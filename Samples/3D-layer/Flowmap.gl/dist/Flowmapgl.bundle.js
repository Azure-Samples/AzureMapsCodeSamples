(function(Ab){typeof define=="function"&&define.amd?define(Ab):Ab()})(function(){"use strict";function Ab(n,e){for(var t=0;t<e.length;t++){const r=e[t];if(typeof r!="string"&&!Array.isArray(r)){for(const i in r)if(i!=="default"&&!(i in n)){const o=Object.getOwnPropertyDescriptor(r,i);o&&Object.defineProperty(n,i,o.get?o:{enumerable:!0,get:()=>r[i]})}}}return Object.freeze(Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}))}function Ib(n,e){if(!n)throw new Error(e||"loader assertion failed.")}const VT=!!(typeof process!="object"||String(process)!=="[object process]"||process.browser),_k=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);_k&&parseFloat(_k[1]);const JV="3.4.15";function Ll(n,e){if(!n)throw new Error(e||"loaders.gl assertion failed.")}const Pb=typeof process!="object"||String(process)!=="[object process]"||process.browser,e7=typeof window<"u"&&typeof window.orientation<"u",vk=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);vk&&parseFloat(vk[1]);function Ay(n){"@babel/helpers - typeof";return Ay=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ay(n)}function t7(n,e){if(Ay(n)!="object"||!n)return n;var t=n[Symbol.toPrimitive];if(t!==void 0){var r=t.call(n,e||"default");if(Ay(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(n)}function n7(n){var e=t7(n,"string");return Ay(e)=="symbol"?e:e+""}function Y(n,e,t){return(e=n7(e))in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}class r7{constructor(e,t){Y(this,"name",void 0),Y(this,"workerThread",void 0),Y(this,"isRunning",!0),Y(this,"result",void 0),Y(this,"_resolve",()=>{}),Y(this,"_reject",()=>{}),this.name=e,this.workerThread=t,this.result=new Promise((r,i)=>{this._resolve=r,this._reject=i})}postMessage(e,t){this.workerThread.postMessage({source:"loaders.gl",type:e,payload:t})}done(e){Ll(this.isRunning),this.isRunning=!1,this._resolve(e)}error(e){Ll(this.isRunning),this.isRunning=!1,this._reject(e)}}let HT=class{terminate(){}};const GT=new Map;function i7(n){Ll(n.source&&!n.url||!n.source&&n.url);let e=GT.get(n.source||n.url);return e||(n.url&&(e=o7(n.url),GT.set(n.url,e)),n.source&&(e=bk(n.source),GT.set(n.source,e))),Ll(e),e}function o7(n){if(!n.startsWith("http"))return n;const e=a7(n);return bk(e)}function bk(n){const e=new Blob([n],{type:"application/javascript"});return URL.createObjectURL(e)}function a7(n){return`try {
  importScripts('`.concat(n,`');
} catch (error) {
  console.error(error);
  throw error;
}`)}function wk(n){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,t=arguments.length>2?arguments[2]:void 0;const r=t||new Set;if(n){if(xk(n))r.add(n);else if(xk(n.buffer))r.add(n.buffer);else if(!ArrayBuffer.isView(n)){if(e&&typeof n=="object")for(const i in n)wk(n[i],e,r)}}return t===void 0?Array.from(r):[]}function xk(n){return n?n instanceof ArrayBuffer||typeof MessagePort<"u"&&n instanceof MessagePort||typeof ImageBitmap<"u"&&n instanceof ImageBitmap||typeof OffscreenCanvas<"u"&&n instanceof OffscreenCanvas:!1}const qT=()=>{};class $T{static isSupported(){return typeof Worker<"u"&&Pb||typeof HT<"u"&&!Pb}constructor(e){Y(this,"name",void 0),Y(this,"source",void 0),Y(this,"url",void 0),Y(this,"terminated",!1),Y(this,"worker",void 0),Y(this,"onMessage",void 0),Y(this,"onError",void 0),Y(this,"_loadableURL","");const{name:t,source:r,url:i}=e;Ll(r||i),this.name=t,this.source=r,this.url=i,this.onMessage=qT,this.onError=o=>console.log(o),this.worker=Pb?this._createBrowserWorker():this._createNodeWorker()}destroy(){this.onMessage=qT,this.onError=qT,this.worker.terminate(),this.terminated=!0}get isRunning(){return!!this.onMessage}postMessage(e,t){t=t||wk(e),this.worker.postMessage(e,t)}_getErrorFromErrorEvent(e){let t="Failed to load ";return t+="worker ".concat(this.name," from ").concat(this.url,". "),e.message&&(t+="".concat(e.message," in ")),e.lineno&&(t+=":".concat(e.lineno,":").concat(e.colno)),new Error(t)}_createBrowserWorker(){this._loadableURL=i7({source:this.source,url:this.url});const e=new Worker(this._loadableURL,{name:this.name});return e.onmessage=t=>{t.data?this.onMessage(t.data):this.onError(new Error("No data received"))},e.onerror=t=>{this.onError(this._getErrorFromErrorEvent(t)),this.terminated=!0},e.onmessageerror=t=>console.error(t),e}_createNodeWorker(){let e;if(this.url){const r=this.url.includes(":/")||this.url.startsWith("/")?this.url:"./".concat(this.url);e=new HT(r,{eval:!1})}else if(this.source)e=new HT(this.source,{eval:!0});else throw new Error("no worker");return e.on("message",t=>{this.onMessage(t)}),e.on("error",t=>{this.onError(t)}),e.on("exit",t=>{}),e}}class s7{static isSupported(){return $T.isSupported()}constructor(e){Y(this,"name","unnamed"),Y(this,"source",void 0),Y(this,"url",void 0),Y(this,"maxConcurrency",1),Y(this,"maxMobileConcurrency",1),Y(this,"onDebug",()=>{}),Y(this,"reuseWorkers",!0),Y(this,"props",{}),Y(this,"jobQueue",[]),Y(this,"idleQueue",[]),Y(this,"count",0),Y(this,"isDestroyed",!1),this.source=e.source,this.url=e.url,this.setProps(e)}destroy(){this.idleQueue.forEach(e=>e.destroy()),this.isDestroyed=!0}setProps(e){this.props={...this.props,...e},e.name!==void 0&&(this.name=e.name),e.maxConcurrency!==void 0&&(this.maxConcurrency=e.maxConcurrency),e.maxMobileConcurrency!==void 0&&(this.maxMobileConcurrency=e.maxMobileConcurrency),e.reuseWorkers!==void 0&&(this.reuseWorkers=e.reuseWorkers),e.onDebug!==void 0&&(this.onDebug=e.onDebug)}async startJob(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:(o,a,l)=>o.done(l),r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:(o,a)=>o.error(a);const i=new Promise(o=>(this.jobQueue.push({name:e,onMessage:t,onError:r,onStart:o}),this));return this._startQueuedJob(),await i}async _startQueuedJob(){if(!this.jobQueue.length)return;const e=this._getAvailableWorker();if(!e)return;const t=this.jobQueue.shift();if(t){this.onDebug({message:"Starting job",name:t.name,workerThread:e,backlog:this.jobQueue.length});const r=new r7(t.name,e);e.onMessage=i=>t.onMessage(r,i.type,i.payload),e.onError=i=>t.onError(r,i),t.onStart(r);try{await r.result}finally{this.returnWorkerToQueue(e)}}}returnWorkerToQueue(e){this.isDestroyed||!this.reuseWorkers||this.count>this._getMaxConcurrency()?(e.destroy(),this.count--):this.idleQueue.push(e),this.isDestroyed||this._startQueuedJob()}_getAvailableWorker(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this._getMaxConcurrency()){this.count++;const e="".concat(this.name.toLowerCase()," (#").concat(this.count," of ").concat(this.maxConcurrency,")");return new $T({name:e,source:this.source,url:this.url})}return null}_getMaxConcurrency(){return e7?this.maxMobileConcurrency:this.maxConcurrency}}const c7={maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:!0,onDebug:()=>{}};class Nl{static isSupported(){return $T.isSupported()}static getWorkerFarm(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return Nl._workerFarm=Nl._workerFarm||new Nl({}),Nl._workerFarm.setProps(e),Nl._workerFarm}constructor(e){Y(this,"props",void 0),Y(this,"workerPools",new Map),this.props={...c7},this.setProps(e),this.workerPools=new Map}destroy(){for(const e of this.workerPools.values())e.destroy();this.workerPools=new Map}setProps(e){this.props={...this.props,...e};for(const t of this.workerPools.values())t.setProps(this._getWorkerPoolProps())}getWorkerPool(e){const{name:t,source:r,url:i}=e;let o=this.workerPools.get(t);return o||(o=new s7({name:t,source:r,url:i}),o.setProps(this._getWorkerPoolProps()),this.workerPools.set(t,o)),o}_getWorkerPoolProps(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}}}Y(Nl,"_workerFarm",void 0);const l7="latest";function u7(n){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const t=e[n.id]||{},r="".concat(n.id,"-worker.js");let i=t.workerUrl;if(!i&&n.id==="compression"&&(i=e.workerUrl),e._workerType==="test"&&(i="modules/".concat(n.module,"/dist/").concat(r)),!i){let o=n.version;o==="latest"&&(o=l7);const a=o?"@".concat(o):"";i="https://unpkg.com/@loaders.gl/".concat(n.module).concat(a,"/dist/").concat(r)}return Ll(i),i}function h7(n){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:JV;Ll(n,"no worker provided");const t=n.version;return!(!e||!t)}const d7=Object.freeze(Object.defineProperty({__proto__:null,default:{}},Symbol.toStringTag,{value:"Module"}));function f7(n,e){return!Nl.isSupported()||!Pb&&!(e!=null&&e._nodeWorkers)?!1:n.worker&&(e==null?void 0:e.worker)}async function p7(n,e,t,r,i){const o=n.id,a=u7(n,t),h=Nl.getWorkerFarm(t).getWorkerPool({name:o,url:a});t=JSON.parse(JSON.stringify(t)),r=JSON.parse(JSON.stringify(r||{}));const p=await h.startJob("process-on-worker",g7.bind(null,i));return p.postMessage("process",{input:e,options:t,context:r}),await(await p.result).result}async function g7(n,e,t,r){switch(t){case"done":e.done(r);break;case"error":e.error(new Error(r.error));break;case"process":const{id:i,input:o,options:a}=r;try{const l=await n(o,a);e.postMessage("done",{id:i,result:l})}catch(l){const h=l instanceof Error?l.message:"unknown error";e.postMessage("error",{id:i,error:h})}break;default:console.warn("parse-with-worker unknown message ".concat(t))}}function m7(n,e,t){if(t=t||n.byteLength,n.byteLength<t||e.byteLength<t)return!1;const r=new Uint8Array(n),i=new Uint8Array(e);for(let o=0;o<r.length;++o)if(r[o]!==i[o])return!1;return!0}function y7(){for(var n=arguments.length,e=new Array(n),t=0;t<n;t++)e[t]=arguments[t];const r=e.map(l=>l instanceof ArrayBuffer?new Uint8Array(l):l),i=r.reduce((l,h)=>l+h.byteLength,0),o=new Uint8Array(i);let a=0;for(const l of r)o.set(l,a),a+=l.byteLength;return o.buffer}async function _7(n){const e=[];for await(const t of n)e.push(t);return y7(...e)}function Ek(){let n;if(typeof window<"u"&&window.performance)n=window.performance.now();else if(typeof process<"u"&&process.hrtime){const e=process.hrtime();n=e[0]*1e3+e[1]/1e6}else n=Date.now();return n}class Tk{constructor(e,t){Y(this,"name",void 0),Y(this,"type",void 0),Y(this,"sampleSize",1),Y(this,"time",void 0),Y(this,"count",void 0),Y(this,"samples",void 0),Y(this,"lastTiming",void 0),Y(this,"lastSampleTime",void 0),Y(this,"lastSampleCount",void 0),Y(this,"_count",0),Y(this,"_time",0),Y(this,"_samples",0),Y(this,"_startTime",0),Y(this,"_timerPending",!1),this.name=e,this.type=t,this.reset()}setSampleSize(e){return this.sampleSize=e,this}incrementCount(){return this.addCount(1),this}decrementCount(){return this.subtractCount(1),this}addCount(e){return this._count+=e,this._samples++,this._checkSampling(),this}subtractCount(e){return this._count-=e,this._samples++,this._checkSampling(),this}addTime(e){return this._time+=e,this.lastTiming=e,this._samples++,this._checkSampling(),this}timeStart(){return this._startTime=Ek(),this._timerPending=!0,this}timeEnd(){return this._timerPending?(this.addTime(Ek()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}getSampleAverageCount(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}getSampleAverageTime(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}getSampleHz(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}getAverageCount(){return this.samples>0?this.count/this.samples:0}getAverageTime(){return this.samples>0?this.time/this.samples:0}getHz(){return this.time>0?this.samples/(this.time/1e3):0}reset(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}_checkSampling(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}}class WT{constructor(e){Y(this,"id",void 0),Y(this,"stats",{}),this.id=e.id,this.stats={},this._initializeStats(e.stats),Object.seal(this)}get(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"count";return this._getOrCreate({name:e,type:t})}get size(){return Object.keys(this.stats).length}reset(){for(const e in this.stats)this.stats[e].reset();return this}forEach(e){for(const t in this.stats)e(this.stats[t])}getTable(){const e={};return this.forEach(t=>{e[t.name]={time:t.time||0,count:t.count||0,average:t.getAverageTime()||0,hz:t.getHz()||0}}),e}_initializeStats(){(arguments.length>0&&arguments[0]!==void 0?arguments[0]:[]).forEach(t=>this._getOrCreate(t))}_getOrCreate(e){if(!e||!e.name)return null;const{name:t,type:r}=e;return this.stats[t]||(e instanceof Tk?this.stats[t]=e:this.stats[t]=new Tk(t,r)),this.stats[t]}}let v7="";const Sk={};function b7(n){for(const e in Sk)if(n.startsWith(e)){const t=Sk[e];n=n.replace(e,t)}return!n.startsWith("http://")&&!n.startsWith("https://")&&(n="".concat(v7).concat(n)),n}function sSe(n){return n}function w7(n){return n&&typeof n=="object"&&n.isBuffer}function Ck(n){if(w7(n))return n;if(n instanceof ArrayBuffer)return n;if(ArrayBuffer.isView(n))return n.byteOffset===0&&n.byteLength===n.buffer.byteLength?n.buffer:n.buffer.slice(n.byteOffset,n.byteOffset+n.byteLength);if(typeof n=="string"){const e=n;return new TextEncoder().encode(e).buffer}if(n&&typeof n=="object"&&n._toArrayBuffer)return n._toArrayBuffer();throw new Error("toArrayBuffer")}function Ak(n){const e=n?n.lastIndexOf("/"):-1;return e>=0?n.substr(e+1):""}function x7(n){const e=n?n.lastIndexOf("/"):-1;return e>=0?n.substr(0,e):""}const E7=n=>typeof n=="boolean",Iy=n=>typeof n=="function",Py=n=>n!==null&&typeof n=="object",Ik=n=>Py(n)&&n.constructor==={}.constructor,T7=n=>n&&typeof n[Symbol.iterator]=="function",S7=n=>n&&typeof n[Symbol.asyncIterator]=="function",bd=n=>typeof Response<"u"&&n instanceof Response||n&&n.arrayBuffer&&n.text&&n.json,wd=n=>typeof Blob<"u"&&n instanceof Blob,C7=n=>n&&typeof n=="object"&&n.isBuffer,A7=n=>typeof ReadableStream<"u"&&n instanceof ReadableStream||Py(n)&&Iy(n.tee)&&Iy(n.cancel)&&Iy(n.getReader),I7=n=>Py(n)&&Iy(n.read)&&Iy(n.pipe)&&E7(n.readable),Pk=n=>A7(n)||I7(n),P7=/^data:([-\w.]+\/[-\w.+]+)(;|,)/,M7=/^([-\w.]+\/[-\w.+]+)/;function R7(n){const e=M7.exec(n);return e?e[1]:n}function Mk(n){const e=P7.exec(n);return e?e[1]:""}const Rk=/\?.*/;function k7(n){const e=n.match(Rk);return e&&e[0]}function YT(n){return n.replace(Rk,"")}function Mb(n){return bd(n)?n.url:wd(n)?n.name||"":typeof n=="string"?n:""}function KT(n){if(bd(n)){const e=n,t=e.headers.get("content-type")||"",r=YT(e.url);return R7(t)||Mk(r)}return wd(n)?n.type||"":typeof n=="string"?Mk(n):""}function O7(n){return bd(n)?n.headers["content-length"]||-1:wd(n)?n.size:typeof n=="string"?n.length:n instanceof ArrayBuffer||ArrayBuffer.isView(n)?n.byteLength:-1}async function kk(n){if(bd(n))return n;const e={},t=O7(n);t>=0&&(e["content-length"]=String(t));const r=Mb(n),i=KT(n);i&&(e["content-type"]=i);const o=await D7(n);o&&(e["x-first-bytes"]=o),typeof n=="string"&&(n=new TextEncoder().encode(n));const a=new Response(n,{headers:e});return Object.defineProperty(a,"url",{value:r}),a}async function L7(n){if(!n.ok){const e=await N7(n);throw new Error(e)}}async function N7(n){let e="Failed to fetch resource ".concat(n.url," (").concat(n.status,"): ");try{const t=n.headers.get("Content-Type");let r=n.statusText;t.includes("application/json")&&(r+=" ".concat(await n.text())),e+=r,e=e.length>60?"".concat(e.slice(0,60),"..."):e}catch{}return e}async function D7(n){if(typeof n=="string")return"data:,".concat(n.slice(0,5));if(n instanceof Blob){const t=n.slice(0,5);return await new Promise(r=>{const i=new FileReader;i.onload=o=>{var a;return r(o==null||(a=o.target)===null||a===void 0?void 0:a.result)},i.readAsDataURL(t)})}if(n instanceof ArrayBuffer){const t=n.slice(0,5),r=F7(t);return"data:base64,".concat(r)}return null}function F7(n){let e="";const t=new Uint8Array(n);for(let r=0;r<t.byteLength;r++)e+=String.fromCharCode(t[r]);return btoa(e)}async function Ok(n,e){if(typeof n=="string"){n=b7(n);let t=e;return e!=null&&e.fetch&&typeof(e==null?void 0:e.fetch)!="function"&&(t=e.fetch),await fetch(n,t)}return await kk(n)}function Lk(n){if(typeof window<"u"&&typeof window.process=="object"&&window.process.type==="renderer"||typeof process<"u"&&typeof process.versions=="object"&&process.versions.electron)return!0;const e=typeof navigator=="object"&&typeof navigator.userAgent=="string"&&navigator.userAgent,t=n||e;return!!(t&&t.indexOf("Electron")>=0)}function Dl(){return!(typeof process=="object"&&String(process)==="[object process]"&&!process.browser)||Lk()}const Rb={self:typeof self<"u"&&self,window:typeof window<"u"&&window,global:typeof global<"u"&&global,document:typeof document<"u"&&document,process:typeof process=="object"&&process},kb=Rb.window||Rb.self||Rb.global,My=Rb.process||{},Nk=typeof __VERSION__<"u"?__VERSION__:"untranspiled source";Dl();const ZT=globalThis;function Dk(n){if(!n&&!Dl())return"Node";if(Lk(n))return"Electron";const t=n||(typeof navigator<"u"?navigator:{}).userAgent||"";if(t.indexOf("Edge")>-1)return"Edge";const r=t.indexOf("MSIE ")!==-1,i=t.indexOf("Trident/")!==-1;return r||i?"IE":ZT.chrome?"Chrome":ZT.safari?"Safari":ZT.mozInnerScreenX?"Firefox":"Unknown"}function B7(n){try{const e=window[n],t="__storage_test__";return e.setItem(t,t),e.removeItem(t),e}catch{return null}}class U7{constructor(e,t){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"sessionStorage";Y(this,"storage",void 0),Y(this,"id",void 0),Y(this,"config",void 0),this.storage=B7(r),this.id=e,this.config=t,this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(e){if(Object.assign(this.config,e),this.storage){const t=JSON.stringify(this.config);this.storage.setItem(this.id,t)}}_loadConfiguration(){let e={};if(this.storage){const t=this.storage.getItem(this.id);e=t?JSON.parse(t):{}}return Object.assign(this.config,e),this}}function z7(n){let e;return n<10?e="".concat(n.toFixed(2),"ms"):n<100?e="".concat(n.toFixed(1),"ms"):n<1e3?e="".concat(n.toFixed(0),"ms"):e="".concat((n/1e3).toFixed(2),"s"),e}function j7(n){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:8;const t=Math.max(e-n.length,0);return"".concat(" ".repeat(t)).concat(n)}function XT(n,e,t){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:600;const i=n.src.replace(/\(/g,"%28").replace(/\)/g,"%29");n.width>r&&(t=Math.min(t,r/n.width));const o=n.width*t,a=n.height*t,l=["font-size:1px;","padding:".concat(Math.floor(a/2),"px ").concat(Math.floor(o/2),"px;"),"line-height:".concat(a,"px;"),"background:url(".concat(i,");"),"background-size:".concat(o,"px ").concat(a,"px;"),"color:transparent;"].join("");return["".concat(e," %c+"),l]}let Ob;(function(n){n[n.BLACK=30]="BLACK",n[n.RED=31]="RED",n[n.GREEN=32]="GREEN",n[n.YELLOW=33]="YELLOW",n[n.BLUE=34]="BLUE",n[n.MAGENTA=35]="MAGENTA",n[n.CYAN=36]="CYAN",n[n.WHITE=37]="WHITE",n[n.BRIGHT_BLACK=90]="BRIGHT_BLACK",n[n.BRIGHT_RED=91]="BRIGHT_RED",n[n.BRIGHT_GREEN=92]="BRIGHT_GREEN",n[n.BRIGHT_YELLOW=93]="BRIGHT_YELLOW",n[n.BRIGHT_BLUE=94]="BRIGHT_BLUE",n[n.BRIGHT_MAGENTA=95]="BRIGHT_MAGENTA",n[n.BRIGHT_CYAN=96]="BRIGHT_CYAN",n[n.BRIGHT_WHITE=97]="BRIGHT_WHITE"})(Ob||(Ob={}));function Fk(n){return typeof n=="string"?Ob[n.toUpperCase()]||Ob.WHITE:n}function V7(n,e,t){return!Dl&&typeof n=="string"&&(e&&(e=Fk(e),n="\x1B[".concat(e,"m").concat(n,"\x1B[39m")),t&&(e=Fk(t),n="\x1B[".concat(t+10,"m").concat(n,"\x1B[49m"))),n}function H7(n){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:["constructor"];const t=Object.getPrototypeOf(n),r=Object.getOwnPropertyNames(t);for(const i of r)typeof n[i]=="function"&&(e.find(o=>i===o)||(n[i]=n[i].bind(n)))}function Lb(n,e){if(!n)throw new Error(e||"Assertion failed")}function wp(){let n;if(Dl&&"performance"in kb){var e,t;n=kb==null||(e=kb.performance)===null||e===void 0||(t=e.now)===null||t===void 0?void 0:t.call(e)}else if("hrtime"in My){var r;const i=My==null||(r=My.hrtime)===null||r===void 0?void 0:r.call(My);n=i[0]*1e3+i[1]/1e6}else n=Date.now();return n}const xp={debug:Dl&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},G7={enabled:!0,level:0};function zs(){}const Bk={},Uk={once:!0};class Ry{constructor(){let{id:e}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{id:""};Y(this,"id",void 0),Y(this,"VERSION",Nk),Y(this,"_startTs",wp()),Y(this,"_deltaTs",wp()),Y(this,"_storage",void 0),Y(this,"userData",{}),Y(this,"LOG_THROTTLE_TIMEOUT",0),this.id=e,this.userData={},this._storage=new U7("__probe-".concat(this.id,"__"),G7),this.timeStamp("".concat(this.id," started")),H7(this),Object.seal(this)}set level(e){this.setLevel(e)}get level(){return this.getLevel()}isEnabled(){return this._storage.config.enabled}getLevel(){return this._storage.config.level}getTotal(){return Number((wp()-this._startTs).toPrecision(10))}getDelta(){return Number((wp()-this._deltaTs).toPrecision(10))}set priority(e){this.level=e}get priority(){return this.level}getPriority(){return this.level}enable(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return this._storage.setConfiguration({enabled:e}),this}setLevel(e){return this._storage.setConfiguration({level:e}),this}get(e){return this._storage.config[e]}set(e,t){this._storage.setConfiguration({[e]:t})}settings(){console.table?console.table(this._storage.config):console.log(this._storage.config)}assert(e,t){Lb(e,t)}warn(e){return this._getLogFunction(0,e,xp.warn,arguments,Uk)}error(e){return this._getLogFunction(0,e,xp.error,arguments)}deprecated(e,t){return this.warn("`".concat(e,"` is deprecated and will be removed in a later version. Use `").concat(t,"` instead"))}removed(e,t){return this.error("`".concat(e,"` has been removed. Use `").concat(t,"` instead"))}probe(e,t){return this._getLogFunction(e,t,xp.log,arguments,{time:!0,once:!0})}log(e,t){return this._getLogFunction(e,t,xp.debug,arguments)}info(e,t){return this._getLogFunction(e,t,console.info,arguments)}once(e,t){for(var r=arguments.length,i=new Array(r>2?r-2:0),o=2;o<r;o++)i[o-2]=arguments[o];return this._getLogFunction(e,t,xp.debug||xp.info,arguments,Uk)}table(e,t,r){return t?this._getLogFunction(e,t,console.table||zs,r&&[r],{tag:Y7(t)}):zs}image(e){let{logLevel:t,priority:r,image:i,message:o="",scale:a=1}=e;return this._shouldLog(t||r)?Dl?W7({image:i,message:o,scale:a}):$7():zs}time(e,t){return this._getLogFunction(e,t,console.time?console.time:console.info)}timeEnd(e,t){return this._getLogFunction(e,t,console.timeEnd?console.timeEnd:console.info)}timeStamp(e,t){return this._getLogFunction(e,t,console.timeStamp||zs)}group(e,t){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{collapsed:!1};const i=jk({logLevel:e,message:t,opts:r}),{collapsed:o}=r;return i.method=(o?console.groupCollapsed:console.group)||console.info,this._getLogFunction(i)}groupCollapsed(e,t){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return this.group(e,t,Object.assign({},r,{collapsed:!0}))}groupEnd(e){return this._getLogFunction(e,"",console.groupEnd||zs)}withGroup(e,t,r){this.group(e,t)();try{r()}finally{this.groupEnd(e)()}}trace(){console.trace&&console.trace()}_shouldLog(e){return this.isEnabled()&&this.getLevel()>=zk(e)}_getLogFunction(e,t,r,i,o){if(this._shouldLog(e)){o=jk({logLevel:e,message:t,args:i,opts:o}),r=r||o.method,Lb(r),o.total=this.getTotal(),o.delta=this.getDelta(),this._deltaTs=wp();const a=o.tag||o.message;if(o.once)if(!Bk[a])Bk[a]=wp();else return zs;return t=q7(this.id,o.message,o),r.bind(console,t,...o.args)}return zs}}Y(Ry,"VERSION",Nk);function zk(n){if(!n)return 0;let e;switch(typeof n){case"number":e=n;break;case"object":e=n.logLevel||n.priority||0;break;default:return 0}return Lb(Number.isFinite(e)&&e>=0),e}function jk(n){const{logLevel:e,message:t}=n;n.logLevel=zk(e);const r=n.args?Array.from(n.args):[];for(;r.length&&r.shift()!==t;);switch(typeof e){case"string":case"function":t!==void 0&&r.unshift(t),n.message=e;break;case"object":Object.assign(n,e);break}typeof n.message=="function"&&(n.message=n.message());const i=typeof n.message;return Lb(i==="string"||i==="object"),Object.assign(n,{args:r},n.opts)}function q7(n,e,t){if(typeof e=="string"){const r=t.time?j7(z7(t.total)):"";e=t.time?"".concat(n,": ").concat(r,"  ").concat(e):"".concat(n,": ").concat(e),e=V7(e,t.color,t.background)}return e}function $7(n){return console.warn("removed"),zs}function W7(n){let{image:e,message:t="",scale:r=1}=n;if(typeof e=="string"){const o=new Image;return o.onload=()=>{const a=XT(o,t,r);console.log(...a)},o.src=e,zs}const i=e.nodeName||"";if(i.toLowerCase()==="img")return console.log(...XT(e,t,r)),zs;if(i.toLowerCase()==="canvas"){const o=new Image;return o.onload=()=>console.log(...XT(o,t,r)),o.src=e.toDataURL(),zs}return zs}function Y7(n){for(const e in n)for(const t in n[e])return t||"untitled";return"empty"}const Vk=new Ry({id:"loaders.gl"});class K7{log(){return()=>{}}info(){return()=>{}}warn(){return()=>{}}error(){return()=>{}}}class Z7{constructor(){Y(this,"console",void 0),this.console=console}log(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return this.console.log.bind(this.console,...t)}info(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return this.console.info.bind(this.console,...t)}warn(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return this.console.warn.bind(this.console,...t)}error(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return this.console.error.bind(this.console,...t)}}const Hk={fetch:null,mimeType:void 0,nothrow:!1,log:new Z7,CDN:"https://unpkg.com/@loaders.gl",worker:!0,maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:VT,_nodeWorkers:!1,_workerType:"",limit:0,_limitMB:0,batchSize:"auto",batchDebounceMs:0,metadata:!1,transforms:[]},X7={throws:"nothrow",dataType:"(no longer used)",uri:"baseUri",method:"fetch.method",headers:"fetch.headers",body:"fetch.body",mode:"fetch.mode",credentials:"fetch.credentials",cache:"fetch.cache",redirect:"fetch.redirect",referrer:"fetch.referrer",referrerPolicy:"fetch.referrerPolicy",integrity:"fetch.integrity",keepalive:"fetch.keepalive",signal:"fetch.signal"};function Gk(){globalThis.loaders=globalThis.loaders||{};const{loaders:n}=globalThis;return n._state=n._state||{},n._state}const qk=()=>{const n=Gk();return n.globalOptions=n.globalOptions||{...Hk},n.globalOptions};function Q7(n,e,t,r){return t=t||[],t=Array.isArray(t)?t:[t],J7(n,t),tH(e,n,r)}function J7(n,e){$k(n,null,Hk,X7,e);for(const t of e){const r=n&&n[t.id]||{},i=t.options&&t.options[t.id]||{},o=t.deprecatedOptions&&t.deprecatedOptions[t.id]||{};$k(r,t.id,i,o,e)}}function $k(n,e,t,r,i){const o=e||"Top level",a=e?"".concat(e,"."):"";for(const l in n){const h=!e&&Py(n[l]),p=l==="baseUri"&&!e,g=l==="workerUrl"&&e;if(!(l in t)&&!p&&!g){if(l in r)Vk.warn("".concat(o," loader option '").concat(a).concat(l,"' no longer supported, use '").concat(r[l],"'"))();else if(!h){const _=eH(l,i);Vk.warn("".concat(o," loader option '").concat(a).concat(l,"' not recognized. ").concat(_))()}}}}function eH(n,e){const t=n.toLowerCase();let r="";for(const i of e)for(const o in i.options){if(n===o)return"Did you mean '".concat(i.id,".").concat(o,"'?");const a=o.toLowerCase();(t.startsWith(a)||a.startsWith(t))&&(r=r||"Did you mean '".concat(i.id,".").concat(o,"'?"))}return r}function tH(n,e,t){const i={...n.options||{}};return nH(i,t),i.log===null&&(i.log=new K7),Wk(i,qk()),Wk(i,e),i}function Wk(n,e){for(const t in e)if(t in e){const r=e[t];Ik(r)&&Ik(n[t])?n[t]={...n[t],...e[t]}:n[t]=e[t]}}function nH(n,e){e&&!("baseUri"in n)&&(n.baseUri=e)}function QT(n){var e;return n?(Array.isArray(n)&&(n=n[0]),Array.isArray((e=n)===null||e===void 0?void 0:e.extensions)):!1}function JT(n){var e,t;Ib(n,"null loader"),Ib(QT(n),"invalid loader");let r;return Array.isArray(n)&&(r=n[1],n=n[0],n={...n,options:{...n.options,...r}}),((e=n)!==null&&e!==void 0&&e.parseTextSync||(t=n)!==null&&t!==void 0&&t.parseText)&&(n.text=!0),n.text||(n.binary=!0),n}const Yk=()=>{const n=Gk();return n.loaderRegistry=n.loaderRegistry||[],n.loaderRegistry};function rH(n){const e=Yk();n=Array.isArray(n)?n:[n];for(const t of n){const r=JT(t);e.find(i=>r===i)||e.unshift(r)}}function iH(){return Yk()}const oH=new Ry({id:"loaders.gl"}),aH=/\.([^.]+)$/;async function sH(n){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],t=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0;if(!Zk(n))return null;let i=Kk(n,e,{...t,nothrow:!0},r);if(i)return i;if(wd(n)&&(n=await n.slice(0,10).arrayBuffer(),i=Kk(n,e,t,r)),!i&&!(t!=null&&t.nothrow))throw new Error(Xk(n));return i}function Kk(n){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],t=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0;if(!Zk(n))return null;if(e&&!Array.isArray(e))return JT(e);let i=[];e&&(i=i.concat(e)),t!=null&&t.ignoreRegisteredLoaders||i.push(...iH()),lH(i);const o=cH(n,i,t,r);if(!o&&!(t!=null&&t.nothrow))throw new Error(Xk(n));return o}function cH(n,e,t,r){const i=Mb(n),o=KT(n),a=YT(i)||(r==null?void 0:r.url);let l=null,h="";if(t!=null&&t.mimeType&&(l=eS(e,t==null?void 0:t.mimeType),h="match forced by supplied MIME type ".concat(t==null?void 0:t.mimeType)),l=l||uH(e,a),h=h||(l?"matched url ".concat(a):""),l=l||eS(e,o),h=h||(l?"matched MIME type ".concat(o):""),l=l||dH(e,n),h=h||(l?"matched initial data ".concat(Jk(n)):""),l=l||eS(e,t==null?void 0:t.fallbackMimeType),h=h||(l?"matched fallback MIME type ".concat(o):""),h){var p;oH.log(1,"selectLoader selected ".concat((p=l)===null||p===void 0?void 0:p.name,": ").concat(h,"."))}return l}function Zk(n){return!(n instanceof Response&&n.status===204)}function Xk(n){const e=Mb(n),t=KT(n);let r="No valid loader found (";r+=e?"".concat(Ak(e),", "):"no url provided, ",r+="MIME type: ".concat(t?'"'.concat(t,'"'):"not provided",", ");const i=n?Jk(n):"";return r+=i?' first bytes: "'.concat(i,'"'):"first bytes: not available",r+=")",r}function lH(n){for(const e of n)JT(e)}function uH(n,e){const t=e&&aH.exec(e),r=t&&t[1];return r?hH(n,r):null}function hH(n,e){e=e.toLowerCase();for(const t of n)for(const r of t.extensions)if(r.toLowerCase()===e)return t;return null}function eS(n,e){for(const t of n)if(t.mimeTypes&&t.mimeTypes.includes(e)||e==="application/x.".concat(t.id))return t;return null}function dH(n,e){if(!e)return null;for(const t of n)if(typeof e=="string"){if(fH(e,t))return t}else if(ArrayBuffer.isView(e)){if(Qk(e.buffer,e.byteOffset,t))return t}else if(e instanceof ArrayBuffer&&Qk(e,0,t))return t;return null}function fH(n,e){return e.testText?e.testText(n):(Array.isArray(e.tests)?e.tests:[e.tests]).some(r=>n.startsWith(r))}function Qk(n,e,t){return(Array.isArray(t.tests)?t.tests:[t.tests]).some(i=>pH(n,e,t,i))}function pH(n,e,t,r){if(r instanceof ArrayBuffer)return m7(r,n,r.byteLength);switch(typeof r){case"function":return r(n,t);case"string":const i=tS(n,e,r.length);return r===i;default:return!1}}function Jk(n){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5;return typeof n=="string"?n.slice(0,e):ArrayBuffer.isView(n)?tS(n.buffer,n.byteOffset,e):n instanceof ArrayBuffer?tS(n,0,e):""}function tS(n,e,t){if(n.byteLength<e+t)return"";const r=new DataView(n);let i="";for(let o=0;o<t;o++)i+=String.fromCharCode(r.getUint8(e+o));return i}const gH=256*1024;function*mH(n,e){const t=(e==null?void 0:e.chunkSize)||gH;let r=0;const i=new TextEncoder;for(;r<n.length;){const o=Math.min(n.length-r,t),a=n.slice(r,r+o);r+=o,yield i.encode(a)}}const yH=256*1024;function _H(n){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return function*(){const{chunkSize:t=yH}=e;let r=0;for(;r<n.byteLength;){const i=Math.min(n.byteLength-r,t),o=new ArrayBuffer(i),a=new Uint8Array(n,r,i);new Uint8Array(o).set(a),r+=i,yield o}}()}const vH=1024*1024;async function*bH(n,e){const t=(e==null?void 0:e.chunkSize)||vH;let r=0;for(;r<n.size;){const i=r+t,o=await n.slice(r,i).arrayBuffer();r=i,yield o}}function eO(n,e){return VT?wH(n,e):xH(n)}async function*wH(n,e){const t=n.getReader();let r;try{for(;;){const i=r||t.read();e!=null&&e._streamReadAhead&&(r=t.read());const{done:o,value:a}=await i;if(o)return;yield Ck(a)}}catch{t.releaseLock()}}async function*xH(n,e){for await(const t of n)yield Ck(t)}function EH(n,e){if(typeof n=="string")return mH(n,e);if(n instanceof ArrayBuffer)return _H(n,e);if(wd(n))return bH(n,e);if(Pk(n))return eO(n,e);if(bd(n))return eO(n.body,e);throw new Error("makeIterator")}const tO="Cannot convert supplied data type";function TH(n,e,t){if(e.text&&typeof n=="string")return n;if(C7(n)&&(n=n.buffer),n instanceof ArrayBuffer){const r=n;return e.text&&!e.binary?new TextDecoder("utf8").decode(r):r}if(ArrayBuffer.isView(n)){if(e.text&&!e.binary)return new TextDecoder("utf8").decode(n);let r=n.buffer;const i=n.byteLength||n.length;return(n.byteOffset!==0||i!==r.byteLength)&&(r=r.slice(n.byteOffset,n.byteOffset+i)),r}throw new Error(tO)}async function SH(n,e,t){const r=n instanceof ArrayBuffer||ArrayBuffer.isView(n);if(typeof n=="string"||r)return TH(n,e);if(wd(n)&&(n=await kk(n)),bd(n)){const i=n;return await L7(i),e.binary?await i.arrayBuffer():await i.text()}if(Pk(n)&&(n=EH(n,t)),T7(n)||S7(n))return _7(n);throw new Error(tO)}function nO(n,e){const t=qk(),r=n||t;return typeof r.fetch=="function"?r.fetch:Py(r.fetch)?i=>Ok(i,r):e!=null&&e.fetch?e==null?void 0:e.fetch:Ok}function CH(n,e,t){if(t)return t;const r={fetch:nO(e,n),...n};if(r.url){const i=YT(r.url);r.baseUrl=i,r.queryString=k7(r.url),r.filename=Ak(i),r.baseUrl=x7(i)}return Array.isArray(r.loaders)||(r.loaders=null),r}function AH(n,e){if(!e&&n&&!Array.isArray(n))return n;let t;if(n&&(t=Array.isArray(n)?n:[n]),e&&e.loaders){const r=Array.isArray(e.loaders)?e.loaders:[e.loaders];t=t?[...t,...r]:r}return t&&t.length?t:null}async function nS(n,e,t,r){Ll(!r||typeof r=="object"),e&&!Array.isArray(e)&&!QT(e)&&(r=void 0,t=e,e=void 0),n=await n,t=t||{};const i=Mb(n),a=AH(e,r),l=await sH(n,a,t);return l?(t=Q7(t,l,a,i),r=CH({url:i,parse:nS,loaders:a},t,r||null),await IH(l,n,t,r)):null}async function IH(n,e,t,r){if(h7(n),bd(e)){const i=e,{ok:o,redirected:a,status:l,statusText:h,type:p,url:g}=i,_=Object.fromEntries(i.headers.entries());r.response={headers:_,ok:o,redirected:a,status:l,statusText:h,type:p,url:g}}if(e=await SH(e,n,t),n.parseTextSync&&typeof e=="string")return t.dataType="text",n.parseTextSync(e,t,r,n);if(f7(n,t))return await p7(n,e,t,r,nS);if(n.parseText&&typeof e=="string")return await n.parseText(e,t,r,n);if(n.parse)return await n.parse(e,t,r,n);throw Ll(!n.parseSync),new Error("".concat(n.id," loader - no parser found and worker is disabled"))}async function Nb(n,e,t,r){!Array.isArray(e)&&!QT(e)&&(t=e,e=void 0);const i=nO(t);let o=n;return typeof n=="string"&&(o=await i(n)),wd(n)&&(o=await i(n)),await nS(o,e,t)}const PH="3.4.15",{_parseImageNode:MH}=globalThis,rS=typeof Image<"u",iS=typeof ImageBitmap<"u",oS=VT?!0:!!MH;function RH(n){switch(n){case"auto":return iS||rS||oS;case"imagebitmap":return iS;case"image":return rS;case"data":return oS;default:throw new Error("@loaders.gl/images: image ".concat(n," not supported in this environment"))}}function kH(){if(iS)return"imagebitmap";if(rS)return"image";if(oS)return"data";throw new Error("Install '@loaders.gl/polyfills' to parse images under Node.js")}function OH(n){const e=NH(n);if(!e)throw new Error("Not an image");return e}function LH(n){switch(OH(n)){case"data":return n;case"image":case"imagebitmap":const e=document.createElement("canvas"),t=e.getContext("2d");if(!t)throw new Error("getImageData");return e.width=n.width,e.height=n.height,t.drawImage(n,0,0),t.getImageData(0,0,n.width,n.height);default:throw new Error("getImageData")}}function NH(n){return typeof ImageBitmap<"u"&&n instanceof ImageBitmap?"imagebitmap":typeof Image<"u"&&n instanceof Image?"image":n&&typeof n=="object"&&n.data&&n.width&&n.height?"data":null}const DH=/^data:image\/svg\+xml/,FH=/\.svg((\?|#).*)?$/;function aS(n){return n&&(DH.test(n)||FH.test(n))}function BH(n,e){if(aS(e)){let r=new TextDecoder().decode(n);try{typeof unescape=="function"&&typeof encodeURIComponent=="function"&&(r=unescape(encodeURIComponent(r)))}catch(o){throw new Error(o.message)}return"data:image/svg+xml;base64,".concat(btoa(r))}return rO(n,e)}function rO(n,e){if(aS(e))throw new Error("SVG cannot be parsed directly to imagebitmap");return new Blob([new Uint8Array(n)])}async function iO(n,e,t){const r=BH(n,t),i=self.URL||self.webkitURL,o=typeof r!="string"&&i.createObjectURL(r);try{return await UH(o||r,e)}finally{o&&i.revokeObjectURL(o)}}async function UH(n,e){const t=new Image;return t.src=n,e.image&&e.image.decode&&t.decode?(await t.decode(),t):await new Promise((r,i)=>{try{t.onload=()=>r(t),t.onerror=o=>i(new Error("Could not load image ".concat(n,": ").concat(o)))}catch(o){i(o)}})}const zH={};let oO=!0;async function jH(n,e,t){let r;aS(t)?r=await iO(n,e,t):r=rO(n,t);const i=e&&e.imagebitmap;return await VH(r,i)}async function VH(n){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;if((HH(e)||!oO)&&(e=null),e)try{return await createImageBitmap(n,e)}catch(t){console.warn(t),oO=!1}return await createImageBitmap(n)}function HH(n){for(const e in n||zH)return!1;return!0}function GH(n){return!YH(n,"ftyp",4)||!(n[8]&96)?null:qH(n)}function qH(n){switch($H(n,8,12).replace("\0"," ").trim()){case"avif":case"avis":return{extension:"avif",mimeType:"image/avif"};default:return null}}function $H(n,e,t){return String.fromCharCode(...n.slice(e,t))}function WH(n){return[...n].map(e=>e.charCodeAt(0))}function YH(n,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const r=WH(e);for(let i=0;i<r.length;++i)if(r[i]!==n[i+t])return!1;return!0}const Fc=!1,ky=!0;function aO(n){const e=Oy(n);return ZH(e)||JH(e)||XH(e)||QH(e)||KH(e)}function KH(n){const e=new Uint8Array(n instanceof DataView?n.buffer:n),t=GH(e);return t?{mimeType:t.mimeType,width:0,height:0}:null}function ZH(n){const e=Oy(n);return e.byteLength>=24&&e.getUint32(0,Fc)===2303741511?{mimeType:"image/png",width:e.getUint32(16,Fc),height:e.getUint32(20,Fc)}:null}function XH(n){const e=Oy(n);return e.byteLength>=10&&e.getUint32(0,Fc)===1195984440?{mimeType:"image/gif",width:e.getUint16(6,ky),height:e.getUint16(8,ky)}:null}function QH(n){const e=Oy(n);return e.byteLength>=14&&e.getUint16(0,Fc)===16973&&e.getUint32(2,ky)===e.byteLength?{mimeType:"image/bmp",width:e.getUint32(18,ky),height:e.getUint32(22,ky)}:null}function JH(n){const e=Oy(n);if(!(e.byteLength>=3&&e.getUint16(0,Fc)===65496&&e.getUint8(2)===255))return null;const{tableMarkers:r,sofMarkers:i}=eG();let o=2;for(;o+9<e.byteLength;){const a=e.getUint16(o,Fc);if(i.has(a))return{mimeType:"image/jpeg",height:e.getUint16(o+5,Fc),width:e.getUint16(o+7,Fc)};if(!r.has(a))return null;o+=2,o+=e.getUint16(o,Fc)}return null}function eG(){const n=new Set([65499,65476,65484,65501,65534]);for(let t=65504;t<65520;++t)n.add(t);return{tableMarkers:n,sofMarkers:new Set([65472,65473,65474,65475,65477,65478,65479,65481,65482,65483,65485,65486,65487,65502])}}function Oy(n){if(n instanceof DataView)return n;if(ArrayBuffer.isView(n))return new DataView(n.buffer);if(n instanceof ArrayBuffer)return new DataView(n);throw new Error("toDataView")}async function tG(n,e){const{mimeType:t}=aO(n)||{},r=globalThis._parseImageNode;return Ib(r),await r(n,t)}async function nG(n,e,t){e=e||{};const i=(e.image||{}).type||"auto",{url:o}=t||{},a=rG(i);let l;switch(a){case"imagebitmap":l=await jH(n,e,o);break;case"image":l=await iO(n,e,o);break;case"data":l=await tG(n);break;default:Ib(!1)}return i==="data"&&(l=LH(l)),l}function rG(n){switch(n){case"auto":case"data":return kH();default:return RH(n),n}}const iG={id:"image",module:"images",name:"Images",version:PH,mimeTypes:["image/png","image/jpeg","image/gif","image/webp","image/avif","image/bmp","image/vnd.microsoft.icon","image/svg+xml"],extensions:["png","jpg","jpeg","gif","webp","bmp","ico","svg","avif"],parse:nG,tests:[n=>!!aO(new DataView(n))],options:{image:{type:"auto",decode:!0}}},Ir=new Ry({id:"deck"}),zu={attributeUpdateStart:-1,attributeManagerUpdateStart:-1,attributeUpdateMessages:[]},sS=1,Ly=2,cS=3,lS=4,oG=2,aG=n=>({"layer.changeFlag":(e,t,r)=>{n.log(cS,"".concat(e.id," ").concat(t,": "),r[t])()},"layer.initialize":e=>{n.log(sS,"Initializing ".concat(e))()},"layer.update":(e,t)=>{if(t){const r=e.getChangeFlags();n.log(Ly,"Updating ".concat(e," because: ").concat(Object.keys(r).filter(i=>r[i]).join(", ")))()}else n.log(lS,"".concat(e," does not need update"))()},"layer.matched":(e,t)=>{t&&n.log(lS,"Matched ".concat(e,", state transfered"))()},"layer.finalize":e=>{n.log(sS,"Finalizing ".concat(e))()},"compositeLayer.renderLayers":(e,t,r)=>{t?n.log(Ly,"Composite layer rendered new subLayers ".concat(e),r)():n.log(lS,"Composite layer reused subLayers ".concat(e),r)()},"layerManager.setLayers":(e,t,r)=>{t&&n.log(Ly,"Updating ".concat(r.length," deck layers"))()},"layerManager.activateViewport":(e,t)=>{n.log(cS,"Viewport changed",t)()},"attributeManager.invalidate":(e,t,r)=>{n.log(sS,r?"invalidated attributes ".concat(r," (").concat(t,") for ").concat(e.id):"invalidated all attributes for ".concat(e.id))()},"attributeManager.updateStart":e=>{zu.attributeUpdateMessages.length=0,zu.attributeManagerUpdateStart=Date.now()},"attributeManager.updateEnd":(e,t)=>{const r=Math.round(Date.now()-zu.attributeManagerUpdateStart);n.groupCollapsed(Ly,"Updated attributes for ".concat(t," instances in ").concat(e.id," in ").concat(r,"ms"))();for(const i of zu.attributeUpdateMessages)n.log(cS,i)();n.groupEnd(Ly)()},"attribute.updateStart":e=>{zu.attributeUpdateStart=Date.now()},"attribute.allocate":(e,t)=>{const r="".concat(e.id," allocated ").concat(t);zu.attributeUpdateMessages.push(r)},"attribute.updateEnd":(e,t)=>{const r=Math.round(Date.now()-zu.attributeUpdateStart),i="".concat(e.id," updated ").concat(t," in ").concat(r,"ms");zu.attributeUpdateMessages.push(i)},"deckRenderer.renderLayers":(e,t,r)=>{const{pass:i,redrawReason:o,stats:a}=r;for(const l of t){const{totalCount:h,visibleCount:p,compositeCount:g,pickableCount:_}=l,C=h-g-p;n.log(oG,"RENDER #".concat(e.renderCount,"   ").concat(p," (of ").concat(h," layers) to ").concat(i," because ").concat(o,"   (").concat(C," hidden, ").concat(g," composite ").concat(_," pickable)"))(),a&&a.get("Redraw Layers").add(p)}}});let Db={};({}).NODE_ENV!=="production"&&(Db=aG(Ir));function sG(n){Db=n}function oa(n,e,t,r){Ir.level>0&&Db[n]&&Db[n].call(null,e,t,r)}function cG(n){const e=n[0],t=n[n.length-1];return e==="{"&&t==="}"||e==="["&&t==="]"}const lG={id:"JSON",name:"JSON",module:"",version:"",options:{},extensions:["json","geojson"],mimeTypes:["application/json","application/geo+json"],testText:cG,parseTextSync:JSON.parse};function uG(){const n="8.9.36",e=globalThis.deck&&globalThis.deck.VERSION;if(e&&e!==n)throw new Error("deck.gl - multiple versions detected: ".concat(e," vs ").concat(n));return e||(Ir.log(1,"deck.gl ".concat(n))(),globalThis.deck={...globalThis.deck,VERSION:n,version:n,log:Ir,_registerLoggers:sG},rH([lG,[iG,{imagebitmap:{premultiplyAlpha:"none"}}]])),n}const hG=uG(),Zr={DEFAULT:-1,LNGLAT:1,METER_OFFSETS:2,LNGLAT_OFFSETS:3,CARTESIAN:0};Object.defineProperty(Zr,"IDENTITY",{get:()=>(Ir.deprecated("COORDINATE_SYSTEM.IDENTITY","COORDINATE_SYSTEM.CARTESIAN")(),0)});const Bc={WEB_MERCATOR:1,GLOBE:2,WEB_MERCATOR_AUTO_OFFSET:4,IDENTITY:0},Ep={common:0,meters:1,pixels:2},sO={click:{handler:"onClick"},panstart:{handler:"onDragStart"},panmove:{handler:"onDrag"},panend:{handler:"onDragEnd"}},Tn=new Ry({id:"luma.gl"});function va(n,e){if(!n)throw new Error(e||"luma.gl: assertion failed.")}const dG="Invalid WebGLRenderingContext",fG="Requires WebGL2";function Fb(n){return typeof WebGLRenderingContext<"u"&&n instanceof WebGLRenderingContext||typeof WebGL2RenderingContext<"u"&&n instanceof WebGL2RenderingContext?!0:!!(n&&Number.isFinite(n._version))}function yr(n){return typeof WebGL2RenderingContext<"u"&&n instanceof WebGL2RenderingContext?!0:!!(n&&n._version===2)}function pG(n){return yr(n)?n:null}function Bb(n){return va(Fb(n),dG),n}function aa(n){return va(yr(n),fG),n}const Ny={};function gG(n){globalThis.console&&globalThis.console.error&&globalThis.console.error(n)}function mG(n){globalThis.console&&globalThis.console.log&&globalThis.console.log(n)}function yG(n,e){Ny[n]=!0,e!==void 0&&gG(e)}function _G(n){const e=n.getError;n.getError=function(){let r;do r=e.apply(n),r!==0&&(Ny[r]=!0);while(r!==0);for(r in Ny)if(Ny[r])return delete Ny[r],parseInt(r,10);return 0}}const Dy=function n(e){const t=e.gl;this.ext=e,this.isAlive=!0,this.hasBeenBound=!1,this.elementArrayBuffer=null,this.attribs=new Array(e.maxVertexAttribs);for(let r=0;r<this.attribs.length;r++){const i=new n.VertexAttrib(t);this.attribs[r]=i}this.maxAttrib=0};Dy.VertexAttrib=function(e){this.enabled=!1,this.buffer=null,this.size=4,this.type=5126,this.normalized=!1,this.stride=16,this.offset=0,this.cached="",this.recache()},Dy.VertexAttrib.prototype.recache=function(){this.cached=[this.size,this.type,this.normalized,this.stride,this.offset].join(":")};const xd=function(e){const t=this;this.gl=e,_G(e);const r=this.original={getParameter:e.getParameter,enableVertexAttribArray:e.enableVertexAttribArray,disableVertexAttribArray:e.disableVertexAttribArray,bindBuffer:e.bindBuffer,getVertexAttrib:e.getVertexAttrib,vertexAttribPointer:e.vertexAttribPointer};e.getParameter=function(o){return o===t.VERTEX_ARRAY_BINDING_OES?t.currentVertexArrayObject===t.defaultVertexArrayObject?null:t.currentVertexArrayObject:r.getParameter.apply(this,arguments)},e.enableVertexAttribArray=function(o){const a=t.currentVertexArrayObject;a.maxAttrib=Math.max(a.maxAttrib,o);const l=a.attribs[o];return l.enabled=!0,r.enableVertexAttribArray.apply(this,arguments)},e.disableVertexAttribArray=function(o){const a=t.currentVertexArrayObject;a.maxAttrib=Math.max(a.maxAttrib,o);const l=a.attribs[o];return l.enabled=!1,r.disableVertexAttribArray.apply(this,arguments)},e.bindBuffer=function(o,a){switch(o){case 34962:t.currentArrayBuffer=a;break;case 34963:t.currentVertexArrayObject.elementArrayBuffer=a;break}return r.bindBuffer.apply(this,arguments)},e.getVertexAttrib=function(o,a){const h=t.currentVertexArrayObject.attribs[o];switch(a){case 34975:return h.buffer;case 34338:return h.enabled;case 34339:return h.size;case 34340:return h.stride;case 34341:return h.type;case 34922:return h.normalized;default:return r.getVertexAttrib.apply(this,arguments)}},e.vertexAttribPointer=function(o,a,l,h,p,g){const _=t.currentVertexArrayObject;_.maxAttrib=Math.max(_.maxAttrib,o);const x=_.attribs[o];return x.buffer=t.currentArrayBuffer,x.size=a,x.type=l,x.normalized=h,x.stride=p,x.offset=g,x.recache(),r.vertexAttribPointer.apply(this,arguments)},e.instrumentExtension&&e.instrumentExtension(this,"OES_vertex_array_object"),e.canvas&&e.canvas.addEventListener("webglcontextrestored",()=>{mG("OESVertexArrayObject emulation library context restored"),t.reset_()},!0),this.reset_()};xd.prototype.VERTEX_ARRAY_BINDING_OES=34229,xd.prototype.reset_=function(){if(this.vertexArrayObjects!==void 0)for(let r=0;r<this.vertexArrayObjects.length;++r)this.vertexArrayObjects.isAlive=!1;const t=this.gl;this.maxVertexAttribs=t.getParameter(34921),this.defaultVertexArrayObject=new Dy(this),this.currentVertexArrayObject=null,this.currentArrayBuffer=null,this.vertexArrayObjects=[this.defaultVertexArrayObject],this.bindVertexArrayOES(null)},xd.prototype.createVertexArrayOES=function(){const e=new Dy(this);return this.vertexArrayObjects.push(e),e},xd.prototype.deleteVertexArrayOES=function(e){e.isAlive=!1,this.vertexArrayObjects.splice(this.vertexArrayObjects.indexOf(e),1),this.currentVertexArrayObject===e&&this.bindVertexArrayOES(null)},xd.prototype.isVertexArrayOES=function(e){return!!(e&&e instanceof Dy&&e.hasBeenBound&&e.ext===this)},xd.prototype.bindVertexArrayOES=function(e){const t=this.gl;if(e&&!e.isAlive){yG(1282,"bindVertexArrayOES: attempt to bind deleted arrayObject");return}const r=this.original,i=this.currentVertexArrayObject;this.currentVertexArrayObject=e||this.defaultVertexArrayObject,this.currentVertexArrayObject.hasBeenBound=!0;const o=this.currentVertexArrayObject;if(i===o)return;(!i||o.elementArrayBuffer!==i.elementArrayBuffer)&&r.bindBuffer.call(t,34963,o.elementArrayBuffer);let a=this.currentArrayBuffer;const l=Math.max(i?i.maxAttrib:0,o.maxAttrib);for(let h=0;h<=l;h++){const p=o.attribs[h],g=i?i.attribs[h]:null;if((!i||p.enabled!==g.enabled)&&(p.enabled?r.enableVertexAttribArray.call(t,h):r.disableVertexAttribArray.call(t,h)),p.enabled){let _=!1;(!i||p.buffer!==g.buffer)&&(a!==p.buffer&&(r.bindBuffer.call(t,34962,p.buffer),a=p.buffer),_=!0),(_||p.cached!==g.cached)&&r.vertexAttribPointer.call(t,h,p.size,p.type,p.normalized,p.stride,p.offset)}}this.currentArrayBuffer!==a&&r.bindBuffer.call(t,34962,this.currentArrayBuffer)};function vG(n){if(typeof n.createVertexArray=="function")return;const e=n.getSupportedExtensions;n.getSupportedExtensions=function(){const i=e.call(this)||[];return i.indexOf("OES_vertex_array_object")<0&&i.push("OES_vertex_array_object"),i};const t=n.getExtension;n.getExtension=function(i){const o=t.call(this,i);return o||(i!=="OES_vertex_array_object"?null:(n.__OESVertexArrayObject||(this.__OESVertexArrayObject=new xd(this)),this.__OESVertexArrayObject))}}const cO="OES_element_index",lO="WEBGL_draw_buffers",bG="EXT_disjoint_timer_query",wG="EXT_disjoint_timer_query_webgl2",xG="EXT_texture_filter_anisotropic",uO="WEBGL_debug_renderer_info",EG=35723,TG=4352,SG=36795,CG=34047,AG=37445,IG=37446,di=n=>yr(n)?void 0:0,PG={3074:n=>yr(n)?void 0:36064,[EG]:n=>yr(n)?void 0:TG,35977:di,32937:di,[SG]:(n,e)=>{const t=yr(n)?n.getExtension(wG):n.getExtension(bG);return t&&t.GPU_DISJOINT_EXT?e(t.GPU_DISJOINT_EXT):0},[AG]:(n,e)=>{const t=n.getExtension(uO);return e(t&&t.UNMASKED_VENDOR_WEBGL||7936)},[IG]:(n,e)=>{const t=n.getExtension(uO);return e(t&&t.UNMASKED_RENDERER_WEBGL||7937)},[CG]:(n,e)=>{const t=n.luma.extensions[xG];return t?e(t.MAX_TEXTURE_MAX_ANISOTROPY_EXT):1},32883:di,35071:di,37447:di,36063:(n,e)=>{if(!yr(n)){const t=n.getExtension(lO);return t?e(t.MAX_COLOR_ATTACHMENTS_WEBGL):0}},35379:di,35374:di,35377:di,34852:n=>{if(!yr(n)){const e=n.getExtension(lO);return e?e.MAX_DRAW_BUFFERS_WEBGL:0}},36203:n=>n.getExtension(cO)?2147483647:65535,33001:n=>n.getExtension(cO)?16777216:65535,33e3:n=>16777216,37157:di,35373:di,35657:di,36183:di,37137:di,34045:di,35978:di,35979:di,35968:di,35376:di,35375:di,35659:di,37154:di,35371:di,35658:di,35076:di,35077:di,35380:di};function MG(n,e,t){const r=PG[t],i=typeof r=="function"?r(n,e,t):r;return i!==void 0?i:e(t)}const RG="OES_vertex_array_object",hO="ANGLE_instanced_arrays",kG="WEBGL_draw_buffers",OG="EXT_disjoint_timer_query",LG="EXT_texture_filter_anisotropic",NG="VertexArray requires WebGL2 or OES_vertex_array_object extension";function DG(n,e){return{webgl2:yr(n),ext:n.getExtension(e)}}const dO={[RG]:{meta:{suffix:"OES"},createVertexArray:()=>{va(!1,NG)},deleteVertexArray:()=>{},bindVertexArray:()=>{},isVertexArray:()=>!1},[hO]:{meta:{suffix:"ANGLE"},vertexAttribDivisor(n,e){va(e===0,"WebGL instanced rendering not supported")},drawElementsInstanced:()=>{},drawArraysInstanced:()=>{}},[kG]:{meta:{suffix:"WEBGL"},drawBuffers:()=>{va(!1)}},[OG]:{meta:{suffix:"EXT"},createQuery:()=>{va(!1)},deleteQuery:()=>{va(!1)},beginQuery:()=>{va(!1)},endQuery:()=>{},getQuery(n,e){return this.getQueryObject(n,e)},getQueryParameter(n,e){return this.getQueryObject(n,e)},getQueryObject:()=>{}}},uS={readBuffer:(n,e,t)=>{yr(n)&&e(t)},getVertexAttrib:(n,e,t,r)=>{const{webgl2:i,ext:o}=DG(n,hO);let a;switch(r){case 35069:a=i?void 0:!1;break;case 35070:a=!i&&!o?0:void 0;break}return a!==void 0?a:e(t,r)},getProgramParameter:(n,e,t,r)=>{if(!yr(n))switch(r){case 35967:return 35981;case 35971:return 0;case 35382:return 0}return e(t,r)},getInternalformatParameter:(n,e,t,r,i)=>{if(!yr(n))switch(i){case 32937:return new Int32Array([0])}return n.getInternalformatParameter(t,r,i)},getTexParameter(n,e,t,r){switch(r){case 34046:const{extensions:i}=n.luma,o=i[LG];r=o&&o.TEXTURE_MAX_ANISOTROPY_EXT||34046;break}return e(t,r)},getParameter:MG,hint(n,e,t,r){return e(t,r)}};function FG(n){n.luma=n.luma||{};const{luma:e}=n;return e.polyfilled||(vG(n),BG(n),zG(n,dO),UG(n,{target:e,target2:n}),e.polyfilled=!0),n}globalThis.polyfillContext=FG;function BG(n){n.luma.extensions={};const e=n.getSupportedExtensions()||[];for(const t of e)n.luma[t]=n.getExtension(t)}function UG(n,e){let{target:t,target2:r}=e;Object.keys(uS).forEach(i=>{if(typeof uS[i]=="function"){const o=n[i]?n[i].bind(n):()=>{},a=uS[i].bind(null,n,o);t[i]=a,r[i]=a}})}function zG(n,e){for(const t of Object.getOwnPropertyNames(e))t!=="overrides"&&jG(n,{extension:t,target:n.luma,target2:n})}function jG(n,e){let{extension:t,target:r,target2:i}=e;const o=dO[t];va(o);const{meta:a={}}=o,{suffix:l=""}=a,h=n.getExtension(t);for(const p of Object.keys(o)){const g="".concat(p).concat(l);let _=null;p==="meta"||typeof n[p]=="function"||(h&&typeof h[g]=="function"?_=function(){return h[g](...arguments)}:typeof o[p]=="function"&&(_=o[p].bind(r))),_&&(r[p]=_,i[p]=_)}}const hS={3042:!1,32773:new Float32Array([0,0,0,0]),32777:32774,34877:32774,32969:1,32968:0,32971:1,32970:0,3106:new Float32Array([0,0,0,0]),3107:[!0,!0,!0,!0],2884:!1,2885:1029,2929:!1,2931:1,2932:513,2928:new Float32Array([0,1]),2930:!0,3024:!0,36006:null,2886:2305,33170:4352,2849:1,32823:!1,32824:0,10752:0,32938:1,32939:!1,3089:!1,3088:new Int32Array([0,0,1024,1024]),2960:!1,2961:0,2968:4294967295,36005:4294967295,2962:519,2967:0,2963:4294967295,34816:519,36003:0,36004:4294967295,2964:7680,2965:7680,2966:7680,34817:7680,34818:7680,34819:7680,2978:[0,0,1024,1024],3333:4,3317:4,37440:!1,37441:!1,37443:37444,35723:4352,36010:null,35977:!1,3330:0,3332:0,3331:0,3314:0,32878:0,3316:0,3315:0,32877:0},ju=(n,e,t)=>e?n.enable(t):n.disable(t),fO=(n,e,t)=>n.hint(t,e),hs=(n,e,t)=>n.pixelStorei(t,e),VG=(n,e)=>{const t=yr(n)?36009:36160;return n.bindFramebuffer(t,e)},HG=(n,e)=>n.bindFramebuffer(36008,e);function Fy(n){return Array.isArray(n)||ArrayBuffer.isView(n)}const GG={3042:ju,32773:(n,e)=>n.blendColor(...e),32777:"blendEquation",34877:"blendEquation",32969:"blendFunc",32968:"blendFunc",32971:"blendFunc",32970:"blendFunc",3106:(n,e)=>n.clearColor(...e),3107:(n,e)=>n.colorMask(...e),2884:ju,2885:(n,e)=>n.cullFace(e),2929:ju,2931:(n,e)=>n.clearDepth(e),2932:(n,e)=>n.depthFunc(e),2928:(n,e)=>n.depthRange(...e),2930:(n,e)=>n.depthMask(e),3024:ju,35723:fO,36006:VG,2886:(n,e)=>n.frontFace(e),33170:fO,2849:(n,e)=>n.lineWidth(e),32823:ju,32824:"polygonOffset",10752:"polygonOffset",35977:ju,32938:"sampleCoverage",32939:"sampleCoverage",3089:ju,3088:(n,e)=>n.scissor(...e),2960:ju,2961:(n,e)=>n.clearStencil(e),2968:(n,e)=>n.stencilMaskSeparate(1028,e),36005:(n,e)=>n.stencilMaskSeparate(1029,e),2962:"stencilFuncFront",2967:"stencilFuncFront",2963:"stencilFuncFront",34816:"stencilFuncBack",36003:"stencilFuncBack",36004:"stencilFuncBack",2964:"stencilOpFront",2965:"stencilOpFront",2966:"stencilOpFront",34817:"stencilOpBack",34818:"stencilOpBack",34819:"stencilOpBack",2978:(n,e)=>n.viewport(...e),3333:hs,3317:hs,37440:hs,37441:hs,37443:hs,3330:hs,3332:hs,3331:hs,36010:HG,3314:hs,32878:hs,3316:hs,3315:hs,32877:hs,framebuffer:(n,e)=>{const t=e&&"handle"in e?e.handle:e;return n.bindFramebuffer(36160,t)},blend:(n,e)=>e?n.enable(3042):n.disable(3042),blendColor:(n,e)=>n.blendColor(...e),blendEquation:(n,e)=>{e=Fy(e)?e:[e,e],n.blendEquationSeparate(...e)},blendFunc:(n,e)=>{e=Fy(e)&&e.length===2?[...e,...e]:e,n.blendFuncSeparate(...e)},clearColor:(n,e)=>n.clearColor(...e),clearDepth:(n,e)=>n.clearDepth(e),clearStencil:(n,e)=>n.clearStencil(e),colorMask:(n,e)=>n.colorMask(...e),cull:(n,e)=>e?n.enable(2884):n.disable(2884),cullFace:(n,e)=>n.cullFace(e),depthTest:(n,e)=>e?n.enable(2929):n.disable(2929),depthFunc:(n,e)=>n.depthFunc(e),depthMask:(n,e)=>n.depthMask(e),depthRange:(n,e)=>n.depthRange(...e),dither:(n,e)=>e?n.enable(3024):n.disable(3024),derivativeHint:(n,e)=>{n.hint(35723,e)},frontFace:(n,e)=>n.frontFace(e),mipmapHint:(n,e)=>n.hint(33170,e),lineWidth:(n,e)=>n.lineWidth(e),polygonOffsetFill:(n,e)=>e?n.enable(32823):n.disable(32823),polygonOffset:(n,e)=>n.polygonOffset(...e),sampleCoverage:(n,e)=>n.sampleCoverage(...e),scissorTest:(n,e)=>e?n.enable(3089):n.disable(3089),scissor:(n,e)=>n.scissor(...e),stencilTest:(n,e)=>e?n.enable(2960):n.disable(2960),stencilMask:(n,e)=>{e=Fy(e)?e:[e,e];const[t,r]=e;n.stencilMaskSeparate(1028,t),n.stencilMaskSeparate(1029,r)},stencilFunc:(n,e)=>{e=Fy(e)&&e.length===3?[...e,...e]:e;const[t,r,i,o,a,l]=e;n.stencilFuncSeparate(1028,t,r,i),n.stencilFuncSeparate(1029,o,a,l)},stencilOp:(n,e)=>{e=Fy(e)&&e.length===3?[...e,...e]:e;const[t,r,i,o,a,l]=e;n.stencilOpSeparate(1028,t,r,i),n.stencilOpSeparate(1029,o,a,l)},viewport:(n,e)=>n.viewport(...e)};function ji(n,e,t){return e[n]!==void 0?e[n]:t[n]}const qG={blendEquation:(n,e,t)=>n.blendEquationSeparate(ji(32777,e,t),ji(34877,e,t)),blendFunc:(n,e,t)=>n.blendFuncSeparate(ji(32969,e,t),ji(32968,e,t),ji(32971,e,t),ji(32970,e,t)),polygonOffset:(n,e,t)=>n.polygonOffset(ji(32824,e,t),ji(10752,e,t)),sampleCoverage:(n,e,t)=>n.sampleCoverage(ji(32938,e,t),ji(32939,e,t)),stencilFuncFront:(n,e,t)=>n.stencilFuncSeparate(1028,ji(2962,e,t),ji(2967,e,t),ji(2963,e,t)),stencilFuncBack:(n,e,t)=>n.stencilFuncSeparate(1029,ji(34816,e,t),ji(36003,e,t),ji(36004,e,t)),stencilOpFront:(n,e,t)=>n.stencilOpSeparate(1028,ji(2964,e,t),ji(2965,e,t),ji(2966,e,t)),stencilOpBack:(n,e,t)=>n.stencilOpSeparate(1029,ji(34817,e,t),ji(34818,e,t),ji(34819,e,t))},pO={enable:(n,e)=>n({[e]:!0}),disable:(n,e)=>n({[e]:!1}),pixelStorei:(n,e,t)=>n({[e]:t}),hint:(n,e,t)=>n({[e]:t}),bindFramebuffer:(n,e,t)=>{switch(e){case 36160:return n({36006:t,36010:t});case 36009:return n({36006:t});case 36008:return n({36010:t});default:return null}},blendColor:(n,e,t,r,i)=>n({32773:new Float32Array([e,t,r,i])}),blendEquation:(n,e)=>n({32777:e,34877:e}),blendEquationSeparate:(n,e,t)=>n({32777:e,34877:t}),blendFunc:(n,e,t)=>n({32969:e,32968:t,32971:e,32970:t}),blendFuncSeparate:(n,e,t,r,i)=>n({32969:e,32968:t,32971:r,32970:i}),clearColor:(n,e,t,r,i)=>n({3106:new Float32Array([e,t,r,i])}),clearDepth:(n,e)=>n({2931:e}),clearStencil:(n,e)=>n({2961:e}),colorMask:(n,e,t,r,i)=>n({3107:[e,t,r,i]}),cullFace:(n,e)=>n({2885:e}),depthFunc:(n,e)=>n({2932:e}),depthRange:(n,e,t)=>n({2928:new Float32Array([e,t])}),depthMask:(n,e)=>n({2930:e}),frontFace:(n,e)=>n({2886:e}),lineWidth:(n,e)=>n({2849:e}),polygonOffset:(n,e,t)=>n({32824:e,10752:t}),sampleCoverage:(n,e,t)=>n({32938:e,32939:t}),scissor:(n,e,t,r,i)=>n({3088:new Int32Array([e,t,r,i])}),stencilMask:(n,e)=>n({2968:e,36005:e}),stencilMaskSeparate:(n,e,t)=>n({[e===1028?2968:36005]:t}),stencilFunc:(n,e,t,r)=>n({2962:e,2967:t,2963:r,34816:e,36003:t,36004:r}),stencilFuncSeparate:(n,e,t,r,i)=>n({[e===1028?2962:34816]:t,[e===1028?2967:36003]:r,[e===1028?2963:36004]:i}),stencilOp:(n,e,t,r)=>n({2964:e,2965:t,2966:r,34817:e,34818:t,34819:r}),stencilOpSeparate:(n,e,t,r,i)=>n({[e===1028?2964:34817]:t,[e===1028?2965:34818]:r,[e===1028?2966:34819]:i}),viewport:(n,e,t,r,i)=>n({2978:[e,t,r,i]})},Uc=(n,e)=>n.isEnabled(e),gO={3042:Uc,2884:Uc,2929:Uc,3024:Uc,32823:Uc,32926:Uc,32928:Uc,3089:Uc,2960:Uc,35977:Uc};function mO(n){for(const e in n)return!1;return!0}function $G(n,e){if(n===e)return!0;const t=Array.isArray(n)||ArrayBuffer.isView(n),r=Array.isArray(e)||ArrayBuffer.isView(e);if(t&&r&&n.length===e.length){for(let i=0;i<n.length;++i)if(n[i]!==e[i])return!1;return!0}return!1}function yO(n,e){const t=n[e].bind(n);n[e]=function(){const i=arguments.length<=0?void 0:arguments[0];return i in n.state.cache?n.state.enable?n.state.cache[i]:t(...arguments):t(...arguments)},Object.defineProperty(n[e],"name",{value:"".concat(e,"-from-cache"),configurable:!1})}function WG(n,e,t){const r=n[e].bind(n);n[e]=function(){for(var o=arguments.length,a=new Array(o),l=0;l<o;l++)a[l]=arguments[l];const{valueChanged:h,oldValue:p}=t(n.state._updateCache,...a);return h&&r(...a),p},Object.defineProperty(n[e],"name",{value:"".concat(e,"-to-cache"),configurable:!1})}function YG(n){const e=n.useProgram.bind(n);n.useProgram=function(r){n.state.program!==r&&(e(r),n.state.program=r)}}class KG{constructor(e){let{copyState:t=!1,log:r=()=>{}}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.gl=e,this.program=null,this.stateStack=[],this.enable=!0,this.cache=t?XG(e):Object.assign({},hS),this.log=r,this._updateCache=this._updateCache.bind(this),Object.seal(this)}push(){this.stateStack.push({})}pop(){va(this.stateStack.length>0);const e=this.stateStack[this.stateStack.length-1];Fl(this.gl,e),this.stateStack.pop()}_updateCache(e){let t=!1,r;const i=this.stateStack.length>0&&this.stateStack[this.stateStack.length-1];for(const o in e){va(o!==void 0);const a=e[o],l=this.cache[o];$G(a,l)||(t=!0,r=l,i&&!(o in i)&&(i[o]=l),this.cache[o]=a)}return{valueChanged:t,oldValue:r}}}function _O(n){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{enable:t=!0,copyState:r}=e;if(va(r!==void 0),!n.state){const{polyfillContext:i}=globalThis;i&&i(n),n.state=new KG(n,{copyState:r}),YG(n);for(const o in pO){const a=pO[o];WG(n,o,a)}yO(n,"getParameter"),yO(n,"isEnabled")}return n.state.enable=t,n}function ZG(n){n.state||_O(n,{copyState:!1}),n.state.push()}function vO(n){va(n.state),n.state.pop()}function Fl(n,e){if(va(Fb(n),"setParameters requires a WebGL context"),mO(e))return;const t={};for(const i in e){const o=Number(i),a=GG[i];a&&(typeof a=="string"?t[a]=!0:a(n,e[i],o))}const r=n.state&&n.state.cache;if(r)for(const i in t){const o=qG[i];o(n,e,r)}}function XG(n,e){if(e=e||hS,typeof e=="number"){const i=e,o=gO[i];return o?o(n,i):n.getParameter(i)}const t=Array.isArray(e)?e:Object.keys(e),r={};for(const i of t){const o=gO[i];r[i]=o?o(n,Number(i)):n.getParameter(Number(i))}return r}function QG(n){Fl(n,hS)}function fc(n,e,t){if(mO(e))return t(n);const{nocatch:r=!0}=e;ZG(n),Fl(n,e);let i;if(r)i=t(n),vO(n);else try{i=t(n)}finally{vO(n)}return i}function Tp(n){const{luma:e}=n;if(n.canvas&&e){const t=e.canvasSizeInfo,r="clientWidth"in t?t.clientWidth:n.canvas.clientWidth;return r?n.drawingBufferWidth/r:1}return 1}function dS(n,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;const r=Tp(n),i=n.drawingBufferWidth,o=n.drawingBufferHeight;return eq(e,r,i,o,t)}function JG(n){const e=typeof window>"u"?1:window.devicePixelRatio||1;return Number.isFinite(n)?n<=0?1:n:n?e:1}function eq(n,e,t,r,i){const o=bO(n[0],e,t);let a=wO(n[1],e,r,i),l=bO(n[0]+1,e,t);const h=l===t-1?l:l-1;l=wO(n[1]+1,e,r,i);let p;return i?(l=l===0?l:l+1,p=a,a=l):p=l===r-1?l:l-1,{x:o,y:a,width:Math.max(h-o+1,1),height:Math.max(p-a+1,1)}}function bO(n,e,t){return Math.min(Math.round(n*e),t-1)}function wO(n,e,t,r){return r?Math.max(0,t-1-Math.round(n*e)):Math.min(Math.round(n*e),t-1)}const fS=Dl(),tq=fS&&typeof document<"u",xO={webgl2:!0,webgl1:!0,throwOnError:!0,manageState:!0,canvas:null,debug:!1,width:800,height:600};function EO(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};va(fS,`createGLContext only available in the browser.
Create your own headless context or use 'createHeadlessContext' from @luma.gl/test-utils`),n=Object.assign({},xO,n);const{width:e,height:t}=n;function r(l){if(n.throwOnError)throw new Error(l);return console.error(l),null}n.onError=r;let i;const{canvas:o}=n,a=oq({canvas:o,width:e,height:t,onError:r});return i=iq(a,n),i?(i=pS(i,n),aq(i),i):null}function pS(n){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!n||n._instrumented)return n;n._version=n._version||sq(n),n.luma=n.luma||{},n.luma.canvasSizeInfo=n.luma.canvasSizeInfo||{},e=Object.assign({},xO,e);const{manageState:t,debug:r}=e;return t&&_O(n,{copyState:!1,log:function(){for(var i=arguments.length,o=new Array(i),a=0;a<i;a++)o[a]=arguments[a];return Tn.log(1,...o)()}}),fS&&r&&(globalThis.makeDebugContext?(n=globalThis.makeDebugContext(n,e),Tn.level=Math.max(Tn.level,1)):Tn.warn('WebGL debug mode not activated. import "@luma.gl/debug" to enable.')()),n._instrumented=!0,n}function nq(n){const e=n.getParameter(7936),t=n.getParameter(7937),r=n.getExtension("WEBGL_debug_renderer_info"),i=r&&n.getParameter(r.UNMASKED_VENDOR_WEBGL||7936),o=r&&n.getParameter(r.UNMASKED_RENDERER_WEBGL||7937);return{vendor:i||e,renderer:o||t,vendorMasked:e,rendererMasked:t,version:n.getParameter(7938),shadingLanguageVersion:n.getParameter(35724)}}function rq(n){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(n.canvas){const r=JG(e.useDevicePixels);cq(n,r,e);return}const t=n.getExtension("STACKGL_resize_drawingbuffer");t&&"width"in e&&"height"in e&&t.resize(e.width,e.height)}function iq(n,e){const{onError:t}=e;let r=null;const i=h=>r=h.statusMessage||r;n.addEventListener("webglcontextcreationerror",i,!1);const{webgl1:o=!0,webgl2:a=!0}=e;let l=null;return a&&(l=l||n.getContext("webgl2",e),l=l||n.getContext("experimental-webgl2",e)),o&&(l=l||n.getContext("webgl",e),l=l||n.getContext("experimental-webgl",e)),n.removeEventListener("webglcontextcreationerror",i,!1),l?(e.onContextLost&&n.addEventListener("webglcontextlost",e.onContextLost,!1),e.onContextRestored&&n.addEventListener("webglcontextrestored",e.onContextRestored,!1),l):t("Failed to create ".concat(a&&!o?"WebGL2":"WebGL"," context: ").concat(r||"Unknown error"))}function oq(n){let{canvas:e,width:t=800,height:r=600,onError:i}=n,o;return typeof e=="string"?(tq&&document.readyState==="complete"||i("createGLContext called on canvas '".concat(e,"' before page was loaded")),o=document.getElementById(e)):e?o=e:(o=document.createElement("canvas"),o.id="lumagl-canvas",o.style.width=Number.isFinite(t)?"".concat(t,"px"):"100%",o.style.height=Number.isFinite(r)?"".concat(r,"px"):"100%",document.body.insertBefore(o,document.body.firstChild)),o}function aq(n){const e=yr(n)?"WebGL2":"WebGL1",t=nq(n),r=t?"(".concat(t.vendor,",").concat(t.renderer,")"):"",i=n.debug?" debug":"";Tn.info(1,"".concat(e).concat(i," context ").concat(r))()}function sq(n){return typeof WebGL2RenderingContext<"u"&&n instanceof WebGL2RenderingContext?2:1}function cq(n,e,t){let r="width"in t?t.width:n.canvas.clientWidth,i="height"in t?t.height:n.canvas.clientHeight;(!r||!i)&&(Tn.log(1,"Canvas clientWidth/clientHeight is 0")(),e=1,r=n.canvas.width||1,i=n.canvas.height||1),n.luma=n.luma||{},n.luma.canvasSizeInfo=n.luma.canvasSizeInfo||{};const o=n.luma.canvasSizeInfo;if(o.clientWidth!==r||o.clientHeight!==i||o.devicePixelRatio!==e){let a=e;const l=Math.floor(r*a),h=Math.floor(i*a);n.canvas.width=l,n.canvas.height=h,(n.drawingBufferWidth!==l||n.drawingBufferHeight!==h)&&(Tn.warn("Device pixel ratio clamped")(),a=Math.min(n.drawingBufferWidth/r,n.drawingBufferHeight/i),n.canvas.width=Math.floor(r*a),n.canvas.height=Math.floor(i*a)),Object.assign(n.luma.canvasSizeInfo,{clientWidth:r,clientHeight:i,devicePixelRatio:e})}}const By="8.5.21",lq="set luma.log.level=1 (or higher) to trace rendering";class uq{constructor(){this.stats=new Map}get(e){return this.stats.has(e)||this.stats.set(e,new WT({id:e})),this.stats.get(e)}}const Ed=new uq;if(globalThis.luma&&globalThis.luma.VERSION!==By)throw new Error("luma.gl - multiple VERSIONs detected: ".concat(globalThis.luma.VERSION," vs ").concat(By));globalThis.luma||(Dl()&&Tn.log(1,"luma.gl ".concat(By," - ").concat(lq))(),globalThis.luma=globalThis.luma||{VERSION:By,version:By,log:Tn,stats:Ed,globals:{modules:{},nodeIO:{}}});function hq(n){return typeof window<"u"&&window.requestAnimationFrame?window.requestAnimationFrame(n):setTimeout(n,1e3/60)}function dq(n){return typeof window<"u"&&window.cancelAnimationFrame?window.cancelAnimationFrame(n):clearTimeout(n)}function Xt(n,e){if(!n)throw new Error(e||"luma.gl: assertion failed.")}function gS(n,e){if(typeof e!="string")return e;const t=Number(e);if(!isNaN(t))return t;e=e.replace(/^.*\./,"");const r=n[e];return Xt(r!==void 0,"Accessing undefined constant GL.".concat(e)),r}function Vu(n,e){e=Number(e);for(const t in n)if(n[t]===e)return"GL.".concat(t);return String(e)}const mS={};function Hu(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"id";mS[n]=mS[n]||1;const e=mS[n]++;return"".concat(n,"-").concat(e)}function TO(n){return Xt(typeof n=="number","Input must be a number"),n&&(n&n-1)===0}function Sp(n){let e=!0;for(const t in n){e=!1;break}return e}function SO(n,e,t,r){const i="See luma.gl ".concat(t," Upgrade Guide at https://luma.gl/docs/upgrade-guide"),o=Object.getPrototypeOf(n);r.forEach(a=>{o.methodName||(o[a]=()=>{throw Tn.removed("Calling removed method ".concat(e,".").concat(a,": "),i)(),new Error(a)})})}const Cp="Resource subclass must define virtual methods";let Bl=class{get[Symbol.toStringTag](){return"Resource"}constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};Bb(e);const{id:r,userData:i={}}=t;this.gl=e,this.gl2=e,this.id=r||Hu(this[Symbol.toStringTag]),this.userData=i,this._bound=!1,this._handle=t.handle,this._handle===void 0&&(this._handle=this._createHandle()),this.byteLength=0,this._addStats()}toString(){return"".concat(this[Symbol.toStringTag]||this.constructor.name,"(").concat(this.id,")")}get handle(){return this._handle}delete(){let{deleteChildren:e=!1}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const t=this._handle&&this._deleteHandle(this._handle);return this._handle&&this._removeStats(),this._handle=null,t&&e&&t.filter(Boolean).forEach(r=>r.delete()),this}bind(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.handle;if(typeof e!="function")return this._bindHandle(e),this;let t;return this._bound?t=e():(this._bindHandle(this.handle),this._bound=!0,t=e(),this._bound=!1,this._bindHandle(null)),t}unbind(){this.bind(null)}getParameter(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};e=gS(this.gl,e),Xt(e);const i=(this.constructor.PARAMETERS||{})[e];if(i){const o=yr(this.gl);if(!((!("webgl2"in i)||o)&&(!("extension"in i)||this.gl.getExtension(i.extension)))){const l=i.webgl1,h="webgl2"in i?i.webgl2:i.webgl1;return o?h:l}}return this._getParameter(e,t)}getParameters(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{parameters:t,keys:r}=e,i=this.constructor.PARAMETERS||{},o=yr(this.gl),a={},l=t||Object.keys(i);for(const h of l){const p=i[h];if(p&&(!("webgl2"in p)||o)&&(!("extension"in p)||this.gl.getExtension(p.extension))){const _=r?Vu(this.gl,h):h;a[_]=this.getParameter(h,e),r&&p.type==="GLenum"&&(a[_]=Vu(this.gl,a[_]))}}return a}setParameter(e,t){e=gS(this.gl,e),Xt(e);const i=(this.constructor.PARAMETERS||{})[e];if(i){const o=yr(this.gl);if(!((!("webgl2"in i)||o)&&(!("extension"in i)||this.gl.getExtension(i.extension))))throw new Error("Parameter not available on this platform");i.type==="GLenum"&&(t=gS(t))}return this._setParameter(e,t),this}setParameters(e){for(const t in e)this.setParameter(t,e[t]);return this}stubRemovedMethods(e,t,r){return SO(this,e,t,r)}initialize(e){}_createHandle(){throw new Error(Cp)}_deleteHandle(){throw new Error(Cp)}_bindHandle(e){throw new Error(Cp)}_getOptsFromHandle(){throw new Error(Cp)}_getParameter(e,t){throw new Error(Cp)}_setParameter(e,t){throw new Error(Cp)}_context(){return this.gl.luma=this.gl.luma||{},this.gl.luma}_addStats(){const e=this[Symbol.toStringTag],t=Ed.get("Resource Counts");t.get("Resources Created").incrementCount(),t.get("".concat(e,"s Created")).incrementCount(),t.get("".concat(e,"s Active")).incrementCount()}_removeStats(){const e=this[Symbol.toStringTag];Ed.get("Resource Counts").get("".concat(e,"s Active")).decrementCount()}_trackAllocatedMemory(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this[Symbol.toStringTag];this._trackAllocatedMemoryForContext(e,t),this._trackAllocatedMemoryForContext(e,t,this.gl.canvas&&this.gl.canvas.id),this.byteLength=e}_trackAllocatedMemoryForContext(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this[Symbol.toStringTag],r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"";const i=Ed.get("Memory Usage".concat(r));i.get("GPU Memory").addCount(e),i.get("".concat(t," Memory")).addCount(e)}_trackDeallocatedMemory(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this[Symbol.toStringTag];this._trackDeallocatedMemoryForContext(e),this._trackDeallocatedMemoryForContext(e,this.gl.canvas&&this.gl.canvas.id),this.byteLength=0}_trackDeallocatedMemoryForContext(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this[Symbol.toStringTag],t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";const r=Ed.get("Memory Usage".concat(t));r.get("GPU Memory").subtractCount(this.byteLength),r.get("".concat(e," Memory")).subtractCount(this.byteLength)}};const fq="Failed to deduce GL constant from typed array";function yS(n){switch(ArrayBuffer.isView(n)?n.constructor:n){case Float32Array:return 5126;case Uint16Array:return 5123;case Uint32Array:return 5125;case Uint8Array:return 5121;case Uint8ClampedArray:return 5121;case Int8Array:return 5120;case Int16Array:return 5122;case Int32Array:return 5124;default:throw new Error(fq)}}function Uy(n){let{clamped:e=!0}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};switch(n){case 5126:return Float32Array;case 5123:case 33635:case 32819:case 32820:return Uint16Array;case 5125:return Uint32Array;case 5121:return e?Uint8ClampedArray:Uint8Array;case 5120:return Int8Array;case 5122:return Int16Array;case 5124:return Int32Array;default:throw new Error("Failed to deduce typed array type from GL constant")}}function pq(n){let{data:e,width:t,height:r,bytesPerPixel:i=4,temp:o}=n;const a=t*i;o=o||new Uint8Array(a);for(let l=0;l<r/2;++l){const h=l*a,p=(r-l-1)*a;o.set(e.subarray(h,h+a)),e.copyWithin(h,p,p+a),e.set(o,p)}}function gq(n){let{data:e,width:t,height:r}=n;const i=Math.round(t/2),o=Math.round(r/2),a=new Uint8Array(i*o*4);for(let l=0;l<o;l++)for(let h=0;h<i;h++)for(let p=0;p<4;p++)a[(l*i+h)*4+p]=e[(l*2*t+h*2)*4+p];return{data:a,width:i,height:o}}function _S(n,e,t){const{removedProps:r={},deprecatedProps:i={},replacedProps:o={}}=t;for(const l in r)if(l in e){const p=r[l]?"".concat(n,".").concat(r[l]):"N/A";Tn.removed("".concat(n,".").concat(l),p)()}for(const l in i)if(l in e){const h=i[l];Tn.deprecated("".concat(n,".").concat(l),"".concat(n,".").concat(h))()}let a=null;for(const l in o)if(l in e){const h=o[l];Tn.deprecated("".concat(n,".").concat(l),"".concat(n,".").concat(h))(),a=a||Object.assign({},e),a[h]=e[l],delete a[l]}return a||e}const mq={offset:0,stride:0,type:5126,size:1,divisor:0,normalized:!1,integer:!1},yq={deprecatedProps:{instanced:"divisor",isInstanced:"divisor"}};class ds{static getBytesPerElement(e){return Uy(e.type||5126).BYTES_PER_ELEMENT}static getBytesPerVertex(e){return Xt(e.size),Uy(e.type||5126).BYTES_PER_ELEMENT*e.size}static resolve(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return new ds(mq,...t)}constructor(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];t.forEach(i=>this._assign(i)),Object.freeze(this)}toString(){return JSON.stringify(this)}get BYTES_PER_ELEMENT(){return ds.getBytesPerElement(this)}get BYTES_PER_VERTEX(){return ds.getBytesPerVertex(this)}_assign(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return e=_S("Accessor",e,yq),e.type!==void 0&&(this.type=e.type,(e.type===5124||e.type===5125)&&(this.integer=!0)),e.size!==void 0&&(this.size=e.size),e.offset!==void 0&&(this.offset=e.offset),e.stride!==void 0&&(this.stride=e.stride),e.normalized!==void 0&&(this.normalized=e.normalized),e.integer!==void 0&&(this.integer=e.integer),e.divisor!==void 0&&(this.divisor=e.divisor),e.buffer!==void 0&&(this.buffer=e.buffer),e.index!==void 0&&(typeof e.index=="boolean"?this.index=e.index?1:0:this.index=e.index),e.instanced!==void 0&&(this.divisor=e.instanced?1:0),e.isInstanced!==void 0&&(this.divisor=e.isInstanced?1:0),this}}const CO=10,AO={offset:"accessor.offset",stride:"accessor.stride",type:"accessor.type",size:"accessor.size",divisor:"accessor.divisor",normalized:"accessor.normalized",integer:"accessor.integer",instanced:"accessor.divisor",isInstanced:"accessor.divisor"},_q={removedProps:{},replacedProps:{bytes:"byteLength"},deprecatedProps:AO},vq={removedProps:AO};class ni extends Bl{get[Symbol.toStringTag](){return"Buffer"}constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(e,t),this.stubRemovedMethods("Buffer","v6.0",["layout","setLayout","getIndexedParameter"]),this.target=t.target||(this.gl.webgl2?36662:34962),this.initialize(t),Object.seal(this)}getElementCount(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.accessor;return Math.round(this.byteLength/ds.getBytesPerElement(e))}getVertexCount(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.accessor;return Math.round(this.byteLength/ds.getBytesPerVertex(e))}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return ArrayBuffer.isView(e)&&(e={data:e}),Number.isFinite(e)&&(e={byteLength:e}),e=_S("Buffer",e,_q),this.usage=e.usage||35044,this.debugData=null,this.setAccessor(Object.assign({},e,e.accessor)),e.data?this._setData(e.data,e.offset,e.byteLength):this._setByteLength(e.byteLength||0),this}setProps(e){return e=_S("Buffer",e,vq),"accessor"in e&&this.setAccessor(e.accessor),this}setAccessor(e){return e=Object.assign({},e),delete e.buffer,this.accessor=new ds(e),this}reallocate(e){return e>this.byteLength?(this._setByteLength(e),!0):(this.bytesUsed=e,!1)}setData(e){return this.initialize(e)}subData(e){ArrayBuffer.isView(e)&&(e={data:e});const{data:t,offset:r=0,srcOffset:i=0}=e,o=e.byteLength||e.length;Xt(t);const a=this.gl.webgl2?36663:this.target;return this.gl.bindBuffer(a,this.handle),i!==0||o!==void 0?(aa(this.gl),this.gl.bufferSubData(this.target,r,t,i,o)):this.gl.bufferSubData(a,r,t),this.gl.bindBuffer(a,null),this.debugData=null,this._inferType(t),this}copyData(e){let{sourceBuffer:t,readOffset:r=0,writeOffset:i=0,size:o}=e;const{gl:a}=this;return aa(a),a.bindBuffer(36662,t.handle),a.bindBuffer(36663,this.handle),a.copyBufferSubData(36662,36663,r,i,o),a.bindBuffer(36662,null),a.bindBuffer(36663,null),this.debugData=null,this}getData(){let{dstData:e=null,srcByteOffset:t=0,dstOffset:r=0,length:i=0}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};aa(this.gl);const o=Uy(this.accessor.type||5126,{clamped:!1}),a=this._getAvailableElementCount(t),l=r;let h,p;e?(p=e.length,h=p-l):(h=Math.min(a,i||a),p=l+h);const g=Math.min(a,h);return i=i||g,Xt(i<=g),e=e||new o(p),this.gl.bindBuffer(36662,this.handle),this.gl.getBufferSubData(36662,t,e,r,i),this.gl.bindBuffer(36662,null),e}bind(){let{target:e=this.target,index:t=this.accessor&&this.accessor.index,offset:r=0,size:i}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return e===35345||e===35982?i!==void 0?this.gl.bindBufferRange(e,t,this.handle,r,i):(Xt(r===0),this.gl.bindBufferBase(e,t,this.handle)):this.gl.bindBuffer(e,this.handle),this}unbind(){let{target:e=this.target,index:t=this.accessor&&this.accessor.index}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return e===35345||e===35982?this.gl.bindBufferBase(e,t,null):this.gl.bindBuffer(e,null),this}getDebugData(){return this.debugData?{data:this.debugData,changed:!1}:(this.debugData=this.getData({length:Math.min(CO,this.byteLength)}),{data:this.debugData,changed:!0})}invalidateDebugData(){this.debugData=null}_setData(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:e.byteLength+t;Xt(ArrayBuffer.isView(e)),this._trackDeallocatedMemory();const i=this._getTarget();this.gl.bindBuffer(i,this.handle),this.gl.bufferData(i,r,this.usage),this.gl.bufferSubData(i,t,e),this.gl.bindBuffer(i,null),this.debugData=e.slice(0,CO),this.bytesUsed=r,this._trackAllocatedMemory(r);const o=yS(e);return Xt(o),this.setAccessor(new ds(this.accessor,{type:o})),this}_setByteLength(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.usage;Xt(e>=0),this._trackDeallocatedMemory();let r=e;e===0&&(r=new Float32Array(0));const i=this._getTarget();return this.gl.bindBuffer(i,this.handle),this.gl.bufferData(i,r,t),this.gl.bindBuffer(i,null),this.usage=t,this.debugData=null,this.bytesUsed=e,this._trackAllocatedMemory(e),this}_getTarget(){return this.gl.webgl2?36663:this.target}_getAvailableElementCount(e){const t=Uy(this.accessor.type||5126,{clamped:!1}),r=e/t.BYTES_PER_ELEMENT;return this.getElementCount()-r}_inferType(e){this.accessor.type||this.setAccessor(new ds(this.accessor,{type:yS(e)}))}_createHandle(){return this.gl.createBuffer()}_deleteHandle(){this.gl.deleteBuffer(this.handle),this._trackDeallocatedMemory()}_getParameter(e){this.gl.bindBuffer(this.target,this.handle);const t=this.gl.getBufferParameter(this.target,e);return this.gl.bindBuffer(this.target,null),t}get type(){return Tn.deprecated("Buffer.type","Buffer.accessor.type")(),this.accessor.type}get bytes(){return Tn.deprecated("Buffer.bytes","Buffer.byteLength")(),this.byteLength}setByteLength(e){return Tn.deprecated("setByteLength","reallocate")(),this.reallocate(e)}updateAccessor(e){return Tn.deprecated("updateAccessor(...)","setAccessor(new Accessor(buffer.accessor, ...)")(),this.accessor=new ds(this.accessor,e),this}}const vS={6407:{dataFormat:6407,types:[5121,33635]},6408:{dataFormat:6408,types:[5121,32819,32820]},6406:{dataFormat:6406,types:[5121]},6409:{dataFormat:6409,types:[5121]},6410:{dataFormat:6410,types:[5121]},33326:{dataFormat:6403,types:[5126],gl2:!0},33328:{dataFormat:33319,types:[5126],gl2:!0},34837:{dataFormat:6407,types:[5126],gl2:!0},34836:{dataFormat:6408,types:[5126],gl2:!0}},IO={6403:1,36244:1,33319:2,33320:2,6407:3,36248:3,6408:4,36249:4,6402:1,34041:1,6406:1,6409:1,6410:2},PO={5126:4,5125:4,5124:4,5123:2,5122:2,5131:2,5120:1,5121:1};function bq(n,e){const t=vS[e];if(!t)return!1;if(t.gl1===void 0&&t.gl2===void 0)return!0;const r=yr(n)&&t.gl2||t.gl1;return typeof r=="string"?n.getExtension(r):r}function wq(n,e){const t=vS[e];switch(t&&t.types[0]){case 5126:return n.getExtension("OES_texture_float_linear");case 5131:return n.getExtension("OES_texture_half_float_linear");default:return!0}}const xq=[9729,9728],MO=globalThis.WebGLBuffer||function(){};class Td extends Bl{get[Symbol.toStringTag](){return"Texture"}static isSupported(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{format:r,linearFiltering:i}=t;let o=!0;return r&&(o=o&&bq(e,r),o=o&&(!i||wq(e,r))),o}constructor(e,t){const{id:r=Hu("texture"),handle:i,target:o}=t;super(e,{id:r,handle:i}),this.target=o,this.textureUnit=void 0,this.loaded=!1,this.width=void 0,this.height=void 0,this.depth=void 0,this.format=void 0,this.type=void 0,this.dataFormat=void 0,this.border=void 0,this.textureUnit=void 0,this.mipmaps=void 0}toString(){return"Texture(".concat(this.id,",").concat(this.width,"x").concat(this.height,")")}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=e.data;if(t instanceof Promise)return t.then(ee=>this.initialize(Object.assign({},e,{pixels:ee,data:ee}))),this;const r=typeof HTMLVideoElement<"u"&&t instanceof HTMLVideoElement;if(r&&t.readyState<HTMLVideoElement.HAVE_METADATA)return this._video=null,t.addEventListener("loadeddata",()=>this.initialize(e)),this;const{pixels:i=null,format:o=6408,border:a=0,recreate:l=!1,parameters:h={},pixelStore:p={},textureUnit:g=void 0}=e;t||(t=i);let{width:_,height:x,dataFormat:C,type:M,compressed:L=!1,mipmaps:F=!0}=e;const{depth:z=0}=e;return{width:_,height:x,compressed:L,dataFormat:C,type:M}=this._deduceParameters({format:o,type:M,dataFormat:C,compressed:L,data:t,width:_,height:x}),this.width=_,this.height=x,this.depth=z,this.format=o,this.type=M,this.dataFormat=C,this.border=a,this.textureUnit=g,Number.isFinite(this.textureUnit)&&(this.gl.activeTexture(33984+this.textureUnit),this.gl.bindTexture(this.target,this.handle)),F&&this._isNPOT()&&(Tn.warn("texture: ".concat(this," is Non-Power-Of-Two, disabling mipmaping"))(),F=!1,this._updateForNPOT(h)),this.mipmaps=F,this.setImageData({data:t,width:_,height:x,depth:z,format:o,type:M,dataFormat:C,border:a,mipmaps:F,parameters:p,compressed:L}),F&&this.generateMipmap(),this.setParameters(h),l&&(this.data=t),r&&(this._video={video:t,parameters:h,lastTime:t.readyState>=HTMLVideoElement.HAVE_CURRENT_DATA?t.currentTime:-1}),this}update(){if(this._video){const{video:e,parameters:t,lastTime:r}=this._video;if(r===e.currentTime||e.readyState<HTMLVideoElement.HAVE_CURRENT_DATA)return;this.setSubImageData({data:e,parameters:t}),this.mipmaps&&this.generateMipmap(),this._video.lastTime=e.currentTime}}resize(e){let{height:t,width:r,mipmaps:i=!1}=e;return r!==this.width||t!==this.height?this.initialize({width:r,height:t,format:this.format,type:this.type,dataFormat:this.dataFormat,border:this.border,mipmaps:i}):this}generateMipmap(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this._isNPOT()?(Tn.warn("texture: ".concat(this," is Non-Power-Of-Two, disabling mipmaping"))(),this):(this.mipmaps=!0,this.gl.bindTexture(this.target,this.handle),fc(this.gl,e,()=>{this.gl.generateMipmap(this.target)}),this.gl.bindTexture(this.target,null),this)}setImageData(e){this._trackDeallocatedMemory("Texture");const{target:t=this.target,pixels:r=null,level:i=0,format:o=this.format,border:a=this.border,offset:l=0,parameters:h={}}=e;let{data:p=null,type:g=this.type,width:_=this.width,height:x=this.height,dataFormat:C=this.dataFormat,compressed:M=!1}=e;p||(p=r),{type:g,dataFormat:C,compressed:M,width:_,height:x}=this._deduceParameters({format:o,type:g,dataFormat:C,compressed:M,data:p,width:_,height:x});const{gl:L}=this;L.bindTexture(this.target,this.handle);let F=null;({data:p,dataType:F}=this._getDataType({data:p,compressed:M}));let z,ee=0;if(fc(this.gl,h,()=>{switch(F){case"null":L.texImage2D(t,i,o,_,x,a,C,g,p);break;case"typed-array":L.texImage2D(t,i,o,_,x,a,C,g,p,l);break;case"buffer":z=aa(L),z.bindBuffer(35052,p.handle||p),z.texImage2D(t,i,o,_,x,a,C,g,l),z.bindBuffer(35052,null);break;case"browser-object":yr(L)?L.texImage2D(t,i,o,_,x,a,C,g,p):L.texImage2D(t,i,o,C,g,p);break;case"compressed":for(const[ce,se]of p.entries())L.compressedTexImage2D(t,ce,se.format,se.width,se.height,a,se.data),ee+=se.levelSize;break;default:Xt(!1,"Unknown image data type")}}),F==="compressed")this._trackAllocatedMemory(ee,"Texture");else if(p&&p.byteLength)this._trackAllocatedMemory(p.byteLength,"Texture");else{const ce=IO[this.dataFormat]||4,se=PO[this.type]||1;this._trackAllocatedMemory(this.width*this.height*ce*se,"Texture")}return this.loaded=!0,this}setSubImageData(e){let{target:t=this.target,pixels:r=null,data:i=null,x:o=0,y:a=0,width:l=this.width,height:h=this.height,level:p=0,format:g=this.format,type:_=this.type,dataFormat:x=this.dataFormat,compressed:C=!1,offset:M=0,border:L=this.border,parameters:F={}}=e;if({type:_,dataFormat:x,compressed:C,width:l,height:h}=this._deduceParameters({format:g,type:_,dataFormat:x,compressed:C,data:i,width:l,height:h}),Xt(this.depth===0,"texSubImage not supported for 3D textures"),i||(i=r),i&&i.data){const z=i;i=z.data,l=z.shape[0],h=z.shape[1]}i instanceof ni&&(i=i.handle),this.gl.bindTexture(this.target,this.handle),fc(this.gl,F,()=>{if(C)this.gl.compressedTexSubImage2D(t,p,o,a,l,h,g,i);else if(i===null)this.gl.texSubImage2D(t,p,o,a,l,h,x,_,null);else if(ArrayBuffer.isView(i))this.gl.texSubImage2D(t,p,o,a,l,h,x,_,i,M);else if(i instanceof MO){const z=aa(this.gl);z.bindBuffer(35052,i),z.texSubImage2D(t,p,o,a,l,h,x,_,M),z.bindBuffer(35052,null)}else yr(this.gl)?aa(this.gl).texSubImage2D(t,p,o,a,l,h,x,_,i):this.gl.texSubImage2D(t,p,o,a,x,_,i)}),this.gl.bindTexture(this.target,null)}copyFramebuffer(){return Tn.error("Texture.copyFramebuffer({...}) is no logner supported, use copyToTexture(source, target, opts})")(),null}getActiveUnit(){return this.gl.getParameter(34016)-33984}bind(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.textureUnit;const{gl:t}=this;return e!==void 0&&(this.textureUnit=e,t.activeTexture(33984+e)),t.bindTexture(this.target,this.handle),e}unbind(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.textureUnit;const{gl:t}=this;return e!==void 0&&(this.textureUnit=e,t.activeTexture(33984+e)),t.bindTexture(this.target,null),e}_getDataType(e){let{data:t,compressed:r=!1}=e;return r?{data:t,dataType:"compressed"}:t===null?{data:t,dataType:"null"}:ArrayBuffer.isView(t)?{data:t,dataType:"typed-array"}:t instanceof ni?{data:t.handle,dataType:"buffer"}:t instanceof MO?{data:t,dataType:"buffer"}:{data:t,dataType:"browser-object"}}_deduceParameters(e){const{format:t,data:r}=e;let{width:i,height:o,dataFormat:a,type:l,compressed:h}=e;const p=vS[t];return a=a||p&&p.dataFormat,l=l||p&&p.types[0],h=h||p&&p.compressed,{width:i,height:o}=this._deduceImageSize(r,i,o),{dataFormat:a,type:l,compressed:h,width:i,height:o,format:t,data:r}}_deduceImageSize(e,t,r){let i;return typeof ImageData<"u"&&e instanceof ImageData?i={width:e.width,height:e.height}:typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement?i={width:e.naturalWidth,height:e.naturalHeight}:typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement?i={width:e.width,height:e.height}:typeof ImageBitmap<"u"&&e instanceof ImageBitmap?i={width:e.width,height:e.height}:typeof HTMLVideoElement<"u"&&e instanceof HTMLVideoElement?i={width:e.videoWidth,height:e.videoHeight}:e?i={width:t,height:r}:i={width:t>=0?t:1,height:r>=0?r:1},Xt(i,"Could not deduced texture size"),Xt(t===void 0||i.width===t,"Deduced texture width does not match supplied width"),Xt(r===void 0||i.height===r,"Deduced texture height does not match supplied height"),i}_createHandle(){return this.gl.createTexture()}_deleteHandle(){this.gl.deleteTexture(this.handle),this._trackDeallocatedMemory("Texture")}_getParameter(e){switch(e){case 4096:return this.width;case 4097:return this.height;default:this.gl.bindTexture(this.target,this.handle);const t=this.gl.getTexParameter(this.target,e);return this.gl.bindTexture(this.target,null),t}}_setParameter(e,t){switch(this.gl.bindTexture(this.target,this.handle),t=this._getNPOTParam(e,t),e){case 33082:case 33083:this.gl.texParameterf(this.handle,e,t);break;case 4096:case 4097:Xt(!1);break;default:this.gl.texParameteri(this.target,e,t);break}return this.gl.bindTexture(this.target,null),this}_isNPOT(){return yr(this.gl)||!this.width||!this.height?!1:!TO(this.width)||!TO(this.height)}_updateForNPOT(e){e[this.gl.TEXTURE_MIN_FILTER]===void 0&&(e[this.gl.TEXTURE_MIN_FILTER]=this.gl.LINEAR),e[this.gl.TEXTURE_WRAP_S]===void 0&&(e[this.gl.TEXTURE_WRAP_S]=this.gl.CLAMP_TO_EDGE),e[this.gl.TEXTURE_WRAP_T]===void 0&&(e[this.gl.TEXTURE_WRAP_T]=this.gl.CLAMP_TO_EDGE)}_getNPOTParam(e,t){if(this._isNPOT())switch(e){case 10241:xq.indexOf(t)===-1&&(t=9729);break;case 10242:case 10243:t!==33071&&(t=33071);break}return t}}let Eq="";function Tq(n,e){return Xt(typeof n=="string"),n=Eq+n,new Promise((t,r)=>{try{const i=new Image;i.onload=()=>t(i),i.onerror=()=>r(new Error("Could not load image ".concat(n,"."))),i.crossOrigin=e&&e.crossOrigin||"anonymous",i.src=n}catch(i){r(i)}})}class fs extends Td{get[Symbol.toStringTag](){return"Texture2D"}static isSupported(e,t){return Td.isSupported(e,t)}constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};Bb(e),(t instanceof Promise||typeof t=="string")&&(t={data:t}),typeof t.data=="string"&&(t=Object.assign({},t,{data:Tq(t.data)})),super(e,Object.assign({},t,{target:3553})),this.initialize(t),Object.seal(this)}}const bS=[34069,34070,34071,34072,34073,34074];class RO extends Td{get[Symbol.toStringTag](){return"TextureCube"}constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};Bb(e),super(e,Object.assign({},t,{target:34067})),this.initialize(t),Object.seal(this)}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{mipmaps:t=!0,parameters:r={}}=e;return this.opts=e,this.setCubeMapImageData(e).then(()=>{this.loaded=!0,t&&this.generateMipmap(e),this.setParameters(r)}),this}subImage(e){let{face:t,data:r,x:i=0,y:o=0,mipmapLevel:a=0}=e;return this._subImage({target:t,data:r,x:i,y:o,mipmapLevel:a})}async setCubeMapImageData(e){let{width:t,height:r,pixels:i,data:o,border:a=0,format:l=6408,type:h=5121}=e;const{gl:p}=this,g=i||o,_=await Promise.all(bS.map(x=>{const C=g[x];return Promise.all(Array.isArray(C)?C:[C])}));this.bind(),bS.forEach((x,C)=>{_[C].length>1&&this.opts.mipmaps!==!1&&Tn.warn("".concat(this.id," has mipmap and multiple LODs."))(),_[C].forEach((M,L)=>{t&&r?p.texImage2D(x,L,l,t,r,a,l,h,M):p.texImage2D(x,L,l,l,h,M)})}),this.unbind()}setImageDataForFace(e){const{face:t,width:r,height:i,pixels:o,data:a,border:l=0,format:h=6408,type:p=5121}=e,{gl:g}=this,_=o||a;return this.bind(),_ instanceof Promise?_.then(x=>this.setImageDataForFace(Object.assign({},e,{face:t,data:x,pixels:x}))):this.width||this.height?g.texImage2D(t,0,h,r,i,l,h,p,_):g.texImage2D(t,0,h,h,p,_),this}}RO.FACES=bS;class Sq extends Td{get[Symbol.toStringTag](){return"Texture3D"}static isSupported(e){return yr(e)}constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};aa(e),t=Object.assign({depth:1},t,{target:32879,unpackFlipY:!1}),super(e,t),this.initialize(t),Object.seal(this)}setImageData(e){let{level:t=0,dataFormat:r=6408,width:i,height:o,depth:a=1,border:l=0,format:h,type:p=5121,offset:g=0,data:_,parameters:x={}}=e;if(this._trackDeallocatedMemory("Texture"),this.gl.bindTexture(this.target,this.handle),fc(this.gl,x,()=>{ArrayBuffer.isView(_)&&this.gl.texImage3D(this.target,t,r,i,o,a,l,h,p,_),_ instanceof ni&&(this.gl.bindBuffer(35052,_.handle),this.gl.texImage3D(this.target,t,r,i,o,a,l,h,p,g))}),_&&_.byteLength)this._trackAllocatedMemory(_.byteLength,"Texture");else{const C=IO[this.dataFormat]||4,M=PO[this.type]||1;this._trackAllocatedMemory(this.width*this.height*this.depth*C*M,"Texture")}return this.loaded=!0,this}}const Sd="EXT_color_buffer_float",kO={33189:{bpp:2},33190:{gl2:!0,bpp:3},36012:{gl2:!0,bpp:4},36168:{bpp:1},34041:{bpp:4},35056:{gl2:!0,bpp:4},36013:{gl2:!0,bpp:5},32854:{bpp:2},36194:{bpp:2},32855:{bpp:2},33321:{gl2:!0,bpp:1},33330:{gl2:!0,bpp:1},33329:{gl2:!0,bpp:1},33332:{gl2:!0,bpp:2},33331:{gl2:!0,bpp:2},33334:{gl2:!0,bpp:4},33333:{gl2:!0,bpp:4},33323:{gl2:!0,bpp:2},33336:{gl2:!0,bpp:2},33335:{gl2:!0,bpp:2},33338:{gl2:!0,bpp:4},33337:{gl2:!0,bpp:4},33340:{gl2:!0,bpp:8},33339:{gl2:!0,bpp:8},32849:{gl2:!0,bpp:3},32856:{gl2:!0,bpp:4},32857:{gl2:!0,bpp:4},36220:{gl2:!0,bpp:4},36238:{gl2:!0,bpp:4},36975:{gl2:!0,bpp:4},36214:{gl2:!0,bpp:8},36232:{gl2:!0,bpp:8},36226:{gl2:!0,bpp:16},36208:{gl2:!0,bpp:16},33325:{gl2:Sd,bpp:2},33327:{gl2:Sd,bpp:4},34842:{gl2:Sd,bpp:8},33326:{gl2:Sd,bpp:4},33328:{gl2:Sd,bpp:8},34836:{gl2:Sd,bpp:16},35898:{gl2:Sd,bpp:4}};function Cq(n,e,t){const r=t[e];if(!r)return!1;const i=yr(n)&&r.gl2||r.gl1;return typeof i=="string"?n.getExtension(i):i}class Ap extends Bl{get[Symbol.toStringTag](){return"Renderbuffer"}static isSupported(e){let{format:t}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{format:null};return!t||Cq(e,t,kO)}static getSamplesForFormat(e,t){let{format:r}=t;return e.getInternalformatParameter(36161,r,32937)}constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(e,t),this.initialize(t),Object.seal(this)}initialize(e){let{format:t,width:r=1,height:i=1,samples:o=0}=e;return Xt(t,"Needs format"),this._trackDeallocatedMemory(),this.gl.bindRenderbuffer(36161,this.handle),o!==0&&yr(this.gl)?this.gl.renderbufferStorageMultisample(36161,o,t,r,i):this.gl.renderbufferStorage(36161,t,r,i),this.format=t,this.width=r,this.height=i,this.samples=o,this._trackAllocatedMemory(this.width*this.height*(this.samples||1)*kO[this.format].bpp),this}resize(e){let{width:t,height:r}=e;return t!==this.width||r!==this.height?this.initialize({width:t,height:r,format:this.format,samples:this.samples}):this}_createHandle(){return this.gl.createRenderbuffer()}_deleteHandle(){this.gl.deleteRenderbuffer(this.handle),this._trackDeallocatedMemory()}_bindHandle(e){this.gl.bindRenderbuffer(36161,e)}_syncHandle(e){this.format=this.getParameter(36164),this.width=this.getParameter(36162),this.height=this.getParameter(36163),this.samples=this.getParameter(36011)}_getParameter(e){return this.gl.bindRenderbuffer(36161,this.handle),this.gl.getRenderbufferParameter(36161,e)}}const Aq=256,Iq=1024,Pq=16384,OO=6144,LO=6145,NO=6146,DO=34041,FO="clear: bad arguments";function wS(n){let{framebuffer:e=null,color:t=null,depth:r=null,stencil:i=null}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const o={};e&&(o.framebuffer=e);let a=0;t&&(a|=Pq,t!==!0&&(o.clearColor=t)),r&&(a|=Aq,r!==!0&&(o.clearDepth=r)),i&&(a|=Iq,r!==!0&&(o.clearStencil=r)),Xt(a!==0,FO),fc(n,o,()=>{n.clear(a)})}function Mq(n){let{framebuffer:e=null,buffer:t=OO,drawBuffer:r=0,value:i=[0,0,0,0]}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};aa(n),fc(n,{framebuffer:e},()=>{switch(t){case OO:switch(i.constructor){case Int32Array:n.clearBufferiv(t,r,i);break;case Uint32Array:n.clearBufferuiv(t,r,i);break;case Float32Array:default:n.clearBufferfv(t,r,i)}break;case LO:n.clearBufferfv(LO,0,[i]);break;case NO:n.clearBufferiv(NO,0,[i]);break;case DO:const[o,a]=i;n.clearBufferfi(DO,0,o,a);break;default:Xt(!1,FO)}})}function Rq(n){switch(n){case 6406:case 33326:case 6403:return 1;case 33328:case 33319:return 2;case 6407:case 34837:return 3;case 6408:case 34836:return 4;default:return Xt(!1),0}}function Ub(n){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{sourceX:t=0,sourceY:r=0,sourceFormat:i=6408}=e;let{sourceAttachment:o=36064,target:a=null,sourceWidth:l,sourceHeight:h,sourceType:p}=e;const{framebuffer:g,deleteFramebuffer:_}=UO(n);Xt(g);const{gl:x,handle:C,attachments:M}=g;l=l||g.width,h=h||g.height,o===36064&&C===null&&(o=1028),Xt(M[o]),p=p||M[o].type,a=Oq(a,p,i,l,h),p=p||yS(a);const L=x.bindFramebuffer(36160,C);return x.readPixels(t,r,l,h,i,p,a),x.bindFramebuffer(36160,L||null),_&&g.delete(),a}function BO(n){let{sourceAttachment:e=36064,targetMaxHeight:t=Number.MAX_SAFE_INTEGER}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},r=Ub(n,{sourceAttachment:e}),{width:i,height:o}=n;for(;o>t;)({data:r,width:i,height:o}=gq({data:r,width:i,height:o}));pq({data:r,width:i,height:o});const a=document.createElement("canvas");a.width=i,a.height=o;const l=a.getContext("2d"),h=l.createImageData(i,o);return h.data.set(r),l.putImageData(h,0,0),a.toDataURL()}function kq(n,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const{sourceX:r=0,sourceY:i=0,targetMipmaplevel:o=0,targetInternalFormat:a=6408}=t;let{targetX:l,targetY:h,targetZ:p,width:g,height:_}=t;const{framebuffer:x,deleteFramebuffer:C}=UO(n);Xt(x);const{gl:M,handle:L}=x,F=typeof l<"u"||typeof h<"u"||typeof p<"u";l=l||0,h=h||0,p=p||0;const z=M.bindFramebuffer(36160,L);Xt(e);let ee=null;if(e instanceof Td&&(ee=e,g=Number.isFinite(g)?g:ee.width,_=Number.isFinite(_)?_:ee.height,ee.bind(0),e=ee.target),!F)M.copyTexImage2D(e,o,a,r,i,g,_,0);else switch(e){case 3553:case 34067:M.copyTexSubImage2D(e,o,l,h,r,i,g,_);break;case 35866:case 32879:aa(M).copyTexSubImage3D(e,o,l,h,p,r,i,g,_);break}return ee&&ee.unbind(),M.bindFramebuffer(36160,z||null),C&&x.delete(),ee}function UO(n){return n instanceof _o?{framebuffer:n,deleteFramebuffer:!1}:{framebuffer:Hq(n),deleteFramebuffer:!0}}function Oq(n,e,t,r,i){if(n)return n;e=e||5121;const o=Uy(e,{clamped:!1}),a=Rq(t);return new o(r*i*a)}const Ri={WEBGL2:"WEBGL2",VERTEX_ARRAY_OBJECT:"VERTEX_ARRAY_OBJECT",TIMER_QUERY:"TIMER_QUERY",INSTANCED_RENDERING:"INSTANCED_RENDERING",MULTIPLE_RENDER_TARGETS:"MULTIPLE_RENDER_TARGETS",ELEMENT_INDEX_UINT32:"ELEMENT_INDEX_UINT32",BLEND_EQUATION_MINMAX:"BLEND_EQUATION_MINMAX",FLOAT_BLEND:"FLOAT_BLEND",COLOR_ENCODING_SRGB:"COLOR_ENCODING_SRGB",TEXTURE_DEPTH:"TEXTURE_DEPTH",TEXTURE_FLOAT:"TEXTURE_FLOAT",TEXTURE_HALF_FLOAT:"TEXTURE_HALF_FLOAT",TEXTURE_FILTER_LINEAR_FLOAT:"TEXTURE_FILTER_LINEAR_FLOAT",TEXTURE_FILTER_LINEAR_HALF_FLOAT:"TEXTURE_FILTER_LINEAR_HALF_FLOAT",TEXTURE_FILTER_ANISOTROPIC:"TEXTURE_FILTER_ANISOTROPIC",COLOR_ATTACHMENT_RGBA32F:"COLOR_ATTACHMENT_RGBA32F",COLOR_ATTACHMENT_FLOAT:"COLOR_ATTACHMENT_FLOAT",COLOR_ATTACHMENT_HALF_FLOAT:"COLOR_ATTACHMENT_HALF_FLOAT",GLSL_FRAG_DATA:"GLSL_FRAG_DATA",GLSL_FRAG_DEPTH:"GLSL_FRAG_DEPTH",GLSL_DERIVATIVES:"GLSL_DERIVATIVES",GLSL_TEXTURE_LOD:"GLSL_TEXTURE_LOD"};function Lq(n){const e=new fs(n,{format:6408,type:5126,dataFormat:6408}),t=new _o(n,{id:"test-framebuffer",check:!1,attachments:{36064:e}}),r=t.getStatus();return e.delete(),t.delete(),r===36053}const zO={[Ri.WEBGL2]:[!1,!0],[Ri.VERTEX_ARRAY_OBJECT]:["OES_vertex_array_object",!0],[Ri.TIMER_QUERY]:["EXT_disjoint_timer_query","EXT_disjoint_timer_query_webgl2"],[Ri.INSTANCED_RENDERING]:["ANGLE_instanced_arrays",!0],[Ri.MULTIPLE_RENDER_TARGETS]:["WEBGL_draw_buffers",!0],[Ri.ELEMENT_INDEX_UINT32]:["OES_element_index_uint",!0],[Ri.BLEND_EQUATION_MINMAX]:["EXT_blend_minmax",!0],[Ri.FLOAT_BLEND]:["EXT_float_blend"],[Ri.COLOR_ENCODING_SRGB]:["EXT_sRGB",!0],[Ri.TEXTURE_DEPTH]:["WEBGL_depth_texture",!0],[Ri.TEXTURE_FLOAT]:["OES_texture_float",!0],[Ri.TEXTURE_HALF_FLOAT]:["OES_texture_half_float",!0],[Ri.TEXTURE_FILTER_LINEAR_FLOAT]:["OES_texture_float_linear"],[Ri.TEXTURE_FILTER_LINEAR_HALF_FLOAT]:["OES_texture_half_float_linear"],[Ri.TEXTURE_FILTER_ANISOTROPIC]:["EXT_texture_filter_anisotropic"],[Ri.COLOR_ATTACHMENT_RGBA32F]:[Lq,"EXT_color_buffer_float"],[Ri.COLOR_ATTACHMENT_FLOAT]:[!1,"EXT_color_buffer_float"],[Ri.COLOR_ATTACHMENT_HALF_FLOAT]:["EXT_color_buffer_half_float"],[Ri.GLSL_FRAG_DATA]:["WEBGL_draw_buffers",!0],[Ri.GLSL_FRAG_DEPTH]:["EXT_frag_depth",!0],[Ri.GLSL_DERIVATIVES]:["OES_standard_derivatives",!0],[Ri.GLSL_TEXTURE_LOD]:["EXT_shader_texture_lod",!0]},Nq=2;function Dq(n,e){return jO(n,e)}function jO(n,e){return e=Array.isArray(e)?e:[e],e.every(t=>VO(n,t))}function Fq(n){n.luma=n.luma||{},n.luma.caps=n.luma.caps||{};for(const e in zO)n.luma.caps[e]===void 0&&(n.luma.caps[e]=VO(n,e));return n.luma.caps}function VO(n,e){return n.luma=n.luma||{},n.luma.caps=n.luma.caps||{},n.luma.caps[e]===void 0&&(n.luma.caps[e]=Bq(n,e)),n.luma.caps[e]||Tn.log(Nq,"Feature: ".concat(e," not supported"))(),n.luma.caps[e]}function Bq(n,e){const t=zO[e];Xt(t,e);let r;const i=yr(n)&&t[1]||t[0];if(typeof i=="function")r=i(n);else if(Array.isArray(i)){r=!0;for(const o of i)r=r&&!!n.getExtension(o)}else typeof i=="string"?r=!!n.getExtension(i):typeof i=="boolean"?r=i:Xt(!1);return r}const HO="Multiple render targets not supported";class _o extends Bl{get[Symbol.toStringTag](){return"Framebuffer"}static isSupported(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{colorBufferFloat:r,colorBufferHalfFloat:i}=t;let o=!0;return r&&(o=!!(e.getExtension("EXT_color_buffer_float")||e.getExtension("WEBGL_color_buffer_float")||e.getExtension("OES_texture_float"))),i&&(o=o&&!!(e.getExtension("EXT_color_buffer_float")||e.getExtension("EXT_color_buffer_half_float"))),o}static getDefaultFramebuffer(e){return e.luma=e.luma||{},e.luma.defaultFramebuffer=e.luma.defaultFramebuffer||new _o(e,{id:"default-framebuffer",handle:null,attachments:{}}),e.luma.defaultFramebuffer}get MAX_COLOR_ATTACHMENTS(){const e=aa(this.gl);return e.getParameter(e.MAX_COLOR_ATTACHMENTS)}get MAX_DRAW_BUFFERS(){const e=aa(this.gl);return e.getParameter(e.MAX_DRAW_BUFFERS)}constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(e,t),this.width=null,this.height=null,this.attachments={},this.readBuffer=36064,this.drawBuffers=[36064],this.ownResources=[],this.initialize(t),Object.seal(this)}get color(){return this.attachments[36064]||null}get texture(){return this.attachments[36064]||null}get depth(){return this.attachments[36096]||this.attachments[33306]||null}get stencil(){return this.attachments[36128]||this.attachments[33306]||null}initialize(e){let{width:t=1,height:r=1,attachments:i=null,color:o=!0,depth:a=!0,stencil:l=!1,check:h=!0,readBuffer:p=void 0,drawBuffers:g=void 0}=e;if(Xt(t>=0&&r>=0,"Width and height need to be integers"),this.width=t,this.height=r,i)for(const _ in i){const x=i[_];(Array.isArray(x)?x[0]:x).resize({width:t,height:r})}else i=this._createDefaultAttachments(o,a,l,t,r);this.update({clearAttachments:!0,attachments:i,readBuffer:p,drawBuffers:g}),i&&h&&this.checkStatus()}delete(){for(const e of this.ownResources)e.delete();return super.delete(),this}update(e){let{attachments:t={},readBuffer:r,drawBuffers:i,clearAttachments:o=!1,resizeAttachments:a=!0}=e;this.attach(t,{clearAttachments:o,resizeAttachments:a});const{gl:l}=this,h=l.bindFramebuffer(36160,this.handle);return r&&this._setReadBuffer(r),i&&this._setDrawBuffers(i),l.bindFramebuffer(36160,h||null),this}resize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},{width:t,height:r}=e;if(this.handle===null)return Xt(t===void 0&&r===void 0),this.width=this.gl.drawingBufferWidth,this.height=this.gl.drawingBufferHeight,this;t===void 0&&(t=this.gl.drawingBufferWidth),r===void 0&&(r=this.gl.drawingBufferHeight),t!==this.width&&r!==this.height&&Tn.log(2,"Resizing framebuffer ".concat(this.id," to ").concat(t,"x").concat(r))();for(const i in this.attachments)this.attachments[i].resize({width:t,height:r});return this.width=t,this.height=r,this}attach(e){let{clearAttachments:t=!1,resizeAttachments:r=!0}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const i={};t&&Object.keys(this.attachments).forEach(a=>{i[a]=null}),Object.assign(i,e);const o=this.gl.bindFramebuffer(36160,this.handle);for(const a in i){Xt(a!==void 0,"Misspelled framebuffer binding point?");const l=Number(a),h=i[l];let p=h;if(!p)this._unattach(l);else if(p instanceof Ap)this._attachRenderbuffer({attachment:l,renderbuffer:p});else if(Array.isArray(h)){const[g,_=0,x=0]=h;p=g,this._attachTexture({attachment:l,texture:g,layer:_,level:x})}else this._attachTexture({attachment:l,texture:p,layer:0,level:0});r&&p&&p.resize({width:this.width,height:this.height})}this.gl.bindFramebuffer(36160,o||null),Object.assign(this.attachments,e),Object.keys(this.attachments).filter(a=>!this.attachments[a]).forEach(a=>{delete this.attachments[a]})}checkStatus(){const e=this.getStatus();if(e!==36053)throw new Error(zq(e));return this}getStatus(){const{gl:e}=this,t=e.bindFramebuffer(36160,this.handle),r=e.checkFramebufferStatus(36160);return e.bindFramebuffer(36160,t||null),r}clear(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{color:t,depth:r,stencil:i,drawBuffers:o=[]}=e,a=this.gl.bindFramebuffer(36160,this.handle);return(t||r||i)&&wS(this.gl,{color:t,depth:r,stencil:i}),o.forEach((l,h)=>{Mq(this.gl,{drawBuffer:h,value:l})}),this.gl.bindFramebuffer(36160,a||null),this}readPixels(){return Tn.error("Framebuffer.readPixels() is no logner supported, use readPixelsToArray(framebuffer)")(),null}readPixelsToBuffer(){return Tn.error("Framebuffer.readPixelsToBuffer()is no logner supported, use readPixelsToBuffer(framebuffer)")(),null}copyToDataUrl(){return Tn.error("Framebuffer.copyToDataUrl() is no logner supported, use copyToDataUrl(framebuffer)")(),null}copyToImage(){return Tn.error("Framebuffer.copyToImage() is no logner supported, use copyToImage(framebuffer)")(),null}copyToTexture(){return Tn.error("Framebuffer.copyToTexture({...}) is no logner supported, use copyToTexture(source, target, opts})")(),null}blit(){return Tn.error("Framebuffer.blit({...}) is no logner supported, use blit(source, target, opts)")(),null}invalidate(e){let{attachments:t=[],x:r=0,y:i=0,width:o,height:a}=e;const l=aa(this.gl),h=l.bindFramebuffer(36008,this.handle);return r===0&&i===0&&o===void 0&&a===void 0?l.invalidateFramebuffer(36008,t):l.invalidateFramebuffer(36008,t,r,i,o,a),l.bindFramebuffer(36008,h),this}getAttachmentParameter(e,t,r){let i=this._getAttachmentParameterFallback(t);return i===null&&(this.gl.bindFramebuffer(36160,this.handle),i=this.gl.getFramebufferAttachmentParameter(36160,e,t),this.gl.bindFramebuffer(36160,null)),r&&i>1e3&&(i=Vu(this.gl,i)),i}getAttachmentParameters(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:36064,t=arguments.length>1?arguments[1]:void 0,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:this.constructor.ATTACHMENT_PARAMETERS||[];const i={};for(const o of r){const a=t?Vu(this.gl,o):o;i[a]=this.getAttachmentParameter(e,o,t)}return i}getParameters(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;const t=Object.keys(this.attachments),r={};for(const i of t){const o=Number(i),a=e?Vu(this.gl,o):o;r[a]=this.getAttachmentParameters(o,e)}return r}show(){return typeof window<"u"&&window.open(BO(this),"luma-debug-texture"),this}log(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";if(e>Tn.level||typeof window>"u")return this;t=t||"Framebuffer ".concat(this.id);const r=BO(this,{targetMaxHeight:100});return Tn.image({logLevel:e,message:t,image:r},t)(),this}bind(){let{target:e=36160}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.gl.bindFramebuffer(e,this.handle),this}unbind(){let{target:e=36160}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.gl.bindFramebuffer(e,null),this}_createDefaultAttachments(e,t,r,i,o){let a=null;return e&&(a=a||{},a[36064]=new fs(this.gl,{id:"".concat(this.id,"-color0"),pixels:null,format:6408,type:5121,width:i,height:o,mipmaps:!1,parameters:{10241:9729,10240:9729,10242:33071,10243:33071}}),this.ownResources.push(a[36064])),t&&r?(a=a||{},a[33306]=new Ap(this.gl,{id:"".concat(this.id,"-depth-stencil"),format:35056,width:i,height:111}),this.ownResources.push(a[33306])):t?(a=a||{},a[36096]=new Ap(this.gl,{id:"".concat(this.id,"-depth"),format:33189,width:i,height:o}),this.ownResources.push(a[36096])):r&&Xt(!1),a}_unattach(e){const t=this.attachments[e];t&&(t instanceof Ap?this.gl.framebufferRenderbuffer(36160,e,36161,null):this.gl.framebufferTexture2D(36160,e,3553,null,0),delete this.attachments[e])}_attachRenderbuffer(e){let{attachment:t=36064,renderbuffer:r}=e;const{gl:i}=this;i.framebufferRenderbuffer(36160,t,36161,r.handle),this.attachments[t]=r}_attachTexture(e){let{attachment:t=36064,texture:r,layer:i,level:o}=e;const{gl:a}=this;switch(a.bindTexture(r.target,r.handle),r.target){case 35866:case 32879:aa(a).framebufferTextureLayer(36160,t,r.target,o,i);break;case 34067:const h=Uq(i);a.framebufferTexture2D(36160,t,h,r.handle,o);break;case 3553:a.framebufferTexture2D(36160,t,3553,r.handle,o);break;default:Xt(!1,"Illegal texture type")}a.bindTexture(r.target,null),this.attachments[t]=r}_setReadBuffer(e){const t=pG(this.gl);t?t.readBuffer(e):Xt(e===36064||e===1029,HO),this.readBuffer=e}_setDrawBuffers(e){const{gl:t}=this,r=aa(t);if(r)r.drawBuffers(e);else{const i=t.getExtension("WEBGL_draw_buffers");i?i.drawBuffersWEBGL(e):Xt(e.length===1&&(e[0]===36064||e[0]===1029),HO)}this.drawBuffers=e}_getAttachmentParameterFallback(e){const t=Fq(this.gl);switch(e){case 36052:return t.WEBGL2?null:0;case 33298:case 33299:case 33300:case 33301:case 33302:case 33303:return t.WEBGL2?null:8;case 33297:return t.WEBGL2?null:5125;case 33296:return!t.WEBGL2&&!t.EXT_sRGB?9729:null;default:return null}}_createHandle(){return this.gl.createFramebuffer()}_deleteHandle(){this.gl.deleteFramebuffer(this.handle)}_bindHandle(e){return this.gl.bindFramebuffer(36160,e)}}function Uq(n){return n<34069?n+34069:n}function zq(n){return(_o.STATUS||{})[n]||"Framebuffer error ".concat(n)}const jq=[36049,36048,33296,33298,33299,33300,33301,33302,33303];_o.ATTACHMENT_PARAMETERS=jq;function Vq(n,e){Xt(n instanceof fs||n instanceof RO||n instanceof Sq);const t=n.constructor,{gl:r,width:i,height:o,format:a,type:l,dataFormat:h,border:p,mipmaps:g}=n,_=Object.assign({width:i,height:o,format:a,type:l,dataFormat:h,border:p,mipmaps:g},e);return new t(r,_)}function Hq(n,e){const{gl:t,width:r,height:i,id:o}=n;return new _o(t,Object.assign({},e,{id:"framebuffer-for-".concat(o),width:r,height:i,attachments:{36064:n}}))}function zb(n){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"unnamed";const t=/#define[\s*]SHADER_NAME[\s*]([A-Za-z0-9_-]+)[\s*]/,r=n.match(t);return r?r[1]:e}const Gq=35632,qq=35633;function $q(n){switch(n){case Gq:return"fragment";case qq:return"vertex";default:return"unknown type"}}function Wq(n,e,t,r){const i=n.split(/\r?\n/),o={},a={},l=r||zb(e)||"(unnamed)",h="".concat($q(t)," shader ").concat(l);for(let g=0;g<i.length;g++){const _=i[g];if(_.length<=1)continue;const x=_.split(":"),C=x[0],M=parseInt(x[2],10);if(isNaN(M))throw new Error("GLSL compilation error in ".concat(h,": ").concat(n));C!=="WARNING"?o[M]=_:a[M]=_}const p=Yq(e);return{shaderName:h,errors:GO(o,p),warnings:GO(a,p)}}function GO(n,e){let t="";for(let r=0;r<e.length;r++){const i=e[r];if(!(!n[r+3]&&!n[r+2]&&!n[r+1])&&(t+="".concat(i,`
`),n[r+1])){const o=n[r+1],a=o.split(":",3),l=a[0],h=parseInt(a[1],10)||0,p=o.substring(a.join(":").length+1).trim();t+=qO("^^^ ".concat(l,": ").concat(p,`

`),h)}}return t}function Yq(n){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:": ";const r=n.split(/\r?\n/),i=String(r.length+e-1).length;return r.map((o,a)=>{const l=String(a+e),h=l.length;return qO(l,i-h)+t+o})}function qO(n,e){let t="";for(let r=0;r<e;++r)t+=" ";return"".concat(t).concat(n)}function $O(n){let e=100;const t=n.match(/[^\s]+/g);if(t.length>=2&&t[0]==="#version"){const r=parseInt(t[1],10);Number.isFinite(r)&&(e=r)}return e}const Kq="Shader: GLSL source code must be a JavaScript string";class zy extends Bl{get[Symbol.toStringTag](){return"Shader"}static getTypeName(e){switch(e){case 35633:return"vertex-shader";case 35632:return"fragment-shader";default:return Xt(!1),"unknown"}}constructor(e,t){Bb(e),Xt(typeof t.source=="string",Kq);const r=zb(t.source,null)||t.id||Hu("unnamed ".concat(zy.getTypeName(t.shaderType)));super(e,{id:r}),this.shaderType=t.shaderType,this.source=t.source,this.initialize(t)}initialize(e){let{source:t}=e;const r=zb(t,null);r&&(this.id=Hu(r)),this._compile(t)}getParameter(e){return this.gl.getShaderParameter(this.handle,e)}toString(){return"".concat(zy.getTypeName(this.shaderType),":").concat(this.id)}getName(){return zb(this.source)||"unnamed-shader"}getSource(){return this.gl.getShaderSource(this.handle)}getTranslatedSource(){const e=this.gl.getExtension("WEBGL_debug_shaders");return e?e.getTranslatedShaderSource(this.handle):"No translated source available. WEBGL_debug_shaders not implemented"}_compile(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.source;if(e.startsWith("#version ")||(e=`#version 100
`.concat(e)),this.source=e,this.gl.shaderSource(this.handle,this.source),this.gl.compileShader(this.handle),!this.getParameter(35713)){const r=this.gl.getShaderInfoLog(this.handle),{shaderName:i,errors:o,warnings:a}=Wq(r,this.source,this.shaderType,this.id);throw Tn.error("GLSL compilation errors in ".concat(i,`
`).concat(o))(),Tn.warn("GLSL compilation warnings in ".concat(i,`
`).concat(a))(),new Error("GLSL compilation errors in ".concat(i))}}_deleteHandle(){this.gl.deleteShader(this.handle)}_getOptsFromHandle(){return{type:this.getParameter(35663),source:this.getSource()}}}let xS=class extends zy{get[Symbol.toStringTag](){return"VertexShader"}constructor(e,t){typeof t=="string"&&(t={source:t}),super(e,Object.assign({},t,{shaderType:35633}))}_createHandle(){return this.gl.createShader(35633)}},ES=class extends zy{get[Symbol.toStringTag](){return"FragmentShader"}constructor(e,t){typeof t=="string"&&(t={source:t}),super(e,Object.assign({},t,{shaderType:35632}))}_createHandle(){return this.gl.createShader(35632)}};const Zq={5126:Ei.bind(null,"uniform1fv",ps,1,sa),35664:Ei.bind(null,"uniform2fv",ps,2,sa),35665:Ei.bind(null,"uniform3fv",ps,3,sa),35666:Ei.bind(null,"uniform4fv",ps,4,sa),5124:Ei.bind(null,"uniform1iv",Gu,1,sa),35667:Ei.bind(null,"uniform2iv",Gu,2,sa),35668:Ei.bind(null,"uniform3iv",Gu,3,sa),35669:Ei.bind(null,"uniform4iv",Gu,4,sa),35670:Ei.bind(null,"uniform1iv",Gu,1,sa),35671:Ei.bind(null,"uniform2iv",Gu,2,sa),35672:Ei.bind(null,"uniform3iv",Gu,3,sa),35673:Ei.bind(null,"uniform4iv",Gu,4,sa),35674:Ei.bind(null,"uniformMatrix2fv",ps,4,Ul),35675:Ei.bind(null,"uniformMatrix3fv",ps,9,Ul),35676:Ei.bind(null,"uniformMatrix4fv",ps,16,Ul),35678:jo,35680:jo,5125:Ei.bind(null,"uniform1uiv",jb,1,sa),36294:Ei.bind(null,"uniform2uiv",jb,2,sa),36295:Ei.bind(null,"uniform3uiv",jb,3,sa),36296:Ei.bind(null,"uniform4uiv",jb,4,sa),35685:Ei.bind(null,"uniformMatrix2x3fv",ps,6,Ul),35686:Ei.bind(null,"uniformMatrix2x4fv",ps,8,Ul),35687:Ei.bind(null,"uniformMatrix3x2fv",ps,6,Ul),35688:Ei.bind(null,"uniformMatrix3x4fv",ps,12,Ul),35689:Ei.bind(null,"uniformMatrix4x2fv",ps,8,Ul),35690:Ei.bind(null,"uniformMatrix4x3fv",ps,12,Ul),35678:jo,35680:jo,35679:jo,35682:jo,36289:jo,36292:jo,36293:jo,36298:jo,36299:jo,36300:jo,36303:jo,36306:jo,36307:jo,36308:jo,36311:jo},Xq={},Qq={},Jq={},WO=[0];function TS(n,e,t,r){e===1&&typeof n=="boolean"&&(n=n?1:0),Number.isFinite(n)&&(WO[0]=n,n=WO);const i=n.length;if(i%e&&Tn.warn("Uniform size should be multiples of ".concat(e),n)(),n instanceof t)return n;let o=r[i];o||(o=new t(i),r[i]=o);for(let a=0;a<i;a++)o[a]=n[a];return o}function ps(n,e){return TS(n,e,Float32Array,Xq)}function Gu(n,e){return TS(n,e,Int32Array,Qq)}function jb(n,e){return TS(n,e,Uint32Array,Jq)}function YO(n,e,t){const r=Zq[t.type];if(!r)throw new Error("Unknown GLSL uniform type ".concat(t.type));return r().bind(null,n,e)}function e$(n){if(n[n.length-1]!=="]")return{name:n,length:1,isArray:!1};const e=/([^[]*)(\[[0-9]+\])?/,t=n.match(e);if(!t||t.length<2)throw new Error("Failed to parse GLSL uniform name ".concat(n));return{name:t[1],length:t[2]||1,isArray:!!t[2]}}function t$(n,e,t){for(const r in n){const i=n[r];if((!t||!!t[r])&&!n$(i))throw e=e?"".concat(e," "):"",console.error("".concat(e," Bad uniform ").concat(r),i),new Error("".concat(e," Bad uniform ").concat(r))}return!0}function n$(n){return Array.isArray(n)||ArrayBuffer.isView(n)?i$(n):isFinite(n)||n===!0||n===!1||n instanceof Td||n instanceof Ap?!0:n instanceof _o?!!n.texture:!1}function r$(n,e,t){if(Array.isArray(t)||ArrayBuffer.isView(t))if(n[e]){const r=n[e];for(let i=0,o=t.length;i<o;++i)r[i]=t[i]}else n[e]=t.slice();else n[e]=t}function i$(n){if(n.length===0)return!1;const e=Math.min(n.length,16);for(let t=0;t<e;++t)if(!Number.isFinite(n[t]))return!1;return!0}function jo(){let n=null;return(e,t,r)=>{const i=n!==r;return i&&(e.uniform1i(t,r),n=r),i}}function Ei(n,e,t,r){let i=null,o=null;return(a,l,h)=>{const p=e(h,t),g=p.length;let _=!1;if(i===null)i=new Float32Array(g),o=g,_=!0;else{Xt(o===g,"Uniform length cannot change.");for(let x=0;x<g;++x)if(p[x]!==i[x]){_=!0;break}}return _&&(r(a,n,l,p),i.set(p)),_}}function sa(n,e,t,r){n[e](t,r)}function Ul(n,e,t,r){n[e](t,!1,r)}const o$=5120,a$=5121,s$=5122,c$=5123,KO=0,Vb=1,l$=2,u$=3,Hb=4,h$=5,d$=6,vo=5126,f$=35664,p$=35665,g$=35666,jy=5124,m$=35667,y$=35668,_$=35669,Vy=5125,v$=36294,b$=36295,w$=36296,x$=35670,E$=35671,T$=35672,S$=35673,C$=35674,A$=35675,I$=35676,P$=35685,M$=35686,R$=35687,k$=35688,O$=35689,L$=35690,SS={[vo]:[vo,1,"float"],[f$]:[vo,2,"vec2"],[p$]:[vo,3,"vec3"],[g$]:[vo,4,"vec4"],[jy]:[jy,1,"int"],[m$]:[jy,2,"ivec2"],[y$]:[jy,3,"ivec3"],[_$]:[jy,4,"ivec4"],[Vy]:[Vy,1,"uint"],[v$]:[Vy,2,"uvec2"],[b$]:[Vy,3,"uvec3"],[w$]:[Vy,4,"uvec4"],[x$]:[vo,1,"bool"],[E$]:[vo,2,"bvec2"],[T$]:[vo,3,"bvec3"],[S$]:[vo,4,"bvec4"],[C$]:[vo,8,"mat2"],[P$]:[vo,8,"mat2x3"],[M$]:[vo,8,"mat2x4"],[A$]:[vo,12,"mat3"],[R$]:[vo,12,"mat3x2"],[k$]:[vo,12,"mat3x4"],[I$]:[vo,16,"mat4"],[O$]:[vo,16,"mat4x2"],[L$]:[vo,16,"mat4x3"]};function N$(n){switch(n){case KO:return KO;case Vb:return Vb;case u$:return Vb;case l$:return Vb;case Hb:return Hb;case h$:return Hb;case d$:return Hb;default:return Xt(!1),0}}function ZO(n){const e=SS[n];if(!e)return null;const[t,r]=e;return{type:t,components:r}}function XO(n,e){switch(n){case o$:case a$:case s$:case c$:n=vo;break}for(const t in SS){const[r,i,o]=SS[t];if(r===n&&i===e)return{glType:t,name:o}}return null}class D${constructor(e){this.id=e.id,this.attributeInfos=[],this.attributeInfosByName={},this.attributeInfosByLocation=[],this.varyingInfos=[],this.varyingInfosByName={},Object.seal(this),this._readAttributesFromProgram(e),this._readVaryingsFromProgram(e)}getAttributeInfo(e){const t=Number(e);return Number.isFinite(t)?this.attributeInfosByLocation[t]:this.attributeInfosByName[e]||null}getAttributeLocation(e){const t=this.getAttributeInfo(e);return t?t.location:-1}getAttributeAccessor(e){const t=this.getAttributeInfo(e);return t?t.accessor:null}getVaryingInfo(e){const t=Number(e);return Number.isFinite(t)?this.varyingInfos[t]:this.varyingInfosByName[e]||null}getVaryingIndex(e){const t=this.getVaryingInfo();return t?t.location:-1}getVaryingAccessor(e){const t=this.getVaryingInfo();return t?t.accessor:null}_readAttributesFromProgram(e){const{gl:t}=e,r=t.getProgramParameter(e.handle,35721);for(let i=0;i<r;i++){const{name:o,type:a,size:l}=t.getActiveAttrib(e.handle,i),h=t.getAttribLocation(e.handle,o);h>=0&&this._addAttribute(h,o,a,l)}this.attributeInfos.sort((i,o)=>i.location-o.location)}_readVaryingsFromProgram(e){const{gl:t}=e;if(!yr(t))return;const r=t.getProgramParameter(e.handle,35971);for(let i=0;i<r;i++){const{name:o,type:a,size:l}=t.getTransformFeedbackVarying(e.handle,i);this._addVarying(i,o,a,l)}this.varyingInfos.sort((i,o)=>i.location-o.location)}_addAttribute(e,t,r,i){const{type:o,components:a}=ZO(r),l={type:o,size:i*a};this._inferProperties(e,t,l);const h={location:e,name:t,accessor:new ds(l)};this.attributeInfos.push(h),this.attributeInfosByLocation[e]=h,this.attributeInfosByName[h.name]=h}_inferProperties(e,t,r){/instance/i.test(t)&&(r.divisor=1)}_addVarying(e,t,r,i){const{type:o,components:a}=ZO(r),l=new ds({type:o,size:i*a}),h={location:e,name:t,accessor:l};this.varyingInfos.push(h),this.varyingInfosByName[h.name]=h}}const QO=4,F$=35981,B$=["setVertexArray","setAttributes","setBuffers","unsetBuffers","use","getUniformCount","getUniformInfo","getUniformLocation","getUniformValue","getVarying","getFragDataLocation","getAttachedShaders","getAttributeCount","getAttributeLocation","getAttributeInfo"];class JO extends Bl{get[Symbol.toStringTag](){return"Program"}constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(e,t),this.stubRemovedMethods("Program","v6.0",B$),this._isCached=!1,this.initialize(t),Object.seal(this),this._setId(t.id)}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{hash:t,vs:r,fs:i,varyings:o,bufferMode:a=F$}=e;return this.hash=t||"",this.vs=typeof r=="string"?new xS(this.gl,{id:"".concat(e.id,"-vs"),source:r}):r,this.fs=typeof i=="string"?new ES(this.gl,{id:"".concat(e.id,"-fs"),source:i}):i,Xt(this.vs instanceof xS),Xt(this.fs instanceof ES),this.uniforms={},this._textureUniforms={},o&&o.length>0&&(aa(this.gl),this.varyings=o,this.gl2.transformFeedbackVaryings(this.handle,o,a)),this._compileAndLink(),this._readUniformLocationsFromLinkedProgram(),this.configuration=new D$(this),this.setProps(e)}delete(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this._isCached?this:super.delete(e)}setProps(e){return"uniforms"in e&&this.setUniforms(e.uniforms),this}draw(e){let{logPriority:t,drawMode:r=4,vertexCount:i,offset:o=0,start:a,end:l,isIndexed:h=!1,indexType:p=5123,instanceCount:g=0,isInstanced:_=g>0,vertexArray:x=null,transformFeedback:C,framebuffer:M,parameters:L={},uniforms:F,samplers:z}=e;if((F||z)&&(Tn.deprecated("Program.draw({uniforms})","Program.setUniforms(uniforms)")(),this.setUniforms(F||{})),Tn.priority>=t){const ee=M?M.id:"default",ce="mode=".concat(Vu(this.gl,r)," verts=").concat(i," ")+"instances=".concat(g," indexType=").concat(Vu(this.gl,p)," ")+"isInstanced=".concat(_," isIndexed=").concat(h," ")+"Framebuffer=".concat(ee);Tn.log(t,ce)()}return Xt(x),this.gl.useProgram(this.handle),!this._areTexturesRenderable()||i===0||_&&g===0?!1:(x.bindForDraw(i,g,()=>{if(M!==void 0&&(L=Object.assign({},L,{framebuffer:M})),C){const ee=N$(r);C.begin(ee)}this._bindTextures(),fc(this.gl,L,()=>{h&&_?this.gl2.drawElementsInstanced(r,i,p,o,g):h&&yr(this.gl)&&!isNaN(a)&&!isNaN(l)?this.gl2.drawRangeElements(r,a,l,i,p,o):h?this.gl.drawElements(r,i,p,o):_?this.gl2.drawArraysInstanced(r,o,i,g):this.gl.drawArrays(r,o,i)}),C&&C.end()}),!0)}setUniforms(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};Tn.priority>=2&&t$(e,this.id,this._uniformSetters),this.gl.useProgram(this.handle);for(const t in e){const r=e[t],i=this._uniformSetters[t];if(i){let o=r,a=!1;if(o instanceof _o&&(o=o.texture),o instanceof Td)if(a=this.uniforms[t]!==r,a){i.textureIndex===void 0&&(i.textureIndex=this._textureIndexCounter++);const l=o,{textureIndex:h}=i;l.bind(h),o=h,this._textureUniforms[t]=l}else o=i.textureIndex;else this._textureUniforms[t]&&delete this._textureUniforms[t];(i(o)||a)&&r$(this.uniforms,t,r)}}return this}_areTexturesRenderable(){let e=!0;for(const t in this._textureUniforms){const r=this._textureUniforms[t];r.update(),e=e&&r.loaded}return e}_bindTextures(){for(const e in this._textureUniforms){const t=this._uniformSetters[e].textureIndex;this._textureUniforms[e].bind(t)}}_createHandle(){return this.gl.createProgram()}_deleteHandle(){this.gl.deleteProgram(this.handle)}_getOptionsFromHandle(e){const t=this.gl.getAttachedShaders(e),r={};for(const i of t)switch(this.gl.getShaderParameter(this.handle,35663)){case 35633:r.vs=new xS({handle:i});break;case 35632:r.fs=new ES({handle:i});break}return r}_getParameter(e){return this.gl.getProgramParameter(this.handle,e)}_setId(e){if(!e){const t=this._getName();this.id=Hu(t)}}_getName(){let e=this.vs.getName()||this.fs.getName();return e=e.replace(/shader/i,""),e=e?"".concat(e,"-program"):"program",e}_compileAndLink(){const{gl:e}=this;if(e.attachShader(this.handle,this.vs.handle),e.attachShader(this.handle,this.fs.handle),Tn.time(QO,"linkProgram for ".concat(this._getName()))(),e.linkProgram(this.handle),Tn.timeEnd(QO,"linkProgram for ".concat(this._getName()))(),e.debug||Tn.level>0){if(!e.getProgramParameter(this.handle,35714))throw new Error("Error linking: ".concat(e.getProgramInfoLog(this.handle)));if(e.validateProgram(this.handle),!e.getProgramParameter(this.handle,35715))throw new Error("Error validating: ".concat(e.getProgramInfoLog(this.handle)))}}_readUniformLocationsFromLinkedProgram(){const{gl:e}=this;this._uniformSetters={},this._uniformCount=this._getParameter(35718);for(let t=0;t<this._uniformCount;t++){const r=this.gl.getActiveUniform(this.handle,t),{name:i}=e$(r.name);let o=e.getUniformLocation(this.handle,i);if(this._uniformSetters[i]=YO(e,o,r),r.size>1)for(let a=0;a<r.size;a++)o=e.getUniformLocation(this.handle,"".concat(i,"[").concat(a,"]")),this._uniformSetters["".concat(i,"[").concat(a,"]")]=YO(e,o,r)}this._textureIndexCounter=0}getActiveUniforms(e,t){return this.gl2.getActiveUniforms(this.handle,e,t)}getUniformBlockIndex(e){return this.gl2.getUniformBlockIndex(this.handle,e)}getActiveUniformBlockParameter(e,t){return this.gl2.getActiveUniformBlockParameter(this.handle,e,t)}uniformBlockBinding(e,t){this.gl2.uniformBlockBinding(this.handle,e,t)}}const U$=34918,z$=34919,j$=35007,V$=36795,H$=35976,G$=35887,q$=36202;class Gb extends Bl{get[Symbol.toStringTag](){return"Query"}static isSupported(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];const r=yr(e),i=jO(e,Ri.TIMER_QUERY);let o=r||i;for(const a of t)switch(a){case"queries":o=o&&r;break;case"timers":o=o&&i;break;default:Xt(!1)}return o}constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(e,t),this.target=null,this._queryPending=!1,this._pollingPromise=null,Object.seal(this)}beginTimeElapsedQuery(){return this.begin(j$)}beginOcclusionQuery(){let{conservative:e=!1}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.begin(e?q$:G$)}beginTransformFeedbackQuery(){return this.begin(H$)}begin(e){return this._queryPending?this:(this.target=e,this.gl2.beginQuery(this.target,this.handle),this)}end(){return this._queryPending?this:(this.target&&(this.gl2.endQuery(this.target),this.target=null,this._queryPending=!0),this)}isResultAvailable(){if(!this._queryPending)return!1;const e=this.gl2.getQueryParameter(this.handle,z$);return e&&(this._queryPending=!1),e}isTimerDisjoint(){return this.gl2.getParameter(V$)}getResult(){return this.gl2.getQueryParameter(this.handle,U$)}getTimerMilliseconds(){return this.getResult()/1e6}createPoll(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Number.POSITIVE_INFINITY;if(this._pollingPromise)return this._pollingPromise;let t=0;return this._pollingPromise=new Promise((r,i)=>{const o=()=>{this.isResultAvailable()?(r(this.getResult()),this._pollingPromise=null):t++>e?(i("Timed out"),this._pollingPromise=null):requestAnimationFrame(o)};requestAnimationFrame(o)}),this._pollingPromise}_createHandle(){return Gb.isSupported(this.gl)?this.gl2.createQuery():null}_deleteHandle(){this.gl2.deleteQuery(this.handle)}}class eL extends Bl{get[Symbol.toStringTag](){return"TransformFeedback"}static isSupported(e){return yr(e)}constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};aa(e),super(e,t),this.initialize(t),this.stubRemovedMethods("TransformFeedback","v6.0",["pause","resume"]),Object.seal(this)}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.buffers={},this.unused={},this.configuration=null,this.bindOnUse=!0,Sp(this.buffers)||this.bind(()=>this._unbindBuffers()),this.setProps(e),this}setProps(e){"program"in e&&(this.configuration=e.program&&e.program.configuration),"configuration"in e&&(this.configuration=e.configuration),"bindOnUse"in e&&(e=e.bindOnUse),"buffers"in e&&this.setBuffers(e.buffers)}setBuffers(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.bind(()=>{for(const t in e)this.setBuffer(t,e[t])}),this}setBuffer(e,t){const r=this._getVaryingIndex(e),{buffer:i,byteSize:o,byteOffset:a}=this._getBufferParams(t);return r<0?(this.unused[e]=i,Tn.warn("".concat(this.id," unused varying buffer ").concat(e))(),this):(this.buffers[r]=t,this.bindOnUse||this._bindBuffer(r,i,a,o),this)}begin(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return this.gl.bindTransformFeedback(36386,this.handle),this._bindBuffers(),this.gl.beginTransformFeedback(e),this}end(){return this.gl.endTransformFeedback(),this._unbindBuffers(),this.gl.bindTransformFeedback(36386,null),this}_getBufferParams(e){let t,r,i;return e instanceof ni?i=e:(i=e.buffer,r=e.byteSize,t=e.byteOffset),(t!==void 0||r!==void 0)&&(t=t||0,r=r||i.byteLength-t),{buffer:i,byteOffset:t,byteSize:r}}_getVaryingInfo(e){return this.configuration&&this.configuration.getVaryingInfo(e)}_getVaryingIndex(e){if(this.configuration)return this.configuration.getVaryingInfo(e).location;const t=Number(e);return Number.isFinite(t)?t:-1}_bindBuffers(){if(this.bindOnUse)for(const e in this.buffers){const{buffer:t,byteSize:r,byteOffset:i}=this._getBufferParams(this.buffers[e]);this._bindBuffer(e,t,i,r)}}_unbindBuffers(){if(this.bindOnUse)for(const e in this.buffers)this._bindBuffer(e,null)}_bindBuffer(e,t){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,i=arguments.length>3?arguments[3]:void 0;const o=t&&t.handle;return!o||i===void 0?this.gl.bindBufferBase(35982,e,o):this.gl.bindBufferRange(35982,e,o,r,i),this}_createHandle(){return this.gl.createTransformFeedback()}_deleteHandle(){this.gl.deleteTransformFeedback(this.handle)}_bindHandle(e){this.gl.bindTransformFeedback(36386,this.handle)}}let qb=null;function $$(n){return(!qb||qb.byteLength<n)&&(qb=new ArrayBuffer(n)),qb}function W$(n,e){const t=$$(n.BYTES_PER_ELEMENT*e);return new n(t,0,e)}function Y$(n){let{target:e,source:t,start:r=0,count:i=1}=n;const o=t.length,a=i*o;let l=0;for(let h=r;l<o;l++)e[h++]=t[l];for(;l<a;)l<a-l?(e.copyWithin(r+l,r,r+l),l*=2):(e.copyWithin(r+l,r,r+a-l),l=a);return e}const K$="elements must be GL.ELEMENT_ARRAY_BUFFER";class gs extends Bl{get[Symbol.toStringTag](){return"VertexArrayObject"}static isSupported(e){return(arguments.length>1&&arguments[1]!==void 0?arguments[1]:{}).constantAttributeZero?yr(e)||Dk()==="Chrome":!0}static getDefaultArray(e){return e.luma=e.luma||{},e.luma.defaultVertexArray||(e.luma.defaultVertexArray=new gs(e,{handle:null,isDefaultArray:!0})),e.luma.defaultVertexArray}static getMaxAttributes(e){return gs.MAX_ATTRIBUTES=gs.MAX_ATTRIBUTES||e.getParameter(34921),gs.MAX_ATTRIBUTES}static setConstant(e,t,r){switch(r.constructor){case Float32Array:gs._setConstantFloatArray(e,t,r);break;case Int32Array:gs._setConstantIntArray(e,t,r);break;case Uint32Array:gs._setConstantUintArray(e,t,r);break;default:Xt(!1)}}constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const r=t.id||t.program&&t.program.id;super(e,Object.assign({},t,{id:r})),this.buffer=null,this.bufferValue=null,this.isDefaultArray=t.isDefaultArray||!1,this.gl2=e,this.initialize(t),Object.seal(this)}delete(){return super.delete(),this.buffer&&this.buffer.delete(),this}get MAX_ATTRIBUTES(){return gs.getMaxAttributes(this.gl)}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.setProps(e)}setProps(e){return this}setElementBuffer(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;return Xt(!e||e.target===34963,K$),this.bind(()=>{this.gl.bindBuffer(34963,e?e.handle:null)}),this}setBuffer(e,t,r){if(t.target===34963)return this.setElementBuffer(t,r);const{size:i,type:o,stride:a,offset:l,normalized:h,integer:p,divisor:g}=r,{gl:_,gl2:x}=this;return e=Number(e),this.bind(()=>{_.bindBuffer(34962,t.handle),p?(Xt(yr(_)),x.vertexAttribIPointer(e,i,o,a,l)):_.vertexAttribPointer(e,i,o,h,a,l),_.enableVertexAttribArray(e),x.vertexAttribDivisor(e,g||0)}),this}enable(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return!t&&e===0&&!gs.isSupported(this.gl,{constantAttributeZero:!0})||(e=Number(e),this.bind(()=>t?this.gl.enableVertexAttribArray(e):this.gl.disableVertexAttribArray(e))),this}getConstantBuffer(e,t){const r=this._normalizeConstantArrayValue(t),i=r.byteLength*e,o=r.length*e;let a=!this.buffer;if(this.buffer=this.buffer||new ni(this.gl,i),a=a||this.buffer.reallocate(i),a=a||!this._compareConstantArrayValues(r,this.bufferValue),a){const l=W$(t.constructor,o);Y$({target:l,source:r,start:0,count:o}),this.buffer.subData(l),this.bufferValue=t}return this.buffer}_normalizeConstantArrayValue(e){return Array.isArray(e)?new Float32Array(e):e}_compareConstantArrayValues(e,t){if(!e||!t||e.length!==t.length||e.constructor!==t.constructor)return!1;for(let r=0;r<e.length;++r)if(e[r]!==t[r])return!1;return!0}static _setConstantFloatArray(e,t,r){switch(r.length){case 1:e.vertexAttrib1fv(t,r);break;case 2:e.vertexAttrib2fv(t,r);break;case 3:e.vertexAttrib3fv(t,r);break;case 4:e.vertexAttrib4fv(t,r);break;default:Xt(!1)}}static _setConstantIntArray(e,t,r){switch(Xt(yr(e)),r.length){case 1:e.vertexAttribI1iv(t,r);break;case 2:e.vertexAttribI2iv(t,r);break;case 3:e.vertexAttribI3iv(t,r);break;case 4:e.vertexAttribI4iv(t,r);break;default:Xt(!1)}}static _setConstantUintArray(e,t,r){switch(Xt(yr(e)),r.length){case 1:e.vertexAttribI1uiv(t,r);break;case 2:e.vertexAttribI2uiv(t,r);break;case 3:e.vertexAttribI3uiv(t,r);break;case 4:e.vertexAttribI4uiv(t,r);break;default:Xt(!1)}}_createHandle(){return this.gl.createVertexArray()}_deleteHandle(e){return this.gl2.deleteVertexArray(e),[this.elements]}_bindHandle(e){this.gl2.bindVertexArray(e)}_getParameter(e,t){let{location:r}=t;return Xt(Number.isFinite(r)),this.bind(()=>{switch(e){case 34373:return this.gl.getVertexAttribOffset(r,e);default:return this.gl.getVertexAttrib(r,e)}})}}const Z$="VertexArray: attributes must be Buffers or constants (i.e. typed array)",X$=/^(.+)__LOCATION_([0-9]+)$/,Q$=["setBuffers","setGeneric","clearBindings","setLocations","setGenericValues","setDivisor","enable","disable"];class J${constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const r=t.id||t.program&&t.program.id;this.id=r,this.gl=e,this.configuration=null,this.elements=null,this.elementsAccessor=null,this.values=null,this.accessors=null,this.unused=null,this.drawParams=null,this.buffer=null,this.attributes={},this.vertexArrayObject=new gs(e),SO(this,"VertexArray","v6.0",Q$),this.initialize(t),Object.seal(this)}delete(){this.buffer&&this.buffer.delete(),this.vertexArrayObject.delete()}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.reset(),this.configuration=null,this.bindOnUse=!1,this.setProps(e)}reset(){this.elements=null,this.elementsAccessor=null;const{MAX_ATTRIBUTES:e}=this.vertexArrayObject;return this.values=new Array(e).fill(null),this.accessors=new Array(e).fill(null),this.unused={},this.drawParams=null,this}setProps(e){return"program"in e&&(this.configuration=e.program&&e.program.configuration),"configuration"in e&&(this.configuration=e.configuration),"attributes"in e&&this.setAttributes(e.attributes),"elements"in e&&this.setElementBuffer(e.elements),"bindOnUse"in e&&(e=e.bindOnUse),this}clearDrawParams(){this.drawParams=null}getDrawParams(){return this.drawParams=this.drawParams||this._updateDrawParams(),this.drawParams}setAttributes(e){return Object.assign(this.attributes,e),this.vertexArrayObject.bind(()=>{for(const t in e){const r=e[t];this._setAttribute(t,r)}this.gl.bindBuffer(34962,null)}),this}setElementBuffer(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return this.elements=e,this.elementsAccessor=t,this.clearDrawParams(),this.vertexArrayObject.setElementBuffer(e,t),this}setBuffer(e,t){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(t.target===34963)return this.setElementBuffer(t,r);const{location:i,accessor:o}=this._resolveLocationAndAccessor(e,t,t.accessor,r);return i>=0&&(this.values[i]=t,this.accessors[i]=o,this.clearDrawParams(),this.vertexArrayObject.setBuffer(i,t,o)),this}setConstant(e,t){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const{location:i,accessor:o}=this._resolveLocationAndAccessor(e,t,Object.assign({size:t.length},r));return i>=0&&(t=this.vertexArrayObject._normalizeConstantArrayValue(t),this.values[i]=t,this.accessors[i]=o,this.clearDrawParams(),this.vertexArrayObject.enable(i,!1)),this}unbindBuffers(){return this.vertexArrayObject.bind(()=>{this.elements&&this.vertexArrayObject.setElementBuffer(null),this.buffer=this.buffer||new ni(this.gl,{accessor:{size:4}});for(let e=0;e<this.vertexArrayObject.MAX_ATTRIBUTES;e++)this.values[e]instanceof ni&&(this.gl.disableVertexAttribArray(e),this.gl.bindBuffer(34962,this.buffer.handle),this.gl.vertexAttribPointer(e,1,5126,!1,0,0))}),this}bindBuffers(){return this.vertexArrayObject.bind(()=>{this.elements&&this.setElementBuffer(this.elements);for(let e=0;e<this.vertexArrayObject.MAX_ATTRIBUTES;e++){const t=this.values[e];t instanceof ni&&this.setBuffer(e,t)}}),this}bindForDraw(e,t,r){let i;return this.vertexArrayObject.bind(()=>{this._setConstantAttributes(e,t),i=r()}),i}_resolveLocationAndAccessor(e,t,r,i){const o={location:-1,accessor:null},{location:a,name:l}=this._getAttributeIndex(e);if(!Number.isFinite(a)||a<0)return this.unused[e]=t,Tn.once(3,()=>"unused value ".concat(e," in ").concat(this.id))(),o;const h=this._getAttributeInfo(l||a);if(!h)return o;const p=this.accessors[a]||{},g=ds.resolve(h.accessor,p,r,i),{size:_,type:x}=g;return Xt(Number.isFinite(_)&&Number.isFinite(x)),{location:a,accessor:g}}_getAttributeInfo(e){return this.configuration&&this.configuration.getAttributeInfo(e)}_getAttributeIndex(e){const t=Number(e);if(Number.isFinite(t))return{location:t};const r=X$.exec(e),i=r?r[1]:e,o=r?Number(r[2]):0;return this.configuration?{location:this.configuration.getAttributeLocation(i)+o,name:i}:{location:-1}}_setAttribute(e,t){if(t instanceof ni)this.setBuffer(e,t);else if(Array.isArray(t)&&t.length&&t[0]instanceof ni){const r=t[0],i=t[1];this.setBuffer(e,r,i)}else if(ArrayBuffer.isView(t)||Array.isArray(t)){const r=t;this.setConstant(e,r)}else if(t.buffer instanceof ni){const r=t;this.setBuffer(e,r.buffer,r)}else throw new Error(Z$)}_setConstantAttributes(e,t){const r=Math.max(e|0,t|0);let i=this.values[0];ArrayBuffer.isView(i)&&this._setConstantAttributeZero(i,r);for(let o=1;o<this.vertexArrayObject.MAX_ATTRIBUTES;o++)i=this.values[o],ArrayBuffer.isView(i)&&this._setConstantAttribute(o,i)}_setConstantAttributeZero(e,t){if(gs.isSupported(this.gl,{constantAttributeZero:!0})){this._setConstantAttribute(0,e);return}const r=this.vertexArrayObject.getConstantBuffer(t,e);this.vertexArrayObject.setBuffer(0,r,this.accessors[0])}_setConstantAttribute(e,t){gs.setConstant(this.gl,e,t)}_updateDrawParams(){const e={isIndexed:!1,isInstanced:!1,indexCount:1/0,vertexCount:1/0,instanceCount:1/0};for(let t=0;t<this.vertexArrayObject.MAX_ATTRIBUTES;t++)this._updateDrawParamsForLocation(e,t);return this.elements&&(e.elementCount=this.elements.getElementCount(this.elements.accessor),e.isIndexed=!0,e.indexType=this.elementsAccessor.type||this.elements.accessor.type,e.indexOffset=this.elementsAccessor.offset||0),e.indexCount===1/0&&(e.indexCount=0),e.vertexCount===1/0&&(e.vertexCount=0),e.instanceCount===1/0&&(e.instanceCount=0),e}_updateDrawParamsForLocation(e,t){const r=this.values[t],i=this.accessors[t];if(!r)return;const{divisor:o}=i,a=o>0;if(e.isInstanced=e.isInstanced||a,r instanceof ni){const l=r;if(a){const h=l.getVertexCount(i);e.instanceCount=Math.min(e.instanceCount,h)}else{const h=l.getVertexCount(i);e.vertexCount=Math.min(e.vertexCount,h)}}}setElements(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return Tn.deprecated("setElements","setElementBuffer")(),this.setElementBuffer(e,t)}}function eW(n,e){const{maxElts:t=16,size:r=1}=e;let i="[";for(let a=0;a<n.length&&a<t;++a)a>0&&(i+=",".concat(a%r===0?" ":"")),i+=Hy(n[a],e);const o=n.length>t?"...":"]";return"".concat(i).concat(o)}function Hy(n){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const t=1e-16,{isInteger:r=!1}=e;if(Array.isArray(n)||ArrayBuffer.isView(n))return eW(n,e);if(!Number.isFinite(n))return String(n);if(Math.abs(n)<t)return r?"0":"0.";if(r||Math.abs(n)>100&&Math.abs(n)<1e4)return n.toFixed(0);const i=n.toPrecision(2);return i.indexOf(".0")===i.length-2?i.slice(0,-1):i}function tL(n){let{header:e="Uniforms",program:t,uniforms:r,undefinedOnly:i=!1}=n;Xt(t);const o=".*_.*",a=".*Matrix",l=t._uniformSetters,h={},p=Object.keys(l).sort();let g=0;for(const C of p)!C.match(o)&&!C.match(a)&&CS({table:h,header:e,uniforms:r,uniformName:C,undefinedOnly:i})&&g++;for(const C of p)C.match(a)&&CS({table:h,header:e,uniforms:r,uniformName:C,undefinedOnly:i})&&g++;for(const C of p)h[C]||CS({table:h,header:e,uniforms:r,uniformName:C,undefinedOnly:i})&&g++;let _=0;const x={};if(!i)for(const C in r){const M=r[C];h[C]||(_++,x[C]={Type:"NOT USED: ".concat(M),[e]:Hy(M)})}return{table:h,count:g,unusedTable:x,unusedCount:_}}function CS(n){let{table:e,header:t,uniforms:r,uniformName:i,undefinedOnly:o}=n;const a=r[i],l=tW(a);return!o||!l?(e[i]={[t]:l?Hy(a):"N/A","Uniform Type":l?a:"NOT PROVIDED"},!0):!1}function tW(n){return n!=null}function nW(n){let{vertexArray:e,header:t="Attributes"}=n;if(!e.configuration)return{};const r={};e.elements&&(r.ELEMENT_ARRAY_BUFFER=nL(e,e.elements,null,t));const i=e.values;for(const o in i){const a=e._getAttributeInfo(o);if(a){let l="".concat(o,": ").concat(a.name);const h=e.accessors[a.location];h&&(l="".concat(o,": ").concat(rW(a.name,h))),r[l]=nL(e,i[o],h,t)}}return r}function nL(n,e,t,r){const{gl:i}=n;if(!e)return{[r]:"null","Format ":"N/A"};let o="NOT PROVIDED",a=1,l=0,h=0,p,g,_;if(t&&(o=t.type,a=t.size,o=String(o).replace("Array",""),p=o.indexOf("nt")!==-1),e instanceof ni){const x=e,{data:C,changed:M}=x.getDebugData();g=M?"*":"",_=C,h=x.byteLength,l=h/C.BYTES_PER_ELEMENT/a;let L;if(t){const F=t.divisor>0;L="".concat(F?"I ":"P "," ").concat(l," (x").concat(a,"=").concat(h," bytes ").concat(Vu(i,o),")")}else p=!0,L="".concat(h," bytes");return{[r]:"".concat(g).concat(Hy(_,{size:a,isInteger:p})),"Format ":L}}return _=e,a=e.length,o=String(e.constructor.name).replace("Array",""),p=o.indexOf("nt")!==-1,{[r]:"".concat(Hy(_,{size:a,isInteger:p})," (constant)"),"Format ":"".concat(a,"x").concat(o," (constant)")}}function rW(n,e){const{type:t,size:r}=e,i=XO(t,r);return i?"".concat(n," (").concat(i.name,")"):n}function iW(n){const e={},t="Accessors for ".concat(n.id);for(const r of n.attributeInfos)if(r){const i=rL(r);e["in ".concat(i)]={[t]:JSON.stringify(r.accessor)}}for(const r of n.varyingInfos)if(r){const i=rL(r);e["out ".concat(i)]={[t]:JSON.stringify(r.accessor)}}return e}function rL(n){const{type:e,size:t}=n.accessor,r=XO(e,t);return r?"".concat(r.name," ").concat(n.name):n.name}const iL=Dl()&&typeof document<"u";let oW=0;class aW{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{onCreateContext:t=F=>EO(F),onAddHTML:r=null,onInitialize:i=()=>{},onRender:o=()=>{},onFinalize:a=()=>{},onError:l,gl:h=null,glOptions:p={},debug:g=!1,createFramebuffer:_=!1,autoResizeViewport:x=!0,autoResizeDrawingBuffer:C=!0,stats:M=Ed.get("animation-loop-".concat(oW++))}=e;let{useDevicePixels:L=!0}=e;"useDevicePixelRatio"in e&&(Tn.deprecated("useDevicePixelRatio","useDevicePixels")(),L=e.useDevicePixelRatio),this.props={onCreateContext:t,onAddHTML:r,onInitialize:i,onRender:o,onFinalize:a,onError:l,gl:h,glOptions:p,debug:g,createFramebuffer:_},this.gl=h,this.needsRedraw=null,this.timeline=null,this.stats=M,this.cpuTime=this.stats.get("CPU Time"),this.gpuTime=this.stats.get("GPU Time"),this.frameRate=this.stats.get("Frame Rate"),this._initialized=!1,this._running=!1,this._animationFrameId=null,this._nextFramePromise=null,this._resolveNextFrame=null,this._cpuStartTime=0,this.setProps({autoResizeViewport:x,autoResizeDrawingBuffer:C,useDevicePixels:L}),this.start=this.start.bind(this),this.stop=this.stop.bind(this),this._pageLoadPromise=null,this._onMousemove=this._onMousemove.bind(this),this._onMouseleave=this._onMouseleave.bind(this)}delete(){this.stop(),this._setDisplay(null)}setNeedsRedraw(e){return Xt(typeof e=="string"),this.needsRedraw=this.needsRedraw||e,this}setProps(e){return"autoResizeViewport"in e&&(this.autoResizeViewport=e.autoResizeViewport),"autoResizeDrawingBuffer"in e&&(this.autoResizeDrawingBuffer=e.autoResizeDrawingBuffer),"useDevicePixels"in e&&(this.useDevicePixels=e.useDevicePixels),this}start(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(this._running)return this;this._running=!0;const t=this._getPageLoadPromise().then(()=>!this._running||this._initialized?null:(this._createWebGLContext(e),this._createFramebuffer(),this._startEventHandling(),this._initializeCallbackData(),this._updateCallbackData(),this._resizeCanvasDrawingBuffer(),this._resizeViewport(),this._gpuTimeQuery=Gb.isSupported(this.gl,["timers"])?new Gb(this.gl):null,this._initialized=!0,this.onInitialize(this.animationProps))).then(r=>{this._running&&(this._addCallbackData(r||{}),r!==!1&&this._startLoop())});return this.props.onError&&t.catch(this.props.onError),this}redraw(){return this.isContextLost()?this:(this._beginTimers(),this._setupFrame(),this._updateCallbackData(),this._renderFrame(this.animationProps),this._clearNeedsRedraw(),this.offScreen&&this.gl.commit&&this.gl.commit(),this._resolveNextFrame&&(this._resolveNextFrame(this),this._nextFramePromise=null,this._resolveNextFrame=null),this._endTimers(),this)}stop(){return this._running&&(this._finalizeCallbackData(),this._cancelAnimationFrame(this._animationFrameId),this._nextFramePromise=null,this._resolveNextFrame=null,this._animationFrameId=null,this._running=!1),this}attachTimeline(e){return this.timeline=e,this.timeline}detachTimeline(){this.timeline=null}waitForRender(){return this.setNeedsRedraw("waitForRender"),this._nextFramePromise||(this._nextFramePromise=new Promise(e=>{this._resolveNextFrame=e})),this._nextFramePromise}async toDataURL(){return this.setNeedsRedraw("toDataURL"),await this.waitForRender(),this.gl.canvas.toDataURL()}isContextLost(){return this.gl.isContextLost()}onCreateContext(){return this.props.onCreateContext(...arguments)}onInitialize(){return this.props.onInitialize(...arguments)}onRender(){return this.props.onRender(...arguments)}onFinalize(){return this.props.onFinalize(...arguments)}getHTMLControlValue(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;const r=document.getElementById(e);return r?Number(r.value):t}setViewParameters(){return Tn.removed("AnimationLoop.setViewParameters","AnimationLoop.setProps")(),this}_startLoop(){const e=()=>{this._running&&(this.redraw(),this._animationFrameId=this._requestAnimationFrame(e))};this._cancelAnimationFrame(this._animationFrameId),this._animationFrameId=this._requestAnimationFrame(e)}_getPageLoadPromise(){return this._pageLoadPromise||(this._pageLoadPromise=iL?new Promise((e,t)=>{if(iL&&document.readyState==="complete"){e(document);return}window.addEventListener("load",()=>{e(document)})}):Promise.resolve({})),this._pageLoadPromise}_setDisplay(e){this.display&&(this.display.delete(),this.display.animationLoop=null),e&&(e.animationLoop=this),this.display=e}_cancelAnimationFrame(e){return this.display&&this.display.cancelAnimationFrame?this.display.cancelAnimationFrame(e):dq(e)}_requestAnimationFrame(e){if(this._running)return this.display&&this.display.requestAnimationFrame?this.display.requestAnimationFrame(e):hq(e)}_renderFrame(){if(this.display){this.display._renderFrame(...arguments);return}this.onRender(...arguments)}_clearNeedsRedraw(){this.needsRedraw=null}_setupFrame(){this._resizeCanvasDrawingBuffer(),this._resizeViewport(),this._resizeFramebuffer()}_initializeCallbackData(){this.animationProps={gl:this.gl,stop:this.stop,canvas:this.gl.canvas,framebuffer:this.framebuffer,useDevicePixels:this.useDevicePixels,needsRedraw:null,startTime:Date.now(),engineTime:0,tick:0,tock:0,time:0,_timeline:this.timeline,_loop:this,_animationLoop:this,_mousePosition:null}}_updateCallbackData(){const{width:e,height:t,aspect:r}=this._getSizeAndAspect();(e!==this.animationProps.width||t!==this.animationProps.height)&&this.setNeedsRedraw("drawing buffer resized"),r!==this.animationProps.aspect&&this.setNeedsRedraw("drawing buffer aspect changed"),this.animationProps.width=e,this.animationProps.height=t,this.animationProps.aspect=r,this.animationProps.needsRedraw=this.needsRedraw,this.animationProps.engineTime=Date.now()-this.animationProps.startTime,this.timeline&&this.timeline.update(this.animationProps.engineTime),this.animationProps.tick=Math.floor(this.animationProps.time/1e3*60),this.animationProps.tock++,this.animationProps.time=this.timeline?this.timeline.getTime():this.animationProps.engineTime,this.animationProps._offScreen=this.offScreen}_finalizeCallbackData(){this.onFinalize(this.animationProps)}_addCallbackData(e){typeof e=="object"&&e!==null&&(this.animationProps=Object.assign({},this.animationProps,e))}_createWebGLContext(e){if(this.offScreen=e.canvas&&typeof OffscreenCanvas<"u"&&e.canvas instanceof OffscreenCanvas,e=Object.assign({},e,this.props.glOptions),this.gl=this.props.gl?pS(this.props.gl,e):this.onCreateContext(e),!Fb(this.gl))throw new Error("AnimationLoop.onCreateContext - illegal context returned");QG(this.gl),this._createInfoDiv()}_createInfoDiv(){if(this.gl.canvas&&this.props.onAddHTML){const e=document.createElement("div");document.body.appendChild(e),e.style.position="relative";const t=document.createElement("div");t.style.position="absolute",t.style.left="10px",t.style.bottom="10px",t.style.width="300px",t.style.background="white",e.appendChild(this.gl.canvas),e.appendChild(t);const r=this.props.onAddHTML(t);r&&(t.innerHTML=r)}}_getSizeAndAspect(){const e=this.gl.drawingBufferWidth,t=this.gl.drawingBufferHeight;let r=1;const{canvas:i}=this.gl;return i&&i.clientHeight?r=i.clientWidth/i.clientHeight:e>0&&t>0&&(r=e/t),{width:e,height:t,aspect:r}}_resizeViewport(){this.autoResizeViewport&&this.gl.viewport(0,0,this.gl.drawingBufferWidth,this.gl.drawingBufferHeight)}_resizeCanvasDrawingBuffer(){this.autoResizeDrawingBuffer&&rq(this.gl,{useDevicePixels:this.useDevicePixels})}_createFramebuffer(){this.props.createFramebuffer&&(this.framebuffer=new _o(this.gl))}_resizeFramebuffer(){this.framebuffer&&this.framebuffer.resize({width:this.gl.drawingBufferWidth,height:this.gl.drawingBufferHeight})}_beginTimers(){this.frameRate.timeEnd(),this.frameRate.timeStart(),this._gpuTimeQuery&&this._gpuTimeQuery.isResultAvailable()&&!this._gpuTimeQuery.isTimerDisjoint()&&this.stats.get("GPU Time").addTime(this._gpuTimeQuery.getTimerMilliseconds()),this._gpuTimeQuery&&this._gpuTimeQuery.beginTimeElapsedQuery(),this.cpuTime.timeStart()}_endTimers(){this.cpuTime.timeEnd(),this._gpuTimeQuery&&this._gpuTimeQuery.end()}_startEventHandling(){const{canvas:e}=this.gl;e&&(e.addEventListener("mousemove",this._onMousemove),e.addEventListener("mouseleave",this._onMouseleave))}_onMousemove(e){this.animationProps._mousePosition=[e.offsetX,e.offsetY]}_onMouseleave(e){this.animationProps._mousePosition=null}}const Gy="vs",AS="fs";function ms(n,e){if(!n)throw new Error(e||"shadertools: assertion failed.")}const IS={number:{validate(n,e){return Number.isFinite(n)&&(!("max"in e)||n<=e.max)&&(!("min"in e)||n>=e.min)}},array:{validate(n,e){return Array.isArray(n)||ArrayBuffer.isView(n)}}};function sW(n){const e={};for(const t in n){const r=n[t],i=cW(r);e[t]=i}return e}function cW(n){let e=oL(n);return e==="object"?n?"type"in n?Object.assign({},n,IS[n.type]):"value"in n?(e=oL(n.value),Object.assign({type:e},n,IS[e])):{type:"object",value:n}:{type:"object",value:null}:Object.assign({type:e,value:n},IS[e])}function oL(n){return Array.isArray(n)||ArrayBuffer.isView(n)?"array":typeof n}const lW="vs",uW="fs";class aL{constructor(e){let{name:t,vs:r,fs:i,dependencies:o=[],uniforms:a,getUniforms:l,deprecations:h=[],defines:p={},inject:g={},vertexShader:_,fragmentShader:x}=e;ms(typeof t=="string"),this.name=t,this.vs=r||_,this.fs=i||x,this.getModuleUniforms=l,this.dependencies=o,this.deprecations=this._parseDeprecationDefinitions(h),this.defines=p,this.injections=hW(g),a&&(this.uniforms=sW(a))}getModuleSource(e){let t;switch(e){case lW:t=this.vs||"";break;case uW:t=this.fs||"";break;default:ms(!1)}return"#define MODULE_".concat(this.name.toUpperCase().replace(/[^0-9a-z]/gi,"_"),`
`).concat(t,"// END MODULE_").concat(this.name,`

`)}getUniforms(e,t){return this.getModuleUniforms?this.getModuleUniforms(e,t):this.uniforms?this._defaultGetUniforms(e):{}}getDefines(){return this.defines}checkDeprecations(e,t){this.deprecations.forEach(r=>{r.regex.test(e)&&(r.deprecated?t.deprecated(r.old,r.new)():t.removed(r.old,r.new)())})}_parseDeprecationDefinitions(e){return e.forEach(t=>{switch(t.type){case"function":t.regex=new RegExp("\\b".concat(t.old,"\\("));break;default:t.regex=new RegExp("".concat(t.type," ").concat(t.old,";"))}}),e}_defaultGetUniforms(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const t={},r=this.uniforms;for(const i in r){const o=r[i];i in e&&!o.private?(o.validate&&ms(o.validate(e[i],o),"".concat(this.name,": invalid ").concat(i)),t[i]=e[i]):t[i]=o.value}return t}}function hW(n){const e={vs:{},fs:{}};for(const t in n){let r=n[t];const i=t.slice(0,2);typeof r=="string"&&(r={order:0,injection:r}),e[i][t]=r}return e}function dW(n){return fW(cL(n))}function fW(n){const e={},t={};return sL({modules:n,level:0,moduleMap:e,moduleDepth:t}),Object.keys(t).sort((r,i)=>t[i]-t[r]).map(r=>e[r])}function sL(n){let{modules:e,level:t,moduleMap:r,moduleDepth:i}=n;if(t>=5)throw new Error("Possible loop in shader dependency graph");for(const o of e)r[o.name]=o,(i[o.name]===void 0||i[o.name]<t)&&(i[o.name]=t);for(const o of e)o.dependencies&&sL({modules:o.dependencies,level:t+1,moduleMap:r,moduleDepth:i})}function cL(n,e){return n.map(t=>(t instanceof aL||(ms(typeof t!="string","Shader module use by name is deprecated. Import shader module '".concat(t,"' and use it directly.")),ms(t.name,"shader module has no name"),t=new aL(t),t.dependencies=cL(t.dependencies)),t))}function pW(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const e=typeof window<"u"?window.navigator||{}:{},t=n.userAgent||e.userAgent||"",r=t.indexOf("MSIE ")!==-1,i=t.indexOf("Trident/")!==-1;return r||i}const gW=7936,mW=7937,yW=7938,_W=35724,PS={GLSL_FRAG_DATA:["WEBGL_draw_buffers",!0],GLSL_FRAG_DEPTH:["EXT_frag_depth",!0],GLSL_DERIVATIVES:["OES_standard_derivatives",!0],GLSL_TEXTURE_LOD:["EXT_shader_texture_lod",!0]},Cd={};Object.keys(PS).forEach(n=>{Cd[n]=n});function vW(n){return typeof WebGL2RenderingContext<"u"&&n instanceof WebGL2RenderingContext?!0:!!(n&&n._version===2)}function bW(n){const e=n.getExtension("WEBGL_debug_renderer_info"),t=n.getParameter(e&&e.UNMASKED_VENDOR_WEBGL||gW),r=n.getParameter(e&&e.UNMASKED_RENDERER_WEBGL||mW);return{gpuVendor:wW(t,r),vendor:t,renderer:r,version:n.getParameter(yW),shadingLanguageVersion:n.getParameter(_W)}}function wW(n,e){return n.match(/NVIDIA/i)||e.match(/NVIDIA/i)?"NVIDIA":n.match(/INTEL/i)||e.match(/INTEL/i)?"INTEL":n.match(/AMD/i)||e.match(/AMD/i)||n.match(/ATI/i)||e.match(/ATI/i)?"AMD":"UNKNOWN GPU"}const MS={};function lL(n,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const r=PS[e];if(ms(r,e),!pW(t))return!0;if(e in MS)return MS[e];const i=r[0],o=t.behavior||"enable",a="#extension GL_".concat(i," : ").concat(o,`
void main(void) {}`),l=n.createShader(35633);n.shaderSource(l,a),n.compileShader(l);const h=n.getShaderParameter(l,35713);return n.deleteShader(l),MS[e]=h,h}function xW(n,e){const t=PS[e];ms(t,e);const r=vW(n)&&t[1]||t[0],i=typeof r=="string"?!!n.getExtension(r):r;return ms(i===!1||i===!0),i}function $b(n,e){return e=Array.isArray(e)?e:[e],e.every(t=>xW(n,t))}function EW(n){switch(bW(n).gpuVendor.toLowerCase()){case"nvidia":return`#define NVIDIA_GPU
// Nvidia optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
`;case"intel":return`#define INTEL_GPU
// Intel optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
// Intel's built-in 'tan' function doesn't have acceptable precision
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`;case"amd":return`#define AMD_GPU
`;default:return`#define DEFAULT_GPU
// Prevent driver from optimizing away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
// Intel's built-in 'tan' function doesn't have acceptable precision
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`}}function TW(n,e,t){let r=`#if (__VERSION__ > 120)

# define FEATURE_GLSL_DERIVATIVES
# define FEATURE_GLSL_DRAW_BUFFERS
# define FEATURE_GLSL_FRAG_DEPTH
# define FEATURE_GLSL_TEXTURE_LOD

// DEPRECATED FLAGS, remove in v9
# define FRAG_DEPTH
# define DERIVATIVES
# define DRAW_BUFFERS
# define TEXTURE_LOD

#endif // __VERSION
`;return $b(n,Cd.GLSL_FRAG_DEPTH)&&(r+=`
// FRAG_DEPTH => gl_FragDepth is available
#ifdef GL_EXT_frag_depth
#extension GL_EXT_frag_depth : enable
# define FEATURE_GLSL_FRAG_DEPTH
# define FRAG_DEPTH
# define gl_FragDepth gl_FragDepthEXT
#endif
`),$b(n,Cd.GLSL_DERIVATIVES)&&lL(n,Cd.GLSL_DERIVATIVES)&&(r+=`
// DERIVATIVES => dxdF, dxdY and fwidth are available
#ifdef GL_OES_standard_derivatives
#extension GL_OES_standard_derivatives : enable
# define FEATURE_GLSL_DERIVATIVES
# define DERIVATIVES
#endif
`),$b(n,Cd.GLSL_FRAG_DATA)&&lL(n,Cd.GLSL_FRAG_DATA,{behavior:"require"})&&(r+=`
// DRAW_BUFFERS => gl_FragData[] is available
#ifdef GL_EXT_draw_buffers
#extension GL_EXT_draw_buffers : require
#define FEATURE_GLSL_DRAW_BUFFERS
#define DRAW_BUFFERS
#endif
`),$b(n,Cd.GLSL_TEXTURE_LOD)&&(r+=`// TEXTURE_LOD => texture2DLod etc are available
#ifdef GL_EXT_shader_texture_lod
#extension GL_EXT_shader_texture_lod : enable

# define FEATURE_GLSL_TEXTURE_LOD
# define TEXTURE_LOD

#endif
`),r}const SW=`#ifdef MODULE_LOGDEPTH
  logdepth_adjustPosition(gl_Position);
#endif
`,CW=`#ifdef MODULE_MATERIAL
  gl_FragColor = material_filterColor(gl_FragColor);
#endif

#ifdef MODULE_LIGHTING
  gl_FragColor = lighting_filterColor(gl_FragColor);
#endif

#ifdef MODULE_FOG
  gl_FragColor = fog_filterColor(gl_FragColor);
#endif

#ifdef MODULE_PICKING
  gl_FragColor = picking_filterHighlightColor(gl_FragColor);
  gl_FragColor = picking_filterPickingColor(gl_FragColor);
#endif

#ifdef MODULE_LOGDEPTH
  logdepth_setFragDepth();
#endif
`,AW={[Gy]:SW,[AS]:CW},Wb="__LUMA_INJECT_DECLARATIONS__",uL=/void\s+main\s*\([^)]*\)\s*\{\n?/,hL=/}\n?[^{}]*$/,RS=[];function dL(n,e,t){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;const i=e===Gy;for(const o in t){const a=t[o];a.sort((h,p)=>h.order-p.order),RS.length=a.length;for(let h=0,p=a.length;h<p;++h)RS[h]=a[h].injection;const l="".concat(RS.join(`
`),`
`);switch(o){case"vs:#decl":i&&(n=n.replace(Wb,l));break;case"vs:#main-start":i&&(n=n.replace(uL,h=>h+l));break;case"vs:#main-end":i&&(n=n.replace(hL,h=>l+h));break;case"fs:#decl":i||(n=n.replace(Wb,l));break;case"fs:#main-start":i||(n=n.replace(uL,h=>h+l));break;case"fs:#main-end":i||(n=n.replace(hL,h=>l+h));break;default:n=n.replace(o,h=>h+l)}}return n=n.replace(Wb,""),r&&(n=n.replace(/\}\s*$/,o=>o+AW[e])),n}function kS(n){const e={};return ms(Array.isArray(n)&&n.length>1),n.forEach(t=>{for(const r in t)e[r]=e[r]?"".concat(e[r],`
`).concat(t[r]):t[r]}),e}function Ip(n){return new RegExp("\\b".concat(n,"[ \\t]+(\\w+[ \\t]+\\w+(\\[\\w+\\])?;)"),"g")}const fL=[[/^(#version[ \t]+(100|300[ \t]+es))?[ \t]*\n/,`#version 300 es
`],[/\btexture(2D|2DProj|Cube)Lod(EXT)?\(/g,"textureLod("],[/\btexture(2D|2DProj|Cube)(EXT)?\(/g,"texture("]],IW=[...fL,[Ip("attribute"),"in $1"],[Ip("varying"),"out $1"]],PW=[...fL,[Ip("varying"),"in $1"]],pL=[[/^#version[ \t]+300[ \t]+es/,"#version 100"],[/\btexture(2D|2DProj|Cube)Lod\(/g,"texture$1LodEXT("],[/\btexture\(/g,"texture2D("],[/\btextureLod\(/g,"texture2DLodEXT("]],MW=[...pL,[Ip("in"),"attribute $1"],[Ip("out"),"varying $1"]],RW=[...pL,[Ip("in"),"varying $1"]],OS="gl_FragColor",LS=/\bout[ \t]+vec4[ \t]+(\w+)[ \t]*;\n?/,kW=/void\s+main\s*\([^)]*\)\s*\{\n?/;function OW(n,e,t){switch(e){case 300:return t?Yb(n,IW):LW(n);case 100:return t?Yb(n,MW):NW(n);default:throw new Error("unknown GLSL version ".concat(e))}}function Yb(n,e){for(const[t,r]of e)n=n.replace(t,r);return n}function LW(n){n=Yb(n,PW);const e=n.match(LS);if(e){const t=e[1];n=n.replace(new RegExp("\\b".concat(OS,"\\b"),"g"),t)}else{const t="fragmentColor";n=n.replace(kW,r=>"out vec4 ".concat(t,`;
`).concat(r)).replace(new RegExp("\\b".concat(OS,"\\b"),"g"),t)}return n}function NW(n){n=Yb(n,RW);const e=n.match(LS);if(e){const t=e[1];n=n.replace(LS,"").replace(new RegExp("\\b".concat(t,"\\b"),"g"),OS)}return n}const DW=`

`.concat(Wb,`

`),gL={[Gy]:"vertex",[AS]:"fragment"},FW=`precision highp float;

`;function BW(n,e){const{vs:t,fs:r}=e,i=dW(e.modules||[]);return{gl:n,vs:mL(n,Object.assign({},e,{source:t,type:Gy,modules:i})),fs:mL(n,Object.assign({},e,{source:r,type:AS,modules:i})),getUniforms:UW(i)}}function mL(n,e){let{id:t,source:r,type:i,modules:o,defines:a={},hookFunctions:l=[],inject:h={},transpileToGLSL100:p=!1,prologue:g=!0,log:_}=e;ms(typeof r=="string","shader source must be a string");const x=i===Gy,C=r.split(`
`);let M=100,L="",F=r;C[0].indexOf("#version ")===0?(M=300,L=C[0],F=C.slice(1).join(`
`)):L="#version ".concat(M);const z={};o.forEach(pe=>{Object.assign(z,pe.getDefines())}),Object.assign(z,a);let ee=g?"".concat(L,`
`).concat(jW({id:t,source:r,type:i}),`
`).concat(zW({type:i}),`
`).concat(EW(n),`
`).concat(TW(n),`
`).concat(VW(z),`
`).concat(x?"":FW,`
`):"".concat(L,`
`);const ce=GW(l),se={},_e={},J={};for(const pe in h){const ue=typeof h[pe]=="string"?{injection:h[pe],order:0}:h[pe],xe=pe.match(/^(v|f)s:(#)?([\w-]+)$/);if(xe){const je=xe[2],ne=xe[3];je?ne==="decl"?_e[pe]=[ue]:J[pe]=[ue]:se[pe]=[ue]}else J[pe]=[ue]}for(const pe of o){_&&pe.checkDeprecations(F,_);const ue=pe.getModuleSource(i,M);ee+=ue;const xe=pe.injections[i];for(const je in xe){const ne=je.match(/^(v|f)s:#([\w-]+)$/);if(ne){const ke=ne[2]==="decl"?_e:J;ke[je]=ke[je]||[],ke[je].push(xe[je])}else se[je]=se[je]||[],se[je].push(xe[je])}}return ee+=DW,ee=dL(ee,i,_e),ee+=HW(ce[i],se),ee+=F,ee=dL(ee,i,J),ee=OW(ee,p?100:M,x),ee}function UW(n){return function(t){const r={};for(const i of n){const o=i.getUniforms(t,r);Object.assign(r,o)}return r}}function zW(n){let{type:e}=n;return`
#define SHADER_TYPE_`.concat(gL[e].toUpperCase(),`
`)}function jW(n){let{id:e,source:t,type:r}=n;return e&&typeof e=="string"&&t.indexOf("SHADER_NAME")===-1?`
#define SHADER_NAME `.concat(e,"_").concat(gL[r],`

`):""}function VW(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=0,t="";for(const r in n){e===0&&(t+=`
// APPLICATION DEFINES
`),e++;const i=n[r];(i||Number.isFinite(i))&&(t+="#define ".concat(r.toUpperCase()," ").concat(n[r],`
`))}return e===0&&(t+=`
`),t}function HW(n,e){let t="";for(const r in n){const i=n[r];if(t+="void ".concat(i.signature,` {
`),i.header&&(t+="  ".concat(i.header)),e[r]){const o=e[r];o.sort((a,l)=>a.order-l.order);for(const a of o)t+="  ".concat(a.injection,`
`)}i.footer&&(t+="  ".concat(i.footer)),t+=`}
`}return t}function GW(n){const e={vs:{},fs:{}};return n.forEach(t=>{let r;typeof t!="string"?(r=t,t=r.hook):r={},t=t.trim();const[i,o]=t.split(":"),a=t.replace(/\(.+/,"");e[i][a]=Object.assign(r,{signature:o})}),e}const qW="void main() {gl_FragColor = vec4(0);}",yL=`out vec4 transform_output;
void main() {
  transform_output = vec4(0);
}`,$W=`#version 300 es
`.concat(yL);function _L(n,e){e=Array.isArray(e)?e:[e];const t=n.replace(/^\s+/,"").split(/\s+/),[r,i,o]=t;if(!e.includes(r)||!i||!o)return null;const a=o.split(";")[0];return{qualifier:r,type:i,name:a}}function vL(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{version:e=100,input:t,inputType:r,output:i}=n;if(!t)return e===300?$W:e>300?"#version ".concat(e,`
`).concat(yL):qW;const o=KW(t,r);return e>=300?"#version ".concat(e," ").concat(e===300?"es":"",`
in `).concat(r," ").concat(t,`;
out vec4 `).concat(i,`;
void main() {
  `).concat(i," = ").concat(o,`;
}`):"varying ".concat(r," ").concat(t,`;
void main() {
  gl_FragColor = `).concat(o,`;
}`)}function WW(n){switch(n){case"float":return"x";case"vec2":return"xy";case"vec3":return"xyz";case"vec4":return"xyzw";default:return ms(!1),null}}function YW(n){switch(n){case"float":return 1;case"vec2":return 2;case"vec3":return 3;case"vec4":return 4;default:return ms(!1),null}}function KW(n,e){switch(e){case"float":return"vec4(".concat(n,", 0.0, 0.0, 1.0)");case"vec2":return"vec4(".concat(n,", 0.0, 1.0)");case"vec3":return"vec4(".concat(n,", 1.0)");case"vec4":return n;default:return ms(!1),null}}const ZW={name:"fp32",vs:`#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND
const float TWO_PI = 6.2831854820251465;
const float PI_2 = 1.5707963705062866;
const float PI_16 = 0.1963495463132858;

const float SIN_TABLE_0 = 0.19509032368659973;
const float SIN_TABLE_1 = 0.3826834261417389;
const float SIN_TABLE_2 = 0.5555702447891235;
const float SIN_TABLE_3 = 0.7071067690849304;

const float COS_TABLE_0 = 0.9807852506637573;
const float COS_TABLE_1 = 0.9238795042037964;
const float COS_TABLE_2 = 0.8314695954322815;
const float COS_TABLE_3 = 0.7071067690849304;

const float INVERSE_FACTORIAL_3 = 1.666666716337204e-01;
const float INVERSE_FACTORIAL_5 = 8.333333767950535e-03;
const float INVERSE_FACTORIAL_7 = 1.9841270113829523e-04;
const float INVERSE_FACTORIAL_9 = 2.75573188446287533e-06;

float sin_taylor_fp32(float a) {
  float r, s, t, x;

  if (a == 0.0) {
    return 0.0;
  }

  x = -a * a;
  s = a;
  r = a;

  r = r * x;
  t = r * INVERSE_FACTORIAL_3;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_5;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_7;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_9;
  s = s + t;

  return s;
}

void sincos_taylor_fp32(float a, out float sin_t, out float cos_t) {
  if (a == 0.0) {
    sin_t = 0.0;
    cos_t = 1.0;
  }
  sin_t = sin_taylor_fp32(a);
  cos_t = sqrt(1.0 - sin_t * sin_t);
}

float tan_taylor_fp32(float a) {
    float sin_a;
    float cos_a;

    if (a == 0.0) {
        return 0.0;
    }
    float z = floor(a / TWO_PI);
    float r = a - TWO_PI * z;

    float t;
    float q = floor(r / PI_2 + 0.5);
    int j = int(q);

    if (j < -2 || j > 2) {
        return 1.0 / 0.0;
    }

    t = r - PI_2 * q;

    q = floor(t / PI_16 + 0.5);
    int k = int(q);
    int abs_k = int(abs(float(k)));

    if (abs_k > 4) {
        return 1.0 / 0.0;
    } else {
        t = t - PI_16 * q;
    }

    float u = 0.0;
    float v = 0.0;

    float sin_t, cos_t;
    float s, c;
    sincos_taylor_fp32(t, sin_t, cos_t);

    if (k == 0) {
        s = sin_t;
        c = cos_t;
    } else {
        if (abs(float(abs_k) - 1.0) < 0.5) {
            u = COS_TABLE_0;
            v = SIN_TABLE_0;
        } else if (abs(float(abs_k) - 2.0) < 0.5) {
            u = COS_TABLE_1;
            v = SIN_TABLE_1;
        } else if (abs(float(abs_k) - 3.0) < 0.5) {
            u = COS_TABLE_2;
            v = SIN_TABLE_2;
        } else if (abs(float(abs_k) - 4.0) < 0.5) {
            u = COS_TABLE_3;
            v = SIN_TABLE_3;
        }
        if (k > 0) {
            s = u * sin_t + v * cos_t;
            c = u * cos_t - v * sin_t;
        } else {
            s = u * sin_t - v * cos_t;
            c = u * cos_t + v * sin_t;
        }
    }

    if (j == 0) {
        sin_a = s;
        cos_a = c;
    } else if (j == 1) {
        sin_a = c;
        cos_a = -s;
    } else if (j == -1) {
        sin_a = -c;
        cos_a = s;
    } else {
        sin_a = -s;
        cos_a = -c;
    }
    return sin_a / cos_a;
}
#endif

float tan_fp32(float a) {
#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND
  return tan_taylor_fp32(a);
#else
  return tan(a);
#endif
}
`,fs:null};function bL(n,e){if(!n)throw new Error("math.gl assertion ".concat(e))}const ys={EPSILON:1e-12,debug:!1,precision:4,printTypes:!1,printDegrees:!1,printRowMajor:!0};function XW(n,{precision:e=ys.precision}={}){return n=QW(n),"".concat(parseFloat(n.toPrecision(e)))}function Pp(n){return Array.isArray(n)||ArrayBuffer.isView(n)&&!(n instanceof DataView)}function qu(n,e,t){return eY(n,r=>Math.max(e,Math.min(t,r)))}function Kb(n,e,t){return Pp(n)?n.map((r,i)=>Kb(r,e[i],t)):t*e+(1-t)*n}function qy(n,e,t){const r=ys.EPSILON;t&&(ys.EPSILON=t);try{if(n===e)return!0;if(Pp(n)&&Pp(e)){if(n.length!==e.length)return!1;for(let i=0;i<n.length;++i)if(!qy(n[i],e[i]))return!1;return!0}return n&&n.equals?n.equals(e):e&&e.equals?e.equals(n):typeof n=="number"&&typeof e=="number"?Math.abs(n-e)<=ys.EPSILON*Math.max(1,Math.abs(n),Math.abs(e)):!1}finally{ys.EPSILON=r}}function QW(n){return Math.round(n/ys.EPSILON)*ys.EPSILON}function JW(n){return n.clone?n.clone():new Array(n.length)}function eY(n,e,t){if(Pp(n)){const r=n;t=t||JW(r);for(let i=0;i<t.length&&i<r.length;++i)t[i]=e(n[i],i,t);return t}return e(n)}function tY(n){function e(){var t=Reflect.construct(n,Array.from(arguments));return Object.setPrototypeOf(t,Object.getPrototypeOf(this)),t}return e.prototype=Object.create(n.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),Object.setPrototypeOf?Object.setPrototypeOf(e,n):e.__proto__=n,e}class wL extends tY(Array){clone(){return new this.constructor().copy(this)}fromArray(e,t=0){for(let r=0;r<this.ELEMENTS;++r)this[r]=e[r+t];return this.check()}toArray(e=[],t=0){for(let r=0;r<this.ELEMENTS;++r)e[t+r]=this[r];return e}from(e){return Array.isArray(e)?this.copy(e):this.fromObject(e)}to(e){return e===this?this:Pp(e)?this.toArray(e):this.toObject(e)}toTarget(e){return e?this.to(e):this}toFloat32Array(){return new Float32Array(this)}toString(){return this.formatString(ys)}formatString(e){let t="";for(let r=0;r<this.ELEMENTS;++r)t+=(r>0?", ":"")+XW(this[r],e);return"".concat(e.printTypes?this.constructor.name:"","[").concat(t,"]")}equals(e){if(!e||this.length!==e.length)return!1;for(let t=0;t<this.ELEMENTS;++t)if(!qy(this[t],e[t]))return!1;return!0}exactEquals(e){if(!e||this.length!==e.length)return!1;for(let t=0;t<this.ELEMENTS;++t)if(this[t]!==e[t])return!1;return!0}negate(){for(let e=0;e<this.ELEMENTS;++e)this[e]=-this[e];return this.check()}lerp(e,t,r){if(r===void 0)return this.lerp(this,e,t);for(let i=0;i<this.ELEMENTS;++i){const o=e[i];this[i]=o+r*(t[i]-o)}return this.check()}min(e){for(let t=0;t<this.ELEMENTS;++t)this[t]=Math.min(e[t],this[t]);return this.check()}max(e){for(let t=0;t<this.ELEMENTS;++t)this[t]=Math.max(e[t],this[t]);return this.check()}clamp(e,t){for(let r=0;r<this.ELEMENTS;++r)this[r]=Math.min(Math.max(this[r],e[r]),t[r]);return this.check()}add(...e){for(const t of e)for(let r=0;r<this.ELEMENTS;++r)this[r]+=t[r];return this.check()}subtract(...e){for(const t of e)for(let r=0;r<this.ELEMENTS;++r)this[r]-=t[r];return this.check()}scale(e){if(typeof e=="number")for(let t=0;t<this.ELEMENTS;++t)this[t]*=e;else for(let t=0;t<this.ELEMENTS&&t<e.length;++t)this[t]*=e[t];return this.check()}multiplyByScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]*=e;return this.check()}check(){if(ys.debug&&!this.validate())throw new Error("math.gl: ".concat(this.constructor.name," some fields set to invalid numbers'"));return this}validate(){let e=this.length===this.ELEMENTS;for(let t=0;t<this.ELEMENTS;++t)e=e&&Number.isFinite(this[t]);return e}sub(e){return this.subtract(e)}setScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]=e;return this.check()}addScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]+=e;return this.check()}subScalar(e){return this.addScalar(-e)}multiplyScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]*=e;return this.check()}divideScalar(e){return this.multiplyByScalar(1/e)}clampScalar(e,t){for(let r=0;r<this.ELEMENTS;++r)this[r]=Math.min(Math.max(this[r],e),t);return this.check()}get elements(){return this}}function nY(n,e){if(n.length!==e)return!1;for(let t=0;t<n.length;++t)if(!Number.isFinite(n[t]))return!1;return!0}function _s(n){if(!Number.isFinite(n))throw new Error("Invalid number ".concat(n));return n}function NS(n,e,t=""){if(ys.debug&&!nY(n,e))throw new Error("math.gl: ".concat(t," some fields set to invalid numbers'"));return n}class rY extends wL{get x(){return this[0]}set x(e){this[0]=_s(e)}get y(){return this[1]}set y(e){this[1]=_s(e)}len(){return Math.sqrt(this.lengthSquared())}magnitude(){return this.len()}lengthSquared(){let e=0;for(let t=0;t<this.ELEMENTS;++t)e+=this[t]*this[t];return e}magnitudeSquared(){return this.lengthSquared()}distance(e){return Math.sqrt(this.distanceSquared(e))}distanceSquared(e){let t=0;for(let r=0;r<this.ELEMENTS;++r){const i=this[r]-e[r];t+=i*i}return _s(t)}dot(e){let t=0;for(let r=0;r<this.ELEMENTS;++r)t+=this[r]*e[r];return _s(t)}normalize(){const e=this.magnitude();if(e!==0)for(let t=0;t<this.ELEMENTS;++t)this[t]/=e;return this.check()}multiply(...e){for(const t of e)for(let r=0;r<this.ELEMENTS;++r)this[r]*=t[r];return this.check()}divide(...e){for(const t of e)for(let r=0;r<this.ELEMENTS;++r)this[r]/=t[r];return this.check()}lengthSq(){return this.lengthSquared()}distanceTo(e){return this.distance(e)}distanceToSquared(e){return this.distanceSquared(e)}getComponent(e){return bL(e>=0&&e<this.ELEMENTS,"index is out of range"),_s(this[e])}setComponent(e,t){return bL(e>=0&&e<this.ELEMENTS,"index is out of range"),this[e]=t,this.check()}addVectors(e,t){return this.copy(e).add(t)}subVectors(e,t){return this.copy(e).subtract(t)}multiplyVectors(e,t){return this.copy(e).multiply(t)}addScaledVector(e,t){return this.add(new this.constructor(e).multiplyScalar(t))}}var co=1e-6,Mp=typeof Float32Array<"u"?Float32Array:Array;function iY(){var n=new Mp(2);return Mp!=Float32Array&&(n[0]=0,n[1]=0),n}function Zb(n,e,t){return n[0]=e[0]+t[0],n[1]=e[1]+t[1],n}function xL(n,e){return n[0]=-e[0],n[1]=-e[1],n}function EL(n,e,t,r){var i=e[0],o=e[1];return n[0]=i+r*(t[0]-i),n[1]=o+r*(t[1]-o),n}function oY(n,e,t){var r=e[0],i=e[1];return n[0]=t[0]*r+t[4]*i+t[12],n[1]=t[1]*r+t[5]*i+t[13],n}(function(){var n=iY();return function(e,t,r,i,o,a){var l,h;for(t||(t=2),r||(r=0),i?h=Math.min(i*t+r,e.length):h=e.length,l=r;l<h;l+=t)n[0]=e[l],n[1]=e[l+1],o(n,n,a),e[l]=n[0],e[l+1]=n[1];return e}})();function aY(n,e,t){const r=e[0],i=e[1],o=t[3]*r+t[7]*i||1;return n[0]=(t[0]*r+t[4]*i)/o,n[1]=(t[1]*r+t[5]*i)/o,n}function TL(n,e,t){const r=e[0],i=e[1],o=e[2],a=t[3]*r+t[7]*i+t[11]*o||1;return n[0]=(t[0]*r+t[4]*i+t[8]*o)/a,n[1]=(t[1]*r+t[5]*i+t[9]*o)/a,n[2]=(t[2]*r+t[6]*i+t[10]*o)/a,n}function sY(n,e,t){const r=e[0],i=e[1];return n[0]=t[0]*r+t[2]*i,n[1]=t[1]*r+t[3]*i,n[2]=e[2],n}function cY(){var n=new Mp(3);return Mp!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0),n}function lY(n,e,t){return n[0]=e[0]+t[0],n[1]=e[1]+t[1],n[2]=e[2]+t[2],n}function uY(n,e,t){return n[0]=e[0]-t[0],n[1]=e[1]-t[1],n[2]=e[2]-t[2],n}function hY(n,e,t){return n[0]=e[0]*t[0],n[1]=e[1]*t[1],n[2]=e[2]*t[2],n}function dY(n,e){return n[0]=-e[0],n[1]=-e[1],n[2]=-e[2],n}function fY(n,e){return n[0]*e[0]+n[1]*e[1]+n[2]*e[2]}function pY(n,e,t){var r=e[0],i=e[1],o=e[2],a=t[0],l=t[1],h=t[2];return n[0]=i*h-o*l,n[1]=o*a-r*h,n[2]=r*l-i*a,n}function SL(n,e,t){var r=e[0],i=e[1],o=e[2],a=t[3]*r+t[7]*i+t[11]*o+t[15];return a=a||1,n[0]=(t[0]*r+t[4]*i+t[8]*o+t[12])/a,n[1]=(t[1]*r+t[5]*i+t[9]*o+t[13])/a,n[2]=(t[2]*r+t[6]*i+t[10]*o+t[14])/a,n}function gY(n,e,t){var r=e[0],i=e[1],o=e[2];return n[0]=r*t[0]+i*t[3]+o*t[6],n[1]=r*t[1]+i*t[4]+o*t[7],n[2]=r*t[2]+i*t[5]+o*t[8],n}function mY(n,e,t){var r=t[0],i=t[1],o=t[2],a=t[3],l=e[0],h=e[1],p=e[2],g=i*p-o*h,_=o*l-r*p,x=r*h-i*l;return g=g+g,_=_+_,x=x+x,n[0]=l+a*g+i*x-o*_,n[1]=h+a*_+o*g-r*x,n[2]=p+a*x+r*_-i*g,n}function yY(n,e,t,r){var i=[],o=[];return i[0]=e[0]-t[0],i[1]=e[1]-t[1],i[2]=e[2]-t[2],o[0]=i[0],o[1]=i[1]*Math.cos(r)-i[2]*Math.sin(r),o[2]=i[1]*Math.sin(r)+i[2]*Math.cos(r),n[0]=o[0]+t[0],n[1]=o[1]+t[1],n[2]=o[2]+t[2],n}function _Y(n,e,t,r){var i=[],o=[];return i[0]=e[0]-t[0],i[1]=e[1]-t[1],i[2]=e[2]-t[2],o[0]=i[2]*Math.sin(r)+i[0]*Math.cos(r),o[1]=i[1],o[2]=i[2]*Math.cos(r)-i[0]*Math.sin(r),n[0]=o[0]+t[0],n[1]=o[1]+t[1],n[2]=o[2]+t[2],n}function vY(n,e,t,r){var i=[],o=[];return i[0]=e[0]-t[0],i[1]=e[1]-t[1],i[2]=e[2]-t[2],o[0]=i[0]*Math.cos(r)-i[1]*Math.sin(r),o[1]=i[0]*Math.sin(r)+i[1]*Math.cos(r),o[2]=i[2],n[0]=o[0]+t[0],n[1]=o[1]+t[1],n[2]=o[2]+t[2],n}function bY(n,e){var t=n[0],r=n[1],i=n[2],o=e[0],a=e[1],l=e[2],h=Math.sqrt((t*t+r*r+i*i)*(o*o+a*a+l*l)),p=h&&fY(n,e)/h;return Math.acos(Math.min(Math.max(p,-1),1))}var wY=uY,xY=hY;(function(){var n=cY();return function(e,t,r,i,o,a){var l,h;for(t||(t=3),r||(r=0),i?h=Math.min(i*t+r,e.length):h=e.length,l=r;l<h;l+=t)n[0]=e[l],n[1]=e[l+1],n[2]=e[l+2],o(n,n,a),e[l]=n[0],e[l+1]=n[1],e[l+2]=n[2];return e}})();const DS=[0,0,0];let Xb;class zc extends rY{static get ZERO(){return Xb||(Xb=new zc(0,0,0),Object.freeze(Xb)),Xb}constructor(e=0,t=0,r=0){super(-0,-0,-0),arguments.length===1&&Pp(e)?this.copy(e):(ys.debug&&(_s(e),_s(t),_s(r)),this[0]=e,this[1]=t,this[2]=r)}set(e,t,r){return this[0]=e,this[1]=t,this[2]=r,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this.check()}fromObject(e){return ys.debug&&(_s(e.x),_s(e.y),_s(e.z)),this[0]=e.x,this[1]=e.y,this[2]=e.z,this.check()}toObject(e){return e.x=this[0],e.y=this[1],e.z=this[2],e}get ELEMENTS(){return 3}get z(){return this[2]}set z(e){this[2]=_s(e)}angle(e){return bY(this,e)}cross(e){return pY(this,this,e),this.check()}rotateX({radians:e,origin:t=DS}){return yY(this,this,t,e),this.check()}rotateY({radians:e,origin:t=DS}){return _Y(this,this,t,e),this.check()}rotateZ({radians:e,origin:t=DS}){return vY(this,this,t,e),this.check()}transform(e){return this.transformAsPoint(e)}transformAsPoint(e){return SL(this,this,e),this.check()}transformAsVector(e){return TL(this,this,e),this.check()}transformByMatrix3(e){return gY(this,this,e),this.check()}transformByMatrix2(e){return sY(this,this,e),this.check()}transformByQuaternion(e){return mY(this,this,e),this.check()}}class EY extends wL{toString(){let e="[";if(ys.printRowMajor){e+="row-major:";for(let t=0;t<this.RANK;++t)for(let r=0;r<this.RANK;++r)e+=" ".concat(this[r*this.RANK+t])}else{e+="column-major:";for(let t=0;t<this.ELEMENTS;++t)e+=" ".concat(this[t])}return e+="]",e}getElementIndex(e,t){return t*this.RANK+e}getElement(e,t){return this[t*this.RANK+e]}setElement(e,t,r){return this[t*this.RANK+e]=_s(r),this}getColumn(e,t=new Array(this.RANK).fill(-0)){const r=e*this.RANK;for(let i=0;i<this.RANK;++i)t[i]=this[r+i];return t}setColumn(e,t){const r=e*this.RANK;for(let i=0;i<this.RANK;++i)this[r+i]=t[i];return this}}function TY(n){return n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function SY(n,e){if(n===e){var t=e[1],r=e[2],i=e[3],o=e[6],a=e[7],l=e[11];n[1]=e[4],n[2]=e[8],n[3]=e[12],n[4]=t,n[6]=e[9],n[7]=e[13],n[8]=r,n[9]=o,n[11]=e[14],n[12]=i,n[13]=a,n[14]=l}else n[0]=e[0],n[1]=e[4],n[2]=e[8],n[3]=e[12],n[4]=e[1],n[5]=e[5],n[6]=e[9],n[7]=e[13],n[8]=e[2],n[9]=e[6],n[10]=e[10],n[11]=e[14],n[12]=e[3],n[13]=e[7],n[14]=e[11],n[15]=e[15];return n}function Qb(n,e){var t=e[0],r=e[1],i=e[2],o=e[3],a=e[4],l=e[5],h=e[6],p=e[7],g=e[8],_=e[9],x=e[10],C=e[11],M=e[12],L=e[13],F=e[14],z=e[15],ee=t*l-r*a,ce=t*h-i*a,se=t*p-o*a,_e=r*h-i*l,J=r*p-o*l,pe=i*p-o*h,ue=g*L-_*M,xe=g*F-x*M,je=g*z-C*M,ne=_*F-x*L,Ee=_*z-C*L,ke=x*z-C*F,Be=ee*ke-ce*Ee+se*ne+_e*je-J*xe+pe*ue;return Be?(Be=1/Be,n[0]=(l*ke-h*Ee+p*ne)*Be,n[1]=(i*Ee-r*ke-o*ne)*Be,n[2]=(L*pe-F*J+z*_e)*Be,n[3]=(x*J-_*pe-C*_e)*Be,n[4]=(h*je-a*ke-p*xe)*Be,n[5]=(t*ke-i*je+o*xe)*Be,n[6]=(F*se-M*pe-z*ce)*Be,n[7]=(g*pe-x*se+C*ce)*Be,n[8]=(a*Ee-l*je+p*ue)*Be,n[9]=(r*je-t*Ee-o*ue)*Be,n[10]=(M*J-L*se+z*ee)*Be,n[11]=(_*se-g*J-C*ee)*Be,n[12]=(l*xe-a*ne-h*ue)*Be,n[13]=(t*ne-r*xe+i*ue)*Be,n[14]=(L*ce-M*_e-F*ee)*Be,n[15]=(g*_e-_*ce+x*ee)*Be,n):null}function CY(n){var e=n[0],t=n[1],r=n[2],i=n[3],o=n[4],a=n[5],l=n[6],h=n[7],p=n[8],g=n[9],_=n[10],x=n[11],C=n[12],M=n[13],L=n[14],F=n[15],z=e*a-t*o,ee=e*l-r*o,ce=t*l-r*a,se=p*M-g*C,_e=p*L-_*C,J=g*L-_*M,pe=e*J-t*_e+r*se,ue=o*J-a*_e+l*se,xe=p*ce-g*ee+_*z,je=C*ce-M*ee+L*z;return h*pe-i*ue+F*xe-x*je}function jc(n,e,t){var r=e[0],i=e[1],o=e[2],a=e[3],l=e[4],h=e[5],p=e[6],g=e[7],_=e[8],x=e[9],C=e[10],M=e[11],L=e[12],F=e[13],z=e[14],ee=e[15],ce=t[0],se=t[1],_e=t[2],J=t[3];return n[0]=ce*r+se*l+_e*_+J*L,n[1]=ce*i+se*h+_e*x+J*F,n[2]=ce*o+se*p+_e*C+J*z,n[3]=ce*a+se*g+_e*M+J*ee,ce=t[4],se=t[5],_e=t[6],J=t[7],n[4]=ce*r+se*l+_e*_+J*L,n[5]=ce*i+se*h+_e*x+J*F,n[6]=ce*o+se*p+_e*C+J*z,n[7]=ce*a+se*g+_e*M+J*ee,ce=t[8],se=t[9],_e=t[10],J=t[11],n[8]=ce*r+se*l+_e*_+J*L,n[9]=ce*i+se*h+_e*x+J*F,n[10]=ce*o+se*p+_e*C+J*z,n[11]=ce*a+se*g+_e*M+J*ee,ce=t[12],se=t[13],_e=t[14],J=t[15],n[12]=ce*r+se*l+_e*_+J*L,n[13]=ce*i+se*h+_e*x+J*F,n[14]=ce*o+se*p+_e*C+J*z,n[15]=ce*a+se*g+_e*M+J*ee,n}function $y(n,e,t){var r=t[0],i=t[1],o=t[2],a,l,h,p,g,_,x,C,M,L,F,z;return e===n?(n[12]=e[0]*r+e[4]*i+e[8]*o+e[12],n[13]=e[1]*r+e[5]*i+e[9]*o+e[13],n[14]=e[2]*r+e[6]*i+e[10]*o+e[14],n[15]=e[3]*r+e[7]*i+e[11]*o+e[15]):(a=e[0],l=e[1],h=e[2],p=e[3],g=e[4],_=e[5],x=e[6],C=e[7],M=e[8],L=e[9],F=e[10],z=e[11],n[0]=a,n[1]=l,n[2]=h,n[3]=p,n[4]=g,n[5]=_,n[6]=x,n[7]=C,n[8]=M,n[9]=L,n[10]=F,n[11]=z,n[12]=a*r+g*i+M*o+e[12],n[13]=l*r+_*i+L*o+e[13],n[14]=h*r+x*i+F*o+e[14],n[15]=p*r+C*i+z*o+e[15]),n}function Jb(n,e,t){var r=t[0],i=t[1],o=t[2];return n[0]=e[0]*r,n[1]=e[1]*r,n[2]=e[2]*r,n[3]=e[3]*r,n[4]=e[4]*i,n[5]=e[5]*i,n[6]=e[6]*i,n[7]=e[7]*i,n[8]=e[8]*o,n[9]=e[9]*o,n[10]=e[10]*o,n[11]=e[11]*o,n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15],n}function AY(n,e,t,r){var i=r[0],o=r[1],a=r[2],l=Math.sqrt(i*i+o*o+a*a),h,p,g,_,x,C,M,L,F,z,ee,ce,se,_e,J,pe,ue,xe,je,ne,Ee,ke,Be,Ze;return l<co?null:(l=1/l,i*=l,o*=l,a*=l,h=Math.sin(t),p=Math.cos(t),g=1-p,_=e[0],x=e[1],C=e[2],M=e[3],L=e[4],F=e[5],z=e[6],ee=e[7],ce=e[8],se=e[9],_e=e[10],J=e[11],pe=i*i*g+p,ue=o*i*g+a*h,xe=a*i*g-o*h,je=i*o*g-a*h,ne=o*o*g+p,Ee=a*o*g+i*h,ke=i*a*g+o*h,Be=o*a*g-i*h,Ze=a*a*g+p,n[0]=_*pe+L*ue+ce*xe,n[1]=x*pe+F*ue+se*xe,n[2]=C*pe+z*ue+_e*xe,n[3]=M*pe+ee*ue+J*xe,n[4]=_*je+L*ne+ce*Ee,n[5]=x*je+F*ne+se*Ee,n[6]=C*je+z*ne+_e*Ee,n[7]=M*je+ee*ne+J*Ee,n[8]=_*ke+L*Be+ce*Ze,n[9]=x*ke+F*Be+se*Ze,n[10]=C*ke+z*Be+_e*Ze,n[11]=M*ke+ee*Be+J*Ze,e!==n&&(n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n)}function CL(n,e,t){var r=Math.sin(t),i=Math.cos(t),o=e[4],a=e[5],l=e[6],h=e[7],p=e[8],g=e[9],_=e[10],x=e[11];return e!==n&&(n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[3],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n[4]=o*i+p*r,n[5]=a*i+g*r,n[6]=l*i+_*r,n[7]=h*i+x*r,n[8]=p*i-o*r,n[9]=g*i-a*r,n[10]=_*i-l*r,n[11]=x*i-h*r,n}function IY(n,e,t){var r=Math.sin(t),i=Math.cos(t),o=e[0],a=e[1],l=e[2],h=e[3],p=e[8],g=e[9],_=e[10],x=e[11];return e!==n&&(n[4]=e[4],n[5]=e[5],n[6]=e[6],n[7]=e[7],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n[0]=o*i-p*r,n[1]=a*i-g*r,n[2]=l*i-_*r,n[3]=h*i-x*r,n[8]=o*r+p*i,n[9]=a*r+g*i,n[10]=l*r+_*i,n[11]=h*r+x*i,n}function AL(n,e,t){var r=Math.sin(t),i=Math.cos(t),o=e[0],a=e[1],l=e[2],h=e[3],p=e[4],g=e[5],_=e[6],x=e[7];return e!==n&&(n[8]=e[8],n[9]=e[9],n[10]=e[10],n[11]=e[11],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n[0]=o*i+p*r,n[1]=a*i+g*r,n[2]=l*i+_*r,n[3]=h*i+x*r,n[4]=p*i-o*r,n[5]=g*i-a*r,n[6]=_*i-l*r,n[7]=x*i-h*r,n}function PY(n,e){var t=e[0],r=e[1],i=e[2],o=e[3],a=t+t,l=r+r,h=i+i,p=t*a,g=r*a,_=r*l,x=i*a,C=i*l,M=i*h,L=o*a,F=o*l,z=o*h;return n[0]=1-_-M,n[1]=g+z,n[2]=x-F,n[3]=0,n[4]=g-z,n[5]=1-p-M,n[6]=C+L,n[7]=0,n[8]=x+F,n[9]=C-L,n[10]=1-p-_,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function MY(n,e,t,r,i,o,a){var l=1/(t-e),h=1/(i-r),p=1/(o-a);return n[0]=o*2*l,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=o*2*h,n[6]=0,n[7]=0,n[8]=(t+e)*l,n[9]=(i+r)*h,n[10]=(a+o)*p,n[11]=-1,n[12]=0,n[13]=0,n[14]=a*o*2*p,n[15]=0,n}function RY(n,e,t,r,i){var o=1/Math.tan(e/2);if(n[0]=o/t,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=o,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=-1,n[12]=0,n[13]=0,n[15]=0,i!=null&&i!==1/0){var a=1/(r-i);n[10]=(i+r)*a,n[14]=2*i*r*a}else n[10]=-1,n[14]=-2*r;return n}var IL=RY;function kY(n,e,t,r,i,o,a){var l=1/(e-t),h=1/(r-i),p=1/(o-a);return n[0]=-2*l,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=-2*h,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=2*p,n[11]=0,n[12]=(e+t)*l,n[13]=(i+r)*h,n[14]=(a+o)*p,n[15]=1,n}var OY=kY;function LY(n,e,t,r){var i,o,a,l,h,p,g,_,x,C,M=e[0],L=e[1],F=e[2],z=r[0],ee=r[1],ce=r[2],se=t[0],_e=t[1],J=t[2];return Math.abs(M-se)<co&&Math.abs(L-_e)<co&&Math.abs(F-J)<co?TY(n):(g=M-se,_=L-_e,x=F-J,C=1/Math.sqrt(g*g+_*_+x*x),g*=C,_*=C,x*=C,i=ee*x-ce*_,o=ce*g-z*x,a=z*_-ee*g,C=Math.sqrt(i*i+o*o+a*a),C?(C=1/C,i*=C,o*=C,a*=C):(i=0,o=0,a=0),l=_*a-x*o,h=x*i-g*a,p=g*o-_*i,C=Math.sqrt(l*l+h*h+p*p),C?(C=1/C,l*=C,h*=C,p*=C):(l=0,h=0,p=0),n[0]=i,n[1]=l,n[2]=g,n[3]=0,n[4]=o,n[5]=h,n[6]=_,n[7]=0,n[8]=a,n[9]=p,n[10]=x,n[11]=0,n[12]=-(i*M+o*L+a*F),n[13]=-(l*M+h*L+p*F),n[14]=-(g*M+_*L+x*F),n[15]=1,n)}function PL(n,e){var t=n[0],r=n[1],i=n[2],o=n[3],a=n[4],l=n[5],h=n[6],p=n[7],g=n[8],_=n[9],x=n[10],C=n[11],M=n[12],L=n[13],F=n[14],z=n[15],ee=e[0],ce=e[1],se=e[2],_e=e[3],J=e[4],pe=e[5],ue=e[6],xe=e[7],je=e[8],ne=e[9],Ee=e[10],ke=e[11],Be=e[12],Ze=e[13],at=e[14],Re=e[15];return Math.abs(t-ee)<=co*Math.max(1,Math.abs(t),Math.abs(ee))&&Math.abs(r-ce)<=co*Math.max(1,Math.abs(r),Math.abs(ce))&&Math.abs(i-se)<=co*Math.max(1,Math.abs(i),Math.abs(se))&&Math.abs(o-_e)<=co*Math.max(1,Math.abs(o),Math.abs(_e))&&Math.abs(a-J)<=co*Math.max(1,Math.abs(a),Math.abs(J))&&Math.abs(l-pe)<=co*Math.max(1,Math.abs(l),Math.abs(pe))&&Math.abs(h-ue)<=co*Math.max(1,Math.abs(h),Math.abs(ue))&&Math.abs(p-xe)<=co*Math.max(1,Math.abs(p),Math.abs(xe))&&Math.abs(g-je)<=co*Math.max(1,Math.abs(g),Math.abs(je))&&Math.abs(_-ne)<=co*Math.max(1,Math.abs(_),Math.abs(ne))&&Math.abs(x-Ee)<=co*Math.max(1,Math.abs(x),Math.abs(Ee))&&Math.abs(C-ke)<=co*Math.max(1,Math.abs(C),Math.abs(ke))&&Math.abs(M-Be)<=co*Math.max(1,Math.abs(M),Math.abs(Be))&&Math.abs(L-Ze)<=co*Math.max(1,Math.abs(L),Math.abs(Ze))&&Math.abs(F-at)<=co*Math.max(1,Math.abs(F),Math.abs(at))&&Math.abs(z-Re)<=co*Math.max(1,Math.abs(z),Math.abs(Re))}function NY(){var n=new Mp(4);return Mp!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0,n[3]=0),n}function DY(n,e,t){return n[0]=e[0]*t,n[1]=e[1]*t,n[2]=e[2]*t,n[3]=e[3]*t,n}function Wy(n,e,t){var r=e[0],i=e[1],o=e[2],a=e[3];return n[0]=t[0]*r+t[4]*i+t[8]*o+t[12]*a,n[1]=t[1]*r+t[5]*i+t[9]*o+t[13]*a,n[2]=t[2]*r+t[6]*i+t[10]*o+t[14]*a,n[3]=t[3]*r+t[7]*i+t[11]*o+t[15]*a,n}(function(){var n=NY();return function(e,t,r,i,o,a){var l,h;for(t||(t=4),r||(r=0),i?h=Math.min(i*t+r,e.length):h=e.length,l=r;l<h;l+=t)n[0]=e[l],n[1]=e[l+1],n[2]=e[l+2],n[3]=e[l+3],o(n,n,a),e[l]=n[0],e[l+1]=n[1],e[l+2]=n[2],e[l+3]=n[3];return e}})();var FS;(function(n){n[n.COL0ROW0=0]="COL0ROW0",n[n.COL0ROW1=1]="COL0ROW1",n[n.COL0ROW2=2]="COL0ROW2",n[n.COL0ROW3=3]="COL0ROW3",n[n.COL1ROW0=4]="COL1ROW0",n[n.COL1ROW1=5]="COL1ROW1",n[n.COL1ROW2=6]="COL1ROW2",n[n.COL1ROW3=7]="COL1ROW3",n[n.COL2ROW0=8]="COL2ROW0",n[n.COL2ROW1=9]="COL2ROW1",n[n.COL2ROW2=10]="COL2ROW2",n[n.COL2ROW3=11]="COL2ROW3",n[n.COL3ROW0=12]="COL3ROW0",n[n.COL3ROW1=13]="COL3ROW1",n[n.COL3ROW2=14]="COL3ROW2",n[n.COL3ROW3=15]="COL3ROW3"})(FS||(FS={}));const FY=45*Math.PI/180,BY=1,BS=.1,US=500,UY=Object.freeze([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);class Vc extends EY{static get IDENTITY(){return jY()}static get ZERO(){return zY()}get ELEMENTS(){return 16}get RANK(){return 4}get INDICES(){return FS}constructor(e){super(-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(e)?this.copy(e):this.identity()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this[4]=e[4],this[5]=e[5],this[6]=e[6],this[7]=e[7],this[8]=e[8],this[9]=e[9],this[10]=e[10],this[11]=e[11],this[12]=e[12],this[13]=e[13],this[14]=e[14],this[15]=e[15],this.check()}set(e,t,r,i,o,a,l,h,p,g,_,x,C,M,L,F){return this[0]=e,this[1]=t,this[2]=r,this[3]=i,this[4]=o,this[5]=a,this[6]=l,this[7]=h,this[8]=p,this[9]=g,this[10]=_,this[11]=x,this[12]=C,this[13]=M,this[14]=L,this[15]=F,this.check()}setRowMajor(e,t,r,i,o,a,l,h,p,g,_,x,C,M,L,F){return this[0]=e,this[1]=o,this[2]=p,this[3]=C,this[4]=t,this[5]=a,this[6]=g,this[7]=M,this[8]=r,this[9]=l,this[10]=_,this[11]=L,this[12]=i,this[13]=h,this[14]=x,this[15]=F,this.check()}toRowMajor(e){return e[0]=this[0],e[1]=this[4],e[2]=this[8],e[3]=this[12],e[4]=this[1],e[5]=this[5],e[6]=this[9],e[7]=this[13],e[8]=this[2],e[9]=this[6],e[10]=this[10],e[11]=this[14],e[12]=this[3],e[13]=this[7],e[14]=this[11],e[15]=this[15],e}identity(){return this.copy(UY)}fromObject(e){return this.check()}fromQuaternion(e){return PY(this,e),this.check()}frustum(e){const{left:t,right:r,bottom:i,top:o,near:a=BS,far:l=US}=e;return l===1/0?VY(this,t,r,i,o,a):MY(this,t,r,i,o,a,l),this.check()}lookAt(e){const{eye:t,center:r=[0,0,0],up:i=[0,1,0]}=e;return LY(this,t,r,i),this.check()}ortho(e){const{left:t,right:r,bottom:i,top:o,near:a=BS,far:l=US}=e;return OY(this,t,r,i,o,a,l),this.check()}orthographic(e){const{fovy:t=FY,aspect:r=BY,focalDistance:i=1,near:o=BS,far:a=US}=e;ML(t);const l=t/2,h=i*Math.tan(l),p=h*r;return this.ortho({left:-p,right:p,bottom:-h,top:h,near:o,far:a})}perspective(e){const{fovy:t=45*Math.PI/180,aspect:r=1,near:i=.1,far:o=500}=e;return ML(t),IL(this,t,r,i,o),this.check()}determinant(){return CY(this)}getScale(e=[-0,-0,-0]){return e[0]=Math.sqrt(this[0]*this[0]+this[1]*this[1]+this[2]*this[2]),e[1]=Math.sqrt(this[4]*this[4]+this[5]*this[5]+this[6]*this[6]),e[2]=Math.sqrt(this[8]*this[8]+this[9]*this[9]+this[10]*this[10]),e}getTranslation(e=[-0,-0,-0]){return e[0]=this[12],e[1]=this[13],e[2]=this[14],e}getRotation(e,t){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0],t=t||[-0,-0,-0];const r=this.getScale(t),i=1/r[0],o=1/r[1],a=1/r[2];return e[0]=this[0]*i,e[1]=this[1]*o,e[2]=this[2]*a,e[3]=0,e[4]=this[4]*i,e[5]=this[5]*o,e[6]=this[6]*a,e[7]=0,e[8]=this[8]*i,e[9]=this[9]*o,e[10]=this[10]*a,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}getRotationMatrix3(e,t){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0],t=t||[-0,-0,-0];const r=this.getScale(t),i=1/r[0],o=1/r[1],a=1/r[2];return e[0]=this[0]*i,e[1]=this[1]*o,e[2]=this[2]*a,e[3]=this[4]*i,e[4]=this[5]*o,e[5]=this[6]*a,e[6]=this[8]*i,e[7]=this[9]*o,e[8]=this[10]*a,e}transpose(){return SY(this,this),this.check()}invert(){return Qb(this,this),this.check()}multiplyLeft(e){return jc(this,e,this),this.check()}multiplyRight(e){return jc(this,this,e),this.check()}rotateX(e){return CL(this,this,e),this.check()}rotateY(e){return IY(this,this,e),this.check()}rotateZ(e){return AL(this,this,e),this.check()}rotateXYZ(e){return this.rotateX(e[0]).rotateY(e[1]).rotateZ(e[2])}rotateAxis(e,t){return AY(this,this,e,t),this.check()}scale(e){return Jb(this,this,Array.isArray(e)?e:[e,e,e]),this.check()}translate(e){return $y(this,this,e),this.check()}transform(e,t){return e.length===4?(t=Wy(t||[-0,-0,-0,-0],e,this),NS(t,4),t):this.transformAsPoint(e,t)}transformAsPoint(e,t){const{length:r}=e;let i;switch(r){case 2:i=oY(t||[-0,-0],e,this);break;case 3:i=SL(t||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return NS(i,e.length),i}transformAsVector(e,t){let r;switch(e.length){case 2:r=aY(t||[-0,-0],e,this);break;case 3:r=TL(t||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return NS(r,e.length),r}transformPoint(e,t){return this.transformAsPoint(e,t)}transformVector(e,t){return this.transformAsPoint(e,t)}transformDirection(e,t){return this.transformAsVector(e,t)}makeRotationX(e){return this.identity().rotateX(e)}makeTranslation(e,t,r){return this.identity().translate([e,t,r])}}let e1,t1;function zY(){return e1||(e1=new Vc([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),Object.freeze(e1)),e1}function jY(){return t1||(t1=new Vc,Object.freeze(t1)),t1}function ML(n){if(n>Math.PI*2)throw Error("expected radians")}function VY(n,e,t,r,i,o){const a=2*o/(t-e),l=2*o/(i-r),h=(t+e)/(t-e),p=(i+r)/(i-r),g=-1,_=-1,x=-2*o;return n[0]=a,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=l,n[6]=0,n[7]=0,n[8]=h,n[9]=p,n[10]=g,n[11]=_,n[12]=0,n[13]=0,n[14]=x,n[15]=0,n}const HY={pickingSelectedColor:null,pickingHighlightColor:new Uint8Array([0,255,255,255]),pickingActive:!1,pickingAttribute:!1};function GY(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:HY;const e={};if(n.pickingSelectedColor!==void 0)if(!n.pickingSelectedColor)e.picking_uSelectedColorValid=0;else{const t=n.pickingSelectedColor.slice(0,3);e.picking_uSelectedColorValid=1,e.picking_uSelectedColor=t}if(n.pickingHighlightColor){const t=Array.from(n.pickingHighlightColor,r=>r/255);Number.isFinite(t[3])||(t[3]=1),e.picking_uHighlightColor=t}return n.pickingActive!==void 0&&(e.picking_uActive=!!n.pickingActive,e.picking_uAttribute=!!n.pickingAttribute),e}const qY={name:"picking",vs:`uniform bool picking_uActive;
uniform bool picking_uAttribute;
uniform vec3 picking_uSelectedColor;
uniform bool picking_uSelectedColorValid;

out vec4 picking_vRGBcolor_Avalid;

const float COLOR_SCALE = 1. / 255.;

bool picking_isColorValid(vec3 color) {
  return dot(color, vec3(1.0)) > 0.001;
}

bool isVertexPicked(vec3 vertexColor) {
  return
    picking_uSelectedColorValid &&
    !picking_isColorValid(abs(vertexColor - picking_uSelectedColor));
}

void picking_setPickingColor(vec3 pickingColor) {
  if (picking_uActive) {
    picking_vRGBcolor_Avalid.a = float(picking_isColorValid(pickingColor));

    if (!picking_uAttribute) {
      picking_vRGBcolor_Avalid.rgb = pickingColor * COLOR_SCALE;
    }
  } else {
    picking_vRGBcolor_Avalid.a = float(isVertexPicked(pickingColor));
  }
}

void picking_setPickingAttribute(float value) {
  if (picking_uAttribute) {
    picking_vRGBcolor_Avalid.r = value;
  }
}
void picking_setPickingAttribute(vec2 value) {
  if (picking_uAttribute) {
    picking_vRGBcolor_Avalid.rg = value;
  }
}
void picking_setPickingAttribute(vec3 value) {
  if (picking_uAttribute) {
    picking_vRGBcolor_Avalid.rgb = value;
  }
}
`,fs:`uniform bool picking_uActive;
uniform vec3 picking_uSelectedColor;
uniform vec4 picking_uHighlightColor;

in vec4 picking_vRGBcolor_Avalid;
vec4 picking_filterHighlightColor(vec4 color) {
  if (picking_uActive) {
    return color;
  }
  bool selected = bool(picking_vRGBcolor_Avalid.a);

  if (selected) {
    float highLightAlpha = picking_uHighlightColor.a;
    float blendedAlpha = highLightAlpha + color.a * (1.0 - highLightAlpha);
    float highLightRatio = highLightAlpha / blendedAlpha;

    vec3 blendedRGB = mix(color.rgb, picking_uHighlightColor.rgb, highLightRatio);
    return vec4(blendedRGB, blendedAlpha);
  } else {
    return color;
  }
}
vec4 picking_filterPickingColor(vec4 color) {
  if (picking_uActive) {
    if (picking_vRGBcolor_Avalid.a == 0.0) {
      discard;
    }
    return picking_vRGBcolor_Avalid;
  }
  return color;
}
vec4 picking_filterColor(vec4 color) {
  vec4 highightColor = picking_filterHighlightColor(color);
  return picking_filterPickingColor(highightColor);
}

`,getUniforms:GY},$Y={name:"transform",vs:`attribute float transform_elementID;
vec2 transform_getPixelSizeHalf(vec2 size) {
  return vec2(1.) / (2. * size);
}

vec2 transform_getPixelIndices(vec2 texSize, vec2 pixelSizeHalf) {
  float yIndex = floor((transform_elementID / texSize[0]) + pixelSizeHalf[1]);
  float xIndex = transform_elementID - (yIndex * texSize[0]);
  return vec2(xIndex, yIndex);
}
vec2 transform_getTexCoord(vec2 size) {
  vec2 pixelSizeHalf = transform_getPixelSizeHalf(size);
  vec2 indices = transform_getPixelIndices(size, pixelSizeHalf);
  vec2 coord = indices / size + pixelSizeHalf;
  return coord;
}
vec2 transform_getPos(vec2 size) {
  vec2 texCoord = transform_getTexCoord(size);
  vec2 pos = (texCoord * (2.0, 2.0)) - (1., 1.);
  return pos;
}
vec4 transform_getInput(sampler2D texSampler, vec2 size) {
  vec2 texCoord = transform_getTexCoord(size);
  vec4 textureColor = texture2D(texSampler, texCoord);
  return textureColor;
}
`,fs:null};class Yy{static getDefaultProgramManager(e){return e.luma=e.luma||{},e.luma.defaultProgramManager=e.luma.defaultProgramManager||new Yy(e),e.luma.defaultProgramManager}constructor(e){this.gl=e,this._programCache={},this._getUniforms={},this._registeredModules={},this._hookFunctions=[],this._defaultModules=[],this._hashes={},this._hashCounter=0,this.stateHash=0,this._useCounts={}}addDefaultModule(e){this._defaultModules.find(t=>t.name===e.name)||this._defaultModules.push(e),this.stateHash++}removeDefaultModule(e){const t=typeof e=="string"?e:e.name;this._defaultModules=this._defaultModules.filter(r=>r.name!==t),this.stateHash++}addShaderHook(e,t){t&&(e=Object.assign(t,{hook:e})),this._hookFunctions.push(e),this.stateHash++}get(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{vs:t="",fs:r="",defines:i={},inject:o={},varyings:a=[],bufferMode:l=35981,transpileToGLSL100:h=!1}=e,p=this._getModuleList(e.modules),g=this._getHash(t),_=this._getHash(r),x=p.map(ce=>this._getHash(ce.name)).sort(),C=a.map(ce=>this._getHash(ce)),M=Object.keys(i).sort(),L=Object.keys(o).sort(),F=[],z=[];for(const ce of M)F.push(this._getHash(ce)),F.push(this._getHash(i[ce]));for(const ce of L)z.push(this._getHash(ce)),z.push(this._getHash(o[ce]));const ee="".concat(g,"/").concat(_,"D").concat(F.join("/"),"M").concat(x.join("/"),"I").concat(z.join("/"),"V").concat(C.join("/"),"H").concat(this.stateHash,"B").concat(l).concat(h?"T":"");if(!this._programCache[ee]){const ce=BW(this.gl,{vs:t,fs:r,modules:p,inject:o,defines:i,hookFunctions:this._hookFunctions,transpileToGLSL100:h});this._programCache[ee]=new JO(this.gl,{hash:ee,vs:ce.vs,fs:ce.fs,varyings:a,bufferMode:l}),this._getUniforms[ee]=ce.getUniforms||(se=>{}),this._useCounts[ee]=0}return this._useCounts[ee]++,this._programCache[ee]}getUniforms(e){return this._getUniforms[e.hash]||null}release(e){const t=e.hash;this._useCounts[t]--,this._useCounts[t]===0&&(this._programCache[t].delete(),delete this._programCache[t],delete this._getUniforms[t],delete this._useCounts[t])}_getHash(e){return this._hashes[e]===void 0&&(this._hashes[e]=this._hashCounter++),this._hashes[e]}_getModuleList(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];const t=new Array(this._defaultModules.length+e.length),r={};let i=0;for(let o=0,a=this._defaultModules.length;o<a;++o){const l=this._defaultModules[o],h=l.name;t[i++]=l,r[h]=!0}for(let o=0,a=e.length;o<a;++o){const l=e[o],h=l.name;r[h]||(t[i++]=l,r[h]=!0)}return t.length=i,t}}const WY={POSITION:"positions",NORMAL:"normals",COLOR_0:"colors",TEXCOORD_0:"texCoords",TEXCOORD_1:"texCoords1",TEXCOORD_2:"texCoords2"};function YY(n,e,t){const r={};let i=e.indices;for(const o in e.attributes){const a=e.attributes[o],l=KY(o,t);if(o==="indices")i=a;else if(a.constant)r[l]=a.value;else{const h=a.value,p={...a};delete p.value,r[l]=[new ni(n,h),p],ZY(o,p)}}if(i){const o=i.value||i;Xt(o instanceof Uint16Array||o instanceof Uint32Array,'attribute array for "indices" must be of integer type');const a={size:1,isIndexed:i.isIndexed===void 0?!0:i.isIndexed};r.indices=[new ni(n,{data:o,target:34963}),a]}return r}function KY(n,e){const{attributeMap:t=WY}=e||{};return t&&t[n]||n}function ZY(n,e){let t;switch(n){case"texCoords":case"texCoord1":case"texCoord2":case"texCoord3":t="uvs";break;case"vertices":case"positions":case"normals":case"pickingColors":t="vectors";break}switch(t){case"vectors":e.size=e.size||3;break;case"uvs":e.size=e.size||2;break}Xt(Number.isFinite(e.size),"attribute ".concat(n," needs size"))}const Rp=2,XY=1e4,QY="Model needs drawMode and vertexCount",RL=()=>{},JY={};class Ad{constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{id:r=Hu("model")}=t;Xt(Fb(e)),this.id=r,this.gl=e,this.id=t.id||Hu("Model"),this.lastLogTime=0,this.animated=!1,this.initialize(t)}initialize(e){this.props={},this.programManager=e.programManager||Yy.getDefaultProgramManager(this.gl),this._programManagerState=-1,this._managedProgram=!1;const{program:t=null,vs:r,fs:i,modules:o,defines:a,inject:l,varyings:h,bufferMode:p,transpileToGLSL100:g}=e;this.programProps={program:t,vs:r,fs:i,modules:o,defines:a,inject:l,varyings:h,bufferMode:p,transpileToGLSL100:g},this.program=null,this.vertexArray=null,this._programDirty=!0,this.userData={},this.needsRedraw=!0,this._attributes={},this.attributes={},this.uniforms={},this.pickable=!0,this._checkProgram(),this.setUniforms(Object.assign({},this.getModuleUniforms(e.moduleSettings))),this.drawMode=e.drawMode!==void 0?e.drawMode:4,this.vertexCount=e.vertexCount||0,this.geometryBuffers={},this.isInstanced=e.isInstanced||e.instanced||e.instanceCount>0,this._setModelProps(e),this.geometry={},Xt(this.drawMode!==void 0&&Number.isFinite(this.vertexCount),QY)}setProps(e){this._setModelProps(e)}delete(){for(const e in this._attributes)this._attributes[e]!==this.attributes[e]&&this._attributes[e].delete();this._managedProgram&&(this.programManager.release(this.program),this._managedProgram=!1),this.vertexArray.delete(),this._deleteGeometryBuffers()}getDrawMode(){return this.drawMode}getVertexCount(){return this.vertexCount}getInstanceCount(){return this.instanceCount}getAttributes(){return this.attributes}getProgram(){return this.program}setProgram(e){const{program:t,vs:r,fs:i,modules:o,defines:a,inject:l,varyings:h,bufferMode:p,transpileToGLSL100:g}=e;this.programProps={program:t,vs:r,fs:i,modules:o,defines:a,inject:l,varyings:h,bufferMode:p,transpileToGLSL100:g},this._programDirty=!0}getUniforms(){return this.uniforms}setDrawMode(e){return this.drawMode=e,this}setVertexCount(e){return Xt(Number.isFinite(e)),this.vertexCount=e,this}setInstanceCount(e){return Xt(Number.isFinite(e)),this.instanceCount=e,this}setGeometry(e){return this.drawMode=e.drawMode,this.vertexCount=e.getVertexCount(),this._deleteGeometryBuffers(),this.geometryBuffers=YY(this.gl,e),this.vertexArray.setAttributes(this.geometryBuffers),this}setAttributes(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(Sp(e))return this;const t={};for(const r in e){const i=e[r];t[r]=i.getValue?i.getValue():i}return this.vertexArray.setAttributes(t),this}setUniforms(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return Object.assign(this.uniforms,e),this}getModuleUniforms(e){this._checkProgram();const t=this.programManager.getUniforms(this.program);return t?t(e):{}}updateModuleSettings(e){const t=this.getModuleUniforms(e||{});return this.setUniforms(t)}clear(e){return wS(this.program.gl,e),this}draw(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._checkProgram();const{moduleSettings:t=null,framebuffer:r,uniforms:i={},attributes:o={},transformFeedback:a=this.transformFeedback,parameters:l={},vertexArray:h=this.vertexArray}=e;this.setAttributes(o),this.updateModuleSettings(t),this.setUniforms(i);let p;Tn.priority>=Rp&&(p=this._logDrawCallStart(Rp));const g=this.vertexArray.getDrawParams(),{isIndexed:_=g.isIndexed,indexType:x=g.indexType,indexOffset:C=g.indexOffset,vertexArrayInstanced:M=g.isInstanced}=this.props;M&&!this.isInstanced&&Tn.warn("Found instanced attributes on non-instanced model",this.id)();const{isInstanced:L,instanceCount:F}=this,{onBeforeRender:z=RL,onAfterRender:ee=RL}=this.props;z(),this.program.setUniforms(this.uniforms);const ce=this.program.draw(Object.assign(JY,e,{logPriority:p,uniforms:null,framebuffer:r,parameters:l,drawMode:this.getDrawMode(),vertexCount:this.getVertexCount(),vertexArray:h,transformFeedback:a,isIndexed:_,indexType:x,isInstanced:L,instanceCount:F,offset:_?C:0}));return ee(),Tn.priority>=Rp&&this._logDrawCallEnd(p,h,r),ce}transform(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{discard:t=!0,feedbackBuffers:r,unbindModels:i=[]}=e;let{parameters:o}=e;r&&this._setFeedbackBuffers(r),t&&(o=Object.assign({},o,{35977:t})),i.forEach(a=>a.vertexArray.unbindBuffers());try{this.draw(Object.assign({},e,{parameters:o}))}finally{i.forEach(a=>a.vertexArray.bindBuffers())}return this}render(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return Tn.warn("Model.render() is deprecated. Use Model.setUniforms() and Model.draw()")(),this.setUniforms(e).draw()}_setModelProps(e){Object.assign(this.props,e),"uniforms"in e&&this.setUniforms(e.uniforms),"pickable"in e&&(this.pickable=e.pickable),"instanceCount"in e&&(this.instanceCount=e.instanceCount),"geometry"in e&&this.setGeometry(e.geometry),"attributes"in e&&this.setAttributes(e.attributes),"_feedbackBuffers"in e&&this._setFeedbackBuffers(e._feedbackBuffers)}_checkProgram(){if(!(this._programDirty||this.programManager.stateHash!==this._programManagerState))return;let{program:t}=this.programProps;if(t)this._managedProgram=!1;else{const{vs:r,fs:i,modules:o,inject:a,defines:l,varyings:h,bufferMode:p,transpileToGLSL100:g}=this.programProps;t=this.programManager.get({vs:r,fs:i,modules:o,inject:a,defines:l,varyings:h,bufferMode:p,transpileToGLSL100:g}),this.program&&this._managedProgram&&this.programManager.release(this.program),this._programManagerState=this.programManager.stateHash,this._managedProgram=!0}Xt(t instanceof JO,"Model needs a program"),this._programDirty=!1,t!==this.program&&(this.program=t,this.vertexArray?this.vertexArray.setProps({program:this.program,attributes:this.vertexArray.attributes}):this.vertexArray=new J$(this.gl,{program:this.program}),this.setUniforms(Object.assign({},this.getModuleUniforms())))}_deleteGeometryBuffers(){for(const e in this.geometryBuffers){const t=this.geometryBuffers[e][0]||this.geometryBuffers[e];t instanceof ni&&t.delete()}}_setAnimationProps(e){this.animated&&Xt(e,"Model.draw(): animated uniforms but no animationProps")}_setFeedbackBuffers(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(Sp(e))return this;const{gl:t}=this.program;return this.transformFeedback=this.transformFeedback||new eL(t,{program:this.program}),this.transformFeedback.setBuffers(e),this}_logDrawCallStart(e){const t=e>3?0:XY;if(!(Date.now()-this.lastLogTime<t))return this.lastLogTime=Date.now(),Tn.group(Rp,">>> DRAWING MODEL ".concat(this.id),{collapsed:Tn.level<=2})(),e}_logDrawCallEnd(e,t,r,i){if(e===void 0)return;const o=nW({vertexArray:t,header:"".concat(this.id," attributes"),attributes:this._attributes}),{table:a,unusedTable:l,unusedCount:h}=tL({header:"".concat(this.id," uniforms"),program:this.program,uniforms:Object.assign({},this.program.uniforms,r)}),{table:p,count:g}=tL({header:"".concat(this.id," uniforms"),program:this.program,uniforms:Object.assign({},this.program.uniforms,r),undefinedOnly:!0});g>0&&Tn.log("MISSING UNIFORMS",Object.keys(p))(),h>0&&Tn.log("UNUSED UNIFORMS",Object.keys(l))();const _=iW(this.vertexArray.configuration);Tn.table(e,o)(),Tn.table(e,a)(),Tn.table(e+1,_)(),i&&i.log({logLevel:Rp,message:"Rendered to ".concat(i.id)}),Tn.groupEnd(Rp)()}}class eK{constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.gl=e,this.currentIndex=0,this.feedbackMap={},this.varyings=null,this.bindings=[],this.resources={},this._initialize(t),Object.seal(this)}setupResources(e){for(const t of this.bindings)this._setupTransformFeedback(t,e)}updateModelProps(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{varyings:t}=this;return t.length>0&&(e=Object.assign({},e,{varyings:t})),e}getDrawOptions(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const t=this.bindings[this.currentIndex],{sourceBuffers:r,transformFeedback:i}=t;return{attributes:Object.assign({},r,e.attributes),transformFeedback:i}}swap(){return this.feedbackMap?(this.currentIndex=this._getNextIndex(),!0):!1}update(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._setupBuffers(e)}getBuffer(e){const{feedbackBuffers:t}=this.bindings[this.currentIndex],r=e?t[e]:null;return r?r instanceof ni?r:r.buffer:null}getData(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{varyingName:t}=e,r=this.getBuffer(t);return r?r.getData():null}delete(){for(const e in this.resources)this.resources[e].delete()}_initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._setupBuffers(e),this.varyings=e.varyings||Object.keys(this.bindings[this.currentIndex].feedbackBuffers),this.varyings.length>0&&Xt(yr(this.gl))}_getFeedbackBuffers(e){const{sourceBuffers:t={}}=e,r={};if(this.bindings[this.currentIndex]&&Object.assign(r,this.bindings[this.currentIndex].feedbackBuffers),this.feedbackMap)for(const i in this.feedbackMap){const o=this.feedbackMap[i];i in t&&(r[o]=i)}Object.assign(r,e.feedbackBuffers);for(const i in r){const o=r[i];if(typeof o=="string"){const a=t[o],{byteLength:l,usage:h,accessor:p}=a;r[i]=this._createNewBuffer(i,{byteLength:l,usage:h,accessor:p})}}return r}_setupBuffers(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{sourceBuffers:t=null}=e;Object.assign(this.feedbackMap,e.feedbackMap);const r=this._getFeedbackBuffers(e);this._updateBindings({sourceBuffers:t,feedbackBuffers:r})}_setupTransformFeedback(e,t){let{model:r}=t;const{program:i}=r;e.transformFeedback=new eL(this.gl,{program:i,buffers:e.feedbackBuffers})}_updateBindings(e){if(this.bindings[this.currentIndex]=this._updateBinding(this.bindings[this.currentIndex],e),this.feedbackMap){const{sourceBuffers:t,feedbackBuffers:r}=this._swapBuffers(this.bindings[this.currentIndex]),i=this._getNextIndex();this.bindings[i]=this._updateBinding(this.bindings[i],{sourceBuffers:t,feedbackBuffers:r})}}_updateBinding(e,t){return e?(Object.assign(e.sourceBuffers,t.sourceBuffers),Object.assign(e.feedbackBuffers,t.feedbackBuffers),e.transformFeedback&&e.transformFeedback.setBuffers(e.feedbackBuffers),e):{sourceBuffers:Object.assign({},t.sourceBuffers),feedbackBuffers:Object.assign({},t.feedbackBuffers)}}_swapBuffers(e){if(!this.feedbackMap)return null;const t=Object.assign({},e.sourceBuffers),r=Object.assign({},e.feedbackBuffers);for(const i in this.feedbackMap){const o=this.feedbackMap[i];t[i]=e.feedbackBuffers[o],r[o]=e.sourceBuffers[i],Xt(r[o]instanceof ni)}return{sourceBuffers:t,feedbackBuffers:r}}_createNewBuffer(e,t){const r=new ni(this.gl,t);return this.resources[e]&&this.resources[e].delete(),this.resources[e]=r,r}_getNextIndex(){return(this.currentIndex+1)%2}}const tK="transform_uSampler_",n1="transform_uSize_",kL="transform_position";function nK(n){let{vs:e,sourceTextureMap:t,targetTextureVarying:r,targetTexture:i}=n,a=Object.keys(t).length,l=null;const h={};let p=e,g={};if(a>0||r){const _=p.split(`
`),x=_.slice();if(_.forEach((C,M,L)=>{if(a>0){const F=sK(C,t);if(F){const{updatedLine:z,inject:ee}=F;x[M]=z,g=kS([g,ee]),Object.assign(h,F.samplerTextureMap),a--}}r&&!l&&(l=aK(C,r))}),r){Xt(i);const C="".concat(n1).concat(r),M="uniform vec2 ".concat(C,`;
`),L="     vec2 ".concat(kL," = transform_getPos(").concat(C,`);
     gl_Position = vec4(`).concat(kL,`, 0, 1.);
`);g=kS([g,{"vs:#decl":M,"vs:#main-start":L}])}p=x.join(`
`)}return{vs:p,targetTextureType:l,inject:g,samplerTextureMap:h}}function rK(n){let{sourceTextureMap:e,targetTextureVarying:t,targetTexture:r}=n;const i={};let o,a;t&&({width:o,height:a}=r,i["".concat(n1).concat(t)]=[o,a]);for(const l in e)({width:o,height:a}=e[l]),i["".concat(n1).concat(l)]=[o,a];return i}function iK(n){return _L(n,["attribute","in"])}function oK(n){const e="".concat(tK).concat(n),t="".concat(n1).concat(n),r="  uniform sampler2D ".concat(e,`;
  uniform vec2 `).concat(t,";");return{samplerName:e,sizeName:t,uniformDeclerations:r}}function aK(n,e){const t=_L(n,["varying","out"]);return t&&t.name===e?t.type:null}function sK(n,e){const t={},r=iK(n);if(!r)return null;const{type:i,name:o}=r;if(o&&e[o]){const a="// ".concat(n," => Replaced by Transform with a sampler"),{samplerName:l,sizeName:h,uniformDeclerations:p}=oK(o),g=WW(i),_="  ".concat(i," ").concat(o," = transform_getInput(").concat(l,", ").concat(h,").").concat(g,`;
`);return t[l]=o,{updatedLine:a,inject:{"vs:#decl":p,"vs:#main-start":_},samplerTextureMap:t}}return null}const cK={10241:9728,10240:9728,10242:33071,10243:33071},lK="transform_output";class uK{constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.gl=e,this.id=this.currentIndex=0,this._swapTexture=null,this.targetTextureVarying=null,this.targetTextureType=null,this.samplerTextureMap=null,this.bindings=[],this.resources={},this._initialize(t),Object.seal(this)}updateModelProps(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const t=this._processVertexShader(e);return Object.assign({},e,t)}getDrawOptions(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{sourceBuffers:t,sourceTextures:r,framebuffer:i,targetTexture:o}=this.bindings[this.currentIndex],a=Object.assign({},t,e.attributes),l=Object.assign({},e.uniforms),h=Object.assign({},e.parameters);let p=e.discard;if(this.hasSourceTextures||this.hasTargetTexture){a.transform_elementID=this.elementIDBuffer;for(const _ in this.samplerTextureMap){const x=this.samplerTextureMap[_];l[_]=r[x]}this._setSourceTextureParameters();const g=rK({sourceTextureMap:r,targetTextureVarying:this.targetTextureVarying,targetTexture:o});Object.assign(l,g)}return this.hasTargetTexture&&(p=!1,h.viewport=[0,0,i.width,i.height]),{attributes:a,framebuffer:i,uniforms:l,discard:p,parameters:h}}swap(){return this._swapTexture?(this.currentIndex=this._getNextIndex(),!0):!1}update(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._setupTextures(e)}getTargetTexture(){const{targetTexture:e}=this.bindings[this.currentIndex];return e}getData(){let{packed:e=!1}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{framebuffer:t}=this.bindings[this.currentIndex],r=Ub(t);if(!e)return r;const i=r.constructor,o=YW(this.targetTextureType),a=new i(r.length*o/4);let l=0;for(let h=0;h<r.length;h+=4)for(let p=0;p<o;p++)a[l++]=r[h+p];return a}getFramebuffer(){return this.bindings[this.currentIndex].framebuffer}delete(){this.ownTexture&&this.ownTexture.delete(),this.elementIDBuffer&&this.elementIDBuffer.delete()}_initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{_targetTextureVarying:t,_swapTexture:r}=e;this._swapTexture=r,this.targetTextureVarying=t,this.hasTargetTexture=t,this._setupTextures(e)}_createTargetTexture(e){const{sourceTextures:t,textureOrReference:r}=e;if(r instanceof fs)return r;const i=t[r];return i?(this._targetRefTexName=r,this._createNewTexture(i)):null}_setupTextures(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{sourceBuffers:t,_sourceTextures:r={},_targetTexture:i}=e,o=this._createTargetTexture({sourceTextures:r,textureOrReference:i});this.hasSourceTextures=this.hasSourceTextures||r&&Object.keys(r).length>0,this._updateBindings({sourceBuffers:t,sourceTextures:r,targetTexture:o}),"elementCount"in e&&this._updateElementIDBuffer(e.elementCount)}_updateElementIDBuffer(e){if(typeof e!="number"||this.elementCount>=e)return;const t=new Float32Array(e);t.forEach((r,i,o)=>{o[i]=i}),this.elementIDBuffer?this.elementIDBuffer.setData({data:t}):this.elementIDBuffer=new ni(this.gl,{data:t,accessor:{size:1}}),this.elementCount=e}_updateBindings(e){if(this.bindings[this.currentIndex]=this._updateBinding(this.bindings[this.currentIndex],e),this._swapTexture){const{sourceTextures:t,targetTexture:r}=this._swapTextures(this.bindings[this.currentIndex]),i=this._getNextIndex();this.bindings[i]=this._updateBinding(this.bindings[i],{sourceTextures:t,targetTexture:r})}}_updateBinding(e,t){const{sourceBuffers:r,sourceTextures:i,targetTexture:o}=t;if(e||(e={sourceBuffers:{},sourceTextures:{},targetTexture:null}),Object.assign(e.sourceTextures,i),Object.assign(e.sourceBuffers,r),o){e.targetTexture=o;const{width:a,height:l}=o,{framebuffer:h}=e;h?(h.update({attachments:{36064:o},resizeAttachments:!1}),h.resize({width:a,height:l})):e.framebuffer=new _o(this.gl,{id:"transform-framebuffer",width:a,height:l,attachments:{36064:o}})}return e}_setSourceTextureParameters(){const e=this.currentIndex,{sourceTextures:t}=this.bindings[e];for(const r in t)t[r].setParameters(cK)}_swapTextures(e){if(!this._swapTexture)return null;const t=Object.assign({},e.sourceTextures);t[this._swapTexture]=e.targetTexture;const r=e.sourceTextures[this._swapTexture];return{sourceTextures:t,targetTexture:r}}_createNewTexture(e){const t=Vq(e,{parameters:{10241:9728,10240:9728,10242:33071,10243:33071},pixelStore:{37440:!1}});return this.ownTexture&&this.ownTexture.delete(),this.ownTexture=t,t}_getNextIndex(){return(this.currentIndex+1)%2}_processVertexShader(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{sourceTextures:t,targetTexture:r}=this.bindings[this.currentIndex],{vs:i,uniforms:o,targetTextureType:a,inject:l,samplerTextureMap:h}=nK({vs:e.vs,sourceTextureMap:t,targetTextureVarying:this.targetTextureVarying,targetTexture:r}),p=kS([e.inject||{},l]);this.targetTextureType=a,this.samplerTextureMap=h;const g=e._fs||vL({version:$O(i),input:this.targetTextureVarying,inputType:a,output:lK}),_=this.hasSourceTextures||this.targetTextureVarying?[$Y].concat(e.modules||[]):e.modules;return{vs:i,fs:g,modules:_,uniforms:o,inject:p}}}class zS{static isSupported(e){return yr(e)}constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.gl=e,this.model=null,this.elementCount=0,this.bufferTransform=null,this.textureTransform=null,this.elementIDBuffer=null,this._initialize(t),Object.seal(this)}delete(){const{model:e,bufferTransform:t,textureTransform:r}=this;e&&e.delete(),t&&t.delete(),r&&r.delete()}run(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{clearRenderTarget:t=!0}=e,r=this._updateDrawOptions(e);t&&r.framebuffer&&r.framebuffer.clear({color:!0}),this.model.transform(r)}swap(){let e=!1;const t=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const r of t)e=e||r.swap();Xt(e,"Nothing to swap")}getBuffer(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;return this.bufferTransform&&this.bufferTransform.getBuffer(e)}getData(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const t=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const r of t){const i=r.getData(e);if(i)return i}return null}getFramebuffer(){return this.textureTransform&&this.textureTransform.getFramebuffer()}update(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};"elementCount"in e&&this.model.setVertexCount(e.elementCount);const t=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const r of t)r.update(e)}_initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{gl:t}=this;this._buildResourceTransforms(t,e),e=this._updateModelProps(e),this.model=new Ad(t,Object.assign({},e,{fs:e.fs||vL({version:$O(e.vs)}),id:e.id||"transform-model",drawMode:e.drawMode||0,vertexCount:e.elementCount})),this.bufferTransform&&this.bufferTransform.setupResources({model:this.model})}_updateModelProps(e){let t=Object.assign({},e);const r=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const i of r)t=i.updateModelProps(t);return t}_buildResourceTransforms(e,t){hK(t)&&(this.bufferTransform=new eK(e,t)),dK(t)&&(this.textureTransform=new uK(e,t)),Xt(this.bufferTransform||this.textureTransform,"must provide source/feedback buffers or source/target textures")}_updateDrawOptions(e){let t=Object.assign({},e);const r=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const i of r)t=Object.assign(t,i.getDrawOptions(t));return t}}function hK(n){return!!(!Sp(n.feedbackBuffers)||!Sp(n.feedbackMap)||n.varyings&&n.varyings.length>0)}function dK(n){return!!(!Sp(n._sourceTextures)||n._targetTexture||n._targetTextureVarying)}const OL={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6};class kp{static get DRAW_MODE(){return OL}constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{id:t=Hu("geometry"),drawMode:r=OL.TRIANGLES,attributes:i={},indices:o=null,vertexCount:a=null}=e;this.id=t,this.drawMode=r|0,this.attributes={},this.userData={},this._setAttributes(i,o),this.vertexCount=a||this._calculateVertexCount(this.attributes,this.indices)}get mode(){return this.drawMode}getVertexCount(){return this.vertexCount}getAttributes(){return this.indices?{indices:this.indices,...this.attributes}:this.attributes}_print(e){return"Geometry ".concat(this.id," attribute ").concat(e)}_setAttributes(e,t){t&&(this.indices=ArrayBuffer.isView(t)?{value:t,size:1}:t);for(const r in e){let i=e[r];i=ArrayBuffer.isView(i)?{value:i}:i,Xt(ArrayBuffer.isView(i.value),"".concat(this._print(r),": must be typed array or object with value as typed array")),(r==="POSITION"||r==="positions")&&!i.size&&(i.size=3),r==="indices"?(Xt(!this.indices),this.indices=i):this.attributes[r]=i}return this.indices&&this.indices.isIndexed!==void 0&&(this.indices=Object.assign({},this.indices),delete this.indices.isIndexed),this}_calculateVertexCount(e,t){if(t)return t.value.length;let r=1/0;for(const i in e){const o=e[i],{value:a,size:l,constant:h}=o;!h&&a&&l>=1&&(r=Math.min(r,a.length/l))}return Xt(Number.isFinite(r)),r}}let fK=1,pK=1;class LL{constructor(){this.time=0,this.channels=new Map,this.animations=new Map,this.playing=!1,this.lastEngineTime=-1}addChannel(e){const{delay:t=0,duration:r=Number.POSITIVE_INFINITY,rate:i=1,repeat:o=1}=e,a=fK++,l={time:0,delay:t,duration:r,rate:i,repeat:o};return this._setChannelTime(l,this.time),this.channels.set(a,l),a}removeChannel(e){this.channels.delete(e);for(const[t,r]of this.animations)r.channel===e&&this.detachAnimation(t)}isFinished(e){const t=this.channels.get(e);return t===void 0?!1:this.time>=t.delay+t.duration*t.repeat}getTime(e){if(e===void 0)return this.time;const t=this.channels.get(e);return t===void 0?-1:t.time}setTime(e){this.time=Math.max(0,e);const t=this.channels.values();for(const i of t)this._setChannelTime(i,this.time);const r=this.animations.values();for(const i of r){const{animation:o,channel:a}=i;o.setTime(this.getTime(a))}}play(){this.playing=!0}pause(){this.playing=!1,this.lastEngineTime=-1}reset(){this.setTime(0)}attachAnimation(e,t){const r=pK++;return this.animations.set(r,{animation:e,channel:t}),e.setTime(this.getTime(t)),r}detachAnimation(e){this.animations.delete(e)}update(e){this.playing&&(this.lastEngineTime===-1&&(this.lastEngineTime=e),this.setTime(this.time+(e-this.lastEngineTime)),this.lastEngineTime=e)}_setChannelTime(e,t){const r=t-e.delay,i=e.duration*e.repeat;r>=i?e.time=e.duration*e.rate:(e.time=Math.max(0,r)%e.duration,e.time*=e.rate)}}const gK=[255,255,255],mK=1;let yK=0;class _K{constructor(e={}){Y(this,"id",void 0),Y(this,"color",void 0),Y(this,"intensity",void 0),Y(this,"type","ambient");const{color:t=gK}=e,{intensity:r=mK}=e;this.id=e.id||"ambient-".concat(yK++),this.color=t,this.intensity=r}}const vK=[255,255,255],bK=1,wK=[0,0,-1];let xK=0;class NL{constructor(e={}){Y(this,"id",void 0),Y(this,"color",void 0),Y(this,"intensity",void 0),Y(this,"type","directional"),Y(this,"direction",void 0),Y(this,"shadow",void 0);const{color:t=vK}=e,{intensity:r=bK}=e,{direction:i=wK}=e,{_shadow:o=!1}=e;this.id=e.id||"directional-".concat(xK++),this.color=t,this.intensity=r,this.type="directional",this.direction=new zc(i).normalize().toArray(),this.shadow=o}getProjectedLight(e){return this}}class EK{constructor(e,t={id:"pass"}){Y(this,"id",void 0),Y(this,"gl",void 0),Y(this,"props",void 0);const{id:r}=t;this.id=r,this.gl=e,this.props={...t}}setProps(e){Object.assign(this.props,e)}render(e){}cleanup(){}}class jS extends EK{constructor(...e){super(...e),Y(this,"_lastRenderIndex",-1)}render(e){const t=this.gl;return Fl(t,{framebuffer:e.target}),this._drawLayers(e)}_drawLayers(e){const{target:t,moduleParameters:r,viewports:i,views:o,onViewportActive:a,clearStack:l=!0,clearCanvas:h=!0}=e;e.pass=e.pass||"unknown";const p=this.gl;h&&SK(p,t),l&&(this._lastRenderIndex=-1);const g=[];for(const _ of i){const x=o&&o[_.id];a==null||a(_);const C=this._getDrawLayerParams(_,e),M=_.subViewports||[_];for(const L of M){const F=this._drawLayersInViewport(p,{target:t,moduleParameters:r,viewport:L,view:x,pass:e.pass,layers:e.layers},C);g.push(F)}}return g}_getDrawLayerParams(e,{layers:t,pass:r,isPicking:i=!1,layerFilter:o,cullRect:a,effects:l,moduleParameters:h},p=!1){const g=[],_=DL(this._lastRenderIndex+1),x={layer:t[0],viewport:e,isPicking:i,renderPass:r,cullRect:a},C={};for(let M=0;M<t.length;M++){const L=t[M],F=this._shouldDrawLayer(L,x,o,C),z={shouldDrawLayer:F};F&&!p&&(z.layerRenderIndex=_(L,F),z.moduleParameters=this._getModuleParameters(L,l,r,h),z.layerParameters=this.getLayerParameters(L,M,e)),g[M]=z}return g}_drawLayersInViewport(e,{layers:t,moduleParameters:r,pass:i,target:o,viewport:a,view:l},h){const p=TK(e,{moduleParameters:r,target:o,viewport:a});if(l&&l.props.clear){const _=l.props.clear===!0?{color:!0,depth:!0}:l.props.clear;fc(e,{scissorTest:!0,scissor:p},()=>wS(e,_))}const g={totalCount:t.length,visibleCount:0,compositeCount:0,pickableCount:0};Fl(e,{viewport:p});for(let _=0;_<t.length;_++){const x=t[_],{shouldDrawLayer:C,layerRenderIndex:M,moduleParameters:L,layerParameters:F}=h[_];if(C&&x.props.pickable&&g.pickableCount++,x.isComposite)g.compositeCount++;else if(C){g.visibleCount++,this._lastRenderIndex=Math.max(this._lastRenderIndex,M),L.viewport=a;try{x._drawLayer({moduleParameters:L,uniforms:{layerIndex:M},parameters:F})}catch(z){x.raiseError(z,"drawing ".concat(x," to ").concat(i))}}}return g}shouldDrawLayer(e){return!0}getModuleParameters(e,t){return null}getLayerParameters(e,t,r){return e.props.parameters}_shouldDrawLayer(e,t,r,i){if(!(e.props.visible&&this.shouldDrawLayer(e)))return!1;t.layer=e;let a=e.parent;for(;a;){if(!a.props.visible||!a.filterSubLayer(t))return!1;t.layer=a,a=a.parent}if(r){const l=t.layer.id;if(l in i||(i[l]=r(t)),!i[l])return!1}return e.activateViewport(t.viewport),!0}_getModuleParameters(e,t,r,i){var o;const a=Object.assign(Object.create(((o=e.internalState)===null||o===void 0?void 0:o.propsInTransition)||e.props),{autoWrapLongitude:e.wrapLongitude,viewport:e.context.viewport,mousePosition:e.context.mousePosition,pickingActive:0,devicePixelRatio:Tp(this.gl)});if(t)for(const h of t){var l;Object.assign(a,(l=h.getModuleParameters)===null||l===void 0?void 0:l.call(h,e))}return Object.assign(a,this.getModuleParameters(e,t),i)}}function DL(n=0,e={}){const t={},r=(i,o)=>{const a=i.props._offset,l=i.id,h=i.parent&&i.parent.id;let p;if(h&&!(h in e)&&r(i.parent,!1),h in t){const g=t[h]=t[h]||DL(e[h],e);p=g(i,o),t[l]=g}else Number.isFinite(a)?(p=a+(e[h]||0),t[l]=null):p=n;return o&&p>=n&&(n=p+1),e[l]=p,p};return r}function TK(n,{moduleParameters:e,target:t,viewport:r}){const i=t&&t.id!=="default-framebuffer",o=e&&e.devicePixelRatio||Tp(n),a=i?t.height:n.drawingBufferHeight,l=r;return[l.x*o,a-(l.y+l.height)*o,l.width*o,l.height*o]}function SK(n,e){const t=e?e.width:n.drawingBufferWidth,r=e?e.height:n.drawingBufferHeight;Fl(n,{viewport:[0,0,t,r]}),n.clear(16640)}class CK extends jS{constructor(e,t){super(e,t),Y(this,"shadowMap",void 0),Y(this,"depthBuffer",void 0),Y(this,"fbo",void 0),this.shadowMap=new fs(e,{width:1,height:1,parameters:{10241:9729,10240:9729,10242:33071,10243:33071}}),this.depthBuffer=new Ap(e,{format:33189,width:1,height:1}),this.fbo=new _o(e,{id:"shadowmap",width:1,height:1,attachments:{36064:this.shadowMap,36096:this.depthBuffer}})}render(e){const t=this.fbo;fc(this.gl,{depthRange:[0,1],depthTest:!0,blend:!1,clearColor:[1,1,1,1]},()=>{const r=e.viewports[0],i=Tp(this.gl),o=r.width*i,a=r.height*i;(o!==t.width||a!==t.height)&&t.resize({width:o,height:a}),super.render({...e,target:t,pass:"shadow"})})}shouldDrawLayer(e){return e.props.shadowEnabled!==!1}getModuleParameters(){return{drawToShadowMap:!0}}delete(){this.fbo&&(this.fbo.delete(),this.fbo=null),this.shadowMap&&(this.shadowMap.delete(),this.shadowMap=null),this.depthBuffer&&(this.depthBuffer.delete(),this.depthBuffer=null)}}const FL="#define SMOOTH_EDGE_RADIUS 0.5",AK=`
`.concat(FL,`

struct VertexGeometry {
  vec4 position;
  vec3 worldPosition;
  vec3 worldPositionAlt;
  vec3 normal;
  vec2 uv;
  vec3 pickingColor;
} geometry = VertexGeometry(
  vec4(0.0, 0.0, 1.0, 0.0),
  vec3(0.0),
  vec3(0.0),
  vec3(0.0),
  vec2(0.0),
  vec3(0.0)
);
`),IK=`
`.concat(FL,`

struct FragmentGeometry {
  vec2 uv;
} geometry;

float smoothedge(float edge, float x) {
  return smoothstep(edge - SMOOTH_EDGE_RADIUS, edge + SMOOTH_EDGE_RADIUS, x);
}
`),PK={name:"geometry",vs:AK,fs:IK},MK=Object.keys(Zr).map(n=>"const int COORDINATE_SYSTEM_".concat(n," = ").concat(Zr[n],";")).join(""),RK=Object.keys(Bc).map(n=>"const int PROJECTION_MODE_".concat(n," = ").concat(Bc[n],";")).join(""),kK=Object.keys(Ep).map(n=>"const int UNIT_".concat(n.toUpperCase()," = ").concat(Ep[n],";")).join(""),OK="".concat(MK,`
`).concat(RK,`
`).concat(kK,`

uniform int project_uCoordinateSystem;
uniform int project_uProjectionMode;
uniform float project_uScale;
uniform bool project_uWrapLongitude;
uniform vec3 project_uCommonUnitsPerMeter;
uniform vec3 project_uCommonUnitsPerWorldUnit;
uniform vec3 project_uCommonUnitsPerWorldUnit2;
uniform vec4 project_uCenter;
uniform mat4 project_uModelMatrix;
uniform mat4 project_uViewProjectionMatrix;
uniform vec2 project_uViewportSize;
uniform float project_uDevicePixelRatio;
uniform float project_uFocalDistance;
uniform vec3 project_uCameraPosition;
uniform vec3 project_uCoordinateOrigin;
uniform vec3 project_uCommonOrigin;
uniform bool project_uPseudoMeters;

const float TILE_SIZE = 512.0;
const float PI = 3.1415926536;
const float WORLD_SCALE = TILE_SIZE / (PI * 2.0);
const vec3 ZERO_64_LOW = vec3(0.0);
const float EARTH_RADIUS = 6370972.0;
const float GLOBE_RADIUS = 256.0;
float project_size_at_latitude(float lat) {
  float y = clamp(lat, -89.9, 89.9);
  return 1.0 / cos(radians(y));
}

float project_size() {
  if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR &&
    project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT &&
    project_uPseudoMeters == false) {
    
    if (geometry.position.w == 0.0) {
      return project_size_at_latitude(geometry.worldPosition.y);
    }
  
    float y = geometry.position.y / TILE_SIZE * 2.0 - 1.0;
    float y2 = y * y;
    float y4 = y2 * y2;
    float y6 = y4 * y2;
    return 1.0 + 4.9348 * y2 + 4.0587 * y4 + 1.5642 * y6;
  }
  return 1.0;
}

float project_size_at_latitude(float meters, float lat) {
  return meters * project_uCommonUnitsPerMeter.z * project_size_at_latitude(lat);
}
float project_size(float meters) {
  return meters * project_uCommonUnitsPerMeter.z * project_size();
}

vec2 project_size(vec2 meters) {
  return meters * project_uCommonUnitsPerMeter.xy * project_size();
}

vec3 project_size(vec3 meters) {
  return meters * project_uCommonUnitsPerMeter * project_size();
}

vec4 project_size(vec4 meters) {
  return vec4(meters.xyz * project_uCommonUnitsPerMeter, meters.w);
}
mat3 project_get_orientation_matrix(vec3 up) {
  vec3 uz = normalize(up);
  vec3 ux = abs(uz.z) == 1.0 ? vec3(1.0, 0.0, 0.0) : normalize(vec3(uz.y, -uz.x, 0));
  vec3 uy = cross(uz, ux);
  return mat3(ux, uy, uz);
}

bool project_needs_rotation(vec3 commonPosition, out mat3 transform) {
  if (project_uProjectionMode == PROJECTION_MODE_GLOBE) {
    transform = project_get_orientation_matrix(commonPosition);
    return true;
  }
  return false;
}
vec3 project_normal(vec3 vector) {
  vec4 normal_modelspace = project_uModelMatrix * vec4(vector, 0.0);
  vec3 n = normalize(normal_modelspace.xyz * project_uCommonUnitsPerMeter);
  mat3 rotation;
  if (project_needs_rotation(geometry.position.xyz, rotation)) {
    n = rotation * n;
  }
  return n;
}

vec4 project_offset_(vec4 offset) {
  float dy = offset.y;
  vec3 commonUnitsPerWorldUnit = project_uCommonUnitsPerWorldUnit + project_uCommonUnitsPerWorldUnit2 * dy;
  return vec4(offset.xyz * commonUnitsPerWorldUnit, offset.w);
}
vec2 project_mercator_(vec2 lnglat) {
  float x = lnglat.x;
  if (project_uWrapLongitude) {
    x = mod(x + 180., 360.0) - 180.;
  }
  float y = clamp(lnglat.y, -89.9, 89.9);
  return vec2(
    radians(x) + PI,
    PI + log(tan_fp32(PI * 0.25 + radians(y) * 0.5))
  ) * WORLD_SCALE;
}

vec3 project_globe_(vec3 lnglatz) {
  float lambda = radians(lnglatz.x);
  float phi = radians(lnglatz.y);
  float cosPhi = cos(phi);
  float D = (lnglatz.z / EARTH_RADIUS + 1.0) * GLOBE_RADIUS;

  return vec3(
    sin(lambda) * cosPhi,
    -cos(lambda) * cosPhi,
    sin(phi)
  ) * D;
}
vec4 project_position(vec4 position, vec3 position64Low) {
  vec4 position_world = project_uModelMatrix * position;
  if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR) {
    if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      return vec4(
        project_mercator_(position_world.xy),
        project_size_at_latitude(position_world.z, position_world.y),
        position_world.w
      );
    }
    if (project_uCoordinateSystem == COORDINATE_SYSTEM_CARTESIAN) {
      position_world.xyz += project_uCoordinateOrigin;
    }
  }
  if (project_uProjectionMode == PROJECTION_MODE_GLOBE) {
    if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      return vec4(
        project_globe_(position_world.xyz),
        position_world.w
      );
    }
  }
  if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
    if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      if (abs(position_world.y - project_uCoordinateOrigin.y) > 0.25) {
        return vec4(
          project_mercator_(position_world.xy) - project_uCommonOrigin.xy,
          project_size(position_world.z),
          position_world.w
        );
      }
    }
  }
  if (project_uProjectionMode == PROJECTION_MODE_IDENTITY ||
    (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET &&
    (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
     project_uCoordinateSystem == COORDINATE_SYSTEM_CARTESIAN))) {
    position_world.xyz -= project_uCoordinateOrigin;
  }
  return project_offset_(position_world) + project_offset_(project_uModelMatrix * vec4(position64Low, 0.0));
}

vec4 project_position(vec4 position) {
  return project_position(position, ZERO_64_LOW);
}

vec3 project_position(vec3 position, vec3 position64Low) {
  vec4 projected_position = project_position(vec4(position, 1.0), position64Low);
  return projected_position.xyz;
}

vec3 project_position(vec3 position) {
  vec4 projected_position = project_position(vec4(position, 1.0), ZERO_64_LOW);
  return projected_position.xyz;
}

vec2 project_position(vec2 position) {
  vec4 projected_position = project_position(vec4(position, 0.0, 1.0), ZERO_64_LOW);
  return projected_position.xy;
}

vec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {
  return viewProjectionMatrix * position + center;
}
vec4 project_common_position_to_clipspace(vec4 position) {
  return project_common_position_to_clipspace(position, project_uViewProjectionMatrix, project_uCenter);
}
vec2 project_pixel_size_to_clipspace(vec2 pixels) {
  vec2 offset = pixels / project_uViewportSize * project_uDevicePixelRatio * 2.0;
  return offset * project_uFocalDistance;
}

float project_size_to_pixel(float meters) {
  return project_size(meters) * project_uScale;
}
float project_size_to_pixel(float size, int unit) {
  if (unit == UNIT_METERS) return project_size_to_pixel(size);
  if (unit == UNIT_COMMON) return size * project_uScale;
  return size;
}
float project_pixel_size(float pixels) {
  return pixels / project_uScale;
}
vec2 project_pixel_size(vec2 pixels) {
  return pixels / project_uScale;
}
`);function LK(n,e){if(n===e)return!0;if(Array.isArray(n)){const t=n.length;if(!e||e.length!==t)return!1;for(let r=0;r<t;r++)if(n[r]!==e[r])return!1;return!0}return!1}function Ky(n){let e={},t;return r=>{for(const i in r)if(!LK(r[i],e[i])){t=n(r),e=r;break}return t}}const BL=[0,0,0,0],NK=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],UL=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],DK=[0,0,0],zL=[0,0,0],FK=Ky(zK);function jL(n,e,t=zL){t.length<3&&(t=[t[0],t[1],0]);let r=t,i,o=!0;switch(e===Zr.LNGLAT_OFFSETS||e===Zr.METER_OFFSETS?i=t:i=n.isGeospatial?[Math.fround(n.longitude),Math.fround(n.latitude),0]:null,n.projectionMode){case Bc.WEB_MERCATOR:(e===Zr.LNGLAT||e===Zr.CARTESIAN)&&(i=[0,0,0],o=!1);break;case Bc.WEB_MERCATOR_AUTO_OFFSET:e===Zr.LNGLAT?r=i:e===Zr.CARTESIAN&&(r=[Math.fround(n.center[0]),Math.fround(n.center[1]),0],i=n.unprojectPosition(r),r[0]-=t[0],r[1]-=t[1],r[2]-=t[2]);break;case Bc.IDENTITY:r=n.position.map(Math.fround),r[2]=r[2]||0;break;case Bc.GLOBE:o=!1,i=null;break;default:o=!1}return{geospatialOrigin:i,shaderCoordinateOrigin:r,offsetMode:o}}function BK(n,e,t){const{viewMatrixUncentered:r,projectionMatrix:i}=n;let{viewMatrix:o,viewProjectionMatrix:a}=n,l=BL,h=BL,p=n.cameraPosition;const{geospatialOrigin:g,shaderCoordinateOrigin:_,offsetMode:x}=jL(n,e,t);return x&&(h=n.projectPosition(g||_),p=[p[0]-h[0],p[1]-h[1],p[2]-h[2]],h[3]=1,l=Wy([],h,a),o=r||o,a=jc([],i,o),a=jc([],a,NK)),{viewMatrix:o,viewProjectionMatrix:a,projectionCenter:l,originCommon:h,cameraPosCommon:p,shaderCoordinateOrigin:_,geospatialOrigin:g}}function UK({viewport:n,devicePixelRatio:e=1,modelMatrix:t=null,coordinateSystem:r=Zr.DEFAULT,coordinateOrigin:i=zL,autoWrapLongitude:o=!1}){r===Zr.DEFAULT&&(r=n.isGeospatial?Zr.LNGLAT:Zr.CARTESIAN);const a=FK({viewport:n,devicePixelRatio:e,coordinateSystem:r,coordinateOrigin:i});return a.project_uWrapLongitude=o,a.project_uModelMatrix=t||UL,a}function zK({viewport:n,devicePixelRatio:e,coordinateSystem:t,coordinateOrigin:r}){const{projectionCenter:i,viewProjectionMatrix:o,originCommon:a,cameraPosCommon:l,shaderCoordinateOrigin:h,geospatialOrigin:p}=BK(n,t,r),g=n.getDistanceScales(),_=[n.width*e,n.height*e],x=Wy([],[0,0,-n.focalDistance,1],n.projectionMatrix)[3]||1,C={project_uCoordinateSystem:t,project_uProjectionMode:n.projectionMode,project_uCoordinateOrigin:h,project_uCommonOrigin:a.slice(0,3),project_uCenter:i,project_uPseudoMeters:!!n._pseudoMeters,project_uViewportSize:_,project_uDevicePixelRatio:e,project_uFocalDistance:x,project_uCommonUnitsPerMeter:g.unitsPerMeter,project_uCommonUnitsPerWorldUnit:g.unitsPerMeter,project_uCommonUnitsPerWorldUnit2:DK,project_uScale:n.scale,project_uWrapLongitude:!1,project_uViewProjectionMatrix:o,project_uModelMatrix:UL,project_uCameraPosition:l};if(p){const M=n.getDistanceScales(p);switch(t){case Zr.METER_OFFSETS:C.project_uCommonUnitsPerWorldUnit=M.unitsPerMeter,C.project_uCommonUnitsPerWorldUnit2=M.unitsPerMeter2;break;case Zr.LNGLAT:case Zr.LNGLAT_OFFSETS:n._pseudoMeters||(C.project_uCommonUnitsPerMeter=M.unitsPerMeter),C.project_uCommonUnitsPerWorldUnit=M.unitsPerDegree,C.project_uCommonUnitsPerWorldUnit2=M.unitsPerDegree2;break;case Zr.CARTESIAN:C.project_uCommonUnitsPerWorldUnit=[1,1,M.unitsPerMeter[2]],C.project_uCommonUnitsPerWorldUnit2=[0,0,M.unitsPerMeter2[2]];break}}return C}const jK={};function VK(n=jK){return"viewport"in n?UK(n):{}}const VS={name:"project",dependencies:[ZW,PK],vs:OK,getUniforms:VK};function r1(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function Op(n,e){const t=Wy([],e,n);return DY(t,t,1/t[3]),t}function VL(n,e){const t=n%e;return t<0?e+t:t}function HS(n,e,t){return n<e?e:n>t?t:n}function HK(n){return Math.log(n)*Math.LOG2E}const GS=Math.log2||HK;function zl(n,e){if(!n)throw new Error(e||"@math.gl/web-mercator: assertion failed.")}const pc=Math.PI,HL=pc/4,js=pc/180,qS=180/pc,Lp=512,i1=4003e4,o1=85.051129,GL=1.5;function GK(n){return Math.pow(2,n)}function qK(n){return GS(n)}function $u(n){const[e,t]=n;zl(Number.isFinite(e)),zl(Number.isFinite(t)&&t>=-90&&t<=90,"invalid latitude");const r=e*js,i=t*js,o=Lp*(r+pc)/(2*pc),a=Lp*(pc+Math.log(Math.tan(HL+i*.5)))/(2*pc);return[o,a]}function jl(n){const[e,t]=n,r=e/Lp*(2*pc)-pc,i=2*(Math.atan(Math.exp(t/Lp*(2*pc)-pc))-HL);return[r*qS,i*qS]}function $K(n){const{latitude:e}=n;zl(Number.isFinite(e));const t=Math.cos(e*js);return qK(i1*t)-9}function $S(n){const e=Math.cos(n*js);return Lp/i1/e}function a1(n){const{latitude:e,longitude:t,highPrecision:r=!1}=n;zl(Number.isFinite(e)&&Number.isFinite(t));const i=Lp,o=Math.cos(e*js),a=i/360,l=a/o,h=i/i1/o,p={unitsPerMeter:[h,h,h],metersPerUnit:[1/h,1/h,1/h],unitsPerDegree:[a,l,h],degreesPerUnit:[1/a,1/l,1/h]};if(r){const g=js*Math.tan(e*js)/o,_=a*g/2,x=i/i1*g,C=x/l*h;p.unitsPerDegree2=[0,_,x],p.unitsPerMeter2=[C,0,C]}return p}function qL(n,e){const[t,r,i]=n,[o,a,l]=e,{unitsPerMeter:h,unitsPerMeter2:p}=a1({longitude:t,latitude:r,highPrecision:!0}),g=$u(n);g[0]+=o*(h[0]+p[0]*a),g[1]+=a*(h[1]+p[1]*a);const _=jl(g),x=(i||0)+(l||0);return Number.isFinite(i)||Number.isFinite(l)?[_[0],_[1],x]:_}function $L(n){const{height:e,pitch:t,bearing:r,altitude:i,scale:o,center:a}=n,l=r1();$y(l,l,[0,0,-i]),CL(l,l,-t*js),AL(l,l,r*js);const h=o/e;return Jb(l,l,[h,h,h]),a&&$y(l,l,dY([],a)),l}function WL(n){const{width:e,height:t,altitude:r,pitch:i=0,offset:o,center:a,scale:l,nearZMultiplier:h=1,farZMultiplier:p=1}=n;let{fovy:g=Np(GL)}=n;r!==void 0&&(g=Np(r));const _=g*js,x=i*js,C=WS(g);let M=C;a&&(M+=a[2]*l/Math.cos(x)/t);const L=_*(.5+(o?o[1]:0)/t),F=Math.sin(L)*M/Math.sin(HS(Math.PI/2-x-L,.01,Math.PI-.01)),z=Math.sin(x)*F+M,ee=M*10,ce=Math.min(z*p,ee);return{fov:_,aspect:e/t,focalDistance:C,near:h,far:ce}}function WK(n){const{fov:e,aspect:t,near:r,far:i}=WL(n);return IL([],e,t,r,i)}function Np(n){return 2*Math.atan(.5/n)*qS}function WS(n){return .5/Math.tan(.5*n*js)}function YS(n,e){const[t,r,i=0]=n;return zl(Number.isFinite(t)&&Number.isFinite(r)&&Number.isFinite(i)),Op(e,[t,r,i,1])}function Zy(n,e,t=0){const[r,i,o]=n;if(zl(Number.isFinite(r)&&Number.isFinite(i),"invalid pixel coordinate"),Number.isFinite(o))return Op(e,[r,i,o,1]);const a=Op(e,[r,i,0,1]),l=Op(e,[r,i,1,1]),h=a[2],p=l[2],g=h===p?0:((t||0)-h)/(p-h);return EL([],a,l,g)}function KS(n){const{width:e,height:t,bounds:r,minExtent:i=0,maxZoom:o=24,offset:a=[0,0]}=n,[[l,h],[p,g]]=r,_=YK(n.padding),x=$u([l,HS(g,-o1,o1)]),C=$u([p,HS(h,-o1,o1)]),M=[Math.max(Math.abs(C[0]-x[0]),i),Math.max(Math.abs(C[1]-x[1]),i)],L=[e-_.left-_.right-Math.abs(a[0])*2,t-_.top-_.bottom-Math.abs(a[1])*2];zl(L[0]>0&&L[1]>0);const F=L[0]/M[0],z=L[1]/M[1],ee=(_.right-_.left)/2/F,ce=(_.top-_.bottom)/2/z,se=[(C[0]+x[0])/2+ee,(C[1]+x[1])/2+ce],_e=jl(se),J=Math.min(o,GS(Math.abs(Math.min(F,z))));return zl(Number.isFinite(J)),{longitude:_e[0],latitude:_e[1],zoom:J}}function YK(n=0){return typeof n=="number"?{top:n,bottom:n,left:n,right:n}:(zl(Number.isFinite(n.top)&&Number.isFinite(n.bottom)&&Number.isFinite(n.left)&&Number.isFinite(n.right)),n)}const YL=Math.PI/180;function KL(n,e=0){const{width:t,height:r,unproject:i}=n,o={targetZ:e},a=i([0,r],o),l=i([t,r],o);let h,p;const g=n.fovy?.5*n.fovy*YL:Math.atan(.5/n.altitude),_=(90-n.pitch)*YL;return g>_-.01?(h=ZL(n,0,e),p=ZL(n,t,e)):(h=i([0,0],o),p=i([t,0],o)),[a,l,p,h]}function ZL(n,e,t){const{pixelUnprojectionMatrix:r}=n,i=Op(r,[e,0,1,1]),o=Op(r,[e,n.height,1,1]),l=(t*n.distanceScales.unitsPerMeter[2]-i[2])/(o[2]-i[2]),h=EL([],i,o,l),p=jl(h);return p.push(t),p}let KK=class gk{constructor(e={width:1,height:1}){Y(this,"latitude",void 0),Y(this,"longitude",void 0),Y(this,"zoom",void 0),Y(this,"pitch",void 0),Y(this,"bearing",void 0),Y(this,"altitude",void 0),Y(this,"fovy",void 0),Y(this,"meterOffset",void 0),Y(this,"center",void 0),Y(this,"width",void 0),Y(this,"height",void 0),Y(this,"scale",void 0),Y(this,"distanceScales",void 0),Y(this,"viewMatrix",void 0),Y(this,"projectionMatrix",void 0),Y(this,"viewProjectionMatrix",void 0),Y(this,"pixelProjectionMatrix",void 0),Y(this,"pixelUnprojectionMatrix",void 0),Y(this,"equals",z=>z instanceof gk?z.width===this.width&&z.height===this.height&&PL(z.projectionMatrix,this.projectionMatrix)&&PL(z.viewMatrix,this.viewMatrix):!1),Y(this,"project",(z,ee={})=>{const{topLeft:ce=!0}=ee,se=this.projectPosition(z),_e=YS(se,this.pixelProjectionMatrix),[J,pe]=_e,ue=ce?pe:this.height-pe;return z.length===2?[J,ue]:[J,ue,_e[2]]}),Y(this,"unproject",(z,ee={})=>{const{topLeft:ce=!0,targetZ:se=void 0}=ee,[_e,J,pe]=z,ue=ce?J:this.height-J,xe=se&&se*this.distanceScales.unitsPerMeter[2],je=Zy([_e,ue,pe],this.pixelUnprojectionMatrix,xe),[ne,Ee,ke]=this.unprojectPosition(je);return Number.isFinite(pe)?[ne,Ee,ke]:Number.isFinite(se)?[ne,Ee,se]:[ne,Ee]}),Y(this,"projectPosition",z=>{const[ee,ce]=$u(z),se=(z[2]||0)*this.distanceScales.unitsPerMeter[2];return[ee,ce,se]}),Y(this,"unprojectPosition",z=>{const[ee,ce]=jl(z),se=(z[2]||0)*this.distanceScales.metersPerUnit[2];return[ee,ce,se]});let{width:t,height:r,altitude:i=null,fovy:o=null}=e;const{latitude:a=0,longitude:l=0,zoom:h=0,pitch:p=0,bearing:g=0,position:_=null,nearZMultiplier:x=.02,farZMultiplier:C=1.01}=e;t=t||1,r=r||1,o===null&&i===null?(i=GL,o=Np(i)):o===null?o=Np(i):i===null&&(i=WS(o));const M=GK(h);i=Math.max(.75,i);const L=a1({longitude:l,latitude:a}),F=$u([l,a]);F.push(0),_&&lY(F,F,xY([],_,L.unitsPerMeter)),this.projectionMatrix=WK({width:t,height:r,scale:M,center:F,pitch:p,fovy:o,nearZMultiplier:x,farZMultiplier:C}),this.viewMatrix=$L({height:r,scale:M,center:F,pitch:p,bearing:g,altitude:i}),this.width=t,this.height=r,this.scale=M,this.latitude=a,this.longitude=l,this.zoom=h,this.pitch=p,this.bearing=g,this.altitude=i,this.fovy=o,this.center=F,this.meterOffset=_||[0,0,0],this.distanceScales=L,this._initMatrices(),Object.freeze(this)}_initMatrices(){const{width:e,height:t,projectionMatrix:r,viewMatrix:i}=this,o=r1();jc(o,o,r),jc(o,o,i),this.viewProjectionMatrix=o;const a=r1();Jb(a,a,[e/2,-t/2,1]),$y(a,a,[1,-1,0]),jc(a,a,o);const l=Qb(r1(),a);if(!l)throw new Error("Pixel project matrix not invertible");this.pixelProjectionMatrix=a,this.pixelUnprojectionMatrix=l}projectFlat(e){return $u(e)}unprojectFlat(e){return jl(e)}getMapCenterByLngLatPosition({lngLat:e,pos:t}){const r=Zy(t,this.pixelUnprojectionMatrix),i=$u(e),o=Zb([],i,xL([],r)),a=Zb([],this.center,o);return jl(a)}fitBounds(e,t={}){const{width:r,height:i}=this,{longitude:o,latitude:a,zoom:l}=KS(Object.assign({width:r,height:i,bounds:e},t));return new gk({width:r,height:i,longitude:o,latitude:a,zoom:l})}getBounds(e){const t=this.getBoundingRegion(e),r=Math.min(...t.map(l=>l[0])),i=Math.max(...t.map(l=>l[0])),o=Math.min(...t.map(l=>l[1])),a=Math.max(...t.map(l=>l[1]));return[[r,o],[i,a]]}getBoundingRegion(e={}){return KL(this,e.z||0)}getLocationAtPoint({lngLat:e,pos:t}){return this.getMapCenterByLngLatPosition({lngLat:e,pos:t})}};const XL=512;function ZK(n){const{width:e,height:t,pitch:r=0}=n;let{longitude:i,latitude:o,zoom:a,bearing:l=0}=n;(i<-180||i>180)&&(i=VL(i+180,360)-180),(l<-180||l>180)&&(l=VL(l+180,360)-180);const h=GS(t/XL);if(a<=h)a=h,o=0;else{const p=t/2/Math.pow(2,a),g=jl([0,p])[1];if(o<g)o=g;else{const _=jl([0,XL-p])[1];o>_&&(o=_)}}return{width:e,height:t,longitude:i,latitude:o,zoom:a,pitch:r,bearing:l}}const XK=`
const int max_lights = 2;
uniform mat4 shadow_uViewProjectionMatrices[max_lights];
uniform vec4 shadow_uProjectCenters[max_lights];
uniform bool shadow_uDrawShadowMap;
uniform bool shadow_uUseShadowMap;
uniform int shadow_uLightId;
uniform float shadow_uLightCount;

varying vec3 shadow_vPosition[max_lights];

vec4 shadow_setVertexPosition(vec4 position_commonspace) {
  if (shadow_uDrawShadowMap) {
    return project_common_position_to_clipspace(position_commonspace, shadow_uViewProjectionMatrices[shadow_uLightId], shadow_uProjectCenters[shadow_uLightId]);
  }
  if (shadow_uUseShadowMap) {
    for (int i = 0; i < max_lights; i++) {
      if(i < int(shadow_uLightCount)) {
        vec4 shadowMap_position = project_common_position_to_clipspace(position_commonspace, shadow_uViewProjectionMatrices[i], shadow_uProjectCenters[i]);
        shadow_vPosition[i] = (shadowMap_position.xyz / shadowMap_position.w + 1.0) / 2.0;
      }
    }
  }
  return gl_Position;
}
`,QK=`
const int max_lights = 2;
uniform bool shadow_uDrawShadowMap;
uniform bool shadow_uUseShadowMap;
uniform sampler2D shadow_uShadowMap0;
uniform sampler2D shadow_uShadowMap1;
uniform vec4 shadow_uColor;
uniform float shadow_uLightCount;

varying vec3 shadow_vPosition[max_lights];

const vec4 bitPackShift = vec4(1.0, 255.0, 65025.0, 16581375.0);
const vec4 bitUnpackShift = 1.0 / bitPackShift;
const vec4 bitMask = vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0,  0.0);

float shadow_getShadowWeight(vec3 position, sampler2D shadowMap) {
  vec4 rgbaDepth = texture2D(shadowMap, position.xy);

  float z = dot(rgbaDepth, bitUnpackShift);
  return smoothstep(0.001, 0.01, position.z - z);
}

vec4 shadow_filterShadowColor(vec4 color) {
  if (shadow_uDrawShadowMap) {
    vec4 rgbaDepth = fract(gl_FragCoord.z * bitPackShift);
    rgbaDepth -= rgbaDepth.gbaa * bitMask;
    return rgbaDepth;
  }
  if (shadow_uUseShadowMap) {
    float shadowAlpha = 0.0;
    shadowAlpha += shadow_getShadowWeight(shadow_vPosition[0], shadow_uShadowMap0);
    if(shadow_uLightCount > 1.0) {
      shadowAlpha += shadow_getShadowWeight(shadow_vPosition[1], shadow_uShadowMap1);
    }
    shadowAlpha *= shadow_uColor.a / shadow_uLightCount;
    float blendedAlpha = shadowAlpha + color.a * (1.0 - shadowAlpha);

    return vec4(
      mix(color.rgb, shadow_uColor.rgb, shadowAlpha / blendedAlpha),
      blendedAlpha
    );
  }
  return color;
}
`,JK=Ky(iZ),eZ=Ky(oZ),tZ=[0,0,0,1],nZ=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0];function rZ(n,e){const[t,r,i]=n,o=Zy([t,r,i],e);return Number.isFinite(i)?o:[o[0],o[1],0]}function iZ({viewport:n,center:e}){return new Vc(n.viewProjectionMatrix).invert().transform(e)}function oZ({viewport:n,shadowMatrices:e}){const t=[],r=n.pixelUnprojectionMatrix,i=n.isGeospatial?void 0:1,o=[[0,0,i],[n.width,0,i],[0,n.height,i],[n.width,n.height,i],[0,0,-1],[n.width,0,-1],[0,n.height,-1],[n.width,n.height,-1]].map(a=>rZ(a,r));for(const a of e){const l=a.clone().translate(new zc(n.center).negate()),h=o.map(g=>l.transform(g)),p=new Vc().ortho({left:Math.min(...h.map(g=>g[0])),right:Math.max(...h.map(g=>g[0])),bottom:Math.min(...h.map(g=>g[1])),top:Math.max(...h.map(g=>g[1])),near:Math.min(...h.map(g=>-g[2])),far:Math.max(...h.map(g=>-g[2]))});t.push(p.multiplyRight(a))}return t}function aZ(n,e){const{shadowEnabled:t=!0}=n;if(!t||!n.shadowMatrices||!n.shadowMatrices.length)return{shadow_uDrawShadowMap:!1,shadow_uUseShadowMap:!1};const r={shadow_uDrawShadowMap:!!n.drawToShadowMap,shadow_uUseShadowMap:n.shadowMaps?n.shadowMaps.length>0:!1,shadow_uColor:n.shadowColor||tZ,shadow_uLightId:n.shadowLightId||0,shadow_uLightCount:n.shadowMatrices.length},i=JK({viewport:n.viewport,center:e.project_uCenter}),o=[],a=eZ({shadowMatrices:n.shadowMatrices,viewport:n.viewport}).slice();for(let l=0;l<n.shadowMatrices.length;l++){const h=a[l],p=h.clone().translate(new zc(n.viewport.center).negate());e.project_uCoordinateSystem===Zr.LNGLAT&&e.project_uProjectionMode===Bc.WEB_MERCATOR?(a[l]=p,o[l]=i):(a[l]=h.clone().multiplyRight(nZ),o[l]=p.transform(i))}for(let l=0;l<a.length;l++)r["shadow_uViewProjectionMatrices[".concat(l,"]")]=a[l],r["shadow_uProjectCenters[".concat(l,"]")]=o[l],n.shadowMaps&&n.shadowMaps.length>0?r["shadow_uShadowMap".concat(l)]=n.shadowMaps[l]:r["shadow_uShadowMap".concat(l)]=n.dummyShadowMap;return r}const ZS={name:"shadow",dependencies:[VS],vs:XK,fs:QK,inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    position = shadow_setVertexPosition(geometry.position);
    `,"fs:DECKGL_FILTER_COLOR":`
    color = shadow_filterShadowColor(color);
    `},getUniforms:(n={},e={})=>"viewport"in n&&(n.drawToShadowMap||n.shadowMaps&&n.shadowMaps.length>0)?aZ(n,e):{}},sZ={color:[255,255,255],intensity:1},QL=[{color:[255,255,255],intensity:1,direction:[-1,3,-1]},{color:[255,255,255],intensity:.9,direction:[1,-8,-2.5]}],cZ=[0,0,0,200/255];class JL{constructor(e={}){Y(this,"id","lighting-effect"),Y(this,"props",void 0),Y(this,"shadowColor",cZ),Y(this,"shadow",void 0),Y(this,"ambientLight",void 0),Y(this,"directionalLights",void 0),Y(this,"pointLights",void 0),Y(this,"shadowPasses",[]),Y(this,"shadowMaps",[]),Y(this,"dummyShadowMap",null),Y(this,"programManager",void 0),Y(this,"shadowMatrices",void 0),this.setProps(e)}setProps(e){this.ambientLight=null,this.directionalLights=[],this.pointLights=[];for(const t in e){const r=e[t];switch(r.type){case"ambient":this.ambientLight=r;break;case"directional":this.directionalLights.push(r);break;case"point":this.pointLights.push(r);break}}this._applyDefaultLights(),this.shadow=this.directionalLights.some(t=>t.shadow),this.props=e}preRender(e,{layers:t,layerFilter:r,viewports:i,onViewportActive:o,views:a}){if(this.shadow){this.shadowMatrices=this._calculateMatrices(),this.shadowPasses.length===0&&this._createShadowPasses(e),this.programManager||(this.programManager=Yy.getDefaultProgramManager(e),ZS&&this.programManager.addDefaultModule(ZS)),this.dummyShadowMap||(this.dummyShadowMap=new fs(e,{width:1,height:1}));for(let l=0;l<this.shadowPasses.length;l++)this.shadowPasses[l].render({layers:t,layerFilter:r,viewports:i,onViewportActive:o,views:a,moduleParameters:{shadowLightId:l,dummyShadowMap:this.dummyShadowMap,shadowMatrices:this.shadowMatrices}})}}getModuleParameters(e){const t=this.shadow?{shadowMaps:this.shadowMaps,dummyShadowMap:this.dummyShadowMap,shadowColor:this.shadowColor,shadowMatrices:this.shadowMatrices}:{};return t.lightSources={ambientLight:this.ambientLight,directionalLights:this.directionalLights.map(r=>r.getProjectedLight({layer:e})),pointLights:this.pointLights.map(r=>r.getProjectedLight({layer:e}))},t}cleanup(){for(const e of this.shadowPasses)e.delete();this.shadowPasses.length=0,this.shadowMaps.length=0,this.dummyShadowMap&&(this.dummyShadowMap.delete(),this.dummyShadowMap=null),this.shadow&&this.programManager&&(this.programManager.removeDefaultModule(ZS),this.programManager=null)}_calculateMatrices(){const e=[];for(const t of this.directionalLights){const r=new Vc().lookAt({eye:new zc(t.direction).negate()});e.push(r)}return e}_createShadowPasses(e){for(let t=0;t<this.directionalLights.length;t++){const r=new CK(e);this.shadowPasses[t]=r,this.shadowMaps[t]=r.shadowMap}}_applyDefaultLights(){const{ambientLight:e,pointLights:t,directionalLights:r}=this;!e&&t.length===0&&r.length===0&&(this.ambientLight=new _K(sZ),this.directionalLights.push(new NL(QL[0]),new NL(QL[1])))}}class lZ{constructor(e={}){Y(this,"_pool",[]),Y(this,"opts",{overAlloc:2,poolSize:100}),this.setOptions(e)}setOptions(e){Object.assign(this.opts,e)}allocate(e,t,{size:r=1,type:i,padding:o=0,copy:a=!1,initialize:l=!1,maxCount:h}){const p=i||e&&e.constructor||Float32Array,g=t*r+o;if(ArrayBuffer.isView(e)){if(g<=e.length)return e;if(g*e.BYTES_PER_ELEMENT<=e.buffer.byteLength)return new p(e.buffer,0,g)}let _=1/0;h&&(_=h*r+o);const x=this._allocate(p,g,l,_);return e&&a?x.set(e):l||x.fill(0,0,4),this._release(e),x}release(e){this._release(e)}_allocate(e,t,r,i){let o=Math.max(Math.ceil(t*this.opts.overAlloc),1);o>i&&(o=i);const a=this._pool,l=e.BYTES_PER_ELEMENT*o,h=a.findIndex(p=>p.byteLength>=l);if(h>=0){const p=new e(a.splice(h,1)[0],0,o);return r&&p.fill(0),p}return new e(o)}_release(e){if(!ArrayBuffer.isView(e))return;const t=this._pool,{buffer:r}=e,{byteLength:i}=r,o=t.findIndex(a=>a.byteLength>=i);o<0?t.push(r):(o>0||t.length<this.opts.poolSize)&&t.splice(o,0,r),t.length>this.opts.poolSize&&t.shift()}}const Xy=new lZ;function Qy(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function uZ(n){return[n[12],n[13],n[14]]}function hZ(n){return{left:Dp(n[3]+n[0],n[7]+n[4],n[11]+n[8],n[15]+n[12]),right:Dp(n[3]-n[0],n[7]-n[4],n[11]-n[8],n[15]-n[12]),bottom:Dp(n[3]+n[1],n[7]+n[5],n[11]+n[9],n[15]+n[13]),top:Dp(n[3]-n[1],n[7]-n[5],n[11]-n[9],n[15]-n[13]),near:Dp(n[3]+n[2],n[7]+n[6],n[11]+n[10],n[15]+n[14]),far:Dp(n[3]-n[2],n[7]-n[6],n[11]-n[10],n[15]-n[14])}}const eN=new zc;function Dp(n,e,t,r){eN.set(n,e,t);const i=eN.len();return{distance:r/i,normal:new zc(-n/i,-e/i,-t/i)}}function dZ(n){return n-Math.fround(n)}let Jy;function XS(n,e){const{size:t=1,startIndex:r=0}=e,i=e.endIndex!==void 0?e.endIndex:n.length,o=(i-r)/t;Jy=Xy.allocate(Jy,o,{type:Float32Array,size:t*2});let a=r,l=0;for(;a<i;){for(let h=0;h<t;h++){const p=n[a++];Jy[l+h]=p,Jy[l+h+t]=dZ(p)}l+=t*2}return Jy.subarray(0,o*t*2)}function fZ(n){let e=null,t=!1;for(const r of n)r&&(e?(t||(e=[[e[0][0],e[0][1]],[e[1][0],e[1][1]]],t=!0),e[0][0]=Math.min(e[0][0],r[0][0]),e[0][1]=Math.min(e[0][1],r[0][1]),e[1][0]=Math.max(e[1][0],r[1][0]),e[1][1]=Math.max(e[1][1],r[1][1])):e=r);return e}const pZ=Math.PI/180,gZ=Qy(),tN=[0,0,0],mZ={unitsPerMeter:[1,1,1],metersPerUnit:[1,1,1]};function yZ({width:n,height:e,orthographic:t,fovyRadians:r,focalDistance:i,padding:o,near:a,far:l}){const h=n/e,p=t?new Vc().orthographic({fovy:r,aspect:h,focalDistance:i,near:a,far:l}):new Vc().perspective({fovy:r,aspect:h,near:a,far:l});if(o){const{left:g=0,right:_=0,top:x=0,bottom:C=0}=o,M=qu((g+n-_)/2,0,n)-n/2,L=qu((x+e-C)/2,0,e)-e/2;p[8]-=M*2/n,p[9]+=L*2/e}return p}class Fp{constructor(e={}){Y(this,"id",void 0),Y(this,"x",void 0),Y(this,"y",void 0),Y(this,"width",void 0),Y(this,"height",void 0),Y(this,"padding",void 0),Y(this,"isGeospatial",void 0),Y(this,"zoom",void 0),Y(this,"focalDistance",void 0),Y(this,"position",void 0),Y(this,"modelMatrix",void 0),Y(this,"distanceScales",void 0),Y(this,"scale",void 0),Y(this,"center",void 0),Y(this,"cameraPosition",void 0),Y(this,"projectionMatrix",void 0),Y(this,"viewMatrix",void 0),Y(this,"viewMatrixUncentered",void 0),Y(this,"viewMatrixInverse",void 0),Y(this,"viewProjectionMatrix",void 0),Y(this,"pixelProjectionMatrix",void 0),Y(this,"pixelUnprojectionMatrix",void 0),Y(this,"resolution",void 0),Y(this,"_frustumPlanes",{}),this.id=e.id||this.constructor.displayName||"viewport",this.x=e.x||0,this.y=e.y||0,this.width=e.width||1,this.height=e.height||1,this.zoom=e.zoom||0,this.padding=e.padding,this.distanceScales=e.distanceScales||mZ,this.focalDistance=e.focalDistance||1,this.position=e.position||tN,this.modelMatrix=e.modelMatrix||null;const{longitude:t,latitude:r}=e;this.isGeospatial=Number.isFinite(r)&&Number.isFinite(t),this._initProps(e),this._initMatrices(e),this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}get subViewports(){return null}get metersPerPixel(){return this.distanceScales.metersPerUnit[2]/this.scale}get projectionMode(){return this.isGeospatial?this.zoom<12?Bc.WEB_MERCATOR:Bc.WEB_MERCATOR_AUTO_OFFSET:Bc.IDENTITY}equals(e){return e instanceof Fp?this===e?!0:e.width===this.width&&e.height===this.height&&e.scale===this.scale&&qy(e.projectionMatrix,this.projectionMatrix)&&qy(e.viewMatrix,this.viewMatrix):!1}project(e,{topLeft:t=!0}={}){const r=this.projectPosition(e),i=YS(r,this.pixelProjectionMatrix),[o,a]=i,l=t?a:this.height-a;return e.length===2?[o,l]:[o,l,i[2]]}unproject(e,{topLeft:t=!0,targetZ:r}={}){const[i,o,a]=e,l=t?o:this.height-o,h=r&&r*this.distanceScales.unitsPerMeter[2],p=Zy([i,l,a],this.pixelUnprojectionMatrix,h),[g,_,x]=this.unprojectPosition(p);return Number.isFinite(a)?[g,_,x]:Number.isFinite(r)?[g,_,r]:[g,_]}projectPosition(e){const[t,r]=this.projectFlat(e),i=(e[2]||0)*this.distanceScales.unitsPerMeter[2];return[t,r,i]}unprojectPosition(e){const[t,r]=this.unprojectFlat(e),i=(e[2]||0)*this.distanceScales.metersPerUnit[2];return[t,r,i]}projectFlat(e){if(this.isGeospatial){const t=$u(e);return t[1]=qu(t[1],-318,830),t}return e}unprojectFlat(e){return this.isGeospatial?jl(e):e}getBounds(e={}){const t={targetZ:e.z||0},r=this.unproject([0,0],t),i=this.unproject([this.width,0],t),o=this.unproject([0,this.height],t),a=this.unproject([this.width,this.height],t);return[Math.min(r[0],i[0],o[0],a[0]),Math.min(r[1],i[1],o[1],a[1]),Math.max(r[0],i[0],o[0],a[0]),Math.max(r[1],i[1],o[1],a[1])]}getDistanceScales(e){return e?a1({longitude:e[0],latitude:e[1],highPrecision:!0}):this.distanceScales}containsPixel({x:e,y:t,width:r=1,height:i=1}){return e<this.x+this.width&&this.x<e+r&&t<this.y+this.height&&this.y<t+i}getFrustumPlanes(){return this._frustumPlanes.near?this._frustumPlanes:(Object.assign(this._frustumPlanes,hZ(this.viewProjectionMatrix)),this._frustumPlanes)}panByPosition(e,t){return null}_initProps(e){const t=e.longitude,r=e.latitude;this.isGeospatial&&(Number.isFinite(e.zoom)||(this.zoom=$K({latitude:r})+Math.log2(this.focalDistance)),this.distanceScales=e.distanceScales||a1({latitude:r,longitude:t}));const i=Math.pow(2,this.zoom);this.scale=i;const{position:o,modelMatrix:a}=e;let l=tN;if(o&&(l=a?new Vc(a).transformAsVector(o,[]):o),this.isGeospatial){const h=this.projectPosition([t,r,0]);this.center=new zc(l).scale(this.distanceScales.unitsPerMeter).add(h)}else this.center=this.projectPosition(l)}_initMatrices(e){const{viewMatrix:t=gZ,projectionMatrix:r=null,orthographic:i=!1,fovyRadians:o,fovy:a=75,near:l=.1,far:h=1e3,padding:p=null,focalDistance:g=1}=e;this.viewMatrixUncentered=t,this.viewMatrix=new Vc().multiplyRight(t).translate(new zc(this.center).negate()),this.projectionMatrix=r||yZ({width:this.width,height:this.height,orthographic:i,fovyRadians:o||a*pZ,focalDistance:g,padding:p,near:l,far:h});const _=Qy();jc(_,_,this.projectionMatrix),jc(_,_,this.viewMatrix),this.viewProjectionMatrix=_,this.viewMatrixInverse=Qb([],this.viewMatrix)||this.viewMatrix,this.cameraPosition=uZ(this.viewMatrixInverse);const x=Qy(),C=Qy();Jb(x,x,[this.width/2,-this.height/2,1]),$y(x,x,[1,-1,0]),jc(C,x,this.viewProjectionMatrix),this.pixelProjectionMatrix=C,this.pixelUnprojectionMatrix=Qb(Qy(),this.pixelProjectionMatrix),this.pixelUnprojectionMatrix||Ir.warn("Pixel project matrix not invertible")()}}Y(Fp,"displayName","Viewport");class Bp extends Fp{constructor(e={}){const{latitude:t=0,longitude:r=0,zoom:i=0,pitch:o=0,bearing:a=0,nearZMultiplier:l=.1,farZMultiplier:h=1.01,nearZ:p,farZ:g,orthographic:_=!1,projectionMatrix:x,repeat:C=!1,worldOffset:M=0,position:L,padding:F,legacyMeterSizes:z=!1}=e;let{width:ee,height:ce,altitude:se=1.5}=e;const _e=Math.pow(2,i);ee=ee||1,ce=ce||1;let J,pe=null;if(x)se=x[5]/2,J=Np(se);else{e.fovy?(J=e.fovy,se=WS(J)):J=Np(se);let xe;if(F){const{top:je=0,bottom:ne=0}=F;xe=[0,qu((je+ce-ne)/2,0,ce)-ce/2]}pe=WL({width:ee,height:ce,scale:_e,center:L&&[0,0,L[2]*$S(t)],offset:xe,pitch:o,fovy:J,nearZMultiplier:l,farZMultiplier:h}),Number.isFinite(p)&&(pe.near=p),Number.isFinite(g)&&(pe.far=g)}let ue=$L({height:ce,pitch:o,bearing:a,scale:_e,altitude:se});M&&(ue=new Vc().translate([512*M,0,0]).multiplyLeft(ue)),super({...e,width:ee,height:ce,viewMatrix:ue,longitude:r,latitude:t,zoom:i,...pe,fovy:J,focalDistance:se}),Y(this,"longitude",void 0),Y(this,"latitude",void 0),Y(this,"pitch",void 0),Y(this,"bearing",void 0),Y(this,"altitude",void 0),Y(this,"fovy",void 0),Y(this,"orthographic",void 0),Y(this,"_subViewports",void 0),Y(this,"_pseudoMeters",void 0),this.latitude=t,this.longitude=r,this.zoom=i,this.pitch=o,this.bearing=a,this.altitude=se,this.fovy=J,this.orthographic=_,this._subViewports=C?[]:null,this._pseudoMeters=z,Object.freeze(this)}get subViewports(){if(this._subViewports&&!this._subViewports.length){const e=this.getBounds(),t=Math.floor((e[0]+180)/360),r=Math.ceil((e[2]-180)/360);for(let i=t;i<=r;i++){const o=i?new Bp({...this,worldOffset:i}):this;this._subViewports.push(o)}}return this._subViewports}projectPosition(e){if(this._pseudoMeters)return super.projectPosition(e);const[t,r]=this.projectFlat(e),i=(e[2]||0)*$S(e[1]);return[t,r,i]}unprojectPosition(e){if(this._pseudoMeters)return super.unprojectPosition(e);const[t,r]=this.unprojectFlat(e),i=(e[2]||0)/$S(r);return[t,r,i]}addMetersToLngLat(e,t){return qL(e,t)}panByPosition(e,t){const r=Zy(t,this.pixelUnprojectionMatrix),i=this.projectFlat(e),o=Zb([],i,xL([],r)),a=Zb([],this.center,o),[l,h]=this.unprojectFlat(a);return{longitude:l,latitude:h}}getBounds(e={}){const t=KL(this,e.z||0);return[Math.min(t[0][0],t[1][0],t[2][0],t[3][0]),Math.min(t[0][1],t[1][1],t[2][1],t[3][1]),Math.max(t[0][0],t[1][0],t[2][0],t[3][0]),Math.max(t[0][1],t[1][1],t[2][1],t[3][1])]}fitBounds(e,t={}){const{width:r,height:i}=this,{longitude:o,latitude:a,zoom:l}=KS({width:r,height:i,bounds:e,...t});return new Bp({width:r,height:i,longitude:o,latitude:a,zoom:l})}}Y(Bp,"displayName","WebMercatorViewport");const nN=[0,0,0];function QS(n,e,t=!1){const r=e.projectPosition(n);if(t&&e instanceof Bp){const[i,o,a=0]=n,l=e.getDistanceScales([i,o]);r[2]=a*l.unitsPerMeter[2]}return r}function _Z(n){const{viewport:e,modelMatrix:t,coordinateOrigin:r}=n;let{coordinateSystem:i,fromCoordinateSystem:o,fromCoordinateOrigin:a}=n;return i===Zr.DEFAULT&&(i=e.isGeospatial?Zr.LNGLAT:Zr.CARTESIAN),o===void 0&&(o=i),a===void 0&&(a=r),{viewport:e,coordinateSystem:i,coordinateOrigin:r,modelMatrix:t,fromCoordinateSystem:o,fromCoordinateOrigin:a}}function rN(n,{viewport:e,modelMatrix:t,coordinateSystem:r,coordinateOrigin:i,offsetMode:o}){let[a,l,h=0]=n;switch(t&&([a,l,h]=Wy([],[a,l,h,1],t)),r){case Zr.LNGLAT:return QS([a,l,h],e,o);case Zr.LNGLAT_OFFSETS:return QS([a+i[0],l+i[1],h+(i[2]||0)],e,o);case Zr.METER_OFFSETS:return QS(qL(i,[a,l,h]),e,o);case Zr.CARTESIAN:default:return e.isGeospatial?[a+i[0],l+i[1],h+i[2]]:e.projectPosition([a,l,h])}}function vZ(n,e){const{viewport:t,coordinateSystem:r,coordinateOrigin:i,modelMatrix:o,fromCoordinateSystem:a,fromCoordinateOrigin:l}=_Z(e),{autoOffset:h=!0}=e,{geospatialOrigin:p=nN,shaderCoordinateOrigin:g=nN,offsetMode:_=!1}=h?jL(t,r,i):{},x=rN(n,{viewport:t,modelMatrix:o,coordinateSystem:a,coordinateOrigin:l,offsetMode:_});if(_){const C=t.projectPosition(p||g);wY(x,x,C)}return x}const iN={blendFunc:[1,0,32771,0],blendEquation:32774};class oN extends jS{constructor(...e){super(...e),Y(this,"pickZ",void 0),Y(this,"_colorEncoderState",null)}render(e){return"pickingFBO"in e?this._drawPickingBuffer(e):super.render(e)}_drawPickingBuffer({layers:e,layerFilter:t,views:r,viewports:i,onViewportActive:o,pickingFBO:a,deviceRect:{x:l,y:h,width:p,height:g},cullRect:_,effects:x,pass:C="picking",pickZ:M,moduleParameters:L}){const F=this.gl;this.pickZ=M;const z=this._resetColorEncoder(M),ee=fc(F,{scissorTest:!0,scissor:[l,h,p,g],clearColor:[0,0,0,0],depthMask:!0,depthTest:!0,depthRange:[0,1],colorMask:[!0,!0,!0,!0],...iN,blend:!M},()=>super.render({target:a,layers:e,layerFilter:t,views:r,viewports:i,onViewportActive:o,cullRect:_,effects:x==null?void 0:x.filter(se=>se.useInPicking),pass:C,isPicking:!0,moduleParameters:L}));return this._colorEncoderState=null,{decodePickingColor:z&&wZ.bind(null,z),stats:ee}}shouldDrawLayer(e){const{pickable:t,operation:r}=e.props;return t&&r.includes("draw")||r.includes("terrain")||r.includes("mask")}getModuleParameters(){return{pickingActive:1,pickingAttribute:this.pickZ,lightSources:{}}}getLayerParameters(e,t,r){const i={...e.props.parameters},{pickable:o,operation:a}=e.props;return this._colorEncoderState?o&&a.includes("draw")&&(Object.assign(i,iN),i.blend=!0,i.blendColor=bZ(this._colorEncoderState,e,r)):i.blend=!1,a.includes("terrain")&&(i.blend=!1),i}_resetColorEncoder(e){return this._colorEncoderState=e?null:{byLayer:new Map,byAlpha:[]},this._colorEncoderState}}function bZ(n,e,t){const{byLayer:r,byAlpha:i}=n;let o,a=r.get(e);return a?(a.viewports.push(t),o=a.a):(o=r.size+1,o<=255?(a={a:o,layer:e,viewports:[t]},r.set(e,a),i[o]=a):(Ir.warn("Too many pickable layers, only picking the first 255")(),o=0)),[0,0,0,o/255]}function wZ(n,e){const t=n.byAlpha[e[3]];return t&&{pickedLayer:t.layer,pickedViewports:t.viewports,pickedObjectIndex:t.layer.decodePickingColor(e)}}const Up={NO_STATE:"Awaiting state",MATCHED:"Matched. State transferred from previous layer",INITIALIZED:"Initialized",AWAITING_GC:"Discarded. Awaiting garbage collection",AWAITING_FINALIZATION:"No longer matched. Awaiting garbage collection",FINALIZED:"Finalized! Awaiting garbage collection"},s1=Symbol.for("component"),Wu=Symbol.for("propTypes"),JS=Symbol.for("deprecatedProps"),zp=Symbol.for("asyncPropDefaults"),Id=Symbol.for("asyncPropOriginal"),Yu=Symbol.for("asyncPropResolved");function eC(n,e=()=>!0){return Array.isArray(n)?aN(n,e,[]):e(n)?[n]:[]}function aN(n,e,t){let r=-1;for(;++r<n.length;){const i=n[r];Array.isArray(i)?aN(i,e,t):e(i)&&t.push(i)}return t}function xZ({target:n,source:e,start:t=0,count:r=1}){const i=e.length,o=r*i;let a=0;for(let l=t;a<i;a++)n[l++]=e[a];for(;a<o;)a<o-a?(n.copyWithin(t+a,t,t+a),a*=2):(n.copyWithin(t+a,t,t+o-a),a=o);return n}class EZ{constructor(e,t,r){Y(this,"id",void 0),Y(this,"context",void 0),Y(this,"isLoaded",void 0),Y(this,"persistent",void 0),Y(this,"_loadCount",0),Y(this,"_subscribers",new Set),Y(this,"_data",void 0),Y(this,"_loader",void 0),Y(this,"_error",void 0),Y(this,"_content",void 0),this.id=e,this.context=r,this.setData(t)}subscribe(e){this._subscribers.add(e)}unsubscribe(e){this._subscribers.delete(e)}inUse(){return this._subscribers.size>0}delete(){}getData(){return this.isLoaded?this._error?Promise.reject(this._error):this._content:this._loader.then(()=>this.getData())}setData(e,t){if(e===this._data&&!t)return;this._data=e;const r=++this._loadCount;let i=e;typeof e=="string"&&(i=Nb(e)),i instanceof Promise?(this.isLoaded=!1,this._loader=i.then(o=>{this._loadCount===r&&(this.isLoaded=!0,this._error=void 0,this._content=o)}).catch(o=>{this._loadCount===r&&(this.isLoaded=!0,this._error=o||!0)})):(this.isLoaded=!0,this._error=void 0,this._content=e);for(const o of this._subscribers)o.onChange(this.getData())}}class TZ{constructor({gl:e,protocol:t}){Y(this,"protocol",void 0),Y(this,"_context",void 0),Y(this,"_resources",void 0),Y(this,"_consumers",void 0),Y(this,"_pruneRequest",void 0),this.protocol=t||"resource://",this._context={gl:e,resourceManager:this},this._resources={},this._consumers={},this._pruneRequest=null}contains(e){return e.startsWith(this.protocol)?!0:e in this._resources}add({resourceId:e,data:t,forceUpdate:r=!1,persistent:i=!0}){let o=this._resources[e];o?o.setData(t,r):(o=new EZ(e,t,this._context),this._resources[e]=o),o.persistent=i}remove(e){const t=this._resources[e];t&&(t.delete(),delete this._resources[e])}unsubscribe({consumerId:e}){const t=this._consumers[e];if(t){for(const r in t){const i=t[r],o=this._resources[i.resourceId];o&&o.unsubscribe(i)}delete this._consumers[e],this.prune()}}subscribe({resourceId:e,onChange:t,consumerId:r,requestId:i="default"}){const{_resources:o,protocol:a}=this;e.startsWith(a)&&(e=e.replace(a,""),o[e]||this.add({resourceId:e,data:null,persistent:!1}));const l=o[e];if(this._track(r,i,l,t),l)return l.getData()}prune(){this._pruneRequest||(this._pruneRequest=setTimeout(()=>this._prune(),0))}finalize(){for(const e in this._resources)this._resources[e].delete()}_track(e,t,r,i){const o=this._consumers,a=o[e]=o[e]||{},l=a[t]||{},h=l.resourceId&&this._resources[l.resourceId];h&&(h.unsubscribe(l),this.prune()),r&&(a[t]=l,l.onChange=i,l.resourceId=r.id,r.subscribe(l))}_prune(){this._pruneRequest=null;for(const e of Object.keys(this._resources)){const t=this._resources[e];!t.persistent&&!t.inUse()&&(t.delete(),delete this._resources[e])}}}const jp={name:"project32",dependencies:[VS],vs:`
vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset, out vec4 commonPosition
) {
  vec3 projectedPosition = project_position(position, position64Low);
  mat3 rotation;
  if (project_needs_rotation(projectedPosition, rotation)) {
    // offset is specified as ENU
    // when in globe projection, rotate offset so that the ground alighs with the surface of the globe
    offset = rotation * offset;
  }
  commonPosition = vec4(projectedPosition + offset, 1.0);
  return project_common_position_to_clipspace(commonPosition);
}

vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset
) {
  vec4 commonPosition;
  return project_position_to_clipspace(position, position64Low, offset, commonPosition);
}
`},Vp={inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    // for picking depth values
    picking_setPickingAttribute(position.z / position.w);
  `,"vs:DECKGL_FILTER_COLOR":`
  picking_setPickingColor(geometry.pickingColor);
  `,"fs:#decl":`
uniform bool picking_uAttribute;
  `,"fs:DECKGL_FILTER_COLOR":{order:99,injection:`
  // use highlight color if this fragment belongs to the selected object.
  color = picking_filterHighlightColor(color);

  // use picking color if rendering to picking FBO.
  color = picking_filterPickingColor(color);
    `}},...qY},SZ=[VS],CZ=["vs:DECKGL_FILTER_SIZE(inout vec3 size, VertexGeometry geometry)","vs:DECKGL_FILTER_GL_POSITION(inout vec4 position, VertexGeometry geometry)","vs:DECKGL_FILTER_COLOR(inout vec4 color, VertexGeometry geometry)","fs:DECKGL_FILTER_COLOR(inout vec4 color, FragmentGeometry geometry)"];function AZ(n){const e=Yy.getDefaultProgramManager(n);for(const t of SZ)e.addDefaultModule(t);for(const t of CZ)e.addShaderHook(t);return e}const IZ="layerManager.setLayers",PZ="layerManager.activateViewport";let MZ=class{constructor(e,{deck:t,stats:r,viewport:i,timeline:o}={}){Y(this,"layers",void 0),Y(this,"context",void 0),Y(this,"resourceManager",void 0),Y(this,"_lastRenderedLayers",[]),Y(this,"_needsRedraw",!1),Y(this,"_needsUpdate",!1),Y(this,"_nextLayers",null),Y(this,"_debug",!1),Y(this,"activateViewport",a=>{oa(PZ,this,a),a&&(this.context.viewport=a)}),this.layers=[],this.resourceManager=new TZ({gl:e,protocol:"deck://"}),this.context={mousePosition:null,userData:{},layerManager:this,gl:e,deck:t,programManager:e&&AZ(e),stats:r||new WT({id:"deck.gl"}),viewport:i||new Fp({id:"DEFAULT-INITIAL-VIEWPORT"}),timeline:o||new LL,resourceManager:this.resourceManager,onError:void 0},Object.seal(this)}finalize(){this.resourceManager.finalize();for(const e of this.layers)this._finalizeLayer(e)}needsRedraw(e={clearRedrawFlags:!1}){let t=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);for(const r of this.layers){const i=r.getNeedsRedraw(e);t=t||i}return t}needsUpdate(){return this._nextLayers&&this._nextLayers!==this._lastRenderedLayers?"layers changed":this._needsUpdate}setNeedsRedraw(e){this._needsRedraw=this._needsRedraw||e}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e}getLayers({layerIds:e}={}){return e?this.layers.filter(t=>e.find(r=>t.id.indexOf(r)===0)):this.layers}setProps(e){"debug"in e&&(this._debug=e.debug),"userData"in e&&(this.context.userData=e.userData),"layers"in e&&(this._nextLayers=e.layers),"onError"in e&&(this.context.onError=e.onError)}setLayers(e,t){oa(IZ,this,t,e),this._lastRenderedLayers=e;const r=eC(e,Boolean);for(const i of r)i.context=this.context;this._updateLayers(this.layers,r)}updateLayers(){const e=this.needsUpdate();e&&(this.setNeedsRedraw("updating layers: ".concat(e)),this.setLayers(this._nextLayers||this._lastRenderedLayers,e)),this._nextLayers=null}_handleError(e,t,r){r.raiseError(t,"".concat(e," of ").concat(r))}_updateLayers(e,t){const r={};for(const a of e)r[a.id]?Ir.warn("Multiple old layers with same id ".concat(a.id))():r[a.id]=a;const i=[];this._updateSublayersRecursively(t,r,i),this._finalizeOldLayers(r);let o=!1;for(const a of i)if(a.hasUniformTransition()){o="Uniform transition in ".concat(a);break}this._needsUpdate=o,this.layers=i}_updateSublayersRecursively(e,t,r){for(const i of e){i.context=this.context;const o=t[i.id];o===null&&Ir.warn("Multiple new layers with same id ".concat(i.id))(),t[i.id]=null;let a=null;try{this._debug&&o!==i&&i.validateProps(),o?(this._transferLayerState(o,i),this._updateLayer(i)):this._initializeLayer(i),r.push(i),a=i.isComposite?i.getSubLayers():null}catch(l){this._handleError("matching",l,i)}a&&this._updateSublayersRecursively(a,t,r)}}_finalizeOldLayers(e){for(const t in e){const r=e[t];r&&this._finalizeLayer(r)}}_initializeLayer(e){try{e._initialize(),e.lifecycle=Up.INITIALIZED}catch(t){this._handleError("initialization",t,e)}}_transferLayerState(e,t){t._transferState(e),t.lifecycle=Up.MATCHED,t!==e&&(e.lifecycle=Up.AWAITING_GC)}_updateLayer(e){try{e._update()}catch(t){this._handleError("update",t,e)}}_finalizeLayer(e){this._needsRedraw=this._needsRedraw||"finalized ".concat(e),e.lifecycle=Up.AWAITING_FINALIZATION;try{e._finalize(),e.lifecycle=Up.FINALIZED}catch(t){this._handleError("finalization",t,e)}}};function Hc(n,e,t){if(n===e)return!0;if(!t||!n||!e)return!1;if(Array.isArray(n)){if(!Array.isArray(e)||n.length!==e.length)return!1;for(let r=0;r<n.length;r++)if(!Hc(n[r],e[r],t-1))return!1;return!0}if(Array.isArray(e))return!1;if(typeof n=="object"&&typeof e=="object"){const r=Object.keys(n),i=Object.keys(e);if(r.length!==i.length)return!1;for(const o of r)if(!e.hasOwnProperty(o)||!Hc(n[o],e[o],t-1))return!1;return!0}return!1}class RZ{constructor(e){Y(this,"width",void 0),Y(this,"height",void 0),Y(this,"views",void 0),Y(this,"viewState",void 0),Y(this,"controllers",void 0),Y(this,"timeline",void 0),Y(this,"_viewports",void 0),Y(this,"_viewportMap",void 0),Y(this,"_isUpdating",void 0),Y(this,"_needsRedraw",void 0),Y(this,"_needsUpdate",void 0),Y(this,"_eventManager",void 0),Y(this,"_eventCallbacks",void 0),this.views=[],this.width=100,this.height=100,this.viewState={},this.controllers={},this.timeline=e.timeline,this._viewports=[],this._viewportMap={},this._isUpdating=!1,this._needsRedraw="First render",this._needsUpdate="Initialize",this._eventManager=e.eventManager,this._eventCallbacks={onViewStateChange:e.onViewStateChange,onInteractionStateChange:e.onInteractionStateChange},Object.seal(this),this.setProps(e)}finalize(){for(const e in this.controllers){const t=this.controllers[e];t&&t.finalize()}this.controllers={}}needsRedraw(e={clearRedrawFlags:!1}){const t=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),t}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e,this._needsRedraw=this._needsRedraw||e}updateViewStates(){for(const e in this.controllers){const t=this.controllers[e];t&&t.updateTransition()}}getViewports(e){return e?this._viewports.filter(t=>t.containsPixel(e)):this._viewports}getViews(){const e={};return this.views.forEach(t=>{e[t.id]=t}),e}getView(e){return this.views.find(t=>t.id===e)}getViewState(e){const t=typeof e=="string"?this.getView(e):e,r=t&&this.viewState[t.getViewStateId()]||this.viewState;return t?t.filterViewState(r):r}getViewport(e){return this._viewportMap[e]}unproject(e,t){const r=this.getViewports(),i={x:e[0],y:e[1]};for(let o=r.length-1;o>=0;--o){const a=r[o];if(a.containsPixel(i)){const l=e.slice();return l[0]-=a.x,l[1]-=a.y,a.unproject(l,t)}}return null}setProps(e){e.views&&this._setViews(e.views),e.viewState&&this._setViewState(e.viewState),("width"in e||"height"in e)&&this._setSize(e.width,e.height),this._isUpdating||this._update()}_update(){this._isUpdating=!0,this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._isUpdating=!1}_setSize(e,t){(e!==this.width||t!==this.height)&&(this.width=e,this.height=t,this.setNeedsUpdate("Size changed"))}_setViews(e){e=eC(e,Boolean),this._diffViews(e,this.views)&&this.setNeedsUpdate("views changed"),this.views=e}_setViewState(e){e?(!Hc(e,this.viewState,3)&&this.setNeedsUpdate("viewState changed"),this.viewState=e):Ir.warn("missing `viewState` or `initialViewState`")()}_onViewStateChange(e,t){this._eventCallbacks.onViewStateChange&&this._eventCallbacks.onViewStateChange({...t,viewId:e})}_createController(e,t){const r=t.type;return new r({timeline:this.timeline,eventManager:this._eventManager,onViewStateChange:this._onViewStateChange.bind(this,t.id),onStateChange:this._eventCallbacks.onInteractionStateChange,makeViewport:o=>{var a;return(a=this.getView(e.id))===null||a===void 0?void 0:a.makeViewport({viewState:o,width:this.width,height:this.height})}})}_updateController(e,t,r,i){const o=e.controller;if(o&&r){const a={...t,...o,id:e.id,x:r.x,y:r.y,width:r.width,height:r.height};return(!i||i.constructor!==o.type)&&(i=this._createController(e,a)),i&&i.setProps(a),i}return null}_rebuildViewports(){const{views:e}=this,t=this.controllers;this._viewports=[],this.controllers={};let r=!1;for(let i=e.length;i--;){const o=e[i],a=this.getViewState(o),l=o.makeViewport({viewState:a,width:this.width,height:this.height});let h=t[o.id];const p=!!o.controller;p&&!h&&(r=!0),(r||!p)&&h&&(h.finalize(),h=null),this.controllers[o.id]=this._updateController(o,a,l,h),l&&this._viewports.unshift(l)}for(const i in t){const o=t[i];o&&!this.controllers[i]&&o.finalize()}this._buildViewportMap()}_buildViewportMap(){this._viewportMap={},this._viewports.forEach(e=>{e.id&&(this._viewportMap[e.id]=this._viewportMap[e.id]||e)})}_diffViews(e,t){return e.length!==t.length?!0:e.some((r,i)=>!e[i].equals(t[i]))}}const kZ=/([0-9]+\.?[0-9]*)(%|px)/;function Ku(n){switch(typeof n){case"number":return{position:n,relative:!1};case"string":const e=kZ.exec(n);if(e&&e.length>=3){const t=e[2]==="%",r=parseFloat(e[1]);return{position:t?r/100:r,relative:t}}default:throw new Error("Could not parse position string ".concat(n))}}function Zu(n,e){return n.relative?Math.round(n.position*e):n.position}function Vo(n,e){if(!n)throw new Error(e||"deck.gl: assertion failed.")}class OZ{constructor(e){Y(this,"id",void 0),Y(this,"viewportInstance",void 0),Y(this,"_x",void 0),Y(this,"_y",void 0),Y(this,"_width",void 0),Y(this,"_height",void 0),Y(this,"_padding",void 0),Y(this,"props",void 0);const{id:t,x:r=0,y:i=0,width:o="100%",height:a="100%",padding:l=null,viewportInstance:h}=e||{};Vo(!h||h instanceof Fp),this.viewportInstance=h,this.id=t||this.constructor.displayName||"view",this.props={...e,id:this.id},this._x=Ku(r),this._y=Ku(i),this._width=Ku(o),this._height=Ku(a),this._padding=l&&{left:Ku(l.left||0),right:Ku(l.right||0),top:Ku(l.top||0),bottom:Ku(l.bottom||0)},this.equals=this.equals.bind(this),Object.seal(this)}equals(e){return this===e?!0:this.viewportInstance?e.viewportInstance?this.viewportInstance.equals(e.viewportInstance):!1:this.ViewportType===e.ViewportType&&Hc(this.props,e.props,2)}makeViewport({width:e,height:t,viewState:r}){if(this.viewportInstance)return this.viewportInstance;r=this.filterViewState(r);const i=this.getDimensions({width:e,height:t});return!i.height||!i.width?null:new this.ViewportType({...r,...this.props,...i})}getViewStateId(){const{viewState:e}=this.props;return typeof e=="string"?e:(e==null?void 0:e.id)||this.id}filterViewState(e){if(this.props.viewState&&typeof this.props.viewState=="object"){if(!this.props.viewState.id)return this.props.viewState;const t={...e};for(const r in this.props.viewState)r!=="id"&&(t[r]=this.props.viewState[r]);return t}return e}getDimensions({width:e,height:t}){const r={x:Zu(this._x,e),y:Zu(this._y,t),width:Zu(this._width,e),height:Zu(this._height,t)};return this._padding&&(r.padding={left:Zu(this._padding.left,e),top:Zu(this._padding.top,t),right:Zu(this._padding.right,e),bottom:Zu(this._padding.bottom,t)}),r}get controller(){const e=this.props.controller;return e?e===!0?{type:this.ControllerType}:typeof e=="function"?{type:e}:{type:this.ControllerType,...e}:null}}class e_{constructor(e){Y(this,"_inProgress",void 0),Y(this,"_handle",void 0),Y(this,"_timeline",void 0),Y(this,"time",void 0),Y(this,"settings",void 0),this._inProgress=!1,this._handle=null,this._timeline=e,this.time=0,this.settings={duration:0}}get inProgress(){return this._inProgress}start(e){var t,r;this.cancel(),this.settings=e,this._inProgress=!0,(t=(r=this.settings).onStart)===null||t===void 0||t.call(r,this)}end(){if(this._inProgress){var e,t;this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1,(e=(t=this.settings).onEnd)===null||e===void 0||e.call(t,this)}}cancel(){if(this._inProgress){var e,t;(e=(t=this.settings).onInterrupt)===null||e===void 0||e.call(t,this),this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1}}update(){var e,t;if(!this._inProgress)return!1;if(this._handle===null){const{_timeline:r,settings:i}=this;this._handle=r.addChannel({delay:r.getTime(),duration:i.duration})}return this.time=this._timeline.getTime(this._handle),this._onUpdate(),(e=(t=this.settings).onUpdate)===null||e===void 0||e.call(t,this),this._timeline.isFinished(this._handle)&&this.end(),!0}_onUpdate(){}}const sN=()=>{},tC={BREAK:1,SNAP_TO_END:2,IGNORE:3},LZ=n=>n,NZ=tC.BREAK;class DZ{constructor(e){Y(this,"getControllerState",void 0),Y(this,"props",void 0),Y(this,"propsInTransition",void 0),Y(this,"transition",void 0),Y(this,"onViewStateChange",void 0),Y(this,"onStateChange",void 0),Y(this,"_onTransitionUpdate",t=>{const{time:r,settings:{interpolator:i,startProps:o,endProps:a,duration:l,easing:h}}=t,p=h(r/l),g=i.interpolateProps(o,a,p);this.propsInTransition=this.getControllerState({...this.props,...g}).getViewportProps(),this.onViewStateChange({viewState:this.propsInTransition,oldViewState:this.props})}),this.getControllerState=e.getControllerState,this.propsInTransition=null,this.transition=new e_(e.timeline),this.onViewStateChange=e.onViewStateChange||sN,this.onStateChange=e.onStateChange||sN}finalize(){this.transition.cancel()}getViewportInTransition(){return this.propsInTransition}processViewStateChange(e){let t=!1;const r=this.props;if(this.props=e,!r||this._shouldIgnoreViewportChange(r,e))return!1;if(this._isTransitionEnabled(e)){let i=r;if(this.transition.inProgress){const{interruption:o,endProps:a}=this.transition.settings;i={...r,...o===tC.SNAP_TO_END?a:this.propsInTransition||r}}this._triggerTransition(i,e),t=!0}else this.transition.cancel();return t}updateTransition(){this.transition.update()}_isTransitionEnabled(e){const{transitionDuration:t,transitionInterpolator:r}=e;return(t>0||t==="auto")&&!!r}_isUpdateDueToCurrentTransition(e){return this.transition.inProgress&&this.propsInTransition?this.transition.settings.interpolator.arePropsEqual(e,this.propsInTransition):!1}_shouldIgnoreViewportChange(e,t){return this.transition.inProgress?this.transition.settings.interruption===tC.IGNORE||this._isUpdateDueToCurrentTransition(t):this._isTransitionEnabled(t)?t.transitionInterpolator.arePropsEqual(e,t):!0}_triggerTransition(e,t){const r=this.getControllerState(e),i=this.getControllerState(t).shortestPathFrom(r),o=t.transitionInterpolator,a=o.getDuration?o.getDuration(e,t):t.transitionDuration;if(a===0)return;const l=o.initializeProps(e,i);this.propsInTransition={};const h={duration:a,easing:t.transitionEasing||LZ,interpolator:o,interruption:t.transitionInterruption||NZ,startProps:l.start,endProps:l.end,onStart:t.onTransitionStart,onUpdate:this._onTransitionUpdate,onInterrupt:this._onTransitionEnd(t.onTransitionInterrupt),onEnd:this._onTransitionEnd(t.onTransitionEnd)};this.transition.start(h),this.onStateChange({inTransition:!0}),this.updateTransition()}_onTransitionEnd(e){return t=>{this.propsInTransition=null,this.onStateChange({inTransition:!1,isZooming:!1,isPanning:!1,isRotating:!1}),e==null||e(t)}}}class FZ{constructor(e){Y(this,"_propsToCompare",void 0),Y(this,"_propsToExtract",void 0),Y(this,"_requiredProps",void 0);const{compare:t,extract:r,required:i}=e;this._propsToCompare=t,this._propsToExtract=r||t,this._requiredProps=i}arePropsEqual(e,t){for(const r of this._propsToCompare)if(!(r in e)||!(r in t)||!qy(e[r],t[r]))return!1;return!0}initializeProps(e,t){const r={},i={};for(const o of this._propsToExtract)(o in e||o in t)&&(r[o]=e[o],i[o]=t[o]);return this._checkRequiredProps(r),this._checkRequiredProps(i),{start:r,end:i}}getDuration(e,t){return t.transitionDuration}_checkRequiredProps(e){this._requiredProps&&this._requiredProps.forEach(t=>{const r=e[t];Vo(Number.isFinite(r)||Array.isArray(r),"".concat(t," is required for transition"))})}}const BZ=["longitude","latitude","zoom","bearing","pitch"],UZ=["longitude","latitude","zoom"];class cN extends FZ{constructor(e={}){const t=Array.isArray(e)?e:e.transitionProps,r=Array.isArray(e)?{}:e;r.transitionProps=Array.isArray(t)?{compare:t,required:t}:t||{compare:BZ,required:UZ},super(r.transitionProps),Y(this,"opts",void 0),this.opts=r}initializeProps(e,t){const r=super.initializeProps(e,t),{makeViewport:i,around:o}=this.opts;if(i&&o){const a=i(e),l=i(t),h=a.unproject(o);r.start.around=o,Object.assign(r.end,{around:l.project(h),aroundPosition:h,width:t.width,height:t.height})}return r}interpolateProps(e,t,r){const i={};for(const o of this._propsToExtract)i[o]=Kb(e[o]||0,t[o]||0,r);if(t.aroundPosition&&this.opts.makeViewport){const o=this.opts.makeViewport({...t,...i});Object.assign(i,o.panByPosition(t.aroundPosition,Kb(e.around,t.around,r)))}return i}}const Xu={transitionDuration:0},zZ=300,c1=n=>1-(1-n)*(1-n),Hp={WHEEL:["wheel"],PAN:["panstart","panmove","panend"],PINCH:["pinchstart","pinchmove","pinchend"],TRIPLE_PAN:["tripanstart","tripanmove","tripanend"],DOUBLE_TAP:["doubletap"],KEYBOARD:["keydown"]},Pd={};class jZ{constructor(e){Y(this,"props",void 0),Y(this,"state",{}),Y(this,"transitionManager",void 0),Y(this,"eventManager",void 0),Y(this,"onViewStateChange",void 0),Y(this,"onStateChange",void 0),Y(this,"makeViewport",void 0),Y(this,"_controllerState",void 0),Y(this,"_events",{}),Y(this,"_interactionState",{isDragging:!1}),Y(this,"_customEvents",[]),Y(this,"_eventStartBlocked",null),Y(this,"_panMove",!1),Y(this,"invertPan",!1),Y(this,"dragMode","rotate"),Y(this,"inertia",0),Y(this,"scrollZoom",!0),Y(this,"dragPan",!0),Y(this,"dragRotate",!0),Y(this,"doubleClickZoom",!0),Y(this,"touchZoom",!0),Y(this,"touchRotate",!1),Y(this,"keyboard",!0),this.transitionManager=new DZ({...e,getControllerState:t=>new this.ControllerState(t),onViewStateChange:this._onTransition.bind(this),onStateChange:this._setInteractionState.bind(this)}),this.handleEvent=this.handleEvent.bind(this),this.eventManager=e.eventManager,this.onViewStateChange=e.onViewStateChange||(()=>{}),this.onStateChange=e.onStateChange||(()=>{}),this.makeViewport=e.makeViewport}set events(e){this.toggleEvents(this._customEvents,!1),this.toggleEvents(e,!0),this._customEvents=e,this.props&&this.setProps(this.props)}finalize(){for(const t in this._events)if(this._events[t]){var e;(e=this.eventManager)===null||e===void 0||e.off(t,this.handleEvent)}this.transitionManager.finalize()}handleEvent(e){this._controllerState=void 0;const t=this._eventStartBlocked;switch(e.type){case"panstart":return t?!1:this._onPanStart(e);case"panmove":return this._onPan(e);case"panend":return this._onPanEnd(e);case"pinchstart":return t?!1:this._onPinchStart(e);case"pinchmove":return this._onPinch(e);case"pinchend":return this._onPinchEnd(e);case"tripanstart":return t?!1:this._onTriplePanStart(e);case"tripanmove":return this._onTriplePan(e);case"tripanend":return this._onTriplePanEnd(e);case"doubletap":return this._onDoubleTap(e);case"wheel":return this._onWheel(e);case"keydown":return this._onKeyDown(e);default:return!1}}get controllerState(){return this._controllerState=this._controllerState||new this.ControllerState({makeViewport:this.makeViewport,...this.props,...this.state}),this._controllerState}getCenter(e){const{x:t,y:r}=this.props,{offsetCenter:i}=e;return[i.x-t,i.y-r]}isPointInBounds(e,t){const{width:r,height:i}=this.props;if(t&&t.handled)return!1;const o=e[0]>=0&&e[0]<=r&&e[1]>=0&&e[1]<=i;return o&&t&&t.stopPropagation(),o}isFunctionKeyPressed(e){const{srcEvent:t}=e;return!!(t.metaKey||t.altKey||t.ctrlKey||t.shiftKey)}isDragging(){return this._interactionState.isDragging||!1}blockEvents(e){const t=setTimeout(()=>{this._eventStartBlocked===t&&(this._eventStartBlocked=null)},e);this._eventStartBlocked=t}setProps(e){e.dragMode&&(this.dragMode=e.dragMode),this.props=e,"transitionInterpolator"in e||(e.transitionInterpolator=this._getTransitionProps().transitionInterpolator),this.transitionManager.processViewStateChange(e);const{inertia:t}=e;this.inertia=Number.isFinite(t)?t:t===!0?zZ:0;const{scrollZoom:r=!0,dragPan:i=!0,dragRotate:o=!0,doubleClickZoom:a=!0,touchZoom:l=!0,touchRotate:h=!1,keyboard:p=!0}=e,g=!!this.onViewStateChange;this.toggleEvents(Hp.WHEEL,g&&r),this.toggleEvents(Hp.PAN,g),this.toggleEvents(Hp.PINCH,g&&(l||h)),this.toggleEvents(Hp.TRIPLE_PAN,g&&h),this.toggleEvents(Hp.DOUBLE_TAP,g&&a),this.toggleEvents(Hp.KEYBOARD,g&&p),this.scrollZoom=r,this.dragPan=i,this.dragRotate=o,this.doubleClickZoom=a,this.touchZoom=l,this.touchRotate=h,this.keyboard=p}updateTransition(){this.transitionManager.updateTransition()}toggleEvents(e,t){this.eventManager&&e.forEach(r=>{this._events[r]!==t&&(this._events[r]=t,t?this.eventManager.on(r,this.handleEvent):this.eventManager.off(r,this.handleEvent))})}updateViewport(e,t=null,r={}){const i={...e.getViewportProps(),...t},o=this.controllerState!==e;if(this.state=e.getState(),this._setInteractionState(r),o){const a=this.controllerState&&this.controllerState.getViewportProps();this.onViewStateChange&&this.onViewStateChange({viewState:i,interactionState:this._interactionState,oldViewState:a})}}_onTransition(e){this.onViewStateChange({...e,interactionState:this._interactionState})}_setInteractionState(e){Object.assign(this._interactionState,e),this.onStateChange(this._interactionState)}_onPanStart(e){const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;let r=this.isFunctionKeyPressed(e)||e.rightButton||!1;(this.invertPan||this.dragMode==="pan")&&(r=!r);const i=this.controllerState[r?"panStart":"rotateStart"]({pos:t});return this._panMove=r,this.updateViewport(i,Xu,{isDragging:!0}),!0}_onPan(e){return this.isDragging()?this._panMove?this._onPanMove(e):this._onPanRotate(e):!1}_onPanEnd(e){return this.isDragging()?this._panMove?this._onPanMoveEnd(e):this._onPanRotateEnd(e):!1}_onPanMove(e){if(!this.dragPan)return!1;const t=this.getCenter(e),r=this.controllerState.pan({pos:t});return this.updateViewport(r,Xu,{isDragging:!0,isPanning:!0}),!0}_onPanMoveEnd(e){const{inertia:t}=this;if(this.dragPan&&t&&e.velocity){const r=this.getCenter(e),i=[r[0]+e.velocityX*t/2,r[1]+e.velocityY*t/2],o=this.controllerState.pan({pos:i}).panEnd();this.updateViewport(o,{...this._getTransitionProps(),transitionDuration:t,transitionEasing:c1},{isDragging:!1,isPanning:!0})}else{const r=this.controllerState.panEnd();this.updateViewport(r,null,{isDragging:!1,isPanning:!1})}return!0}_onPanRotate(e){if(!this.dragRotate)return!1;const t=this.getCenter(e),r=this.controllerState.rotate({pos:t});return this.updateViewport(r,Xu,{isDragging:!0,isRotating:!0}),!0}_onPanRotateEnd(e){const{inertia:t}=this;if(this.dragRotate&&t&&e.velocity){const r=this.getCenter(e),i=[r[0]+e.velocityX*t/2,r[1]+e.velocityY*t/2],o=this.controllerState.rotate({pos:i}).rotateEnd();this.updateViewport(o,{...this._getTransitionProps(),transitionDuration:t,transitionEasing:c1},{isDragging:!1,isRotating:!0})}else{const r=this.controllerState.rotateEnd();this.updateViewport(r,null,{isDragging:!1,isRotating:!1})}return!0}_onWheel(e){if(!this.scrollZoom)return!1;const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;e.srcEvent.preventDefault();const{speed:r=.01,smooth:i=!1}=this.scrollZoom===!0?{}:this.scrollZoom,{delta:o}=e;let a=2/(1+Math.exp(-Math.abs(o*r)));o<0&&a!==0&&(a=1/a);const l=this.controllerState.zoom({pos:t,scale:a});return this.updateViewport(l,{...this._getTransitionProps({around:t}),transitionDuration:i?250:1},{isZooming:!0,isPanning:!0}),!0}_onTriplePanStart(e){const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;const r=this.controllerState.rotateStart({pos:t});return this.updateViewport(r,Xu,{isDragging:!0}),!0}_onTriplePan(e){if(!this.touchRotate||!this.isDragging())return!1;const t=this.getCenter(e);t[0]-=e.deltaX;const r=this.controllerState.rotate({pos:t});return this.updateViewport(r,Xu,{isDragging:!0,isRotating:!0}),!0}_onTriplePanEnd(e){if(!this.isDragging())return!1;const{inertia:t}=this;if(this.touchRotate&&t&&e.velocityY){const r=this.getCenter(e),i=[r[0],r[1]+=e.velocityY*t/2],o=this.controllerState.rotate({pos:i});this.updateViewport(o,{...this._getTransitionProps(),transitionDuration:t,transitionEasing:c1},{isDragging:!1,isRotating:!0}),this.blockEvents(t)}else{const r=this.controllerState.rotateEnd();this.updateViewport(r,null,{isDragging:!1,isRotating:!1})}return!0}_onPinchStart(e){const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;const r=this.controllerState.zoomStart({pos:t}).rotateStart({pos:t});return Pd._startPinchRotation=e.rotation,Pd._lastPinchEvent=e,this.updateViewport(r,Xu,{isDragging:!0}),!0}_onPinch(e){if(!this.touchZoom&&!this.touchRotate||!this.isDragging())return!1;let t=this.controllerState;if(this.touchZoom){const{scale:r}=e,i=this.getCenter(e);t=t.zoom({pos:i,scale:r})}if(this.touchRotate){const{rotation:r}=e;t=t.rotate({deltaAngleX:Pd._startPinchRotation-r})}return this.updateViewport(t,Xu,{isDragging:!0,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:this.touchRotate}),Pd._lastPinchEvent=e,!0}_onPinchEnd(e){if(!this.isDragging())return!1;const{inertia:t}=this,{_lastPinchEvent:r}=Pd;if(this.touchZoom&&t&&r&&e.scale!==r.scale){const i=this.getCenter(e);let o=this.controllerState.rotateEnd();const a=Math.log2(e.scale),l=(a-Math.log2(r.scale))/(e.deltaTime-r.deltaTime),h=Math.pow(2,a+l*t/2);o=o.zoom({pos:i,scale:h}).zoomEnd(),this.updateViewport(o,{...this._getTransitionProps({around:i}),transitionDuration:t,transitionEasing:c1},{isDragging:!1,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:!1}),this.blockEvents(t)}else{const i=this.controllerState.zoomEnd().rotateEnd();this.updateViewport(i,null,{isDragging:!1,isPanning:!1,isZooming:!1,isRotating:!1})}return Pd._startPinchRotation=null,Pd._lastPinchEvent=null,!0}_onDoubleTap(e){if(!this.doubleClickZoom)return!1;const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;const r=this.isFunctionKeyPressed(e),i=this.controllerState.zoom({pos:t,scale:r?.5:2});return this.updateViewport(i,this._getTransitionProps({around:t}),{isZooming:!0,isPanning:!0}),this.blockEvents(100),!0}_onKeyDown(e){if(!this.keyboard)return!1;const t=this.isFunctionKeyPressed(e),{zoomSpeed:r,moveSpeed:i,rotateSpeedX:o,rotateSpeedY:a}=this.keyboard===!0?{}:this.keyboard,{controllerState:l}=this;let h;const p={};switch(e.srcEvent.code){case"Minus":h=t?l.zoomOut(r).zoomOut(r):l.zoomOut(r),p.isZooming=!0;break;case"Equal":h=t?l.zoomIn(r).zoomIn(r):l.zoomIn(r),p.isZooming=!0;break;case"ArrowLeft":t?(h=l.rotateLeft(o),p.isRotating=!0):(h=l.moveLeft(i),p.isPanning=!0);break;case"ArrowRight":t?(h=l.rotateRight(o),p.isRotating=!0):(h=l.moveRight(i),p.isPanning=!0);break;case"ArrowUp":t?(h=l.rotateUp(a),p.isRotating=!0):(h=l.moveUp(i),p.isPanning=!0);break;case"ArrowDown":t?(h=l.rotateDown(a),p.isRotating=!0):(h=l.moveDown(i),p.isPanning=!0);break;default:return!1}return this.updateViewport(h,this._getTransitionProps(),p),!0}_getTransitionProps(e){const{transition:t}=this;return!t||!t.transitionInterpolator?Xu:e?{...t,transitionInterpolator:new cN({...e,...t.transitionInterpolator.opts,makeViewport:this.controllerState.makeViewport})}:t}}class VZ{constructor(e,t){Y(this,"_viewportProps",void 0),Y(this,"_state",void 0),this._viewportProps=this.applyConstraints(e),this._state=t}getViewportProps(){return this._viewportProps}getState(){return this._state}}const lN=5,HZ=1.2;class GZ extends VZ{constructor(e){const{width:t,height:r,latitude:i,longitude:o,zoom:a,bearing:l=0,pitch:h=0,altitude:p=1.5,position:g=[0,0,0],maxZoom:_=20,minZoom:x=0,maxPitch:C=60,minPitch:M=0,startPanLngLat:L,startZoomLngLat:F,startRotatePos:z,startBearing:ee,startPitch:ce,startZoom:se,normalize:_e=!0}=e;Vo(Number.isFinite(o)),Vo(Number.isFinite(i)),Vo(Number.isFinite(a)),super({width:t,height:r,latitude:i,longitude:o,zoom:a,bearing:l,pitch:h,altitude:p,maxZoom:_,minZoom:x,maxPitch:C,minPitch:M,normalize:_e,position:g},{startPanLngLat:L,startZoomLngLat:F,startRotatePos:z,startBearing:ee,startPitch:ce,startZoom:se}),Y(this,"makeViewport",void 0),this.makeViewport=e.makeViewport}panStart({pos:e}){return this._getUpdatedState({startPanLngLat:this._unproject(e)})}pan({pos:e,startPos:t}){const r=this.getState().startPanLngLat||this._unproject(t);if(!r)return this;const o=this.makeViewport(this.getViewportProps()).panByPosition(r,e);return this._getUpdatedState(o)}panEnd(){return this._getUpdatedState({startPanLngLat:null})}rotateStart({pos:e}){return this._getUpdatedState({startRotatePos:e,startBearing:this.getViewportProps().bearing,startPitch:this.getViewportProps().pitch})}rotate({pos:e,deltaAngleX:t=0,deltaAngleY:r=0}){const{startRotatePos:i,startBearing:o,startPitch:a}=this.getState();if(!i||o===void 0||a===void 0)return this;let l;return e?l=this._getNewRotation(e,i,a,o):l={bearing:o+t,pitch:a+r},this._getUpdatedState(l)}rotateEnd(){return this._getUpdatedState({startBearing:null,startPitch:null})}zoomStart({pos:e}){return this._getUpdatedState({startZoomLngLat:this._unproject(e),startZoom:this.getViewportProps().zoom})}zoom({pos:e,startPos:t,scale:r}){let{startZoom:i,startZoomLngLat:o}=this.getState();if(o||(i=this.getViewportProps().zoom,o=this._unproject(t)||this._unproject(e)),!o)return this;const{maxZoom:a,minZoom:l}=this.getViewportProps();let h=i+Math.log2(r);h=qu(h,l,a);const p=this.makeViewport({...this.getViewportProps(),zoom:h});return this._getUpdatedState({zoom:h,...p.panByPosition(o,e)})}zoomEnd(){return this._getUpdatedState({startZoomLngLat:null,startZoom:null})}zoomIn(e=2){return this._zoomFromCenter(e)}zoomOut(e=2){return this._zoomFromCenter(1/e)}moveLeft(e=100){return this._panFromCenter([e,0])}moveRight(e=100){return this._panFromCenter([-e,0])}moveUp(e=100){return this._panFromCenter([0,e])}moveDown(e=100){return this._panFromCenter([0,-e])}rotateLeft(e=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing-e})}rotateRight(e=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing+e})}rotateUp(e=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch+e})}rotateDown(e=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch-e})}shortestPathFrom(e){const t=e.getViewportProps(),r={...this.getViewportProps()},{bearing:i,longitude:o}=r;return Math.abs(i-t.bearing)>180&&(r.bearing=i<0?i+360:i-360),Math.abs(o-t.longitude)>180&&(r.longitude=o<0?o+360:o-360),r}applyConstraints(e){const{maxZoom:t,minZoom:r,zoom:i}=e;e.zoom=qu(i,r,t);const{maxPitch:o,minPitch:a,pitch:l}=e;e.pitch=qu(l,a,o);const{normalize:h=!0}=e;return h&&Object.assign(e,ZK(e)),e}_zoomFromCenter(e){const{width:t,height:r}=this.getViewportProps();return this.zoom({pos:[t/2,r/2],scale:e})}_panFromCenter(e){const{width:t,height:r}=this.getViewportProps();return this.pan({startPos:[t/2,r/2],pos:[t/2+e[0],r/2+e[1]]})}_getUpdatedState(e){return new this.constructor({makeViewport:this.makeViewport,...this.getViewportProps(),...this.getState(),...e})}_unproject(e){const t=this.makeViewport(this.getViewportProps());return e&&t.unproject(e)}_getNewRotation(e,t,r,i){const o=e[0]-t[0],a=e[1]-t[1],l=e[1],h=t[1],{width:p,height:g}=this.getViewportProps(),_=o/p;let x=0;a>0?Math.abs(g-h)>lN&&(x=a/(h-g)*HZ):a<0&&h>lN&&(x=1-l/h),x=qu(x,-1,1);const{minPitch:C,maxPitch:M}=this.getViewportProps(),L=i+180*_;let F=r;return x>0?F=r+x*(M-r):x<0&&(F=r-x*(C-r)),{pitch:F,bearing:L}}}class qZ extends jZ{constructor(...e){super(...e),Y(this,"ControllerState",GZ),Y(this,"transition",{transitionDuration:300,transitionInterpolator:new cN({transitionProps:{compare:["longitude","latitude","zoom","bearing","pitch","position"],required:["longitude","latitude","zoom"]}})}),Y(this,"dragMode","pan")}setProps(e){e.position=e.position||[0,0,0];const t=this.props;super.setProps(e),(!t||t.height!==e.height)&&this.updateViewport(new this.ControllerState({makeViewport:this.makeViewport,...e,...this.state}))}}class uN extends OZ{get ViewportType(){return Bp}get ControllerType(){return qZ}}Y(uN,"displayName","MapView");const $Z=new JL;function WZ(n,e){var t,r;const i=(t=n.order)!==null&&t!==void 0?t:1/0,o=(r=e.order)!==null&&r!==void 0?r:1/0;return i-o}class YZ{constructor(){Y(this,"effects",void 0),Y(this,"_resolvedEffects",[]),Y(this,"_defaultEffects",[]),Y(this,"_needsRedraw",void 0),this.effects=[],this._needsRedraw="Initial render",this._setEffects([])}addDefaultEffect(e){const t=this._defaultEffects;if(!t.find(r=>r.id===e.id)){const r=t.findIndex(i=>WZ(i,e)>0);r<0?t.push(e):t.splice(r,0,e),this._setEffects(this.effects)}}setProps(e){"effects"in e&&(Hc(e.effects,this.effects,1)||this._setEffects(e.effects))}needsRedraw(e={clearRedrawFlags:!1}){const t=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),t}getEffects(){return this._resolvedEffects}_setEffects(e){const t={};for(const i of this.effects)t[i.id]=i;const r=[];for(const i of e){const o=t[i.id];o&&o!==i?o.setProps?(o.setProps(i.props),r.push(o)):(o.cleanup(),r.push(i)):r.push(i),delete t[i.id]}for(const i in t)t[i].cleanup();this.effects=r,this._resolvedEffects=r.concat(this._defaultEffects),e.some(i=>i instanceof JL)||this._resolvedEffects.push($Z),this._needsRedraw="effects changed"}finalize(){for(const e of this._resolvedEffects)e.cleanup();this.effects.length=0,this._resolvedEffects.length=0,this._defaultEffects.length=0}}class KZ extends jS{shouldDrawLayer(e){const{operation:t}=e.props;return t.includes("draw")||t.includes("terrain")}}const ZZ="deckRenderer.renderLayers";class XZ{constructor(e){Y(this,"gl",void 0),Y(this,"layerFilter",void 0),Y(this,"drawPickingColors",void 0),Y(this,"drawLayersPass",void 0),Y(this,"pickLayersPass",void 0),Y(this,"renderCount",void 0),Y(this,"_needsRedraw",void 0),Y(this,"renderBuffers",void 0),Y(this,"lastPostProcessEffect",void 0),this.gl=e,this.layerFilter=null,this.drawPickingColors=!1,this.drawLayersPass=new KZ(e),this.pickLayersPass=new oN(e),this.renderCount=0,this._needsRedraw="Initial render",this.renderBuffers=[],this.lastPostProcessEffect=null}setProps(e){this.layerFilter!==e.layerFilter&&(this.layerFilter=e.layerFilter,this._needsRedraw="layerFilter changed"),this.drawPickingColors!==e.drawPickingColors&&(this.drawPickingColors=e.drawPickingColors,this._needsRedraw="drawPickingColors changed")}renderLayers(e){if(!e.viewports.length)return;const t=this.drawPickingColors?this.pickLayersPass:this.drawLayersPass,r={layerFilter:this.layerFilter,isPicking:this.drawPickingColors,...e,target:e.target||_o.getDefaultFramebuffer(this.gl)};r.effects&&this._preRender(r.effects,r);const i=this.lastPostProcessEffect?this.renderBuffers[0]:r.target,o=t.render({...r,target:i});r.effects&&this._postRender(r.effects,r),this.renderCount++,oa(ZZ,this,o,e)}needsRedraw(e={clearRedrawFlags:!1}){const t=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),t}finalize(){const{renderBuffers:e}=this;for(const t of e)t.delete();e.length=0}_preRender(e,t){this.lastPostProcessEffect=null,t.preRenderStats=t.preRenderStats||{};for(const r of e)t.preRenderStats[r.id]=r.preRender(this.gl,t),r.postRender&&(this.lastPostProcessEffect=r.id);this.lastPostProcessEffect&&this._resizeRenderBuffers()}_resizeRenderBuffers(){const{renderBuffers:e}=this;e.length===0&&e.push(new _o(this.gl),new _o(this.gl));for(const t of e)t.resize()}_postRender(e,t){const{renderBuffers:r}=this,i={...t,inputBuffer:r[0],swapBuffer:r[1],target:null};for(const o of e)if(o.postRender){if(o.id===this.lastPostProcessEffect){i.target=t.target,o.postRender(this.gl,i);break}const a=o.postRender(this.gl,i);i.inputBuffer=a,i.swapBuffer=a===r[0]?r[1]:r[0]}}}const QZ={pickedColor:null,pickedObjectIndex:-1};function JZ({pickedColors:n,decodePickingColor:e,deviceX:t,deviceY:r,deviceRadius:i,deviceRect:o}){const{x:a,y:l,width:h,height:p}=o;let g=i*i,_=-1,x=0;for(let C=0;C<p;C++){const M=C+l-r,L=M*M;if(L>g)x+=4*h;else for(let F=0;F<h;F++){if(n[x+3]-1>=0){const ee=F+a-t,ce=ee*ee+L;ce<=g&&(g=ce,_=x)}x+=4}}if(_>=0){const C=n.slice(_,_+4),M=e(C);if(M){const L=Math.floor(_/4/h),F=_/4-L*h;return{...M,pickedColor:C,pickedX:a+F,pickedY:l+L}}Ir.error("Picked non-existent layer. Is picking buffer corrupt?")()}return QZ}function eX({pickedColors:n,decodePickingColor:e}){const t=new Map;if(n){for(let r=0;r<n.length;r+=4)if(n[r+3]-1>=0){const o=n.slice(r,r+4),a=o.join(",");if(!t.has(a)){const l=e(o);l?t.set(a,{...l,color:o}):Ir.error("Picked non-existent layer. Is picking buffer corrupt?")()}}}return Array.from(t.values())}function hN({pickInfo:n,viewports:e,pixelRatio:t,x:r,y:i,z:o}){let a=e[0];e.length>1&&(a=nX((n==null?void 0:n.pickedViewports)||e,{x:r,y:i}));let l;if(a){const h=[r-a.x,i-a.y];o!==void 0&&(h[2]=o),l=a.unproject(h)}return{color:null,layer:null,viewport:a,index:-1,picked:!1,x:r,y:i,pixel:[r,i],coordinate:l,devicePixel:n&&"pickedX"in n?[n.pickedX,n.pickedY]:void 0,pixelRatio:t}}function tX(n){const{pickInfo:e,lastPickedInfo:t,mode:r,layers:i}=n,{pickedColor:o,pickedLayer:a,pickedObjectIndex:l}=e,h=a?[a]:[];if(r==="hover"){const _=t.index,x=t.layerId,C=a?a.props.id:null;if(C!==x||l!==_){if(C!==x){const M=i.find(L=>L.props.id===x);M&&h.unshift(M)}t.layerId=C,t.index=l,t.info=null}}const p=hN(n),g=new Map;return g.set(null,p),h.forEach(_=>{let x={...p};_===a&&(x.color=o,x.index=l,x.picked=!0),x=dN({layer:_,info:x,mode:r});const C=x.layer;_===a&&r==="hover"&&(t.info=x),g.set(C.id,x),r==="hover"&&C.updateAutoHighlight(x)}),g}function dN({layer:n,info:e,mode:t}){for(;n&&e;){const r=e.layer||null;e.sourceLayer=r,e.layer=n,e=n.getPickingInfo({info:e,mode:t,sourceLayer:r}),n=n.parent}return e}function nX(n,e){for(let t=n.length-1;t>=0;t--){const r=n[t];if(r.containsPixel(e))return r}return n[0]}class rX{constructor(e){Y(this,"gl",void 0),Y(this,"pickingFBO",void 0),Y(this,"depthFBO",void 0),Y(this,"pickLayersPass",void 0),Y(this,"layerFilter",void 0),Y(this,"lastPickedInfo",void 0),Y(this,"_pickable",!0),this.gl=e,this.pickLayersPass=new oN(e),this.lastPickedInfo={index:-1,layerId:null,info:null}}setProps(e){"layerFilter"in e&&(this.layerFilter=e.layerFilter),"_pickable"in e&&(this._pickable=e._pickable)}finalize(){this.pickingFBO&&this.pickingFBO.delete(),this.depthFBO&&(this.depthFBO.color.delete(),this.depthFBO.delete())}pickObject(e){return this._pickClosestObject(e)}pickObjects(e){return this._pickVisibleObjects(e)}getLastPickedObject({x:e,y:t,layers:r,viewports:i},o=this.lastPickedInfo.info){const a=o&&o.layer&&o.layer.id,l=o&&o.viewport&&o.viewport.id,h=a?r.find(x=>x.id===a):null,p=l&&i.find(x=>x.id===l)||i[0],g=p&&p.unproject([e-p.x,t-p.y]);return{...o,...{x:e,y:t,viewport:p,coordinate:g,layer:h}}}_resizeBuffer(){var e,t;const{gl:r}=this;if(!this.pickingFBO&&(this.pickingFBO=new _o(r),_o.isSupported(r,{colorBufferFloat:!0}))){const i=new _o(r);i.attach({36064:new fs(r,{format:yr(r)?34836:6408,type:5126})}),this.depthFBO=i}(e=this.pickingFBO)===null||e===void 0||e.resize({width:r.canvas.width,height:r.canvas.height}),(t=this.depthFBO)===null||t===void 0||t.resize({width:r.canvas.width,height:r.canvas.height})}_getPickable(e){if(this._pickable===!1)return null;const t=e.filter(r=>this.pickLayersPass.shouldDrawLayer(r)&&!r.isComposite);return t.length?t:null}_pickClosestObject({layers:e,views:t,viewports:r,x:i,y:o,radius:a=0,depth:l=1,mode:h="query",unproject3D:p,onViewportActive:g,effects:_}){const x=this._getPickable(e),C=Tp(this.gl);if(!x)return{result:[],emptyInfo:hN({viewports:r,x:i,y:o,pixelRatio:C})};this._resizeBuffer();const M=dS(this.gl,[i,o],!0),L=[M.x+Math.floor(M.width/2),M.y+Math.floor(M.height/2)],F=Math.round(a*C),{width:z,height:ee}=this.pickingFBO,ce=this._getPickingRect({deviceX:L[0],deviceY:L[1],deviceRadius:F,deviceWidth:z,deviceHeight:ee}),se={x:i-a,y:o-a,width:a*2+1,height:a*2+1};let _e;const J=[],pe=new Set;for(let ue=0;ue<l;ue++){let xe;if(ce){const ne=this._drawAndSample({layers:x,views:t,viewports:r,onViewportActive:g,deviceRect:ce,cullRect:se,effects:_,pass:"picking:".concat(h)});xe=JZ({...ne,deviceX:L[0],deviceY:L[1],deviceRadius:F,deviceRect:ce})}else xe={pickedColor:null,pickedObjectIndex:-1};let je;if(xe.pickedLayer&&p&&this.depthFBO){const{pickedColors:ne}=this._drawAndSample({layers:[xe.pickedLayer],views:t,viewports:r,onViewportActive:g,deviceRect:{x:xe.pickedX,y:xe.pickedY,width:1,height:1},cullRect:se,effects:_,pass:"picking:".concat(h,":z")},!0);ne[3]&&(je=ne[0])}xe.pickedLayer&&ue+1<l&&(pe.add(xe.pickedLayer),xe.pickedLayer.disablePickingIndex(xe.pickedObjectIndex)),_e=tX({pickInfo:xe,lastPickedInfo:this.lastPickedInfo,mode:h,layers:x,viewports:r,x:i,y:o,z:je,pixelRatio:C});for(const ne of _e.values())ne.layer&&J.push(ne);if(!xe.pickedColor)break}for(const ue of pe)ue.restorePickingColors();return{result:J,emptyInfo:_e.get(null)}}_pickVisibleObjects({layers:e,views:t,viewports:r,x:i,y:o,width:a=1,height:l=1,mode:h="query",maxObjects:p=null,onViewportActive:g,effects:_}){const x=this._getPickable(e);if(!x)return[];this._resizeBuffer();const C=Tp(this.gl),M=dS(this.gl,[i,o],!0),L=M.x,F=M.y+M.height,z=dS(this.gl,[i+a,o+l],!0),ee=z.x+z.width,ce=z.y,se={x:L,y:ce,width:ee-L,height:F-ce},_e=this._drawAndSample({layers:x,views:t,viewports:r,onViewportActive:g,deviceRect:se,cullRect:{x:i,y:o,width:a,height:l},effects:_,pass:"picking:".concat(h)}),J=eX(_e),pe=new Map,ue=Number.isFinite(p);for(let je=0;je<J.length;je++){var xe;if(ue&&p&&pe.size>=p)break;const ne=J[je];let Ee={color:ne.pickedColor,layer:null,index:ne.pickedObjectIndex,picked:!0,x:i,y:o,pixelRatio:C};Ee=dN({layer:ne.pickedLayer,info:Ee,mode:h});const ke=(xe=Ee.object)!==null&&xe!==void 0?xe:"".concat(Ee.layer.id,"[").concat(Ee.index,"]");pe.has(ke)||pe.set(ke,Ee)}return Array.from(pe.values())}_drawAndSample({layers:e,views:t,viewports:r,onViewportActive:i,deviceRect:o,cullRect:a,effects:l,pass:h},p=!1){const g=p?this.depthFBO:this.pickingFBO,_={layers:e,layerFilter:this.layerFilter,views:t,viewports:r,onViewportActive:i,pickingFBO:g,deviceRect:o,cullRect:a,effects:l,pass:h,pickZ:p,preRenderStats:{}};for(const ee of l)ee.useInPicking&&(_.preRenderStats[ee.id]=ee.preRender(this.gl,_));const{decodePickingColor:x}=this.pickLayersPass.render(_),{x:C,y:M,width:L,height:F}=o,z=new(p?Float32Array:Uint8Array)(L*F*4);return Ub(g,{sourceX:C,sourceY:M,sourceWidth:L,sourceHeight:F,target:z}),{pickedColors:z,decodePickingColor:x}}_getPickingRect({deviceX:e,deviceY:t,deviceRadius:r,deviceWidth:i,deviceHeight:o}){const a=Math.max(0,e-r),l=Math.max(0,t-r),h=Math.min(i,e+r+1)-a,p=Math.min(o,t+r+1)-l;return h<=0||p<=0?null:{x:a,y:l,width:h,height:p}}}const iX={zIndex:"1",position:"absolute",pointerEvents:"none",color:"#a0a7b4",backgroundColor:"#29323c",padding:"10px",top:"0",left:"0",display:"none"};class oX{constructor(e){Y(this,"el",null),Y(this,"isVisible",!1);const t=e.parentElement;t&&(this.el=document.createElement("div"),this.el.className="deck-tooltip",Object.assign(this.el.style,iX),t.appendChild(this.el))}setTooltip(e,t,r){const i=this.el;if(i){if(typeof e=="string")i.innerText=e;else if(e)e.text&&(i.innerText=e.text),e.html&&(i.innerHTML=e.html),e.className&&(i.className=e.className);else{this.isVisible=!1,i.style.display="none";return}this.isVisible=!0,i.style.display="block",i.style.transform="translate(".concat(t,"px, ").concat(r,"px)"),e&&typeof e=="object"&&"style"in e&&Object.assign(i.style,e.style)}}remove(){this.el&&(this.el.remove(),this.el=null)}}var Md=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function aX(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}function sX(n){if(n.__esModule)return n;var e=n.default;if(typeof e=="function"){var t=function r(){return this instanceof r?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(n).forEach(function(r){var i=Object.getOwnPropertyDescriptor(n,r);Object.defineProperty(t,r,i.get?i:{enumerable:!0,get:function(){return n[r]}})}),t}var fN={exports:{}};/*! Hammer.JS - v2.0.7 - 2016-04-22
 * http://hammerjs.github.io/
 *
 * Copyright (c) 2016 Jorik Tangelder;
 * Licensed under the MIT license */(function(n){(function(e,t,r,i){var o=["","webkit","Moz","MS","ms","o"],a=t.createElement("div"),l="function",h=Math.round,p=Math.abs,g=Date.now;function _(te,le,Se){return setTimeout(ce(te,Se),le)}function x(te,le,Se){return Array.isArray(te)?(C(te,Se[le],Se),!0):!1}function C(te,le,Se){var qe;if(te)if(te.forEach)te.forEach(le,Se);else if(te.length!==i)for(qe=0;qe<te.length;)le.call(Se,te[qe],qe,te),qe++;else for(qe in te)te.hasOwnProperty(qe)&&le.call(Se,te[qe],qe,te)}function M(te,le,Se){var qe="DEPRECATED METHOD: "+le+`
`+Se+` AT 
`;return function(){var yt=new Error("get-stack-trace"),Jt=yt&&yt.stack?yt.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",Zn=e.console&&(e.console.warn||e.console.log);return Zn&&Zn.call(e.console,qe,Jt),te.apply(this,arguments)}}var L;typeof Object.assign!="function"?L=function(le){if(le===i||le===null)throw new TypeError("Cannot convert undefined or null to object");for(var Se=Object(le),qe=1;qe<arguments.length;qe++){var yt=arguments[qe];if(yt!==i&&yt!==null)for(var Jt in yt)yt.hasOwnProperty(Jt)&&(Se[Jt]=yt[Jt])}return Se}:L=Object.assign;var F=M(function(le,Se,qe){for(var yt=Object.keys(Se),Jt=0;Jt<yt.length;)(!qe||qe&&le[yt[Jt]]===i)&&(le[yt[Jt]]=Se[yt[Jt]]),Jt++;return le},"extend","Use `assign`."),z=M(function(le,Se){return F(le,Se,!0)},"merge","Use `assign`.");function ee(te,le,Se){var qe=le.prototype,yt;yt=te.prototype=Object.create(qe),yt.constructor=te,yt._super=qe,Se&&L(yt,Se)}function ce(te,le){return function(){return te.apply(le,arguments)}}function se(te,le){return typeof te==l?te.apply(le&&le[0]||i,le):te}function _e(te,le){return te===i?le:te}function J(te,le,Se){C(je(le),function(qe){te.addEventListener(qe,Se,!1)})}function pe(te,le,Se){C(je(le),function(qe){te.removeEventListener(qe,Se,!1)})}function ue(te,le){for(;te;){if(te==le)return!0;te=te.parentNode}return!1}function xe(te,le){return te.indexOf(le)>-1}function je(te){return te.trim().split(/\s+/g)}function ne(te,le,Se){if(te.indexOf&&!Se)return te.indexOf(le);for(var qe=0;qe<te.length;){if(Se&&te[qe][Se]==le||!Se&&te[qe]===le)return qe;qe++}return-1}function Ee(te){return Array.prototype.slice.call(te,0)}function ke(te,le,Se){for(var qe=[],yt=[],Jt=0;Jt<te.length;){var Zn=le?te[Jt][le]:te[Jt];ne(yt,Zn)<0&&qe.push(te[Jt]),yt[Jt]=Zn,Jt++}return Se&&(le?qe=qe.sort(function(Wi,yo){return Wi[le]>yo[le]}):qe=qe.sort()),qe}function Be(te,le){for(var Se,qe,yt=le[0].toUpperCase()+le.slice(1),Jt=0;Jt<o.length;){if(Se=o[Jt],qe=Se?Se+yt:le,qe in te)return qe;Jt++}return i}var Ze=1;function at(){return Ze++}function Re(te){var le=te.ownerDocument||te;return le.defaultView||le.parentWindow||e}var ht=/mobile|tablet|ip(ad|hone|od)|android/i,Rt="ontouchstart"in e,dn=Be(e,"PointerEvent")!==i,wt=Rt&&ht.test(navigator.userAgent),Ge="touch",qn="pen",Qt="mouse",ln="kinect",Mn=25,Ot=1,En=2,lt=4,Pt=8,he=1,B=2,H=4,D=8,Q=16,ae=B|H,q=D|Q,Ae=ae|q,Pe=["x","y"],We=["clientX","clientY"];function rt(te,le){var Se=this;this.manager=te,this.callback=le,this.element=te.element,this.target=te.options.inputTarget,this.domHandler=function(qe){se(te.options.enable,[te])&&Se.handler(qe)},this.init()}rt.prototype={handler:function(){},init:function(){this.evEl&&J(this.element,this.evEl,this.domHandler),this.evTarget&&J(this.target,this.evTarget,this.domHandler),this.evWin&&J(Re(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&pe(this.element,this.evEl,this.domHandler),this.evTarget&&pe(this.target,this.evTarget,this.domHandler),this.evWin&&pe(Re(this.element),this.evWin,this.domHandler)}};function Et(te){var le,Se=te.options.inputClass;return Se?le=Se:dn?le=$:wt?le=ot:Rt?le=tn:le=Fr,new le(te,Bt)}function Bt(te,le,Se){var qe=Se.pointers.length,yt=Se.changedPointers.length,Jt=le&Ot&&qe-yt===0,Zn=le&(lt|Pt)&&qe-yt===0;Se.isFirst=!!Jt,Se.isFinal=!!Zn,Jt&&(te.session={}),Se.eventType=le,Lt(te,Se),te.emit("hammer.input",Se),te.recognize(Se),te.session.prevInput=Se}function Lt(te,le){var Se=te.session,qe=le.pointers,yt=qe.length;Se.firstInput||(Se.firstInput=Te(le)),yt>1&&!Se.firstMultiple?Se.firstMultiple=Te(le):yt===1&&(Se.firstMultiple=!1);var Jt=Se.firstInput,Zn=Se.firstMultiple,Mi=Zn?Zn.center:Jt.center,Wi=le.center=At(qe);le.timeStamp=g(),le.deltaTime=le.timeStamp-Jt.timeStamp,le.angle=Ke(Mi,Wi),le.distance=fn(Mi,Wi),an(Se,le),le.offsetDirection=qt(le.deltaX,le.deltaY);var yo=xt(le.deltaTime,le.deltaX,le.deltaY);le.overallVelocityX=yo.x,le.overallVelocityY=yo.y,le.overallVelocity=p(yo.x)>p(yo.y)?yo.x:yo.y,le.scale=Zn?Tt(Zn.pointers,qe):1,le.rotation=Zn?gt(Zn.pointers,qe):0,le.maxPointers=Se.prevInput?le.pointers.length>Se.prevInput.maxPointers?le.pointers.length:Se.prevInput.maxPointers:le.pointers.length,Ie(Se,le);var Na=te.element;ue(le.srcEvent.target,Na)&&(Na=le.srcEvent.target),le.target=Na}function an(te,le){var Se=le.center,qe=te.offsetDelta||{},yt=te.prevDelta||{},Jt=te.prevInput||{};(le.eventType===Ot||Jt.eventType===lt)&&(yt=te.prevDelta={x:Jt.deltaX||0,y:Jt.deltaY||0},qe=te.offsetDelta={x:Se.x,y:Se.y}),le.deltaX=yt.x+(Se.x-qe.x),le.deltaY=yt.y+(Se.y-qe.y)}function Ie(te,le){var Se=te.lastInterval||le,qe=le.timeStamp-Se.timeStamp,yt,Jt,Zn,Mi;if(le.eventType!=Pt&&(qe>Mn||Se.velocity===i)){var Wi=le.deltaX-Se.deltaX,yo=le.deltaY-Se.deltaY,Na=xt(qe,Wi,yo);Jt=Na.x,Zn=Na.y,yt=p(Na.x)>p(Na.y)?Na.x:Na.y,Mi=qt(Wi,yo),te.lastInterval=le}else yt=Se.velocity,Jt=Se.velocityX,Zn=Se.velocityY,Mi=Se.direction;le.velocity=yt,le.velocityX=Jt,le.velocityY=Zn,le.direction=Mi}function Te(te){for(var le=[],Se=0;Se<te.pointers.length;)le[Se]={clientX:h(te.pointers[Se].clientX),clientY:h(te.pointers[Se].clientY)},Se++;return{timeStamp:g(),pointers:le,center:At(le),deltaX:te.deltaX,deltaY:te.deltaY}}function At(te){var le=te.length;if(le===1)return{x:h(te[0].clientX),y:h(te[0].clientY)};for(var Se=0,qe=0,yt=0;yt<le;)Se+=te[yt].clientX,qe+=te[yt].clientY,yt++;return{x:h(Se/le),y:h(qe/le)}}function xt(te,le,Se){return{x:le/te||0,y:Se/te||0}}function qt(te,le){return te===le?he:p(te)>=p(le)?te<0?B:H:le<0?D:Q}function fn(te,le,Se){Se||(Se=Pe);var qe=le[Se[0]]-te[Se[0]],yt=le[Se[1]]-te[Se[1]];return Math.sqrt(qe*qe+yt*yt)}function Ke(te,le,Se){Se||(Se=Pe);var qe=le[Se[0]]-te[Se[0]],yt=le[Se[1]]-te[Se[1]];return Math.atan2(yt,qe)*180/Math.PI}function gt(te,le){return Ke(le[1],le[0],We)+Ke(te[1],te[0],We)}function Tt(te,le){return fn(le[0],le[1],We)/fn(te[0],te[1],We)}var Rn={mousedown:Ot,mousemove:En,mouseup:lt},Qn="mousedown",nn="mousemove mouseup";function Fr(){this.evEl=Qn,this.evWin=nn,this.pressed=!1,rt.apply(this,arguments)}ee(Fr,rt,{handler:function(le){var Se=Rn[le.type];Se&Ot&&le.button===0&&(this.pressed=!0),Se&En&&le.which!==1&&(Se=lt),this.pressed&&(Se&lt&&(this.pressed=!1),this.callback(this.manager,Se,{pointers:[le],changedPointers:[le],pointerType:Qt,srcEvent:le}))}});var ti={pointerdown:Ot,pointermove:En,pointerup:lt,pointercancel:Pt,pointerout:Pt},Ar={2:Ge,3:qn,4:Qt,5:ln},oe="pointerdown",V="pointermove pointerup pointercancel";e.MSPointerEvent&&!e.PointerEvent&&(oe="MSPointerDown",V="MSPointerMove MSPointerUp MSPointerCancel");function $(){this.evEl=oe,this.evWin=V,rt.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}ee($,rt,{handler:function(le){var Se=this.store,qe=!1,yt=le.type.toLowerCase().replace("ms",""),Jt=ti[yt],Zn=Ar[le.pointerType]||le.pointerType,Mi=Zn==Ge,Wi=ne(Se,le.pointerId,"pointerId");Jt&Ot&&(le.button===0||Mi)?Wi<0&&(Se.push(le),Wi=Se.length-1):Jt&(lt|Pt)&&(qe=!0),!(Wi<0)&&(Se[Wi]=le,this.callback(this.manager,Jt,{pointers:Se,changedPointers:[le],pointerType:Zn,srcEvent:le}),qe&&Se.splice(Wi,1))}});var K={touchstart:Ot,touchmove:En,touchend:lt,touchcancel:Pt},me="touchstart",Oe="touchstart touchmove touchend touchcancel";function He(){this.evTarget=me,this.evWin=Oe,this.started=!1,rt.apply(this,arguments)}ee(He,rt,{handler:function(le){var Se=K[le.type];if(Se===Ot&&(this.started=!0),!!this.started){var qe=Ne.call(this,le,Se);Se&(lt|Pt)&&qe[0].length-qe[1].length===0&&(this.started=!1),this.callback(this.manager,Se,{pointers:qe[0],changedPointers:qe[1],pointerType:Ge,srcEvent:le})}}});function Ne(te,le){var Se=Ee(te.touches),qe=Ee(te.changedTouches);return le&(lt|Pt)&&(Se=ke(Se.concat(qe),"identifier",!0)),[Se,qe]}var Ce={touchstart:Ot,touchmove:En,touchend:lt,touchcancel:Pt},De="touchstart touchmove touchend touchcancel";function ot(){this.evTarget=De,this.targetIds={},rt.apply(this,arguments)}ee(ot,rt,{handler:function(le){var Se=Ce[le.type],qe=st.call(this,le,Se);qe&&this.callback(this.manager,Se,{pointers:qe[0],changedPointers:qe[1],pointerType:Ge,srcEvent:le})}});function st(te,le){var Se=Ee(te.touches),qe=this.targetIds;if(le&(Ot|En)&&Se.length===1)return qe[Se[0].identifier]=!0,[Se,Se];var yt,Jt,Zn=Ee(te.changedTouches),Mi=[],Wi=this.target;if(Jt=Se.filter(function(yo){return ue(yo.target,Wi)}),le===Ot)for(yt=0;yt<Jt.length;)qe[Jt[yt].identifier]=!0,yt++;for(yt=0;yt<Zn.length;)qe[Zn[yt].identifier]&&Mi.push(Zn[yt]),le&(lt|Pt)&&delete qe[Zn[yt].identifier],yt++;if(Mi.length)return[ke(Jt.concat(Mi),"identifier",!0),Mi]}var St=2500,un=25;function tn(){rt.apply(this,arguments);var te=ce(this.handler,this);this.touch=new ot(this.manager,te),this.mouse=new Fr(this.manager,te),this.primaryTouch=null,this.lastTouches=[]}ee(tn,rt,{handler:function(le,Se,qe){var yt=qe.pointerType==Ge,Jt=qe.pointerType==Qt;if(!(Jt&&qe.sourceCapabilities&&qe.sourceCapabilities.firesTouchEvents)){if(yt)_n.call(this,Se,qe);else if(Jt&&er.call(this,qe))return;this.callback(le,Se,qe)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});function _n(te,le){te&Ot?(this.primaryTouch=le.changedPointers[0].identifier,Kn.call(this,le)):te&(lt|Pt)&&Kn.call(this,le)}function Kn(te){var le=te.changedPointers[0];if(le.identifier===this.primaryTouch){var Se={x:le.clientX,y:le.clientY};this.lastTouches.push(Se);var qe=this.lastTouches,yt=function(){var Jt=qe.indexOf(Se);Jt>-1&&qe.splice(Jt,1)};setTimeout(yt,St)}}function er(te){for(var le=te.srcEvent.clientX,Se=te.srcEvent.clientY,qe=0;qe<this.lastTouches.length;qe++){var yt=this.lastTouches[qe],Jt=Math.abs(le-yt.x),Zn=Math.abs(Se-yt.y);if(Jt<=un&&Zn<=un)return!0}return!1}var On=Be(a.style,"touchAction"),Bn=On!==i,pn="compute",gn="auto",Yn="manipulation",Br="none",si="pan-x",$i="pan-y",Pi=bl();function mo(te,le){this.manager=te,this.set(le)}mo.prototype={set:function(te){te==pn&&(te=this.compute()),Bn&&this.manager.element.style&&Pi[te]&&(this.manager.element.style[On]=te),this.actions=te.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var te=[];return C(this.manager.recognizers,function(le){se(le.options.enable,[le])&&(te=te.concat(le.getTouchAction()))}),Xh(te.join(" "))},preventDefaults:function(te){var le=te.srcEvent,Se=te.offsetDirection;if(this.manager.session.prevented){le.preventDefault();return}var qe=this.actions,yt=xe(qe,Br)&&!Pi[Br],Jt=xe(qe,$i)&&!Pi[$i],Zn=xe(qe,si)&&!Pi[si];if(yt){var Mi=te.pointers.length===1,Wi=te.distance<2,yo=te.deltaTime<250;if(Mi&&Wi&&yo)return}if(!(Zn&&Jt)&&(yt||Jt&&Se&ae||Zn&&Se&q))return this.preventSrc(le)},preventSrc:function(te){this.manager.session.prevented=!0,te.preventDefault()}};function Xh(te){if(xe(te,Br))return Br;var le=xe(te,si),Se=xe(te,$i);return le&&Se?Br:le||Se?le?si:$i:xe(te,Yn)?Yn:gn}function bl(){if(!Bn)return!1;var te={},le=e.CSS&&e.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach(function(Se){te[Se]=le?e.CSS.supports("touch-action",Se):!0}),te}var Su=1,ga=2,ir=4,Do=8,Oa=Do,to=16,$r=32;function Ms(te){this.options=L({},this.defaults,te||{}),this.id=at(),this.manager=null,this.options.enable=_e(this.options.enable,!0),this.state=Su,this.simultaneous={},this.requireFail=[]}Ms.prototype={defaults:{},set:function(te){return L(this.options,te),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(te){if(x(te,"recognizeWith",this))return this;var le=this.simultaneous;return te=wl(te,this),le[te.id]||(le[te.id]=te,te.recognizeWith(this)),this},dropRecognizeWith:function(te){return x(te,"dropRecognizeWith",this)?this:(te=wl(te,this),delete this.simultaneous[te.id],this)},requireFailure:function(te){if(x(te,"requireFailure",this))return this;var le=this.requireFail;return te=wl(te,this),ne(le,te)===-1&&(le.push(te),te.requireFailure(this)),this},dropRequireFailure:function(te){if(x(te,"dropRequireFailure",this))return this;te=wl(te,this);var le=ne(this.requireFail,te);return le>-1&&this.requireFail.splice(le,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(te){return!!this.simultaneous[te.id]},emit:function(te){var le=this,Se=this.state;function qe(yt){le.manager.emit(yt,te)}Se<Do&&qe(le.options.event+Jo(Se)),qe(le.options.event),te.additionalEvent&&qe(te.additionalEvent),Se>=Do&&qe(le.options.event+Jo(Se))},tryEmit:function(te){if(this.canEmit())return this.emit(te);this.state=$r},canEmit:function(){for(var te=0;te<this.requireFail.length;){if(!(this.requireFail[te].state&($r|Su)))return!1;te++}return!0},recognize:function(te){var le=L({},te);if(!se(this.options.enable,[this,le])){this.reset(),this.state=$r;return}this.state&(Oa|to|$r)&&(this.state=Su),this.state=this.process(le),this.state&(ga|ir|Do|to)&&this.tryEmit(le)},process:function(te){},getTouchAction:function(){},reset:function(){}};function Jo(te){return te&to?"cancel":te&Do?"end":te&ir?"move":te&ga?"start":""}function ea(te){return te==Q?"down":te==D?"up":te==B?"left":te==H?"right":""}function wl(te,le){var Se=le.manager;return Se?Se.get(te):te}function no(){Ms.apply(this,arguments)}ee(no,Ms,{defaults:{pointers:1},attrTest:function(te){var le=this.options.pointers;return le===0||te.pointers.length===le},process:function(te){var le=this.state,Se=te.eventType,qe=le&(ga|ir),yt=this.attrTest(te);return qe&&(Se&Pt||!yt)?le|to:qe||yt?Se&lt?le|Do:le&ga?le|ir:ga:$r}});function ci(){no.apply(this,arguments),this.pX=null,this.pY=null}ee(ci,no,{defaults:{event:"pan",threshold:10,pointers:1,direction:Ae},getTouchAction:function(){var te=this.options.direction,le=[];return te&ae&&le.push($i),te&q&&le.push(si),le},directionTest:function(te){var le=this.options,Se=!0,qe=te.distance,yt=te.direction,Jt=te.deltaX,Zn=te.deltaY;return yt&le.direction||(le.direction&ae?(yt=Jt===0?he:Jt<0?B:H,Se=Jt!=this.pX,qe=Math.abs(te.deltaX)):(yt=Zn===0?he:Zn<0?D:Q,Se=Zn!=this.pY,qe=Math.abs(te.deltaY))),te.direction=yt,Se&&qe>le.threshold&&yt&le.direction},attrTest:function(te){return no.prototype.attrTest.call(this,te)&&(this.state&ga||!(this.state&ga)&&this.directionTest(te))},emit:function(te){this.pX=te.deltaX,this.pY=te.deltaY;var le=ea(te.direction);le&&(te.additionalEvent=this.options.event+le),this._super.emit.call(this,te)}});function Rs(){no.apply(this,arguments)}ee(Rs,no,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[Br]},attrTest:function(te){return this._super.attrTest.call(this,te)&&(Math.abs(te.scale-1)>this.options.threshold||this.state&ga)},emit:function(te){if(te.scale!==1){var le=te.scale<1?"in":"out";te.additionalEvent=this.options.event+le}this._super.emit.call(this,te)}});function La(){Ms.apply(this,arguments),this._timer=null,this._input=null}ee(La,Ms,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[gn]},process:function(te){var le=this.options,Se=te.pointers.length===le.pointers,qe=te.distance<le.threshold,yt=te.deltaTime>le.time;if(this._input=te,!qe||!Se||te.eventType&(lt|Pt)&&!yt)this.reset();else if(te.eventType&Ot)this.reset(),this._timer=_(function(){this.state=Oa,this.tryEmit()},le.time,this);else if(te.eventType&lt)return Oa;return $r},reset:function(){clearTimeout(this._timer)},emit:function(te){this.state===Oa&&(te&&te.eventType&lt?this.manager.emit(this.options.event+"up",te):(this._input.timeStamp=g(),this.manager.emit(this.options.event,this._input)))}});function or(){no.apply(this,arguments)}ee(or,no,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[Br]},attrTest:function(te){return this._super.attrTest.call(this,te)&&(Math.abs(te.rotation)>this.options.threshold||this.state&ga)}});function rs(){no.apply(this,arguments)}ee(rs,no,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:ae|q,pointers:1},getTouchAction:function(){return ci.prototype.getTouchAction.call(this)},attrTest:function(te){var le=this.options.direction,Se;return le&(ae|q)?Se=te.overallVelocity:le&ae?Se=te.overallVelocityX:le&q&&(Se=te.overallVelocityY),this._super.attrTest.call(this,te)&&le&te.offsetDirection&&te.distance>this.options.threshold&&te.maxPointers==this.options.pointers&&p(Se)>this.options.velocity&&te.eventType&lt},emit:function(te){var le=ea(te.offsetDirection);le&&this.manager.emit(this.options.event+le,te),this.manager.emit(this.options.event,te)}});function Hn(){Ms.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}ee(Hn,Ms,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[Yn]},process:function(te){var le=this.options,Se=te.pointers.length===le.pointers,qe=te.distance<le.threshold,yt=te.deltaTime<le.time;if(this.reset(),te.eventType&Ot&&this.count===0)return this.failTimeout();if(qe&&yt&&Se){if(te.eventType!=lt)return this.failTimeout();var Jt=this.pTime?te.timeStamp-this.pTime<le.interval:!0,Zn=!this.pCenter||fn(this.pCenter,te.center)<le.posThreshold;this.pTime=te.timeStamp,this.pCenter=te.center,!Zn||!Jt?this.count=1:this.count+=1,this._input=te;var Mi=this.count%le.taps;if(Mi===0)return this.hasRequireFailures()?(this._timer=_(function(){this.state=Oa,this.tryEmit()},le.interval,this),ga):Oa}return $r},failTimeout:function(){return this._timer=_(function(){this.state=$r},this.options.interval,this),$r},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==Oa&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}});function is(te,le){return le=le||{},le.recognizers=_e(le.recognizers,is.defaults.preset),new Jh(te,le)}is.VERSION="2.0.7",is.defaults={domEvents:!1,touchAction:pn,enable:!0,inputTarget:null,inputClass:null,preset:[[or,{enable:!1}],[Rs,{enable:!1},["rotate"]],[rs,{direction:ae}],[ci,{direction:ae},["swipe"]],[Hn],[Hn,{event:"doubletap",taps:2},["tap"]],[La]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};var nc=1,Qh=2;function Jh(te,le){this.options=L({},is.defaults,le||{}),this.options.inputTarget=this.options.inputTarget||te,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=te,this.input=Et(this),this.touchAction=new mo(this,this.options.touchAction),xl(this,!0),C(this.options.recognizers,function(Se){var qe=this.add(new Se[0](Se[1]));Se[2]&&qe.recognizeWith(Se[2]),Se[3]&&qe.requireFailure(Se[3])},this)}Jh.prototype={set:function(te){return L(this.options,te),te.touchAction&&this.touchAction.update(),te.inputTarget&&(this.input.destroy(),this.input.target=te.inputTarget,this.input.init()),this},stop:function(te){this.session.stopped=te?Qh:nc},recognize:function(te){var le=this.session;if(!le.stopped){this.touchAction.preventDefaults(te);var Se,qe=this.recognizers,yt=le.curRecognizer;(!yt||yt&&yt.state&Oa)&&(yt=le.curRecognizer=null);for(var Jt=0;Jt<qe.length;)Se=qe[Jt],le.stopped!==Qh&&(!yt||Se==yt||Se.canRecognizeWith(yt))?Se.recognize(te):Se.reset(),!yt&&Se.state&(ga|ir|Do)&&(yt=le.curRecognizer=Se),Jt++}},get:function(te){if(te instanceof Ms)return te;for(var le=this.recognizers,Se=0;Se<le.length;Se++)if(le[Se].options.event==te)return le[Se];return null},add:function(te){if(x(te,"add",this))return this;var le=this.get(te.options.event);return le&&this.remove(le),this.recognizers.push(te),te.manager=this,this.touchAction.update(),te},remove:function(te){if(x(te,"remove",this))return this;if(te=this.get(te),te){var le=this.recognizers,Se=ne(le,te);Se!==-1&&(le.splice(Se,1),this.touchAction.update())}return this},on:function(te,le){if(te!==i&&le!==i){var Se=this.handlers;return C(je(te),function(qe){Se[qe]=Se[qe]||[],Se[qe].push(le)}),this}},off:function(te,le){if(te!==i){var Se=this.handlers;return C(je(te),function(qe){le?Se[qe]&&Se[qe].splice(ne(Se[qe],le),1):delete Se[qe]}),this}},emit:function(te,le){this.options.domEvents&&Cu(te,le);var Se=this.handlers[te]&&this.handlers[te].slice();if(!(!Se||!Se.length)){le.type=te,le.preventDefault=function(){le.srcEvent.preventDefault()};for(var qe=0;qe<Se.length;)Se[qe](le),qe++}},destroy:function(){this.element&&xl(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}};function xl(te,le){var Se=te.element;if(Se.style){var qe;C(te.options.cssProps,function(yt,Jt){qe=Be(Se.style,Jt),le?(te.oldCssProps[qe]=Se.style[qe],Se.style[qe]=yt):Se.style[qe]=te.oldCssProps[qe]||""}),le||(te.oldCssProps={})}}function Cu(te,le){var Se=t.createEvent("Event");Se.initEvent(te,!0,!0),Se.gesture=le,le.target.dispatchEvent(Se)}L(is,{INPUT_START:Ot,INPUT_MOVE:En,INPUT_END:lt,INPUT_CANCEL:Pt,STATE_POSSIBLE:Su,STATE_BEGAN:ga,STATE_CHANGED:ir,STATE_ENDED:Do,STATE_RECOGNIZED:Oa,STATE_CANCELLED:to,STATE_FAILED:$r,DIRECTION_NONE:he,DIRECTION_LEFT:B,DIRECTION_RIGHT:H,DIRECTION_UP:D,DIRECTION_DOWN:Q,DIRECTION_HORIZONTAL:ae,DIRECTION_VERTICAL:q,DIRECTION_ALL:Ae,Manager:Jh,Input:rt,TouchAction:mo,TouchInput:ot,MouseInput:Fr,PointerEventInput:$,TouchMouseInput:tn,SingleTouchInput:He,Recognizer:Ms,AttrRecognizer:no,Tap:Hn,Pan:ci,Swipe:rs,Pinch:Rs,Rotate:or,Press:La,on:J,off:pe,each:C,merge:z,extend:F,assign:L,inherit:ee,bindFn:ce,prefixed:Be});var rc=typeof e<"u"?e:typeof self<"u"?self:{};rc.Hammer=is,typeof i=="function"&&i.amd?i(function(){return is}):n.exports?n.exports=is:e[r]=is})(window,document,"Hammer")})(fN);var t_=fN.exports;const Gc=Ab({__proto__:null,default:aX(t_)},[t_]),pN=1,gN=2,nC=4,cX={mousedown:pN,mousemove:gN,mouseup:nC};function lX(n,e){for(let t=0;t<n.length;t++)if(e(n[t]))return!0;return!1}function uX(n){const e=n.prototype.handler;n.prototype.handler=function(r){const i=this.store;r.button>0&&r.type==="pointerdown"&&(lX(i,o=>o.pointerId===r.pointerId)||i.push(r)),e.call(this,r)}}function hX(n){n.prototype.handler=function(t){let r=cX[t.type];r&pN&&t.button>=0&&(this.pressed=!0),r&gN&&t.buttons===0&&(r=nC),this.pressed&&(r&nC&&(this.pressed=!1),this.callback(this.manager,r,{pointers:[t],changedPointers:[t],pointerType:"mouse",srcEvent:t}))}}uX(t_.PointerEventInput),hX(t_.MouseInput);const dX=t_.Manager;class l1{constructor(e,t,r){this.element=e,this.callback=t,this.options={enable:!0,...r}}}const fX=Gc?[[Gc.Pan,{event:"tripan",pointers:3,threshold:0,enable:!1}],[Gc.Rotate,{enable:!1}],[Gc.Pinch,{enable:!1}],[Gc.Swipe,{enable:!1}],[Gc.Pan,{threshold:0,enable:!1}],[Gc.Press,{enable:!1}],[Gc.Tap,{event:"doubletap",taps:2,enable:!1}],[Gc.Tap,{event:"anytap",enable:!1}],[Gc.Tap,{enable:!1}]]:null,mN={tripan:["rotate","pinch","pan"],rotate:["pinch"],pinch:["pan"],pan:["press","doubletap","anytap","tap"],doubletap:["anytap"],anytap:["tap"]},pX={doubletap:["tap"]},gX={pointerdown:"pointerdown",pointermove:"pointermove",pointerup:"pointerup",touchstart:"pointerdown",touchmove:"pointermove",touchend:"pointerup",mousedown:"pointerdown",mousemove:"pointermove",mouseup:"pointerup"},rC={KEY_EVENTS:["keydown","keyup"],MOUSE_EVENTS:["mousedown","mousemove","mouseup","mouseover","mouseout","mouseleave"],WHEEL_EVENTS:["wheel","mousewheel"]},mX={tap:"tap",anytap:"anytap",doubletap:"doubletap",press:"press",pinch:"pinch",pinchin:"pinch",pinchout:"pinch",pinchstart:"pinch",pinchmove:"pinch",pinchend:"pinch",pinchcancel:"pinch",rotate:"rotate",rotatestart:"rotate",rotatemove:"rotate",rotateend:"rotate",rotatecancel:"rotate",tripan:"tripan",tripanstart:"tripan",tripanmove:"tripan",tripanup:"tripan",tripandown:"tripan",tripanleft:"tripan",tripanright:"tripan",tripanend:"tripan",tripancancel:"tripan",pan:"pan",panstart:"pan",panmove:"pan",panup:"pan",pandown:"pan",panleft:"pan",panright:"pan",panend:"pan",pancancel:"pan",swipe:"swipe",swipeleft:"swipe",swiperight:"swipe",swipeup:"swipe",swipedown:"swipe"},yN={click:"tap",anyclick:"anytap",dblclick:"doubletap",mousedown:"pointerdown",mousemove:"pointermove",mouseup:"pointerup",mouseover:"pointerover",mouseout:"pointerout",mouseleave:"pointerleave"},yX=typeof navigator<"u"&&navigator.userAgent?navigator.userAgent.toLowerCase():"",Gp=typeof window<"u"?window:global;let iC=!1;try{const n={get passive(){return iC=!0,!0}};Gp.addEventListener("test",null,n),Gp.removeEventListener("test",null)}catch{iC=!1}const _X=yX.indexOf("firefox")!==-1,{WHEEL_EVENTS:vX}=rC,_N="wheel",vN=4.000244140625,bX=40,wX=.25;class xX extends l1{constructor(e,t,r){super(e,t,r),this.handleEvent=i=>{if(!this.options.enable)return;let o=i.deltaY;Gp.WheelEvent&&(_X&&i.deltaMode===Gp.WheelEvent.DOM_DELTA_PIXEL&&(o/=Gp.devicePixelRatio),i.deltaMode===Gp.WheelEvent.DOM_DELTA_LINE&&(o*=bX)),o!==0&&o%vN===0&&(o=Math.floor(o/vN)),i.shiftKey&&o&&(o=o*wX),this.callback({type:_N,center:{x:i.clientX,y:i.clientY},delta:-o,srcEvent:i,pointerType:"mouse",target:i.target})},this.events=(this.options.events||[]).concat(vX),this.events.forEach(i=>e.addEventListener(i,this.handleEvent,iC?{passive:!1}:!1))}destroy(){this.events.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,t){e===_N&&(this.options.enable=t)}}const{MOUSE_EVENTS:EX}=rC,bN="pointermove",wN="pointerover",xN="pointerout",EN="pointerenter",TN="pointerleave";class TX extends l1{constructor(e,t,r){super(e,t,r),this.handleEvent=o=>{this.handleOverEvent(o),this.handleOutEvent(o),this.handleEnterEvent(o),this.handleLeaveEvent(o),this.handleMoveEvent(o)},this.pressed=!1;const{enable:i}=this.options;this.enableMoveEvent=i,this.enableLeaveEvent=i,this.enableEnterEvent=i,this.enableOutEvent=i,this.enableOverEvent=i,this.events=(this.options.events||[]).concat(EX),this.events.forEach(o=>e.addEventListener(o,this.handleEvent))}destroy(){this.events.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,t){e===bN&&(this.enableMoveEvent=t),e===wN&&(this.enableOverEvent=t),e===xN&&(this.enableOutEvent=t),e===EN&&(this.enableEnterEvent=t),e===TN&&(this.enableLeaveEvent=t)}handleOverEvent(e){this.enableOverEvent&&e.type==="mouseover"&&this._emit(wN,e)}handleOutEvent(e){this.enableOutEvent&&e.type==="mouseout"&&this._emit(xN,e)}handleEnterEvent(e){this.enableEnterEvent&&e.type==="mouseenter"&&this._emit(EN,e)}handleLeaveEvent(e){this.enableLeaveEvent&&e.type==="mouseleave"&&this._emit(TN,e)}handleMoveEvent(e){if(this.enableMoveEvent)switch(e.type){case"mousedown":e.button>=0&&(this.pressed=!0);break;case"mousemove":e.buttons===0&&(this.pressed=!1),this.pressed||this._emit(bN,e);break;case"mouseup":this.pressed=!1;break}}_emit(e,t){this.callback({type:e,center:{x:t.clientX,y:t.clientY},srcEvent:t,pointerType:"mouse",target:t.target})}}const{KEY_EVENTS:SX}=rC,SN="keydown",CN="keyup";class CX extends l1{constructor(e,t,r){super(e,t,r),this.handleEvent=i=>{const o=i.target||i.srcElement;o.tagName==="INPUT"&&o.type==="text"||o.tagName==="TEXTAREA"||(this.enableDownEvent&&i.type==="keydown"&&this.callback({type:SN,srcEvent:i,key:i.key,target:i.target}),this.enableUpEvent&&i.type==="keyup"&&this.callback({type:CN,srcEvent:i,key:i.key,target:i.target}))},this.enableDownEvent=this.options.enable,this.enableUpEvent=this.options.enable,this.events=(this.options.events||[]).concat(SX),e.tabIndex=this.options.tabIndex||0,e.style.outline="none",this.events.forEach(i=>e.addEventListener(i,this.handleEvent))}destroy(){this.events.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,t){e===SN&&(this.enableDownEvent=t),e===CN&&(this.enableUpEvent=t)}}const AN="contextmenu";class AX extends l1{constructor(e,t,r){super(e,t,r),this.handleEvent=i=>{this.options.enable&&this.callback({type:AN,center:{x:i.clientX,y:i.clientY},srcEvent:i,pointerType:"mouse",target:i.target})},e.addEventListener("contextmenu",this.handleEvent)}destroy(){this.element.removeEventListener("contextmenu",this.handleEvent)}enableEventType(e,t){e===AN&&(this.options.enable=t)}}const IN=1,oC=2,PN=4,IX={pointerdown:IN,pointermove:oC,pointerup:PN,mousedown:IN,mousemove:oC,mouseup:PN},PX=0,MX=1,RX=2,kX=1,OX=2,LX=4;function NX(n){const e=IX[n.srcEvent.type];if(!e)return null;const{buttons:t,button:r}=n.srcEvent;let i=!1,o=!1,a=!1;return e===oC?(i=!!(t&kX),o=!!(t&LX),a=!!(t&OX)):(i=r===PX,o=r===MX,a=r===RX),{leftButton:i,middleButton:o,rightButton:a}}function DX(n,e){const t=n.center;if(!t)return null;const r=e.getBoundingClientRect(),i=r.width/e.offsetWidth||1,o=r.height/e.offsetHeight||1,a={x:(t.x-r.left-e.clientLeft)/i,y:(t.y-r.top-e.clientTop)/o};return{center:t,offsetCenter:a}}const aC={srcElement:"root",priority:0};class FX{constructor(e){this.handleEvent=t=>{if(this.isEmpty())return;const r=this._normalizeEvent(t);let i=t.srcEvent.target;for(;i&&i!==r.rootElement;){if(this._emit(r,i),r.handled)return;i=i.parentNode}this._emit(r,"root")},this.eventManager=e,this.handlers=[],this.handlersByElement=new Map,this._active=!1}isEmpty(){return!this._active}add(e,t,r,i=!1,o=!1){const{handlers:a,handlersByElement:l}=this;let h=aC;typeof r=="string"||r&&r.addEventListener?h={...aC,srcElement:r}:r&&(h={...aC,...r});let p=l.get(h.srcElement);p||(p=[],l.set(h.srcElement,p));const g={type:e,handler:t,srcElement:h.srcElement,priority:h.priority};i&&(g.once=!0),o&&(g.passive=!0),a.push(g),this._active=this._active||!g.passive;let _=p.length-1;for(;_>=0&&!(p[_].priority>=g.priority);)_--;p.splice(_+1,0,g)}remove(e,t){const{handlers:r,handlersByElement:i}=this;for(let o=r.length-1;o>=0;o--){const a=r[o];if(a.type===e&&a.handler===t){r.splice(o,1);const l=i.get(a.srcElement);l.splice(l.indexOf(a),1),l.length===0&&i.delete(a.srcElement)}}this._active=r.some(o=>!o.passive)}_emit(e,t){const r=this.handlersByElement.get(t);if(r){let i=!1;const o=()=>{e.handled=!0},a=()=>{e.handled=!0,i=!0},l=[];for(let h=0;h<r.length;h++){const{type:p,handler:g,once:_}=r[h];if(g({...e,type:p,stopPropagation:o,stopImmediatePropagation:a}),_&&l.push(r[h]),i)break}for(let h=0;h<l.length;h++){const{type:p,handler:g}=l[h];this.remove(p,g)}}}_normalizeEvent(e){const t=this.eventManager.getElement();return{...e,...NX(e),...DX(e,t),preventDefault:()=>{e.srcEvent.preventDefault()},stopImmediatePropagation:null,stopPropagation:null,handled:!1,rootElement:t}}}const BX={events:null,recognizers:null,recognizerOptions:{},Manager:dX,touchAction:"none",tabIndex:0};let UX=class{constructor(e=null,t){this._onBasicInput=i=>{const{srcEvent:o}=i,a=gX[o.type];a&&this.manager.emit(a,i)},this._onOtherEvent=i=>{this.manager.emit(i.type,i)},this.options={...BX,...t},this.events=new Map,this.setElement(e);const{events:r}=this.options;r&&this.on(r)}getElement(){return this.element}setElement(e){if(this.element&&this.destroy(),this.element=e,!e)return;const{options:t}=this,r=t.Manager;this.manager=new r(e,{touchAction:t.touchAction,recognizers:t.recognizers||fX}).on("hammer.input",this._onBasicInput),t.recognizers||Object.keys(mN).forEach(i=>{const o=this.manager.get(i);o&&mN[i].forEach(a=>{o.recognizeWith(a)})});for(const i in t.recognizerOptions){const o=this.manager.get(i);if(o){const a=t.recognizerOptions[i];delete a.enable,o.set(a)}}this.wheelInput=new xX(e,this._onOtherEvent,{enable:!1}),this.moveInput=new TX(e,this._onOtherEvent,{enable:!1}),this.keyInput=new CX(e,this._onOtherEvent,{enable:!1,tabIndex:t.tabIndex}),this.contextmenuInput=new AX(e,this._onOtherEvent,{enable:!1});for(const[i,o]of this.events)o.isEmpty()||(this._toggleRecognizer(o.recognizerName,!0),this.manager.on(i,o.handleEvent))}destroy(){this.element&&(this.wheelInput.destroy(),this.moveInput.destroy(),this.keyInput.destroy(),this.contextmenuInput.destroy(),this.manager.destroy(),this.wheelInput=null,this.moveInput=null,this.keyInput=null,this.contextmenuInput=null,this.manager=null,this.element=null)}on(e,t,r){this._addEventHandler(e,t,r,!1)}once(e,t,r){this._addEventHandler(e,t,r,!0)}watch(e,t,r){this._addEventHandler(e,t,r,!1,!0)}off(e,t){this._removeEventHandler(e,t)}_toggleRecognizer(e,t){const{manager:r}=this;if(!r)return;const i=r.get(e);if(i&&i.options.enable!==t){i.set({enable:t});const o=pX[e];o&&!this.options.recognizers&&o.forEach(a=>{const l=r.get(a);t?(l.requireFailure(e),i.dropRequireFailure(a)):l.dropRequireFailure(e)})}this.wheelInput.enableEventType(e,t),this.moveInput.enableEventType(e,t),this.keyInput.enableEventType(e,t),this.contextmenuInput.enableEventType(e,t)}_addEventHandler(e,t,r,i,o){if(typeof e!="string"){r=t;for(const g in e)this._addEventHandler(g,e[g],r,i,o);return}const{manager:a,events:l}=this,h=yN[e]||e;let p=l.get(h);p||(p=new FX(this),l.set(h,p),p.recognizerName=mX[h]||h,a&&a.on(h,p.handleEvent)),p.add(e,t,r,i,o),p.isEmpty()||this._toggleRecognizer(p.recognizerName,!0)}_removeEventHandler(e,t){if(typeof e!="string"){for(const a in e)this._removeEventHandler(a,e[a]);return}const{events:r}=this,i=yN[e]||e,o=r.get(i);if(o&&(o.remove(e,t),o.isEmpty())){const{recognizerName:a}=o;let l=!1;for(const h of r.values())if(h.recognizerName===a&&!h.isEmpty()){l=!0;break}l||this._toggleRecognizer(a,!1)}}};function Rd(){}const MN={id:"",width:"100%",height:"100%",style:null,viewState:null,initialViewState:null,pickingRadius:0,layerFilter:null,glOptions:{},parameters:{},parent:null,gl:null,canvas:null,layers:[],effects:[],views:null,controller:null,useDevicePixels:!0,touchAction:"none",eventRecognizerOptions:{},_framebuffer:null,_animate:!1,_pickable:!0,_typedArrayManagerProps:{},_customRender:null,onWebGLInitialized:Rd,onResize:Rd,onViewStateChange:Rd,onInteractionStateChange:Rd,onBeforeRender:Rd,onAfterRender:Rd,onLoad:Rd,onError:n=>Ir.error(n.message,n.cause)(),onHover:null,onClick:null,onDragStart:null,onDrag:null,onDragEnd:null,_onMetrics:null,getCursor:({isDragging:n})=>n?"grabbing":"grab",getTooltip:null,debug:!1,drawPickingColors:!1};class sC{constructor(e){Y(this,"props",void 0),Y(this,"width",0),Y(this,"height",0),Y(this,"userData",{}),Y(this,"canvas",null),Y(this,"viewManager",null),Y(this,"layerManager",null),Y(this,"effectManager",null),Y(this,"deckRenderer",null),Y(this,"deckPicker",null),Y(this,"eventManager",null),Y(this,"tooltip",null),Y(this,"metrics",void 0),Y(this,"animationLoop",void 0),Y(this,"stats",void 0),Y(this,"viewState",void 0),Y(this,"cursorState",void 0),Y(this,"_needsRedraw",void 0),Y(this,"_pickRequest",void 0),Y(this,"_lastPointerDownInfo",null),Y(this,"_metricsCounter",void 0),Y(this,"_onPointerMove",t=>{const{_pickRequest:r}=this;if(t.type==="pointerleave")r.x=-1,r.y=-1,r.radius=0;else{if(t.leftButton||t.rightButton)return;{const i=t.offsetCenter;if(!i)return;r.x=i.x,r.y=i.y,r.radius=this.props.pickingRadius}}this.layerManager&&(this.layerManager.context.mousePosition={x:r.x,y:r.y}),r.event=t}),Y(this,"_onEvent",t=>{const r=sO[t.type],i=t.offsetCenter;if(!r||!i||!this.layerManager)return;const o=this.layerManager.getLayers(),a=this.deckPicker.getLastPickedObject({x:i.x,y:i.y,layers:o,viewports:this.getViewports(i)},this._lastPointerDownInfo),{layer:l}=a,h=l&&(l[r.handler]||l.props[r.handler]),p=this.props[r.handler];let g=!1;h&&(g=h.call(l,a,t)),!g&&p&&p(a,t)}),Y(this,"_onPointerDown",t=>{const r=t.offsetCenter,i=this._pick("pickObject","pickObject Time",{x:r.x,y:r.y,radius:this.props.pickingRadius});this._lastPointerDownInfo=i.result[0]||i.emptyInfo}),this.props={...MN,...e},e=this.props,this._needsRedraw="Initial render",this._pickRequest={mode:"hover",x:-1,y:-1,radius:0,event:null},this.cursorState={isHovering:!1,isDragging:!1},e.viewState&&e.initialViewState&&Ir.warn("View state tracking is disabled. Use either `initialViewState` for auto update or `viewState` for manual update.")(),Dk()==="IE"&&Ir.warn("IE 11 is not supported")(),this.viewState=e.initialViewState,e.gl||typeof document<"u"&&(this.canvas=this._createCanvas(e)),this.animationLoop=this._createAnimationLoop(e),this.stats=new WT({id:"deck.gl"}),this.metrics={fps:0,setPropsTime:0,updateAttributesTime:0,framesRedrawn:0,pickTime:0,pickCount:0,gpuTime:0,gpuTimePerFrame:0,cpuTime:0,cpuTimePerFrame:0,bufferMemory:0,textureMemory:0,renderbufferMemory:0,gpuMemory:0},this._metricsCounter=0,this.setProps(e),e._typedArrayManagerProps&&Xy.setOptions(e._typedArrayManagerProps),this.animationLoop.start()}finalize(){var e,t,r,i,o,a,l,h;if((e=this.animationLoop)===null||e===void 0||e.stop(),this.animationLoop=null,this._lastPointerDownInfo=null,(t=this.layerManager)===null||t===void 0||t.finalize(),this.layerManager=null,(r=this.viewManager)===null||r===void 0||r.finalize(),this.viewManager=null,(i=this.effectManager)===null||i===void 0||i.finalize(),this.effectManager=null,(o=this.deckRenderer)===null||o===void 0||o.finalize(),this.deckRenderer=null,(a=this.deckPicker)===null||a===void 0||a.finalize(),this.deckPicker=null,(l=this.eventManager)===null||l===void 0||l.destroy(),this.eventManager=null,(h=this.tooltip)===null||h===void 0||h.remove(),this.tooltip=null,!this.props.canvas&&!this.props.gl&&this.canvas){var p;(p=this.canvas.parentElement)===null||p===void 0||p.removeChild(this.canvas),this.canvas=null}}setProps(e){this.stats.get("setProps Time").timeStart(),"onLayerHover"in e&&Ir.removed("onLayerHover","onHover")(),"onLayerClick"in e&&Ir.removed("onLayerClick","onClick")(),e.initialViewState&&!Hc(this.props.initialViewState,e.initialViewState,3)&&(this.viewState=e.initialViewState),Object.assign(this.props,e),this._setCanvasSize(this.props);const t=Object.create(this.props);Object.assign(t,{views:this._getViews(),width:this.width,height:this.height,viewState:this._getViewState()}),this.animationLoop.setProps(t),this.layerManager&&(this.viewManager.setProps(t),this.layerManager.activateViewport(this.getViewports()[0]),this.layerManager.setProps(t),this.effectManager.setProps(t),this.deckRenderer.setProps(t),this.deckPicker.setProps(t)),this.stats.get("setProps Time").timeEnd()}needsRedraw(e={clearRedrawFlags:!1}){if(!this.layerManager)return!1;if(this.props._animate)return"Deck._animate";let t=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);const r=this.viewManager.needsRedraw(e),i=this.layerManager.needsRedraw(e),o=this.effectManager.needsRedraw(e),a=this.deckRenderer.needsRedraw(e);return t=t||r||i||o||a,t}redraw(e){if(!this.layerManager)return;let t=this.needsRedraw({clearRedrawFlags:!0});t=e||t,t&&(this.stats.get("Redraw Count").incrementCount(),this.props._customRender?this.props._customRender(t):this._drawLayers(t))}get isInitialized(){return this.viewManager!==null}getViews(){return Vo(this.viewManager),this.viewManager.views}getViewports(e){return Vo(this.viewManager),this.viewManager.getViewports(e)}getCanvas(){return this.canvas}pickObject(e){const t=this._pick("pickObject","pickObject Time",e).result;return t.length?t[0]:null}pickMultipleObjects(e){return e.depth=e.depth||10,this._pick("pickObject","pickMultipleObjects Time",e).result}pickObjects(e){return this._pick("pickObjects","pickObjects Time",e)}_addResources(e,t=!1){for(const r in e)this.layerManager.resourceManager.add({resourceId:r,data:e[r],forceUpdate:t})}_removeResources(e){for(const t of e)this.layerManager.resourceManager.remove(t)}_addDefaultEffect(e){this.effectManager.addDefaultEffect(e)}_pick(e,t,r){Vo(this.deckPicker);const{stats:i}=this;i.get("Pick Count").incrementCount(),i.get(t).timeStart();const o=this.deckPicker[e]({layers:this.layerManager.getLayers(r),views:this.viewManager.getViews(),viewports:this.getViewports(r),onViewportActive:this.layerManager.activateViewport,effects:this.effectManager.getEffects(),...r});return i.get(t).timeEnd(),o}_createCanvas(e){let t=e.canvas;return typeof t=="string"&&(t=document.getElementById(t),Vo(t)),t||(t=document.createElement("canvas"),t.id=e.id||"deckgl-overlay",(e.parent||document.body).appendChild(t)),Object.assign(t.style,e.style),t}_setCanvasSize(e){if(!this.canvas)return;const{width:t,height:r}=e;if(t||t===0){const o=Number.isFinite(t)?"".concat(t,"px"):t;this.canvas.style.width=o}if(r||r===0){var i;const o=Number.isFinite(r)?"".concat(r,"px"):r;this.canvas.style.position=((i=e.style)===null||i===void 0?void 0:i.position)||"absolute",this.canvas.style.height=o}}_updateCanvasSize(){var e,t;const{canvas:r}=this;if(!r)return;const i=(e=r.clientWidth)!==null&&e!==void 0?e:r.width,o=(t=r.clientHeight)!==null&&t!==void 0?t:r.height;if(i!==this.width||o!==this.height){var a,l;this.width=i,this.height=o,(a=this.viewManager)===null||a===void 0||a.setProps({width:i,height:o}),(l=this.layerManager)===null||l===void 0||l.activateViewport(this.getViewports()[0]),this.props.onResize({width:i,height:o})}}_createAnimationLoop(e){const{width:t,height:r,gl:i,glOptions:o,debug:a,onError:l,onBeforeRender:h,onAfterRender:p,useDevicePixels:g}=e;return new aW({width:t,height:r,useDevicePixels:g,autoResizeDrawingBuffer:!i,autoResizeViewport:!1,gl:i,onCreateContext:_=>EO({...o,..._,canvas:this.canvas,debug:a,onContextLost:()=>this._onContextLost()}),onInitialize:_=>this._setGLContext(_.gl),onRender:this._onRenderFrame.bind(this),onBeforeRender:h,onAfterRender:p,onError:l})}_getViewState(){return this.props.viewState||this.viewState}_getViews(){let e=this.props.views||[new uN({id:"default-view"})];return e=Array.isArray(e)?e:[e],e.length&&this.props.controller&&(e[0].props.controller=this.props.controller),e}_onContextLost(){const{onError:e}=this.props;this.animationLoop&&e&&e(new Error("WebGL context is lost"))}_pickAndCallback(){const{_pickRequest:e}=this;if(e.event){const{result:r,emptyInfo:i}=this._pick("pickObject","pickObject Time",e);this.cursorState.isHovering=r.length>0;let o=i,a=!1;for(const l of r){var t;o=l,a=((t=l.layer)===null||t===void 0?void 0:t.onHover(l,e.event))||a}if(!a&&this.props.onHover&&this.props.onHover(o,e.event),this.props.getTooltip&&this.tooltip){const l=this.props.getTooltip(o);this.tooltip.setTooltip(l,o.x,o.y)}e.event=null}}_updateCursor(){const e=this.props.parent||this.canvas;e&&(e.style.cursor=this.props.getCursor(this.cursorState))}_setGLContext(e){if(this.layerManager)return;this.canvas||(this.canvas=e.canvas,pS(e,{enable:!0,copyState:!0})),this.tooltip=new oX(this.canvas),Fl(e,{blend:!0,blendFunc:[770,771,1,771],polygonOffsetFill:!0,depthTest:!0,depthFunc:515}),this.props.onWebGLInitialized(e);const t=new LL;t.play(),this.animationLoop.attachTimeline(t),this.eventManager=new UX(this.props.parent||e.canvas,{touchAction:this.props.touchAction,recognizerOptions:this.props.eventRecognizerOptions,events:{pointerdown:this._onPointerDown,pointermove:this._onPointerMove,pointerleave:this._onPointerMove}});for(const i in sO)this.eventManager.on(i,this._onEvent);this.viewManager=new RZ({timeline:t,eventManager:this.eventManager,onViewStateChange:this._onViewStateChange.bind(this),onInteractionStateChange:this._onInteractionStateChange.bind(this),views:this._getViews(),viewState:this._getViewState(),width:this.width,height:this.height});const r=this.viewManager.getViewports()[0];this.layerManager=new MZ(e,{deck:this,stats:this.stats,viewport:r,timeline:t}),this.effectManager=new YZ,this.deckRenderer=new XZ(e),this.deckPicker=new rX(e),this.setProps(this.props),this._updateCanvasSize(),this.props.onLoad()}_drawLayers(e,t){const{gl:r}=this.layerManager.context;Fl(r,this.props.parameters),this.props.onBeforeRender({gl:r}),this.deckRenderer.renderLayers({target:this.props._framebuffer,layers:this.layerManager.getLayers(),viewports:this.viewManager.getViewports(),onViewportActive:this.layerManager.activateViewport,views:this.viewManager.getViews(),pass:"screen",effects:this.effectManager.getEffects(),...t}),this.props.onAfterRender({gl:r})}_onRenderFrame(e){this._getFrameStats(),this._metricsCounter++%60===0&&(this._getMetrics(),this.stats.reset(),Ir.table(4,this.metrics)(),this.props._onMetrics&&this.props._onMetrics(this.metrics)),this._updateCanvasSize(),this._updateCursor(),this.tooltip.isVisible&&this.viewManager.needsRedraw()&&this.tooltip.setTooltip(null),this.layerManager.updateLayers(),this._pickAndCallback(),this.redraw(),this.viewManager&&this.viewManager.updateViewStates()}_onViewStateChange(e){const t=this.props.onViewStateChange(e)||e.viewState;this.viewState&&(this.viewState={...this.viewState,[e.viewId]:t},this.props.viewState||this.viewManager&&this.viewManager.setProps({viewState:this.viewState}))}_onInteractionStateChange(e){this.cursorState.isDragging=e.isDragging||!1,this.props.onInteractionStateChange(e)}_getFrameStats(){const{stats:e}=this;e.get("frameRate").timeEnd(),e.get("frameRate").timeStart();const t=this.animationLoop.stats;e.get("GPU Time").addTime(t.get("GPU Time").lastTiming),e.get("CPU Time").addTime(t.get("CPU Time").lastTiming)}_getMetrics(){const{metrics:e,stats:t}=this;e.fps=t.get("frameRate").getHz(),e.setPropsTime=t.get("setProps Time").time,e.updateAttributesTime=t.get("Update Attributes").time,e.framesRedrawn=t.get("Redraw Count").count,e.pickTime=t.get("pickObject Time").time+t.get("pickMultipleObjects Time").time+t.get("pickObjects Time").time,e.pickCount=t.get("Pick Count").count,e.gpuTime=t.get("GPU Time").time,e.cpuTime=t.get("CPU Time").time,e.gpuTimePerFrame=t.get("GPU Time").getAverageTime(),e.cpuTimePerFrame=t.get("CPU Time").getAverageTime();const r=Ed.get("Memory Usage");e.bufferMemory=r.get("Buffer Memory").count,e.textureMemory=r.get("Texture Memory").count,e.renderbufferMemory=r.get("Renderbuffer Memory").count,e.gpuMemory=r.get("GPU Memory").count}}Y(sC,"defaultProps",MN),Y(sC,"VERSION",hG);class cC{constructor(e,t){Y(this,"opts",void 0),Y(this,"source",void 0),this.opts=t,this.source=e}get value(){return this.source.value}getValue(){const e=this.source.getBuffer(),t=this.getAccessor();if(e)return[e,t];const{value:r}=this.source,{size:i}=t;let o=r;if(r&&r.length!==i){o=new Float32Array(i);const a=t.elementOffset||0;for(let l=0;l<i;++l)o[l]=r[a+l]}return o}getAccessor(){return{...this.source.getAccessor(),...this.opts}}}function zX(n){switch(n){case 5126:return Float32Array;case 5130:return Float64Array;case 5123:case 33635:case 32819:case 32820:return Uint16Array;case 5125:return Uint32Array;case 5121:return Uint8ClampedArray;case 5120:return Int8Array;case 5122:return Int16Array;case 5124:return Int32Array;default:throw new Error("Unknown GL type")}}function u1(n){return n.stride||n.size*n.bytesPerElement}function RN(n,e){e.offset&&Ir.removed("shaderAttribute.offset","vertexOffset, elementOffset")();const t=u1(n),r=e.vertexOffset!==void 0?e.vertexOffset:n.vertexOffset||0,i=e.elementOffset||0,o=r*t+i*n.bytesPerElement+(n.offset||0);return{...e,offset:o,stride:t}}function jX(n,e){const t=RN(n,e);return{high:t,low:{...t,offset:t.offset+n.size*4}}}class VX{constructor(e,t,r){Y(this,"gl",void 0),Y(this,"id",void 0),Y(this,"size",void 0),Y(this,"settings",void 0),Y(this,"value",void 0),Y(this,"doublePrecision",void 0),Y(this,"_buffer",void 0),Y(this,"state",void 0),this.gl=e,this.id=t.id||"",this.size=t.size||1;const i=t.logicalType||t.type,o=i===5130;let{defaultValue:a}=t;a=Number.isFinite(a)?[a]:a||new Array(this.size).fill(0);let l;o?l=5126:!i&&t.isIndexed?l=e&&Dq(e,Ri.ELEMENT_INDEX_UINT32)?5125:5123:l=i||5126;let h=zX(i||l||5126);this.doublePrecision=o,o&&t.fp64===!1&&(h=Float32Array),this.value=null,this.settings={...t,defaultType:h,defaultValue:a,logicalType:i,type:l,size:this.size,bytesPerElement:h.BYTES_PER_ELEMENT},this.state={...r,externalBuffer:null,bufferAccessor:this.settings,allocatedValue:null,numInstances:0,bounds:null,constant:!1},this._buffer=null}get isConstant(){return this.state.constant}get buffer(){if(!this._buffer){const{isIndexed:e,type:t}=this.settings;this._buffer=new ni(this.gl,{id:this.id,target:e?34963:34962,accessor:{type:t}})}return this._buffer}get byteOffset(){const e=this.getAccessor();return e.vertexOffset?e.vertexOffset*u1(e):0}get numInstances(){return this.state.numInstances}set numInstances(e){this.state.numInstances=e}delete(){this._buffer&&(this._buffer.delete(),this._buffer=null),Xy.release(this.state.allocatedValue)}getShaderAttributes(e,t){if(this.doublePrecision){const r={},i=this.value instanceof Float64Array,o=jX(this.getAccessor(),t||{});return r[e]=new cC(this,o.high),r["".concat(e,"64Low")]=i?new cC(this,o.low):new Float32Array(this.size),r}if(t){const r=RN(this.getAccessor(),t);return{[e]:new cC(this,r)}}return{[e]:this}}getBuffer(){return this.state.constant?null:this.state.externalBuffer||this._buffer}getValue(){return this.state.constant?this.value:[this.getBuffer(),this.getAccessor()]}getAccessor(){return this.state.bufferAccessor}getBounds(){if(this.state.bounds)return this.state.bounds;let e=null;if(this.state.constant&&this.value){const t=Array.from(this.value);e=[t,t]}else{const{value:t,numInstances:r,size:i}=this,o=r*i;if(t&&o&&t.length>=o){const a=new Array(i).fill(1/0),l=new Array(i).fill(-1/0);for(let h=0;h<o;)for(let p=0;p<i;p++){const g=t[h++];g<a[p]&&(a[p]=g),g>l[p]&&(l[p]=g)}e=[a,l]}}return this.state.bounds=e,e}setData(e){const{state:t}=this;let r;ArrayBuffer.isView(e)?r={value:e}:e instanceof ni?r={buffer:e}:r=e;const i={...this.settings,...r};if(t.bufferAccessor=i,t.bounds=null,r.constant){let o=r.value;if(o=this._normalizeValue(o,[],0),this.settings.normalized&&(o=this.normalizeConstant(o)),!(!t.constant||!this._areValuesEqual(o,this.value)))return!1;t.externalBuffer=null,t.constant=!0,this.value=o}else if(r.buffer){const o=r.buffer;t.externalBuffer=o,t.constant=!1,this.value=r.value||null;const a=r.value instanceof Float64Array;i.type=r.type||o.accessor.type,i.bytesPerElement=o.accessor.BYTES_PER_ELEMENT*(a?2:1),i.stride=u1(i)}else if(r.value){this._checkExternalBuffer(r);let o=r.value;t.externalBuffer=null,t.constant=!1,this.value=o,i.bytesPerElement=o.BYTES_PER_ELEMENT,i.stride=u1(i);const{buffer:a,byteOffset:l}=this;this.doublePrecision&&o instanceof Float64Array&&(o=XS(o,i));const h=o.byteLength+l+i.stride*2;a.byteLength<h&&a.reallocate(h),a.setAccessor(null),a.subData({data:o,offset:l}),i.type=r.type||a.accessor.type}return!0}updateSubBuffer(e={}){this.state.bounds=null;const t=this.value,{startOffset:r=0,endOffset:i}=e;this.buffer.subData({data:this.doublePrecision&&t instanceof Float64Array?XS(t,{size:this.size,startIndex:r,endIndex:i}):t.subarray(r,i),offset:r*t.BYTES_PER_ELEMENT+this.byteOffset})}allocate(e,t=!1){const{state:r}=this,i=r.allocatedValue,o=Xy.allocate(i,e+1,{size:this.size,type:this.settings.defaultType,copy:t});this.value=o;const{buffer:a,byteOffset:l}=this;return a.byteLength<o.byteLength+l&&(a.reallocate(o.byteLength+l),t&&i&&a.subData({data:i instanceof Float64Array?XS(i,this):i,offset:l})),r.allocatedValue=o,r.constant=!1,r.externalBuffer=null,r.bufferAccessor=this.settings,!0}_checkExternalBuffer(e){const{value:t}=e;if(!ArrayBuffer.isView(t))throw new Error("Attribute ".concat(this.id," value is not TypedArray"));const r=this.settings.defaultType;let i=!1;if(this.doublePrecision&&(i=t.BYTES_PER_ELEMENT<4),i)throw new Error("Attribute ".concat(this.id," does not support ").concat(t.constructor.name));!(t instanceof r)&&this.settings.normalized&&!("normalized"in e)&&Ir.warn("Attribute ".concat(this.id," is normalized"))()}normalizeConstant(e){switch(this.settings.type){case 5120:return new Float32Array(e).map(t=>(t+128)/255*2-1);case 5122:return new Float32Array(e).map(t=>(t+32768)/65535*2-1);case 5121:return new Float32Array(e).map(t=>t/255);case 5123:return new Float32Array(e).map(t=>t/65535);default:return e}}_normalizeValue(e,t,r){const{defaultValue:i,size:o}=this.settings;if(Number.isFinite(e))return t[r]=e,t;if(!e){let a=o;for(;--a>=0;)t[r+a]=i[a];return t}switch(o){case 4:t[r+3]=Number.isFinite(e[3])?e[3]:i[3];case 3:t[r+2]=Number.isFinite(e[2])?e[2]:i[2];case 2:t[r+1]=Number.isFinite(e[1])?e[1]:i[1];case 1:t[r+0]=Number.isFinite(e[0])?e[0]:i[0];break;default:let a=o;for(;--a>=0;)t[r+a]=Number.isFinite(e[a])?e[a]:i[a]}return t}_areValuesEqual(e,t){if(!e||!t)return!1;const{size:r}=this;for(let i=0;i<r;i++)if(e[i]!==t[i])return!1;return!0}}const kN=[],ON=[];function lC(n,e=0,t=1/0){let r=kN;const i={index:-1,data:n,target:[]};return n?typeof n[Symbol.iterator]=="function"?r=n:n.length>0&&(ON.length=n.length,r=ON):r=kN,(e>0||Number.isFinite(t))&&(r=(Array.isArray(r)?r:Array.from(r)).slice(e,t),i.index=e-1),{iterable:r,objectInfo:i}}function LN(n){return n&&n[Symbol.asyncIterator]}function HX(n,e){const{size:t,stride:r,offset:i,startIndices:o,nested:a}=e,l=n.BYTES_PER_ELEMENT,h=r?r/l:t,p=i?i/l:0,g=Math.floor((n.length-p)/h);return(_,{index:x,target:C})=>{if(!o){const z=x*h+p;for(let ee=0;ee<t;ee++)C[ee]=n[z+ee];return C}const M=o[x],L=o[x+1]||g;let F;if(a){F=new Array(L-M);for(let z=M;z<L;z++){const ee=z*h+p;C=new Array(t);for(let ce=0;ce<t;ce++)C[ce]=n[ee+ce];F[z-M]=C}}else if(h===t)F=n.subarray(M*t+p,L*t+p);else{F=new n.constructor((L-M)*t);let z=0;for(let ee=M;ee<L;ee++){const ce=ee*h+p;for(let se=0;se<t;se++)F[z++]=n[ce+se]}}return F}}const GX=[],h1=[[0,1/0]];function qX(n,e){if(n===h1||(e[0]<0&&(e[0]=0),e[0]>=e[1]))return n;const t=[],r=n.length;let i=0;for(let o=0;o<r;o++){const a=n[o];a[1]<e[0]?(t.push(a),i=o+1):a[0]>e[1]?t.push(a):e=[Math.min(a[0],e[0]),Math.max(a[1],e[1])]}return t.splice(i,0,e),t}function uC(n){const{source:e,target:t,start:r=0,size:i,getData:o}=n,a=n.end||t.length,l=e.length,h=a-r;if(l>h){t.set(e.subarray(0,h),r);return}if(t.set(e,r),!o)return;let p=l;for(;p<h;){const g=o(p,e);for(let _=0;_<i;_++)t[r+p]=g[_]||0,p++}}function $X({source:n,target:e,size:t,getData:r,sourceStartIndices:i,targetStartIndices:o}){if(!Array.isArray(o))return uC({source:n,target:e,size:t,getData:r}),e;let a=0,l=0;const h=r&&((g,_)=>r(g+l,_)),p=Math.min(i.length,o.length);for(let g=1;g<p;g++){const _=i[g]*t,x=o[g]*t;uC({source:n.subarray(a,_),target:e,start:l,end:x,size:t,getData:h}),a=_,l=x}return l<e.length&&uC({source:[],target:e,start:l,size:t,getData:h}),e}const WX={interpolation:{duration:0,easing:n=>n},spring:{stiffness:.05,damping:.5}};function NN(n,e){if(!n)return null;Number.isFinite(n)&&(n={type:"interpolation",duration:n});const t=n.type||"interpolation";return{...WX[t],...e,...n,type:t}}function DN(n,e){const t=e.getBuffer();return t?[t,{divisor:0,size:e.size,normalized:e.settings.normalized}]:e.value}function FN(n){switch(n){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error('No defined attribute type for size "'.concat(n,'"'))}}function BN(n){n.push(n.shift())}function hC(n,e){const{doublePrecision:t,settings:r,value:i,size:o}=n,a=t&&i instanceof Float64Array?2:1;return(r.noAlloc?i.length:e*o)*a}function UN({buffer:n,numInstances:e,attribute:t,fromLength:r,fromStartIndices:i,getData:o=a=>a}){const a=t.doublePrecision&&t.value instanceof Float64Array?2:1,l=t.size*a,h=t.byteOffset,p=t.startIndices,g=i&&p,_=hC(t,e),x=t.isConstant;if(!g&&r>=_)return;const C=x?t.value:t.getBuffer().getData({srcByteOffset:h});if(t.settings.normalized&&!x){const z=o;o=(ee,ce)=>t.normalizeConstant(z(ee,ce))}const M=x?(z,ee)=>o(C,ee):(z,ee)=>o(C.subarray(z,z+l),ee),L=n.getData({length:r}),F=new Float32Array(_);$X({source:L,target:F,sourceStartIndices:i,targetStartIndices:p,size:l,getData:M}),n.byteLength<F.byteLength+h&&n.reallocate(F.byteLength+h),n.subData({data:F,offset:h})}class dC extends VX{constructor(e,t){super(e,t,{startIndices:null,lastExternalBuffer:null,binaryValue:null,binaryAccessor:null,needsUpdate:!0,needsRedraw:!1,updateRanges:h1}),Y(this,"constant",!1),this.settings.update=t.update||(t.accessor?this._autoUpdater:void 0),Object.seal(this.settings),Object.seal(this.state),this._validateAttributeUpdaters()}get startIndices(){return this.state.startIndices}set startIndices(e){this.state.startIndices=e}needsUpdate(){return this.state.needsUpdate}needsRedraw({clearChangedFlags:e=!1}={}){const t=this.state.needsRedraw;return this.state.needsRedraw=t&&!e,t}getUpdateTriggers(){const{accessor:e}=this.settings;return[this.id].concat(typeof e!="function"&&e||[])}supportsTransition(){return!!this.settings.transition}getTransitionSetting(e){if(!e||!this.supportsTransition())return null;const{accessor:t}=this.settings,r=this.settings.transition,i=Array.isArray(t)?e[t.find(o=>e[o])]:e[t];return NN(i,r)}setNeedsUpdate(e=this.id,t){if(this.state.needsUpdate=this.state.needsUpdate||e,this.setNeedsRedraw(e),t){const{startRow:r=0,endRow:i=1/0}=t;this.state.updateRanges=qX(this.state.updateRanges,[r,i])}else this.state.updateRanges=h1}clearNeedsUpdate(){this.state.needsUpdate=!1,this.state.updateRanges=GX}setNeedsRedraw(e=this.id){this.state.needsRedraw=this.state.needsRedraw||e}allocate(e){const{state:t,settings:r}=this;return r.noAlloc?!1:r.update?(super.allocate(e,t.updateRanges!==h1),!0):!1}updateBuffer({numInstances:e,data:t,props:r,context:i}){if(!this.needsUpdate())return!1;const{state:{updateRanges:o},settings:{update:a,noAlloc:l}}=this;let h=!0;if(a){for(const[p,g]of o)a.call(i,this,{data:t,startRow:p,endRow:g,props:r,numInstances:e});if(this.value)if(this.constant||this.buffer.byteLength<this.value.byteLength+this.byteOffset)this.setData({value:this.value,constant:this.constant}),this.constant=!1;else for(const[p,g]of o){const _=Number.isFinite(p)?this.getVertexOffset(p):0,x=Number.isFinite(g)?this.getVertexOffset(g):l||!Number.isFinite(e)?this.value.length:e*this.size;super.updateSubBuffer({startOffset:_,endOffset:x})}this._checkAttributeArray()}else h=!1;return this.clearNeedsUpdate(),this.setNeedsRedraw(),h}setConstantValue(e){return e===void 0||typeof e=="function"?!1:(this.setData({constant:!0,value:e})&&this.setNeedsRedraw(),this.clearNeedsUpdate(),!0)}setExternalBuffer(e){const{state:t}=this;return e?(this.clearNeedsUpdate(),t.lastExternalBuffer===e||(t.lastExternalBuffer=e,this.setNeedsRedraw(),this.setData(e)),!0):(t.lastExternalBuffer=null,!1)}setBinaryValue(e,t=null){const{state:r,settings:i}=this;if(!e)return r.binaryValue=null,r.binaryAccessor=null,!1;if(i.noAlloc)return!1;if(r.binaryValue===e)return this.clearNeedsUpdate(),!0;if(r.binaryValue=e,this.setNeedsRedraw(),i.transform||t!==this.startIndices){ArrayBuffer.isView(e)&&(e={value:e});const a=e;Vo(ArrayBuffer.isView(a.value),"invalid ".concat(i.accessor));const l=!!a.size&&a.size!==this.size;return r.binaryAccessor=HX(a.value,{size:a.size||this.size,stride:a.stride,offset:a.offset,startIndices:t,nested:l}),!1}return this.clearNeedsUpdate(),this.setData(e),!0}getVertexOffset(e){const{startIndices:t}=this;return(t?e<t.length?t[e]:this.numInstances:e)*this.size}getShaderAttributes(){const e=this.settings.shaderAttributes||{[this.id]:null},t={};for(const r in e)Object.assign(t,super.getShaderAttributes(r,e[r]));return t}_autoUpdater(e,{data:t,startRow:r,endRow:i,props:o,numInstances:a}){if(e.constant)return;const{settings:l,state:h,value:p,size:g,startIndices:_}=e,{accessor:x,transform:C}=l,M=h.binaryAccessor||(typeof x=="function"?x:o[x]);Vo(typeof M=="function",'accessor "'.concat(x,'" is not a function'));let L=e.getVertexOffset(r);const{iterable:F,objectInfo:z}=lC(t,r,i);for(const ee of F){z.index++;let ce=M(ee,z);if(C&&(ce=C.call(this,ce)),_){const se=(z.index<_.length-1?_[z.index+1]:a)-_[z.index];if(ce&&Array.isArray(ce[0])){let _e=L;for(const J of ce)e._normalizeValue(J,p,_e),_e+=g}else ce&&ce.length>g?p.set(ce,L):(e._normalizeValue(ce,z.target,0),xZ({target:p,source:z.target,start:L,count:se}));L+=se*g}else e._normalizeValue(ce,p,L),L+=g}}_validateAttributeUpdaters(){const{settings:e}=this;if(!(e.noAlloc||typeof e.update=="function"))throw new Error("Attribute ".concat(this.id," missing update or accessor"))}_checkAttributeArray(){const{value:e}=this,t=Math.min(4,this.size);if(e&&e.length>=t){let r=!0;switch(t){case 4:r=r&&Number.isFinite(e[3]);case 3:r=r&&Number.isFinite(e[2]);case 2:r=r&&Number.isFinite(e[1]);case 1:r=r&&Number.isFinite(e[0]);break;default:r=!1}if(!r)throw new Error("Illegal attribute generated for ".concat(this.id))}}}class YX{constructor({gl:e,attribute:t,timeline:r}){Y(this,"gl",void 0),Y(this,"type","interpolation"),Y(this,"attributeInTransition",void 0),Y(this,"settings",void 0),Y(this,"attribute",void 0),Y(this,"transition",void 0),Y(this,"currentStartIndices",void 0),Y(this,"currentLength",void 0),Y(this,"transform",void 0),Y(this,"buffers",void 0),this.gl=e,this.transition=new e_(r),this.attribute=t,this.attributeInTransition=new dC(e,t.settings),this.currentStartIndices=t.startIndices,this.currentLength=0,this.transform=ZX(e,t);const i={byteLength:0,usage:35050};this.buffers=[new ni(e,i),new ni(e,i)]}get inProgress(){return this.transition.inProgress}start(e,t){if(e.duration<=0){this.transition.cancel();return}this.settings=e;const{gl:r,buffers:i,attribute:o}=this;BN(i);const a={numInstances:t,attribute:o,fromLength:this.currentLength,fromStartIndices:this.currentStartIndices,getData:e.enter};for(const l of i)UN({buffer:l,...a});this.currentStartIndices=o.startIndices,this.currentLength=hC(o,t),this.attributeInTransition.setData({buffer:i[1],value:o.value}),this.transition.start(e),this.transform.update({elementCount:Math.floor(this.currentLength/o.size),sourceBuffers:{aFrom:i[0],aTo:DN(r,o)},feedbackBuffers:{vCurrent:i[1]}})}update(){const e=this.transition.update();if(e){const{duration:t,easing:r}=this.settings,{time:i}=this.transition;let o=i/t;r&&(o=r(o)),this.transform.run({uniforms:{time:o}})}return e}cancel(){this.transition.cancel(),this.transform.delete();for(const e of this.buffers)e.delete();this.buffers.length=0}}const KX=`
#define SHADER_NAME interpolation-transition-vertex-shader

uniform float time;
attribute ATTRIBUTE_TYPE aFrom;
attribute ATTRIBUTE_TYPE aTo;
varying ATTRIBUTE_TYPE vCurrent;

void main(void) {
  vCurrent = mix(aFrom, aTo, time);
  gl_Position = vec4(0.0);
}
`;function ZX(n,e){const t=FN(e.size);return new zS(n,{vs:KX,defines:{ATTRIBUTE_TYPE:t},varyings:["vCurrent"]})}class XX{constructor({gl:e,attribute:t,timeline:r}){Y(this,"gl",void 0),Y(this,"type","spring"),Y(this,"attributeInTransition",void 0),Y(this,"settings",void 0),Y(this,"attribute",void 0),Y(this,"transition",void 0),Y(this,"currentStartIndices",void 0),Y(this,"currentLength",void 0),Y(this,"texture",void 0),Y(this,"framebuffer",void 0),Y(this,"transform",void 0),Y(this,"buffers",void 0),this.gl=e,this.type="spring",this.transition=new e_(r),this.attribute=t,this.attributeInTransition=new dC(e,{...t.settings,normalized:!1}),this.currentStartIndices=t.startIndices,this.currentLength=0,this.texture=JX(e),this.framebuffer=eQ(e,this.texture),this.transform=QX(e,t,this.framebuffer);const i={byteLength:0,usage:35050};this.buffers=[new ni(e,i),new ni(e,i),new ni(e,i)]}get inProgress(){return this.transition.inProgress}start(e,t){const{gl:r,buffers:i,attribute:o}=this,a={numInstances:t,attribute:o,fromLength:this.currentLength,fromStartIndices:this.currentStartIndices,getData:e.enter};for(const l of i)UN({buffer:l,...a});this.settings=e,this.currentStartIndices=o.startIndices,this.currentLength=hC(o,t),this.attributeInTransition.setData({buffer:i[1],value:o.value}),this.transition.start({...e,duration:1/0}),this.transform.update({elementCount:Math.floor(this.currentLength/o.size),sourceBuffers:{aTo:DN(r,o)}})}update(){const{buffers:e,transform:t,framebuffer:r,transition:i}=this;if(!i.update())return!1;const a=this.settings;return t.update({sourceBuffers:{aPrev:e[0],aCur:e[1]},feedbackBuffers:{vNext:e[2]}}),t.run({framebuffer:r,discard:!1,clearRenderTarget:!0,uniforms:{stiffness:a.stiffness,damping:a.damping},parameters:{depthTest:!1,blend:!0,viewport:[0,0,1,1],blendFunc:[1,1],blendEquation:[32776,32776]}}),BN(e),this.attributeInTransition.setData({buffer:e[1],value:this.attribute.value}),Ub(r)[0]>0||i.end(),!0}cancel(){this.transition.cancel(),this.transform.delete();for(const e of this.buffers)e.delete();this.buffers.length=0,this.texture.delete(),this.framebuffer.delete()}}function QX(n,e,t){const r=FN(e.size);return new zS(n,{framebuffer:t,vs:`
#define SHADER_NAME spring-transition-vertex-shader

#define EPSILON 0.00001

uniform float stiffness;
uniform float damping;
attribute ATTRIBUTE_TYPE aPrev;
attribute ATTRIBUTE_TYPE aCur;
attribute ATTRIBUTE_TYPE aTo;
varying ATTRIBUTE_TYPE vNext;
varying float vIsTransitioningFlag;

ATTRIBUTE_TYPE getNextValue(ATTRIBUTE_TYPE cur, ATTRIBUTE_TYPE prev, ATTRIBUTE_TYPE dest) {
  ATTRIBUTE_TYPE velocity = cur - prev;
  ATTRIBUTE_TYPE delta = dest - cur;
  ATTRIBUTE_TYPE spring = delta * stiffness;
  ATTRIBUTE_TYPE damper = velocity * -1.0 * damping;
  return spring + damper + velocity + cur;
}

void main(void) {
  bool isTransitioning = length(aCur - aPrev) > EPSILON || length(aTo - aCur) > EPSILON;
  vIsTransitioningFlag = isTransitioning ? 1.0 : 0.0;

  vNext = getNextValue(aCur, aPrev, aTo);
  gl_Position = vec4(0, 0, 0, 1);
  gl_PointSize = 100.0;
}
`,fs:`
#define SHADER_NAME spring-transition-is-transitioning-fragment-shader

varying float vIsTransitioningFlag;

void main(void) {
  if (vIsTransitioningFlag == 0.0) {
    discard;
  }
  gl_FragColor = vec4(1.0);
}`,defines:{ATTRIBUTE_TYPE:r},varyings:["vNext"]})}function JX(n){return new fs(n,{data:new Uint8Array(4),format:6408,type:5121,border:0,mipmaps:!1,dataFormat:6408,width:1,height:1})}function eQ(n,e){return new _o(n,{id:"spring-transition-is-transitioning-framebuffer",width:1,height:1,attachments:{36064:e}})}const tQ={interpolation:YX,spring:XX};class nQ{constructor(e,{id:t,timeline:r}){Y(this,"id",void 0),Y(this,"isSupported",void 0),Y(this,"gl",void 0),Y(this,"timeline",void 0),Y(this,"transitions",void 0),Y(this,"needsRedraw",void 0),Y(this,"numInstances",void 0),this.id=t,this.gl=e,this.timeline=r,this.transitions={},this.needsRedraw=!1,this.numInstances=1,this.isSupported=zS.isSupported(e)}finalize(){for(const e in this.transitions)this._removeTransition(e)}update({attributes:e,transitions:t,numInstances:r}){this.numInstances=r||1;for(const i in e){const o=e[i],a=o.getTransitionSetting(t);a&&this._updateAttribute(i,o,a)}for(const i in this.transitions){const o=e[i];(!o||!o.getTransitionSetting(t))&&this._removeTransition(i)}}hasAttribute(e){const t=this.transitions[e];return t&&t.inProgress}getAttributes(){const e={};for(const t in this.transitions){const r=this.transitions[t];r.inProgress&&(e[t]=r.attributeInTransition)}return e}run(){if(!this.isSupported||this.numInstances===0)return!1;for(const t in this.transitions)this.transitions[t].update()&&(this.needsRedraw=!0);const e=this.needsRedraw;return this.needsRedraw=!1,e}_removeTransition(e){this.transitions[e].cancel(),delete this.transitions[e]}_updateAttribute(e,t,r){const i=this.transitions[e];let o=!i||i.type!==r.type;if(o){if(!this.isSupported){Ir.warn("WebGL2 not supported by this browser. Transition for ".concat(e," is disabled."))();return}i&&this._removeTransition(e);const a=tQ[r.type];a?this.transitions[e]=new a({attribute:t,timeline:this.timeline,gl:this.gl}):(Ir.error("unsupported transition type '".concat(r.type,"'"))(),o=!1)}(o||t.needsRedraw())&&(this.needsRedraw=!0,this.transitions[e].start(r,this.numInstances))}}const zN="attributeManager.invalidate",rQ="attributeManager.updateStart",iQ="attributeManager.updateEnd",oQ="attribute.updateStart",aQ="attribute.allocate",sQ="attribute.updateEnd";class cQ{constructor(e,{id:t="attribute-manager",stats:r,timeline:i}={}){Y(this,"id",void 0),Y(this,"gl",void 0),Y(this,"attributes",void 0),Y(this,"updateTriggers",void 0),Y(this,"needsRedraw",void 0),Y(this,"userData",void 0),Y(this,"stats",void 0),Y(this,"attributeTransitionManager",void 0),Y(this,"mergeBoundsMemoized",Ky(fZ)),this.id=t,this.gl=e,this.attributes={},this.updateTriggers={},this.needsRedraw=!0,this.userData={},this.stats=r,this.attributeTransitionManager=new nQ(e,{id:"".concat(t,"-transitions"),timeline:i}),Object.seal(this)}finalize(){for(const e in this.attributes)this.attributes[e].delete();this.attributeTransitionManager.finalize()}getNeedsRedraw(e={clearRedrawFlags:!1}){const t=this.needsRedraw;return this.needsRedraw=this.needsRedraw&&!e.clearRedrawFlags,t&&this.id}setNeedsRedraw(){this.needsRedraw=!0}add(e){this._add(e)}addInstanced(e){this._add(e,{instanced:1})}remove(e){for(const t of e)this.attributes[t]!==void 0&&(this.attributes[t].delete(),delete this.attributes[t])}invalidate(e,t){const r=this._invalidateTrigger(e,t);oa(zN,this,e,r)}invalidateAll(e){for(const t in this.attributes)this.attributes[t].setNeedsUpdate(t,e);oa(zN,this,"all")}update({data:e,numInstances:t,startIndices:r=null,transitions:i,props:o={},buffers:a={},context:l={}}){let h=!1;oa(rQ,this),this.stats&&this.stats.get("Update Attributes").timeStart();for(const p in this.attributes){const g=this.attributes[p],_=g.settings.accessor;g.startIndices=r,g.numInstances=t,o[p]&&Ir.removed("props.".concat(p),"data.attributes.".concat(p))(),g.setExternalBuffer(a[p])||g.setBinaryValue(typeof _=="string"?a[_]:void 0,e.startIndices)||typeof _=="string"&&!a[_]&&g.setConstantValue(o[_])||g.needsUpdate()&&(h=!0,this._updateAttribute({attribute:g,numInstances:t,data:e,props:o,context:l})),this.needsRedraw=this.needsRedraw||g.needsRedraw()}h&&oa(iQ,this,t),this.stats&&this.stats.get("Update Attributes").timeEnd(),this.attributeTransitionManager.update({attributes:this.attributes,numInstances:t,transitions:i})}updateTransition(){const{attributeTransitionManager:e}=this,t=e.run();return this.needsRedraw=this.needsRedraw||t,t}getAttributes(){return this.attributes}getBounds(e){const t=e.map(r=>{var i;return(i=this.attributes[r])===null||i===void 0?void 0:i.getBounds()});return this.mergeBoundsMemoized(t)}getChangedAttributes(e={clearChangedFlags:!1}){const{attributes:t,attributeTransitionManager:r}=this,i={...r.getAttributes()};for(const o in t){const a=t[o];a.needsRedraw(e)&&!r.hasAttribute(o)&&(i[o]=a)}return i}getShaderAttributes(e,t={}){e||(e=this.getAttributes());const r={};for(const i in e)t[i]||Object.assign(r,e[i].getShaderAttributes());return r}_add(e,t={}){for(const r in e){const i=e[r];this.attributes[r]=this._createAttribute(r,i,t)}this._mapUpdateTriggersToAttributes()}_createAttribute(e,t,r){const i={...t,id:e,size:t.isIndexed&&1||t.size||1,divisor:r.instanced?1:t.divisor||0};return new dC(this.gl,i)}_mapUpdateTriggersToAttributes(){const e={};for(const t in this.attributes)this.attributes[t].getUpdateTriggers().forEach(i=>{e[i]||(e[i]=[]),e[i].push(t)});this.updateTriggers=e}_invalidateTrigger(e,t){const{attributes:r,updateTriggers:i}=this,o=i[e];return o&&o.forEach(a=>{const l=r[a];l&&l.setNeedsUpdate(l.id,t)}),o}_updateAttribute(e){const{attribute:t,numInstances:r}=e;if(oa(oQ,t),t.constant){t.setConstantValue(t.value);return}t.allocate(r)&&oa(aQ,t,r),t.updateBuffer(e)&&(this.needsRedraw=!0,oa(sQ,t,r))}}class lQ extends e_{get value(){return this._value}_onUpdate(){const{time:e,settings:{fromValue:t,toValue:r,duration:i,easing:o}}=this,a=o(e/i);this._value=Kb(t,r,a)}}const jN=1e-5;function VN(n,e,t,r,i){const o=e-n,l=(t-e)*i,h=-o*r;return l+h+o+e}function uQ(n,e,t,r,i){if(Array.isArray(t)){const o=[];for(let a=0;a<t.length;a++)o[a]=VN(n[a],e[a],t[a],r,i);return o}return VN(n,e,t,r,i)}function HN(n,e){if(Array.isArray(n)){let t=0;for(let r=0;r<n.length;r++){const i=n[r]-e[r];t+=i*i}return Math.sqrt(t)}return Math.abs(n-e)}class hQ extends e_{get value(){return this._currValue}_onUpdate(){const{fromValue:e,toValue:t,damping:r,stiffness:i}=this.settings,{_prevValue:o=e,_currValue:a=e}=this;let l=uQ(o,a,t,r,i);const h=HN(l,t),p=HN(l,a);h<jN&&p<jN&&(l=t,this.end()),this._prevValue=a,this._currValue=l}}const dQ={interpolation:lQ,spring:hQ};class fQ{constructor(e){this.transitions=new Map,this.timeline=e}get active(){return this.transitions.size>0}add(e,t,r,i){const{transitions:o}=this;if(o.has(e)){const h=o.get(e),{value:p=h.settings.fromValue}=h;t=p,this.remove(e)}if(i=NN(i),!i)return;const a=dQ[i.type];if(!a){Ir.error("unsupported transition type '".concat(i.type,"'"))();return}const l=new a(this.timeline);l.start({...i,fromValue:t,toValue:r}),o.set(e,l)}remove(e){const{transitions:t}=this;t.has(e)&&(t.get(e).cancel(),t.delete(e))}update(){const e={};for(const[t,r]of this.transitions)r.update(),e[t]=r.value,r.inProgress||this.remove(t);return e}clear(){for(const e of this.transitions.keys())this.remove(e)}}function pQ(n){const e=n[Wu];for(const t in e){const r=e[t],{validate:i}=r;if(i&&!i(n[t],r))throw new Error("Invalid prop ".concat(t,": ").concat(n[t]))}}function gQ(n,e){const t=GN({newProps:n,oldProps:e,propTypes:n[Wu],ignoreProps:{data:null,updateTriggers:null,extensions:null,transitions:null}}),r=yQ(n,e);let i=!1;return r||(i=_Q(n,e)),{dataChanged:r,propsChanged:t,updateTriggersChanged:i,extensionsChanged:vQ(n,e),transitionsChanged:mQ(n,e)}}function mQ(n,e){if(!n.transitions)return!1;const t={},r=n[Wu];let i=!1;for(const o in n.transitions){const a=r[o],l=a&&a.type;(l==="number"||l==="color"||l==="array")&&fC(n[o],e[o],a)&&(t[o]=!0,i=!0)}return i?t:!1}function GN({newProps:n,oldProps:e,ignoreProps:t={},propTypes:r={},triggerName:i="props"}){if(e===n)return!1;if(typeof n!="object"||n===null||typeof e!="object"||e===null)return"".concat(i," changed shallowly");for(const o of Object.keys(n))if(!(o in t)){if(!(o in e))return"".concat(i,".").concat(o," added");const a=fC(n[o],e[o],r[o]);if(a)return"".concat(i,".").concat(o," ").concat(a)}for(const o of Object.keys(e))if(!(o in t)){if(!(o in n))return"".concat(i,".").concat(o," dropped");if(!Object.hasOwnProperty.call(n,o)){const a=fC(n[o],e[o],r[o]);if(a)return"".concat(i,".").concat(o," ").concat(a)}}return!1}function fC(n,e,t){let r=t&&t.equal;return r&&!r(n,e,t)||!r&&(r=n&&e&&n.equals,r&&!r.call(n,e))?"changed deeply":!r&&e!==n?"changed shallowly":null}function yQ(n,e){if(e===null)return"oldProps is null, initial diff";let t=!1;const{dataComparator:r,_dataDiff:i}=n;return r?r(n.data,e.data)||(t="Data comparator detected a change"):n.data!==e.data&&(t="A new data container was supplied"),t&&i&&(t=i(n.data,e.data)||t),t}function _Q(n,e){if(e===null)return{all:!0};if("all"in n.updateTriggers&&qN(n,e,"all"))return{all:!0};const t={};let r=!1;for(const i in n.updateTriggers)i!=="all"&&qN(n,e,i)&&(t[i]=!0,r=!0);return r?t:!1}function vQ(n,e){if(e===null)return!0;const t=e.extensions,{extensions:r}=n;if(r===t)return!1;if(!t||!r||r.length!==t.length)return!0;for(let i=0;i<r.length;i++)if(!r[i].equals(t[i]))return!0;return!1}function qN(n,e,t){let r=n.updateTriggers[t];r=r??{};let i=e.updateTriggers[t];return i=i??{},GN({oldProps:i,newProps:r,triggerName:t})}const bQ="count(): argument not an object",wQ="count(): argument not a container";function xQ(n){if(!TQ(n))throw new Error(bQ);if(typeof n.count=="function")return n.count();if(Number.isFinite(n.size))return n.size;if(Number.isFinite(n.length))return n.length;if(EQ(n))return Object.keys(n).length;throw new Error(wQ)}function EQ(n){return n!==null&&typeof n=="object"&&n.constructor===Object}function TQ(n){return n!==null&&typeof n=="object"}function SQ(n,e){if(!e)return n;const t={...n,...e};if("defines"in e&&(t.defines={...n.defines,...e.defines}),"modules"in e&&(t.modules=(n.modules||[]).concat(e.modules),e.modules.some(r=>r.name==="project64"))){const r=t.modules.findIndex(i=>i.name==="project32");r>=0&&t.modules.splice(r,1)}if("inject"in e)if(!n.inject)t.inject=e.inject;else{const r={...n.inject};for(const i in e.inject)r[i]=(r[i]||"")+e.inject[i];t.inject=r}return t}const CQ={10241:9987,10240:9729,10242:33071,10243:33071},pC={};function AQ(n,e,t,r){if(t instanceof fs)return t;t.constructor&&t.constructor.name!=="Object"&&(t={data:t});let i=null;t.compressed&&(i={10241:t.data.length>1?9985:9729});const o=new fs(e,{...t,parameters:{...CQ,...i,...r}});return pC[o.id]=n,o}function IQ(n,e){!e||!(e instanceof fs)||pC[e.id]===n&&(e.delete(),delete pC[e.id])}const PQ={boolean:{validate(n,e){return!0},equal(n,e,t){return!!n==!!e}},number:{validate(n,e){return Number.isFinite(n)&&(!("max"in e)||n<=e.max)&&(!("min"in e)||n>=e.min)}},color:{validate(n,e){return e.optional&&!n||gC(n)&&(n.length===3||n.length===4)},equal(n,e,t){return Hc(n,e,1)}},accessor:{validate(n,e){const t=d1(n);return t==="function"||t===d1(e.value)},equal(n,e,t){return typeof e=="function"?!0:Hc(n,e,1)}},array:{validate(n,e){return e.optional&&!n||gC(n)},equal(n,e,t){const{compare:r}=t,i=Number.isInteger(r)?r:r?1:0;return r?Hc(n,e,i):n===e}},object:{equal(n,e,t){if(t.ignore)return!0;const{compare:r}=t,i=Number.isInteger(r)?r:r?1:0;return r?Hc(n,e,i):n===e}},function:{validate(n,e){return e.optional&&!n||typeof n=="function"},equal(n,e,t){return!t.compare&&t.ignore!==!1||n===e}},data:{transform:(n,e,t)=>{const{dataTransform:r}=t.props;return r&&n?r(n):n}},image:{transform:(n,e,t)=>{const r=t.context;return!r||!r.gl?null:AQ(t.id,r.gl,n,{...e.parameters,...t.props.textureParameters})},release:(n,e,t)=>{IQ(t.id,n)}}};function MQ(n){const e={},t={},r={};for(const[i,o]of Object.entries(n)){const a=o==null?void 0:o.deprecatedFor;if(a)r[i]=Array.isArray(a)?a:[a];else{const l=RQ(i,o);e[i]=l,t[i]=l.value}}return{propTypes:e,defaultProps:t,deprecatedProps:r}}function RQ(n,e){switch(d1(e)){case"object":return n_(n,e);case"array":return n_(n,{type:"array",value:e,compare:!1});case"boolean":return n_(n,{type:"boolean",value:e});case"number":return n_(n,{type:"number",value:e});case"function":return n_(n,{type:"function",value:e,compare:!0});default:return{name:n,type:"unknown",value:e}}}function n_(n,e){return"type"in e?{name:n,...PQ[e.type],...e}:"value"in e?{name:n,type:d1(e.value),...e}:{name:n,type:"object",value:e}}function gC(n){return Array.isArray(n)||ArrayBuffer.isView(n)}function d1(n){return gC(n)?"array":n===null?"null":typeof n}function kQ(n,e){let t;for(let o=e.length-1;o>=0;o--){const a=e[o];"extensions"in a&&(t=a.extensions)}const r=mC(n.constructor,t),i=Object.create(r);i[s1]=n,i[Id]={},i[Yu]={};for(let o=0;o<e.length;++o){const a=e[o];for(const l in a)i[l]=a[l]}return Object.freeze(i),i}const OQ="_mergedDefaultProps";function mC(n,e){let t=OQ;if(e)for(const i of e){const o=i.constructor;o&&(t+=":".concat(o.extensionName||o.name))}const r=$N(n,t);return r||(n[t]=LQ(n,e||[]))}function LQ(n,e){if(!n.prototype)return null;const r=Object.getPrototypeOf(n),i=mC(r),o=$N(n,"defaultProps")||{},a=MQ(o),l=Object.assign(Object.create(null),i,a.defaultProps),h=Object.assign(Object.create(null),i==null?void 0:i[Wu],a.propTypes),p=Object.assign(Object.create(null),i==null?void 0:i[JS],a.deprecatedProps);for(const g of e){const _=mC(g.constructor);_&&(Object.assign(l,_),Object.assign(h,_[Wu]),Object.assign(p,_[JS]))}return NQ(l,n),FQ(l,h),DQ(l,p),l[Wu]=h,l[JS]=p,e.length===0&&!yC(n,"_propTypes")&&(n._propTypes=h),l}function NQ(n,e){const t=UQ(e);Object.defineProperties(n,{id:{writable:!0,value:t}})}function DQ(n,e){for(const t in e)Object.defineProperty(n,t,{enumerable:!1,set(r){const i="".concat(this.id,": ").concat(t);for(const o of e[t])yC(this,o)||(this[o]=r);Ir.deprecated(i,e[t].join("/"))()}})}function FQ(n,e){const t={},r={};for(const i in e){const o=e[i],{name:a,value:l}=o;o.async&&(t[a]=l,r[a]=BQ(a))}n[zp]=t,n[Id]={},Object.defineProperties(n,r)}function BQ(n){return{enumerable:!0,set(e){typeof e=="string"||e instanceof Promise||LN(e)?this[Id][n]=e:this[Yu][n]=e},get(){if(this[Yu]){if(n in this[Yu])return this[Yu][n]||this[zp][n];if(n in this[Id]){const e=this[s1]&&this[s1].internalState;if(e&&e.hasAsyncProp(n))return e.getAsyncProp(n)||this[zp][n]}}return this[zp][n]}}}function yC(n,e){return Object.prototype.hasOwnProperty.call(n,e)}function $N(n,e){return yC(n,e)&&n[e]}function UQ(n){const e=n.componentName;return e||Ir.warn("".concat(n.name,".componentName not specified"))(),e||n.name}let zQ=0;class _C{constructor(...e){Y(this,"id",void 0),Y(this,"props",void 0),Y(this,"count",void 0),this.props=kQ(this,e),this.id=this.props.id,this.count=zQ++}clone(e){const{props:t}=this,r={};for(const i in t[zp])i in t[Yu]?r[i]=t[Yu][i]:i in t[Id]&&(r[i]=t[Id][i]);return new this.constructor({...t,...r,...e})}}Y(_C,"componentName","Component"),Y(_C,"defaultProps",{});const jQ=Object.freeze({});class VQ{constructor(e){Y(this,"component",void 0),Y(this,"onAsyncPropUpdated",void 0),Y(this,"asyncProps",void 0),Y(this,"oldProps",void 0),Y(this,"oldAsyncProps",void 0),this.component=e,this.asyncProps={},this.onAsyncPropUpdated=()=>{},this.oldProps=null,this.oldAsyncProps=null}finalize(){for(const e in this.asyncProps){const t=this.asyncProps[e];t&&t.type&&t.type.release&&t.type.release(t.resolvedValue,t.type,this.component)}this.asyncProps={},this.component=null,this.resetOldProps()}getOldProps(){return this.oldAsyncProps||this.oldProps||jQ}resetOldProps(){this.oldAsyncProps=null,this.oldProps=this.component?this.component.props:null}hasAsyncProp(e){return e in this.asyncProps}getAsyncProp(e){const t=this.asyncProps[e];return t&&t.resolvedValue}isAsyncPropLoading(e){if(e){const t=this.asyncProps[e];return!!(t&&t.pendingLoadCount>0&&t.pendingLoadCount!==t.resolvedLoadCount)}for(const t in this.asyncProps)if(this.isAsyncPropLoading(t))return!0;return!1}reloadAsyncProp(e,t){this._watchPromise(e,Promise.resolve(t))}setAsyncProps(e){this.component=e[s1]||this.component;const t=e[Yu]||{},r=e[Id]||e,i=e[zp]||{};for(const o in t){const a=t[o];this._createAsyncPropData(o,i[o]),this._updateAsyncProp(o,a),t[o]=this.getAsyncProp(o)}for(const o in r){const a=r[o];this._createAsyncPropData(o,i[o]),this._updateAsyncProp(o,a)}}_fetch(e,t){return null}_onResolve(e,t){}_onError(e,t){}_updateAsyncProp(e,t){if(this._didAsyncInputValueChange(e,t)){if(typeof t=="string"&&(t=this._fetch(e,t)),t instanceof Promise){this._watchPromise(e,t);return}if(LN(t)){this._resolveAsyncIterable(e,t);return}this._setPropValue(e,t)}}_freezeAsyncOldProps(){if(!this.oldAsyncProps&&this.oldProps){this.oldAsyncProps=Object.create(this.oldProps);for(const e in this.asyncProps)Object.defineProperty(this.oldAsyncProps,e,{enumerable:!0,value:this.oldProps[e]})}}_didAsyncInputValueChange(e,t){const r=this.asyncProps[e];return t===r.resolvedValue||t===r.lastValue?!1:(r.lastValue=t,!0)}_setPropValue(e,t){this._freezeAsyncOldProps();const r=this.asyncProps[e];r&&(t=this._postProcessValue(r,t),r.resolvedValue=t,r.pendingLoadCount++,r.resolvedLoadCount=r.pendingLoadCount)}_setAsyncPropValue(e,t,r){const i=this.asyncProps[e];i&&r>=i.resolvedLoadCount&&t!==void 0&&(this._freezeAsyncOldProps(),i.resolvedValue=t,i.resolvedLoadCount=r,this.onAsyncPropUpdated(e,t))}_watchPromise(e,t){const r=this.asyncProps[e];if(r){r.pendingLoadCount++;const i=r.pendingLoadCount;t.then(o=>{this.component&&(o=this._postProcessValue(r,o),this._setAsyncPropValue(e,o,i),this._onResolve(e,o))}).catch(o=>{this._onError(e,o)})}}async _resolveAsyncIterable(e,t){if(e!=="data"){this._setPropValue(e,t);return}const r=this.asyncProps[e];if(!r)return;r.pendingLoadCount++;const i=r.pendingLoadCount;let o=[],a=0;for await(const l of t){if(!this.component)return;const{dataTransform:h}=this.component.props;h?o=h(l,o):o=o.concat(l),Object.defineProperty(o,"__diff",{enumerable:!1,value:[{startRow:a,endRow:o.length}]}),a=o.length,this._setAsyncPropValue(e,o,i)}this._onResolve(e,o)}_postProcessValue(e,t){const r=e.type;return r&&this.component&&(r.release&&r.release(e.resolvedValue,r,this.component),r.transform)?r.transform(t,r,this.component):t}_createAsyncPropData(e,t){if(!this.asyncProps[e]){const i=this.component&&this.component.props[Wu];this.asyncProps[e]={type:i&&i[e],lastValue:null,resolvedValue:t,pendingLoadCount:0,resolvedLoadCount:0}}}}class HQ extends VQ{constructor({attributeManager:e,layer:t}){super(t),Y(this,"attributeManager",void 0),Y(this,"needsRedraw",void 0),Y(this,"needsUpdate",void 0),Y(this,"subLayers",void 0),Y(this,"usesPickingColorCache",void 0),Y(this,"hasPickingBuffer",void 0),Y(this,"changeFlags",void 0),Y(this,"viewport",void 0),Y(this,"uniformTransitions",void 0),Y(this,"propsInTransition",void 0),this.attributeManager=e,this.needsRedraw=!0,this.needsUpdate=!0,this.subLayers=null,this.usesPickingColorCache=!1}get layer(){return this.component}_fetch(e,t){const r=this.layer,i=r==null?void 0:r.props.fetch;return i?i(t,{propName:e,layer:r}):super._fetch(e,t)}_onResolve(e,t){const r=this.layer;if(r){const i=r.props.onDataLoad;e==="data"&&i&&i(t,{propName:e,layer:r})}}_onError(e,t){const r=this.layer;r&&r.raiseError(t,"loading ".concat(e," of ").concat(this.layer))}}const GQ="layer.changeFlag",qQ="layer.initialize",$Q="layer.update",WQ="layer.finalize",YQ="layer.matched",WN=2**24-1,KQ=Object.freeze([]),ZQ=Ky(({oldViewport:n,viewport:e})=>n.equals(e));let qc=new Uint8ClampedArray(0);const XQ={data:{type:"data",value:KQ,async:!0},dataComparator:{type:"function",value:null,optional:!0},_dataDiff:{type:"function",value:n=>n&&n.__diff,optional:!0},dataTransform:{type:"function",value:null,optional:!0},onDataLoad:{type:"function",value:null,optional:!0},onError:{type:"function",value:null,optional:!0},fetch:{type:"function",value:(n,{propName:e,layer:t,loaders:r,loadOptions:i,signal:o})=>{const{resourceManager:a}=t.context;if(i=i||t.getLoadOptions(),r=r||t.props.loaders,o){var l;i={...i,fetch:{...(l=i)===null||l===void 0?void 0:l.fetch,signal:o}}}let h=a.contains(n);return!h&&!i&&(a.add({resourceId:n,data:Nb(n,r),persistent:!1}),h=!0),h?a.subscribe({resourceId:n,onChange:p=>{var g;return(g=t.internalState)===null||g===void 0?void 0:g.reloadAsyncProp(e,p)},consumerId:t.id,requestId:e}):Nb(n,r,i)}},updateTriggers:{},visible:!0,pickable:!1,opacity:{type:"number",min:0,max:1,value:1},operation:"draw",onHover:{type:"function",value:null,optional:!0},onClick:{type:"function",value:null,optional:!0},onDragStart:{type:"function",value:null,optional:!0},onDrag:{type:"function",value:null,optional:!0},onDragEnd:{type:"function",value:null,optional:!0},coordinateSystem:Zr.DEFAULT,coordinateOrigin:{type:"array",value:[0,0,0],compare:!0},modelMatrix:{type:"array",value:null,compare:!0,optional:!0},wrapLongitude:!1,positionFormat:"XYZ",colorFormat:"RGBA",parameters:{type:"object",value:{},optional:!0,compare:2},loadOptions:{type:"object",value:null,optional:!0,ignore:!0},transitions:null,extensions:[],loaders:{type:"array",value:[],optional:!0,ignore:!0},getPolygonOffset:{type:"function",value:({layerIndex:n})=>[0,-n*100]},highlightedObjectIndex:null,autoHighlight:!1,highlightColor:{type:"accessor",value:[0,0,128,128]}};let Vl=class extends _C{constructor(...e){super(...e),Y(this,"internalState",null),Y(this,"lifecycle",Up.NO_STATE),Y(this,"context",void 0),Y(this,"state",void 0),Y(this,"parent",null)}static get componentName(){return Object.prototype.hasOwnProperty.call(this,"layerName")?this.layerName:""}get root(){let e=this;for(;e.parent;)e=e.parent;return e}toString(){const e=this.constructor.layerName||this.constructor.name;return"".concat(e,"({id: '").concat(this.props.id,"'})")}project(e){Vo(this.internalState);const t=this.internalState.viewport||this.context.viewport,r=rN(e,{viewport:t,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem}),[i,o,a]=YS(r,t.pixelProjectionMatrix);return e.length===2?[i,o]:[i,o,a]}unproject(e){return Vo(this.internalState),(this.internalState.viewport||this.context.viewport).unproject(e)}projectPosition(e,t){Vo(this.internalState);const r=this.internalState.viewport||this.context.viewport;return vZ(e,{viewport:r,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem,...t})}get isComposite(){return!1}setState(e){this.setChangeFlags({stateChanged:!0}),Object.assign(this.state,e),this.setNeedsRedraw()}setNeedsRedraw(){this.internalState&&(this.internalState.needsRedraw=!0)}setNeedsUpdate(){this.internalState&&(this.context.layerManager.setNeedsUpdate(String(this)),this.internalState.needsUpdate=!0)}get isLoaded(){return this.internalState?!this.internalState.isAsyncPropLoading():!1}get wrapLongitude(){return this.props.wrapLongitude}isPickable(){return this.props.pickable&&this.props.visible}getModels(){return this.state&&(this.state.models||this.state.model&&[this.state.model])||[]}setModuleParameters(e){for(const t of this.getModels())t.updateModuleSettings(e)}getAttributeManager(){return this.internalState&&this.internalState.attributeManager}getCurrentLayer(){return this.internalState&&this.internalState.layer}getLoadOptions(){return this.props.loadOptions}use64bitPositions(){const{coordinateSystem:e}=this.props;return e===Zr.DEFAULT||e===Zr.LNGLAT||e===Zr.CARTESIAN}onHover(e,t){return this.props.onHover&&this.props.onHover(e,t)||!1}onClick(e,t){return this.props.onClick&&this.props.onClick(e,t)||!1}nullPickingColor(){return[0,0,0]}encodePickingColor(e,t=[]){return t[0]=e+1&255,t[1]=e+1>>8&255,t[2]=e+1>>8>>8&255,t}decodePickingColor(e){Vo(e instanceof Uint8Array);const[t,r,i]=e;return t+r*256+i*65536-1}getNumInstances(){return Number.isFinite(this.props.numInstances)?this.props.numInstances:this.state&&this.state.numInstances!==void 0?this.state.numInstances:xQ(this.props.data)}getStartIndices(){return this.props.startIndices?this.props.startIndices:this.state&&this.state.startIndices?this.state.startIndices:null}getBounds(){var e;return(e=this.getAttributeManager())===null||e===void 0?void 0:e.getBounds(["positions","instancePositions"])}getShaders(e){for(const t of this.props.extensions)e=SQ(e,t.getShaders.call(this,t));return e}shouldUpdateState(e){return e.changeFlags.propsOrDataChanged}updateState(e){const t=this.getAttributeManager(),{dataChanged:r}=e.changeFlags;if(r&&t)if(Array.isArray(r))for(const i of r)t.invalidateAll(i);else t.invalidateAll();if(t){const{props:i}=e,o=this.internalState.hasPickingBuffer,a=Number.isInteger(i.highlightedObjectIndex)||i.pickable||i.extensions.some(l=>l.getNeedsPickingBuffer.call(this,l));if(o!==a){this.internalState.hasPickingBuffer=a;const{pickingColors:l,instancePickingColors:h}=t.attributes,p=l||h;p&&(a&&p.constant&&(p.constant=!1,t.invalidate(p.id)),!p.value&&!a&&(p.constant=!0,p.value=[0,0,0]))}}}finalizeState(e){for(const r of this.getModels())r.delete();const t=this.getAttributeManager();t&&t.finalize(),this.context&&this.context.resourceManager.unsubscribe({consumerId:this.id}),this.internalState&&(this.internalState.uniformTransitions.clear(),this.internalState.finalize())}draw(e){for(const t of this.getModels())t.draw(e)}getPickingInfo({info:e,mode:t,sourceLayer:r}){const{index:i}=e;return i>=0&&Array.isArray(this.props.data)&&(e.object=this.props.data[i]),e}raiseError(e,t){var r,i;if(t&&(e=new Error("".concat(t,": ").concat(e.message),{cause:e})),!((r=(i=this.props).onError)!==null&&r!==void 0&&r.call(i,e))){var o,a;(o=this.context)===null||o===void 0||(a=o.onError)===null||a===void 0||a.call(o,e,this)}}getNeedsRedraw(e={clearRedrawFlags:!1}){return this._getNeedsRedraw(e)}needsUpdate(){return this.internalState?this.internalState.needsUpdate||this.hasUniformTransition()||this.shouldUpdateState(this._getUpdateParams()):!1}hasUniformTransition(){var e;return((e=this.internalState)===null||e===void 0?void 0:e.uniformTransitions.active)||!1}activateViewport(e){if(!this.internalState)return;const t=this.internalState.viewport;this.internalState.viewport=e,(!t||!ZQ({oldViewport:t,viewport:e}))&&(this.setChangeFlags({viewportChanged:!0}),this.isComposite?this.needsUpdate()&&this.setNeedsUpdate():this._update())}invalidateAttribute(e="all"){const t=this.getAttributeManager();t&&(e==="all"?t.invalidateAll():t.invalidate(e))}updateAttributes(e){for(const t of this.getModels())this._setModelAttributes(t,e)}_updateAttributes(){const e=this.getAttributeManager();if(!e)return;const t=this.props,r=this.getNumInstances(),i=this.getStartIndices();e.update({data:t.data,numInstances:r,startIndices:i,props:t,transitions:t.transitions,buffers:t.data.attributes,context:this});const o=e.getChangedAttributes({clearChangedFlags:!0});this.updateAttributes(o)}_updateAttributeTransition(){const e=this.getAttributeManager();e&&e.updateTransition()}_updateUniformTransition(){const{uniformTransitions:e}=this.internalState;if(e.active){const t=e.update(),r=Object.create(this.props);for(const i in t)Object.defineProperty(r,i,{value:t[i]});return r}return this.props}calculateInstancePickingColors(e,{numInstances:t}){if(e.constant)return;const r=Math.floor(qc.length/3);if(this.internalState.usesPickingColorCache=!0,r<t){t>WN&&Ir.warn("Layer has too many data objects. Picking might not be able to distinguish all objects.")(),qc=Xy.allocate(qc,t,{size:3,copy:!0,maxCount:Math.max(t,WN)});const i=Math.floor(qc.length/3),o=[];for(let a=r;a<i;a++)this.encodePickingColor(a,o),qc[a*3+0]=o[0],qc[a*3+1]=o[1],qc[a*3+2]=o[2]}e.value=qc.subarray(0,t*3)}_setModelAttributes(e,t){const r=this.getAttributeManager(),i=e.userData.excludeAttributes||{},o=r.getShaderAttributes(t,i);e.setAttributes(o)}disablePickingIndex(e){const t=this.props.data;if(!("attributes"in t)){this._disablePickingIndex(e);return}const{pickingColors:r,instancePickingColors:i}=this.getAttributeManager().attributes,o=r||i,a=o&&t.attributes&&t.attributes[o.id];if(a&&a.value){const l=a.value,h=this.encodePickingColor(e);for(let p=0;p<t.length;p++){const g=o.getVertexOffset(p);l[g]===h[0]&&l[g+1]===h[1]&&l[g+2]===h[2]&&this._disablePickingIndex(p)}}else this._disablePickingIndex(e)}_disablePickingIndex(e){const{pickingColors:t,instancePickingColors:r}=this.getAttributeManager().attributes,i=t||r;if(!i)return;const o=i.getVertexOffset(e),a=i.getVertexOffset(e+1);i.buffer.subData({data:new Uint8Array(a-o),offset:o})}restorePickingColors(){const{pickingColors:e,instancePickingColors:t}=this.getAttributeManager().attributes,r=e||t;r&&(this.internalState.usesPickingColorCache&&r.value.buffer!==qc.buffer&&(r.value=qc.subarray(0,r.value.length)),r.updateSubBuffer({startOffset:0}))}_initialize(){Vo(!this.internalState),Vo(Number.isFinite(this.props.coordinateSystem)),oa(qQ,this);const e=this._getAttributeManager();e&&e.addInstanced({instancePickingColors:{type:5121,size:3,noAlloc:!0,update:this.calculateInstancePickingColors}}),this.internalState=new HQ({attributeManager:e,layer:this}),this._clearChangeFlags(),this.state={},Object.defineProperty(this.state,"attributeManager",{get:()=>(Ir.deprecated("layer.state.attributeManager","layer.getAttributeManager()")(),e)}),this.internalState.uniformTransitions=new fQ(this.context.timeline),this.internalState.onAsyncPropUpdated=this._onAsyncPropUpdated.bind(this),this.internalState.setAsyncProps(this.props),this.initializeState(this.context);for(const t of this.props.extensions)t.initializeState.call(this,this.context,t);this.setChangeFlags({dataChanged:"init",propsChanged:"init",viewportChanged:!0,extensionsChanged:!0}),this._update()}_transferState(e){oa(YQ,this,this===e);const{state:t,internalState:r}=e;this!==e&&(this.internalState=r,this.state=t,this.internalState.setAsyncProps(this.props),this._diffProps(this.props,this.internalState.getOldProps()))}_update(){const e=this.needsUpdate();if(oa($Q,this,e),!e)return;const t=this.props,r=this.context,i=this.internalState,o=r.viewport,a=this._updateUniformTransition();i.propsInTransition=a,r.viewport=i.viewport||o,this.props=a;try{const l=this._getUpdateParams(),h=this.getModels();if(r.gl)this.updateState(l);else try{this.updateState(l)}catch{}for(const g of this.props.extensions)g.updateState.call(this,l,g);const p=this.getModels()[0]!==h[0];this._postUpdate(l,p)}finally{r.viewport=o,this.props=t,this._clearChangeFlags(),i.needsUpdate=!1,i.resetOldProps()}}_finalize(){oa(WQ,this),this.finalizeState(this.context);for(const e of this.props.extensions)e.finalizeState.call(this,this.context,e)}_drawLayer({moduleParameters:e=null,uniforms:t={},parameters:r={}}){this._updateAttributeTransition();const i=this.props,o=this.context;this.props=this.internalState.propsInTransition||i;const a=this.props.opacity;t.opacity=Math.pow(a,1/2.2);try{e&&this.setModuleParameters(e);const{getPolygonOffset:l}=this.props,h=l&&l(t)||[0,0];Fl(o.gl,{polygonOffset:h}),fc(o.gl,r,()=>{const p={moduleParameters:e,uniforms:t,parameters:r,context:o};for(const g of this.props.extensions)g.draw.call(this,p,g);this.draw(p)})}finally{this.props=i}}getChangeFlags(){var e;return(e=this.internalState)===null||e===void 0?void 0:e.changeFlags}setChangeFlags(e){if(!this.internalState)return;const{changeFlags:t}=this.internalState;for(const i in e)if(e[i]){let o=!1;switch(i){case"dataChanged":const a=e[i],l=t[i];a&&Array.isArray(l)&&(t.dataChanged=Array.isArray(a)?l.concat(a):a,o=!0);default:t[i]||(t[i]=e[i],o=!0)}o&&oa(GQ,this,i,e)}const r=!!(t.dataChanged||t.updateTriggersChanged||t.propsChanged||t.extensionsChanged);t.propsOrDataChanged=r,t.somethingChanged=r||t.viewportChanged||t.stateChanged}_clearChangeFlags(){this.internalState.changeFlags={dataChanged:!1,propsChanged:!1,updateTriggersChanged:!1,viewportChanged:!1,stateChanged:!1,extensionsChanged:!1,propsOrDataChanged:!1,somethingChanged:!1}}_diffProps(e,t){const r=gQ(e,t);if(r.updateTriggersChanged)for(const o in r.updateTriggersChanged)r.updateTriggersChanged[o]&&this.invalidateAttribute(o);if(r.transitionsChanged)for(const o in r.transitionsChanged){var i;this.internalState.uniformTransitions.add(o,t[o],e[o],(i=e.transitions)===null||i===void 0?void 0:i[o])}return this.setChangeFlags(r)}validateProps(){pQ(this.props)}updateAutoHighlight(e){this.props.autoHighlight&&!Number.isInteger(this.props.highlightedObjectIndex)&&this._updateAutoHighlight(e)}_updateAutoHighlight(e){const t={pickingSelectedColor:e.picked?e.color:null},{highlightColor:r}=this.props;e.picked&&typeof r=="function"&&(t.pickingHighlightColor=r(e)),this.setModuleParameters(t),this.setNeedsRedraw()}_getAttributeManager(){const e=this.context;return new cQ(e.gl,{id:this.props.id,stats:e.stats,timeline:e.timeline})}_postUpdate(e,t){const{props:r,oldProps:i}=e;this.setNeedsRedraw(),this._updateAttributes();const{model:o}=this.state;o==null||o.setInstanceCount(this.getNumInstances());const{autoHighlight:a,highlightedObjectIndex:l,highlightColor:h}=r;if(t||i.autoHighlight!==a||i.highlightedObjectIndex!==l||i.highlightColor!==h){const p={};a||(p.pickingSelectedColor=null),Array.isArray(h)&&(p.pickingHighlightColor=h),(t||l!==i.highlightedObjectIndex)&&(p.pickingSelectedColor=Number.isFinite(l)&&l>=0?this.encodePickingColor(l):null),this.setModuleParameters(p)}}_getUpdateParams(){return{props:this.props,oldProps:this.internalState.getOldProps(),context:this.context,changeFlags:this.internalState.changeFlags}}_getNeedsRedraw(e){if(!this.internalState)return!1;let t=!1;t=t||this.internalState.needsRedraw&&this.id;const r=this.getAttributeManager(),i=r?r.getNeedsRedraw(e):!1;if(t=t||i,t)for(const o of this.props.extensions)o.onNeedsRedraw.call(this,o);return this.internalState.needsRedraw=this.internalState.needsRedraw&&!e.clearRedrawFlags,t}_onAsyncPropUpdated(){this._diffProps(this.props,this.internalState.getOldProps()),this.setNeedsUpdate()}};Y(Vl,"defaultProps",XQ),Y(Vl,"layerName","Layer");const QQ="compositeLayer.renderLayers";class vC extends Vl{get isComposite(){return!0}get isLoaded(){return super.isLoaded&&this.getSubLayers().every(e=>e.isLoaded)}getSubLayers(){return this.internalState&&this.internalState.subLayers||[]}initializeState(e){}setState(e){super.setState(e),this.setNeedsUpdate()}getPickingInfo({info:e}){const{object:t}=e;return t&&t.__source&&t.__source.parent&&t.__source.parent.id===this.id&&(e.object=t.__source.object,e.index=t.__source.index),e}filterSubLayer(e){return!0}shouldRenderSubLayer(e,t){return t&&t.length}getSubLayerClass(e,t){const{_subLayerProps:r}=this.props;return r&&r[e]&&r[e].type||t}getSubLayerRow(e,t,r){return e.__source={parent:this,object:t,index:r},e}getSubLayerAccessor(e){if(typeof e=="function"){const t={index:-1,data:this.props.data,target:[]};return(r,i)=>r&&r.__source?(t.index=r.__source.index,e(r.__source.object,t)):e(r,i)}return e}getSubLayerProps(e={}){var t;const{opacity:r,pickable:i,visible:o,parameters:a,getPolygonOffset:l,highlightedObjectIndex:h,autoHighlight:p,highlightColor:g,coordinateSystem:_,coordinateOrigin:x,wrapLongitude:C,positionFormat:M,modelMatrix:L,extensions:F,fetch:z,operation:ee,_subLayerProps:ce}=this.props,se={id:"",updateTriggers:{},opacity:r,pickable:i,visible:o,parameters:a,getPolygonOffset:l,highlightedObjectIndex:h,autoHighlight:p,highlightColor:g,coordinateSystem:_,coordinateOrigin:x,wrapLongitude:C,positionFormat:M,modelMatrix:L,extensions:F,fetch:z,operation:ee},_e=ce&&e.id&&ce[e.id],J=_e&&_e.updateTriggers,pe=e.id||"sublayer";if(_e){const ue=this.props[Wu],xe=e.type?e.type._propTypes:{};for(const je in _e){const ne=xe[je]||ue[je];ne&&ne.type==="accessor"&&(_e[je]=this.getSubLayerAccessor(_e[je]))}}Object.assign(se,e,_e),se.id="".concat(this.props.id,"-").concat(pe),se.updateTriggers={all:(t=this.props.updateTriggers)===null||t===void 0?void 0:t.all,...e.updateTriggers,...J};for(const ue of F){const xe=ue.getSubLayerProps.call(this,ue);xe&&Object.assign(se,xe,{updateTriggers:Object.assign(se.updateTriggers,xe.updateTriggers)})}return se}_updateAutoHighlight(e){for(const t of this.getSubLayers())t.updateAutoHighlight(e)}_getAttributeManager(){return null}_postUpdate(e,t){let r=this.internalState.subLayers;const i=!r||this.needsUpdate();if(i){const o=this.renderLayers();r=eC(o,Boolean),this.internalState.subLayers=r}oa(QQ,this,i,r);for(const o of r)o.parent=this}}Y(vC,"layerName","CompositeLayer");const gc={DEPTH_BUFFER_BIT:256,STENCIL_BUFFER_BIT:1024,COLOR_BUFFER_BIT:16384,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,ZERO:0,ONE:1,SRC_COLOR:768,ONE_MINUS_SRC_COLOR:769,SRC_ALPHA:770,ONE_MINUS_SRC_ALPHA:771,DST_ALPHA:772,ONE_MINUS_DST_ALPHA:773,DST_COLOR:774,ONE_MINUS_DST_COLOR:775,SRC_ALPHA_SATURATE:776,CONSTANT_COLOR:32769,ONE_MINUS_CONSTANT_COLOR:32770,CONSTANT_ALPHA:32771,ONE_MINUS_CONSTANT_ALPHA:32772,FUNC_ADD:32774,FUNC_SUBTRACT:32778,FUNC_REVERSE_SUBTRACT:32779,BLEND_EQUATION:32777,BLEND_EQUATION_RGB:32777,BLEND_EQUATION_ALPHA:34877,BLEND_DST_RGB:32968,BLEND_SRC_RGB:32969,BLEND_DST_ALPHA:32970,BLEND_SRC_ALPHA:32971,BLEND_COLOR:32773,ARRAY_BUFFER_BINDING:34964,ELEMENT_ARRAY_BUFFER_BINDING:34965,LINE_WIDTH:2849,ALIASED_POINT_SIZE_RANGE:33901,ALIASED_LINE_WIDTH_RANGE:33902,CULL_FACE_MODE:2885,FRONT_FACE:2886,DEPTH_RANGE:2928,DEPTH_WRITEMASK:2930,DEPTH_CLEAR_VALUE:2931,DEPTH_FUNC:2932,STENCIL_CLEAR_VALUE:2961,STENCIL_FUNC:2962,STENCIL_FAIL:2964,STENCIL_PASS_DEPTH_FAIL:2965,STENCIL_PASS_DEPTH_PASS:2966,STENCIL_REF:2967,STENCIL_VALUE_MASK:2963,STENCIL_WRITEMASK:2968,STENCIL_BACK_FUNC:34816,STENCIL_BACK_FAIL:34817,STENCIL_BACK_PASS_DEPTH_FAIL:34818,STENCIL_BACK_PASS_DEPTH_PASS:34819,STENCIL_BACK_REF:36003,STENCIL_BACK_VALUE_MASK:36004,STENCIL_BACK_WRITEMASK:36005,VIEWPORT:2978,SCISSOR_BOX:3088,COLOR_CLEAR_VALUE:3106,COLOR_WRITEMASK:3107,UNPACK_ALIGNMENT:3317,PACK_ALIGNMENT:3333,MAX_TEXTURE_SIZE:3379,MAX_VIEWPORT_DIMS:3386,SUBPIXEL_BITS:3408,RED_BITS:3410,GREEN_BITS:3411,BLUE_BITS:3412,ALPHA_BITS:3413,DEPTH_BITS:3414,STENCIL_BITS:3415,POLYGON_OFFSET_UNITS:10752,POLYGON_OFFSET_FACTOR:32824,TEXTURE_BINDING_2D:32873,SAMPLE_BUFFERS:32936,SAMPLES:32937,SAMPLE_COVERAGE_VALUE:32938,SAMPLE_COVERAGE_INVERT:32939,COMPRESSED_TEXTURE_FORMATS:34467,VENDOR:7936,RENDERER:7937,VERSION:7938,IMPLEMENTATION_COLOR_READ_TYPE:35738,IMPLEMENTATION_COLOR_READ_FORMAT:35739,BROWSER_DEFAULT_WEBGL:37444,STATIC_DRAW:35044,STREAM_DRAW:35040,DYNAMIC_DRAW:35048,ARRAY_BUFFER:34962,ELEMENT_ARRAY_BUFFER:34963,BUFFER_SIZE:34660,BUFFER_USAGE:34661,CURRENT_VERTEX_ATTRIB:34342,VERTEX_ATTRIB_ARRAY_ENABLED:34338,VERTEX_ATTRIB_ARRAY_SIZE:34339,VERTEX_ATTRIB_ARRAY_STRIDE:34340,VERTEX_ATTRIB_ARRAY_TYPE:34341,VERTEX_ATTRIB_ARRAY_NORMALIZED:34922,VERTEX_ATTRIB_ARRAY_POINTER:34373,VERTEX_ATTRIB_ARRAY_BUFFER_BINDING:34975,CULL_FACE:2884,FRONT:1028,BACK:1029,FRONT_AND_BACK:1032,BLEND:3042,DEPTH_TEST:2929,DITHER:3024,POLYGON_OFFSET_FILL:32823,SAMPLE_ALPHA_TO_COVERAGE:32926,SAMPLE_COVERAGE:32928,SCISSOR_TEST:3089,STENCIL_TEST:2960,NO_ERROR:0,INVALID_ENUM:1280,INVALID_VALUE:1281,INVALID_OPERATION:1282,OUT_OF_MEMORY:1285,CONTEXT_LOST_WEBGL:37442,CW:2304,CCW:2305,DONT_CARE:4352,FASTEST:4353,NICEST:4354,GENERATE_MIPMAP_HINT:33170,BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,INT:5124,UNSIGNED_INT:5125,FLOAT:5126,DOUBLE:5130,DEPTH_COMPONENT:6402,ALPHA:6406,RGB:6407,RGBA:6408,LUMINANCE:6409,LUMINANCE_ALPHA:6410,UNSIGNED_SHORT_4_4_4_4:32819,UNSIGNED_SHORT_5_5_5_1:32820,UNSIGNED_SHORT_5_6_5:33635,FRAGMENT_SHADER:35632,VERTEX_SHADER:35633,COMPILE_STATUS:35713,DELETE_STATUS:35712,LINK_STATUS:35714,VALIDATE_STATUS:35715,ATTACHED_SHADERS:35717,ACTIVE_ATTRIBUTES:35721,ACTIVE_UNIFORMS:35718,MAX_VERTEX_ATTRIBS:34921,MAX_VERTEX_UNIFORM_VECTORS:36347,MAX_VARYING_VECTORS:36348,MAX_COMBINED_TEXTURE_IMAGE_UNITS:35661,MAX_VERTEX_TEXTURE_IMAGE_UNITS:35660,MAX_TEXTURE_IMAGE_UNITS:34930,MAX_FRAGMENT_UNIFORM_VECTORS:36349,SHADER_TYPE:35663,SHADING_LANGUAGE_VERSION:35724,CURRENT_PROGRAM:35725,NEVER:512,ALWAYS:519,LESS:513,EQUAL:514,LEQUAL:515,GREATER:516,GEQUAL:518,NOTEQUAL:517,KEEP:7680,REPLACE:7681,INCR:7682,DECR:7683,INVERT:5386,INCR_WRAP:34055,DECR_WRAP:34056,NEAREST:9728,LINEAR:9729,NEAREST_MIPMAP_NEAREST:9984,LINEAR_MIPMAP_NEAREST:9985,NEAREST_MIPMAP_LINEAR:9986,LINEAR_MIPMAP_LINEAR:9987,TEXTURE_MAG_FILTER:10240,TEXTURE_MIN_FILTER:10241,TEXTURE_WRAP_S:10242,TEXTURE_WRAP_T:10243,TEXTURE_2D:3553,TEXTURE:5890,TEXTURE_CUBE_MAP:34067,TEXTURE_BINDING_CUBE_MAP:34068,TEXTURE_CUBE_MAP_POSITIVE_X:34069,TEXTURE_CUBE_MAP_NEGATIVE_X:34070,TEXTURE_CUBE_MAP_POSITIVE_Y:34071,TEXTURE_CUBE_MAP_NEGATIVE_Y:34072,TEXTURE_CUBE_MAP_POSITIVE_Z:34073,TEXTURE_CUBE_MAP_NEGATIVE_Z:34074,MAX_CUBE_MAP_TEXTURE_SIZE:34076,TEXTURE0:33984,ACTIVE_TEXTURE:34016,REPEAT:10497,CLAMP_TO_EDGE:33071,MIRRORED_REPEAT:33648,TEXTURE_WIDTH:4096,TEXTURE_HEIGHT:4097,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,INT_VEC2:35667,INT_VEC3:35668,INT_VEC4:35669,BOOL:35670,BOOL_VEC2:35671,BOOL_VEC3:35672,BOOL_VEC4:35673,FLOAT_MAT2:35674,FLOAT_MAT3:35675,FLOAT_MAT4:35676,SAMPLER_2D:35678,SAMPLER_CUBE:35680,LOW_FLOAT:36336,MEDIUM_FLOAT:36337,HIGH_FLOAT:36338,LOW_INT:36339,MEDIUM_INT:36340,HIGH_INT:36341,FRAMEBUFFER:36160,RENDERBUFFER:36161,RGBA4:32854,RGB5_A1:32855,RGB565:36194,DEPTH_COMPONENT16:33189,STENCIL_INDEX:6401,STENCIL_INDEX8:36168,DEPTH_STENCIL:34041,RENDERBUFFER_WIDTH:36162,RENDERBUFFER_HEIGHT:36163,RENDERBUFFER_INTERNAL_FORMAT:36164,RENDERBUFFER_RED_SIZE:36176,RENDERBUFFER_GREEN_SIZE:36177,RENDERBUFFER_BLUE_SIZE:36178,RENDERBUFFER_ALPHA_SIZE:36179,RENDERBUFFER_DEPTH_SIZE:36180,RENDERBUFFER_STENCIL_SIZE:36181,FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE:36048,FRAMEBUFFER_ATTACHMENT_OBJECT_NAME:36049,FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL:36050,FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE:36051,COLOR_ATTACHMENT0:36064,DEPTH_ATTACHMENT:36096,STENCIL_ATTACHMENT:36128,DEPTH_STENCIL_ATTACHMENT:33306,NONE:0,FRAMEBUFFER_COMPLETE:36053,FRAMEBUFFER_INCOMPLETE_ATTACHMENT:36054,FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:36055,FRAMEBUFFER_INCOMPLETE_DIMENSIONS:36057,FRAMEBUFFER_UNSUPPORTED:36061,FRAMEBUFFER_BINDING:36006,RENDERBUFFER_BINDING:36007,READ_FRAMEBUFFER:36008,DRAW_FRAMEBUFFER:36009,MAX_RENDERBUFFER_SIZE:34024,INVALID_FRAMEBUFFER_OPERATION:1286,UNPACK_FLIP_Y_WEBGL:37440,UNPACK_PREMULTIPLY_ALPHA_WEBGL:37441,UNPACK_COLORSPACE_CONVERSION_WEBGL:37443,READ_BUFFER:3074,UNPACK_ROW_LENGTH:3314,UNPACK_SKIP_ROWS:3315,UNPACK_SKIP_PIXELS:3316,PACK_ROW_LENGTH:3330,PACK_SKIP_ROWS:3331,PACK_SKIP_PIXELS:3332,TEXTURE_BINDING_3D:32874,UNPACK_SKIP_IMAGES:32877,UNPACK_IMAGE_HEIGHT:32878,MAX_3D_TEXTURE_SIZE:32883,MAX_ELEMENTS_VERTICES:33e3,MAX_ELEMENTS_INDICES:33001,MAX_TEXTURE_LOD_BIAS:34045,MAX_FRAGMENT_UNIFORM_COMPONENTS:35657,MAX_VERTEX_UNIFORM_COMPONENTS:35658,MAX_ARRAY_TEXTURE_LAYERS:35071,MIN_PROGRAM_TEXEL_OFFSET:35076,MAX_PROGRAM_TEXEL_OFFSET:35077,MAX_VARYING_COMPONENTS:35659,FRAGMENT_SHADER_DERIVATIVE_HINT:35723,RASTERIZER_DISCARD:35977,VERTEX_ARRAY_BINDING:34229,MAX_VERTEX_OUTPUT_COMPONENTS:37154,MAX_FRAGMENT_INPUT_COMPONENTS:37157,MAX_SERVER_WAIT_TIMEOUT:37137,MAX_ELEMENT_INDEX:36203,RED:6403,RGB8:32849,RGBA8:32856,RGB10_A2:32857,TEXTURE_3D:32879,TEXTURE_WRAP_R:32882,TEXTURE_MIN_LOD:33082,TEXTURE_MAX_LOD:33083,TEXTURE_BASE_LEVEL:33084,TEXTURE_MAX_LEVEL:33085,TEXTURE_COMPARE_MODE:34892,TEXTURE_COMPARE_FUNC:34893,SRGB:35904,SRGB8:35905,SRGB8_ALPHA8:35907,COMPARE_REF_TO_TEXTURE:34894,RGBA32F:34836,RGB32F:34837,RGBA16F:34842,RGB16F:34843,TEXTURE_2D_ARRAY:35866,TEXTURE_BINDING_2D_ARRAY:35869,R11F_G11F_B10F:35898,RGB9_E5:35901,RGBA32UI:36208,RGB32UI:36209,RGBA16UI:36214,RGB16UI:36215,RGBA8UI:36220,RGB8UI:36221,RGBA32I:36226,RGB32I:36227,RGBA16I:36232,RGB16I:36233,RGBA8I:36238,RGB8I:36239,RED_INTEGER:36244,RGB_INTEGER:36248,RGBA_INTEGER:36249,R8:33321,RG8:33323,R16F:33325,R32F:33326,RG16F:33327,RG32F:33328,R8I:33329,R8UI:33330,R16I:33331,R16UI:33332,R32I:33333,R32UI:33334,RG8I:33335,RG8UI:33336,RG16I:33337,RG16UI:33338,RG32I:33339,RG32UI:33340,R8_SNORM:36756,RG8_SNORM:36757,RGB8_SNORM:36758,RGBA8_SNORM:36759,RGB10_A2UI:36975,TEXTURE_IMMUTABLE_FORMAT:37167,TEXTURE_IMMUTABLE_LEVELS:33503,UNSIGNED_INT_2_10_10_10_REV:33640,UNSIGNED_INT_10F_11F_11F_REV:35899,UNSIGNED_INT_5_9_9_9_REV:35902,FLOAT_32_UNSIGNED_INT_24_8_REV:36269,UNSIGNED_INT_24_8:34042,HALF_FLOAT:5131,RG:33319,RG_INTEGER:33320,INT_2_10_10_10_REV:36255,CURRENT_QUERY:34917,QUERY_RESULT:34918,QUERY_RESULT_AVAILABLE:34919,ANY_SAMPLES_PASSED:35887,ANY_SAMPLES_PASSED_CONSERVATIVE:36202,MAX_DRAW_BUFFERS:34852,DRAW_BUFFER0:34853,DRAW_BUFFER1:34854,DRAW_BUFFER2:34855,DRAW_BUFFER3:34856,DRAW_BUFFER4:34857,DRAW_BUFFER5:34858,DRAW_BUFFER6:34859,DRAW_BUFFER7:34860,DRAW_BUFFER8:34861,DRAW_BUFFER9:34862,DRAW_BUFFER10:34863,DRAW_BUFFER11:34864,DRAW_BUFFER12:34865,DRAW_BUFFER13:34866,DRAW_BUFFER14:34867,DRAW_BUFFER15:34868,MAX_COLOR_ATTACHMENTS:36063,COLOR_ATTACHMENT1:36065,COLOR_ATTACHMENT2:36066,COLOR_ATTACHMENT3:36067,COLOR_ATTACHMENT4:36068,COLOR_ATTACHMENT5:36069,COLOR_ATTACHMENT6:36070,COLOR_ATTACHMENT7:36071,COLOR_ATTACHMENT8:36072,COLOR_ATTACHMENT9:36073,COLOR_ATTACHMENT10:36074,COLOR_ATTACHMENT11:36075,COLOR_ATTACHMENT12:36076,COLOR_ATTACHMENT13:36077,COLOR_ATTACHMENT14:36078,COLOR_ATTACHMENT15:36079,SAMPLER_3D:35679,SAMPLER_2D_SHADOW:35682,SAMPLER_2D_ARRAY:36289,SAMPLER_2D_ARRAY_SHADOW:36292,SAMPLER_CUBE_SHADOW:36293,INT_SAMPLER_2D:36298,INT_SAMPLER_3D:36299,INT_SAMPLER_CUBE:36300,INT_SAMPLER_2D_ARRAY:36303,UNSIGNED_INT_SAMPLER_2D:36306,UNSIGNED_INT_SAMPLER_3D:36307,UNSIGNED_INT_SAMPLER_CUBE:36308,UNSIGNED_INT_SAMPLER_2D_ARRAY:36311,MAX_SAMPLES:36183,SAMPLER_BINDING:35097,PIXEL_PACK_BUFFER:35051,PIXEL_UNPACK_BUFFER:35052,PIXEL_PACK_BUFFER_BINDING:35053,PIXEL_UNPACK_BUFFER_BINDING:35055,COPY_READ_BUFFER:36662,COPY_WRITE_BUFFER:36663,COPY_READ_BUFFER_BINDING:36662,COPY_WRITE_BUFFER_BINDING:36663,FLOAT_MAT2x3:35685,FLOAT_MAT2x4:35686,FLOAT_MAT3x2:35687,FLOAT_MAT3x4:35688,FLOAT_MAT4x2:35689,FLOAT_MAT4x3:35690,UNSIGNED_INT_VEC2:36294,UNSIGNED_INT_VEC3:36295,UNSIGNED_INT_VEC4:36296,UNSIGNED_NORMALIZED:35863,SIGNED_NORMALIZED:36764,VERTEX_ATTRIB_ARRAY_INTEGER:35069,VERTEX_ATTRIB_ARRAY_DIVISOR:35070,TRANSFORM_FEEDBACK_BUFFER_MODE:35967,MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS:35968,TRANSFORM_FEEDBACK_VARYINGS:35971,TRANSFORM_FEEDBACK_BUFFER_START:35972,TRANSFORM_FEEDBACK_BUFFER_SIZE:35973,TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN:35976,MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS:35978,MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS:35979,INTERLEAVED_ATTRIBS:35980,SEPARATE_ATTRIBS:35981,TRANSFORM_FEEDBACK_BUFFER:35982,TRANSFORM_FEEDBACK_BUFFER_BINDING:35983,TRANSFORM_FEEDBACK:36386,TRANSFORM_FEEDBACK_PAUSED:36387,TRANSFORM_FEEDBACK_ACTIVE:36388,TRANSFORM_FEEDBACK_BINDING:36389,FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING:33296,FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE:33297,FRAMEBUFFER_ATTACHMENT_RED_SIZE:33298,FRAMEBUFFER_ATTACHMENT_GREEN_SIZE:33299,FRAMEBUFFER_ATTACHMENT_BLUE_SIZE:33300,FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE:33301,FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE:33302,FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE:33303,FRAMEBUFFER_DEFAULT:33304,DEPTH24_STENCIL8:35056,DRAW_FRAMEBUFFER_BINDING:36006,READ_FRAMEBUFFER_BINDING:36010,RENDERBUFFER_SAMPLES:36011,FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER:36052,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE:36182,UNIFORM_BUFFER:35345,UNIFORM_BUFFER_BINDING:35368,UNIFORM_BUFFER_START:35369,UNIFORM_BUFFER_SIZE:35370,MAX_VERTEX_UNIFORM_BLOCKS:35371,MAX_FRAGMENT_UNIFORM_BLOCKS:35373,MAX_COMBINED_UNIFORM_BLOCKS:35374,MAX_UNIFORM_BUFFER_BINDINGS:35375,MAX_UNIFORM_BLOCK_SIZE:35376,MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS:35377,MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS:35379,UNIFORM_BUFFER_OFFSET_ALIGNMENT:35380,ACTIVE_UNIFORM_BLOCKS:35382,UNIFORM_TYPE:35383,UNIFORM_SIZE:35384,UNIFORM_BLOCK_INDEX:35386,UNIFORM_OFFSET:35387,UNIFORM_ARRAY_STRIDE:35388,UNIFORM_MATRIX_STRIDE:35389,UNIFORM_IS_ROW_MAJOR:35390,UNIFORM_BLOCK_BINDING:35391,UNIFORM_BLOCK_DATA_SIZE:35392,UNIFORM_BLOCK_ACTIVE_UNIFORMS:35394,UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES:35395,UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER:35396,UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER:35398,OBJECT_TYPE:37138,SYNC_CONDITION:37139,SYNC_STATUS:37140,SYNC_FLAGS:37141,SYNC_FENCE:37142,SYNC_GPU_COMMANDS_COMPLETE:37143,UNSIGNALED:37144,SIGNALED:37145,ALREADY_SIGNALED:37146,TIMEOUT_EXPIRED:37147,CONDITION_SATISFIED:37148,WAIT_FAILED:37149,SYNC_FLUSH_COMMANDS_BIT:1,COLOR:6144,DEPTH:6145,STENCIL:6146,MIN:32775,MAX:32776,DEPTH_COMPONENT24:33190,STREAM_READ:35041,STREAM_COPY:35042,STATIC_READ:35045,STATIC_COPY:35046,DYNAMIC_READ:35049,DYNAMIC_COPY:35050,DEPTH_COMPONENT32F:36012,DEPTH32F_STENCIL8:36013,INVALID_INDEX:4294967295,TIMEOUT_IGNORED:-1,MAX_CLIENT_WAIT_TIMEOUT_WEBGL:37447,VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE:35070,UNMASKED_VENDOR_WEBGL:37445,UNMASKED_RENDERER_WEBGL:37446,MAX_TEXTURE_MAX_ANISOTROPY_EXT:34047,TEXTURE_MAX_ANISOTROPY_EXT:34046,COMPRESSED_RGB_S3TC_DXT1_EXT:33776,COMPRESSED_RGBA_S3TC_DXT1_EXT:33777,COMPRESSED_RGBA_S3TC_DXT3_EXT:33778,COMPRESSED_RGBA_S3TC_DXT5_EXT:33779,COMPRESSED_R11_EAC:37488,COMPRESSED_SIGNED_R11_EAC:37489,COMPRESSED_RG11_EAC:37490,COMPRESSED_SIGNED_RG11_EAC:37491,COMPRESSED_RGB8_ETC2:37492,COMPRESSED_RGBA8_ETC2_EAC:37493,COMPRESSED_SRGB8_ETC2:37494,COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:37495,COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:37496,COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:37497,COMPRESSED_RGB_PVRTC_4BPPV1_IMG:35840,COMPRESSED_RGBA_PVRTC_4BPPV1_IMG:35842,COMPRESSED_RGB_PVRTC_2BPPV1_IMG:35841,COMPRESSED_RGBA_PVRTC_2BPPV1_IMG:35843,COMPRESSED_RGB_ETC1_WEBGL:36196,COMPRESSED_RGB_ATC_WEBGL:35986,COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL:35986,COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL:34798,UNSIGNED_INT_24_8_WEBGL:34042,HALF_FLOAT_OES:36193,RGBA32F_EXT:34836,RGB32F_EXT:34837,FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE_EXT:33297,UNSIGNED_NORMALIZED_EXT:35863,MIN_EXT:32775,MAX_EXT:32776,SRGB_EXT:35904,SRGB_ALPHA_EXT:35906,SRGB8_ALPHA8_EXT:35907,FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING_EXT:33296,FRAGMENT_SHADER_DERIVATIVE_HINT_OES:35723,COLOR_ATTACHMENT0_WEBGL:36064,COLOR_ATTACHMENT1_WEBGL:36065,COLOR_ATTACHMENT2_WEBGL:36066,COLOR_ATTACHMENT3_WEBGL:36067,COLOR_ATTACHMENT4_WEBGL:36068,COLOR_ATTACHMENT5_WEBGL:36069,COLOR_ATTACHMENT6_WEBGL:36070,COLOR_ATTACHMENT7_WEBGL:36071,COLOR_ATTACHMENT8_WEBGL:36072,COLOR_ATTACHMENT9_WEBGL:36073,COLOR_ATTACHMENT10_WEBGL:36074,COLOR_ATTACHMENT11_WEBGL:36075,COLOR_ATTACHMENT12_WEBGL:36076,COLOR_ATTACHMENT13_WEBGL:36077,COLOR_ATTACHMENT14_WEBGL:36078,COLOR_ATTACHMENT15_WEBGL:36079,DRAW_BUFFER0_WEBGL:34853,DRAW_BUFFER1_WEBGL:34854,DRAW_BUFFER2_WEBGL:34855,DRAW_BUFFER3_WEBGL:34856,DRAW_BUFFER4_WEBGL:34857,DRAW_BUFFER5_WEBGL:34858,DRAW_BUFFER6_WEBGL:34859,DRAW_BUFFER7_WEBGL:34860,DRAW_BUFFER8_WEBGL:34861,DRAW_BUFFER9_WEBGL:34862,DRAW_BUFFER10_WEBGL:34863,DRAW_BUFFER11_WEBGL:34864,DRAW_BUFFER12_WEBGL:34865,DRAW_BUFFER13_WEBGL:34866,DRAW_BUFFER14_WEBGL:34867,DRAW_BUFFER15_WEBGL:34868,MAX_COLOR_ATTACHMENTS_WEBGL:36063,MAX_DRAW_BUFFERS_WEBGL:34852,VERTEX_ARRAY_BINDING_OES:34229,QUERY_COUNTER_BITS_EXT:34916,CURRENT_QUERY_EXT:34917,QUERY_RESULT_EXT:34918,QUERY_RESULT_AVAILABLE_EXT:34919,TIME_ELAPSED_EXT:35007,TIMESTAMP_EXT:36392,GPU_DISJOINT_EXT:36795},JQ=`#define SHADER_NAME animated-flow-lines-layer-fragment-shader

precision highp float;

uniform float animationTailLength;

varying vec4 vColor;
varying float sourceToTarget;
varying vec2 uv;
                                   
void main(void) {
  geometry.uv = uv;

  gl_FragColor = vec4(vColor.xyz, vColor.w * smoothstep(1.0 - animationTailLength, 1.0, fract(sourceToTarget)));

  DECKGL_FILTER_COLOR(gl_FragColor, geometry);
}
`,eJ=`#define SHADER_NAME animated-flow-lines-layer-vertex-shader
#define SPEED 0.015
#define NUM_PARTS 5.0

attribute vec3 positions;
attribute vec3 instanceSourcePositions;
attribute vec3 instanceTargetPositions;
attribute vec3 instanceSourcePositions64Low;
attribute vec3 instanceTargetPositions64Low;
attribute vec4 instanceColors;
attribute vec3 instancePickingColors;
attribute float instanceWidths;
attribute float instancePickable;
attribute float instanceStaggering;

uniform float opacity;
uniform float currentTime;
uniform float thicknessUnit;
    
varying vec4 vColor;
varying float sourceToTarget;
varying vec2 uv;

// offset vector by strokeWidth pixels
// offset_direction is -1 (left) or 1 (right)
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction, float width) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace * project_uViewportSize);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);

  return dir_screenspace * offset_direction * width / 2.0;
}

void main(void) {
  geometry.worldPosition = instanceSourcePositions;
  geometry.worldPositionAlt = instanceTargetPositions;

  // Position
  vec4 source_commonspace;
  vec4 target_commonspace;
  vec4 source = project_position_to_clipspace(instanceSourcePositions, instanceSourcePositions64Low, vec3(0.), source_commonspace);
  vec4 target = project_position_to_clipspace(instanceTargetPositions, instanceTargetPositions64Low, vec3(0.), target_commonspace);

  float widthPixels = instanceWidths * thicknessUnit;
  
  
  // linear interpolation of source & target to pick right coord
  float segmentIndex = positions.x;
  vec4 p = mix(source, target, segmentIndex);
  geometry.position = mix(source_commonspace, target_commonspace, segmentIndex);
  uv = positions.xy;
  geometry.uv = uv;
  if (instancePickable > 0.5) {
    geometry.pickingColor = instancePickingColors;
  }
  
  // extrude
  vec3 offset = vec3(
    getExtrusionOffset(target.xy - source.xy, positions.y, widthPixels),
    0.0);
  DECKGL_FILTER_SIZE(offset, geometry);
  gl_Position = p + vec4(project_pixel_size_to_clipspace(offset.xy), 0.0, 0.0);
  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);

  // Color
  vColor = vec4(instanceColors.rgb, instanceColors.a * opacity) / 255.;
  DECKGL_FILTER_COLOR(vColor, geometry);

  sourceToTarget = positions.x * length(source - target) * NUM_PARTS - currentTime * SPEED + instanceStaggering; 
}
`,tJ=[0,132,193,255],YN=1800,KN=YN/20;class f1 extends Vl{constructor(e){super(e)}getShaders(){return super.getShaders({vs:eJ,fs:JQ,modules:[jp,Vp],shaderCache:this.context.shaderCache})}initializeState(){this.getAttributeManager().addInstanced({instanceSourcePositions:{size:3,type:gc.DOUBLE,transition:!0,accessor:"getSourcePosition"},instanceTargetPositions:{size:3,type:gc.DOUBLE,transition:!0,accessor:"getTargetPosition"},instanceColors:{size:4,type:gc.UNSIGNED_BYTE,transition:!0,accessor:"getColor",defaultValue:[0,0,0,255]},instanceWidths:{size:1,transition:!0,accessor:"getThickness",defaultValue:1},instanceStaggering:{accessor:"getStaggering",size:1,transition:!1},instancePickable:{accessor:"getPickable",size:1,transition:!1}})}getNeedsRedraw(){return!0}updateState({props:e,oldProps:t,changeFlags:r}){var i;if(super.updateState({props:e,oldProps:t,changeFlags:r}),r.extensionsChanged){const{gl:o}=this.context;(i=this.state.model)==null||i.delete(),this.state.model=this._getModel(o),this.getAttributeManager().invalidateAll()}}draw({uniforms:e}){const{thicknessUnit:t,animationTailLength:r}=this.props,o=Date.now()/1e3%KN/KN*YN;this.state.model.setUniforms({...e,thicknessUnit:t*4,animationTailLength:r,currentTime:o}).draw()}_getModel(e){const t=[0,-1,0,0,1,0,1,-1,0,1,1,0];return new Ad(e,Object.assign({},this.getShaders(),{id:this.props.id,geometry:new kp({drawMode:gc.TRIANGLE_STRIP,attributes:{positions:new Float32Array(t)}}),isInstanced:!0}))}}f1.defaultProps={currentTime:0,animationTailLength:.7,getSourcePosition:{type:"accessor",value:n=>[0,0]},getTargetPosition:{type:"accessor",value:n=>[0,0]},getPickable:{type:"accessor",value:n=>1},getStaggering:{type:"accessor",value:(n,{index:e})=>Math.random()},getColor:{type:"accessor",value:tJ},getThickness:{type:"accessor",value:1},thicknessUnit:15*2,parameters:{depthTest:!1}};const nJ=`#define SHADER_NAME flow-line-layer-fragment-shader

precision highp float;

varying vec4 vColor;
varying vec2 uv;

void main(void) {
  if (vColor.a == 0.0) {
    discard;
  }

  geometry.uv = uv;
  gl_FragColor = vColor;
  DECKGL_FILTER_COLOR(gl_FragColor, geometry);
}
`,rJ=`#define SHADER_NAME flow-line-layer-vertex-shader

attribute vec3 positions;
attribute vec3 normals;
attribute vec4 instanceColors;
attribute float instanceThickness;    // 0..0.5
attribute vec3 instanceSourcePositions;
attribute vec3 instanceTargetPositions;
attribute vec3 instanceSourcePositions64Low;
attribute vec3 instanceTargetPositions64Low;
attribute vec3 instancePickingColors;
attribute vec2 instanceEndpointOffsets;
attribute float instancePickable;

uniform vec4 outlineColor;
uniform float thicknessUnit;
uniform float gap;
uniform float opacity;

varying vec4 vColor;
varying vec2 uv;

void main(void) {
  geometry.worldPosition = instanceSourcePositions;
  geometry.worldPositionAlt = instanceTargetPositions;
  
  // Position
  vec4 source_commonspace;    
  vec4 target_commonspace;
  vec4 source = project_position_to_clipspace(instanceSourcePositions, instanceSourcePositions64Low, vec3(0.), source_commonspace);
  vec4 target = project_position_to_clipspace(instanceTargetPositions, instanceTargetPositions64Low, vec3(0.), target_commonspace);

  // linear interpolation of source & target to pick right coord
  float sourceOrTarget = positions.x;
  geometry.position = mix(source_commonspace, target_commonspace, sourceOrTarget);
  uv = positions.xy;
  geometry.uv = uv;
  if (instancePickable > 0.5) {
    geometry.pickingColor = instancePickingColors;
  }
  
  // set the clamp limits in pixel size 
  float lengthCommon = length(target_commonspace - source_commonspace);    
  vec2 offsetDistances = project_pixel_size(positions.yz) * thicknessUnit;
  
  vec2 limitedOffsetDistances = clamp(   
    project_pixel_size(positions.yz) * thicknessUnit,
    -lengthCommon*.8, lengthCommon*.8
  );
  float startOffsetCommon = project_pixel_size(instanceEndpointOffsets[0]);
  float endOffsetCommon = project_pixel_size(instanceEndpointOffsets[1]);
  float endpointOffset = mix(
    clamp(startOffsetCommon, 0.0, lengthCommon*.2),
    -clamp(endOffsetCommon, 0.0, lengthCommon*.2),
    positions.x
  );

  vec2 flowlineDir = normalize(target_commonspace.xy - source_commonspace.xy);
  vec2 perpendicularDir = vec2(-flowlineDir.y, flowlineDir.x);
  vec2 normalsCommon = project_pixel_size(normals.xy);
  float gapCommon = project_pixel_size(gap);
  vec3 offsetCommon = vec3(
    flowlineDir * (instanceThickness * limitedOffsetDistances[1] + normalsCommon.y + endpointOffset * 1.05) -
    perpendicularDir * (instanceThickness * limitedOffsetDistances[0] + gapCommon + normalsCommon.x),
    0.0
  );
  
  DECKGL_FILTER_SIZE(offsetCommon, geometry);
  vec4 position_commonspace = mix(source_commonspace, target_commonspace, sourceOrTarget);
  vec4 offset_commonspace = vec4(offsetCommon, 0.0);
  gl_Position = project_common_position_to_clipspace(position_commonspace + offset_commonspace);
      
  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
  
  vec4 fillColor = vec4(instanceColors.rgb, instanceColors.a * opacity) / 255.;
  vColor = mix(fillColor, vec4(outlineColor.xyz, outlineColor.w * fillColor.w), normals.z);
  DECKGL_FILTER_COLOR(vColor, geometry);
}
`,iJ=[0,132,193,255],oJ=1,ZN=[1,0,0,1,2,-3,1,1,-3,1,0,0,1,1,-3,0,1,0,1,0,0,0,1,0,0,0,0];function aJ(n,e){return[-e,2*n,1,2*n,-n,1,n,-n,1,-e,2*n,1,n,-n,1,n,-n,1,-e,2*n,1,n,-n,1,-e,-n,1]}const sJ=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];class qp extends Vl{constructor(e){super(e)}getShaders(){return super.getShaders({vs:rJ,fs:nJ,modules:[jp,Vp],shaderCache:this.context.shaderCache})}initializeState(){const{attributeManager:e}=this.state;e.addInstanced({instanceSourcePositions:{accessor:"getSourcePosition",size:3,transition:!1,type:gc.DOUBLE},instanceTargetPositions:{accessor:"getTargetPosition",size:3,transition:!1,type:gc.DOUBLE},instanceThickness:{accessor:"getThickness",size:1,transition:!1},instanceEndpointOffsets:{accessor:"getEndpointOffsets",size:2,transition:!1},instanceColors:{accessor:"getColor",size:4,type:gc.UNSIGNED_BYTE,transition:!1},instancePickable:{accessor:"getPickable",size:1,transition:!1}})}updateState({props:e,oldProps:t,changeFlags:r}){if(super.updateState({props:e,oldProps:t,changeFlags:r}),r.extensionsChanged){const{gl:i}=this.context;this.state.model&&this.state.model.delete(),this.setState({model:this._getModel(i)}),this.getAttributeManager().invalidateAll()}}draw({uniforms:e}){const{gl:t}=this.context,{outlineColor:r,thicknessUnit:i}=this.props;t.lineWidth(1),this.state.model.setUniforms({...e,outlineColor:r.map(o=>o/255),thicknessUnit:i*2,gap:.5}).draw()}_getModel(e){let t=[],r=[];const{drawOutline:i,outlineThickness:o}=this.props;if(i){t=t.concat(ZN);const a=o,l=oJ;r=r.concat(aJ(a,l))}return t=t.concat(ZN),r=r.concat(sJ),new Ad(e,{id:this.props.id,...this.getShaders(),geometry:new kp({drawMode:gc.TRIANGLES,attributes:{positions:new Float32Array(t),normals:new Float32Array(r)}}),isInstanced:!0,shaderCache:this.context.shaderCache})}}qp.layerName="FlowLinesLayer",qp.defaultProps={getSourcePosition:{type:"accessor",value:n=>[0,0]},getTargetPosition:{type:"accessor",value:n=>[0,0]},getColor:{type:"accessor",value:iJ},getThickness:{type:"accessor",value:n=>n.count},getPickable:{type:"accessor",value:n=>1},drawOutline:!0,thicknessUnit:12,outlineThickness:1,outlineColor:[255,255,255,255],parameters:{depthTest:!1}};const cJ=`#define SHADER_NAME flow-circles-layer-fragment-shader
#define SOFT_OUTLINE 0.05
#define EPS 0.05
precision highp float;

uniform vec4 emptyColor;
uniform float outlineEmptyMix;

varying vec4 vColor;
varying vec2 unitPosition;
varying float unitInRadius;
varying float unitOutRadius;

float when_gt(float x, float y) {
  return max(sign(x - y), 0.0);
}

void main(void) {
  geometry.uv = unitPosition;
  float distToCenter = length(unitPosition);
  if (distToCenter > 1.0) {
    discard;
  }

  // See https://stackoverflow.com/questions/47285778
  vec4 ringColor = mix(
    emptyColor / 255., vColor,
    when_gt(unitInRadius, unitOutRadius)
  );
  vec4 outlineColor = mix(
    mix(vColor, emptyColor / 255., outlineEmptyMix),
    vColor,
    when_gt(unitInRadius, unitOutRadius)
  );
  
  float innerR = min(unitInRadius, unitOutRadius) * (1.0 - SOFT_OUTLINE);
  
  // Inner circle
  float step2 = innerR - 2.0 * EPS; 
  float step3 = innerR - EPS;
  
  // Ring
  float step4 = innerR;
  // float step5 = 1.0 - SOFT_OUTLINE - EPS;
  // float step6 = 1.0 - SOFT_OUTLINE;
  float step5 = 1.0 - 5.0 * EPS;
  float step6 = 1.0;
  
  gl_FragColor = vColor;
  gl_FragColor = mix(gl_FragColor, emptyColor / 255., smoothstep(step2, step3, distToCenter));
  gl_FragColor = mix(gl_FragColor, ringColor, smoothstep(step3, step4, distToCenter));
  gl_FragColor = mix(gl_FragColor, outlineColor, smoothstep(step5, step6, distToCenter));
  // gl_FragColor = mix(gl_FragColor, emptyColor / 255., smoothstep(step6, 1.0, distToCenter));
  gl_FragColor.a = vColor.a;
  gl_FragColor.a *= smoothstep(0.0, SOFT_OUTLINE, 1.0 - distToCenter);
  DECKGL_FILTER_COLOR(gl_FragColor, geometry);
}
`,lJ=`#define SHADER_NAME flow-circles-layer-vertex-shader
#define radiusScale 100

attribute vec3 positions;

attribute vec3 instancePositions;
attribute vec3 instancePositions64Low;
attribute float instanceInRadius;
attribute float instanceOutRadius;
attribute vec4 instanceColors;
attribute vec3 instancePickingColors;

uniform float opacity;
uniform vec4 emptyColor;
uniform float outlineEmptyMix;

varying vec4 vColor;
varying vec2 unitPosition;
varying float unitInRadius;
varying float unitOutRadius;

void main(void) {
  geometry.worldPosition = instancePositions;

  float outerRadiusPixels = max(instanceInRadius, instanceOutRadius);
  unitInRadius = instanceInRadius / outerRadiusPixels; 
  unitOutRadius = instanceOutRadius / outerRadiusPixels; 

  // position on the containing square in [-1, 1] space
  unitPosition = positions.xy;
  geometry.uv = unitPosition;
  geometry.pickingColor = instancePickingColors;
                                                                                                    
  // Find the center of the point and add the current vertex
  vec3 offset = positions * project_pixel_size(outerRadiusPixels);
  DECKGL_FILTER_SIZE(offset, geometry);
  gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset, geometry.position);
  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
                            
  // Apply opacity to instance color, or return instance picking color
  vColor = vec4(instanceColors.rgb / 255., instanceColors.a / 255. * opacity);
  DECKGL_FILTER_COLOR(vColor, geometry);
}
`,XN=[0,0,0,255],uJ=[255,255,255,255],hJ=.4;class r_ extends Vl{constructor(e){super(e)}getShaders(){return super.getShaders({vs:lJ,fs:cJ,modules:[jp,Vp]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:gc.DOUBLE,fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceInRadius:{size:1,transition:!0,accessor:"getInRadius",defaultValue:1},instanceOutRadius:{size:1,transition:!0,accessor:"getOutRadius",defaultValue:1},instanceColors:{size:4,transition:!0,type:gc.UNSIGNED_BYTE,accessor:"getColor",defaultValue:XN}})}updateState({props:e,oldProps:t,changeFlags:r}){if(super.updateState({props:e,oldProps:t,changeFlags:r}),r.extensionsChanged){const{gl:i}=this.context;this.state.model&&this.state.model.delete(),this.setState({model:this._getModel(i)}),this.getAttributeManager().invalidateAll()}}draw({uniforms:e}){const{emptyColor:t,outlineEmptyMix:r}=this.props;this.state.model.setUniforms({...e,emptyColor:t,outlineEmptyMix:r}).draw()}_getModel(e){const t=[-1,-1,0,1,-1,0,1,1,0,-1,1,0];return new Ad(e,Object.assign(this.getShaders(),{id:this.props.id,geometry:new kp({drawMode:gc.TRIANGLE_FAN,vertexCount:4,attributes:{positions:{size:3,value:new Float32Array(t)}}}),isInstanced:!0}))}}r_.layerName="FlowCirclesLayer",r_.defaultProps={getColor:{type:"accessor",value:XN},emptyColor:{type:"accessor",value:uJ},outlineEmptyMix:{type:"accessor",value:hJ},getPosition:{type:"accessor",value:n=>n.position},getInRadius:{type:"accessor",value:1},getOutRadius:{type:"accessor",value:1},parameters:{depthTest:!1}};const dJ=`#define SHADER_NAME icon-layer-vertex-shader

attribute vec2 positions;

attribute vec3 instancePositions;
attribute vec3 instancePositions64Low;
attribute float instanceSizes;
attribute float instanceAngles;
attribute vec4 instanceColors;
attribute vec3 instancePickingColors;
attribute vec4 instanceIconFrames;
attribute float instanceColorModes;
attribute vec2 instanceOffsets;
attribute vec2 instancePixelOffset;

uniform float sizeScale;
uniform vec2 iconsTextureDim;
uniform float sizeMinPixels;
uniform float sizeMaxPixels;
uniform bool billboard;
uniform int sizeUnits;

varying float vColorMode;
varying vec4 vColor;
varying vec2 vTextureCoords;
varying vec2 uv;

vec2 rotate_by_angle(vec2 vertex, float angle) {
  float angle_radian = angle * PI / 180.0;
  float cos_angle = cos(angle_radian);
  float sin_angle = sin(angle_radian);
  mat2 rotationMatrix = mat2(cos_angle, -sin_angle, sin_angle, cos_angle);
  return rotationMatrix * vertex;
}

void main(void) {
  geometry.worldPosition = instancePositions;
  geometry.uv = positions;
  geometry.pickingColor = instancePickingColors;
  uv = positions;

  vec2 iconSize = instanceIconFrames.zw;
  float sizePixels = clamp(
    project_size_to_pixel(instanceSizes * sizeScale, sizeUnits), 
    sizeMinPixels, sizeMaxPixels
  );
  float instanceScale = iconSize.y == 0.0 ? 0.0 : sizePixels / iconSize.y;
  vec2 pixelOffset = positions / 2.0 * iconSize + instanceOffsets;
  pixelOffset = rotate_by_angle(pixelOffset, instanceAngles) * instanceScale;
  pixelOffset += instancePixelOffset;
  pixelOffset.y *= -1.0;

  if (billboard)  {
    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
    DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
    vec3 offset = vec3(pixelOffset, 0.0);
    DECKGL_FILTER_SIZE(offset, geometry);
    gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);

  } else {
    vec3 offset_common = vec3(project_pixel_size(pixelOffset), 0.0);
    DECKGL_FILTER_SIZE(offset_common, geometry);
    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset_common, geometry.position); 
    DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
  }

  vTextureCoords = mix(
    instanceIconFrames.xy,
    instanceIconFrames.xy + iconSize,
    (positions.xy + 1.0) / 2.0
  ) / iconsTextureDim;

  vColor = instanceColors;
  DECKGL_FILTER_COLOR(vColor, geometry);

  vColorMode = instanceColorModes;
}
`,fJ=`#define SHADER_NAME icon-layer-fragment-shader

precision highp float;

uniform float opacity;
uniform sampler2D iconsTexture;
uniform float alphaCutoff;

varying float vColorMode;
varying vec4 vColor;
varying vec2 vTextureCoords;
varying vec2 uv;

void main(void) {
  geometry.uv = uv;

  vec4 texColor = texture2D(iconsTexture, vTextureCoords);
  vec3 color = mix(texColor.rgb, vColor.rgb, vColorMode);
  float a = texColor.a * opacity * vColor.a;

  if (a < alphaCutoff) {
    discard;
  }

  gl_FragColor = vec4(color, a);
  DECKGL_FILTER_COLOR(gl_FragColor, geometry);
}
`,pJ=1024,gJ=4,QN=()=>{},JN={10241:9987,10240:9729,10242:33071,10243:33071};function mJ(n){return Math.pow(2,Math.ceil(Math.log2(n)))}function yJ(n,e,t,r){const i=Math.min(t/e.width,r/e.height),o=Math.floor(e.width*i),a=Math.floor(e.height*i);return i===1?{data:e,width:o,height:a}:(n.canvas.height=a,n.canvas.width=o,n.clearRect(0,0,o,a),n.drawImage(e,0,0,e.width,e.height,0,0,o,a),{data:n.canvas,width:o,height:a})}function i_(n){return n&&(n.id||n.url)}function _J(n,e,t,r){const i=n.width,o=n.height,a=new fs(n.gl,{width:e,height:t,parameters:r});return kq(n,a,{targetY:0,width:i,height:o}),n.delete(),a}function eD(n,e,t){for(let r=0;r<e.length;r++){const{icon:i,xOffset:o}=e[r],a=i_(i);n[a]={...i,x:o,y:t}}}function vJ({icons:n,buffer:e,mapping:t={},xOffset:r=0,yOffset:i=0,rowHeight:o=0,canvasWidth:a}){let l=[];for(let h=0;h<n.length;h++){const p=n[h],g=i_(p);if(!t[g]){const{height:_,width:x}=p;r+x+e>a&&(eD(t,l,i),r=0,i=o+i+e,o=0,l=[]),l.push({icon:p,xOffset:r}),r=r+x+e,o=Math.max(o,_)}}return l.length>0&&eD(t,l,i),{mapping:t,rowHeight:o,xOffset:r,yOffset:i,canvasWidth:a,canvasHeight:mJ(o+i+e)}}function bJ(n,e,t){if(!n||!e)return null;t=t||{};const r={},{iterable:i,objectInfo:o}=lC(n);for(const a of i){o.index++;const l=e(a,o),h=i_(l);if(!l)throw new Error("Icon is missing.");if(!l.url)throw new Error("Icon url is missing.");!r[h]&&(!t[h]||l.url!==t[h].url)&&(r[h]={...l,source:a,sourceIndex:o.index})}return r}class wJ{constructor(e,{onUpdate:t=QN,onError:r=QN}){Y(this,"gl",void 0),Y(this,"onUpdate",void 0),Y(this,"onError",void 0),Y(this,"_loadOptions",null),Y(this,"_texture",null),Y(this,"_externalTexture",null),Y(this,"_mapping",{}),Y(this,"_textureParameters",null),Y(this,"_pendingCount",0),Y(this,"_autoPacking",!1),Y(this,"_xOffset",0),Y(this,"_yOffset",0),Y(this,"_rowHeight",0),Y(this,"_buffer",gJ),Y(this,"_canvasWidth",pJ),Y(this,"_canvasHeight",0),Y(this,"_canvas",null),this.gl=e,this.onUpdate=t,this.onError=r}finalize(){var e;(e=this._texture)===null||e===void 0||e.delete()}getTexture(){return this._texture||this._externalTexture}getIconMapping(e){const t=this._autoPacking?i_(e):e;return this._mapping[t]||{}}setProps({loadOptions:e,autoPacking:t,iconAtlas:r,iconMapping:i,textureParameters:o}){if(e&&(this._loadOptions=e),t!==void 0&&(this._autoPacking=t),i&&(this._mapping=i),r){var a;(a=this._texture)===null||a===void 0||a.delete(),this._texture=null,this._externalTexture=r}o&&(this._textureParameters=o)}get isLoaded(){return this._pendingCount===0}packIcons(e,t){if(!this._autoPacking||typeof document>"u")return;const r=Object.values(bJ(e,t,this._mapping)||{});if(r.length>0){const{mapping:i,xOffset:o,yOffset:a,rowHeight:l,canvasHeight:h}=vJ({icons:r,buffer:this._buffer,canvasWidth:this._canvasWidth,mapping:this._mapping,rowHeight:this._rowHeight,xOffset:this._xOffset,yOffset:this._yOffset});this._rowHeight=l,this._mapping=i,this._xOffset=o,this._yOffset=a,this._canvasHeight=h,this._texture||(this._texture=new fs(this.gl,{width:this._canvasWidth,height:this._canvasHeight,parameters:this._textureParameters||JN})),this._texture.height!==this._canvasHeight&&(this._texture=_J(this._texture,this._canvasWidth,this._canvasHeight,this._textureParameters||JN)),this.onUpdate(),this._canvas=this._canvas||document.createElement("canvas"),this._loadIcons(r)}}_loadIcons(e){const t=this._canvas.getContext("2d",{willReadFrequently:!0});for(const r of e)this._pendingCount++,Nb(r.url,this._loadOptions).then(i=>{const o=i_(r),a=this._mapping[o],{x:l,y:h,width:p,height:g}=a,{data:_,width:x,height:C}=yJ(t,i,p,g);this._texture.setSubImageData({data:_,x:l+(p-x)/2,y:h+(g-C)/2,width:x,height:C}),a.width=x,a.height=C,this._texture.generateMipmap(),this.onUpdate()}).catch(i=>{this.onError({url:r.url,source:r.source,sourceIndex:r.sourceIndex,loadOptions:this._loadOptions,error:i})}).finally(()=>{this._pendingCount--})}}const tD=[0,0,0,255],xJ={iconAtlas:{type:"image",value:null,async:!0},iconMapping:{type:"object",value:{},async:!0},sizeScale:{type:"number",value:1,min:0},billboard:!0,sizeUnits:"pixels",sizeMinPixels:{type:"number",min:0,value:0},sizeMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},alphaCutoff:{type:"number",value:.05,min:0,max:1},getPosition:{type:"accessor",value:n=>n.position},getIcon:{type:"accessor",value:n=>n.icon},getColor:{type:"accessor",value:tD},getSize:{type:"accessor",value:1},getAngle:{type:"accessor",value:0},getPixelOffset:{type:"accessor",value:[0,0]},onIconError:{type:"function",value:null,optional:!0},textureParameters:{type:"object",ignore:!0}};class bC extends Vl{constructor(...e){super(...e),Y(this,"state",void 0)}getShaders(){return super.getShaders({vs:dJ,fs:fJ,modules:[jp,Vp]})}initializeState(){this.state={iconManager:new wJ(this.context.gl,{onUpdate:this._onUpdate.bind(this),onError:this._onError.bind(this)})},this.getAttributeManager().addInstanced({instancePositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceSizes:{size:1,transition:!0,accessor:"getSize",defaultValue:1},instanceOffsets:{size:2,accessor:"getIcon",transform:this.getInstanceOffset},instanceIconFrames:{size:4,accessor:"getIcon",transform:this.getInstanceIconFrame},instanceColorModes:{size:1,type:5121,accessor:"getIcon",transform:this.getInstanceColorMode},instanceColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,transition:!0,accessor:"getColor",defaultValue:tD},instanceAngles:{size:1,transition:!0,accessor:"getAngle"},instancePixelOffset:{size:2,transition:!0,accessor:"getPixelOffset"}})}updateState(e){super.updateState(e);const{props:t,oldProps:r,changeFlags:i}=e,o=this.getAttributeManager(),{iconAtlas:a,iconMapping:l,data:h,getIcon:p,textureParameters:g}=t,{iconManager:_}=this.state,x=a||this.internalState.isAsyncPropLoading("iconAtlas");if(_.setProps({loadOptions:t.loadOptions,autoPacking:!x,iconAtlas:a,iconMapping:x?l:null,textureParameters:g}),x?r.iconMapping!==t.iconMapping&&o.invalidate("getIcon"):(i.dataChanged||i.updateTriggersChanged&&(i.updateTriggersChanged.all||i.updateTriggersChanged.getIcon))&&_.packIcons(h,p),i.extensionsChanged){var C;const{gl:M}=this.context;(C=this.state.model)===null||C===void 0||C.delete(),this.state.model=this._getModel(M),o.invalidateAll()}}get isLoaded(){return super.isLoaded&&this.state.iconManager.isLoaded}finalizeState(e){super.finalizeState(e),this.state.iconManager.finalize()}draw({uniforms:e}){const{sizeScale:t,sizeMinPixels:r,sizeMaxPixels:i,sizeUnits:o,billboard:a,alphaCutoff:l}=this.props,{iconManager:h}=this.state,p=h.getTexture();p&&this.state.model.setUniforms(e).setUniforms({iconsTexture:p,iconsTextureDim:[p.width,p.height],sizeUnits:Ep[o],sizeScale:t,sizeMinPixels:r,sizeMaxPixels:i,billboard:a,alphaCutoff:l}).draw()}_getModel(e){const t=[-1,-1,-1,1,1,1,1,-1];return new Ad(e,{...this.getShaders(),id:this.props.id,geometry:new kp({drawMode:6,attributes:{positions:{size:2,value:new Float32Array(t)}}}),isInstanced:!0})}_onUpdate(){this.setNeedsRedraw()}_onError(e){var t;const r=(t=this.getCurrentLayer())===null||t===void 0?void 0:t.props.onIconError;r?r(e):Ir.error(e.error.message)()}getInstanceOffset(e){const{width:t,height:r,anchorX:i=t/2,anchorY:o=r/2}=this.state.iconManager.getIconMapping(e);return[t/2-i,r/2-o]}getInstanceColorMode(e){return this.state.iconManager.getIconMapping(e).mask?1:0}getInstanceIconFrame(e){const{x:t,y:r,width:i,height:o}=this.state.iconManager.getIconMapping(e);return[t,r,i,o]}}Y(bC,"defaultProps",xJ),Y(bC,"layerName","IconLayer");const EJ=`#define SHADER_NAME scatterplot-layer-vertex-shader

attribute vec3 positions;

attribute vec3 instancePositions;
attribute vec3 instancePositions64Low;
attribute float instanceRadius;
attribute float instanceLineWidths;
attribute vec4 instanceFillColors;
attribute vec4 instanceLineColors;
attribute vec3 instancePickingColors;

uniform float opacity;
uniform float radiusScale;
uniform float radiusMinPixels;
uniform float radiusMaxPixels;
uniform float lineWidthScale;
uniform float lineWidthMinPixels;
uniform float lineWidthMaxPixels;
uniform float stroked;
uniform bool filled;
uniform bool antialiasing;
uniform bool billboard;
uniform int radiusUnits;
uniform int lineWidthUnits;

varying vec4 vFillColor;
varying vec4 vLineColor;
varying vec2 unitPosition;
varying float innerUnitRadius;
varying float outerRadiusPixels;


void main(void) {
  geometry.worldPosition = instancePositions;
  outerRadiusPixels = clamp(
    project_size_to_pixel(radiusScale * instanceRadius, radiusUnits),
    radiusMinPixels, radiusMaxPixels
  );
  float lineWidthPixels = clamp(
    project_size_to_pixel(lineWidthScale * instanceLineWidths, lineWidthUnits),
    lineWidthMinPixels, lineWidthMaxPixels
  );
  outerRadiusPixels += stroked * lineWidthPixels / 2.0;
  float edgePadding = antialiasing ? (outerRadiusPixels + SMOOTH_EDGE_RADIUS) / outerRadiusPixels : 1.0;
  unitPosition = edgePadding * positions.xy;
  geometry.uv = unitPosition;
  geometry.pickingColor = instancePickingColors;

  innerUnitRadius = 1.0 - stroked * lineWidthPixels / outerRadiusPixels;
  
  if (billboard) {
    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
    DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
    vec3 offset = edgePadding * positions * outerRadiusPixels;
    DECKGL_FILTER_SIZE(offset, geometry);
    gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
  } else {
    vec3 offset = edgePadding * positions * project_pixel_size(outerRadiusPixels);
    DECKGL_FILTER_SIZE(offset, geometry);
    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset, geometry.position);
    DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
  }
  vFillColor = vec4(instanceFillColors.rgb, instanceFillColors.a * opacity);
  DECKGL_FILTER_COLOR(vFillColor, geometry);
  vLineColor = vec4(instanceLineColors.rgb, instanceLineColors.a * opacity);
  DECKGL_FILTER_COLOR(vLineColor, geometry);
}
`,TJ=`#define SHADER_NAME scatterplot-layer-fragment-shader

precision highp float;

uniform bool filled;
uniform float stroked;
uniform bool antialiasing;

varying vec4 vFillColor;
varying vec4 vLineColor;
varying vec2 unitPosition;
varying float innerUnitRadius;
varying float outerRadiusPixels;

void main(void) {
  geometry.uv = unitPosition;

  float distToCenter = length(unitPosition) * outerRadiusPixels;
  float inCircle = antialiasing ? 
    smoothedge(distToCenter, outerRadiusPixels) : 
    step(distToCenter, outerRadiusPixels);

  if (inCircle == 0.0) {
    discard;
  }

  if (stroked > 0.5) {
    float isLine = antialiasing ? 
      smoothedge(innerUnitRadius * outerRadiusPixels, distToCenter) :
      step(innerUnitRadius * outerRadiusPixels, distToCenter);

    if (filled) {
      gl_FragColor = mix(vFillColor, vLineColor, isLine);
    } else {
      if (isLine == 0.0) {
        discard;
      }
      gl_FragColor = vec4(vLineColor.rgb, vLineColor.a * isLine);
    }
  } else if (!filled) {
    discard;
  } else {
    gl_FragColor = vFillColor;
  }

  gl_FragColor.a *= inCircle;
  DECKGL_FILTER_COLOR(gl_FragColor, geometry);
}
`,nD=[0,0,0,255],SJ={radiusUnits:"meters",radiusScale:{type:"number",min:0,value:1},radiusMinPixels:{type:"number",min:0,value:0},radiusMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},lineWidthUnits:"meters",lineWidthScale:{type:"number",min:0,value:1},lineWidthMinPixels:{type:"number",min:0,value:0},lineWidthMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},stroked:!1,filled:!0,billboard:!1,antialiasing:!0,getPosition:{type:"accessor",value:n=>n.position},getRadius:{type:"accessor",value:1},getFillColor:{type:"accessor",value:nD},getLineColor:{type:"accessor",value:nD},getLineWidth:{type:"accessor",value:1},strokeWidth:{deprecatedFor:"getLineWidth"},outline:{deprecatedFor:"stroked"},getColor:{deprecatedFor:["getFillColor","getLineColor"]}};class wC extends Vl{getShaders(){return super.getShaders({vs:EJ,fs:TJ,modules:[jp,Vp]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceRadius:{size:1,transition:!0,accessor:"getRadius",defaultValue:1},instanceFillColors:{size:this.props.colorFormat.length,transition:!0,normalized:!0,type:5121,accessor:"getFillColor",defaultValue:[0,0,0,255]},instanceLineColors:{size:this.props.colorFormat.length,transition:!0,normalized:!0,type:5121,accessor:"getLineColor",defaultValue:[0,0,0,255]},instanceLineWidths:{size:1,transition:!0,accessor:"getLineWidth",defaultValue:1}})}updateState(e){if(super.updateState(e),e.changeFlags.extensionsChanged){var t;const{gl:r}=this.context;(t=this.state.model)===null||t===void 0||t.delete(),this.state.model=this._getModel(r),this.getAttributeManager().invalidateAll()}}draw({uniforms:e}){const{radiusUnits:t,radiusScale:r,radiusMinPixels:i,radiusMaxPixels:o,stroked:a,filled:l,billboard:h,antialiasing:p,lineWidthUnits:g,lineWidthScale:_,lineWidthMinPixels:x,lineWidthMaxPixels:C}=this.props;this.state.model.setUniforms(e).setUniforms({stroked:a?1:0,filled:l,billboard:h,antialiasing:p,radiusUnits:Ep[t],radiusScale:r,radiusMinPixels:i,radiusMaxPixels:o,lineWidthUnits:Ep[g],lineWidthScale:_,lineWidthMinPixels:x,lineWidthMaxPixels:C}).draw()}_getModel(e){const t=[-1,-1,0,1,-1,0,1,1,0,-1,1,0];return new Ad(e,{...this.getShaders(),id:this.props.id,geometry:new kp({drawMode:6,vertexCount:4,attributes:{positions:{size:3,value:new Float32Array(t)}}}),isInstanced:!0})}}Y(wC,"defaultProps",SJ),Y(wC,"layerName","ScatterplotLayer");const CJ=`#define SHADER_NAME multi-icon-layer-fragment-shader

precision highp float;

uniform float opacity;
uniform sampler2D iconsTexture;
uniform float gamma;
uniform bool sdf;
uniform float alphaCutoff;
uniform float sdfBuffer;
uniform float outlineBuffer;
uniform vec4 outlineColor;

varying vec4 vColor;
varying vec2 vTextureCoords;
varying vec2 uv;

void main(void) {
  geometry.uv = uv;

  if (!picking_uActive) {
    float alpha = texture2D(iconsTexture, vTextureCoords).a;
    vec4 color = vColor;
    if (sdf) {
      float distance = alpha;
      alpha = smoothstep(sdfBuffer - gamma, sdfBuffer + gamma, distance);

      if (outlineBuffer > 0.0) {
        float inFill = alpha;
        float inBorder = smoothstep(outlineBuffer - gamma, outlineBuffer + gamma, distance);
        color = mix(outlineColor, vColor, inFill);
        alpha = inBorder;
      }
    }
    float a = alpha * color.a;
    
    if (a < alphaCutoff) {
      discard;
    }

    gl_FragColor = vec4(color.rgb, a * opacity);
  }

  DECKGL_FILTER_COLOR(gl_FragColor, geometry);
}
`,xC=192/256,rD=[],AJ={getIconOffsets:{type:"accessor",value:n=>n.offsets},alphaCutoff:.001,smoothing:.1,outlineWidth:0,outlineColor:{type:"color",value:[0,0,0,255]}};class EC extends bC{constructor(...e){super(...e),Y(this,"state",void 0)}getShaders(){return{...super.getShaders(),fs:CJ}}initializeState(){super.initializeState(),this.getAttributeManager().addInstanced({instanceOffsets:{size:2,accessor:"getIconOffsets"},instancePickingColors:{type:5121,size:3,accessor:(t,{index:r,target:i})=>this.encodePickingColor(r,i)}})}updateState(e){super.updateState(e);const{props:t,oldProps:r}=e;let{outlineColor:i}=t;i!==r.outlineColor&&(i=i.map(o=>o/255),i[3]=Number.isFinite(i[3])?i[3]:1,this.setState({outlineColor:i})),!t.sdf&&t.outlineWidth&&Ir.warn("".concat(this.id,": fontSettings.sdf is required to render outline"))()}draw(e){const{sdf:t,smoothing:r,outlineWidth:i}=this.props,{outlineColor:o}=this.state,a=i?Math.max(r,xC*(1-i)):-1;if(e.uniforms={...e.uniforms,sdfBuffer:xC,outlineBuffer:a,gamma:r,sdf:!!t,outlineColor:o},super.draw(e),t&&i){const{iconManager:l}=this.state;l.getTexture()&&this.state.model.draw({uniforms:{outlineBuffer:xC}})}}getInstanceOffset(e){return e?Array.from(e).flatMap(t=>super.getInstanceOffset(t)):rD}getInstanceColorMode(e){return 1}getInstanceIconFrame(e){return e?Array.from(e).flatMap(t=>super.getInstanceIconFrame(t)):rD}}Y(EC,"defaultProps",AJ),Y(EC,"layerName","MultiIconLayer");const o_=1e20;class IJ{constructor({fontSize:e=24,buffer:t=3,radius:r=8,cutoff:i=.25,fontFamily:o="sans-serif",fontWeight:a="normal",fontStyle:l="normal",lang:h=null}={}){this.buffer=t,this.cutoff=i,this.radius=r,this.lang=h;const p=this.size=e+t*4,g=this._createCanvas(p),_=this.ctx=g.getContext("2d",{willReadFrequently:!0});_.font=`${l} ${a} ${e}px ${o}`,_.textBaseline="alphabetic",_.textAlign="left",_.fillStyle="black",this.gridOuter=new Float64Array(p*p),this.gridInner=new Float64Array(p*p),this.f=new Float64Array(p),this.z=new Float64Array(p+1),this.v=new Uint16Array(p)}_createCanvas(e){const t=document.createElement("canvas");return t.width=t.height=e,t}draw(e){const{width:t,actualBoundingBoxAscent:r,actualBoundingBoxDescent:i,actualBoundingBoxLeft:o,actualBoundingBoxRight:a}=this.ctx.measureText(e),l=Math.ceil(r),h=0,p=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(a-o))),g=Math.min(this.size-this.buffer,l+Math.ceil(i)),_=p+2*this.buffer,x=g+2*this.buffer,C=Math.max(_*x,0),M=new Uint8ClampedArray(C),L={data:M,width:_,height:x,glyphWidth:p,glyphHeight:g,glyphTop:l,glyphLeft:h,glyphAdvance:t};if(p===0||g===0)return L;const{ctx:F,buffer:z,gridInner:ee,gridOuter:ce}=this;this.lang&&(F.lang=this.lang),F.clearRect(z,z,p,g),F.fillText(e,z,z+l);const se=F.getImageData(z,z,p,g);ce.fill(o_,0,C),ee.fill(0,0,C);for(let _e=0;_e<g;_e++)for(let J=0;J<p;J++){const pe=se.data[4*(_e*p+J)+3]/255;if(pe===0)continue;const ue=(_e+z)*_+J+z;if(pe===1)ce[ue]=0,ee[ue]=o_;else{const xe=.5-pe;ce[ue]=xe>0?xe*xe:0,ee[ue]=xe<0?xe*xe:0}}iD(ce,0,0,_,x,_,this.f,this.v,this.z),iD(ee,z,z,p,g,_,this.f,this.v,this.z);for(let _e=0;_e<C;_e++){const J=Math.sqrt(ce[_e])-Math.sqrt(ee[_e]);M[_e]=Math.round(255-255*(J/this.radius+this.cutoff))}return L}}function iD(n,e,t,r,i,o,a,l,h){for(let p=e;p<e+r;p++)oD(n,t*o+p,o,i,a,l,h);for(let p=t;p<t+i;p++)oD(n,p*o+e,1,r,a,l,h)}function oD(n,e,t,r,i,o,a){o[0]=0,a[0]=-o_,a[1]=o_,i[0]=n[e];for(let l=1,h=0,p=0;l<r;l++){i[l]=n[e+l*t];const g=l*l;do{const _=o[h];p=(i[l]-i[_]+g-_*_)/(l-_)/2}while(p<=a[h]&&--h>-1);h++,o[h]=l,a[h]=p,a[h+1]=o_}for(let l=0,h=0;l<r;l++){for(;a[h+1]<l;)h++;const p=o[h],g=l-p;n[e+l*t]=i[p]+g*g}}const PJ=32,MJ=[];function RJ(n){return Math.pow(2,Math.ceil(Math.log2(n)))}function kJ({characterSet:n,getFontWidth:e,fontHeight:t,buffer:r,maxCanvasWidth:i,mapping:o={},xOffset:a=0,yOffset:l=0}){let h=0,p=a;const g=t+r*2;for(const _ of n)if(!o[_]){const x=e(_);p+x+r*2>i&&(p=0,h++),o[_]={x:p+r,y:l+h*g+r,width:x,height:g,layoutWidth:x,layoutHeight:t},p+=x+r*2}return{mapping:o,xOffset:p,yOffset:l+h*g,canvasHeight:RJ(l+(h+1)*g)}}function aD(n,e,t,r){let i=0;for(let a=e;a<t;a++){var o;const l=n[a];i+=((o=r[l])===null||o===void 0?void 0:o.layoutWidth)||0}return i}function sD(n,e,t,r,i,o){let a=e,l=0;for(let h=e;h<t;h++){const p=aD(n,h,h+1,i);l+p>r&&(a<h&&o.push(h),a=h,l=0),l+=p}return l}function OJ(n,e,t,r,i,o){let a=e,l=e,h=e,p=0;for(let g=e;g<t;g++)if((n[g]===" "||n[g+1]===" "||g+1===t)&&(h=g+1),h>l){let _=aD(n,l,h,i);p+_>r&&(a<l&&(o.push(l),a=l,p=0),_>r&&(_=sD(n,l,h,r,i,o),a=o[o.length-1])),l=h,p+=_}return p}function LJ(n,e,t,r,i=0,o){o===void 0&&(o=n.length);const a=[];return e==="break-all"?sD(n,i,o,t,r,a):OJ(n,i,o,t,r,a),a}function NJ(n,e,t,r,i,o){let a=0,l=0;for(let h=e;h<t;h++){const p=n[h],g=r[p];g?(l||(l=g.layoutHeight),i[h]=a+g.layoutWidth/2,a+=g.layoutWidth):(Ir.warn("Missing character: ".concat(p," (").concat(p.codePointAt(0),")"))(),i[h]=a,a+=PJ)}o[0]=a,o[1]=l}function DJ(n,e,t,r,i){const o=Array.from(n),a=o.length,l=new Array(a),h=new Array(a),p=new Array(a),g=(t==="break-word"||t==="break-all")&&isFinite(r)&&r>0,_=[0,0],x=[0,0];let C=0,M=0,L=0;for(let z=0;z<=a;z++){const ee=o[z];if((ee===`
`||z===a)&&(L=z),L>M){const ce=g?LJ(o,t,r,i,M,L):MJ;for(let se=0;se<=ce.length;se++){const _e=se===0?M:ce[se-1],J=se<ce.length?ce[se]:L;NJ(o,_e,J,i,l,x);for(let pe=_e;pe<J;pe++){var F;const ue=o[pe],xe=((F=i[ue])===null||F===void 0?void 0:F.layoutOffsetY)||0;h[pe]=C+x[1]/2+xe,p[pe]=x[0]}C=C+x[1]*e,_[0]=Math.max(_[0],x[0])}M=L}ee===`
`&&(l[M]=0,h[M]=0,p[M]=0,M++)}return _[1]=C,{x:l,y:h,rowWidth:p,size:_}}function FJ({value:n,length:e,stride:t,offset:r,startIndices:i,characterSet:o}){const a=n.BYTES_PER_ELEMENT,l=t?t/a:1,h=r?r/a:0,p=i[e]||Math.ceil((n.length-h)/l),g=o&&new Set,_=new Array(e);let x=n;if(l>1||h>0){const C=n.constructor;x=new C(p);for(let M=0;M<p;M++)x[M]=n[M*l+h]}for(let C=0;C<e;C++){const M=i[C],L=i[C+1]||p,F=x.subarray(M,L);_[C]=String.fromCodePoint.apply(null,F),g&&F.forEach(g.add,g)}if(g)for(const C of g)o.add(String.fromCodePoint(C));return{texts:_,characterCount:p}}class cD{constructor(e=5){Y(this,"limit",void 0),Y(this,"_cache",{}),Y(this,"_order",[]),this.limit=e}get(e){const t=this._cache[e];return t&&(this._deleteOrder(e),this._appendOrder(e)),t}set(e,t){this._cache[e]?(this.delete(e),this._cache[e]=t,this._appendOrder(e)):(Object.keys(this._cache).length===this.limit&&this.delete(this._order[0]),this._cache[e]=t,this._appendOrder(e))}delete(e){this._cache[e]&&(delete this._cache[e],this._deleteOrder(e))}_deleteOrder(e){const t=this._order.indexOf(e);t>=0&&this._order.splice(t,1)}_appendOrder(e){this._order.push(e)}}function BJ(){const n=[];for(let e=32;e<128;e++)n.push(String.fromCharCode(e));return n}const $p={fontFamily:"Monaco, monospace",fontWeight:"normal",characterSet:BJ(),fontSize:64,buffer:4,sdf:!1,cutoff:.25,radius:12,smoothing:.1},lD=1024,uD=.9,hD=1.2,dD=3;let p1=new cD(dD);function UJ(n,e){let t;typeof e=="string"?t=new Set(Array.from(e)):t=new Set(e);const r=p1.get(n);if(!r)return t;for(const i in r.mapping)t.has(i)&&t.delete(i);return t}function zJ(n,e){for(let t=0;t<n.length;t++)e.data[4*t+3]=n[t]}function fD(n,e,t,r){n.font="".concat(r," ").concat(t,"px ").concat(e),n.fillStyle="#000",n.textBaseline="alphabetic",n.textAlign="left"}function jJ(n){Ir.assert(Number.isFinite(n)&&n>=dD,"Invalid cache limit"),p1=new cD(n)}class VJ{constructor(){Y(this,"props",{...$p}),Y(this,"_key",void 0),Y(this,"_atlas",void 0)}get texture(){return this._atlas}get mapping(){return this._atlas&&this._atlas.mapping}get scale(){const{fontSize:e,buffer:t}=this.props;return(e*hD+t*2)/e}setProps(e={}){Object.assign(this.props,e),this._key=this._getKey();const t=UJ(this._key,this.props.characterSet),r=p1.get(this._key);if(r&&t.size===0){this._atlas!==r&&(this._atlas=r);return}const i=this._generateFontAtlas(t,r);this._atlas=i,p1.set(this._key,i)}_generateFontAtlas(e,t){const{fontFamily:r,fontWeight:i,fontSize:o,buffer:a,sdf:l,radius:h,cutoff:p}=this.props;let g=t&&t.data;g||(g=document.createElement("canvas"),g.width=lD);const _=g.getContext("2d",{willReadFrequently:!0});fD(_,r,o,i);const{mapping:x,canvasHeight:C,xOffset:M,yOffset:L}=kJ({getFontWidth:F=>_.measureText(F).width,fontHeight:o*hD,buffer:a,characterSet:e,maxCanvasWidth:lD,...t&&{mapping:t.mapping,xOffset:t.xOffset,yOffset:t.yOffset}});if(g.height!==C){const F=_.getImageData(0,0,g.width,g.height);g.height=C,_.putImageData(F,0,0)}if(fD(_,r,o,i),l){const F=new IJ({fontSize:o,buffer:a,radius:h,cutoff:p,fontFamily:r,fontWeight:"".concat(i)});for(const z of e){const{data:ee,width:ce,height:se,glyphTop:_e}=F.draw(z);x[z].width=ce,x[z].layoutOffsetY=o*uD-_e;const J=_.createImageData(ce,se);zJ(ee,J),_.putImageData(J,x[z].x,x[z].y)}}else for(const F of e)_.fillText(F,x[F].x,x[F].y+a+o*uD);return{xOffset:M,yOffset:L,mapping:x,data:g,width:g.width,height:g.height}}_getKey(){const{fontFamily:e,fontWeight:t,fontSize:r,buffer:i,sdf:o,radius:a,cutoff:l}=this.props;return o?"".concat(e," ").concat(t," ").concat(r," ").concat(i," ").concat(a," ").concat(l):"".concat(e," ").concat(t," ").concat(r," ").concat(i)}}const HJ=`#define SHADER_NAME text-background-layer-vertex-shader

attribute vec2 positions;

attribute vec3 instancePositions;
attribute vec3 instancePositions64Low;
attribute vec4 instanceRects;
attribute float instanceSizes;
attribute float instanceAngles;
attribute vec2 instancePixelOffsets;
attribute float instanceLineWidths;
attribute vec4 instanceFillColors;
attribute vec4 instanceLineColors;
attribute vec3 instancePickingColors;

uniform bool billboard;
uniform float opacity;
uniform float sizeScale;
uniform float sizeMinPixels;
uniform float sizeMaxPixels;
uniform vec4 padding;
uniform int sizeUnits;

varying vec4 vFillColor;
varying vec4 vLineColor;
varying float vLineWidth;
varying vec2 uv;
varying vec2 dimensions;

vec2 rotate_by_angle(vec2 vertex, float angle) {
  float angle_radian = radians(angle);
  float cos_angle = cos(angle_radian);
  float sin_angle = sin(angle_radian);
  mat2 rotationMatrix = mat2(cos_angle, -sin_angle, sin_angle, cos_angle);
  return rotationMatrix * vertex;
}

void main(void) {
  geometry.worldPosition = instancePositions;
  geometry.uv = positions;
  geometry.pickingColor = instancePickingColors;
  uv = positions;
  vLineWidth = instanceLineWidths;
  float sizePixels = clamp(
    project_size_to_pixel(instanceSizes * sizeScale, sizeUnits),
    sizeMinPixels, sizeMaxPixels
  );

  dimensions = instanceRects.zw * sizePixels + padding.xy + padding.zw;

  vec2 pixelOffset = (positions * instanceRects.zw + instanceRects.xy) * sizePixels + mix(-padding.xy, padding.zw, positions);
  pixelOffset = rotate_by_angle(pixelOffset, instanceAngles);
  pixelOffset += instancePixelOffsets;
  pixelOffset.y *= -1.0;

  if (billboard)  {
    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
    DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
    vec3 offset = vec3(pixelOffset, 0.0);
    DECKGL_FILTER_SIZE(offset, geometry);
    gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
  } else {
    vec3 offset_common = vec3(project_pixel_size(pixelOffset), 0.0);
    DECKGL_FILTER_SIZE(offset_common, geometry);
    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset_common, geometry.position);
    DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
  }
  vFillColor = vec4(instanceFillColors.rgb, instanceFillColors.a * opacity);
  DECKGL_FILTER_COLOR(vFillColor, geometry);
  vLineColor = vec4(instanceLineColors.rgb, instanceLineColors.a * opacity);
  DECKGL_FILTER_COLOR(vLineColor, geometry);
}
`,GJ=`#define SHADER_NAME text-background-layer-fragment-shader

precision highp float;

uniform bool stroked;

varying vec4 vFillColor;
varying vec4 vLineColor;
varying float vLineWidth;
varying vec2 uv;
varying vec2 dimensions;

void main(void) {
  geometry.uv = uv;

  vec2 pixelPosition = uv * dimensions;
  if (stroked) {
    float distToEdge = min(
      min(pixelPosition.x, dimensions.x - pixelPosition.x),
      min(pixelPosition.y, dimensions.y - pixelPosition.y)
    );
    float isBorder = smoothedge(distToEdge, vLineWidth);
    gl_FragColor = mix(vFillColor, vLineColor, isBorder);
  } else {
    gl_FragColor = vFillColor;
  }

  DECKGL_FILTER_COLOR(gl_FragColor, geometry);
}
`,qJ={billboard:!0,sizeScale:1,sizeUnits:"pixels",sizeMinPixels:0,sizeMaxPixels:Number.MAX_SAFE_INTEGER,padding:{type:"array",value:[0,0,0,0]},getPosition:{type:"accessor",value:n=>n.position},getSize:{type:"accessor",value:1},getAngle:{type:"accessor",value:0},getPixelOffset:{type:"accessor",value:[0,0]},getBoundingRect:{type:"accessor",value:[0,0,0,0]},getFillColor:{type:"accessor",value:[0,0,0,255]},getLineColor:{type:"accessor",value:[0,0,0,255]},getLineWidth:{type:"accessor",value:1}};class TC extends Vl{constructor(...e){super(...e),Y(this,"state",void 0)}getShaders(){return super.getShaders({vs:HJ,fs:GJ,modules:[jp,Vp]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceSizes:{size:1,transition:!0,accessor:"getSize",defaultValue:1},instanceAngles:{size:1,transition:!0,accessor:"getAngle"},instanceRects:{size:4,accessor:"getBoundingRect"},instancePixelOffsets:{size:2,transition:!0,accessor:"getPixelOffset"},instanceFillColors:{size:4,transition:!0,normalized:!0,type:5121,accessor:"getFillColor",defaultValue:[0,0,0,255]},instanceLineColors:{size:4,transition:!0,normalized:!0,type:5121,accessor:"getLineColor",defaultValue:[0,0,0,255]},instanceLineWidths:{size:1,transition:!0,accessor:"getLineWidth",defaultValue:1}})}updateState(e){super.updateState(e);const{changeFlags:t}=e;if(t.extensionsChanged){var r;const{gl:i}=this.context;(r=this.state.model)===null||r===void 0||r.delete(),this.state.model=this._getModel(i),this.getAttributeManager().invalidateAll()}}draw({uniforms:e}){const{billboard:t,sizeScale:r,sizeUnits:i,sizeMinPixels:o,sizeMaxPixels:a,getLineWidth:l}=this.props;let{padding:h}=this.props;h.length<4&&(h=[h[0],h[1],h[0],h[1]]),this.state.model.setUniforms(e).setUniforms({billboard:t,stroked:!!l,padding:h,sizeUnits:Ep[i],sizeScale:r,sizeMinPixels:o,sizeMaxPixels:a}).draw()}_getModel(e){const t=[0,0,1,0,1,1,0,1];return new Ad(e,{...this.getShaders(),id:this.props.id,geometry:new kp({drawMode:6,vertexCount:4,attributes:{positions:{size:2,value:new Float32Array(t)}}}),isInstanced:!0})}}Y(TC,"defaultProps",qJ),Y(TC,"layerName","TextBackgroundLayer");const pD={start:1,middle:0,end:-1},gD={top:1,center:0,bottom:-1},SC=[0,0,0,255],$J=1,WJ={billboard:!0,sizeScale:1,sizeUnits:"pixels",sizeMinPixels:0,sizeMaxPixels:Number.MAX_SAFE_INTEGER,background:!1,getBackgroundColor:{type:"accessor",value:[255,255,255,255]},getBorderColor:{type:"accessor",value:SC},getBorderWidth:{type:"accessor",value:0},backgroundPadding:{type:"array",value:[0,0,0,0]},characterSet:{type:"object",value:$p.characterSet},fontFamily:$p.fontFamily,fontWeight:$p.fontWeight,lineHeight:$J,outlineWidth:{type:"number",value:0,min:0},outlineColor:{type:"color",value:SC},fontSettings:{type:"object",value:{},compare:1},wordBreak:"break-word",maxWidth:{type:"number",value:-1},getText:{type:"accessor",value:n=>n.text},getPosition:{type:"accessor",value:n=>n.position},getColor:{type:"accessor",value:SC},getSize:{type:"accessor",value:32},getAngle:{type:"accessor",value:0},getTextAnchor:{type:"accessor",value:"middle"},getAlignmentBaseline:{type:"accessor",value:"center"},getPixelOffset:{type:"accessor",value:[0,0]},backgroundColor:{deprecatedFor:["background","getBackgroundColor"]}};class CC extends vC{constructor(...e){super(...e),Y(this,"state",void 0),Y(this,"getBoundingRect",(t,r)=>{let{size:[i,o]}=this.transformParagraph(t,r);const{fontSize:a}=this.state.fontAtlasManager.props;i/=a,o/=a;const{getTextAnchor:l,getAlignmentBaseline:h}=this.props,p=pD[typeof l=="function"?l(t,r):l],g=gD[typeof h=="function"?h(t,r):h];return[(p-1)*i/2,(g-1)*o/2,i,o]}),Y(this,"getIconOffsets",(t,r)=>{const{getTextAnchor:i,getAlignmentBaseline:o}=this.props,{x:a,y:l,rowWidth:h,size:[p,g]}=this.transformParagraph(t,r),_=pD[typeof i=="function"?i(t,r):i],x=gD[typeof o=="function"?o(t,r):o],C=a.length,M=new Array(C*2);let L=0;for(let F=0;F<C;F++){const z=(1-_)*(p-h[F])/2;M[L++]=(_-1)*p/2+z+a[F],M[L++]=(x-1)*g/2+l[F]}return M})}initializeState(){this.state={styleVersion:0,fontAtlasManager:new VJ},this.props.maxWidth>0&&Ir.warn("v8.9 breaking change: TextLayer maxWidth is now relative to text size")()}updateState(e){const{props:t,oldProps:r,changeFlags:i}=e;(i.dataChanged||i.updateTriggersChanged&&(i.updateTriggersChanged.all||i.updateTriggersChanged.getText))&&this._updateText(),(this._updateFontAtlas()||t.lineHeight!==r.lineHeight||t.wordBreak!==r.wordBreak||t.maxWidth!==r.maxWidth)&&this.setState({styleVersion:this.state.styleVersion+1})}getPickingInfo({info:e}){return e.object=e.index>=0?this.props.data[e.index]:null,e}_updateFontAtlas(){const{fontSettings:e,fontFamily:t,fontWeight:r}=this.props,{fontAtlasManager:i,characterSet:o}=this.state,a={...e,characterSet:o,fontFamily:t,fontWeight:r};if(!i.mapping)return i.setProps(a),!0;for(const l in a)if(a[l]!==i.props[l])return i.setProps(a),!0;return!1}_updateText(){var e;const{data:t,characterSet:r}=this.props,i=(e=t.attributes)===null||e===void 0?void 0:e.getText;let{getText:o}=this.props,a=t.startIndices,l;const h=r==="auto"&&new Set;if(i&&a){const{texts:p,characterCount:g}=FJ({...ArrayBuffer.isView(i)?{value:i}:i,length:t.length,startIndices:a,characterSet:h});l=g,o=(_,{index:x})=>p[x]}else{const{iterable:p,objectInfo:g}=lC(t);a=[0],l=0;for(const _ of p){g.index++;const x=Array.from(o(_,g)||"");h&&x.forEach(h.add,h),l+=x.length,a.push(l)}}this.setState({getText:o,startIndices:a,numInstances:l,characterSet:h||r})}transformParagraph(e,t){const{fontAtlasManager:r}=this.state,i=r.mapping,o=this.state.getText,{wordBreak:a,lineHeight:l,maxWidth:h}=this.props,p=o(e,t)||"";return DJ(p,l,a,h*r.props.fontSize,i)}renderLayers(){const{startIndices:e,numInstances:t,getText:r,fontAtlasManager:{scale:i,texture:o,mapping:a},styleVersion:l}=this.state,{data:h,_dataDiff:p,getPosition:g,getColor:_,getSize:x,getAngle:C,getPixelOffset:M,getBackgroundColor:L,getBorderColor:F,getBorderWidth:z,backgroundPadding:ee,background:ce,billboard:se,fontSettings:_e,outlineWidth:J,outlineColor:pe,sizeScale:ue,sizeUnits:xe,sizeMinPixels:je,sizeMaxPixels:ne,transitions:Ee,updateTriggers:ke}=this.props,Be=this.getSubLayerClass("characters",EC),Ze=this.getSubLayerClass("background",TC);return[ce&&new Ze({getFillColor:L,getLineColor:F,getLineWidth:z,padding:ee,getPosition:g,getSize:x,getAngle:C,getPixelOffset:M,billboard:se,sizeScale:ue,sizeUnits:xe,sizeMinPixels:je,sizeMaxPixels:ne,transitions:Ee&&{getPosition:Ee.getPosition,getAngle:Ee.getAngle,getSize:Ee.getSize,getFillColor:Ee.getBackgroundColor,getLineColor:Ee.getBorderColor,getLineWidth:Ee.getBorderWidth,getPixelOffset:Ee.getPixelOffset}},this.getSubLayerProps({id:"background",updateTriggers:{getPosition:ke.getPosition,getAngle:ke.getAngle,getSize:ke.getSize,getFillColor:ke.getBackgroundColor,getLineColor:ke.getBorderColor,getLineWidth:ke.getBorderWidth,getPixelOffset:ke.getPixelOffset,getBoundingRect:{getText:ke.getText,getTextAnchor:ke.getTextAnchor,getAlignmentBaseline:ke.getAlignmentBaseline,styleVersion:l}}}),{data:h.attributes&&h.attributes.background?{length:h.length,attributes:h.attributes.background}:h,_dataDiff:p,autoHighlight:!1,getBoundingRect:this.getBoundingRect}),new Be({sdf:_e.sdf,smoothing:Number.isFinite(_e.smoothing)?_e.smoothing:$p.smoothing,outlineWidth:J/(_e.radius||$p.radius),outlineColor:pe,iconAtlas:o,iconMapping:a,getPosition:g,getColor:_,getSize:x,getAngle:C,getPixelOffset:M,billboard:se,sizeScale:ue*i,sizeUnits:xe,sizeMinPixels:je*i,sizeMaxPixels:ne*i,transitions:Ee&&{getPosition:Ee.getPosition,getAngle:Ee.getAngle,getColor:Ee.getColor,getSize:Ee.getSize,getPixelOffset:Ee.getPixelOffset}},this.getSubLayerProps({id:"characters",updateTriggers:{all:ke.getText,getPosition:ke.getPosition,getAngle:ke.getAngle,getColor:ke.getColor,getSize:ke.getSize,getPixelOffset:ke.getPixelOffset,getIconOffsets:{getTextAnchor:ke.getTextAnchor,getAlignmentBaseline:ke.getAlignmentBaseline,styleVersion:l}}}),{data:h,_dataDiff:p,startIndices:e,numInstances:t,getIconOffsets:this.getIconOffsets,getIcon:r})]}static set fontAtlasCacheLimit(e){jJ(e)}}Y(CC,"defaultProps",WJ),Y(CC,"layerName","TextLayer");function AC(n){const{children:e}=n;return e&&e.length>0}function a_(n){const{zoom:e}=n;return e!==void 0}function IC(n){return n&&!!n.aggregate}var Wp;(function(n){n.ALL="ALL",n.INCOMING="INCOMING",n.OUTGOING="OUTGOING",n.BETWEEN="BETWEEN"})(Wp||(Wp={}));function Vi(n){for(var e=n.length/6|0,t=new Array(e),r=0;r<e;)t[r]="#"+n.slice(r*6,++r*6);return t}function Yp(n,e,t){n.prototype=e.prototype=t,t.constructor=n}function s_(n,e){var t=Object.create(n.prototype);for(var r in e)t[r]=e[r];return t}function Qu(){}var kd=.7,Kp=1/kd,Zp="\\s*([+-]?\\d+)\\s*",c_="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",$c="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",YJ=/^#([0-9a-f]{3,8})$/,KJ=new RegExp(`^rgb\\(${Zp},${Zp},${Zp}\\)$`),ZJ=new RegExp(`^rgb\\(${$c},${$c},${$c}\\)$`),XJ=new RegExp(`^rgba\\(${Zp},${Zp},${Zp},${c_}\\)$`),QJ=new RegExp(`^rgba\\(${$c},${$c},${$c},${c_}\\)$`),JJ=new RegExp(`^hsl\\(${c_},${$c},${$c}\\)$`),eee=new RegExp(`^hsla\\(${c_},${$c},${$c},${c_}\\)$`),mD={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};Yp(Qu,Od,{copy(n){return Object.assign(new this.constructor,this,n)},displayable(){return this.rgb().displayable()},hex:yD,formatHex:yD,formatHex8:tee,formatHsl:nee,formatRgb:_D,toString:_D});function yD(){return this.rgb().formatHex()}function tee(){return this.rgb().formatHex8()}function nee(){return ED(this).formatHsl()}function _D(){return this.rgb().formatRgb()}function Od(n){var e,t;return n=(n+"").trim().toLowerCase(),(e=YJ.exec(n))?(t=e[1].length,e=parseInt(e[1],16),t===6?vD(e):t===3?new Ao(e>>8&15|e>>4&240,e>>4&15|e&240,(e&15)<<4|e&15,1):t===8?g1(e>>24&255,e>>16&255,e>>8&255,(e&255)/255):t===4?g1(e>>12&15|e>>8&240,e>>8&15|e>>4&240,e>>4&15|e&240,((e&15)<<4|e&15)/255):null):(e=KJ.exec(n))?new Ao(e[1],e[2],e[3],1):(e=ZJ.exec(n))?new Ao(e[1]*255/100,e[2]*255/100,e[3]*255/100,1):(e=XJ.exec(n))?g1(e[1],e[2],e[3],e[4]):(e=QJ.exec(n))?g1(e[1]*255/100,e[2]*255/100,e[3]*255/100,e[4]):(e=JJ.exec(n))?xD(e[1],e[2]/100,e[3]/100,1):(e=eee.exec(n))?xD(e[1],e[2]/100,e[3]/100,e[4]):mD.hasOwnProperty(n)?vD(mD[n]):n==="transparent"?new Ao(NaN,NaN,NaN,0):null}function vD(n){return new Ao(n>>16&255,n>>8&255,n&255,1)}function g1(n,e,t,r){return r<=0&&(n=e=t=NaN),new Ao(n,e,t,r)}function PC(n){return n instanceof Qu||(n=Od(n)),n?(n=n.rgb(),new Ao(n.r,n.g,n.b,n.opacity)):new Ao}function l_(n,e,t,r){return arguments.length===1?PC(n):new Ao(n,e,t,r??1)}function Ao(n,e,t,r){this.r=+n,this.g=+e,this.b=+t,this.opacity=+r}Yp(Ao,l_,s_(Qu,{brighter(n){return n=n==null?Kp:Math.pow(Kp,n),new Ao(this.r*n,this.g*n,this.b*n,this.opacity)},darker(n){return n=n==null?kd:Math.pow(kd,n),new Ao(this.r*n,this.g*n,this.b*n,this.opacity)},rgb(){return this},clamp(){return new Ao(Ld(this.r),Ld(this.g),Ld(this.b),m1(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:bD,formatHex:bD,formatHex8:ree,formatRgb:wD,toString:wD}));function bD(){return`#${Nd(this.r)}${Nd(this.g)}${Nd(this.b)}`}function ree(){return`#${Nd(this.r)}${Nd(this.g)}${Nd(this.b)}${Nd((isNaN(this.opacity)?1:this.opacity)*255)}`}function wD(){const n=m1(this.opacity);return`${n===1?"rgb(":"rgba("}${Ld(this.r)}, ${Ld(this.g)}, ${Ld(this.b)}${n===1?")":`, ${n})`}`}function m1(n){return isNaN(n)?1:Math.max(0,Math.min(1,n))}function Ld(n){return Math.max(0,Math.min(255,Math.round(n)||0))}function Nd(n){return n=Ld(n),(n<16?"0":"")+n.toString(16)}function xD(n,e,t,r){return r<=0?n=e=t=NaN:t<=0||t>=1?n=e=NaN:e<=0&&(n=NaN),new mc(n,e,t,r)}function ED(n){if(n instanceof mc)return new mc(n.h,n.s,n.l,n.opacity);if(n instanceof Qu||(n=Od(n)),!n)return new mc;if(n instanceof mc)return n;n=n.rgb();var e=n.r/255,t=n.g/255,r=n.b/255,i=Math.min(e,t,r),o=Math.max(e,t,r),a=NaN,l=o-i,h=(o+i)/2;return l?(e===o?a=(t-r)/l+(t<r)*6:t===o?a=(r-e)/l+2:a=(e-t)/l+4,l/=h<.5?o+i:2-o-i,a*=60):l=h>0&&h<1?0:a,new mc(a,l,h,n.opacity)}function iee(n,e,t,r){return arguments.length===1?ED(n):new mc(n,e,t,r??1)}function mc(n,e,t,r){this.h=+n,this.s=+e,this.l=+t,this.opacity=+r}Yp(mc,iee,s_(Qu,{brighter(n){return n=n==null?Kp:Math.pow(Kp,n),new mc(this.h,this.s,this.l*n,this.opacity)},darker(n){return n=n==null?kd:Math.pow(kd,n),new mc(this.h,this.s,this.l*n,this.opacity)},rgb(){var n=this.h%360+(this.h<0)*360,e=isNaN(n)||isNaN(this.s)?0:this.s,t=this.l,r=t+(t<.5?t:1-t)*e,i=2*t-r;return new Ao(MC(n>=240?n-240:n+120,i,r),MC(n,i,r),MC(n<120?n+240:n-120,i,r),this.opacity)},clamp(){return new mc(TD(this.h),y1(this.s),y1(this.l),m1(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const n=m1(this.opacity);return`${n===1?"hsl(":"hsla("}${TD(this.h)}, ${y1(this.s)*100}%, ${y1(this.l)*100}%${n===1?")":`, ${n})`}`}}));function TD(n){return n=(n||0)%360,n<0?n+360:n}function y1(n){return Math.max(0,Math.min(1,n||0))}function MC(n,e,t){return(n<60?e+(t-e)*n/60:n<180?t:n<240?e+(t-e)*(240-n)/60:e)*255}const SD=Math.PI/180,CD=180/Math.PI,_1=18,AD=.96422,ID=1,PD=.82521,MD=4/29,Xp=6/29,RD=3*Xp*Xp,oee=Xp*Xp*Xp;function kD(n){if(n instanceof Wc)return new Wc(n.l,n.a,n.b,n.opacity);if(n instanceof Hl)return OD(n);n instanceof Ao||(n=PC(n));var e=LC(n.r),t=LC(n.g),r=LC(n.b),i=RC((.2225045*e+.7168786*t+.0606169*r)/ID),o,a;return e===t&&t===r?o=a=i:(o=RC((.4360747*e+.3850649*t+.1430804*r)/AD),a=RC((.0139322*e+.0971045*t+.7141733*r)/PD)),new Wc(116*i-16,500*(o-i),200*(i-a),n.opacity)}function aee(n,e,t,r){return arguments.length===1?kD(n):new Wc(n,e,t,r??1)}function Wc(n,e,t,r){this.l=+n,this.a=+e,this.b=+t,this.opacity=+r}Yp(Wc,aee,s_(Qu,{brighter(n){return new Wc(this.l+_1*(n??1),this.a,this.b,this.opacity)},darker(n){return new Wc(this.l-_1*(n??1),this.a,this.b,this.opacity)},rgb(){var n=(this.l+16)/116,e=isNaN(this.a)?n:n+this.a/500,t=isNaN(this.b)?n:n-this.b/200;return e=AD*kC(e),n=ID*kC(n),t=PD*kC(t),new Ao(OC(3.1338561*e-1.6168667*n-.4906146*t),OC(-.9787684*e+1.9161415*n+.033454*t),OC(.0719453*e-.2289914*n+1.4052427*t),this.opacity)}}));function RC(n){return n>oee?Math.pow(n,1/3):n/RD+MD}function kC(n){return n>Xp?n*n*n:RD*(n-MD)}function OC(n){return 255*(n<=.0031308?12.92*n:1.055*Math.pow(n,1/2.4)-.055)}function LC(n){return(n/=255)<=.04045?n/12.92:Math.pow((n+.055)/1.055,2.4)}function see(n){if(n instanceof Hl)return new Hl(n.h,n.c,n.l,n.opacity);if(n instanceof Wc||(n=kD(n)),n.a===0&&n.b===0)return new Hl(NaN,0<n.l&&n.l<100?0:NaN,n.l,n.opacity);var e=Math.atan2(n.b,n.a)*CD;return new Hl(e<0?e+360:e,Math.sqrt(n.a*n.a+n.b*n.b),n.l,n.opacity)}function v1(n,e,t,r){return arguments.length===1?see(n):new Hl(n,e,t,r??1)}function Hl(n,e,t,r){this.h=+n,this.c=+e,this.l=+t,this.opacity=+r}function OD(n){if(isNaN(n.h))return new Wc(n.l,0,0,n.opacity);var e=n.h*SD;return new Wc(n.l,Math.cos(e)*n.c,Math.sin(e)*n.c,n.opacity)}Yp(Hl,v1,s_(Qu,{brighter(n){return new Hl(this.h,this.c,this.l+_1*(n??1),this.opacity)},darker(n){return new Hl(this.h,this.c,this.l-_1*(n??1),this.opacity)},rgb(){return OD(this).rgb()}}));var LD=-.14861,NC=1.78277,DC=-.29227,b1=-.90649,u_=1.97294,ND=u_*b1,DD=u_*NC,FD=NC*DC-b1*LD;function cee(n){if(n instanceof Dd)return new Dd(n.h,n.s,n.l,n.opacity);n instanceof Ao||(n=PC(n));var e=n.r/255,t=n.g/255,r=n.b/255,i=(FD*r+ND*e-DD*t)/(FD+ND-DD),o=r-i,a=(u_*(t-i)-DC*o)/b1,l=Math.sqrt(a*a+o*o)/(u_*i*(1-i)),h=l?Math.atan2(a,o)*CD-120:NaN;return new Dd(h<0?h+360:h,l,i,n.opacity)}function Ju(n,e,t,r){return arguments.length===1?cee(n):new Dd(n,e,t,r??1)}function Dd(n,e,t,r){this.h=+n,this.s=+e,this.l=+t,this.opacity=+r}Yp(Dd,Ju,s_(Qu,{brighter(n){return n=n==null?Kp:Math.pow(Kp,n),new Dd(this.h,this.s,this.l*n,this.opacity)},darker(n){return n=n==null?kd:Math.pow(kd,n),new Dd(this.h,this.s,this.l*n,this.opacity)},rgb(){var n=isNaN(this.h)?0:(this.h+120)*SD,e=+this.l,t=isNaN(this.s)?0:this.s*e*(1-e),r=Math.cos(n),i=Math.sin(n);return new Ao(255*(e+t*(LD*r+NC*i)),255*(e+t*(DC*r+b1*i)),255*(e+t*(u_*r)),this.opacity)}}));function lee(n,e,t,r,i){var o=n*n,a=o*n;return((1-3*n+3*o-a)*e+(4-6*o+3*a)*t+(1+3*n+3*o-3*a)*r+a*i)/6}function BD(n){var e=n.length-1;return function(t){var r=t<=0?t=0:t>=1?(t=1,e-1):Math.floor(t*e),i=n[r],o=n[r+1],a=r>0?n[r-1]:2*i-o,l=r<e-1?n[r+2]:2*o-i;return lee((t-r/e)*e,a,i,o,l)}}const w1=n=>()=>n;function UD(n,e){return function(t){return n+t*e}}function uee(n,e,t){return n=Math.pow(n,t),e=Math.pow(e,t)-n,t=1/t,function(r){return Math.pow(n+r*e,t)}}function hee(n,e){var t=e-n;return t?UD(n,t>180||t<-180?t-360*Math.round(t/360):t):w1(isNaN(n)?e:n)}function dee(n){return(n=+n)==1?Qp:function(e,t){return t-e?uee(e,t,n):w1(isNaN(e)?t:e)}}function Qp(n,e){var t=e-n;return t?UD(n,t):w1(isNaN(n)?e:n)}const zD=function n(e){var t=dee(e);function r(i,o){var a=t((i=l_(i)).r,(o=l_(o)).r),l=t(i.g,o.g),h=t(i.b,o.b),p=Qp(i.opacity,o.opacity);return function(g){return i.r=a(g),i.g=l(g),i.b=h(g),i.opacity=p(g),i+""}}return r.gamma=n,r}(1);function fee(n){return function(e){var t=e.length,r=new Array(t),i=new Array(t),o=new Array(t),a,l;for(a=0;a<t;++a)l=l_(e[a]),r[a]=l.r||0,i[a]=l.g||0,o[a]=l.b||0;return r=n(r),i=n(i),o=n(o),l.opacity=1,function(h){return l.r=r(h),l.g=i(h),l.b=o(h),l+""}}}var jD=fee(BD);function pee(n,e){e||(e=[]);var t=n?Math.min(e.length,n.length):0,r=e.slice(),i;return function(o){for(i=0;i<t;++i)r[i]=n[i]*(1-o)+e[i]*o;return r}}function gee(n){return ArrayBuffer.isView(n)&&!(n instanceof DataView)}function mee(n,e){var t=e?e.length:0,r=n?Math.min(t,n.length):0,i=new Array(r),o=new Array(t),a;for(a=0;a<r;++a)i[a]=E1(n[a],e[a]);for(;a<t;++a)o[a]=e[a];return function(l){for(a=0;a<r;++a)o[a]=i[a](l);return o}}function yee(n,e){var t=new Date;return n=+n,e=+e,function(r){return t.setTime(n*(1-r)+e*r),t}}function x1(n,e){return n=+n,e=+e,function(t){return n*(1-t)+e*t}}function _ee(n,e){var t={},r={},i;(n===null||typeof n!="object")&&(n={}),(e===null||typeof e!="object")&&(e={});for(i in e)i in n?t[i]=E1(n[i],e[i]):r[i]=e[i];return function(o){for(i in t)r[i]=t[i](o);return r}}var FC=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,BC=new RegExp(FC.source,"g");function vee(n){return function(){return n}}function bee(n){return function(e){return n(e)+""}}function wee(n,e){var t=FC.lastIndex=BC.lastIndex=0,r,i,o,a=-1,l=[],h=[];for(n=n+"",e=e+"";(r=FC.exec(n))&&(i=BC.exec(e));)(o=i.index)>t&&(o=e.slice(t,o),l[a]?l[a]+=o:l[++a]=o),(r=r[0])===(i=i[0])?l[a]?l[a]+=i:l[++a]=i:(l[++a]=null,h.push({i:a,x:x1(r,i)})),t=BC.lastIndex;return t<e.length&&(o=e.slice(t),l[a]?l[a]+=o:l[++a]=o),l.length<2?h[0]?bee(h[0].x):vee(e):(e=h.length,function(p){for(var g=0,_;g<e;++g)l[(_=h[g]).i]=_.x(p);return l.join("")})}function E1(n,e){var t=typeof e,r;return e==null||t==="boolean"?w1(e):(t==="number"?x1:t==="string"?(r=Od(e))?(e=r,zD):wee:e instanceof Od?zD:e instanceof Date?yee:gee(e)?pee:Array.isArray(e)?mee:typeof e.valueOf!="function"&&typeof e.toString!="function"||isNaN(e)?_ee:x1)(n,e)}function VD(n,e){return n=+n,e=+e,function(t){return Math.round(n*(1-t)+e*t)}}function HD(n){return function e(t){t=+t;function r(i,o){var a=n((i=Ju(i)).h,(o=Ju(o)).h),l=Qp(i.s,o.s),h=Qp(i.l,o.l),p=Qp(i.opacity,o.opacity);return function(g){return i.h=a(g),i.s=l(g),i.l=h(Math.pow(g,t)),i.opacity=p(g),i+""}}return r.gamma=e,r}(1)}HD(hee);var GD=HD(Qp);const Io=n=>jD(n[n.length-1]);var qD=new Array(3).concat("e5f5f999d8c92ca25f","edf8fbb2e2e266c2a4238b45","edf8fbb2e2e266c2a42ca25f006d2c","edf8fbccece699d8c966c2a42ca25f006d2c","edf8fbccece699d8c966c2a441ae76238b45005824","f7fcfde5f5f9ccece699d8c966c2a441ae76238b45005824","f7fcfde5f5f9ccece699d8c966c2a441ae76238b45006d2c00441b").map(Vi);Io(qD);var $D=new Array(3).concat("e0ecf49ebcda8856a7","edf8fbb3cde38c96c688419d","edf8fbb3cde38c96c68856a7810f7c","edf8fbbfd3e69ebcda8c96c68856a7810f7c","edf8fbbfd3e69ebcda8c96c68c6bb188419d6e016b","f7fcfde0ecf4bfd3e69ebcda8c96c68c6bb188419d6e016b","f7fcfde0ecf4bfd3e69ebcda8c96c68c6bb188419d810f7c4d004b").map(Vi);Io($D);var WD=new Array(3).concat("e0f3dba8ddb543a2ca","f0f9e8bae4bc7bccc42b8cbe","f0f9e8bae4bc7bccc443a2ca0868ac","f0f9e8ccebc5a8ddb57bccc443a2ca0868ac","f0f9e8ccebc5a8ddb57bccc44eb3d32b8cbe08589e","f7fcf0e0f3dbccebc5a8ddb57bccc44eb3d32b8cbe08589e","f7fcf0e0f3dbccebc5a8ddb57bccc44eb3d32b8cbe0868ac084081").map(Vi);Io(WD);var YD=new Array(3).concat("fee8c8fdbb84e34a33","fef0d9fdcc8afc8d59d7301f","fef0d9fdcc8afc8d59e34a33b30000","fef0d9fdd49efdbb84fc8d59e34a33b30000","fef0d9fdd49efdbb84fc8d59ef6548d7301f990000","fff7ecfee8c8fdd49efdbb84fc8d59ef6548d7301f990000","fff7ecfee8c8fdd49efdbb84fc8d59ef6548d7301fb300007f0000").map(Vi);Io(YD);var KD=new Array(3).concat("ece2f0a6bddb1c9099","f6eff7bdc9e167a9cf02818a","f6eff7bdc9e167a9cf1c9099016c59","f6eff7d0d1e6a6bddb67a9cf1c9099016c59","f6eff7d0d1e6a6bddb67a9cf3690c002818a016450","fff7fbece2f0d0d1e6a6bddb67a9cf3690c002818a016450","fff7fbece2f0d0d1e6a6bddb67a9cf3690c002818a016c59014636").map(Vi);Io(KD);var ZD=new Array(3).concat("ece7f2a6bddb2b8cbe","f1eef6bdc9e174a9cf0570b0","f1eef6bdc9e174a9cf2b8cbe045a8d","f1eef6d0d1e6a6bddb74a9cf2b8cbe045a8d","f1eef6d0d1e6a6bddb74a9cf3690c00570b0034e7b","fff7fbece7f2d0d1e6a6bddb74a9cf3690c00570b0034e7b","fff7fbece7f2d0d1e6a6bddb74a9cf3690c00570b0045a8d023858").map(Vi);Io(ZD);var XD=new Array(3).concat("e7e1efc994c7dd1c77","f1eef6d7b5d8df65b0ce1256","f1eef6d7b5d8df65b0dd1c77980043","f1eef6d4b9dac994c7df65b0dd1c77980043","f1eef6d4b9dac994c7df65b0e7298ace125691003f","f7f4f9e7e1efd4b9dac994c7df65b0e7298ace125691003f","f7f4f9e7e1efd4b9dac994c7df65b0e7298ace125698004367001f").map(Vi);Io(XD);var QD=new Array(3).concat("fde0ddfa9fb5c51b8a","feebe2fbb4b9f768a1ae017e","feebe2fbb4b9f768a1c51b8a7a0177","feebe2fcc5c0fa9fb5f768a1c51b8a7a0177","feebe2fcc5c0fa9fb5f768a1dd3497ae017e7a0177","fff7f3fde0ddfcc5c0fa9fb5f768a1dd3497ae017e7a0177","fff7f3fde0ddfcc5c0fa9fb5f768a1dd3497ae017e7a017749006a").map(Vi);Io(QD);var JD=new Array(3).concat("edf8b17fcdbb2c7fb8","ffffcca1dab441b6c4225ea8","ffffcca1dab441b6c42c7fb8253494","ffffccc7e9b47fcdbb41b6c42c7fb8253494","ffffccc7e9b47fcdbb41b6c41d91c0225ea80c2c84","ffffd9edf8b1c7e9b47fcdbb41b6c41d91c0225ea80c2c84","ffffd9edf8b1c7e9b47fcdbb41b6c41d91c0225ea8253494081d58").map(Vi);Io(JD);var e3=new Array(3).concat("f7fcb9addd8e31a354","ffffccc2e69978c679238443","ffffccc2e69978c67931a354006837","ffffccd9f0a3addd8e78c67931a354006837","ffffccd9f0a3addd8e78c67941ab5d238443005a32","ffffe5f7fcb9d9f0a3addd8e78c67941ab5d238443005a32","ffffe5f7fcb9d9f0a3addd8e78c67941ab5d238443006837004529").map(Vi);Io(e3);var t3=new Array(3).concat("fff7bcfec44fd95f0e","ffffd4fed98efe9929cc4c02","ffffd4fed98efe9929d95f0e993404","ffffd4fee391fec44ffe9929d95f0e993404","ffffd4fee391fec44ffe9929ec7014cc4c028c2d04","ffffe5fff7bcfee391fec44ffe9929ec7014cc4c028c2d04","ffffe5fff7bcfee391fec44ffe9929ec7014cc4c02993404662506").map(Vi);Io(t3);var n3=new Array(3).concat("ffeda0feb24cf03b20","ffffb2fecc5cfd8d3ce31a1c","ffffb2fecc5cfd8d3cf03b20bd0026","ffffb2fed976feb24cfd8d3cf03b20bd0026","ffffb2fed976feb24cfd8d3cfc4e2ae31a1cb10026","ffffccffeda0fed976feb24cfd8d3cfc4e2ae31a1cb10026","ffffccffeda0fed976feb24cfd8d3cfc4e2ae31a1cbd0026800026").map(Vi);Io(n3);var r3=new Array(3).concat("deebf79ecae13182bd","eff3ffbdd7e76baed62171b5","eff3ffbdd7e76baed63182bd08519c","eff3ffc6dbef9ecae16baed63182bd08519c","eff3ffc6dbef9ecae16baed64292c62171b5084594","f7fbffdeebf7c6dbef9ecae16baed64292c62171b5084594","f7fbffdeebf7c6dbef9ecae16baed64292c62171b508519c08306b").map(Vi);Io(r3);var i3=new Array(3).concat("e5f5e0a1d99b31a354","edf8e9bae4b374c476238b45","edf8e9bae4b374c47631a354006d2c","edf8e9c7e9c0a1d99b74c47631a354006d2c","edf8e9c7e9c0a1d99b74c47641ab5d238b45005a32","f7fcf5e5f5e0c7e9c0a1d99b74c47641ab5d238b45005a32","f7fcf5e5f5e0c7e9c0a1d99b74c47641ab5d238b45006d2c00441b").map(Vi);Io(i3);var o3=new Array(3).concat("f0f0f0bdbdbd636363","f7f7f7cccccc969696525252","f7f7f7cccccc969696636363252525","f7f7f7d9d9d9bdbdbd969696636363252525","f7f7f7d9d9d9bdbdbd969696737373525252252525","fffffff0f0f0d9d9d9bdbdbd969696737373525252252525","fffffff0f0f0d9d9d9bdbdbd969696737373525252252525000000").map(Vi);Io(o3);var a3=new Array(3).concat("efedf5bcbddc756bb1","f2f0f7cbc9e29e9ac86a51a3","f2f0f7cbc9e29e9ac8756bb154278f","f2f0f7dadaebbcbddc9e9ac8756bb154278f","f2f0f7dadaebbcbddc9e9ac8807dba6a51a34a1486","fcfbfdefedf5dadaebbcbddc9e9ac8807dba6a51a34a1486","fcfbfdefedf5dadaebbcbddc9e9ac8807dba6a51a354278f3f007d").map(Vi);Io(a3);var s3=new Array(3).concat("fee0d2fc9272de2d26","fee5d9fcae91fb6a4acb181d","fee5d9fcae91fb6a4ade2d26a50f15","fee5d9fcbba1fc9272fb6a4ade2d26a50f15","fee5d9fcbba1fc9272fb6a4aef3b2ccb181d99000d","fff5f0fee0d2fcbba1fc9272fb6a4aef3b2ccb181d99000d","fff5f0fee0d2fcbba1fc9272fb6a4aef3b2ccb181da50f1567000d").map(Vi);Io(s3);var c3=new Array(3).concat("fee6cefdae6be6550d","feeddefdbe85fd8d3cd94701","feeddefdbe85fd8d3ce6550da63603","feeddefdd0a2fdae6bfd8d3ce6550da63603","feeddefdd0a2fdae6bfd8d3cf16913d948018c2d04","fff5ebfee6cefdd0a2fdae6bfd8d3cf16913d948018c2d04","fff5ebfee6cefdd0a2fdae6bfd8d3cf16913d94801a636037f2704").map(Vi);Io(c3);var xee=GD(Ju(-100,.75,.35),Ju(80,1.5,.8)),Eee=GD(Ju(260,.75,.35),Ju(80,1.5,.8));Ju();function T1(n){var e=n.length;return function(t){return n[Math.max(0,Math.min(e-1,Math.floor(t*e)))]}}const Tee=T1(Vi("44015444025645045745055946075a46085c460a5d460b5e470d60470e6147106347116447136548146748166848176948186a481a6c481b6d481c6e481d6f481f70482071482173482374482475482576482677482878482979472a7a472c7a472d7b472e7c472f7d46307e46327e46337f463480453581453781453882443983443a83443b84433d84433e85423f854240864241864142874144874045884046883f47883f48893e49893e4a893e4c8a3d4d8a3d4e8a3c4f8a3c508b3b518b3b528b3a538b3a548c39558c39568c38588c38598c375a8c375b8d365c8d365d8d355e8d355f8d34608d34618d33628d33638d32648e32658e31668e31678e31688e30698e306a8e2f6b8e2f6c8e2e6d8e2e6e8e2e6f8e2d708e2d718e2c718e2c728e2c738e2b748e2b758e2a768e2a778e2a788e29798e297a8e297b8e287c8e287d8e277e8e277f8e27808e26818e26828e26828e25838e25848e25858e24868e24878e23888e23898e238a8d228b8d228c8d228d8d218e8d218f8d21908d21918c20928c20928c20938c1f948c1f958b1f968b1f978b1f988b1f998a1f9a8a1e9b8a1e9c891e9d891f9e891f9f881fa0881fa1881fa1871fa28720a38620a48621a58521a68522a78522a88423a98324aa8325ab8225ac8226ad8127ad8128ae8029af7f2ab07f2cb17e2db27d2eb37c2fb47c31b57b32b67a34b67935b77937b87838b9773aba763bbb753dbc743fbc7340bd7242be7144bf7046c06f48c16e4ac16d4cc26c4ec36b50c46a52c56954c56856c66758c7655ac8645cc8635ec96260ca6063cb5f65cb5e67cc5c69cd5b6ccd5a6ece5870cf5773d05675d05477d1537ad1517cd2507fd34e81d34d84d44b86d54989d5488bd6468ed64590d74393d74195d84098d83e9bd93c9dd93ba0da39a2da37a5db36a8db34aadc32addc30b0dd2fb2dd2db5de2bb8de29bade28bddf26c0df25c2df23c5e021c8e020cae11fcde11dd0e11cd2e21bd5e21ad8e219dae319dde318dfe318e2e418e5e419e7e419eae51aece51befe51cf1e51df4e61ef6e620f8e621fbe723fde725"));var See=T1(Vi("00000401000501010601010802010902020b02020d03030f03031204041405041606051806051a07061c08071e0907200a08220b09240c09260d0a290e0b2b100b2d110c2f120d31130d34140e36150e38160f3b180f3d19103f1a10421c10441d11471e114920114b21114e22115024125325125527125829115a2a115c2c115f2d11612f116331116533106734106936106b38106c390f6e3b0f703d0f713f0f72400f74420f75440f764510774710784910784a10794c117a4e117b4f127b51127c52137c54137d56147d57157e59157e5a167e5c167f5d177f5f187f601880621980641a80651a80671b80681c816a1c816b1d816d1d816e1e81701f81721f817320817521817621817822817922827b23827c23827e24828025828125818326818426818627818827818928818b29818c29818e2a81902a81912b81932b80942c80962c80982d80992d809b2e7f9c2e7f9e2f7fa02f7fa1307ea3307ea5317ea6317da8327daa337dab337cad347cae347bb0357bb2357bb3367ab5367ab73779b83779ba3878bc3978bd3977bf3a77c03a76c23b75c43c75c53c74c73d73c83e73ca3e72cc3f71cd4071cf4070d0416fd2426fd3436ed5446dd6456cd8456cd9466bdb476adc4869de4968df4a68e04c67e24d66e34e65e44f64e55064e75263e85362e95462ea5661eb5760ec5860ed5a5fee5b5eef5d5ef05f5ef1605df2625df2645cf3655cf4675cf4695cf56b5cf66c5cf66e5cf7705cf7725cf8745cf8765cf9785df9795df97b5dfa7d5efa7f5efa815ffb835ffb8560fb8761fc8961fc8a62fc8c63fc8e64fc9065fd9266fd9467fd9668fd9869fd9a6afd9b6bfe9d6cfe9f6dfea16efea36ffea571fea772fea973feaa74feac76feae77feb078feb27afeb47bfeb67cfeb77efeb97ffebb81febd82febf84fec185fec287fec488fec68afec88cfeca8dfecc8ffecd90fecf92fed194fed395fed597fed799fed89afdda9cfddc9efddea0fde0a1fde2a3fde3a5fde5a7fde7a9fde9aafdebacfcecaefceeb0fcf0b2fcf2b4fcf4b6fcf6b8fcf7b9fcf9bbfcfbbdfcfdbf")),Cee=T1(Vi("00000401000501010601010802010a02020c02020e03021004031204031405041706041907051b08051d09061f0a07220b07240c08260d08290e092b10092d110a30120a32140b34150b37160b39180c3c190c3e1b0c411c0c431e0c451f0c48210c4a230c4c240c4f260c51280b53290b552b0b572d0b592f0a5b310a5c320a5e340a5f3609613809623909633b09643d09653e0966400a67420a68440a68450a69470b6a490b6a4a0c6b4c0c6b4d0d6c4f0d6c510e6c520e6d540f6d550f6d57106e59106e5a116e5c126e5d126e5f136e61136e62146e64156e65156e67166e69166e6a176e6c186e6d186e6f196e71196e721a6e741a6e751b6e771c6d781c6d7a1d6d7c1d6d7d1e6d7f1e6c801f6c82206c84206b85216b87216b88226a8a226a8c23698d23698f24699025689225689326679526679727669827669a28659b29649d29649f2a63a02a63a22b62a32c61a52c60a62d60a82e5fa92e5eab2f5ead305dae305cb0315bb1325ab3325ab43359b63458b73557b93556ba3655bc3754bd3853bf3952c03a51c13a50c33b4fc43c4ec63d4dc73e4cc83f4bca404acb4149cc4248ce4347cf4446d04545d24644d34743d44842d54a41d74b3fd84c3ed94d3dda4e3cdb503bdd513ade5238df5337e05536e15635e25734e35933e45a31e55c30e65d2fe75e2ee8602de9612bea632aeb6429eb6628ec6726ed6925ee6a24ef6c23ef6e21f06f20f1711ff1731df2741cf3761bf37819f47918f57b17f57d15f67e14f68013f78212f78410f8850ff8870ef8890cf98b0bf98c0af98e09fa9008fa9207fa9407fb9606fb9706fb9906fb9b06fb9d07fc9f07fca108fca309fca50afca60cfca80dfcaa0ffcac11fcae12fcb014fcb216fcb418fbb61afbb81dfbba1ffbbc21fbbe23fac026fac228fac42afac62df9c72ff9c932f9cb35f8cd37f8cf3af7d13df7d340f6d543f6d746f5d949f5db4cf4dd4ff4df53f4e156f3e35af3e55df2e661f2e865f2ea69f1ec6df1ed71f1ef75f1f179f2f27df2f482f3f586f3f68af4f88ef5f992f6fa96f8fb9af9fc9dfafda1fcffa4")),Aee=T1(Vi("0d088710078813078916078a19068c1b068d1d068e20068f2206902406912605912805922a05932c05942e05952f059631059733059735049837049938049a3a049a3c049b3e049c3f049c41049d43039e44039e46039f48039f4903a04b03a14c02a14e02a25002a25102a35302a35502a45601a45801a45901a55b01a55c01a65e01a66001a66100a76300a76400a76600a76700a86900a86a00a86c00a86e00a86f00a87100a87201a87401a87501a87701a87801a87a02a87b02a87d03a87e03a88004a88104a78305a78405a78606a68707a68808a68a09a58b0aa58d0ba58e0ca48f0da4910ea3920fa39410a29511a19613a19814a099159f9a169f9c179e9d189d9e199da01a9ca11b9ba21d9aa31e9aa51f99a62098a72197a82296aa2395ab2494ac2694ad2793ae2892b02991b12a90b22b8fb32c8eb42e8db52f8cb6308bb7318ab83289ba3388bb3488bc3587bd3786be3885bf3984c03a83c13b82c23c81c33d80c43e7fc5407ec6417dc7427cc8437bc9447aca457acb4679cc4778cc4977cd4a76ce4b75cf4c74d04d73d14e72d24f71d35171d45270d5536fd5546ed6556dd7566cd8576bd9586ada5a6ada5b69db5c68dc5d67dd5e66de5f65de6164df6263e06363e16462e26561e26660e3685fe4695ee56a5de56b5de66c5ce76e5be76f5ae87059e97158e97257ea7457eb7556eb7655ec7754ed7953ed7a52ee7b51ef7c51ef7e50f07f4ff0804ef1814df1834cf2844bf3854bf3874af48849f48948f58b47f58c46f68d45f68f44f79044f79143f79342f89441f89540f9973ff9983ef99a3efa9b3dfa9c3cfa9e3bfb9f3afba139fba238fca338fca537fca636fca835fca934fdab33fdac33fdae32fdaf31fdb130fdb22ffdb42ffdb52efeb72dfeb82cfeba2cfebb2bfebd2afebe2afec029fdc229fdc328fdc527fdc627fdc827fdca26fdcb26fccd25fcce25fcd025fcd225fbd324fbd524fbd724fad824fada24f9dc24f9dd25f8df25f8e125f7e225f7e425f6e626f6e826f5e926f5eb27f4ed27f3ee27f3f027f2f227f1f426f1f525f0f724f0f921"));function Jp(n,e){return n==null||e==null?NaN:n<e?-1:n>e?1:n>=e?0:NaN}function S1(n,e){return n==null||e==null?NaN:e<n?-1:e>n?1:e>=n?0:NaN}function l3(n){let e,t,r;n.length!==2?(e=Jp,t=(l,h)=>Jp(n(l),h),r=(l,h)=>n(l)-h):(e=n===Jp||n===S1?n:Iee,t=n,r=n);function i(l,h,p=0,g=l.length){if(p<g){if(e(h,h)!==0)return g;do{const _=p+g>>>1;t(l[_],h)<0?p=_+1:g=_}while(p<g)}return p}function o(l,h,p=0,g=l.length){if(p<g){if(e(h,h)!==0)return g;do{const _=p+g>>>1;t(l[_],h)<=0?p=_+1:g=_}while(p<g)}return p}function a(l,h,p=0,g=l.length){const _=i(l,h,p,g-1);return _>p&&r(l[_-1],h)>-r(l[_],h)?_-1:_}return{left:i,center:a,right:o}}function Iee(){return 0}function Pee(n){return n===null?NaN:+n}const u3=l3(Jp),Mee=u3.right,Ree=u3.left;l3(Pee).center;function UC(n,e){let t,r;if(e===void 0)for(const i of n)i!=null&&(t===void 0?i>=i&&(t=r=i):(t>i&&(t=i),r<i&&(r=i)));else{let i=-1;for(let o of n)(o=e(o,++i,n))!=null&&(t===void 0?o>=o&&(t=r=o):(t>o&&(t=o),r<o&&(r=o)))}return[t,r]}class C1{constructor(){this._partials=new Float64Array(32),this._n=0}add(e){const t=this._partials;let r=0;for(let i=0;i<this._n&&i<32;i++){const o=t[i],a=e+o,l=Math.abs(e)<Math.abs(o)?e-(a-o):o-(a-e);l&&(t[r++]=l),e=a}return t[r]=e,this._n=r+1,this}valueOf(){const e=this._partials;let t=this._n,r,i,o,a=0;if(t>0){for(a=e[--t];t>0&&(r=a,i=e[--t],a=r+i,o=i-(a-r),!o););t>0&&(o<0&&e[t-1]<0||o>0&&e[t-1]>0)&&(i=o*2,r=a+i,i==r-a&&(a=r))}return a}}class kee extends Map{constructor(e,t=Nee){if(super(),Object.defineProperties(this,{_intern:{value:new Map},_key:{value:t}}),e!=null)for(const[r,i]of e)this.set(r,i)}get(e){return super.get(h3(this,e))}has(e){return super.has(h3(this,e))}set(e,t){return super.set(Oee(this,e),t)}delete(e){return super.delete(Lee(this,e))}}function h3({_intern:n,_key:e},t){const r=e(t);return n.has(r)?n.get(r):t}function Oee({_intern:n,_key:e},t){const r=e(t);return n.has(r)?n.get(r):(n.set(r,t),t)}function Lee({_intern:n,_key:e},t){const r=e(t);return n.has(r)&&(t=n.get(r),n.delete(r)),t}function Nee(n){return n!==null&&typeof n=="object"?n.valueOf():n}function Dee(n){return n}function d3(n,e,...t){return Fee(n,Dee,e,t)}function Fee(n,e,t,r){return function i(o,a){if(a>=r.length)return t(o);const l=new kee,h=r[a++];let p=-1;for(const g of o){const _=h(g,++p,o),x=l.get(_);x?x.push(g):l.set(_,[g])}for(const[g,_]of l)l.set(g,i(_,a));return e(l)}(n,0)}const Bee=Math.sqrt(50),Uee=Math.sqrt(10),zee=Math.sqrt(2);function A1(n,e,t){const r=(e-n)/Math.max(0,t),i=Math.floor(Math.log10(r)),o=r/Math.pow(10,i),a=o>=Bee?10:o>=Uee?5:o>=zee?2:1;let l,h,p;return i<0?(p=Math.pow(10,-i)/a,l=Math.round(n*p),h=Math.round(e*p),l/p<n&&++l,h/p>e&&--h,p=-p):(p=Math.pow(10,i)*a,l=Math.round(n/p),h=Math.round(e/p),l*p<n&&++l,h*p>e&&--h),h<l&&.5<=t&&t<2?A1(n,e,t*2):[l,h,p]}function jee(n,e,t){if(e=+e,n=+n,t=+t,!(t>0))return[];if(n===e)return[n];const r=e<n,[i,o,a]=r?A1(e,n,t):A1(n,e,t);if(!(o>=i))return[];const l=o-i+1,h=new Array(l);if(r)if(a<0)for(let p=0;p<l;++p)h[p]=(o-p)/-a;else for(let p=0;p<l;++p)h[p]=(o-p)*a;else if(a<0)for(let p=0;p<l;++p)h[p]=(i+p)/-a;else for(let p=0;p<l;++p)h[p]=(i+p)*a;return h}function zC(n,e,t){return e=+e,n=+n,t=+t,A1(n,e,t)[2]}function Vee(n,e,t){e=+e,n=+n,t=+t;const r=e<n,i=r?zC(e,n,t):zC(n,e,t);return(r?-1:1)*(i<0?1/-i:i)}function f3(n,e){let t;if(e===void 0)for(const r of n)r!=null&&(t>r||t===void 0&&r>=r)&&(t=r);else{let r=-1;for(let i of n)(i=e(i,++r,n))!=null&&(t>i||t===void 0&&i>=i)&&(t=i)}return t}function p3(n,e,t){n=+n,e=+e,t=(i=arguments.length)<2?(e=n,n=0,1):i<3?1:+t;for(var r=-1,i=Math.max(0,Math.ceil((e-n)/t))|0,o=new Array(i);++r<i;)o[r]=n+r*t;return o}function g3(n,e){switch(arguments.length){case 0:break;case 1:this.range(n);break;default:this.range(e).domain(n);break}return this}function m3(n,e){switch(arguments.length){case 0:break;case 1:{typeof n=="function"?this.interpolator(n):this.range(n);break}default:{this.domain(n),typeof e=="function"?this.interpolator(e):this.range(e);break}}return this}function Hee(n){return function(){return n}}function Gee(n){return+n}var y3=[0,1];function Vs(n){return n}function jC(n,e){return(e-=n=+n)?function(t){return(t-n)/e}:Hee(isNaN(e)?NaN:.5)}function qee(n,e){var t;return n>e&&(t=n,n=e,e=t),function(r){return Math.max(n,Math.min(e,r))}}function $ee(n,e,t){var r=n[0],i=n[1],o=e[0],a=e[1];return i<r?(r=jC(i,r),o=t(a,o)):(r=jC(r,i),o=t(o,a)),function(l){return o(r(l))}}function Wee(n,e,t){var r=Math.min(n.length,e.length)-1,i=new Array(r),o=new Array(r),a=-1;for(n[r]<n[0]&&(n=n.slice().reverse(),e=e.slice().reverse());++a<r;)i[a]=jC(n[a],n[a+1]),o[a]=t(e[a],e[a+1]);return function(l){var h=Mee(n,l,1,r)-1;return o[h](i[h](l))}}function _3(n,e){return e.domain(n.domain()).range(n.range()).interpolate(n.interpolate()).clamp(n.clamp()).unknown(n.unknown())}function v3(){var n=y3,e=y3,t=E1,r,i,o,a=Vs,l,h,p;function g(){var x=Math.min(n.length,e.length);return a!==Vs&&(a=qee(n[0],n[x-1])),l=x>2?Wee:$ee,h=p=null,_}function _(x){return x==null||isNaN(x=+x)?o:(h||(h=l(n.map(r),e,t)))(r(a(x)))}return _.invert=function(x){return a(i((p||(p=l(e,n.map(r),x1)))(x)))},_.domain=function(x){return arguments.length?(n=Array.from(x,Gee),g()):n.slice()},_.range=function(x){return arguments.length?(e=Array.from(x),g()):e.slice()},_.rangeRound=function(x){return e=Array.from(x),t=VD,g()},_.clamp=function(x){return arguments.length?(a=x?!0:Vs,g()):a!==Vs},_.interpolate=function(x){return arguments.length?(t=x,g()):t},_.unknown=function(x){return arguments.length?(o=x,_):o},function(x,C){return r=x,i=C,g()}}function Yee(){return v3()(Vs,Vs)}function Kee(n){return Math.abs(n=Math.round(n))>=1e21?n.toLocaleString("en").replace(/,/g,""):n.toString(10)}function I1(n,e){if((t=(n=e?n.toExponential(e-1):n.toExponential()).indexOf("e"))<0)return null;var t,r=n.slice(0,t);return[r.length>1?r[0]+r.slice(2):r,+n.slice(t+1)]}function eg(n){return n=I1(Math.abs(n)),n?n[1]:NaN}function Zee(n,e){return function(t,r){for(var i=t.length,o=[],a=0,l=n[0],h=0;i>0&&l>0&&(h+l+1>r&&(l=Math.max(1,r-h)),o.push(t.substring(i-=l,i+l)),!((h+=l+1)>r));)l=n[a=(a+1)%n.length];return o.reverse().join(e)}}function Xee(n){return function(e){return e.replace(/[0-9]/g,function(t){return n[+t]})}}var Qee=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function P1(n){if(!(e=Qee.exec(n)))throw new Error("invalid format: "+n);var e;return new VC({fill:e[1],align:e[2],sign:e[3],symbol:e[4],zero:e[5],width:e[6],comma:e[7],precision:e[8]&&e[8].slice(1),trim:e[9],type:e[10]})}P1.prototype=VC.prototype;function VC(n){this.fill=n.fill===void 0?" ":n.fill+"",this.align=n.align===void 0?">":n.align+"",this.sign=n.sign===void 0?"-":n.sign+"",this.symbol=n.symbol===void 0?"":n.symbol+"",this.zero=!!n.zero,this.width=n.width===void 0?void 0:+n.width,this.comma=!!n.comma,this.precision=n.precision===void 0?void 0:+n.precision,this.trim=!!n.trim,this.type=n.type===void 0?"":n.type+""}VC.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function Jee(n){e:for(var e=n.length,t=1,r=-1,i;t<e;++t)switch(n[t]){case".":r=i=t;break;case"0":r===0&&(r=t),i=t;break;default:if(!+n[t])break e;r>0&&(r=0);break}return r>0?n.slice(0,r)+n.slice(i+1):n}var b3;function ete(n,e){var t=I1(n,e);if(!t)return n+"";var r=t[0],i=t[1],o=i-(b3=Math.max(-8,Math.min(8,Math.floor(i/3)))*3)+1,a=r.length;return o===a?r:o>a?r+new Array(o-a+1).join("0"):o>0?r.slice(0,o)+"."+r.slice(o):"0."+new Array(1-o).join("0")+I1(n,Math.max(0,e+o-1))[0]}function w3(n,e){var t=I1(n,e);if(!t)return n+"";var r=t[0],i=t[1];return i<0?"0."+new Array(-i).join("0")+r:r.length>i+1?r.slice(0,i+1)+"."+r.slice(i+1):r+new Array(i-r.length+2).join("0")}const x3={"%":(n,e)=>(n*100).toFixed(e),b:n=>Math.round(n).toString(2),c:n=>n+"",d:Kee,e:(n,e)=>n.toExponential(e),f:(n,e)=>n.toFixed(e),g:(n,e)=>n.toPrecision(e),o:n=>Math.round(n).toString(8),p:(n,e)=>w3(n*100,e),r:w3,s:ete,X:n=>Math.round(n).toString(16).toUpperCase(),x:n=>Math.round(n).toString(16)};function E3(n){return n}var T3=Array.prototype.map,S3=["y","z","a","f","p","n","µ","m","","k","M","G","T","P","E","Z","Y"];function tte(n){var e=n.grouping===void 0||n.thousands===void 0?E3:Zee(T3.call(n.grouping,Number),n.thousands+""),t=n.currency===void 0?"":n.currency[0]+"",r=n.currency===void 0?"":n.currency[1]+"",i=n.decimal===void 0?".":n.decimal+"",o=n.numerals===void 0?E3:Xee(T3.call(n.numerals,String)),a=n.percent===void 0?"%":n.percent+"",l=n.minus===void 0?"−":n.minus+"",h=n.nan===void 0?"NaN":n.nan+"";function p(_){_=P1(_);var x=_.fill,C=_.align,M=_.sign,L=_.symbol,F=_.zero,z=_.width,ee=_.comma,ce=_.precision,se=_.trim,_e=_.type;_e==="n"?(ee=!0,_e="g"):x3[_e]||(ce===void 0&&(ce=12),se=!0,_e="g"),(F||x==="0"&&C==="=")&&(F=!0,x="0",C="=");var J=L==="$"?t:L==="#"&&/[boxX]/.test(_e)?"0"+_e.toLowerCase():"",pe=L==="$"?r:/[%p]/.test(_e)?a:"",ue=x3[_e],xe=/[defgprs%]/.test(_e);ce=ce===void 0?6:/[gprs]/.test(_e)?Math.max(1,Math.min(21,ce)):Math.max(0,Math.min(20,ce));function je(ne){var Ee=J,ke=pe,Be,Ze,at;if(_e==="c")ke=ue(ne)+ke,ne="";else{ne=+ne;var Re=ne<0||1/ne<0;if(ne=isNaN(ne)?h:ue(Math.abs(ne),ce),se&&(ne=Jee(ne)),Re&&+ne==0&&M!=="+"&&(Re=!1),Ee=(Re?M==="("?M:l:M==="-"||M==="("?"":M)+Ee,ke=(_e==="s"?S3[8+b3/3]:"")+ke+(Re&&M==="("?")":""),xe){for(Be=-1,Ze=ne.length;++Be<Ze;)if(at=ne.charCodeAt(Be),48>at||at>57){ke=(at===46?i+ne.slice(Be+1):ne.slice(Be))+ke,ne=ne.slice(0,Be);break}}}ee&&!F&&(ne=e(ne,1/0));var ht=Ee.length+ne.length+ke.length,Rt=ht<z?new Array(z-ht+1).join(x):"";switch(ee&&F&&(ne=e(Rt+ne,Rt.length?z-ke.length:1/0),Rt=""),C){case"<":ne=Ee+ne+ke+Rt;break;case"=":ne=Ee+Rt+ne+ke;break;case"^":ne=Rt.slice(0,ht=Rt.length>>1)+Ee+ne+ke+Rt.slice(ht);break;default:ne=Rt+Ee+ne+ke;break}return o(ne)}return je.toString=function(){return _+""},je}function g(_,x){var C=p((_=P1(_),_.type="f",_)),M=Math.max(-8,Math.min(8,Math.floor(eg(x)/3)))*3,L=Math.pow(10,-M),F=S3[8+M/3];return function(z){return C(L*z)+F}}return{format:p,formatPrefix:g}}var M1,C3,A3;nte({thousands:",",grouping:[3],currency:["$",""]});function nte(n){return M1=tte(n),C3=M1.format,A3=M1.formatPrefix,M1}function rte(n){return Math.max(0,-eg(Math.abs(n)))}function ite(n,e){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(eg(e)/3)))*3-eg(Math.abs(n)))}function ote(n,e){return n=Math.abs(n),e=Math.abs(e)-n,Math.max(0,eg(e)-eg(n))+1}function ate(n,e,t,r){var i=Vee(n,e,t),o;switch(r=P1(r??",f"),r.type){case"s":{var a=Math.max(Math.abs(n),Math.abs(e));return r.precision==null&&!isNaN(o=ite(i,a))&&(r.precision=o),A3(r,a)}case"":case"e":case"g":case"p":case"r":{r.precision==null&&!isNaN(o=ote(i,Math.max(Math.abs(n),Math.abs(e))))&&(r.precision=o-(r.type==="e"));break}case"f":case"%":{r.precision==null&&!isNaN(o=rte(i))&&(r.precision=o-(r.type==="%")*2);break}}return C3(r)}function HC(n){var e=n.domain;return n.ticks=function(t){var r=e();return jee(r[0],r[r.length-1],t??10)},n.tickFormat=function(t,r){var i=e();return ate(i[0],i[i.length-1],t??10,r)},n.nice=function(t){t==null&&(t=10);var r=e(),i=0,o=r.length-1,a=r[i],l=r[o],h,p,g=10;for(l<a&&(p=a,a=l,l=p,p=i,i=o,o=p);g-- >0;){if(p=zC(a,l,t),p===h)return r[i]=a,r[o]=l,e(r);if(p>0)a=Math.floor(a/p)*p,l=Math.ceil(l/p)*p;else if(p<0)a=Math.ceil(a*p)/p,l=Math.floor(l*p)/p;else break;h=p}return n},n}function I3(){var n=Yee();return n.copy=function(){return _3(n,I3())},g3.apply(n,arguments),HC(n)}function P3(n){return function(e){return e<0?-Math.pow(-e,n):Math.pow(e,n)}}function ste(n){return n<0?-Math.sqrt(-n):Math.sqrt(n)}function cte(n){return n<0?-n*n:n*n}function M3(n){var e=n(Vs,Vs),t=1;function r(){return t===1?n(Vs,Vs):t===.5?n(ste,cte):n(P3(t),P3(1/t))}return e.exponent=function(i){return arguments.length?(t=+i,r()):t},HC(e)}function GC(){var n=M3(v3());return n.copy=function(){return _3(n,GC()).exponent(n.exponent())},g3.apply(n,arguments),n}function lte(){return GC.apply(null,arguments).exponent(.5)}const qC=new Date,$C=new Date;function Ho(n,e,t,r){function i(o){return n(o=arguments.length===0?new Date:new Date(+o)),o}return i.floor=o=>(n(o=new Date(+o)),o),i.ceil=o=>(n(o=new Date(o-1)),e(o,1),n(o),o),i.round=o=>{const a=i(o),l=i.ceil(o);return o-a<l-o?a:l},i.offset=(o,a)=>(e(o=new Date(+o),a==null?1:Math.floor(a)),o),i.range=(o,a,l)=>{const h=[];if(o=i.ceil(o),l=l==null?1:Math.floor(l),!(o<a)||!(l>0))return h;let p;do h.push(p=new Date(+o)),e(o,l),n(o);while(p<o&&o<a);return h},i.filter=o=>Ho(a=>{if(a>=a)for(;n(a),!o(a);)a.setTime(a-1)},(a,l)=>{if(a>=a)if(l<0)for(;++l<=0;)for(;e(a,-1),!o(a););else for(;--l>=0;)for(;e(a,1),!o(a););}),t&&(i.count=(o,a)=>(qC.setTime(+o),$C.setTime(+a),n(qC),n($C),Math.floor(t(qC,$C))),i.every=o=>(o=Math.floor(o),!isFinite(o)||!(o>0)?null:o>1?i.filter(r?a=>r(a)%o===0:a=>i.count(0,a)%o===0):i)),i}const h_=1e3,eh=h_*60,d_=eh*60,f_=d_*24,R3=f_*7,k3=Ho(n=>{n.setTime(n-n.getMilliseconds())},(n,e)=>{n.setTime(+n+e*h_)},(n,e)=>(e-n)/h_,n=>n.getUTCSeconds());k3.range;const O3=Ho(n=>{n.setTime(n-n.getMilliseconds()-n.getSeconds()*h_)},(n,e)=>{n.setTime(+n+e*eh)},(n,e)=>(e-n)/eh,n=>n.getMinutes());O3.range,Ho(n=>{n.setUTCSeconds(0,0)},(n,e)=>{n.setTime(+n+e*eh)},(n,e)=>(e-n)/eh,n=>n.getUTCMinutes()).range;const L3=Ho(n=>{n.setTime(n-n.getMilliseconds()-n.getSeconds()*h_-n.getMinutes()*eh)},(n,e)=>{n.setTime(+n+e*d_)},(n,e)=>(e-n)/d_,n=>n.getHours());L3.range,Ho(n=>{n.setUTCMinutes(0,0,0)},(n,e)=>{n.setTime(+n+e*d_)},(n,e)=>(e-n)/d_,n=>n.getUTCHours()).range;const R1=Ho(n=>n.setHours(0,0,0,0),(n,e)=>n.setDate(n.getDate()+e),(n,e)=>(e-n-(e.getTimezoneOffset()-n.getTimezoneOffset())*eh)/f_,n=>n.getDate()-1);R1.range;const WC=Ho(n=>{n.setUTCHours(0,0,0,0)},(n,e)=>{n.setUTCDate(n.getUTCDate()+e)},(n,e)=>(e-n)/f_,n=>n.getUTCDate()-1);WC.range,Ho(n=>{n.setUTCHours(0,0,0,0)},(n,e)=>{n.setUTCDate(n.getUTCDate()+e)},(n,e)=>(e-n)/f_,n=>Math.floor(n/f_)).range;function Fd(n){return Ho(e=>{e.setDate(e.getDate()-(e.getDay()+7-n)%7),e.setHours(0,0,0,0)},(e,t)=>{e.setDate(e.getDate()+t*7)},(e,t)=>(t-e-(t.getTimezoneOffset()-e.getTimezoneOffset())*eh)/R3)}const N3=Fd(0),k1=Fd(1),ute=Fd(2),hte=Fd(3),tg=Fd(4),dte=Fd(5),fte=Fd(6);N3.range,k1.range,ute.range,hte.range,tg.range,dte.range,fte.range;function Bd(n){return Ho(e=>{e.setUTCDate(e.getUTCDate()-(e.getUTCDay()+7-n)%7),e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCDate(e.getUTCDate()+t*7)},(e,t)=>(t-e)/R3)}const D3=Bd(0),O1=Bd(1),pte=Bd(2),gte=Bd(3),ng=Bd(4),mte=Bd(5),yte=Bd(6);D3.range,O1.range,pte.range,gte.range,ng.range,mte.range,yte.range;const F3=Ho(n=>{n.setDate(1),n.setHours(0,0,0,0)},(n,e)=>{n.setMonth(n.getMonth()+e)},(n,e)=>e.getMonth()-n.getMonth()+(e.getFullYear()-n.getFullYear())*12,n=>n.getMonth());F3.range,Ho(n=>{n.setUTCDate(1),n.setUTCHours(0,0,0,0)},(n,e)=>{n.setUTCMonth(n.getUTCMonth()+e)},(n,e)=>e.getUTCMonth()-n.getUTCMonth()+(e.getUTCFullYear()-n.getUTCFullYear())*12,n=>n.getUTCMonth()).range;const th=Ho(n=>{n.setMonth(0,1),n.setHours(0,0,0,0)},(n,e)=>{n.setFullYear(n.getFullYear()+e)},(n,e)=>e.getFullYear()-n.getFullYear(),n=>n.getFullYear());th.every=n=>!isFinite(n=Math.floor(n))||!(n>0)?null:Ho(e=>{e.setFullYear(Math.floor(e.getFullYear()/n)*n),e.setMonth(0,1),e.setHours(0,0,0,0)},(e,t)=>{e.setFullYear(e.getFullYear()+t*n)}),th.range;const Ud=Ho(n=>{n.setUTCMonth(0,1),n.setUTCHours(0,0,0,0)},(n,e)=>{n.setUTCFullYear(n.getUTCFullYear()+e)},(n,e)=>e.getUTCFullYear()-n.getUTCFullYear(),n=>n.getUTCFullYear());Ud.every=n=>!isFinite(n=Math.floor(n))||!(n>0)?null:Ho(e=>{e.setUTCFullYear(Math.floor(e.getUTCFullYear()/n)*n),e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCFullYear(e.getUTCFullYear()+t*n)}),Ud.range;function YC(n){if(0<=n.y&&n.y<100){var e=new Date(-1,n.m,n.d,n.H,n.M,n.S,n.L);return e.setFullYear(n.y),e}return new Date(n.y,n.m,n.d,n.H,n.M,n.S,n.L)}function KC(n){if(0<=n.y&&n.y<100){var e=new Date(Date.UTC(-1,n.m,n.d,n.H,n.M,n.S,n.L));return e.setUTCFullYear(n.y),e}return new Date(Date.UTC(n.y,n.m,n.d,n.H,n.M,n.S,n.L))}function p_(n,e,t){return{y:n,m:e,d:t,H:0,M:0,S:0,L:0}}function _te(n){var e=n.dateTime,t=n.date,r=n.time,i=n.periods,o=n.days,a=n.shortDays,l=n.months,h=n.shortMonths,p=g_(i),g=m_(i),_=g_(o),x=m_(o),C=g_(a),M=m_(a),L=g_(l),F=m_(l),z=g_(h),ee=m_(h),ce={a:Re,A:ht,b:Rt,B:dn,c:null,d:H3,e:H3,f:jte,g:Xte,G:Jte,H:Bte,I:Ute,j:zte,L:G3,m:Vte,M:Hte,p:wt,q:Ge,Q:Z3,s:X3,S:Gte,u:qte,U:$te,V:Wte,w:Yte,W:Kte,x:null,X:null,y:Zte,Y:Qte,Z:ene,"%":K3},se={a:qn,A:Qt,b:ln,B:Mn,c:null,d:$3,e:$3,f:ine,g:pne,G:mne,H:tne,I:nne,j:rne,L:W3,m:one,M:ane,p:Ot,q:En,Q:Z3,s:X3,S:sne,u:cne,U:lne,V:une,w:hne,W:dne,x:null,X:null,y:fne,Y:gne,Z:yne,"%":K3},_e={a:je,A:ne,b:Ee,B:ke,c:Be,d:j3,e:j3,f:Lte,g:z3,G:U3,H:V3,I:V3,j:Mte,L:Ote,m:Pte,M:Rte,p:xe,q:Ite,Q:Dte,s:Fte,S:kte,u:Ete,U:Tte,V:Ste,w:xte,W:Cte,x:Ze,X:at,y:z3,Y:U3,Z:Ate,"%":Nte};ce.x=J(t,ce),ce.X=J(r,ce),ce.c=J(e,ce),se.x=J(t,se),se.X=J(r,se),se.c=J(e,se);function J(lt,Pt){return function(he){var B=[],H=-1,D=0,Q=lt.length,ae,q,Ae;for(he instanceof Date||(he=new Date(+he));++H<Q;)lt.charCodeAt(H)===37&&(B.push(lt.slice(D,H)),(q=B3[ae=lt.charAt(++H)])!=null?ae=lt.charAt(++H):q=ae==="e"?" ":"0",(Ae=Pt[ae])&&(ae=Ae(he,q)),B.push(ae),D=H+1);return B.push(lt.slice(D,H)),B.join("")}}function pe(lt,Pt){return function(he){var B=p_(1900,void 0,1),H=ue(B,lt,he+="",0),D,Q;if(H!=he.length)return null;if("Q"in B)return new Date(B.Q);if("s"in B)return new Date(B.s*1e3+("L"in B?B.L:0));if(Pt&&!("Z"in B)&&(B.Z=0),"p"in B&&(B.H=B.H%12+B.p*12),B.m===void 0&&(B.m="q"in B?B.q:0),"V"in B){if(B.V<1||B.V>53)return null;"w"in B||(B.w=1),"Z"in B?(D=KC(p_(B.y,0,1)),Q=D.getUTCDay(),D=Q>4||Q===0?O1.ceil(D):O1(D),D=WC.offset(D,(B.V-1)*7),B.y=D.getUTCFullYear(),B.m=D.getUTCMonth(),B.d=D.getUTCDate()+(B.w+6)%7):(D=YC(p_(B.y,0,1)),Q=D.getDay(),D=Q>4||Q===0?k1.ceil(D):k1(D),D=R1.offset(D,(B.V-1)*7),B.y=D.getFullYear(),B.m=D.getMonth(),B.d=D.getDate()+(B.w+6)%7)}else("W"in B||"U"in B)&&("w"in B||(B.w="u"in B?B.u%7:"W"in B?1:0),Q="Z"in B?KC(p_(B.y,0,1)).getUTCDay():YC(p_(B.y,0,1)).getDay(),B.m=0,B.d="W"in B?(B.w+6)%7+B.W*7-(Q+5)%7:B.w+B.U*7-(Q+6)%7);return"Z"in B?(B.H+=B.Z/100|0,B.M+=B.Z%100,KC(B)):YC(B)}}function ue(lt,Pt,he,B){for(var H=0,D=Pt.length,Q=he.length,ae,q;H<D;){if(B>=Q)return-1;if(ae=Pt.charCodeAt(H++),ae===37){if(ae=Pt.charAt(H++),q=_e[ae in B3?Pt.charAt(H++):ae],!q||(B=q(lt,he,B))<0)return-1}else if(ae!=he.charCodeAt(B++))return-1}return B}function xe(lt,Pt,he){var B=p.exec(Pt.slice(he));return B?(lt.p=g.get(B[0].toLowerCase()),he+B[0].length):-1}function je(lt,Pt,he){var B=C.exec(Pt.slice(he));return B?(lt.w=M.get(B[0].toLowerCase()),he+B[0].length):-1}function ne(lt,Pt,he){var B=_.exec(Pt.slice(he));return B?(lt.w=x.get(B[0].toLowerCase()),he+B[0].length):-1}function Ee(lt,Pt,he){var B=z.exec(Pt.slice(he));return B?(lt.m=ee.get(B[0].toLowerCase()),he+B[0].length):-1}function ke(lt,Pt,he){var B=L.exec(Pt.slice(he));return B?(lt.m=F.get(B[0].toLowerCase()),he+B[0].length):-1}function Be(lt,Pt,he){return ue(lt,e,Pt,he)}function Ze(lt,Pt,he){return ue(lt,t,Pt,he)}function at(lt,Pt,he){return ue(lt,r,Pt,he)}function Re(lt){return a[lt.getDay()]}function ht(lt){return o[lt.getDay()]}function Rt(lt){return h[lt.getMonth()]}function dn(lt){return l[lt.getMonth()]}function wt(lt){return i[+(lt.getHours()>=12)]}function Ge(lt){return 1+~~(lt.getMonth()/3)}function qn(lt){return a[lt.getUTCDay()]}function Qt(lt){return o[lt.getUTCDay()]}function ln(lt){return h[lt.getUTCMonth()]}function Mn(lt){return l[lt.getUTCMonth()]}function Ot(lt){return i[+(lt.getUTCHours()>=12)]}function En(lt){return 1+~~(lt.getUTCMonth()/3)}return{format:function(lt){var Pt=J(lt+="",ce);return Pt.toString=function(){return lt},Pt},parse:function(lt){var Pt=pe(lt+="",!1);return Pt.toString=function(){return lt},Pt},utcFormat:function(lt){var Pt=J(lt+="",se);return Pt.toString=function(){return lt},Pt},utcParse:function(lt){var Pt=pe(lt+="",!0);return Pt.toString=function(){return lt},Pt}}}var B3={"-":"",_:" ",0:"0"},Po=/^\s*\d+/,vte=/^%/,bte=/[\\^$*+?|[\]().{}]/g;function Nr(n,e,t){var r=n<0?"-":"",i=(r?-n:n)+"",o=i.length;return r+(o<t?new Array(t-o+1).join(e)+i:i)}function wte(n){return n.replace(bte,"\\$&")}function g_(n){return new RegExp("^(?:"+n.map(wte).join("|")+")","i")}function m_(n){return new Map(n.map((e,t)=>[e.toLowerCase(),t]))}function xte(n,e,t){var r=Po.exec(e.slice(t,t+1));return r?(n.w=+r[0],t+r[0].length):-1}function Ete(n,e,t){var r=Po.exec(e.slice(t,t+1));return r?(n.u=+r[0],t+r[0].length):-1}function Tte(n,e,t){var r=Po.exec(e.slice(t,t+2));return r?(n.U=+r[0],t+r[0].length):-1}function Ste(n,e,t){var r=Po.exec(e.slice(t,t+2));return r?(n.V=+r[0],t+r[0].length):-1}function Cte(n,e,t){var r=Po.exec(e.slice(t,t+2));return r?(n.W=+r[0],t+r[0].length):-1}function U3(n,e,t){var r=Po.exec(e.slice(t,t+4));return r?(n.y=+r[0],t+r[0].length):-1}function z3(n,e,t){var r=Po.exec(e.slice(t,t+2));return r?(n.y=+r[0]+(+r[0]>68?1900:2e3),t+r[0].length):-1}function Ate(n,e,t){var r=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(e.slice(t,t+6));return r?(n.Z=r[1]?0:-(r[2]+(r[3]||"00")),t+r[0].length):-1}function Ite(n,e,t){var r=Po.exec(e.slice(t,t+1));return r?(n.q=r[0]*3-3,t+r[0].length):-1}function Pte(n,e,t){var r=Po.exec(e.slice(t,t+2));return r?(n.m=r[0]-1,t+r[0].length):-1}function j3(n,e,t){var r=Po.exec(e.slice(t,t+2));return r?(n.d=+r[0],t+r[0].length):-1}function Mte(n,e,t){var r=Po.exec(e.slice(t,t+3));return r?(n.m=0,n.d=+r[0],t+r[0].length):-1}function V3(n,e,t){var r=Po.exec(e.slice(t,t+2));return r?(n.H=+r[0],t+r[0].length):-1}function Rte(n,e,t){var r=Po.exec(e.slice(t,t+2));return r?(n.M=+r[0],t+r[0].length):-1}function kte(n,e,t){var r=Po.exec(e.slice(t,t+2));return r?(n.S=+r[0],t+r[0].length):-1}function Ote(n,e,t){var r=Po.exec(e.slice(t,t+3));return r?(n.L=+r[0],t+r[0].length):-1}function Lte(n,e,t){var r=Po.exec(e.slice(t,t+6));return r?(n.L=Math.floor(r[0]/1e3),t+r[0].length):-1}function Nte(n,e,t){var r=vte.exec(e.slice(t,t+1));return r?t+r[0].length:-1}function Dte(n,e,t){var r=Po.exec(e.slice(t));return r?(n.Q=+r[0],t+r[0].length):-1}function Fte(n,e,t){var r=Po.exec(e.slice(t));return r?(n.s=+r[0],t+r[0].length):-1}function H3(n,e){return Nr(n.getDate(),e,2)}function Bte(n,e){return Nr(n.getHours(),e,2)}function Ute(n,e){return Nr(n.getHours()%12||12,e,2)}function zte(n,e){return Nr(1+R1.count(th(n),n),e,3)}function G3(n,e){return Nr(n.getMilliseconds(),e,3)}function jte(n,e){return G3(n,e)+"000"}function Vte(n,e){return Nr(n.getMonth()+1,e,2)}function Hte(n,e){return Nr(n.getMinutes(),e,2)}function Gte(n,e){return Nr(n.getSeconds(),e,2)}function qte(n){var e=n.getDay();return e===0?7:e}function $te(n,e){return Nr(N3.count(th(n)-1,n),e,2)}function q3(n){var e=n.getDay();return e>=4||e===0?tg(n):tg.ceil(n)}function Wte(n,e){return n=q3(n),Nr(tg.count(th(n),n)+(th(n).getDay()===4),e,2)}function Yte(n){return n.getDay()}function Kte(n,e){return Nr(k1.count(th(n)-1,n),e,2)}function Zte(n,e){return Nr(n.getFullYear()%100,e,2)}function Xte(n,e){return n=q3(n),Nr(n.getFullYear()%100,e,2)}function Qte(n,e){return Nr(n.getFullYear()%1e4,e,4)}function Jte(n,e){var t=n.getDay();return n=t>=4||t===0?tg(n):tg.ceil(n),Nr(n.getFullYear()%1e4,e,4)}function ene(n){var e=n.getTimezoneOffset();return(e>0?"-":(e*=-1,"+"))+Nr(e/60|0,"0",2)+Nr(e%60,"0",2)}function $3(n,e){return Nr(n.getUTCDate(),e,2)}function tne(n,e){return Nr(n.getUTCHours(),e,2)}function nne(n,e){return Nr(n.getUTCHours()%12||12,e,2)}function rne(n,e){return Nr(1+WC.count(Ud(n),n),e,3)}function W3(n,e){return Nr(n.getUTCMilliseconds(),e,3)}function ine(n,e){return W3(n,e)+"000"}function one(n,e){return Nr(n.getUTCMonth()+1,e,2)}function ane(n,e){return Nr(n.getUTCMinutes(),e,2)}function sne(n,e){return Nr(n.getUTCSeconds(),e,2)}function cne(n){var e=n.getUTCDay();return e===0?7:e}function lne(n,e){return Nr(D3.count(Ud(n)-1,n),e,2)}function Y3(n){var e=n.getUTCDay();return e>=4||e===0?ng(n):ng.ceil(n)}function une(n,e){return n=Y3(n),Nr(ng.count(Ud(n),n)+(Ud(n).getUTCDay()===4),e,2)}function hne(n){return n.getUTCDay()}function dne(n,e){return Nr(O1.count(Ud(n)-1,n),e,2)}function fne(n,e){return Nr(n.getUTCFullYear()%100,e,2)}function pne(n,e){return n=Y3(n),Nr(n.getUTCFullYear()%100,e,2)}function gne(n,e){return Nr(n.getUTCFullYear()%1e4,e,4)}function mne(n,e){var t=n.getUTCDay();return n=t>=4||t===0?ng(n):ng.ceil(n),Nr(n.getUTCFullYear()%1e4,e,4)}function yne(){return"+0000"}function K3(){return"%"}function Z3(n){return+n}function X3(n){return Math.floor(+n/1e3)}var rg,ba,ig;_ne({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});function _ne(n){return rg=_te(n),ba=rg.format,ig=rg.parse,rg.utcFormat,rg.utcParse,rg}function Q3(){var n=0,e=1,t,r,i,o,a=Vs,l=!1,h;function p(_){return _==null||isNaN(_=+_)?h:a(i===0?.5:(_=(o(_)-t)*i,l?Math.max(0,Math.min(1,_)):_))}p.domain=function(_){return arguments.length?([n,e]=_,t=o(n=+n),r=o(e=+e),i=t===r?0:1/(r-t),p):[n,e]},p.clamp=function(_){return arguments.length?(l=!!_,p):l},p.interpolator=function(_){return arguments.length?(a=_,p):a};function g(_){return function(x){var C,M;return arguments.length?([C,M]=x,a=_(C,M),p):[a(0),a(1)]}}return p.range=g(E1),p.rangeRound=g(VD),p.unknown=function(_){return arguments.length?(h=_,p):h},function(_){return o=_,t=_(n),r=_(e),i=t===r?0:1/(r-t),p}}function J3(n,e){return e.domain(n.domain()).interpolator(n.interpolator()).clamp(n.clamp()).unknown(n.unknown())}function e4(){var n=HC(Q3()(Vs));return n.copy=function(){return J3(n,e4())},m3.apply(n,arguments)}function t4(){var n=M3(Q3());return n.copy=function(){return J3(n,t4()).exponent(n.exponent())},m3.apply(n,arguments)}const vne="#fff",bne=.4,ZC="rgba(240,240,240,0.5)",wne=[ZC,"#137CBD"],xne="rgba(220,220,220,0.5)",Ene=[ZC,"#f6654e"],Tne=[ZC,"#00a9cc"],Sne=[255,255,255,255];function Cne(n){return Math.round(n*255)}function n4(n,e){const t=Od(n);if(!t)return console.warn("Invalid color: ",n),`rgba(255, 255, 255, ${e})`;const r=t.rgb();return`rgba(${r.r}, ${r.g}, ${r.b}, ${e})`}function Yc(n){if(Array.isArray(n))return n;const e=Od(n);if(!e)return console.warn("Invalid color: ",n),Sne;const t=e.rgb();return[Math.floor(t.r),Math.floor(t.g),Math.floor(t.b),Cne(e.opacity)]}function Kc(n,e){return n?Yc(n):typeof e=="string"?Yc(e):e}const Mo=n=>n[n.length-1];var XC;(function(n){n.primary="#162d3c"})(XC||(XC={}));const r4=20,og=n=>p3(0,r4+1).map(e=>n(e/r4)).reverse(),QC="rgba(240,240,240,0.5)",Ane=[QC,XC.primary],Ine=["#f7feae","#b7e6a5","#7ccba2","#46aea0","#089099","#00718b","#045275"],Pne=["#d3f2a3","#97e196","#6cc08b","#4c9b82","#217a79","#105965","#074050"],i4=["#d1eeea","#a8dbd9","#85c4c9","#68abb8","#4f90a6","#3b738f","#2a5674"],Mne=i4,Rne={Blues:Mo(r3),BluGrn:["#c4e6c3","#96d2a4","#6dbc90","#4da284","#36877a","#266b6e","#1d4f60"],BluYl:Ine,BrwnYl:["#ede5cf","#e0c2a2","#d39c83","#c1766f","#a65461","#813753","#541f3f"],BuGn:Mo(qD),BuPu:Mo($D),Burg:["#ffc6c4","#f4a3a8","#e38191","#cc607d","#ad466c","#8b3058","#672044"],BurgYl:["#fbe6c5","#f5ba98","#ee8a82","#dc7176","#c8586c","#9c3f5d","#70284a"],Cool:og(Eee),DarkMint:["#d2fbd4","#a5dbc2","#7bbcb0","#559c9e","#3a7c89","#235d72","#123f5a"],Emrld:Pne,GnBu:Mo(WD),Grayish:Ane,Greens:Mo(i3),Greys:Mo(o3),Inferno:og(Cee),Magenta:["#f3cbd3","#eaa9bd","#dd88ac","#ca699d","#b14d8e","#91357d","#6c2167"],Magma:og(See),Mint:["#e4f1e1","#b4d9cc","#89c0b6","#63a6a0","#448c8a","#287274","#0d585f"],Oranges:Mo(c3),OrRd:Mo(YD),OrYel:["#ecda9a","#efc47e","#f3ad6a","#f7945d","#f97b57","#f66356","#ee4d5a"],Peach:["#fde0c5","#facba6","#f8b58b","#f59e72","#f2855d","#ef6a4c","#eb4a40"],Plasma:og(Aee),PinkYl:["#fef6b5","#ffdd9a","#ffc285","#ffa679","#fa8a76","#f16d7a","#e15383"],PuBu:Mo(ZD),PuBuGn:Mo(KD),PuRd:Mo(XD),Purp:["#f3e0f7","#e4c7f1","#d1afe8","#b998dd","#9f82ce","#826dba","#63589f"],Purples:Mo(a3),PurpOr:["#f9ddda","#f2b9c4","#e597b9","#ce78b3","#ad5fad","#834ba0","#573b88"],RdPu:Mo(QD),RedOr:["#f6d2a9","#f5b78e","#f19c7c","#ea8171","#dd686c","#ca5268","#b13f64"],Reds:Mo(s3),Sunset:["#f3e79b","#fac484","#f8a07e","#eb7f86","#ce6693","#a059a0","#5c53a5"],SunsetDark:["#fcde9c","#faa476","#f0746e","#e34f6f","#dc3977","#b9257a","#7c1d6f"],Teal:i4,TealGrn:["#b0f2bc","#89e8ac","#67dba5","#4cc8a3","#38b2a3","#2c98a0","#257d98"],Viridis:og(Tee),Warm:og(xee),YlGn:Mo(e3),YlGnBu:Mo(JD),YlOrBr:Mo(t3),YlOrRd:Mo(n3)},kne={negative:{flows:{scheme:[QC,"#17a5be"]}},positive:{flows:{scheme:[QC,"#f52020"]}},locationAreas:{outline:"rgba(92,112,128,0.5)",normal:"rgba(220,220,220,0.5)"},outlineColor:"rgb(230,233,237)"};function One(n){return o4(!1,n.colorScheme,n.darkMode,n.fadeEnabled,n.fadeOpacityEnabled,n.fadeAmount,n.animationEnabled)}function o4(n,e,t,r,i,o,a){if(n)return kne;let l;Array.isArray(e)?l=e:(l=e&&Rne[e]||Mne,t&&(l=l.slice().reverse()));{const h=p3(0,Math.max(10,l.length)),p=h.length-1,g=e4(jD(l)).domain([0,p]);if(!r||o===0)l=h.map((_,x)=>g(x));else{const _=GC().exponent(1.5).domain([p,0]).range([0,2*o/100]);l=h.map((x,C)=>{const M=g(C),L=_(C);if(M==null||L==null)return"#000";const F=v1(M);return F.l=t?F.l-F.l*L:F.l+(100-F.l)*L,F.c=F.c-F.c*(L/4),i&&(F.opacity=F.opacity*(1-L)),F.toString()})}}return{darkMode:t,flows:{scheme:l},locationCircles:{outgoing:t?"#000":"#fff"},outlineColor:t?"#000":"rgba(255, 255, 255, 0.5)"}}function Lne(n){const e=BD,t=n.length;let r=new Array(t),i=new Array(t),o=new Array(t),a=new Array(t),l,h;for(l=0;l<t;++l)h=l_(n[l]),r[l]=h.r||0,i[l]=h.g||0,o[l]=h.b||0,a[l]=h.opacity||0;return r=e(r),i=e(i),o=e(o),a=e(a),function(p){return h.r=r(p),h.g=i(p),h.b=o(p),h.opacity=a(p),h+""}}function JC(n,e,t){const r=t4(Lne(e)).exponent(t?.5:.3333333333333333).domain(n);return i=>Yc(r(i))}function Nne(n,e,t){const r=e?e[0]:0,i=e?e[1]:0;if(a4(n)){const a=JC([0,i],n.positive.flows.scheme,t),l=JC([0,r],n.negative.flows.scheme,t);return h=>h>=0?a(h):l(h)}const o=JC([0,i||0],n.flows.scheme,t);return a=>o(a)}function Dne(n){return n.positive!==void 0}function a4(n){return n.positive!==void 0}function Fne(n,e){const t=n&&n.normal||xne,r=v1(t),i=Yc(t);return{normal:i,connected:Kc(n&&n.connected,i),highlighted:Kc(n&&n.highlighted,n4(r[e?"brighter":"darker"](1).toString(),.5)),selected:Kc(n&&n.selected,n4(r[e?"brighter":"darker"](2).toString(),.8)),outline:Kc(n&&n.outline,Yc(r[e?"brighter":"darker"](4).toString()))}}function eA(n,e,t){var h,p;const r=n&&n.flows&&n.flows.scheme||e,i=v1(r[r.length-1]),o=Kc(n&&n.flows&&n.flows.highlighted,Yc(i[t?"brighter":"darker"](.7).toString())),a=Kc((h=n==null?void 0:n.locationCircles)==null?void 0:h.empty,t?"#000":"#fff"),l=Kc(n&&n.locationCircles&&n.locationCircles.inner,i.toString());return{flows:{scheme:r,highlighted:o},locationCircles:{inner:l,outgoing:Kc(n&&n.locationCircles&&n.locationCircles.outgoing,t?"#000":"#fff"),incoming:Kc(n&&n.locationCircles&&n.locationCircles.incoming,i[t?"brighter":"darker"](1.25).toString()),highlighted:Kc(n&&n.locationCircles&&n.locationCircles.highlighted,o),empty:a,outlineEmptyMix:((p=n==null?void 0:n.locationCircles)==null?void 0:p.outlineEmptyMix)??.4}}}function s4(n){const e=!!(n&&n.darkMode);return{darkMode:e,locationAreas:Fne(n&&n.locationAreas,e),outlineColor:Yc(n&&n.outlineColor||vne),dimmedOpacity:n&&n.dimmedOpacity!=null?n.dimmedOpacity:bne}}function Bne(n){const e=s4(n);return{...e,...eA(n,wne,e.darkMode)}}function Une(n){const e=s4(n);return{...e,positive:eA(n&&n.positive,Ene,e.darkMode),negative:eA(n&&n.negative,Tne,e.darkMode)}}const c4=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array],tA=1,y_=8;class L1{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[t,r]=new Uint8Array(e,0,2);if(t!==219)throw new Error("Data does not appear to be in a KDBush format.");const i=r>>4;if(i!==tA)throw new Error(`Got v${i} data when expected v${tA}.`);const o=c4[r&15];if(!o)throw new Error("Unrecognized array type.");const[a]=new Uint16Array(e,2,1),[l]=new Uint32Array(e,4,1);return new L1(l,a,o,e)}constructor(e,t=64,r=Float64Array,i){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+t,2),65535),this.ArrayType=r,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;const o=c4.indexOf(this.ArrayType),a=e*2*this.ArrayType.BYTES_PER_ELEMENT,l=e*this.IndexArrayType.BYTES_PER_ELEMENT,h=(8-l%8)%8;if(o<0)throw new Error(`Unexpected typed array class: ${r}.`);i&&i instanceof ArrayBuffer?(this.data=i,this.ids=new this.IndexArrayType(this.data,y_,e),this.coords=new this.ArrayType(this.data,y_+l+h,e*2),this._pos=e*2,this._finished=!0):(this.data=new ArrayBuffer(y_+a+l+h),this.ids=new this.IndexArrayType(this.data,y_,e),this.coords=new this.ArrayType(this.data,y_+l+h,e*2),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,(tA<<4)+o]),new Uint16Array(this.data,2,1)[0]=t,new Uint32Array(this.data,4,1)[0]=e)}add(e,t){const r=this._pos>>1;return this.ids[r]=r,this.coords[this._pos++]=e,this.coords[this._pos++]=t,r}finish(){const e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return nA(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,t,r,i){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:o,coords:a,nodeSize:l}=this,h=[0,o.length-1,0],p=[];for(;h.length;){const g=h.pop()||0,_=h.pop()||0,x=h.pop()||0;if(_-x<=l){for(let F=x;F<=_;F++){const z=a[2*F],ee=a[2*F+1];z>=e&&z<=r&&ee>=t&&ee<=i&&p.push(o[F])}continue}const C=x+_>>1,M=a[2*C],L=a[2*C+1];M>=e&&M<=r&&L>=t&&L<=i&&p.push(o[C]),(g===0?e<=M:t<=L)&&(h.push(x),h.push(C-1),h.push(1-g)),(g===0?r>=M:i>=L)&&(h.push(C+1),h.push(_),h.push(1-g))}return p}within(e,t,r){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:i,coords:o,nodeSize:a}=this,l=[0,i.length-1,0],h=[],p=r*r;for(;l.length;){const g=l.pop()||0,_=l.pop()||0,x=l.pop()||0;if(_-x<=a){for(let F=x;F<=_;F++)u4(o[2*F],o[2*F+1],e,t)<=p&&h.push(i[F]);continue}const C=x+_>>1,M=o[2*C],L=o[2*C+1];u4(M,L,e,t)<=p&&h.push(i[C]),(g===0?e-r<=M:t-r<=L)&&(l.push(x),l.push(C-1),l.push(1-g)),(g===0?e+r>=M:t+r>=L)&&(l.push(C+1),l.push(_),l.push(1-g))}return h}}function nA(n,e,t,r,i,o){if(i-r<=t)return;const a=r+i>>1;l4(n,e,a,r,i,o),nA(n,e,t,r,a-1,1-o),nA(n,e,t,a+1,i,1-o)}function l4(n,e,t,r,i,o){for(;i>r;){if(i-r>600){const p=i-r+1,g=t-r+1,_=Math.log(p),x=.5*Math.exp(2*_/3),C=.5*Math.sqrt(_*x*(p-x)/p)*(g-p/2<0?-1:1),M=Math.max(r,Math.floor(t-g*x/p+C)),L=Math.min(i,Math.floor(t+(p-g)*x/p+C));l4(n,e,t,M,L,o)}const a=e[2*t+o];let l=r,h=i;for(__(n,e,r,t),e[2*i+o]>a&&__(n,e,r,i);l<h;){for(__(n,e,l,h),l++,h--;e[2*l+o]<a;)l++;for(;e[2*h+o]>a;)h--}e[2*r+o]===a?__(n,e,r,h):(h++,__(n,e,h,i)),h<=t&&(r=h+1),t<=h&&(i=h-1)}}function __(n,e,t,r){rA(n,t,r),rA(e,2*t,2*r),rA(e,2*t+1,2*r+1)}function rA(n,e,t){const r=n[e];n[e]=n[t],n[t]=r}function u4(n,e,t,r){const i=n-t,o=e-r;return i*i+o*o}var N1="NOT_FOUND";function zne(n){var e;return{get:function(r){return e&&n(e.key,r)?e.value:N1},put:function(r,i){e={key:r,value:i}},getEntries:function(){return e?[e]:[]},clear:function(){e=void 0}}}function jne(n,e){var t=[];function r(l){var h=t.findIndex(function(g){return e(l,g.key)});if(h>-1){var p=t[h];return h>0&&(t.splice(h,1),t.unshift(p)),p.value}return N1}function i(l,h){r(l)===N1&&(t.unshift({key:l,value:h}),t.length>n&&t.pop())}function o(){return t}function a(){t=[]}return{get:r,put:i,getEntries:o,clear:a}}var Vne=function(e,t){return e===t};function Hne(n){return function(t,r){if(t===null||r===null||t.length!==r.length)return!1;for(var i=t.length,o=0;o<i;o++)if(!n(t[o],r[o]))return!1;return!0}}function h4(n,e){var t=typeof e=="object"?e:{equalityCheck:e},r=t.equalityCheck,i=r===void 0?Vne:r,o=t.maxSize,a=o===void 0?1:o,l=t.resultEqualityCheck,h=Hne(i),p=a===1?zne(h):jne(a,h);function g(){var _=p.get(arguments);if(_===N1){if(_=n.apply(null,arguments),l){var x=p.getEntries(),C=x.find(function(M){return l(M.value,_)});C&&(_=C.value)}p.put(arguments,_)}return _}return g.clearCache=function(){return p.clear()},g}function Gne(n){var e=Array.isArray(n[0])?n[0]:n;if(!e.every(function(r){return typeof r=="function"})){var t=e.map(function(r){return typeof r=="function"?"function "+(r.name||"unnamed")+"()":typeof r}).join(", ");throw new Error("createSelector expects all input-selectors to be functions, but received the following types: ["+t+"]")}return e}function d4(n){for(var e=arguments.length,t=new Array(e>1?e-1:0),r=1;r<e;r++)t[r-1]=arguments[r];var i=function(){for(var a=arguments.length,l=new Array(a),h=0;h<a;h++)l[h]=arguments[h];var p=0,g,_={memoizeOptions:void 0},x=l.pop();if(typeof x=="object"&&(_=x,x=l.pop()),typeof x!="function")throw new Error("createSelector expects an output function after the inputs, but received: ["+typeof x+"]");var C=_,M=C.memoizeOptions,L=M===void 0?t:M,F=Array.isArray(L)?L:[L],z=Gne(l),ee=n.apply(void 0,[function(){return p++,x.apply(null,arguments)}].concat(F)),ce=n(function(){for(var _e=[],J=z.length,pe=0;pe<J;pe++)_e.push(z[pe].apply(null,arguments));return g=ee.apply(null,_e),g});return Object.assign(ce,{resultFunc:x,memoizedResultFunc:ee,dependencies:z,lastResult:function(){return g},recomputations:function(){return p},resetRecomputations:function(){return p=0}}),ce};return i}var Dn=d4(h4),iA={exports:{}};iA.exports,function(n){(function(e,t,r){function i(h){var p=this,g=l();p.next=function(){var _=2091639*p.s0+p.c*23283064365386963e-26;return p.s0=p.s1,p.s1=p.s2,p.s2=_-(p.c=_|0)},p.c=1,p.s0=g(" "),p.s1=g(" "),p.s2=g(" "),p.s0-=g(h),p.s0<0&&(p.s0+=1),p.s1-=g(h),p.s1<0&&(p.s1+=1),p.s2-=g(h),p.s2<0&&(p.s2+=1),g=null}function o(h,p){return p.c=h.c,p.s0=h.s0,p.s1=h.s1,p.s2=h.s2,p}function a(h,p){var g=new i(h),_=p&&p.state,x=g.next;return x.int32=function(){return g.next()*4294967296|0},x.double=function(){return x()+(x()*2097152|0)*11102230246251565e-32},x.quick=x,_&&(typeof _=="object"&&o(_,g),x.state=function(){return o(g,{})}),x}function l(){var h=4022871197,p=function(g){g=String(g);for(var _=0;_<g.length;_++){h+=g.charCodeAt(_);var x=.02519603282416938*h;h=x>>>0,x-=h,x*=h,h=x>>>0,x-=h,h+=x*4294967296}return(h>>>0)*23283064365386963e-26};return p}t&&t.exports?t.exports=a:r&&r.amd?r(function(){return a}):this.alea=a})(Md,n,!1)}(iA);var qne=iA.exports,oA={exports:{}};oA.exports,function(n){(function(e,t,r){function i(l){var h=this,p="";h.x=0,h.y=0,h.z=0,h.w=0,h.next=function(){var _=h.x^h.x<<11;return h.x=h.y,h.y=h.z,h.z=h.w,h.w^=h.w>>>19^_^_>>>8},l===(l|0)?h.x=l:p+=l;for(var g=0;g<p.length+64;g++)h.x^=p.charCodeAt(g)|0,h.next()}function o(l,h){return h.x=l.x,h.y=l.y,h.z=l.z,h.w=l.w,h}function a(l,h){var p=new i(l),g=h&&h.state,_=function(){return(p.next()>>>0)/4294967296};return _.double=function(){do var x=p.next()>>>11,C=(p.next()>>>0)/4294967296,M=(x+C)/(1<<21);while(M===0);return M},_.int32=p.next,_.quick=_,g&&(typeof g=="object"&&o(g,p),_.state=function(){return o(p,{})}),_}t&&t.exports?t.exports=a:r&&r.amd?r(function(){return a}):this.xor128=a})(Md,n,!1)}(oA);var $ne=oA.exports,aA={exports:{}};aA.exports,function(n){(function(e,t,r){function i(l){var h=this,p="";h.next=function(){var _=h.x^h.x>>>2;return h.x=h.y,h.y=h.z,h.z=h.w,h.w=h.v,(h.d=h.d+362437|0)+(h.v=h.v^h.v<<4^(_^_<<1))|0},h.x=0,h.y=0,h.z=0,h.w=0,h.v=0,l===(l|0)?h.x=l:p+=l;for(var g=0;g<p.length+64;g++)h.x^=p.charCodeAt(g)|0,g==p.length&&(h.d=h.x<<10^h.x>>>4),h.next()}function o(l,h){return h.x=l.x,h.y=l.y,h.z=l.z,h.w=l.w,h.v=l.v,h.d=l.d,h}function a(l,h){var p=new i(l),g=h&&h.state,_=function(){return(p.next()>>>0)/4294967296};return _.double=function(){do var x=p.next()>>>11,C=(p.next()>>>0)/4294967296,M=(x+C)/(1<<21);while(M===0);return M},_.int32=p.next,_.quick=_,g&&(typeof g=="object"&&o(g,p),_.state=function(){return o(p,{})}),_}t&&t.exports?t.exports=a:r&&r.amd?r(function(){return a}):this.xorwow=a})(Md,n,!1)}(aA);var Wne=aA.exports,sA={exports:{}};sA.exports,function(n){(function(e,t,r){function i(l){var h=this;h.next=function(){var g=h.x,_=h.i,x,C;return x=g[_],x^=x>>>7,C=x^x<<24,x=g[_+1&7],C^=x^x>>>10,x=g[_+3&7],C^=x^x>>>3,x=g[_+4&7],C^=x^x<<7,x=g[_+7&7],x=x^x<<13,C^=x^x<<9,g[_]=C,h.i=_+1&7,C};function p(g,_){var x,C=[];if(_===(_|0))C[0]=_;else for(_=""+_,x=0;x<_.length;++x)C[x&7]=C[x&7]<<15^_.charCodeAt(x)+C[x+1&7]<<13;for(;C.length<8;)C.push(0);for(x=0;x<8&&C[x]===0;++x);for(x==8?C[7]=-1:C[x],g.x=C,g.i=0,x=256;x>0;--x)g.next()}p(h,l)}function o(l,h){return h.x=l.x.slice(),h.i=l.i,h}function a(l,h){l==null&&(l=+new Date);var p=new i(l),g=h&&h.state,_=function(){return(p.next()>>>0)/4294967296};return _.double=function(){do var x=p.next()>>>11,C=(p.next()>>>0)/4294967296,M=(x+C)/(1<<21);while(M===0);return M},_.int32=p.next,_.quick=_,g&&(g.x&&o(g,p),_.state=function(){return o(p,{})}),_}t&&t.exports?t.exports=a:r&&r.amd?r(function(){return a}):this.xorshift7=a})(Md,n,!1)}(sA);var Yne=sA.exports,cA={exports:{}};cA.exports,function(n){(function(e,t,r){function i(l){var h=this;h.next=function(){var g=h.w,_=h.X,x=h.i,C,M;return h.w=g=g+1640531527|0,M=_[x+34&127],C=_[x=x+1&127],M^=M<<13,C^=C<<17,M^=M>>>15,C^=C>>>12,M=_[x]=M^C,h.i=x,M+(g^g>>>16)|0};function p(g,_){var x,C,M,L,F,z=[],ee=128;for(_===(_|0)?(C=_,_=null):(_=_+"\0",C=0,ee=Math.max(ee,_.length)),M=0,L=-32;L<ee;++L)_&&(C^=_.charCodeAt((L+32)%_.length)),L===0&&(F=C),C^=C<<10,C^=C>>>15,C^=C<<4,C^=C>>>13,L>=0&&(F=F+1640531527|0,x=z[L&127]^=C+F,M=x==0?M+1:0);for(M>=128&&(z[(_&&_.length||0)&127]=-1),M=127,L=4*128;L>0;--L)C=z[M+34&127],x=z[M=M+1&127],C^=C<<13,x^=x<<17,C^=C>>>15,x^=x>>>12,z[M]=C^x;g.w=F,g.X=z,g.i=M}p(h,l)}function o(l,h){return h.i=l.i,h.w=l.w,h.X=l.X.slice(),h}function a(l,h){l==null&&(l=+new Date);var p=new i(l),g=h&&h.state,_=function(){return(p.next()>>>0)/4294967296};return _.double=function(){do var x=p.next()>>>11,C=(p.next()>>>0)/4294967296,M=(x+C)/(1<<21);while(M===0);return M},_.int32=p.next,_.quick=_,g&&(g.X&&o(g,p),_.state=function(){return o(p,{})}),_}t&&t.exports?t.exports=a:r&&r.amd?r(function(){return a}):this.xor4096=a})(Md,n,!1)}(cA);var Kne=cA.exports,lA={exports:{}};lA.exports,function(n){(function(e,t,r){function i(l){var h=this,p="";h.next=function(){var _=h.b,x=h.c,C=h.d,M=h.a;return _=_<<25^_>>>7^x,x=x-C|0,C=C<<24^C>>>8^M,M=M-_|0,h.b=_=_<<20^_>>>12^x,h.c=x=x-C|0,h.d=C<<16^x>>>16^M,h.a=M-_|0},h.a=0,h.b=0,h.c=-1640531527,h.d=1367130551,l===Math.floor(l)?(h.a=l/4294967296|0,h.b=l|0):p+=l;for(var g=0;g<p.length+20;g++)h.b^=p.charCodeAt(g)|0,h.next()}function o(l,h){return h.a=l.a,h.b=l.b,h.c=l.c,h.d=l.d,h}function a(l,h){var p=new i(l),g=h&&h.state,_=function(){return(p.next()>>>0)/4294967296};return _.double=function(){do var x=p.next()>>>11,C=(p.next()>>>0)/4294967296,M=(x+C)/(1<<21);while(M===0);return M},_.int32=p.next,_.quick=_,g&&(typeof g=="object"&&o(g,p),_.state=function(){return o(p,{})}),_}t&&t.exports?t.exports=a:r&&r.amd?r(function(){return a}):this.tychei=a})(Md,n,!1)}(lA);var Zne=lA.exports,f4={exports:{}};const Xne=sX(d7);(function(n){(function(e,t,r){var i=256,o=6,a=52,l="random",h=r.pow(i,o),p=r.pow(2,a),g=p*2,_=i-1,x;function C(se,_e,J){var pe=[];_e=_e==!0?{entropy:!0}:_e||{};var ue=z(F(_e.entropy?[se,ce(t)]:se??ee(),3),pe),xe=new M(pe),je=function(){for(var ne=xe.g(o),Ee=h,ke=0;ne<p;)ne=(ne+ke)*i,Ee*=i,ke=xe.g(1);for(;ne>=g;)ne/=2,Ee/=2,ke>>>=1;return(ne+ke)/Ee};return je.int32=function(){return xe.g(4)|0},je.quick=function(){return xe.g(4)/4294967296},je.double=je,z(ce(xe.S),t),(_e.pass||J||function(ne,Ee,ke,Be){return Be&&(Be.S&&L(Be,xe),ne.state=function(){return L(xe,{})}),ke?(r[l]=ne,Ee):ne})(je,ue,"global"in _e?_e.global:this==r,_e.state)}function M(se){var _e,J=se.length,pe=this,ue=0,xe=pe.i=pe.j=0,je=pe.S=[];for(J||(se=[J++]);ue<i;)je[ue]=ue++;for(ue=0;ue<i;ue++)je[ue]=je[xe=_&xe+se[ue%J]+(_e=je[ue])],je[xe]=_e;(pe.g=function(ne){for(var Ee,ke=0,Be=pe.i,Ze=pe.j,at=pe.S;ne--;)Ee=at[Be=_&Be+1],ke=ke*i+at[_&(at[Be]=at[Ze=_&Ze+Ee])+(at[Ze]=Ee)];return pe.i=Be,pe.j=Ze,ke})(i)}function L(se,_e){return _e.i=se.i,_e.j=se.j,_e.S=se.S.slice(),_e}function F(se,_e){var J=[],pe=typeof se,ue;if(_e&&pe=="object")for(ue in se)try{J.push(F(se[ue],_e-1))}catch{}return J.length?J:pe=="string"?se:se+"\0"}function z(se,_e){for(var J=se+"",pe,ue=0;ue<J.length;)_e[_&ue]=_&(pe^=_e[_&ue]*19)+J.charCodeAt(ue++);return ce(_e)}function ee(){try{var se;return x&&(se=x.randomBytes)?se=se(i):(se=new Uint8Array(i),(e.crypto||e.msCrypto).getRandomValues(se)),ce(se)}catch{var _e=e.navigator,J=_e&&_e.plugins;return[+new Date,e,J,e.screen,ce(t)]}}function ce(se){return String.fromCharCode.apply(0,se)}if(z(r.random(),t),n.exports){n.exports=C;try{x=Xne}catch{}}else r["seed"+l]=C})(typeof self<"u"?self:Md,[],Math)})(f4);var Qne=f4.exports,Jne=qne,ere=$ne,tre=Wne,nre=Yne,rre=Kne,ire=Zne,zd=Qne;zd.alea=Jne,zd.xor128=ere,zd.xorwow=tre,zd.xorshift7=nre,zd.xor4096=rre,zd.tychei=ire;var ore=zd;const are={minZoom:0,maxZoom:16,radius:40,extent:512,nodeSize:64,makeClusterName:(n,e)=>{},makeClusterId:n=>`{[${n}]}`};function sre(n){const{index:e}=n;return e!=null}function p4(n){const{id:e}=n;return e!=null}function cre(n,e,t,r){const{getLocationLon:i,getLocationLat:o,getLocationId:a}=e,l={...are,...r},{minZoom:h,maxZoom:p,nodeSize:g,makeClusterName:_,makeClusterId:x}=l,C=new Array(p+1);let M=new Array,L=0;for(const ue of n){const xe=i(ue),je=o(ue);M.push({x:fre(xe),y:pre(je),weight:t(a(ue)),zoom:1/0,index:L,parentId:-1,location:ue}),L++}const F=ue=>{const xe=new L1(ue.length,g,Float32Array);for(let je=0;je<ue.length;je++)xe.add(ue[je].x,ue[je].y);return xe.finish(),xe.points=ue,xe};C[p+1]=F(M);let z=p+1;for(let ue=p;ue>=h;ue--){const xe=ure(M,ue,C[z],l);xe.length===M.length?(C[ue]=C[z],C[z]=void 0,z=ue,M=xe):(z=ue,M=xe,C[ue]=F(M))}if(C.length===0)return[];const ee=C.map(ue=>ue==null?void 0:ue.points.length),ce=f3(ee.filter(ue=>ue>0));let se=mre(ee)??ee.length-1;const _e=gre(n,e);if(_e<L){const ue=yre(ee,xe=>xe<=_e);ue>=0&&(ue<se&&(C[ue+1]=C[se],C.splice(ue+2)),se=ue+1)}const J=Math.min(se,ce?ee.lastIndexOf(ce):se),pe=new Array;z=NaN;for(let ue=se;ue>=J;ue--){let xe;const je=C[ue];if(!je)continue;C[z]&&ue<se&&(xe=d3(C[z].points,Ee=>Ee.map(ke=>ke.id?x(ke.id):a(ke.location)),Ee=>Ee.parentId));const ne=[];for(const Ee of je.points){const{x:ke,y:Be,numPoints:Ze,location:at}=Ee;if(sre(Ee))ne.push({id:a(at),zoom:ue,lat:o(at),lon:i(at)});else if(p4(Ee)){const{id:Re}=Ee,ht=xe&&xe.get(Re);if(!ht){console.warn("Omitting cluster with no children, point:",Ee);continue}const Rt={id:x(Re),name:_(Re,Ze),zoom:ue,lat:dre(Be),lon:hre(ke),children:ht??[]};ne.push(Rt)}}pe.push({zoom:ue,nodes:ne}),z=ue}return pe}function lre(n,e,t,r,i){return{x:n,y:e,zoom:1/0,id:t,parentId:-1,numPoints:r,weight:i}}function ure(n,e,t,r){const i=[],{radius:o,extent:a}=r,l=o/(a*Math.pow(2,e));for(let h=0;h<n.length;h++){const p=n[h];if(p.zoom<=e)continue;p.zoom=e;const g=t.within(p.x,p.y,l);let _=p.weight||1,x=p4(p)?p.numPoints:1,C=p.x*_,M=p.y*_;const L=(h<<5)+(e+1);for(const F of g){const z=t.points[F];if(z.zoom<=e)continue;z.zoom=e;const ee=z.weight||1,ce=z.numPoints||1;C+=z.x*ee,M+=z.y*ee,_+=ee,x+=ce,z.parentId=L}x===1?i.push(p):(p.parentId=L,i.push(lre(C/_,M/_,L,x,_)))}return i}function hre(n){return(n-.5)*360}function dre(n){const e=(180-n*360)*Math.PI/180;return 360*Math.atan(Math.exp(e))/Math.PI-90}function fre(n){return n/360+.5}function pre(n){const e=Math.sin(n*Math.PI/180),t=.5-.25*Math.log((1+e)/(1-e))/Math.PI;return t<0?0:t>1?1:t}function gre(n,e){const{getLocationLon:t,getLocationLat:r}=e,i=new Map;let o=0;for(const a of n){const l=t(a),h=r(a),p=`${l},${h}`,g=i.get(p);g||o++,i.set(p,g?g+1:1)}return o}function mre(n){let e=-1/0,t;for(let r=0;r<n.length;r++){const i=n[r];typeof i=="number"&&i>e&&(e=i,t=r)}return t}function yre(n,e){for(let t=n.length-1;t>=0;t--)if(e(n[t],t,n))return t;return-1}function _re(n){const e=new Map,t=new Map,r=new Map;for(const{zoom:_,nodes:x}of n){e.set(_,x);for(const C of x)if(AC(C))t.set(C.id,C);else{const{id:M}=C,L=r.get(M);(L==null||L>_)&&r.set(M,_)}}const[i,o]=UC(n,_=>_.zoom);if(i==null||o==null)throw new Error("Could not determine minZoom or maxZoom");const a=new Map;for(const _ of t.values()){const{zoom:x}=_;let C=a.get(x);C||(C=new Map,a.set(x,C)),l(_,M=>{C==null||C.set(M,_)})}function l(_,x){for(const C of _.children){const M=t.get(C);M?l(M,x):x(C)}}const h=(_,x=o)=>{const C=[],M=(L,F)=>{if(x>L.zoom)for(const z of L.children){const ee=t.get(z);ee?M(ee,F):F.push(z)}else F.push(L.id)};return M(_,C),C};function p(_,x){const C=a.get(x);if(!C)return;const M=C.get(_);return M?M.id:void 0}return{availableZoomLevels:n.map(_=>+_.zoom).sort((_,x)=>Jp(_,x)),getClusterNodesFor:_=>{if(_!==void 0)return e.get(_)},getClusterById:_=>t.get(_),getMinZoomForLocation:_=>r.get(_)||i,expandCluster:h,findClusterFor:p,aggregateFlows:(_,x,{getFlowOriginId:C,getFlowDestId:M,getFlowMagnitude:L},F={})=>{if(x>o)return _;const z=[],ee=new Map,ce=(_e,J)=>`${_e}:${J}`,{flowCountsMapReduce:se={map:L,reduce:(_e,J)=>(_e||0)+J}}=F;for(const _e of _){const J=C(_e),pe=M(_e),ue=p(J,x)||J,xe=p(pe,x)||pe,je=ce(ue,xe);if(ue===J&&xe===pe)z.push(_e);else{let ne=ee.get(je);ne?ne.count=se.reduce(ne.count,se.map(_e)):(ne={origin:ue,dest:xe,count:se.map(_e),aggregate:!0},z.push(ne),ee.set(je,ne))}}return z}}}function vre(n,{getFlowOriginId:e,getFlowDestId:t,getFlowMagnitude:r}){const i={incoming:new Map,outgoing:new Map};for(const o of n){const a=e(o),l=t(o),h=r(o);i.incoming.set(l,(i.incoming.get(l)||0)+h),i.outgoing.set(a,(i.outgoing.get(a)||0)+h)}return o=>Math.max(Math.abs(i.incoming.get(o)||0),Math.abs(i.outgoing.get(o)||0))}function bre(n,e){if(!n.length)throw new Error("No available zoom levels");return n[Math.min(Ree(n,Math.floor(e)),n.length-1)]}class uA{constructor(e){this.getLocationId=t=>a_(t)?t.id:this.accessors.getLocationId(t),this.getLocationName=t=>{let r;return a_(t)&&AC(t)?r=t.name:this.accessors.getLocationName&&(r=this.accessors.getLocationName(t)),r||(r=`${this.getLocationId(t)}`),r},this.getLocationLat=t=>a_(t)?t.lat:this.accessors.getLocationLat(t),this.getLocationLon=t=>a_(t)?t.lon:this.accessors.getLocationLon(t),this.getFlowOriginId=t=>IC(t)?t.origin:this.accessors.getFlowOriginId(t),this.getFlowDestId=t=>IC(t)?t.dest:this.accessors.getFlowDestId(t),this.getFlowMagnitude=t=>IC(t)?t.count:this.accessors.getFlowMagnitude(t),this.getFlowTime=t=>{const{getFlowTime:r}=this.accessors;return r?r(t):void 0},this.accessors=e}setAccessors(e){this.accessors=e}getFlowmapDataAccessors(){return this.accessors}}const wre=(n,e=0)=>{const t=e,r=new KK({...n,width:n.width+t*2,height:n.height+t*2}).getBounds();return[r[0][0],r[0][1],r[1][0],r[1][1]]},xre=n=>{if(n)return I3().range([.025,.5]).domain([0,Math.max.apply(null,n.map(e=>Math.abs(e||0)))])};function Ere(n,e,t,r,i){const{getLocationId:o,getLocationName:a,getLocationClusterName:l}=r,h=p=>{const g=t.get(p);return g?a?a(g):o(g)||p:`"${p}"`};for(const p of e)for(const g of p.nodes)if(AC(g)){const _=n.expandCluster(g);if(_.sort((x,C)=>S1(i(x),i(C))),l)g.name=l(_);else{const x=_[0],C=_.length===2?_[1]:void 0;g.name=`"${h(x)}" and ${C?`"${h(C)}"`:`${_.length-1} others`}`}}else g.name=h(g.id)}ig("%Y-%m-%d"),ig("%Y-%m-%d %H:%M"),ig("%Y-%m-%d %H:%M:%S"),ig("%Y"),ig("%Y-%m");var nh;(function(n){n.SECOND="SECOND",n.MINUTE="MINUTE",n.HOUR="HOUR",n.DAY="DAY",n.MONTH="MONTH",n.YEAR="YEAR"})(nh||(nh={})),ba(".%L");const Tre=ba(":%S"),Sre=ba("%I:%M"),Cre=ba("%I %p"),Are=ba("%a %d");ba("%b %d");const Ire=ba("%b"),Pre=ba("%Y"),v_=[{order:0,key:nh.SECOND,interval:k3,format:Tre,formatFull:ba("%Y-%m-%d %H:%M:%S")},{order:1,key:nh.MINUTE,interval:O3,format:Sre,formatFull:ba("%Y-%m-%d %H:%M")},{order:2,key:nh.HOUR,interval:L3,format:Cre,formatFull:ba("%a %d %b %Y, %I %p")},{order:3,key:nh.DAY,interval:R1,format:Are,formatFull:ba("%a %d %b %Y")},{order:4,key:nh.MONTH,interval:F3,format:Ire,formatFull:ba("%b %Y")},{order:5,key:nh.YEAR,interval:th,format:Pre,formatFull:ba("%Y")}];function g4(n){return v_.find(e=>e.key===n)}function Mre(n){return v_.find(e=>e.order===n)}function Rre(n){let e;for(const t of v_){const{interval:r}=t;if(r(n)<n)return e||t;e=t}return v_[v_.length-1]}const kre=20;class Ore{constructor(e){this.getFlowsFromProps=(t,r)=>r.flows,this.getLocationsFromProps=(t,r)=>r.locations,this.getClusterLevelsFromProps=(t,r)=>r.clusterLevels,this.getMaxTopFlowsDisplayNum=(t,r)=>t.settings.maxTopFlowsDisplayNum,this.getSelectedLocations=(t,r)=>{var i;return(i=t.filter)==null?void 0:i.selectedLocations},this.getLocationFilterMode=(t,r)=>{var i;return(i=t.filter)==null?void 0:i.locationFilterMode},this.getClusteringEnabled=(t,r)=>t.settings.clusteringEnabled,this.getLocationTotalsEnabled=(t,r)=>t.settings.locationTotalsEnabled,this.getLocationLabelsEnabled=(t,r)=>t.settings.locationLabelsEnabled,this.getZoom=(t,r)=>t.viewport.zoom,this.getViewport=(t,r)=>t.viewport,this.getSelectedTimeRange=(t,r)=>{var i;return(i=t.filter)==null?void 0:i.selectedTimeRange},this.getColorScheme=(t,r)=>t.settings.colorScheme,this.getDarkMode=(t,r)=>t.settings.darkMode,this.getFadeEnabled=(t,r)=>t.settings.fadeEnabled,this.getFadeOpacityEnabled=(t,r)=>t.settings.fadeOpacityEnabled,this.getFadeAmount=(t,r)=>t.settings.fadeAmount,this.getAnimate=(t,r)=>t.settings.animationEnabled,this.getInvalidLocationIds=Dn(this.getLocationsFromProps,t=>{if(!t)return;const r=[];for(const i of t){const o=this.accessors.getLocationId(i),a=this.accessors.getLocationLon(i),l=this.accessors.getLocationLat(i);(!(-90<=l&&l<=90)||!(-180<=a&&a<=180))&&r.push(o)}return r.length>0?r:void 0}),this.getLocations=Dn(this.getLocationsFromProps,this.getInvalidLocationIds,(t,r)=>{if(!t)return;if(!r||r.length===0)return t;const i=new Set(r),o=[];for(const a of t){const l=this.accessors.getLocationId(a);i.has(l)||o.push(a)}return o}),this.getLocationIds=Dn(this.getLocations,t=>{if(!t)return;const r=new Set;for(const i of t)r.add(this.accessors.getLocationId(i));return r}),this.getSelectedLocationsSet=Dn(this.getSelectedLocations,t=>t&&t.length>0?new Set(t):void 0),this.getSortedFlowsForKnownLocations=Dn(this.getFlowsFromProps,this.getLocationIds,(t,r)=>{if(!r||!t)return;const i=[];for(const o of t){const a=this.accessors.getFlowOriginId(o),l=this.accessors.getFlowDestId(o);r.has(a)&&r.has(l)&&i.push(o)}return i.sort((o,a)=>S1(Math.abs(this.accessors.getFlowMagnitude(o)),Math.abs(this.accessors.getFlowMagnitude(a))))}),this.getActualTimeExtent=Dn(this.getSortedFlowsForKnownLocations,t=>{if(!t)return;let r=null,i=null;for(const o of t){const a=this.accessors.getFlowTime(o);a&&((r==null||r>a)&&(r=a),(i==null||i<a)&&(i=a))}if(!(!r||!i))return[r,i]}),this.getTimeGranularityKey=Dn(this.getSortedFlowsForKnownLocations,this.getActualTimeExtent,(t,r)=>{if(!t||!r)return;const i=f3(t,a=>{const l=this.accessors.getFlowTime(a);return l?Rre(l).order:null});if(i==null)return;const o=Mre(i);return o?o.key:void 0}),this.getTimeExtent=Dn(this.getActualTimeExtent,this.getTimeGranularityKey,(t,r)=>{const i=r?g4(r):void 0;if(!t||!(i!=null&&i.interval))return;const{interval:o}=i;return[t[0],o.offset(o.floor(t[1]),1)]}),this.getSortedFlowsForKnownLocationsFilteredByTime=Dn(this.getSortedFlowsForKnownLocations,this.getTimeExtent,this.getSelectedTimeRange,(t,r,i)=>{if(t)return!r||!i||r[0]===i[0]&&r[1]===i[1]?t:t.filter(o=>{const a=this.accessors.getFlowTime(o);return a&&i[0]<=a&&a<i[1]})}),this.getLocationsHavingFlows=Dn(this.getSortedFlowsForKnownLocations,this.getLocations,(t,r)=>{if(!r||!t)return r;const i=new Set;for(const a of t)i.add(this.accessors.getFlowOriginId(a)),i.add(this.accessors.getFlowDestId(a));const o=[];for(const a of r)i.has(this.accessors.getLocationId(a))&&o.push(a);return o}),this.getLocationsById=Dn(this.getLocationsHavingFlows,t=>{if(!t)return;const r=new Map;for(const i of t)r.set(this.accessors.getLocationId(i),i);return r}),this.getLocationWeightGetter=Dn(this.getSortedFlowsForKnownLocations,t=>t?vre(t,this.accessors.getFlowmapDataAccessors()):void 0),this.getClusterLevels=Dn(this.getClusterLevelsFromProps,this.getLocationsHavingFlows,this.getLocationWeightGetter,(t,r,i)=>t||(!r||!i?void 0:cre(r,this.accessors.getFlowmapDataAccessors(),i,{maxZoom:kre}))),this.getClusterIndex=Dn(this.getLocationsById,this.getLocationWeightGetter,this.getClusterLevels,(t,r,i)=>{if(!t||!r||!i)return;const o=_re(i);return Ere(o,i,t,this.accessors.getFlowmapDataAccessors(),r),o}),this.getAvailableClusterZoomLevels=Dn(this.getClusterIndex,this.getSelectedLocations,(t,r)=>{if(!t)return;let i=Number.POSITIVE_INFINITY,o=Number.NEGATIVE_INFINITY;const a=l=>{const h=t.getClusterById(l);if(h)o=Math.max(o,h.zoom),i=Math.min(i,h.zoom);else{const p=t.getMinZoomForLocation(l);o=Math.max(o,p)}};if(r)for(const l of r)a(l);return t.availableZoomLevels.filter(l=>o<=l&&l<=i)}),this._getClusterZoom=Dn(this.getClusterIndex,this.getZoom,this.getAvailableClusterZoomLevels,(t,r,i)=>!t||!i||r==null?void 0:bre(i,r)),this.getClusterZoom=(t,r)=>{const{settings:i}=t;if(i.clusteringEnabled)return i.clusteringAuto||i.clusteringLevel==null?this._getClusterZoom(t,r):i.clusteringLevel},this.getLocationsForSearchBox=Dn(this.getClusteringEnabled,this.getLocationsHavingFlows,this.getSelectedLocations,this.getClusterZoom,this.getClusterIndex,(t,r,i,o,a)=>{if(!r)return;let l=Array.from(r);if(a&&i){const h=[];for(const p of i){const g=a.getClusterById(p);g&&!l.find(_=>(a_(_)?_.id:this.accessors.getLocationId(_))===p)&&h.push(g)}h.length>0&&(l=l.concat(h))}return l}),this.getDiffMode=Dn(this.getFlowsFromProps,t=>{if(t){for(const r of t)if(this.accessors.getFlowMagnitude(r)<0)return!0}return!1}),this._getFlowmapColors=Dn(this.getDiffMode,this.getColorScheme,this.getDarkMode,this.getFadeEnabled,this.getFadeOpacityEnabled,this.getFadeAmount,this.getAnimate,o4),this.getFlowmapColorsRGBA=Dn(this._getFlowmapColors,t=>Dne(t)?Une(t):Bne(t)),this.getUnknownLocations=Dn(this.getLocationIds,this.getFlowsFromProps,this.getSortedFlowsForKnownLocations,(t,r,i)=>{if(!t||!r||i)return;const o=new Set;for(const a of r)t.has(this.accessors.getFlowOriginId(a))||o.add(this.accessors.getFlowOriginId(a)),t.has(this.accessors.getFlowDestId(a))||o.add(this.accessors.getFlowDestId(a));return o}),this.getSortedAggregatedFilteredFlows=Dn(this.getClusterIndex,this.getClusteringEnabled,this.getSortedFlowsForKnownLocationsFilteredByTime,this.getClusterZoom,this.getTimeExtent,(t,r,i,o,a)=>{if(!i)return;let l;return r&&t&&o!=null?l=t.aggregateFlows(i,o,this.accessors.getFlowmapDataAccessors()):l=Lre(i,this.accessors.getFlowmapDataAccessors()),l.sort((h,p)=>S1(Math.abs(this.accessors.getFlowMagnitude(h)),Math.abs(this.accessors.getFlowMagnitude(p)))),l}),this.getExpandedSelectedLocationsSet=Dn(this.getClusteringEnabled,this.getSelectedLocationsSet,this.getClusterIndex,(t,r,i)=>{if(!r||!i)return r;const o=new Set;for(const a of r){const l=i.getClusterById(a);if(l){const h=i.expandCluster(l);for(const p of h)o.add(p)}else o.add(a)}return o}),this.getTotalCountsByTime=Dn(this.getSortedFlowsForKnownLocations,this.getTimeGranularityKey,this.getTimeExtent,this.getExpandedSelectedLocationsSet,this.getLocationFilterMode,(t,r,i,o,a)=>{const l=r?g4(r):void 0;if(!t||!l||!i)return;const h=t.reduce((p,g)=>{if(this.isFlowInSelection(g,o,a)){const _=l.interval(this.accessors.getFlowTime(g)).getTime();p.set(_,(p.get(_)??0)+this.accessors.getFlowMagnitude(g))}return p},new Map);return Array.from(h.entries()).map(([p,g])=>({time:new Date(p),count:g}))}),this.getMaxLocationCircleSize=Dn(this.getLocationTotalsEnabled,t=>t?17:1),this.getViewportBoundingBox=Dn(this.getViewport,this.getMaxLocationCircleSize,wre),this.getLocationsForZoom=Dn(this.getClusteringEnabled,this.getLocationsHavingFlows,this.getClusterIndex,this.getClusterZoom,(t,r,i,o)=>t&&i?i.getClusterNodesFor(o):r),this.getLocationTotals=Dn(this.getLocationsForZoom,this.getSortedAggregatedFilteredFlows,this.getSelectedLocationsSet,this.getLocationFilterMode,(t,r,i,o)=>{if(!r)return;const a=new Map,l=(h,p)=>{const g=a.get(h)??{incomingCount:0,outgoingCount:0,internalCount:0};return p.incomingCount!=null&&(g.incomingCount+=p.incomingCount),p.outgoingCount!=null&&(g.outgoingCount+=p.outgoingCount),p.internalCount!=null&&(g.internalCount+=p.internalCount),g};for(const h of r)if(this.isFlowInSelection(h,i,o)){const p=this.accessors.getFlowOriginId(h),g=this.accessors.getFlowDestId(h),_=this.accessors.getFlowMagnitude(h);p===g?a.set(p,l(p,{internalCount:_})):(a.set(p,l(p,{outgoingCount:_})),a.set(g,l(g,{incomingCount:_})))}return a}),this.getLocationsTree=Dn(this.getLocationsForZoom,t=>{if(!t)return;const r=Array.isArray(t)?t:Array.from(t),i=new L1(r.length,64,Float32Array);for(let o=0;o<r.length;o++){const a=r[o];i.add(hA(this.accessors.getLocationLon(a)),dA(this.accessors.getLocationLat(a)))}return i.finish(),i.points=r,i}),this._getLocationIdsInViewport=Dn(this.getLocationsTree,this.getViewportBoundingBox,(t,r)=>{const i=this._getLocationsInBboxIndices(t,r);if(i)return new Set(i.map(o=>t.points[o].id))}),this.getLocationIdsInViewport=d4(h4,(t,r,i)=>{if(t===r)return!0;if(t==null||r==null||t.size!==r.size)return!1;for(const o of t)if(!r.has(o))return!1;return!0})(this._getLocationIdsInViewport,t=>{if(t)return t}),this.getTotalUnfilteredCount=Dn(this.getSortedFlowsForKnownLocations,t=>{if(t)return t.reduce((r,i)=>r+this.accessors.getFlowMagnitude(i),0)}),this.getTotalFilteredCount=Dn(this.getSortedAggregatedFilteredFlows,this.getSelectedLocationsSet,this.getLocationFilterMode,(t,r,i)=>t?t.reduce((a,l)=>this.isFlowInSelection(l,r,i)?a+this.accessors.getFlowMagnitude(l):a,0):void 0),this._getLocationTotalsExtent=Dn(this.getLocationTotals,t=>m4(t,void 0)),this._getLocationTotalsForViewportExtent=Dn(this.getLocationTotals,this.getLocationIdsInViewport,(t,r)=>m4(t,r)),this.getLocationTotalsExtent=(t,r)=>t.settings.adaptiveScalesEnabled?this._getLocationTotalsForViewportExtent(t,r):this._getLocationTotalsExtent(t,r),this.getFlowsForFlowmapLayer=Dn(this.getSortedAggregatedFilteredFlows,this.getLocationIdsInViewport,this.getSelectedLocationsSet,this.getLocationFilterMode,this.getMaxTopFlowsDisplayNum,(t,r,i,o,a)=>{if(!t||!r)return;const l=[];let h=0;for(const p of t){const g=this.accessors.getFlowOriginId(p),_=this.accessors.getFlowDestId(p);if((r.has(g)||r.has(_))&&this.isFlowInSelection(p,i,o)&&g!==_&&(l.push(p),h++),h>a)break}return l.reverse()}),this._getFlowMagnitudeExtent=Dn(this.getSortedAggregatedFilteredFlows,this.getSelectedLocationsSet,this.getLocationFilterMode,(t,r,i)=>{if(!t)return;let o;for(const a of t)if(this.accessors.getFlowOriginId(a)!==this.accessors.getFlowDestId(a)&&this.isFlowInSelection(a,r,i)){const l=this.accessors.getFlowMagnitude(a);o==null?o=[l,l]:(l<o[0]&&(o[0]=l),l>o[1]&&(o[1]=l))}return o}),this._getAdaptiveFlowMagnitudeExtent=Dn(this.getFlowsForFlowmapLayer,t=>{if(!t)return;const r=UC(t,this.accessors.getFlowMagnitude);return r[0]!==void 0&&r[1]!==void 0?r:void 0}),this.getFlowMagnitudeExtent=(t,r)=>t.settings.adaptiveScalesEnabled?this._getAdaptiveFlowMagnitudeExtent(t,r):this._getFlowMagnitudeExtent(t,r),this.getLocationMaxAbsTotalGetter=Dn(this.getLocationTotals,t=>r=>{const i=t==null?void 0:t.get(r);if(i)return Math.max(Math.abs(i.incomingCount+i.internalCount),Math.abs(i.outgoingCount+i.internalCount))}),this.getFlowThicknessScale=Dn(this.getFlowMagnitudeExtent,xre),this.getCircleSizeScale=Dn(this.getMaxLocationCircleSize,this.getLocationTotalsEnabled,this.getLocationTotalsExtent,(t,r,i)=>{if(!r)return()=>t;if(i)return lte().range([0,t]).domain([0,Math.max.apply(null,i.map(o=>Math.abs(o||0)))])}),this.getInCircleSizeGetter=Dn(this.getCircleSizeScale,this.getLocationTotals,(t,r)=>i=>{const o=r==null?void 0:r.get(i);return o&&t&&t(Math.abs(o.incomingCount+o.internalCount))||0}),this.getOutCircleSizeGetter=Dn(this.getCircleSizeScale,this.getLocationTotals,(t,r)=>i=>{const o=r==null?void 0:r.get(i);return o&&t&&t(Math.abs(o.outgoingCount+o.internalCount))||0}),this.getSortedLocationsForZoom=Dn(this.getLocationsForZoom,this.getInCircleSizeGetter,this.getOutCircleSizeGetter,(t,r,i)=>t?[...t].sort((a,l)=>{const h=this.accessors.getLocationId(a),p=this.accessors.getLocationId(l);return Jp(Math.max(r(h),i(h)),Math.max(r(p),i(p)))}):void 0),this.getLocationsForFlowmapLayer=Dn(this.getSortedLocationsForZoom,t=>t),this.getLocationsForFlowmapLayerById=Dn(this.getLocationsForFlowmapLayer,t=>{if(t)return t.reduce((r,i)=>(r.set(this.accessors.getLocationId(i),i),r),new Map)}),this.getLocationOrClusterByIdGetter=Dn(this.getClusterIndex,this.getLocationsById,(t,r)=>i=>(t==null?void 0:t.getClusterById(i))??(r==null?void 0:r.get(i))),this.getLayersData=Dn(this.getLocationsForFlowmapLayer,this.getFlowsForFlowmapLayer,this.getFlowmapColorsRGBA,this.getLocationsForFlowmapLayerById,this.getLocationIdsInViewport,this.getInCircleSizeGetter,this.getOutCircleSizeGetter,this.getFlowThicknessScale,this.getAnimate,this.getLocationLabelsEnabled,(t,r,i,o,a,l,h,p,g,_)=>this._prepareLayersData(t,r,i,o,a,l,h,p,g,_)),this.accessors=new uA(e),this.setAccessors(e)}setAccessors(e){this.accessors=new uA(e)}getAggregateAccessors(){return this.accessors}prepareLayersData(e,t){const r=this.getLocationsForFlowmapLayer(e,t)||[],i=this.getFlowsForFlowmapLayer(e,t)||[],o=this.getFlowmapColorsRGBA(e,t),a=this.getLocationsForFlowmapLayerById(e,t),l=this.getLocationIdsInViewport(e,t),h=this.getInCircleSizeGetter(e,t),p=this.getOutCircleSizeGetter(e,t),g=this.getFlowThicknessScale(e,t),_=this.getLocationLabelsEnabled(e,t);return this._prepareLayersData(r,i,o,a,l,h,p,g,e.settings.animationEnabled,_)}_prepareLayersData(e,t,r,i,o,a,l,h,p,g){e||(e=[]),t||(t=[]);const{getFlowOriginId:_,getFlowDestId:x,getFlowMagnitude:C,getLocationId:M,getLocationLon:L,getLocationLat:F,getLocationName:z}=this.accessors,ee=UC(t,Ze=>C(Ze)),ce=Nne(r,ee,!1),se=Float32Array.from(function*(){for(const Ze of e)yield L(Ze),yield F(Ze)}()),_e=a4(r)?r.positive.locationCircles.inner:r.locationCircles.inner,J=Uint8Array.from(function*(){for(const Ze of e)yield*_e}()),pe=Float32Array.from(function*(){for(const Ze of e){const at=M(Ze);yield o!=null&&o.has(at)?a(at):1}}()),ue=Float32Array.from(function*(){for(const Ze of e){const at=M(Ze);yield o!=null&&o.has(at)?l(at):1}}()),xe=Float32Array.from(function*(){for(const Ze of t){const at=i==null?void 0:i.get(_(Ze));yield at?L(at):0,yield at?F(at):0}}()),je=Float32Array.from(function*(){for(const Ze of t){const at=i==null?void 0:i.get(x(Ze));yield at?L(at):0,yield at?F(at):0}}()),ne=Float32Array.from(function*(){for(const Ze of t)yield h&&h(C(Ze))||0}()),Ee=Float32Array.from(function*(){for(const Ze of t){const at=_(Ze),Re=x(Ze);yield Math.max(a(at),l(at)),yield Math.max(a(Re),l(Re))}}()),ke=Uint8Array.from(function*(){for(const Ze of t)yield*ce(C(Ze))}()),Be=p?Float32Array.from(function*(){for(const Ze of t)yield new ore.alea(`${_(Ze)}-${x(Ze)}`)()}()):void 0;return{circleAttributes:{length:e.length,attributes:{getPosition:{value:se,size:2},getColor:{value:J,size:4},getInRadius:{value:pe,size:1},getOutRadius:{value:ue,size:1}}},lineAttributes:{length:t.length,attributes:{getSourcePosition:{value:xe,size:2},getTargetPosition:{value:je,size:2},getThickness:{value:ne,size:1},getColor:{value:ke,size:4},getEndpointOffsets:{value:Ee,size:2},...Be?{getStaggering:{value:Be,size:1}}:{}}},...g?{locationLabels:e.map(z)}:void 0}}getLocationsInBbox(e,t){if(e)return this._getLocationsInBboxIndices(e,t).map(r=>e.points[r])}_getLocationsInBboxIndices(e,t){if(!e)return;const[r,i,o,a]=t,[l,h,p,g]=[hA(r),dA(i),hA(o),dA(a)];return e.range(Math.min(l,p),Math.min(h,g),Math.max(l,p),Math.max(h,g))}isFlowInSelection(e,t,r){const i=this.accessors.getFlowOriginId(e),o=this.accessors.getFlowDestId(e);if(t)switch(r){case Wp.ALL:return t.has(i)||t.has(o);case Wp.BETWEEN:return t.has(i)&&t.has(o);case Wp.INCOMING:return t.has(o);case Wp.OUTGOING:return t.has(i)}return!0}}function m4(n,e){if(!n)return;let t;for(const[r,{incomingCount:i,outgoingCount:o,internalCount:a}]of n.entries())if(e==null||e.has(r)){const l=Math.min(i+a,o+a,a),h=Math.max(i+a,o+a,a);t?(l<t[0]&&(t[0]=l),h>t[1]&&(t[1]=h)):t=[l,h]}return t}function hA(n){return n/360+.5}function dA(n){const e=Math.sin(n*Math.PI/180),t=.5-.25*Math.log((1+e)/(1-e))/Math.PI;return t<0?0:t>1?1:t}function Lre(n,e){const t=d3(n,i=>{const o=e.getFlowOriginId(i[0]),a=e.getFlowDestId(i[0]);return{aggregate:!0,origin:o,dest:a,count:i.reduce((h,p)=>{const g=e.getFlowMagnitude(p);return g&&!isNaN(g)&&isFinite(g)?h+g:h},0)}},e.getFlowOriginId,e.getFlowDestId),r=[];for(const i of t.values())for(const o of i.values())r.push(o);return r}function fA(n,e){const{getInRadius:t,getOutRadius:r}=n.attributes;return Math.max(t.value[e],r.value[e])}function y4(n,e){const{getPosition:t}=n.attributes;return[t.value[e*2],t.value[e*2+1]]}function Nre(n,e){const{getColor:t,getEndpointOffsets:r,getSourcePosition:i,getTargetPosition:o,getThickness:a,getStaggering:l}=n.attributes;return{length:1,attributes:{getColor:{value:t.value.subarray(e*4,(e+1)*4),size:4},getEndpointOffsets:{value:r.value.subarray(e*2,(e+1)*2),size:2},getSourcePosition:{value:i.value.subarray(e*2,(e+1)*2),size:2},getTargetPosition:{value:o.value.subarray(e*2,(e+1)*2),size:2},getThickness:{value:a.value.subarray(e,e+1),size:1},...l?{getStaggering:{value:l.value.subarray(e,e+1),size:1}}:void 0}}}var pA=1e-6,b_=Math.PI,_4=b_/2,v4=b_/4,b4=b_*2,gA=180/b_,ag=b_/180,mA=Math.abs,w4=Math.atan2,w_=Math.cos,x_=Math.sin,Dre=Math.sqrt;function Fre(n){return n>1?_4:n<-1?-_4:Math.asin(n)}function D1(){}function F1(n,e){n&&E4.hasOwnProperty(n.type)&&E4[n.type](n,e)}var x4={Feature:function(n,e){F1(n.geometry,e)},FeatureCollection:function(n,e){for(var t=n.features,r=-1,i=t.length;++r<i;)F1(t[r].geometry,e)}},E4={Sphere:function(n,e){e.sphere()},Point:function(n,e){n=n.coordinates,e.point(n[0],n[1],n[2])},MultiPoint:function(n,e){for(var t=n.coordinates,r=-1,i=t.length;++r<i;)n=t[r],e.point(n[0],n[1],n[2])},LineString:function(n,e){yA(n.coordinates,e,0)},MultiLineString:function(n,e){for(var t=n.coordinates,r=-1,i=t.length;++r<i;)yA(t[r],e,0)},Polygon:function(n,e){T4(n.coordinates,e)},MultiPolygon:function(n,e){for(var t=n.coordinates,r=-1,i=t.length;++r<i;)T4(t[r],e)},GeometryCollection:function(n,e){for(var t=n.geometries,r=-1,i=t.length;++r<i;)F1(t[r],e)}};function yA(n,e,t){var r=-1,i=n.length-t,o;for(e.lineStart();++r<i;)o=n[r],e.point(o[0],o[1],o[2]);e.lineEnd()}function T4(n,e){var t=-1,r=n.length;for(e.polygonStart();++t<r;)yA(n[t],e,1);e.polygonEnd()}function Bre(n,e){n&&x4.hasOwnProperty(n.type)?x4[n.type](n,e):F1(n,e)}var B1=new C1,S4=new C1,C4,A4,_A,vA,bA,Gl={point:D1,lineStart:D1,lineEnd:D1,polygonStart:function(){B1=new C1,Gl.lineStart=Ure,Gl.lineEnd=zre},polygonEnd:function(){var n=+B1;S4.add(n<0?b4+n:n),this.lineStart=this.lineEnd=this.point=D1},sphere:function(){S4.add(b4)}};function Ure(){Gl.point=jre}function zre(){I4(C4,A4)}function jre(n,e){Gl.point=I4,C4=n,A4=e,n*=ag,e*=ag,_A=n,vA=w_(e=e/2+v4),bA=x_(e)}function I4(n,e){n*=ag,e*=ag,e=e/2+v4;var t=n-_A,r=t>=0?1:-1,i=r*t,o=w_(e),a=x_(e),l=bA*a,h=vA*o+l*w_(i),p=l*r*x_(i);B1.add(w4(p,h)),_A=n,vA=o,bA=a}function Vre(n){return[w4(n[1],n[0]),Fre(n[2])]}function Hre(n){var e=n[0],t=n[1],r=w_(t);return[r*w_(e),r*x_(e),x_(t)]}function P4(n,e){return[n[1]*e[2]-n[2]*e[1],n[2]*e[0]-n[0]*e[2],n[0]*e[1]-n[1]*e[0]]}function Gre(n){var e=Dre(n[0]*n[0]+n[1]*n[1]+n[2]*n[2]);n[0]/=e,n[1]/=e,n[2]/=e}var Di,ja,Hi,vs,jd,M4,R4,sg,E_,rh,ql,$l={point:wA,lineStart:O4,lineEnd:L4,polygonStart:function(){$l.point=N4,$l.lineStart=qre,$l.lineEnd=$re,E_=new C1,Gl.polygonStart()},polygonEnd:function(){Gl.polygonEnd(),$l.point=wA,$l.lineStart=O4,$l.lineEnd=L4,B1<0?(Di=-(Hi=180),ja=-(vs=90)):E_>pA?vs=90:E_<-pA&&(ja=-90),ql[0]=Di,ql[1]=Hi},sphere:function(){Di=-(Hi=180),ja=-(vs=90)}};function wA(n,e){rh.push(ql=[Di=n,Hi=n]),e<ja&&(ja=e),e>vs&&(vs=e)}function k4(n,e){var t=Hre([n*ag,e*ag]);if(sg){var r=P4(sg,t),i=[r[1],-r[0],0],o=P4(i,r);Gre(o),o=Vre(o);var a=n-jd,l=a>0?1:-1,h=o[0]*gA*l,p,g=mA(a)>180;g^(l*jd<h&&h<l*n)?(p=o[1]*gA,p>vs&&(vs=p)):(h=(h+360)%360-180,g^(l*jd<h&&h<l*n)?(p=-o[1]*gA,p<ja&&(ja=p)):(e<ja&&(ja=e),e>vs&&(vs=e))),g?n<jd?bs(Di,n)>bs(Di,Hi)&&(Hi=n):bs(n,Hi)>bs(Di,Hi)&&(Di=n):Hi>=Di?(n<Di&&(Di=n),n>Hi&&(Hi=n)):n>jd?bs(Di,n)>bs(Di,Hi)&&(Hi=n):bs(n,Hi)>bs(Di,Hi)&&(Di=n)}else rh.push(ql=[Di=n,Hi=n]);e<ja&&(ja=e),e>vs&&(vs=e),sg=t,jd=n}function O4(){$l.point=k4}function L4(){ql[0]=Di,ql[1]=Hi,$l.point=wA,sg=null}function N4(n,e){if(sg){var t=n-jd;E_.add(mA(t)>180?t+(t>0?360:-360):t)}else M4=n,R4=e;Gl.point(n,e),k4(n,e)}function qre(){Gl.lineStart()}function $re(){N4(M4,R4),Gl.lineEnd(),mA(E_)>pA&&(Di=-(Hi=180)),ql[0]=Di,ql[1]=Hi,sg=null}function bs(n,e){return(e-=n)<0?e+360:e}function Wre(n,e){return n[0]-e[0]}function D4(n,e){return n[0]<=n[1]?n[0]<=e&&e<=n[1]:e<n[0]||n[1]<e}function Yre(n){var e,t,r,i,o,a,l;if(vs=Hi=-(Di=ja=1/0),rh=[],Bre(n,$l),t=rh.length){for(rh.sort(Wre),e=1,r=rh[0],o=[r];e<t;++e)i=rh[e],D4(r,i[0])||D4(r,i[1])?(bs(r[0],i[1])>bs(r[0],r[1])&&(r[1]=i[1]),bs(i[0],r[1])>bs(r[0],r[1])&&(r[0]=i[0])):o.push(r=i);for(a=-1/0,t=o.length-1,e=0,r=o[t];e<=t;r=i,++e)i=o[e],(l=bs(r[1],i[0]))>a&&(a=l,Di=i[0],Hi=r[1])}return rh=ql=null,Di===1/0||ja===1/0?[[NaN,NaN],[NaN,NaN]]:[[Di,ja],[Hi,vs]]}function Kre(n,e,t){const{pad:r=.05,maxZoom:i=100}=t||{},o=Yre(n),[[a,l],[h,p]]=o,g=r?[[a-r*(h-a),l-r*(p-l)],[h+r*(h-a),p+r*(p-l)]]:o,[_,x]=e;return{...KS({width:_,height:x,bounds:g,padding:t==null?void 0:t.padding,maxZoom:i}),width:_,height:x,bearing:0,pitch:0}}function F4(n,e,t,r){const i=a=>({type:"Point",coordinates:e(a)});let o;if(Array.isArray(n))o=n.map(i);else{o=[];for(const a of n)o.push(i(a))}return Kre({type:"GeometryCollection",geometries:o},t,r)}function Zre(n){return n&&n.locations&&n.flows}function Xre(n){return n&&typeof n.setFlowmapState=="function"&&typeof n.getViewportForLocations=="function"&&typeof n.getFlowByIndex=="function"&&typeof n.getLocationById=="function"&&typeof n.getLocationByIndex=="function"&&typeof n.getLayersData=="function"}class Qre{constructor(e){this.selectors=new Ore(e),this.flowmapData=void 0,this.flowmapState=void 0}setAccessors(e){this.selectors.setAccessors(e)}setFlowmapData(e){this.flowmapData=e}getSelectors(){return this.selectors}getFlowmapData(){return this.flowmapData}async setFlowmapState(e){this.flowmapState=e}getFlowmapState(){return this.flowmapState}async getFlowByIndex(e){if(!this.flowmapState||!this.flowmapData)return;const t=this.selectors.getFlowsForFlowmapLayer(this.flowmapState,this.flowmapData);return t==null?void 0:t[e]}async getLocationByIndex(e){if(!this.flowmapState||!this.flowmapData)return;const t=this.selectors.getLocationsForFlowmapLayer(this.flowmapState,this.flowmapData);return t==null?void 0:t[e]}async getLayersData(){if(!(!this.flowmapState||!this.flowmapData))return this.selectors.getLayersData(this.flowmapState,this.flowmapData)}async getLocationById(e){if(!this.flowmapState||!this.flowmapData)return;const t=this.selectors.getClusterIndex(this.flowmapState,this.flowmapData);if(t){const i=t.getClusterById(e);if(i)return i}const r=this.selectors.getLocationsById(this.flowmapState,this.flowmapData);return r==null?void 0:r.get(e)}async getTotalsForLocation(e){var t;if(!(!this.flowmapState||!this.flowmapData))return(t=this.selectors.getLocationTotals(this.flowmapState,this.flowmapData))==null?void 0:t.get(e)}async getViewportForLocations(e,t){var r;if((r=this.flowmapData)!=null&&r.locations)return F4(this.flowmapData.locations,i=>[this.selectors.accessors.getLocationLon(i),this.selectors.accessors.getLocationLat(i)],e,t)}async updateLayersData(e){e(await this.getLayersData())}getClusterZoom(){return this.flowmapState&&this.flowmapData?this.selectors.getClusterZoom(this.flowmapState,this.flowmapData):void 0}getClusterIndex(){return this.flowmapState&&this.flowmapData?this.selectors.getClusterIndex(this.flowmapState,this.flowmapData):void 0}getLocationsById(){return this.flowmapState&&this.flowmapData?this.selectors.getLocationsById(this.flowmapState,this.flowmapData):void 0}getLocationTotals(){return this.flowmapState&&this.flowmapData?this.selectors.getLocationTotals(this.flowmapState,this.flowmapData):void 0}getFlowsForFlowmapLayer(){return this.flowmapState&&this.flowmapData?this.selectors.getFlowsForFlowmapLayer(this.flowmapState,this.flowmapData):void 0}}var cg;(function(n){n.LOCATION="location",n.FLOW="flow"})(cg||(cg={}));const Jre=["filter","locationsEnabled","locationTotalsEnabled","locationLabelsEnabled","adaptiveScalesEnabled","animationEnabled","clusteringEnabled","clusteringLevel","fadeEnabled","fadeOpacityEnabled","clusteringAuto","darkMode","fadeAmount","colorScheme","highlightColor","maxTopFlowsDisplayNum"];var lg;(function(n){n.LOCATION="location",n.FLOW="flow"})(lg||(lg={}));class B4 extends vC{constructor(e){super({...e,onHover:(t,r)=>{const i=Date.now();this.setState({highlightedObject:this._getHighlightedObject(t),lastHoverTime:i});const{onHover:o}=e;o&&this._getFlowmapLayerPickingInfo(t).then(a=>{var l;(((l=this.state)==null?void 0:l.lastHoverTime)??0)<=i&&(this.setState({pickingInfo:a}),o(a,r))})},onClick:(t,r)=>{const{onClick:i}=e,o=Date.now();this.setState({lastClickTime:o}),i&&this._getFlowmapLayerPickingInfo(t).then(a=>{var l;(((l=this.state)==null?void 0:l.lastClickTime)??0)<=o&&(this.setState({pickingInfo:a}),a&&i(a,r))})}})}initializeState(){this.state={accessors:new uA(this.props),dataProvider:this._getOrMakeDataProvider(),layersData:void 0,highlightedObject:void 0,pickingInfo:void 0,lastHoverTime:void 0,lastClickTime:void 0}}getPickingInfo({info:e}){var t,r;if(!e.object){const i=(r=(t=this.state)==null?void 0:t.pickingInfo)==null?void 0:r.object;if(i)return{...e,object:i,picked:!0}}return e}_getOrMakeDataProvider(){const{data:e,dataProvider:t}=this.props;if(Xre(t))return t;if(Zre(e)){const r=new Qre(this.props);return r.setFlowmapData(e),r}throw new Error("FlowmapLayer: data must be a FlowmapDataProvider or FlowmapData")}_updateDataProvider(){this.setState({dataProvider:this._getOrMakeDataProvider()})}shouldUpdateState(e){const{changeFlags:t}=e;return t.viewportChanged?!0:super.shouldUpdateState(e)}updateState({oldProps:e,props:t,changeFlags:r}){if(r.propsChanged,r.dataChanged&&this._updateDataProvider(),(r.viewportChanged||r.dataChanged)&&this.setState({highlightedObject:void 0}),r.viewportChanged||r.dataChanged||r.propsChanged&&Jre.some(i=>e[i]!==t[i])){const{dataProvider:i}=this.state||{};i&&(i.setFlowmapState(this._getFlowmapState()),i.updateLayersData(o=>{this.setState({layersData:o,highlightedObject:void 0})},r))}}_getSettingsState(){const{locationsEnabled:e,locationTotalsEnabled:t,locationLabelsEnabled:r,adaptiveScalesEnabled:i,animationEnabled:o,clusteringEnabled:a,clusteringLevel:l,fadeEnabled:h,fadeOpacityEnabled:p,clusteringAuto:g,darkMode:_,fadeAmount:x,colorScheme:C,highlightColor:M,maxTopFlowsDisplayNum:L}=this.props;return{locationsEnabled:e,locationTotalsEnabled:t,locationLabelsEnabled:r,adaptiveScalesEnabled:i,animationEnabled:o,clusteringEnabled:a,clusteringLevel:l,fadeEnabled:h,fadeOpacityEnabled:p,clusteringAuto:g,darkMode:_,fadeAmount:x,colorScheme:C,highlightColor:M,maxTopFlowsDisplayNum:L}}_getFlowmapState(){return{viewport:eie(this.context.viewport),filter:this.props.filter,settings:this._getSettingsState()}}async _getFlowmapLayerPickingInfo(e){var l;const{index:t,sourceLayer:r}=e,{dataProvider:i,accessors:o}=this.state||{};if(!i||!o)return;const a={...e,picked:e.picked,layer:e.layer,index:e.index,x:e.x,y:e.y,coordinate:e.coordinate,event:e.event};if(r instanceof qp||r instanceof f1){const h=t===-1?void 0:await i.getFlowByIndex(t);if(h){const p=await i.getLocationById(o.getFlowOriginId(h)),g=await i.getLocationById(o.getFlowDestId(h));if(p&&g)return{...a,object:{type:cg.FLOW,flow:h,origin:p,dest:g,count:o.getFlowMagnitude(h)}}}}else if(r instanceof r_){const h=t===-1?void 0:await i.getLocationByIndex(t);if(h){const p=o.getLocationId(h),g=o.getLocationName(h),_=await i.getTotalsForLocation(p),{circleAttributes:x}=((l=this.state)==null?void 0:l.layersData)||{};if(_&&x){const C=fA(x,e.index);return{...a,object:{type:cg.LOCATION,location:h,id:p,name:g,totals:_,circleRadius:C}}}}}}_getHighlightedObject(e){var i,o;const{index:t,sourceLayer:r}=e;if(!(t<0)){if(r instanceof qp||r instanceof f1){const{lineAttributes:a}=((i=this.state)==null?void 0:i.layersData)||{};if(a){let l=Nre(a,t);return this.props.fadeOpacityEnabled&&(l={...l,attributes:{...l.attributes,getColor:{...l.attributes.getColor,value:new Uint8Array([...l.attributes.getColor.value.slice(0,3),255])}}}),{type:lg.FLOW,lineAttributes:l}}}else if(r instanceof r_){const{circleAttributes:a}=((o=this.state)==null?void 0:o.layersData)||{};if(a)return{type:lg.LOCATION,coords:y4(a,t),radius:fA(a,t)}}}}renderLayers(){var t;const e=[];if((t=this.state)!=null&&t.layersData){const{layersData:r,highlightedObject:i}=this.state,{circleAttributes:o,lineAttributes:a,locationLabels:l}=r||{};if(o&&a){const h=One(this._getSettingsState()),p=Yc(h.outlineColor||(this.props.darkMode?"#000":"#fff")),g={data:a,parameters:{...this.props.parameters,depthTest:!1}};if(this.props.animationEnabled?e.push(new f1({...this.getSubLayerProps({...g,id:"animated-flow-lines",drawOutline:!1,thicknessUnit:20})})):e.push(new qp({...this.getSubLayerProps({...g,id:"flow-lines",drawOutline:!0,outlineColor:p})})),e.push(new r_(this.getSubLayerProps({id:"circles",data:o,emptyColor:this.props.darkMode?[0,0,0,255]:[255,255,255,255],outlineEmptyMix:.4}))),i)switch(i.type){case lg.LOCATION:e.push(new wC({...this.getSubLayerProps({id:"location-highlight",data:[i],pickable:!1,antialiasing:!0,stroked:!0,filled:!1,lineWidthUnits:"pixels",getLineWidth:2,radiusUnits:"pixels",getRadius:_=>_.radius,getLineColor:Yc(this.props.highlightColor),getPosition:_=>_.coords})}));break;case lg.FLOW:e.push(new qp({...this.getSubLayerProps({id:"flow-highlight",data:i.lineAttributes,drawOutline:!0,pickable:!1,outlineColor:Yc(this.props.highlightColor),outlineThickness:1,parameters:{depthTest:!1}})}));break}}l&&e.push(new CC(this.getSubLayerProps({id:"location-labels",data:l,maxWidth:1e3,pickable:!1,fontFamily:"Helvetica",getPixelOffset:(h,{index:p})=>[0,fA(o,p)+5],getPosition:(h,{index:p})=>y4(o,p),getText:h=>h,getSize:10,getColor:[255,255,255,255],getAngle:0,getTextAnchor:"middle",getAlignmentBaseline:"top"})))}return e}}B4.defaultProps={darkMode:!0,fadeAmount:50,locationsEnabled:!0,locationTotalsEnabled:!0,locationLabelsEnabled:!1,animationEnabled:!1,clusteringEnabled:!0,fadeEnabled:!0,fadeOpacityEnabled:!1,clusteringAuto:!0,clusteringLevel:void 0,adaptiveScalesEnabled:!0,colorScheme:"Teal",highlightColor:"orange",maxTopFlowsDisplayNum:5e3};function eie(n){const{width:e,height:t,longitude:r,latitude:i,zoom:o,pitch:a,bearing:l}=n;return{width:e,height:t,longitude:r,latitude:i,zoom:o,pitch:a,bearing:l}}var U4={},xA={},EA=34,T_=10,TA=13;function z4(n){return new Function("d","return {"+n.map(function(e,t){return JSON.stringify(e)+": d["+t+'] || ""'}).join(",")+"}")}function tie(n,e){var t=z4(n);return function(r,i){return e(t(r),i,n)}}function j4(n){var e=Object.create(null),t=[];return n.forEach(function(r){for(var i in r)i in e||t.push(e[i]=i)}),t}function Va(n,e){var t=n+"",r=t.length;return r<e?new Array(e-r+1).join(0)+t:t}function nie(n){return n<0?"-"+Va(-n,6):n>9999?"+"+Va(n,6):Va(n,4)}function rie(n){var e=n.getUTCHours(),t=n.getUTCMinutes(),r=n.getUTCSeconds(),i=n.getUTCMilliseconds();return isNaN(n)?"Invalid Date":nie(n.getUTCFullYear())+"-"+Va(n.getUTCMonth()+1,2)+"-"+Va(n.getUTCDate(),2)+(i?"T"+Va(e,2)+":"+Va(t,2)+":"+Va(r,2)+"."+Va(i,3)+"Z":r?"T"+Va(e,2)+":"+Va(t,2)+":"+Va(r,2)+"Z":t||e?"T"+Va(e,2)+":"+Va(t,2)+"Z":"")}function iie(n){var e=new RegExp('["'+n+`
\r]`),t=n.charCodeAt(0);function r(_,x){var C,M,L=i(_,function(F,z){if(C)return C(F,z-1);M=F,C=x?tie(F,x):z4(F)});return L.columns=M||[],L}function i(_,x){var C=[],M=_.length,L=0,F=0,z,ee=M<=0,ce=!1;_.charCodeAt(M-1)===T_&&--M,_.charCodeAt(M-1)===TA&&--M;function se(){if(ee)return xA;if(ce)return ce=!1,U4;var J,pe=L,ue;if(_.charCodeAt(pe)===EA){for(;L++<M&&_.charCodeAt(L)!==EA||_.charCodeAt(++L)===EA;);return(J=L)>=M?ee=!0:(ue=_.charCodeAt(L++))===T_?ce=!0:ue===TA&&(ce=!0,_.charCodeAt(L)===T_&&++L),_.slice(pe+1,J-1).replace(/""/g,'"')}for(;L<M;){if((ue=_.charCodeAt(J=L++))===T_)ce=!0;else if(ue===TA)ce=!0,_.charCodeAt(L)===T_&&++L;else if(ue!==t)continue;return _.slice(pe,J)}return ee=!0,_.slice(pe,M)}for(;(z=se())!==xA;){for(var _e=[];z!==U4&&z!==xA;)_e.push(z),z=se();x&&(_e=x(_e,F++))==null||C.push(_e)}return C}function o(_,x){return _.map(function(C){return x.map(function(M){return g(C[M])}).join(n)})}function a(_,x){return x==null&&(x=j4(_)),[x.map(g).join(n)].concat(o(_,x)).join(`
`)}function l(_,x){return x==null&&(x=j4(_)),o(_,x).join(`
`)}function h(_){return _.map(p).join(`
`)}function p(_){return _.map(g).join(n)}function g(_){return _==null?"":_ instanceof Date?rie(_):e.test(_+="")?'"'+_.replace(/"/g,'""')+'"':_}return{parse:r,parseRows:i,format:a,formatBody:l,formatRows:h,formatRow:p,formatValue:g}}var oie=iie(","),aie=oie.parse;function sie(n){if(!n.ok)throw new Error(n.status+" "+n.statusText);return n.text()}function cie(n,e){return fetch(n,e).then(sie)}function lie(n){return function(e,t,r){return arguments.length===2&&typeof t=="function"&&(r=t,t=void 0),cie(e,t).then(function(i){return n(i,r)})}}var V4=lie(aie);/*!
MICROSOFT SOFTWARE LICENSE TERMS
MICROSOFT AZURE MAPS WEB SDK
These license terms are an agreement between you and Microsoft Corporation (or one of its affiliates). They apply to the software named above and any Microsoft services or software updates (except to the extent such services or updates are accompanied by new or additional terms, in which case those different terms apply prospectively and do not alter your or Microsoft’s rights relating to pre-updated software or services). IF YOU COMPLY WITH THESE LICENSE TERMS, YOU HAVE THE RIGHTS BELOW.  BY USING THE SOFTWARE, YOU ACCEPT THESE TERMS.
1. INSTALLATION AND USE RIGHTS.
  a) General. You may install and use any number of copies of the software to develop and test your applications.
  b) User Region Parameters. The software will allow you to select from a View list to set the map view within your application for a given customer. By default the View parameter (also referred to as “user region parameter” is set to “Unified”.  Countries/Regions that are not on the View list will default to the “Unified” View. It is your responsibility to determine the location of your users, and then set the View parameter correctly for that location. The View parameter must be used in compliance with applicable laws, including those regarding mapping, of the country where maps, images and other data and third party content that You are authorized to access via the software is made available. 
  c) Third Party Software. The software may include third party applications that Microsoft, not the third party, licenses to you under this agreement. Any included notices for third party applications are for your information only.
  d) Microsoft Online Subscription Agreement. Some features of the software provide access to, or rely on, Microsoft Azure Services. The use of those services (but not the software) is governed by the separate terms and privacy policies associated with your Microsoft Azure subscription. The services may not be available in all regions. For more information see https://go.microsoft.com/fwLink/?LinkID=522330&amp;clcid=0x9.
2. DISTRIBUTABLE CODE. The software is comprised of “Distributable Code”. “Distributable Code” is code that you are permitted to distribute in applications you develop if you comply with the terms below and otherwise set forth in these license terms. 
  a) Distribution Rights. 
    i. You may copy and distribute the object code form of the software.
    i. Third Party Distribution. You may permit distributors of your applications to copy and distribute any of this distributable code you elect to distribute with your applications.
  b) Distribution Requirements. For any code you distribute, you must:
    i. add significant primary functionality to it in your applications;
    ii. require distributors and external end users to agree to terms that protect it and Microsoft at least as much as this agreement; and
    iii. indemnify, defend, and hold harmless Microsoft from any claims, including attorneys’ fees, related to the distribution or use of your applications, except to the extent that any claim is based solely on the unmodified distributable code.
  c) Distribution Restrictions. You may not:
    i. use Microsoft’s trademarks or trade dress in your application in any way that suggests your application comes from or is endorsed by Microsoft; or
    ii. modify or distribute the source code of any distributable code so that any part of it becomes subject to any license that requires that the distributable code, any other part of the software, or any of Microsoft’s other intellectual property be disclosed or distributed in source code form, or that others have the right to modify it.
3. DATA COLLECTION. The software may collect information about you and your use of the software and send that to Microsoft. Microsoft may use this information to provide services and improve Microsoft’s products and services. Your opt-out rights, if any, are described in the product documentation. Some features in the software may enable collection of data from users of your applications that access or use the software. If you use these features to enable data collection in your applications, you must comply with applicable law, including getting any required user consent, and maintain a prominent privacy policy that accurately informs users about how you use, collect, and share their data. You can learn more about Microsoft’s data collection and use in the product documentation and the Microsoft Privacy Statement at https://go.microsoft.com/fwlink/?LinkId=512132. You agree to comply with all applicable provisions of the Microsoft Privacy Statement.
4. SCOPE OF LICENSE. The software is licensed, not sold. Microsoft reserves all other rights. Unless applicable law gives you more rights despite this limitation, you will not (and have no right to):
  a) work around any technical limitations in the software that only allow you to use it in certain ways;
  b) reverse engineer, decompile, or disassemble the software, or attempt to do so, except and only to the extent permitted by licensing terms governing the use of open-source components that may be included with the software;
  c) remove, minimize, block, or modify any notices of Microsoft or its suppliers in the software;
  d) use the software in any way that is against the law or to create or propagate malware; or
  e) share, publish, distribute, or lend the software (except for any distributable code, subject to the terms above), provide the software as a stand-alone hosted solution for others to use, or transfer the software or this agreement to any third party.
5. EXPORT RESTRICTIONS. You must comply with all domestic and international export laws and regulations that apply to the software, which include restrictions on destinations, end users, and end use. For further information on export restrictions, visit http://aka.ms/exporting.
6. SUPPORT SERVICES. Microsoft is not obligated under this agreement to provide any support services for the software. Any support provided is “as is”, “with all faults”, and without warranty of any kind.
7. UPDATES. The software may periodically check for updates, and download and install them for you. You may obtain updates only from Microsoft or authorized sources. Microsoft may need to update your system to provide you with updates. You agree to receive these automatic updates without any additional notice. Updates may not include or support all existing software features, services, or peripheral devices.
8. ENTIRE AGREEMENT. This agreement, and any other terms Microsoft may provide for supplements, updates, or third-party applications, is the entire agreement for the software.
9. APPLICABLE LAW AND PLACE TO RESOLVE DISPUTES. If you acquired the software in the United States or Canada, the laws of the state or province where you live (or, if a business, where your principal place of business is located) govern the interpretation of this agreement, claims for its breach, and all other claims (including consumer protection, unfair competition, and tort claims), regardless of conflict of laws principles. If you acquired the software in any other country, its laws apply. If U.S. federal jurisdiction exists, you and Microsoft consent to exclusive jurisdiction and venue in the federal court in King County, Washington for all disputes heard in court. If not, you and Microsoft consent to exclusive jurisdiction and venue in the Superior Court of King County, Washington for all disputes heard in court.
10. CONSUMER RIGHTS; REGIONAL VARIATIONS. This agreement describes certain legal rights. You may have other rights, including consumer rights, under the laws of your state or country. Separate and apart from your relationship with Microsoft, you may also have rights with respect to the party from which you acquired the software. This agreement does not change those other rights if the laws of your state or country do not permit it to do so. For example, if you acquired the software in one of the below regions, or mandatory country law applies, then the following provisions apply to you:
  a) Australia. You have statutory guarantees under the Australian Consumer Law and nothing in this agreement is intended to affect those rights.
  b) Canada. If you acquired this software in Canada, you may stop receiving updates by turning off the automatic update feature, disconnecting your device from the Internet (if and when you re-connect to the Internet, however, the software will resume checking for and installing updates), or uninstalling the software. The product documentation, if any, may also specify how to turn off updates for your specific device or software.
  c) Germany and Austria.
    i. Warranty. The properly licensed software will perform substantially as described in any Microsoft materials that accompany the software. However, Microsoft gives no contractual guarantee in relation to the licensed software.
    ii. Limitation of Liability. In case of intentional conduct, gross negligence, claims based on the Product Liability Act, as well as, in case of death or personal or physical injury, Microsoft is liable according to the statutory law.
  Subject to the foregoing clause ii., Microsoft will only be liable for slight negligence if Microsoft is in breach of such material contractual obligations, the fulfillment of which facilitate the due performance of this agreement, the breach of which would endanger the purpose of this agreement and the compliance with which a party may constantly trust in (so-called "cardinal obligations"). In other cases of slight negligence, Microsoft will not be liable for slight negligence.
11. DISCLAIMER OF WARRANTY. THE SOFTWARE IS LICENSED “AS IS.” YOU BEAR THE RISK OF USING IT. MICROSOFT GIVES NO EXPRESS WARRANTIES, GUARANTEES, OR CONDITIONS. TO THE EXTENT PERMITTED UNDER APPLICABLE LAWS, MICROSOFT EXCLUDES ALL IMPLIED WARRANTIES, INCLUDING MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE, AND NON-INFRINGEMENT.
12. LIMITATION ON AND EXCLUSION OF DAMAGES. IF YOU HAVE ANY BASIS FOR RECOVERING DAMAGES DESPITE THE PRECEDING DISCLAIMER OF WARRANTY, YOU CAN RECOVER FROM MICROSOFT AND ITS SUPPLIERS ONLY DIRECT DAMAGES UP TO U.S. $5.00. YOU CANNOT RECOVER ANY OTHER DAMAGES, INCLUDING CONSEQUENTIAL, LOST PROFITS, SPECIAL, INDIRECT, OR INCIDENTAL DAMAGES.
This limitation applies to (a) anything related to the software, services, content (including code) on third party Internet sites, or third party applications; and (b) claims for breach of contract, warranty, guarantee, or condition; strict liability, negligence, or other tort; or any other claim; in each case to the extent permitted by applicable law.
It also applies even if Microsoft knew or should have known about the possibility of the damages. The above limitation or exclusion may not apply to you because your state, province, or country may not allow the exclusion or limitation of incidental, consequential, or other damages.
Please note: As this software is distributed in Canada, some of the clauses in this agreement are provided below in French.
Remarque: Ce logiciel étant distribué au Canada, certaines des clauses dans ce contrat sont fournies ci-dessous en français.
EXONÉRATION DE GARANTIE. Le logiciel visé par une licence est offert « tel quel ». Toute utilisation de ce logiciel est à votre seule risque et péril. Microsoft n’accorde aucune autre garantie expresse. Vous pouvez bénéficier de droits additionnels en vertu du droit local sur la protection des consommateurs, que ce contrat ne peut modifier. La ou elles sont permises par le droit locale, les garanties implicites de qualité marchande, d’adéquation à un usage particulier et d’absence de contrefaçon sont exclues.
LIMITATION DES DOMMAGES-INTÉRÊTS ET EXCLUSION DE RESPONSABILITÉ POUR LES DOMMAGES. Vous pouvez obtenir de Microsoft et de ses fournisseurs une indemnisation en cas de dommages directs uniquement à hauteur de 5,00 $ US. Vous ne pouvez prétendre à aucune indemnisation pour les autres dommages, y compris les dommages spéciaux, indirects ou accessoires et pertes de bénéfices.
Cette limitation concerne:
• tout ce qui est relié au logiciel, aux services ou au contenu (y compris le code) figurant sur des sites Internet tiers ou dans des programmes tiers; et
• les réclamations au titre de violation de contrat ou de garantie, ou au titre de responsabilité stricte, de négligence ou d’une autre faute dans la limite autorisée par la loi en vigueur.
Elle s’applique également, même si Microsoft connaissait ou devrait connaître l’éventualité d’un tel dommage. Si votre pays n’autorise pas l’exclusion ou la limitation de responsabilité pour les dommages indirects, accessoires ou de quelque nature que ce soit, il se peut que la limitation ou l’exclusion ci-dessus ne s’appliquera pas à votre égard.
EFFET JURIDIQUE. Le présent contrat décrit certains droits juridiques. Vous pourriez avoir d’autres droits prévus par les lois de votre pays. Le présent contrat ne modifie pas les droits que vous confèrent les lois de votre pays si celles-ci ne le permettent pas.
*/var U1=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function ih(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}function uie(n){var e,t;return n.__esModule?n:(typeof(e=n.default)=="function"?(t=function r(){return this instanceof r?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)}).prototype=e.prototype:t={},Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(n).forEach(function(r){var i=Object.getOwnPropertyDescriptor(n,r);Object.defineProperty(t,r,i.get?i:{enumerable:!0,get:function(){return n[r]}})}),t)}var H4={exports:{}},hie=(function(){var n;n=function(){var e={},t={};function r(i,o,a){t[i]=a,i==="index"&&(a="var sharedModule = {}; ("+t.shared+")(sharedModule); ("+t.worker+")(sharedModule);",t.shared(i={}),t.index(e,i),typeof window<"u")&&e.setWorkerUrl(window.URL.createObjectURL(new Blob([a],{type:"text/javascript"})))}return r("shared",0,function(i){function o(u,c,d,m){return new(d=d||Promise)(function(b,E){function S(O){try{I(m.next(O))}catch(k){E(k)}}function A(O){try{I(m.throw(O))}catch(k){E(k)}}function I(O){var k;O.done?b(O.value):((k=O.value)instanceof d?k:new d(function(U){U(k)})).then(S,A)}I((m=m.apply(u,c||[])).next())})}function a(u){return u&&u.__esModule&&Object.prototype.hasOwnProperty.call(u,"default")?u.default:u}var l=h;function h(u,c){this.x=u,this.y=c}h.prototype={clone:function(){return new h(this.x,this.y)},add:function(u){return this.clone()._add(u)},sub:function(u){return this.clone()._sub(u)},multByPoint:function(u){return this.clone()._multByPoint(u)},divByPoint:function(u){return this.clone()._divByPoint(u)},mult:function(u){return this.clone()._mult(u)},div:function(u){return this.clone()._div(u)},rotate:function(u){return this.clone()._rotate(u)},rotateAround:function(u,c){return this.clone()._rotateAround(u,c)},matMult:function(u){return this.clone()._matMult(u)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(u){return this.x===u.x&&this.y===u.y},dist:function(u){return Math.sqrt(this.distSqr(u))},distSqr:function(d){var c=d.x-this.x,d=d.y-this.y;return c*c+d*d},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(u){return Math.atan2(this.y-u.y,this.x-u.x)},angleWith:function(u){return this.angleWithSep(u.x,u.y)},angleWithSep:function(u,c){return Math.atan2(this.x*c-this.y*u,this.x*u+this.y*c)},_matMult:function(d){var c=d[0]*this.x+d[1]*this.y,d=d[2]*this.x+d[3]*this.y;return this.x=c,this.y=d,this},_add:function(u){return this.x+=u.x,this.y+=u.y,this},_sub:function(u){return this.x-=u.x,this.y-=u.y,this},_mult:function(u){return this.x*=u,this.y*=u,this},_div:function(u){return this.x/=u,this.y/=u,this},_multByPoint:function(u){return this.x*=u.x,this.y*=u.y,this},_divByPoint:function(u){return this.x/=u.x,this.y/=u.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var u=this.y;return this.y=this.x,this.x=-u,this},_rotate:function(m){var c=Math.cos(m),m=Math.sin(m),d=c*this.x-m*this.y,m=m*this.x+c*this.y;return this.x=d,this.y=m,this},_rotateAround:function(b,c){var d=Math.cos(b),b=Math.sin(b),m=c.x+d*(this.x-c.x)-b*(this.y-c.y),b=c.y+b*(this.x-c.x)+d*(this.y-c.y);return this.x=m,this.y=b,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},h.convert=function(u){return!(u instanceof h)&&Array.isArray(u)?new h(u[0],u[1]):u};var p=a(l),g=_;function _(u,c,d,m){this.cx=3*u,this.bx=3*(d-u)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*c,this.by=3*(m-c)-this.cy,this.ay=1-this.cy-this.by,this.p1x=u,this.p1y=c,this.p2x=d,this.p2y=m}_.prototype={sampleCurveX:function(u){return((this.ax*u+this.bx)*u+this.cx)*u},sampleCurveY:function(u){return((this.ay*u+this.by)*u+this.cy)*u},sampleCurveDerivativeX:function(u){return(3*this.ax*u+2*this.bx)*u+this.cx},solveCurveX:function(u,c){if(c===void 0&&(c=1e-6),u<0)return 0;if(1<u)return 1;for(var d=u,m=0;m<8;m++){var b=this.sampleCurveX(d)-u;if(Math.abs(b)<c)return d;var E=this.sampleCurveDerivativeX(d);if(Math.abs(E)<1e-6)break;d-=b/E}for(var S=0,A=1,d=u,m=0;m<20&&(b=this.sampleCurveX(d),!(Math.abs(b-u)<c));m++)b<u?S=d:A=d,d=.5*(A-S)+S;return d},solve:function(u,c){return this.sampleCurveY(this.solveCurveX(u,c))}};var x=a(g);let C;function M(){return C=C??(typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function")}let L;function F(){if(L==null&&(L=!1,M())){var u=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(u){for(let m=0;m<25;m++){var c=4*m;u.fillStyle=`rgb(${c},${1+c},${2+c})`,u.fillRect(m%5,Math.floor(m/5),1,1)}var d=u.getImageData(0,0,5,5).data;for(let m=0;m<100;m++)if(m%4!=3&&d[m]!==m){L=!0;break}}}return L||!1}function z(u){var c,d;return u<=0?0:1<=u?1:(d=(c=u*u)*u,4*(u<.5?d:3*(u-c)+d-.75))}function ee(u,c,d,m){const b=new x(u,c,d,m);return function(E){return b.solve(E)}}g=ee(.25,.1,.25,1);function ce(u,c,d){return Math.min(d,Math.max(c,u))}function se(b,c,d){var m=d-c,b=((b-c)%m+m)%m+c;return b===c?d:b}function _e(u,...c){for(const d of c)for(const m in d)u[m]=d[m];return u}let J=1;function pe(u,c,d){var m={};for(const b in u)m[b]=c.call(d||this,u[b],b,u);return m}function ue(u,c,d){var m={};for(const b in u)c.call(d||this,u[b],b,u)&&(m[b]=u[b]);return m}function xe(u){return Array.isArray(u)?u.map(xe):typeof u=="object"&&u?pe(u,xe):u}function je(u,c){for(let d=0;d<u.length;d++)if(0<=c.indexOf(u[d]))return 1}const ne={};function Ee(u){ne[u]||(typeof console<"u"&&console.warn(u),ne[u]=!0)}function ke(u,c,d){return(d.y-u.y)*(c.x-u.x)>(c.y-u.y)*(d.x-u.x)}function Be(u){return typeof WorkerGlobalScope<"u"&&u!==void 0&&u instanceof WorkerGlobalScope}let Ze=null;function at(u){return typeof ImageBitmap<"u"&&u instanceof ImageBitmap}const Re="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function ht(u,c,d,m,b){return o(this,void 0,void 0,function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");var E,S,A,I,O,k,U,W,re,ie=new VideoFrame(u,{timestamp:0});try{var fe=ie==null?void 0:ie.format;if(!fe||!fe.startsWith("BGR")&&!fe.startsWith("RGB"))throw new Error("Unrecognized format "+fe);var we=fe.startsWith("BGR"),de=new Uint8ClampedArray(m*b*4);if(yield ie.copyTo(de,(E=u,S=c,A=d,I=m,O=b,k=4*Math.max(-S,0),k=(Math.max(0,A)-A)*I*4+k,U=4*I,W=Math.max(0,S),re=Math.max(0,A),{rect:{x:W,y:re,width:Math.min(E.width,S+I)-W,height:Math.min(E.height,A+O)-re},layout:[{offset:k,stride:U}]})),we)for(let Ve=0;Ve<de.length;Ve+=4){var Me=de[Ve];de[Ve]=de[Ve+2],de[Ve+2]=Me}return de}finally{ie.close()}})}let Rt,dn;function wt(u,c,d,m){return u.addEventListener(c,d,m),{unsubscribe:()=>{u.removeEventListener(c,d,m)}}}const Ge="AbortError";function qn(){return new Error(Ge)}const Qt={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function ln(u){return Qt.REGISTERED_PROTOCOLS[u.substring(0,u.indexOf("://"))]}const Mn="global-dispatcher";class Ot extends Error{constructor(c,d,m,b){super(`AJAXError: ${d} (${c}): `+m),this.status=c,this.statusText=d,this.url=m,this.body=b}}const En=()=>Be(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,lt=u=>/^file:/.test(u)||/^file:/.test(En())&&!/^\w+:/.test(u);function Pt(u,c){if(/:\/\//.test(u.url)&&!/^https?:|^file:/.test(u.url)){var d=ln(u.url);if(d)return d(u,c);if(Be(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:u,targetMapId:Mn},c)}if(!lt(u.url)){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return function(E,S){return o(this,void 0,void 0,function*(){var A=new Request(E.url,{method:E.method||"GET",body:E.body,credentials:E.credentials,headers:E.headers,cache:E.cache,referrer:En(),signal:S.signal}),A=(E.type==="json"&&A.headers.set("Accept","application/json"),yield fetch(A));if(!A.ok)throw I=yield A.blob(),new Ot(A.status,A.statusText,E.url,I);var I=yield E.type==="arrayBuffer"||E.type==="image"?A.arrayBuffer():E.type==="json"?A.json():A.text();if(S.signal.aborted)throw qn();return{data:I,cacheControl:A.headers.get("Cache-Control"),expires:A.headers.get("Expires")}})}(u,c);if(Be(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:u,mustQueue:!0,targetMapId:Mn},c)}return m=u,b=c,new Promise((E,S)=>{const A=new XMLHttpRequest;A.open(m.method||"GET",m.url,!0),m.type!=="arrayBuffer"&&m.type!=="image"||(A.responseType="arraybuffer");for(const I in m.headers)A.setRequestHeader(I,m.headers[I]);m.type==="json"&&(A.responseType="text",A.setRequestHeader("Accept","application/json")),A.withCredentials=m.credentials==="include",A.onerror=()=>{S(new Error(A.statusText))},A.onload=()=>{if(!b.signal.aborted)if((200<=A.status&&A.status<300||A.status===0)&&A.response!==null){let O=A.response;if(m.type==="json")try{O=JSON.parse(A.response)}catch(k){return void S(k)}E({data:O,cacheControl:A.getResponseHeader("Cache-Control"),expires:A.getResponseHeader("Expires")})}else{var I=new Blob([A.response],{type:A.getResponseHeader("Content-Type")});S(new Ot(A.status,A.statusText,m.url,I))}},b.signal.addEventListener("abort",()=>{A.abort(),S(qn())}),A.send(m.body)});var m,b}function he(u){var c;return!u||u.indexOf("://")<=0||u.indexOf("data:image/")===0||u.indexOf("blob:")===0||(u=new URL(u),c=window.location,u.protocol===c.protocol&&u.host===c.host)}function B(u,c,d){d[u]&&d[u].indexOf(c)!==-1||(d[u]=d[u]||[],d[u].push(c))}function H(u,c,d){d&&d[u]&&(c=d[u].indexOf(c))!==-1&&d[u].splice(c,1)}class D{constructor(c,d={}){_e(this,d),this.type=c}}class Q extends D{constructor(c,d={}){super("error",_e({error:c},d))}}class ae{on(c,d){return this._listeners=this._listeners||{},B(c,d,this._listeners),this}off(c,d){return H(c,d,this._listeners),H(c,d,this._oneTimeListeners),this}once(c,d){return d?(this._oneTimeListeners=this._oneTimeListeners||{},B(c,d,this._oneTimeListeners),this):new Promise(m=>this.once(c,m))}fire(c,d){var m=(c=typeof c=="string"?new D(c,d||{}):c).type;if(this.listens(m)){for(const b of(c.target=this)._listeners&&this._listeners[m]?this._listeners[m].slice():[])b.call(this,c);for(const b of this._oneTimeListeners&&this._oneTimeListeners[m]?this._oneTimeListeners[m].slice():[])H(m,b,this._oneTimeListeners),b.call(this,c);d=this._eventedParent,d&&(_e(c,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),d.fire(c))}else c instanceof Q&&console.error(c.error);return this}listens(c){return this._listeners&&this._listeners[c]&&0<this._listeners[c].length||this._oneTimeListeners&&this._oneTimeListeners[c]&&0<this._oneTimeListeners[c].length||this._eventedParent&&this._eventedParent.listens(c)}setEventedParent(c,d){return this._eventedParent=c,this._eventedParentData=d,this}}var q={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sky:{type:"sky"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const Ae=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function Pe(u,c){if(Array.isArray(u)){if(!Array.isArray(c)||u.length!==c.length)return;for(let d=0;d<u.length;d++)if(!Pe(u[d],c[d]))return;return 1}if(typeof u!="object"||u===null||c===null)return u===c;if(typeof c=="object"&&Object.keys(u).length===Object.keys(c).length){for(const d in u)if(!Pe(u[d],c[d]))return;return 1}}function We(u,c){u.push(c)}function rt(u,c,d){We(d,{command:"addSource",args:[u,c[u]]})}function Et(u,c,d){We(c,{command:"removeSource",args:[u]}),d[u]=!0}function Bt(u,c,d,m){c=c||{};let b;for(b in u=u||{})!Object.prototype.hasOwnProperty.call(u,b)||Object.prototype.hasOwnProperty.call(c,b)||Et(b,d,m);for(b in c)Object.prototype.hasOwnProperty.call(c,b)&&(Object.prototype.hasOwnProperty.call(u,b)?Pe(u[b],c[b])||(u[b].type==="geojson"&&c[b].type==="geojson"&&function(I,O,k){let U;for(U in I[k])if(Object.prototype.hasOwnProperty.call(I[k],U)&&U!=="data"&&!Pe(I[k][U],O[k][U]))return;for(U in O[k])if(Object.prototype.hasOwnProperty.call(O[k],U)&&U!=="data"&&!Pe(I[k][U],O[k][U]))return;return 1}(u,c,b)?We(d,{command:"setGeoJSONSourceData",args:[b,c[b].data]}):(E=b,S=c,Et(E,A=d,m),rt(E,S,A))):rt(b,c,d));var E,S,A}function Lt(u,c,d,m,b,E){c=c||{};for(const S in u=u||{})!Object.prototype.hasOwnProperty.call(u,S)||Pe(u[S],c[S])||d.push({command:E,args:[m,S,c[S],b]});for(const S in c)!Object.prototype.hasOwnProperty.call(c,S)||Object.prototype.hasOwnProperty.call(u,S)||Pe(u[S],c[S])||d.push({command:E,args:[m,S,c[S],b]})}function an(u){return u.id}function Ie(u,c){return u[c.id]=c,u}class Te{constructor(c,d,m,b){this.message=(c?c+": ":"")+m,b&&(this.identifier=b),d!=null&&d.__line__&&(this.line=d.__line__)}}function At(u,...c){for(const d of c)for(const m in d)u[m]=d[m];return u}class xt extends Error{constructor(c,d){super(d),this.message=d,this.key=c}}class qt{constructor(c,d=[]){this.parent=c,this.bindings={};for(var[m,b]of d)this.bindings[m]=b}concat(c){return new qt(this,c)}get(c){if(this.bindings[c])return this.bindings[c];if(this.parent)return this.parent.get(c);throw new Error(c+" not found in scope.")}has(c){return!!this.bindings[c]||!!this.parent&&this.parent.has(c)}}const fn={kind:"null"},Ke={kind:"number"},gt={kind:"string"},Tt={kind:"boolean"},Rn={kind:"color"},Qn={kind:"object"},nn={kind:"value"},Fr={kind:"collator"},ti={kind:"formatted"},Ar={kind:"padding"},oe={kind:"resolvedImage"},V={kind:"variableAnchorOffsetCollection"};function $(u,c){return{kind:"array",itemType:u,N:c}}function K(u){var c;return u.kind==="array"?(c=K(u.itemType),typeof u.N=="number"?`array<${c}, ${u.N}>`:u.itemType.kind==="value"?"array":`array<${c}>`):u.kind}const me=[fn,Ke,gt,Tt,Rn,ti,Qn,$(nn),Ar,oe,V];function Oe(u,c){if(c.kind==="error")return null;if(u.kind==="array"){if(c.kind==="array"&&(c.N===0&&c.itemType.kind==="value"||!Oe(u.itemType,c.itemType))&&(typeof u.N!="number"||u.N===c.N))return null}else{if(u.kind===c.kind)return null;if(u.kind==="value"){for(const d of me)if(!Oe(d,c))return null}}return`Expected ${K(u)} but found ${K(c)} instead.`}function He(u,c){return c.some(d=>d.kind===u.kind)}function Ne(u,c){return c.some(d=>d==="null"?u===null:d==="array"?Array.isArray(u):d==="object"?u&&!Array.isArray(u)&&typeof u=="object":d===typeof u)}function Ce(u,c){return u.kind==="array"&&c.kind==="array"?u.itemType.kind===c.itemType.kind&&typeof u.N=="number":u.kind===c.kind}const De=.96422,ot=1,st=.82521,St=4/29,un=6/29,tn=3*un*un,_n=un*un*un,Kn=Math.PI/180,er=180/Math.PI;function On(u){return(u%=360)<0&&(u+=360),u}function Bn([A,c,d,m]){let b,E;var S=gn((.2225045*(A=pn(A))+.7168786*(c=pn(c))+.0606169*(d=pn(d)))/ot),A=(A===c&&c===d?b=E=S:(b=gn((.4360747*A+.3850649*c+.1430804*d)/De),E=gn((.0139322*A+.0971045*c+.7141733*d)/st)),116*S-16);return[A<0?0:A,500*(b-S),200*(S-E),m]}function pn(u){return u<=.04045?u/12.92:Math.pow((u+.055)/1.055,2.4)}function gn(u){return u>_n?Math.pow(u,1/3):u/tn+St}function Yn([u,c,d,m]){return u=(u+16)/116,c=isNaN(c)?u:u+c/500,d=isNaN(d)?u:u-d/200,u=ot*si(u),[Br(3.1338561*(c=De*si(c))-1.6168667*u-.4906146*(d=st*si(d))),Br(-.9787684*c+1.9161415*u+.033454*d),Br(.0719453*c-.2289914*u+1.4052427*d),m]}function Br(u){return(u=u<=.00304?12.92*u:1.055*Math.pow(u,1/2.4)-.055)<0?0:1<u?1:u}function si(u){return u>un?u*u*u:tn*(u-St)}function $i(c){var[c,d,m,b]=Bn(c),E=Math.sqrt(d*d+m*m);return[Math.round(1e4*E)?On(Math.atan2(m,d)*er):NaN,E,c,b]}function Pi(u){if((u=u.toLowerCase().trim())==="transparent")return[0,0,0,0];var ie=ga[u];if(ie)return[ie,d,c]=ie,[ie/255,d/255,c/255,1];if(u.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(u))return ie=u.length<6?1:2,[mo(u.slice(d=1,d+=ie)),mo(u.slice(d,d+=ie)),mo(u.slice(d,d+=ie)),mo(u.slice(d,d+ie)||"ff")];if(u.startsWith("rgb")){var c=u.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(c){var[,d,ie,c,m,b,E,S,A,I,O,k]=c,c=[c||" ",E||" ",I].join("");return(c==="  "||c==="  /"||c===",,"||c===",,,")&&(E=[ie,b,A].join(""),I=E==="%%%"?100:E===""?255:0,I&&(c=[bl(+d/I,0,1),bl(+m/I,0,1),bl(+S/I,0,1),O?Xh(+O,k):1],Su(c)))?c:void 0}}var U,W,re,ie=u.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(ie){var[,b,A,E,d,m,S,I,O]=ie,k=[A||" ",d||" ",S].join("");if((k==="  "||k==="  /"||k===",,"||k===",,,")&&(c=[+b,bl(+E,0,100),bl(+m,0,100),I?Xh(+I,O):1],Su(c)))return[U,W,re,u]=[c][0],U=On(U),W/=100,re/=100,[fe(0),fe(8),fe(4),u]}function fe(de){var de=(de+U/30)%12,Me=W*Math.min(re,1-re);return re-Me*Math.max(-1,Math.min(de-3,9-de,1))}}function mo(u){return parseInt(u.padEnd(2,u),16)/255}function Xh(u,c){return bl(c?u/100:u,0,1)}function bl(u,c,d){return Math.min(Math.max(c,u),d)}function Su(u){return!u.some(Number.isNaN)}const ga={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};class ir{constructor(c,d,m,b=1,E=!0){this.r=c,this.g=d,this.b=m,this.a=b,E||(this.r*=b,this.g*=b,this.b*=b,b)||this.overwriteGetter("rgb",[c,d,m,b])}static parse(c){return c instanceof ir?c:typeof c=="string"&&(c=Pi(c))?new ir(...c,!1):void 0}get rgb(){var{r:c,g:d,b:m,a:b}=this,E=b||1/0;return this.overwriteGetter("rgb",[c/E,d/E,m/E,b])}get hcl(){return this.overwriteGetter("hcl",$i(this.rgb))}get lab(){return this.overwriteGetter("lab",Bn(this.rgb))}overwriteGetter(c,d){return Object.defineProperty(this,c,{value:d}),d}toString(){var[c,d,m,b]=this.rgb;return`rgba(${[c,d,m].map(E=>Math.round(255*E)).join(",")},${b})`}}ir.black=new ir(0,0,0,1),ir.white=new ir(1,1,1,1),ir.transparent=new ir(0,0,0,0),ir.red=new ir(1,0,0,1);class Do{constructor(c,d,m){this.sensitivity=c?d?"variant":"case":d?"accent":"base",this.locale=m,this.collator=new Intl.Collator(this.locale||[],{sensitivity:this.sensitivity,usage:"search"})}compare(c,d){return this.collator.compare(c,d)}resolvedLocale(){return new Intl.Collator(this.locale||[]).resolvedOptions().locale}}class Oa{constructor(c,d,m,b,E){this.text=c,this.image=d,this.scale=m,this.fontStack=b,this.textColor=E}}class to{constructor(c){this.sections=c}static fromString(c){return new to([new Oa(c,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(c=>c.text.length!==0||c.image&&c.image.name.length!==0)}static factory(c){return c instanceof to?c:to.fromString(c)}toString(){return this.sections.length===0?"":this.sections.map(c=>c.text).join("")}}class $r{constructor(c){this.values=c.slice()}static parse(c){if(c instanceof $r)return c;if(typeof c=="number")return new $r([c,c,c,c]);if(Array.isArray(c)&&!(c.length<1||4<c.length)){for(const d of c)if(typeof d!="number")return;switch(c.length){case 1:c=[c[0],c[0],c[0],c[0]];break;case 2:c=[c[0],c[1],c[0],c[1]];break;case 3:c=[c[0],c[1],c[2],c[1]]}return new $r(c)}}toString(){return JSON.stringify(this.values)}}const Ms=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class Jo{constructor(c){this.values=c.slice()}static parse(c){if(c instanceof Jo)return c;if(Array.isArray(c)&&!(c.length<1)&&c.length%2==0){for(let b=0;b<c.length;b+=2){var d=c[b],m=c[b+1];if(typeof d!="string"||!Ms.has(d)||!Array.isArray(m)||m.length!==2||typeof m[0]!="number"||typeof m[1]!="number")return}return new Jo(c)}}toString(){return JSON.stringify(this.values)}}class ea{constructor(c){this.name=c.name,this.available=c.available}toString(){return this.name}static fromString(c){return c?new ea({name:c,available:!1}):null}}function wl(u,c,d,m){return typeof u=="number"&&0<=u&&u<=255&&typeof c=="number"&&0<=c&&c<=255&&typeof d=="number"&&0<=d&&d<=255?m===void 0||typeof m=="number"&&0<=m&&m<=1?null:`Invalid rgba value [${[u,c,d,m].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof m=="number"?[u,c,d,m]:[u,c,d]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function no(u){if(u===null||typeof u=="string"||typeof u=="boolean"||typeof u=="number"||u instanceof ir||u instanceof Do||u instanceof to||u instanceof $r||u instanceof Jo||u instanceof ea)return 1;if(Array.isArray(u)){for(const c of u)if(!no(c))return;return 1}if(typeof u=="object"){for(const c in u)if(!no(u[c]))return;return 1}}function ci(u){if(u===null)return fn;if(typeof u=="string")return gt;if(typeof u=="boolean")return Tt;if(typeof u=="number")return Ke;if(u instanceof ir)return Rn;if(u instanceof Do)return Fr;if(u instanceof to)return ti;if(u instanceof $r)return Ar;if(u instanceof Jo)return V;if(u instanceof ea)return oe;if(Array.isArray(u)){var c=u.length;let m;for(const b of u){var d=ci(b);if(m){if(m!==d){m=nn;break}}else m=d}return $(m||nn,c)}return Qn}function Rs(u){var c=typeof u;return u===null?"":c=="string"||c=="number"||c=="boolean"?String(u):u instanceof ir||u instanceof to||u instanceof $r||u instanceof Jo||u instanceof ea?u.toString():JSON.stringify(u)}class La{constructor(c,d){this.type=c,this.value=d}static parse(c,d){if(c.length!==2)return d.error(`'literal' expression requires exactly one argument, but found ${c.length-1} instead.`);if(!no(c[1]))return d.error("invalid value");c=c[1];let m=ci(c);return d=d.expectedType,m.kind!=="array"||m.N!==0||!d||d.kind!=="array"||typeof d.N=="number"&&d.N!==0||(m=d),new La(m,c)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}class or{constructor(c){this.name="ExpressionEvaluationError",this.message=c}toJSON(){return this.message}}const rs={string:gt,number:Ke,boolean:Tt,object:Qn};class Hn{constructor(c,d){this.type=c,this.args=d}static parse(c,d){if(c.length<2)return d.error("Expected at least one argument.");let m=1,b;var E=c[0];if(E==="array"){let I;if(2<c.length){const k=c[1];if(typeof k!="string"||!(k in rs)||k==="object")return d.error('The item type argument of "array" must be one of string, number, boolean',1);I=rs[k],m++}else I=nn;let O;if(3<c.length){if(c[2]!==null&&(typeof c[2]!="number"||c[2]<0||c[2]!==Math.floor(c[2])))return d.error('The length argument to "array" must be a positive integer literal',2);O=c[2],m++}b=$(I,O)}else{if(!rs[E])throw new Error("Types doesn't contain name = "+E);b=rs[E]}for(var S=[];m<c.length;m++){var A=d.parse(c[m],m,nn);if(!A)return null;S.push(A)}return new Hn(b,S)}evaluate(c){for(let m=0;m<this.args.length;m++){var d=this.args[m].evaluate(c);if(!Oe(this.type,ci(d)))return d;if(m===this.args.length-1)throw new or(`Expected value to be of type ${K(this.type)}, but found ${K(ci(d))} instead.`)}throw new Error}eachChild(c){this.args.forEach(c)}outputDefined(){return this.args.every(c=>c.outputDefined())}}const is={"to-boolean":Tt,"to-color":Rn,"to-number":Ke,"to-string":gt};class nc{constructor(c,d){this.type=c,this.args=d}static parse(c,d){if(c.length<2)return d.error("Expected at least one argument.");var m=c[0];if(!is[m])throw new Error(`Can't parse ${m} as it is not part of the known types`);if((m==="to-boolean"||m==="to-string")&&c.length!==2)return d.error("Expected one argument.");var m=is[m],b=[];for(let S=1;S<c.length;S++){var E=d.parse(c[S],S,nn);if(!E)return null;b.push(E)}return new nc(m,b)}evaluate(c){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(c);case"color":{let S,A;for(const I of this.args){if(S=I.evaluate(c),A=null,S instanceof ir)return S;if(typeof S=="string"){var d=c.parseColor(S);if(d)return d}else if(Array.isArray(S)&&!(A=S.length<3||4<S.length?`Invalid rbga value ${JSON.stringify(S)}: expected an array containing either three or four numeric values.`:wl(S[0],S[1],S[2],S[3])))return new ir(S[0]/255,S[1]/255,S[2]/255,S[3])}throw new or(A||`Could not parse color from value '${typeof S=="string"?S:JSON.stringify(S)}'`)}case"padding":{let S;for(const A of this.args){S=A.evaluate(c);var m=$r.parse(S);if(m)return m}throw new or(`Could not parse padding from value '${typeof S=="string"?S:JSON.stringify(S)}'`)}case"variableAnchorOffsetCollection":{let S;for(const A of this.args){S=A.evaluate(c);var b=Jo.parse(S);if(b)return b}throw new or(`Could not parse variableAnchorOffsetCollection from value '${typeof S=="string"?S:JSON.stringify(S)}'`)}case"number":{let S=null;for(const A of this.args){if((S=A.evaluate(c))===null)return 0;var E=Number(S);if(!isNaN(E))return E}throw new or(`Could not convert ${JSON.stringify(S)} to number.`)}case"formatted":return to.fromString(Rs(this.args[0].evaluate(c)));case"resolvedImage":return ea.fromString(Rs(this.args[0].evaluate(c)));default:return Rs(this.args[0].evaluate(c))}}eachChild(c){this.args.forEach(c)}outputDefined(){return this.args.every(c=>c.outputDefined())}}const Qh=["Unknown","Point","LineString","Polygon"];class Jh{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Qh[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(c){let d=this._parseColorCache[c];return d=d||(this._parseColorCache[c]=ir.parse(c))}}class xl{constructor(c,d,m=[],b,E=new qt,S=[]){this.registry=c,this.path=m,this.key=m.map(A=>`[${A}]`).join(""),this.scope=E,this.errors=S,this.expectedType=b,this._isConstant=d}parse(c,d,m,b,E={}){return(d?this.concat(d,m,b):this)._parse(c,E)}_parse(c,d){function m(A,I,O){return O==="assert"?new Hn(I,[A]):O==="coerce"?new nc(I,[A]):A}if(c!==null&&typeof c!="string"&&typeof c!="boolean"&&typeof c!="number"||(c=["literal",c]),Array.isArray(c)){if(c.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');var b=c[0];if(typeof b!="string")return this.error(`Expression name must be a string, but found ${typeof b} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;var E=this.registry[b];if(E){let A=E.parse(c,this);if(!A)return null;if(this.expectedType){var E=this.expectedType,S=A.type;if(E.kind!=="string"&&E.kind!=="number"&&E.kind!=="boolean"&&E.kind!=="object"&&E.kind!=="array"||S.kind!=="value")if(E.kind!=="color"&&E.kind!=="formatted"&&E.kind!=="resolvedImage"||S.kind!=="value"&&S.kind!=="string")if(E.kind!=="padding"||S.kind!=="value"&&S.kind!=="number"&&S.kind!=="array")if(E.kind!=="variableAnchorOffsetCollection"||S.kind!=="value"&&S.kind!=="array"){if(this.checkSubtype(E,S))return null}else A=m(A,E,d.typeAnnotation||"coerce");else A=m(A,E,d.typeAnnotation||"coerce");else A=m(A,E,d.typeAnnotation||"coerce");else A=m(A,E,d.typeAnnotation||"assert")}if(!(A instanceof La)&&A.type.kind!=="resolvedImage"&&this._isConstant(A)){S=new Jh;try{A=new La(A.type,A.evaluate(S))}catch(I){return this.error(I.message),null}}return A}return this.error(`Unknown expression "${b}". If you wanted a literal array, use ["literal", [...]].`,0)}return c===void 0?this.error("'undefined' value invalid. Use null instead."):typeof c=="object"?this.error('Bare objects invalid. Use ["literal", {...}] instead.'):this.error(`Expected an array, but found ${typeof c} instead.`)}concat(c,d,m){return c=typeof c=="number"?this.path.concat(c):this.path,m=m?this.scope.concat(m):this.scope,new xl(this.registry,this._isConstant,c,d||null,m,this.errors)}error(c,...d){d=""+this.key+d.map(m=>`[${m}]`).join(""),this.errors.push(new xt(d,c))}checkSubtype(c,d){return c=Oe(c,d),c&&this.error(c),c}}class Cu{constructor(c,d,m){this.type=Fr,this.locale=m,this.caseSensitive=c,this.diacriticSensitive=d}static parse(c,d){if(c.length!==2)return d.error("Expected one argument.");if(c=c[1],typeof c!="object"||Array.isArray(c))return d.error("Collator options argument must be an object.");var m=d.parse(c["case-sensitive"]!==void 0&&c["case-sensitive"],1,Tt);if(!m)return null;var b=d.parse(c["diacritic-sensitive"]!==void 0&&c["diacritic-sensitive"],1,Tt);if(!b)return null;let E=null;return c.locale&&!(E=d.parse(c.locale,1,gt))?null:new Cu(m,b,E)}evaluate(c){return new Do(this.caseSensitive.evaluate(c),this.diacriticSensitive.evaluate(c),this.locale?this.locale.evaluate(c):null)}eachChild(c){c(this.caseSensitive),c(this.diacriticSensitive),this.locale&&c(this.locale)}outputDefined(){return!1}}const rc=8192;function te(u,c){u[0]=Math.min(u[0],c[0]),u[1]=Math.min(u[1],c[1]),u[2]=Math.max(u[2],c[0]),u[3]=Math.max(u[3],c[1])}function le(u,c){return!(u[0]<=c[0]||u[2]>=c[2]||u[1]<=c[1]||u[3]>=c[3])}function Se(m,b){var d=(180+m[0])/360,m=(m=m[1],(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+m*Math.PI/360)))/360),b=Math.pow(2,b.z);return[Math.round(d*b*rc),Math.round(m*b*rc)]}function qe(u,c){let d=!1;for(let O=0,k=c.length;O<k;O++){var m=c[O];for(let U=0,W=m.length;U<W-1;U++){if(b=u,E=m[U],S=m[U+1],I=A=void 0,A=b[0]-E[0],E=b[1]-E[1],I=b[0]-S[0],b=b[1]-S[1],A*b-I*E==0&&A*I<=0&&E*b<=0)return;S=u,A=m[U],I=m[U+1],A[1]>S[1]!=I[1]>S[1]&&S[0]<(I[0]-A[0])*(S[1]-A[1])/(I[1]-A[1])+A[0]&&(d=!d)}}var b,E,S,A,I;return d}function yt(b,S,O,I){var k=b[0]-O[0],b=b[1]-O[1],E=S[0]-O[0],S=S[1]-O[1],A=I[0]-O[0],I=I[1]-O[1],O=k*I-A*b,k=E*I-A*S;return 0<O&&k<0||O<0&&0<k}function Jt(u,c,d){for(const O of d)for(let k=0;k<O.length-1;++k)if(m=u,b=c,E=O[k],S=O[k+1],I=A=void 0,A=[b[0]-m[0],b[1]-m[1]],(I=[S[0]-E[0],S[1]-E[1]])[0]*A[1]-I[1]*A[0]!=0&&!(!yt(m,b,E,S)||!yt(E,S,m,b)))return 1;var m,b,E,S,A,I}function Zn(u,c){for(let d=0;d<u.length;++d)if(!qe(u[d],c))return;for(let d=0;d<u.length-1;++d)if(Jt(u[d],u[d+1],c))return;return 1}function Mi(u,c,d){var m=[];for(let S=0;S<u.length;S++){var b=[];for(let A=0;A<u[S].length;A++){var E=Se(u[S][A],d);te(c,E),b.push(E)}m.push(b)}return m}function Wi(u,c,d){var m=[];for(let E=0;E<u.length;E++){var b=Mi(u[E],c,d);m.push(b)}return m}function yo(u,c,d,m){if(u[0]<d[0]||u[0]>d[2]){var b=.5*m;let E=u[0]-d[0]>b?-m:d[0]-u[0]>b?m:0;E===0&&(E=u[0]-d[2]>b?-m:d[2]-u[0]>b?m:0),u[0]+=E}te(c,u)}function Na(u,c,d,m){var b=Math.pow(2,m.z)*rc,E=[m.x*rc,m.y*rc],S=[];for(const I of u)for(const O of I){var A=[O.x+E[0],O.y+E[1]];yo(A,c,d,b),S.push(A)}return S}function Lm(u,c,d,m){var b=Math.pow(2,m.z)*rc,E=[m.x*rc,m.y*rc],S=[];for(const O of u){var A=[];for(const k of O){var I=[k.x+E[0],k.y+E[1]];te(c,I),A.push(I)}S.push(A)}if(c[2]-c[0]<=b/2){(m=c)[0]=m[1]=1/0,m[2]=m[3]=-1/0;for(const O of S)for(const k of O)yo(k,c,d,b)}return S}function UE(u,c){var d=[1/0,1/0,-1/0,-1/0],m=[1/0,1/0,-1/0,-1/0],b=u.canonicalID();if(c.type==="Polygon"){var E=Mi(c.coordinates,m,b),S=Na(u.geometry(),d,m,b);if(!le(d,m))return!1;for(const I of S)if(!qe(I,E))return!1}if(c.type==="MultiPolygon"){var A=Wi(c.coordinates,m,b),S=Na(u.geometry(),d,m,b);if(!le(d,m))return!1;for(const O of S)if(!function(k,U){for(let W=0;W<U.length;W++)if(qe(k,U[W]))return 1}(O,A))return!1}return!0}function zE(u,c){var d=[1/0,1/0,-1/0,-1/0],m=[1/0,1/0,-1/0,-1/0],b=u.canonicalID();if(c.type==="Polygon"){var E=Mi(c.coordinates,m,b),S=Lm(u.geometry(),d,m,b);if(!le(d,m))return!1;for(const I of S)if(!Zn(I,E))return!1}if(c.type==="MultiPolygon"){var A=Wi(c.coordinates,m,b),S=Lm(u.geometry(),d,m,b);if(!le(d,m))return!1;for(const O of S)if(!function(k,U){for(let W=0;W<U.length;W++)if(Zn(k,U[W]))return 1}(O,A))return!1}return!0}class Au{constructor(c,d){this.type=Tt,this.geojson=c,this.geometries=d}static parse(c,d){if(c.length!==2)return d.error(`'within' expression requires exactly one argument, but found ${c.length-1} instead.`);if(no(c[1])){if(c=c[1],c.type==="FeatureCollection"){var m=[];for(const A of c.features){var{type:b,coordinates:E}=A.geometry;b==="Polygon"&&m.push(E),b==="MultiPolygon"&&m.push(...E)}if(m.length)return S={type:"MultiPolygon",coordinates:m},new Au(c,S)}else if(c.type==="Feature"){var S=c.geometry.type;if(S==="Polygon"||S==="MultiPolygon")return new Au(c,c.geometry)}else if(c.type==="Polygon"||c.type==="MultiPolygon")return new Au(c,c)}return d.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(c){if(c.geometry()!=null&&c.canonicalID()!=null){if(c.geometryType()==="Point")return UE(c,this.geometries);if(c.geometryType()==="LineString")return zE(c,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}class Jf{constructor(c,d){this.type=d.type,this.name=c,this.boundExpression=d}static parse(c,d){return c.length!==2||typeof c[1]!="string"?d.error("'var' expression requires exactly one string literal argument."):(c=c[1],d.scope.has(c)?new Jf(c,d.scope.get(c)):d.error(`Unknown variable "${c}". Make sure "${c}" has been bound in an enclosing "let" expression before using it.`,1))}evaluate(c){return this.boundExpression.evaluate(c)}eachChild(){}outputDefined(){return!1}}class Da{constructor(c,d,m,b){this.name=c,this.type=d,this._evaluate=m,this.args=b}evaluate(c){return this._evaluate(c,this.args)}eachChild(c){this.args.forEach(c)}outputDefined(){return!1}static parse(c,d){var m=c[0],A=Da.definitions[m];if(!A)return d.error(`Unknown expression "${m}". If you wanted a literal array, use ["literal", [...]].`,0);var b,E,S=Array.isArray(A)?A[0]:A.type,A=Array.isArray(A)?[[A[1],A[2]]]:A.overloads,I=A.filter(([de])=>!Array.isArray(de)||de.length===c.length-1);let O=null;for([b,E]of I){O=new xl(d.registry,Nm,d.path,null,d.scope);var k=[];let de=!1;for(let Me=1;Me<c.length;Me++){var W=c[Me],U=Array.isArray(b)?b[Me-1]:b.type,W=O.parse(W,1+k.length,U);if(!W){de=!0;break}k.push(W)}if(!de)if(Array.isArray(b)&&b.length!==k.length)O.error(`Expected ${b.length} arguments, but found ${k.length} instead.`);else{for(let Me=0;Me<k.length;Me++){var re=Array.isArray(b)?b[Me]:b.type,ie=k[Me];O.concat(Me+1).checkSubtype(re,ie.type)}if(O.errors.length===0)return new Da(m,S,E,k)}}if(I.length===1)d.errors.push(...O.errors);else{var I=(I.length?I:A).map(([Me])=>_R(Me)).join(" | "),fe=[];for(let Me=1;Me<c.length;Me++){var we=d.parse(c[Me],1+fe.length);if(!we)return null;fe.push(K(we.type))}d.error(`Expected arguments of type ${I}, but found (${fe.join(", ")}) instead.`)}return null}static register(c,d){for(const m in Da.definitions=d)c[m]=Da}}function _R(u){return Array.isArray(u)?`(${u.map(K).join(", ")})`:`(${K(u.type)}...)`}function Nm(u){if(u instanceof Jf)return Nm(u.boundExpression);if(u instanceof Da&&u.name==="error"||u instanceof Cu||u instanceof Au)return!1;const c=u instanceof nc||u instanceof Hn;let d=!0;return u.eachChild(m=>{d=c?d&&Nm(m):d&&m instanceof La}),!!d&&Dm(u)&&Fm(u,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function Dm(u){if(u instanceof Da&&(u.name==="get"&&u.args.length===1||u.name==="feature-state"||u.name==="has"&&u.args.length===1||u.name==="properties"||u.name==="geometry-type"||u.name==="id"||/^filter-/.test(u.name))||u instanceof Au)return!1;let c=!0;return u.eachChild(d=>{c&&!Dm(d)&&(c=!1)}),c}function ep(u){if(!(u instanceof Da&&u.name==="feature-state")){let c=!0;return u.eachChild(d=>{c&&!ep(d)&&(c=!1)}),c}}function Fm(u,c){if(u instanceof Da&&0<=c.indexOf(u.name))return!1;let d=!0;return u.eachChild(m=>{d&&!Fm(m,c)&&(d=!1)}),d}function Bm(u,c){var d=u.length-1;let m=0,b=d;for(var E,S,A;m<=b;)if(S=u[E=Math.floor((m+b)/2)],A=u[E+1],S<=c){if(E===d||c<A)return E;m=E+1}else{if(!(c<S))throw new or("Input is not a number.");b=E-1}return 0}class Iu{constructor(c,d,m){this.type=c,this.input=d,this.labels=[],this.outputs=[];for(var[b,E]of m)this.labels.push(b),this.outputs.push(E)}static parse(c,d){if(c.length-1<4)return d.error(`Expected at least 4 arguments, but found only ${c.length-1}.`);if((c.length-1)%2!=0)return d.error("Expected an even number of arguments.");var m=d.parse(c[1],1,Ke);if(!m)return null;var b=[];let E=null;d.expectedType&&d.expectedType.kind!=="value"&&(E=d.expectedType);for(let k=1;k<c.length;k+=2){var S=k===1?-1/0:c[k],A=c[k+1],I=k,O=k+1;if(typeof S!="number")return d.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',I);if(b.length&&b[b.length-1][0]>=S)return d.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',I);if(I=d.parse(A,O,E),!I)return null;E=E||I.type,b.push([S,I])}return new Iu(E,m,b)}evaluate(c){var d,m,b=this.labels,E=this.outputs;return(b.length===1||(d=this.input.evaluate(c))<=b[0]?E[0]:d>=b[(m=b.length)-1]?E[m-1]:E[Bm(b,d)]).evaluate(c)}eachChild(c){c(this.input);for(const d of this.outputs)c(d)}outputDefined(){return this.outputs.every(c=>c.outputDefined())}}function Um(u){return u&&u.__esModule&&Object.prototype.hasOwnProperty.call(u,"default")?u.default:u}var np=xr;function xr(u,c,d,m){this.cx=3*u,this.bx=3*(d-u)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*c,this.by=3*(m-c)-this.cy,this.ay=1-this.cy-this.by,this.p1x=u,this.p1y=c,this.p2x=d,this.p2y=m}xr.prototype={sampleCurveX:function(u){return((this.ax*u+this.bx)*u+this.cx)*u},sampleCurveY:function(u){return((this.ay*u+this.by)*u+this.cy)*u},sampleCurveDerivativeX:function(u){return(3*this.ax*u+2*this.bx)*u+this.cx},solveCurveX:function(u,c){if(c===void 0&&(c=1e-6),u<0)return 0;if(1<u)return 1;for(var d=u,m=0;m<8;m++){var b=this.sampleCurveX(d)-u;if(Math.abs(b)<c)return d;var E=this.sampleCurveDerivativeX(d);if(Math.abs(E)<1e-6)break;d-=b/E}for(var S=0,A=1,d=u,m=0;m<20&&(b=this.sampleCurveX(d),!(Math.abs(b-u)<c));m++)b<u?S=d:A=d,d=.5*(A-S)+S;return d},solve:function(u,c){return this.sampleCurveY(this.solveCurveX(u,c))}};var vR=Um(np);function Pu(u,c,d){return u+d*(c-u)}function zm(u,c,d){return u.map((m,b)=>Pu(m,c[b],d))}const Fa={number:Pu,color:function(u,c,d,m="rgb"){switch(m){case"rgb":var[b,E,k,S]=zm(u.rgb,c.rgb,d);return new ir(b,E,k,S,!1);case"hcl":{var[b,E,k,S]=u.hcl,[I,O,U,A]=c.hcl;let we,de;if(isNaN(b)||isNaN(I))isNaN(b)?isNaN(I)?we=NaN:(we=I,k!==1&&k!==0||(de=O)):(we=b,U!==1&&U!==0||(de=E));else{let Ye=I-b;b<I&&180<Ye?Ye-=360:I<b&&180<b-I&&(Ye+=360),we=b+d*Ye}[I,b,E,O]=[[we,de??Pu(E,O,d),Pu(k,U,d),Pu(S,A,d)]][0],I=isNaN(I)?0:I*Kn;var[k,U,S,A]=Yn([E,Math.cos(I)*b,Math.sin(I)*b,O]);return new ir(k,U,S,A,!1)}case"lab":var[I,O,k,U]=Yn(zm(u.lab,c.lab,d));return new ir(I,O,k,U,!1)}},array:zm,padding:function(u,c,d){return new $r(zm(u.values,c.values,d))},variableAnchorOffsetCollection:function(u,c,d){var m=u.values,b=c.values;if(m.length!==b.length)throw new or(`Cannot interpolate values of different length. from: ${u.toString()}, to: `+c.toString());var E=[];for(let k=0;k<m.length;k+=2){if(m[k]!==b[k])throw new or(`Cannot interpolate values containing mismatched anchors. from[${k}]: ${m[k]}, to[${k}]: `+b[k]);E.push(m[k]);var[S,A]=m[k+1],[I,O]=b[k+1];E.push([Pu(S,I,d),Pu(A,O,d)])}return new Jo(E)}};class Ba{constructor(c,d,m,b,E){this.type=c,this.operator=d,this.interpolation=m,this.input=b,this.labels=[],this.outputs=[];for(var[S,A]of E)this.labels.push(S),this.outputs.push(A)}static interpolationFactor(c,d,m,b){let E=0;return c.name==="exponential"?E=P0(d,c.base,m,b):c.name==="linear"?E=P0(d,1,m,b):c.name==="cubic-bezier"&&(c=c.controlPoints,c=new vR(c[0],c[1],c[2],c[3]),E=c.solve(P0(d,1,m,b))),E}static parse(c,d){let[m,b,E,...S]=c;if(!Array.isArray(b)||b.length===0)return d.error("Expected an interpolation type expression.",1);if(b[0]==="linear")b={name:"linear"};else if(b[0]==="exponential"){var A=b[1];if(typeof A!="number")return d.error("Exponential interpolation requires a numeric base.",1,1);b={name:"exponential",base:A}}else{if(b[0]!=="cubic-bezier")return d.error("Unknown interpolation type "+String(b[0]),1,0);if(A=b.slice(1),A.length!==4||A.some(ie=>typeof ie!="number"||ie<0||1<ie))return d.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);b={name:"cubic-bezier",controlPoints:A}}if(c.length-1<4)return d.error(`Expected at least 4 arguments, but found only ${c.length-1}.`);if((c.length-1)%2!=0)return d.error("Expected an even number of arguments.");if(!(E=d.parse(E,2,Ke)))return null;var I=[];let O=null;m==="interpolate-hcl"||m==="interpolate-lab"?O=Rn:d.expectedType&&d.expectedType.kind!=="value"&&(O=d.expectedType);for(let ie=0;ie<S.length;ie+=2){var k=S[ie],U=S[ie+1],W=ie+3,re=ie+4;if(typeof k!="number")return d.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',W);if(I.length&&I[I.length-1][0]>=k)return d.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',W);if(W=d.parse(U,re,O),!W)return null;O=O||W.type,I.push([k,W])}return Ce(O,Ke)||Ce(O,Rn)||Ce(O,Ar)||Ce(O,V)||Ce(O,$(Ke))?new Ba(O,m,b,E,I):d.error(`Type ${K(O)} is not interpolatable.`)}evaluate(c){var S=this.labels,d=this.outputs;if(S.length===1)return d[0].evaluate(c);var m=this.input.evaluate(c);if(m<=S[0])return d[0].evaluate(c);var b=S.length;if(m>=S[b-1])return d[b-1].evaluate(c);var b=Bm(S,m),E=S[b],S=S[b+1],A=Ba.interpolationFactor(this.interpolation,m,E,S),I=d[b].evaluate(c),O=d[b+1].evaluate(c);switch(this.operator){case"interpolate":return Fa[this.type.kind](I,O,A);case"interpolate-hcl":return Fa.color(I,O,A,"hcl");case"interpolate-lab":return Fa.color(I,O,A,"lab")}}eachChild(c){c(this.input);for(const d of this.outputs)c(d)}outputDefined(){return this.outputs.every(c=>c.outputDefined())}}function P0(u,c,d,m){return m-=d,u-=d,m==0?0:c===1?u/m:(Math.pow(c,u)-1)/(Math.pow(c,m)-1)}class tp{constructor(c,d){this.type=c,this.args=d}static parse(c,d){if(c.length<2)return d.error("Expectected at least one argument.");let m=null;const b=d.expectedType;b&&b.kind!=="value"&&(m=b);var E=[];for(const A of c.slice(1)){var S=d.parse(A,1+E.length,m,void 0,{typeAnnotation:"omit"});if(!S)return null;m=m||S.type,E.push(S)}if(m)return b&&E.some(A=>Oe(b,A.type))?new tp(nn,E):new tp(m,E);throw new Error("No output type")}evaluate(c){let d=null,m=0,b;for(const E of this.args)if(m++,(d=(d=E.evaluate(c))&&d instanceof ea&&!d.available&&(b=b||d.name,d=null,m===this.args.length)?b:d)!==null)break;return d}eachChild(c){this.args.forEach(c)}outputDefined(){return this.args.every(c=>c.outputDefined())}}class jm{constructor(c,d){this.type=d.type,this.bindings=[].concat(c),this.result=d}evaluate(c){return this.result.evaluate(c)}eachChild(c){for(const d of this.bindings)c(d[1]);c(this.result)}static parse(c,d){if(c.length<4)return d.error(`Expected at least 3 arguments, but found ${c.length-1} instead.`);var m=[];for(let A=1;A<c.length-1;A+=2){var b=c[A];if(typeof b!="string")return d.error(`Expected string, but found ${typeof b} instead.`,A);if(/[^a-zA-Z0-9_]/.test(b))return d.error("Variable names must contain only alphanumeric characters or '_'.",A);var E=d.parse(c[A+1],A+1);if(!E)return null;m.push([b,E])}var S=d.parse(c[c.length-1],c.length-1,d.expectedType,m);return S?new jm(m,S):null}outputDefined(){return this.result.outputDefined()}}function jE(u,c){return u==="=="||u==="!="?c.kind==="boolean"||c.kind==="string"||c.kind==="number"||c.kind==="null"||c.kind==="value":c.kind==="string"||c.kind==="number"||c.kind==="value"}function VE(u,c,d,m){return m.compare(c,d)===0}function ed(u,c,d){const m=u!=="=="&&u!=="!=";return class GV{constructor(E,S,A){this.type=Tt,this.lhs=E,this.rhs=S,this.collator=A,this.hasUntypedArgument=E.type.kind==="value"||S.type.kind==="value"}static parse(E,S){if(E.length!==3&&E.length!==4)return S.error("Expected two or three arguments.");var A=E[0];let I=S.parse(E[1],1,nn);if(!I)return null;if(!jE(A,I.type))return S.concat(1).error(`"${A}" comparisons are not supported for type '${K(I.type)}'.`);let O=S.parse(E[2],2,nn);if(!O)return null;if(!jE(A,O.type))return S.concat(2).error(`"${A}" comparisons are not supported for type '${K(O.type)}'.`);if(I.type.kind!==O.type.kind&&I.type.kind!=="value"&&O.type.kind!=="value")return S.error(`Cannot compare types '${K(I.type)}' and '${K(O.type)}'.`);m&&(I.type.kind==="value"&&O.type.kind!=="value"?I=new Hn(O.type,[I]):I.type.kind!=="value"&&O.type.kind==="value"&&(O=new Hn(I.type,[O])));let k=null;if(E.length===4){if(I.type.kind!=="string"&&O.type.kind!=="string"&&I.type.kind!=="value"&&O.type.kind!=="value")return S.error("Cannot use collator to compare non-string types.");if(!(k=S.parse(E[3],3,Fr)))return null}return new GV(I,O,k)}evaluate(E){var S=this.lhs.evaluate(E),A=this.rhs.evaluate(E);if(m&&this.hasUntypedArgument){var I=ci(S),O=ci(A);if(I.kind!==O.kind||I.kind!=="string"&&I.kind!=="number")throw new or(`Expected arguments for "${u}" to be (string, string) or (number, number), but found (${I.kind}, ${O.kind}) instead.`)}return this.collator&&!m&&this.hasUntypedArgument&&(I=ci(S),O=ci(A),I.kind!=="string"||O.kind!=="string")?c(E,S,A):this.collator?d(E,S,A,this.collator.evaluate(E)):c(E,S,A)}eachChild(E){E(this.lhs),E(this.rhs),this.collator&&E(this.collator)}outputDefined(){return!0}}}var np=ed("==",function(u,c,d){return c===d},VE),ao=ed("!=",function(u,c,d){return c!==d},function(u,c,d,m){return!VE(0,c,d,m)}),ls=ed("<",function(u,c,d){return c<d},function(u,c,d,m){return m.compare(c,d)<0}),rp=ed(">",function(u,c,d){return d<c},function(u,c,d,m){return 0<m.compare(c,d)}),Rc=ed("<=",function(u,c,d){return c<=d},function(u,c,d,m){return m.compare(c,d)<=0}),Or=ed(">=",function(u,c,d){return d<=c},function(u,c,d,m){return 0<=m.compare(c,d)});class Vm{constructor(c){this.type=ti,this.sections=c}static parse(c,d){if(c.length<2)return d.error("Expected at least one argument.");var m=c[1];if(!Array.isArray(m)&&typeof m=="object")return d.error("First argument must be an image or text section.");var b=[];let E=!1;for(let I=1;I<=c.length-1;++I){var S=c[I];if(E&&typeof S=="object"&&!Array.isArray(S)){E=!1;let O=null;if(S["font-scale"]&&!(O=d.parse(S["font-scale"],1,Ke)))return null;let k=null;if(S["text-font"]&&!(k=d.parse(S["text-font"],1,$(gt))))return null;let U=null;if(S["text-color"]&&!(U=d.parse(S["text-color"],1,Rn)))return null;S=b[b.length-1],S.scale=O,S.font=k,S.textColor=U}else{if(S=d.parse(c[I],1,nn),!S)return null;var A=S.type.kind;if(A!=="string"&&A!=="value"&&A!=="null"&&A!=="resolvedImage")return d.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");E=!0,b.push({content:S,scale:null,font:null,textColor:null})}}return new Vm(b)}evaluate(c){return new to(this.sections.map(d=>{var m=d.content.evaluate(c);return ci(m)===oe?new Oa("",m,null,null,null):new Oa(Rs(m),null,d.scale?d.scale.evaluate(c):null,d.font?d.font.evaluate(c).join(","):null,d.textColor?d.textColor.evaluate(c):null)}))}eachChild(c){for(const d of this.sections)c(d.content),d.scale&&c(d.scale),d.font&&c(d.font),d.textColor&&c(d.textColor)}outputDefined(){return!1}}const td={"==":np,"!=":ao,">":rp,"<":ls,">=":Or,"<=":Rc,array:Hn,at:class qV{constructor(c,d,m){this.type=c,this.index=d,this.input=m}static parse(c,d){var m;return c.length!==3?d.error(`Expected 2 arguments, but found ${c.length-1} instead.`):(m=d.parse(c[1],1,Ke),c=d.parse(c[2],2,$(d.expectedType||nn)),m&&c?(d=c.type,new qV(d.itemType,m,c)):null)}evaluate(m){var d=this.index.evaluate(m),m=this.input.evaluate(m);if(d<0)throw new or(`Array index out of bounds: ${d} < 0.`);if(d>=m.length)throw new or(`Array index out of bounds: ${d} > ${m.length-1}.`);if(d!==Math.floor(d))throw new or(`Array index must be an integer, but found ${d} instead.`);return m[d]}eachChild(c){c(this.index),c(this.input)}outputDefined(){return!1}},boolean:Hn,case:class $V{constructor(c,d,m){this.type=c,this.branches=d,this.otherwise=m}static parse(c,d){if(c.length<4)return d.error(`Expected at least 3 arguments, but found only ${c.length-1}.`);if(c.length%2!=0)return d.error("Expected an odd number of arguments.");let m;d.expectedType&&d.expectedType.kind!=="value"&&(m=d.expectedType);var b=[];for(let I=1;I<c.length-1;I+=2){var E=d.parse(c[I],I,Tt);if(!E)return null;var S=d.parse(c[I+1],I+1,m);if(!S)return null;b.push([E,S]),m=m||S.type}var A=d.parse(c[c.length-1],c.length-1,m);if(!A)return null;if(m)return new $V(m,b,A);throw new Error("Can't infer output type")}evaluate(c){for(var[d,m]of this.branches)if(d.evaluate(c))return m.evaluate(c);return this.otherwise.evaluate(c)}eachChild(c){for(var[d,m]of this.branches)c(d),c(m);c(this.otherwise)}outputDefined(){return this.branches.every(([,c])=>c.outputDefined())&&this.otherwise.outputDefined()}},coalesce:tp,collator:Cu,format:Vm,image:class WV{constructor(c){this.type=oe,this.input=c}static parse(c,d){return c.length!==2?d.error("Expected two arguments."):(c=d.parse(c[1],1,gt))?new WV(c):d.error("No image name provided.")}evaluate(c){var d=this.input.evaluate(c),m=ea.fromString(d);return m&&c.availableImages&&(m.available=-1<c.availableImages.indexOf(d)),m}eachChild(c){c(this.input)}outputDefined(){return!1}},in:class YV{constructor(c,d){this.type=Tt,this.needle=c,this.haystack=d}static parse(c,d){var m;return c.length!==3?d.error(`Expected 2 arguments, but found ${c.length-1} instead.`):(m=d.parse(c[1],1,nn),c=d.parse(c[2],2,nn),m&&c?He(m.type,[Tt,gt,Ke,fn,nn])?new YV(m,c):d.error(`Expected first argument to be of type boolean, string, number or null, but found ${K(m.type)} instead`):null)}evaluate(c){var d=this.needle.evaluate(c);if(!(c=this.haystack.evaluate(c)))return!1;if(!Ne(d,["boolean","string","number","null"]))throw new or(`Expected first argument to be of type boolean, string, number or null, but found ${K(ci(d))} instead.`);if(Ne(c,["string","array"]))return 0<=c.indexOf(d);throw new or(`Expected second argument to be of type array or string, but found ${K(ci(c))} instead.`)}eachChild(c){c(this.needle),c(this.haystack)}outputDefined(){return!0}},"index-of":class mk{constructor(c,d,m){this.type=Ke,this.needle=c,this.haystack=d,this.fromIndex=m}static parse(c,d){var m,b;return c.length<=2||5<=c.length?d.error(`Expected 3 or 4 arguments, but found ${c.length-1} instead.`):(m=d.parse(c[1],1,nn),b=d.parse(c[2],2,nn),m&&b?He(m.type,[Tt,gt,Ke,fn,nn])?c.length===4?(c=d.parse(c[3],3,Ke))?new mk(m,b,c):null:new mk(m,b):d.error(`Expected first argument to be of type boolean, string, number or null, but found ${K(m.type)} instead`):null)}evaluate(c){var d=this.needle.evaluate(c),m=this.haystack.evaluate(c);if(!Ne(d,["boolean","string","number","null"]))throw new or(`Expected first argument to be of type boolean, string, number or null, but found ${K(ci(d))} instead.`);if(Ne(m,["string","array"]))return this.fromIndex?(c=this.fromIndex.evaluate(c),m.indexOf(d,c)):m.indexOf(d);throw new or(`Expected second argument to be of type array or string, but found ${K(ci(m))} instead.`)}eachChild(c){c(this.needle),c(this.haystack),this.fromIndex&&c(this.fromIndex)}outputDefined(){return!1}},interpolate:Ba,"interpolate-hcl":Ba,"interpolate-lab":Ba,length:class KV{constructor(c){this.type=Ke,this.input=c}static parse(c,d){return c.length!==2?d.error(`Expected 1 argument, but found ${c.length-1} instead.`):(c=d.parse(c[1],1))?c.type.kind!=="array"&&c.type.kind!=="string"&&c.type.kind!=="value"?d.error(`Expected argument of type string or array, but found ${K(c.type)} instead.`):new KV(c):null}evaluate(c){if(typeof(c=this.input.evaluate(c))=="string"||Array.isArray(c))return c.length;throw new or(`Expected value to be of type string or array, but found ${K(ci(c))} instead.`)}eachChild(c){c(this.input)}outputDefined(){return!1}},let:jm,literal:La,match:class ZV{constructor(c,d,m,b,E,S){this.inputType=c,this.type=d,this.input=m,this.cases=b,this.outputs=E,this.otherwise=S}static parse(c,d){if(c.length<5)return d.error(`Expected at least 4 arguments, but found only ${c.length-1}.`);if(c.length%2!=1)return d.error("Expected an even number of arguments.");let m,b;d.expectedType&&d.expectedType.kind!=="value"&&(b=d.expectedType);var E={},S=[];for(let U=2;U<c.length-1;U+=2){let W=c[U];var A=c[U+1],I=(Array.isArray(W)||(W=[W]),d.concat(U));if(W.length===0)return I.error("Expected at least one branch label.");for(const re of W){if(typeof re!="number"&&typeof re!="string")return I.error("Branch labels must be numbers or strings.");if(typeof re=="number"&&Math.abs(re)>Number.MAX_SAFE_INTEGER)return I.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof re=="number"&&Math.floor(re)!==re)return I.error("Numeric branch labels must be integer values.");if(m){if(I.checkSubtype(m,ci(re)))return null}else m=ci(re);if(E[String(re)]!==void 0)return I.error("Branch labels must be unique.");E[String(re)]=S.length}if(!(A=d.parse(A,U,b)))return null;b=b||A.type,S.push(A)}var O,k=d.parse(c[1],1,nn);return!k||!(O=d.parse(c[c.length-1],c.length-1,b))||k.type.kind!=="value"&&d.concat(1).checkSubtype(m,k.type)?null:new ZV(m,b,k,E,S,O)}evaluate(c){var d=this.input.evaluate(c);return(ci(d)===this.inputType&&this.outputs[this.cases[d]]||this.otherwise).evaluate(c)}eachChild(c){c(this.input),this.outputs.forEach(c),c(this.otherwise)}outputDefined(){return this.outputs.every(c=>c.outputDefined())&&this.otherwise.outputDefined()}},number:Hn,"number-format":class XV{constructor(c,d,m,b,E){this.type=gt,this.number=c,this.locale=d,this.currency=m,this.minFractionDigits=b,this.maxFractionDigits=E}static parse(c,d){if(c.length!==3)return d.error("Expected two arguments.");var m=d.parse(c[1],1,Ke);if(!m)return null;if(typeof(c=c[2])!="object"||Array.isArray(c))return d.error("NumberFormat options argument must be an object.");let b=null;if(c.locale&&!(b=d.parse(c.locale,1,gt)))return null;let E=null;if(c.currency&&!(E=d.parse(c.currency,1,gt)))return null;let S=null;if(c["min-fraction-digits"]&&!(S=d.parse(c["min-fraction-digits"],1,Ke)))return null;let A=null;return c["max-fraction-digits"]&&!(A=d.parse(c["max-fraction-digits"],1,Ke))?null:new XV(m,b,E,S,A)}evaluate(c){return new Intl.NumberFormat(this.locale?this.locale.evaluate(c):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(c):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(c):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(c):void 0}).format(this.number.evaluate(c))}eachChild(c){c(this.number),this.locale&&c(this.locale),this.currency&&c(this.currency),this.minFractionDigits&&c(this.minFractionDigits),this.maxFractionDigits&&c(this.maxFractionDigits)}outputDefined(){return!1}},object:Hn,slice:class yk{constructor(c,d,m,b){this.type=c,this.input=d,this.beginIndex=m,this.endIndex=b}static parse(c,d){var m,b;return c.length<=2||5<=c.length?d.error(`Expected 3 or 4 arguments, but found ${c.length-1} instead.`):(m=d.parse(c[1],1,nn),b=d.parse(c[2],2,Ke),m&&b?He(m.type,[$(nn),gt,nn])?c.length===4?(c=d.parse(c[3],3,Ke))?new yk(m.type,m,b,c):null:new yk(m.type,m,b):d.error(`Expected first argument to be of type array or string, but found ${K(m.type)} instead`):null)}evaluate(c){var d=this.input.evaluate(c),m=this.beginIndex.evaluate(c);if(Ne(d,["string","array"]))return this.endIndex?(c=this.endIndex.evaluate(c),d.slice(m,c)):d.slice(m);throw new or(`Expected first argument to be of type array or string, but found ${K(ci(d))} instead.`)}eachChild(c){c(this.input),c(this.beginIndex),this.endIndex&&c(this.endIndex)}outputDefined(){return!1}},step:Iu,string:Hn,"to-boolean":nc,"to-color":nc,"to-number":nc,"to-string":nc,var:Jf,within:Au};function HE(u,[c,d,m,b]){if(c=c.evaluate(u),d=d.evaluate(u),m=m.evaluate(u),b=b?b.evaluate(u):1,u=wl(c,d,m,b),u)throw new or(u);return new ir(c/255,d/255,m/255,b,!1)}function M0(u,c){return c=c[u],c===void 0?null:c}function Mu(u){return{type:u}}function R0(u){return{result:"success",value:u}}function nd(u){return{result:"error",value:u}}function rd(u){return u["property-type"]==="data-driven"||u["property-type"]==="cross-faded-data-driven"}function GE(u){return u.expression&&-1<u.expression.parameters.indexOf("zoom")}function k0(u){return u.expression&&u.expression.interpolated}function _r(u){return u instanceof Number?"number":u instanceof String?"string":u instanceof Boolean?"boolean":Array.isArray(u)?"array":u===null?"null":typeof u}function Hm(u){return typeof u=="object"&&u!==null&&!Array.isArray(u)}function bR(u){return u}function qE(u,c){var d=c.type==="color",m=u.stops&&typeof u.stops[0][0]=="object",b=m||u.property!==void 0,b=m||!b,E=u.type||(k0(c)?"exponential":"interval");if(d||c.type==="padding"){const re=(d?ir:$r).parse;(u=At({},u)).stops&&(u.stops=u.stops.map(ie=>[ie[0],re(ie[1])])),u.default?u.default=re(u.default):u.default=re(c.default)}if(u.colorSpace&&(d=u.colorSpace)!=="rgb"&&d!=="hcl"&&d!=="lab")throw new Error(`Unknown color space: "${u.colorSpace}"`);let S,A,I;if(E==="exponential")S=Gm;else if(E==="interval")S=xR;else if(E==="categorical"){S=wR,A=Object.create(null);for(const re of u.stops)A[re[0]]=re[1];I=typeof u.stops[0][0]}else{if(E!=="identity")throw new Error(`Unknown function type "${E}"`);S=ER}if(m){var O={},k=[];for(let ie=0;ie<u.stops.length;ie++){var U=u.stops[ie],W=U[0].zoom;O[W]===void 0&&(O[W]={zoom:W,type:u.type,property:u.property,default:u.default,stops:[]},k.push(W)),O[W].stops.push([U[0].value,U[1]])}const re=[];for(const ie of k)re.push([O[ie].zoom,qE(O[ie],c)]);return d={name:"linear"},{kind:"composite",interpolationType:d,interpolationFactor:Ba.interpolationFactor.bind(void 0,d),zoomStops:re.map(ie=>ie[0]),evaluate({zoom:ie},fe){return Gm({stops:re,base:u.base},c,ie).evaluate(ie,fe)}}}return b?{kind:"camera",interpolationType:m=E==="exponential"?{name:"exponential",base:u.base!==void 0?u.base:1}:null,interpolationFactor:Ba.interpolationFactor.bind(void 0,m),zoomStops:u.stops.map(re=>re[0]),evaluate:({zoom:re})=>S(u,c,re,A,I)}:{kind:"source",evaluate(re,ie){return ie=ie&&ie.properties?ie.properties[u.property]:void 0,ie===void 0?ip(u.default,c.default):S(u,c,ie,A,I)}}}function ip(u,c,d){return u!==void 0?u:c!==void 0?c:d!==void 0?d:void 0}function wR(u,c,d,m,b){return ip(typeof d===b?m[d]:void 0,u.default,c.default)}function xR(u,c,d){return _r(d)!=="number"?ip(u.default,c.default):((c=u.stops.length)===1||d<=u.stops[0][0]?u.stops[0]:d>=u.stops[c-1][0]?u.stops[c-1]:(c=Bm(u.stops.map(m=>m[0]),d),u.stops[c]))[1]}function Gm(u,c,d){var m=u.base!==void 0?u.base:1;if(_r(d)!=="number")return ip(u.default,c.default);var b=u.stops.length;if(b===1||d<=u.stops[0][0])return u.stops[0][1];if(d>=u.stops[b-1][0])return u.stops[b-1][1];b=Bm(u.stops.map(O=>O[0]),d);const E=function(O,k,U,W){return W-=U,O-=U,W==0?0:k===1?O/W:(Math.pow(k,O)-1)/(Math.pow(k,W)-1)}(d,m,u.stops[b][0],u.stops[b+1][0]),S=u.stops[b][1],A=u.stops[b+1][1],I=Fa[c.type]||bR;return typeof S.evaluate=="function"?{evaluate(...U){var k=S.evaluate.apply(void 0,U),U=A.evaluate.apply(void 0,U);if(k!==void 0&&U!==void 0)return I(k,U,E,u.colorSpace)}}:I(S,A,E,u.colorSpace)}function ER(u,c,d){switch(c.type){case"color":d=ir.parse(d);break;case"formatted":d=to.fromString(d.toString());break;case"resolvedImage":d=ea.fromString(d.toString());break;case"padding":d=$r.parse(d);break;default:_r(d)===c.type||c.type==="enum"&&c.values[d]||(d=void 0)}return ip(d,u.default,c.default)}Da.register(td,{error:[{kind:"error"},[gt],(u,[c])=>{throw new or(c.evaluate(u))}],typeof:[gt,[nn],(u,[c])=>K(ci(c.evaluate(u)))],"to-rgba":[$(Ke,4),[Rn],(m,[d])=>{var[d,m,b,E]=d.evaluate(m).rgb;return[255*d,255*m,255*b,E]}],rgb:[Rn,[Ke,Ke,Ke],HE],rgba:[Rn,[Ke,Ke,Ke,Ke],HE],has:{type:Tt,overloads:[[[gt],(u,[c])=>c.evaluate(u)in u.properties()],[[gt,Qn],(u,[c,d])=>c.evaluate(u)in d.evaluate(u)]]},get:{type:nn,overloads:[[[gt],(u,[c])=>M0(c.evaluate(u),u.properties())],[[gt,Qn],(u,[c,d])=>M0(c.evaluate(u),d.evaluate(u))]]},"feature-state":[nn,[gt],(u,[c])=>M0(c.evaluate(u),u.featureState||{})],properties:[Qn,[],u=>u.properties()],"geometry-type":[gt,[],u=>u.geometryType()],id:[nn,[],u=>u.id()],zoom:[Ke,[],u=>u.globals.zoom],"heatmap-density":[Ke,[],u=>u.globals.heatmapDensity||0],"line-progress":[Ke,[],u=>u.globals.lineProgress||0],accumulated:[nn,[],u=>u.globals.accumulated===void 0?null:u.globals.accumulated],"+":[Ke,Mu(Ke),(u,c)=>{let d=0;for(const m of c)d+=m.evaluate(u);return d}],"*":[Ke,Mu(Ke),(u,c)=>{let d=1;for(const m of c)d*=m.evaluate(u);return d}],"-":{type:Ke,overloads:[[[Ke,Ke],(u,[c,d])=>c.evaluate(u)-d.evaluate(u)],[[Ke],(u,[c])=>-c.evaluate(u)]]},"/":[Ke,[Ke,Ke],(u,[c,d])=>c.evaluate(u)/d.evaluate(u)],"%":[Ke,[Ke,Ke],(u,[c,d])=>c.evaluate(u)%d.evaluate(u)],ln2:[Ke,[],()=>Math.LN2],pi:[Ke,[],()=>Math.PI],e:[Ke,[],()=>Math.E],"^":[Ke,[Ke,Ke],(u,[c,d])=>Math.pow(c.evaluate(u),d.evaluate(u))],sqrt:[Ke,[Ke],(u,[c])=>Math.sqrt(c.evaluate(u))],log10:[Ke,[Ke],(u,[c])=>Math.log(c.evaluate(u))/Math.LN10],ln:[Ke,[Ke],(u,[c])=>Math.log(c.evaluate(u))],log2:[Ke,[Ke],(u,[c])=>Math.log(c.evaluate(u))/Math.LN2],sin:[Ke,[Ke],(u,[c])=>Math.sin(c.evaluate(u))],cos:[Ke,[Ke],(u,[c])=>Math.cos(c.evaluate(u))],tan:[Ke,[Ke],(u,[c])=>Math.tan(c.evaluate(u))],asin:[Ke,[Ke],(u,[c])=>Math.asin(c.evaluate(u))],acos:[Ke,[Ke],(u,[c])=>Math.acos(c.evaluate(u))],atan:[Ke,[Ke],(u,[c])=>Math.atan(c.evaluate(u))],min:[Ke,Mu(Ke),(u,c)=>Math.min(...c.map(d=>d.evaluate(u)))],max:[Ke,Mu(Ke),(u,c)=>Math.max(...c.map(d=>d.evaluate(u)))],abs:[Ke,[Ke],(u,[c])=>Math.abs(c.evaluate(u))],round:[Ke,[Ke],(u,[c])=>(c=c.evaluate(u),c<0?-Math.round(-c):Math.round(c))],floor:[Ke,[Ke],(u,[c])=>Math.floor(c.evaluate(u))],ceil:[Ke,[Ke],(u,[c])=>Math.ceil(c.evaluate(u))],"filter-==":[Tt,[gt,nn],(u,[c,d])=>u.properties()[c.value]===d.value],"filter-id-==":[Tt,[nn],(u,[c])=>u.id()===c.value],"filter-type-==":[Tt,[gt],(u,[c])=>u.geometryType()===c.value],"filter-<":[Tt,[gt,nn],(u,[c,d])=>(u=u.properties()[c.value],c=d.value,typeof u==typeof c&&u<c)],"filter-id-<":[Tt,[nn],(u,[c])=>(u=u.id(),c=c.value,typeof u==typeof c&&u<c)],"filter->":[Tt,[gt,nn],(u,[c,d])=>(u=u.properties()[c.value],c=d.value,typeof u==typeof c&&c<u)],"filter-id->":[Tt,[nn],(u,[c])=>(u=u.id(),c=c.value,typeof u==typeof c&&c<u)],"filter-<=":[Tt,[gt,nn],(u,[c,d])=>(u=u.properties()[c.value],c=d.value,typeof u==typeof c&&u<=c)],"filter-id-<=":[Tt,[nn],(u,[c])=>(u=u.id(),c=c.value,typeof u==typeof c&&u<=c)],"filter->=":[Tt,[gt,nn],(u,[c,d])=>(u=u.properties()[c.value],c=d.value,typeof u==typeof c&&c<=u)],"filter-id->=":[Tt,[nn],(u,[c])=>(u=u.id(),c=c.value,typeof u==typeof c&&c<=u)],"filter-has":[Tt,[nn],(u,[c])=>c.value in u.properties()],"filter-has-id":[Tt,[],u=>u.id()!==null&&u.id()!==void 0],"filter-type-in":[Tt,[$(gt)],(u,[c])=>0<=c.value.indexOf(u.geometryType())],"filter-id-in":[Tt,[$(nn)],(u,[c])=>0<=c.value.indexOf(u.id())],"filter-in-small":[Tt,[gt,$(nn)],(u,[c,d])=>0<=d.value.indexOf(u.properties()[c.value])],"filter-in-large":[Tt,[gt,$(nn)],(u,[c,d])=>{for(var m=u.properties()[c.value],b=d.value,E=0,S=d.value.length-1;E<=S;){var A=E+S>>1;if(b[A]===m)return!0;b[A]>m?S=A-1:E=1+A}return!1}],all:{type:Tt,overloads:[[[Tt,Tt],(u,[c,d])=>c.evaluate(u)&&d.evaluate(u)],[Mu(Tt),(u,c)=>{for(const d of c)if(!d.evaluate(u))return!1;return!0}]]},any:{type:Tt,overloads:[[[Tt,Tt],(u,[c,d])=>c.evaluate(u)||d.evaluate(u)],[Mu(Tt),(u,c)=>{for(const d of c)if(d.evaluate(u))return!0;return!1}]]},"!":[Tt,[Tt],(u,[c])=>!c.evaluate(u)],"is-supported-script":[Tt,[gt],(u,[c])=>{var d=u.globals&&u.globals.isSupportedScript;return!d||d(c.evaluate(u))}],upcase:[gt,[gt],(u,[c])=>c.evaluate(u).toUpperCase()],downcase:[gt,[gt],(u,[c])=>c.evaluate(u).toLowerCase()],concat:[gt,Mu(nn),(u,c)=>c.map(d=>Rs(d.evaluate(u))).join("")],"resolved-locale":[gt,[Fr],(u,[c])=>c.evaluate(u).resolvedLocale()]});class O0{constructor(c,d){this.expression=c,this._warningHistory={},this._evaluator=new Jh,this._defaultValue=d?$E(d):null,this._enumValues=d&&d.type==="enum"?d.values:null}evaluateWithoutErrorHandling(c,d,m,b,E,S){return this._evaluator.globals=c,this._evaluator.feature=d,this._evaluator.featureState=m,this._evaluator.canonical=b,this._evaluator.availableImages=E||null,this._evaluator.formattedSection=S,this.expression.evaluate(this._evaluator)}evaluate(c,d,m,b,E,S){this._evaluator.globals=c,this._evaluator.feature=d||null,this._evaluator.featureState=m||null,this._evaluator.canonical=b,this._evaluator.availableImages=E||null,this._evaluator.formattedSection=S||null;try{var A=this.expression.evaluate(this._evaluator);if(A==null||typeof A=="number"&&A!=A)return this._defaultValue;if(!this._enumValues||A in this._enumValues)return A;throw new or(`Expected value to be one of ${Object.keys(this._enumValues).map(I=>JSON.stringify(I)).join(", ")}, but found ${JSON.stringify(A)} instead.`)}catch(I){return this._warningHistory[I.message]||(this._warningHistory[I.message]=!0,typeof console<"u"&&console.warn(I.message)),this._defaultValue}}}function qm(u){return Array.isArray(u)&&0<u.length&&typeof u[0]=="string"&&u[0]in td}function $m(u,c){var d=new xl(td,Nm,[],c?(m=c,d={color:Rn,string:gt,number:Ke,enum:gt,boolean:Tt,formatted:ti,padding:Ar,resolvedImage:oe,variableAnchorOffsetCollection:V},m.type!=="array"?d[m.type]:$(d[m.value]||nn,m.length)):void 0),m=d.parse(u,void 0,void 0,void 0,c&&c.type==="string"?{typeAnnotation:"coerce"}:void 0);return m?R0(new O0(m,c)):nd(d.errors)}class vi{constructor(c,d){this.kind=c,this._styleExpression=d,this.isStateDependent=c!=="constant"&&!ep(d.expression)}evaluateWithoutErrorHandling(c,d,m,b,E,S){return this._styleExpression.evaluateWithoutErrorHandling(c,d,m,b,E,S)}evaluate(c,d,m,b,E,S){return this._styleExpression.evaluate(c,d,m,b,E,S)}}class Wm{constructor(c,d,m,b){this.kind=c,this.zoomStops=m,this._styleExpression=d,this.isStateDependent=c!=="camera"&&!ep(d.expression),this.interpolationType=b}evaluateWithoutErrorHandling(c,d,m,b,E,S){return this._styleExpression.evaluateWithoutErrorHandling(c,d,m,b,E,S)}evaluate(c,d,m,b,E,S){return this._styleExpression.evaluate(c,d,m,b,E,S)}interpolationFactor(c,d,m){return this.interpolationType?Ba.interpolationFactor(this.interpolationType,c,d,m):0}}function ur(u){return u._styleExpression!==void 0}function li(E,c){var d,m,b,E=$m(E,c);return E.result==="error"?E:(d=Dm(m=E.value.expression))||rd(c)?(b=Fm(m,["zoom"]))||GE(c)?(m=function S(A){let I=null;if(A instanceof jm)I=S(A.result);else if(A instanceof tp){for(const O of A.args)if(I=S(O))break}else(A instanceof Iu||A instanceof Ba)&&A.input instanceof Da&&A.input.name==="zoom"&&(I=A);return I instanceof xt||A.eachChild(O=>{const k=S(O);k instanceof xt?I=k:!I&&k?I=new xt("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):I&&k&&I!==k&&(I=new xt("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),I}(m))||b?m instanceof xt?nd([m]):m instanceof Ba&&!k0(c)?nd([new xt("",'"interpolate" expressions cannot be used with this property')]):m?(b=m instanceof Ba?m.interpolation:void 0,R0(d?new Wm("camera",E.value,m.labels,b):new Wm("composite",E.value,m.labels,b))):R0(d?new vi("constant",E.value):new vi("source",E.value)):nd([new xt("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')]):nd([new xt("","zoom expressions not supported")]):nd([new xt("","data expressions not supported")])}class Wr{constructor(c,d){this._parameters=c,this._specification=d,At(this,qE(this._parameters,this._specification))}static deserialize(c){return new Wr(c._parameters,c._specification)}static serialize(c){return{_parameters:c._parameters,_specification:c._specification}}}function Ym(u,c){if(Hm(u))return new Wr(u,c);if(qm(u)){var d=li(u,c);if(d.result==="error")throw new Error(d.value.map(m=>m.key+": "+m.message).join(", "));return d.value}{let m=u;return c.type==="color"&&typeof u=="string"?m=ir.parse(u):c.type!=="padding"||typeof u!="number"&&!Array.isArray(u)?c.type==="variableAnchorOffsetCollection"&&Array.isArray(u)&&(m=Jo.parse(u)):m=$r.parse(u),{kind:"constant",evaluate:()=>m}}}function $E(u){return u.type==="color"&&Hm(u.default)?new ir(0,0,0,0):u.type==="color"?ir.parse(u.default)||null:u.type==="padding"?$r.parse(u.default)||null:u.type==="variableAnchorOffsetCollection"?Jo.parse(u.default)||null:u.default===void 0?null:u.default}function L0(u){if(u===!0||u===!1)return 1;if(Array.isArray(u)&&u.length!==0)switch(u[0]){case"has":return 2<=u.length&&u[1]!=="$id"&&u[1]!=="$type";case"in":return 3<=u.length&&(typeof u[1]!="string"||Array.isArray(u[2]));case"!in":case"!has":case"none":return;case"==":case"!=":case">":case">=":case"<":case"<=":return u.length!==3||Array.isArray(u[1])||Array.isArray(u[2]);case"any":case"all":for(const c of u.slice(1))if(!L0(c)&&typeof c!="boolean")return;return 1;default:return 1}}const TR={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function Km(u){if(u==null)return{filter:()=>!0,needGeometry:!1};const c=$m(u=L0(u)?u:Zm(u),TR);if(c.result==="error")throw new Error(c.value.map(d=>d.key+": "+d.message).join(", "));return{filter:(d,m,b)=>c.value.evaluate(d,m,{},b),needGeometry:function d(m){if(!Array.isArray(m))return!1;if(m[0]==="within")return!0;for(let b=1;b<m.length;b++)if(d(m[b]))return!0;return!1}(u)}}function WE(u,c){return u<c?-1:c<u?1:0}function Zm(u){var c,d;return!u||(c=u[0],u.length<=1?c!=="any":c==="=="?N0(u[1],u[2],"=="):c==="!="?Xm(N0(u[1],u[2],"==")):c==="<"||c===">"||c==="<="||c===">="?N0(u[1],u[2],c):c==="any"?(d=u.slice(1),["any"].concat(d.map(Zm))):c==="all"?["all"].concat(u.slice(1).map(Zm)):c==="none"?["all"].concat(u.slice(1).map(Zm).map(Xm)):c==="in"?YE(u[1],u.slice(2)):c==="!in"?Xm(YE(u[1],u.slice(2))):c==="has"?D0(u[1]):c==="!has"?Xm(D0(u[1])):c!=="within"||u)}function N0(u,c,d){switch(u){case"$type":return["filter-type-"+d,c];case"$id":return["filter-id-"+d,c];default:return["filter-"+d,u,c]}}function YE(u,c){if(c.length===0)return!1;switch(u){case"$type":return["filter-type-in",["literal",c]];case"$id":return["filter-id-in",["literal",c]];default:return 200<c.length&&!c.some(d=>typeof d!=typeof c[0])?["filter-in-large",u,["literal",c.sort(WE)]]:["filter-in-small",u,["literal",c]]}}function D0(u){switch(u){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",u]}}function Xm(u){return["!",u]}function KE(u){let c="";for(const d of Ae)c+="/"+function m(b){var E=typeof b;if(E=="number"||E=="boolean"||E=="string"||b==null)return JSON.stringify(b);if(Array.isArray(b)){let I="[";for(const O of b)I+=m(O)+",";return I+"]"}var S=Object.keys(b).sort();let A="{";for(let I=0;I<S.length;I++)A+=`${JSON.stringify(S[I])}:${m(b[S[I]])},`;return A+"}"}(u[d]);return c}function ZE(d){var c=d.key,d=d.value;return d?[new Te(c,d,"constants have been deprecated as of v8")]:[]}function bi(u){return u instanceof Number||u instanceof String||u instanceof Boolean?u.valueOf():u}function Ru(u){if(Array.isArray(u))return u.map(Ru);if(u instanceof Object&&!(u instanceof Number||u instanceof String||u instanceof Boolean)){var c={};for(const d in u)c[d]=Ru(u[d]);return c}return bi(u)}function os(u){var c=u.key,d=u.value,m=u.valueSpec||{},b=u.objectElementValidators||{},E=u.style,S=u.styleSpec,A=u.validateSpec;let I=[];if(u=_r(d),u!=="object")return[new Te(c,d,`object expected, ${u} found`)];for(const U in d){var O=U.split(".")[0],k=m[O]||m["*"];let W;if(b[O])W=b[O];else if(m[O])W=A;else if(b["*"])W=b["*"];else{if(!m["*"]){I.push(new Te(c,d[U],`unknown property "${U}"`));continue}W=A}I=I.concat(W({key:(c&&c+".")+U,value:d[U],valueSpec:k,style:E,styleSpec:S,object:d,objectKey:U,validateSpec:A},d))}for(const U in m)b[U]||m[U].required&&m[U].default===void 0&&d[U]===void 0&&I.push(new Te(c,d,`missing required property "${U}"`));return I}function F0(u){var c=u.value,d=u.valueSpec,m=u.validateSpec,b=u.style,E=u.styleSpec,S=u.key,A=u.arrayElementValidator||m;if(_r(c)!=="array")return[new Te(S,c,`array expected, ${_r(c)} found`)];if(d.length&&c.length!==d.length)return[new Te(S,c,`array length ${d.length} expected, length ${c.length} found`)];if(d["min-length"]&&c.length<d["min-length"])return[new Te(S,c,`array length at least ${d["min-length"]} expected, length ${c.length} found`)];let I={type:d.value,values:d.values},O=(E.$version<7&&(I.function=d.function),_r(d.value)==="object"&&(I=d.value),[]);for(let k=0;k<c.length;k++)O=O.concat(A({array:c,arrayIndex:k,value:c[k],valueSpec:I,validateSpec:u.validateSpec,style:b,styleSpec:E,key:`${S}[${k}]`}));return O}function B0(m){var c=m.key,d=m.value,m=m.valueSpec;let b=_r(d);return(b=b==="number"&&d!=d?"NaN":b)!=="number"?[new Te(c,d,`number expected, ${b} found`)]:"minimum"in m&&d<m.minimum?[new Te(c,d,d+" is less than the minimum value "+m.minimum)]:"maximum"in m&&d>m.maximum?[new Te(c,d,d+" is greater than the maximum value "+m.maximum)]:[]}function XE(u){const c=u.valueSpec,d=bi(u.value.type);let m,b={},E,S;var A=d!=="categorical"&&u.value.property===void 0,I=!A;const O=_r(u.value.stops)==="array"&&_r(u.value.stops[0])==="array"&&_r(u.value.stops[0][0])==="object";var k=os({key:u.key,value:u.value,valueSpec:u.styleSpec.function,validateSpec:u.validateSpec,style:u.style,styleSpec:u.styleSpec,objectElementValidators:{stops:function(re){if(d==="identity")return[new Te(re.key,re.value,'identity function may not have a "stops" property')];let ie=[];var fe=re.value;return ie=ie.concat(F0({key:re.key,value:fe,valueSpec:re.valueSpec,validateSpec:re.validateSpec,style:re.style,styleSpec:re.styleSpec,arrayElementValidator:U})),_r(fe)==="array"&&fe.length===0&&ie.push(new Te(re.key,fe,"array must have at least one stop")),ie},default:function(re){return re.validateSpec({key:re.key,value:re.value,valueSpec:c,validateSpec:re.validateSpec,style:re.style,styleSpec:re.styleSpec})}}});return d==="identity"&&A&&k.push(new Te(u.key,u.value,'missing required property "property"')),d==="identity"||u.value.stops||k.push(new Te(u.key,u.value,'missing required property "stops"')),d==="exponential"&&u.valueSpec.expression&&!k0(u.valueSpec)&&k.push(new Te(u.key,u.value,"exponential functions not supported")),8<=u.styleSpec.$version&&(I&&!rd(u.valueSpec)?k.push(new Te(u.key,u.value,"property functions not supported")):A&&!GE(u.valueSpec)&&k.push(new Te(u.key,u.value,"zoom functions not supported"))),d!=="categorical"&&!O||u.value.property!==void 0||k.push(new Te(u.key,u.value,'"property" property is required')),k;function U(re){let ie=[];var fe=re.value,we=re.key;if(_r(fe)!=="array")return[new Te(we,fe,`array expected, ${_r(fe)} found`)];if(fe.length!==2)return[new Te(we,fe,`array length 2 expected, length ${fe.length} found`)];if(O){if(_r(fe[0])!=="object")return[new Te(we,fe,`object expected, ${_r(fe[0])} found`)];if(fe[0].zoom===void 0)return[new Te(we,fe,"object stop key must have zoom")];if(fe[0].value===void 0)return[new Te(we,fe,"object stop key must have value")];if(S&&S>bi(fe[0].zoom))return[new Te(we,fe[0].zoom,"stop zoom values must appear in ascending order")];bi(fe[0].zoom)!==S&&(S=bi(fe[0].zoom),E=void 0,b={}),ie=ie.concat(os({key:we+"[0]",value:fe[0],valueSpec:{zoom:{}},validateSpec:re.validateSpec,style:re.style,styleSpec:re.styleSpec,objectElementValidators:{zoom:B0,value:W}}))}else ie=ie.concat(W({key:we+"[0]",value:fe[0],valueSpec:{},validateSpec:re.validateSpec,style:re.style,styleSpec:re.styleSpec},fe));return qm(Ru(fe[1]))?ie.concat([new Te(we+"[1]",fe[1],"expressions are not allowed in function stops.")]):ie.concat(re.validateSpec({key:we+"[1]",value:fe[1],valueSpec:c,validateSpec:re.validateSpec,style:re.style,styleSpec:re.styleSpec}))}function W(re,de){var fe=_r(re.value),we=bi(re.value),de=re.value!==null?re.value:de;if(m){if(fe!==m)return[new Te(re.key,de,fe+" stop domain type must match previous stop domain type "+m)]}else m=fe;if(fe!=="number"&&fe!=="string"&&fe!=="boolean")return[new Te(re.key,de,"stop domain value must be a number, string, or boolean")];if(fe==="number"||d==="categorical")return d!=="categorical"||fe!=="number"||isFinite(we)&&Math.floor(we)===we?d!=="categorical"&&fe==="number"&&E!==void 0&&we<E?[new Te(re.key,de,"stop domain values must appear in ascending order")]:(E=we,d==="categorical"&&we in b?[new Te(re.key,de,"stop domain values must be unique")]:(b[we]=!0,[])):[new Te(re.key,de,"integer expected, found "+we)];{let Me=`number expected, ${fe} found`;return rd(c)&&d===void 0&&(Me+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Te(re.key,de,Me)]}}}function id(u){var c=(u.expressionContext==="property"?li:$m)(Ru(u.value),u.valueSpec);if(c.result==="error")return c.value.map(d=>new Te(""+u.key+d.key,u.value,d.message));if(c=c.value.expression||c.value._styleExpression.expression,u.expressionContext==="property"&&u.propertyKey==="text-font"&&!c.outputDefined())return[new Te(u.key,u.value,`Invalid data expression for "${u.propertyKey}". Output values must be contained as literals within the expression.`)];if(u.expressionContext==="property"&&u.propertyType==="layout"&&!ep(c))return[new Te(u.key,u.value,'"feature-state" data expressions are not supported with layout properties.')];if(u.expressionContext==="filter"&&!ep(c))return[new Te(u.key,u.value,'"feature-state" data expressions are not supported with filters.')];if(u.expressionContext&&u.expressionContext.indexOf("cluster")===0){if(!Fm(c,["zoom","feature-state"]))return[new Te(u.key,u.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(u.expressionContext==="cluster-initial"&&!Dm(c))return[new Te(u.key,u.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function op(m){var c=m.key,d=m.value,m=m.valueSpec,b=[];return Array.isArray(m.values)?m.values.indexOf(bi(d))===-1&&b.push(new Te(c,d,`expected one of [${m.values.join(", ")}], ${JSON.stringify(d)} found`)):Object.keys(m.values).indexOf(bi(d))===-1&&b.push(new Te(c,d,`expected one of [${Object.keys(m.values).join(", ")}], ${JSON.stringify(d)} found`)),b}function U0(u){return L0(Ru(u.value))?id(At({},u,{expressionContext:"filter",valueSpec:{value:"boolean"}})):function c(d){const m=d.value,b=d.key;if(_r(m)!=="array")return[new Te(b,m,`array expected, ${_r(m)} found`)];const E=d.styleSpec;let S,A=[];if(m.length<1)return[new Te(b,m,"filter array must have at least 1 element")];switch(A=A.concat(op({key:b+"[0]",value:m[0],valueSpec:E.filter_operator,style:d.style,styleSpec:d.styleSpec})),bi(m[0])){case"<":case"<=":case">":case">=":2<=m.length&&bi(m[1])==="$type"&&A.push(new Te(b,m,`"$type" cannot be use with operator "${m[0]}"`));case"==":case"!=":m.length!==3&&A.push(new Te(b,m,`filter array for operator "${m[0]}" must have 3 elements`));case"in":case"!in":2<=m.length&&(S=_r(m[1]))!=="string"&&A.push(new Te(b+"[1]",m[1],`string expected, ${S} found`));for(let I=2;I<m.length;I++)S=_r(m[I]),bi(m[1])==="$type"?A=A.concat(op({key:`${b}[${I}]`,value:m[I],valueSpec:E.geometry_type,style:d.style,styleSpec:d.styleSpec})):S!=="string"&&S!=="number"&&S!=="boolean"&&A.push(new Te(`${b}[${I}]`,m[I],`string, number, or boolean expected, ${S} found`));break;case"any":case"all":case"none":for(let I=1;I<m.length;I++)A=A.concat(c({key:`${b}[${I}]`,value:m[I],style:d.style,styleSpec:d.styleSpec}));break;case"has":case"!has":S=_r(m[1]),m.length!==2?A.push(new Te(b,m,`filter array for "${m[0]}" operator must have 2 elements`)):S!=="string"&&A.push(new Te(b+"[1]",m[1],`string expected, ${S} found`));break;case"within":S=_r(m[1]),m.length!==2?A.push(new Te(b,m,`filter array for "${m[0]}" operator must have 2 elements`)):S!=="object"&&A.push(new Te(b+"[1]",m[1],`object expected, ${S} found`))}return A}(u)}function QE(u,c){var d=u.key,m=u.validateSpec,b=u.style,E=u.styleSpec,S=u.value,A=u.objectKey,I=E[c+"_"+u.layerType];if(!I)return[];var O=A.match(/^(.*)-transition$/);if(c==="paint"&&O&&I[O[1]]&&I[O[1]].transition)return m({key:d,value:S,valueSpec:E.transition,style:b,styleSpec:E});if(O=u.valueSpec||I[A],!O)return[new Te(d,S,`unknown property "${A}"`)];let k;return _r(S)==="string"&&rd(O)&&!O.tokens&&(k=/^{([^}]+)}$/.exec(S))?[new Te(d,S,`"${A}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(k[1])} }\`.`)]:(I=[],u.layerType==="symbol"&&(A==="text-field"&&b&&!b.glyphs&&I.push(new Te(d,S,'use of "text-field" requires a style "glyphs" property')),A==="text-font")&&Hm(Ru(S))&&bi(S.type)==="identity"&&I.push(new Te(d,S,'"text-font" does not support identity functions')),I.concat(m({key:u.key,value:S,valueSpec:O,style:b,styleSpec:E,expressionContext:"property",propertyType:c,propertyKey:A})))}function z0(u){return QE(u,"paint")}function j0(u){return QE(u,"layout")}function ap(u){let c=[];const d=u.value,m=u.key;var b,E,S=u.style;const A=u.styleSpec;d.type||d.ref||c.push(new Te(m,d,'either "type" or "ref" is required'));let I=bi(d.type);const O=bi(d.ref);if(d.id){var k=bi(d.id);for(let W=0;W<u.arrayIndex;W++){var U=S.layers[W];bi(U.id)===k&&c.push(new Te(m,d.id,`duplicate layer id "${d.id}", previously used at line `+U.id.__line__))}}if("ref"in d){["type","source","source-layer","filter","layout"].forEach(re=>{re in d&&c.push(new Te(m,d[re],`"${re}" is prohibited for ref layers`))});let W;S.layers.forEach(re=>{bi(re.id)===O&&(W=re)}),W?W.ref?c.push(new Te(m,d.ref,"ref cannot reference another ref layer")):I=bi(W.type):c.push(new Te(m,d.ref,`ref layer "${O}" not found`))}else I!=="background"&&(d.source?(E=(b=S.sources&&S.sources[d.source])&&bi(b.type),b?E==="vector"&&I==="raster"?c.push(new Te(m,d.source,`layer "${d.id}" requires a raster source`)):E!=="raster-dem"&&I==="hillshade"?c.push(new Te(m,d.source,`layer "${d.id}" requires a raster-dem source`)):E==="raster"&&I!=="raster"?c.push(new Te(m,d.source,`layer "${d.id}" requires a vector source`)):E!=="vector"||d["source-layer"]?E==="raster-dem"&&I!=="hillshade"?c.push(new Te(m,d.source,"raster-dem source can only be used with layer type 'hillshade'.")):I!=="line"||!d.paint||!d.paint["line-gradient"]||E==="geojson"&&b.lineMetrics||c.push(new Te(m,d,`layer "${d.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):c.push(new Te(m,d,`layer "${d.id}" must specify a "source-layer"`)):c.push(new Te(m,d.source,`source "${d.source}" not found`))):c.push(new Te(m,d,'missing required property "source"')));return c=c.concat(os({key:m,value:d,valueSpec:A.layer,style:u.style,styleSpec:u.styleSpec,validateSpec:u.validateSpec,objectElementValidators:{"*"(){return[]},type(){return u.validateSpec({key:m+".type",value:d.type,valueSpec:A.layer.type,style:u.style,styleSpec:u.styleSpec,validateSpec:u.validateSpec,object:d,objectKey:"type"})},filter:U0,layout(W){return os({layer:d,key:W.key,value:W.value,style:W.style,styleSpec:W.styleSpec,validateSpec:W.validateSpec,objectElementValidators:{"*"(re){return j0(At({layerType:I},re))}}})},paint(W){return os({layer:d,key:W.key,value:W.value,style:W.style,styleSpec:W.styleSpec,validateSpec:W.validateSpec,objectElementValidators:{"*"(re){return z0(At({layerType:I},re))}}})}}}))}function ku(d){var c=d.value,d=d.key,m=_r(c);return m!=="string"?[new Te(d,c,`string expected, ${m} found`)]:[]}const JE={promoteId:function({key:u,value:c}){{if(_r(c)==="string")return ku({key:u,value:c});var d=[];for(const m in c)d.push(...ku({key:u+"."+m,value:c[m]}));return d}}};function eT(u){var c=u.value,d=u.key,m=u.styleSpec,b=u.style,E=u.validateSpec;if(!c.type)return[new Te(d,c,'"type" is required')];var S=bi(c.type);let A;switch(S){case"vector":case"raster":return A=os({key:d,value:c,valueSpec:m["source_"+S.replace("-","_")],style:u.style,styleSpec:m,objectElementValidators:JE,validateSpec:E});case"raster-dem":return A=function(k){var U=(de=k.sourceName)!=null?de:"",W=k.value,re=k.styleSpec,ie=re.source_raster_dem,fe=k.style;let we=[];var de=_r(W);if(W!==void 0)if(de!=="object")we.push(new Te("source_raster_dem",W,`object expected, ${de} found`));else{var Me=bi(W.encoding)==="custom",Ve=["redFactor","greenFactor","blueFactor","baseShift"],$e=k.value.encoding?`"${k.value.encoding}"`:"Default";for(const Ye in W)!Me&&Ve.includes(Ye)?we.push(new Te(Ye,W[Ye],`In "${U}": "${Ye}" is only valid when "encoding" is set to "custom". ${$e} encoding found`)):ie[Ye]?we=we.concat(k.validateSpec({key:Ye,value:W[Ye],valueSpec:ie[Ye],validateSpec:k.validateSpec,style:fe,styleSpec:re})):we.push(new Te(Ye,W[Ye],`unknown property "${Ye}"`))}return we}({sourceName:d,value:c,style:u.style,styleSpec:m,validateSpec:E});case"geojson":if(A=os({key:d,value:c,valueSpec:m.source_geojson,style:b,styleSpec:m,validateSpec:E,objectElementValidators:JE}),c.cluster)for(const k in c.clusterProperties){var[O,I]=c.clusterProperties[k],O=typeof O=="string"?[O,["accumulated"],["get",k]]:O;A.push(...id({key:`${d}.${k}.map`,value:I,validateSpec:E,expressionContext:"cluster-map"})),A.push(...id({key:`${d}.${k}.reduce`,value:O,validateSpec:E,expressionContext:"cluster-reduce"}))}return A;case"video":return os({key:d,value:c,valueSpec:m.source_video,style:b,validateSpec:E,styleSpec:m});case"image":return os({key:d,value:c,valueSpec:m.source_image,style:b,validateSpec:E,styleSpec:m});case"canvas":return[new Te(d,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return op({key:d+".type",value:c.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:b,validateSpec:E,styleSpec:m})}}function tT(u){var c=u.value,d=u.styleSpec,m=d.light,b=u.style;let E=[];var S=_r(c);if(c!==void 0){if(S!=="object")return E=E.concat([new Te("light",c,`object expected, ${S} found`)]);for(const I in c){var A=I.match(/^(.*)-transition$/);E=A&&m[A[1]]&&m[A[1]].transition?E.concat(u.validateSpec({key:I,value:c[I],valueSpec:d.transition,validateSpec:u.validateSpec,style:b,styleSpec:d})):m[I]?E.concat(u.validateSpec({key:I,value:c[I],valueSpec:m[I],validateSpec:u.validateSpec,style:b,styleSpec:d})):E.concat([new Te(I,c[I],`unknown property "${I}"`)])}}return E}function nT(E){var c=E.value,d=E.styleSpec,m=d.sky,b=E.style,E=_r(c);if(c===void 0)return[];if(E!=="object")return[new Te("sky",c,`object expected, ${E} found`)];let S=[];for(const A in c)S=m[A]?S.concat(kc({key:A,value:c[A],valueSpec:m[A],style:b,styleSpec:d})):S.concat([new Te(A,c[A],`unknown property "${A}"`)]);return S}function V0(u){var c=u.value,d=u.styleSpec,m=d.terrain,b=u.style;let E=[];var S=_r(c);if(c!==void 0){if(S!=="object")return E=E.concat([new Te("terrain",c,`object expected, ${S} found`)]);for(const A in c)E=m[A]?E.concat(u.validateSpec({key:A,value:c[A],valueSpec:m[A],validateSpec:u.validateSpec,style:b,styleSpec:d})):E.concat([new Te(A,c[A],`unknown property "${A}"`)])}return E}function rT(u){let c=[];var d=u.value,m=u.key;if(Array.isArray(d)){var b=[],E=[];for(const S in d)d[S].id&&b.includes(d[S].id)&&c.push(new Te(m,d,`all the sprites' ids must be unique, but ${d[S].id} is duplicated`)),b.push(d[S].id),d[S].url&&E.includes(d[S].url)&&c.push(new Te(m,d,`all the sprites' URLs must be unique, but ${d[S].url} is duplicated`)),E.push(d[S].url),c=c.concat(os({key:`${m}[${S}]`,value:d[S],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:u.validateSpec}));return c}return ku({key:m,value:d})}const Qm={"*"(){return[]},array:F0,boolean:function(d){var c=d.value,d=d.key,m=_r(c);return m!=="boolean"?[new Te(d,c,`boolean expected, ${m} found`)]:[]},number:B0,color:function(u){var c=u.key,d=_r(u=u.value);return d!=="string"?[new Te(c,u,`color expected, ${d} found`)]:ir.parse(String(u))?[]:[new Te(c,u,`color expected, "${u}" found`)]},constants:ZE,enum:op,filter:U0,function:XE,layer:ap,object:os,source:eT,light:tT,sky:nT,terrain:V0,string:ku,formatted:function(u){return ku(u).length===0?[]:id(u)},resolvedImage:function(u){return ku(u).length===0?[]:id(u)},padding:function(u){var c=u.key,d=u.value;if(_r(d)!=="array")return B0({key:c,value:d,valueSpec:{}});{if(d.length<1||4<d.length)return[new Te(c,d,`padding requires 1 to 4 values; ${d.length} values found`)];var m={type:"number"};let b=[];for(let E=0;E<d.length;E++)b=b.concat(u.validateSpec({key:`${c}[${E}]`,value:d[E],validateSpec:u.validateSpec,valueSpec:m}));return b}},variableAnchorOffsetCollection:function(u){var c=u.key,d=u.value,m=_r(d),b=u.styleSpec;if(m!=="array"||d.length<1||d.length%2!=0)return[new Te(c,d,"variableAnchorOffsetCollection requires a non-empty array of even length")];let E=[];for(let S=0;S<d.length;S+=2)E=(E=E.concat(op({key:`${c}[${S}]`,value:d[S],valueSpec:b.layout_symbol["text-anchor"]}))).concat(F0({key:`${c}[${S+1}]`,value:d[S+1],valueSpec:{length:2,value:"number"},validateSpec:u.validateSpec,style:u.style,styleSpec:b}));return E},sprite:rT};function kc(u){var c=u.value,d=u.valueSpec,m=u.styleSpec;return u.validateSpec=kc,d.expression&&Hm(bi(c))?XE(u):d.expression&&qm(Ru(c))?id(u):d.type&&Qm[d.type]?Qm[d.type](u):os(At({},u,{valueSpec:d.type?m[d.type]:d}))}function sp(m){var c=m.value,d=m.key,m=ku(m);return m.length||(c.indexOf("{fontstack}")===-1&&m.push(new Te(d,c,'"glyphs" url must include a "{fontstack}" token')),c.indexOf("{range}")===-1&&m.push(new Te(d,c,'"glyphs" url must include a "{range}" token'))),m}function ma(u,c=q){let d=[];return d=d.concat(kc({key:"",value:u,valueSpec:c.$root,styleSpec:c,style:u,validateSpec:kc,objectElementValidators:{glyphs:sp,"*"(){return[]}}})),H0(d=u.constants?d.concat(ZE({key:"constants",value:u.constants,style:u,styleSpec:c,validateSpec:kc})):d)}function as(u){return function(c){return u({...c,validateSpec:kc})}}function H0(u){return[].concat(u).sort((c,d)=>c.line-d.line)}function ks(u){return function(...c){return H0(u.apply(this,c))}}ma.source=ks(as(eT)),ma.sprite=ks(as(rT)),ma.glyphs=ks(as(sp)),ma.light=ks(as(tT)),ma.sky=ks(as(nT)),ma.terrain=ks(as(V0)),ma.layer=ks(as(ap)),ma.filter=ks(as(U0)),ma.paintProperty=ks(as(z0)),ma.layoutProperty=ks(as(j0));const cp=ma;np=cp.light;const SR=cp.paintProperty,CR=cp.layoutProperty;function iT(u,c){let d=!1;if(c&&c.length)for(const m of c)u.fire(new Q(new Error(m.message))),d=!0;return d}class lp{constructor(c,d,m){var b=this.cells=[];if(c instanceof ArrayBuffer){this.arrayBuffer=c;var E=new Int32Array(this.arrayBuffer);c=E[0],d=E[1],m=E[2],this.d=d+2*m;for(let k=0;k<this.d*this.d;k++){var S=E[3+k],A=E[3+k+1];b.push(S===A?null:E.subarray(S,A))}var I=E[3+b.length],O=E[3+b.length+1];this.keys=E.subarray(I,O),this.bboxes=E.subarray(O),this.insert=this._insertReadonly}else{this.d=d+2*m;for(let k=0;k<this.d*this.d;k++)b.push([]);this.keys=[],this.bboxes=[]}this.n=d,this.extent=c,this.padding=m,this.scale=d/c,this.uid=0,I=m/d*c,this.min=-I,this.max=c+I}insert(c,d,m,b,E){this._forEachCell(d,m,b,E,this._insertCell,this.uid++,void 0,void 0),this.keys.push(c),this.bboxes.push(d),this.bboxes.push(m),this.bboxes.push(b),this.bboxes.push(E)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(c,d,m,b,E,S){this.cells[E].push(S)}query(c,d,m,b,E){var S=this.min,A=this.max;return c<=S&&d<=S&&A<=m&&A<=b&&!E?Array.prototype.slice.call(this.keys):(this._forEachCell(c,d,m,b,this._queryCell,S=[],{},E),S)}_queryCell(c,d,m,b,E,S,A,I){var O=this.cells[E];if(O!==null){var k=this.keys,U=this.bboxes;for(let ie=0;ie<O.length;ie++){var W,re=O[ie];A[re]===void 0&&(W=4*re,(I?I(U[0+W],U[1+W],U[2+W],U[3+W]):c<=U[2+W]&&d<=U[3+W]&&m>=U[0+W]&&b>=U[1+W])?(A[re]=!0,S.push(k[re])):A[re]=!1)}}}_forEachCell(c,d,m,b,E,S,A,I){var O=this._convertToCellCoord(c),k=this._convertToCellCoord(d),U=this._convertToCellCoord(m),W=this._convertToCellCoord(b);for(let ie=O;ie<=U;ie++)for(let fe=k;fe<=W;fe++){var re=this.d*fe+ie;if((!I||I(this._convertFromCellCoord(ie),this._convertFromCellCoord(fe),this._convertFromCellCoord(ie+1),this._convertFromCellCoord(fe+1)))&&E.call(this,c,d,m,b,re,S,A,I))return}}_convertFromCellCoord(c){return(c-this.padding)/this.scale}_convertToCellCoord(c){return Math.max(0,Math.min(this.d-1,Math.floor(c*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;var c=this.cells,d=3+this.cells.length+1+1;let m=0;for(let A=0;A<this.cells.length;A++)m+=this.cells[A].length;var b=new Int32Array(d+m+this.keys.length+this.bboxes.length);b[0]=this.extent,b[1]=this.n,b[2]=this.padding;let E=d;for(let A=0;A<c.length;A++){var S=c[A];b[3+A]=E,b.set(S,E),E+=S.length}return b[3+c.length]=E,b.set(this.keys,E),E+=this.keys.length,b[3+c.length+1]=E,b.set(this.bboxes,E),E+=this.bboxes.length,b.buffer}static serialize(c,d){return c=c.toArrayBuffer(),d&&d.push(c),{buffer:c}}static deserialize(c){return new lp(c.buffer)}}const Os={};function Ht(u,c,d={}){if(Os[u])throw new Error(u+" is already registered.");Object.defineProperty(c,"_classRegistryKey",{value:u,writeable:!1}),Os[u]={klass:c,omit:d.omit||[],shallow:d.shallow||[]}}Ht("Object",Object),Ht("TransferableGridIndex",lp),Ht("Color",ir),Ht("Error",Error),Ht("AJAXError",Ot),Ht("ResolvedImage",ea),Ht("StylePropertyFunction",Wr),Ht("StyleExpression",O0,{omit:["_evaluator"]}),Ht("ZoomDependentExpression",Wm),Ht("ZoomConstantExpression",vi),Ht("CompoundExpression",Da,{omit:["_evaluate"]});for(const u in td)td[u]._classRegistryKey||Ht("Expression_"+u,td[u]);function ya(u){return u&&typeof ArrayBuffer<"u"&&(u instanceof ArrayBuffer||u.constructor&&u.constructor.name==="ArrayBuffer")}function Oc(u,c){if(u==null||typeof u=="boolean"||typeof u=="number"||typeof u=="string"||u instanceof Boolean||u instanceof Number||u instanceof String||u instanceof Date||u instanceof RegExp||u instanceof Blob||u instanceof Error)return u;if(ya(u)||at(u))return c&&c.push(u),u;if(ArrayBuffer.isView(u))return m=u,c&&c.push(m.buffer),m;if(u instanceof ImageData)return c&&c.push(u.data.buffer),u;if(Array.isArray(u)){var d=[];for(const A of u)d.push(Oc(A,c));return d}if(typeof u!="object")throw new Error("can't serialize object of type "+typeof u);var m=u.constructor,b=m._classRegistryKey;if(!b)throw new Error("can't serialize object of unregistered class "+m.name);if(!Os[b])throw new Error(b+" is not registered.");var E,S=m.serialize?m.serialize(u,c):{};if(m.serialize){if(c&&S===c[c.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const A in u)!u.hasOwnProperty(A)||0<=Os[b].omit.indexOf(A)||(E=u[A],S[A]=0<=Os[b].shallow.indexOf(A)?E:Oc(E,c));u instanceof Error&&(S.message=u.message)}if(S.$name)throw new Error("$name property is reserved for worker serialization logic.");return b!=="Object"&&(S.$name=b),S}function od(u){if(u==null||typeof u=="boolean"||typeof u=="number"||typeof u=="string"||u instanceof Boolean||u instanceof Number||u instanceof String||u instanceof Date||u instanceof RegExp||u instanceof Blob||u instanceof Error||ya(u)||at(u)||ArrayBuffer.isView(u)||u instanceof ImageData)return u;if(Array.isArray(u))return u.map(od);if(typeof u!="object")throw new Error("can't deserialize object of type "+typeof u);var c=u.$name||"Object";if(!Os[c])throw new Error("can't deserialize unregistered class "+c);var d=Os[c].klass;if(!d)throw new Error("can't deserialize unregistered class "+c);if(d.deserialize)return d.deserialize(u);var m,b=Object.create(d.prototype);for(const E of Object.keys(u))E!=="$name"&&(m=u[E],b[E]=0<=Os[c].shallow.indexOf(E)?m:od(m));return b}class oT{constructor(){this.first=!0}update(c,d){var m=Math.floor(c);return this.first?(this.first=!1,this.lastIntegerZoom=m,this.lastIntegerZoomTime=0,this.lastZoom=c,this.lastFloorZoom=m,!0):(this.lastFloorZoom>m?(this.lastIntegerZoom=m+1,this.lastIntegerZoomTime=d):this.lastFloorZoom<m&&(this.lastIntegerZoom=m,this.lastIntegerZoomTime=d),c!==this.lastZoom&&(this.lastZoom=c,this.lastFloorZoom=m,!0))}}const Ft={"Latin-1 Supplement":u=>128<=u&&u<=255,Arabic:u=>1536<=u&&u<=1791,"Arabic Supplement":u=>1872<=u&&u<=1919,"Arabic Extended-A":u=>2208<=u&&u<=2303,"Hangul Jamo":u=>4352<=u&&u<=4607,"Unified Canadian Aboriginal Syllabics":u=>5120<=u&&u<=5759,Khmer:u=>6016<=u&&u<=6143,"Unified Canadian Aboriginal Syllabics Extended":u=>6320<=u&&u<=6399,"General Punctuation":u=>8192<=u&&u<=8303,"Letterlike Symbols":u=>8448<=u&&u<=8527,"Number Forms":u=>8528<=u&&u<=8591,"Miscellaneous Technical":u=>8960<=u&&u<=9215,"Control Pictures":u=>9216<=u&&u<=9279,"Optical Character Recognition":u=>9280<=u&&u<=9311,"Enclosed Alphanumerics":u=>9312<=u&&u<=9471,"Geometric Shapes":u=>9632<=u&&u<=9727,"Miscellaneous Symbols":u=>9728<=u&&u<=9983,"Miscellaneous Symbols and Arrows":u=>11008<=u&&u<=11263,"CJK Radicals Supplement":u=>11904<=u&&u<=12031,"Kangxi Radicals":u=>12032<=u&&u<=12255,"Ideographic Description Characters":u=>12272<=u&&u<=12287,"CJK Symbols and Punctuation":u=>12288<=u&&u<=12351,Hiragana:u=>12352<=u&&u<=12447,Katakana:u=>12448<=u&&u<=12543,Bopomofo:u=>12544<=u&&u<=12591,"Hangul Compatibility Jamo":u=>12592<=u&&u<=12687,Kanbun:u=>12688<=u&&u<=12703,"Bopomofo Extended":u=>12704<=u&&u<=12735,"CJK Strokes":u=>12736<=u&&u<=12783,"Katakana Phonetic Extensions":u=>12784<=u&&u<=12799,"Enclosed CJK Letters and Months":u=>12800<=u&&u<=13055,"CJK Compatibility":u=>13056<=u&&u<=13311,"CJK Unified Ideographs Extension A":u=>13312<=u&&u<=19903,"Yijing Hexagram Symbols":u=>19904<=u&&u<=19967,"CJK Unified Ideographs":u=>19968<=u&&u<=40959,"Yi Syllables":u=>40960<=u&&u<=42127,"Yi Radicals":u=>42128<=u&&u<=42191,"Hangul Jamo Extended-A":u=>43360<=u&&u<=43391,"Hangul Syllables":u=>44032<=u&&u<=55215,"Hangul Jamo Extended-B":u=>55216<=u&&u<=55295,"Private Use Area":u=>57344<=u&&u<=63743,"CJK Compatibility Ideographs":u=>63744<=u&&u<=64255,"Arabic Presentation Forms-A":u=>64336<=u&&u<=65023,"Vertical Forms":u=>65040<=u&&u<=65055,"CJK Compatibility Forms":u=>65072<=u&&u<=65103,"Small Form Variants":u=>65104<=u&&u<=65135,"Arabic Presentation Forms-B":u=>65136<=u&&u<=65279,"Halfwidth and Fullwidth Forms":u=>65280<=u&&u<=65519};function Ou(u){for(const c of u)if(up(c.charCodeAt(0)))return!0;return!1}function aT(u){for(const d of u)if(c=d.charCodeAt(0),Ft.Arabic(c)||Ft["Arabic Supplement"](c)||Ft["Arabic Extended-A"](c)||Ft["Arabic Presentation Forms-A"](c)||Ft["Arabic Presentation Forms-B"](c))return;var c;return 1}function up(u){return u===746||u===747||!(u<4352)&&(Ft["Bopomofo Extended"](u)||Ft.Bopomofo(u)||Ft["CJK Compatibility Forms"](u)&&!(65097<=u&&u<=65103)||Ft["CJK Compatibility Ideographs"](u)||Ft["CJK Compatibility"](u)||Ft["CJK Radicals Supplement"](u)||Ft["CJK Strokes"](u)||!(!Ft["CJK Symbols and Punctuation"](u)||12296<=u&&u<=12305||12308<=u&&u<=12319||u===12336)||Ft["CJK Unified Ideographs Extension A"](u)||Ft["CJK Unified Ideographs"](u)||Ft["Enclosed CJK Letters and Months"](u)||Ft["Hangul Compatibility Jamo"](u)||Ft["Hangul Jamo Extended-A"](u)||Ft["Hangul Jamo Extended-B"](u)||Ft["Hangul Jamo"](u)||Ft["Hangul Syllables"](u)||Ft.Hiragana(u)||Ft["Ideographic Description Characters"](u)||Ft.Kanbun(u)||Ft["Kangxi Radicals"](u)||Ft["Katakana Phonetic Extensions"](u)||Ft.Katakana(u)&&u!==12540||!(!Ft["Halfwidth and Fullwidth Forms"](u)||u===65288||u===65289||u===65293||65306<=u&&u<=65310||u===65339||u===65341||u===65343||65371<=u&&u<=65503||u===65507||65512<=u&&u<=65519)||!(!Ft["Small Form Variants"](u)||65112<=u&&u<=65118||65123<=u&&u<=65126)||Ft["Unified Canadian Aboriginal Syllabics"](u)||Ft["Unified Canadian Aboriginal Syllabics Extended"](u)||Ft["Vertical Forms"](u)||Ft["Yijing Hexagram Symbols"](u)||Ft["Yi Syllables"](u)||!!Ft["Yi Radicals"](u))}function sT(u){return!(up(u)||(u=u,Ft["Latin-1 Supplement"](u)&&(u===167||u===169||u===174||u===177||u===188||u===189||u===190||u===215||u===247))||Ft["General Punctuation"](u)&&(u===8214||u===8224||u===8225||u===8240||u===8241||u===8251||u===8252||u===8258||u===8263||u===8264||u===8265||u===8273)||Ft["Letterlike Symbols"](u)||Ft["Number Forms"](u)||Ft["Miscellaneous Technical"](u)&&(8960<=u&&u<=8967||8972<=u&&u<=8991||8996<=u&&u<=9e3||u===9003||9085<=u&&u<=9114||9150<=u&&u<=9165||u===9167||9169<=u&&u<=9179||9186<=u&&u<=9215)||Ft["Control Pictures"](u)&&u!==9251||Ft["Optical Character Recognition"](u)||Ft["Enclosed Alphanumerics"](u)||Ft["Geometric Shapes"](u)||Ft["Miscellaneous Symbols"](u)&&!(9754<=u&&u<=9759)||Ft["Miscellaneous Symbols and Arrows"](u)&&(11026<=u&&u<=11055||11088<=u&&u<=11097||11192<=u&&u<=11243)||Ft["CJK Symbols and Punctuation"](u)||Ft.Katakana(u)||Ft["Private Use Area"](u)||Ft["CJK Compatibility Forms"](u)||Ft["Small Form Variants"](u)||Ft["Halfwidth and Fullwidth Forms"](u)||u===8734||u===8756||u===8757||9984<=u&&u<=10087||10102<=u&&u<=10131||u===65532||u===65533)}function cT(u){return 1424<=u&&u<=2303||Ft["Arabic Presentation Forms-A"](u)||Ft["Arabic Presentation Forms-B"](u)}function G0(u,c){for(const m of u)if(d=m.charCodeAt(0),!c&&cT(d)||2304<=d&&d<=3583||3840<=d&&d<=4255||Ft.Khmer(d))return!1;var d;return!0}const Lu=new class{constructor(){this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null}setState(u){this.pluginStatus=u.pluginStatus,this.pluginURL=u.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(u){this.applyArabicShaping=u.applyArabicShaping,this.processBidirectionalText=u.processBidirectionalText,this.processStyledBidirectionalText=u.processStyledBidirectionalText}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getPluginURL(){return this.pluginURL}getRTLTextPluginStatus(){return this.pluginStatus}};class zr{constructor(c,d){this.zoom=c,d?(this.now=d.now,this.fadeDuration=d.fadeDuration,this.zoomHistory=d.zoomHistory,this.transition=d.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new oT,this.transition={})}isSupportedScript(c){return G0(c,Lu.getRTLTextPluginStatus()==="loaded")}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){var c=this.zoom,d=c-Math.floor(c),m=this.crossFadingFactor();return c>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:d+(1-d)*m}:{fromScale:.5,toScale:1,t:1-(1-m)*d}}}class Jm{constructor(c,d){this.property=c,this.value=d,this.expression=Ym(d===void 0?c.specification.default:d,c.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(c,d,m){return this.property.possiblyEvaluate(this,c,d,m)}}class q0{constructor(c){this.property=c,this.value=new Jm(c,void 0)}transitioned(c,d){return new $0(this.property,this.value,d,_e({},c.transition,this.transition),c.now)}untransitioned(){return new $0(this.property,this.value,null,{},0)}}class ey{constructor(c){this._properties=c,this._values=Object.create(c.defaultTransitionablePropertyValues)}getValue(c){return xe(this._values[c].value.value)}setValue(c,d){Object.prototype.hasOwnProperty.call(this._values,c)||(this._values[c]=new q0(this._values[c].property)),this._values[c].value=new Jm(this._values[c].property,d===null?void 0:xe(d))}getTransition(c){return xe(this._values[c].transition)}setTransition(c,d){Object.prototype.hasOwnProperty.call(this._values,c)||(this._values[c]=new q0(this._values[c].property)),this._values[c].transition=xe(d)||void 0}serialize(){var c={};for(const m of Object.keys(this._values)){var d=this.getValue(m),d=(d!==void 0&&(c[m]=d),this.getTransition(m));d!==void 0&&(c[m+"-transition"]=d)}return c}transitioned(c,d){var m=new ty(this._properties);for(const b of Object.keys(this._values))m._values[b]=this._values[b].transitioned(c,d._values[b]);return m}untransitioned(){var c=new ty(this._properties);for(const d of Object.keys(this._values))c._values[d]=this._values[d].untransitioned();return c}}class $0{constructor(c,d,m,b,E){this.property=c,this.value=d,this.begin=E+b.delay||0,this.end=this.begin+b.duration||0,c.specification.transition&&(b.delay||b.duration)&&(this.prior=m)}possiblyEvaluate(c,d,m){var b=c.now||0,E=this.value.possiblyEvaluate(c,d,m),S=this.prior;return S?b>this.end||this.value.isDataDriven()?(this.prior=null,E):b<this.begin?S.possiblyEvaluate(c,d,m):(b=(b-this.begin)/(this.end-this.begin),this.property.interpolate(S.possiblyEvaluate(c,d,m),E,z(b))):E}}class ty{constructor(c){this._properties=c,this._values=Object.create(c.defaultTransitioningPropertyValues)}possiblyEvaluate(c,d,m){var b=new hp(this._properties);for(const E of Object.keys(this._values))b._values[E]=this._values[E].possiblyEvaluate(c,d,m);return b}hasTransition(){for(const c of Object.keys(this._values))if(this._values[c].prior)return!0;return!1}}class AR{constructor(c){this._properties=c,this._values=Object.create(c.defaultPropertyValues)}hasValue(c){return this._values[c].value!==void 0}getValue(c){return xe(this._values[c].value)}setValue(c,d){this._values[c]=new Jm(this._values[c].property,d===null?void 0:xe(d))}serialize(){var c={};for(const m of Object.keys(this._values)){var d=this.getValue(m);d!==void 0&&(c[m]=d)}return c}possiblyEvaluate(c,d,m){var b=new hp(this._properties);for(const E of Object.keys(this._values))b._values[E]=this._values[E].possiblyEvaluate(c,d,m);return b}}class ss{constructor(c,d,m){this.property=c,this.value=d,this.parameters=m}isConstant(){return this.value.kind==="constant"}constantOr(c){return this.value.kind==="constant"?this.value.value:c}evaluate(c,d,m,b){return this.property.evaluate(this.value,this.parameters,c,d,m,b)}}class hp{constructor(c){this._properties=c,this._values=Object.create(c.defaultPossiblyEvaluatedValues)}get(c){return this._values[c]}}class sn{constructor(c){this.specification=c}possiblyEvaluate(c,d){if(c.isDataDriven())throw new Error("Value should not be data driven");return c.expression.evaluate(d)}interpolate(c,d,m){var b=this.specification.type,b=Fa[b];return b?b(c,d,m):c}}class xn{constructor(c,d){this.specification=c,this.overrides=d}possiblyEvaluate(c,d,m,b){return c.expression.kind==="constant"||c.expression.kind==="camera"?new ss(this,{kind:"constant",value:c.expression.evaluate(d,null,{},m,b)},d):new ss(this,c.expression,d)}interpolate(c,d,m){var b;return c.value.kind!=="constant"||d.value.kind!=="constant"?c:c.value.value===void 0||d.value.value===void 0?new ss(this,{kind:"constant",value:void 0},c.parameters):(b=this.specification.type,(b=Fa[b])?(b=b(c.value.value,d.value.value,m),new ss(this,{kind:"constant",value:b},c.parameters)):c)}evaluate(c,d,m,b,E,S){return c.kind==="constant"?c.value:c.evaluate(d,m,b,E,S)}}class Nu extends xn{possiblyEvaluate(c,d,m,b){return c.value===void 0?new ss(this,{kind:"constant",value:void 0},d):c.expression.kind==="constant"?(m=c.expression.evaluate(d,null,{},m,b),b=c.property.specification.type==="resolvedImage"&&typeof m!="string"?m.name:m,m=this._calculate(b,b,b,d),new ss(this,{kind:"constant",value:m},d)):c.expression.kind==="camera"?(b=this._calculate(c.expression.evaluate({zoom:d.zoom-1}),c.expression.evaluate({zoom:d.zoom}),c.expression.evaluate({zoom:d.zoom+1}),d),new ss(this,{kind:"constant",value:b},d)):new ss(this,c.expression,d)}evaluate(c,d,m,b,E,S){return c.kind==="source"?(E=c.evaluate(d,m,b,E,S),this._calculate(E,E,E,d)):c.kind==="composite"?this._calculate(c.evaluate({zoom:Math.floor(d.zoom)-1},m,b),c.evaluate({zoom:Math.floor(d.zoom)},m,b),c.evaluate({zoom:Math.floor(d.zoom)+1},m,b),d):c.value}_calculate(c,d,m,b){return b.zoom>b.zoomHistory.lastIntegerZoom?{from:c,to:d}:{from:m,to:d}}interpolate(c){return c}}class ny{constructor(c){this.specification=c}possiblyEvaluate(c,d,m,b){if(c.value!==void 0)return c.expression.kind==="constant"?(m=c.expression.evaluate(d,null,{},m,b),this._calculate(m,m,m,d)):this._calculate(c.expression.evaluate(new zr(Math.floor(d.zoom-1),d)),c.expression.evaluate(new zr(Math.floor(d.zoom),d)),c.expression.evaluate(new zr(Math.floor(d.zoom+1),d)),d)}_calculate(c,d,m,b){return b.zoom>b.zoomHistory.lastIntegerZoom?{from:c,to:d}:{from:m,to:d}}interpolate(c){return c}}class ry{constructor(c){this.specification=c}possiblyEvaluate(c,d,m,b){return!!c.expression.evaluate(d,null,{},m,b)}interpolate(){return!1}}class ta{constructor(c){this.properties=c,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const b in c){var m=c[b],d=(m.specification.overridable&&this.overridableProperties.push(b),this.defaultPropertyValues[b]=new Jm(m,void 0)),m=this.defaultTransitionablePropertyValues[b]=new q0(m);this.defaultTransitioningPropertyValues[b]=m.untransitioned(),this.defaultPossiblyEvaluatedValues[b]=d.possiblyEvaluate({})}}}Ht("DataDrivenProperty",xn),Ht("DataConstantProperty",sn),Ht("CrossFadedDataDrivenProperty",Nu),Ht("CrossFadedProperty",ny),Ht("ColorRampProperty",ry);const dp="-transition";class cs extends ae{constructor(c,d){if(super(),this.id=c.id,this.type=c.type,this._featureFilter={filter:()=>!0,needGeometry:!1},c.type!=="custom"&&(this.metadata=c.metadata,this.minzoom=c.minzoom,this.maxzoom=c.maxzoom,c.type!=="background"&&(this.source=c.source,this.sourceLayer=c["source-layer"],this.filter=c.filter),d.layout&&(this._unevaluatedLayout=new AR(d.layout)),d.paint)){this._transitionablePaint=new ey(d.paint);for(const m in c.paint)this.setPaintProperty(m,c.paint[m],{validate:!1});for(const m in c.layout)this.setLayoutProperty(m,c.layout[m],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new hp(d.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(c){return c==="visibility"?this.visibility:this._unevaluatedLayout.getValue(c)}setLayoutProperty(c,d,m={}){if(d!=null){var b=`layers.${this.id}.layout.`+c;if(this._validate(CR,b,c,d,m))return}c==="visibility"?this.visibility=d:this._unevaluatedLayout.setValue(c,d)}getPaintProperty(c){return c.endsWith(dp)?this._transitionablePaint.getTransition(c.slice(0,-dp.length)):this._transitionablePaint.getValue(c)}setPaintProperty(c,d,m={}){if(d!=null){var b=`layers.${this.id}.paint.`+c;if(this._validate(SR,b,c,d,m))return!1}var E;return c.endsWith(dp)?(this._transitionablePaint.setTransition(c.slice(0,-dp.length),d||void 0),!1):(m=(b=this._transitionablePaint._values[c]).property.specification["property-type"]==="cross-faded-data-driven",E=b.value.isDataDriven(),b=b.value,this._transitionablePaint.setValue(c,d),this._handleSpecialPaintPropertyUpdate(c),(d=this._transitionablePaint._values[c].value).isDataDriven()||E||m||this._handleOverridablePaintPropertyUpdate(c,b,d))}_handleSpecialPaintPropertyUpdate(c){}_handleOverridablePaintPropertyUpdate(c,d,m){return!1}isHidden(c){return!!(this.minzoom&&c<this.minzoom)||!!(this.maxzoom&&c>=this.maxzoom)||this.visibility==="none"}updateTransitions(c){this._transitioningPaint=this._transitionablePaint.transitioned(c,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(c,d){c.getCrossfadeParameters&&(this._crossfadeParameters=c.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(c,void 0,d)),this.paint=this._transitioningPaint.possiblyEvaluate(c,void 0,d)}serialize(){var c={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(c.layout=c.layout||{},c.layout.visibility=this.visibility),ue(c,(d,m)=>!(d===void 0||m==="layout"&&!Object.keys(d).length||m==="paint"&&!Object.keys(d).length))}_validate(c,d,m,b,E={}){return(!E||E.validate!==!1)&&iT(this,c.call(cp,{key:d,layerType:this.type,objectKey:m,value:b,styleSpec:q,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const d in this.paint._values){var c=this.paint.get(d);if(c instanceof ss&&rd(c.property.specification)&&(c.value.kind==="source"||c.value.kind==="composite")&&c.value.isStateDependent)return!0}return!1}}const lT={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class fp{constructor(c,d){this._structArray=c,this._pos1=d*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class wi{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(c,d){return c._trim(),d&&(c.isTransferred=!0,d.push(c.arrayBuffer)),{length:c.length,arrayBuffer:c.arrayBuffer}}static deserialize(c){var d=Object.create(this.prototype);return d.arrayBuffer=c.arrayBuffer,d.length=c.length,d.capacity=c.arrayBuffer.byteLength/d.bytesPerElement,d._refreshViews(),d}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(c){this.reserve(c),this.length=c}reserve(c){c>this.capacity&&(this.capacity=Math.max(c,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement),c=this.uint8,this._refreshViews(),c)&&this.uint8.set(c)}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function Bi(u,c=1){let d=0,m=0;return{members:u.map(b=>{E=b.type;var E=lT[E].BYTES_PER_ELEMENT,S=d=W0(d,Math.max(c,E)),A=b.components||1;return m=Math.max(m,E),d+=E*A,{name:b.name,type:b.type,components:A,offset:S}}),size:W0(d,Math.max(m,c)),alignment:c}}function W0(u,c){return Math.ceil(u/c)*c}class ad extends wi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(c,d){var m=this.length;return this.resize(m+1),this.emplace(m,c,d)}emplace(c,d,m){var b=2*c;return this.int16[0+b]=d,this.int16[1+b]=m,c}}ad.prototype.bytesPerElement=4,Ht("StructArrayLayout2i4",ad);class pp extends wi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(c,d,m){var b=this.length;return this.resize(b+1),this.emplace(b,c,d,m)}emplace(c,d,m,b){var E=3*c;return this.int16[0+E]=d,this.int16[1+E]=m,this.int16[2+E]=b,c}}pp.prototype.bytesPerElement=6,Ht("StructArrayLayout3i6",pp);class Y0 extends wi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(c,d,m,b){var E=this.length;return this.resize(E+1),this.emplace(E,c,d,m,b)}emplace(c,d,m,b,E){var S=4*c;return this.int16[0+S]=d,this.int16[1+S]=m,this.int16[2+S]=b,this.int16[3+S]=E,c}}Y0.prototype.bytesPerElement=8,Ht("StructArrayLayout4i8",Y0);class K0 extends wi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(c,d,m,b,E,S){var A=this.length;return this.resize(A+1),this.emplace(A,c,d,m,b,E,S)}emplace(c,d,m,b,E,S,A){var I=6*c;return this.int16[0+I]=d,this.int16[1+I]=m,this.int16[2+I]=b,this.int16[3+I]=E,this.int16[4+I]=S,this.int16[5+I]=A,c}}K0.prototype.bytesPerElement=12,Ht("StructArrayLayout2i4i12",K0);class iy extends wi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(c,d,m,b,E,S){var A=this.length;return this.resize(A+1),this.emplace(A,c,d,m,b,E,S)}emplace(c,d,m,b,E,S,A){var I=4*c,O=8*c;return this.int16[0+I]=d,this.int16[1+I]=m,this.uint8[4+O]=b,this.uint8[5+O]=E,this.uint8[6+O]=S,this.uint8[7+O]=A,c}}iy.prototype.bytesPerElement=8,Ht("StructArrayLayout2i4ub8",iy);class sd extends wi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(c,d){var m=this.length;return this.resize(m+1),this.emplace(m,c,d)}emplace(c,d,m){var b=2*c;return this.float32[0+b]=d,this.float32[1+b]=m,c}}sd.prototype.bytesPerElement=8,Ht("StructArrayLayout2f8",sd);class oy extends wi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(c,d,m,b,E,S,A,I,O,k){var U=this.length;return this.resize(U+1),this.emplace(U,c,d,m,b,E,S,A,I,O,k)}emplace(c,d,m,b,E,S,A,I,O,k,U){var W=10*c;return this.uint16[0+W]=d,this.uint16[1+W]=m,this.uint16[2+W]=b,this.uint16[3+W]=E,this.uint16[4+W]=S,this.uint16[5+W]=A,this.uint16[6+W]=I,this.uint16[7+W]=O,this.uint16[8+W]=k,this.uint16[9+W]=U,c}}oy.prototype.bytesPerElement=20,Ht("StructArrayLayout10ui20",oy);class ay extends wi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(c,d,m,b,E,S,A,I,O,k,U,W){var re=this.length;return this.resize(re+1),this.emplace(re,c,d,m,b,E,S,A,I,O,k,U,W)}emplace(c,d,m,b,E,S,A,I,O,k,U,W,re){var ie=12*c;return this.int16[0+ie]=d,this.int16[1+ie]=m,this.int16[2+ie]=b,this.int16[3+ie]=E,this.uint16[4+ie]=S,this.uint16[5+ie]=A,this.uint16[6+ie]=I,this.uint16[7+ie]=O,this.int16[8+ie]=k,this.int16[9+ie]=U,this.int16[10+ie]=W,this.int16[11+ie]=re,c}}ay.prototype.bytesPerElement=24,Ht("StructArrayLayout4i4ui4i24",ay);class cd extends wi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(c,d,m){var b=this.length;return this.resize(b+1),this.emplace(b,c,d,m)}emplace(c,d,m,b){var E=3*c;return this.float32[0+E]=d,this.float32[1+E]=m,this.float32[2+E]=b,c}}cd.prototype.bytesPerElement=12,Ht("StructArrayLayout3f12",cd);class Z0 extends wi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(c){var d=this.length;return this.resize(d+1),this.emplace(d,c)}emplace(c,d){return this.uint32[0+ +c]=d,c}}Z0.prototype.bytesPerElement=4,Ht("StructArrayLayout1ul4",Z0);class gp extends wi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(c,d,m,b,E,S,A,I,O){var k=this.length;return this.resize(k+1),this.emplace(k,c,d,m,b,E,S,A,I,O)}emplace(c,d,m,b,E,S,A,I,O,k){var U=10*c,W=5*c;return this.int16[0+U]=d,this.int16[1+U]=m,this.int16[2+U]=b,this.int16[3+U]=E,this.int16[4+U]=S,this.int16[5+U]=A,this.uint32[3+W]=I,this.uint16[8+U]=O,this.uint16[9+U]=k,c}}gp.prototype.bytesPerElement=20,Ht("StructArrayLayout6i1ul2ui20",gp);class X0 extends wi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(c,d,m,b,E,S){var A=this.length;return this.resize(A+1),this.emplace(A,c,d,m,b,E,S)}emplace(c,d,m,b,E,S,A){var I=6*c;return this.int16[0+I]=d,this.int16[1+I]=m,this.int16[2+I]=b,this.int16[3+I]=E,this.int16[4+I]=S,this.int16[5+I]=A,c}}X0.prototype.bytesPerElement=12,Ht("StructArrayLayout2i2i2i12",X0);class Q0 extends wi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(c,d,m,b,E){var S=this.length;return this.resize(S+1),this.emplace(S,c,d,m,b,E)}emplace(c,d,m,b,E,S){var A=4*c,I=8*c;return this.float32[0+A]=d,this.float32[1+A]=m,this.float32[2+A]=b,this.int16[6+I]=E,this.int16[7+I]=S,c}}Q0.prototype.bytesPerElement=16,Ht("StructArrayLayout2f1f2i16",Q0);class sy extends wi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(c,d,m,b){var E=this.length;return this.resize(E+1),this.emplace(E,c,d,m,b)}emplace(c,d,m,b,E){var S=12*c,A=3*c;return this.uint8[0+S]=d,this.uint8[1+S]=m,this.float32[1+A]=b,this.float32[2+A]=E,c}}sy.prototype.bytesPerElement=12,Ht("StructArrayLayout2ub2f12",sy);class mp extends wi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(c,d,m){var b=this.length;return this.resize(b+1),this.emplace(b,c,d,m)}emplace(c,d,m,b){var E=3*c;return this.uint16[0+E]=d,this.uint16[1+E]=m,this.uint16[2+E]=b,c}}mp.prototype.bytesPerElement=6,Ht("StructArrayLayout3ui6",mp);class cy extends wi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(c,d,m,b,E,S,A,I,O,k,U,W,re,ie,fe,we,de){var Me=this.length;return this.resize(Me+1),this.emplace(Me,c,d,m,b,E,S,A,I,O,k,U,W,re,ie,fe,we,de)}emplace(c,d,m,b,E,S,A,I,O,k,U,W,re,ie,fe,we,de,Me){var Ve=24*c,$e=12*c,Ye=48*c;return this.int16[0+Ve]=d,this.int16[1+Ve]=m,this.uint16[2+Ve]=b,this.uint16[3+Ve]=E,this.uint32[2+$e]=S,this.uint32[3+$e]=A,this.uint32[4+$e]=I,this.uint16[10+Ve]=O,this.uint16[11+Ve]=k,this.uint16[12+Ve]=U,this.float32[7+$e]=W,this.float32[8+$e]=re,this.uint8[36+Ye]=ie,this.uint8[37+Ye]=fe,this.uint8[38+Ye]=we,this.uint32[10+$e]=de,this.int16[22+Ve]=Me,c}}cy.prototype.bytesPerElement=48,Ht("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",cy);class J0 extends wi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(c,d,m,b,E,S,A,I,O,k,U,W,re,ie,fe,we,de,Me,Ve,$e,Ye,et,mt,zt,Nt,ut,kt,vt){var pt=this.length;return this.resize(pt+1),this.emplace(pt,c,d,m,b,E,S,A,I,O,k,U,W,re,ie,fe,we,de,Me,Ve,$e,Ye,et,mt,zt,Nt,ut,kt,vt)}emplace(c,d,m,b,E,S,A,I,O,k,U,W,re,ie,fe,we,de,Me,Ve,$e,Ye,et,mt,zt,Nt,ut,kt,vt,pt){var tt=32*c,Gt=16*c;return this.int16[0+tt]=d,this.int16[1+tt]=m,this.int16[2+tt]=b,this.int16[3+tt]=E,this.int16[4+tt]=S,this.int16[5+tt]=A,this.int16[6+tt]=I,this.int16[7+tt]=O,this.uint16[8+tt]=k,this.uint16[9+tt]=U,this.uint16[10+tt]=W,this.uint16[11+tt]=re,this.uint16[12+tt]=ie,this.uint16[13+tt]=fe,this.uint16[14+tt]=we,this.uint16[15+tt]=de,this.uint16[16+tt]=Me,this.uint16[17+tt]=Ve,this.uint16[18+tt]=$e,this.uint16[19+tt]=Ye,this.uint16[20+tt]=et,this.uint16[21+tt]=mt,this.uint16[22+tt]=zt,this.uint32[12+Gt]=Nt,this.float32[13+Gt]=ut,this.float32[14+Gt]=kt,this.uint16[30+tt]=vt,this.uint16[31+tt]=pt,c}}J0.prototype.bytesPerElement=64,Ht("StructArrayLayout8i15ui1ul2f2ui64",J0);class ly extends wi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(c){var d=this.length;return this.resize(d+1),this.emplace(d,c)}emplace(c,d){return this.float32[0+ +c]=d,c}}ly.prototype.bytesPerElement=4,Ht("StructArrayLayout1f4",ly);class eb extends wi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(c,d,m){var b=this.length;return this.resize(b+1),this.emplace(b,c,d,m)}emplace(c,d,m,b){var E=3*c;return this.uint16[0+6*c]=d,this.float32[1+E]=m,this.float32[2+E]=b,c}}eb.prototype.bytesPerElement=12,Ht("StructArrayLayout1ui2f12",eb);class tb extends wi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(c,d,m){var b=this.length;return this.resize(b+1),this.emplace(b,c,d,m)}emplace(c,d,m,b){var E=4*c;return this.uint32[0+2*c]=d,this.uint16[2+E]=m,this.uint16[3+E]=b,c}}tb.prototype.bytesPerElement=8,Ht("StructArrayLayout1ul2ui8",tb);class nb extends wi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(c,d){var m=this.length;return this.resize(m+1),this.emplace(m,c,d)}emplace(c,d,m){var b=2*c;return this.uint16[0+b]=d,this.uint16[1+b]=m,c}}nb.prototype.bytesPerElement=4,Ht("StructArrayLayout2ui4",nb);class El extends wi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(c){var d=this.length;return this.resize(d+1),this.emplace(d,c)}emplace(c,d){return this.uint16[0+ +c]=d,c}}El.prototype.bytesPerElement=2,Ht("StructArrayLayout1ui2",El);class rb extends wi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(c,d,m,b){var E=this.length;return this.resize(E+1),this.emplace(E,c,d,m,b)}emplace(c,d,m,b,E){var S=4*c;return this.float32[0+S]=d,this.float32[1+S]=m,this.float32[2+S]=b,this.float32[3+S]=E,c}}rb.prototype.bytesPerElement=16,Ht("StructArrayLayout4f16",rb);class uT extends fp{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new p(this.anchorPointX,this.anchorPointY)}}uT.prototype.size=20;class hT extends gp{get(c){return new uT(this,c)}}Ht("CollisionBoxArray",hT);class dT extends fp{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(c){this._structArray.uint8[this._pos1+37]=c}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(c){this._structArray.uint8[this._pos1+38]=c}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(c){this._structArray.uint32[this._pos4+10]=c}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}dT.prototype.size=48;class ib extends cy{get(c){return new dT(this,c)}}Ht("PlacedSymbolArray",ib);class fT extends fp{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(c){this._structArray.uint32[this._pos4+12]=c}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}fT.prototype.size=64;class pT extends J0{get(c){return new fT(this,c)}}Ht("SymbolInstanceArray",pT);class gT extends ly{getoffsetX(c){return this.float32[+c+0]}}Ht("GlyphOffsetArray",gT);class mT extends pp{getx(c){return this.int16[3*c+0]}gety(c){return this.int16[3*c+1]}gettileUnitDistanceFromAnchor(c){return this.int16[3*c+2]}}Ht("SymbolLineVertexArray",mT);class ld extends fp{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}ld.prototype.size=12;class yT extends eb{get(c){return new ld(this,c)}}Ht("TextAnchorOffsetArray",yT);class ob extends fp{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}ob.prototype.size=8;class uy extends tb{get(c){return new ob(this,c)}}Ht("FeatureIndexArray",uy);class ab extends ad{}class sb extends ad{}class IR extends ad{}class hy extends K0{}class dy extends iy{}class PR extends sd{}class ud extends oy{}class _T extends ay{}class yp extends cd{}class MR extends Z0{}class vT extends X0{}class RR extends sy{}class hd extends mp{}class fy extends nb{}const kR=Bi([{name:"a_pos",components:2,type:"Int16"}],4).members;class w{constructor(c=[]){this.segments=c}prepareSegment(c,d,m,b){let E=this.segments[this.segments.length-1];return c>w.MAX_VERTEX_ARRAY_LENGTH&&Ee(`Max vertices per segment is ${w.MAX_VERTEX_ARRAY_LENGTH}: bucket requested `+c),(!E||E.vertexLength+c>w.MAX_VERTEX_ARRAY_LENGTH||E.sortKey!==b)&&(E={vertexOffset:d.length,primitiveOffset:m.length,vertexLength:0,primitiveLength:0},b!==void 0&&(E.sortKey=b),this.segments.push(E)),E}get(){return this.segments}destroy(){for(const c of this.segments)for(const d in c.vaos)c.vaos[d].destroy()}static simpleSegment(c,d,m,b){return new w([{vertexOffset:c,primitiveOffset:d,vertexLength:m,primitiveLength:b,vaos:{},sortKey:0}])}}function s(u,c){return 256*(u=ce(Math.floor(u),0,255))+(c=ce(Math.floor(c),0,255))}w.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Ht("SegmentVector",w);const f=Bi([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);ao={exports:{}},rp={exports:{},exports:function(u,c){for(var d,m,b=3&u.length,E=u.length-b,S=c,A=3432918353,I=461845907,O=0;O<E;)m=255&u.charCodeAt(O)|(255&u.charCodeAt(++O))<<8|(255&u.charCodeAt(++O))<<16|(255&u.charCodeAt(++O))<<24,++O,S=27492+(65535&(d=5*(65535&(S=(S^=m=(65535&(m=(m=(65535&m)*A+(((m>>>16)*A&65535)<<16)&4294967295)<<15|m>>>17))*I+(((m>>>16)*I&65535)<<16)&4294967295)<<13|S>>>19))+((5*(S>>>16)&65535)<<16)&4294967295))+((58964+(d>>>16)&65535)<<16);switch(m=0,b){case 3:m^=(255&u.charCodeAt(O+2))<<16;case 2:m^=(255&u.charCodeAt(O+1))<<8;case 1:S^=m=(65535&(m=(m=(65535&(m^=255&u.charCodeAt(O)))*A+(((m>>>16)*A&65535)<<16)&4294967295)<<15|m>>>17))*I+(((m>>>16)*I&65535)<<16)&4294967295}return S=2246822507*(65535&(S=(S^=u.length)^S>>>16))+((2246822507*(S>>>16)&65535)<<16)&4294967295,S=3266489909*(65535&(S^=S>>>13))+((3266489909*(S>>>16)&65535)<<16)&4294967295,(S^=S>>>16)>>>0}},ls={exports:{},exports:function(u,c){for(var d,m=u.length,b=c^m,E=0;4<=m;)d=1540483477*(65535&(d=255&u.charCodeAt(E)|(255&u.charCodeAt(++E))<<8|(255&u.charCodeAt(++E))<<16|(255&u.charCodeAt(++E))<<24))+((1540483477*(d>>>16)&65535)<<16),b=1540483477*(65535&b)+((1540483477*(b>>>16)&65535)<<16)^1540483477*(65535&(d^=d>>>24))+((1540483477*(d>>>16)&65535)<<16),m-=4,++E;switch(m){case 3:b^=(255&u.charCodeAt(E+2))<<16;case 2:b^=(255&u.charCodeAt(E+1))<<8;case 1:b=1540483477*(65535&(b^=255&u.charCodeAt(E)))+((1540483477*(b>>>16)&65535)<<16)}return b=1540483477*(65535&(b^=b>>>13))+((1540483477*(b>>>16)&65535)<<16),(b^=b>>>15)>>>0}},Or=rp.exports,Rc=ls.exports,ao.exports=Or,ao.exports.murmur3=Or,ao.exports.murmur2=Rc;var y=a(ao.exports);class v{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(c,d,m,b){this.ids.push(T(c)),this.positions.push(d,m,b)}getPositions(c){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");var d=T(c);let m=0,b=this.ids.length-1;for(;m<b;){var E=m+b>>1;this.ids[E]>=d?b=E:m=1+E}for(var S=[];this.ids[m]===d;){var A=this.positions[3*m],I=this.positions[3*m+1],O=this.positions[3*m+2];S.push({index:A,start:I,end:O}),m++}return S}static serialize(b,d){var m=new Float64Array(b.ids),b=new Uint32Array(b.positions);return P(m,b,0,m.length-1),d&&d.push(m.buffer,b.buffer),{ids:m,positions:b}}static deserialize(c){var d=new v;return d.ids=c.ids,d.positions=c.positions,d.indexed=!0,d}}function T(u){var c=+u;return!isNaN(c)&&c<=Number.MAX_SAFE_INTEGER?c:y(String(u))}function P(u,c,d,m){for(;d<m;){var b=u[d+m>>1];let E=d-1,S=m+1;for(;;){for(;u[++E]<b;);for(;u[--S]>b;);if(E>=S)break;R(u,E,S),R(c,3*E,3*S),R(c,3*E+1,3*S+1),R(c,3*E+2,3*S+2)}S-d<m-S?(P(u,c,d,S),d=S+1):(P(u,c,S+1,m),m=S)}}function R(u,c,d){var m=u[c];u[c]=u[d],u[d]=m}Ht("FeaturePositionMap",v);class N{constructor(c,d){this.gl=c.gl,this.location=d}}class G extends N{constructor(c,d){super(c,d),this.current=0}set(c){this.current!==c&&(this.current=c,this.gl.uniform1f(this.location,c))}}class Z extends N{constructor(c,d){super(c,d),this.current=[0,0,0,0]}set(c){c[0]===this.current[0]&&c[1]===this.current[1]&&c[2]===this.current[2]&&c[3]===this.current[3]||(this.current=c,this.gl.uniform4f(this.location,c[0],c[1],c[2],c[3]))}}class j extends N{constructor(c,d){super(c,d),this.current=ir.transparent}set(c){c.r===this.current.r&&c.g===this.current.g&&c.b===this.current.b&&c.a===this.current.a||(this.current=c,this.gl.uniform4f(this.location,c.r,c.g,c.b,c.a))}}const X=new Float32Array(16);function ge(u){return[s(255*u.r,255*u.g),s(255*u.b,255*u.a)]}class ye{constructor(c,d,m){this.value=c,this.uniformNames=d.map(b=>"u_"+b),this.type=m}setUniform(c,d,m){c.set(m.constantOr(this.value))}getBinding(c,d,m){return new(this.type==="color"?j:G)(c,d)}}class be{constructor(c,d){this.uniformNames=d.map(m=>"u_"+m),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(c,d){this.pixelRatioFrom=d.pixelRatio,this.pixelRatioTo=c.pixelRatio,this.patternFrom=d.tlbr,this.patternTo=c.tlbr}setUniform(c,d,m,b){b=b==="u_pattern_to"?this.patternTo:b==="u_pattern_from"?this.patternFrom:b==="u_pixel_ratio_to"?this.pixelRatioTo:b==="u_pixel_ratio_from"?this.pixelRatioFrom:null,b&&c.set(b)}getBinding(c,d,m){return new(m.substr(0,9)==="u_pattern"?Z:G)(c,d)}}class ve{constructor(c,d,m,b){this.expression=c,this.type=m,this.maxValue=0,this.paintVertexAttributes=d.map(E=>({name:"a_"+E,type:"Float32",components:m==="color"?2:1,offset:0})),this.paintVertexArray=new b}populatePaintArray(c,A,m,b,E){var S=this.paintVertexArray.length,A=this.expression.evaluate(new zr(0),A,{},b,[],E);this.paintVertexArray.resize(c),this._setPaintValue(S,c,A)}updatePaintArray(c,d,m,b){m=this.expression.evaluate({zoom:0},m,b),this._setPaintValue(c,d,m)}_setPaintValue(c,d,m){if(this.type==="color"){var b=ge(m);for(let E=c;E<d;E++)this.paintVertexArray.emplace(E,b[0],b[1])}else{for(let E=c;E<d;E++)this.paintVertexArray.emplace(E,m);this.maxValue=Math.max(this.maxValue,Math.abs(m))}}upload(c){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=c.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Fe{constructor(c,d,m,b,E,S){this.expression=c,this.uniformNames=d.map(A=>`u_${A}_t`),this.type=m,this.useIntegerZoom=b,this.zoom=E,this.maxValue=0,this.paintVertexAttributes=d.map(A=>({name:"a_"+A,type:"Float32",components:m==="color"?4:2,offset:0})),this.paintVertexArray=new S}populatePaintArray(c,A,m,I,E){var S=this.expression.evaluate(new zr(this.zoom),A,{},I,[],E),A=this.expression.evaluate(new zr(this.zoom+1),A,{},I,[],E),I=this.paintVertexArray.length;this.paintVertexArray.resize(c),this._setPaintValue(I,c,S,A)}updatePaintArray(c,d,S,b){var E=this.expression.evaluate({zoom:this.zoom},S,b),S=this.expression.evaluate({zoom:this.zoom+1},S,b);this._setPaintValue(c,d,E,S)}_setPaintValue(c,d,m,b){if(this.type==="color"){var E=ge(m),S=ge(b);for(let A=c;A<d;A++)this.paintVertexArray.emplace(A,E[0],E[1],S[0],S[1])}else{for(let A=c;A<d;A++)this.paintVertexArray.emplace(A,m,b);this.maxValue=Math.max(this.maxValue,Math.abs(m),Math.abs(b))}}upload(c){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=c.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(c,d){d=this.useIntegerZoom?Math.floor(d.zoom):d.zoom,d=ce(this.expression.interpolationFactor(d,this.zoom,this.zoom+1),0,1),c.set(d)}getBinding(c,d,m){return new G(c,d)}}class Ue{constructor(c,d,m,b,E,S){this.expression=c,this.type=d,this.useIntegerZoom=m,this.zoom=b,this.layerId=S,this.zoomInPaintVertexArray=new E,this.zoomOutPaintVertexArray=new E}populatePaintArray(c,d,m){var b=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(c),this.zoomOutPaintVertexArray.resize(c),this._setPaintValues(b,c,d.patterns&&d.patterns[this.layerId],m)}updatePaintArray(c,d,m,b,E){this._setPaintValues(c,d,m.patterns&&m.patterns[this.layerId],E)}_setPaintValues(c,d,m,b){if(b&&m){var{min:m,mid:E,max:S}=m,A=b[m],I=b[E],O=b[S];if(A&&I&&O)for(let U=c;U<d;U++)this.zoomInPaintVertexArray.emplace(U,I.tl[0],I.tl[1],I.br[0],I.br[1],A.tl[0],A.tl[1],A.br[0],A.br[1],I.pixelRatio,A.pixelRatio),this.zoomOutPaintVertexArray.emplace(U,I.tl[0],I.tl[1],I.br[0],I.br[1],O.tl[0],O.tl[1],O.br[0],O.br[1],I.pixelRatio,O.pixelRatio)}}upload(c){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=c.createVertexBuffer(this.zoomInPaintVertexArray,f.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=c.createVertexBuffer(this.zoomOutPaintVertexArray,f.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class ze{constructor(c,d,m){this.binders={},this._buffers=[];var b,E,S,A,I,O,k=[];for(const U in c.paint._values)m(U)&&(O=c.paint.get(U))instanceof ss&&rd(O.property.specification)&&(b=Je(U,c.type),E=O.value,S=O.property.specification.type,A=O.property.useIntegerZoom,O=(O=O.property.specification["property-type"])==="cross-faded"||O==="cross-faded-data-driven",E.kind==="constant"?(this.binders[U]=O?new be(E.value,b):new ye(E.value,b,S),k.push("/u_"+U)):E.kind==="source"||O?(I=Xe(U,S,"source"),this.binders[U]=O?new Ue(E,S,A,d,I,c.id):new ve(E,b,S,I),k.push("/a_"+U)):(O=Xe(U,S,"composite"),this.binders[U]=new Fe(E,b,S,A,d,O),k.push("/z_"+U)));this.cacheKey=k.sort().join("")}getMaxValue(c){return c=this.binders[c],c instanceof ve||c instanceof Fe?c.maxValue:0}populatePaintArrays(c,d,m,b,E){for(const A in this.binders){var S=this.binders[A];(S instanceof ve||S instanceof Fe||S instanceof Ue)&&S.populatePaintArray(c,d,m,b,E)}}setConstantPatternPositions(c,d){for(const b in this.binders){var m=this.binders[b];m instanceof be&&m.setConstantPatternPositions(c,d)}}updatePaintArrays(c,d,m,b,E){let S=!1;for(const k in c)for(const U of d.getPositions(k)){var A=m.feature(U.index);for(const W in this.binders){var I,O=this.binders[W];(O instanceof ve||O instanceof Fe||O instanceof Ue)&&O.expression.isStateDependent===!0&&(I=b.paint.get(W),O.expression=I.value,O.updatePaintArray(U.start,U.end,A,c[k],E),S=!0)}}return S}defines(){var c=[];for(const m in this.binders){var d=this.binders[m];(d instanceof ye||d instanceof be)&&c.push(...d.uniformNames.map(b=>"#define HAS_UNIFORM_"+b))}return c}getBinderAttributes(){var c=[];for(const m in this.binders){var d=this.binders[m];if(d instanceof ve||d instanceof Fe)for(let b=0;b<d.paintVertexAttributes.length;b++)c.push(d.paintVertexAttributes[b].name);else if(d instanceof Ue)for(let b=0;b<f.members.length;b++)c.push(f.members[b].name)}return c}getBinderUniforms(){var c=[];for(const m in this.binders){var d=this.binders[m];if(d instanceof ye||d instanceof be||d instanceof Fe)for(const b of d.uniformNames)c.push(b)}return c}getPaintVertexBuffers(){return this._buffers}getUniforms(c,d){var m=[];for(const S in this.binders){var b,E=this.binders[S];if(E instanceof ye||E instanceof be||E instanceof Fe)for(const A of E.uniformNames)d[A]&&(b=E.getBinding(c,d[A],A),m.push({name:A,property:S,binding:b}))}return m}setUniforms(c,d,m,b){for(var{name:E,property:S,binding:A}of d)this.binders[S].setUniform(A,b,m.get(S),E)}updatePaintBuffers(c){this._buffers=[];for(const b in this.binders){var d,m=this.binders[b];c&&m instanceof Ue?(d=c.fromScale===2?m.zoomInPaintVertexBuffer:m.zoomOutPaintVertexBuffer)&&this._buffers.push(d):(m instanceof ve||m instanceof Fe)&&m.paintVertexBuffer&&this._buffers.push(m.paintVertexBuffer)}}upload(c){for(const m in this.binders){var d=this.binders[m];(d instanceof ve||d instanceof Fe||d instanceof Ue)&&d.upload(c)}this.updatePaintBuffers()}destroy(){for(const d in this.binders){var c=this.binders[d];(c instanceof ve||c instanceof Fe||c instanceof Ue)&&c.destroy()}}}class Qe{constructor(c,d,m=()=>!0){this.programConfigurations={};for(const b of c)this.programConfigurations[b.id]=new ze(b,d,m);this.needsUpload=!1,this._featureMap=new v,this._bufferOffset=0}populatePaintArrays(c,d,m,b,E,S){for(const A in this.programConfigurations)this.programConfigurations[A].populatePaintArrays(c,d,b,E,S);d.id!==void 0&&this._featureMap.add(d.id,m,this._bufferOffset,c),this._bufferOffset=c,this.needsUpload=!0}updatePaintArrays(c,d,m,b){for(const E of m)this.needsUpload=this.programConfigurations[E.id].updatePaintArrays(c,this._featureMap,d,E,b)||this.needsUpload}get(c){return this.programConfigurations[c]}upload(c){if(this.needsUpload){for(const d in this.programConfigurations)this.programConfigurations[d].upload(c);this.needsUpload=!1}}destroy(){for(const c in this.programConfigurations)this.programConfigurations[c].destroy()}}function Je(u,c){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[u]||[u.replace(c+"-","").replace(/-/g,"_")]}function Xe(b,c,d){var m={color:{source:sd,composite:rb},number:{source:ly,composite:sd}},b=(b=b,{"line-pattern":{source:ud,composite:ud},"fill-pattern":{source:ud,composite:ud},"fill-extrusion-pattern":{source:ud,composite:ud}}[b]);return b&&b[d]||m[c][d]}Ht("ConstantBinder",ye),Ht("CrossFadedConstantBinder",be),Ht("SourceExpressionBinder",ve),Ht("CrossFadedCompositeBinder",Ue),Ht("CompositeExpressionBinder",Fe),Ht("ProgramConfiguration",ze,{omit:["_buffers"]}),Ht("ProgramConfigurationSet",Qe);const ct=8192,it=Math.pow(2,14)-1,_t=-it-1;function Dt(u){var c=ct/u.extent,d=u.loadGeometry();for(let A=0;A<d.length;A++){var m=d[A];for(let I=0;I<m.length;I++){var b=m[I],E=Math.round(b.x*c),S=Math.round(b.y*c);b.x=ce(E,_t,it),b.y=ce(S,_t,it),(E<b.x||E>b.x+1||S<b.y||S>b.y+1)&&Ee("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return d}function Yt(u,c){return{type:u.type,id:u.id,properties:u.properties,geometry:c?Dt(u):[]}}function vn(u,c,d,m,b){u.emplaceBack(2*c+(m+1)/2,2*d+(b+1)/2)}class bn{constructor(c){this.zoom=c.zoom,this.overscaling=c.overscaling,this.layers=c.layers,this.layerIds=this.layers.map(d=>d.id),this.index=c.index,this.hasPattern=!1,this.layoutVertexArray=new sb,this.indexArray=new hd,this.segments=new w,this.programConfigurations=new Qe(c.layers,c.zoom),this.stateDependentLayerIds=this.layers.filter(d=>d.isStateDependent()).map(d=>d.id)}populate(c,d,m){var b,E,S,A,I=this.layers[0],O=[];let k=null,U=!1;I.type==="circle"&&(k=I.layout.get("circle-sort-key"),U=!k.isConstant());for({feature:b,id:E,index:S,sourceLayerIndex:A}of c){var W,re=this.layers[0]._featureFilter.needGeometry,ie=Yt(b,re);this.layers[0]._featureFilter.filter(new zr(this.zoom),ie,m)&&(W=U?k.evaluate(ie,{},m):void 0,re={id:E,properties:b.properties,type:b.type,sourceLayerIndex:A,index:S,geometry:re?ie.geometry:Dt(b),patterns:{},sortKey:W},O.push(re))}U&&O.sort((Ve,$e)=>Ve.sortKey-$e.sortKey);for(const Ve of O){var{geometry:fe,index:we,sourceLayerIndex:de}=Ve,Me=c[we].feature;this.addFeature(Ve,fe,we,m),d.featureIndex.insert(Me,fe,we,de,this.index)}}update(c,d,m){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(c,d,this.stateDependentLayers,m)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(c){this.uploaded||(this.layoutVertexBuffer=c.createVertexBuffer(this.layoutVertexArray,kR),this.indexBuffer=c.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(c),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(c,d,m,b){for(const I of d)for(const O of I){var E=O.x,S=O.y;if(!(E<0||E>=ct||S<0||S>=ct)){var A=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,c.sortKey);const k=A.vertexLength;vn(this.layoutVertexArray,E,S,-1,-1),vn(this.layoutVertexArray,E,S,1,-1),vn(this.layoutVertexArray,E,S,1,1),vn(this.layoutVertexArray,E,S,-1,1),this.indexArray.emplaceBack(k,k+1,k+2),this.indexArray.emplaceBack(k,k+3,k+2),A.vertexLength+=4,A.primitiveLength+=2}}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,c,m,{},b)}}function Zt(u,c){for(let d=0;d<u.length;d++)if(ar(c,u[d]))return!0;for(let d=0;d<c.length;d++)if(ar(u,c[d]))return!0;return!!$t(u,c)}function Ct(u,c,d){return ar(u,c)||!!tr(c,u,d)}function cn(u,c){if(u.length===1)return Jn(c,u[0]);for(let m=0;m<c.length;m++){var d=c[m];for(let b=0;b<d.length;b++)if(ar(u,d[b]))return!0}for(let m=0;m<u.length;m++)if(Jn(c,u[m]))return!0;for(let m=0;m<c.length;m++)if($t(u,c[m]))return!0;return!1}function Cn(u,c,d){for(let b=0;b<c.length;b++){var m=c[b];if(3<=u.length){for(let E=0;E<m.length;E++)if(ar(u,m[E]))return!0}if(function(E,S,A){if(1<E.length){if($t(E,S))return 1;for(let I=0;I<S.length;I++)if(tr(S[I],E,A))return 1}for(let I=0;I<E.length;I++)if(tr(E[I],S,A))return 1}(u,m,d))return!0}return!1}function $t(u,c){var d,m;if(u.length!==0&&c.length!==0)for(let I=0;I<u.length-1;I++){var b=u[I],E=u[I+1];for(let O=0;O<c.length-1;O++){var S=c[O],A=c[O+1];if(m=E,ke(d=b,S=S,A=A)!==ke(m,S,A)&&ke(d,m,S)!==ke(d,m,A))return 1}}}function tr(u,c,d){var m=d*d;if(c.length===1)return u.distSqr(c[0])<m;for(let b=1;b<c.length;b++)if(Rr(u,c[b-1],c[b])<m)return 1}function Rr(u,c,d){var m=c.distSqr(d);return m===0||(m=((u.x-c.x)*(d.x-c.x)+(u.y-c.y)*(d.y-c.y))/m)<0?u.distSqr(c):1<m?u.distSqr(d):u.distSqr(d.sub(c)._mult(m)._add(c))}function Jn(u,c){let d=!1,m,b,E;for(let S=0;S<u.length;S++)for(let A=0,I=(m=u[S]).length-1;A<m.length;I=A++)b=m[A],E=m[I],b.y>c.y!=E.y>c.y&&c.x<(E.x-b.x)*(c.y-b.y)/(E.y-b.y)+b.x&&(d=!d);return d}function ar(u,c){let d=!1;for(let E=0,S=u.length-1;E<u.length;S=E++){var m=u[E],b=u[S];m.y>c.y!=b.y>c.y&&c.x<(b.x-m.x)*(c.y-m.y)/(b.y-m.y)+m.x&&(d=!d)}return d}function Ln(u,c,d,m,b){for(const S of u)if(c<=S.x&&d<=S.y&&m>=S.x&&b>=S.y)return!0;var E=[new p(c,d),new p(c,b),new p(m,b),new p(m,d)];if(2<u.length){for(const S of E)if(ar(u,S))return!0}for(let S=0;S<u.length-1;S++)if(function(A,I,O){var k=O[0],U=O[2];if(!(A.x<k.x&&I.x<k.x||A.x>U.x&&I.x>U.x||A.y<k.y&&I.y<k.y||A.y>U.y&&I.y>U.y))return k=ke(A,I,O[0]),k!==ke(A,I,O[1])||k!==ke(A,I,O[2])||k!==ke(A,I,O[3])}(u[S],u[S+1],E))return!0;return!1}function kr(u,c,d){var m=c.paint.get(u).value;return m.kind==="constant"?m.value:d.programConfigurations.get(c.id).getMaxValue(u)}function sr(u){return Math.sqrt(u[0]*u[0]+u[1]*u[1])}function Er(u,c,d,m,b){if(!c[0]&&!c[1])return u;var E=p.convert(c)._mult(b),S=(d==="viewport"&&E._rotate(-m),[]);for(let I=0;I<u.length;I++){var A=u[I];S.push(A.sub(E))}return S}function To(u,c){var d=[];for(let I=0;I<u.length;I++){var m=u[I],b=[];for(let O=0;O<m.length;O++){var S=m[O-1],E=m[O],A=m[O+1],S=O===0?new p(0,0):E.sub(S)._unit()._perp(),A=O===m.length-1?new p(0,0):A.sub(E)._unit()._perp(),S=S._add(A)._unit(),A=S.x*A.x+S.y*A.y;A!=0&&S._mult(1/A),b.push(S._mult(c)._add(E))}d.push(b)}return d}Ht("CircleBucket",bn,{omit:["layers"]});let ro,Ls;var So={get paint(){return Ls=Ls||new ta({"circle-radius":new xn(q.paint_circle["circle-radius"]),"circle-color":new xn(q.paint_circle["circle-color"]),"circle-blur":new xn(q.paint_circle["circle-blur"]),"circle-opacity":new xn(q.paint_circle["circle-opacity"]),"circle-translate":new sn(q.paint_circle["circle-translate"]),"circle-translate-anchor":new sn(q.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new sn(q.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new sn(q.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new xn(q.paint_circle["circle-stroke-width"]),"circle-stroke-color":new xn(q.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new xn(q.paint_circle["circle-stroke-opacity"])})},get layout(){return ro=ro||new ta({"circle-sort-key":new xn(q.layout_circle["circle-sort-key"])})}},ui=1e-6,xi=typeof Float32Array<"u"?Float32Array:Array;function ic(){var u=new xi(9);return xi!=Float32Array&&(u[1]=0,u[2]=0,u[3]=0,u[5]=0,u[6]=0,u[7]=0),u[0]=1,u[4]=1,u[8]=1,u}function jr(u){return u[0]=1,u[1]=0,u[2]=0,u[3]=0,u[4]=0,u[5]=1,u[6]=0,u[7]=0,u[8]=0,u[9]=0,u[10]=1,u[11]=0,u[12]=0,u[13]=0,u[14]=0,u[15]=1,u}function Co(u,Me,d){var m=Me[0],b=Me[1],E=Me[2],S=Me[3],A=Me[4],I=Me[5],O=Me[6],k=Me[7],U=Me[8],W=Me[9],re=Me[10],ie=Me[11],fe=Me[12],we=Me[13],de=Me[14],Me=Me[15],Ve=d[0],$e=d[1],Ye=d[2],et=d[3];return u[0]=Ve*m+$e*A+Ye*U+et*fe,u[1]=Ve*b+$e*I+Ye*W+et*we,u[2]=Ve*E+$e*O+Ye*re+et*de,u[3]=Ve*S+$e*k+Ye*ie+et*Me,Ve=d[4],$e=d[5],Ye=d[6],et=d[7],u[4]=Ve*m+$e*A+Ye*U+et*fe,u[5]=Ve*b+$e*I+Ye*W+et*we,u[6]=Ve*E+$e*O+Ye*re+et*de,u[7]=Ve*S+$e*k+Ye*ie+et*Me,Ve=d[8],$e=d[9],Ye=d[10],et=d[11],u[8]=Ve*m+$e*A+Ye*U+et*fe,u[9]=Ve*b+$e*I+Ye*W+et*we,u[10]=Ve*E+$e*O+Ye*re+et*de,u[11]=Ve*S+$e*k+Ye*ie+et*Me,Ve=d[12],$e=d[13],Ye=d[14],et=d[15],u[12]=Ve*m+$e*A+Ye*U+et*fe,u[13]=Ve*b+$e*I+Ye*W+et*we,u[14]=Ve*E+$e*O+Ye*re+et*de,u[15]=Ve*S+$e*k+Ye*ie+et*Me,u}Math.hypot||(Math.hypot=function(){for(var u=0,c=arguments.length;c--;)u+=arguments[c]*arguments[c];return Math.sqrt(u)});function Vr(u,c,d,m,b){return c=1/Math.tan(c/2),u[0]=c/d,u[1]=0,u[2]=0,u[3]=0,u[4]=0,u[5]=c,u[6]=0,u[7]=0,u[8]=0,u[9]=0,u[11]=-1,u[12]=0,u[13]=0,u[15]=0,b!=null&&b!==1/0?(u[10]=(b+m)*(d=1/(m-b)),u[14]=2*b*m*d):(u[10]=-1,u[14]=-2*m),u}function Yr(u,c,d,m,b,E,S){var A=1/(c-d),I=1/(m-b),O=1/(E-S);return u[0]=-2*A,u[1]=0,u[2]=0,u[3]=0,u[4]=0,u[5]=-2*I,u[6]=0,u[7]=0,u[8]=0,u[9]=0,u[10]=2*O,u[11]=0,u[12]=(c+d)*A,u[13]=(b+m)*I,u[14]=(S+E)*O,u[15]=1,u}rp=Co;function Fo(){var u=new xi(3);return xi!=Float32Array&&(u[0]=0,u[1]=0,u[2]=0),u}function hi(u,c,d){var m=new xi(3);return m[0]=u,m[1]=c,m[2]=d,m}function io(u,c){var b=c[0],d=c[1],m=c[2],b=b*b+d*d+m*m;return 0<b&&(b=1/Math.sqrt(b)),u[0]=c[0]*b,u[1]=c[1]*b,u[2]=c[2]*b,u}function Tl(u,c){return u[0]*c[0]+u[1]*c[1]+u[2]*c[2]}function oc(u,E,I){var m=E[0],b=E[1],E=E[2],S=I[0],A=I[1],I=I[2];return u[0]=b*I-E*A,u[1]=E*S-m*I,u[2]=m*A-b*S,u}function Ui(u,c,d){return u[0]=c[0]-d[0],u[1]=c[1]-d[1],u[2]=c[2]-d[2],u}function ac(u,S,d){var m=S[0],b=S[1],E=S[2],S=S[3];return u[0]=d[0]*m+d[4]*b+d[8]*E+d[12]*S,u[1]=d[1]*m+d[5]*b+d[9]*E+d[13]*S,u[2]=d[2]*m+d[6]*b+d[10]*E+d[14]*S,u[3]=d[3]*m+d[7]*b+d[11]*E+d[15]*S,u}Fo();function Sl(u,c,d){return u[0]=c[0]*d[0],u[1]=c[1]*d[1],u[2]=c[2]*d[2],u[3]=c[3]*d[3],u}function Xr(){var u=new xi(4);return xi!=Float32Array&&(u[0]=0,u[1]=0,u[2]=0),u[3]=1,u}ls=new xi(4),xi!=Float32Array&&(ls[0]=0,ls[1]=0,ls[2]=0,ls[3]=0),Fo(),hi(1,0,0),hi(0,1,0),Xr(),Xr(),ic();function Li(d){var c=d[0],d=d[1];return c*c+d*d}Or=new xi(2),xi!=Float32Array&&(Or[0]=0,Or[1]=0);class sc extends cs{constructor(c){super(c,So)}createBucket(c){return new bn(c)}queryRadius(c){return kr("circle-radius",this,c)+kr("circle-stroke-width",this,c)+sr(this.paint.get("circle-translate"))}queryIntersectsFeature(O,k,m,b,E,S,A,I){var O=Er(O,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),S.angle,A),k=this.paint.get("circle-radius").evaluate(k,m)+this.paint.get("circle-stroke-width").evaluate(k,m),U=this.paint.get("circle-pitch-alignment")==="map",W=U?O:dd(O,I),re=U?k*A:k;for(const we of b)for(const de of we){var ie=U?de:cc(de,I);let Me=re;var fe=ac([],[de.x,de.y,0,1],I);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?Me*=fe[3]/S.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(Me*=S.cameraToCenterDistance/fe[3]),Ct(W,ie,Me))return!0}return!1}}function cc(u,c){return u=ac([],[u.x,u.y,0,1],c),new p(u[0]/u[3],u[1]/u[3])}function dd(u,c){return u.map(d=>cc(d,c))}class Cl extends bn{}Ht("HeatmapBucket",Cl,{omit:["layers"]});let cb;var bT={get paint(){return cb=cb||new ta({"heatmap-radius":new xn(q.paint_heatmap["heatmap-radius"]),"heatmap-weight":new xn(q.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new sn(q.paint_heatmap["heatmap-intensity"]),"heatmap-color":new ry(q.paint_heatmap["heatmap-color"]),"heatmap-opacity":new sn(q.paint_heatmap["heatmap-opacity"])})}};function Ns(u,{width:c,height:d},m,b){if(b){if(b instanceof Uint8ClampedArray)b=new Uint8Array(b.buffer);else if(b.length!==c*d*m)throw new RangeError(`mismatched image size. expected: ${b.length} but got: `+c*d*m)}else b=new Uint8Array(c*d*m);return u.width=c,u.height=d,u.data=b,u}function fd(u,{width:c,height:d},m){var b;c===u.width&&d===u.height||(Lc(u,b=Ns({},{width:c,height:d},m),{x:0,y:0},{x:0,y:0},{width:Math.min(u.width,c),height:Math.min(u.height,d)},m),u.width=c,u.height=d,u.data=b.data)}function Lc(u,c,d,m,b,E){if(b.width!==0&&b.height!==0){if(b.width>u.width||b.height>u.height||d.x>u.width-b.width||d.y>u.height-b.height)throw new RangeError("out of range source coordinates for image copy");if(b.width>c.width||b.height>c.height||m.x>c.width-b.width||m.y>c.height-b.height)throw new RangeError("out of range destination coordinates for image copy");var S=u.data,A=c.data;if(S===A)throw new Error("srcData equals dstData, so image is already copied");for(let k=0;k<b.height;k++){var I=((d.y+k)*u.width+d.x)*E,O=((m.y+k)*c.width+m.x)*E;for(let U=0;U<b.width*E;U++)A[O+U]=S[I+U]}}}class lb{constructor(c,d){Ns(this,c,1,d)}resize(c){fd(this,c,1)}clone(){return new lb({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(c,d,m,b,E){Lc(c,d,m,b,E,1)}}class Ds{constructor(c,d){Ns(this,c,4,d)}resize(c){fd(this,c,4)}replace(c,d){d?this.data.set(c):c instanceof Uint8ClampedArray?this.data=new Uint8Array(c.buffer):this.data=c}clone(){return new Ds({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(c,d,m,b,E){Lc(c,d,m,b,E,4)}}function P9(u){const c={};var d=u.resolution||256,m=u.clips?u.clips.length:1;const b=u.image||new Ds({width:d,height:m});if(Math.log(d)/Math.LN2%1!=0)throw new Error("width is not a power of 2 - "+d);var E=(k,U,W)=>{c[u.evaluationKey]=W,W=u.expression.evaluate(c),b.data[k+U+0]=Math.floor(255*W.r/W.a),b.data[k+U+1]=Math.floor(255*W.g/W.a),b.data[k+U+2]=Math.floor(255*W.b/W.a),b.data[k+U+3]=Math.floor(255*W.a)};if(u.clips)for(let k=0,U=0;k<m;++k,U+=4*d)for(let W=0,re=0;W<d;W++,re+=4){var S=W/(d-1),{start:A,end:I}=u.clips[k];E(U,re,A*(1-S)+I*S)}else for(let k=0,U=0;k<d;k++,U+=4){var O=k/(d-1);E(0,U,O)}return b}Ht("AlphaImage",lb),Ht("RGBAImage",Ds);class BEe extends cs{createBucket(c){return new Cl(c)}constructor(c){super(c,bT),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(c){c==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){var c=this._transitionablePaint._values["heatmap-color"].value.expression;this.colorRamp=P9({expression:c,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let M9;var UEe={get paint(){return M9=M9||new ta({"hillshade-illumination-direction":new sn(q.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new sn(q.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new sn(q.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new sn(q.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new sn(q.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new sn(q.paint_hillshade["hillshade-accent-color"])})}};class zEe extends cs{constructor(c){super(c,UEe)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}const jEe=Bi([{name:"a_pos",components:2,type:"Int16"}],4).members;Rc={exports:{}};function OR(u,c,d){d=d||2;var m,b,E,S,A,I=c&&c.length,O=I?c[0]*d:u.length,k=R9(u,0,O,d,!0),U=[];if(k&&k.next!==k.prev){if(I&&(k=function(fe,we,de,Me){var Ve,$e,Ye,et,mt=[];for(Ve=0,$e=we.length;Ve<$e;Ve++)et=we[Ve]*Me,Ye=Ve<$e-1?we[Ve+1]*Me:fe.length,(et=R9(fe,et,Ye,Me,!1))===et.next&&(et.steiner=!0),mt.push(function(zt){for(var Nt=zt,ut=zt;(Nt.x<ut.x||Nt.x===ut.x&&Nt.y<ut.y)&&(ut=Nt),Nt=Nt.next,Nt!==zt;);return ut}(et));for(mt.sort(VEe),Ve=0;Ve<mt.length;Ve++)de=function(zt,Nt){var ut=function(kt,vt){var pt,tt=vt,Gt=kt.x,jt=kt.y,Wt=-1/0;do if(jt<=tt.y&&jt>=tt.next.y&&tt.next.y!==tt.y){var Sn=tt.x+(jt-tt.y)*(tt.next.x-tt.x)/(tt.next.y-tt.y);if(Sn<=Gt&&Wt<Sn&&(Wt=Sn,pt=tt.x<tt.next.x?tt:tt.next,Sn===Gt))return pt}while(tt=tt.next,tt!==vt);if(!pt)return null;var $n,An=pt,pr=pt.x,mn=pt.y,kn=1/0;for(tt=pt;Gt>=tt.x&&tt.x>=pr&&Gt!==tt.x&&py(jt<mn?Gt:Wt,jt,pr,mn,jt<mn?Wt:Gt,jt,tt.x,tt.y)&&($n=Math.abs(jt-tt.y)/(Gt-tt.x),hb(tt,kt))&&($n<kn||$n===kn&&(tt.x>pt.x||tt.x===pt.x&&function(cr,Lr){return zi(cr.prev,cr,Lr.prev)<0&&zi(Lr.next,cr,cr.next)<0}(pt,tt)))&&(pt=tt,kn=$n),tt=tt.next,tt!==An;);return pt}(zt,Nt);return ut?(_p(zt=O9(ut,zt),zt.next),_p(ut,ut.next)):Nt}(mt[Ve],de);return de}(u,c,k,d)),u.length>80*d){for(var W=m=u[0],re=b=u[1],ie=d;ie<O;ie+=d)(E=u[ie])<W&&(W=E),(S=u[ie+1])<re&&(re=S),m<E&&(m=E),b<S&&(b=S);A=(A=Math.max(m-W,b-re))!==0?32767/A:0}ub(k,U,d,W,re,A,0)}return U}function R9(u,c,d,m,b){var E,S;if(b===0<DR(u,c,d,m))for(E=c;E<d;E+=m)S=L9(E,u[E],u[E+1],S);else for(E=d-m;c<=E;E-=m)S=L9(E,u[E],u[E+1],S);return S&&wT(S,S.next)&&(db(S),S=S.next),S}function _p(u,c){if(!u)return u;c=c||u;var d,m=u;do if(d=!1,m.steiner||!wT(m,m.next)&&zi(m.prev,m,m.next)!==0)m=m.next;else{if(db(m),(m=c=m.prev)===m.next)break;d=!0}while(d||m!==c);return c}function ub(u,c,d,m,b,E,S){if(u){if(!S&&E){for(var A=u,I=m,O=b,k=E,U=A;U.z===0&&(U.z=LR(U.x,U.y,I,O,k)),U.prevZ=U.prev,U.nextZ=U.next,(U=U.next)!==A;);U.prevZ.nextZ=null,U.prevZ=null;var W,re,ie,fe,we,de,Me,Ve,$e=U,Ye=1;do for(re=$e,we=$e=null,de=0;re;){for(de++,ie=re,W=Me=0;W<Ye&&(Me++,ie=ie.nextZ);W++);for(Ve=Ye;0<Me||0<Ve&&ie;)Me!==0&&(Ve===0||!ie||re.z<=ie.z)?(re=(fe=re).nextZ,Me--):(ie=(fe=ie).nextZ,Ve--),we?we.nextZ=fe:$e=fe,fe.prevZ=we,we=fe;re=ie}while(we.nextZ=null,Ye*=2,1<de)}for(var et,mt,zt=u;u.prev!==u.next;)if(et=u.prev,mt=u.next,E?function(Nt,ut,kt,vt){var pt=Nt.prev,tt=Nt,Gt=Nt.next;if(!(0<=zi(pt,tt,Gt))){for(var jt=pt.x,Wt=tt.x,Sn=Gt.x,$n=pt.y,An=tt.y,pr=Gt.y,mn=jt<Wt?jt<Sn?jt:Sn:Wt<Sn?Wt:Sn,kn=$n<An?$n<pr?$n:pr:An<pr?An:pr,cr=Wt<jt?Sn<jt?jt:Sn:Sn<Wt?Wt:Sn,Lr=An<$n?pr<$n?$n:pr:pr<An?An:pr,Bs=LR(mn,kn,ut,kt,vt),_a=LR(cr,Lr,ut,kt,vt),lr=Nt.prevZ,nr=Nt.nextZ;lr&&lr.z>=Bs&&nr&&nr.z<=_a;){if(lr.x>=mn&&lr.x<=cr&&lr.y>=kn&&lr.y<=Lr&&lr!==pt&&lr!==Gt&&py(jt,$n,Wt,An,Sn,pr,lr.x,lr.y)&&0<=zi(lr.prev,lr,lr.next)||(lr=lr.prevZ,nr.x>=mn&&nr.x<=cr&&nr.y>=kn&&nr.y<=Lr&&nr!==pt&&nr!==Gt&&py(jt,$n,Wt,An,Sn,pr,nr.x,nr.y)&&0<=zi(nr.prev,nr,nr.next)))return;nr=nr.nextZ}for(;lr&&lr.z>=Bs;){if(lr.x>=mn&&lr.x<=cr&&lr.y>=kn&&lr.y<=Lr&&lr!==pt&&lr!==Gt&&py(jt,$n,Wt,An,Sn,pr,lr.x,lr.y)&&0<=zi(lr.prev,lr,lr.next))return;lr=lr.prevZ}for(;nr&&nr.z<=_a;){if(nr.x>=mn&&nr.x<=cr&&nr.y>=kn&&nr.y<=Lr&&nr!==pt&&nr!==Gt&&py(jt,$n,Wt,An,Sn,pr,nr.x,nr.y)&&0<=zi(nr.prev,nr,nr.next))return;nr=nr.nextZ}return 1}}(u,m,b,E):function(vt){var ut=vt.prev,kt=vt,vt=vt.next;if(!(0<=zi(ut,kt,vt))){for(var pt=ut.x,tt=kt.x,Gt=vt.x,jt=ut.y,Wt=kt.y,Sn=vt.y,$n=pt<tt?pt<Gt?pt:Gt:tt<Gt?tt:Gt,An=jt<Wt?jt<Sn?jt:Sn:Wt<Sn?Wt:Sn,pr=tt<pt?Gt<pt?pt:Gt:Gt<tt?tt:Gt,mn=Wt<jt?Sn<jt?jt:Sn:Sn<Wt?Wt:Sn,kn=vt.next;kn!==ut;){if(kn.x>=$n&&kn.x<=pr&&kn.y>=An&&kn.y<=mn&&py(pt,jt,tt,Wt,Gt,Sn,kn.x,kn.y)&&0<=zi(kn.prev,kn,kn.next))return;kn=kn.next}return 1}}(u))c.push(et.i/d|0),c.push(u.i/d|0),c.push(mt.i/d|0),db(u),u=mt.next,zt=mt.next;else if((u=mt)===zt){S?S===1?ub(u=function(Nt,ut,kt){var vt=Nt;do var pt=vt.prev,tt=vt.next.next;while(!wT(pt,tt)&&k9(pt,vt,vt.next,tt)&&hb(pt,tt)&&hb(tt,pt)&&(ut.push(pt.i/kt|0),ut.push(vt.i/kt|0),ut.push(tt.i/kt|0),db(vt),db(vt.next),vt=Nt=tt),vt=vt.next,vt!==Nt);return _p(vt)}(_p(u),c,d),c,d,m,b,E,2):S===2&&function(Nt,ut,kt,vt,pt,tt){var Gt=Nt;do for(var jt,Wt=Gt.next.next;Wt!==Gt.prev;){if(Gt.i!==Wt.i&&function(Sn,$n){return Sn.next.i!==$n.i&&Sn.prev.i!==$n.i&&!function(An,pr){var mn=An;do if(mn.i!==An.i&&mn.next.i!==An.i&&mn.i!==pr.i&&mn.next.i!==pr.i&&k9(mn,mn.next,An,pr))return 1;while(mn=mn.next,mn!==An)}(Sn,$n)&&(hb(Sn,$n)&&hb($n,Sn)&&function(An,pr){for(var mn=An,kn=!1,cr=(An.x+pr.x)/2,Lr=(An.y+pr.y)/2;mn.y>Lr!=mn.next.y>Lr&&mn.next.y!==mn.y&&cr<(mn.next.x-mn.x)*(Lr-mn.y)/(mn.next.y-mn.y)+mn.x&&(kn=!kn),mn=mn.next,mn!==An;);return kn}(Sn,$n)&&(zi(Sn.prev,Sn,$n.prev)||zi(Sn,$n.prev,$n))||wT(Sn,$n)&&0<zi(Sn.prev,Sn,Sn.next)&&0<zi($n.prev,$n,$n.next))}(Gt,Wt))return jt=O9(Gt,Wt),Gt=_p(Gt,Gt.next),jt=_p(jt,jt.next),ub(Gt,ut,kt,vt,pt,tt,0),ub(jt,ut,kt,vt,pt,tt,0);Wt=Wt.next}while(Gt=Gt.next,Gt!==Nt)}(u,c,d,m,b,E):ub(_p(u),c,d,m,b,E,1);break}}}function VEe(u,c){return u.x-c.x}function LR(u,c,d,m,b){return(u=1431655765&((u=858993459&((u=252645135&((u=16711935&((u=(u-d)*b|0)|u<<8))|u<<4))|u<<2))|u<<1))|(c=1431655765&((c=858993459&((c=252645135&((c=16711935&((c=(c-m)*b|0)|c<<8))|c<<4))|c<<2))|c<<1))<<1}function py(u,c,d,m,b,E,S,A){return(u-S)*(E-A)<=(b-S)*(c-A)&&(d-S)*(c-A)<=(u-S)*(m-A)&&(b-S)*(m-A)<=(d-S)*(E-A)}function zi(u,c,d){return(c.y-u.y)*(d.x-c.x)-(c.x-u.x)*(d.y-c.y)}function wT(u,c){return u.x===c.x&&u.y===c.y}function k9(u,c,d,m){var b=ET(zi(u,c,d)),E=ET(zi(u,c,m)),S=ET(zi(d,m,u)),A=ET(zi(d,m,c));return b!==E&&S!==A||b===0&&xT(u,d,c)||E===0&&xT(u,m,c)||S===0&&xT(d,u,m)||!(A!==0||!xT(d,c,m))}function xT(u,c,d){return c.x<=Math.max(u.x,d.x)&&c.x>=Math.min(u.x,d.x)&&c.y<=Math.max(u.y,d.y)&&c.y>=Math.min(u.y,d.y)}function ET(u){return 0<u?1:u<0?-1:0}function hb(u,c){return zi(u.prev,u,u.next)<0?0<=zi(u,c,u.next)&&0<=zi(u,u.prev,c):zi(u,c,u.prev)<0||zi(u,u.next,c)<0}function O9(u,c){var d=new NR(u.i,u.x,u.y),m=new NR(c.i,c.x,c.y),b=u.next,E=c.prev;return(u.next=c).prev=u,(d.next=b).prev=d,(m.next=d).prev=m,(E.next=m).prev=E,m}function L9(u,c,d,m){return u=new NR(u,c,d),m?(u.next=m.next,(u.prev=m).next.prev=u,m.next=u):(u.prev=u).next=u,u}function db(u){u.next.prev=u.prev,u.prev.next=u.next,u.prevZ&&(u.prevZ.nextZ=u.nextZ),u.nextZ&&(u.nextZ.prevZ=u.prevZ)}function NR(u,c,d){this.i=u,this.x=c,this.y=d,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function DR(u,c,d,m){for(var b=0,E=c,S=d-m;E<d;E+=m)b+=(u[S]-u[E])*(u[E+1]+u[S+1]),S=E;return b}Rc.exports=OR,(Rc.exports.default=OR).deviation=function(u,c,d,m){var b=c&&c.length,E=b?c[0]*d:u.length,S=Math.abs(DR(u,0,E,d));if(b)for(var A=0,I=c.length;A<I;A++){var O=c[A]*d,k=A<I-1?c[A+1]*d:u.length;S-=Math.abs(DR(u,O,k,d))}for(var U=0,A=0;A<m.length;A+=3){var W=m[A]*d,re=m[A+1]*d,ie=m[A+2]*d;U+=Math.abs((u[W]-u[ie])*(u[1+re]-u[1+W])-(u[W]-u[re])*(u[1+ie]-u[1+W]))}return S===0&&U===0?0:Math.abs((U-S)/S)},OR.flatten=function(u){for(var c=u[0][0].length,d={vertices:[],holes:[],dimensions:c},m=0,b=0;b<u.length;b++){for(var E=0;E<u[b].length;E++)for(var S=0;S<c;S++)d.vertices.push(u[b][E][S]);0<b&&(m+=u[b-1].length,d.holes.push(m))}return d};var N9=a(Rc.exports);function HEe(u,c,d,m,b){(function E(S,A,I,O,k){for(;I<O;){600<O-I&&(U=O-I+1,fe=A-I+1,re=Math.log(U),W=.5*Math.exp(2*re/3),re=.5*Math.sqrt(re*W*(U-W)/U)*(fe-U/2<0?-1:1),ie=Math.max(I,Math.floor(A-fe*W/U+re)),fe=Math.min(O,Math.floor(A+(U-fe)*W/U+re)),E(S,A,ie,fe,k));var U,W,re,ie,fe,we=S[A],de=I,Me=O;for(fb(S,I,A),0<k(S[O],we)&&fb(S,I,O);de<Me;){for(fb(S,de,Me),de++,Me--;k(S[de],we)<0;)de++;for(;0<k(S[Me],we);)Me--}k(S[I],we)===0?fb(S,I,Me):fb(S,++Me,O),Me<=A&&(I=Me+1),A<=Me&&(O=Me-1)}})(u,c,d||0,m||u.length-1,b||GEe)}function fb(u,c,d){var m=u[c];u[c]=u[d],u[d]=m}function GEe(u,c){return u<c?-1:c<u?1:0}function FR(u,c){var d=u.length;if(d<=1)return[u];var m=[];let b,E;for(let A=0;A<d;A++){var S=function(I){let O=0;for(let k=0,U=I.length,W=U-1,re,ie;k<U;W=k++)re=I[k],ie=I[W],O+=(ie.x-re.x)*(re.y+ie.y);return O}(u[A]);S!==0&&(u[A].area=Math.abs(S),(E=E===void 0?S<0:E)===S<0?(b&&m.push(b),b=[u[A]]):b.push(u[A]))}if(b&&m.push(b),1<c)for(let A=0;A<m.length;A++)m[A].length<=c||(HEe(m[A],c,1,m[A].length-1,qEe),m[A]=m[A].slice(0,c));return m}function qEe(u,c){return c.area-u.area}function BR(u,c,d){var m=d.patternDependencies;let b=!1;for(const S of c){var E=S.paint.get(u+"-pattern"),E=(E.isConstant()||(b=!0),E.constantOr(null));E&&(b=!0,m[E.to]=!0,m[E.from]=!0)}return b}function UR(u,c,d,m,b){var E=b.patternDependencies;for(const O of c){var S,A,I=O.paint.get(u+"-pattern").value;I.kind!=="constant"&&(S=I.evaluate({zoom:m-1},d,{},b.availableImages),A=I.evaluate({zoom:m},d,{},b.availableImages),I=I.evaluate({zoom:m+1},d,{},b.availableImages),S=S&&S.name?S.name:S,A=A&&A.name?A.name:A,I=I&&I.name?I.name:I,E[S]=!0,E[A]=!0,E[I]=!0,d.patterns[O.id]={min:S,mid:A,max:I})}return d}class zR{constructor(c){this.zoom=c.zoom,this.overscaling=c.overscaling,this.layers=c.layers,this.layerIds=this.layers.map(d=>d.id),this.index=c.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new IR,this.indexArray=new hd,this.indexArray2=new fy,this.programConfigurations=new Qe(c.layers,c.zoom),this.segments=new w,this.segments2=new w,this.stateDependentLayerIds=this.layers.filter(d=>d.isStateDependent()).map(d=>d.id)}populate(c,d,m){this.hasPattern=BR("fill",this.layers,d);var b,E,S,A,I=this.layers[0].layout.get("fill-sort-key"),O=!I.isConstant(),k=[];for({feature:b,id:E,index:S,sourceLayerIndex:A}of c){var U,W=this.layers[0]._featureFilter.needGeometry,re=Yt(b,W);this.layers[0]._featureFilter.filter(new zr(this.zoom),re,m)&&(U=O?I.evaluate(re,{},m,d.availableImages):void 0,W={id:E,properties:b.properties,type:b.type,sourceLayerIndex:A,index:S,geometry:W?re.geometry:Dt(b),patterns:{},sortKey:U},k.push(W))}O&&k.sort((Me,Ve)=>Me.sortKey-Ve.sortKey);for(const Me of k){var{geometry:ie,index:fe,sourceLayerIndex:we}=Me,de=(this.hasPattern?(de=UR("fill",this.layers,Me,this.zoom,d),this.patternFeatures.push(de)):this.addFeature(Me,ie,fe,m,{}),c[fe].feature);d.featureIndex.insert(de,ie,fe,we,this.index)}}update(c,d,m){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(c,d,this.stateDependentLayers,m)}addFeatures(c,d,m){for(const b of this.patternFeatures)this.addFeature(b,b.geometry,b.index,d,m)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(c){this.uploaded||(this.layoutVertexBuffer=c.createVertexBuffer(this.layoutVertexArray,jEe),this.indexBuffer=c.createIndexBuffer(this.indexArray),this.indexBuffer2=c.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(c),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(c,d,m,b,E){for(const re of FR(d,500)){let ie=0;for(const fe of re)ie+=fe.length;var S=this.segments.prepareSegment(ie,this.layoutVertexArray,this.indexArray),A=S.vertexLength,I=[],O=[];for(const fe of re)if(fe.length!==0){fe!==re[0]&&O.push(I.length/2);var k=this.segments2.prepareSegment(fe.length,this.layoutVertexArray,this.indexArray2),U=k.vertexLength;this.layoutVertexArray.emplaceBack(fe[0].x,fe[0].y),this.indexArray2.emplaceBack(U+fe.length-1,U),I.push(fe[0].x),I.push(fe[0].y);for(let we=1;we<fe.length;we++)this.layoutVertexArray.emplaceBack(fe[we].x,fe[we].y),this.indexArray2.emplaceBack(U+we-1,U+we),I.push(fe[we].x),I.push(fe[we].y);k.vertexLength+=fe.length,k.primitiveLength+=fe.length}var W=N9(I,O);for(let fe=0;fe<W.length;fe+=3)this.indexArray.emplaceBack(A+W[fe],A+W[fe+1],A+W[fe+2]);S.vertexLength+=ie,S.primitiveLength+=W.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,c,m,E,b)}}Ht("FillBucket",zR,{omit:["layers","patternFeatures"]});let D9,F9;var $Ee={get paint(){return F9=F9||new ta({"fill-antialias":new sn(q.paint_fill["fill-antialias"]),"fill-opacity":new xn(q.paint_fill["fill-opacity"]),"fill-color":new xn(q.paint_fill["fill-color"]),"fill-outline-color":new xn(q.paint_fill["fill-outline-color"]),"fill-translate":new sn(q.paint_fill["fill-translate"]),"fill-translate-anchor":new sn(q.paint_fill["fill-translate-anchor"]),"fill-pattern":new Nu(q.paint_fill["fill-pattern"])})},get layout(){return D9=D9||new ta({"fill-sort-key":new xn(q.layout_fill["fill-sort-key"])})}};class WEe extends cs{constructor(c){super(c,$Ee)}recalculate(c,d){super.recalculate(c,d),c=this.paint._values["fill-outline-color"],c.value.kind==="constant"&&c.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(c){return new zR(c)}queryRadius(){return sr(this.paint.get("fill-translate"))}queryIntersectsFeature(c,d,m,b,E,S,A){return cn(Er(c,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),S.angle,A),b)}isTileClipped(){return!0}}ao=Bi([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4);const YEe=Bi([{name:"a_centroid",components:2,type:"Int16"}],4),KEe=ao.members;var pd={},ZEe=l,ls=gy;function gy(u,c,d,m,b){this.properties={},this.extent=d,this.type=0,this._pbf=u,this._geometry=-1,this._keys=m,this._values=b,u.readFields(XEe,this,c)}function XEe(u,c,d){if(u==1)c.id=d.readVarint();else if(u==2)for(var m=d,b=c,E=m.readVarint()+m.pos;m.pos<E;){var S=b._keys[m.readVarint()],A=b._values[m.readVarint()];b.properties[S]=A}else u==3?c.type=d.readVarint():u==4&&(c._geometry=d.pos)}gy.types=["Unknown","Point","LineString","Polygon"],gy.prototype.loadGeometry=function(){for(var u,c,d=this._pbf,m=(d.pos=this._geometry,d.readVarint()+d.pos),b=1,E=0,S=0,A=0,I=[];d.pos<m;)if(E<=0&&(b=7&(c=d.readVarint()),E=c>>3),E--,b===1||b===2)S+=d.readSVarint(),A+=d.readSVarint(),b===1&&(u&&I.push(u),u=[]),u.push(new ZEe(S,A));else{if(b!==7)throw new Error("unknown command "+b);u&&u.push(u[0].clone())}return u&&I.push(u),I},gy.prototype.bbox=function(){for(var u,c=this._pbf,d=(c.pos=this._geometry,c.readVarint()+c.pos),m=1,b=0,E=0,S=0,A=1/0,I=-1/0,O=1/0,k=-1/0;c.pos<d;)if(b<=0&&(m=7&(u=c.readVarint()),b=u>>3),b--,m===1||m===2)(E+=c.readSVarint())<A&&(A=E),I<E&&(I=E),(S+=c.readSVarint())<O&&(O=S),k<S&&(k=S);else if(m!==7)throw new Error("unknown command "+m);return[A,O,I,k]},gy.prototype.toGeoJSON=function(u,c,I){var m,b=this.extent*Math.pow(2,I),E=this.extent*u,S=this.extent*c,A=this.loadGeometry(),I=gy.types[this.type];function O(W){for(var re=0;re<W.length;re++){var ie=W[re],fe=180-360*(ie.y+S)/b;W[re]=[360*(ie.x+E)/b-180,360/Math.PI*Math.atan(Math.exp(fe*Math.PI/180))-90]}}switch(this.type){case 1:for(var k=[],U=0;U<A.length;U++)k[U]=A[U][0];O(A=k);break;case 2:for(U=0;U<A.length;U++)O(A[U]);break;case 3:for(A=function(W){var re=W.length;if(re<=1)return[W];for(var ie,fe,we=[],de=0;de<re;de++){var Me=function(Ve){for(var $e,Ye,et=0,mt=0,zt=Ve.length,Nt=zt-1;mt<zt;Nt=mt++)$e=Ve[mt],Ye=Ve[Nt],et+=(Ye.x-$e.x)*($e.y+Ye.y);return et}(W[de]);Me!==0&&((fe=fe===void 0?Me<0:fe)===Me<0?(ie&&we.push(ie),ie=[W[de]]):ie.push(W[de]))}return ie&&we.push(ie),we}(A),U=0;U<A.length;U++)for(m=0;m<A[U].length;m++)O(A[U][m])}return A.length===1?A=A[0]:I="Multi"+I,u={type:"Feature",geometry:{type:I,coordinates:A},properties:this.properties},"id"in this&&(u.id=this.id),u};var QEe=ls,Or=B9;function B9(u,c){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=u,this._keys=[],this._values=[],this._features=[],u.readFields(JEe,this,c),this.length=this._features.length}function JEe(u,c,d){u===15?c.version=d.readVarint():u===1?c.name=d.readString():u===5?c.extent=d.readVarint():u===2?c._features.push(d.pos):u===3?c._keys.push(d.readString()):u===4&&c._values.push(function(m){for(var b=null,E=m.readVarint()+m.pos;m.pos<E;){var S=m.readVarint()>>3;b=S==1?m.readString():S==2?m.readFloat():S==3?m.readDouble():S==4?m.readVarint64():S==5?m.readVarint():S==6?m.readSVarint():S==7?m.readBoolean():null}return b}(d))}B9.prototype.feature=function(u){if(u<0||u>=this._features.length)throw new Error("feature index out of bounds");return this._pbf.pos=this._features[u],u=this._pbf.readVarint()+this._pbf.pos,new QEe(this._pbf,u,this.extent,this._keys,this._values)};var eTe=Or;function tTe(u,c,d){u===3&&(u=new eTe(d,d.readVarint()+d.pos)).length&&(c[u.name]=u)}pd.VectorTile=function(u,c){this.layers=u.readFields(tTe,{},c)},pd.VectorTileFeature=ls,pd.VectorTileLayer=Or;const nTe=pd.VectorTileFeature.types,jR=Math.pow(2,13);function pb(u,c,d,m,b,E,S,A){u.emplaceBack(c,d,2*Math.floor(m*jR)+S,b*jR*2,E*jR*2,Math.round(A))}class VR{constructor(c){this.zoom=c.zoom,this.overscaling=c.overscaling,this.layers=c.layers,this.layerIds=this.layers.map(d=>d.id),this.index=c.index,this.hasPattern=!1,this.layoutVertexArray=new hy,this.centroidVertexArray=new ab,this.indexArray=new hd,this.programConfigurations=new Qe(c.layers,c.zoom),this.segments=new w,this.stateDependentLayerIds=this.layers.filter(d=>d.isStateDependent()).map(d=>d.id)}populate(c,d,m){this.features=[],this.hasPattern=BR("fill-extrusion",this.layers,d);for(var{feature:b,id:E,index:S,sourceLayerIndex:A}of c){var I=this.layers[0]._featureFilter.needGeometry,O=Yt(b,I);this.layers[0]._featureFilter.filter(new zr(this.zoom),O,m)&&(E={id:E,sourceLayerIndex:A,index:S,geometry:I?O.geometry:Dt(b),properties:b.properties,type:b.type,patterns:{}},this.hasPattern?this.features.push(UR("fill-extrusion",this.layers,E,this.zoom,d)):this.addFeature(E,E.geometry,S,m,{}),d.featureIndex.insert(b,E.geometry,S,A,this.index,!0))}}addFeatures(c,d,m){for(const E of this.features){var b=E.geometry;this.addFeature(E,b,E.index,d,m)}}update(c,d,m){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(c,d,this.stateDependentLayers,m)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(c){this.uploaded||(this.layoutVertexBuffer=c.createVertexBuffer(this.layoutVertexArray,KEe),this.centroidVertexBuffer=c.createVertexBuffer(this.centroidVertexArray,YEe.members,!0),this.indexBuffer=c.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(c),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(c,d,m,b,E){var S={x:0,y:0,vertexCount:0};for(const we of FR(d,500)){let de=0;for(const Ve of we)de+=Ve.length;let Me=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(const Ve of we)if(Ve.length!==0&&!iTe(Ve)){let $e=0;for(let Ye=0;Ye<Ve.length;Ye++){var A,I,O,k=Ve[Ye];1<=Ye&&(rTe(k,A=Ve[Ye-1])||(Me.vertexLength+4>w.MAX_VERTEX_ARRAY_LENGTH&&(Me=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray)),I=k.sub(A)._perp()._unit(),O=A.dist(k),32768<$e+O&&($e=0),pb(this.layoutVertexArray,k.x,k.y,I.x,I.y,0,0,$e),pb(this.layoutVertexArray,k.x,k.y,I.x,I.y,0,1,$e),S.x+=2*k.x,S.y+=2*k.y,S.vertexCount+=2,$e+=O,pb(this.layoutVertexArray,A.x,A.y,I.x,I.y,0,0,$e),pb(this.layoutVertexArray,A.x,A.y,I.x,I.y,0,1,$e),S.x+=2*A.x,S.y+=2*A.y,S.vertexCount+=2,k=Me.vertexLength,this.indexArray.emplaceBack(k,k+2,k+1),this.indexArray.emplaceBack(k+1,k+2,k+3),Me.vertexLength+=4,Me.primitiveLength+=2))}}if(Me.vertexLength+de>w.MAX_VERTEX_ARRAY_LENGTH&&(Me=this.segments.prepareSegment(de,this.layoutVertexArray,this.indexArray)),nTe[c.type]==="Polygon"){var U=[],W=[],re=Me.vertexLength;for(const Ve of we)if(Ve.length!==0){Ve!==we[0]&&W.push(U.length/2);for(let $e=0;$e<Ve.length;$e++){var ie=Ve[$e];pb(this.layoutVertexArray,ie.x,ie.y,0,0,1,1,0),S.x+=ie.x,S.y+=ie.y,S.vertexCount+=1,U.push(ie.x),U.push(ie.y)}}var fe=N9(U,W);for(let Ve=0;Ve<fe.length;Ve+=3)this.indexArray.emplaceBack(re+fe[Ve],re+fe[Ve+2],re+fe[Ve+1]);Me.primitiveLength+=fe.length/3,Me.vertexLength+=de}}for(let we=0;we<S.vertexCount;we++)this.centroidVertexArray.emplaceBack(Math.floor(S.x/S.vertexCount),Math.floor(S.y/S.vertexCount));this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,c,m,E,b)}}function rTe(u,c){return u.x===c.x&&(u.x<0||u.x>ct)||u.y===c.y&&(u.y<0||u.y>ct)}function iTe(u){return u.every(c=>c.x<0)||u.every(c=>c.x>ct)||u.every(c=>c.y<0)||u.every(c=>c.y>ct)}Ht("FillExtrusionBucket",VR,{omit:["layers","features"]});let U9;var oTe={get paint(){return U9=U9||new ta({"fill-extrusion-opacity":new sn(q["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new xn(q["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new sn(q["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new sn(q["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Nu(q["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new xn(q["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new xn(q["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new sn(q["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class aTe extends cs{constructor(c){super(c,oTe)}createBucket(c){return new VR(c)}queryRadius(){return sr(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(c,d,m,b,E,S,A,I){return c=Er(c,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),S.angle,A),A=this.paint.get("fill-extrusion-height").evaluate(d,m),d=this.paint.get("fill-extrusion-base").evaluate(d,m),m=lTe(c,I,0,0),c=cTe(b,d,A,I),sTe(c[0],c[1],m)}}function gb(u,c){return u.x*c.x+u.y*c.y}function z9(u,c){if(u.length===1){let k=0;var d=c[k++];let U;for(;!U||d.equals(U);)if(!(U=c[k++]))return 1/0;for(;k<c.length;k++){var m=c[k],O=u[0],E=U.sub(d),S=m.sub(d),O=O.sub(d),I=gb(E,E),b=gb(E,S),A=gb(S,S),E=gb(O,E),O=gb(O,S),S=I*A-b*b,A=(A*E-b*O)/S,I=(I*O-b*E)/S,O=d.z*(1-A-I)+U.z*A+m.z*I;if(isFinite(O))return O}return 1/0}{let k=1/0;for(const U of c)k=Math.min(k,U.z);return k}}function sTe(u,c,d){let m=1/0;cn(d,c)&&(m=z9(d,c[0]));for(let O=0;O<c.length;O++){var b=c[O],E=u[O];for(let k=0;k<b.length-1;k++){var S=b[k],I=b[k+1],A=E[k],I=[S,I,E[k+1],A,S];Zt(d,I)&&(m=Math.min(m,z9(d,I)))}}return m!==1/0&&m}function cTe(u,c,d,m){var b=[],E=[],S=m[8]*c,A=m[9]*c,I=m[10]*c,O=m[11]*c,k=m[8]*d,U=m[9]*d,W=m[10]*d,re=m[11]*d;for(const zt of u){var ie=[],fe=[];for(const Nt of zt){var Ye=Nt.x,we=Nt.y,et=m[0]*Ye+m[4]*we+m[12],mt=m[1]*Ye+m[5]*we+m[13],$e=m[2]*Ye+m[6]*we+m[14],Ye=m[3]*Ye+m[7]*we+m[15],we=$e+I,de=Ye+O,Me=et+k,Ve=mt+U,$e=$e+W,Ye=Ye+re,et=new p((et+S)/de,(mt+A)/de),mt=(et.z=we/de,ie.push(et),new p(Me/Ye,Ve/Ye));mt.z=$e/Ye,fe.push(mt)}b.push(ie),E.push(fe)}return[b,E]}function lTe(u,c,d,m){var b=[];for(const S of u){var E=[S.x,S.y,m,1];ac(E,E,c),b.push(new p(E[0]/E[3],E[1]/E[3]))}return b}const uTe=Bi([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4).members,hTe=Bi([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]).members,dTe=pd.VectorTileFeature.types,fTe=Math.cos(Math.PI/180*37.5),j9=Math.pow(2,14)/.5;class HR{constructor(c){this.zoom=c.zoom,this.overscaling=c.overscaling,this.layers=c.layers,this.layerIds=this.layers.map(d=>d.id),this.index=c.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(d=>{this.gradients[d.id]={}}),this.layoutVertexArray=new dy,this.layoutVertexArray2=new PR,this.indexArray=new hd,this.programConfigurations=new Qe(c.layers,c.zoom),this.segments=new w,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(d=>d.isStateDependent()).map(d=>d.id)}populate(c,d,m){this.hasPattern=BR("line",this.layers,d);var b,E,S,A,I=this.layers[0].layout.get("line-sort-key"),O=!I.isConstant(),k=[];for({feature:b,id:E,index:S,sourceLayerIndex:A}of c){var U,W=this.layers[0]._featureFilter.needGeometry,re=Yt(b,W);this.layers[0]._featureFilter.filter(new zr(this.zoom),re,m)&&(U=O?I.evaluate(re,{},m):void 0,W={id:E,properties:b.properties,type:b.type,sourceLayerIndex:A,index:S,geometry:W?re.geometry:Dt(b),patterns:{},sortKey:U},k.push(W))}O&&k.sort((Me,Ve)=>Me.sortKey-Ve.sortKey);for(const Me of k){var{geometry:ie,index:fe,sourceLayerIndex:we}=Me,de=(this.hasPattern?(de=UR("line",this.layers,Me,this.zoom,d),this.patternFeatures.push(de)):this.addFeature(Me,ie,fe,m,{}),c[fe].feature);d.featureIndex.insert(de,ie,fe,we,this.index)}}update(c,d,m){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(c,d,this.stateDependentLayers,m)}addFeatures(c,d,m){for(const b of this.patternFeatures)this.addFeature(b,b.geometry,b.index,d,m)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(c){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=c.createVertexBuffer(this.layoutVertexArray2,hTe)),this.layoutVertexBuffer=c.createVertexBuffer(this.layoutVertexArray,uTe),this.indexBuffer=c.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(c),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(c){if(c.properties&&Object.prototype.hasOwnProperty.call(c.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(c.properties,"mapbox_clip_end"))return{start:+c.properties.mapbox_clip_start,end:+c.properties.mapbox_clip_end}}addFeature(c,d,m,b,E){var S=this.layers[0].layout,A=S.get("line-join").evaluate(c,{}),I=S.get("line-cap"),O=S.get("line-miter-limit"),k=S.get("line-round-limit");this.lineClips=this.lineFeatureClips(c);for(const U of d)this.addLine(U,c,A,I,O,k);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,c,m,E,b)}addLine(c,d,m,b,E,S){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let mt=0;mt<c.length-1;mt++)this.totalDistance+=c[mt].dist(c[mt+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}var A=dTe[d.type]==="Polygon";let I=c.length;for(;2<=I&&c[I-1].equals(c[I-2]);)I--;let O=0;for(;O<I-1&&c[O].equals(c[O+1]);)O++;if(!(I<(A?3:2))){m==="bevel"&&(E=1.05);var k,U=this.overscaling<=16?15*ct/(512*this.overscaling):0,W=this.segments.prepareSegment(10*I,this.layoutVertexArray,this.indexArray);let mt,zt,Nt,ut;this.e1=this.e2=-1,A&&(mt=c[I-2],ut=c[O].sub(mt)._unit()._perp());for(let kt=O;kt<I;kt++)if(!(k=kt===I-1?A?c[O+1]:void 0:c[kt+1])||!c[kt].equals(k)){ut&&(Nt=ut),mt&&(zt=mt),mt=c[kt],ut=k?k.sub(mt)._unit()._perp():Nt;let vt=(Nt=Nt||ut).add(ut);vt.x===0&&vt.y===0||vt._unit();var re=Nt.x*ut.x+Nt.y*ut.y,we=vt.x*ut.x+vt.y*ut.y,ie=we!=0?1/we:1/0,fe=2*Math.sqrt(2-2*we),we=we<fTe&&zt&&k,de=0<Nt.x*ut.y-Nt.y*ut.x,Me=(we&&kt>O&&2*U<(Me=mt.dist(zt))&&(Me=mt.sub(mt.sub(zt)._mult(U/Me)._round()),this.updateDistance(zt,Me),this.addCurrentVertex(Me,Nt,0,0,W),zt=Me),zt&&k);let pt=Me?m:A?"butt":b;if(Me&&pt==="round"&&(ie<S?pt="miter":ie<=2&&(pt="fakeround")),(pt=pt==="miter"&&E<ie?"bevel":pt)==="bevel"&&(2<ie&&(pt="flipbevel"),ie<E)&&(pt="miter"),zt&&this.updateDistance(zt,mt),pt==="miter")vt._mult(ie),this.addCurrentVertex(mt,vt,0,0,W);else if(pt==="flipbevel")100<ie?vt=ut.mult(-1):(Ve=ie*Nt.add(ut).mag()/Nt.sub(ut).mag(),vt._perp()._mult(Ve*(de?-1:1))),this.addCurrentVertex(mt,vt,0,0,W),this.addCurrentVertex(mt,vt.mult(-1),0,0,W);else if(pt==="bevel"||pt==="fakeround"){var Ve=-Math.sqrt(ie*ie-1),ie=de?Ve:0,$e=de?0:Ve;if(zt&&this.addCurrentVertex(mt,Nt,ie,$e,W),pt==="fakeround"){var Ye=Math.round(180*fe/Math.PI/20);for(let Gt=1;Gt<Ye;Gt++){let jt=Gt/Ye;jt!==.5&&(et=jt-.5,jt+=jt*et*(jt-1)*((1.0904+re*(re*(3.55645-1.43519*re)-3.2452))*et*et+(.848013+re*(.215638*re-1.06021))));var et=ut.sub(Nt)._mult(jt)._add(Nt)._unit()._mult(de?-1:1);this.addHalfVertex(mt,et.x,et.y,!1,de,0,W)}}k&&this.addCurrentVertex(mt,ut,-ie,-$e,W)}else pt==="butt"?this.addCurrentVertex(mt,vt,0,0,W):pt==="square"?(fe=zt?1:-1,this.addCurrentVertex(mt,vt,fe,fe,W)):pt==="round"&&(zt&&(this.addCurrentVertex(mt,Nt,0,0,W),this.addCurrentVertex(mt,Nt,1,1,W,!0)),k)&&(this.addCurrentVertex(mt,ut,-1,-1,W,!0),this.addCurrentVertex(mt,ut,0,0,W));we&&kt<I-1&&2*U<(ie=mt.dist(k))&&($e=mt.add(k.sub(mt)._mult(U/ie)._round()),this.updateDistance(mt,$e),this.addCurrentVertex($e,ut,0,0,W),mt=$e)}}}addCurrentVertex(c,d,m,b,E,S=!1){var A=d.x+d.y*m,I=d.y-d.x*m,O=-d.x+d.y*b,k=-d.y-d.x*b;this.addHalfVertex(c,A,I,S,!1,m,E),this.addHalfVertex(c,O,k,S,!0,-b,E),this.distance>j9/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(c,d,m,b,E,S))}addHalfVertex({x:c,y:k},m,b,E,S,A,I){var O=.5*(this.lineClips?this.scaledDistance*(j9-1):this.scaledDistance),k=(this.layoutVertexArray.emplaceBack((c<<1)+(E?1:0),(k<<1)+(S?1:0),Math.round(63*m)+128,Math.round(63*b)+128,1+(A===0?0:A<0?-1:1)|(63&O)<<2,O>>6),this.lineClips&&(c=this.scaledDistance-this.lineClips.start,E=this.lineClips.end-this.lineClips.start,this.layoutVertexArray2.emplaceBack(c/E,this.lineClipsArray.length)),I.vertexLength++);0<=this.e1&&0<=this.e2&&(this.indexArray.emplaceBack(this.e1,this.e2,k),I.primitiveLength++),S?this.e2=k:this.e1=k}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(c,d){this.distance+=c.dist(d),this.updateScaledDistance()}}Ht("LineBucket",HR,{omit:["layers","patternFeatures"]});let V9,H9;var G9={get paint(){return H9=H9||new ta({"line-opacity":new xn(q.paint_line["line-opacity"]),"line-color":new xn(q.paint_line["line-color"]),"line-translate":new sn(q.paint_line["line-translate"]),"line-translate-anchor":new sn(q.paint_line["line-translate-anchor"]),"line-width":new xn(q.paint_line["line-width"]),"line-gap-width":new xn(q.paint_line["line-gap-width"]),"line-offset":new xn(q.paint_line["line-offset"]),"line-blur":new xn(q.paint_line["line-blur"]),"line-dasharray":new ny(q.paint_line["line-dasharray"]),"line-pattern":new Nu(q.paint_line["line-pattern"]),"line-gradient":new ry(q.paint_line["line-gradient"])})},get layout(){return V9=V9||new ta({"line-cap":new sn(q.layout_line["line-cap"]),"line-join":new xn(q.layout_line["line-join"]),"line-miter-limit":new sn(q.layout_line["line-miter-limit"]),"line-round-limit":new sn(q.layout_line["line-round-limit"]),"line-sort-key":new xn(q.layout_line["line-sort-key"])})}};class pTe extends xn{possiblyEvaluate(c,d){return d=new zr(Math.floor(d.zoom),{now:d.now,fadeDuration:d.fadeDuration,zoomHistory:d.zoomHistory,transition:d.transition}),super.possiblyEvaluate(c,d)}evaluate(c,d,m,b){return d=_e({},d,{zoom:Math.floor(d.zoom)}),super.evaluate(c,d,m,b)}}let GR;class gTe extends cs{constructor(c){super(c,G9),this.gradientVersion=0,GR||((GR=new pTe(G9.paint.properties["line-width"].specification)).useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(c){c==="line-gradient"&&(ur(c=this.gradientExpression())?this.stepInterpolant=c._styleExpression.expression instanceof Iu:this.stepInterpolant=!1,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER)}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(c,d){super.recalculate(c,d),this.paint._values["line-floorwidth"]=GR.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,c)}createBucket(c){return new HR(c)}queryRadius(m){var d=q9(kr("line-width",this,m),kr("line-gap-width",this,m)),m=kr("line-offset",this,m);return d/2+Math.abs(m)+sr(this.paint.get("line-translate"))}queryIntersectsFeature(c,d,m,b,E,S,A){return c=Er(c,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),S.angle,A),S=A/2*q9(this.paint.get("line-width").evaluate(d,m),this.paint.get("line-gap-width").evaluate(d,m)),d=this.paint.get("line-offset").evaluate(d,m),Cn(c,b=d?To(b,d*A):b,S)}isTileClipped(){return!0}}function q9(u,c){return 0<c?c+2*u:u}const mTe=Bi([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),yTe=Bi([{name:"a_projected_pos",components:3,type:"Float32"}],4),_Te=(Bi([{name:"a_fade_opacity",components:1,type:"Uint32"}],4),Bi([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}])),$9=(Bi([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]),Bi([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4));Rc=Bi([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function vTe(u,c,d){return u.sections.forEach(m=>{var b,E;m.text=(m=m.text,E=d,(b=(b=c).layout.get("text-transform").evaluate(E,{}))==="uppercase"?m=m.toLocaleUpperCase():b==="lowercase"&&(m=m.toLocaleLowerCase()),m=Lu.applyArabicShaping?Lu.applyArabicShaping(m):m)}),u}function bTe(u){const c={},d={},m=[];let b=0;function E(fe){m.push(u[fe]),b++}function S(fe,we,de){var Me=d[fe];return delete d[fe],d[we]=Me,m[Me].geometry[0].pop(),m[Me].geometry[0]=m[Me].geometry[0].concat(de[0]),Me}function A(fe,we,de){var Me=c[we];return delete c[we],c[fe]=Me,m[Me].geometry[0].shift(),m[Me].geometry[0]=de[0].concat(m[Me].geometry[0]),Me}function I(fe,we,de){return de=de?we[0][we[0].length-1]:we[0][0],`${fe}:${de.x}:`+de.y}for(let fe=0;fe<u.length;fe++){var O,k,U,W,ie=u[fe],re=ie.geometry,ie=ie.text?ie.text.toString():null;ie?(O=I(ie,re),k=I(ie,re,!0),O in d&&k in c&&d[O]!==c[k]?(U=A(O,k,re),W=S(O,k,m[U].geometry),delete c[O],delete d[k],d[I(ie,m[W].geometry,!0)]=W,m[U].geometry=null):O in d?S(O,k,re):k in c?A(O,k,re):(E(fe),c[O]=b-1,d[k]=b-1)):E(fe)}return m.filter(fe=>fe.geometry)}Bi([{name:"triangle",components:3,type:"Uint16"}]),Bi([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),Bi([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),Bi([{type:"Float32",name:"offsetX"}]),Bi([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),Bi([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const mb={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂"};function wTe(u){let c="";for(let b=0;b<u.length;b++){var d=u.charCodeAt(b+1)||null,m=u.charCodeAt(b-1)||null;(!d||!sT(d)||mb[u[b+1]])&&(!m||!sT(m)||mb[u[b-1]])&&mb[u[b]]?c+=mb[u[b]]:c+=u[b]}return c}var oo=24,ao={read:function(u,c,d,m,re){var E,S,A=8*re-m-1,I=(1<<A)-1,O=I>>1,k=-7,U=d?re-1:0,W=d?-1:1,re=u[c+U];for(U+=W,E=re&(1<<-k)-1,re>>=-k,k+=A;0<k;E=256*E+u[c+U],U+=W,k-=8);for(S=E&(1<<-k)-1,E>>=-k,k+=m;0<k;S=256*S+u[c+U],U+=W,k-=8);if(E===0)E=1-O;else{if(E===I)return S?NaN:1/0*(re?-1:1);S+=Math.pow(2,m),E-=O}return(re?-1:1)*S*Math.pow(2,E-m)},write:function(u,c,d,m,b,ie){var S,A,I=8*ie-b-1,O=(1<<I)-1,k=O>>1,U=b===23?Math.pow(2,-24)-Math.pow(2,-77):0,W=m?0:ie-1,re=m?1:-1,ie=c<0||c===0&&1/c<0?1:0;for(c=Math.abs(c),isNaN(c)||c===1/0?(A=isNaN(c)?1:0,S=O):(S=Math.floor(Math.log(c)/Math.LN2),c*(m=Math.pow(2,-S))<1&&(S--,m*=2),2<=(c+=1<=S+k?U/m:U*Math.pow(2,1-k))*m&&(S++,m/=2),O<=S+k?(A=0,S=O):1<=S+k?(A=(c*m-1)*Math.pow(2,b),S+=k):(A=c*Math.pow(2,k-1)*Math.pow(2,b),S=0));8<=b;u[d+W]=255&A,W+=re,A/=256,b-=8);for(S=S<<b|A,I+=b;0<I;u[d+W]=255&S,W+=re,S/=256,I-=8);u[d+W-re]|=128*ie}},ls=Hr,TT=ao;function Hr(u){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(u)?u:new Uint8Array(u||0),this.pos=0,this.type=0,this.length=this.buf.length}Hr.Varint=0,Hr.Fixed64=1,Hr.Bytes=2,Hr.Fixed32=5;var qR=4294967296,W9=1/qR,Y9=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function Du(u){return u.type===Hr.Bytes?u.readVarint()+u.pos:u.pos+1}function my(u,c,d){return d?4294967296*c+(u>>>0):4294967296*(c>>>0)+(u>>>0)}function K9(u,c,d){var m=c<=16383?1:c<=2097151?2:c<=268435455?3:Math.floor(Math.log(c)/(7*Math.LN2));d.realloc(m);for(var b=d.pos-1;u<=b;b--)d.buf[b+m]=d.buf[b]}function xTe(u,c){for(var d=0;d<u.length;d++)c.writeVarint(u[d])}function ETe(u,c){for(var d=0;d<u.length;d++)c.writeSVarint(u[d])}function TTe(u,c){for(var d=0;d<u.length;d++)c.writeFloat(u[d])}function STe(u,c){for(var d=0;d<u.length;d++)c.writeDouble(u[d])}function CTe(u,c){for(var d=0;d<u.length;d++)c.writeBoolean(u[d])}function ATe(u,c){for(var d=0;d<u.length;d++)c.writeFixed32(u[d])}function ITe(u,c){for(var d=0;d<u.length;d++)c.writeSFixed32(u[d])}function PTe(u,c){for(var d=0;d<u.length;d++)c.writeFixed64(u[d])}function MTe(u,c){for(var d=0;d<u.length;d++)c.writeSFixed64(u[d])}function ST(u,c){return(u[c]|u[c+1]<<8|u[c+2]<<16)+16777216*u[c+3]}function yy(u,c,d){u[d]=c,u[d+1]=c>>>8,u[d+2]=c>>>16,u[d+3]=c>>>24}function Z9(u,c){return(u[c]|u[c+1]<<8|u[c+2]<<16)+(u[c+3]<<24)}Hr.prototype={destroy:function(){this.buf=null},readFields:function(u,c,d){for(d=d||this.length;this.pos<d;){var m=this.readVarint(),b=m>>3,E=this.pos;this.type=7&m,u(b,c,this),this.pos===E&&this.skip(m)}return c},readMessage:function(u,c){return this.readFields(u,c,this.readVarint()+this.pos)},readFixed32:function(){var u=ST(this.buf,this.pos);return this.pos+=4,u},readSFixed32:function(){var u=Z9(this.buf,this.pos);return this.pos+=4,u},readFixed64:function(){var u=ST(this.buf,this.pos)+ST(this.buf,this.pos+4)*qR;return this.pos+=8,u},readSFixed64:function(){var u=ST(this.buf,this.pos)+Z9(this.buf,this.pos+4)*qR;return this.pos+=8,u},readFloat:function(){var u=TT.read(this.buf,this.pos,!0,23,4);return this.pos+=4,u},readDouble:function(){var u=TT.read(this.buf,this.pos,!0,52,8);return this.pos+=8,u},readVarint:function(S){var b=this.buf,m=b[this.pos++],E=127&m;if(m<128||(E|=(127&(m=b[this.pos++]))<<7,m<128)||(E|=(127&(m=b[this.pos++]))<<14,m<128)||(E|=(127&(m=b[this.pos++]))<<21,m<128))return E;var c,d,m=E|=(15&b[this.pos])<<28,b=S,E=this,S=E.buf;if(d=S[E.pos++],c=(112&d)>>4,d<128||(d=S[E.pos++],c|=(127&d)<<3,d<128)||(d=S[E.pos++],c|=(127&d)<<10,d<128)||(d=S[E.pos++],c|=(127&d)<<17,d<128)||(d=S[E.pos++],c|=(127&d)<<24,d<128)||(d=S[E.pos++],c|=(1&d)<<31,d<128))return my(m,c,b);throw new Error("Expected varint not more than 10 bytes")},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var u=this.readVarint();return u%2==1?(u+1)/-2:u/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var u=this.readVarint()+this.pos,c=this.pos;if(12<=(this.pos=u)-c&&Y9)return d=this.buf,Y9.decode(d.subarray(c,u));for(var d,m,b,E,S=this.buf,A=u,I="",O=c;O<A;){var k=S[O],U=null,W=239<k?4:223<k?3:191<k?2:1;if(A<O+W)break;W===1?k<128&&(U=k):W===2?(192&(m=S[O+1]))==128&&(U=(31&k)<<6|63&m)<=127&&(U=null):W===3?(m=S[O+1],b=S[O+2],(192&m)==128&&(192&b)==128&&((U=(15&k)<<12|(63&m)<<6|63&b)<=2047||55296<=U&&U<=57343)&&(U=null)):W===4&&(m=S[O+1],b=S[O+2],E=S[O+3],(192&m)==128)&&(192&b)==128&&(192&E)==128&&((U=(15&k)<<18|(63&m)<<12|(63&b)<<6|63&E)<=65535||1114112<=U)&&(U=null),U===null?(U=65533,W=1):65535<U&&(U-=65536,I+=String.fromCharCode(U>>>10&1023|55296),U=56320|1023&U),I+=String.fromCharCode(U),O+=W}return I},readBytes:function(){var u=this.readVarint()+this.pos,c=this.buf.subarray(this.pos,u);return this.pos=u,c},readPackedVarint:function(u,c){if(this.type!==Hr.Bytes)return u.push(this.readVarint(c));var d=Du(this);for(u=u||[];this.pos<d;)u.push(this.readVarint(c));return u},readPackedSVarint:function(u){if(this.type!==Hr.Bytes)return u.push(this.readSVarint());var c=Du(this);for(u=u||[];this.pos<c;)u.push(this.readSVarint());return u},readPackedBoolean:function(u){if(this.type!==Hr.Bytes)return u.push(this.readBoolean());var c=Du(this);for(u=u||[];this.pos<c;)u.push(this.readBoolean());return u},readPackedFloat:function(u){if(this.type!==Hr.Bytes)return u.push(this.readFloat());var c=Du(this);for(u=u||[];this.pos<c;)u.push(this.readFloat());return u},readPackedDouble:function(u){if(this.type!==Hr.Bytes)return u.push(this.readDouble());var c=Du(this);for(u=u||[];this.pos<c;)u.push(this.readDouble());return u},readPackedFixed32:function(u){if(this.type!==Hr.Bytes)return u.push(this.readFixed32());var c=Du(this);for(u=u||[];this.pos<c;)u.push(this.readFixed32());return u},readPackedSFixed32:function(u){if(this.type!==Hr.Bytes)return u.push(this.readSFixed32());var c=Du(this);for(u=u||[];this.pos<c;)u.push(this.readSFixed32());return u},readPackedFixed64:function(u){if(this.type!==Hr.Bytes)return u.push(this.readFixed64());var c=Du(this);for(u=u||[];this.pos<c;)u.push(this.readFixed64());return u},readPackedSFixed64:function(u){if(this.type!==Hr.Bytes)return u.push(this.readSFixed64());var c=Du(this);for(u=u||[];this.pos<c;)u.push(this.readSFixed64());return u},skip:function(u){if(u&=7,u===Hr.Varint)for(;127<this.buf[this.pos++];);else if(u===Hr.Bytes)this.pos=this.readVarint()+this.pos;else if(u===Hr.Fixed32)this.pos+=4;else{if(u!==Hr.Fixed64)throw new Error("Unimplemented type: "+u);this.pos+=8}},writeTag:function(u,c){this.writeVarint(u<<3|c)},realloc:function(u){for(var c,d=this.length||16;d<this.pos+u;)d*=2;d!==this.length&&((c=new Uint8Array(d)).set(this.buf),this.buf=c,this.length=d)},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(u){this.realloc(4),yy(this.buf,u,this.pos),this.pos+=4},writeSFixed32:function(u){this.realloc(4),yy(this.buf,u,this.pos),this.pos+=4},writeFixed64:function(u){this.realloc(8),yy(this.buf,-1&u,this.pos),yy(this.buf,Math.floor(u*W9),this.pos+4),this.pos+=8},writeSFixed64:function(u){this.realloc(8),yy(this.buf,-1&u,this.pos),yy(this.buf,Math.floor(u*W9),this.pos+4),this.pos+=8},writeVarint:function(u){if(268435455<(u=+u||0)||u<0){var d=u,b=this;if(0<=d?(c=d%4294967296|0,m=d/4294967296|0):(m=~(-d/4294967296),4294967295^(c=~(-d%4294967296))?c=c+1|0:m=m+1|(c=0)),18446744073709552e3<=d||d<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");b.realloc(10);var d=c,c=b,d=(c.buf[c.pos++]=127&d|128,d>>>=7,c.buf[c.pos++]=127&d|128,d>>>=7,c.buf[c.pos++]=127&d|128,d>>>=7,c.buf[c.pos++]=127&d|128,d>>>=7,c.buf[c.pos]=127&d,m),m=b,b=(7&d)<<4;m.buf[m.pos++]|=b|((d>>>=3)?128:0),d&&(m.buf[m.pos++]=127&d|((d>>>=7)?128:0),d)&&(m.buf[m.pos++]=127&d|((d>>>=7)?128:0),d)&&(m.buf[m.pos++]=127&d|((d>>>=7)?128:0),d)&&(m.buf[m.pos++]=127&d|((d>>>=7)?128:0),d)&&(m.buf[m.pos++]=127&d)}else this.realloc(4),this.buf[this.pos++]=127&u|(127<u?128:0),u<=127||(this.buf[this.pos++]=127&(u>>>=7)|(127<u?128:0),u<=127)||(this.buf[this.pos++]=127&(u>>>=7)|(127<u?128:0),u<=127)||(this.buf[this.pos++]=u>>>7&127)},writeSVarint:function(u){this.writeVarint(u<0?2*-u-1:2*u)},writeBoolean:function(u){this.writeVarint(!!u)},writeString:function(d){d=String(d),this.realloc(4*d.length),this.pos++;var c=this.pos,d=(this.pos=function(m,b,E){for(var S,A,I=0;I<b.length;I++){if(55295<(S=b.charCodeAt(I))&&S<57344){if(!A){56319<S||I+1===b.length?(m[E++]=239,m[E++]=191,m[E++]=189):A=S;continue}if(S<56320){m[E++]=239,m[E++]=191,m[E++]=189,A=S;continue}S=A-55296<<10|S-56320|65536,A=null}else A&&(m[E++]=239,m[E++]=191,m[E++]=189,A=null);S<128?m[E++]=S:(S<2048?m[E++]=S>>6|192:(S<65536?m[E++]=S>>12|224:(m[E++]=S>>18|240,m[E++]=S>>12&63|128),m[E++]=S>>6&63|128),m[E++]=63&S|128)}return E}(this.buf,d,this.pos),this.pos-c);128<=d&&K9(c,d,this),this.pos=c-1,this.writeVarint(d),this.pos+=d},writeFloat:function(u){this.realloc(4),TT.write(this.buf,u,this.pos,!0,23,4),this.pos+=4},writeDouble:function(u){this.realloc(8),TT.write(this.buf,u,this.pos,!0,52,8),this.pos+=8},writeBytes:function(u){var c=u.length;this.writeVarint(c),this.realloc(c);for(var d=0;d<c;d++)this.buf[this.pos++]=u[d]},writeRawMessage:function(m,c){this.pos++;var d=this.pos,m=(m(c,this),this.pos-d);128<=m&&K9(d,m,this),this.pos=d-1,this.writeVarint(m),this.pos+=m},writeMessage:function(u,c,d){this.writeTag(u,Hr.Bytes),this.writeRawMessage(c,d)},writePackedVarint:function(u,c){c.length&&this.writeMessage(u,xTe,c)},writePackedSVarint:function(u,c){c.length&&this.writeMessage(u,ETe,c)},writePackedBoolean:function(u,c){c.length&&this.writeMessage(u,CTe,c)},writePackedFloat:function(u,c){c.length&&this.writeMessage(u,TTe,c)},writePackedDouble:function(u,c){c.length&&this.writeMessage(u,STe,c)},writePackedFixed32:function(u,c){c.length&&this.writeMessage(u,ATe,c)},writePackedSFixed32:function(u,c){c.length&&this.writeMessage(u,ITe,c)},writePackedFixed64:function(u,c){c.length&&this.writeMessage(u,PTe,c)},writePackedSFixed64:function(u,c){c.length&&this.writeMessage(u,MTe,c)},writeBytesField:function(u,c){this.writeTag(u,Hr.Bytes),this.writeBytes(c)},writeFixed32Field:function(u,c){this.writeTag(u,Hr.Fixed32),this.writeFixed32(c)},writeSFixed32Field:function(u,c){this.writeTag(u,Hr.Fixed32),this.writeSFixed32(c)},writeFixed64Field:function(u,c){this.writeTag(u,Hr.Fixed64),this.writeFixed64(c)},writeSFixed64Field:function(u,c){this.writeTag(u,Hr.Fixed64),this.writeSFixed64(c)},writeVarintField:function(u,c){this.writeTag(u,Hr.Varint),this.writeVarint(c)},writeSVarintField:function(u,c){this.writeTag(u,Hr.Varint),this.writeSVarint(c)},writeStringField:function(u,c){this.writeTag(u,Hr.Bytes),this.writeString(c)},writeFloatField:function(u,c){this.writeTag(u,Hr.Fixed32),this.writeFloat(c)},writeDoubleField:function(u,c){this.writeTag(u,Hr.Fixed64),this.writeDouble(c)},writeBooleanField:function(u,c){this.writeVarintField(u,!!c)}};var CT,$R=a(ls);const WR=3;function RTe(u,c,d){u===1&&d.readMessage(kTe,c)}function kTe(u,c,d){var m,b,E,S,A;u===3&&({id:u,bitmap:d,width:m,height:b,left:E,top:S,advance:A}=d.readMessage(OTe,{}),c.push({id:u,bitmap:new lb({width:m+2*WR,height:b+2*WR},d),metrics:{width:m,height:b,left:E,top:S,advance:A}}))}function OTe(u,c,d){u===1?c.id=d.readVarint():u===2?c.bitmap=d.readBytes():u===3?c.width=d.readVarint():u===4?c.height=d.readVarint():u===5?c.left=d.readSVarint():u===6?c.top=d.readSVarint():u===7&&(c.advance=d.readVarint())}const X9=WR;function Q9(u){let c=0,d=0;for(const I of u)c+=I.w*I.h,d=Math.max(d,I.w);u.sort((I,O)=>O.h-I.h);var m=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(c/.95)),d),h:1/0}];let b=0,E=0;for(const I of u)for(let O=m.length-1;0<=O;O--){var S,A=m[O];if(!(I.w>A.w||I.h>A.h)){I.x=A.x,I.y=A.y,E=Math.max(E,I.y+I.h),b=Math.max(b,I.x+I.w),I.w===A.w&&I.h===A.h?(S=m.pop(),O<m.length&&(m[O]=S)):I.h===A.h?(A.x+=I.w,A.w-=I.w):(I.w!==A.w&&m.push({x:A.x+I.w,y:A.y,w:A.w-I.w,h:I.h}),A.y+=I.h,A.h-=I.h);break}}return{w:b,h:E,fill:c/(b*E)||0}}(Or=CT=CT||{}).none="none",Or.height="height",Or.width="width";const Ua=1;class YR{constructor(c,{pixelRatio:d,version:m,stretchX:b,stretchY:E,content:S,contentMatch:A}){this.paddedRect=c,this.pixelRatio=d,this.stretchX=b,this.stretchY=E,this.content=S,this.version=m,this.contentMatch=A}get tl(){return[this.paddedRect.x+Ua,this.paddedRect.y+Ua]}get br(){return[this.paddedRect.x+this.paddedRect.w-Ua,this.paddedRect.y+this.paddedRect.h-Ua]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2*Ua)/this.pixelRatio,(this.paddedRect.h-2*Ua)/this.pixelRatio]}}class J9{constructor(c,d){var m={},b={},E=(this.haveRenderCallbacks=[],[]);this.addImages(c,m,E),this.addImages(d,b,E);const{w:S,h:A}=Q9(E);var I=new Ds({width:S||1,height:A||1});for(const re in c){var O=c[re],k=m[re].paddedRect;Ds.copy(O.data,I,{x:0,y:0},{x:k.x+Ua,y:k.y+Ua},O.data)}for(const re in d){var U=d[re],W=b[re].paddedRect;const ie=W.x+Ua,fe=W.y+Ua,we=U.data.width,de=U.data.height;Ds.copy(U.data,I,{x:0,y:0},{x:ie,y:fe},U.data),Ds.copy(U.data,I,{x:0,y:de-1},{x:ie,y:fe-1},{width:we,height:1}),Ds.copy(U.data,I,{x:0,y:0},{x:ie,y:fe+de},{width:we,height:1}),Ds.copy(U.data,I,{x:we-1,y:0},{x:ie-1,y:fe},{width:1,height:de}),Ds.copy(U.data,I,{x:0,y:0},{x:ie+we,y:fe},{width:1,height:de})}this.image=I,this.iconPositions=m,this.patternPositions=b}addImages(c,d,m){for(const S in c){var b=c[S],E={x:0,y:0,w:b.data.width+2*Ua,h:b.data.height+2*Ua};m.push(E),d[S]=new YR(E,b),b.hasRenderCallback&&this.haveRenderCallbacks.push(S)}}patchUpdatedImages(c,d){c.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const m in c.updatedImages)this.patchUpdatedImage(this.iconPositions[m],c.getImage(m),d),this.patchUpdatedImage(this.patternPositions[m],c.getImage(m),d)}patchUpdatedImage(c,d,m){var b;c&&d&&c.version!==d.version&&(c.version=d.version,[c,b]=c.tl,m.update(d.data,void 0,{x:c,y:b}))}}Ht("ImagePosition",YR),Ht("ImageAtlas",J9),i.WritingMode=void 0,(ao=i.WritingMode||(i.WritingMode={}))[ao.none=0]="none",ao[ao.horizontal=1]="horizontal",ao[ao.vertical=2]="vertical",ao[ao.horizontalOnly=3]="horizontalOnly";const yb=-17;class _b{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(c,d){var m=new _b;return m.scale=c||1,m.fontStack=d,m}static forImage(c){var d=new _b;return d.imageName=c,d}}class _y{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(c,d){var m=new _y;for(let E=0;E<c.sections.length;E++){var b=c.sections[E];b.image?m.addImageSection(b):m.addTextSection(b,d)}return m}length(){return this.text.length}getSection(c){return this.sections[this.sectionIndex[c]]}getSectionIndex(c){return this.sectionIndex[c]}getCharCode(c){return this.text.charCodeAt(c)}verticalizePunctuation(){this.text=wTe(this.text)}trim(){let c=0;for(let m=0;m<this.text.length&&IT[this.text.charCodeAt(m)];m++)c++;let d=this.text.length;for(let m=this.text.length-1;0<=m&&m>=c&&IT[this.text.charCodeAt(m)];m--)d--;this.text=this.text.substring(c,d),this.sectionIndex=this.sectionIndex.slice(c,d)}substring(c,d){var m=new _y;return m.text=this.text.substring(c,d),m.sectionIndex=this.sectionIndex.slice(c,d),m.sections=this.sections,m}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((c,d)=>Math.max(c,this.sections[d].scale),0)}addTextSection(c,d){this.text+=c.text,this.sections.push(_b.forText(c.scale,c.fontStack||d));var m=this.sections.length-1;for(let b=0;b<c.text.length;++b)this.sectionIndex.push(m)}addImageSection(m){var d,m=m.image?m.image.name:"";m.length===0?Ee("Can't add FormattedSection with an empty image."):(d=this.getNextImageSectionCharCode())?(this.text+=String.fromCharCode(d),this.sections.push(_b.forImage(m)),this.sectionIndex.push(this.sections.length-1)):Ee("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?63743<=this.imageSectionID?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function AT(Me,c,d,m,Ve,E,S,A,I,O,k,U,W,re,ie,fe){var we=_y.fromFeature(Me,Ve);U===i.WritingMode.vertical&&we.verticalizePunctuation();let de;var{processBidirectionalText:Me,processStyledBidirectionalText:Ve}=Lu;if(Me&&we.sections.length===1){de=[];for(const so of Me(we.toString(),KR(we,O,E,c,m,re,ie))){var $e=new _y;$e.text=so,$e.sections=we.sections;for(let Bo=0;Bo<so.length;Bo++)$e.sectionIndex.push(0);de.push($e)}}else if(Ve){de=[];for(const so of Ve(we.text,we.sectionIndex,KR(we,O,E,c,m,re,ie))){var Ye=new _y;Ye.text=so[0],Ye.sectionIndex=so[1],Ye.sections=we.sections,de.push(Ye)}}else de=function(so,Bo){var hc=[],Fu=so.text;let vr=0;for(const gr of Bo)hc.push(so.substring(vr,gr)),vr=gr;return vr<Fu.length&&hc.push(so.substring(vr,Fu.length)),hc}(we,KR(we,O,E,c,m,re,ie));Me=[],Ve={positionedLines:Me,text:we.toString(),top:k[1],bottom:k[1],left:k[0],right:k[0],writingMode:U,iconsInText:!1,verticalizable:!1};{var et=Ve,mt=c,zt=d,Nt=m,ut=(E=de,S),kt=(re=A,ie=I,U),vt=O,pt=W,tt=fe;let so=0,Bo=yb,hc=0,Fu=0;var Gt=ie==="right"?1:ie==="left"?0:.5;let vr=0;for(const Yi of E){Yi.trim();var jt=Yi.getMaxScale(),Wt=(jt-1)*oo,Sn={positionedGlyphs:[],lineOffset:0},$n=(et.positionedLines[vr]=Sn).positionedGlyphs;let za=0;if(Yi.length()){for(let Kr=0;Kr<Yi.length();Kr++){var An=Yi.getSection(Kr),pr=Yi.getSectionIndex(Kr),mn=Yi.getCharCode(Kr);let Ki=0,Uo=null,ra=null,us=null,zo=oo;var kn=!(kt===i.WritingMode.horizontal||!pt&&!up(mn)||pt&&(IT[mn]||function(ia){return Ft.Arabic(ia)||Ft["Arabic Supplement"](ia)||Ft["Arabic Extended-A"](ia)||Ft["Arabic Presentation Forms-A"](ia)||Ft["Arabic Presentation Forms-B"](ia)}(mn)));if(An.imageName){var cr=Nt[An.imageName];if(!cr)continue;us=An.imageName,et.iconsInText=et.iconsInText||!0,ra=cr.paddedRect;var cr=cr.displaySize,Lr=(An.scale=An.scale*oo/tt,Uo={width:cr[0],height:cr[1],left:Ua,top:-X9,advance:kn?cr[1]:cr[0]},oo-cr[1]*An.scale),Lr=(Ki=Wt+Lr,zo=Uo.advance,kn?cr[0]*An.scale-oo*jt:cr[1]*An.scale-oo*jt);0<Lr&&Lr>za&&(za=Lr)}else{if(cr=zt[An.fontStack],Lr=cr&&cr[mn],Lr&&Lr.rect)ra=Lr.rect,Uo=Lr.metrics;else{var Bs=mt[An.fontStack],Bs=Bs&&Bs[mn];if(!Bs)continue;Uo=Bs.metrics}Ki=(jt-An.scale)*oo}kn?(et.verticalizable=!0,$n.push({glyph:mn,imageName:us,x:so,y:Bo+Ki,vertical:kn,scale:An.scale,fontStack:An.fontStack,sectionIndex:pr,metrics:Uo,rect:ra}),so+=zo*An.scale+vt):($n.push({glyph:mn,imageName:us,x:so,y:Bo+Ki,vertical:kn,scale:An.scale,fontStack:An.fontStack,sectionIndex:pr,metrics:Uo,rect:ra}),so+=Uo.advance*An.scale+vt)}$n.length!==0&&(_a=so-vt,hc=Math.max(_a,hc),function(Kr,Ki,Uo,ra,us){if(ra||us){var zo=Kr[Uo],zo=zo.metrics.advance*zo.scale,ia=(Kr[Uo].x+zo)*ra;for(let dc=Ki;dc<=Uo;dc++)Kr[dc].x-=ia,Kr[dc].y+=us}}($n,0,$n.length-1,Gt,za)),so=0;var _a=ut*jt+za;Sn.lineOffset=Math.max(za,Wt),Bo+=_a,Fu=Math.max(_a,Fu)}else Bo+=ut;++vr}var ie=Bo-yb,{horizontalAlign:re,verticalAlign:k}=ZR(re);{var lr=et.positionedLines,nr=Gt,Nc=re,vd=k,lc=hc,Il=Fu,na=ut,uc=ie,dk=E.length,Eb=(nr-Nc)*lc;let Yi=0;Yi=Il!==na?-uc*vd-yb:(-vd*dk+.5)*na;for(const za of lr)for(const Kr of za.positionedGlyphs)Kr.x+=Eb,Kr.y+=Yi}et.top+=-k*ie,et.bottom=et.top+ie,et.left+=-re*hc,et.right=et.left+hc}return!function(so){for(const Bo of so)if(Bo.positionedGlyphs.length!==0)return;return 1}(Me)&&Ve}const IT={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},LTe={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function eV(u,c,d,m,b,E){return c.imageName?(m=m[c.imageName])?m.displaySize[0]*c.scale*oo/E+b:0:(E=(m=d[c.fontStack])&&m[u])?E.metrics.advance*c.scale+b:0}function tV(u,c,d,m){var b=Math.pow(u-c,2);return m?u<c?b/2:2*b:b+Math.abs(d)*d}function nV(u,c,d,m,b,E){let S=null,A=tV(c,d,b,E);for(const O of m){var I=tV(c-O.x,d,b,E)+O.badness;I<=A&&(S=O,A=I)}return{index:u,x:c,priorBreak:S,badness:A}}function KR(u,c,d,m,b,E,S){if(E!=="point")return[];if(!u)return[];var A=[],I=function(ie,fe,we,de,Me,Ve){let $e=0;for(let et=0;et<ie.length();et++){var Ye=ie.getSection(et);$e+=eV(ie.getCharCode(et),Ye,de,Me,fe,Ve)}return we=Math.max(1,Math.ceil($e/we)),$e/we}(u,c,d,m,b,S),O=0<=u.text.indexOf("​");let k=0;for(let ie=0;ie<u.length();ie++){var U,W=u.getSection(ie),re=u.getCharCode(ie);IT[re]||(k+=eV(re,W,m,b,c,S)),ie<u.length()-1&&(U=!((U=re)<11904||!Ft["Bopomofo Extended"](U)&&!(Ft.Bopomofo(U)||Ft["CJK Compatibility Forms"](U)||Ft["CJK Compatibility Ideographs"](U)||Ft["CJK Compatibility"](U)||Ft["CJK Radicals Supplement"](U)||Ft["CJK Strokes"](U)||Ft["CJK Symbols and Punctuation"](U)||Ft["CJK Unified Ideographs Extension A"](U)||Ft["CJK Unified Ideographs"](U)||Ft["Enclosed CJK Letters and Months"](U)||Ft["Halfwidth and Fullwidth Forms"](U)||Ft.Hiragana(U)||Ft["Ideographic Description Characters"](U)||Ft["Kangxi Radicals"](U)||Ft["Katakana Phonetic Extensions"](U)||Ft.Katakana(U)||Ft["Vertical Forms"](U)||Ft["Yi Radicals"](U)||Ft["Yi Syllables"](U))),LTe[re]||U||W.imageName)&&A.push(nV(ie+1,k,I,A,function(fe,we,de){let Me=0;return fe===10&&(Me-=1e4),de&&(Me+=150),fe!==40&&fe!==65288||(Me+=50),we!==41&&we!==65289||(Me+=50),Me}(re,u.getCharCode(ie+1),U&&O),!1))}return function ie(fe){return fe?ie(fe.priorBreak).concat(fe.index):[]}(nV(u.length(),k,I,A,0,!0))}function ZR(u){let c=.5,d=.5;switch(u){case"right":case"top-right":case"bottom-right":c=1;break;case"left":case"top-left":case"bottom-left":c=0}switch(u){case"bottom":case"bottom-right":case"bottom-left":d=1;break;case"top":case"top-right":case"top-left":d=0}return{horizontalAlign:c,verticalAlign:d}}function rV(u){let c=u.left,d=u.top,m=u.right-c,b=u.bottom-d;var E=u.image.content[2]-u.image.content[0],S=u.image.content[3]-u.image.content[1];return S!=0&&m!==0&&b!==0&&(E=E/S,u.image.contentMatch===CT.height?m/b<E&&(S=b*E,c*=S/m,m=S):u.image.contentMatch===CT.width&&E!=0&&m/b>E&&(S=m/E,d*=S/S,b=S)),{x1:c,y1:d,x2:c+m,y2:d+b}}function iV(u,c,d,m,b,E){u=u.image;let S;u.content&&(A=u.content,I=u.pixelRatio||1,S=[A[0]/I,A[1]/I,u.displaySize[0]-A[2]/I,u.displaySize[1]-A[3]/I]);var A=c.left*E,I=c.right*E;let O,k,U,W;return k=d==="width"||d==="both"?(W=b[0]+A-m[3],b[0]+I+m[1]):(W=b[0]+(A+I-u.displaySize[0])/2)+u.displaySize[0],A=c.top*E,I=c.bottom*E,U=d==="height"||d==="both"?(O=b[1]+A-m[0],b[1]+I+m[2]):(O=b[1]+(A+I-u.displaySize[1])/2)+u.displaySize[1],{image:u,top:O,right:k,bottom:U,left:W,collisionPadding:S}}const vb=255,Al=128,gd=vb*Al;function oV(u,c){if(c=c.expression,c.kind==="constant")return{kind:"constant",layoutSize:c.evaluate(new zr(u+1))};if(c.kind==="source")return{kind:"source"};{var{zoomStops:d,interpolationType:m}=c;let S=0;for(;S<d.length&&d[S]<=u;)S++;let A=S=Math.max(0,S-1);for(;A<d.length&&d[A]<u+1;)A++;A=Math.min(d.length-1,A);var b=d[S],E=d[A];return c.kind==="composite"?{kind:"composite",minZoom:b,maxZoom:E,interpolationType:m}:{kind:"camera",minZoom:b,maxZoom:E,minSize:c.evaluate(new zr(b)),maxSize:c.evaluate(new zr(E)),interpolationType:m}}}function XR(u,c,d){let m="never";return c=u.get(c),c?m=c:u.get(d)&&(m="always"),m}const NTe=pd.VectorTileFeature.types,DTe=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function PT(u,c,d,m,b,E,S,ie,I,O,k,U,W){var re=ie?Math.min(gd,Math.round(ie[0])):0,ie=ie?Math.min(gd,Math.round(ie[1])):0;u.emplaceBack(c,d,Math.round(32*m),Math.round(32*b),E,S,(re<<1)+(I?1:0),ie,16*O,16*k,256*U,256*W)}function QR(u,c,d){u.emplaceBack(c.x,c.y,d),u.emplaceBack(c.x,c.y,d),u.emplaceBack(c.x,c.y,d),u.emplaceBack(c.x,c.y,d)}function FTe(u){for(const c of u.sections)if(function(d){for(const m of d)if(cT(m.charCodeAt(0)))return 1}(c.text))return!0;return!1}class JR{constructor(c){this.layoutVertexArray=new _T,this.indexArray=new hd,this.programConfigurations=c,this.segments=new w,this.dynamicLayoutVertexArray=new yp,this.opacityVertexArray=new MR,this.hasVisibleVertices=!1,this.placedSymbolArray=new ib}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(c,d,m,b){!this.isEmpty()&&(m&&(this.layoutVertexBuffer=c.createVertexBuffer(this.layoutVertexArray,mTe.members),this.indexBuffer=c.createIndexBuffer(this.indexArray,d),this.dynamicLayoutVertexBuffer=c.createVertexBuffer(this.dynamicLayoutVertexArray,yTe.members,!0),this.opacityVertexBuffer=c.createVertexBuffer(this.opacityVertexArray,DTe,!0),this.opacityVertexBuffer.itemSize=1),m||b)&&this.programConfigurations.upload(c)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}Ht("SymbolBuffers",JR);class ek{constructor(c,d,m){this.layoutVertexArray=new c,this.layoutAttributes=d,this.indexArray=new m,this.segments=new w,this.collisionVertexArray=new RR}upload(c){this.layoutVertexBuffer=c.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=c.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=c.createVertexBuffer(this.collisionVertexArray,_Te.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}Ht("CollisionBuffers",ek);class vy{constructor(c){this.collisionBoxArray=c.collisionBoxArray,this.zoom=c.zoom,this.overscaling=c.overscaling,this.layers=c.layers,this.layerIds=this.layers.map(E=>E.id),this.index=c.index,this.pixelRatio=c.pixelRatio,this.sourceLayerIndex=c.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=jr([]),this.placementViewportMatrix=jr([]);var d=this.layers[0]._unevaluatedLayout._values,d=(this.textSizeData=oV(this.zoom,d["text-size"]),this.iconSizeData=oV(this.zoom,d["icon-size"]),this.layers[0].layout),b=d.get("symbol-sort-key"),m=d.get("symbol-z-order"),b=(this.canOverlap=XR(d,"text-overlap","text-allow-overlap")!=="never"||XR(d,"icon-overlap","icon-allow-overlap")!=="never"||d.get("text-ignore-placement")||d.get("icon-ignore-placement"),this.sortFeaturesByKey=m!=="viewport-y"&&!b.isConstant(),m==="viewport-y"||m==="auto"&&!this.sortFeaturesByKey);this.sortFeaturesByY=b&&this.canOverlap,d.get("symbol-placement")==="point"&&(this.writingModes=d.get("text-writing-mode").map(E=>i.WritingMode[E])),this.stateDependentLayerIds=this.layers.filter(E=>E.isStateDependent()).map(E=>E.id),this.sourceID=c.sourceID}createArrays(){this.text=new JR(new Qe(this.layers,this.zoom,c=>/^text/.test(c))),this.icon=new JR(new Qe(this.layers,this.zoom,c=>/^icon/.test(c))),this.glyphOffsetArray=new gT,this.lineVertexArray=new mT,this.symbolInstances=new pT,this.textAnchorOffsets=new yT}calculateGlyphDependencies(c,d,m,b,E){for(let A=0;A<c.length;A++){var S;d[c.charCodeAt(A)]=!0,(m||b)&&E&&(S=mb[c.charAt(A)])&&(d[S.charCodeAt(0)]=!0)}}populate(c,d,m){var b=this.layers[0],E=b.layout,S=E.get("text-font"),A=E.get("text-field"),I=E.get("icon-image"),O=(A.value.kind!=="constant"||A.value.value instanceof to&&!A.value.value.isEmpty()||0<A.value.value.toString().length)&&(S.value.kind!=="constant"||0<S.value.value.length),k=I.value.kind!=="constant"||!!I.value.value||0<Object.keys(I.parameters).length,U=E.get("symbol-sort-key");if(this.features=[],O||k){var W,re,ie,fe,we=d.iconDependencies,de=d.glyphDependencies,Me=d.availableImages,Ve=new zr(this.zoom);for({feature:W,id:re,index:ie,sourceLayerIndex:fe}of c){var $e,Ye=b._featureFilter.needGeometry,et=Yt(W,Ye);if(b._featureFilter.filter(Ve,et,m)){Ye||(et.geometry=Dt(W));let kt;O&&(Ye=b.getValueAndResolveTokens("text-field",et,m,Me),Ye=to.factory(Ye),!($e=this.hasRTLText=this.hasRTLText||FTe(Ye))||Lu.getRTLTextPluginStatus()==="unavailable"||$e&&Lu.isParsed())&&(kt=vTe(Ye,b,et));let vt;if(k&&($e=b.getValueAndResolveTokens("icon-image",et,m,Me),vt=$e instanceof ea?$e:ea.fromString($e)),(kt||vt)&&(Ye=this.sortFeaturesByKey?U.evaluate(et,{},m):void 0,Ye={id:re,text:kt,icon:vt,index:ie,sourceLayerIndex:fe,geometry:et.geometry,properties:W.properties,type:NTe[W.type],sortKey:Ye},this.features.push(Ye),vt&&(we[vt.name]=!0),kt)){var mt,zt,Nt=S.evaluate(et,{},m).join(","),ut=E.get("text-rotation-alignment")!=="viewport"&&E.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&0<=this.writingModes.indexOf(i.WritingMode.vertical);for(const pt of kt.sections)pt.image?we[pt.image.name]=!0:(mt=Ou(kt.toString()),zt=de[zt=pt.fontStack||Nt]=de[zt]||{},this.calculateGlyphDependencies(pt.text,zt,ut,this.allowVerticalPlacement,mt))}}}E.get("symbol-placement")==="line"&&(this.features=bTe(this.features)),this.sortFeaturesByKey&&this.features.sort((kt,vt)=>kt.sortKey-vt.sortKey)}}update(c,d,m){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(c,d,this.layers,m),this.icon.programConfigurations.updatePaintArrays(c,d,this.layers,m))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(c){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(c),this.iconCollisionBox.upload(c)),this.text.upload(c,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(c,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(c,d){var m=this.lineVertexArray.length;if(c.segment!==void 0){let S=c.dist(d[c.segment+1]),A=c.dist(d[c.segment]);var b={};for(let I=c.segment+1;I<d.length;I++)b[I]={x:d[I].x,y:d[I].y,tileUnitDistanceFromAnchor:S},I<d.length-1&&(S+=d[I+1].dist(d[I]));for(let I=c.segment||0;0<=I;I--)b[I]={x:d[I].x,y:d[I].y,tileUnitDistanceFromAnchor:A},0<I&&(A+=d[I-1].dist(d[I]));for(let I=0;I<d.length;I++){var E=b[I];this.lineVertexArray.emplaceBack(E.x,E.y,E.tileUnitDistanceFromAnchor)}}return{lineStartIndex:m,lineLength:this.lineVertexArray.length-m}}addSymbols(c,d,m,b,E,S,A,I,O,k,U,W){var re=c.indexArray,ie=c.layoutVertexArray,fe=c.segments.prepareSegment(4*d.length,ie,re,this.canOverlap?S.sortKey:void 0),we=this.glyphOffsetArray.length,de=fe.vertexLength,Me=this.allowVerticalPlacement&&A===i.WritingMode.vertical?Math.PI/2:0,Ve=S.text&&S.text.sections;for(let Sn=0;Sn<d.length;Sn++){var{tl:$e,tr:Ye,bl:et,br:mt,tex:zt,pixelOffsetTL:Nt,pixelOffsetBR:ut,minFontScaleX:kt,minFontScaleY:vt,glyphOffset:pt,isSDF:tt,sectionIndex:Gt}=d[Sn],jt=fe.vertexLength,Wt=pt[1];PT(ie,I.x,I.y,$e.x,Wt+$e.y,zt.x,zt.y,m,tt,Nt.x,Nt.y,kt,vt),PT(ie,I.x,I.y,Ye.x,Wt+Ye.y,zt.x+zt.w,zt.y,m,tt,ut.x,Nt.y,kt,vt),PT(ie,I.x,I.y,et.x,Wt+et.y,zt.x,zt.y+zt.h,m,tt,Nt.x,ut.y,kt,vt),PT(ie,I.x,I.y,mt.x,Wt+mt.y,zt.x+zt.w,zt.y+zt.h,m,tt,ut.x,ut.y,kt,vt),QR(c.dynamicLayoutVertexArray,I,Me),re.emplaceBack(jt,jt+1,jt+2),re.emplaceBack(jt+1,jt+2,jt+3),fe.vertexLength+=4,fe.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(pt[0]),Sn!==d.length-1&&Gt===d[Sn+1].sectionIndex||c.programConfigurations.populatePaintArrays(ie.length,S,S.index,{},W,Ve&&Ve[Gt])}c.placedSymbolArray.emplaceBack(I.x,I.y,we,this.glyphOffsetArray.length-we,de,O,k,I.segment,m?m[0]:0,m?m[1]:0,b[0],b[1],A,0,!1,0,U)}_addCollisionDebugVertex(c,d,m,b,E,S){return d.emplaceBack(0,0),c.emplaceBack(m.x,m.y,b,E,Math.round(S.x),Math.round(S.y))}addCollisionDebugVertices(c,ie,m,b,E,S,re){var I=E.segments.prepareSegment(4,E.layoutVertexArray,E.indexArray),O=I.vertexLength,k=E.layoutVertexArray,U=E.collisionVertexArray,W=re.anchorX,re=re.anchorY,ie=(this._addCollisionDebugVertex(k,U,S,W,re,new p(c,ie)),this._addCollisionDebugVertex(k,U,S,W,re,new p(m,ie)),this._addCollisionDebugVertex(k,U,S,W,re,new p(m,b)),this._addCollisionDebugVertex(k,U,S,W,re,new p(c,b)),I.vertexLength+=4,E.indexArray);ie.emplaceBack(O,O+1),ie.emplaceBack(O+1,O+2),ie.emplaceBack(O+2,O+3),ie.emplaceBack(O+3,O),I.primitiveLength+=4}addDebugCollisionBoxes(c,d,m,b){for(let k=c;k<d;k++){var E=this.collisionBoxArray.get(k),S=E.x1,A=E.y1,I=E.x2,O=E.y2;this.addCollisionDebugVertices(S,A,I,O,b?this.textCollisionBox:this.iconCollisionBox,E.anchorPoint,m)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new ek(vT,$9.members,fy),this.iconCollisionBox=new ek(vT,$9.members,fy);for(let d=0;d<this.symbolInstances.length;d++){var c=this.symbolInstances.get(d);this.addDebugCollisionBoxes(c.textBoxStartIndex,c.textBoxEndIndex,c,!0),this.addDebugCollisionBoxes(c.verticalTextBoxStartIndex,c.verticalTextBoxEndIndex,c,!0),this.addDebugCollisionBoxes(c.iconBoxStartIndex,c.iconBoxEndIndex,c,!1),this.addDebugCollisionBoxes(c.verticalIconBoxStartIndex,c.verticalIconBoxEndIndex,c,!1)}}_deserializeCollisionBoxesForSymbol(c,d,m,b,E,S,A,I,O){var k={};for(let fe=d;fe<m;fe++){var U=c.get(fe);k.textBox={x1:U.x1,y1:U.y1,x2:U.x2,y2:U.y2,anchorPointX:U.anchorPointX,anchorPointY:U.anchorPointY},k.textFeatureIndex=U.featureIndex;break}for(let fe=b;fe<E;fe++){var W=c.get(fe);k.verticalTextBox={x1:W.x1,y1:W.y1,x2:W.x2,y2:W.y2,anchorPointX:W.anchorPointX,anchorPointY:W.anchorPointY},k.verticalTextFeatureIndex=W.featureIndex;break}for(let fe=S;fe<A;fe++){var re=c.get(fe);k.iconBox={x1:re.x1,y1:re.y1,x2:re.x2,y2:re.y2,anchorPointX:re.anchorPointX,anchorPointY:re.anchorPointY},k.iconFeatureIndex=re.featureIndex;break}for(let fe=I;fe<O;fe++){var ie=c.get(fe);k.verticalIconBox={x1:ie.x1,y1:ie.y1,x2:ie.x2,y2:ie.y2,anchorPointX:ie.anchorPointX,anchorPointY:ie.anchorPointY},k.verticalIconFeatureIndex=ie.featureIndex;break}return k}deserializeCollisionBoxes(c){this.collisionArrays=[];for(let m=0;m<this.symbolInstances.length;m++){var d=this.symbolInstances.get(m);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(c,d.textBoxStartIndex,d.textBoxEndIndex,d.verticalTextBoxStartIndex,d.verticalTextBoxEndIndex,d.iconBoxStartIndex,d.iconBoxEndIndex,d.verticalIconBoxStartIndex,d.verticalIconBoxEndIndex))}}hasTextData(){return 0<this.text.segments.get().length}hasIconData(){return 0<this.icon.segments.get().length}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&0<this.textCollisionBox.segments.get().length}hasIconCollisionBoxData(){return this.hasDebugData()&&0<this.iconCollisionBox.segments.get().length}addIndicesForPlacedSymbol(c,m){var m=c.placedSymbolArray.get(m),b=m.vertexStartIndex+4*m.numGlyphs;for(let E=m.vertexStartIndex;E<b;E+=4)c.indexArray.emplaceBack(E,E+1,E+2),c.indexArray.emplaceBack(E+1,E+2,E+3)}getSortedSymbolIndexes(c){if(this.sortedAngle===c&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;var d=Math.sin(c),m=Math.cos(c);const b=[],E=[];var S=[];for(let I=0;I<this.symbolInstances.length;++I){S.push(I);var A=this.symbolInstances.get(I);b.push(0|Math.round(d*A.anchorX+m*A.anchorY)),E.push(A.featureIndex)}return S.sort((I,O)=>b[I]-b[O]||E[O]-E[I]),S}addToSortKeyRanges(c,d){var m=this.sortKeyRanges[this.sortKeyRanges.length-1];m&&m.sortKey===d?m.symbolInstanceEnd=c+1:this.sortKeyRanges.push({sortKey:d,symbolInstanceStart:c,symbolInstanceEnd:c+1})}sortFeatures(c){if(this.sortFeaturesByY&&this.sortedAngle!==c&&!(1<this.text.segments.get().length||1<this.icon.segments.get().length)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(c),this.sortedAngle=c,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const m of this.symbolInstanceIndexes){var d=this.symbolInstances.get(m);this.featureSortOrder.push(d.featureIndex),[d.rightJustifiedTextSymbolIndex,d.centerJustifiedTextSymbolIndex,d.leftJustifiedTextSymbolIndex].forEach((b,E,S)=>{0<=b&&S.indexOf(b)===E&&this.addIndicesForPlacedSymbol(this.text,b)}),0<=d.verticalPlacedTextSymbolIndex&&this.addIndicesForPlacedSymbol(this.text,d.verticalPlacedTextSymbolIndex),0<=d.placedIconSymbolIndex&&this.addIndicesForPlacedSymbol(this.icon,d.placedIconSymbolIndex),0<=d.verticalPlacedIconSymbolIndex&&this.addIndicesForPlacedSymbol(this.icon,d.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}function BTe(u,c){return c.replace(/{([^{}]+)}/g,(d,m)=>u&&m in u?String(u[m]):"")}Ht("SymbolBucket",vy,{omit:["layers","collisionBoxArray","features","compareText"]}),vy.MAX_GLYPHS=65535,vy.addDynamicAttributes=QR;let aV,sV;var tk={get paint(){return sV=sV||new ta({"icon-opacity":new xn(q.paint_symbol["icon-opacity"]),"icon-color":new xn(q.paint_symbol["icon-color"]),"icon-halo-color":new xn(q.paint_symbol["icon-halo-color"]),"icon-halo-width":new xn(q.paint_symbol["icon-halo-width"]),"icon-halo-blur":new xn(q.paint_symbol["icon-halo-blur"]),"icon-translate":new sn(q.paint_symbol["icon-translate"]),"icon-translate-anchor":new sn(q.paint_symbol["icon-translate-anchor"]),"text-opacity":new xn(q.paint_symbol["text-opacity"]),"text-color":new xn(q.paint_symbol["text-color"],{runtimeType:Rn,getOverride:u=>u.textColor,hasOverride:u=>!!u.textColor}),"text-halo-color":new xn(q.paint_symbol["text-halo-color"]),"text-halo-width":new xn(q.paint_symbol["text-halo-width"]),"text-halo-blur":new xn(q.paint_symbol["text-halo-blur"]),"text-translate":new sn(q.paint_symbol["text-translate"]),"text-translate-anchor":new sn(q.paint_symbol["text-translate-anchor"])})},get layout(){return aV=aV||new ta({"symbol-placement":new sn(q.layout_symbol["symbol-placement"]),"symbol-spacing":new sn(q.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new sn(q.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new xn(q.layout_symbol["symbol-sort-key"]),"symbol-z-order":new sn(q.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new sn(q.layout_symbol["icon-allow-overlap"]),"icon-overlap":new sn(q.layout_symbol["icon-overlap"]),"icon-ignore-placement":new sn(q.layout_symbol["icon-ignore-placement"]),"icon-optional":new sn(q.layout_symbol["icon-optional"]),"icon-rotation-alignment":new sn(q.layout_symbol["icon-rotation-alignment"]),"icon-size":new xn(q.layout_symbol["icon-size"]),"icon-text-fit":new sn(q.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new sn(q.layout_symbol["icon-text-fit-padding"]),"icon-image":new xn(q.layout_symbol["icon-image"]),"icon-rotate":new xn(q.layout_symbol["icon-rotate"]),"icon-padding":new xn(q.layout_symbol["icon-padding"]),"icon-keep-upright":new sn(q.layout_symbol["icon-keep-upright"]),"icon-offset":new xn(q.layout_symbol["icon-offset"]),"icon-anchor":new xn(q.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new sn(q.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new sn(q.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new sn(q.layout_symbol["text-rotation-alignment"]),"text-field":new xn(q.layout_symbol["text-field"]),"text-font":new xn(q.layout_symbol["text-font"]),"text-size":new xn(q.layout_symbol["text-size"]),"text-max-width":new xn(q.layout_symbol["text-max-width"]),"text-line-height":new sn(q.layout_symbol["text-line-height"]),"text-letter-spacing":new xn(q.layout_symbol["text-letter-spacing"]),"text-justify":new xn(q.layout_symbol["text-justify"]),"text-radial-offset":new xn(q.layout_symbol["text-radial-offset"]),"text-variable-anchor":new sn(q.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new xn(q.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new xn(q.layout_symbol["text-anchor"]),"text-max-angle":new sn(q.layout_symbol["text-max-angle"]),"text-writing-mode":new sn(q.layout_symbol["text-writing-mode"]),"text-rotate":new xn(q.layout_symbol["text-rotate"]),"text-padding":new sn(q.layout_symbol["text-padding"]),"text-keep-upright":new sn(q.layout_symbol["text-keep-upright"]),"text-transform":new xn(q.layout_symbol["text-transform"]),"text-offset":new xn(q.layout_symbol["text-offset"]),"text-allow-overlap":new sn(q.layout_symbol["text-allow-overlap"]),"text-overlap":new sn(q.layout_symbol["text-overlap"]),"text-ignore-placement":new sn(q.layout_symbol["text-ignore-placement"]),"text-optional":new sn(q.layout_symbol["text-optional"])})}};class cV{constructor(c){if(c.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=c.property.overrides?c.property.overrides.runtimeType:fn,this.defaultValue=c}evaluate(c){if(c.formattedSection){var d=this.defaultValue.property.overrides;if(d&&d.hasOverride(c.formattedSection))return d.getOverride(c.formattedSection)}return c.feature&&c.featureState?this.defaultValue.evaluate(c.feature,c.featureState):this.defaultValue.property.specification.default}eachChild(c){this.defaultValue.isConstant()||c(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Ht("FormatSectionOverride",cV,{omit:["defaultValue"]});class MT extends cs{constructor(c){super(c,tk)}recalculate(c,d){if(super.recalculate(c,d),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout.get("symbol-placement")!=="point"?this.layout._values["icon-rotation-alignment"]="map":this.layout._values["icon-rotation-alignment"]="viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout.get("symbol-placement")!=="point"?this.layout._values["text-rotation-alignment"]="map":this.layout._values["text-rotation-alignment"]="viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point")if(c=this.layout.get("text-writing-mode"),c){var m=[];for(const b of c)m.indexOf(b)<0&&m.push(b);this.layout._values["text-writing-mode"]=m}else this.layout._values["text-writing-mode"]=["horizontal"];this._setPaintOverrides()}getValueAndResolveTokens(c,d,m,b){return m=this.layout.get(c).evaluate(d,{},m,b),b=this._unevaluatedLayout._values[c],b.isDataDriven()||qm(b.value)||!m?m:BTe(d.properties,m)}createBucket(c){return new vy(c)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const m of tk.paint.overridableProperties)if(MT.hasPaintOverride(this.layout,m)){var c=this.paint.get(m),d=new cV(c),d=new O0(d,c.property.specification);let b=null;b=c.value.kind==="constant"||c.value.kind==="source"?new vi("source",d):new Wm("composite",d,c.value.zoomStops),this.paint._values[m]=new ss(c.property,b,c.parameters)}}_handleOverridablePaintPropertyUpdate(c,d,m){return!(!this.layout||d.isDataDriven()||m.isDataDriven())&&MT.hasPaintOverride(this.layout,c)}static hasPaintOverride(c,d){c=c.get("text-field");const m=tk.paint.properties[d];let b=!1;const E=S=>{for(const A of S)if(m.overrides&&m.overrides.hasOverride(A))return void(b=!0)};if(c.value.kind==="constant"&&c.value.value instanceof to)E(c.value.value.sections);else if(c.value.kind==="source"){const S=A=>{var I;b||(A instanceof La&&ci(A.value)===ti?(I=A.value,E(I.sections)):A instanceof Vm?E(A.sections):A.eachChild(S))};d=c.value,d._styleExpression&&S(d._styleExpression.expression)}return b}}let lV;var UTe={get paint(){return lV=lV||new ta({"background-color":new sn(q.paint_background["background-color"]),"background-pattern":new ny(q.paint_background["background-pattern"]),"background-opacity":new sn(q.paint_background["background-opacity"])})}};class zTe extends cs{constructor(c){super(c,UTe)}}let uV;var jTe={get paint(){return uV=uV||new ta({"raster-opacity":new sn(q.paint_raster["raster-opacity"]),"raster-hue-rotate":new sn(q.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new sn(q.paint_raster["raster-brightness-min"]),"raster-brightness-max":new sn(q.paint_raster["raster-brightness-max"]),"raster-saturation":new sn(q.paint_raster["raster-saturation"]),"raster-contrast":new sn(q.paint_raster["raster-contrast"]),"raster-resampling":new sn(q.paint_raster["raster-resampling"]),"raster-fade-duration":new sn(q.paint_raster["raster-fade-duration"])})}};class VTe extends cs{constructor(c){super(c,jTe)}}class HTe extends cs{constructor(c){super(c,{}),this.onAdd=d=>{this.implementation.onAdd&&this.implementation.onAdd(d,d.painter.context.gl)},this.onRemove=d=>{this.implementation.onRemove&&this.implementation.onRemove(d,d.painter.context.gl)},this.implementation=c}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class GTe{constructor(c){this._methodToThrottle=c,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._methodToThrottle()},0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const nk=63710088e-1;class md{constructor(c,d){if(isNaN(c)||isNaN(d))throw new Error(`Invalid LngLat object: (${c}, ${d})`);if(this.lng=+c,this.lat=+d,90<this.lat||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new md(se(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(c){var d=Math.PI/180,b=this.lat*d,m=c.lat*d,b=Math.sin(b)*Math.sin(m)+Math.cos(b)*Math.cos(m)*Math.cos((c.lng-this.lng)*d);return nk*Math.acos(Math.min(b,1))}static convert(c){if(c instanceof md)return c;if(Array.isArray(c)&&(c.length===2||c.length===3))return new md(Number(c[0]),Number(c[1]));if(Array.isArray(c)||typeof c!="object"||c===null)throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]");return new md(Number("lng"in c?c.lng:c.lon),Number(c.lat))}}const hV=2*Math.PI*nk;function dV(u){return hV*Math.cos(u*Math.PI/180)}function fV(u){return(180+u)/360}function pV(u){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+u*Math.PI/360)))/360}function gV(u,c){return u/dV(c)}function qTe(u){return 360*u-180}function rk(u){return 360/Math.PI*Math.atan(Math.exp((180-360*u)*Math.PI/180))-90}function $Te(u,c){return u*dV(rk(c))}function WTe(u){return 1/Math.cos(u*Math.PI/180)}class RT{constructor(c,d,m=0){this.x=+c,this.y=+d,this.z=+m}static fromLngLat(c,d=0){return c=md.convert(c),new RT(fV(c.lng),pV(c.lat),gV(d,c.lat))}toLngLat(){return new md(qTe(this.x),rk(this.y))}toAltitude(){return $Te(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/hV*WTe(rk(this.y))}}function YTe(b,c,d){var m=mV(256*b,256*(c=Math.pow(2,d)-c-1),d),b=mV(256*(b+1),256*(c+1),d);return m[0]+","+m[1]+","+b[0]+","+b[1]}function mV(u,c,d){return d=2*Math.PI*6378137/256/Math.pow(2,d),[u*d-2*Math.PI*6378137/2,c*d-2*Math.PI*6378137/2]}class ik{constructor(c,d,m){if(c<0||25<c||m<0||m>=Math.pow(2,c)||d<0||d>=Math.pow(2,c))throw new Error(`x=${d}, y=${m}, z=${c} outside of bounds. 0<=x<${Math.pow(2,c)}, 0<=y<${Math.pow(2,c)} 0<=z<=25 `);this.z=c,this.x=d,this.y=m,this.key=bb(0,c,c,d,m)}equals(c){return this.z===c.z&&this.x===c.x&&this.y===c.y}url(c,d,m){var b=YTe(this.x,this.y,this.z),E=KTe(this.z,this.x,this.y);return c[(this.x+this.y)%c.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(m==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,1<d?"@2x":"").replace(/{quadkey}/g,E).replace(/{bbox-epsg-3857}/g,b)}isChildOf(c){var d=this.z-c.z;return 0<d&&c.x===this.x>>d&&c.y===this.y>>d}getTilePoint(c){var d=Math.pow(2,this.z);return new p((c.x*d-this.x)*ct,(c.y*d-this.y)*ct)}toString(){return`${this.z}/${this.x}/`+this.y}}class yV{constructor(c,d){this.wrap=c,this.canonical=d,this.key=bb(c,d.z,d.z,d.x,d.y)}}class Fs{constructor(c,d,m,b,E){if(c<m)throw new Error(`overscaledZ should be >= z; overscaledZ = ${c}; z = `+m);this.overscaledZ=c,this.wrap=d,this.canonical=new ik(m,+b,+E),this.key=bb(d,c,m,b,E)}clone(){return new Fs(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(c){return this.overscaledZ===c.overscaledZ&&this.wrap===c.wrap&&this.canonical.equals(c.canonical)}scaledTo(c){if(c>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${c}; overscaledZ = `+this.overscaledZ);var d=this.canonical.z-c;return c>this.canonical.z?new Fs(c,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Fs(c,this.wrap,c,this.canonical.x>>d,this.canonical.y>>d)}calculateScaledKey(c,d){if(c>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${c}; overscaledZ = `+this.overscaledZ);var m=this.canonical.z-c;return c>this.canonical.z?bb(this.wrap*+d,c,this.canonical.z,this.canonical.x,this.canonical.y):bb(this.wrap*+d,c,c,this.canonical.x>>m,this.canonical.y>>m)}isChildOf(c){var d;return c.wrap===this.wrap&&(d=this.canonical.z-c.canonical.z,c.overscaledZ===0||c.overscaledZ<this.overscaledZ&&c.canonical.x===this.canonical.x>>d&&c.canonical.y===this.canonical.y>>d)}children(c){var d,m;return this.overscaledZ>=c?[new Fs(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)]:(c=this.canonical.z+1,d=2*this.canonical.x,m=2*this.canonical.y,[new Fs(c,this.wrap,c,d,m),new Fs(c,this.wrap,c,1+d,m),new Fs(c,this.wrap,c,d,1+m),new Fs(c,this.wrap,c,1+d,1+m)])}isLessThan(c){return this.wrap<c.wrap||!(this.wrap>c.wrap)&&(this.overscaledZ<c.overscaledZ||!(this.overscaledZ>c.overscaledZ)&&(this.canonical.x<c.canonical.x||!(this.canonical.x>c.canonical.x)&&this.canonical.y<c.canonical.y))}wrapped(){return new Fs(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(c){return new Fs(this.overscaledZ,c,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new yV(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/`+this.canonical.y}getTilePoint(c){return this.canonical.getTilePoint(new RT(c.x-this.wrap,c.y))}}function bb(u,c,d,m,b){var E=1<<d;return(E*E*(u=(u*=2)<0?-1*u-1:u)+E*b+m).toString(36)+d.toString(36)+c.toString(36)}function KTe(u,c,d){let m="",b;for(let E=u;0<E;E--)b=1<<E-1,m+=(c&b?1:0)+(d&b?2:0);return m}Ht("CanonicalTileID",ik),Ht("OverscaledTileID",Fs,{omit:["posMatrix"]});class _V{constructor(c,d,m,b=1,E=1,S=1,A=0){if(this.uid=c,d.height!==d.width)throw new RangeError("DEM tiles must be square");if(m&&!["mapbox","terrarium","custom"].includes(m))Ee(`"${m}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);else{this.stride=d.height;var I=this.dim=d.height-2;switch(this.data=new Uint32Array(d.data.buffer),m){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=b,this.greenFactor=E,this.blueFactor=S,this.baseShift=A;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let k=0;k<I;k++)this.data[this._idx(-1,k)]=this.data[this._idx(0,k)],this.data[this._idx(I,k)]=this.data[this._idx(I-1,k)],this.data[this._idx(k,-1)]=this.data[this._idx(k,0)],this.data[this._idx(k,I)]=this.data[this._idx(k,I-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(I,-1)]=this.data[this._idx(I-1,0)],this.data[this._idx(-1,I)]=this.data[this._idx(0,I-1)],this.data[this._idx(I,I)]=this.data[this._idx(I-1,I-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let k=0;k<I;k++)for(let U=0;U<I;U++){var O=this.get(k,U);O>this.max&&(this.max=O),O<this.min&&(this.min=O)}}}get(b,d){var m=new Uint8Array(this.data.buffer),b=4*this._idx(b,d);return this.unpack(m[b],m[1+b],m[2+b])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(c,d){if(c<-1||c>=this.dim+1||d<-1||d>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(d+1)*this.stride+(c+1)}unpack(c,d,m){return c*this.redFactor+d*this.greenFactor+m*this.blueFactor-this.baseShift}getPixels(){return new Ds({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(c,d,m){if(this.dim!==c.dim)throw new Error("dem dimension mismatch");let b=d*this.dim,E=d*this.dim+this.dim,S=m*this.dim,A=m*this.dim+this.dim;switch(d){case-1:b=E-1;break;case 1:E=b+1}switch(m){case-1:S=A-1;break;case 1:A=S+1}var I=-d*this.dim,O=-m*this.dim;for(let k=S;k<A;k++)for(let U=b;U<E;U++)this.data[this._idx(U,k)]=c.data[this._idx(U+I,k+O)]}}Ht("DEMData",_V);class vV{constructor(c){this._stringToNumber={},this._numberToString=[];for(let m=0;m<c.length;m++){var d=c[m];this._stringToNumber[d]=m,this._numberToString[m]=d}}encode(c){return this._stringToNumber[c]}decode(c){if(c>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${c} can't be >= this._numberToString.length `+this._numberToString.length);return this._numberToString[c]}}class bV{constructor(c,d,m,b,E){this.type="Feature",(this._vectorTileFeature=c)._z=d,c._x=m,c._y=b,this.properties=c.properties,this.id=E}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(c){this._geometry=c}toJSON(){var c={geometry:this.geometry};for(const d in this)d!=="_geometry"&&d!=="_vectorTileFeature"&&(c[d]=this[d]);return c}}class wV{constructor(c,d){this.tileID=c,this.x=c.canonical.x,this.y=c.canonical.y,this.z=c.canonical.z,this.grid=new lp(ct,16,0),this.grid3D=new lp(ct,16,0),this.featureIndexArray=new uy,this.promoteId=d}insert(c,d,m,b,E,S){var A=this.featureIndexArray.length,I=(this.featureIndexArray.emplaceBack(m,b,E),S?this.grid3D:this.grid);for(let W=0;W<d.length;W++){var O=d[W],k=[1/0,1/0,-1/0,-1/0];for(let re=0;re<O.length;re++){var U=O[re];k[0]=Math.min(k[0],U.x),k[1]=Math.min(k[1],U.y),k[2]=Math.max(k[2],U.x),k[3]=Math.max(k[3],U.y)}k[0]<ct&&k[1]<ct&&0<=k[2]&&0<=k[3]&&I.insert(A,k[0],k[1],k[2],k[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new pd.VectorTile(new $R(this.rawTileData)).layers,this.sourceLayerCoder=new vV(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(c,d,m,b){this.loadVTLayers();const E=c.params||{},S=ct/c.tileSize/c.scale,A=Km(E.filter),I=c.queryGeometry,O=c.queryPadding*S;var U=EV(I),k=this.grid.query(U.minX-O,U.minY-O,U.maxX+O,U.maxY+O),U=EV(c.cameraQueryGeometry);for(const fe of this.grid3D.query(U.minX-O,U.minY-O,U.maxX+O,U.maxY+O,(we,de,Me,Ve)=>Ln(c.cameraQueryGeometry,we-O,de-O,Me+O,Ve+O)))k.push(fe);k.sort(ZTe);var W={};let re;for(let fe=0;fe<k.length;fe++){var ie=k[fe];if(ie!==re){re=ie,ie=this.featureIndexArray.get(ie);let we=null;this.loadMatchingFeature(W,ie.bucketIndex,ie.sourceLayerIndex,ie.featureIndex,A,E.layers,E.availableImages,d,m,b,(de,Me,Ve)=>(we=we||Dt(de),Me.queryIntersectsFeature(I,de,Ve,we,this.z,c.transform,S,c.pixelPosMatrix)))}}return W}loadMatchingFeature(c,d,m,b,E,S,A,I,O,k,U){var W=this.bucketLayerIDs[d];if(!S||je(S,W)){var d=this.sourceLayerCoder.decode(m),re=this.vtLayers[d].feature(b);if(E.needGeometry){if(m=Yt(re,!0),!E.filter(new zr(this.tileID.overscaledZ),m,this.tileID.canonical))return}else if(!E.filter(new zr(this.tileID.overscaledZ),re))return;var ie=this.getId(re,d);for(let $e=0;$e<W.length;$e++){var fe=W[$e];if(!(S&&S.indexOf(fe)<0)){var we=I[fe];if(we){let Ye={};ie&&k&&(Ye=k.getState(we.sourceLayer||"_geojsonTileLayer",ie));var de=_e({},O[fe]),we=(de.paint=xV(de.paint,we.paint,re,Ye,A),de.layout=xV(de.layout,we.layout,re,Ye,A),!U||U(re,we,Ye));if(we){var Me=new bV(re,this.z,this.x,this.y,ie);Me.layer=de;let mt=c[fe];(mt=mt===void 0?c[fe]=[]:mt).push({featureIndex:b,feature:Me,intersectionZ:we})}}}}}}lookupSymbolFeatures(c,d,m,b,E,S,A,I){var O={},k=(this.loadVTLayers(),Km(E));for(const U of c)this.loadMatchingFeature(O,m,b,U,k,S,A,I,d);return O}hasLayer(c){for(const d of this.bucketLayerIDs)for(const m of d)if(c===m)return!0;return!1}getId(c,d){let m=c.id;return m=this.promoteId&&(d=typeof this.promoteId=="string"?this.promoteId:this.promoteId[d],typeof(m=c.properties[d])=="boolean")?Number(m):m}}function xV(u,c,d,m,b){return pe(u,(E,S)=>(S=c instanceof hp?c.get(S):null,S&&S.evaluate?S.evaluate(d,m,b):S))}function EV(u){let c=1/0,d=1/0,m=-1/0,b=-1/0;for(const E of u)c=Math.min(c,E.x),d=Math.min(d,E.y),m=Math.max(m,E.x),b=Math.max(b,E.y);return{minX:c,minY:d,maxX:m,maxY:b}}function ZTe(u,c){return c-u}function TV(u,c,d,m,b){var E=[];for(let A=0;A<u.length;A++){var S=u[A];let I;for(let O=0;O<S.length-1;O++){let k=S[O],U=S[O+1];k.x<c&&U.x<c||(k.x<c?k=new p(c,k.y+(U.y-k.y)*((c-k.x)/(U.x-k.x)))._round():U.x<c&&(U=new p(c,k.y+(U.y-k.y)*((c-k.x)/(U.x-k.x)))._round()),k.y<d&&U.y<d)||(k.y<d?k=new p(k.x+(U.x-k.x)*((d-k.y)/(U.y-k.y)),d)._round():U.y<d&&(U=new p(k.x+(U.x-k.x)*((d-k.y)/(U.y-k.y)),d)._round()),k.x>=m&&U.x>=m)||(k.x>=m?k=new p(m,k.y+(U.y-k.y)*((m-k.x)/(U.x-k.x)))._round():U.x>=m&&(U=new p(m,k.y+(U.y-k.y)*((m-k.x)/(U.x-k.x)))._round()),k.y>=b&&U.y>=b)||(k.y>=b?k=new p(k.x+(U.x-k.x)*((b-k.y)/(U.y-k.y)),b)._round():U.y>=b&&(U=new p(k.x+(U.x-k.x)*((b-k.y)/(U.y-k.y)),b)._round()),I&&k.equals(I[I.length-1])||(I=[k],E.push(I)),I.push(U))}}return E}Ht("FeatureIndex",wV,{omit:["rawTileData","sourceLayerCoder"]});class yd extends p{constructor(c,d,m,b){super(c,d),this.angle=m,b!==void 0&&(this.segment=b)}clone(){return new yd(this.x,this.y,this.angle,this.segment)}}function SV(u,c,d,m,b){if(c.segment!==void 0&&d!==0){let O=c,k=c.segment+1,U=0;for(;U>-d/2;){if(--k<0)return;U-=u[k].dist(O),O=u[k]}U+=u[k].dist(u[k+1]),k++;var E=[];let W=0;for(;U<d/2;){var S=u[k-1],A=u[k],I=u[k+1];if(!I)return;for(S=S.angleTo(A)-A.angleTo(I),S=Math.abs((S+3*Math.PI)%(2*Math.PI)-Math.PI),E.push({distance:U,angleDelta:S}),W+=S;U-E[0].distance>m;)W-=E.shift().angleDelta;if(W>b)return;k++,U+=A.dist(I)}}return 1}function CV(u){let c=0;for(let d=0;d<u.length-1;d++)c+=u[d].dist(u[d+1]);return c}function AV(u,c,d){return u?.6*c*d:0}function IV(u,c){return Math.max(u?u.right-u.left:0,c?c.right-c.left:0)}function XTe(u,c,d,k,U,re,S,A,I){var O=AV(k,re,S),k=IV(k,U),U=k*S,W=u[0].x===0||u[0].x===I||u[0].y===0||u[0].y===I,re=(c-U<c/4&&(c=U+c/4),2*re);return function ie(fe,we,de,Me,Ve,$e,Ye,et,mt){const zt=$e/2,Nt=CV(fe);let ut=0,kt=we-de,vt=[];for(let pt=0;pt<fe.length-1;pt++){const tt=fe[pt],Gt=fe[pt+1],jt=tt.dist(Gt),Wt=Gt.angleTo(tt);for(;kt+de<ut+jt;){const Sn=((kt+=de)-ut)/jt,$n=Fa.number(tt.x,Gt.x,Sn),An=Fa.number(tt.y,Gt.y,Sn);if(0<=$n&&$n<mt&&0<=An&&An<mt&&0<=kt-zt&&kt+zt<=Nt){const pr=new yd($n,An,Wt,pt);pr._round(),Me&&!SV(fe,pr,$e,Me,Ve)||vt.push(pr)}}ut+=jt}return et||vt.length||Ye||(vt=ie(fe,ut/2,de,Me,Ve,$e,Ye,!0,mt)),vt}(u,W?c/2*A%c:(k/2+re)*S*A%c,c,O,d,U,W,!1,I)}Ht("Anchor",yd);const by=Ua;function PV(u,c,d,m){var b=[];const E=u.image,S=E.pixelRatio;var A=E.paddedRect.w-2*by,I=E.paddedRect.h-2*by;let O={x1:u.left,y1:u.top,x2:u.right,y2:u.bottom};var k=E.stretchX||[[0,A]],U=E.stretchY||[[0,I]],de=(mn,kn)=>mn+kn[1]-kn[0];const W=k.reduce(de,0),re=U.reduce(de,0);var ie,fe,we,de=A-W,Me=I-re;let Ve=0,$e=W,Ye=0,et=re,mt=0,zt=de,Nt=0,ut=Me;E.content&&m&&(fe=(ie=E.content)[2]-ie[0],we=ie[3]-ie[1],E.contentMatch&&E.content&&(O=rV(u)),Ve=kT(k,0,ie[0]),Ye=kT(U,0,ie[1]),$e=kT(k,ie[0],ie[2]),et=kT(U,ie[1],ie[3]),mt=ie[0]-Ve,Nt=ie[1]-Ye,zt=fe-$e,ut=we-et);const kt=O.x1,vt=O.y1,pt=O.x2-kt,tt=O.y2-vt;var Gt=(uc,kn,cr,Lr)=>{var nr=(uc.stretch-Ve)/$e*pt+kt,vd=uc.fixed-mt-zt*uc.stretch/W,_a=(kn.stretch-Ye)/et*tt+vt,na=kn.fixed-Nt-ut*kn.stretch/re,lr=(cr.stretch-Ve)/$e*pt+kt,lc=cr.fixed-mt-zt*cr.stretch/W,Nc=(Lr.stretch-Ye)/et*tt+vt,Il=Lr.fixed-Nt-ut*Lr.stretch/re,Bs=new p(nr,_a),_a=new p(lr,_a),lr=new p(lr,Nc),nr=new p(nr,Nc),Nc=new p(vd/S,na/S),vd=new p(lc/S,Il/S),na=c*Math.PI/180,lc=(na&&(lc=Math.sin(na),Il=Math.cos(na),Bs._matMult(na=[Il,-lc,lc,Il]),_a._matMult(na),nr._matMult(na),lr._matMult(na)),uc.stretch+uc.fixed),Il=cr.stretch+cr.fixed,na=kn.stretch+kn.fixed,uc=Lr.stretch+Lr.fixed;return{tl:Bs,tr:_a,bl:nr,br:lr,tex:{x:E.paddedRect.x+by+lc,y:E.paddedRect.y+by+na,w:Il-lc,h:uc-na},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Nc,pixelOffsetBR:vd,minFontScaleX:zt/S/pt,minFontScaleY:ut/S/tt,isSDF:d}};if(m&&(E.stretchX||E.stretchY)){var jt=MV(k,de,W),Wt=MV(U,Me,re);for(let mn=0;mn<jt.length-1;mn++){var Sn=jt[mn],$n=jt[mn+1];for(let kn=0;kn<Wt.length-1;kn++){var An=Wt[kn],pr=Wt[kn+1];b.push(Gt(Sn,An,$n,pr))}}}else b.push(Gt({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:1+A},{fixed:0,stretch:1+I}));return b}function kT(u,c,d){let m=0;for(const b of u)m+=Math.max(c,Math.min(d,b[1]))-Math.max(c,Math.min(d,b[0]));return m}function MV(u,c,d){var m,b,E=[{fixed:-by,stretch:0}];for([m,b]of u){var S=E[E.length-1];E.push({fixed:m-S.stretch,stretch:S.stretch}),E.push({fixed:m-S.stretch,stretch:S.stretch+(b-m)})}return E.push({fixed:c+by,stretch:d}),E}function QTe(u,c,d,m,b,E,S,A){var I=m.layout.get("text-rotate").evaluate(E,{})*Math.PI/180,O=[];for(const Ye of c.positionedLines)for(const et of Ye.positionedGlyphs)if(et.rect){var k=et.rect||{};let mt=X9+1,zt=!0,Nt=1,ut=0;var U,$e=(b||A)&&et.vertical,W=et.metrics.advance*et.scale/2,re=(A&&c.verticalizable&&(re=(et.scale-1)*oo,U=(oo-et.metrics.width*et.scale)/2,ut=Ye.lineOffset/2-(et.imageName?-U:re)),et.imageName&&(U=S[et.imageName],zt=U.sdf,Nt=U.pixelRatio,mt=Ua/Nt),b?[et.x+W,et.y]:[0,0]);let kt=b?[0,0]:[et.x+W+d[0],et.y+d[1]-ut],vt=[0,0];$e&&(vt=kt,kt=[0,0]);var ie=et.metrics.isDoubleResolution?2:1,de=(et.metrics.left-mt)*et.scale-W+kt[0],we=(-et.metrics.top-mt)*et.scale+kt[1],Me=de+k.w/ie*et.scale/Nt,ie=we+k.h/ie*et.scale/Nt,fe=new p(de,we),we=new p(Me,we),de=new p(de,ie),Me=new p(Me,ie),Ve=($e&&(ie=new p(-W,W-yb),$e=-Math.PI/2,W=oo/2-W,Ve=et.imageName?W:0,W=new p(5-yb-W,-Ve),Ve=new p(...vt),fe._rotateAround($e,ie)._add(W)._add(Ve),we._rotateAround($e,ie)._add(W)._add(Ve),de._rotateAround($e,ie)._add(W)._add(Ve),Me._rotateAround($e,ie)._add(W)._add(Ve)),I&&($e=Math.sin(I),ie=Math.cos(I),fe._matMult(W=[ie,-$e,$e,ie]),we._matMult(W),de._matMult(W),Me._matMult(W)),new p(0,0)),$e=new p(0,0);O.push({tl:fe,tr:we,bl:de,br:Me,tex:k,writingMode:c.writingMode,glyphOffset:re,sectionIndex:et.sectionIndex,isSDF:zt,pixelOffsetTL:Ve,pixelOffsetBR:$e,minFontScaleX:0,minFontScaleY:0})}return O}class OT{constructor(c,d,m,b,E,S,A,I,O,k){if(this.boxStartIndex=c.length,O){let W=S.top,re=S.bottom;var O=S.collisionPadding,O=(O&&(W-=O[1],re+=O[3]),re-W);0<O&&(O=Math.max(10,O),this.circleDiameter=O)}else{var U,O=(O=S.image)!=null&&O.contentMatch&&S.image.content?rV(S):{x1:S.left,y1:S.top,x2:S.right,y2:S.bottom},I=(O.y1=O.y1*A-I[0],O.x2=O.x2*A+I[1],O.y2=O.y2*A+I[2],O.x1=O.x1*A-I[3],S.collisionPadding);I&&(O.x1-=I[0]*A,O.y1-=I[1]*A,O.x2+=I[2]*A,O.y2+=I[3]*A),k&&(S=new p(O.x1,O.y1),I=new p(O.x2,O.y1),A=new p(O.x1,O.y2),U=new p(O.x2,O.y2),k=k*Math.PI/180,S._rotate(k),I._rotate(k),A._rotate(k),U._rotate(k),O.x1=Math.min(S.x,I.x,A.x,U.x),O.x2=Math.max(S.x,I.x,A.x,U.x),O.y1=Math.min(S.y,I.y,A.y,U.y),O.y2=Math.max(S.y,I.y,A.y,U.y)),c.emplaceBack(d.x,d.y,O.x1,O.y1,O.x2,O.y2,m,b,E)}this.boxEndIndex=c.length}}class JTe{constructor(c=[],d=eSe){if(this.data=c,this.length=this.data.length,this.compare=d,0<this.length)for(let m=(this.length>>1)-1;0<=m;m--)this._down(m)}push(c){this.data.push(c),this.length++,this._up(this.length-1)}pop(){var c,d;if(this.length!==0)return c=this.data[0],d=this.data.pop(),this.length--,0<this.length&&(this.data[0]=d,this._down(0)),c}peek(){return this.data[0]}_up(c){for(var{data:d,compare:m}=this,b=d[c];0<c;){var E=c-1>>1,S=d[E];if(0<=m(b,S))break;d[c]=S,c=E}d[c]=b}_down(c){for(var{data:d,compare:m}=this,b=this.length>>1,E=d[c];c<b;){let A=1+(c<<1),I=d[A];var S=A+1;if(S<this.length&&m(d[S],I)<0&&(A=S,I=d[S]),0<=m(I,E))break;d[c]=I,c=A}d[c]=E}}function eSe(u,c){return u<c?-1:c<u?1:0}function tSe(u,c=1,d=!1){let m=1/0,b=1/0,E=-1/0,S=-1/0;var A=u[0];for(let de=0;de<A.length;de++){var I=A[de];(!de||I.x<m)&&(m=I.x),(!de||I.y<b)&&(b=I.y),(!de||I.x>E)&&(E=I.x),(!de||I.y>S)&&(S=I.y)}var O=E-m,k=S-b,U=Math.min(O,k);let W=U/2;var re=new JTe([],nSe);if(U===0)return new p(m,b);for(let de=m;de<E;de+=U)for(let Me=b;Me<S;Me+=U)re.push(new wy(de+W,Me+W,W,u));let ie=function(de){let Me=0,Ve=0,$e=0;var Ye=de[0];for(let Nt=0,ut=Ye.length,kt=ut-1;Nt<ut;kt=Nt++){var et=Ye[Nt],mt=Ye[kt],zt=et.x*mt.y-mt.x*et.y;Ve+=(et.x+mt.x)*zt,$e+=(et.y+mt.y)*zt,Me+=3*zt}return new wy(Ve/Me,$e/Me,0,de)}(u),fe=re.length;for(;re.length;){var we=re.pop();(we.d>ie.d||!ie.d)&&(ie=we,d)&&console.log("found best %d after %d probes",Math.round(1e4*we.d)/1e4,fe),we.max-ie.d<=c||(W=we.h/2,re.push(new wy(we.p.x-W,we.p.y-W,W,u)),re.push(new wy(we.p.x+W,we.p.y-W,W,u)),re.push(new wy(we.p.x-W,we.p.y+W,W,u)),re.push(new wy(we.p.x+W,we.p.y+W,W,u)),fe+=4)}return d&&(console.log("num probes: "+fe),console.log("best distance: "+ie.d)),ie.p}function nSe(u,c){return c.max-u.max}function wy(u,c,d,m){this.p=new p(u,c),this.h=d,this.d=function(b,E){let S=!1,A=1/0;for(let U=0;U<E.length;U++){var I=E[U];for(let W=0,re=I.length,ie=re-1;W<re;ie=W++){var O=I[W],k=I[ie];O.y>b.y!=k.y>b.y&&b.x<(k.x-O.x)*(b.y-O.y)/(k.y-O.y)+O.x&&(S=!S),A=Math.min(A,Rr(b,O,k))}}return(S?1:-1)*Math.sqrt(A)}(this.p,m),this.max=this.d+this.h*Math.SQRT2}i.TextAnchorEnum=void 0,(Or=i.TextAnchorEnum||(i.TextAnchorEnum={}))[Or.center=1]="center",Or[Or.left=2]="left",Or[Or.right=3]="right",Or[Or.top=4]="top",Or[Or.bottom=5]="bottom",Or[Or["top-left"]=6]="top-left",Or[Or["top-right"]=7]="top-right",Or[Or["bottom-left"]=8]="bottom-left",Or[Or["bottom-right"]=9]="bottom-right";const _d=7,ok=Number.POSITIVE_INFINITY;function RV(u,c){if(c[1]!==ok){var d=u,m=c[0],b=c[1];let A=0,I=0;switch(m=Math.abs(m),b=Math.abs(b),d){case"top-right":case"top-left":case"top":I=b-_d;break;case"bottom-right":case"bottom-left":case"bottom":I=-b+_d}switch(d){case"top-right":case"bottom-right":case"right":A=-m;break;case"top-left":case"bottom-left":case"left":A=m}return[A,I]}{var d=u,E=c[0];let I=0,O=0;var S=(E=E<0?0:E)/Math.SQRT2;switch(d){case"top-right":case"top-left":O=S-_d;break;case"bottom-right":case"bottom-left":O=-S+_d;break;case"bottom":O=-E+_d;break;case"top":O=E-_d}switch(d){case"top-right":case"bottom-right":I=-S;break;case"top-left":case"bottom-left":I=S;break;case"left":I=E;break;case"right":I=-E}return[I,O]}}function kV(u,c,d){var m=u.layout,b=(b=m.get("text-variable-anchor-offset"))==null?void 0:b.evaluate(c,{},d);if(b){var E=b.values,S=[];for(let k=0;k<E.length;k+=2){var A=S[k]=E[k],I=E[k+1].map(U=>U*oo);A.startsWith("top")?I[1]-=_d:A.startsWith("bottom")&&(I[1]+=_d),S[k+1]=I}return new Jo(S)}if(b=m.get("text-variable-anchor"),b){let k;var u=u._unevaluatedLayout,O=(k=u.getValue("text-radial-offset")!==void 0?[m.get("text-radial-offset").evaluate(c,{},d)*oo,ok]:m.get("text-offset").evaluate(c,{},d).map(W=>W*oo),[]);for(const W of b)O.push(W,RV(W,k));return new Jo(O)}return null}function ak(u){switch(u){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function OV(u,c,d,m,b,E,S,A,I,O,k,U,W,re,ie){d=QTe(0,d,A,b,E,S,m,u.allowVerticalPlacement),m=u.textSizeData;let fe=null;m.kind==="source"?(fe=[Al*b.layout.get("text-size").evaluate(S,{})])[0]>gd&&Ee(`${u.layerIds[0]}: Value for "text-size" is >= ${vb}. Reduce your "text-size".`):m.kind==="composite"&&((fe=[Al*re.compositeTextSizes[0].evaluate(S,{},ie),Al*re.compositeTextSizes[1].evaluate(S,{},ie)])[0]>gd||fe[1]>gd)&&Ee(`${u.layerIds[0]}: Value for "text-size" is >= ${vb}. Reduce your "text-size".`),u.addSymbols(u.text,d,fe,A,E,S,O,c,I.lineStartIndex,I.lineLength,W,ie);for(const we of k)U[we]=u.text.placedSymbolArray.length-1;return 4*d.length}function LV(u){for(const c in u)return u[c];return null}const NV=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];function sk(u,c,d,m,b,E){var S;b-m<=d||(function A(I,O,k,U,W,re){for(;U<W;){if(600<W-U){const de=W-U+1,Me=k-U+1,Ve=Math.log(de),$e=.5*Math.exp(2*Ve/3),Ye=.5*Math.sqrt(Ve*$e*(de-$e)/de)*(Me-de/2<0?-1:1),et=Math.max(U,Math.floor(k-Me*$e/de+Ye)),mt=Math.min(W,Math.floor(k+(de-Me)*$e/de+Ye));A(I,O,k,et,mt,re)}const ie=O[2*k+re];let fe=U,we=W;for(wb(I,O,U,k),O[2*W+re]>ie&&wb(I,O,U,W);fe<we;){for(wb(I,O,fe,we),fe++,we--;O[2*fe+re]<ie;)fe++;for(;O[2*we+re]>ie;)we--}O[2*U+re]===ie?wb(I,O,U,we):(we++,wb(I,O,we,W)),we<=k&&(U=we+1),k<=we&&(W=we-1)}}(u,c,S=m+b>>1,m,b,E),sk(u,c,d,m,S-1,1-E),sk(u,c,d,1+S,b,1-E))}function wb(u,c,d,m){ck(u,d,m),ck(c,2*d,2*m),ck(c,2*d+1,2*m+1)}function ck(u,c,d){var m=u[c];u[c]=u[d],u[d]=m}function DV(u,c,d,m){return u-=d,d=c-m,u*u+d*d}i.PerformanceMarkers=void 0,(ao=i.PerformanceMarkers||(i.PerformanceMarkers={})).create="create",ao.load="load",ao.fullLoad="fullLoad";let LT=null,xb=[];const lk=1e3/60,uk="loadTime",hk="fullLoadTime";Or={mark(u){performance.mark(u)},frame(u){var c;LT!=null&&(c=u-LT,xb.push(c)),LT=u},clearMetrics(){LT=null,xb=[],performance.clearMeasures(uk),performance.clearMeasures(hk);for(const u in i.PerformanceMarkers)performance.clearMarks(i.PerformanceMarkers[u])},getPerformanceMetrics(){performance.measure(uk,i.PerformanceMarkers.create,i.PerformanceMarkers.load),performance.measure(hk,i.PerformanceMarkers.create,i.PerformanceMarkers.fullLoad);var u=performance.getEntriesByName(uk)[0].duration,c=performance.getEntriesByName(hk)[0].duration,d=xb.length,m=1/(xb.reduce((E,S)=>E+S,0)/d/1e3),b=xb.filter(E=>E>lk).reduce((E,S)=>E+(S-lk)/lk,0);return{loadTime:u,fullLoadTime:c,fps:m,percentDroppedFrames:b/(d+b)*100,totalFrames:d}}},i.AJAXError=Ot,i.Actor=class{constructor(u,c){this.target=u,this.mapId=c,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new GTe(()=>this.process()),this.subscription=wt(this.target,"message",d=>this.receive(d),!1),this.globalScope=Be(self)?u:window}registerMessageHandler(u,c){this.messageHandlers[u]=c}sendAsync(u,c){return new Promise((d,m)=>{const b=Math.round(1e18*Math.random()).toString(36).substring(0,10);this.resolveRejects[b]={resolve:d,reject:m},c&&c.signal.addEventListener("abort",()=>{delete this.resolveRejects[b];var E={id:b,type:"<cancel>",origin:location.origin,targetMapId:u.targetMapId,sourceMapId:this.mapId};this.target.postMessage(E)},{once:!0}),d=[],m=Object.assign(Object.assign({},u),{id:b,sourceMapId:this.mapId,origin:location.origin,data:Oc(u.data,d)}),this.target.postMessage(m,{transfer:d})})}receive(d){var c,d=d.data,m=d.id;d.origin!=="file://"&&location.origin!=="file://"&&d.origin!==location.origin||d.targetMapId&&this.mapId!==d.targetMapId||(d.type==="<cancel>"?(delete this.tasks[m],c=this.abortControllers[m],delete this.abortControllers[m],c&&c.abort()):Be(self)||d.mustQueue?(this.tasks[m]=d,this.taskQueue.push(m),this.invoker.trigger()):this.processTask(m,d))}process(){var u,c;this.taskQueue.length!==0&&(u=this.taskQueue.shift(),c=this.tasks[u],delete this.tasks[u],0<this.taskQueue.length&&this.invoker.trigger(),c)&&this.processTask(u,c)}processTask(u,c){return o(this,void 0,void 0,function*(){if(c.type==="<response>")return d=this.resolveRejects[u],delete this.resolveRejects[u],d?void(c.error?d.reject(od(c.error)):d.resolve(od(c.data))):void 0;if(this.messageHandlers[c.type]){var d=od(c.data),m=new AbortController;this.abortControllers[u]=m;try{var b=yield this.messageHandlers[c.type](c.sourceMapId,d,m);this.completeTask(u,null,b)}catch(E){this.completeTask(u,E)}}else this.completeTask(u,new Error(`Could not find a registered handler for ${c.type}, map ID: ${this.mapId}, available handlers: `+Object.keys(this.messageHandlers).join(", ")))})}completeTask(b,c,d){var m=[],b=(delete this.abortControllers[b],{id:b,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:c?Oc(c):null,data:Oc(d,m)});this.target.postMessage(b,{transfer:m})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},i.AlphaImage=lb,i.CanonicalTileID=ik,i.CollisionBoxArray=hT,i.CollisionCircleLayoutArray=class extends Q0{},i.Color=ir,i.DEMData=_V,i.DataConstantProperty=sn,i.DictionaryCoder=vV,i.EXTENT=ct,i.ErrorEvent=Q,i.EvaluationParameters=zr,i.Event=D,i.Evented=ae,i.FeatureIndex=wV,i.FillBucket=zR,i.FillExtrusionBucket=VR,i.GLOBAL_DISPATCHER_ID=Mn,i.GeoJSONFeature=bV,i.ImageAtlas=J9,i.ImagePosition=YR,i.KDBush=class QV{static from(c){if(!(c instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");var d,[m,b]=new Uint8Array(c,0,2);if(m!==219)throw new Error("Data does not appear to be in a KDBush format.");if((m=b>>4)!=1)throw new Error(`Got v${m} data when expected v1.`);if(m=NV[15&b])return[b]=new Uint16Array(c,2,1),[d]=new Uint32Array(c,4,1),new QV(d,b,m,c);throw new Error("Unrecognized array type.")}constructor(c,d=64,m=Float64Array,b){if(isNaN(c)||c<0)throw new Error(`Unpexpected numItems value: ${c}.`);this.numItems=+c,this.nodeSize=Math.min(Math.max(+d,2),65535),this.ArrayType=m,this.IndexArrayType=c<65536?Uint16Array:Uint32Array;var E=NV.indexOf(this.ArrayType),S=2*c*this.ArrayType.BYTES_PER_ELEMENT,A=c*this.IndexArrayType.BYTES_PER_ELEMENT,I=(8-A%8)%8;if(E<0)throw new Error(`Unexpected typed array class: ${m}.`);b&&b instanceof ArrayBuffer?(this.data=b,this.ids=new this.IndexArrayType(this.data,8,c),this.coords=new this.ArrayType(this.data,8+A+I,2*c),this._pos=2*c,this._finished=!0):(this.data=new ArrayBuffer(8+S+A+I),this.ids=new this.IndexArrayType(this.data,8,c),this.coords=new this.ArrayType(this.data,8+A+I,2*c),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+E]),new Uint16Array(this.data,2,1)[0]=d,new Uint32Array(this.data,4,1)[0]=c)}add(c,d){var m=this._pos>>1;return this.ids[m]=m,this.coords[this._pos++]=c,this.coords[this._pos++]=d,m}finish(){var c=this._pos>>1;if(c!==this.numItems)throw new Error(`Added ${c} items when expected ${this.numItems}.`);return sk(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(c,d,m,b){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");for(var{ids:E,coords:S,nodeSize:A}=this,I=[0,E.length-1,0],O=[];I.length;){var k=I.pop()||0,U=I.pop()||0,W=I.pop()||0;if(U-W<=A)for(let Me=W;Me<=U;Me++){var re=S[2*Me],ie=S[2*Me+1];c<=re&&re<=m&&d<=ie&&ie<=b&&O.push(E[Me])}else{var fe=W+U>>1,we=S[2*fe],de=S[2*fe+1];c<=we&&we<=m&&d<=de&&de<=b&&O.push(E[fe]),(k===0?c<=we:d<=de)&&(I.push(W),I.push(fe-1),I.push(1-k)),(k===0?we<=m:de<=b)&&(I.push(1+fe),I.push(U),I.push(1-k))}}return O}within(c,d,m){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");for(var{ids:b,coords:E,nodeSize:S}=this,A=[0,b.length-1,0],I=[],O=m*m;A.length;){var k=A.pop()||0,U=A.pop()||0,W=A.pop()||0;if(U-W<=S)for(let we=W;we<=U;we++)DV(E[2*we],E[2*we+1],c,d)<=O&&I.push(b[we]);else{var re=W+U>>1,ie=E[2*re],fe=E[2*re+1];DV(ie,fe,c,d)<=O&&I.push(b[re]),(k===0?c-m<=ie:d-m<=fe)&&(A.push(W),A.push(re-1),A.push(1-k)),(k===0?ie<=c+m:fe<=d+m)&&(A.push(1+re),A.push(U),A.push(1-k))}}return I}},i.LineBucket=HR,i.LineStripIndexArray=class extends El{},i.LngLat=md,i.MercatorCoordinate=RT,i.ONE_EM=oo,i.OverscaledTileID=Fs,i.PerformanceUtils=Or,i.Point=p,i.Pos3dArray=class extends pp{},i.PosArray=ab,i.Properties=ta,i.Protobuf=$R,i.QuadTriangleArray=class extends mp{},i.RGBAImage=Ds,i.RasterBoundsArray=class extends Y0{},i.RequestPerformance=class{constructor(u){this._marks={start:[u.url,"start"].join("#"),end:[u.url,"end"].join("#"),measure:u.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let u=performance.getEntriesByName(this._marks.measure);return u.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),u=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),u}},i.SegmentVector=w,i.SymbolBucket=vy,i.Transitionable=ey,i.TriangleIndexArray=hd,i.Uniform1f=G,i.Uniform1i=class extends N{constructor(u,c){super(u,c),this.current=0}set(u){this.current!==u&&(this.current=u,this.gl.uniform1i(this.location,u))}},i.Uniform2f=class extends N{constructor(u,c){super(u,c),this.current=[0,0]}set(u){u[0]===this.current[0]&&u[1]===this.current[1]||(this.current=u,this.gl.uniform2f(this.location,u[0],u[1]))}},i.Uniform3f=class extends N{constructor(u,c){super(u,c),this.current=[0,0,0]}set(u){u[0]===this.current[0]&&u[1]===this.current[1]&&u[2]===this.current[2]||(this.current=u,this.gl.uniform3f(this.location,u[0],u[1],u[2]))}},i.Uniform4f=Z,i.UniformColor=j,i.UniformMatrix4f=class extends N{constructor(u,c){super(u,c),this.current=X}set(u){if(u[12]!==this.current[12]||u[0]!==this.current[0])this.current=u,this.gl.uniformMatrix4fv(this.location,!1,u);else for(let c=1;c<16;c++)if(u[c]!==this.current[c]){this.current=u,this.gl.uniformMatrix4fv(this.location,!1,u);break}}},i.UnwrappedTileID=yV,i.ValidationError=Te,i.ZoomHistory=oT,i.__awaiter=o,i.add=function(u,c,d){return u[0]=c[0]+d[0],u[1]=c[1]+d[1],u[2]=c[2]+d[2],u},i.addDynamicAttributes=QR,i.addProtocol=function(u,c){Qt.REGISTERED_PROTOCOLS[u]=c},i.arrayBufferToImage=u=>new Promise((c,d)=>{const m=new Image;m.onload=()=>{c(m),URL.revokeObjectURL(m.src),m.onload=null,window.requestAnimationFrame(()=>{m.src=Re})},m.onerror=()=>d(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));var b=new Blob([new Uint8Array(u)],{type:"image/png"});m.src=u.byteLength?URL.createObjectURL(b):Re}),i.arrayBufferToImageBitmap=u=>o(void 0,void 0,void 0,function*(){if(u.byteLength===0)return createImageBitmap(new ImageData(1,1));var c=new Blob([new Uint8Array(u)],{type:"image/png"});try{return createImageBitmap(c)}catch(d){throw new Error(`Could not load image because of ${d.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}}),i.bezier=ee,i.clamp=ce,i.clipLine=TV,i.clone=function(u){var c=new xi(16);return c[0]=u[0],c[1]=u[1],c[2]=u[2],c[3]=u[3],c[4]=u[4],c[5]=u[5],c[6]=u[6],c[7]=u[7],c[8]=u[8],c[9]=u[9],c[10]=u[10],c[11]=u[11],c[12]=u[12],c[13]=u[13],c[14]=u[14],c[15]=u[15],c},i.clone$1=xe,i.clone$2=function(u){var c=new xi(3);return c[0]=u[0],c[1]=u[1],c[2]=u[2],c},i.collisionCircleLayout=Rc,i.config=Qt,i.copy=function(u,c){return u[0]=c[0],u[1]=c[1],u[2]=c[2],u[3]=c[3],u[4]=c[4],u[5]=c[5],u[6]=c[6],u[7]=c[7],u[8]=c[8],u[9]=c[9],u[10]=c[10],u[11]=c[11],u[12]=c[12],u[13]=c[13],u[14]=c[14],u[15]=c[15],u},i.create=function(){var u=new xi(16);return xi!=Float32Array&&(u[1]=0,u[2]=0,u[3]=0,u[4]=0,u[6]=0,u[7]=0,u[8]=0,u[9]=0,u[11]=0,u[12]=0,u[13]=0,u[14]=0),u[0]=1,u[5]=1,u[10]=1,u[15]=1,u},i.create$1=ic,i.create$2=function(){var u=new xi(4);return xi!=Float32Array&&(u[1]=0,u[2]=0),u[0]=1,u[3]=1,u},i.createAbortError=qn,i.createExpression=$m,i.createFilter=Km,i.createLayout=Bi,i.createStyleLayer=function(u){if(u.type==="custom")return new HTe(u);switch(u.type){case"background":return new zTe(u);case"circle":return new sc(u);case"fill":return new WEe(u);case"fill-extrusion":return new aTe(u);case"heatmap":return new BEe(u);case"hillshade":return new zEe(u);case"line":return new gTe(u);case"raster":return new VTe(u);case"symbol":return new MT(u)}},i.cross=oc,i.deepEqual=function u(c,d){if(Array.isArray(c)){if(!Array.isArray(d)||c.length!==d.length)return!1;for(let m=0;m<c.length;m++)if(!u(c[m],d[m]))return!1}else{if(typeof c!="object"||c===null||d===null)return c===d;if(typeof d!="object"||Object.keys(c).length!==Object.keys(d).length)return!1;for(const m in c)if(!u(c[m],d[m]))return!1}return!0},i.defaultEasing=g,i.degreesToRadians=function(u){return u*Math.PI/180},i.derefLayers=function(u){u=u.slice();var c=Object.create(null);for(let d=0;d<u.length;d++)c[u[d].id]=u[d];for(let d=0;d<u.length;d++)"ref"in u[d]&&(u[d]=function(m,b){const E={};for(const S in m)S!=="ref"&&(E[S]=m[S]);return Ae.forEach(S=>{S in b&&(E[S]=b[S])}),E}(u[d],c[u[d].ref]));return u},i.diffStyles=function(u,c){if(!u)return[{command:"setStyle",args:[c]}];let d=[];try{if(!Pe(u.version,c.version))return[{command:"setStyle",args:[c]}];Pe(u.center,c.center)||d.push({command:"setCenter",args:[c.center]}),Pe(u.zoom,c.zoom)||d.push({command:"setZoom",args:[c.zoom]}),Pe(u.bearing,c.bearing)||d.push({command:"setBearing",args:[c.bearing]}),Pe(u.pitch,c.pitch)||d.push({command:"setPitch",args:[c.pitch]}),Pe(u.sprite,c.sprite)||d.push({command:"setSprite",args:[c.sprite]}),Pe(u.glyphs,c.glyphs)||d.push({command:"setGlyphs",args:[c.glyphs]}),Pe(u.transition,c.transition)||d.push({command:"setTransition",args:[c.transition]}),Pe(u.light,c.light)||d.push({command:"setLight",args:[c.light]}),Pe(u.terrain,c.terrain)||d.push({command:"setTerrain",args:[c.terrain]}),Pe(u.sky,c.sky)||d.push({command:"setSky",args:[c.sky]});const fe={};var m=[];Bt(u.sources,c.sources,m,fe);const we=[];u.layers&&u.layers.forEach(de=>{"source"in de&&fe[de.source]?d.push({command:"removeLayer",args:[de.id]}):we.push(de)}),d=d.concat(m);{var b=we,E=c.layers,S=d;E=E||[];var A,I,O=(b=b||[]).map(an),k=E.map(an),U=b.reduce(Ie,{}),W=E.reduce(Ie,{}),re=O.slice(),ie=Object.create(null);let de,Me,Ve;for(let $e=0,Ye=0;$e<O.length;$e++)de=O[$e],Object.prototype.hasOwnProperty.call(W,de)?Ye++:(We(S,{command:"removeLayer",args:[de]}),re.splice(re.indexOf(de,Ye),1));for(let $e=0,Ye=0;$e<k.length;$e++)de=k[k.length-1-$e],re[re.length-1-$e]!==de&&(Object.prototype.hasOwnProperty.call(U,de)?(We(S,{command:"removeLayer",args:[de]}),re.splice(re.lastIndexOf(de,re.length-Ye),1)):Ye++,Me=re[re.length-$e],We(S,{command:"addLayer",args:[W[de],Me]}),re.splice(re.length-$e,0,de),ie[de]=!0);for(let $e=0;$e<k.length;$e++)if(A=U[de=k[$e]],I=W[de],!ie[de]&&!Pe(A,I))if(Pe(A.source,I.source)&&Pe(A["source-layer"],I["source-layer"])&&Pe(A.type,I.type)){for(Ve in Lt(A.layout,I.layout,S,de,null,"setLayoutProperty"),Lt(A.paint,I.paint,S,de,null,"setPaintProperty"),Pe(A.filter,I.filter)||We(S,{command:"setFilter",args:[de,I.filter]}),Pe(A.minzoom,I.minzoom)&&Pe(A.maxzoom,I.maxzoom)||We(S,{command:"setLayerZoomRange",args:[de,I.minzoom,I.maxzoom]}),A)Object.prototype.hasOwnProperty.call(A,Ve)&&Ve!=="layout"&&Ve!=="paint"&&Ve!=="filter"&&Ve!=="metadata"&&Ve!=="minzoom"&&Ve!=="maxzoom"&&(Ve.indexOf("paint.")===0?Lt(A[Ve],I[Ve],S,de,Ve.slice(6),"setPaintProperty"):Pe(A[Ve],I[Ve])||We(S,{command:"setLayerProperty",args:[de,Ve,I[Ve]]}));for(Ve in I)Object.prototype.hasOwnProperty.call(I,Ve)&&!Object.prototype.hasOwnProperty.call(A,Ve)&&Ve!=="layout"&&Ve!=="paint"&&Ve!=="filter"&&Ve!=="metadata"&&Ve!=="minzoom"&&Ve!=="maxzoom"&&(Ve.indexOf("paint.")===0?Lt(A[Ve],I[Ve],S,de,Ve.slice(6),"setPaintProperty"):Pe(A[Ve],I[Ve])||We(S,{command:"setLayerProperty",args:[de,Ve,I[Ve]]}))}else We(S,{command:"removeLayer",args:[de]}),We(S,{command:"addLayer",args:[I,Me=re[re.lastIndexOf(de)+1]]})}}catch(fe){console.warn("Unable to compute style diff:",fe),d=[{command:"setStyle",args:[c]}]}return d},i.dot=Tl,i.dot$1=function(u,c){return u[0]*c[0]+u[1]*c[1]+u[2]*c[2]+u[3]*c[3]},i.earthRadius=nk,i.emitValidationErrors=iT,i.emptyStyle=function(){var u={},c=q.$version;for(const m in q.$root){var d=q.$root[m];if(d.required){let b=null;(b=m==="version"?c:d.type==="array"?[]:{})!=null&&(u[m]=b)}}return u},i.equals=function(de,Wt){var d=de[0],m=de[1],b=de[2],E=de[3],S=de[4],A=de[5],I=de[6],O=de[7],k=de[8],U=de[9],W=de[10],re=de[11],ie=de[12],fe=de[13],we=de[14],de=de[15],Me=Wt[0],Ve=Wt[1],$e=Wt[2],Ye=Wt[3],et=Wt[4],mt=Wt[5],zt=Wt[6],Nt=Wt[7],ut=Wt[8],kt=Wt[9],vt=Wt[10],pt=Wt[11],tt=Wt[12],Gt=Wt[13],jt=Wt[14],Wt=Wt[15];return Math.abs(d-Me)<=ui*Math.max(1,Math.abs(d),Math.abs(Me))&&Math.abs(m-Ve)<=ui*Math.max(1,Math.abs(m),Math.abs(Ve))&&Math.abs(b-$e)<=ui*Math.max(1,Math.abs(b),Math.abs($e))&&Math.abs(E-Ye)<=ui*Math.max(1,Math.abs(E),Math.abs(Ye))&&Math.abs(S-et)<=ui*Math.max(1,Math.abs(S),Math.abs(et))&&Math.abs(A-mt)<=ui*Math.max(1,Math.abs(A),Math.abs(mt))&&Math.abs(I-zt)<=ui*Math.max(1,Math.abs(I),Math.abs(zt))&&Math.abs(O-Nt)<=ui*Math.max(1,Math.abs(O),Math.abs(Nt))&&Math.abs(k-ut)<=ui*Math.max(1,Math.abs(k),Math.abs(ut))&&Math.abs(U-kt)<=ui*Math.max(1,Math.abs(U),Math.abs(kt))&&Math.abs(W-vt)<=ui*Math.max(1,Math.abs(W),Math.abs(vt))&&Math.abs(re-pt)<=ui*Math.max(1,Math.abs(re),Math.abs(pt))&&Math.abs(ie-tt)<=ui*Math.max(1,Math.abs(ie),Math.abs(tt))&&Math.abs(fe-Gt)<=ui*Math.max(1,Math.abs(fe),Math.abs(Gt))&&Math.abs(we-jt)<=ui*Math.max(1,Math.abs(we),Math.abs(jt))&&Math.abs(de-Wt)<=ui*Math.max(1,Math.abs(de),Math.abs(Wt))},i.evaluateSizeForFeature=function(u,{uSize:c,uSizeT:d},{lowerSize:m,upperSize:b}){return u.kind==="source"?m/Al:u.kind==="composite"?Fa.number(m/Al,b/Al,d):c},i.evaluateSizeForZoom=function(u,c){let d=0,m=0;var b,E,S;return u.kind==="constant"?m=u.layoutSize:u.kind!=="source"&&({interpolationType:S,minZoom:b,maxZoom:E}=u,S=S?ce(Ba.interpolationFactor(S,c,b,E),0,1):0,u.kind==="camera"?m=Fa.number(u.minSize,u.maxSize,S):d=S),{uSizeT:d,uSize:m}},i.exactEquals=function(u,c){return u[0]===c[0]&&u[1]===c[1]&&u[2]===c[2]&&u[3]===c[3]&&u[4]===c[4]&&u[5]===c[5]&&u[6]===c[6]&&u[7]===c[7]&&u[8]===c[8]&&u[9]===c[9]&&u[10]===c[10]&&u[11]===c[11]&&u[12]===c[12]&&u[13]===c[13]&&u[14]===c[14]&&u[15]===c[15]},i.extend=_e,i.filterObject=ue,i.findLineIntersection=function(u,E,d,A){var b=E.y-u.y,E=E.x-u.x,S=A.y-d.y,A=A.x-d.x,I=S*E-A*b;return I==0?null:(A=(A*(u.y-d.y)-S*(u.x-d.x))/I,new p(u.x+A*E,u.y+A*b))},i.fromRotation=function(u,m){var d=Math.sin(m),m=Math.cos(m);return u[0]=m,u[1]=d,u[2]=0,u[3]=-d,u[4]=m,u[5]=0,u[6]=0,u[7]=0,u[8]=1,u},i.fromScaling=function(u,c){return u[0]=c[0],u[1]=0,u[2]=0,u[3]=0,u[4]=0,u[5]=c[1],u[6]=0,u[7]=0,u[8]=0,u[9]=0,u[10]=c[2],u[11]=0,u[12]=0,u[13]=0,u[14]=0,u[15]=1,u},i.getAnchorAlignment=ZR,i.getAnchorJustification=ak,i.getArrayBuffer=(u,c)=>Pt(_e(u,{type:"arrayBuffer"}),c),i.getDefaultExportFromCjs=a,i.getImageData=function(u,c,d,m,b){return o(this,void 0,void 0,function*(){if(F())try{return yield ht(u,c,d,m,b)}catch{}return S=c,A=d,I=m,O=b,k=(E=u).width,U=E.height,Rt&&dn||(Rt=new OffscreenCanvas(k,U),dn=Rt.getContext("2d",{willReadFrequently:!0})),Rt.width=k,Rt.height=U,dn.drawImage(E,0,0,k,U),E=dn.getImageData(S,A,I,O),dn.clearRect(0,0,k,U),E.data;var E,S,A,I,O,k,U})},i.getJSON=(u,c)=>Pt(_e(u,{type:"json"}),c),i.getOverlapMode=XR,i.getProtocol=ln,i.getReferrer=En,i.getVideo=u=>{const c=window.document.createElement("video");return c.muted=!0,new Promise(d=>{c.onloadstart=()=>{d(c)};for(const b of u){var m=window.document.createElement("source");he(b)||(c.crossOrigin="Anonymous"),m.src=b,c.appendChild(m)}})},i.groupByLayout=function(u,c){var d={};for(let E=0;E<u.length;E++){var m=c&&c[u[E].id]||KE(u[E]);c&&(c[u[E].id]=m);let S=d[m];(S=S||(d[m]=[])).push(u[E])}var b=[];for(const E in d)b.push(d[E]);return b},i.identity=jr,i.interpolate=Fa,i.invert=function(u,de){var d=de[0],m=de[1],b=de[2],E=de[3],S=de[4],A=de[5],I=de[6],O=de[7],k=de[8],U=de[9],W=de[10],re=de[11],ie=de[12],fe=de[13],we=de[14],de=de[15],Me=d*A-m*S,Ve=d*I-b*S,$e=d*O-E*S,Ye=m*I-b*A,et=m*O-E*A,mt=b*O-E*I,zt=k*fe-U*ie,Nt=k*we-W*ie,ut=k*de-re*ie,kt=U*we-W*fe,vt=U*de-re*fe,pt=W*de-re*we,tt=Me*pt-Ve*vt+$e*kt+Ye*ut-et*Nt+mt*zt;return tt?(u[0]=(A*pt-I*vt+O*kt)*(tt=1/tt),u[1]=(b*vt-m*pt-E*kt)*tt,u[2]=(fe*mt-we*et+de*Ye)*tt,u[3]=(W*et-U*mt-re*Ye)*tt,u[4]=(I*ut-S*pt-O*Nt)*tt,u[5]=(d*pt-b*ut+E*Nt)*tt,u[6]=(we*$e-ie*mt-de*Ve)*tt,u[7]=(k*mt-W*$e+re*Ve)*tt,u[8]=(S*vt-A*ut+O*zt)*tt,u[9]=(m*ut-d*vt-E*zt)*tt,u[10]=(ie*et-fe*$e+de*Me)*tt,u[11]=(U*$e-k*et-re*Me)*tt,u[12]=(A*Nt-S*kt-I*zt)*tt,u[13]=(d*kt-m*Nt+b*zt)*tt,u[14]=(fe*Ve-ie*Ye-we*Me)*tt,u[15]=(k*Ye-U*Ve+W*Me)*tt,u):null},i.isAbortError=function(u){return u.message===Ge},i.isImageBitmap=at,i.isOffscreenCanvasDistorted=F,i.isSafari=function(u){var c;return Ze==null&&(c=u.navigator?u.navigator.userAgent:null,Ze=!!u.safari||!(!c||!(/\b(iPad|iPhone|iPod)\b/.test(c)||c.match("Safari")&&!c.match("Chrome")))),Ze},i.isWorker=Be,i.keysDifference=function(u,c){var d=[];for(const m in u)m in c||d.push(m);return d},i.makeRequest=Pt,i.mapObject=pe,i.mercatorXfromLng=fV,i.mercatorYfromLat=pV,i.mercatorZfromAltitude=gV,i.mul=rp,i.mul$1=Sl,i.multiply=Co,i.nextPowerOfTwo=function(u){return u<=1?1:Math.pow(2,Math.ceil(Math.log(u)/Math.LN2))},i.normalize=io,i.offscreenCanvasSupported=M,i.ortho=Yr,i.parseCacheControl=function(u){const c={};return u.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(d,m,b,E)=>(b=b||E,c[m]=!b||b.toLowerCase(),"")),c["max-age"]&&(u=parseInt(c["max-age"],10),isNaN(u)?delete c["max-age"]:c["max-age"]=u),c},i.parseGlyphPbf=function(u){return new $R(u).readFields(RTe,[])},i.pbf=ls,i.performSymbolLayout=function(u){u.bucket.createArrays();var c,d,m=512*u.bucket.overscaling,b=(u.bucket.tilePixelRatio=ct/m,u.bucket.compareText={},u.bucket.iconsNeedLinear=!1,u.bucket.layers[0]),E=b.layout,S={layoutIconSize:(m=b._unevaluatedLayout._values)["icon-size"].possiblyEvaluate(new zr(u.bucket.zoom+1),u.canonical),layoutTextSize:m["text-size"].possiblyEvaluate(new zr(u.bucket.zoom+1),u.canonical),textMaxSize:m["text-size"].possiblyEvaluate(new zr(18))};u.bucket.textSizeData.kind==="composite"&&({minZoom:c,maxZoom:d}=u.bucket.textSizeData,S.compositeTextSizes=[m["text-size"].possiblyEvaluate(new zr(c),u.canonical),m["text-size"].possiblyEvaluate(new zr(d),u.canonical)]),u.bucket.iconSizeData.kind==="composite"&&({minZoom:c,maxZoom:d}=u.bucket.iconSizeData,S.compositeIconSizes=[m["icon-size"].possiblyEvaluate(new zr(c),u.canonical),m["icon-size"].possiblyEvaluate(new zr(d),u.canonical)]);const A=E.get("text-line-height")*oo;var I=E.get("text-rotation-alignment")!=="viewport"&&E.get("symbol-placement")!=="point",O=E.get("text-keep-upright"),k=E.get("text-size");for(const de of u.bucket.features){const Me=E.get("text-font").evaluate(de,{},u.canonical).join(","),Ve=k.evaluate(de,{},u.canonical),$e=S.layoutTextSize.evaluate(de,{},u.canonical);var U=S.layoutIconSize.evaluate(de,{},u.canonical);const Ye={horizontal:{},vertical:void 0},et=de.text;let mt=[0,0];if(et){const ut=et.toString();var W=E.get("text-letter-spacing").evaluate(de,{},u.canonical)*oo;const kt=aT(ut)?W:0,vt=E.get("text-anchor").evaluate(de,{},u.canonical);var re=kV(b,de,u.canonical);re||(W=E.get("text-radial-offset").evaluate(de,{},u.canonical),mt=W?RV(vt,[W*oo,ok]):E.get("text-offset").evaluate(de,{},u.canonical).map(jt=>jt*oo));let pt=I?"center":E.get("text-justify").evaluate(de,{},u.canonical);const tt=E.get("symbol-placement"),Gt=tt==="point"?E.get("text-max-width").evaluate(de,{},u.canonical)*oo:0;if(W=()=>{u.bucket.allowVerticalPlacement&&Ou(ut)&&(Ye.vertical=AT(et,u.glyphMap,u.glyphPositions,u.imagePositions,Me,Gt,A,vt,"left",kt,mt,i.WritingMode.vertical,!0,tt,$e,Ve))},!I&&re){var ie,fe=new Set;if(pt==="auto")for(let Wt=0;Wt<re.values.length;Wt+=2)fe.add(ak(re.values[Wt]));else fe.add(pt);let jt=!1;for(const Wt of fe)Ye.horizontal[Wt]||(jt?Ye.horizontal[Wt]=Ye.horizontal[0]:(ie=AT(et,u.glyphMap,u.glyphPositions,u.imagePositions,Me,Gt,A,"center",Wt,kt,mt,i.WritingMode.horizontal,!1,tt,$e,Ve))&&(Ye.horizontal[Wt]=ie,jt=ie.positionedLines.length===1));W()}else{pt==="auto"&&(pt=ak(vt));var we=AT(et,u.glyphMap,u.glyphPositions,u.imagePositions,Me,Gt,A,vt,pt,kt,mt,i.WritingMode.horizontal,!1,tt,$e,Ve);we&&(Ye.horizontal[pt]=we),W(),Ou(ut)&&I&&O&&(Ye.vertical=AT(et,u.glyphMap,u.glyphPositions,u.imagePositions,Me,Gt,A,vt,pt,kt,mt,i.WritingMode.vertical,!1,tt,$e,Ve))}}let zt,Nt=!1;de.icon&&de.icon.name&&(we=u.imageMap[de.icon.name])&&(zt=function(ut,jt,Gt){var{horizontalAlign:Gt,verticalAlign:pt}=ZR(Gt),tt=jt[0],jt=jt[1],Gt=(tt=tt-ut.displaySize[0]*Gt)+ut.displaySize[0],jt=jt-ut.displaySize[1]*pt;return{image:ut,top:jt,bottom:jt+ut.displaySize[1],left:tt,right:Gt}}(u.imagePositions[de.icon.name],E.get("icon-offset").evaluate(de,{},u.canonical),E.get("icon-anchor").evaluate(de,{},u.canonical)),Nt=!!we.sdf,u.bucket.sdfIcons===void 0?u.bucket.sdfIcons=Nt:u.bucket.sdfIcons!==Nt&&Ee("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),we.pixelRatio!==u.bucket.pixelRatio||E.get("icon-rotate").constantOr(1)!==0)&&(u.bucket.iconsNeedLinear=!0),W=LV(Ye.horizontal)||Ye.vertical,u.bucket.iconsInText=!!W&&W.iconsInText,(W||zt)&&function(ut,kt,vt,pt,tt,Gt,jt,Wt,Sn,$n,An){let pr=Gt.textMaxSize.evaluate(kt,{});pr===void 0&&(pr=jt);const mn=ut.layers[0].layout,kn=mn.get("icon-offset").evaluate(kt,{},An),cr=LV(vt.horizontal),Lr=jt/24,Bs=ut.tilePixelRatio*Lr,_a=ut.tilePixelRatio*pr/24,lr=ut.tilePixelRatio*Wt,nr=ut.tilePixelRatio*mn.get("symbol-spacing"),Nc=mn.get("text-padding")*ut.tilePixelRatio,vd=function(vr,gr,mr,Ni=1){return vr=vr.get("icon-padding").evaluate(gr,{},mr),[(gr=vr&&vr.values)[0]*Ni,gr[1]*Ni,gr[2]*Ni,gr[3]*Ni]}(mn,kt,An,ut.tilePixelRatio),lc=mn.get("text-max-angle")/180*Math.PI,Il=mn.get("text-rotation-alignment")!=="viewport"&&mn.get("symbol-placement")!=="point",na=mn.get("icon-rotation-alignment")==="map"&&mn.get("symbol-placement")!=="point",uc=mn.get("symbol-placement"),dk=nr/2,Eb=mn.get("icon-text-fit");let so;pt&&Eb!=="none"&&(ut.allowVerticalPlacement&&vt.vertical&&(so=iV(pt,vt.vertical,Eb,mn.get("icon-text-fit-padding"),kn,Lr)),cr)&&(pt=iV(pt,cr,Eb,mn.get("icon-text-fit-padding"),kn,Lr));var Bo=(vr,gr)=>{if(!(gr.x<0||gr.x>=ct||gr.y<0||gr.y>=ct)){var mr=ut,Ni=gr;gr=vr;var Yi=vt;vr=pt;var za=tt,Kr=so,Ki=ut.layers[0],Uo=ut.collisionBoxArray,ra=kt.index,us=kt.sourceLayerIndex,zo=ut.index,ia=Bs,dc=[Nc,Nc,Nc,Nc],Pl=Il,xy=Sn,Ml=lr,NT=vd,Rl=na,DT=kn,Us=kt,FT=Gt,vp=$n,Bu=An,Sb=jt,Ey=mr.addToLineVertexArray(Ni,gr);let bp,Ty,Sy,Cy,BV=0,UV=0,zV=0,jV=0,fk=-1,pk=-1;var Uu={};let VV=y("");if(mr.allowVerticalPlacement&&Yi.vertical&&(gr=Ki.layout.get("text-rotate").evaluate(Us,{},Bu)+90,Tb=Yi.vertical,Sy=new OT(Uo,Ni,ra,us,zo,Tb,ia,dc,Pl,gr),Kr)&&(Cy=new OT(Uo,Ni,ra,us,zo,Kr,Ml,NT,Pl,gr)),vr){var Tb=Ki.layout.get("icon-rotate").evaluate(Us,{}),gr=Ki.layout.get("icon-text-fit")!=="none",BT=PV(vr,Tb,vp,gr),Kr=Kr?PV(Kr,Tb,vp,gr):void 0,vp=(Ty=new OT(Uo,Ni,ra,us,zo,vr,Ml,NT,!1,Tb),BV=4*BT.length,mr.iconSizeData);let Dc=null;vp.kind==="source"?(Dc=[Al*Ki.layout.get("icon-size").evaluate(Us,{})])[0]>gd&&Ee(`${mr.layerIds[0]}: Value for "icon-size" is >= ${vb}. Reduce your "icon-size".`):vp.kind==="composite"&&((Dc=[Al*FT.compositeIconSizes[0].evaluate(Us,{},Bu),Al*FT.compositeIconSizes[1].evaluate(Us,{},Bu)])[0]>gd||Dc[1]>gd)&&Ee(`${mr.layerIds[0]}: Value for "icon-size" is >= ${vb}. Reduce your "icon-size".`),mr.addSymbols(mr.icon,BT,Dc,DT,Rl,Us,i.WritingMode.none,Ni,Ey.lineStartIndex,Ey.lineLength,-1,Bu),fk=mr.icon.placedSymbolArray.length-1,Kr&&(UV=4*Kr.length,mr.addSymbols(mr.icon,Kr,Dc,DT,Rl,Us,i.WritingMode.vertical,Ni,Ey.lineStartIndex,Ey.lineLength,-1,Bu),pk=mr.icon.placedSymbolArray.length-1)}var FV=Object.keys(Yi.horizontal);for(const Ol of FV){var UT=Yi.horizontal[Ol],zT=(bp||(VV=y(UT.text),zT=Ki.layout.get("text-rotate").evaluate(Us,{},Bu),bp=new OT(Uo,Ni,ra,us,zo,UT,ia,dc,Pl,zT)),UT.positionedLines.length===1);if(zV+=OV(mr,Ni,UT,za,Ki,Pl,Us,xy,Ey,Yi.vertical?i.WritingMode.horizontal:i.WritingMode.horizontalOnly,zT?FV:[Ol],Uu,fk,FT,Bu),zT)break}Yi.vertical&&(jV+=OV(mr,Ni,Yi.vertical,za,Ki,Pl,Us,xy,Ey,i.WritingMode.vertical,["vertical"],Uu,pk,FT,Bu)),gr=bp?bp.boxStartIndex:mr.collisionBoxArray.length,vr=bp?bp.boxEndIndex:mr.collisionBoxArray.length,Ml=Sy?Sy.boxStartIndex:mr.collisionBoxArray.length,NT=Sy?Sy.boxEndIndex:mr.collisionBoxArray.length,vp=Ty?Ty.boxStartIndex:mr.collisionBoxArray.length,BT=Ty?Ty.boxEndIndex:mr.collisionBoxArray.length,Kr=Cy?Cy.boxStartIndex:mr.collisionBoxArray.length,DT=Cy?Cy.boxEndIndex:mr.collisionBoxArray.length;let kl=-1;Rl=(Ol,Cb)=>Ol&&Ol.circleDiameter?Math.max(Ol.circleDiameter,Cb):Cb,kl=Rl(bp,kl),kl=Rl(Sy,kl),kl=Rl(Ty,kl),Rl=-1<(kl=Rl(Cy,kl))?1:0,Rl&&(kl*=Sb/oo),mr.glyphOffsetArray.length>=vy.MAX_GLYPHS&&Ee("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Us.sortKey!==void 0&&mr.addToSortKeyRanges(mr.symbolInstances.length,Us.sortKey);var Sb=kV(Ki,Us,Bu),[Sb,rSe]=function(Ol,Cb){var iSe=Ol.length,Dc=Cb==null?void 0:Cb.values;if(0<(Dc==null?void 0:Dc.length))for(let jT=0;jT<Dc.length;jT+=2){var oSe=i.TextAnchorEnum[Dc[jT]],HV=Dc[jT+1];Ol.emplaceBack(oSe,HV[0],HV[1])}return[iSe,Ol.length]}(mr.textAnchorOffsets,Sb);mr.symbolInstances.emplaceBack(Ni.x,Ni.y,0<=Uu.right?Uu.right:-1,0<=Uu.center?Uu.center:-1,0<=Uu.left?Uu.left:-1,Uu.vertical||-1,fk,pk,VV,gr,vr,Ml,NT,vp,BT,Kr,DT,ra,zV,jV,BV,UV,Rl,0,ia,kl,Sb,rSe)}};if(uc==="line")for(const vr of TV(kt.geometry,0,0,ct,ct))for(const gr of XTe(vr,nr,lc,vt.vertical||cr,pt,24,_a,ut.overscaling,ct))cr&&function(mr,Ni,Yi,za){if(mr=mr.compareText,Ni in mr){var Kr=mr[Ni];for(let Ki=Kr.length-1;0<=Ki;Ki--)if(za.dist(Kr[Ki])<Yi)return 1}else mr[Ni]=[];return mr[Ni].push(za),0}(ut,cr.text,dk,gr)||Bo(vr,gr);else if(uc==="line-center")for(const vr of kt.geometry){var hc;1<vr.length&&(hc=function(gr,mr,Ni,Yi,za,Kr){var Ki=AV(Ni,za,Kr),Uo=IV(Ni,Yi)*Kr;let ra=0;var us=CV(gr)/2;for(let Ml=0;Ml<gr.length-1;Ml++){var zo,ia,dc=gr[Ml],Pl=gr[Ml+1],xy=dc.dist(Pl);if(ra+xy>us)return zo=(us-ra)/xy,ia=Fa.number(dc.x,Pl.x,zo),zo=Fa.number(dc.y,Pl.y,zo),(ia=new yd(ia,zo,Pl.angleTo(dc),Ml))._round(),!Ki||SV(gr,ia,Uo,Ki,mr)?ia:void 0;ra+=xy}}(vr,lc,vt.vertical||cr,pt,24,_a))&&Bo(vr,hc)}else if(kt.type==="Polygon")for(const vr of FR(kt.geometry,0)){var Fu=tSe(vr,16);Bo(vr[0],new yd(Fu.x,Fu.y,0))}else if(kt.type==="LineString")for(const vr of kt.geometry)Bo(vr,new yd(vr[0].x,vr[0].y,0));else if(kt.type==="Point")for(const vr of kt.geometry)for(const gr of vr)Bo([gr],new yd(gr.x,gr.y,0))}(u.bucket,de,Ye,zt,u.imageMap,S,$e,U,mt,Nt,u.canonical)}u.showCollisionBoxes&&u.bucket.generateCollisionDebugBuffers()},i.perspective=Vr,i.pick=function(u,c){var d={};for(let b=0;b<c.length;b++){var m=c[b];m in u&&(d[m]=u[m])}return d},i.pointGeometry=l,i.polygonIntersectsPolygon=Zt,i.potpack=Q9,i.readImageUsingVideoFrame=ht,i.register=Ht,i.removeProtocol=function(u){delete Qt.REGISTERED_PROTOCOLS[u]},i.renderColorRamp=P9,i.renderStyleImage=function(u){var c=u.userImage;return!!(c&&c.render&&c.render())&&(u.data.replace(new Uint8Array(c.data.buffer)),!0)},i.rotate=function(u,S,I){var m=S[0],b=S[1],E=S[2],S=S[3],A=Math.sin(I),I=Math.cos(I);return u[0]=m*I+E*A,u[1]=b*I+S*A,u[2]=m*-A+E*I,u[3]=b*-A+S*I,u},i.rotateX=function(u,c,b){var m=Math.sin(b),b=Math.cos(b),E=c[4],S=c[5],A=c[6],I=c[7],O=c[8],k=c[9],U=c[10],W=c[11];return c!==u&&(u[0]=c[0],u[1]=c[1],u[2]=c[2],u[3]=c[3],u[12]=c[12],u[13]=c[13],u[14]=c[14],u[15]=c[15]),u[4]=E*b+O*m,u[5]=S*b+k*m,u[6]=A*b+U*m,u[7]=I*b+W*m,u[8]=O*b-E*m,u[9]=k*b-S*m,u[10]=U*b-A*m,u[11]=W*b-I*m,u},i.rotateZ=function(u,c,b){var m=Math.sin(b),b=Math.cos(b),E=c[0],S=c[1],A=c[2],I=c[3],O=c[4],k=c[5],U=c[6],W=c[7];return c!==u&&(u[8]=c[8],u[9]=c[9],u[10]=c[10],u[11]=c[11],u[12]=c[12],u[13]=c[13],u[14]=c[14],u[15]=c[15]),u[0]=E*b+O*m,u[1]=S*b+k*m,u[2]=A*b+U*m,u[3]=I*b+W*m,u[4]=O*b-E*m,u[5]=k*b-S*m,u[6]=U*b-A*m,u[7]=W*b-I*m,u},i.rtlWorkerPlugin=Lu,i.sameOrigin=he,i.scale=function(u,c,E){var m=E[0],b=E[1],E=E[2];return u[0]=c[0]*m,u[1]=c[1]*m,u[2]=c[2]*m,u[3]=c[3]*m,u[4]=c[4]*b,u[5]=c[5]*b,u[6]=c[6]*b,u[7]=c[7]*b,u[8]=c[8]*E,u[9]=c[9]*E,u[10]=c[10]*E,u[11]=c[11]*E,u[12]=c[12],u[13]=c[13],u[14]=c[14],u[15]=c[15],u},i.scale$1=function(u,c,d){return u[0]=c[0]*d,u[1]=c[1]*d,u[2]=c[2]*d,u},i.sphericalToCartesian=function([u,c,d]){return c=(c+=90)*(Math.PI/180),d*=Math.PI/180,{x:u*Math.cos(c)*Math.sin(d),y:u*Math.sin(c)*Math.sin(d),z:u*Math.cos(d)}},i.sqrLen=Li,i.sub=Ui,i.toEvaluationFeature=Yt,i.transformMat3=function(u,E,d){var m=E[0],b=E[1],E=E[2];return u[0]=m*d[0]+b*d[3]+E*d[6],u[1]=m*d[1]+b*d[4]+E*d[7],u[2]=m*d[2]+b*d[5]+E*d[8],u},i.transformMat4=ac,i.transformMat4$1=function(u,b,d){var m=b[0],b=b[1];return u[0]=d[0]*m+d[4]*b+d[12],u[1]=d[1]*m+d[5]*b+d[13],u},i.translate=function(u,c,de){var m,b,E,S,A,I,O,k,U,W,re,ie,fe=de[0],we=de[1],de=de[2];return c===u?(u[12]=c[0]*fe+c[4]*we+c[8]*de+c[12],u[13]=c[1]*fe+c[5]*we+c[9]*de+c[13],u[14]=c[2]*fe+c[6]*we+c[10]*de+c[14],u[15]=c[3]*fe+c[7]*we+c[11]*de+c[15]):(m=c[0],b=c[1],E=c[2],S=c[3],A=c[4],I=c[5],O=c[6],k=c[7],U=c[8],W=c[9],re=c[10],ie=c[11],u[0]=m,u[1]=b,u[2]=E,u[3]=S,u[4]=A,u[5]=I,u[6]=O,u[7]=k,u[8]=U,u[9]=W,u[10]=re,u[11]=ie,u[12]=m*fe+A*we+U*de+c[12],u[13]=b*fe+I*we+W*de+c[13],u[14]=E*fe+O*we+re*de+c[14],u[15]=S*fe+k*we+ie*de+c[15]),u},i.unicodeBlockLookup=Ft,i.uniqueId=function(){return J++},i.v8Spec=q,i.validateCustomStyleLayer=function(u){var c=[],d=u.id;return d===void 0&&c.push({message:`layers.${d}: missing required property "id"`}),u.render===void 0&&c.push({message:`layers.${d}: missing required method "render"`}),u.renderingMode&&u.renderingMode!=="2d"&&u.renderingMode!=="3d"&&c.push({message:`layers.${d}: property "renderingMode" must be either "2d" or "3d"`}),c},i.validateLight=np,i.validateStyle=cp,i.vectorTile=pd,i.warnOnce=Ee,i.wrap=se}),r("worker",0,function(i){class o{constructor(V){this.keyCache={},V&&this.replace(V)}replace(V){this._layerConfigs={},this._layers={},this.update(V,[])}update(V,$){for(const Ne of V){this._layerConfigs[Ne.id]=Ne;var K=this._layers[Ne.id]=i.createStyleLayer(Ne);K._featureFilter=i.createFilter(K.filter),this.keyCache[Ne.id]&&delete this.keyCache[Ne.id]}for(const Ne of $)delete this.keyCache[Ne],delete this._layerConfigs[Ne],delete this._layers[Ne];this.familiesBySource={};for(const Ne of i.groupByLayout(Object.values(this._layerConfigs),this.keyCache)){var me=Ne.map(Ce=>this._layers[Ce.id]),Oe=me[0];if(Oe.visibility!=="none"){var He=Oe.source||"";let Ce=this.familiesBySource[He];Ce=Ce||(this.familiesBySource[He]={}),He=Oe.sourceLayer||"_geojsonTileLayer";let De=Ce[He];(De=De||(Ce[He]=[])).push(me)}}}}class a{constructor(V){var $={},K=[];for(const tn in V){var me=V[tn],Oe=$[tn]={};for(const _n in me){var He,Ne=me[+_n];Ne&&Ne.bitmap.width!==0&&Ne.bitmap.height!==0&&(He={x:0,y:0,w:Ne.bitmap.width+2,h:Ne.bitmap.height+2},K.push(He),Oe[_n]={rect:He,metrics:Ne.metrics})}}var{w:Ce,h:De}=i.potpack(K),ot=new i.AlphaImage({width:Ce||1,height:De||1});for(const tn in V){var st=V[tn];for(const _n in st){var St,un=st[+_n];un&&un.bitmap.width!==0&&un.bitmap.height!==0&&(St=$[tn][_n].rect,i.AlphaImage.copy(un.bitmap,ot,{x:0,y:0},{x:St.x+1,y:St.y+1},un.bitmap))}}this.image=ot,this.positions=$}}i.register("GlyphAtlas",a);class l{constructor(V){this.tileID=new i.OverscaledTileID(V.tileID.overscaledZ,V.tileID.wrap,V.tileID.canonical.z,V.tileID.canonical.x,V.tileID.canonical.y),this.uid=V.uid,this.zoom=V.zoom,this.pixelRatio=V.pixelRatio,this.tileSize=V.tileSize,this.source=V.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=V.showCollisionBoxes,this.collectResourceTiming=!!V.collectResourceTiming,this.returnDependencies=!!V.returnDependencies,this.promoteId=V.promoteId,this.inFlightDependencies=[]}parse(V,$,K,me){return i.__awaiter(this,void 0,void 0,function*(){this.status="parsing",this.data=V,this.collisionBoxArray=new i.CollisionBoxArray;var Oe=new i.DictionaryCoder(Object.keys(V.layers).sort()),He=new i.FeatureIndex(this.tileID,this.promoteId),Ne=(He.bucketLayerIDs=[],{}),Ce={featureIndex:He,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:K},De=$.familiesBySource[this.source];for(const Pi in De){var ot=V.layers[Pi];if(ot){ot.version===1&&i.warnOnce(`Vector tile source "${this.source}" layer "${Pi}" does not use vector tile spec v2 and therefore may have some rendering errors.`);var st=Oe.encode(Pi),St=[];for(let mo=0;mo<ot.length;mo++){var un=ot.feature(mo),tn=He.getId(un,Pi);St.push({feature:un,id:tn,index:mo,sourceLayerIndex:st})}for(const mo of De[Pi]){var _n=mo[0];_n.source!==this.source&&i.warnOnce(`layer.source = ${_n.source} does not equal this.source = `+this.source),_n.minzoom&&this.zoom<Math.floor(_n.minzoom)||_n.maxzoom&&this.zoom>=_n.maxzoom||_n.visibility!=="none"&&(h(mo,this.zoom,K),(Ne[_n.id]=_n.createBucket({index:He.bucketLayerIDs.length,layers:mo,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:st,sourceID:this.source})).populate(St,Ce,this.tileID.canonical),He.bucketLayerIDs.push(mo.map(Xh=>Xh.id)))}}}var Yn=i.mapObject(Ce.glyphDependencies,Pi=>Object.keys(Pi).map(Number));this.inFlightDependencies.forEach(Pi=>Pi==null?void 0:Pi.abort()),this.inFlightDependencies=[];let Kn=Promise.resolve({});Object.keys(Yn).length&&(On=new AbortController,this.inFlightDependencies.push(On),Kn=me.sendAsync({type:"GG",data:{stacks:Yn,source:this.source,tileID:this.tileID,type:"glyphs"}},On)),Yn=Object.keys(Ce.iconDependencies);let er=Promise.resolve({});Yn.length&&(On=new AbortController,this.inFlightDependencies.push(On),er=me.sendAsync({type:"GI",data:{icons:Yn,source:this.source,tileID:this.tileID,type:"icons"}},On));var On,Yn=Object.keys(Ce.patternDependencies);let Bn=Promise.resolve({});Yn.length&&(On=new AbortController,this.inFlightDependencies.push(On),Bn=me.sendAsync({type:"GI",data:{icons:Yn,source:this.source,tileID:this.tileID,type:"patterns"}},On));var[pn,gn,Yn]=yield Promise.all([Kn,er,Bn]),Br=new a(pn),si=new i.ImageAtlas(gn,Yn);for(const Pi in Ne){var $i=Ne[Pi];$i instanceof i.SymbolBucket?(h($i.layers,this.zoom,K),i.performSymbolLayout({bucket:$i,glyphMap:pn,glyphPositions:Br.positions,imageMap:gn,imagePositions:si.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical})):$i.hasPattern&&($i instanceof i.LineBucket||$i instanceof i.FillBucket||$i instanceof i.FillExtrusionBucket)&&(h($i.layers,this.zoom,K),$i.addFeatures(Ce,this.tileID.canonical,si.patternPositions))}return this.status="done",{buckets:Object.values(Ne).filter(Pi=>!Pi.isEmpty()),featureIndex:He,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Br.image,imageAtlas:si,glyphMap:this.returnDependencies?pn:null,iconMap:this.returnDependencies?gn:null,glyphPositions:this.returnDependencies?Br.positions:null}})}}function h(oe,V,$){var K=new i.EvaluationParameters(V);for(const me of oe)me.recalculate(K,$)}class p{constructor(V,$,K){this.actor=V,this.layerIndex=$,this.availableImages=K,this.fetching={},this.loading={},this.loaded={}}loadVectorTile(V,$){return i.__awaiter(this,void 0,void 0,function*(){var K=yield i.getArrayBuffer(V.request,$);try{return{vectorTile:new i.vectorTile.VectorTile(new i.Protobuf(K.data)),rawData:K.data,cacheControl:K.cacheControl,expires:K.expires}}catch(me){K=new Uint8Array(K.data),K=K[0]===31&&K[1]===139;let Oe=`Unable to parse the tile at ${V.request.url}, `;throw Oe+=K?"please make sure the data is not gzipped and that you have configured the relevant header in the server":"got error: "+me.messge,new Error(Oe)}})}loadTile(V){return i.__awaiter(this,void 0,void 0,function*(){var $=V.uid,K=!!(V&&V.request&&V.request.collectResourceTiming)&&new i.RequestPerformance(V.request),me=new l(V),Oe=(this.loading[$]=me,new AbortController);me.abort=Oe;try{var He=yield this.loadVectorTile(V,Oe);if(delete this.loading[$],!He)return null;var Ne,Ce=He.rawData,De={},ot=(He.expires&&(De.expires=He.expires),He.cacheControl&&(De.cacheControl=He.cacheControl),{}),st=(K&&(Ne=K.finish())&&(ot.resourceTiming=JSON.parse(JSON.stringify(Ne))),me.vectorTile=He.vectorTile,me.parse(He.vectorTile,this.layerIndex,this.availableImages,this.actor));this.loaded[$]=me,this.fetching[$]={rawTileData:Ce,cacheControl:De,resourceTiming:ot};try{var St=yield st;return i.extend({rawTileData:Ce.slice(0)},St,De,ot)}finally{delete this.fetching[$]}}catch(un){throw delete this.loading[$],me.status="done",this.loaded[$]=me,un}})}reloadTile(V){return i.__awaiter(this,void 0,void 0,function*(){var $=V.uid;if(!this.loaded||!this.loaded[$])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");var K=this.loaded[$];if(K.showCollisionBoxes=V.showCollisionBoxes,K.status==="parsing"){var me,Oe,He,Ne=yield K.parse(K.vectorTile,this.layerIndex,this.availableImages,this.actor);return this.fetching[$]?({rawTileData:me,cacheControl:Oe,resourceTiming:He}=this.fetching[$],delete this.fetching[$],i.extend({rawTileData:me.slice(0)},Ne,Oe,He)):Ne}if(K.status==="done"&&K.vectorTile)return K.parse(K.vectorTile,this.layerIndex,this.availableImages,this.actor)})}abortTile(V){return i.__awaiter(this,void 0,void 0,function*(){var $=this.loading,K=V.uid;$&&$[K]&&$[K].abort&&($[K].abort.abort(),delete $[K])})}removeTile(V){return i.__awaiter(this,void 0,void 0,function*(){this.loaded&&this.loaded[V.uid]&&delete this.loaded[V.uid]})}}class g{constructor(){this.loaded={}}loadTile(V){return i.__awaiter(this,void 0,void 0,function*(){var{uid:$,encoding:K,rawImageData:me,redFactor:Oe,greenFactor:He,blueFactor:Ne,baseShift:Ce}=V,De=me.width+2,ot=me.height+2,De=i.isImageBitmap(me)?new i.RGBAImage({width:De,height:ot},yield i.getImageData(me,-1,-1,De,ot)):me,ot=new i.DEMData($,De,K,Oe,He,Ne,Ce);return this.loaded=this.loaded||{},this.loaded[$]=ot})}removeTile(K){var $=this.loaded,K=K.uid;$&&$[K]&&delete $[K]}}function _(oe,V){if(oe.length!==0){x(oe[0],V);for(var $=1;$<oe.length;$++)x(oe[$],!V)}}function x(oe,V){for(var $=0,K=0,me=0,Oe=oe.length,He=Oe-1;me<Oe;He=me++){var Ne=(oe[me][0]-oe[He][0])*(oe[He][1]+oe[me][1]),Ce=$+Ne;K+=Math.abs($)>=Math.abs(Ne)?$-Ce+Ne:Ne-Ce+$,$=Ce}0<=$+K!=!!V&&oe.reverse()}var C=i.getDefaultExportFromCjs(function oe(V,$){var K,me=V&&V.type;if(me==="FeatureCollection")for(K=0;K<V.features.length;K++)oe(V.features[K],$);else if(me==="GeometryCollection")for(K=0;K<V.geometries.length;K++)oe(V.geometries[K],$);else if(me==="Feature")oe(V.geometry,$);else if(me==="Polygon")_(V.coordinates,$);else if(me==="MultiPolygon")for(K=0;K<V.coordinates.length;K++)_(V.coordinates[K],$);return V});const M=i.vectorTile.VectorTileFeature.prototype.toGeoJSON;let L=class{constructor(oe){this._feature=oe,this.extent=i.EXTENT,this.type=oe.type,this.properties=oe.tags,"id"in oe&&!isNaN(oe.id)&&(this.id=parseInt(oe.id,10))}loadGeometry(){if(this._feature.type===1){var oe=[];for(const K of this._feature.geometry)oe.push([new i.Point(K[0],K[1])]);return oe}var V=[];for(const K of this._feature.geometry){var $=[];for(const me of K)$.push(new i.Point(me[0],me[1]));V.push($)}return V}toGeoJSON(oe,V,$){return M.call(this,oe,V,$)}},F=class{constructor(oe){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=i.EXTENT,this.length=oe.length,this._features=oe}feature(oe){return new L(this._features[oe])}};var z={exports:{}},ee=i.pointGeometry,ce=i.vectorTile.VectorTileFeature,se=_e;function _e(oe,V){this.options=V||{},this.features=oe,this.length=oe.length}function J(oe,V){this.id=typeof oe.id=="number"?oe.id:void 0,this.type=oe.type,this.rawGeometry=oe.type===1?[oe.geometry]:oe.geometry,this.properties=oe.tags,this.extent=V||4096}_e.prototype.feature=function(oe){return new J(this.features[oe],this.options.extent)},J.prototype.loadGeometry=function(){var oe=this.rawGeometry;this.geometry=[];for(var V=0;V<oe.length;V++){for(var $=oe[V],K=[],me=0;me<$.length;me++)K.push(new ee($[me][0],$[me][1]));this.geometry.push(K)}return this.geometry},J.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var oe=this.geometry,V=1/0,$=-1/0,K=1/0,me=-1/0,Oe=0;Oe<oe.length;Oe++)for(var He=oe[Oe],Ne=0;Ne<He.length;Ne++)var Ce=He[Ne],V=Math.min(V,Ce.x),$=Math.max($,Ce.x),K=Math.min(K,Ce.y),me=Math.max(me,Ce.y);return[V,K,$,me]},J.prototype.toGeoJSON=ce.prototype.toGeoJSON;var pe=i.pbf,ue=se;function xe(oe){var V,$=new pe,K=oe,me=$;for(V in K.layers)me.writeMessage(3,je,K.layers[V]);return $.finish()}function je(oe,V){V.writeVarintField(15,oe.version||1),V.writeStringField(1,oe.name||""),V.writeVarintField(5,oe.extent||4096);for(var $={keys:[],values:[],keycache:{},valuecache:{}},K=0;K<oe.length;K++)$.feature=oe.feature(K),V.writeMessage(2,ne,$);var me=$.keys;for(K=0;K<me.length;K++)V.writeStringField(3,me[K]);var Oe=$.values;for(K=0;K<Oe.length;K++)V.writeMessage(4,at,Oe[K])}function ne(oe,V){var $=oe.feature;$.id!==void 0&&V.writeVarintField(1,$.id),V.writeMessage(2,Ee,oe),V.writeVarintField(3,$.type),V.writeMessage(4,Ze,$)}function Ee(oe,V){var $,K=oe.feature,me=oe.keys,Oe=oe.values,He=oe.keycache,Ne=oe.valuecache;for($ in K.properties){var Ce,De=K.properties[$],ot=He[$];De!==null&&(ot===void 0&&(me.push($),ot=me.length-1,He[$]=ot),V.writeVarint(ot),(Ce=Ne[ot=(ot=typeof De)+":"+(De=ot!="string"&&ot!="boolean"&&ot!="number"?JSON.stringify(De):De)])===void 0&&(Oe.push(De),Ce=Oe.length-1,Ne[ot]=Ce),V.writeVarint(Ce))}}function ke(oe,V){return(V<<3)+(7&oe)}function Be(oe){return oe<<1^oe>>31}function Ze(oe,V){for(var $=oe.loadGeometry(),K=oe.type,me=0,Oe=0,He=$.length,Ne=0;Ne<He;Ne++){for(var Ce=$[Ne],De=1,ot=(K===1&&(De=Ce.length),V.writeVarint(ke(1,De)),K===3?Ce.length-1:Ce.length),st=0;st<ot;st++){st===1&&K!==1&&V.writeVarint(ke(2,ot-1));var St=Ce[st].x-me,un=Ce[st].y-Oe;V.writeVarint(Be(St)),V.writeVarint(Be(un)),me+=St,Oe+=un}K===3&&V.writeVarint(15)}}function at(oe,V){var $=typeof oe;$=="string"?V.writeStringField(1,oe):$=="boolean"?V.writeBooleanField(7,oe):$=="number"&&(oe%1!=0?V.writeDoubleField(3,oe):oe<0?V.writeSVarintField(6,oe):V.writeVarintField(5,oe))}z.exports=xe,z.exports.fromVectorTileJs=xe,z.exports.fromGeojsonVt=function(oe,V){V=V||{};var $,K={};for($ in oe)K[$]=new ue(oe[$].features,V),K[$].name=$,K[$].version=V.version,K[$].extent=V.extent;return xe({layers:K})},z.exports.GeoJSONWrapper=ue;var Re,ht=i.getDefaultExportFromCjs(z.exports);const Rt={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:oe=>oe},dn=Math.fround||(Re=new Float32Array(1),oe=>(Re[0]=+oe,Re[0])),wt=3,Ge=5,qn=6;class Qt{constructor(V){this.options=Object.assign(Object.create(Rt),V),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(V){var{log:$,minZoom:K,maxZoom:me}=this.options,Oe=($&&console.time("total time"),`prepare ${V.length} points`),He=($&&console.time(Oe),this.points=V,[]);for(let st=0;st<V.length;st++){var Ne,Ce=V[st];Ce.geometry&&([Ce,Ne]=Ce.geometry.coordinates,Ce=dn(Ot(Ce)),Ne=dn(En(Ne)),He.push(Ce,Ne,1/0,st,-1,1),this.options.reduce)&&He.push(0)}let De=this.trees[me+1]=this._createTree(He);$&&console.timeEnd(Oe);for(let st=me;st>=K;st--){var ot=+Date.now();De=this.trees[st]=this._createTree(this._cluster(De,st)),$&&console.log("z%d: %d clusters in %dms",st,De.numItems,+Date.now()-ot)}return $&&console.timeEnd("total time"),this}getClusters(Ne,$){let K=((Ne[0]+180)%360+360)%360-180;var me=Math.max(-90,Math.min(90,Ne[1]));let Oe=Ne[2]===180?180:((Ne[2]+180)%360+360)%360-180;var He=Math.max(-90,Math.min(90,Ne[3]));if(360<=Ne[2]-Ne[0])K=-180,Oe=180;else if(K>Oe)return Ne=this.getClusters([K,me,180,He],$),Ce=this.getClusters([-180,me,Oe,He],$),Ne.concat(Ce);var Ne=this.trees[this._limitZoom($)],Ce=Ne.range(Ot(K),En(He),Ot(Oe),En(me)),De=Ne.data,ot=[];for(const St of Ce){var st=this.stride*St;ot.push(1<De[st+Ge]?ln(De,st,this.clusterProps):this.points[De[st+wt]])}return ot}getChildren(V){var Ne=this._getOriginId(V),Oe=this._getOriginZoom(V),$="No cluster with the specified id.",K=this.trees[Oe];if(!K)throw new Error($);var me=K.data;if(Ne*this.stride>=me.length)throw new Error($);var Oe=this.options.radius/(this.options.extent*Math.pow(2,Oe-1)),He=me[Ne*this.stride],Ne=me[Ne*this.stride+1],Ce=[];for(const ot of K.within(He,Ne,Oe)){var De=ot*this.stride;me[4+De]===V&&Ce.push(1<me[De+Ge]?ln(me,De,this.clusterProps):this.points[me[De+wt]])}if(Ce.length===0)throw new Error($);return Ce}getLeaves(V,$,K){var me=[];return this._appendLeaves(me,V,$=$||10,K=K||0,0),me}getTile(Oe,$,K){var me=this.trees[this._limitZoom(Oe)],Oe=Math.pow(2,Oe),{extent:Ne,radius:He}=this.options,He=He/Ne,Ne=(K-He)/Oe,Ce=(K+1+He)/Oe,De={features:[]};return this._addTileFeatures(me.range(($-He)/Oe,Ne,($+1+He)/Oe,Ce),me.data,$,K,Oe,De),$===0&&this._addTileFeatures(me.range(1-He/Oe,Ne,1,Ce),me.data,Oe,K,Oe,De),$===Oe-1&&this._addTileFeatures(me.range(0,Ne,He/Oe,Ce),me.data,-1,K,Oe,De),De.features.length?De:null}getClusterExpansionZoom(V){let $=this._getOriginZoom(V)-1;for(;$<=this.options.maxZoom;){var K=this.getChildren(V);if($++,K.length!==1)break;V=K[0].properties.cluster_id}return $}_appendLeaves(V,$,K,me,Oe){for(const Ne of this.getChildren($)){var He=Ne.properties;if(He&&He.cluster?Oe+He.point_count<=me?Oe+=He.point_count:Oe=this._appendLeaves(V,He.cluster_id,K,me,Oe):Oe<me?Oe++:V.push(Ne),V.length===K)break}return Oe}_createTree(V){var $=new i.KDBush(V.length/this.stride|0,this.options.nodeSize,Float32Array);for(let K=0;K<V.length;K+=this.stride)$.add(V[K],V[K+1]);return $.finish(),$.data=V,$}_addTileFeatures(V,$,K,me,Oe,He){for(const st of V){var Ne,Ce=st*this.stride,De=1<$[Ce+Ge];let St,un,tn;tn=De?(St=Mn($,Ce,this.clusterProps),un=$[Ce],$[1+Ce]):(ot=this.points[$[Ce+wt]],[ot,Ne]=(St=ot.properties,ot.geometry.coordinates),un=Ot(ot),En(Ne));var ot={type:1,geometry:[[Math.round(this.options.extent*(un*Oe-K)),Math.round(this.options.extent*(tn*Oe-me))]],tags:St};let _n;(_n=De||this.options.generateId?$[Ce+wt]:this.points[$[Ce+wt]].id)!==void 0&&(ot.id=_n),He.features.push(ot)}}_limitZoom(V){return Math.max(this.options.minZoom,Math.min(Math.floor(+V),this.options.maxZoom+1))}_cluster(V,$){var{radius:K,extent:me,reduce:Oe,minPoints:He}=this.options,Ne=K/(me*Math.pow(2,$)),Ce=V.data,De=[],ot=this.stride;for(let pn=0;pn<Ce.length;pn+=ot)if(!(Ce[pn+2]<=$)){Ce[pn+2]=$;var st=Ce[pn],St=Ce[pn+1],un=V.within(Ce[pn],Ce[pn+1],Ne),tn=Ce[pn+Ge];let gn=tn;for(const Yn of un){var _n=Yn*ot;Ce[2+_n]>$&&(gn+=Ce[_n+Ge])}if(gn>tn&&gn>=He){let Yn=st*tn,Br=St*tn,si,$i=-1;var Kn=((pn/ot|0)<<5)+($+1)+this.points.length;for(const Pi of un){var er,On=Pi*ot;Ce[2+On]<=$||(Ce[2+On]=$,er=Ce[On+Ge],Yn+=Ce[On]*er,Br+=Ce[1+On]*er,Ce[4+On]=Kn,Oe&&(si||(si=this._map(Ce,pn,!0),$i=this.clusterProps.length,this.clusterProps.push(si)),Oe(si,this._map(Ce,On))))}Ce[pn+4]=Kn,De.push(Yn/gn,Br/gn,1/0,Kn,-1,gn),Oe&&De.push($i)}else{for(let Yn=0;Yn<ot;Yn++)De.push(Ce[pn+Yn]);if(1<gn)for(const Yn of un){var Bn=Yn*ot;if(!(Ce[2+Bn]<=$)){Ce[2+Bn]=$;for(let Br=0;Br<ot;Br++)De.push(Ce[Bn+Br])}}}}return De}_getOriginId(V){return V-this.points.length>>5}_getOriginZoom(V){return(V-this.points.length)%32}_map(V,$,K){var me;return 1<V[$+Ge]?(me=this.clusterProps[V[$+qn]],K?Object.assign({},me):me):(me=this.points[V[$+wt]].properties,V=this.options.map(me),K&&V===me?Object.assign({},V):V)}}function ln(oe,V,$){return{type:"Feature",id:oe[V+wt],properties:Mn(oe,V,$),geometry:{type:"Point",coordinates:[360*(oe[V]-.5),function(K){return K=(180-360*K)*Math.PI/180,360*Math.atan(Math.exp(K))/Math.PI-90}(oe[V+1])]}}}function Mn(oe,V,He){var K=oe[V+Ge],me=1e4<=K?Math.round(K/1e3)+"k":1e3<=K?Math.round(K/100)/10+"k":K,Oe=oe[V+qn],He=Oe===-1?{}:Object.assign({},He[Oe]);return Object.assign(He,{cluster:!0,cluster_id:oe[V+wt],point_count:K,point_count_abbreviated:me})}function Ot(oe){return oe/360+.5}function En(oe){return oe=Math.sin(oe*Math.PI/180),oe=.5-.25*Math.log((1+oe)/(1-oe))/Math.PI,oe<0?0:1<oe?1:oe}function lt(oe,V,$,K){for(var me,Oe=K,He=$-V>>1,Ne=$-V,Ce=oe[V],De=oe[V+1],ot=oe[$],st=oe[$+1],St=V+3;St<$;St+=3){var un=function(tn,_n,Kn,er,On,Bn){var pn=On-Kn,gn=Bn-er;{var Yn;pn==0&&gn==0||(1<(Yn=((tn-Kn)*pn+(_n-er)*gn)/(pn*pn+gn*gn))?(Kn=On,er=Bn):0<Yn&&(Kn+=pn*Yn,er+=gn*Yn))}return(pn=tn-Kn)*pn+(gn=_n-er)*gn}(oe[St],oe[St+1],Ce,De,ot,st);Oe<un?(me=St,Oe=un):un===Oe&&(un=Math.abs(St-He))<Ne&&(me=St,Ne=un)}K<Oe&&(3<me-V&&lt(oe,V,me,K),oe[me+2]=Oe,3<$-me)&&lt(oe,me,$,K)}function Pt(me,Ne,$,K){var me={id:me===void 0?null:me,type:Ne,geometry:$,tags:K,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0},Oe=me,He=Oe.geometry,Ne=Oe.type;if(Ne==="Point"||Ne==="MultiPoint"||Ne==="LineString")he(Oe,He);else if(Ne==="Polygon"||Ne==="MultiLineString")for(var Ce=0;Ce<He.length;Ce++)he(Oe,He[Ce]);else if(Ne==="MultiPolygon")for(Ce=0;Ce<He.length;Ce++)for(var De=0;De<He[Ce].length;De++)he(Oe,He[Ce][De]);return me}function he(oe,V){for(var $=0;$<V.length;$+=3)oe.minX=Math.min(oe.minX,V[$]),oe.minY=Math.min(oe.minY,V[$+1]),oe.maxX=Math.max(oe.maxX,V[$]),oe.maxY=Math.max(oe.maxY,V[$+1])}function B(oe,V,$,K){if(V.geometry){var me=V.geometry.coordinates,Oe=V.geometry.type,He=Math.pow($.tolerance/((1<<$.maxZoom)*$.extent),2),Ne=[],Ce=V.id;if($.promoteId?Ce=V.properties[$.promoteId]:$.generateId&&(Ce=K||0),Oe==="Point")H(me,Ne);else if(Oe==="MultiPoint")for(var De=0;De<me.length;De++)H(me[De],Ne);else if(Oe==="LineString")D(me,Ne,He,!1);else if(Oe==="MultiLineString"){if($.lineMetrics){for(De=0;De<me.length;De++)D(me[De],Ne=[],He,!1),oe.push(Pt(Ce,"LineString",Ne,V.properties));return}Q(me,Ne,He,!1)}else if(Oe==="Polygon")Q(me,Ne,He,!0);else{if(Oe!=="MultiPolygon"){if(Oe!=="GeometryCollection")throw new Error("Input data is not a valid GeoJSON object.");for(De=0;De<V.geometry.geometries.length;De++)B(oe,{id:Ce,geometry:V.geometry.geometries[De],properties:V.properties},$,K);return}for(De=0;De<me.length;De++){var ot=[];Q(me[De],ot,He,!0),Ne.push(ot)}}oe.push(Pt(Ce,Oe,Ne,V.properties))}}function H(oe,V){V.push(ae(oe[0])),V.push(q(oe[1])),V.push(0)}function D(oe,V,$,K){for(var me,Oe,He=0,Ne=0;Ne<oe.length;Ne++){var Ce=ae(oe[Ne][0]),De=q(oe[Ne][1]);V.push(Ce),V.push(De),V.push(0),0<Ne&&(He+=K?(me*De-Ce*Oe)/2:Math.sqrt(Math.pow(Ce-me,2)+Math.pow(De-Oe,2))),me=Ce,Oe=De}var ot=V.length-3;V[2]=1,lt(V,0,ot,$),V[2+ot]=1,V.size=Math.abs(He),V.start=0,V.end=V.size}function Q(oe,V,$,K){for(var me=0;me<oe.length;me++){var Oe=[];D(oe[me],Oe,$,K),V.push(Oe)}}function ae(oe){return oe/360+.5}function q(oe){return oe=Math.sin(oe*Math.PI/180),oe=.5-.25*Math.log((1+oe)/(1-oe))/Math.PI,oe<0?0:1<oe?1:oe}function Ae(oe,V,$,K,me,Oe,He,Ne){if(K/=V,($/=V)<=Oe&&He<K)return oe;if(He<$||K<=Oe)return null;for(var Ce=[],De=0;De<oe.length;De++){var ot=oe[De],st=ot.geometry,St=ot.type,un=me===0?ot.minX:ot.minY,tn=me===0?ot.maxX:ot.maxY;if($<=un&&tn<K)Ce.push(ot);else if(!(tn<$||K<=un)){var _n=[];if(St==="Point"||St==="MultiPoint"){Yn=gn=pn=Bn=On=er=Kn=void 0;for(var Kn=st,er=_n,On=$,Bn=K,pn=me,gn=0;gn<Kn.length;gn+=3){var Yn=Kn[gn+pn];On<=Yn&&Yn<=Bn&&(er.push(Kn[gn]),er.push(Kn[gn+1]),er.push(Kn[gn+2]))}}else if(St==="LineString")Pe(st,_n,$,K,me,!1,Ne.lineMetrics);else if(St==="MultiLineString")rt(st,_n,$,K,me,!1);else if(St==="Polygon")rt(st,_n,$,K,me,!0);else if(St==="MultiPolygon")for(var Br=0;Br<st.length;Br++){var si=[];rt(st[Br],si,$,K,me,!0),si.length&&_n.push(si)}if(_n.length)if(Ne.lineMetrics&&St==="LineString")for(Br=0;Br<_n.length;Br++)Ce.push(Pt(ot.id,St,_n[Br],ot.tags));else St!=="LineString"&&St!=="MultiLineString"||(_n.length===1?(St="LineString",_n=_n[0]):St="MultiLineString"),St!=="Point"&&St!=="MultiPoint"||(St=_n.length===3?"Point":"MultiPoint"),Ce.push(Pt(ot.id,St,_n,ot.tags))}}return Ce.length?Ce:null}function Pe(oe,V,$,K,me,Oe,He){for(var Ne,Ce,De=We(oe),ot=me===0?Bt:Lt,st=oe.start,St=0;St<oe.length-3;St+=3){var Bn=oe[St],pn=oe[St+1],gn=oe[St+2],un=oe[St+3],tn=oe[St+4],_n=me===0?Bn:pn,Kn=me===0?un:tn,er=!1;He&&(Ne=Math.sqrt(Math.pow(Bn-un,2)+Math.pow(pn-tn,2))),_n<$?$<Kn&&(Ce=ot(De,Bn,pn,un,tn,$),He)&&(De.start=st+Ne*Ce):K<_n?Kn<K&&(Ce=ot(De,Bn,pn,un,tn,K),He)&&(De.start=st+Ne*Ce):Et(De,Bn,pn,gn),Kn<$&&$<=_n&&(Ce=ot(De,Bn,pn,un,tn,$),er=!0),K<Kn&&_n<=K&&(Ce=ot(De,Bn,pn,un,tn,K),er=!0),!Oe&&er&&(He&&(De.end=st+Ne*Ce),V.push(De),De=We(oe)),He&&(st+=Ne)}var On=oe.length-3,Bn=oe[On],pn=oe[1+On],gn=oe[2+On];$<=(_n=me===0?Bn:pn)&&_n<=K&&Et(De,Bn,pn,gn),On=De.length-3,Oe&&3<=On&&(De[On]!==De[0]||De[1+On]!==De[1])&&Et(De,De[0],De[1],De[2]),De.length&&V.push(De)}function We(oe){var V=[];return V.size=oe.size,V.start=oe.start,V.end=oe.end,V}function rt(oe,V,$,K,me,Oe){for(var He=0;He<oe.length;He++)Pe(oe[He],V,$,K,me,Oe,!1)}function Et(oe,V,$,K){oe.push(V),oe.push($),oe.push(K)}function Bt(oe,V,$,K,me,Oe){return K=(Oe-V)/(K-V),oe.push(Oe),oe.push($+(me-$)*K),oe.push(1),K}function Lt(oe,V,$,K,me,Oe){return me=(Oe-$)/(me-$),oe.push(V+(K-V)*me),oe.push(Oe),oe.push(1),me}function an(oe,V){for(var $=[],K=0;K<oe.length;K++){var me=oe[K],Oe=me.type;if(Oe==="Point"||Oe==="MultiPoint"||Oe==="LineString")He=Ie(me.geometry,V);else if(Oe==="MultiLineString"||Oe==="Polygon")for(var He=[],Ne=0;Ne<me.geometry.length;Ne++)He.push(Ie(me.geometry[Ne],V));else if(Oe==="MultiPolygon")for(He=[],Ne=0;Ne<me.geometry.length;Ne++){for(var Ce=[],De=0;De<me.geometry[Ne].length;De++)Ce.push(Ie(me.geometry[Ne][De],V));He.push(Ce)}$.push(Pt(me.id,Oe,He,me.tags))}return $}function Ie(oe,V){var $=[];$.size=oe.size,oe.start!==void 0&&($.start=oe.start,$.end=oe.end);for(var K=0;K<oe.length;K+=3)$.push(oe[K]+V,oe[K+1],oe[K+2]);return $}function Te(oe,V){if(!oe.transformed){for(var $,K=1<<oe.z,me=oe.x,Oe=oe.y,He=0;He<oe.features.length;He++){var Ne=oe.features[He],Ce=Ne.geometry,De=Ne.type;if(Ne.geometry=[],De===1)for($=0;$<Ce.length;$+=2)Ne.geometry.push(At(Ce[$],Ce[$+1],V,K,me,Oe));else for($=0;$<Ce.length;$++){for(var ot=[],st=0;st<Ce[$].length;st+=2)ot.push(At(Ce[$][st],Ce[$][st+1],V,K,me,Oe));Ne.geometry.push(ot)}}oe.transformed=!0}return oe}function At(oe,V,$,K,me,Oe){return[Math.round($*(oe*K-me)),Math.round($*(V*K-Oe))]}function xt(oe,V,$,K,me){for(var Oe=V===me.maxZoom?0:me.tolerance/((1<<V)*me.extent),He={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:$,y:K,z:V,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},Ne=0;Ne<oe.length;Ne++){He.numFeatures++,On=er=Kn=_n=tn=un=St=st=Bn=ot=De=Ce=void 0;var Ce=He,De=oe[Ne],ot=Oe,Bn=me,st=De.geometry,St=De.type,un=[];if(St==="Point"||St==="MultiPoint")for(var tn=0;tn<st.length;tn+=3)un.push(st[tn]),un.push(st[tn+1]),Ce.numPoints++,Ce.numSimplified++;else if(St==="LineString")qt(un,st,Ce,ot,!1,!1);else if(St==="MultiLineString"||St==="Polygon")for(tn=0;tn<st.length;tn++)qt(un,st[tn],Ce,ot,St==="Polygon",tn===0);else if(St==="MultiPolygon")for(var _n=0;_n<st.length;_n++){var Kn=st[_n];for(tn=0;tn<Kn.length;tn++)qt(un,Kn[tn],Ce,ot,!0,tn===0)}if(un.length){var er=De.tags||null;if(St==="LineString"&&Bn.lineMetrics){for(var On in er={},De.tags)er[On]=De.tags[On];er.mapbox_clip_start=st.start/st.size,er.mapbox_clip_end=st.end/st.size}Bn={geometry:un,type:St==="Polygon"||St==="MultiPolygon"?3:St==="LineString"||St==="MultiLineString"?2:1,tags:er},De.id!==null&&(Bn.id=De.id),Ce.features.push(Bn)}var Bn=oe[Ne].minX,pn=oe[Ne].minY,gn=oe[Ne].maxX,Yn=oe[Ne].maxY;Bn<He.minX&&(He.minX=Bn),pn<He.minY&&(He.minY=pn),He.maxX<gn&&(He.maxX=gn),He.maxY<Yn&&(He.maxY=Yn)}return He}function qt(oe,V,$,K,me,Oe){var He=K*K;if(0<K&&V.size<(me?He:K))$.numPoints+=V.length/3;else{for(var Ne=[],Ce=0;Ce<V.length;Ce+=3)(K===0||V[Ce+2]>He)&&($.numSimplified++,Ne.push(V[Ce]),Ne.push(V[Ce+1])),$.numPoints++;if(me){for(var De=Ne,me=Oe,ot=0,st=0,St=De.length,un=St-2;st<St;un=st,st+=2)ot+=(De[st]-De[un])*(De[st+1]+De[un+1]);if(0<ot===me)for(st=0,St=De.length;st<St/2;st+=2){var tn=De[st],_n=De[st+1];De[st]=De[St-2-st],De[st+1]=De[St-1-st],De[St-2-st]=tn,De[St-1-st]=_n}}oe.push(Ne)}}function fn(oe,V){return new Ke(oe,V)}function Ke(Ce,V){var $=(V=this.options=function(De,ot){for(var st in ot)De[st]=ot[st];return De}(Object.create(this.options),V)).debug;if($&&console.time("preprocess data"),V.maxZoom<0||24<V.maxZoom)throw new Error("maxZoom should be in the 0-24 range");if(V.promoteId&&V.generateId)throw new Error("promoteId and generateId cannot be used together.");var K,me,Oe,He,Ne,Ce=function(De,ot){var st=[];if(De.type==="FeatureCollection")for(var St=0;St<De.features.length;St++)B(st,De.features[St],ot,St);else De.type==="Feature"?B(st,De,ot):B(st,{geometry:De},ot);return st}(Ce,V);this.tiles={},this.tileCoords=[],$&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",V.indexMaxZoom,V.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),K=Ce,me=(V=V).buffer/V.extent,He=Ae(Oe=K,1,-1-me,me,0,-1,2,V),Ne=Ae(K,1,1-me,2+me,0,-1,2,V),(Ce=Oe=(He||Ne)&&(Oe=Ae(K,1,-me,1+me,0,-1,2,V)||[],He&&(Oe=an(He,1).concat(Oe)),Ne)?Oe.concat(an(Ne,-1)):Oe).length&&this.splitTile(Ce,0,0,0),$&&(Ce.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function gt(oe,V,$){return 32*((1<<oe)*$+V)+oe}function Tt(oe,V){return V?oe.properties[V]:oe.id}function Rn(oe,V){if(oe==null)return 1;if(oe.type==="Feature")return Tt(oe,V)!=null;if(oe.type==="FeatureCollection"){var $=new Set;for(const me of oe.features){var K=Tt(me,V);if(K==null||$.has(K))return;$.add(K)}return 1}}function Qn(oe,V){var $=new Map;if(oe!=null)if(oe.type==="Feature")$.set(Tt(oe,V),oe);else for(const K of oe.features)$.set(Tt(K,V),K);return $}function nn(oe,V,$){if(V.removeAll&&oe.clear(),V.remove)for(const Ce of V.remove)oe.delete(Ce);if(V.add)for(const Ce of V.add){var K=Tt(Ce,$);K!=null&&oe.set(K,Ce)}if(V.update)for(const Ce of V.update){let De=oe.get(Ce.id);if(De!=null){var me=Ce.newGeometry||Ce.removeAllProperties,Oe=!Ce.removeAllProperties&&(0<((Oe=Ce.removeProperties)==null?void 0:Oe.length)||0<((Oe=Ce.addOrUpdateProperties)==null?void 0:Oe.length));if((me||Oe)&&(De=Object.assign({},De),oe.set(Ce.id,De),Oe)&&(De.properties=Object.assign({},De.properties)),Ce.newGeometry&&(De.geometry=Ce.newGeometry),Ce.removeAllProperties)De.properties={};else if(0<((me=Ce.removeProperties)==null?void 0:me.length))for(const ot of Ce.removeProperties)Object.prototype.hasOwnProperty.call(De.properties,ot)&&delete De.properties[ot];if(0<((me=Ce.addOrUpdateProperties)==null?void 0:me.length))for(var{key:He,value:Ne}of Ce.addOrUpdateProperties)De.properties[He]=Ne}}}Ke.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Ke.prototype.splitTile=function(oe,V,$,K,me,Oe,He){for(var Ne=[oe,V,$,K],Ce=this.options,De=Ce.debug;Ne.length;){K=Ne.pop(),$=Ne.pop(),V=Ne.pop(),oe=Ne.pop();var ot,st,St,un,tn,_n,Kn,er,On,Bn=1<<V,pn=gt(V,$,K),gn=this.tiles[pn];if(gn||(1<De&&console.time("creation"),gn=this.tiles[pn]=xt(oe,V,$,K,Ce),this.tileCoords.push({z:V,x:$,y:K}),De&&(1<De&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",V,$,K,gn.numFeatures,gn.numPoints,gn.numSimplified),console.timeEnd("creation")),this.stats[pn="z"+V]=(this.stats[pn]||0)+1,this.total++)),gn.source=oe,me){if(V===Ce.maxZoom||V===me)continue;var pn=1<<me-V;if($!==Math.floor(Oe/pn)||K!==Math.floor(He/pn))continue}else if(V===Ce.indexMaxZoom||gn.numPoints<=Ce.indexMaxPoints)continue;gn.source=null,oe.length!==0&&(1<De&&console.time("clipping"),ot=.5-(pn=.5*Ce.buffer/Ce.extent),St=1+pn,Kn=un=tn=_n=null,er=Ae(oe,Bn,$-pn,$+(st=.5+pn),0,gn.minX,gn.maxX,Ce),On=Ae(oe,Bn,$+ot,$+St,0,gn.minX,gn.maxX,Ce),oe=null,er&&(Kn=Ae(er,Bn,K-pn,K+st,1,gn.minY,gn.maxY,Ce),un=Ae(er,Bn,K+ot,K+St,1,gn.minY,gn.maxY,Ce),er=null),On&&(tn=Ae(On,Bn,K-pn,K+st,1,gn.minY,gn.maxY,Ce),_n=Ae(On,Bn,K+ot,K+St,1,gn.minY,gn.maxY,Ce),On=null),1<De&&console.timeEnd("clipping"),Ne.push(Kn||[],V+1,2*$,2*K),Ne.push(un||[],V+1,2*$,2*K+1),Ne.push(tn||[],V+1,2*$+1,2*K),Ne.push(_n||[],V+1,2*$+1,2*K+1))}},Ke.prototype.getTile=function(oe,V,$){var me=this.options,K=me.extent,me=me.debug;if(oe<0||24<oe)return null;var Oe=1<<oe,Oe=gt(oe,V=(V%Oe+Oe)%Oe,$);if(this.tiles[Oe])return Te(this.tiles[Oe],K);1<me&&console.log("drilling down to z%d-%d-%d",oe,V,$);for(var He,Ne=oe,Ce=V,De=$;!He&&0<Ne;)Ne--,Ce=Math.floor(Ce/2),De=Math.floor(De/2),He=this.tiles[gt(Ne,Ce,De)];return He&&He.source&&(1<me&&console.log("found parent tile z%d-%d-%d",Ne,Ce,De),1<me&&console.time("drilling down"),this.splitTile(He.source,Ne,Ce,De,oe,V,$),1<me&&console.timeEnd("drilling down"),this.tiles[Oe])?Te(this.tiles[Oe],K):null};class Fr extends p{constructor(){super(...arguments),this._dataUpdateable=new Map}loadVectorTile(V,$){return i.__awaiter(this,void 0,void 0,function*(){var K=V.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");if(K=this._geoJSONIndex.getTile(K.z,K.x,K.y),!K)return null;K=new F(K.features);let me=ht(K);return{vectorTile:K,rawData:(me=me.byteOffset===0&&me.byteLength===me.buffer.byteLength?me:new Uint8Array(me)).buffer}})}loadData(V){return i.__awaiter(this,void 0,void 0,function*(){($=this._pendingRequest)!=null&&$.abort();var $=!!(V&&V.request&&V.request.collectResourceTiming)&&new i.RequestPerformance(V.request);this._pendingRequest=new AbortController;try{let He=yield this.loadGeoJSON(V,this._pendingRequest);if(delete this._pendingRequest,typeof He!="object")throw new Error(`Input data given to '${V.source}' is not a valid GeoJSON object.`);if(C(He,!0),V.filter){const Ne=i.createExpression(V.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Ne.result==="error")throw new Error(Ne.value.map(Ce=>Ce.key+": "+Ce.message).join(", "));var K=He.features.filter(Ce=>Ne.value.evaluate({zoom:0},Ce));He={type:"FeatureCollection",features:K}}this._geoJSONIndex=V.cluster?new Qt(ti(V)).load(He.features):fn(He,V.geojsonVtOptions),this.loaded={};var me,Oe={};return $&&(me=$.finish())&&(Oe.resourceTiming={},Oe.resourceTiming[V.source]=JSON.parse(JSON.stringify(me))),Oe}catch(He){if(delete this._pendingRequest,i.isAbortError(He))return{abandoned:!0};throw He}})}reloadTile(V){var $=this.loaded,K=V.uid;return $&&$[K]?super.reloadTile(V):this.loadTile(V)}loadGeoJSON(V,$){return i.__awaiter(this,void 0,void 0,function*(){var K,me=V.promoteId;if(V.request)return K=yield i.getJSON(V.request,$),this._dataUpdateable=Rn(K.data,me)?Qn(K.data,me):void 0,K.data;if(typeof V.data=="string")try{var Oe=JSON.parse(V.data);return this._dataUpdateable=Rn(Oe,me)?Qn(Oe,me):void 0,Oe}catch{throw new Error(`Input data given to '${V.source}' is not a valid GeoJSON object.`)}if(!V.dataDiff)throw new Error(`Input data given to '${V.source}' is not a valid GeoJSON object.`);if(this._dataUpdateable)return nn(this._dataUpdateable,V.dataDiff,me),{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())};throw new Error("Cannot update existing geojson data in "+V.source)})}removeSource(V){return i.__awaiter(this,void 0,void 0,function*(){this._pendingRequest&&this._pendingRequest.abort()})}getClusterExpansionZoom(V){return this._geoJSONIndex.getClusterExpansionZoom(V.clusterId)}getClusterChildren(V){return this._geoJSONIndex.getChildren(V.clusterId)}getClusterLeaves(V){return this._geoJSONIndex.getLeaves(V.clusterId,V.limit,V.offset)}}function ti({superclusterOptions:oe,clusterProperties:V}){if(V&&oe){const me={},Oe={},He={accumulated:null,zoom:0},Ne={properties:null},Ce=Object.keys(V);for(const De of Ce){var[K,$]=V[De],$=i.createExpression($),K=i.createExpression(typeof K=="string"?[K,["accumulated"],["get",De]]:K);me[De]=$.value,Oe[De]=K.value}oe.map=De=>{Ne.properties=De;var ot={};for(const st of Ce)ot[st]=me[st].evaluate(He,Ne);return ot},oe.reduce=(De,ot)=>{Ne.properties=ot;for(const st of Ce)He.accumulated=De[st],De[st]=Oe[st].evaluate(He,Ne)}}return oe}class Ar{constructor(V){this.self=V,this.actor=new i.Actor(V),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.self.registerWorkerSource=($,K)=>{if(this.externalWorkerSourceTypes[$])throw new Error(`Worker source with name "${$}" already registered.`);this.externalWorkerSourceTypes[$]=K},this.self.addProtocol=i.addProtocol,this.self.removeProtocol=i.removeProtocol,this.self.registerRTLTextPlugin=$=>{if(i.rtlWorkerPlugin.isParsed())throw new Error("RTL text plugin already registered.");i.rtlWorkerPlugin.setMethods($)},this.actor.registerMessageHandler("LDT",($,K)=>this._getDEMWorkerSource($,K.source).loadTile(K)),this.actor.registerMessageHandler("RDT",($,K)=>i.__awaiter(this,void 0,void 0,function*(){this._getDEMWorkerSource($,K.source).removeTile(K)})),this.actor.registerMessageHandler("GCEZ",($,K)=>i.__awaiter(this,void 0,void 0,function*(){return this._getWorkerSource($,K.type,K.source).getClusterExpansionZoom(K)})),this.actor.registerMessageHandler("GCC",($,K)=>i.__awaiter(this,void 0,void 0,function*(){return this._getWorkerSource($,K.type,K.source).getClusterChildren(K)})),this.actor.registerMessageHandler("GCL",($,K)=>i.__awaiter(this,void 0,void 0,function*(){return this._getWorkerSource($,K.type,K.source).getClusterLeaves(K)})),this.actor.registerMessageHandler("LD",($,K)=>this._getWorkerSource($,K.type,K.source).loadData(K)),this.actor.registerMessageHandler("LT",($,K)=>this._getWorkerSource($,K.type,K.source).loadTile(K)),this.actor.registerMessageHandler("RT",($,K)=>this._getWorkerSource($,K.type,K.source).reloadTile(K)),this.actor.registerMessageHandler("AT",($,K)=>this._getWorkerSource($,K.type,K.source).abortTile(K)),this.actor.registerMessageHandler("RMT",($,K)=>this._getWorkerSource($,K.type,K.source).removeTile(K)),this.actor.registerMessageHandler("RS",($,K)=>i.__awaiter(this,void 0,void 0,function*(){var me;this.workerSources[$]&&this.workerSources[$][K.type]&&this.workerSources[$][K.type][K.source]&&(me=this.workerSources[$][K.type][K.source],delete this.workerSources[$][K.type][K.source],me.removeSource!==void 0)&&me.removeSource(K)})),this.actor.registerMessageHandler("RM",$=>i.__awaiter(this,void 0,void 0,function*(){delete this.layerIndexes[$],delete this.availableImages[$],delete this.workerSources[$],delete this.demWorkerSources[$]})),this.actor.registerMessageHandler("SR",($,K)=>i.__awaiter(this,void 0,void 0,function*(){this.referrer=K})),this.actor.registerMessageHandler("SRPS",($,K)=>this._syncRTLPluginState($,K)),this.actor.registerMessageHandler("IS",($,K)=>i.__awaiter(this,void 0,void 0,function*(){this.self.importScripts(K)})),this.actor.registerMessageHandler("SI",($,K)=>this._setImages($,K)),this.actor.registerMessageHandler("UL",($,K)=>i.__awaiter(this,void 0,void 0,function*(){this._getLayerIndex($).update(K.layers,K.removedIds)})),this.actor.registerMessageHandler("SL",($,K)=>i.__awaiter(this,void 0,void 0,function*(){this._getLayerIndex($).replace(K)}))}_setImages(V,$){return i.__awaiter(this,void 0,void 0,function*(){this.availableImages[V]=$;for(const me in this.workerSources[V]){var K=this.workerSources[V][me];for(const Oe in K)K[Oe].availableImages=$}})}_syncRTLPluginState(V,$){return i.__awaiter(this,void 0,void 0,function*(){if(i.rtlWorkerPlugin.isParsed())return i.rtlWorkerPlugin.getState();if($.pluginStatus!=="loading")return i.rtlWorkerPlugin.setState($),$;var K=$.pluginURL,me=(this.self.importScripts(K),i.rtlWorkerPlugin.isParsed());if(me)return i.rtlWorkerPlugin.setState(me={pluginStatus:"loaded",pluginURL:K}),me;throw i.rtlWorkerPlugin.setState({pluginStatus:"error",pluginURL:""}),new Error("RTL Text Plugin failed to import scripts from "+K)})}_getAvailableImages(V){let $=this.availableImages[V];return $=$||[]}_getLayerIndex(V){let $=this.layerIndexes[V];return $=$||(this.layerIndexes[V]=new o)}_getWorkerSource(V,$,K){if(this.workerSources[V]||(this.workerSources[V]={}),this.workerSources[V][$]||(this.workerSources[V][$]={}),!this.workerSources[V][$][K]){var me={sendAsync:(Oe,He)=>(Oe.targetMapId=V,this.actor.sendAsync(Oe,He))};switch($){case"vector":this.workerSources[V][$][K]=new p(me,this._getLayerIndex(V),this._getAvailableImages(V));break;case"geojson":this.workerSources[V][$][K]=new Fr(me,this._getLayerIndex(V),this._getAvailableImages(V));break;default:this.workerSources[V][$][K]=new this.externalWorkerSourceTypes[$](me,this._getLayerIndex(V),this._getAvailableImages(V))}}return this.workerSources[V][$][K]}_getDEMWorkerSource(V,$){return this.demWorkerSources[V]||(this.demWorkerSources[V]={}),this.demWorkerSources[V][$]||(this.demWorkerSources[V][$]=new g),this.demWorkerSources[V][$]}}return i.isWorker(self)&&(self.worker=new Ar(self)),Ar}),r("index",0,function(i,o){var a,l="4.1.2",or=typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date);let h,p;const g={now:or,frameAsync(w){return new Promise((s,f)=>{const y=requestAnimationFrame(s);w.signal.addEventListener("abort",()=>{cancelAnimationFrame(y),f(o.createAbortError())})})},getImageData(w,s=0){return this.getImageCanvasContext(w).getImageData(-s,-s,w.width+2*s,w.height+2*s)},getImageCanvasContext(w){var s=window.document.createElement("canvas"),f=s.getContext("2d",{willReadFrequently:!0});if(f)return s.width=w.width,s.height=w.height,f.drawImage(w,0,0,w.width,w.height),f;throw new Error("failed to create canvas 2d context")},resolveURL(w){return(h=h||document.createElement("a")).href=w,h.href},hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(p=p??matchMedia("(prefers-reduced-motion: reduce)")).matches}};class _{static testProp(s){if(_.docStyle){for(let f=0;f<s.length;f++)if(s[f]in _.docStyle)return s[f]}return s[0]}static create(s,f,y){return s=window.document.createElement(s),f!==void 0&&(s.className=f),y&&y.appendChild(s),s}static createNS(s,f){return window.document.createElementNS(s,f)}static disableDrag(){_.docStyle&&_.selectProp&&(_.userSelect=_.docStyle[_.selectProp],_.docStyle[_.selectProp]="none")}static enableDrag(){_.docStyle&&_.selectProp&&(_.docStyle[_.selectProp]=_.userSelect)}static setTransform(s,f){s.style[_.transformProp]=f}static addEventListener(s,f,y,v={}){"passive"in v?s.addEventListener(f,y,v):s.addEventListener(f,y,v.capture)}static removeEventListener(s,f,y,v={}){"passive"in v?s.removeEventListener(f,y,v):s.removeEventListener(f,y,v.capture)}static suppressClickInternal(s){s.preventDefault(),s.stopPropagation(),window.removeEventListener("click",_.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",_.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",_.suppressClickInternal,!0)},0)}static getScale(s){var f=s.getBoundingClientRect();return{x:f.width/s.offsetWidth||1,y:f.height/s.offsetHeight||1,boundingClientRect:f}}static getPoint(s,f,y){var v=f.boundingClientRect;return new o.Point((y.clientX-v.left)/f.x-s.clientLeft,(y.clientY-v.top)/f.y-s.clientTop)}static mousePos(s,f){var y=_.getScale(s);return _.getPoint(s,y,f)}static touchPos(s,f){var y=[],v=_.getScale(s);for(let T=0;T<f.length;T++)y.push(_.getPoint(s,v,f[T]));return y}static mouseButton(s){return s.button}static remove(s){s.parentNode&&s.parentNode.removeChild(s)}}_.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,_.selectProp=_.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),_.transformProp=_.testProp(["transform","WebkitTransform"]);const x={supported:!1,testSupport:function(w){!M&&L&&(F?z(w):C=w)}};let C,M=!1,L,F=!1;function z(w){var s=w.createTexture();w.bindTexture(w.TEXTURE_2D,s);try{if(w.texImage2D(w.TEXTURE_2D,0,w.RGBA,w.RGBA,w.UNSIGNED_BYTE,L),w.isContextLost())return;x.supported=!0}catch{}w.deleteTexture(s),M=!0}typeof document<"u"&&((L=document.createElement("img")).onload=function(){C&&z(C),C=null,F=!0},L.onerror=function(){M=!0,C=null},L.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(w){let s,f,y,v;w.resetRequestQueue=()=>{s=[],f=0,y=0,v={}},w.addThrottleControl=G=>{var Z=y++;return v[Z]=G,Z},w.removeThrottleControl=G=>{delete v[G],R()},w.getImage=(G,Z,j=!0)=>new Promise((X,ge)=>{x.supported&&(G.headers||(G.headers={}),G.headers.accept="image/webp,*/*"),o.extend(G,{type:"image"});var ye={abortController:Z,requestParameters:G,supportImageRefresh:j,state:"queued",onError:be=>{ge(be)},onSuccess:be=>{X(be)}};s.push(ye),R()});const T=G=>typeof createImageBitmap=="function"?o.arrayBufferToImageBitmap(G):o.arrayBufferToImage(G),P=G=>o.__awaiter(this,void 0,void 0,function*(){G.state="running";var{requestParameters:Z,supportImageRefresh:ye,onError:j,onSuccess:X,abortController:ge}=G,ye=ye===!1&&!o.isWorker(self)&&!o.getProtocol(Z.url)&&(!Z.headers||Object.keys(Z.headers).reduce((ve,Fe)=>ve&&Fe==="accept",!0)),ye=(f++,ye?N(Z,ge):o.makeRequest(Z,ge));try{var be=yield ye;delete G.abortController,G.state="completed",be.data instanceof HTMLImageElement||o.isImageBitmap(be.data)?X(be):be.data&&X({data:yield T(be.data),cacheControl:be.cacheControl,expires:be.expires})}catch(ve){delete G.abortController,j(ve)}finally{f--,R()}}),R=()=>{var G=(()=>{for(const j of Object.keys(v))if(v[j]())return!0;return!1})()?o.config.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:o.config.MAX_PARALLEL_IMAGE_REQUESTS;for(let j=f;j<G&&0<s.length;j++){var Z=s.shift();Z.abortController.signal.aborted?j--:P(Z)}},N=(G,Z)=>new Promise((j,X)=>{const ge=new Image;var ye=G.url,be=G.credentials;be&&be==="include"?ge.crossOrigin="use-credentials":(be&&be==="same-origin"||!o.sameOrigin(ye))&&(ge.crossOrigin="anonymous"),Z.signal.addEventListener("abort",()=>{ge.src="",X(o.createAbortError())}),ge.fetchPriority="high",ge.onload=()=>{ge.onerror=ge.onload=null,j({data:ge})},ge.onerror=()=>{ge.onerror=ge.onload=null,Z.signal.aborted||X(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},ge.src=ye})}(a=a||{}),a.resetRequestQueue();class ee{constructor(s){this._transformRequestFn=s}transformRequest(s,f){return this._transformRequestFn&&this._transformRequestFn(s,f)||{url:s}}normalizeSpriteURL(s,f,y){return s=se(s),s.path+=""+f+y,_e(s)}setTransformRequest(s){this._transformRequestFn=s}}const ce=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function se(w){var s=w.match(ce);if(s)return{protocol:s[1],authority:s[2],path:s[3]||"/",params:s[4]?s[4].split("&"):[]};throw new Error(`Unable to parse URL "${w}"`)}function _e(w){var s=w.params.length?"?"+w.params.join("&"):"";return w.protocol+"://"+w.authority+w.path+s}function J(w){var s=[];if(typeof w=="string")s.push({id:"default",url:w});else if(w&&0<w.length){var f,y,v=[];for({id:f,url:y}of w){var T=""+f+y;v.indexOf(T)===-1&&(v.push(T),s.push({id:f,url:y}))}}return s}function pe(w,s,f,y){return o.__awaiter(this,void 0,void 0,function*(){var v,T,P=J(w),R=1<f?"@2x":"",N={},G={};for({id:v,url:T}of P){var Z=s.transformRequest(s.normalizeSpriteURL(T,R,".json"),"SpriteJSON"),Z=(N[v]=o.getJSON(Z,y),s.transformRequest(s.normalizeSpriteURL(T,R,".png"),"SpriteImage"));G[v]=a.getImage(Z,y)}return yield Promise.all([...Object.values(N),...Object.values(G)]),function(j,X){return o.__awaiter(this,void 0,void 0,function*(){var ge={};for(const Dt in j){ge[Dt]={};var ye=g.getImageCanvasContext((yield X[Dt]).data),be=(yield j[Dt]).data;for(const Yt in be){var{width:ve,height:Fe,x:Ue,y:ze,sdf:Qe,pixelRatio:Je,stretchX:Xe,stretchY:ct,content:it,contentMatch:_t}=be[Yt];ge[Dt][Yt]={data:null,pixelRatio:Je,sdf:Qe,stretchX:Xe,stretchY:ct,content:it,spriteData:{width:ve,height:Fe,x:Ue,y:ze,context:ye},contentMatch:_t}}}return ge})}(N,G)})}class ue{constructor(s,f,y,v){this.context=s,this.format=y,this.texture=s.gl.createTexture(),this.update(f,v)}update(s,f,y){var{width:v,height:T}=s,P=!(this.size&&this.size[0]===v&&this.size[1]===T||y),R=this.context,N=R.gl;this.useMipmap=!!(f&&f.useMipmap),N.bindTexture(N.TEXTURE_2D,this.texture),R.pixelStoreUnpackFlipY.set(!1),R.pixelStoreUnpack.set(1),R.pixelStoreUnpackPremultiplyAlpha.set(this.format===N.RGBA&&(!f||f.premultiply!==!1)),P?(this.size=[v,T],s instanceof HTMLImageElement||s instanceof HTMLCanvasElement||s instanceof HTMLVideoElement||s instanceof ImageData||o.isImageBitmap(s)?N.texImage2D(N.TEXTURE_2D,0,this.format,this.format,N.UNSIGNED_BYTE,s):N.texImage2D(N.TEXTURE_2D,0,this.format,v,T,0,this.format,N.UNSIGNED_BYTE,s.data)):({x:R,y:f}=y||{x:0,y:0},s instanceof HTMLImageElement||s instanceof HTMLCanvasElement||s instanceof HTMLVideoElement||s instanceof ImageData||o.isImageBitmap(s)?N.texSubImage2D(N.TEXTURE_2D,0,R,f,N.RGBA,N.UNSIGNED_BYTE,s):N.texSubImage2D(N.TEXTURE_2D,0,R,f,v,T,N.RGBA,N.UNSIGNED_BYTE,s.data)),this.useMipmap&&this.isSizePowerOfTwo()&&N.generateMipmap(N.TEXTURE_2D)}bind(s,f,y){var v=this.context,v=v.gl;v.bindTexture(v.TEXTURE_2D,this.texture),y!==v.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(y=v.LINEAR),s!==this.filter&&(v.texParameteri(v.TEXTURE_2D,v.TEXTURE_MAG_FILTER,s),v.texParameteri(v.TEXTURE_2D,v.TEXTURE_MIN_FILTER,y||s),this.filter=s),f!==this.wrap&&(v.texParameteri(v.TEXTURE_2D,v.TEXTURE_WRAP_S,f),v.texParameteri(v.TEXTURE_2D,v.TEXTURE_WRAP_T,f),this.wrap=f)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){var s=this.context.gl;s.deleteTexture(this.texture),this.texture=null}}class xe extends o.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new o.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(s){if(this.loaded!==s&&(this.loaded=s)){for(var{ids:f,promiseResolve:y}of this.requestors)y(this._getImagesForIds(f));this.requestors=[]}}getImage(y){var f,y=this.images[y];return y&&!y.data&&y.spriteData&&(f=y.spriteData,y.data=new o.RGBAImage({width:f.width,height:f.height},f.context.getImageData(f.x,f.y,f.width,f.height).data),y.spriteData=null),y}addImage(s,f){if(this.images[s])throw new Error(`Image id ${s} already exist, use updateImage instead`);this._validate(s,f)&&(this.images[s]=f)}_validate(s,f){let y=!0;var v=f.data||f.spriteData;return this._validateStretch(f.stretchX,v&&v.width)||(this.fire(new o.ErrorEvent(new Error(`Image "${s}" has invalid "stretchX" value`))),y=!1),this._validateStretch(f.stretchY,v&&v.height)||(this.fire(new o.ErrorEvent(new Error(`Image "${s}" has invalid "stretchY" value`))),y=!1),this._validateContent(f.content,f)||(this.fire(new o.ErrorEvent(new Error(`Image "${s}" has invalid "content" value`))),y=!1),y}_validateStretch(s,f){if(s){let y=0;for(const v of s){if(v[0]<y||v[1]<v[0]||f<v[1])return!1;y=v[1]}}return!0}_validateContent(s,f){var y,v;return!s||s.length===4&&(y=(v=f.spriteData)&&v.width||f.data.width,v=v&&v.height||f.data.height,!(s[0]<0||y<s[0]||s[1]<0||v<s[1]||s[2]<0||y<s[2]||s[3]<0||v<s[3]||s[2]<s[0]||s[3]<s[1]))}updateImage(s,f,y=!0){var v=this.getImage(s);if(y&&(v.data.width!==f.data.width||v.data.height!==f.data.height))throw new Error(`size mismatch between old image (${v.data.width}x${v.data.height}) and new image (${f.data.width}x${f.data.height}).`);f.version=v.version+1,this.images[s]=f,this.updatedImages[s]=!0}removeImage(s){var f=this.images[s];delete this.images[s],delete this.patterns[s],f.userImage&&f.userImage.onRemove&&f.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(s){return new Promise((f,y)=>{let v=!0;if(!this.isLoaded())for(const T of s)this.images[T]||(v=!1);this.isLoaded()||v?f(this._getImagesForIds(s)):this.requestors.push({ids:s,promiseResolve:f})})}_getImagesForIds(s){var f={};for(const y of s){let v=this.getImage(y);v||(this.fire(new o.Event("styleimagemissing",{id:y})),v=this.getImage(y)),v?f[y]={data:v.data.clone(),pixelRatio:v.pixelRatio,sdf:v.sdf,version:v.version,stretchX:v.stretchX,stretchY:v.stretchY,content:v.content,contentMatch:v.contentMatch,hasRenderCallback:!!(v.userImage&&v.userImage.render)}:o.warnOnce(`Image "${y}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return f}getPixelSize(){var{width:s,height:f}=this.atlasImage;return{width:s,height:f}}getPattern(s){var f=this.patterns[s],y=this.getImage(s);return y?(f&&f.position.version===y.version?f:(f?f.position.version=y.version:(f={w:y.data.width+2,h:y.data.height+2,x:0,y:0},y=new o.ImagePosition(f,y),this.patterns[s]={bin:f,position:y}),this._updatePatternAtlas(),this.patterns[s])).position:null}bind(s){var f=s.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new ue(s,this.atlasImage,f.RGBA),this.atlasTexture.bind(f.LINEAR,f.CLAMP_TO_EDGE)}_updatePatternAtlas(){var s=[];for(const N in this.patterns)s.push(this.patterns[N].bin);const{w:f,h:y}=o.potpack(s);var v=this.atlasImage;v.resize({width:f||1,height:y||1});for(const N in this.patterns){var P=this.patterns[N].bin,T=P.x+1,P=P.y+1,R=this.getImage(N).data;const G=R.width,Z=R.height;o.RGBAImage.copy(R,v,{x:0,y:0},{x:T,y:P},{width:G,height:Z}),o.RGBAImage.copy(R,v,{x:0,y:Z-1},{x:T,y:P-1},{width:G,height:1}),o.RGBAImage.copy(R,v,{x:0,y:0},{x:T,y:P+Z},{width:G,height:1}),o.RGBAImage.copy(R,v,{x:G-1,y:0},{x:T-1,y:P},{width:1,height:Z}),o.RGBAImage.copy(R,v,{x:0,y:0},{x:T+G,y:P},{width:1,height:Z})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(s){for(const y of s){var f;this.callbackDispatchedThisFrame[y]||(this.callbackDispatchedThisFrame[y]=!0,(f=this.getImage(y))||o.warnOnce(`Image with ID: "${y}" was not found`),o.renderStyleImage(f)&&this.updateImage(y,f))}}}const je=1e20;function ne(w,s,f,y,v,T,P,R,N){for(let G=s;G<s+y;G++)Ee(w,f*T+G,T,v,P,R,N);for(let G=f;G<f+v;G++)Ee(w,G*T+s,1,y,P,R,N)}function Ee(w,s,f,y,v,T,P){P[T[0]=0]=-je,P[1]=je,v[0]=w[s];for(let j=1,X=0,ge=0;j<y;j++){v[j]=w[s+j*f];var R=j*j;do{var N=T[X];ge=(v[j]-v[N]+R-N*N)/(j-N)/2}while(ge<=P[X]&&-1<--X);T[++X]=j,P[X]=ge,P[X+1]=je}for(let j=0,X=0;j<y;j++){for(;P[X+1]<j;)X++;var G=T[X],Z=j-G;w[s+j*f]=v[G]+Z*Z}}class ke{constructor(s,f){this.requestManager=s,this.localIdeographFontFamily=f,this.entries={}}setURL(s){this.url=s}getGlyphs(s){return o.__awaiter(this,void 0,void 0,function*(){var f=[];for(const R in s)for(const N of s[R])f.push(this._getAndCacheGlyphsPromise(R,N));var y,v,T,P={};for({stack:y,id:v,glyph:T}of yield Promise.all(f))P[y]||(P[y]={}),P[y][v]=T&&{id:T.id,bitmap:T.bitmap.clone(),metrics:T.metrics};return P})}_getAndCacheGlyphsPromise(s,f){return o.__awaiter(this,void 0,void 0,function*(){let y=this.entries[s];var v=(y=y||(this.entries[s]={glyphs:{},requests:{},ranges:{}})).glyphs[f];if(v!==void 0)return{stack:s,id:f,glyph:v};if(v=this._tinySDF(y,s,f))return y.glyphs[f]=v,{stack:s,id:f,glyph:v};var T=Math.floor(f/256);if(65535<256*T)throw new Error("glyphs > 65535 not supported");if(y.ranges[T])return{stack:s,id:f,glyph:v};if(!this.url)throw new Error("glyphsUrl is not set");y.requests[T]||(v=ke.loadGlyphRange(s,T,this.url,this.requestManager),y.requests[T]=v);var P=yield y.requests[T];for(const R in P)this._doesCharSupportLocalGlyph(+R)||(y.glyphs[+R]=P[+R]);return y.ranges[T]=!0,{stack:s,id:f,glyph:P[f]||null}})}_doesCharSupportLocalGlyph(s){return!!this.localIdeographFontFamily&&(o.unicodeBlockLookup["CJK Unified Ideographs"](s)||o.unicodeBlockLookup["Hangul Syllables"](s)||o.unicodeBlockLookup.Hiragana(s)||o.unicodeBlockLookup.Katakana(s))}_tinySDF(s,f,y){var v=this.localIdeographFontFamily;if(v&&this._doesCharSupportLocalGlyph(y)){let T=s.tinySDF;if(!T){let P="400";/bold/i.test(f)?P="900":/medium/i.test(f)?P="500":/light/i.test(f)&&(P="200"),T=s.tinySDF=new ke.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:v,fontWeight:P})}return f=T.draw(String.fromCharCode(y)),{id:y,bitmap:new o.AlphaImage({width:f.width||60,height:f.height||60},f.data),metrics:{width:f.glyphWidth/2||24,height:f.glyphHeight/2||24,left:f.glyphLeft/2+.5||0,top:f.glyphTop/2-27.5||-8,advance:f.glyphAdvance/2||24,isDoubleResolution:!0}}}}}ke.loadGlyphRange=function(w,s,f,y){return o.__awaiter(this,void 0,void 0,function*(){var v=256*s,T=255+v,P=y.transformRequest(f.replace("{fontstack}",w).replace("{range}",v+"-"+T),"Glyphs"),P=yield o.getArrayBuffer(P,new AbortController);if(!P||!P.data)throw new Error(`Could not load glyph range. range: ${s}, ${v}-`+T);var R={};for(const N of o.parseGlyphPbf(P.data))R[N.id]=N;return R})},ke.TinySDF=class{constructor({fontSize:w=24,buffer:s=3,radius:f=8,cutoff:y=.25,fontFamily:v="sans-serif",fontWeight:T="normal",fontStyle:P="normal"}={}){this.buffer=s,this.cutoff=y,this.radius=f,y=this.size=w+4*s,f=this._createCanvas(y),s=this.ctx=f.getContext("2d",{willReadFrequently:!0}),s.font=P+` ${T} ${w}px `+v,s.textBaseline="alphabetic",s.textAlign="left",s.fillStyle="black",this.gridOuter=new Float64Array(y*y),this.gridInner=new Float64Array(y*y),this.f=new Float64Array(y),this.z=new Float64Array(y+1),this.v=new Uint16Array(y)}_createCanvas(w){var s=document.createElement("canvas");return s.width=s.height=w,s}draw(w){var{width:s,actualBoundingBoxAscent:y,actualBoundingBoxDescent:f,actualBoundingBoxLeft:Z,actualBoundingBoxRight:R}=this.ctx.measureText(w),y=Math.ceil(y),v=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(R-Z))),T=Math.min(this.size-this.buffer,y+Math.ceil(f)),P=v+2*this.buffer,R=T+2*this.buffer,N=Math.max(P*R,0),G=new Uint8ClampedArray(N),Z={data:G,width:P,height:R,glyphWidth:v,glyphHeight:T,glyphTop:y,glyphLeft:0,glyphAdvance:s};if(v!==0&&T!==0){var{ctx:f,buffer:j,gridInner:X,gridOuter:ge}=this,ye=(f.clearRect(j,j,v,T),f.fillText(w,j,j+y),f.getImageData(j,j,v,T));ge.fill(je,0,N),X.fill(0,0,N);for(let ze=0;ze<T;ze++)for(let Qe=0;Qe<v;Qe++){var be,ve=ye.data[4*(ze*v+Qe)+3]/255;ve!=0&&(be=(ze+j)*P+Qe+j,ve==1?(ge[be]=0,X[be]=je):(ge[be]=0<(ve=.5-ve)?ve*ve:0,X[be]=ve<0?ve*ve:0))}ne(ge,0,0,P,R,P,this.f,this.v,this.z),ne(X,j,j,v,T,P,this.f,this.v,this.z);for(let ze=0;ze<N;ze++){var Fe=Math.sqrt(ge[ze])-Math.sqrt(X[ze]);G[ze]=Math.round(255-255*(Fe/this.radius+this.cutoff))}}return Z}};class Be{constructor(){this.specification=o.v8Spec.light.position}possiblyEvaluate(s,f){return o.sphericalToCartesian(s.expression.evaluate(f))}interpolate(s,f,y){return{x:o.interpolate.number(s.x,f.x,y),y:o.interpolate.number(s.y,f.y,y),z:o.interpolate.number(s.z,f.z,y)}}}const Ze="-transition";let at;class Re extends o.Evented{constructor(s){super(),at=at||new o.Properties({anchor:new o.DataConstantProperty(o.v8Spec.light.anchor),position:new Be,color:new o.DataConstantProperty(o.v8Spec.light.color),intensity:new o.DataConstantProperty(o.v8Spec.light.intensity)}),this._transitionable=new o.Transitionable(at),this.setLight(s),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(s,f={}){if(!this._validate(o.validateLight,s,f))for(const v in s){var y=s[v];v.endsWith(Ze)?this._transitionable.setTransition(v.slice(0,-Ze.length),y):this._transitionable.setValue(v,y)}}updateTransitions(s){this._transitioning=this._transitionable.transitioned(s,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(s){this.properties=this._transitioning.possiblyEvaluate(s)}_validate(s,f,y){return(!y||y.validate!==!1)&&o.emitValidationErrors(this,s.call(o.validateStyle,{value:f,style:{glyphs:!0,sprite:!0},styleSpec:o.v8Spec}))}}class ht{constructor(s,f){this.width=s,this.height=f,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(s,f){var y=s.join(",")+String(f);return this.dashEntry[y]||(this.dashEntry[y]=this.addDash(s,f)),this.dashEntry[y]}getDashRanges(s,f,y){var v=[],T=s.length%2==1?-s[s.length-1]*y:0,P=s[0]*y;let R=!0,N=(v.push({left:T,right:P,isDash:R,zeroLength:s[0]===0}),s[0]);for(let Z=1;Z<s.length;Z++){R=!R;var G=s[Z],T=N*y,P=(N+=G)*y;v.push({left:T,right:P,isDash:R,zeroLength:G===0})}return v}addRoundDash(s,f,y){var v=f/2;for(let Z=-y;Z<=y;Z++){var T=this.nextRow+y+Z,P=this.width*T;let j=0,X=s[j];for(let ge=0;ge<this.width;ge++){1<ge/X.right&&(X=s[++j]);var R=Math.abs(ge-X.left),G=Math.abs(ge-X.right),R=Math.min(R,G);let ye;var N,G=Z/y*(1+v);ye=X.isDash?(N=v-Math.abs(G),Math.sqrt(R*R+N*N)):v-Math.sqrt(R*R+G*G),this.data[P+ge]=Math.max(0,Math.min(255,ye+128))}}}addRegularDash(s){for(let j=s.length-1;0<=j;--j){var f=s[j],y=s[j+1];f.zeroLength?s.splice(j,1):y&&y.isDash===f.isDash&&(y.left=f.left,s.splice(j,1))}var v=s[0],T=s[s.length-1],P=(v.isDash===T.isDash&&(v.left=T.left-this.width,T.right=v.right+this.width),this.width*this.nextRow);let R=0,N=s[R];for(let j=0;j<this.width;j++){1<j/N.right&&(N=s[++R]);var G=Math.abs(j-N.left),Z=Math.abs(j-N.right),G=Math.min(G,Z),Z=N.isDash?G:-G;this.data[P+j]=Math.max(0,Math.min(255,Z+128))}}addDash(s,f){var y,v,T=f?7:0,P=2*T+1;if(this.nextRow+P>this.height)return o.warnOnce("LineAtlas out of space"),null;let R=0;for(let N=0;N<s.length;N++)R+=s[N];return R!==0&&(y=this.width/R,v=this.getDashRanges(s,this.width,y),f?this.addRoundDash(v,y,T):this.addRegularDash(v)),f={y:(this.nextRow+T+.5)/this.height,height:2*T/this.height,width:R},this.nextRow+=P,this.dirty=!0,f}bind(s){s=s.gl,this.texture?(s.bindTexture(s.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,s.texSubImage2D(s.TEXTURE_2D,0,0,0,this.width,this.height,s.ALPHA,s.UNSIGNED_BYTE,this.data))):(this.texture=s.createTexture(),s.bindTexture(s.TEXTURE_2D,this.texture),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_S,s.REPEAT),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_T,s.REPEAT),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,s.LINEAR),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,s.LINEAR),s.texImage2D(s.TEXTURE_2D,0,s.ALPHA,this.width,this.height,0,s.ALPHA,s.UNSIGNED_BYTE,this.data))}}function Rt(){return new Worker(o.config.WORKER_URL)}const dn="maplibre_preloaded_worker_pool";class wt{constructor(){this.active={}}acquire(s){if(!this.workers)for(this.workers=[];this.workers.length<wt.workerCount;)this.workers.push(Rt());return this.active[s]=!0,this.workers.slice()}release(s){delete this.active[s],this.numActive()===0&&(this.workers.forEach(f=>{f.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[dn]}numActive(){return Object.keys(this.active).length}}or=Math.floor(g.hardwareConcurrency/2),wt.workerCount=o.isSafari(globalThis)?Math.max(Math.min(or,3),1):1;let Ge;function qn(){return Ge=Ge||new wt}class Qt{constructor(s,f){this.workerPool=s,this.actors=[],this.currentActor=0,this.id=f;var y=this.workerPool.acquire(f);for(let T=0;T<y.length;T++){var v=y[T],v=new o.Actor(v,f);v.name="Worker "+T,this.actors.push(v)}if(!this.actors.length)throw new Error("No actors found")}broadcast(s,f){var y=[];for(const v of this.actors)y.push(v.sendAsync({type:s,data:f}));return Promise.all(y)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(s=!0){this.actors.forEach(f=>{f.remove()}),this.actors=[],s&&this.workerPool.release(this.id)}registerMessageHandler(s,f){for(const y of this.actors)y.registerMessageHandler(s,f)}}let ln;function Mn(){return ln||(ln=new Qt(qn(),o.GLOBAL_DISPATCHER_ID)).registerMessageHandler("GR",(w,s,f)=>o.makeRequest(s,f)),ln}function Ot(w,s,f,j,v,T){var P,R,N,G=function(ye,be,ve){if(ye)for(const ze of ye){var Fe=be[ze];if(Fe&&Fe.source===ve&&Fe.type==="fill-extrusion")return!0}else for(const ze in be){var Ue=be[ze];if(Ue.source===ve&&Ue.type==="fill-extrusion")return!0}return!1}(v&&v.layers,s,w.id),Z=T.maxPitchScaleFactor(),j=w.tilesIn(j,Z,G),X=(j.sort(Pt),[]);for(const ye of j)X.push({wrappedTileID:ye.tileID.wrapped().key,queryResults:ye.tile.queryRenderedFeatures(s,f,w._state,ye.queryGeometry,ye.cameraQueryGeometry,ye.scale,v,T,Z,(P=w.transform,R=ye.tileID,N=void 0,N=o.create(),o.translate(N,N,[1,1,0]),o.scale(N,N,[.5*P.width,.5*P.height,1]),o.multiply(N,N,P.calculatePosMatrix(R.toUnwrapped()))))});var ge=function(ye){var be={},ve={};for(const ct of ye){var Fe=ct.queryResults,Ue=ct.wrappedTileID,ze=ve[Ue]=ve[Ue]||{};for(const it in Fe){var Qe=Fe[it],Je=ze[it]=ze[it]||{},Xe=be[it]=be[it]||[];for(const _t of Qe)Je[_t.featureIndex]||(Je[_t.featureIndex]=!0,Xe.push(_t))}}return be}(X);for(const ye in ge)ge[ye].forEach(ve=>{var ve=ve.feature,Fe=w.getFeatureState(ve.layer["source-layer"],ve.id);ve.source=ve.layer.source,ve.layer["source-layer"]&&(ve.sourceLayer=ve.layer["source-layer"]),ve.state=Fe});return ge}function En(w,s,f,y,v,T,P){var R={},N=T.queryRenderedSymbols(y),G=[];for(const ge of Object.keys(N).map(Number))G.push(P[ge]);G.sort(Pt);for(const ge of G){var Z=ge.featureIndex.lookupSymbolFeatures(N[ge.bucketInstanceId],s,ge.bucketIndex,ge.sourceLayerIndex,v.filter,v.layers,v.availableImages,w);for(const ye in Z){var j=R[ye]=R[ye]||[],X=Z[ye];X.sort((be,ve)=>{var Fe,Ue=ge.featureSortOrder;return Ue?(Fe=Ue.indexOf(be.featureIndex),Ue.indexOf(ve.featureIndex)-Fe):ve.featureIndex-be.featureIndex});for(const be of X)j.push(be)}}for(const ge in R)R[ge].forEach(be=>{var be=be.feature,ve=w[ge],ve=f[ve.source].getFeatureState(be.layer["source-layer"],be.id);be.source=be.layer.source,be.layer["source-layer"]&&(be.sourceLayer=be.layer["source-layer"]),be.state=ve});return R}function lt(w,s){var f=w.getRenderableIds().map(R=>w.getTileByID(R)),y=[],v={};for(let R=0;R<f.length;R++){var T=f[R],P=T.tileID.canonical.key;v[P]||(v[P]=!0,T.querySourceFeatures(y,s))}return y}function Pt(w,s){return w=w.tileID,s=s.tileID,w.overscaledZ-s.overscaledZ||w.canonical.y-s.canonical.y||w.wrap-s.wrap||w.canonical.x-s.canonical.x}function he(w,s,f){return o.__awaiter(this,void 0,void 0,function*(){let y=w;var v;return w.url?(v=yield o.getJSON(s.transformRequest(w.url,"Source"),f),y=v.data):yield g.frameAsync(f),y?(v=o.pick(o.extend(y,w),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]),"vector_layers"in y&&y.vector_layers&&(v.vectorLayerIds=y.vector_layers.map(T=>T.id)),v):null})}class B{constructor(s,f){s&&(f?this.setSouthWest(s).setNorthEast(f):Array.isArray(s)&&(s.length===4?this.setSouthWest([s[0],s[1]]).setNorthEast([s[2],s[3]]):this.setSouthWest(s[0]).setNorthEast(s[1])))}setNorthEast(s){return this._ne=s instanceof o.LngLat?new o.LngLat(s.lng,s.lat):o.LngLat.convert(s),this}setSouthWest(s){return this._sw=s instanceof o.LngLat?new o.LngLat(s.lng,s.lat):o.LngLat.convert(s),this}extend(s){var f,y=this._sw,v=this._ne;let T,P;if(s instanceof o.LngLat)T=s,P=s;else{if(!(s instanceof B))return Array.isArray(s)?s.length===4||s.every(Array.isArray)?(f=s,this.extend(B.convert(f))):this.extend(o.LngLat.convert(s)):s&&("lng"in s||"lon"in s)&&"lat"in s?this.extend(o.LngLat.convert(s)):this;if(T=s._sw,P=s._ne,!T||!P)return this}return y||v?(y.lng=Math.min(T.lng,y.lng),y.lat=Math.min(T.lat,y.lat),v.lng=Math.max(P.lng,v.lng),v.lat=Math.max(P.lat,v.lat)):(this._sw=new o.LngLat(T.lng,T.lat),this._ne=new o.LngLat(P.lng,P.lat)),this}getCenter(){return new o.LngLat((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new o.LngLat(this.getWest(),this.getNorth())}getSouthEast(){return new o.LngLat(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(f){var{lng:f,lat:y}=o.LngLat.convert(f),y=this._sw.lat<=y&&y<=this._ne.lat;let v=this._sw.lng<=f&&f<=this._ne.lng;return this._sw.lng>this._ne.lng&&(v=this._sw.lng>=f&&f>=this._ne.lng),y&&v}static convert(s){return s instanceof B?s:s&&new B(s)}static fromLngLat(s,y=0){var y=360*y/40075017,v=y/Math.cos(Math.PI/180*s.lat);return new B(new o.LngLat(s.lng-v,s.lat-y),new o.LngLat(s.lng+v,s.lat+y))}}class H{constructor(s,f,y){this.bounds=B.convert(this.validateBounds(s)),this.minzoom=f||0,this.maxzoom=y||24}validateBounds(s){return Array.isArray(s)&&s.length===4?[Math.max(-180,s[0]),Math.max(-90,s[1]),Math.min(180,s[2]),Math.min(90,s[3])]:[-180,-90,180,90]}contains(s){var f=Math.pow(2,s.z);const y=Math.floor(o.mercatorXfromLng(this.bounds.getWest())*f),v=Math.floor(o.mercatorYfromLat(this.bounds.getNorth())*f),T=Math.ceil(o.mercatorXfromLng(this.bounds.getEast())*f),P=Math.ceil(o.mercatorYfromLat(this.bounds.getSouth())*f);return s.x>=y&&s.x<T&&s.y>=v&&s.y<P}}class D extends o.Evented{constructor(s,f,y,v){if(super(),this.id=s,this.dispatcher=y,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,o.extend(this,o.pick(f,["url","scheme","tileSize","promoteId"])),this._options=o.extend({type:"vector"},f),this._collectResourceTiming=f.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(v)}load(){return o.__awaiter(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new o.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{var s=yield he(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),s&&(o.extend(this,s),s.bounds&&(this.tileBounds=new H(s.bounds,this.minzoom,this.maxzoom)),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"content"})))}catch(f){this._tileJSONRequest=null,this.fire(new o.ErrorEvent(f))}})}loaded(){return this._loaded}hasTile(s){return!this.tileBounds||this.tileBounds.contains(s.canonical)}onAdd(s){this.map=s,this.load()}setSourceProperty(s){this._tileJSONRequest&&this._tileJSONRequest.abort(),s(),this.load()}setTiles(s){return this.setSourceProperty(()=>{this._options.tiles=s}),this}setUrl(s){return this.setSourceProperty(()=>{this.url=s,this._options.url=s}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return o.extend({},this._options)}loadTile(s){return o.__awaiter(this,void 0,void 0,function*(){var f=s.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),f={request:this.map._requestManager.transformRequest(f,"Tile"),uid:s.uid,tileID:s.tileID,zoom:s.tileID.overscaledZ,tileSize:this.tileSize*s.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};f.request.collectResourceTiming=this._collectResourceTiming;let y="RT";if(s.actor&&s.state!=="expired"){if(s.state==="loading")return new Promise((T,P)=>{s.reloadPromise={resolve:T,reject:P}})}else s.actor=this.dispatcher.getActor(),y="LT";s.abortController=new AbortController;try{var v=yield s.actor.sendAsync({type:y,data:f},s.abortController);delete s.abortController,s.aborted||this._afterTileLoadWorkerResponse(s,v)}catch(T){if(delete s.abortController,!s.aborted){if(T&&T.status!==404)throw T;this._afterTileLoadWorkerResponse(s,null)}}})}_afterTileLoadWorkerResponse(s,f){f&&f.resourceTiming&&(s.resourceTiming=f.resourceTiming),f&&this.map._refreshExpiredTiles&&s.setExpiryData(f),s.loadVectorData(f,this.map.painter),s.reloadPromise&&(f=s.reloadPromise,s.reloadPromise=null,this.loadTile(s).then(f.resolve).catch(f.reject))}abortTile(s){return o.__awaiter(this,void 0,void 0,function*(){s.abortController&&(s.abortController.abort(),delete s.abortController),s.actor&&(yield s.actor.sendAsync({type:"AT",data:{uid:s.uid,type:this.type,source:this.id}}))})}unloadTile(s){return o.__awaiter(this,void 0,void 0,function*(){s.unloadVectorData(),s.actor&&(yield s.actor.sendAsync({type:"RMT",data:{uid:s.uid,type:this.type,source:this.id}}))})}hasTransition(){return!1}}class Q extends o.Evented{constructor(s,f,y,v){super(),this.id=s,this.dispatcher=y,this.setEventedParent(v),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=o.extend({type:"raster"},f),o.extend(this,o.pick(f,["url","scheme","tileSize"]))}load(){return o.__awaiter(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new o.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{var s=yield he(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,s&&(o.extend(this,s),s.bounds&&(this.tileBounds=new H(s.bounds,this.minzoom,this.maxzoom)),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"content"})))}catch(f){this._tileJSONRequest=null,this.fire(new o.ErrorEvent(f))}})}loaded(){return this._loaded}onAdd(s){this.map=s,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(s){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),s(),this.load()}setTiles(s){return this.setSourceProperty(()=>{this._options.tiles=s}),this}setUrl(s){return this.setSourceProperty(()=>{this.url=s,this._options.url=s}),this}serialize(){return o.extend({},this._options)}hasTile(s){return!this.tileBounds||this.tileBounds.contains(s.canonical)}loadTile(s){return o.__awaiter(this,void 0,void 0,function*(){var f=s.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);s.abortController=new AbortController;try{var y,v,T,P=yield a.getImage(this.map._requestManager.transformRequest(f,"Tile"),s.abortController,this.map._refreshExpiredTiles);delete s.abortController,s.aborted?s.state="unloaded":P&&P.data&&(this.map._refreshExpiredTiles&&P.cacheControl&&P.expires&&s.setExpiryData({cacheControl:P.cacheControl,expires:P.expires}),v=(y=this.map.painter.context).gl,T=P.data,s.texture=this.map.painter.getTileTexture(T.width),s.texture?s.texture.update(T,{useMipmap:!0}):(s.texture=new ue(y,T,v.RGBA,{useMipmap:!0}),s.texture.bind(v.LINEAR,v.CLAMP_TO_EDGE,v.LINEAR_MIPMAP_NEAREST),y.extTextureFilterAnisotropic&&v.texParameterf(v.TEXTURE_2D,y.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,y.extTextureFilterAnisotropicMax)),s.state="loaded")}catch(R){if(delete s.abortController,s.aborted)s.state="unloaded";else if(R)throw s.state="errored",R}})}abortTile(s){return o.__awaiter(this,void 0,void 0,function*(){s.abortController&&(s.abortController.abort(),delete s.abortController)})}unloadTile(s){return o.__awaiter(this,void 0,void 0,function*(){s.texture&&this.map.painter.saveTileTexture(s.texture)})}hasTransition(){return!1}}class ae extends Q{constructor(s,f,y,v){super(s,f,y,v),this.type="raster-dem",this.maxzoom=22,this._options=o.extend({type:"raster-dem"},f),this.encoding=f.encoding||"mapbox",this.redFactor=f.redFactor,this.greenFactor=f.greenFactor,this.blueFactor=f.blueFactor,this.baseShift=f.baseShift}loadTile(s){return o.__awaiter(this,void 0,void 0,function*(){var f=s.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),f=this.map._requestManager.transformRequest(f,"Tile");s.neighboringTiles=this._getNeighboringTiles(s.tileID),s.abortController=new AbortController;try{var y,v,T,P,R=yield a.getImage(f,s.abortController,this.map._refreshExpiredTiles);delete s.abortController,s.aborted?s.state="unloaded":R&&R.data&&(y=R.data,this.map._refreshExpiredTiles&&R.cacheControl&&R.expires&&s.setExpiryData({cacheControl:R.cacheControl,expires:R.expires}),v=o.isImageBitmap(y)&&o.offscreenCanvasSupported()?y:yield this.readImageNow(y),T={type:this.type,uid:s.uid,source:this.id,rawImageData:v,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift},s.actor&&s.state!=="expired"||(s.actor=this.dispatcher.getActor(),P=yield s.actor.sendAsync({type:"LDT",data:T}),s.dem=P,s.needsHillshadePrepare=!0,s.needsTerrainPrepare=!0,s.state="loaded"))}catch(N){if(delete s.abortController,s.aborted)s.state="unloaded";else if(N)throw s.state="errored",N}})}readImageNow(s){return o.__awaiter(this,void 0,void 0,function*(){if(typeof VideoFrame<"u"&&o.isOffscreenCanvasDistorted()){var f=s.width+2,y=s.height+2;try{return new o.RGBAImage({width:f,height:y},yield o.readImageUsingVideoFrame(s,-1,-1,f,y))}catch{}}return g.getImageData(s,1)})}_getNeighboringTiles(s){var f=s.canonical,y=Math.pow(2,f.z),v=(f.x-1+y)%y,T=f.x===0?s.wrap-1:s.wrap,P=(f.x+1+y)%y,R=f.x+1===y?s.wrap+1:s.wrap,N={};return N[new o.OverscaledTileID(s.overscaledZ,T,f.z,v,f.y).key]={backfilled:!1},N[new o.OverscaledTileID(s.overscaledZ,R,f.z,P,f.y).key]={backfilled:!1},0<f.y&&(N[new o.OverscaledTileID(s.overscaledZ,T,f.z,v,f.y-1).key]={backfilled:!1},N[new o.OverscaledTileID(s.overscaledZ,s.wrap,f.z,f.x,f.y-1).key]={backfilled:!1},N[new o.OverscaledTileID(s.overscaledZ,R,f.z,P,f.y-1).key]={backfilled:!1}),f.y+1<y&&(N[new o.OverscaledTileID(s.overscaledZ,T,f.z,v,f.y+1).key]={backfilled:!1},N[new o.OverscaledTileID(s.overscaledZ,s.wrap,f.z,f.x,f.y+1).key]={backfilled:!1},N[new o.OverscaledTileID(s.overscaledZ,R,f.z,P,f.y+1).key]={backfilled:!1}),N}unloadTile(s){return o.__awaiter(this,void 0,void 0,function*(){s.demTexture&&this.map.painter.saveTileTexture(s.demTexture),s.fbo&&(s.fbo.destroy(),delete s.fbo),s.dem&&delete s.dem,delete s.neighboringTiles,s.state="unloaded",s.actor&&(yield s.actor.sendAsync({type:"RDT",data:{type:this.type,uid:s.uid,source:this.id}}))})}}class q extends o.Evented{constructor(s,f,y,v){super(),this.id=s,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=y.getActor(),this.setEventedParent(v),this._data=f.data,this._options=o.extend({},f),this._collectResourceTiming=f.collectResourceTiming,f.maxzoom!==void 0&&(this.maxzoom=f.maxzoom),f.type&&(this.type=f.type),f.attribution&&(this.attribution=f.attribution),this.promoteId=f.promoteId,s=o.EXTENT/this.tileSize,this.workerOptions=o.extend({source:this.id,cluster:f.cluster||!1,geojsonVtOptions:{buffer:(f.buffer!==void 0?f.buffer:128)*s,tolerance:(f.tolerance!==void 0?f.tolerance:.375)*s,extent:o.EXTENT,maxZoom:this.maxzoom,lineMetrics:f.lineMetrics||!1,generateId:f.generateId||!1},superclusterOptions:{maxZoom:f.clusterMaxZoom!==void 0?f.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,f.clusterMinPoints||2),extent:o.EXTENT,radius:(f.clusterRadius||50)*s,log:!1,generateId:f.generateId||!1},clusterProperties:f.clusterProperties,filter:f.filter},f.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}load(){return o.__awaiter(this,void 0,void 0,function*(){yield this._updateWorkerData()})}onAdd(s){this.map=s,this.load()}setData(s){return this._data=s,this._updateWorkerData(),this}updateData(s){return this._updateWorkerData(s),this}setClusterOptions(s){return this.workerOptions.cluster=s.cluster,s&&(s.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=s.clusterRadius),s.clusterMaxZoom!==void 0)&&(this.workerOptions.superclusterOptions.maxZoom=s.clusterMaxZoom),this._updateWorkerData(),this}getClusterExpansionZoom(s){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:s,source:this.id}})}getClusterChildren(s){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:s,source:this.id}})}getClusterLeaves(s,f,y){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:s,limit:f,offset:y}})}_updateWorkerData(s){return o.__awaiter(this,void 0,void 0,function*(){var f=o.extend({type:this.type},this.workerOptions);s?f.dataDiff=s:typeof this._data=="string"?(f.request=this.map._requestManager.transformRequest(g.resolveURL(this._data),"Source"),f.request.collectResourceTiming=this._collectResourceTiming):f.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new o.Event("dataloading",{dataType:"source"}));try{var y=yield this.actor.sendAsync({type:"LD",data:f});if(this._pendingLoads--,this._removed||y.abandoned)this.fire(new o.Event("dataabort",{dataType:"source"}));else{let T=null;y.resourceTiming&&y.resourceTiming[this.id]&&(T=y.resourceTiming[this.id].slice(0));var v={dataType:"source"};this._collectResourceTiming&&T&&0<T.length&&o.extend(v,{resourceTiming:T}),this.fire(new o.Event("data",Object.assign(Object.assign({},v),{sourceDataType:"metadata"}))),this.fire(new o.Event("data",Object.assign(Object.assign({},v),{sourceDataType:"content"})))}}catch(T){this._pendingLoads--,this._removed?this.fire(new o.Event("dataabort",{dataType:"source"})):this.fire(new o.ErrorEvent(T))}})}loaded(){return this._pendingLoads===0}loadTile(s){return o.__awaiter(this,void 0,void 0,function*(){var f=s.actor?"RT":"LT",y=(s.actor=this.actor,{type:this.type,uid:s.uid,tileID:s.tileID,zoom:s.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId}),y=(s.abortController=new AbortController,yield this.actor.sendAsync({type:f,data:y},s.abortController));delete s.abortController,s.unloadVectorData(),s.aborted||s.loadVectorData(y,this.map.painter,f=="RT")})}abortTile(s){return o.__awaiter(this,void 0,void 0,function*(){s.abortController&&(s.abortController.abort(),delete s.abortController),s.aborted=!0})}unloadTile(s){return o.__awaiter(this,void 0,void 0,function*(){s.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:s.uid,type:this.type,source:this.id}})})}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return o.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}var Ae=o.createLayout([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class Pe extends o.Evented{constructor(s,f,y,v){super(),this.id=s,this.dispatcher=y,this.coordinates=f.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(v),this.options=f}load(s){return o.__awaiter(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new o.Event("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{var f=yield a.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,f&&f.data&&(this.image=f.data,s&&(this.coordinates=s),this._finishLoading())}catch(y){this._request=null,this.fire(new o.ErrorEvent(y))}})}loaded(){return this._loaded}updateImage(s){return s.url&&(this._request&&(this._request.abort(),this._request=null),this.options.url=s.url,this.load(s.coordinates).finally(()=>{this.texture=null})),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(s){this.map=s,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(s){return s=(this.coordinates=s).map(o.MercatorCoordinate.fromLngLat),this.tileID=We(s),this.minzoom=this.maxzoom=this.tileID.z,s=s.map(f=>this.tileID.getTilePoint(f)._round()),this._boundsArray=new o.RasterBoundsArray,this._boundsArray.emplaceBack(s[0].x,s[0].y,0,0),this._boundsArray.emplaceBack(s[1].x,s[1].y,o.EXTENT,0),this._boundsArray.emplaceBack(s[3].x,s[3].y,0,o.EXTENT),this._boundsArray.emplaceBack(s[2].x,s[2].y,o.EXTENT,o.EXTENT),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length!==0&&this.image){var s=this.map.painter.context,f=s.gl;this.boundsBuffer||(this.boundsBuffer=s.createVertexBuffer(this._boundsArray,Ae.members)),this.boundsSegments||(this.boundsSegments=o.SegmentVector.simpleSegment(0,0,4,2)),this.texture||(this.texture=new ue(s,this.image,f.RGBA),this.texture.bind(f.LINEAR,f.CLAMP_TO_EDGE));let v=!1;for(const T in this.tiles){var y=this.tiles[T];y.state!=="loaded"&&(y.state="loaded",y.texture=this.texture,v=!0)}v&&this.fire(new o.Event("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}}loadTile(s){return o.__awaiter(this,void 0,void 0,function*(){this.tileID&&this.tileID.equals(s.tileID.canonical)?(this.tiles[String(s.tileID.wrap)]=s).buckets={}:s.state="errored"})}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}function We(P){let s=1/0,f=1/0,y=-1/0,v=-1/0;for(const R of P)s=Math.min(s,R.x),f=Math.min(f,R.y),y=Math.max(y,R.x),v=Math.max(v,R.y);var P=y-s,T=v-f,P=Math.max(P,T),T=Math.max(0,Math.floor(-Math.log(P)/Math.LN2)),P=Math.pow(2,T);return new o.CanonicalTileID(T,Math.floor((s+y)/2*P),Math.floor((f+v)/2*P))}class rt extends Pe{constructor(s,f,y,v){super(s,f,y,v),this.roundZoom=!0,this.type="video",this.options=f}load(){return o.__awaiter(this,void 0,void 0,function*(){this._loaded=!1;var s=this.options;this.urls=[];for(const y of s.urls)this.urls.push(this.map._requestManager.transformRequest(y,"Source").url);try{var f=yield o.getVideo(this.urls);this._loaded=!0,f&&(this.video=f,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())}catch(y){this.fire(new o.ErrorEvent(y))}})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(s){var f;this.video&&(s<(f=this.video.seekable).start(0)||s>f.end(0)?this.fire(new o.ErrorEvent(new o.ValidationError("sources."+this.id,null,`Playback for this video can be set only between the ${f.start(0)} and ${f.end(0)}-second mark.`))):this.video.currentTime=s)}getVideo(){return this.video}onAdd(s){this.map||(this.map=s,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(!(Object.keys(this.tiles).length===0||this.video.readyState<2)){var s=this.map.painter.context,f=s.gl;this.boundsBuffer||(this.boundsBuffer=s.createVertexBuffer(this._boundsArray,Ae.members)),this.boundsSegments||(this.boundsSegments=o.SegmentVector.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(f.LINEAR,f.CLAMP_TO_EDGE),f.texSubImage2D(f.TEXTURE_2D,0,0,0,f.RGBA,f.UNSIGNED_BYTE,this.video)):(this.texture=new ue(s,this.video,f.RGBA),this.texture.bind(f.LINEAR,f.CLAMP_TO_EDGE));let v=!1;for(const T in this.tiles){var y=this.tiles[T];y.state!=="loaded"&&(y.state="loaded",y.texture=this.texture,v=!0)}v&&this.fire(new o.Event("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class Et extends Pe{constructor(s,f,y,v){super(s,f,y,v),f.coordinates?Array.isArray(f.coordinates)&&f.coordinates.length===4&&!f.coordinates.some(T=>!Array.isArray(T)||T.length!==2||T.some(P=>typeof P!="number"))||this.fire(new o.ErrorEvent(new o.ValidationError("sources."+s,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new o.ErrorEvent(new o.ValidationError("sources."+s,null,'missing required property "coordinates"'))),f.animate&&typeof f.animate!="boolean"&&this.fire(new o.ErrorEvent(new o.ValidationError("sources."+s,null,'optional "animate" property must be a boolean value'))),f.canvas?typeof f.canvas=="string"||f.canvas instanceof HTMLCanvasElement||this.fire(new o.ErrorEvent(new o.ValidationError("sources."+s,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new o.ErrorEvent(new o.ValidationError("sources."+s,null,'missing required property "canvas"'))),this.options=f,this.animate=f.animate===void 0||f.animate}load(){return o.__awaiter(this,void 0,void 0,function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new o.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())})}getCanvas(){return this.canvas}onAdd(s){this.map=s,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let s=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,s=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,s=!0),!this._hasInvalidDimensions()&&Object.keys(this.tiles).length!==0){var f=this.map.painter.context,y=f.gl;this.boundsBuffer||(this.boundsBuffer=f.createVertexBuffer(this._boundsArray,Ae.members)),this.boundsSegments||(this.boundsSegments=o.SegmentVector.simpleSegment(0,0,4,2)),this.texture?(s||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new ue(f,this.canvas,y.RGBA,{premultiply:!0});let T=!1;for(const P in this.tiles){var v=this.tiles[P];v.state!=="loaded"&&(v.state="loaded",v.texture=this.texture,T=!0)}T&&this.fire(new o.Event("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const s of[this.canvas.width,this.canvas.height])if(isNaN(s)||s<=0)return!0;return!1}}const Bt={},Lt=(w,s,f,y)=>{if(s=new(an(s.type))(w,s,f,y),s.id!==w)throw new Error(`Expected Source id to be ${w} instead of `+s.id);return s},an=w=>{switch(w){case"geojson":return q;case"image":return Pe;case"raster":return Q;case"raster-dem":return ae;case"vector":return D;case"video":return rt;case"canvas":return Et}return Bt[w]};function Ie(w,s){var f={};if(s)for(const y of w){const v=y.layerIds.map(T=>s.getLayer(T)).filter(Boolean);if(v.length!==0){y.layers=v,y.stateDependentLayerIds&&(y.stateDependentLayers=y.stateDependentLayerIds.map(T=>v.filter(P=>P.id===T)[0]));for(const T of v)f[T.id]=y}}return f}const Te="RTLPluginLoaded";class At extends o.Evented{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=Mn()}_syncState(s){return this.status=s,this.dispatcher.broadcast("SRPS",{pluginStatus:s,pluginURL:this.url}).catch(f=>{throw this.status="error",f})}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(s){return o.__awaiter(this,arguments,void 0,function*(f,y=!1){if(this.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(this.url=g.resolveURL(f),!this.url)throw new Error(`requested url ${f} is invalid`);if(this.status==="unavailable"){if(!y)return this._requestImport();this.status="deferred",this._syncState(this.status)}else if(this.status==="requested")return this._requestImport()})}_requestImport(){return o.__awaiter(this,void 0,void 0,function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new o.Event(Te))})}lazyLoad(){this.status==="unavailable"?this.status="requested":this.status==="deferred"&&this._requestImport()}}let xt=null;function qt(){return xt=xt||new At}class fn{constructor(s,f){this.timeAdded=0,this.fadeEndTime=0,this.tileID=s,this.uid=o.uniqueId(),this.uses=0,this.tileSize=f,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(s){s+=this.timeAdded,s<this.fadeEndTime||(this.fadeEndTime=s)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(s){this.demTexture&&s.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(s,f,y){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",s){s.featureIndex&&(this.latestFeatureIndex=s.featureIndex,s.rawTileData?(this.latestRawTileData=s.rawTileData,this.latestFeatureIndex.rawTileData=s.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=s.collisionBoxArray,this.buckets=Ie(s.buckets,f.style),this.hasSymbolBuckets=!1;for(const R in this.buckets){var v=this.buckets[R];if(v instanceof o.SymbolBucket){if(this.hasSymbolBuckets=!0,!y)break;v.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const R in this.buckets){var T=this.buckets[R];if(T instanceof o.SymbolBucket&&T.hasRTLText){this.hasRTLText=!0,qt().lazyLoad();break}}this.queryPadding=0;for(const R in this.buckets){var P=this.buckets[R];this.queryPadding=Math.max(this.queryPadding,f.style.getLayer(R).queryRadius(P))}s.imageAtlas&&(this.imageAtlas=s.imageAtlas),s.glyphAtlasImage&&(this.glyphAtlasImage=s.glyphAtlasImage)}else this.collisionBoxArray=new o.CollisionBoxArray}unloadVectorData(){for(const s in this.buckets)this.buckets[s].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(s){return this.buckets[s.id]}upload(s){for(const v in this.buckets){var f=this.buckets[v];f.uploadPending()&&f.upload(s)}var y=s.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new ue(s,this.imageAtlas.image,y.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new ue(s,this.glyphAtlasImage,y.ALPHA),this.glyphAtlasImage=null)}prepare(s){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(s,this.imageAtlasTexture)}queryRenderedFeatures(s,f,y,v,T,P,R,N,G,Z){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:v,cameraQueryGeometry:T,scale:P,tileSize:this.tileSize,pixelPosMatrix:Z,transform:N,params:R,queryPadding:this.queryPadding*G},s,f,y):{}}querySourceFeatures(s,f){var y=this.latestFeatureIndex;if(y&&y.rawTileData){var v=y.loadVTLayers(),T=f&&f.sourceLayer?f.sourceLayer:"",P=v._geojsonTileLayer||v[T];if(P){var R=o.createFilter(f&&f.filter),{z:N,x:G,y:Z}=this.tileID.canonical,j={z:N,x:G,y:Z};for(let ye=0;ye<P.length;ye++){var X=P.feature(ye);if(R.needGeometry){var ge=o.toEvaluationFeature(X,!0);if(!R.filter(new o.EvaluationParameters(this.tileID.overscaledZ),ge,this.tileID.canonical))continue}else if(!R.filter(new o.EvaluationParameters(this.tileID.overscaledZ),X))continue;ge=y.getId(X,T),X=new o.GeoJSONFeature(X,N,G,Z,ge),X.tile=j,s.push(X)}}}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(s){var f=this.expirationTime;if(s.cacheControl?(y=o.parseCacheControl(s.cacheControl))["max-age"]&&(this.expirationTime=Date.now()+1e3*y["max-age"]):s.expires&&(this.expirationTime=new Date(s.expires).getTime()),this.expirationTime){var y=Date.now();let v=!1;this.expirationTime>y?v=!1:f&&!(this.expirationTime<f)&&(s=this.expirationTime-f)?this.expirationTime=y+Math.max(s,3e4):v=!0,v?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(s,f){if(this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData&&Object.keys(s).length!==0){var y,v,T,P=this.latestFeatureIndex.loadVTLayers();for(const R in this.buckets)f.style.hasLayer(R)&&(v=P[T=(y=this.buckets[R]).layers[0].sourceLayer||"_geojsonTileLayer"],T=s[T],v)&&T&&Object.keys(T).length!==0&&(y.update(T,v,this.imageAtlas&&this.imageAtlas.patternPositions||{}),T=f&&f.style&&f.style.getLayer(R))&&(this.queryPadding=Math.max(this.queryPadding,T.queryRadius(y)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<g.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(s){this.symbolFadeHoldUntil=g.now()+s}setDependencies(s,f){var y={};for(const v of f)y[v]=!0;this.dependencies[s]=y}hasDependency(s,f){for(const v of s){var y=this.dependencies[v];if(y){for(const T of f)if(y[T])return!0}}return!1}}class Ke{constructor(s,f){this.max=s,this.onRemove=f,this.reset()}reset(){for(const s in this.data)for(const f of this.data[s])f.timeout&&clearTimeout(f.timeout),this.onRemove(f.value);return this.data={},this.order=[],this}add(s,f,y){var v=s.wrapped().key;this.data[v]===void 0&&(this.data[v]=[]);const T={value:f,timeout:void 0};return y!==void 0&&(T.timeout=setTimeout(()=>{this.remove(s,T)},y)),this.data[v].push(T),this.order.push(v),this.order.length>this.max&&(f=this._getAndRemoveByKey(this.order[0]))&&this.onRemove(f),this}has(s){return s.wrapped().key in this.data}getAndRemove(s){return this.has(s)?this._getAndRemoveByKey(s.wrapped().key):null}_getAndRemoveByKey(s){var f=this.data[s].shift();return f.timeout&&clearTimeout(f.timeout),this.data[s].length===0&&delete this.data[s],this.order.splice(this.order.indexOf(s),1),f.value}getByKey(s){return s=this.data[s],s?s[0].value:null}get(s){return this.has(s)?this.data[s.wrapped().key][0].value:null}remove(s,f){var y;return this.has(s)&&(s=s.wrapped().key,f=f===void 0?0:this.data[s].indexOf(f),y=this.data[s][f],this.data[s].splice(f,1),y.timeout&&clearTimeout(y.timeout),this.data[s].length===0&&delete this.data[s],this.onRemove(y.value),this.order.splice(this.order.indexOf(s),1)),this}setMaxSize(s){for(this.max=s;this.order.length>this.max;){var f=this._getAndRemoveByKey(this.order[0]);f&&this.onRemove(f)}return this}filter(s){var f=[];for(const y in this.data)for(const v of this.data[y])s(v.value)||f.push(v);for(const y of f)this.remove(y.value.tileID,y)}}class gt{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(s,f,y){var v=String(f);if(this.stateChanges[s]=this.stateChanges[s]||{},this.stateChanges[s][v]=this.stateChanges[s][v]||{},o.extend(this.stateChanges[s][v],y),this.deletedStates[s]===null){this.deletedStates[s]={};for(const T in this.state[s])T!==v&&(this.deletedStates[s][T]=null)}else if(this.deletedStates[s]&&this.deletedStates[s][v]===null){this.deletedStates[s][v]={};for(const T in this.state[s][v])y[T]||(this.deletedStates[s][v][T]=null)}else for(const T in y)this.deletedStates[s]&&this.deletedStates[s][v]&&this.deletedStates[s][v][T]===null&&delete this.deletedStates[s][v][T]}removeFeatureState(s,f,y){var v=this.deletedStates[s]===null;if(!v){var T=String(f);if(this.deletedStates[s]=this.deletedStates[s]||{},y&&f!==void 0)this.deletedStates[s][T]!==null&&(this.deletedStates[s][T]=this.deletedStates[s][T]||{},this.deletedStates[s][T][y]=null);else if(f!==void 0)if(this.stateChanges[s]&&this.stateChanges[s][T])for(y in this.deletedStates[s][T]={},this.stateChanges[s][T])this.deletedStates[s][T][y]=null;else this.deletedStates[s][T]=null;else this.deletedStates[s]=null}}getState(s,f){var y=String(f),v=this.state[s]||{},T=this.stateChanges[s]||{},P=o.extend({},v[y],T[y]);if(this.deletedStates[s]===null)return{};if(this.deletedStates[s]){if(v=this.deletedStates[s][f],v===null)return{};for(const R in v)delete P[R]}return P}initializeTileState(s,f){s.setFeatureState(this.state,f)}coalesceChanges(s,f){var y={};for(const P in this.stateChanges){this.state[P]=this.state[P]||{};var v={};for(const R in this.stateChanges[P])this.state[P][R]||(this.state[P][R]={}),o.extend(this.state[P][R],this.stateChanges[P][R]),v[R]=this.state[P][R];y[P]=v}for(const P in this.deletedStates){this.state[P]=this.state[P]||{};var T={};if(this.deletedStates[P]===null)for(const R in this.state[P])T[R]={},this.state[P][R]={};else for(const R in this.deletedStates[P]){if(this.deletedStates[P][R]===null)this.state[P][R]={};else for(const N of Object.keys(this.deletedStates[P][R]))delete this.state[P][R][N];T[R]=this.state[P][R]}y[P]=y[P]||{},o.extend(y[P],T)}if(this.stateChanges={},this.deletedStates={},Object.keys(y).length!==0)for(const P in s)s[P].setFeatureState(y,f)}}class Tt extends o.Evented{constructor(s,f,y){super(),this.id=s,this.dispatcher=y,this.on("data",v=>{v.dataType==="source"&&v.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&v.dataType==="source"&&v.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=Lt(s,f,y,this),this._tiles={},this._cache=new Ke(0,v=>this._unloadTile(v)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new gt,this._didEmitContent=!1,this._updated=!1}onAdd(s){this.map=s,this._maxTileCacheSize=s?s._maxTileCacheSize:null,this._maxTileCacheZoomLevels=s?s._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(s)}onRemove(s){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(s)}loaded(){if(!this._sourceErrored){if(!this._sourceLoaded||!this._source.loaded())return!1;if(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain){if(!this._updated)return!1;for(const f in this._tiles){var s=this._tiles[f];if(s.state!=="loaded"&&s.state!=="errored")return!1}}}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){var s;this._paused&&(s=this._shouldReloadOnResume,this._paused=!1,this._shouldReloadOnResume=!1,s&&this.reload(),this.transform)&&this.update(this.transform,this.terrain)}_loadTile(s,f,y){return o.__awaiter(this,void 0,void 0,function*(){try{yield this._source.loadTile(s),this._tileLoaded(s,f,y)}catch(v){s.state="errored",v.status!==404?this._source.fire(new o.ErrorEvent(v,{tile:s})):this.update(this.transform,this.terrain)}})}_unloadTile(s){this._source.unloadTile&&this._source.unloadTile(s)}_abortTile(s){this._source.abortTile&&this._source.abortTile(s),this._source.fire(new o.Event("dataabort",{tile:s,coord:s.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(s){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const y in this._tiles){var f=this._tiles[y];f.upload(s),f.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(s=>s.tileID).sort(Rn).map(s=>s.key)}getRenderableIds(s){var f=[];for(const y in this._tiles)this._isIdRenderable(y,s)&&f.push(this._tiles[y]);return s?f.sort((T,P)=>{var T=T.tileID,P=P.tileID,R=new o.Point(T.canonical.x,T.canonical.y)._rotate(this.transform.angle),N=new o.Point(P.canonical.x,P.canonical.y)._rotate(this.transform.angle);return T.overscaledZ-P.overscaledZ||N.y-R.y||N.x-R.x}).map(y=>y.tileID.key):f.map(y=>y.tileID).sort(Rn).map(y=>y.key)}hasRenderableParent(s){return s=this.findLoadedParent(s,0),!!s&&this._isIdRenderable(s.tileID.key)}_isIdRenderable(s,f){return this._tiles[s]&&this._tiles[s].hasData()&&!this._coveredTiles[s]&&(f||!this._tiles[s].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const s in this._tiles)this._tiles[s].state!=="errored"&&this._reloadTile(s,"reloading")}}_reloadTile(s,f){return o.__awaiter(this,void 0,void 0,function*(){var y=this._tiles[s];y&&(y.state!=="loading"&&(y.state=f),yield this._loadTile(y,s,f))})}_tileLoaded(s,f,y){s.timeAdded=g.now(),y==="expired"&&(s.refreshedUponExpiration=!0),this._setTileReloadTimer(f,s),this.getSource().type==="raster-dem"&&s.dem&&this._backfillDEM(s),this._state.initializeTileState(s,this.map?this.map.painter:null),s.aborted||this._source.fire(new o.Event("data",{dataType:"source",tile:s,coord:s.tileID}))}_backfillDEM(s){var f=this.getRenderableIds();for(let T=0;T<f.length;T++){var y=f[T];s.neighboringTiles&&s.neighboringTiles[y]&&(v(s,y=this.getTileByID(y)),v(y,s))}function v(T,P){T.needsHillshadePrepare=!0,T.needsTerrainPrepare=!0;let R=P.tileID.canonical.x-T.tileID.canonical.x;var N=P.tileID.canonical.y-T.tileID.canonical.y,G=Math.pow(2,T.tileID.canonical.z),Z=P.tileID.key;R===0&&N==0||1<Math.abs(N)||(1<Math.abs(R)&&(Math.abs(R+G)===1?R+=G:Math.abs(R-G)===1&&(R-=G)),P.dem&&T.dem&&(T.dem.backfillBorder(P.dem,R,N),T.neighboringTiles)&&T.neighboringTiles[Z]&&(T.neighboringTiles[Z].backfilled=!0))}}getTile(s){return this.getTileByID(s.key)}getTileByID(s){return this._tiles[s]}_retainLoadedChildren(s,f,y,v){for(const P in this._tiles){let R=this._tiles[P];if(!(v[P]||!R.hasData()||R.tileID.overscaledZ<=f||R.tileID.overscaledZ>y)){let N=R.tileID;for(;R&&R.tileID.overscaledZ>f+1;){var T=R.tileID.scaledTo(R.tileID.overscaledZ-1);(R=this._tiles[T.key])&&R.hasData()&&(N=T)}let G=N;for(;G.overscaledZ>f;)if(s[(G=G.scaledTo(G.overscaledZ-1)).key]){v[N.key]=N;break}}}}findLoadedParent(s,f){var y;if(s.key in this._loadedParentTiles)return(y=this._loadedParentTiles[s.key])&&y.tileID.overscaledZ>=f?y:null;for(let T=s.overscaledZ-1;T>=f;T--){var v=s.scaledTo(T),v=this._getLoadedTile(v);if(v)return v}}_getLoadedTile(s){var f=this._tiles[s.key];return f&&f.hasData()?f:this._cache.getByKey(s.wrapped().key)}updateCacheSize(v){var y=Math.ceil(v.width/this._source.tileSize)+1,v=Math.ceil(v.height/this._source.tileSize)+1,f=this._maxTileCacheZoomLevels===null?o.config.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels,y=Math.floor(y*v*f),v=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,y):y;this._cache.setMaxSize(v)}handleWrapJump(s){var f=this._prevLng===void 0?s:this._prevLng,y=Math.round((s-f)/360);if(this._prevLng=s,y){var v={};for(const R in this._tiles){var T=this._tiles[R];T.tileID=T.tileID.unwrapTo(T.tileID.wrap+y),v[T.tileID.key]=T}this._tiles=v;for(const R in this._timers)clearTimeout(this._timers[R]),delete this._timers[R];for(const R in this._tiles){var P=this._tiles[R];this._setTileReloadTimer(R,P)}}}update(s,f){if(this.transform=s,this.terrain=f,this._sourceLoaded&&!this._paused){this.updateCacheSize(s),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={};let ze;this.used||this.usedForTerrain?this._source.tileID?ze=s.getVisibleUnwrappedCoordinates(this._source.tileID).map(Je=>new o.OverscaledTileID(Je.canonical.z,Je.wrap,Je.canonical.z,Je.canonical.x,Je.canonical.y)):(ze=s.coveringTiles({tileSize:(this.usedForTerrain?this:this._source).tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:f}),this._source.hasTile&&(ze=ze.filter(Je=>this._source.hasTile(Je)))):ze=[];var s=s.coveringZoomLevel(this._source),y=Math.max(s-Tt.maxOverzooming,this._source.minzoom),v=Math.max(s+Tt.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){var T,P={};for(const Je of ze)Je.canonical.z>this._source.minzoom&&(P[(T=Je.scaledTo(Je.canonical.z-1)).key]=T,P[(T=Je.scaledTo(Math.max(this._source.minzoom,Math.min(Je.canonical.z,5)))).key]=T);ze=ze.concat(Object.values(P))}var R=ze.length===0&&!this._updated&&this._didEmitContent,N=(this._updated=!0,R&&this.fire(new o.Event("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id})),this._updateRetainedTiles(ze,s));if(Qn(this._source.type)){var G={},Z={},R=Object.keys(N),j=g.now();for(const Xe of R){var X=N[Xe],ge=this._tiles[Xe];!ge||ge.fadeEndTime!==0&&ge.fadeEndTime<=j||((ge=this.findLoadedParent(X,y))&&(this._addTile(ge.tileID),G[ge.tileID.key]=ge.tileID),Z[Xe]=X)}this._retainLoadedChildren(Z,s,v,N);for(const Xe in G)N[Xe]||(this._coveredTiles[Xe]=!0,N[Xe]=G[Xe]);if(f){var ye={},be={};for(const Xe of ze)this._tiles[Xe.key].hasData()?ye[Xe.key]=Xe:be[Xe.key]=Xe;for(const Xe in be){var ve=be[Xe].children(this._source.maxzoom);this._tiles[ve[0].key]&&this._tiles[ve[1].key]&&this._tiles[ve[2].key]&&this._tiles[ve[3].key]&&(ye[ve[0].key]=N[ve[0].key]=ve[0],ye[ve[1].key]=N[ve[1].key]=ve[1],ye[ve[2].key]=N[ve[2].key]=ve[2],ye[ve[3].key]=N[ve[3].key]=ve[3],delete be[Xe])}for(const Xe in be){var Fe=this.findLoadedParent(be[Xe],this._source.minzoom);if(Fe){ye[Fe.tileID.key]=N[Fe.tileID.key]=Fe.tileID;for(const ct in ye)ye[ct].isChildOf(Fe.tileID)&&delete ye[ct]}}for(const Xe in this._tiles)ye[Xe]||(this._coveredTiles[Xe]=!0)}}for(const Je in N)this._tiles[Je].clearFadeHold();for(const Je of o.keysDifference(this._tiles,N)){var Ue=this._tiles[Je];Ue.hasSymbolBuckets&&!Ue.holdingForFade()?Ue.setHoldDuration(this.map._fadeDuration):Ue.hasSymbolBuckets&&!Ue.symbolFadeFinished()||this._removeTile(Je)}this._updateLoadedParentTileCache()}}releaseSymbolFadeTiles(){for(const s in this._tiles)this._tiles[s].holdingForFade()&&this._removeTile(s)}_updateRetainedTiles(s,f){var y={},v={},T=Math.max(f-Tt.maxOverzooming,this._source.minzoom),P=Math.max(f+Tt.maxUnderzooming,this._source.minzoom),R={};for(const ge of s){var N=this._addTile(ge);y[ge.key]=ge,N.hasData()||f<this._source.maxzoom&&(R[ge.key]=ge)}this._retainLoadedChildren(R,f,P,y);for(const ge of s){let ye=this._tiles[ge.key];if(!ye.hasData()){if(f+1>this._source.maxzoom){var G=ge.children(this._source.maxzoom)[0],Z=this.getTile(G);if(Z&&Z.hasData()){y[G.key]=G;continue}}else if(Z=ge.children(this._source.maxzoom),y[Z[0].key]&&y[Z[1].key]&&y[Z[2].key]&&y[Z[3].key])continue;let be=ye.wasRequested();for(let ve=ge.overscaledZ-1;ve>=T;--ve){var j=ge.scaledTo(ve);if(v[j.key])break;if(v[j.key]=!0,ye=!(ye=this.getTile(j))&&be?this._addTile(j):ye){var X=ye.hasData();if((be||X)&&(y[j.key]=j),be=ye.wasRequested(),X)break}}}}return y}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const y in this._tiles){var s=[];let v,T=this._tiles[y].tileID;for(;0<T.overscaledZ;){if(T.key in this._loadedParentTiles){v=this._loadedParentTiles[T.key];break}s.push(T.key);var f=T.scaledTo(T.overscaledZ-1);if(v=this._getLoadedTile(f))break;T=f}for(const P of s)this._loadedParentTiles[P]=v}}_addTile(s){let f=this._tiles[s.key];var y;return f||((f=this._cache.getAndRemove(s))&&(this._setTileReloadTimer(s.key,f),f.tileID=s,this._state.initializeTileState(f,this.map?this.map.painter:null),this._cacheTimers[s.key])&&(clearTimeout(this._cacheTimers[s.key]),delete this._cacheTimers[s.key],this._setTileReloadTimer(s.key,f)),(y=f)||(f=new fn(s,this._source.tileSize*s.overscaleFactor()),this._loadTile(f,s.key,f.state)),f.uses++,this._tiles[s.key]=f,y)||this._source.fire(new o.Event("dataloading",{tile:f,coord:f.tileID,dataType:"source"})),f}_setTileReloadTimer(s,f){s in this._timers&&(clearTimeout(this._timers[s]),delete this._timers[s]),f=f.getExpiryTimeout(),f&&(this._timers[s]=setTimeout(()=>{this._reloadTile(s,"expired"),delete this._timers[s]},f))}_removeTile(s){var f=this._tiles[s];f&&(f.uses--,delete this._tiles[s],this._timers[s]&&(clearTimeout(this._timers[s]),delete this._timers[s]),0<f.uses||(f.hasData()&&f.state!=="reloading"?this._cache.add(f.tileID,f,f.getExpiryTimeout()):(f.aborted=!0,this._abortTile(f),this._unloadTile(f))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const s in this._tiles)this._removeTile(s);this._cache.reset()}tilesIn(s,f,y){var v=[];const T=this.transform;if(T){var y=y?T.getCameraQueryGeometry(s):s,P=s.map(Ue=>T.pointCoordinate(Ue,this.terrain)),R=y.map(Ue=>T.pointCoordinate(Ue,this.terrain)),N=this.getIds();let ye=1/0,be=1/0,ve=-1/0,Fe=-1/0;for(const Ue of R)ye=Math.min(ye,Ue.x),be=Math.min(be,Ue.y),ve=Math.max(ve,Ue.x),Fe=Math.max(Fe,Ue.y);for(let Ue=0;Ue<N.length;Ue++){var G=this._tiles[N[Ue]];if(!G.holdingForFade()){const ze=G.tileID;var Z=Math.pow(2,T.zoom-G.tileID.overscaledZ),j=f*G.queryPadding*o.EXTENT/G.tileSize/Z,X=[ze.getTilePoint(new o.MercatorCoordinate(ye,be)),ze.getTilePoint(new o.MercatorCoordinate(ve,Fe))];X[0].x-j<o.EXTENT&&X[0].y-j<o.EXTENT&&0<=X[1].x+j&&0<=X[1].y+j&&(X=P.map(Qe=>ze.getTilePoint(Qe)),j=R.map(Qe=>ze.getTilePoint(Qe)),v.push({tile:G,tileID:ze,queryGeometry:X,cameraQueryGeometry:j,scale:Z}))}}}return v}getVisibleCoordinates(s){s=this.getRenderableIds(s).map(f=>this._tiles[f].tileID);for(const f of s)f.posMatrix=this.transform.calculatePosMatrix(f.toUnwrapped());return s}hasTransition(){if(this._source.hasTransition())return!0;if(Qn(this._source.type)){var s=g.now();for(const f in this._tiles)if(this._tiles[f].fadeEndTime>=s)return!0}return!1}setFeatureState(s,f,y){this._state.updateState(s=s||"_geojsonTileLayer",f,y)}removeFeatureState(s,f,y){this._state.removeFeatureState(s=s||"_geojsonTileLayer",f,y)}getFeatureState(s,f){return this._state.getState(s=s||"_geojsonTileLayer",f)}setDependencies(s,f,y){s=this._tiles[s],s&&s.setDependencies(f,y)}reloadTilesForDependencies(s,f){for(const y in this._tiles)this._tiles[y].hasDependency(s,f)&&this._reloadTile(y,"reloading");this._cache.filter(y=>!y.hasDependency(s,f))}}function Rn(w,s){var f=Math.abs(2*w.wrap)-(w.wrap<0),y=Math.abs(2*s.wrap)-(s.wrap<0);return w.overscaledZ-s.overscaledZ||y-f||s.canonical.y-w.canonical.y||s.canonical.x-w.canonical.x}function Qn(w){return w==="raster"||w==="image"||w==="video"}Tt.maxOverzooming=10,Tt.maxUnderzooming=3;class nn{constructor(s,f){this.reset(s,f)}reset(s,f){this.points=s||[],this._distances=[0];for(let y=1;y<this.points.length;y++)this._distances[y]=this._distances[y-1]+this.points[y].dist(this.points[y-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(f||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(T){if(this.points.length===1)return this.points[0];T=o.clamp(T,0,1);let f=1,y=this._distances[f];for(var v=T*this.paddedLength+this.padding;y<v&&f<this._distances.length;)y=this._distances[++f];var T=f-1,R=this._distances[T],P=y-R,R=0<P?(v-R)/P:0;return this.points[T].mult(1-R).add(this.points[f].mult(R))}}function Fr(w,s){return w==="always"||w!=="never"&&s!=="never"}class ti{constructor(s,f,y){var v=this.boxCells=[],T=this.circleCells=[];this.xCellCount=Math.ceil(s/y),this.yCellCount=Math.ceil(f/y);for(let P=0;P<this.xCellCount*this.yCellCount;P++)v.push([]),T.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=s,this.height=f,this.xScale=this.xCellCount/s,this.yScale=this.yCellCount/f,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(s,f,y,v,T){this._forEachCell(f,y,v,T,this._insertBoxCell,this.boxUid++),this.boxKeys.push(s),this.bboxes.push(f),this.bboxes.push(y),this.bboxes.push(v),this.bboxes.push(T)}insertCircle(s,f,y,v){this._forEachCell(f-v,y-v,f+v,y+v,this._insertCircleCell,this.circleUid++),this.circleKeys.push(s),this.circles.push(f),this.circles.push(y),this.circles.push(v)}_insertBoxCell(s,f,y,v,T,P){this.boxCells[T].push(P)}_insertCircleCell(s,f,y,v,T,P){this.circleCells[T].push(P)}_query(s,f,y,v,T,P,R){if(y<0||s>this.width||v<0||f>this.height)return[];var N=[];if(s<=0&&f<=0&&this.width<=y&&this.height<=v){if(T)return[{key:null,x1:s,y1:f,x2:y,y2:v}];for(let X=0;X<this.boxKeys.length;X++)N.push({key:this.boxKeys[X],x1:this.bboxes[4*X],y1:this.bboxes[4*X+1],x2:this.bboxes[4*X+2],y2:this.bboxes[4*X+3]});for(let X=0;X<this.circleKeys.length;X++){var G=this.circles[3*X],Z=this.circles[3*X+1],j=this.circles[3*X+2];N.push({key:this.circleKeys[X],x1:G-j,y1:Z-j,x2:G+j,y2:Z+j})}}else this._forEachCell(s,f,y,v,this._queryCell,N,{hitTest:T,overlapMode:P,seenUids:{box:{},circle:{}}},R);return N}query(s,f,y,v){return this._query(s,f,y,v,!1,null)}hitTest(s,f,y,v,T,P){return 0<this._query(s,f,y,v,!0,T,P).length}hitTestCircle(s,f,y,v,T){var P=s-y,R=s+y,N=f-y,G=f+y;return!(R<0||P>this.width||G<0||N>this.height)&&(this._forEachCell(P,N,R,G,this._queryCellCircle,P=[],{hitTest:!0,overlapMode:v,circle:{x:s,y:f,radius:y},seenUids:{box:{},circle:{}}},T),0<P.length)}_queryCell(s,f,y,v,T,P,X,N){var{seenUids:G,hitTest:Z,overlapMode:j}=X,X=this.boxCells[T];if(X!==null){var ge=this.bboxes;for(const Je of X)if(!G.box[Je]){G.box[Je]=!0;var ye=4*Je,be=this.boxKeys[Je];if(s<=ge[2+ye]&&f<=ge[3+ye]&&y>=ge[0+ye]&&v>=ge[1+ye]&&(!N||N(be))&&(!Z||!Fr(j,be.overlapMode))&&(P.push({key:be,x1:ge[ye],y1:ge[1+ye],x2:ge[2+ye],y2:ge[3+ye]}),Z))return!0}}if(X=this.circleCells[T],X!==null){var ve=this.circles;for(const Je of X)if(!G.circle[Je]){G.circle[Je]=!0;var Fe=3*Je,Ue=this.circleKeys[Je];if(this._circleAndRectCollide(ve[Fe],ve[1+Fe],ve[2+Fe],s,f,y,v)&&(!N||N(Ue))&&(!Z||!Fr(j,Ue.overlapMode))){var ze=ve[Fe],Qe=ve[1+Fe],Fe=ve[2+Fe];if(P.push({key:Ue,x1:ze-Fe,y1:Qe-Fe,x2:ze+Fe,y2:Qe+Fe}),Z)return!0}}}return!1}_queryCellCircle(s,f,y,v,T,P,X,N){var{circle:G,seenUids:Z,overlapMode:j}=X,X=this.boxCells[T];if(X!==null){var ge=this.bboxes;for(const ze of X)if(!Z.box[ze]){Z.box[ze]=!0;var ye=4*ze,be=this.boxKeys[ze];if(this._circleAndRectCollide(G.x,G.y,G.radius,ge[0+ye],ge[1+ye],ge[2+ye],ge[3+ye])&&(!N||N(be))&&!Fr(j,be.overlapMode))return P.push(!0),!0}}if(X=this.circleCells[T],X!==null){var ve=this.circles;for(const ze of X)if(!Z.circle[ze]){Z.circle[ze]=!0;var Fe=3*ze,Ue=this.circleKeys[ze];if(this._circlesCollide(ve[Fe],ve[1+Fe],ve[2+Fe],G.x,G.y,G.radius)&&(!N||N(Ue))&&!Fr(j,Ue.overlapMode))return P.push(!0),!0}}}_forEachCell(s,f,y,v,T,P,R,N){var G=this._convertToXCellCoord(s),Z=this._convertToYCellCoord(f),j=this._convertToXCellCoord(y),X=this._convertToYCellCoord(v);for(let ye=G;ye<=j;ye++)for(let be=Z;be<=X;be++){var ge=this.xCellCount*be+ye;if(T.call(this,s,f,y,v,ge,P,R,N))return}}_convertToXCellCoord(s){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(s*this.xScale)))}_convertToYCellCoord(s){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(s*this.yScale)))}_circlesCollide(s,f,y,v,T,P){return v-=s,s=T-f,T=y+P,v*v+s*s<T*T}_circleAndRectCollide(s,f,y,v,T,P,R){return P=(P-v)/2,s=Math.abs(s-(v+P)),!(P+y<s||(v=(R-T)/2)+y<(R=Math.abs(f-(T+v)))||!(s<=P||R<=v||(f=s-P)*f+(T=R-v)*T<=y*y))}}function Ar(w,s,f,y,v){var T=o.create();return s?(o.scale(T,T,[1/v,1/v,1]),f||o.rotateZ(T,T,y.angle)):o.multiply(T,y.labelPlaneMatrix,w),T}function oe(w,s,f,y,v){return s?(s=o.clone(w),o.scale(s,s,[v,v,1]),f||o.rotateZ(s,s,-y.angle),s):y.glCoordMatrix}function V(w,s,f){let y;return f?(y=[w.x,w.y,f(w.x,w.y),1],o.transformMat4(y,y,s)):St(y=[w.x,w.y,0,1],y,s),f=y[3],{point:new o.Point(y[0]/f,y[1]/f),signedDistanceFromCamera:f}}function $(w,s){return .5+w/s*.5}function K(w,ve,f,y,v,T,P,R,N,G,Z,j,X){var Fe=R.glyphStartIndex+R.numGlyphs,ge=R.lineStartIndex,ye=R.lineStartIndex+R.lineLength,be=ve.getoffsetX(R.glyphStartIndex),ve=ve.getoffsetX(Fe-1),Fe=De(w*be,f,y,v,T,P,R.segment,ge,ye,N,G,Z,j,X);return Fe&&(be=De(w*ve,f,y,v,T,P,R.segment,ge,ye,N,G,Z,j,X))?{first:Fe,last:be}:null}function me(w,s,f,y){if(w===o.WritingMode.horizontal){var v=Math.abs(f.y-s.y);if(Math.abs(f.x-s.x)*y<v)return{useVertical:!0}}return(w===o.WritingMode.vertical?s.y<f.y:s.x>f.x)?{needsFlipping:!0}:null}function Oe(w,s,f,y,v,T,P,R,N,G,Z,j,X,ge,ye,be){var ve=s/24,Fe=w.lineOffsetX*ve,Ue=w.lineOffsetY*ve;let ze;if(1<w.numGlyphs){var Qe=w.glyphStartIndex+w.numGlyphs,Je=w.lineStartIndex,Xe=w.lineStartIndex+w.lineLength,s=K(ve,R,Fe,Ue,f,Z,j,w,N,T,X,ye,be);if(!s)return{notEnoughRoom:!0};var ct=V(s.first.point,P,be).point,P=V(s.last.point,P,be).point;if(y&&!f&&(ct=me(w.writingMode,ct,P,ge),ct))return ct;ze=[s.first];for(let Dt=w.glyphStartIndex+1;Dt<Qe-1;Dt++)ze.push(De(ve*R.getoffsetX(Dt),Fe,Ue,f,Z,j,w.segment,Je,Xe,N,T,X,ye,be));ze.push(s.last)}else{if(y&&!f&&(P=V(j,v,be).point,ct=w.lineStartIndex+w.segment+1,s=new o.Point(N.getx(ct),N.gety(ct)),y=V(s,v,be),ct=0<y.signedDistanceFromCamera?y.point:He(j,s,P,1,v,be),y=me(w.writingMode,P,ct,ge),y))return y;if(s=De(ve*R.getoffsetX(w.glyphStartIndex),Fe,Ue,f,Z,j,w.segment,w.lineStartIndex,w.lineStartIndex+w.lineLength,N,T,X,ye,be),!s)return{notEnoughRoom:!0};ze=[s]}for(const it of ze)o.addDynamicAttributes(G,it.point,it.angle);return{}}function He(w,s,f,y,v,T){return w=V(w.add(w.sub(s)._unit()),v,T).point,s=f.sub(w),f.add(s._mult(y/s.mag()))}function Ne(w,v){var f,y,{projectionCache:v,lineVertexArray:T,labelPlaneMatrix:P,tileAnchorPoint:R,distanceFromAnchor:N,getElevation:G,previousVertex:Z,direction:j,absOffsetX:X}=v;return v.projections[w]||(0<(y=V(f=new o.Point(T.getx(w),T.gety(w)),P,G)).signedDistanceFromCamera?(v.projections[w]=y.point,y.point):(v=w-j,He(N===0?R:new o.Point(T.getx(v),T.gety(v)),f,Z,X-N+1,P,G)))}function Ce(w,s,f){return w._unit()._perp()._mult(s*f)}function De(w,s,f,y,v,T,P,R,N,G,Z,j,X,ge){w=y?w-s:w+s;let ye=0<w?1:-1,be=0,ve=(y&&(ye*=-1,be=Math.PI),ye<0&&(be+=Math.PI),0<ye?R+P:R+P+1),Fe=v,Ue=v,ze,Qe,Je=0,Xe=0;var ct=Math.abs(w),it=[];let _t;for(;Je+Xe<=ct;){if((ve+=ye)<R||ve>=N)return null;Je+=Xe,Ue=Fe,Qe=ze;var Dt={projectionCache:j,lineVertexArray:G,labelPlaneMatrix:Z,tileAnchorPoint:T,distanceFromAnchor:Je,getElevation:ge,previousVertex:Ue,direction:ye,absOffsetX:ct};if(Fe=Ne(ve,Dt),f===0)it.push(Ue),_t=Fe.sub(Ue);else{let vn;var Yt=Fe.sub(Ue);vn=Yt.mag()===0?Ce(Ne(ve+ye,Dt).sub(Fe),f,ye):Ce(Yt,f,ye),Qe=Qe||Ue.add(vn),ze=function(bn,Zt,Ct,cn,Cn,$t,tr,Rr){var{projectionCache:Jn,direction:ar}=Rr;if(!Jn.offsets[bn]){if(Zt=Ct.add(Zt),bn+ar<cn||Cn<=bn+ar)return Jn.offsets[bn]=Zt;cn=Ne(bn+ar,Rr),Cn=Ce(cn.sub(Ct),tr,ar),Rr=Ct.add(Cn),tr=cn.add(Cn),Jn.offsets[bn]=o.findLineIntersection($t,Zt,Rr,tr)||Zt}return Jn.offsets[bn]}(ve,vn,Fe,R,N,Qe,f,Dt),it.push(Qe),_t=ze.sub(Qe)}Xe=_t.mag()}return s=(ct-Je)/Xe,y=_t._mult(s)._add(Qe||Ue),P=be+Math.atan2(Fe.y-Ue.y,Fe.x-Ue.x),it.push(y),{point:y,angle:X?P:0,path:it}}const ot=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function st(w,s){for(let y=0;y<w;y++){var f=s.length;s.resize(f+4),s.float32.set(ot,3*f)}}function St(w,v,f){var y=v[0],v=v[1];w[0]=f[0]*y+f[4]*v+f[12],w[1]=f[1]*y+f[5]*v+f[13],w[3]=f[3]*y+f[7]*v+f[15]}class un{constructor(s,f=new ti(s.width+200,s.height+200,25),y=new ti(s.width+200,s.height+200,25)){this.transform=s,this.grid=f,this.ignoredGrid=y,this.pitchfactor=Math.cos(s._pitch)*s.cameraToCenterDistance,this.screenRightBoundary=s.width+100,this.screenBottomBoundary=s.height+100,this.gridRightBoundary=s.width+200,this.gridBottomBoundary=s.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(X,f,G,R,T,N){var R=this.projectAndGetPerspectiveRatio(R,X.anchorPointX,X.anchorPointY,N),N=G*R.perspectiveRatio,G=X.x1*N+R.point.x,Z=X.y1*N+R.point.y,j=X.x2*N+R.point.x,X=X.y2*N+R.point.y;return!this.isInsideGrid(G,Z,j,X)||f!=="always"&&this.grid.hitTest(G,Z,j,X,f,T)||R.perspectiveRatio<this.perspectiveRatioCutoff?{box:[],offscreen:!1}:{box:[G,Z,j,X],offscreen:this.isOffscreen(G,Z,j,X)}}placeCollisionCircles(s,f,y,Qe,ze,Fe,R,N,G,Ue,j,X,ge,ye){var be=[],ve=new o.Point(f.anchorX,f.anchorY),Fe=V(ve,Fe,ye),Fe=$(this.transform.cameraToCenterDistance,Fe.signedDistanceFromCamera),Ue=(Ue?ze/Fe:ze*Fe)/o.ONE_EM,ze=V(ve,R,ye).point,Qe=K(Ue,Qe,f.lineOffsetX*Ue,f.lineOffsetY*Ue,!1,ze,ve,f,y,R,{projections:{},offsets:{}},!1,ye);let Je=!1,Xe=!1,ct=!0;if(Qe){var it=.5*X*Fe+ge,Ue=new o.Point(-100,-100),ze=new o.Point(this.screenRightBoundary,this.screenBottomBoundary),_t=new nn,Dt=Qe.first,Yt=Qe.last;let Ln=[];for(let sr=Dt.path.length-1;1<=sr;sr--)Ln.push(Dt.path[sr]);for(let sr=1;sr<Yt.path.length;sr++)Ln.push(Yt.path[sr]);var vn=2.5*it;N&&(ve=Ln.map(sr=>V(sr,N,ye)),Ln=ve.some(sr=>sr.signedDistanceFromCamera<=0)?[]:ve.map(sr=>sr.point));let kr=[];if(0<Ln.length){var bn=Ln[0].clone(),Zt=Ln[0].clone();for(let sr=1;sr<Ln.length;sr++)bn.x=Math.min(bn.x,Ln[sr].x),bn.y=Math.min(bn.y,Ln[sr].y),Zt.x=Math.max(Zt.x,Ln[sr].x),Zt.y=Math.max(Zt.y,Ln[sr].y);kr=bn.x>=Ue.x&&Zt.x<=ze.x&&bn.y>=Ue.y&&Zt.y<=ze.y?[Ln]:Zt.x<Ue.x||bn.x>ze.x||Zt.y<Ue.y||bn.y>ze.y?[]:o.clipLine([Ln],Ue.x,Ue.y,ze.x,ze.y)}for(const sr of kr){_t.reset(sr,.25*it);let Er=0;Er=_t.length<=.5*it?1:Math.ceil(_t.paddedLength/vn)+1;for(let To=0;To<Er;To++){var cn=To/Math.max(Er-1,1),cn=_t.lerp(cn),Ct=cn.x+100,cn=cn.y+100,Cn=(be.push(Ct,cn,it,0),Ct-it),$t=cn-it,tr=Ct+it,Rr=cn+it;if(ct=ct&&this.isOffscreen(Cn,$t,tr,Rr),Xe=Xe||this.isInsideGrid(Cn,$t,tr,Rr),s!=="always"&&this.grid.hitTestCircle(Ct,cn,it,s,j)&&(Je=!0,!G))return{circles:[],offscreen:!1,collisionDetected:Je}}}}return{circles:!G&&Je||!Xe||Fe<this.perspectiveRatioCutoff?[]:be,offscreen:ct,collisionDetected:Je}}queryRenderedSymbols(s){if(s.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};var f=[];let y=1/0,v=1/0,T=-1/0,P=-1/0;for(const X of s){var R=new o.Point(X.x+100,X.y+100);y=Math.min(y,R.x),v=Math.min(v,R.y),T=Math.max(T,R.x),P=Math.max(P,R.y),f.push(R)}var N={},G={};for(const X of this.grid.query(y,v,T,P).concat(this.ignoredGrid.query(y,v,T,P))){var Z,j=X.key;N[j.bucketInstanceId]===void 0&&(N[j.bucketInstanceId]={}),N[j.bucketInstanceId][j.featureIndex]||(Z=[new o.Point(X.x1,X.y1),new o.Point(X.x2,X.y1),new o.Point(X.x2,X.y2),new o.Point(X.x1,X.y2)],o.polygonIntersectsPolygon(f,Z)&&(N[j.bucketInstanceId][j.featureIndex]=!0,G[j.bucketInstanceId]===void 0&&(G[j.bucketInstanceId]=[]),G[j.bucketInstanceId].push(j.featureIndex)))}return G}insertCollisionBox(s,f,y,v,T,P){(y?this.ignoredGrid:this.grid).insert({bucketInstanceId:v,featureIndex:T,collisionGroupID:P,overlapMode:f},s[0],s[1],s[2],s[3])}insertCollisionCircles(s,f,y,v,T,P){var R=y?this.ignoredGrid:this.grid,N={bucketInstanceId:v,featureIndex:T,collisionGroupID:P,overlapMode:f};for(let G=0;G<s.length;G+=4)R.insertCircle(N,s[G],s[G+1],s[G+2])}projectAndGetPerspectiveRatio(s,f,y,v){let T;return v?(T=[f,y,v(f,y),1],o.transformMat4(T,T,s)):St(T=[f,y,0,1],T,s),{point:new o.Point((T[0]/T[3]+1)/2*this.transform.width+100,(-T[1]/T[3]+1)/2*this.transform.height+100),perspectiveRatio:.5+this.transform.cameraToCenterDistance/T[3]*.5}}isOffscreen(s,f,y,v){return y<100||s>=this.screenRightBoundary||v<100||f>this.screenBottomBoundary}isInsideGrid(s,f,y,v){return 0<=y&&s<this.gridRightBoundary&&0<=v&&f<this.gridBottomBoundary}getViewportMatrix(){var s=o.identity([]);return o.translate(s,s,[-100,-100,0]),s}}function tn(w,s,f){return s*(o.EXTENT/(w.tileSize*Math.pow(2,f-w.tileID.overscaledZ)))}class _n{constructor(s,f,y,v){this.opacity=s?Math.max(0,Math.min(1,s.opacity+(s.placed?f:-f))):v&&y?1:0,this.placed=y}isHidden(){return this.opacity===0&&!this.placed}}class Kn{constructor(s,f,y,v,T){this.text=new _n(s?s.text:null,f,y,T),this.icon=new _n(s?s.icon:null,f,v,T)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class er{constructor(s,f,y){this.text=s,this.icon=f,this.skipFade=y}}class On{constructor(){this.invProjMatrix=o.create(),this.viewportMatrix=o.create(),this.circles=[]}}class Bn{constructor(s,f,y,v,T){this.bucketInstanceId=s,this.featureIndex=f,this.sourceLayerIndex=y,this.bucketIndex=v,this.tileID=T}}class pn{constructor(s){this.crossSourceCollisions=s,this.maxGroupID=0,this.collisionGroups={}}get(s){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[s]){const f=++this.maxGroupID;this.collisionGroups[s]={ID:f,predicate:y=>y.collisionGroupID===f}}return this.collisionGroups[s]}}function gn(T,s,f,y,v){var{horizontalAlign:T,verticalAlign:P}=o.getAnchorAlignment(T);return new o.Point(-(T-.5)*s+y[0]*v,-(P-.5)*f+y[1]*v)}function Yn(P,X,f,y,v,T){var{x1:P,x2:R,y1:N,y2:G,anchorPointX:Z,anchorPointY:j}=P,X=new o.Point(X,f);return y&&X._rotate(v?T:-T),{x1:P+X.x,y1:N+X.y,x2:R+X.x,y2:G+X.y,anchorPointX:Z,anchorPointY:j}}class Br{constructor(s,f,y,v,T){this.transform=s.clone(),this.terrain=f,this.collisionIndex=new un(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=y,this.retainedQueryData={},this.collisionGroups=new pn(v),this.collisionCircleArrays={},(this.prevPlacement=T)&&(T.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(s,f,y,v){var T=y.getBucket(f),P=y.latestFeatureIndex;if(T&&P&&f.id===T.layerIds[0]){var f=y.collisionBoxArray,R=T.layers[0].layout,N=Math.pow(2,this.transform.zoom-y.tileID.overscaledZ),G=y.tileSize/o.EXTENT,Z=this.transform.calculatePosMatrix(y.tileID.toUnwrapped()),j=R.get("text-pitch-alignment")==="map",X=R.get("text-rotation-alignment")==="map",ge=tn(y,1,this.transform.zoom),ye=Ar(Z,j,X,this.transform,ge);let Qe=null;j&&(j=oe(Z,j,X,this.transform,ge),Qe=o.multiply([],this.transform.labelPlaneMatrix,j)),this.retainedQueryData[T.bucketInstanceId]=new Bn(T.bucketInstanceId,P,T.sourceLayerIndex,T.index,y.tileID);var be={bucket:T,layout:R,posMatrix:Z,textLabelPlaneMatrix:ye,labelToScreenMatrix:Qe,scale:N,textPixelRatio:G,holdingForFade:y.holdingForFade(),collisionBoxArray:f,partiallyEvaluatedTextSize:o.evaluateSizeForZoom(T.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(T.sourceID)};if(v)for(const Je of T.sortKeyRanges){var{sortKey:ve,symbolInstanceStart:Fe,symbolInstanceEnd:Ue}=Je;s.push({sortKey:ve,symbolInstanceStart:Fe,symbolInstanceEnd:Ue,parameters:be})}else s.push({symbolInstanceStart:0,symbolInstanceEnd:T.symbolInstances.length,parameters:be})}}attemptAnchorPlacement(Ue,Qe,y,v,T,P,R,N,G,Z,j,X,ge,ye,be,ve){var Fe=o.TextAnchorEnum[Ue.textAnchor],Ue=[Ue.textOffset0,Ue.textOffset1],ze=gn(Fe,y,v,Ue,T),Qe=this.collisionIndex.placeCollisionBox(Yn(Qe,ze.x,ze.y,P,R,this.transform.angle),j,N,G,Z.predicate,ve);if(!(be&&this.collisionIndex.placeCollisionBox(Yn(be,ze.x,ze.y,P,R,this.transform.angle),j,N,G,Z.predicate,ve).box.length===0)&&0<Qe.box.length){let Je;if(this.prevPlacement&&this.prevPlacement.variableOffsets[X.crossTileID]&&this.prevPlacement.placements[X.crossTileID]&&this.prevPlacement.placements[X.crossTileID].text&&(Je=this.prevPlacement.variableOffsets[X.crossTileID].anchor),X.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[X.crossTileID]={textOffset:Ue,width:y,height:v,anchor:Fe,textBoxScale:T,prevAnchor:Je},this.markUsedJustification(ge,Fe,X,ye),ge.allowVerticalPlacement&&(this.markUsedOrientation(ge,ye,X),this.placedOrientations[X.crossTileID]=ye),{shift:ze,placedGlyphBoxes:Qe}}}placeLayerBucketPart(s,f,y){const{bucket:v,layout:T,posMatrix:P,textLabelPlaneMatrix:R,labelToScreenMatrix:N,textPixelRatio:G,holdingForFade:Z,collisionBoxArray:j,partiallyEvaluatedTextSize:X,collisionGroup:ge}=s.parameters,ye=T.get("text-optional"),be=T.get("icon-optional"),ve=o.getOverlapMode(T,"text-overlap","text-allow-overlap"),Fe=ve==="always",Ue=o.getOverlapMode(T,"icon-overlap","icon-allow-overlap");var ze=Ue==="always";const Qe=T.get("text-rotation-alignment")==="map",Je=T.get("text-pitch-alignment")==="map",Xe=T.get("icon-text-fit")!=="none";var ct=T.get("symbol-z-order")==="viewport-y";const it=Fe&&(ze||!v.hasIconData()||be),_t=ze&&(Fe||!v.hasTextData()||ye),Dt=(!v.collisionArrays&&j&&v.deserializeCollisionBoxes(j),this.retainedQueryData[v.bucketInstanceId].tileID),Yt=this.terrain?(Ct,cn)=>this.terrain.getElevation(Dt,Ct,cn):null;var vn=(Ct,cn)=>{if(!f[Ct.crossTileID])if(Z)this.placements[Ct.crossTileID]=new er(!1,!1,!1);else{let ar=!1,Ln=!1,kr=!0,sr=null,Er={box:null,offscreen:null},To={box:null,offscreen:null},ro=null,Ls=null,So=0,ui=0,xi=0;cn.textFeatureIndex?So=cn.textFeatureIndex:Ct.useRuntimeCollisionCircles&&(So=Ct.featureIndex),cn.verticalTextFeatureIndex&&(ui=cn.verticalTextFeatureIndex);const ic=cn.textBox;if(ic){var Cn=Vr=>{let Yr=o.WritingMode.horizontal;return v.allowVerticalPlacement&&!Vr&&this.prevPlacement&&(Vr=this.prevPlacement.placedOrientations[Ct.crossTileID])&&(this.placedOrientations[Ct.crossTileID]=Vr,Yr=Vr,this.markUsedOrientation(v,Yr,Ct)),Yr},$t=(Vr,Yr)=>{if(v.allowVerticalPlacement&&0<Ct.numVerticalGlyphVertices&&cn.verticalTextBox){for(const Fo of v.writingModes)if(Fo===o.WritingMode.vertical?(Er=Yr(),To=Er):Er=Vr(),Er&&Er.box&&Er.box.length)break}else Er=Vr()};const jr=Ct.textAnchorOffsetStartIndex,Co=Ct.textAnchorOffsetEndIndex;if(Co===jr){const Vr=(Yr,Fo)=>(Yr=this.collisionIndex.placeCollisionBox(Yr,ve,G,P,ge.predicate,Yt),Yr&&Yr.box&&Yr.box.length&&(this.markUsedOrientation(v,Fo,Ct),this.placedOrientations[Ct.crossTileID]=Fo),Yr);$t(()=>Vr(ic,o.WritingMode.horizontal),()=>{var Yr=cn.verticalTextBox;return v.allowVerticalPlacement&&0<Ct.numVerticalGlyphVertices&&Yr?Vr(Yr,o.WritingMode.vertical):{box:null,offscreen:null}}),Cn(Er&&Er.box&&Er.box.length)}else{let Vr=o.TextAnchorEnum[(tr=(tr=this.prevPlacement)==null?void 0:tr.variableOffsets[Ct.crossTileID])==null?void 0:tr.anchor];const Yr=(hi,io,Tl)=>{var oc=hi.x2-hi.x1,Ui=hi.y2-hi.y1,ac=Ct.textBoxScale,Sl=Xe&&Ue==="never"?io:null;let Xr={box:[],offscreen:!1},Li=ve==="never"?1:2,sc="never";Vr&&Li++;for(let dd=0;dd<Li;dd++){for(let Cl=jr;Cl<Co;Cl++){var cc=v.textAnchorOffsets.get(Cl);if((!Vr||cc.textAnchor===Vr)&&(cc=this.attemptAnchorPlacement(cc,hi,oc,Ui,ac,Qe,Je,G,P,ge,sc,Ct,v,Tl,Sl,Yt),cc&&(Xr=cc.placedGlyphBoxes)&&Xr.box&&Xr.box.length))return ar=!0,sr=cc.shift,Xr}Vr?Vr=null:sc=ve}return Xr};$t(()=>Yr(ic,cn.iconBox,o.WritingMode.horizontal),()=>{var hi=cn.verticalTextBox,io=Er&&Er.box&&Er.box.length;return v.allowVerticalPlacement&&!io&&0<Ct.numVerticalGlyphVertices&&hi?Yr(hi,cn.verticalIconBox,o.WritingMode.vertical):{box:null,offscreen:null}}),Er&&(ar=Er.box,kr=Er.offscreen);var tr=Cn(Er&&Er.box);!ar&&this.prevPlacement&&($t=this.prevPlacement.variableOffsets[Ct.crossTileID])&&(this.variableOffsets[Ct.crossTileID]=$t,this.markUsedJustification(v,$t.anchor,Ct,tr))}}Cn=Er,ar=Cn&&Cn.box&&0<Cn.box.length,kr=Cn&&Cn.offscreen,Ct.useRuntimeCollisionCircles&&($t=v.text.placedSymbolArray.get(Ct.centerJustifiedTextSymbolIndex),tr=o.evaluateSizeForFeature(v.textSizeData,X,$t),Jn=T.get("text-padding"),Rr=Ct.collisionCircleDiameter,(ro=this.collisionIndex.placeCollisionCircles(ve,$t,v.lineVertexArray,v.glyphOffsetArray,tr,P,R,N,y,Je,ge.predicate,Rr,Jn,Yt)).circles.length&&ro.collisionDetected&&!y&&o.warnOnce("Collisions detected, but collision boxes are not shown"),ar=Fe||0<ro.circles.length&&!ro.collisionDetected,kr=kr&&ro.offscreen),cn.iconFeatureIndex&&(xi=cn.iconFeatureIndex),cn.iconBox&&($t=jr=>(jr=Xe&&sr?Yn(jr,sr.x,sr.y,Qe,Je,this.transform.angle):jr,this.collisionIndex.placeCollisionBox(jr,Ue,G,P,ge.predicate,Yt)),Ln=0<(Ls=To&&To.box&&To.box.length&&cn.verticalIconBox?$t(cn.verticalIconBox):$t(cn.iconBox)).box.length,kr=kr&&Ls.offscreen);var tr=ye||Ct.numHorizontalGlyphVertices===0&&Ct.numVerticalGlyphVertices===0,Rr=be||Ct.numIconVertices===0;if(tr||Rr?Rr?tr||(Ln=Ln&&ar):ar=Ln&&ar:Ln=ar=Ln&&ar,ar&&Cn&&Cn.box&&(To&&To.box&&ui?this.collisionIndex.insertCollisionBox(Cn.box,ve,T.get("text-ignore-placement"),v.bucketInstanceId,ui,ge.ID):this.collisionIndex.insertCollisionBox(Cn.box,ve,T.get("text-ignore-placement"),v.bucketInstanceId,So,ge.ID)),Ln&&Ls&&this.collisionIndex.insertCollisionBox(Ls.box,Ue,T.get("icon-ignore-placement"),v.bucketInstanceId,xi,ge.ID),ro&&(ar&&this.collisionIndex.insertCollisionCircles(ro.circles,ve,T.get("text-ignore-placement"),v.bucketInstanceId,So,ge.ID),y)){var Jn=v.bucketInstanceId;let jr=this.collisionCircleArrays[Jn];jr===void 0&&(jr=this.collisionCircleArrays[Jn]=new On);for(let Co=0;Co<ro.circles.length;Co+=4)jr.circles.push(ro.circles[Co+0]),jr.circles.push(ro.circles[Co+1]),jr.circles.push(ro.circles[Co+2]),jr.circles.push(ro.collisionDetected?1:0)}if(Ct.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(v.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[Ct.crossTileID]=new er(ar||it,Ln||_t,kr||v.justReloaded),f[Ct.crossTileID]=!0}};if(ct){if(s.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");var bn=v.getSortedSymbolIndexes(this.transform.angle);for(let Ct=bn.length-1;0<=Ct;--Ct){var Zt=bn[Ct];vn(v.symbolInstances.get(Zt),v.collisionArrays[Zt])}}else for(let Ct=s.symbolInstanceStart;Ct<s.symbolInstanceEnd;Ct++)vn(v.symbolInstances.get(Ct),v.collisionArrays[Ct]);y&&v.bucketInstanceId in this.collisionCircleArrays&&(ze=this.collisionCircleArrays[v.bucketInstanceId],o.invert(ze.invProjMatrix,P),ze.viewportMatrix=this.collisionIndex.getViewportMatrix()),v.justReloaded=!1}markUsedJustification(s,f,y,v){var T={left:y.leftJustifiedTextSymbolIndex,center:y.centerJustifiedTextSymbolIndex,right:y.rightJustifiedTextSymbolIndex};let P;P=v===o.WritingMode.vertical?y.verticalPlacedTextSymbolIndex:T[o.getAnchorJustification(f)];for(const R of[y.leftJustifiedTextSymbolIndex,y.centerJustifiedTextSymbolIndex,y.rightJustifiedTextSymbolIndex,y.verticalPlacedTextSymbolIndex])0<=R&&(0<=P&&R!==P?s.text.placedSymbolArray.get(R).crossTileID=0:s.text.placedSymbolArray.get(R).crossTileID=y.crossTileID)}markUsedOrientation(s,T,y){var v=T===o.WritingMode.horizontal||T===o.WritingMode.horizontalOnly?T:0,T=T===o.WritingMode.vertical?T:0;for(const P of[y.leftJustifiedTextSymbolIndex,y.centerJustifiedTextSymbolIndex,y.rightJustifiedTextSymbolIndex])s.text.placedSymbolArray.get(P).placedOrientation=v;y.verticalPlacedTextSymbolIndex&&(s.text.placedSymbolArray.get(y.verticalPlacedTextSymbolIndex).placedOrientation=T)}commit(s){this.commitTime=s,this.zoomAtLastRecencyCheck=this.transform.zoom;var f=this.prevPlacement;let y=!1;this.prevZoomAdjustment=f?f.zoomAdjustment(this.transform.zoom):0;var v=f?f.symbolFadeChange(s):1,T=f?f.opacities:{},P=f?f.variableOffsets:{},R=f?f.placedOrientations:{};for(const X in this.placements){var N=this.placements[X],G=T[X];y=G?(this.opacities[X]=new Kn(G,v,N.text,N.icon),y||N.text!==G.text.placed||N.icon!==G.icon.placed):(this.opacities[X]=new Kn(null,v,N.text,N.icon,N.skipFade),y||N.text||N.icon)}for(const X in T){var Z,j=T[X];this.opacities[X]||(Z=new Kn(j,v,!1,!1)).isHidden()||(this.opacities[X]=Z,y=y||j.text.placed||j.icon.placed)}for(const X in P)this.variableOffsets[X]||!this.opacities[X]||this.opacities[X].isHidden()||(this.variableOffsets[X]=P[X]);for(const X in R)this.placedOrientations[X]||!this.opacities[X]||this.opacities[X].isHidden()||(this.placedOrientations[X]=R[X]);if(f&&f.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");y?this.lastPlacementChangeTime=s:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=f?f.lastPlacementChangeTime:s)}updateLayerOpacities(s,f){var y={};for(const T of f){var v=T.getBucket(s);v&&T.latestFeatureIndex&&s.id===v.layerIds[0]&&this.updateBucketOpacities(v,y,T.collisionBoxArray)}}updateBucketOpacities(s,f,y){s.hasTextData()&&(s.text.opacityVertexArray.clear(),s.text.hasVisibleVertices=!1),s.hasIconData()&&(s.icon.opacityVertexArray.clear(),s.icon.hasVisibleVertices=!1),s.hasIconCollisionBoxData()&&s.iconCollisionBox.collisionVertexArray.clear(),s.hasTextCollisionBoxData()&&s.textCollisionBox.collisionVertexArray.clear();var v=s.layers[0],T=v.layout,P=new Kn(null,0,!1,!1,!0),R=T.get("text-allow-overlap"),N=T.get("icon-allow-overlap"),G=v._unevaluatedLayout.hasValue("text-variable-anchor")||v._unevaluatedLayout.hasValue("text-variable-anchor-offset"),Z=T.get("text-rotation-alignment")==="map",j=T.get("text-pitch-alignment")==="map",X=T.get("icon-text-fit")!=="none",ge=new Kn(null,0,R&&(N||!s.hasIconData()||T.get("icon-optional")),N&&(R||!s.hasTextData()||T.get("text-optional")),!0),ye=(!s.collisionArrays&&y&&(s.hasIconCollisionBoxData()||s.hasTextCollisionBoxData())&&s.deserializeCollisionBoxes(y),(it,_t,Dt)=>{for(let Yt=0;Yt<_t/4;Yt++)it.opacityVertexArray.emplaceBack(Dt);it.hasVisibleVertices=it.hasVisibleVertices||Dt!==Do});for(let it=0;it<s.symbolInstances.length;it++){var be=s.symbolInstances.get(it),{numHorizontalGlyphVertices:ve,numVerticalGlyphVertices:Fe,crossTileID:Ue}=be,ze=f[Ue];let _t=this.opacities[Ue];ze?_t=P:_t||(_t=ge,this.opacities[Ue]=_t),f[Ue]=!0;var ze=0<be.numIconVertices,Qe=this.placedOrientations[be.crossTileID];const Dt=Qe===o.WritingMode.vertical;var Je=Qe===o.WritingMode.horizontal||Qe===o.WritingMode.horizontalOnly;if(0<ve||0<Fe){var ct=ir(_t.text),Xe=Dt?Do:ct,ve=(ye(s.text,ve,Xe),Je?Do:ct);ye(s.text,Fe,ve);const vn=_t.text.isHidden();[be.rightJustifiedTextSymbolIndex,be.centerJustifiedTextSymbolIndex,be.leftJustifiedTextSymbolIndex].forEach(bn=>{0<=bn&&(s.text.placedSymbolArray.get(bn).hidden=vn||Dt?1:0)}),0<=be.verticalPlacedTextSymbolIndex&&(s.text.placedSymbolArray.get(be.verticalPlacedTextSymbolIndex).hidden=vn||Je?1:0);var Xe=this.variableOffsets[be.crossTileID],ct=(Xe&&this.markUsedJustification(s,Xe.anchor,be,Qe),this.placedOrientations[be.crossTileID]);ct&&(this.markUsedJustification(s,"left",be,ct),this.markUsedOrientation(s,ct,be))}if(ze&&(Fe=ir(_t.icon),ve=!(X&&be.verticalPlacedIconSymbolIndex&&Dt),0<=be.placedIconSymbolIndex&&(Xe=ve?Fe:Do,ye(s.icon,be.numIconVertices,Xe),s.icon.placedSymbolArray.get(be.placedIconSymbolIndex).hidden=_t.icon.isHidden()),0<=be.verticalPlacedIconSymbolIndex)&&(Qe=ve?Do:Fe,ye(s.icon,be.numVerticalIconVertices,Qe),s.icon.placedSymbolArray.get(be.verticalPlacedIconSymbolIndex).hidden=_t.icon.isHidden()),(s.hasIconCollisionBoxData()||s.hasTextCollisionBoxData())&&(ct=s.collisionArrays[it],ct)){let Yt=new o.Point(0,0);if(ct.textBox||ct.verticalTextBox){let vn=!0;G&&((ze=this.variableOffsets[Ue])?(Yt=gn(ze.anchor,ze.width,ze.height,ze.textOffset,ze.textBoxScale),Z&&Yt._rotate(j?this.transform.angle:-this.transform.angle)):vn=!1),ct.textBox&&si(s.textCollisionBox.collisionVertexArray,_t.text.placed,!vn||Dt,Yt.x,Yt.y),ct.verticalTextBox&&si(s.textCollisionBox.collisionVertexArray,_t.text.placed,!vn||Je,Yt.x,Yt.y)}ve=!!(!Je&&ct.verticalIconBox),ct.iconBox&&si(s.iconCollisionBox.collisionVertexArray,_t.icon.placed,ve,X?Yt.x:0,X?Yt.y:0),ct.verticalIconBox&&si(s.iconCollisionBox.collisionVertexArray,_t.icon.placed,!ve,X?Yt.x:0,X?Yt.y:0)}}if(s.sortFeatures(this.transform.angle),this.retainedQueryData[s.bucketInstanceId]&&(this.retainedQueryData[s.bucketInstanceId].featureSortOrder=s.featureSortOrder),s.hasTextData()&&s.text.opacityVertexBuffer&&s.text.opacityVertexBuffer.updateData(s.text.opacityVertexArray),s.hasIconData()&&s.icon.opacityVertexBuffer&&s.icon.opacityVertexBuffer.updateData(s.icon.opacityVertexArray),s.hasIconCollisionBoxData()&&s.iconCollisionBox.collisionVertexBuffer&&s.iconCollisionBox.collisionVertexBuffer.updateData(s.iconCollisionBox.collisionVertexArray),s.hasTextCollisionBoxData()&&s.textCollisionBox.collisionVertexBuffer&&s.textCollisionBox.collisionVertexBuffer.updateData(s.textCollisionBox.collisionVertexArray),s.text.opacityVertexArray.length!==s.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${s.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${s.text.layoutVertexArray.length}) / 4`);if(s.icon.opacityVertexArray.length!==s.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${s.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${s.icon.layoutVertexArray.length}) / 4`);s.bucketInstanceId in this.collisionCircleArrays&&(v=this.collisionCircleArrays[s.bucketInstanceId],s.placementInvProjMatrix=v.invProjMatrix,s.placementViewportMatrix=v.viewportMatrix,s.collisionCircleArray=v.circles,delete this.collisionCircleArrays[s.bucketInstanceId])}symbolFadeChange(s){return this.fadeDuration===0?1:(s-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(s){return Math.max(0,(this.transform.zoom-s)/1.5)}hasTransitions(s){return this.stale||s-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(s,f){var y=this.zoomAtLastRecencyCheck===f?1-this.zoomAdjustment(f):1;return this.zoomAtLastRecencyCheck=f,this.commitTime+this.fadeDuration*y>s}setStale(){this.stale=!0}}function si(w,s,f,y,v){w.emplaceBack(s?1:0,f?1:0,y||0,v||0),w.emplaceBack(s?1:0,f?1:0,y||0,v||0),w.emplaceBack(s?1:0,f?1:0,y||0,v||0),w.emplaceBack(s?1:0,f?1:0,y||0,v||0)}const $i=Math.pow(2,25),Pi=Math.pow(2,24),mo=Math.pow(2,17),Xh=Math.pow(2,16),bl=Math.pow(2,9),Su=Math.pow(2,8),ga=Math.pow(2,1);function ir(w){var s;return w.opacity!==0||w.placed?w.opacity===1&&w.placed?4294967295:(s=w.placed?1:0,(w=Math.floor(127*w.opacity))*$i+s*Pi+w*mo+s*Xh+w*bl+s*Su+w*ga+s):0}const Do=0;class Oa{constructor(s){this._sortAcrossTiles=s.layout.get("symbol-z-order")!=="viewport-y"&&!s.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(s,f,y,v,T){for(var P=this._bucketParts;this._currentTileIndex<s.length;){var R=s[this._currentTileIndex];if(f.getBucketParts(P,v,R,this._sortAcrossTiles),this._currentTileIndex++,T())return!0}for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,P.sort((G,Z)=>G.sortKey-Z.sortKey));this._currentPartIndex<P.length;){var N=P[this._currentPartIndex];if(f.placeLayerBucketPart(N,this._seenCrossTileIDs,y),this._currentPartIndex++,T())return!0}return!1}}class to{constructor(s,f,y,v,T,P,R,N){this.placement=new Br(s,f,P,R,N),this._currentPlacementIndex=y.length-1,this._forceFullPlacement=v,this._showCollisionBoxes=T,this._done=!1}isDone(){return this._done}continuePlacement(s,f,y){const v=g.now();for(var T=()=>!this._forceFullPlacement&&2<g.now()-v;0<=this._currentPlacementIndex;){var P=f[s[this._currentPlacementIndex]],R=this.placement.collisionIndex.transform.zoom;if(P.type==="symbol"&&(!P.minzoom||P.minzoom<=R)&&(!P.maxzoom||P.maxzoom>R)){if(this._inProgressLayer||(this._inProgressLayer=new Oa(P)),this._inProgressLayer.continuePlacement(y[P.source],this.placement,this._showCollisionBoxes,P,T))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(s){return this.placement.commit(s),this.placement}}const $r=512/o.EXTENT/2;class Ms{constructor(s,f,y){this.tileID=s,this.bucketInstanceId=y,this._symbolsByKey={};var v,T,P=new Map;for(let ye=0;ye<f.length;ye++){var R=f.get(ye),N=R.key,G=P.get(N);G?G.push(R):P.set(N,[R])}for([v,T]of P){var Z={positions:T.map(ye=>({x:Math.floor(ye.anchorX*$r),y:Math.floor(ye.anchorY*$r)})),crossTileIDs:T.map(ye=>ye.crossTileID)};if(128<Z.positions.length){var j,X,ge=new o.KDBush(Z.positions.length,16,Uint16Array);for({x:j,y:X}of Z.positions)ge.add(j,X);ge.finish(),delete Z.positions,Z.index=ge}this._symbolsByKey[v]=Z}}getScaledCoordinates(G,R){var{x:y,y:v,z:T}=this.tileID.canonical,{x:R,y:N,z:P}=R.canonical,P=P-T,T=$r/Math.pow(2,P),P=(R*o.EXTENT+G.anchorX)*T,R=(N*o.EXTENT+G.anchorY)*T,N=y*o.EXTENT*$r,G=v*o.EXTENT*$r;return{x:Math.floor(P-N),y:Math.floor(R-G)}}findMatches(s,f,y){var v=this.tileID.canonical.z<f.canonical.z?1:Math.pow(2,this.tileID.canonical.z-f.canonical.z);for(let j=0;j<s.length;j++){var T=s.get(j);if(!T.crossTileID){var P=this._symbolsByKey[T.key];if(P){var R=this.getScaledCoordinates(T,f);if(P.index)for(const X of P.index.range(R.x-v,R.y-v,R.x+v,R.y+v).sort()){var N=P.crossTileIDs[X];if(!y[N]){y[N]=!0,T.crossTileID=N;break}}else if(P.positions)for(let X=0;X<P.positions.length;X++){var G=P.positions[X],Z=P.crossTileIDs[X];if(Math.abs(G.x-R.x)<=v&&Math.abs(G.y-R.y)<=v&&!y[Z]){y[Z]=!0,T.crossTileID=Z;break}}}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(({crossTileIDs:s})=>s)}}class Jo{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class ea{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(s){var f=Math.round((s-this.lng)/360);if(f!==0)for(const P in this.indexes){var y=this.indexes[P],v={};for(const R in y){var T=y[R];T.tileID=T.tileID.unwrapTo(T.tileID.wrap+f),v[T.tileID.key]=T}this.indexes[P]=v}this.lng=s}addBucket(s,f,y){if(this.indexes[s.overscaledZ]&&this.indexes[s.overscaledZ][s.key]){if(this.indexes[s.overscaledZ][s.key].bucketInstanceId===f.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(s.overscaledZ,this.indexes[s.overscaledZ][s.key])}for(let G=0;G<f.symbolInstances.length;G++)f.symbolInstances.get(G).crossTileID=0;this.usedCrossTileIDs[s.overscaledZ]||(this.usedCrossTileIDs[s.overscaledZ]={});var v=this.usedCrossTileIDs[s.overscaledZ];for(const G in this.indexes){var T=this.indexes[G];if(Number(G)>s.overscaledZ)for(const Z in T){var P=T[Z];P.tileID.isChildOf(s)&&P.findMatches(f.symbolInstances,s,v)}else{var R=T[s.scaledTo(Number(G)).key];R&&R.findMatches(f.symbolInstances,s,v)}}for(let G=0;G<f.symbolInstances.length;G++){var N=f.symbolInstances.get(G);N.crossTileID||(N.crossTileID=y.generate(),v[N.crossTileID]=!0)}return this.indexes[s.overscaledZ]===void 0&&(this.indexes[s.overscaledZ]={}),this.indexes[s.overscaledZ][s.key]=new Ms(s,f.symbolInstances,f.bucketInstanceId),!0}removeBucketCrossTileIDs(s,f){for(const y of f.getCrossTileIDsLists())for(const v of y)delete this.usedCrossTileIDs[s][v]}removeStaleBuckets(s){let f=!1;for(const v in this.indexes){var y=this.indexes[v];for(const T in y)s[y[T].bucketInstanceId]||(this.removeBucketCrossTileIDs(v,y[T]),delete y[T],f=!0)}return f}}class wl{constructor(){this.layerIndexes={},this.crossTileIDs=new Jo,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(s,f,y){let v=this.layerIndexes[s.id],T=!1;var P={};(v=v===void 0?this.layerIndexes[s.id]=new ea:v).handleWrapJump(y);for(const N of f){var R=N.getBucket(s);R&&s.id===R.layerIds[0]&&(R.bucketInstanceId||(R.bucketInstanceId=++this.maxBucketInstanceId),v.addBucket(N.tileID,R,this.crossTileIDs)&&(T=!0),P[R.bucketInstanceId]=!0)}return T=v.removeStaleBuckets(P)?!0:T}pruneUnusedLayers(s){const f={};s.forEach(y=>{f[y]=!0});for(const y in this.layerIndexes)f[y]||delete this.layerIndexes[y]}}const no=(w,s)=>o.emitValidationErrors(w,s&&s.filter(f=>f.identifier!=="source.canvas")),ci=o.emptyStyle();class Rs extends o.Evented{constructor(s,f={}){super(),this._rtlPluginLoaded=()=>{for(const v in this.sourceCaches){var y=this.sourceCaches[v].getSource().type;y!=="vector"&&y!=="geojson"||this.sourceCaches[v].reload()}},this.map=s,this.dispatcher=new Qt(qn(),s._getMapId()),this.dispatcher.registerMessageHandler("GG",(y,v)=>this.getGlyphs(y,v)),this.dispatcher.registerMessageHandler("GI",(y,v)=>this.getImages(y,v)),this.imageManager=new xe,this.imageManager.setEventedParent(this),this.glyphManager=new ke(s._requestManager,f.localIdeographFontFamily),this.lineAtlas=new ht(256,512),this.crossTileSymbolIndex=new wl,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new o.ZoomHistory,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("SR",o.getReferrer()),qt().on(Te,this._rtlPluginLoaded),this.on("data",y=>{if(y.dataType==="source"&&y.sourceDataType==="metadata"&&(y=this.sourceCaches[y.sourceId],y)){var v=y.getSource();if(v&&v.vectorLayerIds)for(const P in this._layers){var T=this._layers[P];T.source===v.id&&this._validateLayer(T)}}})}loadURL(s,f={},y){this.fire(new o.Event("dataloading",{dataType:"style"})),f.validate=typeof f.validate!="boolean"||f.validate,s=this.map._requestManager.transformRequest(s,"Style"),this._loadStyleRequest=new AbortController,o.getJSON(s,this._loadStyleRequest).then(v=>{this._loadStyleRequest=null,this._load(v.data,f,y)}).catch(v=>{this._loadStyleRequest=null,v&&this.fire(new o.ErrorEvent(v))})}loadJSON(s,f={},y){this.fire(new o.Event("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,g.frameAsync(this._frameRequest).then(()=>{this._frameRequest=null,f.validate=f.validate!==!1,this._load(s,f,y)}).catch(()=>{})}loadEmpty(){this.fire(new o.Event("dataloading",{dataType:"style"})),this._load(ci,{validate:!1})}_load(s,f,y){var v=f.transformStyle?f.transformStyle(y,s):s;if(!f.validate||!no(this,o.validateStyle(v))){this._loaded=!0;for(const T in(this.stylesheet=v).sources)this.addSource(T,v.sources[T],{validate:!1});v.sprite?this._loadSprite(v.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(v.glyphs),this._createLayers(),this.light=new Re(this.stylesheet.light),this.map.setTerrain((y=this.stylesheet.terrain)!=null?y:null),this.fire(new o.Event("data",{dataType:"style"})),this.fire(new o.Event("style.load"))}}_createLayers(){var s=o.derefLayers(this.stylesheet.layers);this.dispatcher.broadcast("SL",s),this._order=s.map(y=>y.id),this._layers={},this._serializedLayers=null;for(const y of s){var f=o.createStyleLayer(y);f.setEventedParent(this,{layer:{id:y.id}}),this._layers[y.id]=f}}_loadSprite(s,f=!1,y=void 0){this.imageManager.setLoaded(!1),this._spriteRequest=new AbortController;let v;pe(s,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then(T=>{if(this._spriteRequest=null,T)for(const R in T){this._spritesImagesIds[R]=[];for(const N of this._spritesImagesIds[R]?this._spritesImagesIds[R].filter(G=>!(G in T)):[])this.imageManager.removeImage(N),this._changedImages[N]=!0;for(const N in T[R]){var P=R==="default"?N:R+":"+N;this._spritesImagesIds[R].push(P),P in this.imageManager.images?this.imageManager.updateImage(P,T[R][N],!1):this.imageManager.addImage(P,T[R][N]),f&&(this._changedImages[P]=!0)}}}).catch(T=>{this._spriteRequest=null,v=T,this.fire(new o.ErrorEvent(v))}).finally(()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),f&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new o.Event("data",{dataType:"style"})),y&&y(v)})}_unloadSprite(){for(const s of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(s),this._changedImages[s]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new o.Event("data",{dataType:"style"}))}_validateLayer(s){var f,y=this.sourceCaches[s.source];y&&(f=s.sourceLayer)&&((y=y.getSource()).type==="geojson"||y.vectorLayerIds&&y.vectorLayerIds.indexOf(f)===-1)&&this.fire(new o.ErrorEvent(new Error(`Source layer "${f}" does not exist on source "${y.id}" as specified by style layer "${s.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const s in this.sourceCaches)if(!this.sourceCaches[s].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(s){var f=this._serializedAllLayers();if(!s||s.length===0)return Object.values(f);var y=[];for(const v of s)f[v]&&y.push(f[v]);return y}_serializedAllLayers(){var s=this._serializedLayers;if(!s){s=this._serializedLayers={};for(const y of Object.keys(this._layers)){var f=this._layers[y];f.type!=="custom"&&(s[y]=f.serialize())}}return s}hasTransitions(){if(this.light&&this.light.hasTransition())return!0;for(const s in this.sourceCaches)if(this.sourceCaches[s].hasTransition())return!0;for(const s in this._layers)if(this._layers[s].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(s){if(this._loaded){var f=this._changed;if(this._changed){var y=Object.keys(this._updatedLayers),v=Object.keys(this._removedLayers);(y.length||v.length)&&this._updateWorkerLayers(y,v);for(const Z in this._updatedSources){var T=this._updatedSources[Z];if(T==="reload")this._reloadSource(Z);else{if(T!=="clear")throw new Error("Invalid action "+T);this._clearSource(Z)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const Z in this._updatedPaintProps)this._layers[Z].updateTransitions(s);this.light.updateTransitions(s),this._resetUpdates()}var P={};for(const Z in this.sourceCaches){var R=this.sourceCaches[Z];P[Z]=R.used,R.used=!1}for(const Z of this._order){var N=this._layers[Z];N.recalculate(s,this._availableImages),!N.isHidden(s.zoom)&&N.source&&(this.sourceCaches[N.source].used=!0)}for(const Z in P){var G=this.sourceCaches[Z];P[Z]!==G.used&&G.fire(new o.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:Z}))}this.light.recalculate(s),this.z=s.zoom,f&&this.fire(new o.Event("data",{dataType:"style"}))}}_updateTilesForChangedImages(){var s=Object.keys(this._changedImages);if(s.length){for(const f in this.sourceCaches)this.sourceCaches[f].reloadTilesForDependencies(["icons","patterns"],s);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const s in this.sourceCaches)this.sourceCaches[s].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(s,f){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(s),removedIds:f})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(s,v={}){this._checkLoaded();var y=this.serialize(),v=(s=v.transformStyle?v.transformStyle(y,s):s,(v=v.validate)==null||v);if(v&&no(this,o.validateStyle(s)))return!1;if((s=o.clone$1(s)).layers=o.derefLayers(s.layers),v=o.diffStyles(y,s),y=this._getOperationsToPerform(v),0<y.unimplemented.length)throw new Error(`Unimplemented: ${y.unimplemented.join(", ")}.`);if(y.operations.length===0)return!1;for(const T of y.operations)T();return this.stylesheet=s,!(this._serializedLayers=null)}_getOperationsToPerform(s){var f=[],y=[];for(const v of s)switch(v.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":continue;case"addLayer":f.push(()=>this.addLayer.apply(this,v.args));break;case"removeLayer":f.push(()=>this.removeLayer.apply(this,v.args));break;case"setPaintProperty":f.push(()=>this.setPaintProperty.apply(this,v.args));break;case"setLayoutProperty":f.push(()=>this.setLayoutProperty.apply(this,v.args));break;case"setFilter":f.push(()=>this.setFilter.apply(this,v.args));break;case"addSource":f.push(()=>this.addSource.apply(this,v.args));break;case"removeSource":f.push(()=>this.removeSource.apply(this,v.args));break;case"setLayerZoomRange":f.push(()=>this.setLayerZoomRange.apply(this,v.args));break;case"setLight":f.push(()=>this.setLight.apply(this,v.args));break;case"setGeoJSONSourceData":f.push(()=>this.setGeoJSONSourceData.apply(this,v.args));break;case"setGlyphs":f.push(()=>this.setGlyphs.apply(this,v.args));break;case"setSprite":f.push(()=>this.setSprite.apply(this,v.args));break;case"setTerrain":f.push(()=>this.map.setTerrain.apply(this,v.args));break;case"setTransition":f.push(()=>{});break;default:y.push(v.command)}return{operations:f,unimplemented:y}}addImage(s,f){if(this.getImage(s))return this.fire(new o.ErrorEvent(new Error(`An image named "${s}" already exists.`)));this.imageManager.addImage(s,f),this._afterImageUpdated(s)}updateImage(s,f){this.imageManager.updateImage(s,f)}getImage(s){return this.imageManager.getImage(s)}removeImage(s){if(!this.getImage(s))return this.fire(new o.ErrorEvent(new Error(`An image named "${s}" does not exist.`)));this.imageManager.removeImage(s),this._afterImageUpdated(s)}_afterImageUpdated(s){this._availableImages=this.imageManager.listImages(),this._changedImages[s]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new o.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(s,f,y={}){if(this._checkLoaded(),this.sourceCaches[s]!==void 0)throw new Error(`Source "${s}" already exists.`);if(!f.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(f).join(", ")}.`);var v=0<=["vector","raster","geojson","video","image"].indexOf(f.type);if(!v||!this._validate(o.validateStyle.source,"sources."+s,f,null,y)){this.map&&this.map._collectResourceTiming&&(f.collectResourceTiming=!0);const T=this.sourceCaches[s]=new Tt(s,f,this.dispatcher);T.style=this,T.setEventedParent(this,()=>({isSourceLoaded:T.loaded(),source:T.serialize(),sourceId:s})),T.onAdd(this.map),this._changed=!0}}removeSource(s){if(this._checkLoaded(),this.sourceCaches[s]===void 0)throw new Error("There is no source with this ID");for(const y in this._layers)if(this._layers[y].source===s)return this.fire(new o.ErrorEvent(new Error(`Source "${s}" cannot be removed while layer "${y}" is using it.`)));var f=this.sourceCaches[s];delete this.sourceCaches[s],delete this._updatedSources[s],f.fire(new o.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:s})),f.setEventedParent(null),f.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(s,f){if(this._checkLoaded(),this.sourceCaches[s]===void 0)throw new Error("There is no source with this ID="+s);if(s=this.sourceCaches[s].getSource(),s.type!=="geojson")throw new Error(`geojsonSource.type is ${s.type}, which is !== 'geojson`);s.setData(f),this._changed=!0}getSource(s){return this.sourceCaches[s]&&this.sourceCaches[s].getSource()}addLayer(s,f,y={}){this._checkLoaded();var v=s.id;if(this.getLayer(v))this.fire(new o.ErrorEvent(new Error(`Layer "${v}" already exists on this map.`)));else{let T;if(s.type==="custom"){if(no(this,o.validateCustomStyleLayer(s)))return;T=o.createStyleLayer(s)}else{if("source"in s&&typeof s.source=="object"&&(this.addSource(v,s.source),s=o.clone$1(s),s=o.extend(s,{source:v})),this._validate(o.validateStyle.layer,"layers."+v,s,{arrayIndex:-1},y))return;T=o.createStyleLayer(s),this._validateLayer(T),T.setEventedParent(this,{layer:{id:v}})}y=f?this._order.indexOf(f):this._order.length,f&&y===-1?this.fire(new o.ErrorEvent(new Error(`Cannot add layer "${v}" before non-existing layer "${f}".`))):(this._order.splice(y,0,v),this._layerOrderChanged=!0,this._layers[v]=T,this._removedLayers[v]&&T.source&&T.type!=="custom"&&(s=this._removedLayers[v],delete this._removedLayers[v],s.type!==T.type?this._updatedSources[T.source]="clear":(this._updatedSources[T.source]="reload",this.sourceCaches[T.source].pause())),this._updateLayer(T),T.onAdd&&T.onAdd(this.map))}}moveLayer(s,f){var y;this._checkLoaded(),this._changed=!0,this._layers[s]?s!==f&&(y=this._order.indexOf(s),this._order.splice(y,1),y=f?this._order.indexOf(f):this._order.length,f&&y===-1?this.fire(new o.ErrorEvent(new Error(`Cannot move layer "${s}" before non-existing layer "${f}".`))):(this._order.splice(y,0,s),this._layerOrderChanged=!0)):this.fire(new o.ErrorEvent(new Error(`The layer '${s}' does not exist in the map's style and cannot be moved.`)))}removeLayer(s){this._checkLoaded();var f,y=this._layers[s];y?(y.setEventedParent(null),f=this._order.indexOf(s),this._order.splice(f,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[s]=y,delete this._layers[s],this._serializedLayers&&delete this._serializedLayers[s],delete this._updatedLayers[s],delete this._updatedPaintProps[s],y.onRemove&&y.onRemove(this.map)):this.fire(new o.ErrorEvent(new Error(`Cannot remove non-existing layer "${s}".`)))}getLayer(s){return this._layers[s]}getLayersOrder(){return[...this._order]}hasLayer(s){return s in this._layers}setLayerZoomRange(s,f,y){this._checkLoaded();var v=this.getLayer(s);v?v.minzoom===f&&v.maxzoom===y||(f!=null&&(v.minzoom=f),y!=null&&(v.maxzoom=y),this._updateLayer(v)):this.fire(new o.ErrorEvent(new Error(`Cannot set the zoom range of non-existing layer "${s}".`)))}setFilter(s,f,y={}){this._checkLoaded();var v=this.getLayer(s);v?o.deepEqual(v.filter,f)||(f==null?(v.filter=void 0,this._updateLayer(v)):this._validate(o.validateStyle.filter,`layers.${v.id}.filter`,f,null,y)||(v.filter=o.clone$1(f),this._updateLayer(v))):this.fire(new o.ErrorEvent(new Error(`Cannot filter non-existing layer "${s}".`)))}getFilter(s){return o.clone$1(this.getLayer(s).filter)}setLayoutProperty(s,f,y,v={}){this._checkLoaded();var T=this.getLayer(s);T?o.deepEqual(T.getLayoutProperty(f),y)||(T.setLayoutProperty(f,y,v),this._updateLayer(T)):this.fire(new o.ErrorEvent(new Error(`Cannot style non-existing layer "${s}".`)))}getLayoutProperty(s,f){var y=this.getLayer(s);if(y)return y.getLayoutProperty(f);this.fire(new o.ErrorEvent(new Error(`Cannot get style of non-existing layer "${s}".`)))}setPaintProperty(s,f,y,v={}){this._checkLoaded();var T=this.getLayer(s);T?o.deepEqual(T.getPaintProperty(f),y)||(T.setPaintProperty(f,y,v)&&this._updateLayer(T),this._changed=!0,this._updatedPaintProps[s]=!0):this.fire(new o.ErrorEvent(new Error(`Cannot style non-existing layer "${s}".`)))}getPaintProperty(s,f){return this.getLayer(s).getPaintProperty(f)}setFeatureState(s,f){this._checkLoaded();var y=s.source,v=s.sourceLayer,T=this.sourceCaches[y];T===void 0?this.fire(new o.ErrorEvent(new Error(`The source '${y}' does not exist in the map's style.`))):(y=T.getSource().type)==="geojson"&&v?this.fire(new o.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):y!=="vector"||v?(s.id===void 0&&this.fire(new o.ErrorEvent(new Error("The feature id parameter must be provided."))),T.setFeatureState(v,s.id,f)):this.fire(new o.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(s,f){this._checkLoaded();var y,v=s.source,T=this.sourceCaches[v];T===void 0?this.fire(new o.ErrorEvent(new Error(`The source '${v}' does not exist in the map's style.`))):(y=(v=T.getSource().type)==="vector"?s.sourceLayer:void 0,v!=="vector"||y?f&&typeof s.id!="string"&&typeof s.id!="number"?this.fire(new o.ErrorEvent(new Error("A feature id is required to remove its specific state property."))):T.removeFeatureState(y,s.id,f):this.fire(new o.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types."))))}getFeatureState(s){this._checkLoaded();var f=s.source,y=s.sourceLayer,v=this.sourceCaches[f];if(v===void 0)this.fire(new o.ErrorEvent(new Error(`The source '${f}' does not exist in the map's style.`)));else{if(v.getSource().type!=="vector"||y)return s.id===void 0&&this.fire(new o.ErrorEvent(new Error("The feature id parameter must be provided."))),v.getFeatureState(y,s.id);this.fire(new o.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}}getTransition(){return o.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){var s,f,y,v;if(this._loaded)return s=o.mapObject(this.sourceCaches,T=>T.serialize()),f=this._serializeByIds(this._order),y=this.map.getTerrain()||void 0,v=this.stylesheet,o.filterObject({version:v.version,name:v.name,metadata:v.metadata,light:v.light,center:v.center,zoom:v.zoom,bearing:v.bearing,pitch:v.pitch,sprite:v.sprite,glyphs:v.glyphs,transition:v.transition,sources:s,layers:f,terrain:y},T=>T!==void 0)}_updateLayer(s){this._updatedLayers[s.id]=!0,s.source&&!this._updatedSources[s.source]&&this.sourceCaches[s.source].getSource().type!=="raster"&&(this._updatedSources[s.source]="reload",this.sourceCaches[s.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(s){var f=j=>this._layers[j].type==="fill-extrusion",y={},v=[];for(let j=this._order.length-1;0<=j;j--){var T=this._order[j];if(f(T)){y[T]=j;for(const X of s){var P=X[T];if(P)for(const ge of P)v.push(ge)}}}v.sort((j,X)=>X.intersectionZ-j.intersectionZ);var R=[];for(let j=this._order.length-1;0<=j;j--){var N=this._order[j];if(f(N))for(let X=v.length-1;0<=X;X--){var G=v[X].feature;if(y[G.layer.id]<j)break;R.push(G),v.pop()}else for(const X of s){var Z=X[N];if(Z)for(const ge of Z)R.push(ge.feature)}}return R}queryRenderedFeatures(s,f,y){f&&f.filter&&this._validate(o.validateStyle.filter,"queryRenderedFeatures.filter",f.filter,null,f);var v={};if(f&&f.layers){if(!Array.isArray(f.layers))return this.fire(new o.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const N of f.layers){var T=this._layers[N];if(!T)return this.fire(new o.ErrorEvent(new Error(`The layer '${N}' does not exist in the map's style and cannot be queried for features.`))),[];v[T.source]=!0}}var P=[],R=(f.availableImages=this._availableImages,this._serializedAllLayers());for(const N in this.sourceCaches)f.layers&&!v[N]||P.push(Ot(this.sourceCaches[N],this._layers,R,s,f,y));return this.placement&&P.push(En(this._layers,R,this.sourceCaches,s,f,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(P)}querySourceFeatures(s,f){return f&&f.filter&&this._validate(o.validateStyle.filter,"querySourceFeatures.filter",f.filter,null,f),s=this.sourceCaches[s],s?lt(s,f):[]}getLight(){return this.light.getLight()}setLight(s,f={}){this._checkLoaded();var y,v=this.light.getLight();let T=!1;for(const P in s)if(!o.deepEqual(s[P],v[P])){T=!0;break}T&&(y={now:g.now(),transition:o.extend({duration:300,delay:0},this.stylesheet.transition)},this.light.setLight(s,f),this.light.updateTransitions(y))}_validate(s,f,y,v,T={}){return(!T||T.validate!==!1)&&no(this,s.call(o.validateStyle,o.extend({key:f,style:this.serialize(),value:y,styleSpec:o.v8Spec},v)))}_remove(s=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),qt().off(Te,this._rtlPluginLoaded);for(const y in this._layers)this._layers[y].setEventedParent(null);for(const y in this.sourceCaches){var f=this.sourceCaches[y];f.setEventedParent(null),f.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),s&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(s)}_clearSource(s){this.sourceCaches[s].clearTiles()}_reloadSource(s){this.sourceCaches[s].resume(),this.sourceCaches[s].reload()}_updateSources(s){for(const f in this.sourceCaches)this.sourceCaches[f].update(s,this.map.terrain)}_generateCollisionBoxes(){for(const s in this.sourceCaches)this._reloadSource(s)}_updatePlacement(s,f,y,v,T=!1){let P=!1,R=!1;var N={};for(const j of this._order){var G=this._layers[j];if(G.type==="symbol"){if(!N[G.source]){const X=this.sourceCaches[G.source];N[G.source]=X.getRenderableIds(!0).map(ge=>X.getTileByID(ge)).sort((ge,ye)=>ye.tileID.overscaledZ-ge.tileID.overscaledZ||(ge.tileID.isLessThan(ye.tileID)?-1:1))}G=this.crossTileSymbolIndex.addLayer(G,N[G.source],s.center.lng),P=P||G}}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((T=T||this._layerOrderChanged||y===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(g.now(),s.zoom))&&(this.pauseablePlacement=new to(s,this.map.terrain,this._order,T,f,y,v,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,N),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(g.now()),R=!0),P&&this.pauseablePlacement.placement.setStale()),R||P)for(const j of this._order){var Z=this._layers[j];Z.type==="symbol"&&this.placement.updateLayerOpacities(Z,N[Z.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(g.now())}_releaseSymbolFadeTiles(){for(const s in this.sourceCaches)this.sourceCaches[s].releaseSymbolFadeTiles()}getImages(s,f){return o.__awaiter(this,void 0,void 0,function*(){var y=yield this.imageManager.getImages(f.icons),v=(this._updateTilesForChangedImages(),this.sourceCaches[f.source]);return v&&v.setDependencies(f.tileID.key,f.type,f.icons),y})}getGlyphs(s,f){return o.__awaiter(this,void 0,void 0,function*(){var y=yield this.glyphManager.getGlyphs(f.stacks),v=this.sourceCaches[f.source];return v&&v.setDependencies(f.tileID.key,f.type,[""]),y})}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(s,f={}){this._checkLoaded(),s&&this._validate(o.validateStyle.glyphs,"glyphs",s,null,f)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=s,this.glyphManager.entries={},this.glyphManager.setURL(s))}addSprite(s,f,y={},v){this._checkLoaded(),s=[{id:s,url:f}],f=[...J(this.stylesheet.sprite),...s],this._validate(o.validateStyle.sprite,"sprite",f,null,y)||(this.stylesheet.sprite=f,this._loadSprite(s,!0,v))}removeSprite(s){this._checkLoaded();var f=J(this.stylesheet.sprite);if(f.find(y=>y.id===s)){if(this._spritesImagesIds[s])for(const y of this._spritesImagesIds[s])this.imageManager.removeImage(y),this._changedImages[y]=!0;f.splice(f.findIndex(y=>y.id===s),1),this.stylesheet.sprite=0<f.length?f:void 0,delete this._spritesImagesIds[s],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new o.Event("data",{dataType:"style"}))}else this.fire(new o.ErrorEvent(new Error(`Sprite "${s}" doesn't exists on this map.`)))}getSprite(){return J(this.stylesheet.sprite)}setSprite(s,f={},y){this._checkLoaded(),s&&this._validate(o.validateStyle.sprite,"sprite",s,null,f)||((this.stylesheet.sprite=s)?this._loadSprite(s,!0,y):(this._unloadSprite(),y&&y(null)))}}var La=o.createLayout([{name:"a_pos",type:"Int16",components:2}]),or="attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;varying float v_depth;void main() {float extent=8192.0;float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/extent;gl_Position=u_matrix*vec4(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta,1.0);v_depth=gl_Position.z/gl_Position.w;}";const rs={prelude:Hn(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture2D(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture2D(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}`),background:Hn(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:Hn(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:Hn(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float ele=get_elevation(circle_center);v_visibility=calculate_visibility(u_matrix*vec4(circle_center,ele,1.0));if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,ele,1);} else {gl_Position=u_matrix*vec4(circle_center,ele,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:Hn("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Hn(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),heatmapTexture:Hn(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:Hn("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,get_elevation(a_pos),1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:Hn("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:Hn("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,get_elevation(a_pos),1);}"),fill:Hn(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),fillOutline:Hn(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillOutlinePattern:Hn(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillPattern:Hn(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:Hn(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:Hn(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:Hn(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Hn(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:Hn(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:Hn(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:Hn(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:Hn(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:Hn(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:Hn(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),z,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:Hn(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:Hn(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:Hn("uniform sampler2D u_texture;varying vec2 v_texture_pos;void main() {gl_FragColor=texture2D(u_texture,v_texture_pos);}",or),terrainDepth:Hn("varying float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {gl_FragColor=pack(v_depth);}",or),terrainCoords:Hn("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;varying vec2 v_texture_pos;void main() {vec4 rgba=texture2D(u_texture,v_texture_pos);gl_FragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}",or)};function Hn(w,s){var f=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,y=s.match(/attribute ([\w]+) ([\w]+)/g),v=w.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),T=s.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),T=T?T.concat(v):v;const P={};return{fragmentSource:w=w.replace(f,(R,N,G,Z,j)=>(P[j]=!0,N==="define"?`
#ifndef HAS_UNIFORM_u_${j}
varying ${G} ${Z} ${j};
#else
uniform ${G} ${Z} u_${j};
#endif
`:`
#ifdef HAS_UNIFORM_u_${j}
    ${G} ${Z} ${j} = u_${j};
#endif
`)),vertexSource:s=s.replace(f,(R,N,G,Z,j)=>{var X=Z==="float"?"vec2":"vec4",ge=j.match(/color/)?"color":X;return P[j]?N==="define"?`
#ifndef HAS_UNIFORM_u_${j}
uniform lowp float u_${j}_t;
attribute ${G} ${X} a_${j};
varying ${G} ${Z} ${j};
#else
uniform ${G} ${Z} u_${j};
#endif
`:ge=="vec4"?`
#ifndef HAS_UNIFORM_u_${j}
    ${j} = a_${j};
#else
    ${G} ${Z} ${j} = u_${j};
#endif
`:`
#ifndef HAS_UNIFORM_u_${j}
    ${j} = unpack_mix_${ge}(a_${j}, u_${j}_t);
#else
    ${G} ${Z} ${j} = u_${j};
#endif
`:N==="define"?`
#ifndef HAS_UNIFORM_u_${j}
uniform lowp float u_${j}_t;
attribute ${G} ${X} a_${j};
#else
uniform ${G} ${Z} u_${j};
#endif
`:ge=="vec4"?`
#ifndef HAS_UNIFORM_u_${j}
    ${G} ${Z} ${j} = a_${j};
#else
    ${G} ${Z} ${j} = u_${j};
#endif
`:`
#ifndef HAS_UNIFORM_u_${j}
    ${G} ${Z} ${j} = unpack_mix_${ge}(a_${j}, u_${j}_t);
#else
    ${G} ${Z} ${j} = u_${j};
#endif
`}),staticAttributes:y,staticUniforms:T}}class is{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(s,f,y,v,T,P,R,N,G){this.context=s;let Z=this.boundPaintVertexBuffers.length!==v.length;for(let j=0;!Z&&j<v.length;j++)this.boundPaintVertexBuffers[j]!==v[j]&&(Z=!0);!this.vao||this.boundProgram!==f||this.boundLayoutVertexBuffer!==y||Z||this.boundIndexBuffer!==T||this.boundVertexOffset!==P||this.boundDynamicVertexBuffer!==R||this.boundDynamicVertexBuffer2!==N||this.boundDynamicVertexBuffer3!==G?this.freshBind(f,y,v,T,P,R,N,G):(s.bindVertexArray.set(this.vao),R&&R.bind(),T&&T.dynamicDraw&&T.bind(),N&&N.bind(),G&&G.bind())}freshBind(s,f,y,v,T,P,R,N){var G=s.numAttributes,Z=this.context,j=Z.gl;this.vao&&this.destroy(),this.vao=Z.createVertexArray(),Z.bindVertexArray.set(this.vao),this.boundProgram=s,this.boundLayoutVertexBuffer=f,this.boundPaintVertexBuffers=y,this.boundIndexBuffer=v,this.boundVertexOffset=T,this.boundDynamicVertexBuffer=P,this.boundDynamicVertexBuffer2=R,this.boundDynamicVertexBuffer3=N,f.enableAttributes(j,s);for(const X of y)X.enableAttributes(j,s);P&&P.enableAttributes(j,s),R&&R.enableAttributes(j,s),N&&N.enableAttributes(j,s),f.bind(),f.setVertexAttribPointers(j,s,T);for(const X of y)X.bind(),X.setVertexAttribPointers(j,s,T);P&&(P.bind(),P.setVertexAttribPointers(j,s,T)),v&&v.bind(),R&&(R.bind(),R.setVertexAttribPointers(j,s,T)),N&&(N.bind(),N.setVertexAttribPointers(j,s,T)),Z.currentNumAttributes=G}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}const nc=(w,s)=>({u_depth:new o.Uniform1i(w,s.u_depth),u_terrain:new o.Uniform1i(w,s.u_terrain),u_terrain_dim:new o.Uniform1f(w,s.u_terrain_dim),u_terrain_matrix:new o.UniformMatrix4f(w,s.u_terrain_matrix),u_terrain_unpack:new o.Uniform4f(w,s.u_terrain_unpack),u_terrain_exaggeration:new o.Uniform1f(w,s.u_terrain_exaggeration)});function Qh(w){var s,f=[];for(let y=0;y<w.length;y++)w[y]!==null&&(s=w[y].split(" "),f.push(s.pop()));return f}class Jh{constructor(s,f,y,v,T,P){var R=s.gl,G=(this.program=R.createProgram(),Qh(f.staticAttributes)),Z=y?y.getBinderAttributes():[],N=G.concat(Z),G=rs.prelude.staticUniforms?Qh(rs.prelude.staticUniforms):[],Z=f.staticUniforms?Qh(f.staticUniforms):[],j=y?y.getBinderUniforms():[],X=[];for(const ve of G.concat(Z).concat(j))X.indexOf(ve)<0&&X.push(ve);if(G=y?y.defines():[],T&&G.push("#define OVERDRAW_INSPECTOR;"),P&&G.push("#define TERRAIN3D;"),Z=G.concat(rs.prelude.fragmentSource,f.fragmentSource).join(`
`),j=G.concat(rs.prelude.vertexSource,f.vertexSource).join(`
`),T=R.createShader(R.FRAGMENT_SHADER),R.isContextLost())this.failedToCreate=!0;else{if(R.shaderSource(T,Z),R.compileShader(T),!R.getShaderParameter(T,R.COMPILE_STATUS))throw new Error("Could not compile fragment shader: "+R.getShaderInfoLog(T));if(R.attachShader(this.program,T),P=R.createShader(R.VERTEX_SHADER),R.isContextLost())this.failedToCreate=!0;else{if(R.shaderSource(P,j),R.compileShader(P),!R.getShaderParameter(P,R.COMPILE_STATUS))throw new Error("Could not compile vertex shader: "+R.getShaderInfoLog(P));R.attachShader(this.program,P),this.attributes={};var ge={};this.numAttributes=N.length;for(let ve=0;ve<this.numAttributes;ve++)N[ve]&&(R.bindAttribLocation(this.program,ve,N[ve]),this.attributes[N[ve]]=ve);if(R.linkProgram(this.program),!R.getProgramParameter(this.program,R.LINK_STATUS))throw new Error("Program failed to link: "+R.getProgramInfoLog(this.program));R.deleteShader(P),R.deleteShader(T);for(let ve=0;ve<X.length;ve++){var ye,be=X[ve];be&&!ge[be]&&(ye=R.getUniformLocation(this.program,be))&&(ge[be]=ye)}this.fixedUniforms=v(s,ge),this.terrainUniforms=nc(s,ge),this.binderUniforms=y?y.getUniforms(s,ge):[]}}}draw(s,f,y,v,T,P,R,N,G,Z,j,X,ge,ye,be,ve,Fe,Ue){var ze=s.gl;if(!this.failedToCreate){if(s.program.set(this.program),s.setDepthMode(y),s.setStencilMode(v),s.setColorMode(T),s.setCullFace(P),N){s.activeTexture.set(ze.TEXTURE2),ze.bindTexture(ze.TEXTURE_2D,N.depthTexture),s.activeTexture.set(ze.TEXTURE3),ze.bindTexture(ze.TEXTURE_2D,N.texture);for(const Xe in this.terrainUniforms)this.terrainUniforms[Xe].set(N[Xe])}for(const Xe in this.fixedUniforms)this.fixedUniforms[Xe].set(R[Xe]);be&&be.setUniforms(s,this.binderUniforms,ge,{zoom:ye});let Je=0;switch(f){case ze.LINES:Je=2;break;case ze.TRIANGLES:Je=3;break;case ze.LINE_STRIP:Je=1}for(const Xe of X.get()){var Qe=Xe.vaos||(Xe.vaos={});(Qe[G]||(Qe[G]=new is)).bind(s,this,Z,be?be.getPaintVertexBuffers():[],j,Xe.vertexOffset,ve,Fe,Ue),ze.drawElements(f,Xe.primitiveLength*Je,ze.UNSIGNED_SHORT,Xe.primitiveOffset*Je*2)}}}}function xl(w,T,f){var y=1/tn(f,1,T.transform.tileZoom),v=Math.pow(2,f.tileID.overscaledZ),T=f.tileSize*Math.pow(2,T.transform.tileZoom)/v,v=T*(f.tileID.canonical.x+f.tileID.wrap*v),T=T*f.tileID.canonical.y;return{u_image:0,u_texsize:f.imageAtlasTexture.size,u_scale:[y,w.fromScale,w.toScale],u_fade:w.t,u_pixel_coord_upper:[v>>16,T>>16],u_pixel_coord_lower:[65535&v,65535&T]}}const Cu=(w,R,f,y)=>{var v=R.style.light,T=v.properties.get("position"),T=[T.x,T.y,T.z],P=o.create$1(),R=(v.properties.get("anchor")==="viewport"&&o.fromRotation(P,-R.transform.angle),o.transformMat3(T,T,P),v.properties.get("color"));return{u_matrix:w,u_lightpos:T,u_lightintensity:v.properties.get("intensity"),u_lightcolor:[R.r,R.g,R.b],u_vertical_gradient:+f,u_opacity:y}},rc=(w,s,f,y,v,T,P)=>o.extend(Cu(w,s,f,y),xl(T,s,P),{u_height_factor:-Math.pow(2,v.overscaledZ)/P.tileSize/8}),te=w=>({u_matrix:w}),le=(w,s,f,y)=>o.extend(te(w),xl(f,s,y)),Se=(w,s)=>({u_matrix:w,u_world:s}),qe=(w,s,f,y,v)=>o.extend(le(w,s,f,y),{u_world:v}),yt=(w,s,T)=>{var y=tn(T,1,s.zoom),v=Math.pow(2,s.zoom-T.tileID.overscaledZ),T=T.tileID.overscaleFactor();return{u_matrix:w,u_camera_to_center_distance:s.cameraToCenterDistance,u_pixels_to_tile_units:y,u_extrude_scale:[s.pixelsToGLUnits[0]/(y*v),s.pixelsToGLUnits[1]/(y*v)],u_overscale_factor:T}},Jt=(w,s,f)=>({u_matrix:w,u_inv_matrix:s,u_camera_to_center_distance:f.cameraToCenterDistance,u_viewport_size:[f.width,f.height]}),Zn=(w,s,f=1)=>({u_matrix:w,u_color:s,u_overlay:0,u_overlay_scale:f}),Mi=w=>({u_matrix:w}),Wi=(T,s,f,y)=>{var v=o.create(),T=(o.ortho(v,0,T.width,T.height,0,0,1),T.context.gl);return{u_matrix:v,u_world:[T.drawingBufferWidth,T.drawingBufferHeight],u_image:f,u_color_ramp:y,u_opacity:s.paint.get("heatmap-opacity")}},yo=(w,s,f,y)=>{var v=f.paint.get("hillshade-shadow-color"),T=f.paint.get("hillshade-highlight-color"),P=f.paint.get("hillshade-accent-color");let R=f.paint.get("hillshade-illumination-direction")*(Math.PI/180);f.paint.get("hillshade-illumination-anchor")==="viewport"&&(R-=w.transform.angle);var N=!w.options.moving;return{u_matrix:y?y.posMatrix:w.transform.calculatePosMatrix(s.tileID.toUnwrapped(),N),u_image:0,u_latrange:(y=s.tileID,w=Math.pow(2,y.canonical.z),y=y.canonical.y,[new o.MercatorCoordinate(0,y/w).toLngLat().lat,new o.MercatorCoordinate(0,(y+1)/w).toLngLat().lat]),u_light:[f.paint.get("hillshade-exaggeration"),R],u_shadow:v,u_highlight:T,u_accent:P}},Na=(w,s)=>{var f=s.stride,y=o.create();return o.ortho(y,0,o.EXTENT,-o.EXTENT,0,0,1),o.translate(y,y,[0,-o.EXTENT,0]),{u_matrix:y,u_image:1,u_dimension:[f,f],u_zoom:w.overscaledZ,u_unpack:s.getUnpackVector()}},Lm=(w,s,f,y)=>{var v=w.transform;return{u_matrix:zE(w,s,f,y),u_ratio:1/tn(s,1,v.zoom),u_device_pixel_ratio:w.pixelRatio,u_units_to_pixels:[1/v.pixelsToGLUnits[0],1/v.pixelsToGLUnits[1]]}};function UE(w,s){return 1/tn(w,1,s.tileZoom)}function zE(w,s,f,y){return w.translatePosMatrix((y||s.tileID).posMatrix,s,f.paint.get("line-translate"),f.paint.get("line-translate-anchor"))}const Au=(w,s,f,y,v)=>({u_matrix:w,u_tl_parent:s,u_scale_parent:f,u_buffer_scale:1,u_fade_t:y.mix,u_opacity:y.opacity*v.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:v.paint.get("raster-brightness-min"),u_brightness_high:v.paint.get("raster-brightness-max"),u_saturation_factor:0<(w=v.paint.get("raster-saturation"))?1-1/(1.001-w):-w,u_contrast_factor:0<(s=v.paint.get("raster-contrast"))?1/(1-s):1+s,u_spin_weights:(f=v.paint.get("raster-hue-rotate"),f*=Math.PI/180,y=Math.sin(f),[(2*(f=Math.cos(f))+1)/3,(-Math.sqrt(3)*y-f+1)/3,(Math.sqrt(3)*y-f+1)/3])}),Jf=(w,s,f,y,v,T,P,R,N,G)=>{var Z=v.transform;return{u_is_size_zoom_constant:+(w==="constant"||w==="source"),u_is_size_feature_constant:+(w==="constant"||w==="camera"),u_size_t:s?s.uSizeT:0,u_size:s?s.uSize:0,u_camera_to_center_distance:Z.cameraToCenterDistance,u_pitch:Z.pitch/360*2*Math.PI,u_rotate_symbol:+f,u_aspect_ratio:Z.width/Z.height,u_fade_change:v.options.fadeDuration?v.symbolFadeChange:1,u_matrix:T,u_label_plane_matrix:P,u_coord_matrix:R,u_is_text:+N,u_pitch_with_map:+y,u_texsize:G,u_texture:0}},Da=(w,s,f,y,v,T,P,R,N,G,Z)=>{var j=v.transform;return o.extend(Jf(w,s,f,y,v,T,P,R,N,G),{u_gamma_scale:y?Math.cos(j._pitch)*j.cameraToCenterDistance:1,u_device_pixel_ratio:v.pixelRatio,u_is_halo:+Z})},_R=(w,s,f,y,v,T,P,R,N,G)=>o.extend(Da(w,s,f,y,v,T,P,R,!0,N,!0),{u_texsize_icon:G,u_texture_icon:1}),Nm=(w,s,f,y,v,T)=>o.extend(function(j,R,N,G){var Z=N.imageManager.getPattern(j.from.toString()),j=N.imageManager.getPattern(j.to.toString()),{width:X,height:ge}=N.imageManager.getPixelSize(),ye=Math.pow(2,G.tileID.overscaledZ),ye=(be=G.tileSize*Math.pow(2,N.transform.tileZoom)/ye)*(G.tileID.canonical.x+G.tileID.wrap*ye),be=be*G.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:Z.tl,u_pattern_br_a:Z.br,u_pattern_tl_b:j.tl,u_pattern_br_b:j.br,u_texsize:[X,ge],u_mix:R.t,u_pattern_size_a:Z.displaySize,u_pattern_size_b:j.displaySize,u_scale_a:R.fromScale,u_scale_b:R.toScale,u_tile_units_to_pixels:1/tn(G,1,N.transform.tileZoom),u_pixel_coord_upper:[ye>>16,be>>16],u_pixel_coord_lower:[65535&ye,65535&be]}}(y,T,f,v),{u_matrix:w,u_opacity:s}),Dm={fillExtrusion:(w,s)=>({u_matrix:new o.UniformMatrix4f(w,s.u_matrix),u_lightpos:new o.Uniform3f(w,s.u_lightpos),u_lightintensity:new o.Uniform1f(w,s.u_lightintensity),u_lightcolor:new o.Uniform3f(w,s.u_lightcolor),u_vertical_gradient:new o.Uniform1f(w,s.u_vertical_gradient),u_opacity:new o.Uniform1f(w,s.u_opacity)}),fillExtrusionPattern:(w,s)=>({u_matrix:new o.UniformMatrix4f(w,s.u_matrix),u_lightpos:new o.Uniform3f(w,s.u_lightpos),u_lightintensity:new o.Uniform1f(w,s.u_lightintensity),u_lightcolor:new o.Uniform3f(w,s.u_lightcolor),u_vertical_gradient:new o.Uniform1f(w,s.u_vertical_gradient),u_height_factor:new o.Uniform1f(w,s.u_height_factor),u_image:new o.Uniform1i(w,s.u_image),u_texsize:new o.Uniform2f(w,s.u_texsize),u_pixel_coord_upper:new o.Uniform2f(w,s.u_pixel_coord_upper),u_pixel_coord_lower:new o.Uniform2f(w,s.u_pixel_coord_lower),u_scale:new o.Uniform3f(w,s.u_scale),u_fade:new o.Uniform1f(w,s.u_fade),u_opacity:new o.Uniform1f(w,s.u_opacity)}),fill:(w,s)=>({u_matrix:new o.UniformMatrix4f(w,s.u_matrix)}),fillPattern:(w,s)=>({u_matrix:new o.UniformMatrix4f(w,s.u_matrix),u_image:new o.Uniform1i(w,s.u_image),u_texsize:new o.Uniform2f(w,s.u_texsize),u_pixel_coord_upper:new o.Uniform2f(w,s.u_pixel_coord_upper),u_pixel_coord_lower:new o.Uniform2f(w,s.u_pixel_coord_lower),u_scale:new o.Uniform3f(w,s.u_scale),u_fade:new o.Uniform1f(w,s.u_fade)}),fillOutline:(w,s)=>({u_matrix:new o.UniformMatrix4f(w,s.u_matrix),u_world:new o.Uniform2f(w,s.u_world)}),fillOutlinePattern:(w,s)=>({u_matrix:new o.UniformMatrix4f(w,s.u_matrix),u_world:new o.Uniform2f(w,s.u_world),u_image:new o.Uniform1i(w,s.u_image),u_texsize:new o.Uniform2f(w,s.u_texsize),u_pixel_coord_upper:new o.Uniform2f(w,s.u_pixel_coord_upper),u_pixel_coord_lower:new o.Uniform2f(w,s.u_pixel_coord_lower),u_scale:new o.Uniform3f(w,s.u_scale),u_fade:new o.Uniform1f(w,s.u_fade)}),circle:(w,s)=>({u_camera_to_center_distance:new o.Uniform1f(w,s.u_camera_to_center_distance),u_scale_with_map:new o.Uniform1i(w,s.u_scale_with_map),u_pitch_with_map:new o.Uniform1i(w,s.u_pitch_with_map),u_extrude_scale:new o.Uniform2f(w,s.u_extrude_scale),u_device_pixel_ratio:new o.Uniform1f(w,s.u_device_pixel_ratio),u_matrix:new o.UniformMatrix4f(w,s.u_matrix)}),collisionBox:(w,s)=>({u_matrix:new o.UniformMatrix4f(w,s.u_matrix),u_camera_to_center_distance:new o.Uniform1f(w,s.u_camera_to_center_distance),u_pixels_to_tile_units:new o.Uniform1f(w,s.u_pixels_to_tile_units),u_extrude_scale:new o.Uniform2f(w,s.u_extrude_scale),u_overscale_factor:new o.Uniform1f(w,s.u_overscale_factor)}),collisionCircle:(w,s)=>({u_matrix:new o.UniformMatrix4f(w,s.u_matrix),u_inv_matrix:new o.UniformMatrix4f(w,s.u_inv_matrix),u_camera_to_center_distance:new o.Uniform1f(w,s.u_camera_to_center_distance),u_viewport_size:new o.Uniform2f(w,s.u_viewport_size)}),debug:(w,s)=>({u_color:new o.UniformColor(w,s.u_color),u_matrix:new o.UniformMatrix4f(w,s.u_matrix),u_overlay:new o.Uniform1i(w,s.u_overlay),u_overlay_scale:new o.Uniform1f(w,s.u_overlay_scale)}),clippingMask:(w,s)=>({u_matrix:new o.UniformMatrix4f(w,s.u_matrix)}),heatmap:(w,s)=>({u_extrude_scale:new o.Uniform1f(w,s.u_extrude_scale),u_intensity:new o.Uniform1f(w,s.u_intensity),u_matrix:new o.UniformMatrix4f(w,s.u_matrix)}),heatmapTexture:(w,s)=>({u_matrix:new o.UniformMatrix4f(w,s.u_matrix),u_world:new o.Uniform2f(w,s.u_world),u_image:new o.Uniform1i(w,s.u_image),u_color_ramp:new o.Uniform1i(w,s.u_color_ramp),u_opacity:new o.Uniform1f(w,s.u_opacity)}),hillshade:(w,s)=>({u_matrix:new o.UniformMatrix4f(w,s.u_matrix),u_image:new o.Uniform1i(w,s.u_image),u_latrange:new o.Uniform2f(w,s.u_latrange),u_light:new o.Uniform2f(w,s.u_light),u_shadow:new o.UniformColor(w,s.u_shadow),u_highlight:new o.UniformColor(w,s.u_highlight),u_accent:new o.UniformColor(w,s.u_accent)}),hillshadePrepare:(w,s)=>({u_matrix:new o.UniformMatrix4f(w,s.u_matrix),u_image:new o.Uniform1i(w,s.u_image),u_dimension:new o.Uniform2f(w,s.u_dimension),u_zoom:new o.Uniform1f(w,s.u_zoom),u_unpack:new o.Uniform4f(w,s.u_unpack)}),line:(w,s)=>({u_matrix:new o.UniformMatrix4f(w,s.u_matrix),u_ratio:new o.Uniform1f(w,s.u_ratio),u_device_pixel_ratio:new o.Uniform1f(w,s.u_device_pixel_ratio),u_units_to_pixels:new o.Uniform2f(w,s.u_units_to_pixels)}),lineGradient:(w,s)=>({u_matrix:new o.UniformMatrix4f(w,s.u_matrix),u_ratio:new o.Uniform1f(w,s.u_ratio),u_device_pixel_ratio:new o.Uniform1f(w,s.u_device_pixel_ratio),u_units_to_pixels:new o.Uniform2f(w,s.u_units_to_pixels),u_image:new o.Uniform1i(w,s.u_image),u_image_height:new o.Uniform1f(w,s.u_image_height)}),linePattern:(w,s)=>({u_matrix:new o.UniformMatrix4f(w,s.u_matrix),u_texsize:new o.Uniform2f(w,s.u_texsize),u_ratio:new o.Uniform1f(w,s.u_ratio),u_device_pixel_ratio:new o.Uniform1f(w,s.u_device_pixel_ratio),u_image:new o.Uniform1i(w,s.u_image),u_units_to_pixels:new o.Uniform2f(w,s.u_units_to_pixels),u_scale:new o.Uniform3f(w,s.u_scale),u_fade:new o.Uniform1f(w,s.u_fade)}),lineSDF:(w,s)=>({u_matrix:new o.UniformMatrix4f(w,s.u_matrix),u_ratio:new o.Uniform1f(w,s.u_ratio),u_device_pixel_ratio:new o.Uniform1f(w,s.u_device_pixel_ratio),u_units_to_pixels:new o.Uniform2f(w,s.u_units_to_pixels),u_patternscale_a:new o.Uniform2f(w,s.u_patternscale_a),u_patternscale_b:new o.Uniform2f(w,s.u_patternscale_b),u_sdfgamma:new o.Uniform1f(w,s.u_sdfgamma),u_image:new o.Uniform1i(w,s.u_image),u_tex_y_a:new o.Uniform1f(w,s.u_tex_y_a),u_tex_y_b:new o.Uniform1f(w,s.u_tex_y_b),u_mix:new o.Uniform1f(w,s.u_mix)}),raster:(w,s)=>({u_matrix:new o.UniformMatrix4f(w,s.u_matrix),u_tl_parent:new o.Uniform2f(w,s.u_tl_parent),u_scale_parent:new o.Uniform1f(w,s.u_scale_parent),u_buffer_scale:new o.Uniform1f(w,s.u_buffer_scale),u_fade_t:new o.Uniform1f(w,s.u_fade_t),u_opacity:new o.Uniform1f(w,s.u_opacity),u_image0:new o.Uniform1i(w,s.u_image0),u_image1:new o.Uniform1i(w,s.u_image1),u_brightness_low:new o.Uniform1f(w,s.u_brightness_low),u_brightness_high:new o.Uniform1f(w,s.u_brightness_high),u_saturation_factor:new o.Uniform1f(w,s.u_saturation_factor),u_contrast_factor:new o.Uniform1f(w,s.u_contrast_factor),u_spin_weights:new o.Uniform3f(w,s.u_spin_weights)}),symbolIcon:(w,s)=>({u_is_size_zoom_constant:new o.Uniform1i(w,s.u_is_size_zoom_constant),u_is_size_feature_constant:new o.Uniform1i(w,s.u_is_size_feature_constant),u_size_t:new o.Uniform1f(w,s.u_size_t),u_size:new o.Uniform1f(w,s.u_size),u_camera_to_center_distance:new o.Uniform1f(w,s.u_camera_to_center_distance),u_pitch:new o.Uniform1f(w,s.u_pitch),u_rotate_symbol:new o.Uniform1i(w,s.u_rotate_symbol),u_aspect_ratio:new o.Uniform1f(w,s.u_aspect_ratio),u_fade_change:new o.Uniform1f(w,s.u_fade_change),u_matrix:new o.UniformMatrix4f(w,s.u_matrix),u_label_plane_matrix:new o.UniformMatrix4f(w,s.u_label_plane_matrix),u_coord_matrix:new o.UniformMatrix4f(w,s.u_coord_matrix),u_is_text:new o.Uniform1i(w,s.u_is_text),u_pitch_with_map:new o.Uniform1i(w,s.u_pitch_with_map),u_texsize:new o.Uniform2f(w,s.u_texsize),u_texture:new o.Uniform1i(w,s.u_texture)}),symbolSDF:(w,s)=>({u_is_size_zoom_constant:new o.Uniform1i(w,s.u_is_size_zoom_constant),u_is_size_feature_constant:new o.Uniform1i(w,s.u_is_size_feature_constant),u_size_t:new o.Uniform1f(w,s.u_size_t),u_size:new o.Uniform1f(w,s.u_size),u_camera_to_center_distance:new o.Uniform1f(w,s.u_camera_to_center_distance),u_pitch:new o.Uniform1f(w,s.u_pitch),u_rotate_symbol:new o.Uniform1i(w,s.u_rotate_symbol),u_aspect_ratio:new o.Uniform1f(w,s.u_aspect_ratio),u_fade_change:new o.Uniform1f(w,s.u_fade_change),u_matrix:new o.UniformMatrix4f(w,s.u_matrix),u_label_plane_matrix:new o.UniformMatrix4f(w,s.u_label_plane_matrix),u_coord_matrix:new o.UniformMatrix4f(w,s.u_coord_matrix),u_is_text:new o.Uniform1i(w,s.u_is_text),u_pitch_with_map:new o.Uniform1i(w,s.u_pitch_with_map),u_texsize:new o.Uniform2f(w,s.u_texsize),u_texture:new o.Uniform1i(w,s.u_texture),u_gamma_scale:new o.Uniform1f(w,s.u_gamma_scale),u_device_pixel_ratio:new o.Uniform1f(w,s.u_device_pixel_ratio),u_is_halo:new o.Uniform1i(w,s.u_is_halo)}),symbolTextAndIcon:(w,s)=>({u_is_size_zoom_constant:new o.Uniform1i(w,s.u_is_size_zoom_constant),u_is_size_feature_constant:new o.Uniform1i(w,s.u_is_size_feature_constant),u_size_t:new o.Uniform1f(w,s.u_size_t),u_size:new o.Uniform1f(w,s.u_size),u_camera_to_center_distance:new o.Uniform1f(w,s.u_camera_to_center_distance),u_pitch:new o.Uniform1f(w,s.u_pitch),u_rotate_symbol:new o.Uniform1i(w,s.u_rotate_symbol),u_aspect_ratio:new o.Uniform1f(w,s.u_aspect_ratio),u_fade_change:new o.Uniform1f(w,s.u_fade_change),u_matrix:new o.UniformMatrix4f(w,s.u_matrix),u_label_plane_matrix:new o.UniformMatrix4f(w,s.u_label_plane_matrix),u_coord_matrix:new o.UniformMatrix4f(w,s.u_coord_matrix),u_is_text:new o.Uniform1i(w,s.u_is_text),u_pitch_with_map:new o.Uniform1i(w,s.u_pitch_with_map),u_texsize:new o.Uniform2f(w,s.u_texsize),u_texsize_icon:new o.Uniform2f(w,s.u_texsize_icon),u_texture:new o.Uniform1i(w,s.u_texture),u_texture_icon:new o.Uniform1i(w,s.u_texture_icon),u_gamma_scale:new o.Uniform1f(w,s.u_gamma_scale),u_device_pixel_ratio:new o.Uniform1f(w,s.u_device_pixel_ratio),u_is_halo:new o.Uniform1i(w,s.u_is_halo)}),background:(w,s)=>({u_matrix:new o.UniformMatrix4f(w,s.u_matrix),u_opacity:new o.Uniform1f(w,s.u_opacity),u_color:new o.UniformColor(w,s.u_color)}),backgroundPattern:(w,s)=>({u_matrix:new o.UniformMatrix4f(w,s.u_matrix),u_opacity:new o.Uniform1f(w,s.u_opacity),u_image:new o.Uniform1i(w,s.u_image),u_pattern_tl_a:new o.Uniform2f(w,s.u_pattern_tl_a),u_pattern_br_a:new o.Uniform2f(w,s.u_pattern_br_a),u_pattern_tl_b:new o.Uniform2f(w,s.u_pattern_tl_b),u_pattern_br_b:new o.Uniform2f(w,s.u_pattern_br_b),u_texsize:new o.Uniform2f(w,s.u_texsize),u_mix:new o.Uniform1f(w,s.u_mix),u_pattern_size_a:new o.Uniform2f(w,s.u_pattern_size_a),u_pattern_size_b:new o.Uniform2f(w,s.u_pattern_size_b),u_scale_a:new o.Uniform1f(w,s.u_scale_a),u_scale_b:new o.Uniform1f(w,s.u_scale_b),u_pixel_coord_upper:new o.Uniform2f(w,s.u_pixel_coord_upper),u_pixel_coord_lower:new o.Uniform2f(w,s.u_pixel_coord_lower),u_tile_units_to_pixels:new o.Uniform1f(w,s.u_tile_units_to_pixels)}),terrain:(w,s)=>({u_matrix:new o.UniformMatrix4f(w,s.u_matrix),u_texture:new o.Uniform1i(w,s.u_texture),u_ele_delta:new o.Uniform1f(w,s.u_ele_delta)}),terrainDepth:(w,s)=>({u_matrix:new o.UniformMatrix4f(w,s.u_matrix),u_ele_delta:new o.Uniform1f(w,s.u_ele_delta)}),terrainCoords:(w,s)=>({u_matrix:new o.UniformMatrix4f(w,s.u_matrix),u_texture:new o.Uniform1i(w,s.u_texture),u_terrain_coords_id:new o.Uniform1f(w,s.u_terrain_coords_id),u_ele_delta:new o.Uniform1f(w,s.u_ele_delta)})};class ep{constructor(s,f,y){var v=(this.context=s).gl;this.buffer=v.createBuffer(),this.dynamicDraw=!!y,this.context.unbindVAO(),s.bindElementBuffer.set(this.buffer),v.bufferData(v.ELEMENT_ARRAY_BUFFER,f.arrayBuffer,this.dynamicDraw?v.DYNAMIC_DRAW:v.STATIC_DRAW),this.dynamicDraw||delete f.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(s){var f=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),f.bufferSubData(f.ELEMENT_ARRAY_BUFFER,0,s.arrayBuffer)}destroy(){var s=this.context.gl;this.buffer&&(s.deleteBuffer(this.buffer),delete this.buffer)}}const Fm={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Bm{constructor(s,f,y,v){this.length=f.length,this.attributes=y,this.itemSize=f.bytesPerElement,this.dynamicDraw=v,y=(this.context=s).gl,this.buffer=y.createBuffer(),s.bindVertexBuffer.set(this.buffer),y.bufferData(y.ARRAY_BUFFER,f.arrayBuffer,this.dynamicDraw?y.DYNAMIC_DRAW:y.STATIC_DRAW),this.dynamicDraw||delete f.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(s){if(s.length!==this.length)throw new Error(`Length of new data is ${s.length}, which doesn't match current length of `+this.length);var f=this.context.gl;this.bind(),f.bufferSubData(f.ARRAY_BUFFER,0,s.arrayBuffer)}enableAttributes(s,f){for(let v=0;v<this.attributes.length;v++){var y=this.attributes[v],y=f.attributes[y.name];y!==void 0&&s.enableVertexAttribArray(y)}}setVertexAttribPointers(s,f,y){for(let P=0;P<this.attributes.length;P++){var v=this.attributes[P],T=f.attributes[v.name];T!==void 0&&s.vertexAttribPointer(T,v.components,s[Fm[v.type]],!1,this.itemSize,v.offset+this.itemSize*(y||0))}}destroy(){var s=this.context.gl;this.buffer&&(s.deleteBuffer(this.buffer),delete this.buffer)}}const Iu=new WeakMap;function Um(w){var s;return Iu.has(w)?Iu.get(w):(s=(s=w.getParameter(w.VERSION))==null?void 0:s.startsWith("WebGL 2.0"),Iu.set(w,s),s)}class xr{constructor(s){this.gl=s.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(s){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class vR extends xr{getDefault(){return o.Color.transparent}set(s){var f=this.current;s.r===f.r&&s.g===f.g&&s.b===f.b&&s.a===f.a&&!this.dirty||(this.gl.clearColor(s.r,s.g,s.b,s.a),this.current=s,this.dirty=!1)}}class Pu extends xr{getDefault(){return 1}set(s){s===this.current&&!this.dirty||(this.gl.clearDepth(s),this.current=s,this.dirty=!1)}}class zm extends xr{getDefault(){return 0}set(s){s===this.current&&!this.dirty||(this.gl.clearStencil(s),this.current=s,this.dirty=!1)}}class Fa extends xr{getDefault(){return[!0,!0,!0,!0]}set(s){var f=this.current;s[0]===f[0]&&s[1]===f[1]&&s[2]===f[2]&&s[3]===f[3]&&!this.dirty||(this.gl.colorMask(s[0],s[1],s[2],s[3]),this.current=s,this.dirty=!1)}}class Ba extends xr{getDefault(){return!0}set(s){s===this.current&&!this.dirty||(this.gl.depthMask(s),this.current=s,this.dirty=!1)}}class P0 extends xr{getDefault(){return 255}set(s){s===this.current&&!this.dirty||(this.gl.stencilMask(s),this.current=s,this.dirty=!1)}}class tp extends xr{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(s){var f=this.current;s.func===f.func&&s.ref===f.ref&&s.mask===f.mask&&!this.dirty||(this.gl.stencilFunc(s.func,s.ref,s.mask),this.current=s,this.dirty=!1)}}class jm extends xr{getDefault(){var s=this.gl;return[s.KEEP,s.KEEP,s.KEEP]}set(s){var f=this.current;s[0]===f[0]&&s[1]===f[1]&&s[2]===f[2]&&!this.dirty||(this.gl.stencilOp(s[0],s[1],s[2]),this.current=s,this.dirty=!1)}}class jE extends xr{getDefault(){return!1}set(s){var f;s===this.current&&!this.dirty||(f=this.gl,s?f.enable(f.STENCIL_TEST):f.disable(f.STENCIL_TEST),this.current=s,this.dirty=!1)}}class VE extends xr{getDefault(){return[0,1]}set(s){var f=this.current;s[0]===f[0]&&s[1]===f[1]&&!this.dirty||(this.gl.depthRange(s[0],s[1]),this.current=s,this.dirty=!1)}}class ed extends xr{getDefault(){return!1}set(s){var f;s===this.current&&!this.dirty||(f=this.gl,s?f.enable(f.DEPTH_TEST):f.disable(f.DEPTH_TEST),this.current=s,this.dirty=!1)}}class np extends xr{getDefault(){return this.gl.LESS}set(s){s===this.current&&!this.dirty||(this.gl.depthFunc(s),this.current=s,this.dirty=!1)}}class rp extends xr{getDefault(){return!1}set(s){var f;s===this.current&&!this.dirty||(f=this.gl,s?f.enable(f.BLEND):f.disable(f.BLEND),this.current=s,this.dirty=!1)}}class Rc extends xr{getDefault(){var s=this.gl;return[s.ONE,s.ZERO]}set(s){var f=this.current;s[0]===f[0]&&s[1]===f[1]&&!this.dirty||(this.gl.blendFunc(s[0],s[1]),this.current=s,this.dirty=!1)}}class Vm extends xr{getDefault(){return o.Color.transparent}set(s){var f=this.current;s.r===f.r&&s.g===f.g&&s.b===f.b&&s.a===f.a&&!this.dirty||(this.gl.blendColor(s.r,s.g,s.b,s.a),this.current=s,this.dirty=!1)}}class td extends xr{getDefault(){return this.gl.FUNC_ADD}set(s){s===this.current&&!this.dirty||(this.gl.blendEquation(s),this.current=s,this.dirty=!1)}}class HE extends xr{getDefault(){return!1}set(s){var f;s===this.current&&!this.dirty||(f=this.gl,s?f.enable(f.CULL_FACE):f.disable(f.CULL_FACE),this.current=s,this.dirty=!1)}}class M0 extends xr{getDefault(){return this.gl.BACK}set(s){s===this.current&&!this.dirty||(this.gl.cullFace(s),this.current=s,this.dirty=!1)}}class Mu extends xr{getDefault(){return this.gl.CCW}set(s){s===this.current&&!this.dirty||(this.gl.frontFace(s),this.current=s,this.dirty=!1)}}class R0 extends xr{getDefault(){return null}set(s){s===this.current&&!this.dirty||(this.gl.useProgram(s),this.current=s,this.dirty=!1)}}class nd extends xr{getDefault(){return this.gl.TEXTURE0}set(s){s===this.current&&!this.dirty||(this.gl.activeTexture(s),this.current=s,this.dirty=!1)}}class rd extends xr{getDefault(){var s=this.gl;return[0,0,s.drawingBufferWidth,s.drawingBufferHeight]}set(s){var f=this.current;s[0]===f[0]&&s[1]===f[1]&&s[2]===f[2]&&s[3]===f[3]&&!this.dirty||(this.gl.viewport(s[0],s[1],s[2],s[3]),this.current=s,this.dirty=!1)}}class GE extends xr{getDefault(){return null}set(s){var f;s===this.current&&!this.dirty||((f=this.gl).bindFramebuffer(f.FRAMEBUFFER,s),this.current=s,this.dirty=!1)}}class k0 extends xr{getDefault(){return null}set(s){var f;s===this.current&&!this.dirty||((f=this.gl).bindRenderbuffer(f.RENDERBUFFER,s),this.current=s,this.dirty=!1)}}class _r extends xr{getDefault(){return null}set(s){var f;s===this.current&&!this.dirty||((f=this.gl).bindTexture(f.TEXTURE_2D,s),this.current=s,this.dirty=!1)}}class Hm extends xr{getDefault(){return null}set(s){var f;s===this.current&&!this.dirty||((f=this.gl).bindBuffer(f.ARRAY_BUFFER,s),this.current=s,this.dirty=!1)}}class bR extends xr{getDefault(){return null}set(s){var f=this.gl;f.bindBuffer(f.ELEMENT_ARRAY_BUFFER,s),this.current=s,this.dirty=!1}}class qE extends xr{getDefault(){return null}set(s){var f;s===this.current&&!this.dirty||(Um(f=this.gl)?f.bindVertexArray(s):(f=f.getExtension("OES_vertex_array_object"))!=null&&f.bindVertexArrayOES(s),this.current=s,this.dirty=!1)}}class ip extends xr{getDefault(){return 4}set(s){var f;s===this.current&&!this.dirty||((f=this.gl).pixelStorei(f.UNPACK_ALIGNMENT,s),this.current=s,this.dirty=!1)}}class wR extends xr{getDefault(){return!1}set(s){var f;s===this.current&&!this.dirty||((f=this.gl).pixelStorei(f.UNPACK_PREMULTIPLY_ALPHA_WEBGL,s),this.current=s,this.dirty=!1)}}class xR extends xr{getDefault(){return!1}set(s){var f;s===this.current&&!this.dirty||((f=this.gl).pixelStorei(f.UNPACK_FLIP_Y_WEBGL,s),this.current=s,this.dirty=!1)}}class Gm extends xr{constructor(s,f){super(s),this.context=s,this.parent=f}getDefault(){return null}}class ER extends Gm{setDirty(){this.dirty=!0}set(s){var f;s===this.current&&!this.dirty||(this.context.bindFramebuffer.set(this.parent),(f=this.gl).framebufferTexture2D(f.FRAMEBUFFER,f.COLOR_ATTACHMENT0,f.TEXTURE_2D,s,0),this.current=s,this.dirty=!1)}}class O0 extends Gm{set(s){var f;s===this.current&&!this.dirty||(this.context.bindFramebuffer.set(this.parent),(f=this.gl).framebufferRenderbuffer(f.FRAMEBUFFER,f.DEPTH_ATTACHMENT,f.RENDERBUFFER,s),this.current=s,this.dirty=!1)}}class qm extends Gm{set(s){var f;s===this.current&&!this.dirty||(this.context.bindFramebuffer.set(this.parent),(f=this.gl).framebufferRenderbuffer(f.FRAMEBUFFER,f.DEPTH_STENCIL_ATTACHMENT,f.RENDERBUFFER,s),this.current=s,this.dirty=!1)}}class $m{constructor(s,f,y,v,T){if(this.context=s,this.width=f,this.height=y,f=s.gl,y=this.framebuffer=f.createFramebuffer(),this.colorAttachment=new ER(s,y),v)this.depthAttachment=new(T?qm:O0)(s,y);else if(T)throw new Error("Stencil cannot be set without depth");if(f.checkFramebufferStatus(f.FRAMEBUFFER)!==f.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer is not complete")}destroy(){var s=this.context.gl,f=this.colorAttachment.get();f&&s.deleteTexture(f),this.depthAttachment&&(f=this.depthAttachment.get())&&s.deleteRenderbuffer(f),s.deleteFramebuffer(this.framebuffer)}}class vi{constructor(s,f,y){this.blendFunction=s,this.blendColor=f,this.mask=y}}vi.Replace=[1,0],vi.disabled=new vi(vi.Replace,o.Color.transparent,[!1,!1,!1,!1]),vi.unblended=new vi(vi.Replace,o.Color.transparent,[!0,!0,!0,!0]),vi.alphaBlended=new vi([1,771],o.Color.transparent,[!0,!0,!0,!0]);class Wm{constructor(s){var f,y;this.gl=s,this.clearColor=new vR(this),this.clearDepth=new Pu(this),this.clearStencil=new zm(this),this.colorMask=new Fa(this),this.depthMask=new Ba(this),this.stencilMask=new P0(this),this.stencilFunc=new tp(this),this.stencilOp=new jm(this),this.stencilTest=new jE(this),this.depthRange=new VE(this),this.depthTest=new ed(this),this.depthFunc=new np(this),this.blend=new rp(this),this.blendFunc=new Rc(this),this.blendColor=new Vm(this),this.blendEquation=new td(this),this.cullFace=new HE(this),this.cullFaceSide=new M0(this),this.frontFace=new Mu(this),this.program=new R0(this),this.activeTexture=new nd(this),this.viewport=new rd(this),this.bindFramebuffer=new GE(this),this.bindRenderbuffer=new k0(this),this.bindTexture=new _r(this),this.bindVertexBuffer=new Hm(this),this.bindElementBuffer=new bR(this),this.bindVertexArray=new qE(this),this.pixelStoreUnpack=new ip(this),this.pixelStoreUnpackPremultiplyAlpha=new wR(this),this.pixelStoreUnpackFlipY=new xR(this),this.extTextureFilterAnisotropic=s.getExtension("EXT_texture_filter_anisotropic")||s.getExtension("MOZ_EXT_texture_filter_anisotropic")||s.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=s.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=s.getParameter(s.MAX_TEXTURE_SIZE),Um(s)?(this.HALF_FLOAT=s.HALF_FLOAT,f=s.getExtension("EXT_color_buffer_half_float"),this.RGBA16F=(y=s.RGBA16F)!=null?y:f==null?void 0:f.RGBA16F_EXT,this.RGB16F=(y=s.RGB16F)!=null?y:f==null?void 0:f.RGB16F_EXT,s.getExtension("EXT_color_buffer_float")):(s.getExtension("EXT_color_buffer_half_float"),s.getExtension("OES_texture_half_float_linear"),y=s.getExtension("OES_texture_half_float"),this.HALF_FLOAT=y==null?void 0:y.HALF_FLOAT_OES)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(s,f){return new ep(this,s,f)}createVertexBuffer(s,f,y){return new Bm(this,s,f,y)}createRenderbuffer(s,f,y){var v=this.gl,T=v.createRenderbuffer();return this.bindRenderbuffer.set(T),v.renderbufferStorage(v.RENDERBUFFER,s,f,y),this.bindRenderbuffer.set(null),T}createFramebuffer(s,f,y,v){return new $m(this,s,f,y,v)}clear({color:s,depth:f,stencil:y}){var v=this.gl;let T=0;s&&(T|=v.COLOR_BUFFER_BIT,this.clearColor.set(s),this.colorMask.set([!0,!0,!0,!0])),f!==void 0&&(T|=v.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(f),this.depthMask.set(!0)),y!==void 0&&(T|=v.STENCIL_BUFFER_BIT,this.clearStencil.set(y),this.stencilMask.set(255)),v.clear(T)}setCullFace(s){s.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(s.mode),this.frontFace.set(s.frontFace))}setDepthMode(s){s.func!==this.gl.ALWAYS||s.mask?(this.depthTest.set(!0),this.depthFunc.set(s.func),this.depthMask.set(s.mask),this.depthRange.set(s.range)):this.depthTest.set(!1)}setStencilMode(s){s.test.func!==this.gl.ALWAYS||s.mask?(this.stencilTest.set(!0),this.stencilMask.set(s.mask),this.stencilOp.set([s.fail,s.depthFail,s.pass]),this.stencilFunc.set({func:s.test.func,ref:s.ref,mask:s.test.mask})):this.stencilTest.set(!1)}setColorMode(s){o.deepEqual(s.blendFunction,vi.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(s.blendFunction),this.blendColor.set(s.blendColor)),this.colorMask.set(s.mask)}createVertexArray(){var s;return Um(this.gl)?this.gl.createVertexArray():(s=this.gl.getExtension("OES_vertex_array_object"))==null?void 0:s.createVertexArrayOES()}deleteVertexArray(s){var f;return Um(this.gl)?this.gl.deleteVertexArray(s):(f=this.gl.getExtension("OES_vertex_array_object"))==null?void 0:f.deleteVertexArrayOES(s)}unbindVAO(){this.bindVertexArray.set(null)}}class ur{constructor(s,f,y){this.func=s,this.mask=f,this.range=y}}ur.ReadOnly=!1,ur.ReadWrite=!0,ur.disabled=new ur(519,ur.ReadOnly,[0,1]);class li{constructor(s,f,y,v,T,P){this.test=s,this.ref=f,this.mask=y,this.fail=v,this.depthFail=T,this.pass=P}}li.disabled=new li({func:519,mask:0},0,0,7680,7680,7680);class Wr{constructor(s,f,y){this.enable=s,this.mode=f,this.frontFace=y}}Wr.disabled=new Wr(!1,1029,2305),Wr.backCCW=new Wr(!0,1029,2305);let Ym;function $E(w,s,f,y,v,T,P){var R=w.context,N=R.gl,G=w.useProgram("collisionBox"),Z=[];let j=0,X=0;for(let bn=0;bn<y.length;bn++){var ge=y[bn],ye=s.getTile(ge),be=ye.getBucket(f);if(be){let Zt=ge.posMatrix;v[0]===0&&v[1]===0||(Zt=w.translatePosMatrix(ge.posMatrix,ye,v,T));var ve,Fe,Ue=P?be.textCollisionBox:be.iconCollisionBox,ze=be.collisionCircleArray;0<ze.length&&(ve=o.create(),Fe=Zt,o.mul(ve,be.placementInvProjMatrix,w.transform.glCoordMatrix),o.mul(ve,ve,be.placementViewportMatrix),Z.push({circleArray:ze,circleOffset:X,transform:Fe,invTransform:ve,coord:ge}),j+=ze.length/4,X=j),Ue&&G.draw(R,N.LINES,ur.disabled,li.disabled,w.colorModeForRenderPass(),Wr.disabled,yt(Zt,w.transform,ye),w.style.map.terrain&&w.style.map.terrain.getTerrainData(ge),f.id,Ue.layoutVertexBuffer,Ue.indexBuffer,Ue.segments,null,w.transform.zoom,null,null,Ue.collisionVertexBuffer)}}if(P&&Z.length){var Qe=w.useProgram("collisionCircle"),Je=new o.CollisionCircleLayoutArray;Je.resize(4*j),Je._trim();let bn=0;for(const Zt of Z)for(let Ct=0;Ct<Zt.circleArray.length/4;Ct++){var _t=4*Ct,Xe=Zt.circleArray[0+_t],ct=Zt.circleArray[1+_t],it=Zt.circleArray[2+_t],_t=Zt.circleArray[3+_t];Je.emplace(bn++,Xe,ct,it,_t,0),Je.emplace(bn++,Xe,ct,it,_t,1),Je.emplace(bn++,Xe,ct,it,_t,2),Je.emplace(bn++,Xe,ct,it,_t,3)}(!Ym||Ym.length<2*j)&&(Ym=function(Zt){var Ct=2*Zt,cn=new o.QuadTriangleArray;cn.resize(Ct),cn._trim();for(let $t=0;$t<Ct;$t++){var Cn=6*$t;cn.uint16[0+Cn]=4*$t+0,cn.uint16[1+Cn]=4*$t+1,cn.uint16[2+Cn]=4*$t+2,cn.uint16[3+Cn]=4*$t+2,cn.uint16[4+Cn]=4*$t+3,cn.uint16[5+Cn]=4*$t+0}return cn}(j));var Dt=R.createIndexBuffer(Ym,!0),Yt=R.createVertexBuffer(Je,o.collisionCircleLayout.members,!0);for(const Zt of Z){var vn=Jt(Zt.transform,Zt.invTransform,w.transform);Qe.draw(R,N.TRIANGLES,ur.disabled,li.disabled,w.colorModeForRenderPass(),Wr.disabled,vn,w.style.map.terrain&&w.style.map.terrain.getTerrainData(Zt.coord),f.id,Yt,Dt,o.SegmentVector.simpleSegment(0,2*Zt.circleOffset,Zt.circleArray.length,Zt.circleArray.length/2),null,w.transform.zoom,null,null,null)}Yt.destroy(),Dt.destroy()}}const L0=o.identity(new Float32Array(16));function TR(w,s,f,y,v){if(w.renderPass==="translucent"){var T=li.disabled,P=w.colorModeForRenderPass();if(f._unevaluatedLayout.hasValue("text-variable-anchor")||f._unevaluatedLayout.hasValue("text-variable-anchor-offset")){var R=y,N=w,G=f,Z=s,j=f.layout.get("text-rotation-alignment"),X=f.layout.get("text-pitch-alignment"),ge=v,ye=N.transform,be=j==="map",ve=X==="map";for(const ct of R){var Fe,Ue,ze,Qe,Je=Z.getTile(ct),Xe=Je.getBucket(G);Xe&&Xe.text&&Xe.text.segments.get().length&&(Fe=Xe.textSizeData,Fe=o.evaluateSizeForZoom(Fe,ye.zoom),Ue=tn(Je,1,N.transform.zoom),Ue=Ar(ct.posMatrix,ve,be,N.transform,Ue),ze=G.layout.get("icon-text-fit")!=="none"&&Xe.hasIconData(),Fe)&&(Je=Math.pow(2,ye.zoom-Je.tileID.overscaledZ),Qe=N.style.map.terrain?(it,_t)=>N.style.map.terrain.getElevation(ct,it,_t):null,function(it,_t,Dt,Yt,vn,bn,Zt,Ct,cn,Cn,$t){var tr=it.text.placedSymbolArray,Rr=it.text.dynamicLayoutVertexArray,Jn=it.icon.dynamicLayoutVertexArray,ar={};Rr.clear();for(let Vr=0;Vr<tr.length;Vr++){var Ln=tr.get(Vr),kr=it.allowVerticalPlacement&&!Ln.placedOrientation,kr=Ln.hidden||!Ln.crossTileID||kr?null:Yt[Ln.crossTileID];if(kr){var sr=new o.Point(Ln.anchorX,Ln.anchorY),Er=V(sr,Dt?Zt:bn,$t),To=$(vn.cameraToCenterDistance,Er.signedDistanceFromCamera);let Yr=o.evaluateSizeForFeature(it.textSizeData,cn,Ln)*To/o.ONE_EM;Dt&&(Yr*=it.tilePixelRatio/Ct);var{width:To,height:kr,anchor:So,textOffset:ro,textBoxScale:Ls}=kr,So=function(Xr,Li,Tl,oc,Ui,ac){var{horizontalAlign:Xr,verticalAlign:Sl}=o.getAnchorAlignment(Xr),Xr=-(Xr-.5)*Li,Li=-(Sl-.5)*Tl;return new o.Point((Xr/Ui+oc[0])*ac,(Li/Ui+oc[1])*ac)}(So,To,kr,ro,Ls,Yr),ui=Dt?V(sr.add(So),bn,$t).point:Er.point.add(_t?So.rotate(-vn.angle):So),xi=it.allowVerticalPlacement&&Ln.placedOrientation===o.WritingMode.vertical?Math.PI/2:0;for(let hi=0;hi<Ln.numGlyphs;hi++)o.addDynamicAttributes(Rr,ui,xi);Cn&&0<=Ln.associatedIconIndex&&(ar[Ln.associatedIconIndex]={shiftedAnchor:ui,angle:xi})}else st(Ln.numGlyphs,Rr)}if(Cn){Jn.clear();var ic=it.icon.placedSymbolArray;for(let Vr=0;Vr<ic.length;Vr++){var jr=ic.get(Vr);if(jr.hidden)st(jr.numGlyphs,Jn);else{var Co=ar[Vr];if(Co)for(let Yr=0;Yr<jr.numGlyphs;Yr++)o.addDynamicAttributes(Jn,Co.shiftedAnchor,Co.angle);else st(jr.numGlyphs,Jn)}}it.icon.dynamicLayoutVertexBuffer.updateData(Jn)}it.text.dynamicLayoutVertexBuffer.updateData(Rr)}(Xe,be,ve,ge,ye,Ue,ct.posMatrix,Je,Fe,ze,Qe))}}f.paint.get("icon-opacity").constantOr(1)!==0&&Km(w,s,f,y,!1,f.paint.get("icon-translate"),f.paint.get("icon-translate-anchor"),f.layout.get("icon-rotation-alignment"),f.layout.get("icon-pitch-alignment"),f.layout.get("icon-keep-upright"),T,P),f.paint.get("text-opacity").constantOr(1)!==0&&Km(w,s,f,y,!0,f.paint.get("text-translate"),f.paint.get("text-translate-anchor"),f.layout.get("text-rotation-alignment"),f.layout.get("text-pitch-alignment"),f.layout.get("text-keep-upright"),T,P),s.map.showCollisionBoxes&&($E(w,s,f,y,f.paint.get("text-translate"),f.paint.get("text-translate-anchor"),!0),$E(w,s,f,y,f.paint.get("icon-translate"),f.paint.get("icon-translate-anchor"),!1))}}function Km(w,s,f,y,v,T,P,R,N,G,Z,j){var X=w.context,ge=X.gl,ye=w.transform,be=R==="map",ve=N==="map",Fe=R!=="viewport"&&f.layout.get("symbol-placement")!=="point",Ue=be&&!ve&&!Fe,ze=!f.layout.get("symbol-sort-key").isConstant();let Qe=!1;var Je=w.depthModeForSublayer(0,ur.ReadOnly),Xe=f._unevaluatedLayout.hasValue("text-variable-anchor")||f._unevaluatedLayout.hasValue("text-variable-anchor-offset"),ct=[];for(const Li of y){var it=s.getTile(Li),_t=it.getBucket(f);if(_t){var Dt=v?_t.text:_t.icon;if(Dt&&Dt.segments.get().length&&Dt.hasVisibleVertices){var Cn=Dt.programConfigurations.get(f.id),Yt=v||_t.sdfIcons,vn=v?_t.textSizeData:_t.iconSizeData,cn=ve||ye.pitch!==0,bn=w.useProgram((Zt=Yt,bn=v,_t.iconsInText&&bn?"symbolTextAndIcon":Zt?"symbolSDF":"symbolIcon"),Cn),Zt=o.evaluateSizeForZoom(vn,ye.zoom),Ct=w.style.map.terrain&&w.style.map.terrain.getTerrainData(Li);let sc,cc=[0,0],dd,Cl,cb=null,bT;v?(dd=it.glyphAtlasTexture,Cl=ge.LINEAR,sc=it.glyphAtlasTexture.size,_t.iconsInText&&(cc=it.imageAtlasTexture.size,cb=it.imageAtlasTexture,Cn=vn.kind==="composite"||vn.kind==="camera",bT=cn||w.options.rotating||w.options.zooming||Cn?ge.LINEAR:ge.NEAREST)):(Cn=f.layout.get("icon-size").constantOr(0)!==1||_t.iconsNeedLinear,dd=it.imageAtlasTexture,Cl=Yt||w.options.rotating||w.options.zooming||Cn||cn?ge.LINEAR:ge.NEAREST,sc=it.imageAtlasTexture.size);var Cn=tn(it,1,w.transform.zoom),cn=Ar(Li.posMatrix,ve,be,w.transform,Cn),Cn=oe(Li.posMatrix,ve,be,w.transform,Cn),$t=Xe&&_t.hasTextData(),$t=f.layout.get("icon-text-fit")!=="none"&&$t&&_t.hasIconData();if(Fe){var tr=w.style.map.terrain?(Ns,fd)=>w.style.map.terrain.getElevation(Li,Ns,fd):null,Rr=f.layout.get("text-rotation-alignment")==="map";{Jn=void 0,ar=void 0,Ln=void 0,kr=void 0,sr=void 0,Er=void 0,To=void 0,ro=void 0,Ls=void 0,So=void 0,ui=void 0,xi=void 0,ic=void 0,jr=void 0,Co=void 0,Vr=void 0,Yr=void 0,Ui=void 0,hi=void 0,io=void 0,Fo=void 0,Tl=void 0,oc=void 0;var Jn=_t,ar=Li.posMatrix,Ln=w,kr=v,sr=cn,Er=Cn,To=ve,ro=G,Ls=Rr,So=tr,ui=kr?Jn.textSizeData:Jn.iconSizeData,xi=o.evaluateSizeForZoom(ui,Ln.transform.zoom),ic=[256/Ln.width*2+1,256/Ln.height*2+1],jr=(kr?Jn.text:Jn.icon).dynamicLayoutVertexArray,Co=(jr.clear(),Jn.lineVertexArray),Vr=(kr?Jn.text:Jn.icon).placedSymbolArray,Yr=Ln.transform.width/Ln.transform.height;let Ns=!1;for(let fd=0;fd<Vr.length;fd++){var Fo,hi,io,Tl,oc,Ui=Vr.get(fd);if(Ui.hidden||Ui.writingMode===o.WritingMode.vertical&&!Ns)st(Ui.numGlyphs,jr);else{Ns=!1;let Lc;So?(Lc=[Ui.anchorX,Ui.anchorY,So(Ui.anchorX,Ui.anchorY),1],o.transformMat4(Lc,Lc,ar)):St(Lc=[Ui.anchorX,Ui.anchorY,0,1],Lc,ar),io=Lc,hi=ic,Fo=void 0,Fo=io[0]/io[3],io=io[1]/io[3],(!(Fo>=-hi[0]&&Fo<=hi[0]&&io>=-hi[1]&&io<=hi[1])||(Fo=Lc[3],io=$(Ln.transform.cameraToCenterDistance,Fo),hi=o.evaluateSizeForFeature(ui,xi,Ui),Fo=To?hi/io:hi*io,io=V(hi=new o.Point(Ui.anchorX,Ui.anchorY),sr,So).point,oc=Oe(Ui,Fo,!(Tl={projections:{},offsets:{}}),ro,ar,sr,Er,Jn.glyphOffsetArray,Co,jr,io,hi,Tl,Yr,Ls,So),Ns=oc.useVertical,oc.notEnoughRoom)||Ns||oc.needsFlipping&&Oe(Ui,Fo,!0,ro,ar,sr,Er,Jn.glyphOffsetArray,Co,jr,io,hi,Tl,Yr,Ls,So).notEnoughRoom)&&st(Ui.numGlyphs,jr)}}(kr?Jn.text:Jn.icon).dynamicLayoutVertexBuffer.updateData(jr)}}Rr=w.translatePosMatrix(Li.posMatrix,it,T,P),tr=Fe||v&&Xe||$t?L0:cn,kr=w.translatePosMatrix(Cn,it,T,P,!0),$t=Yt&&f.paint.get(v?"text-halo-width":"icon-halo-width").constantOr(1)!==0;var ac={program:bn,buffers:Dt,uniformValues:Yt?_t.iconsInText?_R(vn.kind,Zt,Ue,ve,w,Rr,tr,kr,sc,cc):Da(vn.kind,Zt,Ue,ve,w,Rr,tr,kr,v,sc,!0):Jf(vn.kind,Zt,Ue,ve,w,Rr,tr,kr,v,sc),atlasTexture:dd,atlasTextureIcon:cb,atlasInterpolation:Cl,atlasInterpolationIcon:bT,isSDF:Yt,hasHalo:$t};if(ze&&_t.canOverlap){Qe=!0;for(const Ns of Dt.segments.get())ct.push({segments:new o.SegmentVector([Ns]),sortKey:Ns.sortKey,state:ac,terrainData:Ct})}else ct.push({segments:Dt.segments,sortKey:0,state:ac,terrainData:Ct})}}}Qe&&ct.sort((Li,sc)=>Li.sortKey-sc.sortKey);for(const Li of ct){var Sl,Xr=Li.state;X.activeTexture.set(ge.TEXTURE0),Xr.atlasTexture.bind(Xr.atlasInterpolation,ge.CLAMP_TO_EDGE),Xr.atlasTextureIcon&&(X.activeTexture.set(ge.TEXTURE1),Xr.atlasTextureIcon)&&Xr.atlasTextureIcon.bind(Xr.atlasInterpolationIcon,ge.CLAMP_TO_EDGE),Xr.isSDF&&(Sl=Xr.uniformValues,Xr.hasHalo&&(Sl.u_is_halo=1,WE(Xr.buffers,Li.segments,f,w,Xr.program,Je,Z,j,Sl,Li.terrainData)),Sl.u_is_halo=0),WE(Xr.buffers,Li.segments,f,w,Xr.program,Je,Z,j,Xr.uniformValues,Li.terrainData)}}function WE(w,s,f,y,v,T,P,R,N,G){var Z=y.context,j=Z.gl;v.draw(Z,j.TRIANGLES,T,P,R,Wr.disabled,N,G,f.id,w.layoutVertexBuffer,w.indexBuffer,s,f.paint,y.transform.zoom,w.programConfigurations.get(f.id),w.dynamicLayoutVertexBuffer,w.opacityVertexBuffer)}function Zm(w,s,f,y){if(w.renderPass==="translucent"){var v=f.paint.get("circle-opacity"),T=f.paint.get("circle-stroke-width"),P=f.paint.get("circle-stroke-opacity"),R=!f.layout.get("circle-sort-key").isConstant();if(v.constantOr(1)!==0||T.constantOr(1)!==0&&P.constantOr(1)!==0){var N=w.context,G=N.gl,Z=w.depthModeForSublayer(0,ur.ReadOnly),j=li.disabled,X=w.colorModeForRenderPass(),ge=[];for(let Zt=0;Zt<y.length;Zt++){var ye=y[Zt],be=s.getTile(ye),ve=be.getBucket(f);if(ve){var Fe=ve.programConfigurations.get(f.id),Ue=w.useProgram("circle",Fe),ze=ve.layoutVertexBuffer,Qe=ve.indexBuffer,Je=w.style.map.terrain&&w.style.map.terrain.getTerrainData(ye),Xe={programConfiguration:Fe,program:Ue,layoutVertexBuffer:ze,indexBuffer:Qe,uniformValues:((Ct,cn,Cn,$t)=>{var tr,Rr=Ct.transform;let Jn,ar;return ar=$t.paint.get("circle-pitch-alignment")==="map"?(tr=tn(Cn,1,Rr.zoom),Jn=!0,[tr,tr]):(Jn=!1,Rr.pixelsToGLUnits),{u_camera_to_center_distance:Rr.cameraToCenterDistance,u_scale_with_map:+($t.paint.get("circle-pitch-scale")==="map"),u_matrix:Ct.translatePosMatrix(cn.posMatrix,Cn,$t.paint.get("circle-translate"),$t.paint.get("circle-translate-anchor")),u_pitch_with_map:+Jn,u_device_pixel_ratio:Ct.pixelRatio,u_extrude_scale:ar}})(w,ye,be,f),terrainData:Je};if(R)for(const Ct of ve.segments.get())ge.push({segments:new o.SegmentVector([Ct]),sortKey:Ct.sortKey,state:Xe});else ge.push({segments:ve.segments,sortKey:0,state:Xe})}}R&&ge.sort((Zt,Ct)=>Zt.sortKey-Ct.sortKey);for(const Zt of ge){var{programConfiguration:ct,program:it,layoutVertexBuffer:_t,indexBuffer:Dt,uniformValues:Yt,terrainData:vn}=Zt.state,bn=Zt.segments;it.draw(N,G.TRIANGLES,Z,j,X,Wr.disabled,Yt,vn,f.id,_t,Dt,bn,f.paint,w.transform.zoom,ct)}}}}function N0(w,s,f,y){if(f.paint.get("heatmap-opacity")!==0){if(w.renderPass==="offscreen"){var v=w.context,T=v.gl,P=li.disabled,R=new vi([T.ONE,T.ONE],o.Color.transparent,[!0,!0,!0,!0]);{var N=v,G=w,Z=f,j=N.gl;N.activeTexture.set(j.TEXTURE1),N.viewport.set([0,0,G.width/4,G.height/4]);let ze=Z.heatmapFbo;ze?(j.bindTexture(j.TEXTURE_2D,ze.colorAttachment.get()),N.bindFramebuffer.set(ze.framebuffer)):(Ue=j.createTexture(),j.bindTexture(j.TEXTURE_2D,Ue),j.texParameteri(j.TEXTURE_2D,j.TEXTURE_WRAP_S,j.CLAMP_TO_EDGE),j.texParameteri(j.TEXTURE_2D,j.TEXTURE_WRAP_T,j.CLAMP_TO_EDGE),j.texParameteri(j.TEXTURE_2D,j.TEXTURE_MIN_FILTER,j.LINEAR),j.texParameteri(j.TEXTURE_2D,j.TEXTURE_MAG_FILTER,j.LINEAR),ze=Z.heatmapFbo=N.createFramebuffer(G.width/4,G.height/4,!1,!1),function(Dt,Je,Xe,ct){var it=Dt.gl,_t=(_t=Dt.HALF_FLOAT)!=null?_t:it.UNSIGNED_BYTE,Dt=(Dt=Dt.RGBA16F)!=null?Dt:it.RGBA;it.texImage2D(it.TEXTURE_2D,0,Dt,Je.width/4,Je.height/4,0,it.RGBA,_t,null),ct.colorAttachment.set(Xe)}(N,G,Ue,ze))}v.clear({color:o.Color.transparent});for(let ze=0;ze<y.length;ze++){var X,ge,ye,be,ve,Fe=y[ze];s.hasRenderableParent(Fe)||(ge=(X=s.getTile(Fe)).getBucket(f))&&(ye=ge.programConfigurations.get(f.id),be=w.useProgram("heatmap",ye),ve=w.transform.zoom,be.draw(v,T.TRIANGLES,ur.disabled,P,R,Wr.disabled,(be=Fe.posMatrix,Fe=X,X=ve,ve=f.paint.get("heatmap-intensity"),{u_matrix:be,u_extrude_scale:tn(Fe,1,X),u_intensity:ve}),null,f.id,ge.layoutVertexBuffer,ge.indexBuffer,ge.segments,f.paint,w.transform.zoom,ye))}v.viewport.set([0,0,w.width,w.height])}else if(w.renderPass==="translucent"){w.context.setColorMode(w.colorModeForRenderPass());var j=w,Z=f,N=j.context,G=N.gl,Ue=Z.heatmapFbo;if(Ue){N.activeTexture.set(G.TEXTURE0),G.bindTexture(G.TEXTURE_2D,Ue.colorAttachment.get()),N.activeTexture.set(G.TEXTURE1);let ct=Z.colorRampTexture;(ct=ct||(Z.colorRampTexture=new ue(N,Z.colorRamp,G.RGBA))).bind(G.LINEAR,G.CLAMP_TO_EDGE),j.useProgram("heatmapTexture").draw(N,G.TRIANGLES,ur.disabled,li.disabled,j.colorModeForRenderPass(),Wr.disabled,Wi(j,Z,0,1),null,Z.id,j.viewportBuffer,j.quadTriangleIndexBuffer,j.viewportSegments,Z.paint,j.transform.zoom)}}}}function YE(w,s,f,y){if(w.renderPass==="translucent"){var v=f.paint.get("line-opacity"),T=f.paint.get("line-width");if(v.constantOr(1)!==0&&T.constantOr(1)!==0){var P,R,N,G,Z,j,X,ge,ye,be,ve=w.depthModeForSublayer(0,ur.ReadOnly),Fe=w.colorModeForRenderPass(),Ue=f.paint.get("line-dasharray"),ze=f.paint.get("line-pattern"),Qe=ze.constantOr(1),Je=f.paint.get("line-gradient"),Xe=f.getCrossfadeParameters(),ct=Qe?"linePattern":Ue?"lineSDF":Je?"lineGradient":"line",it=w.context,_t=it.gl;let Rr=!0;for(const Jn of y){var Dt=s.getTile(Jn);if(!Qe||Dt.patternsLoaded()){var Yt=Dt.getBucket(f);if(Yt){var vn,bn,Zt=Yt.programConfigurations.get(f.id),cn=w.context.program.get(),Ct=w.useProgram(ct,Zt),cn=Rr||Ct.program!==cn,Cn=w.style.map.terrain&&w.style.map.terrain.getTerrainData(Jn),$t=ze.constantOr(null),$t=($t&&Dt.imageAtlas&&(vn=(bn=Dt.imageAtlas).patternPositions[$t.to.toString()],bn=bn.patternPositions[$t.from.toString()],vn)&&bn&&Zt.setConstantPatternPositions(vn,bn),Cn?Jn:null),tr=Qe?(vn=Dt,bn=f,X=Xe,ge=$t,be=ye=void 0,ye=(j=w).transform,be=UE(vn,ye),{u_matrix:zE(j,vn,bn,ge),u_texsize:vn.imageAtlasTexture.size,u_ratio:1/tn(vn,1,ye.zoom),u_device_pixel_ratio:j.pixelRatio,u_image:0,u_scale:[be,X.fromScale,X.toScale],u_fade:X.t,u_units_to_pixels:[1/ye.pixelsToGLUnits[0],1/ye.pixelsToGLUnits[1]]}):Ue?(ge=Dt,j=f,be=Ue,X=Xe,ye=$t,Z=G=tr=G=R=N=R=void 0,R=(P=w).transform,N=P.lineAtlas,R=UE(ge,R),G=j.layout.get("line-cap")==="round",tr=N.getDash(be.from,G),be=N.getDash(be.to,G),G=tr.width*X.fromScale,Z=be.width*X.toScale,o.extend(Lm(P,ge,j,ye),{u_patternscale_a:[R/G,-tr.height/2],u_patternscale_b:[R/Z,-be.height/2],u_sdfgamma:N.width/(256*Math.min(G,Z)*P.pixelRatio)/2,u_image:0,u_tex_y_a:tr.y,u_tex_y_b:be.y,u_mix:X.t})):Je?(R=w,N=Dt,G=f,Z=Yt.lineClipsArray.length,P=$t,o.extend(Lm(R,N,G,P),{u_image:0,u_image_height:Z})):Lm(w,Dt,f,$t);if(Qe)it.activeTexture.set(_t.TEXTURE0),Dt.imageAtlasTexture.bind(_t.LINEAR,_t.CLAMP_TO_EDGE),Zt.updatePaintBuffers(Xe);else if(Ue&&(cn||w.lineAtlas.dirty))it.activeTexture.set(_t.TEXTURE0),w.lineAtlas.bind(it);else if(Je){$t=Yt.gradients[f.id];let ar=$t.texture;if(f.gradientVersion!==$t.version){let Ln=256;f.stepInterpolant&&(Dt=s.getSource().maxzoom,cn=Jn.canonical.z===Dt?Math.ceil(1<<w.transform.maxZoom-Jn.canonical.z):1,Dt=Yt.maxLineLength/o.EXTENT,Ln=o.clamp(o.nextPowerOfTwo(1024*Dt*cn),256,it.maxTextureSize)),$t.gradient=o.renderColorRamp({expression:f.gradientExpression(),evaluationKey:"lineProgress",resolution:Ln,image:$t.gradient||void 0,clips:Yt.lineClipsArray}),$t.texture?$t.texture.update($t.gradient):$t.texture=new ue(it,$t.gradient,_t.RGBA),$t.version=f.gradientVersion,ar=$t.texture}it.activeTexture.set(_t.TEXTURE0),ar.bind(f.stepInterpolant?_t.NEAREST:_t.LINEAR,_t.CLAMP_TO_EDGE)}Ct.draw(it,_t.TRIANGLES,ve,w.stencilModeForClipping(Jn),Fe,Wr.disabled,tr,Cn,f.id,Yt.layoutVertexBuffer,Yt.indexBuffer,Yt.segments,f.paint,w.transform.zoom,Zt,Yt.layoutVertexBuffer2),Rr=!1}}}}}}function D0(w,s,f,y,v){if(f&&y&&y.imageAtlas){y=y.imageAtlas.patternPositions;let T=y[f.to.toString()],P=y[f.from.toString()];!T&&P&&(T=P),!P&&T&&(P=T),T&&P||(f=v.getPaintProperty(s),T=y[f],P=y[f]),T&&P&&w.setConstantPatternPositions(T,P)}}function Xm(w,s,f,y){var v,T,P=f.paint.get("fill-color"),R=f.paint.get("fill-opacity");R.constantOr(1)!==0&&(v=w.colorModeForRenderPass(),T=f.paint.get("fill-pattern"),T=w.opaquePassEnabledForLayer()&&!T.constantOr(1)&&P.constantOr(o.Color.transparent).a===1&&R.constantOr(0)===1?"opaque":"translucent",w.renderPass===T&&(P=w.depthModeForSublayer(1,w.renderPass==="opaque"?ur.ReadWrite:ur.ReadOnly),KE(w,s,f,y,P,v,!1)),w.renderPass==="translucent")&&f.paint.get("fill-antialias")&&(R=w.depthModeForSublayer(f.getPaintProperty("fill-outline-color")?2:0,ur.ReadOnly),KE(w,s,f,y,R,v,!0))}function KE(w,s,f,y,v,T,P){var R=w.context.gl,N="fill-pattern",G=f.paint.get(N),Z=G&&G.constantOr(1),j=f.getCrossfadeParameters();let X,ge,ye,be,ve;X=P?(ge=Z&&!f.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",R.LINES):(ge=Z?"fillPattern":"fill",R.TRIANGLES);var Fe=G.constantOr(null);for(const _t of y){var Ue,ze,Qe,Je,Xe,ct,it=s.getTile(_t);Z&&!it.patternsLoaded()||(Ue=it.getBucket(f))&&(ze=Ue.programConfigurations.get(f.id),Qe=w.useProgram(ge,ze),Je=w.style.map.terrain&&w.style.map.terrain.getTerrainData(_t),Z&&(w.context.activeTexture.set(R.TEXTURE0),it.imageAtlasTexture.bind(R.LINEAR,R.CLAMP_TO_EDGE),ze.updatePaintBuffers(j)),D0(ze,N,Fe,it,f),Xe=((Je?_t:null)||_t).posMatrix,Xe=w.translatePosMatrix(Xe,it,f.paint.get("fill-translate"),f.paint.get("fill-translate-anchor")),ye=P?(be=Ue.indexBuffer2,ve=Ue.segments2,ct=[R.drawingBufferWidth,R.drawingBufferHeight],ge==="fillOutlinePattern"&&Z?qe(Xe,w,j,it,ct):Se(Xe,ct)):(be=Ue.indexBuffer,ve=Ue.segments,Z?le(Xe,w,j,it):te(Xe)),Qe.draw(w.context,X,v,w.stencilModeForClipping(_t),T,Wr.disabled,ye,Je,f.id,Ue.layoutVertexBuffer,be,ve,f.paint,w.transform.zoom,ze))}}function ZE(w,s,f,y){var v,T=f.paint.get("fill-extrusion-opacity");T!==0&&w.renderPass==="translucent"&&(v=new ur(w.context.gl.LEQUAL,ur.ReadWrite,w.depthRangeFor3D),T!==1||f.paint.get("fill-extrusion-pattern").constantOr(1)?(bi(w,s,f,y,v,li.disabled,vi.disabled),bi(w,s,f,y,v,w.stencilModeFor3D(),w.colorModeForRenderPass())):(T=w.colorModeForRenderPass(),bi(w,s,f,y,v,li.disabled,T)))}function bi(w,s,f,y,v,T,P){var R=w.context,N=R.gl,G="fill-extrusion-pattern",Z=f.paint.get(G),j=Z.constantOr(1),X=f.getCrossfadeParameters(),ge=f.paint.get("fill-extrusion-opacity"),ye=Z.constantOr(null);for(const Xe of y){var be,ve,Fe,Ue,ze,Qe=s.getTile(Xe),Je=Qe.getBucket(f);Je&&(be=w.style.map.terrain&&w.style.map.terrain.getTerrainData(Xe),ve=Je.programConfigurations.get(f.id),Fe=w.useProgram(j?"fillExtrusionPattern":"fillExtrusion",ve),j&&(w.context.activeTexture.set(N.TEXTURE0),Qe.imageAtlasTexture.bind(N.LINEAR,N.CLAMP_TO_EDGE),ve.updatePaintBuffers(X)),D0(ve,G,ye,Qe,f),Ue=w.translatePosMatrix(Xe.posMatrix,Qe,f.paint.get("fill-extrusion-translate"),f.paint.get("fill-extrusion-translate-anchor")),ze=f.paint.get("fill-extrusion-vertical-gradient"),Qe=j?rc(Ue,w,ze,ge,Xe,X,Qe):Cu(Ue,w,ze,ge),Fe.draw(R,R.gl.TRIANGLES,v,T,P,Wr.backCCW,Qe,be,f.id,Je.layoutVertexBuffer,Je.indexBuffer,Je.segments,f.paint,w.transform.zoom,ve,w.style.map.terrain&&Je.centroidVertexBuffer))}}function Ru(w,s,f,y){if(w.renderPass==="offscreen"||w.renderPass==="translucent"){var v=w.context,T=w.depthModeForSublayer(0,ur.ReadOnly),P=w.colorModeForRenderPass(),[R,y]=w.renderPass==="translucent"?w.stencilConfigForOverlap(y):[{},y];for(const Xe of y){var N=s.getTile(Xe);if(N.needsHillshadePrepare!==void 0&&N.needsHillshadePrepare&&w.renderPass==="offscreen"){Qe=ze=Ue=Fe=ve=be=ye=ge=X=j=Z=G=void 0;var G=w,Z=N,j=f,X=T,ge=li.disabled,ye=P,be=G.context,ve=be.gl,Fe=Z.dem;if(Fe&&Fe.data){var Ue=Fe.dim,ze=Fe.stride,Qe=Fe.getPixels();be.activeTexture.set(ve.TEXTURE1),be.pixelStoreUnpackPremultiplyAlpha.set(!1),Z.demTexture=Z.demTexture||G.getTileTexture(ze),(Z.demTexture?((ze=Z.demTexture).update(Qe,{premultiply:!1}),ze):(Z.demTexture=new ue(be,Qe,ve.RGBA,{premultiply:!1}),Z.demTexture)).bind(ve.NEAREST,ve.CLAMP_TO_EDGE),be.activeTexture.set(ve.TEXTURE0);let ct=Z.fbo;ct||((ze=new ue(be,{width:Ue,height:Ue,data:null},ve.RGBA)).bind(ve.LINEAR,ve.CLAMP_TO_EDGE),(ct=Z.fbo=be.createFramebuffer(Ue,Ue,!0,!1)).colorAttachment.set(ze.texture)),be.bindFramebuffer.set(ct.framebuffer),be.viewport.set([0,0,Ue,Ue]),G.useProgram("hillshadePrepare").draw(be,ve.TRIANGLES,X,ge,ye,Wr.disabled,Na(Z.tileID,Fe),null,j.id,G.rasterBoundsBuffer,G.quadTriangleIndexBuffer,G.rasterBoundsSegments),Z.needsHillshadePrepare=!1}}else w.renderPass==="translucent"&&(Qe=w,ze=Xe,Ue=N,be=f,ve=T,X=R[Xe.overscaledZ],ge=P,Z=G=j=Fe=ye=void 0,ye=Qe.context,Fe=ye.gl,j=Ue.fbo)&&(G=Qe.useProgram("hillshade"),Z=Qe.style.map.terrain&&Qe.style.map.terrain.getTerrainData(ze),ye.activeTexture.set(Fe.TEXTURE0),Fe.bindTexture(Fe.TEXTURE_2D,j.colorAttachment.get()),j=Z?ze:null,G.draw(ye,Fe.TRIANGLES,ve,X,ge,Wr.disabled,yo(Qe,Ue,be,j),Z,be.id,Qe.rasterBoundsBuffer,Qe.quadTriangleIndexBuffer,Qe.rasterBoundsSegments))}v.viewport.set([0,0,w.width,w.height])}}function os(w,s,f,y){if(w.renderPass==="translucent"&&f.paint.get("raster-opacity")!==0&&y.length){var v=w.context,T=v.gl,P=s.getSource(),R=w.useProgram("raster"),N=w.colorModeForRenderPass(),[G,y]=P instanceof Pe?[{},y]:w.stencilConfigForOverlap(y),Z=y[y.length-1].overscaledZ,j=!w.options.moving;for(const Ue of y){var X=w.depthModeForSublayer(Ue.overscaledZ-Z,f.paint.get("raster-opacity")===1?ur.ReadWrite:ur.ReadOnly,T.LESS),ve=s.getTile(Ue),ye=(ve.registerFadeDuration(f.paint.get("raster-fade-duration")),s.findLoadedParent(Ue,0)),ge=function(Je,Xe,ct,it,_t,Dt){it=it.paint.get("raster-fade-duration");{var Yt;return!Dt&&0<it?(Dt=g.now(),Yt=(Dt-Je.timeAdded)/it,Dt=Xe?(Dt-Xe.timeAdded)/it:-1,it=ct.getSource(),ct=_t.coveringZoomLevel({tileSize:it.tileSize,roundZoom:it.roundZoom}),_t=!Xe||Math.abs(Xe.tileID.overscaledZ-ct)>Math.abs(Je.tileID.overscaledZ-ct),it=_t&&Je.refreshedUponExpiration?1:o.clamp(_t?Yt:1-Dt,0,1),Je.refreshedUponExpiration&&1<=Yt&&(Je.refreshedUponExpiration=!1),Xe?{opacity:1,mix:1-it}:{opacity:it,mix:0}):{opacity:1,mix:0}}}(ve,ye,s,f,w.transform,w.style.map.terrain);let ze,Qe;var be=f.paint.get("raster-resampling")==="nearest"?T.NEAREST:T.LINEAR,ye=(v.activeTexture.set(T.TEXTURE0),ve.texture.bind(be,T.CLAMP_TO_EDGE,T.LINEAR_MIPMAP_NEAREST),v.activeTexture.set(T.TEXTURE1),ye?(ye.texture.bind(be,T.CLAMP_TO_EDGE,T.LINEAR_MIPMAP_NEAREST),ze=Math.pow(2,ye.tileID.overscaledZ-ve.tileID.overscaledZ),Qe=[ve.tileID.canonical.x*ze%1,ve.tileID.canonical.y*ze%1]):ve.texture.bind(be,T.CLAMP_TO_EDGE,T.LINEAR_MIPMAP_NEAREST),w.style.map.terrain&&w.style.map.terrain.getTerrainData(Ue)),ve=ye?Ue:null,be=ve?ve.posMatrix:w.transform.calculatePosMatrix(Ue.toUnwrapped(),j),ve=Au(be,Qe||[0,0],ze||1,ge,f);P instanceof Pe?R.draw(v,T.TRIANGLES,X,li.disabled,N,Wr.disabled,ve,ye,f.id,P.boundsBuffer,w.quadTriangleIndexBuffer,P.boundsSegments):R.draw(v,T.TRIANGLES,X,G[Ue.overscaledZ],N,Wr.disabled,ve,ye,f.id,w.rasterBoundsBuffer,w.quadTriangleIndexBuffer,w.rasterBoundsSegments)}}}function F0(w,s,f,y){var v=f.paint.get("background-color"),T=f.paint.get("background-opacity");if(T!==0){var P=w.context,R=P.gl,N=w.transform,G=N.tileSize,Z=f.paint.get("background-pattern");if(!w.isPatternMissing(Z)){var j=!Z&&v.a===1&&T===1&&w.opaquePassEnabledForLayer()?"opaque":"translucent";if(w.renderPass===j){var X=li.disabled,ge=w.depthModeForSublayer(0,j=="opaque"?ur.ReadWrite:ur.ReadOnly),ye=w.colorModeForRenderPass(),be=w.useProgram(Z?"backgroundPattern":"background"),j=y||N.coveringTiles({tileSize:G,terrain:w.style.map.terrain}),ve=(Z&&(P.activeTexture.set(R.TEXTURE0),w.imageManager.bind(w.context)),f.getCrossfadeParameters());for(const Qe of j){var Fe=y?Qe.posMatrix:w.transform.calculatePosMatrix(Qe.toUnwrapped()),Fe=Z?Nm(Fe,T,w,Z,{tileID:Qe,tileSize:G},ve):{u_matrix:Fe,u_opacity:T,u_color:v},Ue=w.style.map.terrain&&w.style.map.terrain.getTerrainData(Qe);be.draw(P,R.TRIANGLES,ge,X,ye,Wr.disabled,Fe,Ue,f.id,w.tileExtentBuffer,w.quadTriangleIndexBuffer,w.tileExtentSegments)}}}}}const B0=new o.Color(1,0,0,1),XE=new o.Color(0,1,0,1),id=new o.Color(0,0,1,1),op=new o.Color(1,0,1,1),U0=new o.Color(0,1,1,1);function QE(w){var s,f,y=w.transform.padding,y=(z0(w,w.transform.height-(y.top||0),3,B0),z0(w,y.bottom||0,3,XE),j0(w,y.left||0,3,id),j0(w,w.transform.width-(y.right||0),3,op),w.transform.centerPoint);s=w,f=y.x,w=w.transform.height-y.y,y=U0,ap(s,f-1,w-10,2,20,y),ap(s,f-10,w-1,20,2,y)}function z0(w,s,f,y){ap(w,0,s+f/2,w.transform.width,f,y)}function j0(w,s,f,y){ap(w,s-f/2,0,f,w.transform.height,y)}function ap(w,s,f,y,v,T){var P=w.context,R=P.gl;R.enable(R.SCISSOR_TEST),R.scissor(s*w.pixelRatio,f*w.pixelRatio,y*w.pixelRatio,v*w.pixelRatio),P.clear({color:T}),R.disable(R.SCISSOR_TEST)}function ku(w,s,f){for(let be=0;be<f.length;be++){y=void 0,ye=void 0,v=void 0,T=void 0,P=void 0,R=void 0,N=void 0,G=void 0,Z=void 0,j=void 0,X=void 0,ge=void 0;var y=w,ye=s,v=f[be],T=y.context,P=T.gl,R=v.posMatrix,N=y.useProgram("debug"),G=ur.disabled,Z=li.disabled,j=y.colorModeForRenderPass(),X=y.style.map.terrain&&y.style.map.terrain.getTerrainData(v),ge=(T.activeTexture.set(P.TEXTURE0),ye.getTileByID(v.key).latestRawTileData),ge=ge&&ge.byteLength||0,ge=Math.floor(ge/1024),ye=ye.getTile(v).tileSize,ye=512/Math.min(ye,512)*(v.overscaledZ/y.transform.zoom)*.5;let ve=v.canonical.toString();v.overscaledZ!==v.canonical.z&&(ve+=" => "+v.overscaledZ),v=ve+` ${ge}kB`,function(Fe,Ue){Fe.initDebugOverlayCanvas();var ze=Fe.debugOverlayCanvas,Qe=Fe.context.gl,Je=Fe.debugOverlayCanvas.getContext("2d");Je.clearRect(0,0,ze.width,ze.height),Je.shadowColor="white",Je.shadowBlur=2,Je.lineWidth=1.5,Je.strokeStyle="white",Je.textBaseline="top",Je.font="bold 36px Open Sans, sans-serif",Je.fillText(Ue,5,5),Je.strokeText(Ue,5,5),Fe.debugOverlayTexture.update(ze),Fe.debugOverlayTexture.bind(Qe.LINEAR,Qe.CLAMP_TO_EDGE)}(y,v),N.draw(T,P.TRIANGLES,G,Z,vi.alphaBlended,Wr.disabled,Zn(R,o.Color.transparent,ye),null,"$debug",y.debugBuffer,y.quadTriangleIndexBuffer,y.debugSegments),N.draw(T,P.LINE_STRIP,G,Z,j,Wr.disabled,Zn(R,o.Color.red),X,"$debug",y.debugBuffer,y.tileBorderIndexBuffer,y.debugSegments)}}function JE(w,s){let f=null;var v=Object.values(w._layers).flatMap(P=>P.source&&!P.isHidden(s)?[w.sourceCaches[P.source]]:[]),y=v.filter(P=>P.getSource().type==="vector"),v=v.filter(P=>P.getSource().type!=="vector");const T=P=>{(!f||f.getSource().maxzoom<P.getSource().maxzoom)&&(f=P)};return y.forEach(P=>T(P)),f||v.forEach(P=>T(P)),f}function eT(w,s,T){var y,v=w.context,T=T.implementation;w.renderPass==="offscreen"?(y=T.prerender)&&(w.setCustomLayerDefaults(),v.setColorMode(w.colorModeForRenderPass()),y.call(T,v.gl,w.transform.customLayerMatrix()),v.setDirty(),w.setBaseState()):w.renderPass==="translucent"&&(w.setCustomLayerDefaults(),v.setColorMode(w.colorModeForRenderPass()),v.setStencilMode(li.disabled),y=T.renderingMode==="3d"?new ur(w.context.gl.LEQUAL,ur.ReadWrite,w.depthRangeFor3D):w.depthModeForSublayer(0,ur.ReadOnly),v.setDepthMode(y),T.render(v.gl,w.transform.customLayerMatrix()),v.setDirty(),w.setBaseState(),v.bindFramebuffer.set(null))}function tT(w,s){var f=w.context,y=f.gl,v=vi.unblended,T=new ur(y.LEQUAL,ur.ReadWrite,[0,1]),P=s.getTerrainMesh(),R=s.sourceCache.getRenderableTiles(),N=w.useProgram("terrainDepth");f.bindFramebuffer.set(s.getFramebuffer("depth").framebuffer),f.viewport.set([0,0,w.width/devicePixelRatio,w.height/devicePixelRatio]),f.clear({color:o.Color.transparent,depth:1});for(const j of R){var G=s.getTerrainData(j.tileID),Z={u_matrix:w.transform.calculatePosMatrix(j.tileID.toUnwrapped()),u_ele_delta:s.getMeshFrameDelta(w.transform.zoom)};N.draw(f,y.TRIANGLES,T,li.disabled,v,Wr.backCCW,Z,G,"terrain",P.vertexBuffer,P.indexBuffer,P.segments)}f.bindFramebuffer.set(null),f.viewport.set([0,0,w.width,w.height])}function nT(w,s){var f=w.context,y=f.gl,v=vi.unblended,T=new ur(y.LEQUAL,ur.ReadWrite,[0,1]),P=s.getTerrainMesh(),R=s.getCoordsTexture(),N=s.sourceCache.getRenderableTiles(),G=w.useProgram("terrainCoords");f.bindFramebuffer.set(s.getFramebuffer("coords").framebuffer),f.viewport.set([0,0,w.width/devicePixelRatio,w.height/devicePixelRatio]),f.clear({color:o.Color.transparent,depth:1}),s.coordsIndex=[];for(const X of N){var Z=s.getTerrainData(X.tileID),j=(f.activeTexture.set(y.TEXTURE0),y.bindTexture(y.TEXTURE_2D,R.texture),w.transform.calculatePosMatrix(X.tileID.toUnwrapped())),j={u_matrix:j,u_terrain_coords_id:(255-s.coordsIndex.length)/255,u_texture:0,u_ele_delta:s.getMeshFrameDelta(w.transform.zoom)};G.draw(f,y.TRIANGLES,T,li.disabled,v,Wr.backCCW,j,Z,"terrain",P.vertexBuffer,P.indexBuffer,P.segments),s.coordsIndex.push(X.tileID.key)}f.bindFramebuffer.set(null),f.viewport.set([0,0,w.width,w.height])}function V0(w,s,f){var y=w.context,v=y.gl,T=w.colorModeForRenderPass(),P=new ur(v.LEQUAL,ur.ReadWrite,w.depthRangeFor3D),R=w.useProgram("terrain"),N=s.getTerrainMesh();y.bindFramebuffer.set(null),y.viewport.set([0,0,w.width,w.height]);for(const j of f){var Z=w.renderToTexture.getTexture(j),G=s.getTerrainData(j.tileID),Z=(y.activeTexture.set(v.TEXTURE0),v.bindTexture(v.TEXTURE_2D,Z.texture),w.transform.calculatePosMatrix(j.tileID.toUnwrapped())),Z={u_matrix:Z,u_texture:0,u_ele_delta:s.getMeshFrameDelta(w.transform.zoom)};R.draw(y,v.TRIANGLES,P,li.disabled,T,Wr.backCCW,Z,G,"terrain",N.vertexBuffer,N.indexBuffer,N.segments)}}class rT{constructor(s,f){this.context=new Wm(s),this.transform=f,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:o.identity(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=Tt.maxUnderzooming+Tt.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new wl}resize(s,f,y){if(this.width=Math.floor(s*y),this.height=Math.floor(f*y),this.pixelRatio=y,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const v of this.style._order)this.style._layers[v].resize()}setup(){var f=this.context,s=new o.PosArray,s=(s.emplaceBack(0,0),s.emplaceBack(o.EXTENT,0),s.emplaceBack(0,o.EXTENT),s.emplaceBack(o.EXTENT,o.EXTENT),this.tileExtentBuffer=f.createVertexBuffer(s,La.members),this.tileExtentSegments=o.SegmentVector.simpleSegment(0,0,4,2),new o.PosArray),s=(s.emplaceBack(0,0),s.emplaceBack(o.EXTENT,0),s.emplaceBack(0,o.EXTENT),s.emplaceBack(o.EXTENT,o.EXTENT),this.debugBuffer=f.createVertexBuffer(s,La.members),this.debugSegments=o.SegmentVector.simpleSegment(0,0,4,5),new o.RasterBoundsArray),s=(s.emplaceBack(0,0,0,0),s.emplaceBack(o.EXTENT,0,o.EXTENT,0),s.emplaceBack(0,o.EXTENT,0,o.EXTENT),s.emplaceBack(o.EXTENT,o.EXTENT,o.EXTENT,o.EXTENT),this.rasterBoundsBuffer=f.createVertexBuffer(s,Ae.members),this.rasterBoundsSegments=o.SegmentVector.simpleSegment(0,0,4,2),new o.PosArray),s=(s.emplaceBack(0,0),s.emplaceBack(1,0),s.emplaceBack(0,1),s.emplaceBack(1,1),this.viewportBuffer=f.createVertexBuffer(s,La.members),this.viewportSegments=o.SegmentVector.simpleSegment(0,0,4,2),new o.LineStripIndexArray),s=(s.emplaceBack(0),s.emplaceBack(1),s.emplaceBack(3),s.emplaceBack(2),s.emplaceBack(0),this.tileBorderIndexBuffer=f.createIndexBuffer(s),new o.TriangleIndexArray),f=(s.emplaceBack(0,1,2),s.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=f.createIndexBuffer(s),this.context.gl);this.stencilClearMode=new li({func:f.ALWAYS,mask:0},0,255,f.ZERO,f.ZERO,f.ZERO)}clearStencil(){var s=this.context,f=s.gl,y=(this.nextStencilID=1,this.currentStencilSource=void 0,o.create());o.ortho(y,0,this.width,this.height,0,0,1),o.scale(y,y,[f.drawingBufferWidth,f.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(s,f.TRIANGLES,ur.disabled,this.stencilClearMode,vi.disabled,Wr.disabled,Mi(y),null,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(s,f){if(this.currentStencilSource!==s.source&&s.isTileClipped()&&f&&f.length){this.currentStencilSource=s.source;var y=this.context,v=y.gl,T=(256<this.nextStencilID+f.length&&this.clearStencil(),y.setColorMode(vi.disabled),y.setDepthMode(ur.disabled),this.useProgram("clippingMask"));this._tileClippingMaskIDs={};for(const N of f){var P=this._tileClippingMaskIDs[N.key]=this.nextStencilID++,R=this.style.map.terrain&&this.style.map.terrain.getTerrainData(N);T.draw(y,v.TRIANGLES,ur.disabled,new li({func:v.ALWAYS,mask:0},P,255,v.KEEP,v.KEEP,v.REPLACE),vi.disabled,Wr.disabled,Mi(N.posMatrix),R,"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}}stencilModeFor3D(){this.currentStencilSource=void 0,256<this.nextStencilID+1&&this.clearStencil();var s=this.nextStencilID++,f=this.context.gl;return new li({func:f.NOTEQUAL,mask:255},s,255,f.KEEP,f.KEEP,f.REPLACE)}stencilModeForClipping(s){var f=this.context.gl;return new li({func:f.EQUAL,mask:255},this._tileClippingMaskIDs[s.key],0,f.KEEP,f.KEEP,f.REPLACE)}stencilConfigForOverlap(y){var f=this.context.gl,y=y.sort((R,N)=>N.overscaledZ-R.overscaledZ),v=y[y.length-1].overscaledZ,T=y[0].overscaledZ-v+1;if(1<T){this.currentStencilSource=void 0,256<this.nextStencilID+T&&this.clearStencil();var P={};for(let R=0;R<T;R++)P[R+v]=new li({func:f.GEQUAL,mask:255},R+this.nextStencilID,255,f.KEEP,f.KEEP,f.REPLACE);return this.nextStencilID+=T,[P,y]}return[{[v]:li.disabled},y]}colorModeForRenderPass(){var s=this.context.gl;return this._showOverdrawInspector?new vi([s.CONSTANT_COLOR,s.ONE],new o.Color(1/8,1/8,1/8,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?vi.unblended:vi.alphaBlended}depthModeForSublayer(s,f,y){return this.opaquePassEnabledForLayer()?(s=1-((1+this.currentLayer)*this.numSublayers+s)*this.depthEpsilon,new ur(y||this.context.gl.LEQUAL,f,[s,s])):ur.disabled}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(s,f){this.style=s,this.options=f,this.lineAtlas=s.lineAtlas,this.imageManager=s.imageManager,this.glyphManager=s.glyphManager,this.symbolFadeChange=s.placement.symbolFadeChange(g.now()),this.imageManager.beginFrame();var y=this.style._order,v=this.style.sourceCaches,T={},P={},R={};for(const Ue in v){var N=v[Ue];N.used&&N.prepare(this.context),T[Ue]=N.getVisibleCoordinates(),P[Ue]=T[Ue].slice().reverse(),R[Ue]=N.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let Ue=0;Ue<y.length;Ue++){var G=y[Ue];if(this.style._layers[G].is3D()){this.opaquePassCutoff=Ue;break}}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(const Ue of y){var Z,j=this.style._layers[Ue];j.hasOffscreenPass()&&!j.isHidden(this.transform.zoom)&&(Z=P[j.source],j.type==="custom"||Z.length)&&this.renderLayer(this,v[j.source],j,Z)}if(this.context.bindFramebuffer.set(null),this.context.clear({color:f.showOverdrawInspector?o.Color.black:o.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=f.showOverdrawInspector,this.depthRangeFor3D=[0,1-(s._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=y.length-1;0<=this.currentLayer;this.currentLayer--){var X=this.style._layers[y[this.currentLayer]],ge=v[X.source],ye=T[X.source];this._renderTileClippingMasks(X,ye),this.renderLayer(this,ge,X,ye)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<y.length;this.currentLayer++){var be,ve=this.style._layers[y[this.currentLayer]],Fe=v[ve.source];this.renderToTexture&&this.renderToTexture.renderLayer(ve)||(be=(ve.type==="symbol"?R:P)[ve.source],this._renderTileClippingMasks(ve,T[ve.source]),this.renderLayer(this,Fe,ve,be))}this.options.showTileBoundaries&&(f=JE(this.style,this.transform.zoom))&&ku(this,f,f.getVisibleCoordinates()),this.options.showPadding&&QE(this),this.context.setDefault()}maybeDrawDepthAndCoords(s){if(this.style&&this.style.map&&this.style.map.terrain){var f=this.terrainFacilitator.matrix,y=this.transform.projMatrix;let v=this.terrainFacilitator.dirty;(v=(v=v||(s?!o.exactEquals(f,y):!o.equals(f,y)))||0<this.style.map.terrain.sourceCache.tilesAfterTime(this.terrainFacilitator.renderTime).length)&&(o.copy(f,y),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,tT(this,this.style.map.terrain),nT(this,this.style.map.terrain))}}renderLayer(s,f,y,v){if(!y.isHidden(this.transform.zoom)&&(y.type==="background"||y.type==="custom"||(v||[]).length))switch(this.id=y.id,y.type){case"symbol":TR(s,f,y,v,this.style.placement.variableOffsets);break;case"circle":Zm(s,f,y,v);break;case"heatmap":N0(s,f,y,v);break;case"line":YE(s,f,y,v);break;case"fill":Xm(s,f,y,v);break;case"fill-extrusion":ZE(s,f,y,v);break;case"hillshade":Ru(s,f,y,v);break;case"raster":os(s,f,y,v);break;case"background":F0(s,0,y,v);break;case"custom":eT(s,0,y)}}translatePosMatrix(s,f,y,v,T){var P;return y[0]||y[1]?((v=T?v==="map"?this.transform.angle:0:v==="viewport"?-this.transform.angle:0)&&(P=Math.sin(v),v=Math.cos(v),y=[y[0]*v-y[1]*P,y[0]*P+y[1]*v]),P=[T?y[0]:tn(f,y[0],this.transform.zoom),T?y[1]:tn(f,y[1],this.transform.zoom),0],v=new Float32Array(16),o.translate(v,s,P),v):s}saveTileTexture(s){var f=this._tileTextures[s.size[0]];f?f.push(s):this._tileTextures[s.size[0]]=[s]}getTileTexture(s){return s=this._tileTextures[s],s&&0<s.length?s.pop():null}isPatternMissing(s){var f;return!(!s||s.from&&s.to&&(f=this.imageManager.getPattern(s.from.toString()),s=this.imageManager.getPattern(s.to.toString()),f)&&s)}useProgram(s,f){this.cache=this.cache||{};var y=s+(f?f.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"")+(this.style.map.terrain?"/terrain":"");return this.cache[y]||(this.cache[y]=new Jh(this.context,rs[s],f,Dm[s],this._showOverdrawInspector,this.style.map.terrain)),this.cache[y]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){var s=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(s.FUNC_ADD)}initDebugOverlayCanvas(){var s;this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,s=this.context.gl,this.debugOverlayTexture=new ue(this.context,this.debugOverlayCanvas,s.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){var{drawingBufferWidth:s,drawingBufferHeight:f}=this.context.gl;return this.width!==s||this.height!==f}}class Qm{constructor(s,f){this.points=s,this.planes=f}static fromInvProjectionMatrix(s,f,y){const v=Math.pow(2,y),T=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(P=>{var R=1/(P=o.transformMat4([],P,s))[3]/f*v;return o.mul$1(P,P,[R,R,1/P[3],R])});return y=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(P=>{var R=o.sub([],T[P[0]],T[P[1]]),N=o.sub([],T[P[2]],T[P[1]]),R=o.normalize([],o.cross([],R,N)),N=-o.dot(R,T[P[1]]);return R.concat(N)}),new Qm(T,y)}}class kc{constructor(s,f){this.min=s,this.max=f,this.center=o.scale$1([],o.add([],this.min,this.max),.5)}quadrant(s){var f=[s%2==0,s<2],y=o.clone$2(this.min),v=o.clone$2(this.max);for(let T=0;T<f.length;T++)y[T]=(f[T]?this.min:this.center)[T],v[T]=(f[T]?this.center:this.max)[T];return v[2]=this.max[2],new kc(y,v)}distanceX(s){return Math.max(Math.min(this.max[0],s[0]),this.min[0])-s[0]}distanceY(s){return Math.max(Math.min(this.max[1],s[1]),this.min[1])-s[1]}intersects(s){var f=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let y=!0;for(let P=0;P<s.planes.length;P++){var v=s.planes[P];let R=0;for(let N=0;N<f.length;N++)0<=o.dot$1(v,f[N])&&R++;if(R===0)return 0;R!==f.length&&(y=!1)}if(y)return 2;for(let P=0;P<3;P++){let R=Number.MAX_VALUE,N=-Number.MAX_VALUE;for(let G=0;G<s.points.length;G++){var T=s.points[G][P]-this.min[P];R=Math.min(R,T),N=Math.max(N,T)}if(N<0||R>this.max[P]-this.min[P])return 0}return 1}}class sp{constructor(s=0,f=0,y=0,v=0){if(isNaN(s)||s<0||isNaN(f)||f<0||isNaN(y)||y<0||isNaN(v)||v<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=s,this.bottom=f,this.left=y,this.right=v}interpolate(s,f,y){return f.top!=null&&s.top!=null&&(this.top=o.interpolate.number(s.top,f.top,y)),f.bottom!=null&&s.bottom!=null&&(this.bottom=o.interpolate.number(s.bottom,f.bottom,y)),f.left!=null&&s.left!=null&&(this.left=o.interpolate.number(s.left,f.left,y)),f.right!=null&&s.right!=null&&(this.right=o.interpolate.number(s.right,f.right,y)),this}getCenter(s,f){return s=o.clamp((this.left+s-this.right)/2,0,s),f=o.clamp((this.top+f-this.bottom)/2,0,f),new o.Point(s,f)}equals(s){return this.top===s.top&&this.bottom===s.bottom&&this.left===s.left&&this.right===s.right}clone(){return new sp(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const ma=85.051129;class as{constructor(s,f,y,v,T){this.tileSize=512,this._renderWorldCopies=T===void 0||!!T,this._minZoom=s||0,this._maxZoom=f||22,this._minPitch=y??0,this._maxPitch=v??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new o.LngLat(0,0),this._elevation=0,this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new sp,this._posMatrixCache={},this._alignedPosMatrixCache={},this.minElevationForCurrentTile=0}clone(){var s=new as(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return s.apply(this),s}apply(s){this.tileSize=s.tileSize,this.latRange=s.latRange,this.width=s.width,this.height=s.height,this._center=s._center,this._elevation=s._elevation,this.minElevationForCurrentTile=s.minElevationForCurrentTile,this.zoom=s.zoom,this.angle=s.angle,this._fov=s._fov,this._pitch=s._pitch,this._unmodified=s._unmodified,this._edgeInsets=s._edgeInsets.clone(),this._calcMatrices()}get minZoom(){return this._minZoom}set minZoom(s){this._minZoom!==s&&(this._minZoom=s,this.zoom=Math.max(this.zoom,s))}get maxZoom(){return this._maxZoom}set maxZoom(s){this._maxZoom!==s&&(this._maxZoom=s,this.zoom=Math.min(this.zoom,s))}get minPitch(){return this._minPitch}set minPitch(s){this._minPitch!==s&&(this._minPitch=s,this.pitch=Math.max(this.pitch,s))}get maxPitch(){return this._maxPitch}set maxPitch(s){this._maxPitch!==s&&(this._maxPitch=s,this.pitch=Math.min(this.pitch,s))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(s){s===void 0?s=!0:s===null&&(s=!1),this._renderWorldCopies=s}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new o.Point(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(s){s=-o.wrap(s,-180,180)*Math.PI/180,this.angle!==s&&(this._unmodified=!1,this.angle=s,this._calcMatrices(),this.rotationMatrix=o.create$2(),o.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(s){s=o.clamp(s,this.minPitch,this.maxPitch)/180*Math.PI,this._pitch!==s&&(this._unmodified=!1,this._pitch=s,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(s){s=Math.max(.01,Math.min(60,s)),this._fov!==s&&(this._unmodified=!1,this._fov=s/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(s){s=Math.min(Math.max(s,this.minZoom),this.maxZoom),this._zoom!==s&&(this._unmodified=!1,this._zoom=s,this.tileZoom=Math.max(0,Math.floor(s)),this.scale=this.zoomScale(s),this._constrain(),this._calcMatrices())}get center(){return this._center}set center(s){s.lat===this._center.lat&&s.lng===this._center.lng||(this._unmodified=!1,this._center=s,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}set elevation(s){s!==this._elevation&&(this._elevation=s,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(s){this._edgeInsets.equals(s)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,s,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(s){return this._edgeInsets.equals(s)}interpolatePadding(s,f,y){this._unmodified=!1,this._edgeInsets.interpolate(s,f,y),this._constrain(),this._calcMatrices()}coveringZoomLevel(s){return s=(s.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/s.tileSize)),Math.max(0,s)}getVisibleUnwrappedCoordinates(s){var f=[new o.UnwrappedTileID(0,s)];if(this._renderWorldCopies){var y=this.pointCoordinate(new o.Point(0,0)),v=this.pointCoordinate(new o.Point(this.width,0)),T=this.pointCoordinate(new o.Point(this.width,this.height)),P=this.pointCoordinate(new o.Point(0,this.height)),R=Math.floor(Math.min(y.x,v.x,T.x,P.x)),N=Math.floor(Math.max(y.x,v.x,T.x,P.x));for(let G=R-1;G<=N+1;G++)G!==0&&f.push(new o.UnwrappedTileID(G,s))}return f}coveringTiles(s){let f=this.coveringZoomLevel(s);var y=f;if(s.minzoom!==void 0&&f<s.minzoom)return[];s.maxzoom!==void 0&&f>s.maxzoom&&(f=s.maxzoom);var v=this.pointCoordinate(this.getCameraPoint()),T=o.MercatorCoordinate.fromLngLat(this.center);const P=Math.pow(2,f);var R=[P*v.x,P*v.y,0],N=[P*T.x,P*T.y,0],G=Qm.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,f);let Z=s.minzoom||0;!s.terrain&&this.pitch<=60&&this._edgeInsets.top<.1&&(Z=f);var j=s.terrain?2/Math.min(this.tileSize,s.tileSize)*this.tileSize:3,X=vn=>({aabb:new kc([vn*P,0,0],[(vn+1)*P,P,0]),zoom:0,x:0,y:0,wrap:vn,fullyVisible:!1}),ge=[],ye=[],be=f,ve=s.reparseOverscaled?y:f;if(this._renderWorldCopies)for(let vn=1;vn<=3;vn++)ge.push(X(-vn)),ge.push(X(vn));for(ge.push(X(0));0<ge.length;){var Fe=ge.pop(),Ue=Fe.x,ze=Fe.y;let vn=Fe.fullyVisible;if(!vn){var Qe=Fe.aabb.intersects(G);if(Qe===0)continue;vn=Qe===2}var Qe=s.terrain?R:N,Je=Fe.aabb.distanceX(Qe),Xe=Fe.aabb.distanceY(Qe),Je=Math.max(Math.abs(Je),Math.abs(Xe)),Xe=j+(1<<be-Fe.zoom)-2;if(Fe.zoom===be||Xe<Je&&Fe.zoom>=Z)Xe=be-Fe.zoom,Je=R[0]-.5-(Ue<<Xe),Xe=R[1]-.5-(ze<<Xe),ye.push({tileID:new o.OverscaledTileID(Fe.zoom===be?ve:Fe.zoom,Fe.wrap,Fe.zoom,Ue,ze),distanceSq:o.sqrLen([N[0]-.5-Ue,N[1]-.5-ze]),tileDistanceToCamera:Math.sqrt(Je*Je+Xe*Xe)});else for(let bn=0;bn<4;bn++){var ct,it,_t=(Ue<<1)+bn%2,Dt=(ze<<1)+(bn>>1),Yt=Fe.zoom+1;let Zt=Fe.aabb.quadrant(bn);s.terrain&&(it=new o.OverscaledTileID(Yt,Fe.wrap,Yt,_t,Dt),ct=(ct=(it=s.terrain.getMinMaxElevation(it)).minElevation)!=null?ct:this.elevation,it=(it=it.maxElevation)!=null?it:this.elevation,Zt=new kc([Zt.min[0],Zt.min[1],ct],[Zt.max[0],Zt.max[1],it])),ge.push({aabb:Zt,zoom:Yt,x:_t,y:Dt,wrap:Fe.wrap,fullyVisible:vn})}}return ye.sort((vn,bn)=>vn.distanceSq-bn.distanceSq).map(vn=>vn.tileID)}resize(s,f){this.width=s,this.height=f,this.pixelsToGLUnits=[2/s,-2/f],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(s){return Math.pow(2,s)}scaleZoom(s){return Math.log(s)/Math.LN2}project(s){var f=o.clamp(s.lat,-ma,ma);return new o.Point(o.mercatorXfromLng(s.lng)*this.worldSize,o.mercatorYfromLat(f)*this.worldSize)}unproject(s){return new o.MercatorCoordinate(s.x/this.worldSize,s.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}getCameraPosition(){return{lngLat:this.pointLocation(this.getCameraPoint()),altitude:Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter+this.elevation}}recalculateZoom(T){var f=this.elevation,y=Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter,v=this.pointLocation(this.centerPoint,T),T=T.getElevationForLngLatZoom(v,this.tileZoom);this.elevation-T&&(y=y+f-T,f=Math.cos(this._pitch)*this.cameraToCenterDistance/y/o.mercatorZfromAltitude(1,v.lat)/this.tileSize,y=this.scaleZoom(f),this._elevation=T,this._center=v,this.zoom=y)}setLocationAtPoint(T,y){var y=this.pointCoordinate(y),v=this.pointCoordinate(this.centerPoint),T=this.locationCoordinate(T),T=new o.MercatorCoordinate(T.x-(y.x-v.x),T.y-(y.y-v.y));this.center=this.coordinateLocation(T),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(s,f){return f?this.coordinatePoint(this.locationCoordinate(s),f.getElevationForLngLatZoom(s,this.tileZoom),this.pixelMatrix3D):this.coordinatePoint(this.locationCoordinate(s))}pointLocation(s,f){return this.coordinateLocation(this.pointCoordinate(s,f))}locationCoordinate(s){return o.MercatorCoordinate.fromLngLat(s)}coordinateLocation(s){return s&&s.toLngLat()}pointCoordinate(v,y){if(y&&(y=y.pointCoordinate(v),y!=null))return y;var y=[v.x,v.y,0,1],v=[v.x,v.y,1,1],T=(o.transformMat4(y,y,this.pixelMatrixInverse),o.transformMat4(v,v,this.pixelMatrixInverse),y[3]),P=v[3],R=y[1]/T,N=v[1]/P,G=y[2]/T,Z=v[2]/P,Z=G==Z?0:(0-G)/(Z-G);return new o.MercatorCoordinate(o.interpolate.number(y[0]/T,v[0]/P,Z)/this.worldSize,o.interpolate.number(R,N,Z)/this.worldSize)}coordinatePoint(s,f=0,y=this.pixelMatrix){return s=[s.x*this.worldSize,s.y*this.worldSize,f,1],o.transformMat4(s,s,y),new o.Point(s[0]/s[3],s[1]/s[3])}getBounds(){var s=Math.max(0,this.height/2-this.getHorizon());return new B().extend(this.pointLocation(new o.Point(0,s))).extend(this.pointLocation(new o.Point(this.width,s))).extend(this.pointLocation(new o.Point(this.width,this.height))).extend(this.pointLocation(new o.Point(0,this.height)))}getMaxBounds(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new B([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}getHorizon(){return Math.tan(Math.PI/2-this._pitch)*this.cameraToCenterDistance*.85}setMaxBounds(s){s?(this.lngRange=[s.getWest(),s.getEast()],this.latRange=[s.getSouth(),s.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-ma,ma])}calculatePosMatrix(s,f=!1){var y,v,T,P=s.key,R=f?this._alignedPosMatrixCache:this._posMatrixCache;return R[P]||(y=s.canonical,v=this.worldSize/this.zoomScale(y.z),s=y.x+Math.pow(2,y.z)*s.wrap,T=o.identity(new Float64Array(16)),o.translate(T,T,[s*v,y.y*v,0]),o.scale(T,T,[v/o.EXTENT,v/o.EXTENT,1]),o.multiply(T,f?this.alignedProjMatrix:this.projMatrix,T),R[P]=new Float32Array(T)),R[P]}customLayerMatrix(){return this.mercatorMatrix.slice()}getConstrained(ye,f){f=o.clamp(+f,this.minZoom,this.maxZoom),f={center:new o.LngLat(ye.lng,ye.lat),zoom:f};let y=this.lngRange;this._renderWorldCopies||y!==null||(y=[-(180-1e-10),180-1e-10]);var v=this.tileSize*this.zoomScale(f.zoom);let T=0,P=v,R=0,N=v,G=0,Z=0;var{x:j,y:X}=this.size,{x:ge,y:ye}=(this.latRange&&(ge=this.latRange,T=o.mercatorYfromLat(ge[1])*v,(P=o.mercatorYfromLat(ge[0])*v)-T<X)&&(G=X/(P-T)),y&&(R=o.wrap(o.mercatorXfromLng(y[0])*v,0,v),(N=o.wrap(o.mercatorXfromLng(y[1])*v,0,v))<R&&(N+=v),N-R<j)&&(Z=j/(N-R)),this.project.call({worldSize:v},ye));let be,ve;var Fe,Ue=Math.max(Z||0,G||0);if(Ue)Fe=new o.Point(Z?(N+R)/2:ge,G?(P+T)/2:ye),f.center=this.unproject.call({worldSize:v},Fe).wrap(),f.zoom+=this.scaleZoom(Ue);else{if(this.latRange&&(ye-(Fe=X/2)<T&&(ve=T+Fe),ye+Fe>P)&&(ve=P-Fe),y){Ue=(R+N)/2;let ze=ge;X=j/2,(ze=this._renderWorldCopies?o.wrap(ge,Ue-v/2,Ue+v/2):ze)-X<R&&(be=R+X),ze+X>N&&(be=N-X)}be===void 0&&ve===void 0||(Fe=new o.Point(be??ge,ve??ye),f.center=this.unproject.call({worldSize:v},Fe).wrap())}return f}_constrain(){var s,f,y;this.center&&this.width&&this.height&&!this._constraining&&(this._constraining=!0,s=this._unmodified,{center:f,zoom:y}=this.getConstrained(this.center,this.zoom),this.center=f,this.zoom=y,this._unmodified=s,this._constraining=!1)}_calcMatrices(){if(this.height){var v=this._fov/2,T=this.centerOffset,P=this.point.x,R=this.point.y;this.cameraToCenterDistance=.5/Math.tan(v)*this.height,this._pixelPerMeter=o.mercatorZfromAltitude(1,this.center.lat)*this.worldSize;let N=o.identity(new Float64Array(16));o.scale(N,N,[this.width/2,-this.height/2,1]),o.translate(N,N,[1,-1,0]),this.labelPlaneMatrix=N,N=o.identity(new Float64Array(16)),o.scale(N,N,[1,-1,1]),o.translate(N,N,[-1,-1,0]),o.scale(N,N,[2/this.width,2/this.height,1]),this.glCoordMatrix=N;var v=this.cameraToCenterDistance+this._elevation*this._pixelPerMeter/Math.cos(this._pitch),f=Math.min(this.elevation,this.minElevationForCurrentTile),y=v-f*this._pixelPerMeter/Math.cos(this._pitch),f=f<0?y:v,y=Math.PI/2+this._pitch,v=this._fov*(.5+T.y/this.height),v=Math.sin(v)*f/Math.sin(o.clamp(Math.PI-y-v,.01,Math.PI-.01)),s=this.getHorizon(),s=2*Math.atan(s/this.cameraToCenterDistance)*(.5+T.y/(2*s)),y=Math.sin(s)*f/Math.sin(o.clamp(Math.PI-y-s,.01,Math.PI-.01)),s=Math.min(v,y),v=1.01*(Math.cos(Math.PI/2-this._pitch)*s+f),y=this.height/50,s=(N=new Float64Array(16),o.perspective(N,this._fov,this.width/this.height,y,v),N[8]=2*-T.x/this.width,N[9]=2*T.y/this.height,o.scale(N,N,[1,-1,1]),o.translate(N,N,[0,0,-this.cameraToCenterDistance]),o.rotateX(N,N,this._pitch),o.rotateZ(N,N,this.angle),o.translate(N,N,[-P,-R,0]),this.mercatorMatrix=o.scale([],N,[this.worldSize,this.worldSize,this.worldSize]),o.scale(N,N,[1,1,this._pixelPerMeter]),this.pixelMatrix=o.multiply(new Float64Array(16),this.labelPlaneMatrix,N),o.translate(N,N,[0,0,-this.elevation]),this.projMatrix=N,this.invProjMatrix=o.invert([],N),this.pixelMatrix3D=o.multiply(new Float64Array(16),this.labelPlaneMatrix,N),this.width%2/2),f=this.height%2/2,y=Math.cos(this.angle),v=Math.sin(this.angle),T=P-Math.round(P)+y*s+v*f,P=R-Math.round(R)+y*f+v*s,R=new Float64Array(N);if(o.translate(R,R,[.5<T?T-1:T,.5<P?P-1:P,0]),this.alignedProjMatrix=R,!(N=o.invert(new Float64Array(16),this.pixelMatrix)))throw new Error("failed to invert matrix");this.pixelMatrixInverse=N,this._posMatrixCache={},this._alignedPosMatrixCache={}}}maxPitchScaleFactor(){var s;return this.pixelMatrixInverse?(s=[(s=this.pointCoordinate(new o.Point(0,0))).x*this.worldSize,s.y*this.worldSize,0,1],o.transformMat4(s,s,this.pixelMatrix)[3]/this.cameraToCenterDistance):1}getCameraPoint(){var s=this._pitch,s=Math.tan(s)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new o.Point(0,s))}getCameraQueryGeometry(s){var f=this.getCameraPoint();if(s.length===1)return[s[0],f];{let y=f.x,v=f.y,T=f.x,P=f.y;for(const R of s)y=Math.min(y,R.x),v=Math.min(v,R.y),T=Math.max(T,R.x),P=Math.max(P,R.y);return[new o.Point(y,v),new o.Point(T,v),new o.Point(T,P),new o.Point(y,P),new o.Point(y,v)]}}lngLatToCameraDepth(s,f){return s=this.locationCoordinate(s),s=[s.x*this.worldSize,s.y*this.worldSize,f,1],o.transformMat4(s,s,this.projMatrix),s[2]/s[3]}}function H0(w,s){let f=!1,y=null,v,T;const P=()=>{y=null,f&&(w.apply(v,T),y=setTimeout(P,s),f=!1)};return(...R)=>(f=!0,v=this,T=R,y||P(),y)}class ks{constructor(s){this._getCurrentHash=()=>{var f=window.location.hash.replace("#","");if(this._hashName){let y;return f.split("&").map(v=>v.split("=")).forEach(v=>{v[0]===this._hashName&&(y=v)}),(y&&y[1]||"").split("/")}return f.split("/")},this._onHashChange=()=>{var f,y=this._getCurrentHash();return 3<=y.length&&!y.some(v=>isNaN(v))&&(f=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(y[3]||0):this._map.getBearing(),this._map.jumpTo({center:[+y[2],+y[1]],zoom:+y[0],bearing:f,pitch:+(y[4]||0)}),!0)},this._updateHashUnthrottled=()=>{var f=window.location.href.replace(/(#.+)?$/,this.getHashString());try{window.history.replaceState(window.history.state,null,f)}catch{}},this._updateHash=H0(this._updateHashUnthrottled,300),this._hashName=s&&encodeURIComponent(s)}addTo(s){return this._map=s,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this}getHashString(s){var v=this._map.getCenter(),f=Math.round(100*this._map.getZoom())/100,T=Math.ceil((f*Math.LN2+Math.log(512/360/.5))/Math.LN10),T=Math.pow(10,T),y=Math.round(v.lng*T)/T,v=Math.round(v.lat*T)/T,T=this._map.getBearing(),P=this._map.getPitch();let R="";if(R+=s?`/${y}/${v}/`+f:f+`/${v}/`+y,(T||P)&&(R+="/"+Math.round(10*T)/10),P&&(R+="/"+Math.round(P)),this._hashName){const N=this._hashName;let G=!1;return s=window.location.hash.slice(1).split("&").map(Z=>{var j=Z.split("=")[0];return j===N?(G=!0,j+"="+R):Z}).filter(Z=>Z),G||s.push(N+"="+R),"#"+s.join("&")}return"#"+R}}or={linearity:.3,easing:o.bezier(0,0,.3,1)};const cp=o.extend({deceleration:2500,maxSpeed:1400},or),SR=o.extend({deceleration:20,maxSpeed:1400},or),CR=o.extend({deceleration:1e3,maxSpeed:360},or),iT=o.extend({deceleration:1e3,maxSpeed:90},or);class lp{constructor(s){this._map=s,this.clear()}clear(){this._inertiaBuffer=[]}record(s){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:g.now(),settings:s})}_drainInertiaBuffer(){for(var s=this._inertiaBuffer,f=g.now();0<s.length&&160<f-s[0].time;)s.shift()}_onMoveEnd(s){if(this._drainInertiaBuffer(),!(this._inertiaBuffer.length<2)){var f,y={zoom:0,bearing:0,pitch:0,pan:new o.Point(0,0),pinchAround:void 0,around:void 0};for({settings:f}of this._inertiaBuffer)y.zoom+=f.zoomDelta||0,y.bearing+=f.bearingDelta||0,y.pitch+=f.pitchDelta||0,f.panDelta&&y.pan._add(f.panDelta),f.around&&(y.around=f.around),f.pinchAround&&(y.pinchAround=f.pinchAround);var v=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,T={};return y.pan.mag()&&(s=Ht(y.pan.mag(),v,o.extend({},cp,s||{})),T.offset=y.pan.mult(s.amount/y.pan.mag()),T.center=this._map.transform.center,Os(T,s)),y.zoom&&(s=Ht(y.zoom,v,SR),T.zoom=this._map.transform.zoom+s.amount,Os(T,s)),y.bearing&&(s=Ht(y.bearing,v,CR),T.bearing=this._map.transform.bearing+o.clamp(s.amount,-179,179),Os(T,s)),y.pitch&&(s=Ht(y.pitch,v,iT),T.pitch=this._map.transform.pitch+s.amount,Os(T,s)),(T.zoom||T.bearing)&&(T.around=(v=y.pinchAround===void 0?y.around:y.pinchAround)?this._map.unproject(v):this._map.getCenter()),this.clear(),o.extend(T,{noMoveStart:!0})}}}function Os(w,s){(!w.duration||w.duration<s.duration)&&(w.duration=s.duration,w.easing=s.easing)}function Ht(P,R,f){var{maxSpeed:y,linearity:v,deceleration:T}=f,P=o.clamp(P*v/(R/1e3),-y,y),R=Math.abs(P)/(T*v);return{easing:f.easing,duration:1e3*R,amount:P*(R/2)}}class ya extends o.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(s,f,y,v={}){var T=_.mousePos(f.getCanvas(),y),P=f.unproject(T);super(s,o.extend({point:T,lngLat:P,originalEvent:y},v)),this._defaultPrevented=!1,this.target=f}}class Oc extends o.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(s,f,y){var v=s==="touchend"?y.changedTouches:y.touches,v=_.touchPos(f.getCanvasContainer(),v),T=v.map(R=>f.unproject(R)),P=v.reduce((R,N,G,Z)=>R.add(N.div(Z.length)),new o.Point(0,0));super(s,{points:v,point:P,lngLats:T,lngLat:f.unproject(P),originalEvent:y}),this._defaultPrevented=!1}}class od extends o.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(s,f,y){super(s,{originalEvent:y}),this._defaultPrevented=!1}}class oT{constructor(s,f){this._map=s,this._clickTolerance=f.clickTolerance}reset(){delete this._mousedownPos}wheel(s){return this._firePreventable(new od(s.type,this._map,s))}mousedown(s,f){return this._mousedownPos=f,this._firePreventable(new ya(s.type,this._map,s))}mouseup(s){this._map.fire(new ya(s.type,this._map,s))}click(s,f){this._mousedownPos&&this._mousedownPos.dist(f)>=this._clickTolerance||this._map.fire(new ya(s.type,this._map,s))}dblclick(s){return this._firePreventable(new ya(s.type,this._map,s))}mouseover(s){this._map.fire(new ya(s.type,this._map,s))}mouseout(s){this._map.fire(new ya(s.type,this._map,s))}touchstart(s){return this._firePreventable(new Oc(s.type,this._map,s))}touchmove(s){this._map.fire(new Oc(s.type,this._map,s))}touchend(s){this._map.fire(new Oc(s.type,this._map,s))}touchcancel(s){this._map.fire(new Oc(s.type,this._map,s))}_firePreventable(s){if(this._map.fire(s),s.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Ft{constructor(s){this._map=s}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(s){this._map.fire(new ya(s.type,this._map,s))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new ya("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(s){this._delayContextMenu?this._contextMenuEvent=s:this._ignoreContextMenu||this._map.fire(new ya(s.type,this._map,s)),this._map.listens("contextmenu")&&s.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Ou{constructor(s){this._map=s}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(s){return this.transform.pointLocation(o.Point.convert(s),this._map.terrain)}}class aT{constructor(s,f){this._map=s,this._tr=new Ou(s),this._el=s.getCanvasContainer(),this._container=s.getContainer(),this._clickTolerance=f.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(s,f){this.isEnabled()&&s.shiftKey&&s.button===0&&(_.disableDrag(),this._startPos=this._lastPos=f,this._active=!0)}mousemoveWindow(s,f){var y,v,T;!this._active||this._lastPos.equals(f=f)||!this._box&&f.dist(this._startPos)<this._clickTolerance||(T=this._startPos,this._lastPos=f,this._box||(this._box=_.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",s)),s=Math.min(T.x,f.x),y=Math.max(T.x,f.x),v=Math.min(T.y,f.y),T=Math.max(T.y,f.y),_.setTransform(this._box,`translate(${s}px,${v}px)`),this._box.style.width=y-s+"px",this._box.style.height=T-v+"px")}mouseupWindow(s,f){if(this._active&&s.button===0){const y=this._startPos,v=f;if(this.reset(),_.suppressClick(),y.x!==v.x||y.y!==v.y)return this._map.fire(new o.Event("boxzoomend",{originalEvent:s})),{cameraAnimation:T=>T.fitScreenCoordinates(y,v,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",s)}}keydown(s){this._active&&s.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",s))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(_.remove(this._box),this._box=null),_.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(s,f){return this._map.fire(new o.Event(s,{originalEvent:f}))}}function up(w,s){if(w.length!==s.length)throw new Error(`The number of touches and points are not equal - touches ${w.length}, points `+s.length);var f={};for(let y=0;y<w.length;y++)f[w[y].identifier]=s[y];return f}function sT(w){var s=new o.Point(0,0);for(const f of w)s._add(f);return s.div(w.length)}class cT{constructor(s){this.reset(),this.numTouches=s.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(s,f,y){(this.centroid||y.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=s.timeStamp),y.length===this.numTouches&&(this.centroid=sT(f),this.touches=up(y,f)))}touchmove(s,f,y){if(!this.aborted&&this.centroid){var v=up(y,f);for(const R in this.touches){var T=this.touches[R],P=v[R];(!P||30<P.dist(T))&&(this.aborted=!0)}}}touchend(s,f,y){if((!this.centroid||500<s.timeStamp-this.startTime)&&(this.aborted=!0),y.length===0&&(s=!this.aborted&&this.centroid,this.reset(),s))return s}}class G0{constructor(s){this.singleTap=new cT(s),this.numTaps=s.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(s,f,y){this.singleTap.touchstart(s,f,y)}touchmove(s,f,y){this.singleTap.touchmove(s,f,y)}touchend(s,f,y){if(f=this.singleTap.touchend(s,f,y),f){var y=s.timeStamp-this.lastTime<500,v=!this.lastTap||this.lastTap.dist(f)<30;if(y&&v||this.reset(),this.count++,this.lastTime=s.timeStamp,this.lastTap=f,this.count===this.numTaps)return this.reset(),f}}}class Lu{constructor(s){this._tr=new Ou(s),this._zoomIn=new G0({numTouches:1,numTaps:2}),this._zoomOut=new G0({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(s,f,y){this._zoomIn.touchstart(s,f,y),this._zoomOut.touchstart(s,f,y)}touchmove(s,f,y){this._zoomIn.touchmove(s,f,y),this._zoomOut.touchmove(s,f,y)}touchend(s,f,y){const v=this._zoomIn.touchend(s,f,y),T=this._zoomOut.touchend(s,f,y),P=this._tr;return v?(this._active=!0,s.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:R=>R.easeTo({duration:300,zoom:P.zoom+1,around:P.unproject(v)},{originalEvent:s})}):T?(this._active=!0,s.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:R=>R.easeTo({duration:300,zoom:P.zoom-1,around:P.unproject(T)},{originalEvent:s})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class zr{constructor(s){this._enabled=!!s.enable,this._moveStateManager=s.moveStateManager,this._clickTolerance=s.clickTolerance||1,this._moveFunction=s.move,this._activateOnStart=!!s.activateOnStart,s.assignEvents(this),this.reset()}reset(s){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(s)}_move(...s){if(s=this._moveFunction(...s),s.bearingDelta||s.pitchDelta||s.around||s.panDelta)return this._active=!0,s}dragStart(s,f){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(s)&&(this._moveStateManager.startMove(s),this._lastPoint=f.length?f[0]:f,this._activateOnStart)&&this._lastPoint&&(this._active=!0)}dragMove(s,f){if(this.isEnabled()){var y=this._lastPoint;if(y)if(s.preventDefault(),this._moveStateManager.isValidMoveEvent(s)){if(f=f.length?f[0]:f,this._moved||!(f.dist(y)<this._clickTolerance))return this._moved=!0,this._lastPoint=f,this._move(y,f)}else this.reset(s)}}dragEnd(s){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(s)&&(this._moved&&_.suppressClick(),this.reset(s))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const Jm={0:1,2:2};function q0(w,s){return s=Jm[s],w.buttons===void 0||(w.buttons&s)!==s}class ey{constructor(s){this._correctEvent=s.checkCorrectEvent}startMove(s){s=_.mouseButton(s),this._eventButton=s}endMove(s){delete this._eventButton}isValidStartEvent(s){return this._correctEvent(s)}isValidMoveEvent(s){return!q0(s,this._eventButton)}isValidEndEvent(s){return _.mouseButton(s)===this._eventButton}}class $0{constructor(){this._firstTouch=void 0}_isOneFingerTouch(s){return s.targetTouches.length===1}_isSameTouchEvent(s){return s.targetTouches[0].identifier===this._firstTouch}startMove(s){s=s.targetTouches[0].identifier,this._firstTouch=s}endMove(s){delete this._firstTouch}isValidStartEvent(s){return this._isOneFingerTouch(s)}isValidMoveEvent(s){return this._isOneFingerTouch(s)&&this._isSameTouchEvent(s)}isValidEndEvent(s){return this._isOneFingerTouch(s)&&this._isSameTouchEvent(s)}}const ty=w=>{w.mousedown=w.dragStart,w.mousemoveWindow=w.dragMove,w.mouseup=w.dragEnd,w.contextmenu=function(s){s.preventDefault()}},AR=({enable:w,clickTolerance:s})=>{var f=new ey({checkCorrectEvent:y=>_.mouseButton(y)===0&&!y.ctrlKey});return new zr({clickTolerance:s,move:(y,v)=>({around:v,panDelta:v.sub(y)}),activateOnStart:!0,moveStateManager:f,enable:w,assignEvents:ty})},ss=({enable:w,clickTolerance:s,bearingDegreesPerPixelMoved:f=.8})=>{var y=new ey({checkCorrectEvent:v=>_.mouseButton(v)===0&&v.ctrlKey||_.mouseButton(v)===2});return new zr({clickTolerance:s,move:(v,T)=>({bearingDelta:(T.x-v.x)*f}),moveStateManager:y,enable:w,assignEvents:ty})},hp=({enable:w,clickTolerance:s,pitchDegreesPerPixelMoved:f=-.5})=>{var y=new ey({checkCorrectEvent:v=>_.mouseButton(v)===0&&v.ctrlKey||_.mouseButton(v)===2});return new zr({clickTolerance:s,move:(v,T)=>({pitchDelta:(T.y-v.y)*f}),moveStateManager:y,enable:w,assignEvents:ty})};class sn{constructor(s,f){this._clickTolerance=s.clickTolerance||1,this._map=f,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new o.Point(0,0)}minTouchs(){return this._map.cooperativeGestures.isEnabled()?2:1}touchstart(s,f,y){return this._calculateTransform(s,f,y)}touchmove(s,f,y){if(this._active&&!(y.length<this.minTouchs()))return s.preventDefault(),this._calculateTransform(s,f,y)}touchend(s,f,y){this._calculateTransform(s,f,y),this._active&&y.length<this.minTouchs()&&this.reset()}touchcancel(){this.reset()}_calculateTransform(s,f,y){0<y.length&&(this._active=!0);var v=up(y,f),T=new o.Point(0,0),P=new o.Point(0,0);let R=0;for(const Z in v){var N=v[Z],G=this._touches[Z];G&&(T._add(N),P._add(N.sub(G)),R++,v[Z]=N)}if(this._touches=v,!(R<this.minTouchs())&&P.mag()&&(y=P.div(R),this._sum._add(y),!(this._sum.mag()<this._clickTolerance)))return{around:T.div(R),panDelta:y}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class xn{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(s,f,y){this._firstTwoTouches||y.length<2||(this._firstTwoTouches=[y[0].identifier,y[1].identifier],this._start([f[0],f[1]]))}touchmove(s,f,y){if(this._firstTwoTouches){s.preventDefault();var[T,v]=this._firstTwoTouches,T=Nu(y,f,T),y=Nu(y,f,v);if(T&&y)return f=this._aroundCenter?null:T.add(y).div(2),this._move([T,y],f,s)}}touchend(s,f,y){var v,T;this._firstTwoTouches&&([T,v]=this._firstTwoTouches,T=Nu(y,f,T),y=Nu(y,f,v),T&&y||(this._active&&_.suppressClick(),this.reset()))}touchcancel(){this.reset()}enable(s){this._enabled=!0,this._aroundCenter=!!s&&s.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function Nu(w,s,f){for(let y=0;y<w.length;y++)if(w[y].identifier===f)return s[y]}function ny(w,s){return Math.log(w/s)/Math.LN2}class ry extends xn{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(s){this._startDistance=this._distance=s[0].dist(s[1])}_move(s,f){var y=this._distance;if(this._distance=s[0].dist(s[1]),this._active||!(Math.abs(ny(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:ny(this._distance,y),pinchAround:f}}}function ta(w,s){return 180*w.angleWith(s)/Math.PI}class dp extends xn{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(s){this._startVector=this._vector=s[0].sub(s[1]),this._minDiameter=s[0].dist(s[1])}_move(s,f,y){var v=this._vector;if(this._vector=s[0].sub(s[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:ta(this._vector,v),pinchAround:f}}_isBelowThreshold(y){this._minDiameter=Math.min(this._minDiameter,y.mag());var f=25/(Math.PI*this._minDiameter)*360,y=ta(y,this._startVector);return Math.abs(y)<f}}function cs(w){return Math.abs(w.y)>Math.abs(w.x)}class lT extends xn{constructor(s){super(),this._currentTouchCount=0,this._map=s}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(s,f,y){super.touchstart(s,f,y),this._currentTouchCount=y.length}_start(s){cs((this._lastPoints=s)[0].sub(s[1]))&&(this._valid=!1)}_move(s,f,y){if(!(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)){var v=s[0].sub(this._lastPoints[0]),T=s[1].sub(this._lastPoints[1]);if(this._valid=this.gestureBeginsVertically(v,T,y.timeStamp),this._valid)return this._lastPoints=s,this._active=!0,{pitchDelta:-.5*((v.y+T.y)/2)}}}gestureBeginsVertically(s,f,y){var v,T;return this._valid!==void 0?this._valid:(T=2<=s.mag(),v=2<=f.mag(),T||v?T&&v?(T=0<s.y==0<f.y,cs(s)&&cs(f)&&T):(this._firstMove===void 0&&(this._firstMove=y),y-this._firstMove<100&&void 0):void 0)}}const fp={panStep:100,bearingStep:15,pitchStep:10};class wi{constructor(s){this._tr=new Ou(s),s=fp,this._panStep=s.panStep,this._bearingStep=s.bearingStep,this._pitchStep=s.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(s){if(!(s.altKey||s.ctrlKey||s.metaKey)){let f=0,y=0,v=0,T=0,P=0;switch(s.keyCode){case 61:case 107:case 171:case 187:f=1;break;case 189:case 109:case 173:f=-1;break;case 37:s.shiftKey?y=-1:(s.preventDefault(),T=-1);break;case 39:s.shiftKey?y=1:(s.preventDefault(),T=1);break;case 38:s.shiftKey?v=1:(s.preventDefault(),P=-1);break;case 40:s.shiftKey?v=-1:(s.preventDefault(),P=1);break;default:return}return this._rotationDisabled&&(y=0,v=0),{cameraAnimation:R=>{var N=this._tr;R.easeTo({duration:300,easeId:"keyboardHandler",easing:Bi,zoom:f?Math.round(N.zoom)+f*(s.shiftKey?2:1):N.zoom,bearing:N.bearing+y*this._bearingStep,pitch:N.pitch+v*this._pitchStep,offset:[-T*this._panStep,-P*this._panStep],center:N.center},{originalEvent:s})}}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Bi(w){return w*(2-w)}const W0=4.000244140625;class ad{constructor(s,f){this._onTimeout=y=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(y)},this._map=s,this._tr=new Ou(s),this._triggerRenderFrame=f,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=1/450}setZoomRate(s){this._defaultZoomRate=s}setWheelZoomRate(s){this._wheelZoomRate=s}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(s){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!s&&s.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}wheel(s){if(this.isEnabled()&&(!this._map.cooperativeGestures.isEnabled()||s[this._map.cooperativeGestures._bypassKey])){let v=s.deltaMode===WheelEvent.DOM_DELTA_LINE?40*s.deltaY:s.deltaY;var f=g.now(),y=f-(this._lastWheelEventTime||0);this._lastWheelEventTime=f,v!==0&&v%W0==0?this._type="wheel":v!==0&&Math.abs(v)<4?this._type="trackpad":400<y?(this._type=null,this._lastValue=v,this._timeout=setTimeout(this._onTimeout,40,s)):this._type||(this._type=Math.abs(y*v)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,v+=this._lastValue)),s.shiftKey&&v&&(v/=4),this._type&&(this._lastWheelEvent=s,this._delta-=v,this._active||this._start(s)),s.preventDefault()}}_start(s){var f;this._delta&&(this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout),s=_.mousePos(this._map.getCanvas(),s),f=this._tr,s.y>f.transform.height/2-f.transform.getHorizon()?this._around=o.LngLat.convert(this._aroundCenter?f.center:f.unproject(s)):this._around=o.LngLat.convert(f.center),this._aroundPoint=f.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._triggerRenderFrame()))}renderFrame(){if(this._frameId&&(this._frameId=null,this.isActive())){var s=this._tr.transform;if(this._delta!==0){var y=this._type==="wheel"&&Math.abs(this._delta)>W0?this._wheelZoomRate:this._defaultZoomRate;let G=2/(1+Math.exp(-Math.abs(this._delta*y)));this._delta<0&&G!==0&&(G=1/G),y=typeof this._targetZoom=="number"?s.zoomScale(this._targetZoom):s.scale,this._targetZoom=Math.min(s.maxZoom,Math.max(s.minZoom,s.scaleZoom(y*G))),this._type==="wheel"&&(this._startZoom=s.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}var f,y=typeof this._targetZoom=="number"?this._targetZoom:s.zoom,v=this._startZoom,T=this._easing;let P=!1,R;return this._type==="wheel"&&v&&T?(f=T(T=Math.min((g.now()-this._lastWheelEventTime)/200,1)),R=o.interpolate.number(v,y,f),T<1?this._frameId||(this._frameId=!0):P=!0):(R=y,P=!0),this._active=!0,P&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!P,zoomDelta:R-s.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}}_smoothOutEasing(s){let f=o.defaultEasing;var y,v;return this._prevEase&&(v=this._prevEase,y=(g.now()-v.start)/v.duration,v=v.easing(.01+y)-v.easing(y),y=.27/Math.sqrt(v*v+1e-4)*.01,v=Math.sqrt(.0729-y*y),f=o.bezier(y,v,.25,1)),this._prevEase={start:g.now(),duration:s,easing:f},f}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class pp{constructor(s,f){this._clickZoom=s,this._tapZoom=f}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Y0{constructor(s){this._tr=new Ou(s),this.reset()}reset(){this._active=!1}dblclick(s,f){return s.preventDefault(),{cameraAnimation:y=>{y.easeTo({duration:300,zoom:this._tr.zoom+(s.shiftKey?-1:1),around:this._tr.unproject(f)},{originalEvent:s})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class K0{constructor(){this._tap=new G0({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(s,f,y){var v,T,P;this._swipePoint||(this._tapTime?(v=f[0],T=s.timeStamp-this._tapTime<500,P=this._tapPoint.dist(v)<30,T&&P?0<y.length&&(this._swipePoint=v,this._swipeTouch=y[0].identifier):this.reset()):this._tap.touchstart(s,f,y))}touchmove(s,f,y){if(this._tapTime){if(this._swipePoint){var v,T;if(y[0].identifier===this._swipeTouch)return T=(v=f[0]).y-this._swipePoint.y,this._swipePoint=v,s.preventDefault(),this._active=!0,{zoomDelta:T/128}}}else this._tap.touchmove(s,f,y)}touchend(s,f,y){this._tapTime?this._swipePoint&&y.length===0&&this.reset():(f=this._tap.touchend(s,f,y))&&(this._tapTime=s.timeStamp,this._tapPoint=f)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class iy{constructor(s,f,y){this._el=s,this._mousePan=f,this._touchPan=y}enable(s){this._inertiaOptions=s||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class sd{constructor(s,f,y){this._pitchWithRotate=s.pitchWithRotate,this._mouseRotate=f,this._mousePitch=y}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class oy{constructor(s,f,y,v){this._el=s,this._touchZoom=f,this._touchRotate=y,this._tapDragZoom=v,this._rotationDisabled=!1,this._enabled=!0}enable(s){this._touchZoom.enable(s),this._rotationDisabled||this._touchRotate.enable(s),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class ay{constructor(s,f){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=s,this._options=f,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(!this._container){var s=this._map.getCanvasContainer();s.classList.add("maplibregl-cooperative-gestures"),this._container=_.create("div","maplibregl-cooperative-gesture-screen",s);let y=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(y=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));var s=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),f=document.createElement("div"),f=(f.className="maplibregl-desktop-message",f.textContent=y,this._container.appendChild(f),document.createElement("div"));f.className="maplibregl-mobile-message",f.textContent=s,this._container.appendChild(f),this._container.setAttribute("aria-hidden","true")}}_destoryUI(){this._container&&(_.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destoryUI()}isEnabled(){return this._enabled}touchmove(s){this._onCooperativeGesture(s.touches.length===1)}wheel(s){this._map.scrollZoom.isEnabled()&&this._onCooperativeGesture(!s[this._bypassKey])}_onCooperativeGesture(s){this._enabled&&s&&(this._container.classList.add("maplibregl-show"),setTimeout(()=>{this._container.classList.remove("maplibregl-show")},100))}}const cd=w=>w.zoom||w.drag||w.pitch||w.rotate;class Z0 extends o.Event{}function gp(w){return w.panDelta&&w.panDelta.mag()||w.zoomDelta||w.bearingDelta||w.pitchDelta}class X0{constructor(P,f){this.handleWindowEvent=R=>{this.handleEvent(R,R.type+"Window")},this.handleEvent=(R,N)=>{if(R.type==="blur")this.stop(!0);else{this._updatingCamera=!0;var G,Z,j,X=R.type==="renderFrame"?void 0:R,ge={needsRenderFrame:!1},ye={},be={},ve=R.touches,Fe=ve?this._getMapTouches(ve):void 0,Ue=Fe?_.touchPos(this._map.getCanvas(),Fe):_.mousePos(this._map.getCanvas(),R);for({handlerName:G,handler:Z,allowed:j}of this._handlers)if(Z.isEnabled()){let Qe;this._blockedByActive(be,j,G)?Z.reset():Z[N||R.type]&&(Qe=Z[N||R.type](R,Ue,Fe),this.mergeHandlerResult(ge,ye,Qe,G,X),Qe)&&Qe.needsRenderFrame&&this._triggerRenderFrame(),(Qe||Z.isActive())&&(be[G]=Z)}var ze={};for(const Qe in this._previousActiveHandlers)be[Qe]||(ze[Qe]=X);this._previousActiveHandlers=be,(Object.keys(ze).length||gp(ge))&&(this._changes.push([ge,ye,ze]),this._triggerRenderFrame()),(Object.keys(be).length||gp(ge))&&this._map._stop(!0),this._updatingCamera=!1,ve=ge.cameraAnimation,ve&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],ve(this._map))}},this._map=P,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new lp(P),this._bearingSnap=f.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(f);var y,v,T,P=this._el;this._listeners=[[P,"touchstart",{passive:!0}],[P,"touchmove",{passive:!1}],[P,"touchend",void 0],[P,"touchcancel",void 0],[P,"mousedown",void 0],[P,"mousemove",void 0],[P,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[P,"mouseover",void 0],[P,"mouseout",void 0],[P,"dblclick",void 0],[P,"click",void 0],[P,"keydown",{capture:!1}],[P,"keyup",void 0],[P,"wheel",{passive:!1}],[P,"contextmenu",void 0],[window,"blur",void 0]];for([y,v,T]of this._listeners)_.addEventListener(y,v,y===document?this.handleWindowEvent:this.handleEvent,T)}destroy(){for(var[s,f,y]of this._listeners)_.removeEventListener(s,f,s===document?this.handleWindowEvent:this.handleEvent,y)}_addDefaultHandlers(s){var f=this._map,T=f.getCanvasContainer(),P=(this._add("mapEvent",new oT(f,s)),f.boxZoom=new aT(f,s)),P=(this._add("boxZoom",P),s.interactive&&s.boxZoom&&P.enable(),f.cooperativeGestures=new ay(f,s.cooperativeGestures)),P=(this._add("cooperativeGestures",P),s.cooperativeGestures&&P.enable(),new Lu(f)),y=new Y0(f),P=(f.doubleClickZoom=new pp(y,P),this._add("tapZoom",P),this._add("clickZoom",y),s.interactive&&s.doubleClickZoom&&f.doubleClickZoom.enable(),new K0),y=(this._add("tapDragZoom",P),f.touchPitch=new lT(f)),y=(this._add("touchPitch",y),s.interactive&&s.touchPitch&&f.touchPitch.enable(s.touchPitch),ss(s)),v=hp(s),y=(f.dragRotate=new sd(s,y,v),this._add("mouseRotate",y,["mousePitch"]),this._add("mousePitch",v,["mouseRotate"]),s.interactive&&s.dragRotate&&f.dragRotate.enable(),AR(s)),v=new sn(s,f),y=(f.dragPan=new iy(T,y,v),this._add("mousePan",y),this._add("touchPan",v,["touchZoom","touchRotate"]),s.interactive&&s.dragPan&&f.dragPan.enable(s.dragPan),new dp),v=new ry,T=(f.touchZoomRotate=new oy(T,v,y,P),this._add("touchRotate",y,["touchPan","touchZoom"]),this._add("touchZoom",v,["touchPan","touchRotate"]),s.interactive&&s.touchZoomRotate&&f.touchZoomRotate.enable(s.touchZoomRotate),f.scrollZoom=new ad(f,()=>this._triggerRenderFrame())),P=(this._add("scrollZoom",T,["mousePan"]),s.interactive&&s.scrollZoom&&f.scrollZoom.enable(s.scrollZoom),f.keyboard=new wi(f));this._add("keyboard",P),s.interactive&&s.keyboard&&f.keyboard.enable(),this._add("blockableMapEvent",new Ft(f))}_add(s,f,y){this._handlers.push({handlerName:s,handler:f,allowed:y}),this._handlersById[s]=f}stop(s){if(!this._updatingCamera){for(var{handler:f}of this._handlers)f.reset();this._inertia.clear(),this._fireEvents({},{},s),this._changes=[]}}isActive(){for(var{handler:s}of this._handlers)if(s.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!cd(this._eventsInProgress)||this.isZooming()}_blockedByActive(s,f,y){for(const v in s)if(v!==y&&(!f||f.indexOf(v)<0))return!0;return!1}_getMapTouches(s){var f=[];for(const v of s){var y=v.target;this._el.contains(y)&&f.push(v)}return f}mergeHandlerResult(s,f,y,v,T){y&&(o.extend(s,y),s={handlerName:v,originalEvent:y.originalEvent||T},y.zoomDelta!==void 0&&(f.zoom=s),y.panDelta!==void 0&&(f.drag=s),y.pitchDelta!==void 0&&(f.pitch=s),y.bearingDelta!==void 0)&&(f.rotate=s)}_applyChanges(){var s,f,y,v={},T={},P={};for([s,f,y]of this._changes)s.panDelta&&(v.panDelta=(v.panDelta||new o.Point(0,0))._add(s.panDelta)),s.zoomDelta&&(v.zoomDelta=(v.zoomDelta||0)+s.zoomDelta),s.bearingDelta&&(v.bearingDelta=(v.bearingDelta||0)+s.bearingDelta),s.pitchDelta&&(v.pitchDelta=(v.pitchDelta||0)+s.pitchDelta),s.around!==void 0&&(v.around=s.around),s.pinchAround!==void 0&&(v.pinchAround=s.pinchAround),s.noInertia&&(v.noInertia=s.noInertia),o.extend(T,f),o.extend(P,y);this._updateMapTransform(v,T,P),this._changes=[]}_updateMapTransform(s,f,y){const v=this._map,T=v._getTransformForUpdate();var P=v.terrain;if(!(gp(s)||P&&this._terrainMovement))return this._fireEvents(f,y,!0);let{panDelta:R,zoomDelta:N,bearingDelta:G,pitchDelta:Z,around:j,pinchAround:X}=s;X!==void 0&&(j=X),v._stop(!0),j=j||v.transform.centerPoint;var ge=T.pointLocation(R?j.sub(R):j);G&&(T.bearing+=G),Z&&(T.pitch+=Z),N&&(T.zoom+=N),P?this._terrainMovement||!f.drag&&!f.zoom?f.drag&&this._terrainMovement?T.center=T.pointLocation(T.centerPoint.sub(R)):T.setLocationAtPoint(ge,j):(this._terrainMovement=!0,this._map._elevationFreeze=!0,T.setLocationAtPoint(ge,j),this._map.once("moveend",()=>{this._map._elevationFreeze=!1,this._terrainMovement=!1,T.recalculateZoom(v.terrain)})):T.setLocationAtPoint(ge,j),v._applyUpdatedTransform(T),this._map._update(),s.noInertia||this._inertia.record(s),this._fireEvents(f,y,!0)}_fireEvents(s,f,y){var v=cd(this._eventsInProgress),T=cd(s),P={};for(const ye in s){var R=s[ye].originalEvent;this._eventsInProgress[ye]||(P[ye+"start"]=R),this._eventsInProgress[ye]=s[ye]}!v&&T&&this._fireEvent("movestart",T.originalEvent);for(const ye in P)this._fireEvent(ye,P[ye]);T&&this._fireEvent("move",T.originalEvent);for(const ye in s){var N=s[ye].originalEvent;this._fireEvent(ye,N)}var G={};let Z;for(const ye in this._eventsInProgress){var{handlerName:j,originalEvent:X}=this._eventsInProgress[ye];this._handlersById[j].isActive()||(delete this._eventsInProgress[ye],Z=f[j]||X,G[ye+"end"]=Z)}for(const ye in G)this._fireEvent(ye,G[ye]);var ge=cd(this._eventsInProgress);y&&(v||T)&&!ge&&(this._updatingCamera=!0,y=ye=>ye!==0&&-this._bearingSnap<ye&&ye<this._bearingSnap,!(v=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions))||!v.essential&&g.prefersReducedMotion?(this._map.fire(new o.Event("moveend",{originalEvent:Z})),y(this._map.getBearing())&&this._map.resetNorth()):(y(v.bearing||this._map.getBearing())&&(v.bearing=0),v.freezeElevation=!0,this._map.easeTo(v,{originalEvent:Z})),this._updatingCamera=!1)}_fireEvent(s,f){this._map.fire(new o.Event(s,f?{originalEvent:f}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(s=>{delete this._frameId,this.handleEvent(new Z0("renderFrame",{timeStamp:s})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class Q0 extends o.Evented{constructor(s,f){super(),this._renderFrameCallback=()=>{var y=Math.min((g.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(y)),y<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=s,this._bearingSnap=f.bearingSnap,this.on("moveend",()=>{delete this._requestedCameraState})}getCenter(){return new o.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(s,f){return this.jumpTo({center:s},f)}panBy(s,f,y){return s=o.Point.convert(s).mult(-1),this.panTo(this.transform.center,o.extend({offset:s},f),y)}panTo(s,f,y){return this.easeTo(o.extend({center:s},f),y)}getZoom(){return this.transform.zoom}setZoom(s,f){return this.jumpTo({zoom:s},f),this}zoomTo(s,f,y){return this.easeTo(o.extend({zoom:s},f),y)}zoomIn(s,f){return this.zoomTo(this.getZoom()+1,s,f),this}zoomOut(s,f){return this.zoomTo(this.getZoom()-1,s,f),this}getBearing(){return this.transform.bearing}setBearing(s,f){return this.jumpTo({bearing:s},f),this}getPadding(){return this.transform.padding}setPadding(s,f){return this.jumpTo({padding:s},f),this}rotateTo(s,f,y){return this.easeTo(o.extend({bearing:s},f),y)}resetNorth(s,f){return this.rotateTo(0,o.extend({duration:1e3},s),f),this}resetNorthPitch(s,f){return this.easeTo(o.extend({bearing:0,pitch:0,duration:1e3},s),f),this}snapToNorth(s,f){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(s,f):this}getPitch(){return this.transform.pitch}setPitch(s,f){return this.jumpTo({pitch:s},f),this}cameraForBounds(s,f){s=B.convert(s);var y=f&&f.bearing||0;return this._cameraForBoxAndBearing(s.getNorthWest(),s.getSouthEast(),y,f)}_cameraForBoxAndBearing(X,R,y,v){var P={top:0,bottom:0,right:0,left:0},T=(typeof(v=o.extend({padding:P,offset:[0,0],maxZoom:this.transform.maxZoom},v)).padding=="number"&&(T=v.padding,v.padding={top:T,bottom:T,right:T,left:T}),v.padding=o.extend(P,v.padding),this.transform),P=T.padding,X=new B(X,R),R=T.project(X.getNorthWest()),j=T.project(X.getNorthEast()),N=T.project(X.getSouthEast()),X=T.project(X.getSouthWest()),G=o.degreesToRadians(-y),Z=R.rotate(G),j=j.rotate(G),ge=N.rotate(G),X=X.rotate(G),G=new o.Point(Math.max(Z.x,j.x,X.x,ge.x),Math.max(Z.y,j.y,X.y,ge.y)),Z=new o.Point(Math.min(Z.x,j.x,X.x,ge.x),Math.min(Z.y,j.y,X.y,ge.y)),j=G.sub(Z),X=(T.width-(P.left+P.right+v.padding.left+v.padding.right))/j.x,ge=(T.height-(P.top+P.bottom+v.padding.top+v.padding.bottom))/j.y;if(!(ge<0||X<0))return G=Math.min(T.scaleZoom(T.scale*Math.min(X,ge)),v.maxZoom),Z=o.Point.convert(v.offset),P=(v.padding.left-v.padding.right)/2,j=(v.padding.top-v.padding.bottom)/2,X=new o.Point(P,j).rotate(o.degreesToRadians(y)),ge=Z.add(X).mult(T.scale/T.zoomScale(G)),{center:T.unproject(R.add(N).div(2).sub(ge)),zoom:G,bearing:y};o.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}fitBounds(s,f,y){return this._fitInternal(this.cameraForBounds(s,f),f,y)}fitScreenCoordinates(s,f,y,v,T){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(o.Point.convert(s)),this.transform.pointLocation(o.Point.convert(f)),y,v),v,T)}_fitInternal(s,f,y){return s?(delete(f=o.extend(s,f)).padding,f.linear?this.easeTo(f,y):this.flyTo(f,y)):this}jumpTo(s,f){this.stop();var y=this._getTransformForUpdate();let v=!1,T=!1,P=!1;return"zoom"in s&&y.zoom!==+s.zoom&&(v=!0,y.zoom=+s.zoom),s.center!==void 0&&(y.center=o.LngLat.convert(s.center)),"bearing"in s&&y.bearing!==+s.bearing&&(T=!0,y.bearing=+s.bearing),"pitch"in s&&y.pitch!==+s.pitch&&(P=!0,y.pitch=+s.pitch),s.padding==null||y.isPaddingEqual(s.padding)||(y.padding=s.padding),this._applyUpdatedTransform(y),this.fire(new o.Event("movestart",f)).fire(new o.Event("move",f)),v&&this.fire(new o.Event("zoomstart",f)).fire(new o.Event("zoom",f)).fire(new o.Event("zoomend",f)),T&&this.fire(new o.Event("rotatestart",f)).fire(new o.Event("rotate",f)).fire(new o.Event("rotateend",f)),P&&this.fire(new o.Event("pitchstart",f)).fire(new o.Event("pitch",f)).fire(new o.Event("pitchend",f)),this.fire(new o.Event("moveend",f))}calculateCameraOptionsFromTo(P,T,Z,j=0){var P=o.MercatorCoordinate.fromLngLat(P,T),T=o.MercatorCoordinate.fromLngLat(Z,j),Z=T.x-P.x,j=T.y-P.y,P=T.z-P.z,R=Math.hypot(Z,j,P);if(R===0)throw new Error("Can't calculate camera options with same From and To");var N=Math.hypot(Z,j),G=this.transform.scaleZoom(this.transform.cameraToCenterDistance/R/this.transform.tileSize),Z=180*Math.atan2(Z,-j)/Math.PI,j=180*Math.acos(N/R)/Math.PI,j=P<0?90-j:90+j;return{center:T.toLngLat(),zoom:G,pitch:j,bearing:Z}}easeTo(s,f){this._stop(!1,s.easeId),((s=o.extend({offset:[0,0],duration:500,easing:o.defaultEasing},s)).animate===!1||!s.essential&&g.prefersReducedMotion)&&(s.duration=0);const y=this._getTransformForUpdate(),v=this.getZoom(),T=this.getBearing(),P=this.getPitch(),R=this.getPadding(),N="bearing"in s?this._normalizeBearing(s.bearing,T):T,G="pitch"in s?+s.pitch:P,Z=("padding"in s?s:y).padding,j=o.Point.convert(s.offset);let X=y.centerPoint.add(j);var ge=y.pointLocation(X);const{center:ye,zoom:be}=y.getConstrained(o.LngLat.convert(s.center||ge),(Je=s.zoom)!=null?Je:v),ve=(this._normalizeCenter(ye),y.project(ge)),Fe=y.project(ye).sub(ve),Ue=y.zoomScale(be-v);let ze,Qe;s.around&&(ze=o.LngLat.convert(s.around),Qe=y.locationPoint(ze));var Je={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||be!==v,this._rotating=this._rotating||T!==N,this._pitching=this._pitching||G!==P,this._padding=!y.isPaddingEqual(Z),this._easeId=s.easeId,this._prepareEase(f,s.noMoveStart,Je),this.terrain&&this._prepareElevation(ye),this._ease(Xe=>{var ct,it;this._zooming&&(y.zoom=o.interpolate.number(v,be,Xe)),this._rotating&&(y.bearing=o.interpolate.number(T,N,Xe)),this._pitching&&(y.pitch=o.interpolate.number(P,G,Xe)),this._padding&&(y.interpolatePadding(R,Z,Xe),X=y.centerPoint.add(j)),this.terrain&&!s.freezeElevation&&this._updateElevation(Xe),ze?y.setLocationAtPoint(ze,Qe):(ct=y.zoomScale(y.zoom-v),it=be>v?Math.min(2,Ue):Math.max(.5,Ue),it=Math.pow(it,1-Xe),Xe=y.unproject(ve.add(Fe.mult(Xe*it)).mult(ct)),y.setLocationAtPoint(y.renderWorldCopies?Xe.wrap():Xe,X)),this._applyUpdatedTransform(y),this._fireMoveEvents(f)},Xe=>{this.terrain&&this._finalizeElevation(),this._afterEase(f,Xe)},s),this}_prepareEase(s,f,y={}){this._moving=!0,f||y.moving||this.fire(new o.Event("movestart",s)),this._zooming&&!y.zooming&&this.fire(new o.Event("zoomstart",s)),this._rotating&&!y.rotating&&this.fire(new o.Event("rotatestart",s)),this._pitching&&!y.pitching&&this.fire(new o.Event("pitchstart",s))}_prepareElevation(s){this._elevationCenter=s,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(s,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(s){this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);var f,y,v=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);s<1&&v!==this._elevationTarget&&(y=(v-((f=this._elevationTarget-this._elevationStart)*s+this._elevationStart))/(1-s),this._elevationStart+=s*(f-y),this._elevationTarget=v),this.transform.elevation=o.interpolate.number(this._elevationStart,this._elevationTarget,s)}_finalizeElevation(){this._elevationFreeze=!1,this.transform.recalculateZoom(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_applyUpdatedTransform(s){var f,y,v,T,P;this.transformCameraUpdate&&(s=s.clone(),{center:f,zoom:y,pitch:v,bearing:T,elevation:P}=this.transformCameraUpdate(s),f&&(s.center=f),y!==void 0&&(s.zoom=y),v!==void 0&&(s.pitch=v),T!==void 0&&(s.bearing=T),P!==void 0&&(s.elevation=P),this.transform.apply(s))}_fireMoveEvents(s){this.fire(new o.Event("move",s)),this._zooming&&this.fire(new o.Event("zoom",s)),this._rotating&&this.fire(new o.Event("rotate",s)),this._pitching&&this.fire(new o.Event("pitch",s))}_afterEase(s,f){var y,v;this._easeId&&f&&this._easeId===f||(delete this._easeId,this.fire(new o.Event("freezeElevation",{freeze:!1})),f=this._zooming,y=this._rotating,v=this._pitching,this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,f&&this.fire(new o.Event("zoomend",s)),y&&this.fire(new o.Event("rotateend",s)),v&&this.fire(new o.Event("pitchend",s)),this.fire(new o.Event("moveend",s)))}flyTo(s,f){if(!s.essential&&g.prefersReducedMotion)return ge=o.pick(s,["center","zoom","bearing","pitch","around"]),this.jumpTo(ge,f);this.stop(),s=o.extend({offset:[0,0],speed:1.2,curve:1.42,easing:o.defaultEasing},s);const y=this._getTransformForUpdate(),v=this.getZoom(),T=this.getBearing(),P=this.getPitch(),R=this.getPadding(),N="bearing"in s?this._normalizeBearing(s.bearing,T):T,G="pitch"in s?+s.pitch:P,Z=("padding"in s?s:y).padding,j=o.Point.convert(s.offset);let X=y.centerPoint.add(j);var ge=y.pointLocation(X);const{center:ye,zoom:be}=y.getConstrained(o.LngLat.convert(s.center||ge),(ve=s.zoom)!=null?ve:v);this._normalizeCenter(ye);var ve=y.zoomScale(be-v);const Fe=y.project(ge),Ue=y.project(ye).sub(Fe);let ze=s.curve;const Qe=Math.max(y.width,y.height),Je=Qe/ve,Xe=Ue.mag(),ct=("minZoom"in s&&(ge=o.clamp(Math.min(s.minZoom,v,be),y.minZoom,y.maxZoom),ve=Qe/y.zoomScale(ge-v),ze=Math.sqrt(ve/Xe*2)),ze*ze);function it(Ct){return Ct=(Je*Je-Qe*Qe+(Ct?-1:1)*ct*ct*Xe*Xe)/(2*(Ct?Je:Qe)*ct*Xe),Math.log(Math.sqrt(Ct*Ct+1)-Ct)}function _t(Ct){return(Math.exp(Ct)-Math.exp(-Ct))/2}function Dt(Ct){return(Math.exp(Ct)+Math.exp(-Ct))/2}const Yt=it(!1);let vn=function(Ct){return Dt(Yt)/Dt(Yt+ze*Ct)},bn=function(Ct){return Qe*((Dt(Yt)*(_t(Ct=Yt+ze*Ct)/Dt(Ct))-_t(Yt))/ct)/Xe},Zt=(it(!0)-Yt)/ze;if(Math.abs(Xe)<1e-6||!isFinite(Zt)){if(Math.abs(Qe-Je)<1e-6)return this.easeTo(s,f);const Ct=Je<Qe?-1:1;Zt=Math.abs(Math.log(Je/Qe))/ze,bn=function(){return 0},vn=function(cn){return Math.exp(Ct*ze*cn)}}return"duration"in s?s.duration=+s.duration:(ge="screenSpeed"in s?+s.screenSpeed/ze:+s.speed,s.duration=1e3*Zt/ge),s.maxDuration&&s.duration>s.maxDuration&&(s.duration=0),this._zooming=!0,this._rotating=T!==N,this._pitching=G!==P,this._padding=!y.isPaddingEqual(Z),this._prepareEase(f,!1),this.terrain&&this._prepareElevation(ye),this._ease($t=>{var cn=$t*Zt,Cn=1/vn(cn),$t=(y.zoom=$t===1?be:v+y.scaleZoom(Cn),this._rotating&&(y.bearing=o.interpolate.number(T,N,$t)),this._pitching&&(y.pitch=o.interpolate.number(P,G,$t)),this._padding&&(y.interpolatePadding(R,Z,$t),X=y.centerPoint.add(j)),this.terrain&&!s.freezeElevation&&this._updateElevation($t),$t===1?ye:y.unproject(Fe.add(Ue.mult(bn(cn))).mult(Cn)));y.setLocationAtPoint(y.renderWorldCopies?$t.wrap():$t,X),this._applyUpdatedTransform(y),this._fireMoveEvents(f)},()=>{this.terrain&&this._finalizeElevation(),this._afterEase(f)},s),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(s,f){var y;return this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd&&(y=this._onEaseEnd,delete this._onEaseEnd,y.call(this,f)),s||(y=this.handlers)&&y.stop(!1),this}_ease(s,f,y){y.animate===!1||y.duration===0?(s(1),f()):(this._easeStart=g.now(),this._easeOptions=y,this._onEaseFrame=s,this._onEaseEnd=f,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(s,f){s=o.wrap(s,-180,180);var y=Math.abs(s-f);return Math.abs(s-360-f)<y&&(s-=360),Math.abs(s+360-f)<y&&(s+=360),s}_normalizeCenter(s){var f=this.transform;f.renderWorldCopies&&!f.lngRange&&(f=s.lng-f.center.lng,s.lng+=180<f?-360:f<-180?360:0)}queryTerrainElevation(s){return this.terrain?this.terrain.getElevationForLngLatZoom(o.LngLat.convert(s),this.transform.tileZoom)-this.transform.elevation:null}}const sy={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class mp{constructor(s=sy){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=f=>{!f||f.sourceDataType!=="metadata"&&f.sourceDataType!=="visibility"&&f.dataType!=="style"&&f.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=s}getDefaultPosition(){return"bottom-right"}onAdd(s){return this._map=s,this._compact=this.options.compact,this._container=_.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=_.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=_.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){_.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(s,f){f=this._map._getUIString("AttributionControl."+f),s.title=f,s.setAttribute("aria-label",f)}_updateAttributions(){if(this._map.style){let v=[];this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?v=v.concat(this.options.customAttribution.map(T=>typeof T!="string"?"":T)):typeof this.options.customAttribution=="string"&&v.push(this.options.customAttribution)),this._map.style.stylesheet&&(y=this._map.style.stylesheet,this.styleOwner=y.owner,this.styleId=y.id);var s=this._map.style.sourceCaches;for(const T in s){var f=s[T];(f.used||f.usedForTerrain)&&(f=f.getSource()).attribution&&v.indexOf(f.attribution)<0&&v.push(f.attribution)}(v=v.filter(T=>String(T).trim())).sort((T,P)=>T.length-P.length);var y=(v=v.filter((T,P)=>{for(let R=P+1;R<v.length;R++)if(0<=v[R].indexOf(T))return!1;return!0})).join(" | ");y!==this._attribHTML&&(this._attribHTML=y,v.length?(this._innerContainer.innerHTML=y,this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}}class cy{constructor(s={}){this._updateCompact=()=>{var f=this._container.children;f.length&&(f=f[0],this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&f.classList.add("maplibregl-compact"):f.classList.remove("maplibregl-compact"))},this.options=s}getDefaultPosition(){return"bottom-left"}onAdd(s){return this._map=s,this._compact=this.options&&this.options.compact,this._container=_.create("div","maplibregl-ctrl"),s=_.create("a","maplibregl-ctrl-logo"),s.target="_blank",s.rel="noopener nofollow",s.href="https://maplibre.org/",s.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),s.setAttribute("rel","noopener nofollow"),this._container.appendChild(s),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){_.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class J0{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(s){var f=++this._id;return this._queue.push({callback:s,id:f,cancelled:!1}),f}remove(s){var f=this._currentlyRunning;for(const y of f?this._queue.concat(f):this._queue)if(y.id===s)return void(y.cancelled=!0)}run(s=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");var f=this._currentlyRunning=this._queue;this._queue=[];for(const y of f)if(!y.cancelled&&(y.callback(s),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var ly=o.createLayout([{name:"a_pos3d",type:"Int16",components:3}]);class eb extends o.Evented{constructor(s){super(),this.sourceCache=s,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.deltaZoom=1,s.usedForTerrain=!0,s.tileSize=this.tileSize*2**this.deltaZoom}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(s,f){this.sourceCache.update(s,f),this._renderableTilesKeys=[];var y={};for(const v of s.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:f}))y[v.key]=!0,this._renderableTilesKeys.push(v.key),this._tiles[v.key]||(v.posMatrix=new Float64Array(16),o.ortho(v.posMatrix,0,o.EXTENT,0,o.EXTENT,0,1),this._tiles[v.key]=new fn(v,this.tileSize));for(const v in this._tiles)y[v]||delete this._tiles[v]}freeRtt(s){for(const y in this._tiles){var f=this._tiles[y];(!s||f.tileID.equals(s)||f.tileID.isChildOf(s)||s.isChildOf(f.tileID))&&(f.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(s=>this.getTileByID(s))}getTileByID(s){return this._tiles[s]}getTerrainCoords(s){var f={};for(const G of this._renderableTilesKeys){var y,v,T,P,R,N=this._tiles[G].tileID;N.canonical.equals(s.canonical)?((y=s.clone()).posMatrix=new Float64Array(16),o.ortho(y.posMatrix,0,o.EXTENT,0,o.EXTENT,0,1),f[G]=y):N.canonical.isChildOf(s.canonical)?((y=s.clone()).posMatrix=new Float64Array(16),P=N.canonical.z-s.canonical.z,v=N.canonical.x-(N.canonical.x>>P<<P),T=N.canonical.y-(N.canonical.y>>P<<P),P=o.EXTENT>>P,o.ortho(y.posMatrix,0,P,0,P,0,1),o.translate(y.posMatrix,y.posMatrix,[-v*P,-T*P,0]),f[G]=y):s.canonical.isChildOf(N.canonical)&&((v=s.clone()).posMatrix=new Float64Array(16),T=s.canonical.z-N.canonical.z,P=s.canonical.x-(s.canonical.x>>T<<T),N=s.canonical.y-(s.canonical.y>>T<<T),R=o.EXTENT>>T,o.ortho(v.posMatrix,0,o.EXTENT,0,o.EXTENT,0,1),o.translate(v.posMatrix,v.posMatrix,[P*R,N*R,0]),o.scale(v.posMatrix,v.posMatrix,[1/2**T,1/2**T,0]),f[G]=v)}return f}getSourceTile(s,f){var y=this.sourceCache._source;let v=s.overscaledZ-this.deltaZoom;if((v=v>y.maxzoom?y.maxzoom:v)<y.minzoom)return null;this._sourceTileCache[s.key]||(this._sourceTileCache[s.key]=s.scaledTo(v).key);let T=this.sourceCache.getTileByID(this._sourceTileCache[s.key]);if((!T||!T.dem)&&f)for(;v>=y.minzoom&&(!T||!T.dem);)T=this.sourceCache.getTileByID(s.scaledTo(v--).key);return T}tilesAfterTime(s=Date.now()){return Object.values(this._tiles).filter(f=>f.timeAdded>=s)}}class tb{constructor(s,f,y){this.painter=s,this.sourceCache=new eb(f),this.options=y,this.exaggeration=typeof y.exaggeration=="number"?y.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(s,f,y,v=o.EXTENT){var T;return 0<=f&&f<v&&0<=y&&y<v&&(T=(T=(s=this.getTerrainData(s)).tile)==null?void 0:T.dem)?(y=[(f=o.transformMat4$1([],[f/v*o.EXTENT,y/v*o.EXTENT],s.u_terrain_matrix))[0]*T.dim,f[1]*T.dim],v=Math.floor(y[0]),s=Math.floor(y[1]),f=y[0]-v,y=y[1]-s,T.get(v,s)*(1-f)*(1-y)+T.get(v+1,s)*f*(1-y)+T.get(v,s+1)*(1-f)*y+T.get(v+1,s+1)*f*y):0}getElevationForLngLatZoom(y,v){var{tileID:y,mercatorX:v,mercatorY:T}=this._getOverscaledTileIDFromLngLatZoom(y,v);return this.getElevation(y,v%o.EXTENT,T%o.EXTENT,o.EXTENT)}getElevation(s,f,y,v=o.EXTENT){return this.getDEMElevation(s,f,y,v)*this.exaggeration}getTerrainData(s){this._emptyDemTexture||(y=this.painter.context,f=new o.RGBAImage({width:1,height:1},new Uint8Array(4)),this._emptyDepthTexture=new ue(y,f,y.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new ue(y,new o.RGBAImage({width:1,height:1}),y.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(y.gl.NEAREST,y.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=o.identity([]));var f=this.sourceCache.getSourceTile(s,!0),y=(f&&f.dem&&(!f.demTexture||f.needsTerrainPrepare)&&(y=this.painter.context,f.demTexture=this.painter.getTileTexture(f.dem.stride),f.demTexture?f.demTexture.update(f.dem.getPixels(),{premultiply:!1}):f.demTexture=new ue(y,f.dem.getPixels(),y.gl.RGBA,{premultiply:!1}),f.demTexture.bind(y.gl.NEAREST,y.gl.CLAMP_TO_EDGE),f.needsTerrainPrepare=!1),f&&f+f.tileID.key+s.key);if(y&&!this._demMatrixCache[y]){var v=this.sourceCache.sourceCache._source.maxzoom;let R=s.canonical.z-f.tileID.canonical.z;s.overscaledZ>s.canonical.z&&(s.canonical.z>=v?R=s.canonical.z-v:o.warnOnce("cannot calculate elevation if elevation maxzoom > source.maxzoom"));var v=s.canonical.x-(s.canonical.x>>R<<R),T=s.canonical.y-(s.canonical.y>>R<<R),P=o.fromScaling(new Float64Array(16),[1/(o.EXTENT<<R),1/(o.EXTENT<<R),0]);o.translate(P,P,[v*o.EXTENT,T*o.EXTENT,0]),this._demMatrixCache[s.key]={matrix:P,coord:s}}return{u_depth:2,u_terrain:3,u_terrain_dim:f&&f.dem&&f.dem.dim||1,u_terrain_matrix:y?this._demMatrixCache[s.key].matrix:this._emptyDemMatrix,u_terrain_unpack:f&&f.dem&&f.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(f&&f.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:f}}getFramebuffer(s){var f=this.painter,y=f.width/devicePixelRatio,v=f.height/devicePixelRatio;return!this._fbo||this._fbo.width===y&&this._fbo.height===v||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new ue(f.context,{width:y,height:v,data:null},f.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(f.context.gl.NEAREST,f.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new ue(f.context,{width:y,height:v,data:null},f.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(f.context.gl.NEAREST,f.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=f.context.createFramebuffer(y,v,!0,!1),this._fbo.depthAttachment.set(f.context.createRenderbuffer(f.context.gl.DEPTH_COMPONENT16,y,v))),this._fbo.colorAttachment.set((s==="coords"?this._fboCoordsTexture:this._fboDepthTexture).texture),this._fbo}getCoordsTexture(){var s=this.painter.context;if(this._coordsTexture)return this._coordsTexture;var f=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let v=0,T=0;v<this._coordsTextureSize;v++)for(let P=0;P<this._coordsTextureSize;P++,T+=4)f[T+0]=255&P,f[T+1]=255&v,f[T+2]=P>>8<<4|v>>8,f[T+3]=0;var y=new o.RGBAImage({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(f.buffer)),y=new ue(s,y,s.gl.RGBA,{premultiply:!1});return y.bind(s.gl.NEAREST,s.gl.CLAMP_TO_EDGE),this._coordsTexture=y}pointCoordinate(P){this.painter.maybeDrawDepthAndCoords(!0);var f=new Uint8Array(4),y=this.painter.context,R=y.gl,v=Math.round(P.x*this.painter.pixelRatio/devicePixelRatio),P=Math.round(P.y*this.painter.pixelRatio/devicePixelRatio),T=Math.round(this.painter.height/devicePixelRatio),v=(y.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),R.readPixels(v,T-P-1,1,1,R.RGBA,R.UNSIGNED_BYTE,f),y.bindFramebuffer.set(null),f[0]+(f[2]>>4<<8)),T=f[1]+((15&f[2])<<8),P=this.coordsIndex[255-f[3]],R=P&&this.sourceCache.getTileByID(P);return R?(y=this._coordsTextureSize,f=(1<<R.tileID.canonical.z)*y,new o.MercatorCoordinate((R.tileID.canonical.x*y+v)/f+R.tileID.wrap,(R.tileID.canonical.y*y+T)/f,this.getElevation(R.tileID,v,T,y))):null}depthAtPoint(T){var f=new Uint8Array(4),y=this.painter.context,v=y.gl,T=(y.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),v.readPixels(T.x,this.painter.height/devicePixelRatio-T.y-1,1,1,v.RGBA,v.UNSIGNED_BYTE,f),y.bindFramebuffer.set(null),(f[0]/16777216+f[1]/65536+f[2]/256+f[3])/256);return T}getTerrainMesh(){if(!this._mesh){var s=this.painter.context,f=new o.Pos3dArray,y=new o.TriangleIndexArray,v=this.meshSize,T=o.EXTENT/v,P=v*v;for(let j=0;j<=v;j++)for(let X=0;X<=v;X++)f.emplaceBack(X*T,j*T,0);for(let j=0;j<P;j+=v+1)for(let X=0;X<v;X++)y.emplaceBack(X+j,v+X+j+1,v+X+j+2),y.emplaceBack(X+j,v+X+j+2,X+j+1);var R=f.length,N=R+2*(v+1);for(const j of[0,1])for(let X=0;X<=v;X++)for(const ge of[0,1])f.emplaceBack(X*T,j*o.EXTENT,ge);for(let j=0;j<2*v;j+=2)y.emplaceBack(N+j,N+j+1,N+j+3),y.emplaceBack(N+j,N+j+3,N+j+2),y.emplaceBack(R+j,R+j+3,R+j+1),y.emplaceBack(R+j,R+j+2,R+j+3);var G=f.length,Z=G+2*(v+1);for(const j of[0,1])for(let X=0;X<=v;X++)for(const ge of[0,1])f.emplaceBack(j*o.EXTENT,X*T,ge);for(let j=0;j<2*v;j+=2)y.emplaceBack(G+j,G+j+1,G+j+3),y.emplaceBack(G+j,G+j+3,G+j+2),y.emplaceBack(Z+j,Z+j+3,Z+j+1),y.emplaceBack(Z+j,Z+j+2,Z+j+3);this._mesh={indexBuffer:s.createIndexBuffer(y),vertexBuffer:s.createVertexBuffer(f,ly.members),segments:o.SegmentVector.simpleSegment(0,0,f.length,y.length)}}return this._mesh}getMeshFrameDelta(s){return 2*Math.PI*o.earthRadius/Math.pow(2,s)/5}getMinTileElevationForLngLatZoom(s,f){return s=this._getOverscaledTileIDFromLngLatZoom(s,f).tileID,(f=this.getMinMaxElevation(s).minElevation)!=null?f:0}getMinMaxElevation(f){var f=this.getTerrainData(f).tile,y={minElevation:null,maxElevation:null};return f&&f.dem&&(y.minElevation=f.dem.min*this.exaggeration,y.maxElevation=f.dem.max*this.exaggeration),y}_getOverscaledTileIDFromLngLatZoom(v,f){var v=o.MercatorCoordinate.fromLngLat(v.wrap()),T=(1<<f)*o.EXTENT,y=v.x*T,v=v.y*T,T=Math.floor(y/o.EXTENT),P=Math.floor(v/o.EXTENT);return{tileID:new o.OverscaledTileID(f,0,f,T,P),mercatorX:y,mercatorY:v}}}class nb{constructor(s,f,y){this._context=s,this._size=f,this._tileSize=y,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const s of this._objects)s.texture.destroy(),s.fbo.destroy()}_createObject(s){var f=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),y=new ue(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return y.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),f.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),f.colorAttachment.set(y.texture),{id:s,fbo:f,texture:y,stamp:-1,inUse:!1}}getObjectForId(s){return this._objects[s]}useObject(s){s.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(f=>s.id!==f),this._recentlyUsed.push(s.id)}stampObject(s){s.stamp=++this._stamp}getOrCreateFreeObject(){for(const f of this._recentlyUsed)if(!this._objects[f].inUse)return this._objects[f];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");var s=this._createObject(this._objects.length);return this._objects.push(s),s}freeObject(s){s.inUse=!1}freeAllObjects(){for(const s of this._objects)this.freeObject(s)}isFull(){return!(this._objects.length<this._size)&&this._objects.some(s=>!s.inUse)===!1}}const El={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0};class rb{constructor(s,f){this.painter=s,this.terrain=f,this.pool=new nb(s.context,30,f.sourceCache.tileSize*f.qualityFactor)}destruct(){this.pool.destruct()}getTexture(s){return this.pool.getObjectForId(s.rtt[this._stacks.length-1].id).texture}prepareForRender(s,f){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=s._order.filter(R=>!s._layers[R].isHidden(f)),this._coordsDescendingInv={};for(const R in s.sourceCaches){this._coordsDescendingInv[R]={};for(const N of s.sourceCaches[R].getVisibleCoordinates()){var y=this.terrain.sourceCache.getTerrainCoords(N);for(const G in y)this._coordsDescendingInv[R][G]||(this._coordsDescendingInv[R][G]=[]),this._coordsDescendingInv[R][G].push(y[G])}}this._coordsDescendingInvStr={};for(const R of s._order){var v=s._layers[R],T=v.source;if(El[v.type]&&!this._coordsDescendingInvStr[T]){this._coordsDescendingInvStr[T]={};for(const N in this._coordsDescendingInv[T])this._coordsDescendingInvStr[T][N]=this._coordsDescendingInv[T][N].map(G=>G.key).sort().join()}}for(const R of this._renderableTiles)for(const N in this._coordsDescendingInvStr){var P=this._coordsDescendingInvStr[N][R.tileID.key];P&&P!==R.rttCoords[N]&&(R.rtt=[])}}renderLayer(s){if(!s.isHidden(this.painter.transform.zoom)){var f=s.type,y=this.painter,v=this._renderableLayerIds[this._renderableLayerIds.length-1]===s.id;if(El[f]&&(this._prevType&&El[this._prevType]||this._stacks.push([]),this._prevType=f,this._stacks[this._stacks.length-1].push(s.id),!v))return!0;if(El[this._prevType]||El[f]&&v){this._prevType=f;var T=this._stacks.length-1,P=this._stacks[T]||[];for(const Z of this._renderableTiles){if(this.pool.isFull()&&(V0(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(Z),Z.rtt[T]){var R=this.pool.getObjectForId(Z.rtt[T].id);if(R.stamp===Z.rtt[T].stamp){this.pool.useObject(R);continue}}var N=this.pool.getOrCreateFreeObject();this.pool.useObject(N),this.pool.stampObject(N),Z.rtt[T]={id:N.id,stamp:N.stamp},y.context.bindFramebuffer.set(N.fbo.framebuffer),y.context.clear({color:o.Color.transparent,stencil:0}),y.currentStencilSource=void 0;for(let j=0;j<P.length;j++){const X=y.style._layers[P[j]];var G=X.source?this._coordsDescendingInv[X.source][Z.tileID.key]:[Z.tileID];y.context.viewport.set([0,0,N.fbo.width,N.fbo.height]),y._renderTileClippingMasks(X,G),y.renderLayer(y,y.style.sourceCaches[X.source],X,G),X.source&&(Z.rttCoords[X.source]=this._coordsDescendingInvStr[X.source][Z.tileID.key])}}return V0(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects(),El[f]}}return!1}}const uT={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use ⌘ + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},hT=l,dT={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:sy,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:o.config.MAX_TILE_CACHE_ZOOM_LEVELS,localIdeographFontFamily:"sans-serif",transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,validateStyle:!0,maxCanvasSize:[4096,4096]};or=class extends Q0{constructor(w){if(o.PerformanceUtils.mark(o.PerformanceMarkers.create),(w=o.extend({},dT,w)).minZoom!=null&&w.maxZoom!=null&&w.minZoom>w.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(w.minPitch!=null&&w.maxPitch!=null&&w.minPitch>w.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(w.minPitch!=null&&w.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(w.maxPitch!=null&&85<w.maxPitch)throw new Error("maxPitch must be less than or equal to 85");if(super(new as(w.minZoom,w.maxZoom,w.minPitch,w.maxPitch,w.renderWorldCopies),{bearingSnap:w.bearingSnap}),this._contextLost=f=>{f.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.fire(new o.Event("webglcontextlost",{originalEvent:f}))},this._contextRestored=f=>{this._setupPainter(),this.resize(),this._update(),this.fire(new o.Event("webglcontextrestored",{originalEvent:f}))},this._onMapScroll=f=>{if(f.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=w.interactive,this._maxTileCacheSize=w.maxTileCacheSize,this._maxTileCacheZoomLevels=w.maxTileCacheZoomLevels,this._failIfMajorPerformanceCaveat=w.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=w.preserveDrawingBuffer,this._antialias=w.antialias,this._trackResize=w.trackResize,this._bearingSnap=w.bearingSnap,this._refreshExpiredTiles=w.refreshExpiredTiles,this._fadeDuration=w.fadeDuration,this._crossSourceCollisions=w.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=w.collectResourceTiming,this._renderTaskQueue=new J0,this._controls=[],this._mapId=o.uniqueId(),this._locale=o.extend({},uT,w.locale),this._clickTolerance=w.clickTolerance,this._overridePixelRatio=w.pixelRatio,this._maxCanvasSize=w.maxCanvasSize,this.transformCameraUpdate=w.transformCameraUpdate,this._imageQueueHandle=a.addThrottleControl(()=>this.isMoving()),this._requestManager=new ee(w.transformRequest),typeof w.container=="string"){if(this._container=document.getElementById(w.container),!this._container)throw new Error(`Container '${w.container}' not found.`)}else{if(!(w.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=w.container}if(w.maxBounds&&this.setMaxBounds(w.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this.on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}),this.once("idle",()=>{this._idleTriggered=!0}),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let f=!1;const y=H0(v=>{this._trackResize&&!this._removed&&this.resize(v)._update()},50);this._resizeObserver=new ResizeObserver(v=>{f?y(v):f=!0}),this._resizeObserver.observe(this._container)}this.handlers=new X0(this,w);var s=typeof w.hash=="string"&&w.hash||void 0;this._hash=w.hash&&new ks(s).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:w.center,zoom:w.zoom,bearing:w.bearing,pitch:w.pitch}),w.bounds&&(this.resize(),this.fitBounds(w.bounds,o.extend({},w.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=w.localIdeographFontFamily,this._validateStyle=w.validateStyle,w.style&&this.setStyle(w.style,{localIdeographFontFamily:w.localIdeographFontFamily}),w.attributionControl&&this.addControl(new mp(typeof w.attributionControl=="boolean"?void 0:w.attributionControl)),w.maplibreLogo&&this.addControl(new cy,w.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",f=>{this._update(f.dataType==="style"),this.fire(new o.Event(f.dataType+"data",f))}),this.on("dataloading",f=>{this.fire(new o.Event(f.dataType+"dataloading",f))}),this.on("dataabort",f=>{this.fire(new o.Event("sourcedataabort",f))})}_getMapId(){return this._mapId}addControl(w,s){var f;return s===void 0&&(s=w.getDefaultPosition?w.getDefaultPosition():"top-right"),w&&w.onAdd?(f=w.onAdd(this),this._controls.push(w),w=this._controlPositions[s],s.indexOf("bottom")!==-1?w.insertBefore(f,w.firstChild):w.appendChild(f),this):this.fire(new o.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")))}removeControl(w){var s;return w&&w.onRemove?(-1<(s=this._controls.indexOf(w))&&this._controls.splice(s,1),w.onRemove(this),this):this.fire(new o.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")))}hasControl(w){return-1<this._controls.indexOf(w)}calculateCameraOptionsFromTo(w,s,f,y){return y==null&&this.terrain&&(y=this.terrain.getElevationForLngLatZoom(f,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(w,s,f,y)}resize(w){var f=this._containerDimensions(),s=f[0],f=f[1];const y=this._getClampedPixelRatio(s,f);if(this._resizeCanvas(s,f,y),this.painter.resize(s,f,y),this.painter.overLimit()){var v=this.painter.context.gl;this._maxCanvasSize=[v.drawingBufferWidth,v.drawingBufferHeight];const T=this._getClampedPixelRatio(s,f);this._resizeCanvas(s,f,T),this.painter.resize(s,f,T)}return this.transform.resize(s,f),(v=this._requestedCameraState)!=null&&v.resize(s,f),v=!this._moving,v&&(this.stop(),this.fire(new o.Event("movestart",w)).fire(new o.Event("move",w))),this.fire(new o.Event("resize",w)),v&&this.fire(new o.Event("moveend",w)),this}_getClampedPixelRatio(T,P){var{0:f,1:y}=this._maxCanvasSize,v=this.getPixelRatio(),T=T*v,P=P*v;return Math.min(f<T?f/T:1,y<P?y/P:1)*v}getPixelRatio(){var w;return(w=this._overridePixelRatio)!=null?w:devicePixelRatio}setPixelRatio(w){this._overridePixelRatio=w,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(w){return this.transform.setMaxBounds(B.convert(w)),this._update()}setMinZoom(w){if(-2<=(w=w??-2)&&w<=this.transform.maxZoom)return this.transform.minZoom=w,this._update(),this.getZoom()<w&&this.setZoom(w),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(w){if((w=w??22)>=this.transform.minZoom)return this.transform.maxZoom=w,this._update(),this.getZoom()>w&&this.setZoom(w),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(w){if((w=w??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(0<=w&&w<=this.transform.maxPitch)return this.transform.minPitch=w,this._update(),this.getPitch()<w&&this.setPitch(w),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(w){if(85<(w=w??60))throw new Error("maxPitch must be less than or equal to 85");if(w>=this.transform.minPitch)return this.transform.maxPitch=w,this._update(),this.getPitch()>w&&this.setPitch(w),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(w){return this.transform.renderWorldCopies=w,this._update()}project(w){return this.transform.locationPoint(o.LngLat.convert(w),this.style&&this.terrain)}unproject(w){return this.transform.pointLocation(o.Point.convert(w),this.terrain)}isMoving(){var w;return this._moving||((w=this.handlers)==null?void 0:w.isMoving())}isZooming(){var w;return this._zooming||((w=this.handlers)==null?void 0:w.isZooming())}isRotating(){var w;return this._rotating||((w=this.handlers)==null?void 0:w.isRotating())}_createDelegatedListener(w,s,f){if(w==="mouseenter"||w==="mouseover"){let y=!1;return{layer:s,listener:f,delegates:{mousemove:v=>{var T=this.getLayer(s)?this.queryRenderedFeatures(v.point,{layers:[s]}):[];T.length?y||(y=!0,f.call(this,new ya(w,this,v.originalEvent,{features:T}))):y=!1},mouseout:()=>{y=!1}}}}if(w!=="mouseleave"&&w!=="mouseout")return{layer:s,listener:f,delegates:{[w]:y=>{var v=this.getLayer(s)?this.queryRenderedFeatures(y.point,{layers:[s]}):[];v.length&&(y.features=v,f.call(this,y),delete y.features)}}};{let y=!1;return{layer:s,listener:f,delegates:{mousemove:v=>{(this.getLayer(s)?this.queryRenderedFeatures(v.point,{layers:[s]}):[]).length?y=!0:y&&(y=!1,f.call(this,new ya(w,this,v.originalEvent)))},mouseout:v=>{y&&(y=!1,f.call(this,new ya(w,this,v.originalEvent)))}}}}}on(w,s,f){if(f===void 0)return super.on(w,s);var y=this._createDelegatedListener(w,s,f);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[w]=this._delegatedListeners[w]||[],this._delegatedListeners[w].push(y);for(const v in y.delegates)this.on(v,y.delegates[v]);return this}once(w,s,f){if(f===void 0)return super.once(w,s);var y=this._createDelegatedListener(w,s,f);for(const v in y.delegates)this.once(v,y.delegates[v]);return this}off(w,s,f){return f===void 0?super.off(w,s):(this._delegatedListeners&&this._delegatedListeners[w]&&(y=>{var v=y[w];for(let P=0;P<v.length;P++){var T=v[P];if(T.layer===s&&T.listener===f){for(const R in T.delegates)this.off(R,T.delegates[R]);return v.splice(P,1),this}}})(this._delegatedListeners),this)}queryRenderedFeatures(w,s){if(!this.style)return[];let f;var y=w instanceof o.Point||Array.isArray(w),v=y?w:[[0,0],[this.transform.width,this.transform.height]];return s=s||(y?{}:w)||{},f=v instanceof o.Point||typeof v[0]=="number"?[o.Point.convert(v)]:(y=o.Point.convert(v[0]),w=o.Point.convert(v[1]),[y,new o.Point(w.x,y.y),w,new o.Point(y.x,w.y),y]),this.style.queryRenderedFeatures(f,s,this.transform)}querySourceFeatures(w,s){return this.style.querySourceFeatures(w,s)}setStyle(w,s){return(s=o.extend({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},s)).diff!==!1&&s.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&w?(this._diffStyle(w,s),this):(this._localIdeographFontFamily=s.localIdeographFontFamily,this._updateStyle(w,s))}setTransformRequest(w){return this._requestManager.setTransformRequest(w),this}_getUIString(w){var s=this._locale[w];if(s==null)throw new Error(`Missing UI string '${w}'`);return s}_updateStyle(w,s){var f;if(!s.transformStyle||!this.style||this.style._loaded)return f=this.style&&s.transformStyle?this.style.serialize():void 0,this.style&&(this.style.setEventedParent(null),this.style._remove(!w)),w?(this.style=new Rs(this,s||{}),this.style.setEventedParent(this,{style:this.style}),typeof w=="string"?this.style.loadURL(w,s,f):this.style.loadJSON(w,s,f)):delete this.style,this;this.style.once("style.load",()=>this._updateStyle(w,s))}_lazyInitEmptyStyle(){this.style||(this.style=new Rs(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(w,s){var f;typeof w=="string"?(f=this._requestManager.transformRequest(w,"Style"),o.getJSON(f,new AbortController).then(y=>{this._updateDiff(y.data,s)}).catch(y=>{y&&this.fire(new o.ErrorEvent(y))})):typeof w=="object"&&this._updateDiff(w,s)}_updateDiff(w,s){try{this.style.setState(w,s)&&this._update(!0)}catch(f){o.warnOnce(`Unable to perform style diff: ${f.message||f.error||f}.  Rebuilding the style from scratch.`),this._updateStyle(w,s)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():o.warnOnce("There is no style added to the map.")}addSource(w,s){return this._lazyInitEmptyStyle(),this.style.addSource(w,s),this._update(!0)}isSourceLoaded(w){var s=this.style&&this.style.sourceCaches[w];if(s!==void 0)return s.loaded();this.fire(new o.ErrorEvent(new Error(`There is no source with ID '${w}'`)))}setTerrain(w){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),w){var s=this.style.sourceCaches[w.source];if(!s)throw new Error("cannot load terrain, because there exists no source with ID: "+w.source);this.terrain===null&&s.reload();for(const y in this.style._layers){var f=this.style._layers[y];f.type==="hillshade"&&f.source===w.source&&o.warnOnce("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new tb(this.painter,s,w),this.painter.renderToTexture=new rb(this.painter,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._terrainDataCallback=y=>{y.dataType==="style"?this.terrain.sourceCache.freeRtt():y.dataType==="source"&&y.tile&&(y.sourceId!==w.source||this._elevationFreeze||(this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.terrain.sourceCache.freeRtt(y.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.minElevationForCurrentTile=0,this.transform.elevation=0;return this.fire(new o.Event("terrain",{terrain:w})),this}getTerrain(){var w;return(w=(w=this.terrain)==null?void 0:w.options)!=null?w:null}areTilesLoaded(){var w=this.style&&this.style.sourceCaches;for(const y in w){var s=w[y]._tiles;for(const v in s){var f=s[v];if(f.state!=="loaded"&&f.state!=="errored")return!1}}return!0}removeSource(w){return this.style.removeSource(w),this._update(!0)}getSource(w){return this.style.getSource(w)}addImage(w,s,R={}){var y,v,T,P,{pixelRatio:R=1,sdf:N=!1,stretchX:G,stretchY:Z,content:j,contentMatch:X}=R;if(this._lazyInitEmptyStyle(),!(s instanceof HTMLImageElement||o.isImageBitmap(s)))return s.width===void 0||s.height===void 0?this.fire(new o.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`"))):({width:y,height:v,data:T}=s,P=s,this.style.addImage(w,{data:new o.RGBAImage({width:y,height:v},new Uint8Array(T)),pixelRatio:R,stretchX:G,stretchY:Z,content:j,contentMatch:X,sdf:N,version:0,userImage:P}),P.onAdd&&P.onAdd(this,w),this);({width:y,height:v,data:T}=g.getImageData(s)),this.style.addImage(w,{data:new o.RGBAImage({width:y,height:v},T),pixelRatio:R,stretchX:G,stretchY:Z,content:j,contentMatch:X,sdf:N,version:0})}updateImage(w,s){var f,y,v,T=this.style.getImage(w);return T?({width:v,height:f,data:y}=s instanceof HTMLImageElement||o.isImageBitmap(s)?g.getImageData(s):s,v===void 0||f===void 0?this.fire(new o.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`"))):v!==T.data.width||f!==T.data.height?this.fire(new o.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image"))):(v=!(s instanceof HTMLImageElement||o.isImageBitmap(s)),T.data.replace(y,v),this.style.updateImage(w,T),this)):this.fire(new o.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")))}getImage(w){return this.style.getImage(w)}hasImage(w){return w?!!this.style.getImage(w):(this.fire(new o.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(w){this.style.removeImage(w)}loadImage(w){return a.getImage(this._requestManager.transformRequest(w,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(w,s){return this._lazyInitEmptyStyle(),this.style.addLayer(w,s),this._update(!0)}moveLayer(w,s){return this.style.moveLayer(w,s),this._update(!0)}removeLayer(w){return this.style.removeLayer(w),this._update(!0)}getLayer(w){return this.style.getLayer(w)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(w,s,f){return this.style.setLayerZoomRange(w,s,f),this._update(!0)}setFilter(w,s,f={}){return this.style.setFilter(w,s,f),this._update(!0)}getFilter(w){return this.style.getFilter(w)}setPaintProperty(w,s,f,y={}){return this.style.setPaintProperty(w,s,f,y),this._update(!0)}getPaintProperty(w,s){return this.style.getPaintProperty(w,s)}setLayoutProperty(w,s,f,y={}){return this.style.setLayoutProperty(w,s,f,y),this._update(!0)}getLayoutProperty(w,s){return this.style.getLayoutProperty(w,s)}setGlyphs(w,s={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(w,s),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(w,s,f={}){return this._lazyInitEmptyStyle(),this.style.addSprite(w,s,f,y=>{y||this._update(!0)}),this}removeSprite(w){return this._lazyInitEmptyStyle(),this.style.removeSprite(w),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(w,s={}){return this._lazyInitEmptyStyle(),this.style.setSprite(w,s,f=>{f||this._update(!0)}),this}setLight(w,s={}){return this._lazyInitEmptyStyle(),this.style.setLight(w,s),this._update(!0)}getLight(){return this.style.getLight()}setFeatureState(w,s){return this.style.setFeatureState(w,s),this._update()}removeFeatureState(w,s){return this.style.removeFeatureState(w,s),this._update()}getFeatureState(w){return this.style.getFeatureState(w)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let w=0,s=0;return this._container&&(w=this._container.clientWidth||400,s=this._container.clientHeight||300),[w,s]}_setupContainer(){var w=this._container,s=(w.classList.add("maplibregl-map"),this._canvasContainer=_.create("div","maplibregl-canvas-container",w)),s=(this._interactive&&s.classList.add("maplibregl-interactive"),this._canvas=_.create("canvas","maplibregl-canvas",s),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region"),this._containerDimensions()),f=this._getClampedPixelRatio(s[0],s[1]);this._resizeCanvas(s[0],s[1],f);const y=this._controlContainer=_.create("div","maplibregl-control-container",w),v=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(T=>{v[T]=_.create("div",`maplibregl-ctrl-${T} `,y)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(w,s,f){this._canvas.width=Math.floor(f*w),this._canvas.height=Math.floor(f*s),this._canvas.style.width=w+"px",this._canvas.style.height=s+"px"}_setupPainter(){const w={alpha:!0,stencil:!0,depth:!0,failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1};let s=null;this._canvas.addEventListener("webglcontextcreationerror",v=>{s={requestedAttributes:w},v&&(s.statusMessage=v.statusMessage,s.type=v.type)},{once:!0});var f,y=this._canvas.getContext("webgl2",w)||this._canvas.getContext("webgl",w);if(!y)throw f="Failed to initialize WebGL",s?(s.message=f,new Error(JSON.stringify(s))):new Error(f);this.painter=new rT(y,this.transform),x.testSupport(y)}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(w){return this.style&&this.style._loaded&&(this._styleDirty=this._styleDirty||w,this._sourcesDirty=!0,this.triggerRepaint()),this}_requestRenderFrame(w){return this._update(),this._renderTaskQueue.add(w)}_cancelRenderFrame(w){this._renderTaskQueue.remove(w)}_render(w){var s=this._idleTriggered?this._fadeDuration:0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(w),!this._removed){let y=!1;this.style&&this._styleDirty&&(this._styleDirty=!1,w=this.transform.zoom,f=g.now(),this.style.zoomHistory.update(w,f),(f=(w=new o.EvaluationParameters(w,{now:f,fadeDuration:s,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()})).crossFadingFactor())===1&&f===this._crossFadingFactor||(y=!0,this._crossFadingFactor=f),this.style.update(w)),this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._elevationFreeze||(this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.minElevationForCurrentTile=0,this.transform.elevation=0),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,s,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:s,showPadding:this.showPadding}),this.fire(new o.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,o.PerformanceUtils.mark(o.PerformanceMarkers.load),this.fire(new o.Event("load"))),this.style&&(this.style.hasTransitions()||y)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();var f=this._sourcesDirty||this._styleDirty||this._placementDirty;return f||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new o.Event("idle")),!this._loaded||this._fullyLoaded||f||(this._fullyLoaded=!0,o.PerformanceUtils.mark(o.PerformanceMarkers.fullLoad)),this}}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){this._hash&&this._hash.remove();for(const s of this._controls)s.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),a.removeThrottleControl(this._imageQueueHandle),(w=this._resizeObserver)!=null&&w.disconnect();var w=this.painter.context.gl.getExtension("WEBGL_lose_context");w&&w.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),_.remove(this._canvasContainer),_.remove(this._controlContainer),this._container.classList.remove("maplibregl-map"),o.PerformanceUtils.clearMetrics(),this._removed=!0,this.fire(new o.Event("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,g.frameAsync(this._frameRequest).then(w=>{o.PerformanceUtils.frame(w),this._frameRequest=null,this._render(w)}).catch(()=>{}))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(w){this._showTileBoundaries!==w&&(this._showTileBoundaries=w,this._update())}get showPadding(){return!!this._showPadding}set showPadding(w){this._showPadding!==w&&(this._showPadding=w,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(w){this._showCollisionBoxes!==w&&((this._showCollisionBoxes=w)?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(w){this._showOverdrawInspector!==w&&(this._showOverdrawInspector=w,this._update())}get repaint(){return!!this._repaint}set repaint(w){this._repaint!==w&&(this._repaint=w,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(w){this._vertices=w,this._update()}get version(){return hT}getCameraTargetElevation(){return this.transform.elevation}};const ib=w=>{w.touchstart=w.dragStart,w.touchmoveWindow=w.dragMove,w.touchend=w.dragEnd},fT=({enable:w,clickTolerance:s,bearingDegreesPerPixelMoved:f=.8})=>{var y=new $0;return new zr({clickTolerance:s,move:(v,T)=>({bearingDelta:(T.x-v.x)*f}),moveStateManager:y,enable:w,assignEvents:ib})},pT=({enable:w,clickTolerance:s,pitchDegreesPerPixelMoved:f=-.5})=>{var y=new $0;return new zr({clickTolerance:s,move:(v,T)=>({pitchDelta:(T.y-v.y)*f}),moveStateManager:y,enable:w,assignEvents:ib})},gT={showCompass:!0,showZoom:!0,visualizePitch:!1};class mT{constructor(s,f,y=!1){this.mousedown=P=>{this.startMouse(o.extend({},P,{ctrlKey:!0,preventDefault:()=>P.preventDefault()}),_.mousePos(this.element,P)),_.addEventListener(window,"mousemove",this.mousemove),_.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=P=>{this.moveMouse(P,_.mousePos(this.element,P))},this.mouseup=P=>{this.mouseRotate.dragEnd(P),this.mousePitch&&this.mousePitch.dragEnd(P),this.offTemp()},this.touchstart=P=>{P.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=_.touchPos(this.element,P.targetTouches)[0],this.startTouch(P,this._startPos),_.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),_.addEventListener(window,"touchend",this.touchend))},this.touchmove=P=>{P.targetTouches.length!==1?this.reset():(this._lastPos=_.touchPos(this.element,P.targetTouches)[0],this.moveTouch(P,this._lastPos))},this.touchend=P=>{P.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),this.touchRotate.reset(),this.touchPitch&&this.touchPitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10;var v=s.dragRotate._mouseRotate.getClickTolerance(),T=s.dragRotate._mousePitch.getClickTolerance();this.element=f,this.mouseRotate=ss({clickTolerance:v,enable:!0}),this.touchRotate=fT({clickTolerance:v,enable:!0}),this.map=s,y&&(this.mousePitch=hp({clickTolerance:T,enable:!0}),this.touchPitch=pT({clickTolerance:T,enable:!0})),_.addEventListener(f,"mousedown",this.mousedown),_.addEventListener(f,"touchstart",this.touchstart,{passive:!1}),_.addEventListener(f,"touchcancel",this.reset)}startMouse(s,f){this.mouseRotate.dragStart(s,f),this.mousePitch&&this.mousePitch.dragStart(s,f),_.disableDrag()}startTouch(s,f){this.touchRotate.dragStart(s,f),this.touchPitch&&this.touchPitch.dragStart(s,f),_.disableDrag()}moveMouse(s,f){var y=this.map,v=(this.mouseRotate.dragMove(s,f)||{}).bearingDelta;v&&y.setBearing(y.getBearing()+v),this.mousePitch&&(v=(this.mousePitch.dragMove(s,f)||{}).pitchDelta,v)&&y.setPitch(y.getPitch()+v)}moveTouch(s,f){var y=this.map,v=(this.touchRotate.dragMove(s,f)||{}).bearingDelta;v&&y.setBearing(y.getBearing()+v),this.touchPitch&&(v=(this.touchPitch.dragMove(s,f)||{}).pitchDelta,v)&&y.setPitch(y.getPitch()+v)}off(){var s=this.element;_.removeEventListener(s,"mousedown",this.mousedown),_.removeEventListener(s,"touchstart",this.touchstart,{passive:!1}),_.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),_.removeEventListener(window,"touchend",this.touchend),_.removeEventListener(s,"touchcancel",this.reset),this.offTemp()}offTemp(){_.enableDrag(),_.removeEventListener(window,"mousemove",this.mousemove),_.removeEventListener(window,"mouseup",this.mouseup),_.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),_.removeEventListener(window,"touchend",this.touchend)}}let ld;function yT(){return o.__awaiter(this,arguments,void 0,function*(w=!1){if(ld===void 0||w){if(window.navigator.permissions===void 0)return ld=!!window.navigator.geolocation;try{var s=yield window.navigator.permissions.query({name:"geolocation"});ld=s.state!=="denied"}catch{ld=!!window.navigator.geolocation}}return ld})}function ob(w,s,f){var y,v,T,P=new o.LngLat(w.lng,w.lat);for(w=new o.LngLat(w.lng,w.lat),s&&(y=new o.LngLat(w.lng-360,w.lat),v=new o.LngLat(w.lng+360,w.lat),T=f.locationPoint(w).distSqr(s),f.locationPoint(y).distSqr(s)<T?w=y:f.locationPoint(v).distSqr(s)<T&&(w=v));180<Math.abs(w.lng-f.center.lng);){var R=f.locationPoint(w);if(0<=R.x&&0<=R.y&&R.x<=f.width&&R.y<=f.height)break;w.lng>f.center.lng?w.lng-=360:w.lng+=360}return w.lng!==P.lng&&f.locationPoint(w).y>f.height/2-f.getHorizon()?w:P}const uy={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function ab(w,s,f){var y=w.classList;for(const v in uy)y.remove(`maplibregl-${f}-anchor-`+v);y.add(`maplibregl-${f}-anchor-`+s)}class sb extends o.Evented{constructor(s){if(super(),this._onKeyPress=ye=>{var ge=ye.code,ye=ye.charCode||ye.keyCode;ge!=="Space"&&ge!=="Enter"&&ye!==32&&ye!==13||this.togglePopup()},this._onMapClick=ge=>{var ge=ge.originalEvent.target,ye=this._element;this._popup&&(ge===ye||ye.contains(ge))&&this.togglePopup()},this._update=X=>{if(this._map){var ge=this._map.loaded()&&!this._map.isMoving();(X==null?void 0:X.type)!=="terrain"&&((X==null?void 0:X.type)!=="render"||ge)||this._map.once("render",this._update),this._map.transform.renderWorldCopies?this._lngLat=ob(this._lngLat,this._flatPos,this._map.transform):this._lngLat=(ge=this._lngLat)==null?void 0:ge.wrap(),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationPoint(this._lngLat)._add(this._offset));let ye="",be=(this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?ye=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(ye=`rotateZ(${this._rotation-this._map.getBearing()}deg)`),"");this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?be="rotateX(0deg)":this._pitchAlignment==="map"&&(be=`rotateX(${this._map.getPitch()}deg)`),X&&X.type!=="moveend"||(this._pos=this._pos.round()),_.setTransform(this._element,`${uy[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${be} `+ye),g.frameAsync(new AbortController).then(()=>{this._updateOpacity(X&&X.type==="moveend")}).catch(()=>{})}},this._onMove=X=>{var ge;this._isDragging||(ge=this._clickTolerance||this._map._clickTolerance,this._isDragging=X.point.dist(this._pointerdownPos)>=ge),this._isDragging&&(this._pos=X.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new o.Event("dragstart"))),this.fire(new o.Event("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new o.Event("dragend")),this._state="inactive"},this._addDragHandler=X=>{this._element.contains(X.originalEvent.target)&&(X.preventDefault(),this._positionDelta=X.point.sub(this._pos).add(this._offset),this._pointerdownPos=X.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=s&&s.anchor||"center",this._color=s&&s.color||"#3FB1CE",this._scale=s&&s.scale||1,this._draggable=s&&s.draggable||!1,this._clickTolerance=s&&s.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=s&&s.rotation||0,this._rotationAlignment=s&&s.rotationAlignment||"auto",this._pitchAlignment=s&&s.pitchAlignment&&s.pitchAlignment!=="auto"?s.pitchAlignment:this._rotationAlignment,this.setOpacity(),this.setOpacity(s==null?void 0:s.opacity,s==null?void 0:s.opacityWhenCovered),s&&s.element)this._element=s.element,this._offset=o.Point.convert(s&&s.offset||[0,0]);else{this._defaultMarker=!0,this._element=_.create("div"),this._element.setAttribute("aria-label","Map marker");var f=_.createNS("http://www.w3.org/2000/svg","svg"),y=(f.setAttributeNS(null,"display","block"),f.setAttributeNS(null,"height","41px"),f.setAttributeNS(null,"width","27px"),f.setAttributeNS(null,"viewBox","0 0 27 41"),_.createNS("http://www.w3.org/2000/svg","g")),y=(y.setAttributeNS(null,"stroke","none"),y.setAttributeNS(null,"stroke-width","1"),y.setAttributeNS(null,"fill","none"),y.setAttributeNS(null,"fill-rule","evenodd"),_.createNS("http://www.w3.org/2000/svg","g")),v=(y.setAttributeNS(null,"fill-rule","nonzero"),_.createNS("http://www.w3.org/2000/svg","g")),P=(v.setAttributeNS(null,"transform","translate(3.0, 29.0)"),v.setAttributeNS(null,"fill","#000000"),[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}]);for(const X of P){var T=_.createNS("http://www.w3.org/2000/svg","ellipse");T.setAttributeNS(null,"opacity","0.04"),T.setAttributeNS(null,"cx","10.5"),T.setAttributeNS(null,"cy","5.80029008"),T.setAttributeNS(null,"rx",X.rx),T.setAttributeNS(null,"ry",X.ry),v.appendChild(T)}var P=_.createNS("http://www.w3.org/2000/svg","g"),R=(P.setAttributeNS(null,"fill",this._color),_.createNS("http://www.w3.org/2000/svg","path")),R=(R.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),P.appendChild(R),_.createNS("http://www.w3.org/2000/svg","g")),N=(R.setAttributeNS(null,"opacity","0.25"),R.setAttributeNS(null,"fill","#000000"),_.createNS("http://www.w3.org/2000/svg","path")),N=(N.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),R.appendChild(N),_.createNS("http://www.w3.org/2000/svg","g")),G=(N.setAttributeNS(null,"transform","translate(6.0, 7.0)"),N.setAttributeNS(null,"fill","#FFFFFF"),_.createNS("http://www.w3.org/2000/svg","g")),Z=(G.setAttributeNS(null,"transform","translate(8.0, 8.0)"),_.createNS("http://www.w3.org/2000/svg","circle")),j=(Z.setAttributeNS(null,"fill","#000000"),Z.setAttributeNS(null,"opacity","0.25"),Z.setAttributeNS(null,"cx","5.5"),Z.setAttributeNS(null,"cy","5.5"),Z.setAttributeNS(null,"r","5.4999962"),_.createNS("http://www.w3.org/2000/svg","circle"));j.setAttributeNS(null,"fill","#FFFFFF"),j.setAttributeNS(null,"cx","5.5"),j.setAttributeNS(null,"cy","5.5"),j.setAttributeNS(null,"r","5.4999962"),G.appendChild(Z),G.appendChild(j),y.appendChild(v),y.appendChild(P),y.appendChild(R),y.appendChild(N),y.appendChild(G),f.appendChild(y),f.setAttributeNS(null,"height",41*this._scale+"px"),f.setAttributeNS(null,"width",27*this._scale+"px"),this._element.appendChild(f),this._offset=o.Point.convert(s&&s.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",X=>{X.preventDefault()}),this._element.addEventListener("mousedown",X=>{X.preventDefault()}),ab(this._element,this._anchor,"marker"),s&&s.className)for(const X of s.className.split(" "))this._element.classList.add(X);this._popup=null}addTo(s){return this.remove(),(this._map=s).getCanvasContainer().appendChild(this._element),s.on("move",this._update),s.on("moveend",this._update),s.on("terrain",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),_.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(s){return this._lngLat=o.LngLat.convert(s),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(s){var f;return this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),s&&("offset"in s.options||(f=Math.abs(13.5)/Math.SQRT2,s.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[f,-1*(24.6+f)],"bottom-right":[-f,-1*(24.6+f)],left:[13.5,-24.6],right:[-13.5,-24.6]}:this._offset),this._popup=s,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)),this}getPopup(){return this._popup}togglePopup(){var s=this._popup;return this._element.style.opacity!==this._opacityWhenCovered&&s&&(s.isOpen()?s.remove():(s.setLngLat(this._lngLat),s.addTo(this._map))),this}_updateOpacity(s=!1){if((y=this._map)!=null&&y.terrain){if(s)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout(()=>{this._opacityTimeout=null},100)}var f,y=this._map,s=y.terrain.depthAtPoint(this._pos),v=y.terrain.getElevationForLngLatZoom(this._lngLat,y.transform.tileZoom);y.transform.lngLatToCameraDepth(this._lngLat,v)-s<.006?this._element.style.opacity=this._opacity:(s=-this._offset.y/y.transform._pixelPerMeter,s=Math.sin(y.getPitch()*Math.PI/180)*s,f=y.terrain.depthAtPoint(new o.Point(this._pos.x,this._pos.y-this._offset.y)),y=.006<y.transform.lngLatToCameraDepth(this._lngLat,v+s)-f,(v=this._popup)!=null&&v.isOpen()&&y&&this._popup.remove(),this._element.style.opacity=y?this._opacityWhenCovered:this._opacity)}else this._element.style.opacity!==this._opacity&&(this._element.style.opacity=this._opacity)}getOffset(){return this._offset}setOffset(s){return this._offset=o.Point.convert(s),this._update(),this}addClassName(s){this._element.classList.add(s)}removeClassName(s){this._element.classList.remove(s)}toggleClassName(s){return this._element.classList.toggle(s)}setDraggable(s){return this._draggable=!!s,this._map&&(s?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(s){return this._rotation=s||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(s){return this._rotationAlignment=s||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(s){return this._pitchAlignment=s&&s!=="auto"?s:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(s,f){return s===void 0&&f===void 0&&(this._opacity="1",this._opacityWhenCovered="0.2"),s!==void 0&&(this._opacity=s),f!==void 0&&(this._opacityWhenCovered=f),this._map&&this._updateOpacity(!0),this}}const IR={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let hy=0,dy=!1;class PR extends o.Evented{constructor(s){super(),this._onSuccess=f=>{if(this._map){if(this._isOutOfMapMaxBounds(f))this._setErrorState(),this.fire(new o.Event("outofmaxbounds",f)),this._updateMarker();else{if(this.options.trackUserLocation)switch(this._lastKnownPosition=f,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error("Unexpected watchState "+this._watchState)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(f),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(f),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new o.Event("geolocate",f))}this._finish()}},this._updateCamera=y=>{var T=new o.LngLat(y.coords.longitude,y.coords.latitude),y=y.coords.accuracy,v=this._map.getBearing(),v=o.extend({bearing:v},this.options.fitBoundsOptions),T=B.fromLngLat(T,y);this._map.fitBounds(T,v,{geolocateSource:!0})},this._updateMarker=f=>{var y;f?(y=new o.LngLat(f.coords.longitude,f.coords.latitude),this._accuracyCircleMarker.setLngLat(y).addTo(this._map),this._userLocationDotMarker.setLngLat(y).addTo(this._map),this._accuracy=f.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()):(this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove())},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=f=>{if(this._map){if(this.options.trackUserLocation)if(f.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;var y=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=y,this._geolocateButton.setAttribute("aria-label",y),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(f.code===3&&dy)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new o.Event("error",f)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=f=>{this._map&&(this._container.addEventListener("contextmenu",y=>y.preventDefault()),this._geolocateButton=_.create("button","maplibregl-ctrl-geolocate",this._container),_.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),!(this._geolocateButton.type="button")===f?(o.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled."),f=this._map._getUIString("GeolocateControl.LocationNotAvailable"),this._geolocateButton.disabled=!0,this._geolocateButton.title=f,this._geolocateButton.setAttribute("aria-label",f)):(f=this._map._getUIString("GeolocateControl.FindMyLocation"),this._geolocateButton.title=f,this._geolocateButton.setAttribute("aria-label",f)),this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=_.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new sb({element:this._dotElement}),this._circleElement=_.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new sb({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",()=>this.trigger()),this._setup=!0,this.options.trackUserLocation)&&this._map.on("movestart",y=>{var v=y.originalEvent&&y.originalEvent.type==="resize";y.geolocateSource||this._watchState!=="ACTIVE_LOCK"||v||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new o.Event("trackuserlocationend")))})},this.options=o.extend({},IR,s)}onAdd(s){return this._map=s,this._container=_.create("div","maplibregl-ctrl maplibregl-ctrl-group"),yT().then(f=>this._setupUI(f)),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),_.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,hy=0,dy=!1}_isOutOfMapMaxBounds(y){var f=this._map.getMaxBounds(),y=y.coords;return f&&(y.longitude<f.getWest()||y.longitude>f.getEast()||y.latitude<f.getSouth()||y.latitude>f.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error("Unexpected watchState "+this._watchState)}}_updateCircleRadius(){var s=this._map.getBounds(),f=s.getSouthEast(),s=s.getNorthEast(),f=f.distanceTo(s),s=this._map._container.clientHeight,f=Math.ceil(this._accuracy/(f/s)*2);this._circleElement.style.width=f+"px",this._circleElement.style.height=f+"px"}trigger(){if(!this._setup)return o.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new o.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":hy--,dy=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new o.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new o.Event("trackuserlocationstart"));break;default:throw new Error("Unexpected watchState "+this._watchState)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error("Unexpected watchState "+this._watchState)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),hy++;let s;dy=1<hy?(s={maximumAge:6e5,timeout:0},!0):(s=this.options.positionOptions,!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,s)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}}const ud={maxWidth:100,unit:"metric"};function _T(w,s,f){var y=f&&f.maxWidth||100,v=w._container.clientHeight/2,T=w.unproject([0,v]),v=w.unproject([y,v]),T=T.distanceTo(v);f&&f.unit==="imperial"?5280<(v=3.2808*T)?yp(s,y,v/5280,w._getUIString("ScaleControl.Miles")):yp(s,y,v,w._getUIString("ScaleControl.Feet")):f&&f.unit==="nautical"?yp(s,y,T/1852,w._getUIString("ScaleControl.NauticalMiles")):1e3<=T?yp(s,y,T/1e3,w._getUIString("ScaleControl.Kilometers")):yp(s,y,T,w._getUIString("ScaleControl.Meters"))}function yp(w,s,f,y){var v=function(T){var P=Math.pow(10,(""+Math.floor(T)).length-1);return T/=P,T=10<=T?10:5<=T?5:3<=T?3:2<=T?2:1<=T?1:function(R){var N=Math.pow(10,Math.ceil(-Math.log(R)/Math.LN10));return Math.round(R*N)/N}(T),P*T}(f);w.style.width=s*(v/f)+"px",w.innerHTML=v+"&nbsp;"+y}class MR extends o.Evented{constructor(s={}){super(),this._onFullscreenChange=()=>{var f;let y=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;(f=y==null?void 0:y.shadowRoot)!=null&&f.fullscreenElement;)y=y.shadowRoot.fullscreenElement;y===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,s&&s.container&&(s.container instanceof HTMLElement?this._container=s.container:o.warnOnce("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(s){return this._map=s,this._container||(this._container=this._map.getContainer()),this._controlContainer=_.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){_.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){var s=this._fullscreenButton=_.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);_.create("span","maplibregl-ctrl-icon",s).setAttribute("aria-hidden","true"),s.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){var s=this._getTitle();this._fullscreenButton.setAttribute("aria-label",s),this._fullscreenButton.title=s}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new o.Event("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new o.Event("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}}const vT={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1},RR=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");class hd extends o.Evented{constructor(s){super(),this.remove=()=>(this._content&&_.remove(this._content),this._container&&(_.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new o.Event("close"))),this),this._onMouseUp=f=>{this._update(f.point)},this._onMouseMove=f=>{this._update(f.point)},this._onDrag=f=>{this._update(f.point)},this._update=f=>{var y=this._lngLat||this._trackPointer;if(this._map&&y&&this._content){if(!this._container){if(this._container=_.create("div","maplibregl-popup",this._map.getContainer()),this._tip=_.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const P of this.options.className.split(" "))this._container.classList.add(P);this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer?this._lngLat=ob(this._lngLat,this._flatPos,this._map.transform):this._lngLat=(y=this._lngLat)==null?void 0:y.wrap(),!this._trackPointer||f){y=this._flatPos=this._pos=this._trackPointer&&f?f:this._map.project(this._lngLat),this._map.terrain&&(this._flatPos=this._trackPointer&&f?f:this._map.transform.locationPoint(this._lngLat));let P=this.options.anchor;if(f=fy(this.options.offset),!P){var v=this._container.offsetWidth,T=this._container.offsetHeight;let N;N=y.y+f.bottom.y<T?["top"]:y.y>this._map.transform.height-T?["bottom"]:[],y.x<v/2?N.push("left"):y.x>this._map.transform.width-v/2&&N.push("right"),P=N.length===0?"bottom":N.join("-")}let R=y.add(f[P]);this.options.subpixelPositioning||(R=R.round()),_.setTransform(this._container,`${uy[P]} translate(${R.x}px,${R.y}px)`),ab(this._container,P,"popup")}}},this._onClose=()=>{this.remove()},this.options=o.extend(Object.create(vT),s)}addTo(s){return this._map&&this.remove(),this._map=s,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new o.Event("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(s){return this._lngLat=o.LngLat.convert(s),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(s){return this.setDOMContent(document.createTextNode(s))}setHTML(s){var f,y=document.createDocumentFragment(),v=document.createElement("body");for(v.innerHTML=s;f=v.firstChild;)y.appendChild(f);return this.setDOMContent(y)}getMaxWidth(){var s;return(s=this._container)==null?void 0:s.style.maxWidth}setMaxWidth(s){return this.options.maxWidth=s,this._update(),this}setDOMContent(s){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=_.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(s),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(s){this._container&&this._container.classList.add(s)}removeClassName(s){this._container&&this._container.classList.remove(s)}setOffset(s){return this.options.offset=s,this._update(),this}toggleClassName(s){if(this._container)return this._container.classList.toggle(s)}setSubpixelPositioning(s){this.options.subpixelPositioning=s}_createCloseButton(){this.options.closeButton&&(this._closeButton=_.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){var s;this.options.focusAfterOpen&&this._container&&(s=this._container.querySelector(RR))&&s.focus()}}function fy(w){var s;return w?typeof w=="number"?(s=Math.round(Math.abs(w)/Math.SQRT2),{center:new o.Point(0,0),top:new o.Point(0,w),"top-left":new o.Point(s,s),"top-right":new o.Point(-s,s),bottom:new o.Point(0,-w),"bottom-left":new o.Point(s,-s),"bottom-right":new o.Point(-s,-s),left:new o.Point(w,0),right:new o.Point(-w,0)}):w instanceof o.Point||Array.isArray(w)?{center:s=o.Point.convert(w),top:s,"top-left":s,"top-right":s,bottom:s,"bottom-left":s,"bottom-right":s,left:s,right:s}:{center:o.Point.convert(w.center||[0,0]),top:o.Point.convert(w.top||[0,0]),"top-left":o.Point.convert(w["top-left"]||[0,0]),"top-right":o.Point.convert(w["top-right"]||[0,0]),bottom:o.Point.convert(w.bottom||[0,0]),"bottom-left":o.Point.convert(w["bottom-left"]||[0,0]),"bottom-right":o.Point.convert(w["bottom-right"]||[0,0]),left:o.Point.convert(w.left||[0,0]),right:o.Point.convert(w.right||[0,0])}:fy(new o.Point(0,0))}const kR=l;i.AJAXError=o.AJAXError,i.Evented=o.Evented,i.LngLat=o.LngLat,i.MercatorCoordinate=o.MercatorCoordinate,i.Point=o.Point,i.addProtocol=o.addProtocol,i.config=o.config,i.removeProtocol=o.removeProtocol,i.AttributionControl=mp,i.BoxZoomHandler=aT,i.CanvasSource=Et,i.CooperativeGesturesHandler=ay,i.DoubleClickZoomHandler=pp,i.DragPanHandler=iy,i.DragRotateHandler=sd,i.EdgeInsets=sp,i.FullscreenControl=MR,i.GeoJSONSource=q,i.GeolocateControl=PR,i.Hash=ks,i.ImageSource=Pe,i.KeyboardHandler=wi,i.LngLatBounds=B,i.LogoControl=cy,i.Map=or,i.MapMouseEvent=ya,i.MapTouchEvent=Oc,i.MapWheelEvent=od,i.Marker=sb,i.NavigationControl=class{constructor(w){this._updateZoomButtons=()=>{var f=this._map.getZoom(),s=f===this._map.getMaxZoom(),f=f===this._map.getMinZoom();this._zoomInButton.disabled=s,this._zoomOutButton.disabled=f,this._zoomInButton.setAttribute("aria-disabled",s.toString()),this._zoomOutButton.setAttribute("aria-disabled",f.toString())},this._rotateCompassArrow=()=>{var s=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=s},this._setButtonTitle=(s,f)=>{f=this._map._getUIString("NavigationControl."+f),s.title=f,s.setAttribute("aria-label",f)},this.options=o.extend({},gT,w),this._container=_.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",s=>s.preventDefault()),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",s=>this._map.zoomIn({},{originalEvent:s})),_.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",s=>this._map.zoomOut({},{originalEvent:s})),_.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",s=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:s}):this._map.resetNorth({},{originalEvent:s})}),this._compassIcon=_.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(w){return this._map=w,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new mT(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){_.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(w,s){return w=_.create("button",w,this._container),w.type="button",w.addEventListener("click",s),w}},i.Popup=hd,i.RasterDEMTileSource=ae,i.RasterTileSource=Q,i.ScaleControl=class{constructor(w){this._onMove=()=>{_T(this._map,this._container,this.options)},this.setUnit=s=>{this.options.unit=s,_T(this._map,this._container,this.options)},this.options=o.extend({},ud,w)}getDefaultPosition(){return"bottom-left"}onAdd(w){return this._map=w,this._container=_.create("div","maplibregl-ctrl maplibregl-ctrl-scale",w.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){_.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},i.ScrollZoomHandler=ad,i.Style=Rs,i.TerrainControl=class{constructor(w){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=w}onAdd(w){return this._map=w,this._container=_.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=_.create("button","maplibregl-ctrl-terrain",this._container),_.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){_.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},i.TwoFingersTouchPitchHandler=lT,i.TwoFingersTouchRotateHandler=dp,i.TwoFingersTouchZoomHandler=ry,i.TwoFingersTouchZoomRotateHandler=oy,i.VectorTileSource=D,i.VideoSource=rt,i.addSourceType=(w,s)=>o.__awaiter(void 0,void 0,void 0,function*(){if(an(w))throw new Error(`A source type called "${w}" already exists.`);var f,y;f=w,y=s,Bt[f]=y}),i.clearPrewarmedResources=function(){var w=Ge;w&&(w.isPreloaded()&&w.numActive()===1?(w.release(dn),Ge=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},i.getMaxParallelImageRequests=function(){return o.config.MAX_PARALLEL_IMAGE_REQUESTS},i.getRTLTextPluginStatus=function(){return qt().getRTLTextPluginStatus()},i.getVersion=function(){return kR},i.getWorkerCount=function(){return wt.workerCount},i.getWorkerUrl=function(){return o.config.WORKER_URL},i.importScriptInWorkers=function(w){return Mn().broadcast("IS",w)},i.prewarm=function(){qn().acquire(dn)},i.setMaxParallelImageRequests=function(w){o.config.MAX_PARALLEL_IMAGE_REQUESTS=w},i.setRTLTextPlugin=function(w,s){return qt().setRTLTextPlugin(w,s)},i.setWorkerCount=function(w){wt.workerCount=w},i.setWorkerUrl=function(w){o.config.WORKER_URL=w}}),e},H4.exports=n()}(),H4.exports),wa=ih(hie);function die(n){throw new Error('Could not dynamically require "'+n+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var ri,G4={exports:{}},fie={},pie=Object.freeze({__proto__:null,default:fie}),gie=uie(pie),mie=(function(n){for(var e,t,r=0,i=[],o=0;o<256;o++)i[o]=(o+256).toString(16).substr(1);function a(){h=16,(!e||l.BUFFER_SIZE<r+h)&&(r=0,e=l.randomBytes(l.BUFFER_SIZE));var h=e.slice(r,r+=h);return h[6]=15&h[6]|64,h[8]=63&h[8]|128,h}function l(){var h=a();return i[h[0]]+i[h[1]]+i[h[2]]+i[h[3]]+"-"+i[h[4]]+i[h[5]]+"-"+i[h[6]]+i[h[7]]+"-"+i[h[8]]+i[h[9]]+"-"+i[h[10]]+i[h[11]]+i[h[12]]+i[h[13]]+i[h[14]]+i[h[15]]}l.BUFFER_SIZE=4096,l.bin=a,l.clearBuffer=function(){e=null,r=0},l.test=function(h){return typeof h=="string"&&/^[0-9a-f]{8}-[0-9a-f]{4}-4[0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(h)},typeof crypto<"u"?t=crypto:typeof window<"u"&&window.msCrypto!==void 0&&(t=window.msCrypto),typeof die=="function"?(t=t||gie,n.exports=l):typeof window<"u"&&(window.uuid=l),l.randomBytes=function(){if(t){if(t.randomBytes)return t.randomBytes;if(t.getRandomValues)return typeof Uint8Array.prototype.slice!="function"?function(h){return h=new Uint8Array(h),t.getRandomValues(h),Array.from(h)}:function(h){return h=new Uint8Array(h),t.getRandomValues(h),h}}return function(h){for(var p=[],g=0;g<h;g++)p.push(Math.floor(256*Math.random()));return p}}()}(G4),G4.exports),Vd=ih(mie),yc={domain:"atlas.microsoft.com",staticAssetsDomain:"atlas.microsoft.com",stylePath:"styling",styleDefinitionsVersion:"2023-01-01",appInsightsKey:"e96cb745-c6f5-409c-a775-c4313e468c1d",aadInstance:"https://login.microsoftonline.com/"},Nn={apiVersionQueryParameter:"api-version",authorizationHeaderName:"Authorization",authorizationTokenPrefix:"Bearer ",jwtSasPrefix:"jwt-sas ",domainPlaceHolder:"{{azMapsDomain}}",legacyDomainPlaceHolder:"{azMapsDomain}",viewPlaceHolder:"{{azMapsView}}",viewParameter:"view",languagePlaceHolder:"{{azMapsLanguage}}",stylePathHolder:"{{azMapsStylingPath}}",styleResourcePlaceholder:"{{azMapsStylePath}}",stylePath:"styling",styleResourcePath:"styles",styleApiVersion:"2.0",mapAgentHeaderName:"Map-Agent",msClientIdHeaderName:"x-ms-client-id",msOriginHeaderName:"Ms-Am-Request-Origin",msOriginHeaderValue:"MapControl",aadResourceId:"https://atlas.microsoft.com/.default",sessionIdHeaderName:"Session-Id"},yie=window&&window.__values||function(n){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&n[e],r=0;if(t)return t.call(n);if(n&&typeof n.length=="number")return{next:function(){return{value:(n=n&&r>=n.length?void 0:n)&&n[r++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},ii=function(){function n(){}return n.prototype.merge=function(){for(var e,t,r,i=[],o=0;o<arguments.length;o++)i[o]=arguments[o];try{for(var a=yie(i),l=a.next();!l.done;l=a.next()){var h=l.value;if(h)for(var p in h)h.hasOwnProperty(p)&&this.hasOwnProperty(p)&&(h[p]!==void 0&&h[p]!=null?this[p]instanceof n?this[p].merge(h[p]):this[p]=h[p]:(r=r||new(Object.getPrototypeOf(this)).constructor,this[p]=r[p]))}}catch(g){e={error:g}}finally{try{l&&!l.done&&(t=a.return)&&t.call(a)}finally{if(e)throw e.error}}return this},n}(),_ie=window&&window.__extends||function(){var n=function(e,t){return(n=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(r,i){r.__proto__=i}:function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])}))(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),vie=window&&window.__read||function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var r,i,o=t.call(n),a=[];try{for(;(e===void 0||0<e--)&&!(r=o.next()).done;)a.push(r.value)}catch(l){i={error:l}}finally{try{r&&!r.done&&(t=o.return)&&t.call(o)}finally{if(i)throw i.error}}return a},bie=function(n){function e(){var t=n!==null&&n.apply(this,arguments)||this;return t.domain=void 0,t.headers={},t.path="",t.protocol="https",t.queryParams={},t.subdomain="",t}return _ie(e,n),e}(ii),Zc=function(){function n(e){this.options=new bie().merge(e)}return n.prototype.get=function(){return fetch(this.toString(),{method:"GET",mode:"cors",headers:new Headers(this.options.headers)}).then(function(e){if(e.ok)return e.json();throw new Error("HTTP ".concat(e.status,": ").concat(e.statusText))})},n.prototype.toString=function(){var e=Object.entries(this.options.queryParams).map(function(a){var a=vie(a,2),o=a[0],a=a[1];return"".concat(o,"=").concat(a)}).join("&"),t=[],r=this.options.path||"";return n.protoRegEx.test(r)?t.push(r):(this.options.domain&&(n.protoRegEx.test(this.options.domain)||(t.push("".concat(this.options.protocol,"://")),t.push(this.options.subdomain?"".concat(this.options.subdomain,"."):"")),t.push(this.options.domain)),t.push(this.options.path?"/".concat(r):"")),t.push(e?"?".concat(e):""),t.join("")},n.protoRegEx=new RegExp(/^(((file|http|https):\/\/)|blob:)/i),n}(),q4=function(){function n(){}return n.parse=function(e){var t=(e=e.toLowerCase()).lastIndexOf("-");return t!==-1?{code:e,language:e.substring(0,t),region:e.substring(t+1)}:{code:e,language:e}},n}(),oh={localizationsPath:"locs/mapcontrol/2019-3-12",sensitiveUserRegions:["il","kr","pk","in","cn","ar","bh","eg","jo","sa","kw","om","qa","ma","ae"],locales:{defaultLanguage:{defaultRegion:{code:"NGT",strings:"en/resource.json"},latn:{code:"NGT-Latn",strings:"en/resource.json"}},ar:{defaultRegion:{code:"ar",strings:"ar-sa/resource.json"}},bg:{defaultRegion:{code:"bg-BG",strings:"bg-bg/resource.json"}},cs:{defaultRegion:{code:"cs-CZ",strings:"cs-cz/resource.json"}},da:{defaultRegion:{code:"da-DK",strings:"da-dk/resource.json"}},de:{defaultRegion:{code:"de-DE",strings:"de-de/resource.json"}},el:{defaultRegion:{code:"el-GR",strings:"el-gr/resource.json"}},en:{defaultRegion:{code:"en",strings:"en/resource.json"},us:{code:"en-US",strings:"en/resource.json"},au:{code:"en-AU",strings:"en/resource.json"},gb:{code:"en-GB",strings:"en/resource.json"},nz:{code:"en-NZ",strings:"en/resource.json"}},es:{defaultRegion:{code:"es-ES",strings:"es-es/resource.json"},mx:{code:"es-MX",strings:"es-mx/resource.json"}},fi:{defaultRegion:{code:"fi-FI",strings:"fi-fi/resource.json"}},fr:{defaultRegion:{code:"fr-FR",strings:"fr-fr/resource.json"}},hu:{defaultRegion:{code:"hu-HU",strings:"hu-hu/resource.json"}},id:{defaultRegion:{code:"id-ID",strings:"id-id/resource.json"}},it:{defaultRegion:{code:"it-IT",strings:"it-it/resource.json"}},ko:{defaultRegion:{code:"ko-KR",strings:"ko-kr/resource.json"}},lt:{defaultRegion:{code:"lt-LT",strings:"lt-lt/resource.json"}},ms:{defaultRegion:{code:"ms-MY",strings:"ms-my/resource.json"}},nb:{defaultRegion:{code:"nb-NO",strings:"nb-no/resource.json"}},nl:{defaultRegion:{code:"nl-NL",strings:"nl-nl/resource.json"}},pl:{defaultRegion:{code:"pl-PL",strings:"pl-pl/resource.json"}},pt:{defaultRegion:{code:"pt-PT",strings:"pt-pt/resource.json"},br:{code:"pt-BR",strings:"pt-br/resource.json"}},ru:{defaultRegion:{code:"ru-RU",strings:"ru-ru/resource.json"}},sk:{defaultRegion:{code:"sk-SK",strings:"sk-sk/resource.json"}},sl:{defaultRegion:{code:"sl-SL",strings:"sl-sl/resource.json"}},sv:{defaultRegion:{code:"sv-SE",strings:"sv-se/resource.json"}},th:{defaultRegion:{code:"th-TH",strings:"th-th/resource.json"}},tr:{defaultRegion:{code:"tr-TR",strings:"tr-tr/resource.json"}},zh:{defaultRegion:{code:"zh",strings:"en/resource.json"}},"zh-hans":{defaultRegion:{code:"zh-Hans",strings:"zh-cn/resource.json"},cn:{code:"zh-Hans-CN",strings:"zh-cn/resource.json"}},"zh-hant":{defaultRegion:{code:"zh-Hant",strings:"en/resource.json"},tw:{code:"zh-Hant-TW",strings:"zh-tw/resource.json"}}}},$4=function(){this.Unknown="Unknown",this.Accident="Accident",this.Fog="Fog",this.Danger="Danger",this.Rain="Rain",this.Ice="Ice",this.Jam="Jam",this.LaneClosed="Lane Closed",this.RoadClosed="Road Closed",this.RoadWorks="Road Works",this.Wind="Wind",this.Flood="Flood",this.Detour="Detour"},z1=function(){function n(){}return n.getCode=function(e){e.localeCompare("auto",void 0,{sensitivity:"base"})===0&&(e=navigator.language);var t=q4.parse(e);return oh.sensitiveUserRegions.indexOf(t.region)===-1?this.getLocaleData(t).code:e},n.getStrings=function(e){return e=this.getLocaleData(e),oh.locales.defaultLanguage.defaultRegion.code===e.code?new Promise(function(t){t(new $4)}):new Zc({domain:yc.staticAssetsDomain,path:"".concat(oh.localizationsPath,"/").concat(e.strings)}).get().then(function(t){return t},function(){return new $4})},n.getLocaleData=function(e){if(typeof e=="string"&&(e=q4.parse(e)),oh.locales[e.code])return oh.locales[e.code].defaultRegion;var t;if(oh.locales[e.language])t=oh.locales[e.language];else{if(e.language.indexOf("-")!==-1)return this.getLocaleData(e.language);t=oh.locales.defaultLanguage}return e.region&&t[e.region]?t[e.region]:t.defaultRegion},n}(),wie=function(){function n(){}return n.getEdgeOrIEVersion=function(){var e=window.navigator.userAgent,t=e.indexOf("MSIE ");return 0<t?parseInt(e.substring(t+5,e.indexOf(".",t)),10):0<e.indexOf("Trident/")?(t=e.indexOf("rv:"),parseInt(e.substring(t+3,e.indexOf(".",t)),10)):0<(t=e.indexOf("Edge/"))?parseInt(e.substring(t+5,e.indexOf(".",t)),10):-1},n.isEdgeOrIE=function(){return this.getEdgeOrIEVersion()!==-1},n.isIE=function(){var e=this.getEdgeOrIEVersion();return e!==-1&&e<=11},n}(),ah="3.6.1",j1=function(){function n(){}return n.getFullVersion=function(){return ah},n.getEndpointVersion=function(){var e=ah.indexOf(".");return(e=ah.indexOf(".",e+1))===-1?ah:ah.substring(0,e)},n}(),xie=window&&window.__extends||function(){var n=function(e,t){return(n=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(r,i){r.__proto__=i}:function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])}))(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),Eie=window&&window.__read||function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var r,i,o=t.call(n),a=[];try{for(;(e===void 0||0<e--)&&!(r=o.next()).done;)a.push(r.value)}catch(l){i={error:l}}finally{try{r&&!r.done&&(t=o.return)&&t.call(o)}finally{if(i)throw i.error}}return a},Tie=window&&window.__spreadArray||function(n,e,t){if(t||arguments.length===2)for(var r,i=0,o=e.length;i<o;i++)!r&&i in e||((r=r||Array.prototype.slice.call(e,0,i))[i]=e[i]);return n.concat(r||Array.prototype.slice.call(e))},W4=(function(n){n.subscriptionKey="subscriptionKey",n.aad="aad",n.anonymous="anonymous",n.sas="sas"}(ri=ri||{}),function(n){function e(){var t=n!==null&&n.apply(this,arguments)||this;return t.authType=void 0,t.subscriptionKey=void 0,t.clientId=void 0,t.aadAppId=void 0,t.aadTenant=void 0,t.aadInstance=void 0,t.getToken=void 0,t.sasToken=void 0,t.authContext=void 0,t}return xie(e,n),e.prototype.setSubscriptionKey=function(t){this.authType=ri.subscriptionKey,this.subscriptionKey=t},e.prototype.setAadProperties=function(t,r,i,o,a){this.authType=ri.aad,this.authContext=a||this.authContext,this.aadInstance=o||this.aadInstance,this.clientId=t,this.aadAppId=r,this.aadTenant=i},e.prototype.setTokenCallbackFunction=function(t){this.authType=ri.anonymous,this.getToken=t},e.prototype.setSasCallbackFunction=function(t){this.authType=ri.sas,this.getToken=t},e.prototype.merge=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var i=n.prototype.merge.apply(this,Tie([],Eie(t),!1));return i.authType===ri.subscriptionKey?i.authContext=i.aadAppId=i.getToken=void 0:i.authType===ri.aad?i.subscriptionKey=i.getToken=void 0:i.authType===ri.anonymous?i.subscriptionKey=i.authContext=i.aadAppId=void 0:i.authType===ri.sas&&(i.authContext=i.subscriptionKey=i.aadAppId=void 0),i},e}(ii)),SA=CA;function CA(n){return!Sie(n)}function Sie(n){return Cie()?Aie()?Iie()?Pie()?Mie()?Rie()?kie()?Oie()?Lie()?Nie(n&&n.failIfMajorPerformanceCaveat)?Bie()?void 0:"insufficient ECMAScript 6 support":"insufficient WebGL support":"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support":"not a browser"}function Cie(){return typeof window<"u"&&typeof document<"u"}function Aie(){return Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray}function Iie(){return Function.prototype&&Function.prototype.bind}function Pie(){return Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions}function Mie(){return"JSON"in window&&"parse"in JSON&&"stringify"in JSON}function Rie(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var n,e,t=new Blob([""],{type:"text/javascript"}),t=URL.createObjectURL(t);try{e=new Worker(t),n=!0}catch{n=!1}return e&&e.terminate(),URL.revokeObjectURL(t),n}function kie(){return"Uint8ClampedArray"in window}function Oie(){return ArrayBuffer.isView}function Lie(){var n=document.createElement("canvas"),e=(n.width=n.height=1,n.getContext("2d"));return!!e&&(e=e.getImageData(0,0,1,1))&&e.width===n.width}var V1,AA={};function Nie(n){return AA[n]===void 0&&(AA[n]=Fie(n)),AA[n]}function Die(n){var e=document.createElement("canvas"),t=Object.create(CA.webGLContextAttributes);return t.failIfMajorPerformanceCaveat=n,e.getContext("webgl",t)||e.getContext("experimental-webgl",t)}function Fie(t){var e,t=Die(t);if(!t)return!1;try{e=t.createShader(t.VERTEX_SHADER)}catch{return!1}return!(!e||t.isContextLost())&&(t.shaderSource(e,"void main() {}"),t.compileShader(e),t.getShaderParameter(e,t.COMPILE_STATUS)===!0)}function Bie(){return!document.documentMode}CA.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};var Y4="NGT",K4=Vd(),Z4=yc.domain,Uie=yc.staticAssetsDomain,X4=yc.stylePath,Q4=yc.styleDefinitionsVersion,J4=Nn.styleApiVersion,ug=new W4,IA=!1,eF=!1,tF=!1,nF=!1,rF=!1,iF=!1,oF=!1,aF=!1,PA=!1;function sF(){return Object.assign({},ug)}function cF(){return Uie}function MA(){return Z4}function lF(){return X4}function uF(){return Q4}function hF(){return J4}function dF(){return wa.getWorkerCount()}function fF(){return wa.getMaxParallelImageRequests()}function pF(){return Y4}function gF(){return K4}function mF(){return ug.authType===ri.subscriptionKey?ug.subscriptionKey:void 0}function zie(){return V1}function yF(){return V1}function jie(){return j1.getFullVersion()}function Vie(n){var e=!wie.isIE();return e=e&&SA({failIfMajorPerformanceCaveat:n})&&document.createElement("canvas").getContext("webgl2")!==null}function _F(n){ug=new W4().merge(ug,n),PA=!0}function vF(n){Z4=n,eF=!0}function bF(n){X4=n,tF=!0}function Hie(n){Q4=n,nF=!0}function Gie(n){J4=n}function wF(n){0<n&&(wa.setWorkerCount(n),rF=!0)}function xF(n){0<n&&(wa.setMaxParallelImageRequests(n),iF=!0)}function EF(n){Y4=z1.getCode(n),oF=!0}function TF(n){K4=n,aF=!0}function SF(n){ug.setSubscriptionKey(n),PA=!0}function CF(n){V1=n,IA=!0}function qie(n){V1=n,IA=!0}function $ie(n,e,t){!t&&S_[n.toLowerCase()]||(S_[n.toLowerCase()]=e)}function AF(n,e){if(e=Math.abs(e||1),typeof n=="string"&&S_[n.toLowerCase()]){for(var t=S_[n.toLowerCase()],r=/calc\(([0-9.]+)[px]*\s*\*\s*\{scale\}\)/gi,i=t,o=r.exec(t);o;)i=i.replace(o[0],parseFloat(o[1])*e+""),o=r.exec(t);return i=i.replace("{scale}",e+"")}throw new Error("Invalid templateName.")}function Wie(){return Object.keys(S_)}function Yie(){wa.prewarm()}function Kie(){wa.clearPrewarmedResources()}function Zie(n,e){wa.addProtocol(n,e)}function Xie(n){wa.removeProtocol(n)}function RA(){return PA}function IF(){return eF}function PF(){return tF}function Qie(){return nF}function MF(){return rF}function RF(){return iF}function kF(){return oF}function OF(){return aF}function LF(){return IA}function Jie(){return yc.domain}function eoe(){return MA()}function NF(){var n=new Zc({domain:yc.staticAssetsDomain,path:"sdk/javascript/mapcontrol/".concat(j1.getEndpointVersion(),"/mapbox-gl-rtl-text.min.js")});wa.setRTLTextPlugin(n.toString(),!0).catch(function(e){e&&console.warn(e)})}var xa,Ro,S_={marker:'<svg xmlns="http://www.w3.org/2000/svg" width="calc(27 * {scale})" height="calc(39 * {scale})" viewBox="-1 -1 26 38"><path d="M12.25.25a12.254 12.254 0 0 0-12 12.494c0 6.444 6.488 12.109 11.059 22.564.549 1.256 1.333 1.256 1.882 0C17.762 24.853 24.25 19.186 24.25 12.744A12.254 12.254 0 0 0 12.25.25Z" style="fill:{color};stroke:{secondaryColor};stroke-width:1"/><text x="12.5" y="17.5" style="font-size:14px;fill:#fff;text-anchor:middle">{text}</text></svg>',"marker-thick":'<svg xmlns="http://www.w3.org/2000/svg" width="calc(28 * {scale})" height="calc(39 * {scale})" viewBox="-1 -1 27 38"><path d="M12.25.25a12.254 12.254 0 0 0-12 12.494c0 6.444 6.488 12.109 11.059 22.564.549 1.256 1.333 1.256 1.882 0C17.762 24.853 24.25 19.186 24.25 12.744A12.254 12.254 0 0 0 12.25.25Z" style="fill:{color};stroke:{secondaryColor};stroke-width:2"/><text x="12.5" y="18.5" style="font-size:14px;fill:#fff;text-anchor:middle">{text}</text></svg>',"marker-circle":'<svg xmlns="http://www.w3.org/2000/svg" width="calc(28 * {scale})" height="calc(39 * {scale})" viewBox="-1 -1 27 38"><path d="M12.25.25a12.254 12.254 0 0 0-12 12.494c0 6.444 6.488 12.109 11.059 22.564.549 1.256 1.333 1.256 1.882 0C17.762 24.853 24.25 19.186 24.25 12.744A12.254 12.254 0 0 0 12.25.25Z" style="fill:{color};stroke:{secondaryColor};stroke-width:1"/><circle cx="12.5" cy="12.5" r="9" fill="{secondaryColor}"/><text x="12" y="17.5" style="font-size:14px;fill:#000;text-anchor:middle">{text}</text></svg>',pin:'<svg xmlns="http://www.w3.org/2000/svg" width="calc(24 * {scale})" height="calc(28 * {scale})" viewBox="0 0 24 28"><path d="m11.988 16.615a5.15 5.15 0 0 1-2.268-.525 4.909 4.909 0 0 1-2.805-4.442 5.019 5.019 0 0 1 5.072-4.936h.012a5.03 5.03 0 0 1 5.085 4.961 4.907 4.907 0 0 1-.549 2.224 5.114 5.114 0 0 1-4.548 2.718zm0-8.06a3.173 3.173 0 0 0-3.226 3.099 3.081 3.081 0 0 0 1.77 2.782 3.299 3.299 0 0 0 4.365-1.386 3.049 3.049 0 0 0 .342-1.381 3.184 3.184 0 0 0-3.239-3.114h-.012z" fill="{secondaryColor}"/><path d="m11.999.922a10.908 10.908 0 0 0-11.076 10.732 10.639 10.639 0 0 0 4.418 8.598l6.658 6.464 6.658-6.463a10.537 10.537 0 0 0 2.198-15.041 11.182 11.182 0 0 0-8.856-4.289zm1.873 14.341a4.221 4.221 0 0 1-5.589-1.789 3.945 3.945 0 0 1-.445-1.8 4.164 4.164 0 0 1 8.323-.037 4.028 4.028 0 0 1-2.289 3.626Z" fill="{color}"/><path d="m11.999 28-7.256-7.044a11.611 11.611 0 0 1-4.743-9.303 11.844 11.844 0 0 1 11.988-11.652.102 .102 0 0 1 .02 0 12.164 12.164 0 0 1 9.577 4.647 11.357 11.357 0 0 1 2.299 8.614 11.521 11.521 0 0 1-4.63 7.695zm-.01-26.157a9.997 9.997 0 0 0-10.143 9.812 9.769 9.769 0 0 0 4.04 7.853l.099.083 6.014 5.838 6.113-5.922a9.7 9.7 0 0 0 3.945-6.505 9.533 9.533 0 0 0-1.933-7.229 10.305 10.305 0 0 0-8.116-3.931h-.021zm.021 14.772a5.11 5.11 0 0 1-4.547-2.718 4.868 4.868 0 0 1 .932-5.743 5.118 5.118 0 0 1 3.58-1.46h.024a5.031 5.031 0 0 1 5.084 4.938 4.92 4.92 0 0 1-2.805 4.457h0a5.152 5.152 0 0 1-2.269.525zm-.011-8.079h-.015a3.277 3.277 0 0 0-2.295.933 3.029 3.029 0 0 0-.587 3.58 3.297 3.297 0 0 0 4.364 1.386h0a3.092 3.092 0 0 0 1.772-2.795 3.185 3.185 0 0 0-3.239-3.105z" fill="{secondaryColor}"/><text x="12" y="17" style="font-size:14px;fill:#000;text-anchor:middle">{text}</text></svg>',"pin-round":'<svg xmlns="http://www.w3.org/2000/svg" width="calc(25 * {scale})" height="calc(25 * {scale})" viewBox="0 0 25 25"><g transform="translate(0 1)"><circle cx="12.25" cy="11.5833" r="11" fill="{color}"/><path d="m12.25 23.583a12 12 0 1 1 12-12 12 12 0 0 1-12 12zm0-22a10 10 0 1 0 10 10 10 10 0 0 0-10-10z" fill="{secondaryColor}"/><circle cx="12.25" cy="11.5833" r="4.2386" fill="{secondaryColor}"/></g><text x="12.5" y="17" style="font-size:14px;fill:#000;text-anchor:middle">{text}</text></svg>',"marker-flat":'<svg xmlns="http://www.w3.org/2000/svg" width="calc(27 * {scale})" height="calc(42.8 * {scale})"  viewBox="0 0 1600 2570"><g fill="{color}"><path d="M691 2419c-409-575-641-1086-683-1504-10-106-10-136 5-224 31-188 105-330 241-458 129-124 270-190 453-214 69-9 113-10 182-1 373 46 655 326 703 698 40 308-120 801-424 1309-134 224-348 535-369 535-4 0-53-63-108-141z"/></g><g fill="rgba(0,0,0,0.15)" style="transform:scale(-1,1);transform-origin:center"><path d="M691 2419c-407-571-639-1083-682-1498-14-139-3-249 37-371 69-208 254-402 459-481 68-27 217-59 271-59h24v160 180 940 635c0 349-2 635-5 635-2 0-49-63-104-141z"/></g><circle cx="800" cy="800" r="600" fill="{secondaryColor}"/><text x="800" y="1100" style="font-size:800px;fill:#000;text-anchor:middle">{text}</text></svg>',"marker-arrow":'<svg xmlns="http://www.w3.org/2000/svg" width="calc(25.47 * {scale})" height="calc(35.18 * {scale})" viewBox="0 0 4330 5980"><g fill="{color}"><path d="m2080 5969c-49-20-93-63-115-113-25-55-1928-5486-1953-5573-40-138 67-282 210-283 36 0 246 73 987 345 518 190 947 345 955 345 8 0 438-155 955-345 615-226 954-345 979-345 87 0 165 47 204 123 46 91 107-95-957 2942-537 1535-986 2805-997 2823-11 18-43 46-72 62-41 24-62 30-111 29-33 0-71-5-85-10z"/></g><g fill="{secondaryColor}"><path d="m2200 1600c-36 10-83 2-484-84-243-53-451-94-461-91-11 4-22 18-25 31-5 19 114 371 436 1292 244 697 448 1273 454 1281 19 24 50 30 71 12z"/><path d="m2200 1600c-36 10-83 2-484-84-243-53-451-94-461-91-11 4-22 18-25 31-5 19 114 371 436 1292 244 697 448 1273 454 1281 19 24 50 30 71 12z" style="transform:scale(-1,1);transform-origin:center"/></g><g fill="rgba(0,0,0,0.2)" ><path d="m2165 685c8 0 438-155 955-345 615-226 954-345 979-345 87 0 165 47 204 123 46 91 107-95-957 2942-537 1535-986 2805-997 2823-11 18-43 46-72 62-41 24-62 30-111 29z"/></g><text x="2165" y="3300" style="font-size:2500px;fill:#fff;text-anchor:middle">{text}</text></svg>',"marker-ball-pin":'<svg xmlns="http://www.w3.org/2000/svg" width="calc(15.67 * {scale})" height="calc(33.33 * {scale})" viewBox="0 0 235 452"><g transform="translate(-135 10)"><path fill="{secondaryColor}" d="m256 442 0 0c-13 0-18-11-18-24l-6-323c0-13 11-24 24-24h0c13 0 24 11 24 24l-6 323c0 13-5 24-18 24z"/><circle style="fill:{color};stroke-width:10;stroke:{secondaryColor}" cx="256" cy="112" r="111"/><ellipse transform="matrix(0.834 0.5518 -0.5518 0.834 65.7916 -97.18)" fill="rgba(255,255,255,0.3)" cx="194.399" cy="60.749" rx="19.076" ry="32.428"/></g><text x="117.5" y="160" style="font-size:160px;fill:#fff;text-anchor:middle">{text}</text></svg>',"marker-square":'<svg xmlns="http://www.w3.org/2000/svg" width="calc(26.67 * {scale})" height="calc(32.27 * {scale})" viewBox="0 0 2000 2420"><g transform="translate(100 100)" style="stroke:{secondaryColor};stroke-width:100;fill:{color}"><path d="M845 2152c-22-37-58-95-80-129-22-35-62-99-90-143l-50-80-312 0-313 0 0-900 0-900 900 0 900 0 0 900 0 900-313 0-313 0-34 58c-19 31-38 59-42 60-5 2-8 8-8 12 0 9-69 123-88 145-5 6-11 15-13 21-16 39-77 123-89 124-8 0-33-31-55-68z"/></g><text x="1000" y="1300" style="font-size:1000px;fill:#fff;text-anchor:middle">{text}</text></svg>',"marker-square-cluster":'<svg xmlns="http://www.w3.org/2000/svg" width="calc(33.33 * {scale})" height="calc(38.8 * {scale})" viewBox="0 0 2500 2910"><g transform="translate(100 100)" style="stroke:{secondaryColor};stroke-width:100;fill:{color}"><path d="m866 2652c-17-31-37-68-46-82-9-14-32-54-51-90-19-36-50-92-70-125l-36-60-332-3-331-2 0-905 0-905 660 0 660 0 0-38c0-71 50-196 102-258 71-85 189-164 244-164 12 0 26-4 29-10 8-13 222-13 230 0 3 6 17 10 30 10 25 0 117 45 154 76 130 107 191 232 191 392 0 155-63 284-190 386-36 29-129 76-150 76-11 0-22 5-25 10-3 6-31 10-61 10l-54 0 0 660 0 660-332 2-332 3-29 50c-17 28-48 84-70 125-22 41-47 86-56 100-9 14-30 51-46 83-17 32-36 57-45 57-8 0-28-25-44-58z"/></g><text x="1650" y="900" style="font-size:1000px;fill:#fff">+</text><text x="1000" y="1800" style="font-size:1000px;fill:#fff;text-anchor:middle">{text}</text></svg>',"marker-square-rounded":'<svg xmlns="http://www.w3.org/2000/svg" width="calc(26.8 * {scale})" height="calc(32.27 * {scale})" viewBox="0 0 2010 2410"><g transform="translate(100 100)" style="stroke:{secondaryColor};stroke-width:100;fill:{color}"><path d="M856 2155c-20-30-36-59-36-65 0-5-4-10-10-10-5 0-10-5-10-11 0-5-18-37-40-69-22-32-40-64-40-69 0-6-4-11-10-11-5 0-10-5-10-10 0-6-15-33-32-60l-33-50-127 0c-74 0-129-4-133-10-3-5-17-10-30-10-25 0-116-45-155-76-87-69-142-151-178-265-15-46-17-1075-2-1084 5-3 10-17 10-30 0-13 5-27 10-30 6-3 10-13 10-22 0-22 83-135 122-168 57-46 62-50 112-75l50-25 585 0 586 0 63 34c84 46 169 133 212 218l35 68 0 565 0 565-28 59c-32 69-100 157-139 180-15 9-33 22-40 29-23 22-99 57-123 57-13 0-27 5-30 10-4 6-60 10-135 10l-128 0-128 205c-84 136-133 205-144 205-10 0-33-24-54-55z"/></g><text x="1000" y="1300" style="font-size:1000px;fill:#fff;text-anchor:middle">{text}</text></svg>',"marker-square-rounded-cluster":'<svg xmlns="http://www.w3.org/2000/svg" width="calc(33.33 * {scale})" height="calc(32.13 * {scale})" viewBox="0 0 2500 2900"><g transform="translate(100 100)" style="stroke:{secondaryColor};stroke-width:100;fill:{color}"><path d="m874 2669c-9-18-26-49-37-68-11-20-30-55-43-78-13-24-36-64-51-90-14-27-38-69-52-95l-26-48-142 0c-84 0-144-4-148-10-3-5-17-10-30-10-25 0-118-46-154-76-91-76-136-142-175-254-13-38-16-119-16-554 0-358 3-520 12-545 40-125 106-219 195-278 127-84 116-83 646-83l467 0 0-42c0-46 11-87 45-163 54-121 169-220 306-264 46-14 232-14 278 0 165 53 284 175 340 350 19 61 14 204-10 273-32 91-94 178-169 240-38 31-130 76-155 76-13 0-27 5-30 10-3 6-28 10-56 10l-49 0 0 462c0 446-1 464-21 522-32 91-94 178-169 240-38 31-130 76-155 76-13 0-27 5-30 10-4 6-65 10-149 10-138 0-143 1-154 23-12 23-62 114-112 202-16 28-44 79-63 115-42 77-67 88-93 39z"/></g><text x="1650" y="900" style="font-size:1000px;fill:#fff">+</text><text x="1000" y="1800" style="font-size:1000px;fill:#fff;text-anchor:middle">{text}</text></svg>',flag:'<svg xmlns="http://www.w3.org/2000/svg" width="calc(23.5 * {scale})" height="calc(40 * {scale})" viewBox="34 28 198 308"><path style="stroke:{secondaryColor};stroke-width:15;stroke-linecap:round;" d="M42 327l0 -291"/><path style="fill:{color};stroke:{secondaryColor};stroke-width:10;stroke-linejoin:round;" d="M49 50c70 30 104 28 178 2-21 42-21 74 0 116-72 25-101 25-178 0l0-118z"/><text x="130" y="165" style="font-size:100px;fill:#fff;text-anchor:middle">{text}</text></svg>',"flag-triangle":'<svg xmlns="http://www.w3.org/2000/svg" width="calc(27 * {scale})" height="calc(35.33 * {scale})" viewBox="0 0 40.5 53"><g transform="translate(-31 -20)"><path fill="{secondaryColor}" d="M34.7,73.3V48.4l34.6-10.1c0.7-0.2,1.2-0.8,1.2-1.5s-0.4-1.4-1-1.7L33.7,20.5c-0.5-0.2-1.1-0.2-1.6,0.2 c-0.5,0.3-0.7,0.8-0.7,1.4v51.2H34.7z"/><polygon points="34.7,24.5 66,36.5 34.7,45 34.7,10" fill="{color}"/></g><text x="11" y="21" style="font-size:14px;fill:#fff;text-anchor:middle">{text}</text></svg>',"rounded-square":'<svg xmlns="http://www.w3.org/2000/svg" width="calc(34 * {scale})" height="calc(34 * {scale})" viewBox="0 0 34 34"><g transform="translate(2 2)"><rect x="0" y="0" rx="8" ry="8" width="30" height="30" style="stroke:{secondaryColor};stroke-width:2;fill:{color}"/></g><text x="17" y="22" style="font-size:14px;fill:#fff;text-anchor:middle">{text}</text></svg>',"rounded-square-thick":'<svg xmlns="http://www.w3.org/2000/svg" width="calc(38 * {scale})" height="calc(38 * {scale})" viewBox="0 0 38 38"><g transform="translate(4 4)"><rect x="0" y="0" rx="8" ry="8" width="30" height="30" style="stroke:{secondaryColor};stroke-width:4;fill:{color}"/></g><text x="19" y="24" style="font-size:14px;fill:#fff;text-anchor:middle">{text}</text></svg>',triangle:'<svg xmlns="http://www.w3.org/2000/svg" width="calc(36 * {scale})" height="calc(36 * {scale})" viewBox="0 0 36 36"><g transform="translate(2 2)"><polygon points="16,0 32,32 0,32 16,0" style="stroke:{secondaryColor};stroke-width:2;fill:{color}"/></g><text x="17.5" y="30" style="font-size:12px;fill:#fff;text-anchor:middle">{text}</text></svg>',"triangle-thick":'<svg xmlns="http://www.w3.org/2000/svg" width="calc(40 * {scale})" height="calc(40 * {scale})" viewBox="0 0 40 40"><g transform="translate(4 4)"><polygon points="16,0 32,32 0,32 16,0" style="stroke:{secondaryColor};stroke-width:4;fill:{color}"/></g><text x="19.5" y="32" style="font-size:12px;fill:#fff;text-anchor:middle">{text}</text></svg>',hexagon:'<svg xmlns="http://www.w3.org/2000/svg" width="calc(35 * {scale})" height="calc(40 * {scale})" viewBox="0 0 35 40"><g transform="translate(2 2)"><path d="M31 9 15.5 0 0 9 0 27 15.5 36 31 27 31 9Z" style="stroke:{secondaryColor};stroke-width:2;fill:{color}"/></g><text x="17.5" y="25" style="font-size:14px;fill:#fff;text-anchor:middle">{text}</text></svg>',"hexagon-thick":'<svg xmlns="http://www.w3.org/2000/svg" width="calc(39 * {scale})" height="calc(44 * {scale})" viewBox="0 0 39 44"><g transform="translate(4 4)"><path d="M31 9 15.5 0 0 9 0 27 15.5 36 31 27 31 9Z" style="stroke:{secondaryColor};stroke-width:4;fill:{color}"/></g><text x="19.5" y="27" style="font-size:14px;fill:#fff;text-anchor:middle">{text}</text></svg>',"hexagon-rounded":'<svg xmlns="http://www.w3.org/2000/svg" width="calc(40 * {scale})" height="calc(40 * {scale})" viewBox="0 0 1100 1100"><g transform="translate(50 50)"><path style="stroke:{secondaryColor};stroke-width:50;fill:{color}" d="M881 210 561 25c-33-19-88-19-121 0L119 210c-33 19-61 67-61 105v370c0 39 27 86 61 105l321 185c33 19 88 19 122 0l321-185c33-19 61-67 61-105V315C942 276 915 229 881 210z"/></g><text x="550" y="700" style="font-size:400px;fill:#fff;text-anchor:middle">{text}</text></svg>',"hexagon-rounded-thick":'<svg xmlns="http://www.w3.org/2000/svg" width="calc(40 * {scale})" height="calc(40 * {scale})" viewBox="0 0 1200 1200"><g transform="translate(100 100)"><path style="stroke:{secondaryColor};stroke-width:100;fill:{color}" d="M881 210 561 25c-33-19-88-19-121 0L119 210c-33 19-61 67-61 105v370c0 39 27 86 61 105l321 185c33 19 88 19 122 0l321-185c33-19 61-67 61-105V315C942 276 915 229 881 210z"/></g><text x="600" y="750" style="font-size:400px;fill:#fff;text-anchor:middle">{text}</text></svg>',"triangle-arrow-up":'<svg xmlns="http://www.w3.org/2000/svg" width="calc(28 * {scale})" height="calc(28 * {scale})" viewBox="0 0 28 28"><g transform="translate(2 2)"><polygon points="12,0 0,24 12,17 24,24" stroke-width="2" stroke="{secondaryColor}" fill="{color}"/></g><text x="14" y="17" style="font-size:8px;fill:#fff;text-anchor:middle">{text}</text></svg>',"triangle-arrow-left":'<svg xmlns="http://www.w3.org/2000/svg" width="calc(28 * {scale})" height="calc(28 * {scale})" viewBox="0 0 28 28"><g transform="translate(2 2)"><polygon points="24,12 0,0 7,12 0,24" stroke-width="2" stroke="{secondaryColor}" fill="{color}"/></g><text x="14" y="16.5" style="font-size:8px;fill:#fff;text-anchor:middle">{text}</text></svg>',"arrow-up":'<svg xmlns="http://www.w3.org/2000/svg" width="calc(12.16 * {scale})" height="calc(30.1 * {scale})" viewBox="0 0 902 364"><g fill="{color}" transform="matrix(0,2.4,-2.4,0,897,-930)"><polygon points="902,222 233,222 233,364 0,182 233,0 233,141 902,141 902,222"/></g><text x="450" y="700" style="font-size:900px;fill:#000;text-anchor:middle">{text}</text></svg>',"arrow-up-thin":'<svg xmlns="http://www.w3.org/2000/svg" width="calc(16 * {scale})" height="calc(33.33 * {scale})" viewBox="0 0 12 25"><g transform="translate(-136.91823 -751.91998)"><path fill="{color}" d="m148.271 760.71c-1.641-.547-3.186-1.47-4.633-2.769l0 18.07-1.675 0 0-18.07c-1.447 1.299-2.986 2.222-4.616 2.769l0-1.231c2.325-1.596 4.006-3.812 5.043-6.65l.838 0c1.037 2.838 2.718 5.055 5.043 6.65l0 1.231z"/></g><text x="6" y="20" style="font-size:10px;fill:#000;text-anchor:middle">{text}</text></svg>',car:'<svg xmlns="http://www.w3.org/2000/svg" width="calc(21.93 * {scale})" height="calc(40.9 * {scale})" viewBox="0 0 6580 12270"><g transform="translate(0 12270) rotate(-90)"><path fill="{secondaryColor}" d="M7045 6566c-42-13-105-44-105-51 0-2 23-105 50-228 28-123 50-230 50-236 0-8-241-11-907-11-855 0-1145 6-1513 30-85 6-189 13-230 15-41 3-133 10-205 15-286 21-430 32-705 50-953 63-1459 18-2335-205-304-77-746-209-799-238-131-72-221-408-285-1062-34-345-42-532-48-1130-16-1557 108-2532 336-2649 32-17 469-149 676-205 409-110 819-191 1205-238 116-14 224-18 540-18 395 1 494 5 1140 50 1124 79 1224 82 2496 78l641-3-53-237c-29-131-52-238-51-239 1-1 31-14 66-29 56-23 76-26 142-23 67 3 83 7 120 33 23 17 50 41 61 55 10 14 51 117 91 230l73 205 674 3 675 2 90-39c98-43 198-72 315-93 122-21 829-18 990 5 321 45 626 143 849 270 293 168 516 378 704 662 266 402 416 893 467 1527 15 174 8 882-9 998-6 41-18 127-27 190-69 502-253 969-523 1325-79 105-262 284-381 374-189 142-355 229-574 300-336 110-526 139-952 148-457 9-685-23-887-124l-47-24-678-6-678-6-64 179c-79 224-92 253-121 284-67 70-177 97-274 66zm-2752-5073c-23-2-64-2-90 0-26 2-7 3 42 3 50 0 71-1 48-3zm395 0c-21-2-55-2-75 0-21 2-4 4 37 4 41 0 58-2 38-4z"/><path fill="{color}" d="M7043 6498c-13-6-23-19-23-28 0-9 23-117 50-240 28-123 50-230 50-237 0-22-2126-13-2465 10-132 10-400 28-595 42-661 47-824 55-1160 62-435 7-656-8-1040-73-415-70-865-183-1447-365-168-53-272-556-325-1569-16-319-16-1311 0-1630 45-872 129-1366 257-1518 22-26 51-39 172-77 557-177 1122-310 1563-369 271-36 351-40 690-40 361 1 463 6 1165 54 1122 78 1288 83 2337 79 460-2 840-7 843-11 4-4-17-117-47-252l-55-245 39-16c76-30 180-8 224 47 10 13 54 124 98 246l79 222 709 0 709 0 47-24c74-37 219-83 322-101 122-22 606-32 802-16 374 29 658 102 933 238 124 62 271 155 361 230l61 51 6 100c19 278 103 497 247 643 88 89 173 136 278 152l70 11 41 131c116 369 159 673 168 1170 10 584-38 984-167 1397l-40 126-70 12c-193 33-348 175-441 405-56 139-89 302-89 445 0 43-3 47-58 91-290 235-644 384-1068 450-191 29-796 39-974 16-135-18-263-54-368-102l-75-35-701 0-701 0-79 223c-82 232-102 267-163 293-38 16-138 17-170 2zm-2023-820c332-15 1155-12 1835 6 308 8 563 12 566 8 4-4 10-21 13-38 7-30 6-31-92-77-518-244-1197-396-2112-474-295-25-1282-25-1579 0-231 20-473 46-479 51-6 7 49 110 93 171 160 226 416 335 855 365 142 10 539 5 900-12zm3304-263c525-111 899-887 934-1935 19-557-37-1023-172-1435-186-563-521-900-896-899-81 0-158 14-525 92-426 91-431 92-540 146-195 96-287 207-306 368-12 104-11 2985 1 3078 22 170 135 291 365 389 49 21 191 55 480 115 226 47 419 87 430 89 45 10 164 6 229-8zm-5570-485c112-43 197-156 216-291 12-83 13-2623 1-2706-23-158-125-273-270-304-44-9-100-1-542 75-272 47-514 91-539 98-266 68-487 424-594 958-56 280-70 548-40 800 56 484 207 878 414 1081 115 114 122 116 702 218 277 49 524 90 550 90 26 1 72-8 102-19zm2111-3440c1023-44 1884-213 2462-486l113-53-7-33c-3-18-8-35-10-37-2-3-236 1-521 7-993 24-1271 26-1708 11-541-18-1128-18-1249-1-377 56-588 181-734 437-32 55-41 79-32 84 12 8 246 32 491 51 356 28 815 36 1195 20z"/></g><text x="3250" y="8250" style="font-size:3000px;fill:#fff;text-anchor:middle">{text}</text></svg>',checker:'<svg xmlns="http://www.w3.org/2000/svg" width="calc(16 * {scale})" height="calc(16 * {scale})" viewBox="0 0 16 16"><pattern id="p" x="0" y="0" width="16" height="16" patternUnits="userSpaceOnUse"><rect fill="{color}" x="0" width="8" height="8" y="0"/><rect fill="{color}" x="8" width="8" height="8" y="8"/></pattern><rect x="0" y="0" width="16" height="16" fill="{secondaryColor}"/><rect x="0" y="0" width="16" height="16" fill="url(#p)"/></svg>',"checker-rotated":'<svg xmlns="http://www.w3.org/2000/svg" width="calc(16 * {scale})" height="calc(16 * {scale})" viewBox="0 0 60 60"><rect width="60" height="60" fill="{secondaryColor}"/><rect width="42.42" height="42.42" transform="translate(30 0) rotate(45)" fill="{color}"/></svg>',"zig-zag":'<svg xmlns="http://www.w3.org/2000/svg" width="calc(15 * {scale})" height="calc(15 * {scale})" viewBox="0 0 120 120"><rect x="0" y="0" width="120" height="120" fill="{secondaryColor}"/><polygon fill="{color}" points="120 120 60 120 90 90 120 60 120 0 120 0 60 60 0 0 0 60 30 90 60 120 120 120"/></svg>',"zig-zag-vertical":'<svg xmlns="http://www.w3.org/2000/svg" width="calc(15 * {scale})" height="calc(15 * {scale})" viewBox="0 0 120 120"><rect x="0" y="0" width="120" height="120" fill="{secondaryColor}"/><polygon fill="{color}" points="120 0 120 60 90 30 60 0 0 0 0 0 60 60 0 120 60 120 90 90 120 60 120 0"/></svg>',"circles-spaced":'<svg xmlns="http://www.w3.org/2000/svg" width="calc(20 * {scale})" height="calc(20 * {scale})" viewBox="0 0 20 20"><defs><pattern id="p" x="0" y="0" width="20" height="20" patternUnits="userSpaceOnUse"><circle cx="10" cy="10" r="2" stroke="none" fill="{color}"/></pattern></defs><rect x="0" y="0" width="20" height="20" fill="{secondaryColor}"/><rect x="0" y="0" width="100" height="100" fill="url(#p)"/></svg>',circles:'<svg xmlns="http://www.w3.org/2000/svg" width="calc(7 * {scale})" height="calc(7 * {scale})" viewBox="0 0 20 20"><defs><pattern id="p" x="0" y="0" width="20" height="20" patternUnits="userSpaceOnUse"><circle cx="10" cy="10" r="6" stroke="none" fill="{color}"/></pattern></defs><rect x="0" y="0" width="20" height="20" fill="{secondaryColor}"/><rect x="0" y="0" width="100" height="100" fill="url(#p)"/></svg>',"diagonal-lines-up":'<svg xmlns="http://www.w3.org/2000/svg" width="calc(18 * {scale})" height="calc(18 * {scale})" viewBox="0 0 6 6"><rect x="0" y="0" width="6" height="6" fill="{secondaryColor}"/><g fill="{color}"><path d="M5 0h1L0 6V5zM6 5v1H5z"/></g></svg>',"diagonal-lines-down":'<svg xmlns="http://www.w3.org/2000/svg" width="calc(18 * {scale})" height="calc(18 * {scale})" viewBox="0 0 6 6"><rect x="0" y="0" width="6" height="6" fill="{secondaryColor}"/><g transform="rotate(90 3 3)" fill="{color}"><path d="M5 0h1L0 6V5zM6 5v1H5z"/></g></svg>',"diagonal-stripes-up":'<svg xmlns="http://www.w3.org/2000/svg" width="calc(20 * {scale})" height="calc(20 * {scale})" viewBox="0 0 40 40"><rect x="0" y="0" width="40" height="40" fill="{secondaryColor}"/><g fill="{color}"><path d="M0 40L40 0H20L0 20M40 40V20L20 40"/></g></svg>',"diagonal-stripes-down":'<svg xmlns="http://www.w3.org/2000/svg" width="calc(20 * {scale})" height="calc(20 * {scale})" viewBox="0 0 40 40"><rect x="0" y="0" width="40" height="40" fill="{secondaryColor}"/><g transform="rotate(90 20 20)" fill="{color}"><path d="M0 40L40 0H20L0 20M40 40V20L20 40"/></g></svg>',"grid-lines":'<svg xmlns="http://www.w3.org/2000/svg" width="calc(14 * {scale})" height="calc(14 * {scale})" viewBox="0 0 6 6"><rect x="0" y="0" width="6" height="6" fill="{secondaryColor}"/><g transform="rotate(45 3 3)" fill="{color}"><path d="M5 0h1L0 6V5zM6 5v1H5z"/></g><g fill="{color}" transform="rotate(-45 3 3)"><path d="M5 0h1L0 6V5zM6 5v1H5z"/></g></svg>',"rotated-grid-lines":'<svg xmlns="http://www.w3.org/2000/svg" width="calc(18 * {scale})" height="calc(18 * {scale})" viewBox="0 0 6 6"><rect x="0" y="0" width="6" height="6" fill="{secondaryColor}"/><g transform="rotate(90 3 3)" fill="{color}"><path d="M5 0h1L0 6V5zM6 5v1H5z"/></g><g fill="{color}"><path d="M5 0h1L0 6V5zM6 5v1H5z"/></g></svg>',"rotated-grid-stripes":'<svg xmlns="http://www.w3.org/2000/svg" width="calc(20 * {scale})" height="calc(20 * {scale})" viewBox="0 0 40 40"><rect x="0" y="0" width="40" height="40" fill="{secondaryColor}"/><g transform="rotate(90 20 20)" fill="{color}"><path d="M0 40L40 0H20L0 20M40 40V20L20 40"/></g><g fill="{color}"><path d="M0 40L40 0H20L0 20M40 40V20L20 40"/></g></svg>',"x-fill":'<svg xmlns="http://www.w3.org/2000/svg" width="calc(40 * {scale})" height="calc(40 * {scale})" viewBox="0 0 40 40"><rect x="0" y="0" width="45.3" height="45.3" fill="{secondaryColor}"/><g fill="{color}"><path d="M0 38.59l2.83-2.83 1.41 1.41L1.41 40H0v-1.41zM0 1.4l2.83 2.83 1.41-1.41L1.41 0H0v1.41zM38.59 40l-2.83-2.83 1.41-1.41L40 38.59V40h-1.41zM40 1.41l-2.83 2.83-1.41-1.41L38.59 0H40v1.41zM20 18.6l2.83-2.83 1.41 1.41L21.41 20l2.83 2.83-1.41 1.41L20 21.41l-2.83 2.83-1.41-1.41L18.59 20l-2.83-2.83 1.41-1.41L20 18.59z"/></g></svg>',dots:'<svg xmlns="http://www.w3.org/2000/svg" width="calc(13 * {scale})" height="calc(13 * {scale})" viewBox="0 0 20 20"><rect x="0" y="0" width="20" height="20" fill="{secondaryColor}"/><g fill="{color}"><circle cx="3" cy="3" r="3"/><circle cx="13" cy="13" r="3"/></g></svg>'},kA=4,ko=function(n){var e=document.createElement("span");return e.innerText=n,e.classList.add("tooltiptext"),navigator.userAgent.indexOf("Edg")!=-1?e.classList.add("edge"):navigator.userAgent.indexOf("Chrome")!=-1?e.classList.add("chrome"):navigator.userAgent.indexOf("Safari")!=-1?e.classList.add("safari"):navigator.userAgent.indexOf("Firefox")!=-1&&e.classList.add("firefox"),navigator.userAgent.indexOf("Windows")!=-1?e.classList.add("win"):navigator.userAgent.indexOf("Macintosh")!=-1&&e.classList.add("mac"),e},Ti=function(n,e,t){t===void 0&&(t=!1);function r(i){var o=e.getBoundingClientRect(),l=n.getBoundingClientRect(),a=o.x+l.width>window.innerWidth?window.innerWidth-l.width:o.x,l=o.y+o.height+l.height+kA>window.innerHeight?o.y-l.height-kA:o.y+o.height+kA;t&&e.parentElement&&(o=e.parentElement?e.parentElement.getBoundingClientRect():null,n.style.position="absolute",a-=o.x,l-=o.y),n.style.transform="translate(".concat(a,"px, ").concat(l,"px)"),n.style.display="block"}e.addEventListener("mouseover",r),e.addEventListener("focusin",r),e.addEventListener("keydown",function(i){i.key!=="Escape"&&i.key!=="Esc"||n.style.display!=="block"||(i.stopPropagation(),n.style.display="none")})},toe=window&&window.__extends||function(){var n=function(e,t){return(n=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(r,i){r.__proto__=i}:function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])}))(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),noe=(function(n){n.TopLeft="top-left",n.TopRight="top-right",n.BottomLeft="bottom-left",n.BottomRight="bottom-right",n.NonFixed="non-fixed"}(xa=xa||{}),function(n){function e(){var t=n!==null&&n.apply(this,arguments)||this;return t.position=xa.NonFixed,t}return toe(e,n),e}(ii)),roe=function(){function n(e){var t;e&&(t=void 0,3<=(t=typeof e=="string"?this.getRBGA(e):e).length)&&(this.r=t[0],this.g=t[1],this.b=t[2],3<t.length)&&(this.a=t[3])}return n.prototype.getLuminosity=function(){for(var e=[this.r,this.g,this.b],t=[],r=0;r<e.length;r++){var i=e[r]/255;t[r]=i<=.03928?i/12.92:Math.pow((.055+i)/1.055,2.4)}return .2126*t[0]+.7152*t[1]+.0722*t[2]},n.prototype.getRBGA=function(r){var t=document.createElement("canvas").getContext("2d"),r=(t.globalAlpha=1,t.fillStyle=r,t.fillRect(0,0,1,1),t.getImageData(0,0,1,1).data);return[r[0],r[1],r[2],r[3]]},n}(),ws=(function(n){n.light="light",n.dark="dark",n.auto="auto"}(Ro=Ro||{}),Map),Wl=function(){function n(){this.listeners=new ws}return n.prototype._addEventListener=function(e,t,r){this.listeners.has(e)||this.listeners.set(e,new ws),this.listeners.get(e).set(t,r)},n.prototype._removeEventListener=function(e,t){this.listeners.has(e)&&this.listeners.get(e).delete(t)},n.prototype._invokeEvent=function(e,t){var r=this;this.listeners.has(e)&&this.listeners.get(e).forEach(function(i,o){i&&r._removeEventListener(e,o);try{o(t)}catch(a){console.error(a)}})},n}(),ioe=Object.freeze({__proto__:null,EventEmitter:Wl}),ooe=window&&window.__extends||function(){var n=function(e,t){return(n=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(r,i){r.__proto__=i}:function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])}))(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),xs=function(n){function e(){var t=n!==null&&n.apply(this,arguments)||this;return t._onStyleChange=function(){t._map.getStyle().style.toLowerCase().startsWith("blank")?t._observer||(t._onBackgroundChange(),t._observer=new MutationObserver(t._onBackgroundChange),t._observer.observe(t._map.getMapContainer(),{attributes:!0,attributeFilter:["style"]})):(t._observer&&(t._observer.disconnect(),delete t._observer),t._map.styles.getThemeAsync(t._map.getStyle()).then(function(r){t._setTheme(r)}))},t._onBackgroundChange=function(){var r=new roe(t._map.getMapContainer().style.backgroundColor).getLuminosity(),r=isNaN(r)||.5<r?Ro.light:Ro.dark;t._setTheme(r)},t}return ooe(e,n),e.prototype.onRemove=function(){this._container&&(this._container.remove(),delete this._container),this._map&&(this._map.events.remove("stylechanged",this._onStyleChange),delete this._map),this._observer&&(this._observer.disconnect(),delete this._observer),delete this._theme},e.prototype.buildContainer=function(t,r,i,o){return this._map=t,this._container=document.createElement(o||"div"),this._container.classList.add("azure-maps-control-container"),typeof i=="string"&&this._container.setAttribute("aria-label",i),r.toLowerCase()===Ro.auto?this._map&&this._map.events.add("stylechanged",this._onStyleChange):this._container.classList.add(r),this._container},e.prototype._setTheme=function(t){this._theme!==t&&(this._container.classList.remove(this._theme),this._container.classList.add(t),this._theme=t)},e.activateClickDelay=100,e}(Wl),aoe=window&&window.__extends||function(){var n=function(e,t){return(n=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(r,i){r.__proto__=i}:function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])}))(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),soe=function(n){function e(){var t=n!==null&&n.apply(this,arguments)||this;return t.rotationDegreesDelta=15,t.style=Ro.light,t.inverted=!1,t}return aoe(e,n),e}(ii),coe=window&&window.__extends||function(){var n=function(e,t){return(n=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(r,i){r.__proto__=i}:function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])}))(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),DF=function(n){function e(t){var r=n.call(this)||this;return r.hasMouse=!1,r.hasFocus=!1,r.options=new soe().merge(t),r}return coe(e,n),e.prototype.onAdd=function(t,r){function i(g){g?(a.classList.add("in-use"),h.classList.remove("hidden-accessible-element")):(a.classList.remove("in-use"),h.classList.add("hidden-accessible-element"))}var o=this,a=this.buildContainer(t,this.options.style,"Rotation Control"),l=this.constructRotationButton(t),h=this.constructRotationGrid(t,r),p=ko("Reset to Default Rotation");return a.addEventListener("mouseover",function(g){o.lastActiveTime=o.lastActiveTime||g.timeStamp,o.hasMouse=!0,i(!0)}),a.addEventListener("focusin",function(g){o.lastActiveTime=o.lastActiveTime||g.timeStamp,o.hasFocus=!0,i(!0)}),a.addEventListener("mouseleave",function(){o.hasMouse=!1,o.hasFocus||(delete o.lastActiveTime,i(!1))}),a.addEventListener("focusout",function(g){g.relatedTarget instanceof Node&&a.contains(g.relatedTarget)||(o.hasFocus=!1,o.hasMouse)||(delete o.lastActiveTime,i(!1))}),h.addEventListener("keydown",function(g){g.key!=="Escape"&&g.key!=="Esc"||(g.stopPropagation(),l.focus(),i(!1))}),l.addEventListener("keydown",function(g){g.key!=="Escape"&&g.key!=="Esc"||a==null||!a.classList.contains("in-use")||(p==null?void 0:p.style.display)!=="none"||(g.stopPropagation(),i(!1))}),r&&e.InvertOrderPositions.includes(r.position)?(a.appendChild(h),a.appendChild(l),a.appendChild(p),Ti(p,l)):(a.appendChild(l),a.appendChild(p),Ti(p,l),a.appendChild(h)),a},e.prototype.constructRotationGrid=function(a,r){var i=document.createElement("div"),o=(i.classList.add("sub-container"),i.classList.add("hidden-accessible-element"),this.constructRightRotationButton(a)),a=this.constructLeftRotationButton(a),l=ko("Rotate Left"),h=ko("Rotate Right");return r&&e.InvertOrderPositions.includes(r.position)?(i.appendChild(o),i.appendChild(h),Ti(h,o),i.appendChild(a),i.appendChild(l),Ti(l,a)):(i.appendChild(a),i.appendChild(l),Ti(l,a),i.appendChild(o),i.appendChild(h),Ti(h,o)),i},e.prototype.constructRotationButton=function(t){var r=this,i=document.createElement("button"),o=(i.classList.add("azure-maps-control-button"),i.classList.add("rotation"),i.setAttribute("aria-label","Reset to Default Rotation"),i.setAttribute("alt","Reset to Default Rotation"),i.setAttribute("type","button"),document.createElement("div"));return i.appendChild(o),i.addEventListener("click",function(a){a.timeStamp-r.lastActiveTime>xs.activateClickDelay&&t.setCamera({bearing:e.DefaultRotation},!0)}),t.events.add("rotate",function(a){o.style.transform="rotate(".concat(-a.map.getCamera().bearing,"deg)")}),i},e.prototype.constructRightRotationButton=function(t){var r=this,i=document.createElement("button");return i.classList.add("azure-maps-control-button"),i.classList.add("rotation-right"),i.setAttribute("aria-label","Rotate Right"),i.setAttribute("alt","Rotate Right"),i.setAttribute("type","button"),i.addEventListener("click",function(){t.setCamera({bearing:t.getCamera().bearing-(r.options.inverted?-1:1)*r.options.rotationDegreesDelta,duration:e.RotationDuration,type:"ease"},!0)}),i},e.prototype.constructLeftRotationButton=function(t){var r=this,i=document.createElement("button");return i.classList.add("azure-maps-control-button"),i.classList.add("rotation-left"),i.setAttribute("aria-label","Rotate Left"),i.setAttribute("alt","Rotate Left"),i.setAttribute("type","button"),i.addEventListener("click",function(){t.setCamera({bearing:t.getCamera().bearing+(r.options.inverted?-1:1)*r.options.rotationDegreesDelta,duration:e.RotationDuration,type:"ease"},!0)}),i},e.DefaultRotation=0,e.RotationDuration=100,e.InvertOrderPositions=[xa.BottomRight,xa.TopRight],e}(xs),loe=window&&window.__extends||function(){var n=function(e,t){return(n=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(r,i){r.__proto__=i}:function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])}))(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),uoe=function(n){function e(){var t=n!==null&&n.apply(this,arguments)||this;return t.pitchDegreesDelta=10,t.style=Ro.light,t.inverted=!1,t}return loe(e,n),e}(ii),hoe=window&&window.__extends||function(){var n=function(e,t){return(n=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(r,i){r.__proto__=i}:function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])}))(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),doe=function(n){function e(t){var r=n.call(this)||this;return r.container=null,r.map=null,r.pitchButton=null,r.pitchIncrementButton=null,r.pitchDecrementButton=null,r.hasMouse=!1,r.hasFocus=!1,r.pitchChanged=function(i){return r.updatePitchButtonsState()},r.updatePitchButtonsState=function(){var i=r.map.getCamera().pitch<=0,o=60<=r.map.getCamera().pitch;r.hasFocus&&r.pitchButton&&(i||o)&&r.pitchButton.focus(),r.options.inverted?(r.pitchIncrementButton&&r.pitchIncrementButton.disabled!=i&&(r.pitchIncrementButton.disabled=i),r.pitchDecrementButton&&r.pitchDecrementButton.disabled!=o&&(r.pitchDecrementButton.disabled=o)):(r.pitchIncrementButton&&r.pitchIncrementButton.disabled!=o&&(r.pitchIncrementButton.disabled=o),r.pitchDecrementButton&&r.pitchDecrementButton.disabled!=i&&(r.pitchDecrementButton.disabled=i))},r.options=new uoe().merge(t),r}return hoe(e,n),e.prototype.onAdd=function(t,r){function i(g){g?(a.classList.add("in-use"),h.classList.remove("hidden-accessible-element")):(a.classList.remove("in-use"),h.classList.add("hidden-accessible-element"))}var o=this,a=this.buildContainer(t,this.options.style,"Pitch Control"),l=this.constructPitchButton(t),h=this.constructPitchGrid(t,r),p=ko("Reset to Default Pitch");return a.addEventListener("mouseover",function(g){o.lastActiveTime=o.lastActiveTime||g.timeStamp,o.hasMouse=!0,i(!0)}),a.addEventListener("focusin",function(g){o.lastActiveTime=o.lastActiveTime||g.timeStamp,o.hasFocus=!0,i(!0)}),a.addEventListener("mouseleave",function(){o.hasMouse=!1,o.hasFocus||(delete o.lastActiveTime,i(!1))}),a.addEventListener("focusout",function(g){g.relatedTarget instanceof Node&&a.contains(g.relatedTarget)||(o.hasFocus=!1,o.hasMouse)||(delete o.lastActiveTime,i(!1))}),h.addEventListener("keydown",function(g){g.key!=="Escape"&&g.key!=="Esc"||(g.stopPropagation(),l.focus(),i(!1))}),l.addEventListener("keydown",function(g){g.key!=="Escape"&&g.key!=="Esc"||a==null||!a.classList.contains("in-use")||(p==null?void 0:p.style.display)!=="none"||(g.stopPropagation(),i(!1))}),r&&e.INVERT_ORDER_POSITIONS.includes(r.position)?(a.appendChild(h),a.appendChild(l),a.appendChild(p),Ti(p,a)):(a.appendChild(l),a.appendChild(p),Ti(p,a),a.appendChild(h)),this.map=t,this.container=a,this.pitchButton=l,t.events.add("pitch",this.pitchChanged),this.updatePitchButtonsState(),a},e.prototype.onRemove=function(){this.container&&(this.container.remove(),this.container=null,this.pitchButton=null,this.pitchIncrementButton=null,this.pitchDecrementButton=null),this.map&&(this.map.events.remove("pitch",this.pitchChanged),this.map=null)},e.prototype.constructPitchGrid=function(o,r){var i=document.createElement("div"),o=(i.classList.add("sub-container"),i.classList.add("hidden-accessible-element"),this.pitchIncrementButton=this.constructPitchIncrementButton(o),this.pitchDecrementButton=this.constructPitchDecrementButton(o),ko("Increase Pitch")),a=ko("Decrease Pitch");return r&&e.INVERT_ORDER_POSITIONS.includes(r.position)?(i.appendChild(this.pitchDecrementButton),i.appendChild(a),Ti(a,this.pitchDecrementButton),i.appendChild(this.pitchIncrementButton),i.appendChild(o),Ti(o,this.pitchIncrementButton)):(i.appendChild(this.pitchIncrementButton),i.appendChild(o),Ti(o,this.pitchIncrementButton),i.appendChild(this.pitchDecrementButton),i.appendChild(a),Ti(a,this.pitchDecrementButton)),i},e.prototype.constructPitchButton=function(t){var r=this,i=document.createElement("button");return i.classList.add("azure-maps-control-button"),i.classList.add("pitch"),i.setAttribute("aria-label","Reset to Default Pitch"),i.setAttribute("alt","Reset to Default Pitch"),i.setAttribute("type","button"),i.addEventListener("click",function(){event.timeStamp-r.lastActiveTime>xs.activateClickDelay&&t.setCamera({pitch:e.DEFAULT_PITCH},!0)}),i},e.prototype.constructPitchDecrementButton=function(t){var r=this,i=document.createElement("button");return i.classList.add("azure-maps-control-button"),i.classList.add("pitch-down"),i.setAttribute("aria-label","Decrease Pitch"),i.setAttribute("alt","Decrease Pitch"),i.setAttribute("type","button"),i.addEventListener("click",function(){t.setCamera({pitch:t.getCamera().pitch-(r.options.inverted?-1:1)*r.options.pitchDegreesDelta,duration:e.PITCH_DURATION_MS,type:"ease"},!0)}),i},e.prototype.constructPitchIncrementButton=function(t){var r=this,i=document.createElement("button");return i.classList.add("azure-maps-control-button"),i.classList.add("pitch-up"),i.setAttribute("aria-label","Increase Pitch"),i.setAttribute("alt","Increase Pitch"),i.setAttribute("type","button"),i.addEventListener("click",function(){t.setCamera({pitch:t.getCamera().pitch+(r.options.inverted?-1:1)*r.options.pitchDegreesDelta,duration:e.PITCH_DURATION_MS,type:"ease"},!0)}),i},e.PITCH_DURATION_MS=100,e.DEFAULT_PITCH=0,e.INVERT_ORDER_POSITIONS=[xa.BottomRight,xa.TopRight],e}(xs),foe=window&&window.__extends||function(){var n=function(e,t){return(n=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(r,i){r.__proto__=i}:function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])}))(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),poe=function(n){function e(t){var r=n.call(this)||this;return r.map=null,r.control=new wa.ScaleControl({maxWidth:t==null?void 0:t.maxWidth,unit:t==null?void 0:t.unit}),r}return foe(e,n),e.prototype.onAdd=function(t,r){this.map=t,(i=(i=this.map)==null?void 0:i._getMap())!=null&&i.addControl(this.control);var i=this.buildContainer(t,Ro.auto,"Scale Bar");return i.appendChild((t=this.control)==null?void 0:t._container),i},e.prototype.onRemove=function(){var t;n.prototype.onRemove.call(this),(t=(t=this.map)==null?void 0:t._getMap())!=null&&t.removeControl(this.control),this.map=null},e.prototype.setUnit=function(t){var r;(r=this.control)!=null&&r.setUnit(t)},e}(xs);function goe(){this.__data__=[],this.size=0}var moe=goe;function yoe(n,e){return n===e||n!=n&&e!=e}var C_=yoe,_oe=C_;function voe(n,e){for(var t=n.length;t--;)if(_oe(n[t][0],e))return t;return-1}var H1=voe,boe=H1,woe=Array.prototype,xoe=woe.splice;function Eoe(t){var e=this.__data__,t=boe(e,t);return!(t<0||(t==e.length-1?e.pop():xoe.call(e,t,1),--this.size,0))}var Toe=H1;function Soe(t){var e=this.__data__,t=Toe(e,t);return t<0?void 0:e[t][1]}var Coe=H1;function Aoe(n){return-1<Coe(this.__data__,n)}var Ioe=H1;function Poe(n,e){var t=this.__data__,r=Ioe(t,n);return r<0?(++this.size,t.push([n,e])):t[r][1]=e,this}var Moe=moe,Roe=Eoe,koe=Soe,Ooe=Aoe,Loe=Poe;function hg(n){var e=-1,t=n==null?0:n.length;for(this.clear();++e<t;){var r=n[e];this.set(r[0],r[1])}}hg.prototype.clear=Moe,hg.prototype.delete=Roe,hg.prototype.get=koe,hg.prototype.has=Ooe,hg.prototype.set=Loe;var G1=hg,Noe=G1;function Doe(){this.__data__=new Noe,this.size=0}var Foe=Doe;function Boe(t){var e=this.__data__,t=e.delete(t);return this.size=e.size,t}var Uoe=Boe;function zoe(n){return this.__data__.get(n)}var joe=zoe;function Voe(n){return this.__data__.has(n)}var Hoe=Voe,Goe=typeof U1=="object"&&U1&&U1.Object===Object&&U1,FF=Goe,qoe=FF,$oe=typeof self=="object"&&self&&self.Object===Object&&self,Woe=qoe||$oe||Function("return this")(),Xc=Woe,Yoe=Xc.Symbol,Hd=Yoe,BF=Hd,UF=Object.prototype,Koe=UF.hasOwnProperty,Zoe=UF.toString,A_=BF?BF.toStringTag:void 0;function Xoe(n){var e=Koe.call(n,A_),t=n[A_];try{var r=!(n[A_]=void 0)}catch{}var i=Zoe.call(n);return r&&(e?n[A_]=t:delete n[A_]),i}var Qoe=Xoe,Joe=Object.prototype,eae=Joe.toString;function tae(n){return eae.call(n)}var nae=Qoe,rae=tae,iae="[object Null]",oae="[object Undefined]",zF=Hd?Hd.toStringTag:void 0;function aae(n){return n==null?n===void 0?oae:iae:(zF&&zF in Object(n)?nae:rae)(n)}var I_=aae;function sae(n){var e=typeof n;return n!=null&&(e=="object"||e=="function")}var sh=sae,cae=I_,lae=sh,uae="[object AsyncFunction]",hae="[object Function]",dae="[object GeneratorFunction]",fae="[object Proxy]";function pae(n){return!!lae(n)&&((n=cae(n))==hae||n==dae||n==uae||n==fae)}var OA=pae,gae=Xc["__core-js_shared__"],LA=gae,jF=function(){var n=/[^.]+$/.exec(LA&&LA.keys&&LA.keys.IE_PROTO||"");return n?"Symbol(src)_1."+n:""}();function mae(n){return!!jF&&jF in n}var yae=mae,_ae=Function.prototype,vae=_ae.toString;function bae(n){if(n!=null){try{return vae.call(n)}catch{}try{return n+""}catch{}}return""}var VF=bae,wae=OA,xae=yae,Eae=sh,Tae=VF,Sae=/[\\^$.*+?()[\]{}|]/g,Cae=/^\[object .+?Constructor\]$/,Aae=Function.prototype,Iae=Object.prototype,Pae=Aae.toString,Mae=Iae.hasOwnProperty,Rae=RegExp("^"+Pae.call(Mae).replace(Sae,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function kae(n){return!(!Eae(n)||xae(n))&&(wae(n)?Rae:Cae).test(Tae(n))}function Oae(n,e){return n==null?void 0:n[e]}var Lae=kae,Nae=Oae;function Dae(n,e){return n=Nae(n,e),Lae(n)?n:void 0}var Gd=Dae,Fae=Gd(Xc,"Map"),NA=Fae,Bae=Gd(Object,"create"),q1=Bae,HF=q1;function Uae(){this.__data__=HF?HF(null):{},this.size=0}var zae=Uae;function jae(n){return n=this.has(n)&&delete this.__data__[n],this.size-=n?1:0,n}var Vae=jae,Hae=q1,Gae="__lodash_hash_undefined__",qae=Object.prototype,$ae=qae.hasOwnProperty;function Wae(n){var e,t=this.__data__;return Hae?(e=t[n])===Gae?void 0:e:$ae.call(t,n)?t[n]:void 0}var Yae=Wae,Kae=q1,Zae=Object.prototype,Xae=Zae.hasOwnProperty;function Qae(n){var e=this.__data__;return Kae?e[n]!==void 0:Xae.call(e,n)}var Jae=q1,ese="__lodash_hash_undefined__";function tse(n,e){var t=this.__data__;return this.size+=this.has(n)?0:1,t[n]=Jae&&e===void 0?ese:e,this}var nse=zae,rse=Vae,ise=Yae,ose=Qae,ase=tse;function dg(n){var e=-1,t=n==null?0:n.length;for(this.clear();++e<t;){var r=n[e];this.set(r[0],r[1])}}dg.prototype.clear=nse,dg.prototype.delete=rse,dg.prototype.get=ise,dg.prototype.has=ose,dg.prototype.set=ase;var GF=dg,sse=G1,cse=NA;function lse(){this.size=0,this.__data__={hash:new GF,map:new(cse||sse),string:new GF}}function use(n){var e=typeof n;return e=="string"||e=="number"||e=="symbol"||e=="boolean"?n!=="__proto__":n===null}var hse=use;function $1(n,e){return n=n.__data__,hse(e)?n[typeof e=="string"?"string":"hash"]:n.map}var dse=$1;function fse(n){return n=dse(this,n).delete(n),this.size-=n?1:0,n}var pse=$1;function gse(n){return pse(this,n).get(n)}var mse=$1;function yse(n){return mse(this,n).has(n)}var _se=$1;function vse(n,e){var t=_se(this,n),r=t.size;return t.set(n,e),this.size+=t.size==r?0:1,this}var bse=lse,wse=fse,xse=gse,Ese=yse,Tse=vse;function fg(n){var e=-1,t=n==null?0:n.length;for(this.clear();++e<t;){var r=n[e];this.set(r[0],r[1])}}fg.prototype.clear=bse,fg.prototype.delete=wse,fg.prototype.get=xse,fg.prototype.has=Ese,fg.prototype.set=Tse;var qF=fg,Sse=G1,Cse=NA,Ase=qF,Ise=200;function Pse(n,e){var t=this.__data__;if(t instanceof Sse){var r=t.__data__;if(!Cse||r.length<Ise-1)return r.push([n,e]),this.size=++t.size,this;t=this.__data__=new Ase(r)}return t.set(n,e),this.size=t.size,this}var Mse=G1,Rse=Foe,kse=Uoe,Ose=joe,Lse=Hoe,Nse=Pse;function pg(n){n=this.__data__=new Mse(n),this.size=n.size}pg.prototype.clear=Rse,pg.prototype.delete=kse,pg.prototype.get=Ose,pg.prototype.has=Lse,pg.prototype.set=Nse;var DA=pg;function Dse(n,e){for(var t=-1,r=n==null?0:n.length;++t<r&&e(n[t],t,n)!==!1;);return n}var Fse=Dse,Bse=Gd,Use=function(){try{var n=Bse(Object,"defineProperty");return n({},"",{}),n}catch{}}(),$F=Use,WF=$F;function zse(n,e,t){e=="__proto__"&&WF?WF(n,e,{configurable:!0,enumerable:!0,value:t,writable:!0}):n[e]=t}var FA=zse,jse=FA,Vse=C_,Hse=Object.prototype,Gse=Hse.hasOwnProperty;function qse(n,e,t){var r=n[e];Gse.call(n,e)&&Vse(r,t)&&(t!==void 0||e in n)||jse(n,e,t)}var YF=qse,$se=YF,Wse=FA;function Yse(n,e,t,r){for(var i=!t,o=(t=t||{},-1),a=e.length;++o<a;){var l=e[o],h=r?r(t[l],n[l],l,t,n):void 0;h===void 0&&(h=n[l]),(i?Wse:$se)(t,l,h)}return t}var P_=Yse;function Kse(n,e){for(var t=-1,r=Array(n);++t<n;)r[t]=e(t);return r}var Zse=Kse;function Xse(n){return n!=null&&typeof n=="object"}var Yl=Xse,Qse=I_,Jse=Yl,ece="[object Arguments]";function tce(n){return Jse(n)&&Qse(n)==ece}var KF=tce,nce=Yl,ZF=Object.prototype,rce=ZF.hasOwnProperty,ice=ZF.propertyIsEnumerable,oce=KF(function(){return arguments}())?KF:function(n){return nce(n)&&rce.call(n,"callee")&&!ice.call(n,"callee")},XF=oce,ace=Array.isArray,M_=ace,W1={exports:{}};function sce(){return!1}var cce=sce,Y1=(W1.exports,function(n,r){var r=r&&!r.nodeType&&r,t=r&&n&&!n.nodeType&&n,t=t&&t.exports===r?Xc.Buffer:void 0,r=t?t.isBuffer:void 0;n.exports=r||cce}(W1,W1.exports),W1.exports),lce=9007199254740991,uce=/^(?:0|[1-9]\d*)$/;function hce(n,e){var t=typeof n;return!!(e=e??lce)&&(t=="number"||t!="symbol"&&uce.test(n))&&-1<n&&n%1==0&&n<e}var QF=hce,dce=9007199254740991;function fce(n){return typeof n=="number"&&-1<n&&n%1==0&&n<=dce}var JF=fce,pce=I_,gce=JF,mce=Yl,yce="[object Arguments]",_ce="[object Array]",vce="[object Boolean]",bce="[object Date]",wce="[object Error]",xce="[object Function]",Ece="[object Map]",Tce="[object Number]",Sce="[object Object]",Cce="[object RegExp]",Ace="[object Set]",Ice="[object String]",Pce="[object WeakMap]",Mce="[object ArrayBuffer]",Rce="[object DataView]",kce="[object Float32Array]",Oce="[object Float64Array]",Lce="[object Int8Array]",Nce="[object Int16Array]",Dce="[object Int32Array]",Fce="[object Uint8Array]",Bce="[object Uint8ClampedArray]",Uce="[object Uint16Array]",zce="[object Uint32Array]",Si={};function jce(n){return mce(n)&&gce(n.length)&&!!Si[pce(n)]}Si[kce]=Si[Oce]=Si[Lce]=Si[Nce]=Si[Dce]=Si[Fce]=Si[Bce]=Si[Uce]=Si[zce]=!0,Si[yce]=Si[_ce]=Si[Mce]=Si[vce]=Si[Rce]=Si[bce]=Si[wce]=Si[xce]=Si[Ece]=Si[Tce]=Si[Sce]=Si[Cce]=Si[Ace]=Si[Ice]=Si[Pce]=!1;var Vce=jce;function Hce(n){return function(e){return n(e)}}var BA=Hce,K1={exports:{}},gg=(K1.exports,function(n,i){var i=i&&!i.nodeType&&i,t=i&&n&&!n.nodeType&&n,r=t&&t.exports===i&&FF.process,i=function(){try{var o=t&&t.require&&t.require("util").types;return o||r&&r.binding&&r.binding("util")}catch{}}();n.exports=i}(K1,K1.exports),K1.exports),Gce=Vce,qce=BA,e5=gg&&gg.isTypedArray,$ce=e5?qce(e5):Gce,UA=$ce,Wce=Zse,Yce=XF,Kce=M_,Zce=Y1,Xce=QF,Qce=UA,Jce=Object.prototype,ele=Jce.hasOwnProperty;function tle(n,e){var t,r=Kce(n),i=!r&&Yce(n),o=!r&&!i&&Zce(n),a=!r&&!i&&!o&&Qce(n),l=r||i||o||a,h=l?Wce(n.length,String):[],p=h.length;for(t in n)!e&&!ele.call(n,t)||l&&(t=="length"||o&&(t=="offset"||t=="parent")||a&&(t=="buffer"||t=="byteLength"||t=="byteOffset")||Xce(t,p))||h.push(t);return h}var t5=tle,nle=Object.prototype;function rle(n){var e=n&&n.constructor;return n===(typeof e=="function"&&e.prototype||nle)}var zA=rle;function ile(n,e){return function(t){return n(e(t))}}var n5=ile,ole=n5(Object.keys,Object),ale=zA,sle=ole,cle=Object.prototype,lle=cle.hasOwnProperty;function ule(n){if(!ale(n))return sle(n);var e,t=[];for(e in Object(n))lle.call(n,e)&&e!="constructor"&&t.push(e);return t}var hle=OA,dle=JF;function fle(n){return n!=null&&dle(n.length)&&!hle(n)}var Z1=fle,ple=t5,gle=ule,mle=Z1;function yle(n){return(mle(n)?ple:gle)(n)}var jA=yle,_le=P_,vle=jA;function ble(n,e){return n&&_le(e,vle(e),n)}var wle=ble;function xle(n){var e=[];if(n!=null)for(var t in Object(n))e.push(t);return e}var Ele=sh,Tle=zA,Sle=xle,Cle=Object.prototype,Ale=Cle.hasOwnProperty;function Ile(n){if(!Ele(n))return Sle(n);var e,t=Tle(n),r=[];for(e in n)(e!="constructor"||!t&&Ale.call(n,e))&&r.push(e);return r}var Ple=t5,Mle=Ile,Rle=Z1;function kle(n){return Rle(n)?Ple(n,!0):Mle(n)}var R_=kle,Ole=P_,Lle=R_;function Nle(n,e){return n&&Ole(e,Lle(e),n)}var Dle=Nle,X1={exports:{}},r5=(X1.exports,function(n,t){var t=t&&!t.nodeType&&t,r=t&&n&&!n.nodeType&&n,r=r&&r.exports===t?Xc.Buffer:void 0,i=r?r.allocUnsafe:void 0;n.exports=function(o,a){return a?o.slice():(a=o.length,a=i?i(a):new o.constructor(a),o.copy(a),a)}}(X1,X1.exports),X1.exports);function Fle(n,e){var t=-1,r=n.length;for(e=e||Array(r);++t<r;)e[t]=n[t];return e}var i5=Fle;function Ble(n,e){for(var t=-1,r=n==null?0:n.length,i=0,o=[];++t<r;){var a=n[t];e(a,t,n)&&(o[i++]=a)}return o}function Ule(){return[]}var o5=Ule,zle=Ble,jle=o5,Vle=Object.prototype,Hle=Vle.propertyIsEnumerable,a5=Object.getOwnPropertySymbols,Gle=a5?function(n){return n==null?[]:(n=Object(n),zle(a5(n),function(e){return Hle.call(n,e)}))}:jle,VA=Gle,qle=P_,$le=VA;function Wle(n,e){return qle(n,$le(n),e)}var Yle=Wle;function Kle(n,e){for(var t=-1,r=e.length,i=n.length;++t<r;)n[i+t]=e[t];return n}var s5=Kle,Zle=n5(Object.getPrototypeOf,Object),HA=Zle,Xle=s5,Qle=HA,Jle=VA,eue=o5,tue=Object.getOwnPropertySymbols,c5=tue?function(n){for(var e=[];n;)Xle(e,Jle(n)),n=Qle(n);return e}:eue,nue=P_,rue=c5;function iue(n,e){return nue(n,rue(n),e)}var oue=iue,aue=s5,sue=M_;function l5(n,e,t){return e=e(n),sue(n)?e:aue(e,t(n))}var cue=l5,lue=VA,uue=jA;function hue(n){return cue(n,uue,lue)}var u5=hue,due=l5,fue=c5,pue=R_;function gue(n){return due(n,pue,fue)}var mue=gue,yue=Gd(Xc,"DataView"),_ue=yue,vue=Gd(Xc,"Promise"),bue=vue,wue=Gd(Xc,"Set"),xue=wue,Eue=Gd(Xc,"WeakMap"),GA=_ue,qA=NA,$A=bue,WA=xue,YA=Eue,h5=I_,mg=VF,d5="[object Map]",Tue="[object Object]",f5="[object Promise]",p5="[object Set]",g5="[object WeakMap]",m5="[object DataView]",Sue=mg(GA),Cue=mg(qA),Aue=mg($A),Iue=mg(WA),Pue=mg(YA),qd=h5,Q1=qd=GA&&qd(new GA(new ArrayBuffer(1)))!=m5||qA&&qd(new qA)!=d5||$A&&qd($A.resolve())!=f5||WA&&qd(new WA)!=p5||YA&&qd(new YA)!=g5?function(t){var e=h5(t),t=e==Tue?t.constructor:void 0,t=t?mg(t):"";if(t)switch(t){case Sue:return m5;case Cue:return d5;case Aue:return f5;case Iue:return p5;case Pue:return g5}return e}:qd,Mue=Object.prototype,Rue=Mue.hasOwnProperty;function kue(n){var e=n.length,t=new n.constructor(e);return e&&typeof n[0]=="string"&&Rue.call(n,"index")&&(t.index=n.index,t.input=n.input),t}var Oue=kue,Lue=Xc.Uint8Array,y5=Lue,_5=y5;function Nue(n){var e=new n.constructor(n.byteLength);return new _5(e).set(new _5(n)),e}var KA=Nue,Due=KA;function Fue(n,e){return e=e?Due(n.buffer):n.buffer,new n.constructor(e,n.byteOffset,n.byteLength)}var Bue=Fue,Uue=/\w*$/;function zue(n){var e=new n.constructor(n.source,Uue.exec(n));return e.lastIndex=n.lastIndex,e}var jue=zue,v5=Hd?Hd.prototype:void 0,b5=v5?v5.valueOf:void 0;function Vue(n){return b5?Object(b5.call(n)):{}}var Hue=KA;function Gue(n,e){return e=e?Hue(n.buffer):n.buffer,new n.constructor(e,n.byteOffset,n.length)}var w5=Gue,que=KA,$ue=Bue,Wue=jue,Yue=Vue,Kue=w5,Zue="[object Boolean]",Xue="[object Date]",Que="[object Map]",Jue="[object Number]",ehe="[object RegExp]",the="[object Set]",nhe="[object String]",rhe="[object Symbol]",ihe="[object ArrayBuffer]",ohe="[object DataView]",ahe="[object Float32Array]",she="[object Float64Array]",che="[object Int8Array]",lhe="[object Int16Array]",uhe="[object Int32Array]",hhe="[object Uint8Array]",dhe="[object Uint8ClampedArray]",fhe="[object Uint16Array]",phe="[object Uint32Array]";function ghe(n,e,t){var r=n.constructor;switch(e){case ihe:return que(n);case Zue:case Xue:return new r(+n);case ohe:return $ue(n,t);case ahe:case she:case che:case lhe:case uhe:case hhe:case dhe:case fhe:case phe:return Kue(n,t);case Que:return new r;case Jue:case nhe:return new r(n);case ehe:return Wue(n);case the:return new r;case rhe:return Yue(n)}}var mhe=ghe,yhe=sh,x5=Object.create,_he=function(){function n(){}return function(e){return yhe(e)?x5?x5(e):(n.prototype=e,e=new n,n.prototype=void 0,e):{}}}(),vhe=_he,bhe=HA,whe=zA;function xhe(n){return typeof n.constructor!="function"||whe(n)?{}:vhe(bhe(n))}var E5=xhe,Ehe=Q1,The=Yl,She="[object Map]";function Che(n){return The(n)&&Ehe(n)==She}var Ahe=Che,Ihe=BA,T5=gg&&gg.isMap,Phe=T5?Ihe(T5):Ahe,Mhe=Phe,Rhe=Q1,khe=Yl,Ohe="[object Set]";function Lhe(n){return khe(n)&&Rhe(n)==Ohe}var Nhe=Lhe,Dhe=BA,S5=gg&&gg.isSet,Fhe=S5?Dhe(S5):Nhe,Bhe=DA,Uhe=Fse,zhe=YF,jhe=wle,Vhe=Dle,Hhe=r5,Ghe=i5,qhe=Yle,$he=oue,Whe=u5,Yhe=mue,Khe=Q1,Zhe=Oue,Xhe=mhe,Qhe=E5,Jhe=M_,ede=Y1,tde=Mhe,nde=sh,rde=Fhe,ide=jA,ode=R_,ade=1,sde=2,cde=4,C5="[object Arguments]",lde="[object Array]",ude="[object Boolean]",hde="[object Date]",dde="[object Error]",A5="[object Function]",fde="[object GeneratorFunction]",pde="[object Map]",gde="[object Number]",I5="[object Object]",mde="[object RegExp]",yde="[object Set]",_de="[object String]",vde="[object Symbol]",bde="[object WeakMap]",wde="[object ArrayBuffer]",xde="[object DataView]",Ede="[object Float32Array]",Tde="[object Float64Array]",Sde="[object Int8Array]",Cde="[object Int16Array]",Ade="[object Int32Array]",Ide="[object Uint8Array]",Pde="[object Uint8ClampedArray]",Mde="[object Uint16Array]",Rde="[object Uint32Array]",fi={};function J1(n,e,t,r,i,o){var a,l=e&ade,h=e&sde,p=e&cde;if((a=t?i?t(n,r,i,o):t(n):a)===void 0){if(!nde(n))return n;if(r=Jhe(n),r){if(a=Zhe(n),!l)return Ghe(n,a)}else{var g=Khe(n),_=g==A5||g==fde;if(ede(n))return Hhe(n,l);if(g==I5||g==C5||_&&!i){if(a=h||_?{}:Qhe(n),!l)return h?$he(n,Vhe(a,n)):qhe(n,jhe(a,n))}else{if(!fi[g])return i?n:{};a=Xhe(n,g,l)}}if(_=(o=o||new Bhe).get(n),_)return _;o.set(n,a),rde(n)?n.forEach(function(C){a.add(J1(C,e,t,C,n,o))}):tde(n)&&n.forEach(function(C,M){a.set(M,J1(C,e,t,M,n,o))});var x=r?void 0:(p?h?Yhe:Whe:h?ode:ide)(n);Uhe(x||n,function(C,M){x&&(C=n[M=C]),zhe(a,M,J1(C,e,t,M,n,o))})}return a}fi[C5]=fi[lde]=fi[wde]=fi[xde]=fi[ude]=fi[hde]=fi[Ede]=fi[Tde]=fi[Sde]=fi[Cde]=fi[Ade]=fi[pde]=fi[gde]=fi[I5]=fi[mde]=fi[yde]=fi[_de]=fi[vde]=fi[Ide]=fi[Pde]=fi[Mde]=fi[Rde]=!0,fi[dde]=fi[A5]=fi[bde]=!1;var P5=J1,kde=P5,Ode=1,Lde=4;function Nde(n){return kde(n,Ode|Lde)}var Zi=ih(Nde),Dde=FA,Fde=C_;function Bde(n,e,t){(t===void 0||Fde(n[e],t))&&(t!==void 0||e in n)||Dde(n,e,t)}var M5=Bde;function Ude(n){return function(e,t,r){for(var i=-1,o=Object(e),a=r(e),l=a.length;l--;){var h=a[n?l:++i];if(t(o[h],h,o)===!1)break}return e}}var zde=Ude(),jde=zde,Vde=Z1,Hde=Yl;function Gde(n){return Hde(n)&&Vde(n)}var qde=Gde,$de=I_,Wde=HA,Yde=Yl,Kde="[object Object]",Zde=Function.prototype,Xde=Object.prototype,R5=Zde.toString,Qde=Xde.hasOwnProperty,Jde=R5.call(Object);function efe(n){return!(!Yde(n)||$de(n)!=Kde)&&((n=Wde(n))===null||typeof(n=Qde.call(n,"constructor")&&n.constructor)=="function"&&n instanceof n&&R5.call(n)==Jde)}var k5=efe;function O5(n,e){if((e!=="constructor"||typeof n[e]!="function")&&e!="__proto__")return n[e]}var tfe=P_,nfe=R_;function rfe(n){return tfe(n,nfe(n))}var ife=M5,ofe=r5,afe=w5,sfe=i5,cfe=E5,L5=XF,N5=M_,lfe=qde,ufe=Y1,hfe=OA,dfe=sh,ffe=k5,pfe=UA,D5=O5,gfe=rfe;function mfe(n,e,t,r,i,o,a){var l,h,p,g=D5(n,t),_=D5(e,t),x=a.get(_);x||((e=(x=o?o(g,_,t+"",n,e,a):void 0)===void 0)&&(h=!(l=N5(_))&&ufe(_),p=!l&&!h&&pfe(_),x=_,l||h||p?x=N5(g)?g:lfe(g)?sfe(g):h?ofe(_,!(e=!1)):p?afe(_,!(e=!1)):[]:ffe(_)||L5(_)?L5(x=g)?x=gfe(g):dfe(g)&&!hfe(g)||(x=cfe(_)):e=!1),e&&(a.set(_,x),i(x,_,r,o,a),a.delete(_))),ife(n,t,x)}var yfe=DA,_fe=M5,vfe=jde,bfe=mfe,wfe=sh,xfe=R_,Efe=O5;function F5(n,e,t,r,i){n!==e&&vfe(e,function(o,a){var l;i=i||new yfe,wfe(o)?bfe(n,e,a,t,F5,r,i):(l=r?r(Efe(n,a),o,a+"",n,e,i):void 0,_fe(n,a,l=l===void 0?o:l))},xfe)}var Tfe=F5;function Sfe(n){return n}var B5=Sfe;function Cfe(n,e,t){switch(t.length){case 0:return n.call(e);case 1:return n.call(e,t[0]);case 2:return n.call(e,t[0],t[1]);case 3:return n.call(e,t[0],t[1],t[2])}return n.apply(e,t)}var Afe=Cfe,U5=Math.max;function Ife(n,e,t){return e=U5(e===void 0?n.length-1:e,0),function(){for(var r=arguments,i=-1,o=U5(r.length-e,0),a=Array(o);++i<o;)a[i]=r[e+i];for(var i=-1,l=Array(e+1);++i<e;)l[i]=r[i];return l[e]=t(a),Afe(n,this,l)}}var Pfe=Ife;function Mfe(n){return function(){return n}}var Rfe=Mfe,z5=$F,kfe=z5?function(n,e){return z5(n,"toString",{configurable:!0,enumerable:!1,value:Rfe(e),writable:!0})}:B5,Ofe=kfe,Lfe=800,Nfe=16,Dfe=Date.now;function Ffe(n){var e=0,t=0;return function(){var r=Dfe(),i=Nfe-(r-t);if(t=r,0<i){if(++e>=Lfe)return arguments[0]}else e=0;return n.apply(void 0,arguments)}}var Bfe=Ffe(Ofe),Ufe=B5,zfe=Pfe,jfe=Bfe;function Vfe(n,e){return jfe(zfe(n,e,Ufe),n+"")}var Hfe=C_,Gfe=Z1,qfe=QF,$fe=sh;function Wfe(n,e,t){var r;return!!$fe(t)&&!!((r=typeof e)=="number"?Gfe(t)&&qfe(e,t.length):r=="string"&&e in t)&&Hfe(t[e],n)}var Yfe=Vfe,Kfe=Wfe;function Zfe(n){return Yfe(function(e,t){var r=-1,i=t.length,a=1<i?t[i-1]:void 0,o=2<i?t[2]:void 0,a=3<n.length&&typeof a=="function"?(i--,a):void 0;for(o&&Kfe(t[0],t[1],o)&&(a=i<3?void 0:a,i=1),e=Object(e);++r<i;){var l=t[r];l&&n(e,l,r,a)}return e})}var Xfe=Tfe,Qfe=Zfe(function(n,e,t){Xfe(n,e,t)}),j5=ih(Qfe),Jfe=window&&window.__extends||function(){var n=function(e,t){return(n=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(r,i){r.__proto__=i}:function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])}))(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),epe=function(n){function e(){var t=n!==null&&n.apply(this,arguments)||this;return t.layout="icons",t.mapStyles=["road","grayscale_light","grayscale_dark","night","road_shaded_relief"],t.style=Ro.light,t.autoSelectionMode=!0,t}return Jfe(e,n),e}(ii),tpe=window&&window.__extends||function(){var n=function(e,t){return(n=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(r,i){r.__proto__=i}:function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])}))(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),npe=window&&window.__awaiter||function(n,e,t,r){return new(t=t||Promise)(function(i,o){function a(p){try{h(r.next(p))}catch(g){o(g)}}function l(p){try{h(r.throw(p))}catch(g){o(g)}}function h(p){var g;p.done?i(p.value):((g=p.value)instanceof t?g:new t(function(_){_(g)})).then(a,l)}h((r=r.apply(n,e||[])).next())})},rpe=window&&window.__generator||function(n,e){var t,r,i,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]},a={next:l(0),throw:l(1),return:l(2)};return typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function l(h){return function(p){var g=[h,p];if(t)throw new TypeError("Generator is already executing.");for(;o=a&&g[a=0]?0:o;)try{if(t=1,r&&(i=2&g[0]?r.return:g[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,g[1])).done)return i;switch(r=0,(g=i?[2&g[0],i.value]:g)[0]){case 0:case 1:i=g;break;case 4:return o.label++,{value:g[1],done:!1};case 5:o.label++,r=g[1],g=[0];continue;case 7:g=o.ops.pop(),o.trys.pop();continue;default:if(!(i=0<(i=o.trys).length&&i[i.length-1])&&(g[0]===6||g[0]===2)){o=0;continue}if(g[0]===3&&(!i||g[1]>i[0]&&g[1]<i[3]))o.label=g[1];else if(g[0]===6&&o.label<i[1])o.label=i[1],i=g;else{if(!(i&&o.label<i[2])){i[2]&&o.ops.pop(),o.trys.pop();continue}o.label=i[2],o.ops.push(g)}}g=e.call(n,o)}catch(_){g=[6,_],r=0}finally{t=i=0}if(5&g[0])throw g[1];return{value:g[0]?g[1]:void 0,done:!0}}}},ZA=window&&window.__read||function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var r,i,o=t.call(n),a=[];try{for(;(e===void 0||0<e--)&&!(r=o.next()).done;)a.push(r.value)}catch(l){i={error:l}}finally{try{r&&!r.done&&(t=o.return)&&t.call(o)}finally{if(i)throw i.error}}return a},ipe=function(n){function e(t){var r=n.call(this)||this;return r.styleOpsGrid=null,r.hasMouse=!1,r.hasFocus=!1,r.styleButtons=new ws,r.styleIcons=new ws,r.thumbnailCache={assumedConfiguration:void 0,response:new ws,blob:new ws},r.onStyleChange=function(){var i;r.options.autoSelectionMode&&(i=r.map.getStyle().style,r.setSelectedStyle(i))},r.onMapConfigurationChange=function(i){!r.styleOpsGrid||0<r.styleOpsGrid.children.length&&r.thumbnailCache.assumedConfiguration===i||(r.thumbnailCache.assumedConfiguration=i,Array.from(r.styleOpsGrid.children).forEach(function(o){return o.remove()}),r.styleButtons.clear(),r.populateOpsGridFromDefinitions(i))},r.mapToFriendlyStyleName=function(i,o){return o=o.configurations.find(function(a){return a.name===i}),(o==null?void 0:o.displayName)||i},r.options=new epe().merge(Zi(t)),r}return tpe(e,n),e.prototype.onAdd=function(p,r){function i(g){g?(a.classList.add(e.Css.inUse),l.classList.remove("hidden-accessible-element")):(a.classList.remove(e.Css.inUse),l.classList.add("hidden-accessible-element"))}var o=this,a=(this.map=p,this.buildContainer(p,this.options.style,"Map Style Control")),l=this.buildStyleOpsGrid(),h=(this.styleOpsGrid=l,this.buildCurrStyleBtn()),p=ko("Select Style");return l.classList.add(r&&r.position||"top-right"),a.addEventListener("mouseover",function(){o.hasMouse=!0,i(!0)}),a.addEventListener("focusin",function(){o.hasFocus=!0,i(!0)}),a.addEventListener("mouseleave",function(){o.hasMouse=!1,o.hasFocus||i(!1)}),a.addEventListener("focusout",function(g){g.target===h&&Array.from(l.children).forEach(function(_){return _.removeAttribute("tabIndex")}),g.relatedTarget instanceof Node&&a.contains(g.relatedTarget)||(o.hasFocus=!1,o.hasMouse)||i(!1)}),l.addEventListener("keydown",function(g){g.keyCode===27&&(g.stopPropagation(),h.focus(),Array.from(l.children).forEach(function(_){return _.setAttribute("tabIndex","-1")}),a.classList.contains(e.Css.inUse))&&i(!1)}),h.addEventListener("click",function(g){a.classList.contains(e.Css.inUse)?i(!1):(i(!0),l.firstElementChild&&l.firstElementChild.focus())}),r&&e.InvertOrderPositions.includes(r.position)?(a.appendChild(l),a.appendChild(h),a.appendChild(p),Ti(p,h)):(a.appendChild(h),a.appendChild(p),Ti(p,h),a.appendChild(l)),a},e.prototype.onRemove=function(){n.prototype.onRemove.call(this),this.styleOpsGrid=null,this.styleButtons.clear(),this.thumbnailCache.response.clear(),this.thumbnailCache.blob.clear(),this.thumbnailCache.assumedConfiguration=void 0,this.map.events.remove("stylechanged",this.onStyleChange),this.map.events.remove("mapconfigurationchanged",this.onMapConfigurationChange)},e.prototype.setSelectedStyle=function(t){var r,i,o=this;this.styleIcons.has(t)&&(r=this.currStyleImage,i=this.styleIcons.get(t),r.src!==i&&(r.src=i),Object.entries(this.styleButtons).forEach(function(l){var l=ZA(l,2),h=l[0];return l[1].setAttribute("aria-current",h===t?"true":"false")}),this.map.styles.definitions().then(function(a){a=o.mapToFriendlyStyleName(t,a),r.alt!==a&&(r.alt=a),r.parentElement.lastChild instanceof Text&&(r.parentElement.lastChild.textContent=a)}))},e.prototype.disableStyle=function(t){t=this.styleButtons[t],t&&t.setAttribute("disabled","true")},e.prototype.enableStyle=function(t){t=this.styleButtons[t],t&&t.removeAttribute("disabled")},e.prototype.buildSelectStyleBtn=function(t,p,i){var o=this,a=document.createElement("button"),l=this.mapToFriendlyStyleName(t,p),h=(a.setAttribute("aria-label",l),a.setAttribute("type","button"),new Image),p=(i.then(function(g){var _;return o.thumbnailCache.blob.has(g.url)?o.thumbnailCache.blob.get(g.url):(_=g.clone().blob(),o.thumbnailCache.blob.set(g.url,_),_)}).then(function(g){g=URL.createObjectURL(g),h.src=g,t===o.map.getStyle().style&&(o.currStyleImage.src=g,o.currStyleImage.alt=l,o.currStyleImage.parentElement.lastChild.nodeType==Node.TEXT_NODE?o.currStyleImage.parentElement.lastChild.textContent=l:o.currStyleImage.parentElement.appendChild(document.createTextNode(l))),o.styleIcons.set(t,g)}),h.setAttribute("aria-hidden","true"),a.appendChild(h),this.options.layout==="icons"?a.classList.add(e.Css.button):(a.classList.add(e.Css.listButton),a.classList.add(e.Css.expanded),a.appendChild(document.createTextNode(l))),a.addEventListener("click",function(){o.hasMouse=!1,o.hasFocus=!1;var g=o.styleButtons[t];g&&!g.hasAttribute("disabled")&&(o._invokeEvent("styleselected",t),o.options.autoSelectionMode&&o.map.setStyle({style:t}),Object.entries(o.styleButtons).forEach(function(x){var x=ZA(x,2),C=x[0];return x[1].setAttribute("aria-current",C===t?"true":"false")}))}),document.createElement("div"));return p.classList.add("selected-icon"),a.appendChild(p),a},e.prototype.buildCurrStyleBtn=function(){var t=document.createElement("button"),r=(this.options.layout=="icons"?t.classList.add(e.Css.button):t.classList.add(e.Css.listButton),t.classList.add(e.Css.currentStyle),t.setAttribute("aria-label","Select Style"),t.setAttribute("tabindex","-1"),this.currStyleImage=new Image,t.appendChild(this.currStyleImage),document.createElement("div"));return r.classList.add("icon"),t.appendChild(r),t},e.prototype.buildStyleOpsGrid=function(){var t=this,r=document.createElement("div");return r.classList.add(e.Css.styleOptions),this.options.layout==="icons"?r.classList.add(this.options.layout):r.classList.add(e.Css.dropdown),r.setAttribute("aria-label","Style Options"),r.classList.add("hidden-accessible-element"),this.map.styles.definitions().then(function(i){return npe(t,void 0,void 0,function(){return rpe(this,function(o){return this.onMapConfigurationChange(i),this.map.events.add("stylechanged",this.onStyleChange),[2]})})}),this.map.events.add("mapconfigurationchanged",this.onMapConfigurationChange),r},e.prototype.populateOpsGridFromDefinitions=function(t){var r,i,o=this;this.styleOpsGrid&&(r=t.configurations,(r=Array.isArray(this.options.mapStyles)?r.filter(function(a){return o.options.mapStyles.includes(a.name.split("_indoor")[0])}):r).forEach(function(a){var l,h={url:a.thumbnail},p=(a.thumbnail&&o.map.styles._transformStyleRequest(a.thumbnail,h),o.map.getServiceOptions()),p=(p.transformRequest&&j5(h,p.transformRequest(h.url,"Thumbnail")),o.thumbnailCache.response.has(h.url)?l=Promise.resolve(o.thumbnailCache.response.get(h.url)):(l=fetch(h.url,{headers:h.headers}),o.thumbnailCache.response.set(h.url,l)),o.buildSelectStyleBtn(a.name,t,l));o.styleOpsGrid.appendChild(p),o.styleButtons[a.name]=p,o.options.layout==="icons"&&(h=ko(o.mapToFriendlyStyleName(a.name,t)),o.styleOpsGrid.appendChild(h),Ti(h,p))}),i=this.map.getStyle().style,Object.entries(this.styleButtons).forEach(function(l){var l=ZA(l,2),h=l[0];return l[1].setAttribute("aria-current",h===i?"true":"false")}))},e.InvertOrderPositions=[xa.TopRight,xa.BottomRight],e.Css={button:"azure-maps-control-button",listButton:"azure-maps-control-list-button",expanded:"expanded",currentStyle:"curr-style",inUse:"in-use",styleOptions:"style-options",dropdown:"azure-maps-control-dropdown"},e}(xs),ope=window&&window.__extends||function(){var n=function(e,t){return(n=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(r,i){r.__proto__=i}:function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])}))(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),ew=function(n){function e(){var t=n!==null&&n.apply(this,arguments)||this;return t.flow="none",t.incidents=!1,t}return ope(e,n),e}(ii),ape=window&&window.__extends||function(){var n=function(e,t){return(n=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(r,i){r.__proto__=i}:function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])}))(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),spe=function(n){function e(){var t=n!==null&&n.apply(this,arguments)||this;return t.isActive=!1,t.style=Ro.light,t}return ape(e,n),e}(ew),cpe=window&&window.__extends||function(){var n=function(e,t){return(n=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(r,i){r.__proto__=i}:function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])}))(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),V5=function(n){function e(t){var r,i=this;return(i=n.call(this)||this).hasMouse=!1,i.hasFocus=!1,i.options=new ew().merge({flow:"relative",incidents:!0}),i.style=Ro.light,i.container=null,i.trafficButton=null,i.map=null,t&&(i.initIsActive=(r=t.isActive)!=null&&r,i.options.flow=t.flow||"relative",i.options.incidents=(r=t.incidents)==null||r,i.style=t.style||Ro.light),i}return cpe(e,n),Object.defineProperty(e.prototype,"isActive",{get:function(){var t;return!!this.map&&((t=this.map.getTraffic()).flow!=="none"||t.incidents)},set:function(t){this.map&&this.map.setTraffic({flow:t?this.options.flow:"none",incidents:!!t&&this.options.incidents})},enumerable:!1,configurable:!0}),e.prototype.onAdd=function(r){(this.map=r).getTraffic(),this.initIsActive!==void 0&&(this.isActive=this.initIsActive),this.container=this.buildContainer(r,this.style,"Traffic Control"),this.container.style.flexDirection="column";var r=this.constructTrafficButton(r),i=(this.container.appendChild(r),ko("Toggle Traffic Display"));return this.container.appendChild(i),Ti(i,r),this.container},e.prototype.onRemove=function(){n.prototype.onRemove.call(this),this.map=null},e.prototype.getOptions=function(){return new spe().merge({isActive:this.isActive,flow:this.options.flow,incidents:this.options.incidents,style:this.style})},e.prototype.updateButtonState=function(){this.trafficButton&&(this.isActive?(this.container.classList.add("in-use"),this.trafficButton.setAttribute("aria-description","Traffic is displayed")):(this.container.classList.remove("in-use"),this.trafficButton.removeAttribute("aria-description")),this.trafficButton.setAttribute("aria-pressed",this.isActive?"true":"false"))},e.prototype.constructTrafficButton=function(t){var r=this,i=document.createElement("button");return i.classList.add("azure-maps-control-button"),i.classList.add("traffic"),i.setAttribute("aria-label","Toggle Traffic Display"),i.setAttribute("alt","Toggle Traffic Display"),i.setAttribute("type","button"),this.trafficButton=i,this.updateButtonState(),i.addEventListener("click",function(){r.isActive=!r.isActive}),i},e}(xs),lpe=window&&window.__extends||function(){var n=function(e,t){return(n=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(r,i){r.__proto__=i}:function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])}))(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),H5=window&&window.__values||function(n){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&n[e],r=0;if(t)return t.call(n);if(n&&typeof n.length=="number")return{next:function(){return{value:(n=n&&r>=n.length?void 0:n)&&n[r++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},upe=function(n){function e(){var t=n.call(this)||this;return t.table=["Fast",["green","yellow","red","dark-red"],"Slow"],t.map=null,t.syncHiddenState=null,t}return lpe(e,n),e.prototype.onAdd=function(i){this.map=i;var r=this.buildContainer(i,Ro.auto,"Traffic Legend"),i=this.buildTrafficLegendDiv(i);return r.setAttribute("role","definition"),r.appendChild(i),r},e.prototype.onRemove=function(){n.prototype.onRemove.call(this),this.syncHiddenState&&(this.map.events.remove("styledata",this.syncHiddenState),this.syncHiddenState=null),this.map=null},e.prototype.buildTrafficLegendDiv=function(t){var r,i,o,a,l=document.createElement("div"),h=(l.classList.add("traffic-legend","hidden"),l.setAttribute("alt","Traffic Legend"),document.createElement("table")),p=document.createElement("tr"),g=document.createElement("td"),_=(g.setAttribute("alt","Traffic"),g.appendChild(document.createTextNode("Traffic")),ko("Traffic")),x=(g.classList.add("traffic-legend-title"),g.colSpan=6,p.appendChild(g),p.appendChild(_),Ti(_,g),h.appendChild(p),document.createElement("tr"));try{for(var C=H5(this.table),M=C.next();!M.done;M=C.next()){var L=M.value,F=document.createElement("td");if(L==="Fast"||L==="Slow")F.setAttribute("alt",L),F.appendChild(document.createTextNode(L)),F.classList.add("traffic-legend-text");else{F.classList.add("traffic-legend-colors"),F.setAttribute("aria-label","Traffic Legend"),F.setAttribute("role","img");try{o=void 0;for(var z=H5(L),ee=z.next();!ee.done;ee=z.next()){var ce=ee.value,se=document.createElement("div");se.classList.add(ce),F.appendChild(se)}}catch(J){o={error:J}}finally{try{ee&&!ee.done&&(a=z.return)&&a.call(z)}finally{if(o)throw o.error}}}x.appendChild(F);var _e=ko(L instanceof Array?"Traffic Legend":L);x.appendChild(_e),Ti(_e,F)}}catch(J){r={error:J}}finally{try{M&&!M.done&&(i=C.return)&&i.call(C)}finally{if(r)throw r.error}}return h.appendChild(x),l.appendChild(h),this.syncHiddenState=function(J){J.dataType==="style"&&((J=t.getTraffic()).flow&&J.flow!=="none"?l.classList.remove("hidden"):l.classList.add("hidden"))},this.syncHiddenState({dataType:"style"}),t.events.add("styledata",this.syncHiddenState),l},e}(xs),hpe="__lodash_hash_undefined__";function dpe(n){return this.__data__.set(n,hpe),this}function fpe(n){return this.__data__.has(n)}var ppe=qF,gpe=dpe,mpe=fpe;function tw(n){var e=-1,t=n==null?0:n.length;for(this.__data__=new ppe;++e<t;)this.add(n[e])}tw.prototype.add=tw.prototype.push=gpe,tw.prototype.has=mpe;function ype(n,e){for(var t=-1,r=n==null?0:n.length;++t<r;)if(e(n[t],t,n))return!0;return!1}function _pe(n,e){return n.has(e)}var vpe=tw,bpe=ype,wpe=_pe,xpe=1,Epe=2;function Tpe(n,e,t,r,i,o){var a=t&xpe,l=n.length,h=e.length;if(l!=h&&!(a&&l<h))return!1;var h=o.get(n),p=o.get(e);if(h&&p)return h==e&&p==n;var g=-1,_=!0,x=t&Epe?new vpe:void 0;for(o.set(n,e),o.set(e,n);++g<l;){var C,M=n[g],L=e[g];if((C=r?a?r(L,M,g,e,n,o):r(M,L,g,n,e,o):C)!==void 0){if(C)continue;_=!1;break}if(x){if(!bpe(e,function(F,z){if(!wpe(x,z)&&(M===F||i(M,F,t,r,o)))return x.push(z)})){_=!1;break}}else if(M!==L&&!i(M,L,t,r,o)){_=!1;break}}return o.delete(n),o.delete(e),_}var G5=Tpe;function Spe(n){var e=-1,t=Array(n.size);return n.forEach(function(r,i){t[++e]=[i,r]}),t}function Cpe(n){var e=-1,t=Array(n.size);return n.forEach(function(r){t[++e]=r}),t}var q5=y5,Ape=C_,Ipe=G5,Ppe=Spe,Mpe=Cpe,Rpe=1,kpe=2,Ope="[object Boolean]",Lpe="[object Date]",Npe="[object Error]",Dpe="[object Map]",Fpe="[object Number]",Bpe="[object RegExp]",Upe="[object Set]",zpe="[object String]",jpe="[object Symbol]",Vpe="[object ArrayBuffer]",Hpe="[object DataView]",$5=Hd?Hd.prototype:void 0,XA=$5?$5.valueOf:void 0;function Gpe(n,e,t,r,i,o,a){switch(t){case Hpe:if(n.byteLength!=e.byteLength||n.byteOffset!=e.byteOffset)return!1;n=n.buffer,e=e.buffer;case Vpe:return!!(n.byteLength==e.byteLength&&o(new q5(n),new q5(e)));case Ope:case Lpe:case Fpe:return Ape(+n,+e);case Npe:return n.name==e.name&&n.message==e.message;case Bpe:case zpe:return n==e+"";case Dpe:var l=Ppe;case Upe:if(l=l||Mpe,n.size!=e.size&&!(r&Rpe))return!1;var h=a.get(n);return h?h==e:(r|=kpe,a.set(n,e),h=Ipe(l(n),l(e),r,i,o,a),a.delete(n),h);case jpe:if(XA)return XA.call(n)==XA.call(e)}return!1}var qpe=Gpe,W5=u5,$pe=1,Wpe=Object.prototype,Ype=Wpe.hasOwnProperty;function Kpe(n,e,t,r,i,o){var a=t&$pe,l=W5(n),h=l.length;if(h!=W5(e).length&&!a)return!1;for(var p=h;p--;){var g=l[p];if(!(a?g in e:Ype.call(e,g)))return!1}var _=o.get(n),x=o.get(e);if(_&&x)return _==e&&x==n;for(var C=!0,M=(o.set(n,e),o.set(e,n),a);++p<h;){var L,F=n[g=l[p]],z=e[g];if(!((L=r?a?r(z,F,g,e,n,o):r(F,z,g,n,e,o):L)===void 0?F===z||i(F,z,t,r,o):L)){C=!1;break}M=M||g=="constructor"}return C&&!M&&(_=n.constructor)!=(x=e.constructor)&&"constructor"in n&&"constructor"in e&&!(typeof _=="function"&&_ instanceof _&&typeof x=="function"&&x instanceof x)&&(C=!1),o.delete(n),o.delete(e),C}var QA=DA,Zpe=G5,Xpe=qpe,Qpe=Kpe,Y5=Q1,K5=M_,Z5=Y1,Jpe=UA,ege=1,X5="[object Arguments]",Q5="[object Array]",nw="[object Object]",tge=Object.prototype,J5=tge.hasOwnProperty;function nge(n,e,t,r,i,o){var a=K5(n),g=K5(e),l=a?Q5:Y5(n),g=g?Q5:Y5(e),h=(l=l==X5?nw:l)==nw,p=(g=g==X5?nw:g)==nw,g=l==g;if(g&&Z5(n)){if(!Z5(e))return!1;h=!(a=!0)}return g&&!h?(o=o||new QA,a||Jpe(n)?Zpe(n,e,t,r,i,o):Xpe(n,e,l,t,r,i,o)):!(t&ege)&&(a=h&&J5.call(n,"__wrapped__"),l=p&&J5.call(e,"__wrapped__"),a||l)?i(a?n.value():n,l?e.value():e,t,r,o=o||new QA):g&&(o=o||new QA,Qpe(n,e,t,r,i,o))}var rge=nge,e6=Yl;function t6(n,e,t,r,i){return n===e||(n==null||e==null||!e6(n)&&!e6(e)?n!=n&&e!=e:rge(n,e,t,r,t6,i))}var ige=t6;function oge(n,e){return ige(n,e)}var pi,Tr,Qr,Jr,Sr,Ea=ih(oge),_c=function(){function n(e,t,r,i){this.type="Feature",this.type=n.TYPE,this.properties=t||{},this.id=r,this.geometry=e,this.bbox=i}return n.TYPE="Feature",n}(),age=window&&window.__extends||function(){var n=function(e,t){return(n=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(r,i){r.__proto__=i}:function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])}))(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),Go=function(n){function e(t,r){return n.call(this,t,r)||this}return age(e,n),e.fromData=function(t){var r=NaN,i=NaN,o=new Set(["y"]),a=new Set(["x"]);return Object.keys(t).forEach(function(l){var h=l.toLowerCase();isNaN(r)&&o.has(h)&&typeof t[l]=="number"?r=t[l]:isNaN(i)&&a.has(h)&&typeof t[l]=="number"&&(i=t[l])}),isNaN(r)||isNaN(i)?null:new e(r,i)},e.getX=function(t){return 0<t.length?t[0]:NaN},e.getY=function(t){return 1<t.length?t[1]:NaN},e.getDestination=function(t,r,i){return new e(e.getX(t)+i*Math.cos((r+270)*Math.PI/180),e.getY(t)+i*Math.sin((r+270)*Math.PI/180))},e.getDistance=function(o,r){var i=e.getX(o)-e.getX(r),o=e.getY(o)-e.getY(r);return Math.sqrt(i*i+o*o)},e.getHeading=function(o,r){var i=e.getX(r)-e.getX(o),o=e.getY(o)-e.getY(r);return 180*(2.5*Math.PI-Math.atan2(o,i))/Math.PI%360},e}(Array),vc=function(){function n(e){this.type="Point",this.type=n.TYPE,this.coordinates=e}return n.TYPE="Point",n}(),k_=window&&window.__read||function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var r,i,o=t.call(n),a=[];try{for(;(e===void 0||0<e--)&&!(r=o.next()).done;)a.push(r.value)}catch(l){i={error:l}}finally{try{r&&!r.done&&(t=o.return)&&t.call(o)}finally{if(i)throw i.error}}return a},sge=window&&window.__values||function(n){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&n[e],r=0;if(t)return t.call(n);if(n&&typeof n.length=="number")return{next:function(){return{value:(n=n&&r>=n.length?void 0:n)&&n[r++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},rw=6378137,cge=Math.PI/180,n6=180/Math.PI,r6=[1,10,100,1e3,1e4,1e5,1e6,1e7,1e8,1e9],O_=85.0511;function qo(n){return n*cge}function L_(n){return n*n6}function JA(n,e,t){return Math.min(Math.max(n,e),t)}function i6(i,e){var r=qo(e[1]-i[1]),t=qo(e[0]-i[0]),r=Math.pow(Math.sin(r/2),2)+Math.cos(qo(i[1]))*Math.cos(qo(e[1]))*Math.pow(Math.sin(t/2),2),i=2*Math.atan2(Math.sqrt(r),Math.sqrt(1-r));return Math.round(rw*i*100)/100}function e2(n){if(n)switch(n.toLowerCase()){case"feet":case"foot":case"ft":return Tr.feet;case"kilometers":case"kilometer":case"kilometres":case"kilometre":case"km":case"kms":return Tr.kilometers;case"miles":case"mile":case"mi":return Tr.miles;case"nauticalmiles":case"nauticalmile":case"nms":case"nm":return Tr.nauticalMiles;case"yards":case"yard":case"yds":case"yrd":case"yrds":return Tr.yards;default:return Tr.meters}return Tr.meters}function o6(n){if(n)switch(n.toLowerCase()){case"milespersecondsquared":case"milepersecondsquared":case"mi/s^2":case"mi/s2":return Sr.milesPerSecondSquared;case"kilometerspersecondsquared":case"kilometrespersecondsquared":case"kilometerpersecondsquared":case"kilometrepersecondsquared":case"km/s^2":case"km/s2":return Sr.kilometersPerSecondSquared;case"knotspersecond":case"knotpersecond":case"knts/s":case"kn/s":case"kt/s":return Sr.knotsPerSecond;case"standardgravity":case"g":return Sr.standardGravity;case"feetpersecondsquared":case"footpersecondsquared":case"ft/s^2":case"ft/s2":return Sr.feetPerSecondSquared;case"yardspersecondsquared":case"yardpersecondsquared":case"yds/s^2":case"yds/s2":case"yd/s^2":case"yd/s2":return Sr.yardsPerSecondSquared;case"milesperhoursecond":case"mileperhoursecond":case"milesperhourseconds":case"mileperhourseconds":case"mi/h/s":return Sr.milesPerHourSecond;case"kilometersperhoursecond":case"kilometrespersoursecond":case"kilometerperhoursecond":case"kilometrepersoursecond":case"kilometersperhourssecond":case"kilometrespersourssecond":case"kilometerperhourssecond":case"kilometrepersourssecond":case"kmhs":case"km/h/s":return Sr.kilometersPerHourSecond;default:return Sr.metersPerSecondSquared}return Sr.metersPerSecondSquared}function a6(n){if(n)switch(n){case"acres":case"ac":return pi.acres;case"hectares":case"ha":return pi.hectares;case"squareFeet":case"ft^2":case"ft2":return pi.squareFeet;case"squareYards":case"squareYard":case"yds^2":case"yds2":case"yd^2":case"yd2":return pi.squareYards;case"squareKilometers":case"squareKilometres":case"squareKilometer":case"squareKilometre":case"km^2":case"km2":return pi.squareKilometers;case"squareMiles":case"squareMile":case"mi^2":case"mi2":return pi.squareMiles;default:return pi.squareMeters}return pi.squareMeters}function s6(n){if(n)switch(n.toLowerCase()){case"feetpersecond":case"footsecond":case"ftps":case"ft/s":return Jr.feetPerSecond;case"milesperhour":case"mileperhour":case"mph":case"mi/hr":case"mi/h":return Jr.milesPerHour;case"knots":case"knot":case"knts":case"knt":case"kn":case"kt":return Jr.knots;case"mach":case"m":return Jr.mach;case"kilometersperhour":case"kilometresperhour":case"kmperhour":case"kmph":case"km/hr":case"km/h":return Jr.kilometersPerHour;default:return Jr.metersPerSecond}return Jr.metersPerSecond}function c6(n){if(n)switch(n.toLowerCase()){case"milliseconds":case"ms":return Qr.ms;case"minutes":case"minute":case"mins":case"min":return Qr.minutes;case"hours":case"hour":case"hr":case"h":return Qr.hours;case"days":case"day":case"d":return Qr.days;default:return Qr.seconds}return Qr.seconds}function l6(n){var e=0;if(n&&0<n.length)for(var e=Math.abs(u6(n[0])),t=1,r=n.length;t<r;t++)e-=Math.abs(u6(n[t]));return e}function u6(n){var e=0;if(3<=n.length){for(var t=void 0,r=void 0,i=0,o=n.length;i<o;i++)e+=(qo(n[i===o-2?(t=o-2,r=o-1,0):i===o-1?(t=o-1,r=0,1):(r=(t=i)+1,i+2)][0])-qo(n[t][0]))*Math.sin(qo(n[r][1]));e=e*rw*rw/2}return e}function h6(n,e,t){return(n[0]-t[0])*(e[1]-t[1])-(n[1]-t[1])*(e[0]-t[0])}function lge(n,e,t){if(2<=t.length){for(var r,i,o,a=1/0,l=null,h=N_(t,22),p=0,g=h.length-1;p<g;p++)i=uge(e,h[p],h[p+1]),(r=Go.getDistance(e,i))<a&&(a=r,l=i);if(l)return o=o2([l],22)[0],new _c(new vc(o),{distance:Ga(n,o)})}else if(t.length===1)return new _c(new vc(t[0]),{distance:Ga(n,t[0])});return null}function uge(n,e,t){var r,i;return e[0]===t[0]&&e[1]===t[1]||(i=n[0]-e[0],n=n[1]-e[1],(n=((r=t[0]-e[0])*i+(i=t[1]-e[1])*n)/(r*r+i*i))<0)?e:1<n?t:[e[0]+r*n,e[1]+i*n]}function Ha(n,e){var t;return!isNaN(n)&&typeof e=="number"&&0<=e&&(t=void 0,t=e<r6.length?r6[e]:Math.pow(10,e),n=Math.round(n*t)/t),n}function hge(i){var e=Gi(rr.getWest(i)),t=Gi(rr.getEast(i)),r=lo(rr.getNorth(i)),o=lo(rr.getSouth(i)),i=rr.getCenter(i),o=[[e,r],[e,o],[i[0],o],[t,o],[t,r],[i[0],r],[e,r]];return new aw([o])}function Kl(n,e,t,r){switch(e2(e)){case Tr.meters:n/=1e3;break;case Tr.feet:n/=3280.8399;break;case Tr.miles:n/=.62137119;break;case Tr.yards:n/=1093.6133;break;case Tr.nauticalMiles:n/=.5399568;break;case Tr.kilometers:}switch(e2(t)){case Tr.meters:n*=1e3;break;case Tr.feet:n*=3280.8399;break;case Tr.miles:n*=.62137119;break;case Tr.yards:n*=1093.6133;break;case Tr.nauticalMiles:n*=.5399568;break;case Tr.kilometers:}return typeof r=="number"&&0<=r&&(e=Math.pow(10,r),n=Math.round(n*e)/e),n}function dge(n,e,t,r){if(!n||n.length<=2)return h;typeof e!="number"&&(e=.5),(typeof t!="number"||t<=0)&&(t=15);var i,o,a,l=n.length,h=n.slice(0),p=(r?($o.areEqual(h[0],h[l-1])&&(h.pop(),l--),h.unshift(n[l-1]),h.push(n[0]),h.push(n[1]),l++):(h.unshift(n[0]),h.push(n[l-1])),[]);p.push([1,0,0,0]);for(var g=1;g<t-1;g++)p.push([2*(a=(i=g/t)*(o=i*i))-3*o+1,-2*a+3*o,a-2*o+i,a-o]);p.push([0,1,0,0]);for(var _,x,C,M,L,F,z=[],g=1;g<l;g++)for(_=e*(h[g+1][0]-h[g-1][0]),x=e*(h[g+1][1]-h[g-1][1]),C=e*(h[g+2][0]-h[g][0]),M=e*(h[g+2][1]-h[g][1]),i=0;i<t;i++)F=(L=p[i])[0]*h[g][0]+L[1]*h[g+1][0]+L[2]*_+L[3]*C,L=JA(L[0]*h[g][1]+L[1]*h[g+1][1]+L[2]*x+L[3]*M,-85,85),z.push([F,L]);return z}function yg(l,h,o,a){a=a||"meters",l=Ta(l);var a=t2(a),i=qo(l[1]),l=qo(l[0]),h=qo(h),o=o/a,a=Math.asin(Math.sin(i)*Math.cos(o)+Math.cos(i)*Math.sin(o)*Math.cos(h)),l=l+Math.atan2(Math.sin(h)*Math.sin(o)*Math.cos(i),Math.cos(o)-Math.sin(i)*Math.sin(a)),h=JA(lo(L_(a)),-85,85);return[Gi(L_(l)),h]}function Ga(n,e,t){return n=i6(n=Ta(n),e=Ta(e)),t==="meters"?n:Kl(n,"meters",t||"meters")}function t2(n){return n=e2(n),Kl(rw,Tr.meters,n)}function d6(n,e,t){for(var r=[],i=qo(n[1]),o=qo(n[0]),a=qo(e[1]),l=qo(e[0]),h=2*Math.asin(Math.sqrt(Math.pow(Math.sin((i-a)/2),2)+Math.cos(i)*Math.cos(a)*Math.pow(Math.sin((o-l)/2),2))),p=0;p<=t;p++){var x=p/t,C=Math.sin((1-x)*h)/Math.sin(h),x=Math.sin(x*h)/Math.sin(h),g=C*Math.cos(i)*Math.cos(o)+x*Math.cos(a)*Math.cos(l),_=C*Math.cos(i)*Math.sin(o)+x*Math.cos(a)*Math.sin(l),C=C*Math.sin(i)+x*Math.sin(a),x=Math.atan2(C,Math.sqrt(Math.pow(g,2)+Math.pow(_,2))),C=Math.atan2(_,g),x=JA(L_(x),-85,85),C=L_(C);r.push([C,x])}return r}function n2(n){return(Array.isArray(n)?n:n.coordinates).reduce(function(e,t){var r=0<e.length?e[e.length-1]:null;return r&&180<Math.abs(t[0]-r[0])?(r=r[0]<0?t[0]-360:t[0]+360,e.push([r,t[1]])):e.push(t),e},[])}function f6(n){for(var e,t,r,i,o,a=Array.isArray(n)?n:n.coordinates,l=[],h=[],p=0;p<a.length;p++)l.push(a[p]),p+1>=a.length||(e=(t=k_(a[p],2))[0],t=t[1],i=(o=k_(a[p+1],2))[0],o=o[1],180<Math.abs(i-e)&&(r=0<e?180:-180,i=Math.abs((0<e?i+360:i-360)-e),o=t+(o-t)*(Math.abs(r-e)/i),l.push([r,o]),h.push(l),l=[[-r,o]]));return h.push(l),h}function fge(n,e){(!e||e<=0)&&(e=15),Array.isArray(n)?t=n:n.type&&n.type==="LineString"&&(t=n.coordinates);for(var t,r=t.length-1,i=[],o=0;o<r;o++)i=i.concat(d6(t[o],t[o+1],e));return n2(i)}function pge(n,e){(!e||e<=0)&&(e=15),Array.isArray(n)?t=n:n.type&&n.type==="LineString"&&(t=n.coordinates);for(var t,r=t.length-1,i=[],o=[],a=0;a<r;a++)for(var l,h,p,g,_,x=d6(t[a],t[a+1],e),C=0;C<x.length;C++)i.push(x[C]),C+1>=x.length||(l=(h=k_(x[C],2))[0],h=h[1],g=(_=k_(x[C+1],2))[0],_=_[1],180<Math.abs(g-l)&&(p=0<l?180:-180,g=Math.abs((0<l?g+360:g-360)-l),_=h+(_-h)*(Math.abs(p-l)/g),i.push([p,_]),o.push(i),i=[[-p,_]]));return o.push(i),o}function ch(n,e){var t,r;return n=Ta(n),e=Ta(e),n&&2<=n.length&&e&&2<=e.length?(r=qo(n[1]),t=qo(e[1]),e=qo(e[0]-n[0]),n=Math.sin(e)*Math.cos(t),r=Math.cos(r)*Math.sin(t)-Math.sin(r)*Math.cos(t)*Math.cos(e),(L_(Math.atan2(n,r))+360)%360):NaN}function r2(n,e){var t,r=0;Array.isArray(n)?t=n:n.type&&n.type==="LineString"&&(t=n.coordinates);for(var i=0,o=t.length-1;i<o;i++)r+=i6(t[i],t[i+1]);return Kl(r,"meters",e||"meters")}function p6(n,e,t){t=t||"meters";var r,i=0;if(Array.isArray(n)?r=n:n.type&&n.type==="LineString"&&(r=n.coordinates),2<=r.length){for(var o,a,l=r.length,h=1;h<l;h++){if(e<=i+(a=Ga(r[h-1],r[h],t)))return o=ch(r[h-1],r[h]),yg(r[h-1],o,e-i,t);i+=a}return i<=e?r[l-1]:r[0]}return null}function g6(n,e,t,r,i){r=r||"meters",i=i||0,n=Ta(n);for(var o=[],a=360/t,l=0;l<=t;l++)o.push(yg(n,(l*a+i)%360,e,r));return o}function m6(n,e,t,r,i){return n2(g6(n,e,t,r,i))}function gge(n,e,t,r,i){return f6(g6(n,e,t,r,i))}function i2(n,e,t){t=t===void 0?.5:t;var r=Ga(n=Ta(n),e=Ta(e),"kilometers");return yg(n,ch(n,e),r*t,"kilometers")}function lo(n){return 90<n?180<(n=(n+90)%360)?90-(n-180):n-90:n<-90?(n=(n-90)%360)<-180?-90-(n+180):n+90:n}function Gi(n){return 180<n?(n+180)%360-180:n<-180?(n-180)%360+180:n}function y6(n,e,t){if(t===0)return Object.assign({},n);e=Ta(e);for(var r,i,o=[],a=0,l=n.length;a<l;a++)r=Ga(e,n[a]),i=ch(e,n[a]),o.push(yg(e,i+t,r));return o}function mge(t,i){t=Ta(t),i=Ta(i);var t=k_(N_([t,i],21),2),i=t[0],t=t[1],r=t[0]-i[0],i=i[1]-t[1];return(2.5*Math.PI-Math.atan2(i,r))*n6%360}function o2(n,e){for(var t,r,i=512*Math.pow(2,e),o=[],a=0,l=n.length;a<l;a++)t=n[a][0]/i-.5,r=.5-n[a][1]/i,o.push([360*t,90-360*Math.atan(Math.exp(2*-r*Math.PI))/Math.PI]);return o}function N_(n,e){for(var t,r,i=512*Math.pow(2,e),o=[],a=0,l=n.length;a<l;a++)r=Math.sin(n[a][1]*Math.PI/180),t=(n[a][0]+180)/360,r=.5-Math.log((1+r)/(1-r))/(4*Math.PI),o.push([Math.round(t*i),Math.round(r*i)]);return o}function iw(n,e,t,r){switch(o6(e)){case Sr.kilometersPerHourSecond:n/=3.6;break;case Sr.milesPerHourSecond:n/=2.236936292054;break;case Sr.knotsPerSecond:n/=1.943844492441;break;case Sr.standardGravity:n/=.1019716212978;break;case Sr.kilometersPerSecondSquared:n/=.001;break;case Sr.milesPerSecondSquared:n/=.000621371192;break;case Sr.feetPerSecondSquared:n/=3.280839895012;break;case Sr.yardsPerSecondSquared:n/=1.093613298338;break;case Sr.metersPerSecondSquared:}switch(o6(t)){case Sr.kilometersPerHourSecond:n*=3.6;break;case Sr.milesPerHourSecond:n*=2.236936292054;break;case Sr.knotsPerSecond:n*=1.943844492441;break;case Sr.standardGravity:n*=.1019716212978;break;case Sr.kilometersPerSecondSquared:n*=.001;break;case Sr.milesPerSecondSquared:n*=.000621371192;break;case Sr.feetPerSecondSquared:n*=3.280839895012;break;case Sr.yardsPerSecondSquared:n*=1.093613298338;break;case Sr.metersPerSecondSquared:}return Ha(n,r)}function _6(n,e,t,r){switch(a6(e)){case pi.acres:n*=4046.8564224;break;case pi.hectares:n*=1e4;break;case pi.squareFeet:n*=.09290304;break;case pi.squareKilometers:n*=1e6;break;case pi.squareMiles:n*=259e4;break;case pi.squareYards:n*=.83612736;break;case pi.squareMeters:}switch(a6(t)){case pi.acres:n/=4046.8564224;break;case pi.hectares:n/=1e4;break;case pi.squareFeet:n/=.09290304;break;case pi.squareKilometers:n/=1e6;break;case pi.squareMiles:n/=259e4;break;case pi.squareYards:n/=.83612736;break;case pi.squareMeters:}return Ha(n,r)}function $d(n,e,t,r){switch(s6(e)){case Jr.feetPerSecond:n*=1.09728;break;case Jr.milesPerHour:n*=1.6093;break;case Jr.knots:n*=1.852;break;case Jr.metersPerSecond:n*=3.6;break;case Jr.mach:n*=1234.8;break;case Jr.kilometersPerHour:}switch(s6(t)){case Jr.feetPerSecond:n/=1.09728;break;case Jr.milesPerHour:n/=1.6093;break;case Jr.knots:n/=1.852;break;case Jr.metersPerSecond:n/=3.6;break;case Jr.mach:n/=1234.8;break;case Jr.kilometersPerHour:}return Ha(n,r)}function _g(n,e,t,r){switch(c6(e)){case Qr.ms:n/=1e3;break;case Qr.hours:n*=3600;break;case Qr.minutes:n*=60;break;case Qr.days:n*=86400;break;case Qr.seconds:}switch(c6(t)){case Qr.ms:n*=1e3;break;case Qr.hours:n/=3600;break;case Qr.minutes:n/=60;break;case Qr.days:n/=86400;break;case Qr.seconds:}return Ha(n,r)}function v6(n,e,t,r,i,o,a,l){return e=Kl(e,i,Tr.meters),i=_g(t,o,Qr.seconds),iw(2*(e-$d(n,r,Jr.metersPerSecond)*i)/(i*i),Sr.metersPerSecondSquared,a,l)}function b6(n,e,t,r,i,o,a){return n=$d(n,r,Jr.metersPerSecond),iw(($d(e,r,Jr.metersPerSecond)-n)/_g(t,i,Qr.seconds),Sr.metersPerSecondSquared,o,a)}function yge(n,e,t,r,i,o,a){if(typeof t=="string"&&n.type==="Feature"&&n.geometry.type==="Point"&&e.type==="Feature"&&e.geometry.type==="Point"&&(t=a2(n.properties[t],e.properties[t],Qr.seconds),!isNaN(t))){var l=0;if(r&&typeof r=="string"){var h=n.properties[r],r=e.properties[r];if(typeof h=="number"&&(l=h,typeof r=="number"))return b6(h,r,t,i,Qr.seconds,o,a)}return v6(l,Ga(n.geometry.coordinates,e.geometry.coordinates,Tr.meters),t,i,Tr.meters,Qr.seconds,o,a)}return NaN}function w6(n,e,t){if(n){var r=0;switch((n=n instanceof Ci?n.toJson():n).type){case"Feature":var i=n;if(i.geometry)return w6(i.geometry,e,t);break;case"Polygon":i=n,i.coordinates&&(r=l6(i.coordinates));break;case"MultiPolygon":var o=n;if(o.coordinates)for(var a=0,l=o.coordinates.length;a<l;a++)r+=l6(o.coordinates[a])}return _6(r,pi.squareMeters,e,t)}return 0}function _ge(n,e,t,r,i,o){return n=Ta(n),e=Ta(e),n&&e?(t=_g(t,r,Qr.seconds),$d(Ga(n,e,Tr.meters)/t,Jr.metersPerSecond,i,o)):0}function vge(n,e,t,r,i){return typeof t=="string"&&n.type==="Feature"&&n.geometry.type==="Point"&&e.type==="Feature"&&e.geometry.type==="Point"&&(t=a2(n.properties[t],e.properties[t],Qr.seconds),!isNaN(t))?$d(Ga(n.geometry.coordinates,e.geometry.coordinates,Tr.meters)/t,Jr.metersPerSecond,r,i):NaN}function a2(n,e,t,r){return n=s2(n),e=s2(e),n!=null&&e!=null?_g(e.getTime()-n.getTime(),Qr.ms,t,r):NaN}function bge(n,e,t,r,i,o,a,l){return e=_g(e,i,Qr.seconds),i=(t=$d(t,o,Jr.metersPerSecond))*e,typeof r=="number"&&(i+=.5*iw(r,a,Sr.metersPerSecondSquared)*e*e),Kl(i,Tr.meters,n,l)}function s2(n){if(Object.prototype.toString.call(n)==="[object Date]")return n;if(typeof n=="string"){var e=Date.parse(n);if(!isNaN(e))return new Date(e);if(0<=n.indexOf("Date("))return e=(e=0)<(n=n.replace("/Date(","").replace(")/","")).indexOf("+")?parseInt(n.substr(0,n.indexOf("+")),10):0<n.indexOf("-")?parseInt(n.substr(0,n.indexOf("-")),10):parseInt(n,10),new Date(e)}else if(typeof n=="number")return new Date(n);return null}function wge(n){var e,t,r=Wd(n).map(function(g){return[Gi(g[0]),lo(g[1])]}),i=(r.sort(function(g,_){return g[0]===_[0]?g[1]-_[1]:g[0]-_[0]}),[]);try{for(var o=sge(r),a=o.next();!a.done;a=o.next()){for(var l=a.value;2<=i.length&&h6(i[i.length-2],i[i.length-1],l)<=0;)i.pop();i.push(l)}}catch(g){e={error:g}}finally{try{a&&!a.done&&(t=o.return)&&t.call(o)}finally{if(e)throw e.error}}for(var h=[],p=r.length-1;0<=p;p--){for(;2<=h.length&&h6(h[h.length-2],h[h.length-1],r[p])<=0;)h.pop();h.push(r[p])}return new aw([i.concat(h)])}function Wd(n){var e=[],t=null,r=null;if(Array.isArray(n)&&0<n.length)if(Array.isArray(n[0])&&typeof n[0][0]=="number")e=n;else for(var i=n.length,o=0;o<i;o++)e=e.concat(Wd(n[o]));else if(n.type)switch(n.type){case"Point":e=[n.coordinates];break;case"LineString":e=n.coordinates;break;case"Polygon":t=n.coordinates;break;case"MultiPoint":e=n.coordinates;break;case"MultiLineString":t=n.coordinates;break;case"MultiPolygon":r=n.coordinates;break;case"Feature":var a=n,e=Ci._isCircle(a)?Ci._getCirclePositions(a):Wd(a.geometry);break;case"FeatureCollection":e=Wd(n.features);break;case"GeometryCollection":e=Wd(n.geometries)}else if(n instanceof Ci)return Wd(n.toJson());if(t)for(i=t.length,o=0;o<i;o++)e=e.concat(t[o]);else if(r)for(var l=r.length,o=0;o<l;o++)for(var h=r[o].length,p=0;p<h;p++)e=e.concat(r[o][p]);return e}function Ta(n){if(Array.isArray(n)&&typeof n[0]=="number")return n;if(n.type){if(n.type==="Point")return n.coordinates;if(n.type==="Feature"&&n.geometry.type==="Point")return n.geometry.coordinates}else if(n instanceof Ci&&n.getType()==="Point")return n.getCoordinates();return null}function xge(n,e){if(e<2)return[];for(var t=[],r=r2(n,Tr.meters)/(e-1),i=0;i<e;i++){var o=p6(n,r*i,Tr.meters);o!=null&&t.push(o)}return t}function x6(n,e,t){t=t||"meters";var r,i=0;if(Array.isArray(n)?r=n:n.type&&n.type==="LineString"&&(r=n.coordinates),2<=r.length){for(var o,a,l,h=r.length,p=1;p<h;p++){if(e<=i+(l=Ga(r[p-1],r[p],t)))return o=ch(r[p-1],r[p]),a=yg(r[p-1],o,e-i,t),new _c(new vc(a),{heading:o});i+=l}return i<=e?new _c(new vc(r[h-1]),{heading:ch(r[h-2],r[h-1])}):new _c(new vc(r[0]),{heading:ch(r[0],r[1])})}return null}function Ege(n,e){if(e<=0)return[];for(var t=[],r=r2(n,Tr.meters)/(e-1),i=0;i<e;i++){var o=x6(n,r*i,Tr.meters);o!=null&&t.push(o)}return t}function ow(n,e,t,r){var i=Ta(n),o=N_([i],22)[0],a=null,l=1/0;switch((e=e instanceof Ci?e.toJson():e).type){case"Feature":return ow(n,e.geometry,t);case"Point":C=[[e.coordinates]];break;case"MultiPoint":for(var h,p=e.coordinates,g=0,_=p.length;g<_;g++)(h=Ga(i,p[g]))<l&&(l=h,a=new _c(new vc(p[g]),{distance:h}));break;case"LineString":C=[e.coordinates];break;case"Polygon":case"MultiLineString":C=e.coordinates;break;case"MultiPolygon":var x=e.coordinates;if(0<x.length)for(var C=x[0],g=1,_=x.length;g<_;g++)C=C.concat(x[g])}if(C)for(var M,g=0,_=C.length;g<_;g++)(M=lge(i,o,C[g]))&&M.properties.distance<l&&(l=M.properties.distance,a=M);return a&&(a.properties.distance=Kl(a.properties.distance,"meters",t,r)),a}(function(n){n.squareMeters="squareMeters",n.acres="acres",n.hectares="hectares",n.squareFeet="squareFeet",n.squareKilometers="squareKilometers",n.squareMiles="squareMiles",n.squareYards="squareYards"})(pi=pi||{}),function(n){n.meters="meters",n.kilometers="kilometers",n.feet="feet",n.miles="miles",n.nauticalMiles="nauticalMiles",n.yards="yards"}(Tr=Tr||{}),function(n){n.seconds="seconds",n.hours="hours",n.ms="ms",n.minutes="minutes",n.days="days"}(Qr=Qr||{}),function(n){n.metersPerSecond="metersPerSecond",n.kilometersPerHour="kilometersPerHour",n.feetPerSecond="feetPerSecond",n.milesPerHour="milesPerHour",n.knots="knots",n.mach="mach"}(Jr=Jr||{}),function(n){n.milesPerSecondSquared="milesPerSecondSquared",n.kilometersPerSecondSquared="kilometersPerSecondSquared",n.knotsPerSecond="knotsPerSecond",n.standardGravity="standardGravity",n.feetPerSecondSquared="feetPerSecondSquared",n.yardsPerSecondSquared="yardsPerSecondSquared",n.milesPerHourSecond="milesPerHourSecond",n.kilometersPerHourSecond="kilometersPerHourSecond",n.metersPerSecondSquared="metersPerSecondSquared"}(Sr=Sr||{});var Tge=window&&window.__extends||function(){var n=function(e,t){return(n=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(r,i){r.__proto__=i}:function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])}))(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),$o=function(n){function e(t,r,i){return i?n.call(this,t,r,i)||this:n.call(this,t,r)||this}return Tge(e,n),e.fromPosition=function(t){return t.length===2?new e(t[0],t[1]):2<t.length?new e(t[0],t[1],t[2]):null},e.areEqual=function(t,r,i){var o,a;return i===void 0&&(i=6),!!(t&&2<=t.length&&r&&2<=r.length)&&(i=Math.pow(10,i),a=lo(t[1]),o=lo(r[1]),t=Gi(t[0]),r=Gi(r[0]),Math.round((a-o)*i)/i==0)&&((a=Math.round((t-r)*i)/i)==0||a==360)},e.fromLatLng=function(t,r,i){var o,a,l,h,p,g,_=[];return typeof t=="number"?(typeof r=="number"&&_.push(r),_.push(t),typeof i=="number"&&_.push(i)):Array.isArray(t)?2<=t.length&&typeof t[0]=="number"&&typeof t[1]=="number"&&(3<=t.length&&typeof t[2]=="number"?_.push(t[1],t[0],t[2]):_.push(t[1],t[0])):typeof t=="object"&&(o=["lat","latitude","y"],a=["lng","longitude","lon","x"],l=["elv","elevation","alt","altitude","z"],g=p=h=NaN,Object.keys(t).forEach(function(x,C,M){var L=x.toLowerCase();isNaN(h)&&0<=o.indexOf(L)&&typeof t[x]=="number"?h=t[x]:isNaN(p)&&0<=a.indexOf(L)&&typeof t[x]=="number"?p=t[x]:isNaN(g)&&0<=l.indexOf(L)&&typeof t[x]=="number"&&(g=t[x])}),isNaN(h)||isNaN(p)||(_.push(p,h),isNaN(g))||_.push(g)),2<=_.length?_:null},e.fromLatLngs=function(t){var r=[];if(Array.isArray(t))for(var i=0,o=t.length;i<o;i++){var a=e.fromLatLng(t[i]);a&&r.push(a)}return r},e._getDimensions=function(t){for(var r=0;Array.isArray(t);)t=t[0],r++;return typeof t=="number"&&r--,r},e}(Array),aw=function(){function n(e,t){this.type="Polygon",this.type=n.TYPE,$o._getDimensions(e)===1?this.coordinates=[e]:this.coordinates=e,this.bbox=t}return n.TYPE="Polygon",n}(),Sge=window&&window.__extends||function(){var n=function(e,t){return(n=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(r,i){r.__proto__=i}:function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])}))(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),E6=window&&window.__values||function(n){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&n[e],r=0;if(t)return t.call(n);if(n&&typeof n.length=="number")return{next:function(){return{value:(n=n&&r>=n.length?void 0:n)&&n[r++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},Ci=function(n){function e(t,r,i){var o,a,l=n.call(this)||this;return t.type==="Feature"?(a=Zi((o=t).geometry),i=o.properties?Zi(o.properties):{},r=o.id==null||o.id===""?Vd():o.id):(a=Zi(t),r=r==null||r===""?Vd():r,i=i?Zi(i):{}),i[e._shapeIdPropName]=r,l.data=new _c(a,i,r),l._handleCircle(),l}return Sge(e,n),e.prototype.addProperty=function(t,r){Ea(this.data.properties[t],r)||(this.data.properties[t]=Zi(r),t!=="subType"&&t!=="radius"||this._handleCircle(),this.dataSource&&this.dataSource._updateSource(),this._invokeEvent("shapechanged",this))},e.prototype.getBounds=function(){var t,r,i,o,a,l=this.getCoordinates(),h=this.getType();if(h==="Point")a=this.circlePolygon?(p=this.circlePolygon.geometry.coordinates,rr.fromPositions(p[0])):new rr(p=l,p);else if(h==="MultiPoint"||h==="LineString"){var p=l;a=rr.fromPositions(p)}else if(h==="Polygon")p=l,a=rr.fromPositions(p[0]);else if(h==="MultiLineString"){p=l;try{for(var g=E6(p),_=g.next();!_.done;_=g.next()){var x=_.value;a=rr.merge(a,rr.fromPositions(x))}}catch(F){t={error:F}}finally{try{_&&!_.done&&(r=g.return)&&r.call(g)}finally{if(t)throw t.error}}}else if(h==="MultiPolygon"){p=l;try{for(var C=E6(p),M=C.next();!M.done;M=C.next()){var L=M.value;a=rr.merge(a,rr.fromPositions(L[0]))}}catch(F){i={error:F}}finally{try{M&&!M.done&&(o=C.return)&&o.call(C)}finally{if(i)throw i.error}}}return a},e.prototype.getCoordinates=function(){return Zi(this.data.geometry.coordinates)},e.prototype.getCircleCoordinates=function(){return this.circlePolygon?Zi(this.circlePolygon.geometry.coordinates[0]):null},e.prototype.getId=function(){return this.data.id},e.prototype.getProperties=function(){return Zi(this.data.properties)},e.prototype.getType=function(){return this.data.geometry.type},e.prototype.isCircle=function(){return e._isCircle(this.data)},e.prototype.isRectangle=function(){return e._isRectangle(this.data)},e.prototype.setCoordinates=function(t){t=this.getType()==="Polygon"&&$o._getDimensions(t)===1?[t]:t,Ea(this.data.geometry.coordinates,t)||(this.data.geometry.coordinates=Zi(t),this._handleCircle(),this.dataSource&&this.dataSource._updateSource(),this._invokeEvent("shapechanged",this))},e.prototype.setProperties=function(t){t[e._shapeIdPropName]=this.data.id,Ea(this.data.properties,t)||(this.data.properties=Zi(t),this._handleCircle(),this.dataSource&&this.dataSource._updateSource(),this._invokeEvent("shapechanged",this))},e.prototype.toJson=function(){return JSON.parse(JSON.stringify(this.data))},e.prototype._toJson=function(){return this.circlePolygon||this.data},e.prototype._setDataSource=function(t){t===void 0||t==null?delete this.dataSource:this.dataSource=t},e.prototype._handleCircle=function(){var t;this.isCircle()?(t=e._getCirclePositions(this.data),this.circlePolygon=new _c(new aw([t]),this.data.properties,this.data.id),this.data.properties.subType="Circle"):delete this.circlePolygon},e._isCircle=function(t){return t&&t.geometry&&t.geometry.type==="Point"&&t.geometry.coordinates&&t.properties&&typeof t.properties.subType=="string"&&t.properties.subType.toLowerCase()==="circle"&&typeof t.properties.radius=="number"},e._isRectangle=function(t){if(t.geometry.type==="Polygon"&&t.geometry.coordinates&&typeof t.properties.subType=="string"&&t.properties.subType.toLowerCase()==="rectangle"&&(t=t.geometry.coordinates,t.length===1)){if(t=t[0],t.length===5)return t[0][0]===t[4][0]&&t[0][1]===t[4][1];if(t.length===4)return!0}return!1},e._getCirclePositions=function(t){return m6(t.geometry.coordinates,t.properties.radius,72,"meters")},e._shapeIdPropName="_azureMapsShapeId",e}(Wl),Cge=window&&window.__extends||function(){var n=function(e,t){return(n=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(r,i){r.__proto__=i}:function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])}))(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),Age=window&&window.__values||function(n){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&n[e],r=0;if(t)return t.call(n);if(n&&typeof n.length=="number")return{next:function(){return{value:(n=n&&r>=n.length?void 0:n)&&n[r++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},rr=function(n){function e(t,r){var i,o=this;return t&&r?o=(i=t)[2]&&r[2]?n.call(this,i[0],i[1],i[2]||0,r[0],r[1],r[2]||0)||this:n.call(this,i[0],i[1],r[0],r[1])||this:t&&(i=t)&&(i.length===4?o=n.call(this,i[0],i[1],i[2],i[3])||this:6<=i.length&&(o=n.call(this,i[0],i[1],i[2],i[3],i[4],i[5])||this)),o}return Cge(e,n),e.fromBoundingBox=function(a){var r=e.getWest(a),i=e.getSouth(a),o=e.getEast(a),a=e.getNorth(a);return new e([r,i,o,a])},e.fromDimensions=function(l,r,h){var o=l[0],l=l[1],a=Math.min(Math.max(l+h/2,-85.5),85.5),l=Math.min(Math.max(l-h/2,-85.5),85.5),h=Gi(o+r/2);return new e([Gi(o-r/2),l,h,a])},e.fromEdges=function(t,r,i,o){return new e([t,r,i,o])},e.containsPosition=function(l,a){var o=e.getCenter(l),i=Math.abs(o[1]-a[1]),o=Math.abs(o[0]-a[0]),a=(180<o&&(o=360-o),e.getHeight(l)),l=e.getWidth(l);return i<=a/2+1e-8&&o<=l/2+1e-8},e.containsBoundingBox=function(t,r){var i=t&&t.length===4,o=r&&r.length===4;return!(!i||!o)&&e.getWest(t)<e.getWest(r)&&e.getWest(r)<e.getEast(t)&&e.getWest(t)<e.getEast(r)&&e.getEast(r)<e.getEast(t)&&e.getSouth(t)<e.getSouth(r)&&e.getSouth(r)<e.getNorth(t)&&e.getSouth(t)<e.getNorth(r)&&e.getNorth(r)<e.getNorth(t)},e.crossesAntimeridian=function(t){return Gi(e.getEast(t))-Gi(e.getWest(t))<0||e.isBoundingBoxWithSixOrMoreElementsLargerThanGlobe(t)||e.isBoundingBoxWithLessThanSixElementsLargerThanGlobe(t)},e.getCenter=function(o){var i=Gi(e.getEast(o)),r=Gi(e.getWest(o)),r=(i<r&&(i+=360),Gi((r+i)/2)),i=lo(e.getSouth(o)),o=lo(e.getNorth(o));return[r,lo((i+o)/2)]},e.getHeight=function(t){return t=lo(e.getNorth(t))-lo(e.getSouth(t)),isNaN(t)?0:t},e.getWidth=function(t){return t=Gi(e.getEast(t))-Gi(e.getWest(t)),isNaN(t)?0:t<0?t+360:t},e.getSouthWest=function(i){var r=this.getSouth(i),i=this.getWest(i);return isNaN(r)||isNaN(i)?null:[i,r]},e.getNorthEast=function(i){var r=this.getNorth(i),i=this.getEast(i);return isNaN(r)||isNaN(i)?null:[i,r]},e.getNorthWest=function(i){var r=this.getNorth(i),i=this.getWest(i);return isNaN(r)||isNaN(i)?null:[i,r]},e.getSouthEast=function(i){var r=this.getSouth(i),i=this.getEast(i);return isNaN(r)||isNaN(i)?null:[i,r]},e.getSouth=function(t){return t&&4<=t.length?Number(t[1]):NaN},e.getWest=function(t){return t&&4<=t.length?Number(t[0]):NaN},e.getNorth=function(t){if(t){if(t.length===4)return Number(t[3]);if(t.length===6)return Number(t[4])}return NaN},e.getEast=function(t){if(t){if(t.length===4)return Number(t[2]);if(t.length===6)return Number(t[3])}return NaN},e.intersect=function(l,p){var o=e.getCenter(l),a=e.getCenter(p),i=Math.abs(o[1]-a[1]),o=Math.abs(o[0]-a[0]),a=(180<o&&(o=360-o),e.getHeight(l)),l=e.getWidth(l),h=e.getHeight(p),p=e.getWidth(p);return i<=a/2+h/2&&o<=l/2+p/2},e.merge=function(t,r){var i=t&&t.length===4,o=r&&r.length===4;if(i&&!o)return t;if(o&&!i)return r;if(!i&&!o)return null;for(var i=Math.max(lo(e.getNorth(t)),lo(e.getNorth(r))),o=Math.min(lo(e.getSouth(t)),lo(e.getSouth(r))),a=[t,r],l=[],h=0,h=0;h<a.length;h++){var p=a[h],g=Gi(e.getWest(p)),_=Gi(e.getEast(p));e.crossesAntimeridian(p)?(l.push([g,180]),l.push([-180,_])):l.push([g,_])}l.sort(function(ce,se){return ce[0]===se[0]?ce[1]-se[1]:ce[0]-se[0]});var x=[],C=l[0];for(h=1;h<l.length;){var M=l[h];C[1]>=M[0]?C[1]=Math.max(C[1],M[1]):(x.push(C),C=M),h++}x.push(C);var L=x.length,F=x[0][0]+360-x[L-1][1],z=[x[L-1][1],x[0][0]];for(h=1;h<L;h++){var ee=x[h][0]-x[h-1][1];F<ee&&(F=ee,z=[x[h-1][1],x[h][0]])}return new e([z[1],o],[z[0],i])},e.fromPositions=function(t){for(var r,i,o=NaN,a=NaN,l=NaN,h=NaN,p=t.length,g=new Array(p),_=0;p--;)(i=t[p])&&2<=i.length&&(r=lo(i[1]),o=isNaN(o)?r:Math.max(o,r),a=isNaN(a)?r:Math.min(a,r),g[_++]=Gi(i[0]));if(_){g.length=_,g.sort(function(L,F){return L-F});for(var x=g[0]+360-g[_-1],C=0,p=1;p<_;p++){var M=g[p]-g[p-1];x<M&&(x=M,C=p)}l=g[C],h=g[(C||_)-1]}return isNaN(l)||isNaN(a)||isNaN(h)||isNaN(o)?null:new e([l,a,h,o])},e.fromLatLngs=function(t){return e.fromPositions($o.fromLatLngs(t))},e.fromData=function(t){var r,i,o=null;if(Array.isArray(t)&&0<t.length){try{for(var a=Age(t),l=a.next();!l.done;l=a.next()){var h,p=l.value;(h=e.fromData(p))!=null&&(o=o===null?h:e.merge(o,h))}}catch(ee){r={error:ee}}finally{try{l&&!l.done&&(i=a.return)&&i.call(a)}finally{if(r)throw r.error}}return o}if(t instanceof Ci)return t.getBounds();if(t&&t.type){var g=t;if(g.bbox&&g.bbox.length===4)return g.bbox;switch(g.type){case"FeatureCollection":return e.fromData(g.features);case"Feature":return Ci._isCircle(g)?e.fromPositions(Ci._getCirclePositions(g)):e.fromData(g.geometry);case"GeometryCollection":return e.fromData(g.geometries);case"Point":var _=g.coordinates;if(_&&2<=_.length)return[_[0],_[1],_[0],_[1]];break;case"LineString":case"MultiPoint":return e.fromPositions(g.coordinates);case"Polygon":case"MultiLineString":var x=g.coordinates;if(x&&0<x.length){for(var C=0,M=x.length;C<M;C++)(h=e.fromPositions(x[C]))!=null&&(o=o===null?h:e.merge(o,h));if(o!=null)return o}break;case"MultiPolygon":var L=g.coordinates;if(L&&0<L.length){for(C=0,M=L.length;C<M;C++)for(var F=0,z=L[C].length;F<z;F++)(h=e.fromPositions(L[C][F]))!=null&&(o=o===null?h:e.merge(o,h));return o}}}return null},e.splitOnAntimeridian=function(t){var r,i,o,a,l,h,p=[];return e.isBoundingBoxWithSixOrMoreElementsLargerThanGlobe(t)?[[-180,t[1],t[2],180,t[4],t[5]]]:e.isBoundingBoxWithLessThanSixElementsLargerThanGlobe(t)?[[-180,t[1],180,t[3]]]:(e.crossesAntimeridian(t)?(h=r=void 0,i=Gi(e.getWest(t)),o=Gi(e.getEast(t)),a=lo(e.getNorth(t)),l=lo(e.getSouth(t)),h=6<=t.length?(r=[i,l,t[2],180,a,t[5]],[-180,l,t[2],o,a,t[5]]):(r=[i,l,180,a],[-180,l,o,a]),p.push(r,h)):p.push(t),p)},e.isBoundingBoxWithSixOrMoreElementsLargerThanGlobe=function(t){return 6<=t.length&&360<t[3]-t[0]},e.isBoundingBoxWithLessThanSixElementsLargerThanGlobe=function(t){return t.length<6&&360<t[2]-t[0]},e}(Array),Yd=function(){function n(e,t){this.type="FeatureCollection",this.type=n.TYPE,this.features=e,this.bbox=t}return n.TYPE="FeatureCollection",n}(),Ige=function(){function n(e){this.type="GeometryCollection",this.type=n.TYPE,this.geometries=e}return n.TYPE="GeometryCollection",n}(),Pge=function(){function n(e,t){this.type="LineString",this.type=n.TYPE,this.coordinates=e,this.bbox=t}return n.TYPE="LineString",n}(),Mge=function(){function n(e,t){this.type="MultiLineString",this.type=n.TYPE,this.coordinates=e,this.bbox=t}return n.TYPE="MultiLineString",n}(),Rge=function(){function n(e,t){this.type="MultiPoint",this.type=n.TYPE,this.coordinates=e,this.bbox=t}return n.TYPE="MultiPoint",n}(),kge=function(){function n(e,t){this.type="MultiPolygon",this.type=n.TYPE,this.coordinates=e,this.bbox=t}return n.TYPE="MultiPolygon",n}(),Oge=window&&window.__extends||function(){var n=function(e,t){return(n=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(r,i){r.__proto__=i}:function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])}))(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),Lge=function(n){function e(t,r,i){return n.call(this,t,r,i||0)||this}return Oge(e,n),e.fromPosition=function(t){return 2<=t.length?new e((180+t[0])/360,e._latToMercatorY(t[1]),3<=t.length?e._altitudeToMercatorZ(t[2],t[1]):0):[0,0,0]},e.fromPositions=function(t){for(var r=[],i=0,o=t.length;i<o;i++)r.push(this.fromPosition(t[i]));return r},e.toFloat32Array=function(t){for(var r=new Float32Array(3*t.length),i=0,o=t.length;i<o;i++){var a=3*i,l=t[i];r[a]=(180+l[0])/360,r[1+a]=e._latToMercatorY(l[1]),r[2+a]=3<=l.length?e._altitudeToMercatorZ(l[2],l[1]):0}return r},e.toPosition=function(t){var r;return 2<=t.length?(r=360/Math.PI*Math.atan(Math.exp((180-360*t[1])*Math.PI/180))-90,new $o(360*t[0]-180,r,3<=t.length?e._mercatorZToAltitude(t[2],t[1]):0)):[0,0,0]},e.toPositions=function(t){for(var r=[],i=0,o=t.length;i<o;i++)r.push(this.toPosition(t[i]));return r},e.mercatorScale=function(t){return 1/Math.cos(t*Math.PI/180)},e.meterInMercatorUnits=function(t){return 1/e.earthCircumference*e.mercatorScale(e._latToMercatorY(t))},e._circumferenceAtLatitude=function(t){return e.earthCircumference*Math.cos(t*Math.PI/180)},e._altitudeToMercatorZ=function(t,r){return t/e._circumferenceAtLatitude(r)},e._mercatorZToAltitude=function(t,r){return t*e._circumferenceAtLatitude(e._latToMercatorY(r))},e._latToMercatorY=function(t){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t*Math.PI/360)))/360},e.earthCircumference=2*Math.PI*t2(),e}(Array),Nge=Object.freeze({__proto__:null,BoundingBox:rr,Feature:_c,FeatureCollection:Yd,GeometryCollection:Ige,LineString:Pge,MercatorPoint:Lge,MultiLineString:Mge,MultiPoint:Rge,MultiPolygon:kge,Point:vc,Polygon:aw,Position:$o});function c2(n,e){return n*n+e*e}function Dge(n,e){return c2(n[0]-e[0],n[1]-e[1])}function Fge(n,o,t){var r,i=o[0],o=o[1],a=t[0]-i,l=t[1]-o;return a==0&&l==0||(1<(r=((n[0]-i)*a+(n[1]-o)*l)/c2(a,l))?(i=t[0],o=t[1]):0<r&&(i+=a*r,o+=l*r)),c2(n[0]-i,n[1]-o)}function Bge(n,e){for(var t,r=n[0],i=[r],o=1,a=n.length;o<a;o++)Dge(t=n[o],r)>e&&(i.push(t),r=t);return r!==t&&i.push(t),i}function l2(n,e,t,r,i){for(var o,a=r,l=e+1;l<t;l++){var h=Fge(n[l],n[e],n[t]);a<h&&(o=l,a=h)}r<a&&(1<o-e&&l2(n,e,o,r,i),i.push(n[o]),1<t-o)&&l2(n,o,t,r,i)}function Uge(n,e){var t=n.length-1,r=[n[0]];return l2(n,0,t,e,r),r.push(n[t]),r}function zge(n,e,t){return e===void 0&&(e=1),t===void 0&&(t=!1),n.length<=2||(e=e*e,n=Uge(n=t?n:Bge(n,e),e)),n}var jge=zge;function Vge(n,e){return jge(n,e,!0)}var Hge=window&&window.__values||function(n){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&n[e],r=0;if(t)return t.call(n);if(n&&typeof n.length=="number")return{next:function(){return{value:(n=n&&r>=n.length?void 0:n)&&n[r++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},sw=function(){function n(e,t){this.M=n._calculateAffineTransform(e,t),this.inverseM=n._calculateAffineTransform(t,e)}return n.prototype.toTarget=function(e,t){return this.transformArray(e,this.M,t)},n.prototype.toSource=function(e,t){return this.transformArray(e,this.inverseM,t)},n.prototype.transformArray=function(e,t,r){var i,o;if(e&&Array.isArray(e)&&Array.isArray(e[0])){var a=[];try{for(var l=Hge(e),h=l.next();!h.done;h=l.next()){var p=h.value;a.push(this.transform(p,t,r))}}catch(g){i={error:g}}finally{try{h&&!h.done&&(o=l.return)&&o.call(l)}finally{if(i)throw i.error}}return a}return null},n.prototype.transform=function(o,t,r){var i=o[0]*t[0][3]+o[1]*t[1][3]+t[2][3],o=o[0]*t[0][4]+o[1]*t[1][4]+t[2][4];return typeof r=="number"&&0<=r?[Ha(i,r),Ha(o,r)]:[Ha(i,6),Ha(o,6)]},n._calculateAffineTransform=function(e,t){if(e.length!==t.length||e.length<1)throw new Error("Error: source and target arrays must have the same length.");var r=Math.min(e[0].length,t[0].length),i=r+1;if(e.length<r)throw new Error("Erorr: At least "+r+" reference points required.");for(var o=[],a=[],l=0;l<i;l++){a[l]=[];for(var h=0;h<i;h++){h<r&&(o[h]=0);for(var p=a[l][h]=0;p<e.length;p++)h<r&&(o[h]+=l<r?e[p][l]*t[p][h]:t[p][h]),a[l][h]+=r<=l&&r<=h?1:r<=l?e[p][h]:r<=h?e[p][l]:e[p][l]*e[p][h]}a[l]=a[l].concat(o)}if(this._gaussJordanElimination(a))return a;throw new Error("Error: Singular matrix. Points are likely coplanar.")},n._gaussJordanElimination=function(e){for(var t,r=e.length,i=2*r-1,o=0;o<r;o++){for(var a=o,l=o+1;l<r;l++)Math.abs(e[l][o])>Math.abs(e[a][o])&&(a=l);if(t=e[a],e[a]=e[o],e[o]=t,Math.abs(e[o][o])<=1e-12)return!1;for(var h=o+1;h<r;h++)for(var p=e[h][o]/e[o][o],g=o;g<i;g++)e[h][g]-=e[o][g]*p}for(o=r-1;-1<o;o--){for(p=e[o][o],l=0;l<o;l++)for(var _=i-1;o-1<_;_--)e[l][_]-=e[o][_]*e[l][o]/p;e[o][o]/=p;for(var x=r;x<i;x++)e[o][x]/=p}return!0},n}(),Gge=Object.freeze({__proto__:null,get AccelerationUnits(){return Sr},AffineTransform:sw,get AreaUnits(){return pi},get DistanceUnits(){return Tr},get SpeedUnits(){return Jr},get TimeUnits(){return Qr},WEBMERCATOR_MAXLAT:O_,_precision:Ha,boundingBoxToPolygon:hge,convertAcceleration:iw,convertArea:_6,convertDistance:Kl,convertSpeed:$d,convertTimespan:_g,getAcceleration:v6,getAccelerationFromFeatures:yge,getAccelerationFromSpeeds:b6,getArea:w6,getCardinalSpline:dge,getClosestPointOnGeometry:ow,getConvexHull:wge,getDestination:yg,getDistanceTo:Ga,getEarthRadius:t2,getGeodesicPath:fge,getGeodesicPaths:pge,getHeading:ch,getLengthOfPath:r2,getPathDenormalizedAtAntimerian:n2,getPathSplitByAntimeridian:f6,getPixelHeading:mge,getPointWithHeadingAlongPath:x6,getPointsWithHeadingsAlongPath:Ege,getPosition:Ta,getPositionAlongPath:p6,getPositions:Wd,getPositionsAlongPath:xge,getRegularPolygonPath:m6,getRegularPolygonPaths:gge,getSpeed:_ge,getSpeedFromFeatures:vge,getTimespan:a2,getTravelDistance:bge,interpolate:i2,mercatorPixelsToPositions:o2,mercatorPositionsToPixels:N_,normalizeLatitude:lo,normalizeLongitude:Gi,parseTimestamp:s2,rotatePositions:y6,simplify:Vge}),qge=window&&window.__extends||function(){var n=function(e,t){return(n=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(r,i){r.__proto__=i}:function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])}))(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),$ge=function(n){function e(){var t=n!==null&&n.apply(this,arguments)||this;return t.zoomDelta=1,t.style=Ro.light,t}return qge(e,n),e}(ii),Wge=window&&window.__extends||function(){var n=function(e,t){return(n=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(r,i){r.__proto__=i}:function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])}))(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),Yge=function(n){function e(t){var r=n.call(this)||this;return r.container=null,r.zoomInButton=null,r.zoomOutButton=null,r.zoomChanged=function(i){return r.updateZoomButtonsState()},r.minZoomChanged=function(i){return r.updateZoomButtonsState()},r.maxZoomChanged=function(i){return r.updateZoomButtonsState()},r.options=new $ge().merge(t),r}return Wge(e,n),e.prototype.onAdd=function(t){this.container=this.buildContainer(t,this.options.style,"Zoom Control"),this.container.style.flexDirection="column",this.zoomInButton=this.constructZoomInButton(t),this.zoomOutButton=this.constructZoomOutButton(t);var r=ko("Zoom In"),i=ko("Zoom Out");return this.container.appendChild(this.zoomInButton),this.container.appendChild(r),this.container.appendChild(this.zoomOutButton),this.container.appendChild(i),Ti(r,this.zoomInButton),Ti(i,this.zoomOutButton),t.events.add("zoom",this.zoomChanged),t.events.add("minzoomchanged",this.minZoomChanged),t.events.add("maxzoomchanged",this.maxZoomChanged),this.map=t,this.container},e.prototype.onRemove=function(){n.prototype.onRemove.call(this),this.map&&(this.map.events.remove("zoom",this.zoomChanged),this.map.events.remove("minzoomchanged",this.minZoomChanged),this.map.events.remove("maxzoomchanged",this.maxZoomChanged),this.map=null),this.container&&(this.container.remove(),this.container=null,this.zoomInButton=null,this.zoomOutButton=null)},e.prototype.updateZoomButtonsState=function(){var t=this.map.getCamera().zoom>=this.map._getMap().getMaxZoom(),r=rr.getSouth(this.map.getCamera().bounds)<=-O_&&rr.getNorth(this.map.getCamera().bounds)>=O_,r=this.map.getCamera().zoom<=this.map._getMap().getMinZoom()||r;this.zoomInButton&&this.zoomInButton.disabled!=t&&(this.zoomInButton.disabled=t,this.zoomInButton.setAttribute("aria-label",t?"Zoom In disabled":"Zoom In")),this.zoomOutButton&&this.zoomOutButton.disabled!=r&&(this.zoomOutButton.disabled=r,this.zoomOutButton.setAttribute("aria-label",t?"Zoom Out disabled":"Zoom Out"))},e.prototype.constructZoomInButton=function(t){var r=this,i=document.createElement("button");return i.classList.add("azure-maps-control-button"),i.classList.add("zoom-in"),i.setAttribute("aria-label","Zoom In"),i.setAttribute("alt","Zoom In"),i.setAttribute("type","button"),i.addEventListener("click",function(){t.setCamera({zoom:t.getCamera().zoom+r.options.zoomDelta,duration:e.ZOOM_DURATION_MS,type:"ease"},!0)}),i},e.prototype.constructZoomOutButton=function(t){var r=this,i=document.createElement("button");return i.classList.add("azure-maps-control-button"),i.classList.add("zoom-out"),i.setAttribute("aria-label","Zoom Out"),i.setAttribute("alt","Zoom Out"),i.setAttribute("type","button"),i.addEventListener("click",function(){t.setCamera({zoom:t.getCamera().zoom-r.options.zoomDelta,duration:e.ZOOM_DURATION_MS,type:"ease"},!0)}),i},e.ZOOM_DURATION_MS=200,e}(xs),Kge=window&&window.__extends||function(){var n=function(e,t){return(n=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(r,i){r.__proto__=i}:function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])}))(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),Zge=function(n){function e(){var t=n!==null&&n.apply(this,arguments)||this;return t.style=Ro.light,t.hideIfUnsupported=!1,t.container=void 0,t}return Kge(e,n),e}(ii),Xge=window&&window.__extends||function(){var n=function(e,t){return(n=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(r,i){r.__proto__=i}:function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])}))(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),Qge=function(n){function e(t){var r=n.call(this)||this;return r.map=null,r.isFullscreenState=!1,r.options=new Zge().merge(t),r.control=new wa.FullscreenControl({container:r.options.container}),r}return Xge(e,n),e.prototype.onAdd=function(t){var r,i,o=this,a=(this.map=t,(a=(a=this.map)==null?void 0:a._getMap())!=null&&a.addControl(this.control),this.buildContainer(t,this.options.style,"Fullscreen Control")),l=this.control._fullscreenButton;return l&&(r=l.querySelector("span"))&&(i=ko("Enter Fullscreen"),a.appendChild(l),l.classList.add("azure-maps-control-button","fullscreen"),r.classList.add("fullscreen-icon","fullscreen-end"),l.removeAttribute("title"),a.appendChild(i),Ti(i,l),this.control.on("fullscreenstart",function(){l.removeAttribute("title"),r.classList.remove("fullscreen-end"),r.classList.add("fullscreen-start"),i.innerText="Exit Fullscreen",o.isFullscreenState=!0}),this.control.on("fullscreenend",function(){l.removeAttribute("title"),r.classList.remove("fullscreen-start"),r.classList.add("fullscreen-end"),i.innerText="Enter Fullscreen",o.isFullscreenState=!1})),this.options.hideIfUnsupported&&!e.isSupported()&&(a.style.display="none"),a},e.prototype.onRemove=function(){var t;n.prototype.onRemove.call(this),(t=(t=this.map)==null?void 0:t._getMap())!=null&&t.removeControl(this.control),this.map=null},e.prototype.isFullscreen=function(){return this.isFullscreenState},e.isSupported=function(){var t=document;return t.fullscreenEnabled||t.msFullscreenEnabled||t.mozFullScreenEnabled||t.webkitFullscreenEnabled},e}(xs),Jge=Object.freeze({__proto__:null,CompassControl:DF,ControlBase:xs,FullscreenControl:Qge,PitchControl:doe,ScaleControl:poe,StyleControl:ipe,TrafficControl:V5,TrafficLegendControl:upe,ZoomControl:Yge}),eme=P5,tme=1,nme=4;function rme(n,e){return eme(n,tme|nme,e=typeof e=="function"?e:void 0)}var Cr=ih(rme),ime=function(){function n(e){var t=this;this.attach=function(r){t.map!==r&&(t.map&&t.detachFromCurrentMap(),t.map=r,t.map.indicators._getCollectionDiv().appendChild(t.element),t.map.indicators.add(t))},this.remove=function(){t.detachFromCurrentMap(),t.element.remove()},this.getElement=function(){return t.element},this.detachFromCurrentMap=function(){t.map&&(t.map.indicators.remove(t),delete t.map)},this.element=document.createElement("div"),this.element.setAttribute("tabindex","0"),this.element.setAttribute("role","option"),e!=null&&e.setSize&&this.element.setAttribute("aria-setsize",e.setSize.toString()),e!=null&&e.positionInSet&&this.element.setAttribute("aria-posinset",e.positionInSet.toString()),this.element.setAttribute("aria-label","data point"),this.element.classList.add(n.Css.hidden)}return n.Css={hidden:"hidden-accessible-element"},n}(),ome=window&&window.__extends||function(){var n=function(e,t){return(n=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(r,i){r.__proto__=i}:function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])}))(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),T6=function(n){function e(){var t=n!==null&&n.apply(this,arguments)||this;return t.buffer=128,t.maxZoom=18,t.cluster=!1,t.clusterRadius=50,t.clusterMaxZoom=void 0,t.clusterProperties=void 0,t.lineMetrics=!1,t.tolerance=.375,t.clusterMinPoints=2,t.generateId=!1,t.promoteId=void 0,t.filter=void 0,t}return ome(e,n),e}(ii),ame=window&&window.__extends||function(){var n=function(e,t){return(n=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(r,i){r.__proto__=i}:function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])}))(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),gi=function(n){function e(t){var r=n.call(this)||this;return r.id=t||Vd(),r}return ame(e,n),e.prototype.getId=function(){return this.id},e.prototype._setMap=function(t,r){var i;r===void 0&&(r=!0),t==null||t===void 0?(i=this.map,delete this.map,r&&(this._invokeEvent("sourceremoved",this),i)&&i.events.invoke("sourceremoved",this)):(this.map=t,r&&(this._invokeEvent("sourceadded",this),this.map.events.invoke("sourceadded",this)))},e}(Wl),sme=window&&window.__extends||function(){var n=function(e,t){return(n=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(r,i){r.__proto__=i}:function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])}))(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),cw=window&&window.__values||function(n){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&n[e],r=0;if(t)return t.call(n);if(n&&typeof n.length=="number")return{next:function(){return{value:(n=n&&r>=n.length?void 0:n)&&n[r++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},Es=function(n){function e(t,r){return t=n.call(this,t)||this,t.requestId=void 0,t.options=new T6().merge(Zi(r)),t.shapes=[],t.shapesMap=new ws,t}return sme(e,n),e.prototype.add=function(t,r){this._addNoUpdate(t,r),this._updateSource()},e.prototype.clear=function(){this._clearNoUpdate(),this._updateSource()},e.prototype.dispose=function(){this.options=null,this.shapes=null,this.shapesMap=null,this.map=null},e.prototype.getClusterExpansionZoom=function(t){var r=this;return new Promise(function(i,o){var a;r.map?(a=r.map._getMap().getSource(r.getId()))&&a.type==="geojson"&&a.getClusterExpansionZoom(t).then(function(l){typeof l=="number"&&i(l)}).catch(function(l){l&&o(l)}):o("The DataSource hasn't been added to a map.")})},e.prototype.getClusterChildren=function(t){var r=this;return new Promise(function(i,o){var a;r.map?(a=r.map._getMap().getSource(r.getId()))&&a.type==="geojson"&&a.getClusterChildren(t).then(function(l){l&&i(r.map.sources._mapFeaturesToShapes(l,!1,r))}).catch(function(l){l&&o(l)}):o("The DataSource hasn't been added to a map.")})},e.prototype.getClusterLeaves=function(t,r,i){var o=this;return new Promise(function(a,l){var h;o.map?(h=o.map._getMap().getSource(o.getId()))&&h.type==="geojson"&&h.getClusterLeaves(t,r,i).then(function(p){p&&a(o.map.sources._mapFeaturesToShapes(p,!1,o))}).catch(function(p){p&&l(p)}):l("The DataSource hasn't been added to a map.")})},e.prototype.getOptions=function(){return Zi(this.options)},e.prototype.getShapes=function(){return Array.from(this.shapes)},e.prototype.importDataFromUrl=function(t){var r=this;return fetch(t,{method:"GET",mode:"cors"}).then(function(i){if(i.ok)return i.json();throw new Error("HTTP ".concat(i.status,": ").concat(i.statusText))}).then(function(i){r.add(i)})},e.prototype.getShapeById=function(t){return this.shapes[this.shapesMap.get(t)]||null},e.prototype.remove=function(o){var r,i,o=Array.isArray(o)?o:[o];try{for(var a=cw(o),l=a.next();!l.done;l=a.next()){var h=l.value;typeof h=="number"?this._removeByIndex(h):this._removeById(h)}}catch(p){r={error:p}}finally{try{l&&!l.done&&(i=a.return)&&i.call(a)}finally{if(r)throw r.error}}this._updateSource()},e.prototype.removeById=function(o){var r,i,o=Array.isArray(o)?o:[o];try{for(var a=cw(o),l=a.next();!l.done;l=a.next()){var h=l.value;this._removeById(h)}}catch(p){r={error:p}}finally{try{l&&!l.done&&(i=a.return)&&i.call(a)}finally{if(r)throw r.error}}this._updateSource()},e.prototype.setOptions=function(t){t=new T6().merge(this.options,Zi(t)),Ea(this.options,t)||(this._invokeEvent("datasourceupdated",this),this.options=t,this.map&&this.map._rebuildStyle())},e.prototype.setShapes=function(t){this._clearNoUpdate(),this.add(t)},e.prototype.toJson=function(){return new Yd(this.shapes.map(function(t){return t.toJson()}))},e.prototype._toJson=function(){return new Yd(this.shapes.map(function(t){return t._toJson()}))},e.prototype._buildSource=function(){var t={type:"geojson",data:this._toJson(),maxzoom:this.options.maxZoom,cluster:this.options.cluster,clusterRadius:this.options.clusterRadius,tolerance:this.options.tolerance,lineMetrics:this.options.lineMetrics,clusterProperties:this.options.clusterProperties,buffer:this.options.buffer,clusterMinPoints:this.options.clusterMinPoints,generateId:this.options.generateId,promoteId:this.options.promoteId,filter:this.options.filter};return typeof this.options.clusterMaxZoom=="number"&&(t.clusterMaxZoom=this.options.clusterMaxZoom),t},e.prototype._isDeepEqual=function(t){var r;return this.constructor===t.constructor&&(r=this._buildSource(),t=t._buildSource(),r.type===t.type)&&r.maxzoom===t.maxzoom&&r.cluster===t.cluster&&r.clusterRadius===t.clusterRadius&&r.tolerance===t.tolerance&&r.lineMetrics===t.lineMetrics&&JSON.stringify(r.clusterProperties)===JSON.stringify(t.clusterProperties)&&r.buffer===t.buffer&&r.clusterMinPoints===t.clusterMinPoints&&r.generateId===t.generateId&&r.promoteId===t.promoteId&&r.filter===t.filter},e.prototype._addNoUpdate=function(t,r){var i;t instanceof Ci?(this._addToSources(t,r),i=[t]):Array.isArray(t)?(i=t.map(function(o){return o instanceof Ci?o:new Ci(o)}),this._addToSources(i,r)):t.type==="FeatureCollection"?(i=t.features.map(function(o){return new Ci(o)}),this._addToSources(i,r)):t.type==="GeometryCollection"?(i=t.geometries.map(function(o){return new Ci(o)}),this._addToSources(i,r)):(t=new Ci(t),this._addToSources(t,r),i=[t]),this._invokeEvent("dataadded",i)},e.prototype._clearNoUpdate=function(){var t=this.shapes;this.shapes=[],this.shapesMap=new ws,t&&0<t.length&&this._invokeEvent("dataremoved",t)},e.prototype._updateSource=function(){var t=this;this.requestId===void 0&&(this.requestId=requestAnimationFrame(function(){t._updateMboxSource(),t.requestId=void 0}))},e.prototype._addToSources=function(t,r){var i,o,a,l;if(t=Array.isArray(t)?t:[t],typeof r!="number")try{for(var h=cw(t),p=h.next();!p.done;p=h.next()){var g=p.value;this.shapes.push(g),this.shapesMap.set(g.getId(),this.shapes.length-1)}}catch(M){i={error:M}}finally{try{p&&!p.done&&(o=h.return)&&o.call(h)}finally{if(i)throw i.error}}else for(var _=t.length-1;0<=_;_--)this.shapes.splice(r,0,t[_]),this._updateShapesMap(r);try{for(var x=cw(t),C=x.next();!C.done;C=x.next())(g=C.value)._setDataSource(this)}catch(M){a={error:M}}finally{try{C&&!C.done&&(l=x.return)&&l.call(x)}finally{if(a)throw a.error}}},e.prototype._removeById=function(r){var r=r instanceof Ci?r.getId():typeof r=="string"||typeof r=="number"?r:r.id,i=this.shapes[this.shapesMap.get(r)];i&&(i._setDataSource(null),this.shapes.splice(this.shapesMap.get(r),1),this._updateShapesMap(this.shapesMap.get(r)),this.shapesMap.delete(r),this._invokeEvent("dataremoved",[i]))},e.prototype._removeByIndex=function(t){var r;if(t>=this.shapes.length)throw new Error("The specified remove index '".concat(t,"' ")+"is greater than the maximum possible index '".concat(this.shapes.length-1,"'"));r=this.shapes[t],this.shapesMap.delete(r.getId()),r._setDataSource(null),this.shapes.splice(t,1),this._updateShapesMap(t),this._invokeEvent("dataremoved",[r])},e.prototype._updateShapesMap=function(t){for(var r=t;r<this.shapes.length;r++)this.shapesMap.set(this.shapes[r].getId(),r)},e.prototype._updateMboxSource=function(){var t;this.map&&this.map._getMap()&&(t=this.map._getMap().getSource(this.getId()))&&t.type==="geojson"&&t.setData(this._toJson())},e}(gi),cme=window&&window.__extends||function(){var n=function(e,t){return(n=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(r,i){r.__proto__=i}:function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])}))(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),S6=function(n){function e(){var t=n!==null&&n.apply(this,arguments)||this;return t.bounds=void 0,t.minZoom=0,t.maxZoom=22,t.isTMS=!1,t.tiles=void 0,t.url=void 0,t}return cme(e,n),e}(ii),lme=window&&window.__extends||function(){var n=function(e,t){return(n=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(r,i){r.__proto__=i}:function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])}))(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),C6=function(n){function e(t,r){return t=n.call(this,t)||this,t.options=new S6().merge(Zi(r)),t}return lme(e,n),e.prototype.getOptions=function(){return Zi(this.options)},e.prototype.getShape=function(t,r){return this.map._getMap().querySourceFeatures(this.getId(),{sourceLayer:t,filter:r})},e.prototype._buildSource=function(){var t={type:"vector"};return this.options.bounds&&(t.bounds=this.options.bounds),this.options.tiles?(t.tiles=this.options.tiles,t.minzoom=this.options.minZoom,t.maxzoom=this.options.maxZoom):this.options.url&&(t.url=this.options.url),this.options.isTMS&&(t.scheme="tms"),t},e.prototype._isDeepEqual=function(t){var r,i;return this.constructor===t.constructor&&(r=this._buildSource(),i=t._buildSource(),r.type===i.type)&&r.url===i.url&&(r.tiles===void 0&&i.tiles===void 0||r.tiles&&i.tiles&&r.tiles.length===i.tiles.length&&r.tiles.every(function(o,a){return o===i.tiles[a]}))&&r.minzoom===i.minzoom&&r.maxzoom===i.maxzoom&&r.bounds===i.bounds&&r.attribution===i.attribution&&r.promoteId===i.promoteId&&r.scheme===i.scheme},e}(gi),ume=window&&window.__extends||function(){var n=function(e,t){return(n=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(r,i){r.__proto__=i}:function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])}))(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),A6=function(n){function e(t,r,i){return t=n.call(this,t)||this,t.source=r,t}return ume(e,n),e.prototype._isDeepEqual=function(t){var r;return this.constructor===t.constructor&&(r=this.source,t=t.source,r.type===t.type)&&r.canvas===t.canvas&&JSON.stringify(r.coordinates)===JSON.stringify(t.coordinates)&&r.animate===t.animate},e.prototype._buildSource=function(){return this.source},e}(gi),hme=window&&window.__extends||function(){var n=function(e,t){return(n=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(r,i){r.__proto__=i}:function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])}))(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),I6=function(n){function e(t,r,i){return t=n.call(this,t)||this,t.source=r,t}return hme(e,n),e.prototype._isDeepEqual=function(t){var r;return this.constructor===t.constructor&&(r=this.source,t=t.source,r.type===t.type)},e.prototype._buildSource=function(){return this.source},e}(gi),dme=window&&window.__extends||function(){var n=function(e,t){return(n=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(r,i){r.__proto__=i}:function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])}))(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),u2=function(n){function e(t,r,i){return t=n.call(this,t)||this,t.source=r,t}return dme(e,n),e.prototype._isDeepEqual=function(t){var r;return this.constructor===t.constructor&&(r=this.source,t=t.source,r.type===t.type)&&JSON.stringify(r.coordinates)===JSON.stringify(t.coordinates)&&r.url===t.url},e.prototype._buildSource=function(){return this.source},e}(gi),fme=window&&window.__extends||function(){var n=function(e,t){return(n=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(r,i){r.__proto__=i}:function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])}))(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),P6=function(n){function e(t,r,i){return t=n.call(this,t)||this,t.source=r,t}return fme(e,n),e.prototype._isDeepEqual=function(t){var r;return this.constructor===t.constructor&&(r=this.source,t=t.source,r.type===t.type)&&JSON.stringify(r.coordinates)===JSON.stringify(t.coordinates)&&r.urls===t.urls},e.prototype._buildSource=function(){return this.source},e}(gi),pme=window&&window.__extends||function(){var n=function(e,t){return(n=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(r,i){r.__proto__=i}:function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])}))(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),gme=function(n){function e(){var t=n!==null&&n.apply(this,arguments)||this;return t.tileSize=512,t}return pme(e,n),e}(S6),mme=window&&window.__extends||function(){var n=function(e,t){return(n=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(r,i){r.__proto__=i}:function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])}))(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),yme=function(n){function e(){var t=n!==null&&n.apply(this,arguments)||this;return t.encoding=void 0,t}return mme(e,n),e}(gme),_me=window&&window.__extends||function(){var n=function(e,t){return(n=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(r,i){r.__proto__=i}:function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])}))(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),M6=window&&window.__assign||function(){return(M6=Object.assign||function(n){for(var e,t=1,r=arguments.length;t<r;t++)for(var i in e=arguments[t])Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i]);return n}).apply(this,arguments)},vme=function(n){function e(t,r){return t=n.call(this,t)||this,t.options=new yme().merge(Zi(r)),t}return _me(e,n),e.prototype.getOptions=function(){return Zi(this.options)},e.prototype._buildSource=function(){return M6({type:"raster-dem",bounds:this.options.bounds,minzoom:this.options.minZoom,maxzoom:this.options.maxZoom,tileSize:this.options.tileSize,encoding:this.options.encoding},this.options.tiles?{tiles:this.options.tiles}:{url:this.options.url})},e.prototype._isDeepEqual=function(t){return this.constructor===t.constructor&&(t=t.getOptions(),this.options.url===t.url)&&this.options.tiles===t.tiles&&this.options.bounds===t.bounds&&this.options.minZoom===t.minZoom&&this.options.maxZoom===t.maxZoom&&this.options.tileSize===t.tileSize&&this.options.encoding===t.encoding},e}(gi),bme=Object.freeze({__proto__:null,CanvasSource:A6,DataSource:Es,ElevationTileSource:vme,ImageSource:u2,Source:gi,UnknownSource:I6,VectorTileSource:C6,VideoSource:P6}),wme=window&&window.__extends||function(){var n=function(e,t){return(n=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(r,i){r.__proto__=i}:function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])}))(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),Ai=function(n){function e(t){var r=n.call(this)||this;return r.id=t||Vd(),r}return wme(e,n),e.prototype.getId=function(){return this.id},e.prototype.getMap=function(){return this.map||null},e.prototype.onAdd=function(t){this.map=t,this._invokeEvent("layeradded",this),this.map.events.invoke("layeradded",this)},e.prototype.onRemove=function(){var t=this.map;delete this.map,this._invokeEvent("layerremoved",this),t&&t.events.invoke("layerremoved",this)},e._isMBoxEvent=function(t){return!this.LayerEvents.hasOwnProperty(t)},e.prototype._updateBaseProperties=function(t,r){this._updateFilter(t.filter,r.filter),this._updateZoomRange(t.minZoom,r.minZoom,t.maxZoom,r.maxZoom),this._updateLayoutProperty("visibility",t.visible,r.visible,t.visible?"visible":"none")},e.prototype._updateFilter=function(t,r){Ea(t,r)||this.map._getMap().setFilter(this.id,t)},e.prototype._updatePaintProperty=function(t,r,i,o){Ea(r,i)||this.map._getMap().setPaintProperty(this.id,t,o||r)},e.prototype._updateLayoutProperty=function(t,r,i,o){Ea(r,i)||this.map._getMap().setLayoutProperty(this.id,t,o||r)},e.prototype._updateZoomRange=function(t,r,i,o){t===r&&o===i||this.map._getMap().setLayerZoomRange(this.id,t,i)},e.LayerEvents={layeradded:void 0,layerremoved:void 0,focusin:void 0,focusout:void 0},e}(Wl),xme=window&&window.__extends||function(){var n=function(e,t){return(n=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(r,i){r.__proto__=i}:function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])}))(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),lh=function(n){function e(){var t=n!==null&&n.apply(this,arguments)||this;return t.filter=void 0,t.minZoom=0,t.maxZoom=24,t.visible=!0,t}return xme(e,n),e._cloneCustomizer=function(t){if(t instanceof gi)return t},e}(ii),Eme=window&&window.__extends||function(){var n=function(e,t){return(n=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(r,i){r.__proto__=i}:function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])}))(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),D_=function(n){function e(){var t=n!==null&&n.apply(this,arguments)||this;return t.source=void 0,t.sourceLayer=void 0,t.color="#1A73AA",t.blur=0,t.opacity=1,t.strokeColor="#FFFFFF",t.strokeOpacity=1,t.strokeWidth=2,t.pitchAlignment="viewport",t.radius=8,t.createIndicators=!1,t.accessibilityIdKey=void 0,t}return Eme(e,n),e}(lh),Tme=window&&window.__extends||function(){var n=function(e,t){return(n=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(r,i){r.__proto__=i}:function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])}))(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),Sme=window&&window.__awaiter||function(n,e,t,r){return new(t=t||Promise)(function(i,o){function a(p){try{h(r.next(p))}catch(g){o(g)}}function l(p){try{h(r.throw(p))}catch(g){o(g)}}function h(p){var g;p.done?i(p.value):((g=p.value)instanceof t?g:new t(function(_){_(g)})).then(a,l)}h((r=r.apply(n,e||[])).next())})},Cme=window&&window.__generator||function(n,e){var t,r,i,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]},a={next:l(0),throw:l(1),return:l(2)};return typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function l(h){return function(p){var g=[h,p];if(t)throw new TypeError("Generator is already executing.");for(;o=a&&g[a=0]?0:o;)try{if(t=1,r&&(i=2&g[0]?r.return:g[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,g[1])).done)return i;switch(r=0,(g=i?[2&g[0],i.value]:g)[0]){case 0:case 1:i=g;break;case 4:return o.label++,{value:g[1],done:!1};case 5:o.label++,r=g[1],g=[0];continue;case 7:g=o.ops.pop(),o.trys.pop();continue;default:if(!(i=0<(i=o.trys).length&&i[i.length-1])&&(g[0]===6||g[0]===2)){o=0;continue}if(g[0]===3&&(!i||g[1]>i[0]&&g[1]<i[3]))o.label=g[1];else if(g[0]===6&&o.label<i[1])o.label=i[1],i=g;else{if(!(i&&o.label<i[2])){i[2]&&o.ops.pop(),o.trys.pop();continue}o.label=i[2],o.ops.push(g)}}g=e.call(n,o)}catch(_){g=[6,_],r=0}finally{t=i=0}if(5&g[0])throw g[1];return{value:g[0]?g[1]:void 0,done:!0}}}},R6=window&&window.__read||function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var r,i,o=t.call(n),a=[];try{for(;(e===void 0||0<e--)&&!(r=o.next()).done;)a.push(r.value)}catch(l){i={error:l}}finally{try{r&&!r.done&&(t=o.return)&&t.call(o)}finally{if(i)throw i.error}}return a},k6=window&&window.__spreadArray||function(n,e,t){if(t||arguments.length===2)for(var r,i=0,o=e.length;i<o;i++)!r&&i in e||((r=r||Array.prototype.slice.call(e,0,i))[i]=e[i]);return n.concat(r||Array.prototype.slice.call(e))},h2=function(n){function e(t,r,i){var o=n.call(this,r)||this;return o.accessibleIndicator=[],o._setAccessibleIndicator=function(){return Sme(o,void 0,void 0,function(){var a,l,h,p,g,_,x=this;return Cme(this,function(C){return this.accessibleIndicator.forEach(function(M){return M.remove()}),this.accessibleIndicator=[],a=this.map.layers.getRenderedShapes(this.map.getCamera().bounds,this),l=this.options.accessibilityIdKey||(this._getDataSource()?Ci._shapeIdPropName:void 0),h=function(M,L){var F=M[L],z=F instanceof Ci?F.toJson():F,ee=new ime({positionInSet:L+1,setSize:M.length}),ce=ee.getElement(),se=R6(x.map.positionsToPixels([x.getFirstCoordinate(z.geometry.coordinates)]),1)[0];return ce.addEventListener("focusin",function(_e){x.accessibleIndicator.filter(function(J){return J!==ee}).forEach(function(J){return J.remove()}),0<=L-1&&p(ee,h(M,L-1)),L+1<M.length&&_(h(M,L+1)),2<=L&&L==M.length-1&&g(h(M,0)),L==0&&2<=M.length&&_(h(M,M.length-1)),l!==void 0&&x.map._getMap().setPaintProperty(x.id,"circle-stroke-color",["case",["==",["get",l],z.properties[l]],"#000000",x.options.strokeColor]),_e={target:ce,type:"focusin",map:x.map,shape:F,originalEvent:_e,pixel:se},x._invokeEvent("focusin",_e)}),ce.addEventListener("focusout",function(_e){l!==void 0&&x.map._getMap().setPaintProperty(x.id,"circle-stroke-color",["case",["==",["get",l],z.properties[l]],x.options.strokeColor,x.options.strokeColor]),_e={target:ce,type:"focusout",map:x.map,shape:F,originalEvent:_e,pixel:se},x._invokeEvent("focusout",_e)}),x.accessibleIndicator.push(ee),ee},p=function(M,L){L.attach(x.map),L=L.getElement(),M=M.getElement(),M.parentElement.insertBefore(L,M)},g=function(L){L.attach(x.map);var L=L.getElement(),F=L.parentElement;F.insertBefore(L,F.firstElementChild)},_=function(M){M.attach(x.map)},0<a.length&&_(h(a,0)),1<a.length&&_(h(a,a.length-1)),[2]})})},o.options=new D_().merge(Cr(i,D_._cloneCustomizer)),o.options.source=t||o.options.source,o}return Tme(e,n),e.prototype.getOptions=function(){return Cr(this.options,D_._cloneCustomizer)},e.prototype.getSource=function(){return this.options.source},e.prototype.setOptions=function(t){if(t=new D_().merge(this.options,Cr(t,D_._cloneCustomizer)),this.map){if(t.source!==this.options.source||t.sourceLayer!==this.options.sourceLayer)return this.options=t,void this.map.layers.add(this);this._updateBaseProperties(t,this.options),this._updatePaintProperty("circle-blur",t.blur,this.options.blur),this._updatePaintProperty("circle-color",t.color,this.options.color),this._updatePaintProperty("circle-opacity",t.opacity,this.options.opacity),this._updatePaintProperty("circle-radius",t.radius,this.options.radius),this._updatePaintProperty("circle-stroke-color",t.strokeColor,this.options.strokeColor),this._updatePaintProperty("circle-stroke-opacity",t.strokeOpacity,this.options.strokeOpacity),this._updatePaintProperty("circle-stroke-width",t.strokeWidth,this.options.strokeWidth),this._updatePaintProperty("circle-pitch-alignment",t.pitchAlignment,this.options.pitchAlignment)}this.options=t},e.prototype.onAdd=function(t){var r,i,o=this;n.prototype.onAdd.call(this,t),this.options.createIndicators&&(t.events.addOnce("idle",this._setAccessibleIndicator),t.events.add("moveend",this._setAccessibleIndicator),(r=this._getDataSource())?t.events.add("dataadded",r,function(){t.events.addOnce("idle",o._setAccessibleIndicator)}):(i=typeof this.options.source=="string"?this.options.source:this.options.source.getId(),t.events.add("sourcedata",function(a){((a=a.source)==null?void 0:a.getId())===i&&t._getMap().isSourceLoaded(i)&&(a=o._getSourceDataEventCacheKey())!==o.sourceDataEventCacheKey&&(o._setAccessibleIndicator(),o.sourceDataEventCacheKey=a)})))},e.prototype.onRemove=function(){var t;this.options.createIndicators&&(this.map.events.remove("idle",this._setAccessibleIndicator),this.map.events.remove("moveend",this._setAccessibleIndicator),(t=this._getDataSource())?this.map.events.remove("dataadded",t,this._setAccessibleIndicator):this.map.events.remove("sourcedata",this._setAccessibleIndicator)),n.prototype.onRemove.call(this)},e.prototype._getSourceDataEventCacheKey=function(){var t;if(this.map)return t=this.map.getServiceOptions().mapConfiguration,k6(k6([],R6(this.map.getCamera().bounds),!1),[this.map.getCamera().zoom,this.map.getCamera().pitch,this.map.getStyle().style,t instanceof Object?t.id:t],!1).join(",")},e.prototype._getDataSource=function(){var t=typeof this.options.source=="string"?this.map.sources.getById(this.options.source):this.options.source;if(t instanceof Es)return t},e.prototype._buildLayers=function(){var t={id:this.id,type:"circle",source:this.options.source instanceof gi?this.options.source.getId():this.options.source,layout:{visibility:this.options.visible?"visible":"none"},paint:{"circle-color":this.options.color,"circle-blur":this.options.blur,"circle-opacity":this.options.opacity,"circle-stroke-color":this.options.strokeColor,"circle-stroke-opacity":this.options.strokeOpacity,"circle-stroke-width":this.options.strokeWidth,"circle-pitch-alignment":this.options.pitchAlignment,"circle-radius":this.options.radius},minzoom:this.options.minZoom,maxzoom:this.options.maxZoom};return this.options.filter&&(t.filter=this.options.filter),this.options.sourceLayer&&(t["source-layer"]=this.options.sourceLayer),[t]},e.prototype._getLayerIds=function(){return[this.id]},e.prototype._getSourceIds=function(){var t=new Set;return this.options.source instanceof gi?t.add(this.options.source.getId()):t.add(this.options.source),t},e.prototype.getFirstCoordinate=function(t){return Array.isArray(t[0])?this.getFirstCoordinate(t[0]):t},e}(Ai),Ame=window&&window.__extends||function(){var n=function(e,t){return(n=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(r,i){r.__proto__=i}:function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])}))(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),F_=function(n){function e(){var t=n!==null&&n.apply(this,arguments)||this;return t.source=void 0,t.sourceLayer=void 0,t.color=["interpolate",["linear"],["heatmap-density"],0,"rgba(0,0, 255,0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],t.intensity=1,t.opacity=1,t.radius=30,t.weight=1,t}return Ame(e,n),e._cloneCustomizer=function(t){if(t instanceof gi)return t},e}(lh),Ime=window&&window.__extends||function(){var n=function(e,t){return(n=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(r,i){r.__proto__=i}:function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])}))(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),Pme=function(n){function e(t,r,i){return r=n.call(this,r)||this,r.options=new F_().merge(Cr(i,F_._cloneCustomizer)),r.options.source=t||r.options.source,r}return Ime(e,n),e.prototype.getOptions=function(){return Cr(this.options,F_._cloneCustomizer)},e.prototype.getSource=function(){return this.options.source},e.prototype.setOptions=function(t){if(t=new F_().merge(this.options,Cr(t,F_._cloneCustomizer)),this.map){if(t.source!==this.options.source||t.sourceLayer!==this.options.sourceLayer)return this.options=t,void this.map.layers.add(this);this._updateBaseProperties(t,this.options),this._updatePaintProperty("heatmap-color",t.color,this.options.color),this._updatePaintProperty("heatmap-intensity",t.intensity,this.options.intensity),this._updatePaintProperty("heatmap-opacity",t.opacity,this.options.opacity),this._updatePaintProperty("heatmap-radius",t.radius,this.options.radius),this._updatePaintProperty("heatmap-weight",t.weight,this.options.weight)}this.options=t},e.prototype._buildLayers=function(){var t={id:this.id,type:"heatmap",source:this.options.source instanceof gi?this.options.source.getId():this.options.source,layout:{visibility:this.options.visible?"visible":"none"},paint:{"heatmap-color":this.options.color,"heatmap-intensity":this.options.intensity,"heatmap-opacity":this.options.opacity,"heatmap-radius":this.options.radius,"heatmap-weight":this.options.weight},minzoom:this.options.minZoom,maxzoom:this.options.maxZoom};return this.options.filter&&(t.filter=this.options.filter),this.options.sourceLayer&&(t["source-layer"]=this.options.sourceLayer),[t]},e.prototype._getLayerIds=function(){return[this.id]},e.prototype._getSourceIds=function(){var t=new Set;return this.options.source instanceof gi?t.add(this.options.source.getId()):t.add(this.options.source),t},e}(Ai),Mme=window&&window.__extends||function(){var n=function(e,t){return(n=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(r,i){r.__proto__=i}:function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])}))(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),O6=function(n){function e(){var t=n!==null&&n.apply(this,arguments)||this;return t.contrast=0,t.fadeDuration=300,t.hueRotation=0,t.maxBrightness=1,t.minBrightness=0,t.opacity=1,t.saturation=0,t}return Mme(e,n),e}(lh),Rme=window&&window.__extends||function(){var n=function(e,t){return(n=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(r,i){r.__proto__=i}:function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])}))(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),B_=function(n){function e(){var t=n!==null&&n.apply(this,arguments)||this;return t.url=void 0,t.coordinates=void 0,t}return Rme(e,n),e._cloneCustomizer=function(t){if(t instanceof gi)return t},e}(O6),kme=window&&window.__extends||function(){var n=function(e,t){return(n=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(r,i){r.__proto__=i}:function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])}))(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),U_=function(n){function e(){return n!==null&&n.apply(this,arguments)||this}return kme(e,n),e.prototype._getSourceIds=function(){var t=new Set;return t.add(this._getSourceId()),t},e.prototype.onAdd=function(t){n.prototype.onAdd.call(this,t)},e}(Ai),Ome=window&&window.__extends||function(){var n=function(e,t){return(n=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(r,i){r.__proto__=i}:function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])}))(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),Lme=function(n){function e(t,r){return r=n.call(this,r)||this,r.isLoading=!1,r.options=new B_().merge(Cr(t,B_._cloneCustomizer)),r.img=new Image,r.reloadImage(),r}return Ome(e,n),e.prototype.getOptions=function(){return Cr(this.options,B_._cloneCustomizer)},e.prototype.setOptions=function(a){var r,i=new B_().merge(this.options,Cr(a,B_._cloneCustomizer)),o=typeof a.url=="string"&&a.url!==this.getOptions().url,a=a.coordinates!==void 0&&a.coordinates!==this.getOptions().coordinates;this.map&&(this._updateBaseProperties(i,this.options),this._updatePaintProperty("raster-contrast",i.contrast,this.options.contrast),this._updatePaintProperty("raster-fade-duration",i.fadeDuration,this.options.fadeDuration),this._updatePaintProperty("raster-hue-rotate",i.hueRotation,this.options.hueRotation),this._updatePaintProperty("raster-brightness-max",i.maxBrightness,this.options.maxBrightness),this._updatePaintProperty("raster-opacity",i.opacity,this.options.opacity),this._updatePaintProperty("raster-saturation",i.saturation,this.options.saturation),r=this.map._getMap().getSource(this._getSourceId()))&&(o||a)&&r.updateImage(i),this.options=i,o?this.reloadImage():a&&this.updateTransform()},e.prototype.getPositions=function(t){return this.transform.then(function(r){return r.toTarget(t)})},e.prototype.getPixels=function(t){return this.transform.then(function(r){return r.toSource(t)})},e.getCoordinatesFromRefPoints=function(t,r,i,o){return new sw(i,o).toTarget([[0,0],[t,0],[t,r],[0,r]])},e.getCoordinatesFromEdges=function(t,r,i,o,a){return typeof a!="number"&&(a=0),r=[Math.min(o,i),r,Math.max(o,i),t],o=rr.getCenter(r),y6([rr.getNorthWest(r),rr.getNorthEast(r),rr.getSouthEast(r),rr.getSouthWest(r)],o,a)},e.prototype._buildLayers=function(){var t={id:this.id,type:"raster",source:this._getSourceId(),layout:{visibility:this.options.visible?"visible":"none"},paint:{"raster-opacity":this.options.opacity,"raster-hue-rotate":this.options.hueRotation,"raster-brightness-min":this.options.minBrightness,"raster-brightness-max":this.options.maxBrightness,"raster-saturation":this.options.saturation,"raster-contrast":this.options.contrast,"raster-fade-duration":this.options.fadeDuration},minzoom:this.options.minZoom,maxzoom:this.options.maxZoom};return this.options.filter&&(t.filter=this.options.filter),[t]},e.prototype._getLayerIds=function(){return[this.id]},e.prototype._buildSource=function(){return{type:"image",url:this.options.url,coordinates:this.options.coordinates}},e.prototype._getSourceId=function(){return"".concat(this.getId(),"-ImageSource")},e.prototype.reloadImage=function(){var t=this;this.options.url&&(this.transform=new Promise(function(r,i){t.img.onload=function(){var o=[[0,0],[t.img.width,0],[t.img.width,t.img.height],[0,t.img.height]];r(new sw(o,t.options.coordinates)),t.isLoading=!1},t.img.onerror=t.img.onabort=function(){i("Failed to load image")},t.isLoading=!0,t.img.src=t.options.url}))},e.prototype.updateTransform=function(){var t;this.isLoading||(t=[[0,0],[this.img.width,0],[this.img.width,this.img.height],[0,this.img.height]],this.transform=Promise.resolve(new sw(t,this.options.coordinates)))},e.prototype._getSourceWrapper=function(){var t=this._getSourceId(),r=this._buildSource();return new u2(t,r)},e}(U_),Nme=window&&window.__extends||function(){var n=function(e,t){return(n=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(r,i){r.__proto__=i}:function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])}))(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),z_=function(n){function e(){var t=n!==null&&n.apply(this,arguments)||this;return t.source=void 0,t.sourceLayer=void 0,t.lineCap="round",t.lineJoin="round",t.blur=0,t.strokeColor="#1E90FF",t.strokeDashArray=void 0,t.strokeGradient=void 0,t.offset=0,t.strokeOpacity=1,t.translate=new Go(0,0),t.translateAnchor="map",t.strokeWidth=2,t}return Nme(e,n),e}(lh),Dme=window&&window.__extends||function(){var n=function(e,t){return(n=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(r,i){r.__proto__=i}:function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])}))(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),uh=window&&window.__assign||function(){return(uh=Object.assign||function(n){for(var e,t=1,r=arguments.length;t<r;t++)for(var i in e=arguments[t])Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i]);return n}).apply(this,arguments)},d2=function(n){function e(t,r,i){return r=n.call(this,r)||this,r.options=new z_().merge(Cr(i,z_._cloneCustomizer)),r.options.source=t||r.options.source,r}return Dme(e,n),e.prototype.getOptions=function(){return Cr(this.options,z_._cloneCustomizer)},e.prototype.getSource=function(){return this.options.source},e.prototype.setOptions=function(t){if(t=new z_().merge(this.options,Cr(t,z_._cloneCustomizer)),this.map){if(t.source!==this.options.source||t.sourceLayer!==this.options.sourceLayer)return this.options=t,void this.map.layers.add(this);this._updateBaseProperties(t,this.options),this._updatePaintProperty("line-blur",t.blur,this.options.blur),this._updateLayoutProperty("line-cap",t.lineCap,this.options.lineCap),this._updateLayoutProperty("line-join",t.lineJoin,this.options.lineJoin),this._updatePaintProperty("line-offset",t.offset,this.options.offset),this._updatePaintProperty("line-color",t.strokeColor,this.options.strokeColor),this._updatePaintProperty("line-dasharray",t.strokeDashArray,this.options.strokeDashArray),this._updatePaintProperty("line-gradient",t.strokeGradient,this.options.strokeGradient),this._updatePaintProperty("line-opacity",t.strokeOpacity,this.options.strokeOpacity),this._updatePaintProperty("line-width",t.strokeWidth,this.options.strokeWidth),this._updatePaintProperty("line-translate",t.translate,this.options.translate),this._updatePaintProperty("line-translate-anchor",t.translateAnchor,this.options.translateAnchor)}this.options=t},e.prototype._buildLayers=function(){return[uh(uh(uh(uh({id:this.id,type:"line"},this.options.sourceLayer&&{"source-layer":this.options.sourceLayer}),{source:this.options.source instanceof gi?this.options.source.getId():this.options.source,layout:{visibility:this.options.visible?"visible":"none","line-cap":this.options.lineCap,"line-join":this.options.lineJoin},paint:uh(uh(uh({"line-blur":this.options.blur,"line-color":this.options.strokeColor},this.options.strokeDashArray?{"line-dasharray":this.options.strokeDashArray}:{}),this.options.strokeGradient?{"line-gradient":this.options.strokeGradient}:{}),{"line-offset":this.options.offset,"line-opacity":this.options.strokeOpacity,"line-translate":this.options.translate,"line-translate-anchor":this.options.translateAnchor,"line-width":this.options.strokeWidth})}),this.options.filter&&{filter:this.options.filter}),{minzoom:this.options.minZoom,maxzoom:this.options.maxZoom})]},e.prototype._getLayerIds=function(){return[this.id]},e.prototype._getSourceIds=function(){var t=new Set;return this.options.source instanceof gi?t.add(this.options.source.getId()):t.add(this.options.source),t},e}(Ai),Fme=window&&window.__extends||function(){var n=function(e,t){return(n=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(r,i){r.__proto__=i}:function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])}))(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),j_=function(n){function e(){var t=n!==null&&n.apply(this,arguments)||this;return t.source=void 0,t.sourceLayer=void 0,t.base=0,t.fillColor="#1E90FF",t.height=0,t.fillOpacity=1,t.fillPattern=void 0,t.translate=new Go(0,0),t.translateAnchor="map",t.verticalGradient=!0,t}return Fme(e,n),e}(lh),Bme=window&&window.__extends||function(){var n=function(e,t){return(n=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(r,i){r.__proto__=i}:function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])}))(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),Kd=window&&window.__assign||function(){return(Kd=Object.assign||function(n){for(var e,t=1,r=arguments.length;t<r;t++)for(var i in e=arguments[t])Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i]);return n}).apply(this,arguments)},Ume=function(n){function e(t,r,i){return r=n.call(this,r)||this,r.options=new j_().merge(Cr(i,j_._cloneCustomizer)),r.options.source=t||r.options.source,r}return Bme(e,n),e.prototype.getOptions=function(){return Cr(this.options,j_._cloneCustomizer)},e.prototype.getSource=function(){return this.options.source},e.prototype.setOptions=function(t){if(t=new j_().merge(this.options,Cr(t,j_._cloneCustomizer)),this.map){if(t.source!==this.options.source||t.sourceLayer!==this.options.sourceLayer)return this.options=t,void this.map.layers.add(this);this._updateBaseProperties(t,this.options),this._updatePaintProperty("fill-extrusion-base",t.base,this.options.base),this._updatePaintProperty("fill-extrusion-color",t.fillColor,this.options.fillColor),this._updatePaintProperty("fill-extrusion-height",t.height,this.options.height),this._updatePaintProperty("fill-extrusion-opacity",t.fillOpacity,this.options.fillOpacity),this._updatePaintProperty("fill-extrusion-pattern",t.fillPattern,this.options.fillPattern),this._updatePaintProperty("fill-extrusion-translate",t.translate,this.options.translate),this._updatePaintProperty("fill-extrusion-translate-anchor",t.translateAnchor,this.options.translateAnchor),this._updatePaintProperty("fill-extrusion-vertical-gradient",t.verticalGradient,this.options.verticalGradient)}this.options=t},e.prototype._buildLayers=function(){return[Kd(Kd(Kd(Kd({id:this.id,type:"fill-extrusion"},this.options.sourceLayer&&{"source-layer":this.options.sourceLayer}),{source:this.options.source instanceof gi?this.options.source.getId():this.options.source,layout:{visibility:this.options.visible?"visible":"none"},paint:Kd(Kd({"fill-extrusion-base":this.options.base,"fill-extrusion-height":this.options.height,"fill-extrusion-opacity":this.options.fillOpacity},this.options.fillPattern?{"fill-extrusion-pattern":this.options.fillPattern}:{"fill-extrusion-color":this.options.fillColor}),{"fill-extrusion-translate":this.options.translate,"fill-extrusion-translate-anchor":this.options.translateAnchor,"fill-extrusion-vertical-gradient":this.options.verticalGradient})}),this.options.filter&&{filter:this.options.filter}),{minzoom:this.options.minZoom,maxzoom:this.options.maxZoom})]},e.prototype._getLayerIds=function(){return[this.id]},e.prototype._getSourceIds=function(){var t=new Set;return this.options.source instanceof gi?t.add(this.options.source.getId()):t.add(this.options.source),t},e}(Ai),zme=window&&window.__extends||function(){var n=function(e,t){return(n=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(r,i){r.__proto__=i}:function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])}))(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),V_=function(n){function e(){var t=n!==null&&n.apply(this,arguments)||this;return t.source=void 0,t.sourceLayer=void 0,t.fillColor="#1E90FF",t.fillOpacity=.5,t.fillPattern=void 0,t.fillAntialias=!0,t}return zme(e,n),e}(lh),jme=window&&window.__extends||function(){var n=function(e,t){return(n=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(r,i){r.__proto__=i}:function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])}))(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),f2=function(n){function e(t,r,i){return r=n.call(this,r)||this,r.options=new V_().merge(Cr(i,V_._cloneCustomizer)),r.options.source=t||r.options.source,r}return jme(e,n),e.prototype.getOptions=function(){return Cr(this.options,V_._cloneCustomizer)},e.prototype.getSource=function(){return this.options.source},e.prototype.setOptions=function(t){if(t=new V_().merge(this.options,Cr(t,V_._cloneCustomizer)),this.map){if(t.source!==this.options.source||t.sourceLayer!==this.options.sourceLayer)return this.options=t,void this.map.layers.add(this);this._updateBaseProperties(t,this.options),this._updatePaintProperty("fill-color",t.fillColor,this.options.fillColor),this._updatePaintProperty("fill-opacity",t.fillOpacity,this.options.fillOpacity),this._updatePaintProperty("fill-pattern",t.fillPattern,this.options.fillPattern),this._updatePaintProperty("fill-antialias",t.fillAntialias,this.options.fillAntialias)}this.options=t},e.prototype._buildLayers=function(){var t={id:this.id,type:"fill",source:this.options.source instanceof gi?this.options.source.getId():this.options.source,layout:{visibility:this.options.visible?"visible":"none"},paint:{"fill-opacity":this.options.fillOpacity,"fill-antialias":this.options.fillAntialias},minzoom:this.options.minZoom,maxzoom:this.options.maxZoom};return this.options.filter&&(t.filter=this.options.filter),this.options.sourceLayer&&(t["source-layer"]=this.options.sourceLayer),this.options.fillPattern?t.paint["fill-pattern"]=this.options.fillPattern:t.paint["fill-color"]=this.options.fillColor,[t]},e.prototype._getLayerIds=function(){return[this.id]},e.prototype._getSourceIds=function(){var t=new Set;return this.options.source instanceof gi?t.add(this.options.source.getId()):t.add(this.options.source),t},e}(Ai),Vme=window&&window.__extends||function(){var n=function(e,t){return(n=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(r,i){r.__proto__=i}:function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])}))(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),Hme=function(n){function e(){var t=n!==null&&n.apply(this,arguments)||this;return t.allowOverlap=!1,t.anchor="bottom",t.ignorePlacement=!1,t.image="marker-blue",t.offset=new Go(0,0),t.optional=!1,t.padding=2,t.pitchAlignment="auto",t.rotation=0,t.rotationAlignment="auto",t.size=1,t.opacity=1,t}return Vme(e,n),e}(ii),Gme=window&&window.__extends||function(){var n=function(e,t){return(n=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(r,i){r.__proto__=i}:function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])}))(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),qme=function(n){function e(){var t=n!==null&&n.apply(this,arguments)||this;return t.allowOverlap=!1,t.anchor="center",t.textField=void 0,t.font=["StandardFont-Regular"],t.ignorePlacement=!1,t.justify="center",t.offset=new Go(0,0),t.optional=!1,t.padding=2,t.pitchAlignment="auto",t.radialOffset=void 0,t.rotation=0,t.rotationAlignment="auto",t.variableAnchor=void 0,t.size=16,t.color="#000000",t.haloBlur=0,t.haloColor="rgba(0,0,0,0)",t.haloWidth=0,t.opacity=1,t}return Gme(e,n),e}(ii),$me=window&&window.__extends||function(){var n=function(e,t){return(n=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(r,i){r.__proto__=i}:function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])}))(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),H_=function(n){function e(){var t=n!==null&&n.apply(this,arguments)||this;return t.source=void 0,t.sourceLayer=void 0,t.iconOptions=new Hme,t.textOptions=new qme,t.placement="point",t.sortKey=void 0,t.zOrder="auto",t.lineSpacing=250,t}return $me(e,n),e}(lh),Wme=window&&window.__extends||function(){var n=function(e,t){return(n=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(r,i){r.__proto__=i}:function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])}))(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),Zd=window&&window.__assign||function(){return(Zd=Object.assign||function(n){for(var e,t=1,r=arguments.length;t<r;t++)for(var i in e=arguments[t])Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i]);return n}).apply(this,arguments)},lw=function(n){function e(t,r,i){return r=n.call(this,r)||this,r.options=new H_().merge(Cr(i,H_._cloneCustomizer)),r.options.source=t||r.options.source,r}return Wme(e,n),e.prototype.getOptions=function(){return Cr(this.options,H_._cloneCustomizer)},e.prototype.getSource=function(){return this.options.source},e.prototype.setOptions=function(t){if(t=new H_().merge(this.options,Cr(t,H_._cloneCustomizer)),this.map){if(t.source!==this.options.source||t.sourceLayer!==this.options.sourceLayer)return this.options=t,void this.map.layers.add(this);var r=this.options,i=t.iconOptions,o=r.iconOptions,a=t.textOptions,l=r.textOptions;this._updateBaseProperties(t,r),this._updateLayoutProperty("symbol-spacing",t.lineSpacing,r.lineSpacing),this._updateLayoutProperty("symbol-placement",t.placement,r.placement),this._updateLayoutProperty("symbol-sort-key",t.sortKey,r.sortKey),this._updateLayoutProperty("symbol-z-order",t.zOrder,r.zOrder),this._updateLayoutProperty("icon-allow-overlap",i.allowOverlap,o.allowOverlap),this._updateLayoutProperty("icon-anchor",i.anchor,o.anchor),this._updateLayoutProperty("icon-ignore-placement",i.ignorePlacement,o.ignorePlacement),this._updateLayoutProperty("icon-image",i.image,o.image),this._updateLayoutProperty("icon-offset",i.offset,o.offset),this._updatePaintProperty("icon-opacity",i.opacity,o.opacity),this._updateLayoutProperty("icon-optional",i.optional,o.optional),this._updateLayoutProperty("icon-padding",i.padding,o.padding),this._updateLayoutProperty("icon-pitch-alignment",i.pitchAlignment,o.pitchAlignment),this._updateLayoutProperty("icon-rotate",i.rotation,o.rotation),this._updateLayoutProperty("icon-rotation-alignment",i.rotationAlignment,o.rotationAlignment),this._updateLayoutProperty("icon-size",i.size,o.size),this._updateLayoutProperty("text-allow-overlap",a.allowOverlap,l.allowOverlap),this._updateLayoutProperty("text-anchor",a.anchor,l.anchor),this._updatePaintProperty("text-color",a.color,l.color),this._updateLayoutProperty("text-font",a.font,l.font),this._updateLayoutProperty("text-ignore-placement",a.ignorePlacement,l.ignorePlacement),this._updateLayoutProperty("text-justify",a.justify,l.justify),this._updatePaintProperty("text-halo-blur",a.haloBlur,l.haloBlur),this._updatePaintProperty("text-halo-color",a.haloColor,l.haloColor),this._updatePaintProperty("text-halo-width",a.haloWidth,l.haloWidth),this._updateLayoutProperty("text-offset",a.offset,l.offset),this._updatePaintProperty("text-opacity",a.opacity,l.opacity),this._updateLayoutProperty("text-optional",a.optional,l.optional),this._updateLayoutProperty("text-padding",a.padding,l.padding),this._updateLayoutProperty("text-pitch-alignment",a.pitchAlignment,l.pitchAlignment),this._updateLayoutProperty("text-radial-offset",a.radialOffset,l.radialOffset),this._updateLayoutProperty("text-rotate",a.rotation,l.rotation),this._updateLayoutProperty("text-rotation-alignment",a.rotationAlignment,l.rotationAlignment),this._updateLayoutProperty("text-size",a.size,l.size),this._updateLayoutProperty("text-variable-anchor",a.variableAnchor,l.variableAnchor),this._updateLayoutProperty("text-field",a.textField,l.textField)}this.options=t},e.prototype._buildLayers=function(){var t=Zd(Zd(Zd(Zd({id:this.id,type:"symbol"},this.options.sourceLayer&&{"source-layer":this.options.sourceLayer}),{source:this.options.source instanceof gi?this.options.source.getId():this.options.source,layout:Zd(Zd({visibility:this.options.visible?"visible":"none","symbol-placement":this.options.placement,"symbol-spacing":this.options.lineSpacing,"symbol-z-order":this.options.zOrder,"text-allow-overlap":this.options.textOptions.allowOverlap,"text-anchor":this.options.textOptions.anchor},this.options.textOptions.textField&&{"text-field":this.options.textOptions.textField}),{"text-font":this.options.textOptions.font,"text-ignore-placement":this.options.textOptions.ignorePlacement,"text-justify":this.options.textOptions.justify,"text-offset":this.options.textOptions.offset,"text-optional":this.options.textOptions.optional,"text-padding":this.options.textOptions.padding,"text-pitch-alignment":this.options.textOptions.pitchAlignment,"text-rotate":this.options.textOptions.rotation,"text-rotation-alignment":this.options.textOptions.rotationAlignment,"text-size":this.options.textOptions.size,"icon-allow-overlap":this.options.iconOptions.allowOverlap,"icon-anchor":this.options.iconOptions.anchor,"icon-ignore-placement":this.options.iconOptions.ignorePlacement,"icon-image":this.options.iconOptions.image,"icon-offset":this.options.iconOptions.offset,"icon-optional":this.options.iconOptions.optional,"icon-padding":this.options.iconOptions.padding,"icon-pitch-alignment":this.options.iconOptions.pitchAlignment,"icon-rotate":this.options.iconOptions.rotation,"icon-rotation-alignment":this.options.iconOptions.rotationAlignment,"icon-size":this.options.iconOptions.size}),paint:{"text-color":this.options.textOptions.color,"text-halo-blur":this.options.textOptions.haloBlur,"text-halo-color":this.options.textOptions.haloColor,"text-halo-width":this.options.textOptions.haloWidth,"text-opacity":this.options.textOptions.opacity,"icon-opacity":this.options.iconOptions.opacity}}),this.options.filter&&{filter:this.options.filter}),{minzoom:this.options.minZoom,maxzoom:this.options.maxZoom});return this.options.sortKey!==void 0&&(t.layout["symbol-sort-key"]=this.options.sortKey),this.options.textOptions.radialOffset!==void 0&&(t.layout["text-radial-offset"]=this.options.textOptions.radialOffset),this.options.textOptions.variableAnchor!==void 0&&(t.layout["text-variable-anchor"]=this.options.textOptions.variableAnchor),[t]},e.prototype._getLayerIds=function(){return[this.id]},e.prototype._getSourceIds=function(){var t=new Set;return this.options.source instanceof gi?t.add(this.options.source.getId()):t.add(this.options.source),t},e}(Ai),Yme=window&&window.__extends||function(){var n=function(e,t){return(n=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(r,i){r.__proto__=i}:function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])}))(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),G_=window&&window.__assign||function(){return(G_=Object.assign||function(n){for(var e,t=1,r=arguments.length;t<r;t++)for(var i in e=arguments[t])Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i]);return n}).apply(this,arguments)},L6=function(n){function e(t,r,i){return t=n.call(this,t)||this,t.source=t._modifySource(r,i),t}return Yme(e,n),e.prototype._buildSource=function(){return this.source},e.prototype._isDeepEqual=function(t){var r,i,o,a;return this.constructor===t.constructor&&(a=this.source,r=t.source,t=a.type===r.type&&a.url===r.url&&(a.tiles===void 0&&r.tiles===void 0||a.tiles&&r.tiles&&a.tiles.length===r.tiles.length&&a.tiles.every(function(l,h){return l===r.tiles[h]}))&&a.minzoom===r.minzoom&&a.maxzoom===r.maxzoom&&a.bounds===r.bounds&&a.attribution===r.attribution,i=a.type!=="raster"||a.type==="raster"&&a.type===r.type&&a.tileSize===r.tileSize&&a.scheme===r.scheme,o=a.type!=="raster-dem"||a.type==="raster-dem"&&a.type===r.type&&a.tileSize===r.tileSize&&a.encoding===r.encoding,a=a.type!=="vector"||a.type==="vector"&&a.type===r.type&&a.promoteId===r.promoteId&&a.scheme===r.scheme,t)&&i&&o&&a},e.prototype._modifySource=function(t,r){if(t.type!=="raster"&&t.type!=="raster-dem"&&t.type!=="vector"||!t.tiles){if(t.type!=="raster"&&t.type!=="raster-dem"&&t.type!=="vector"||!t.url)throw new Error("Source definition must define a TileJSON 'url' or a 'tiles' array.");t.url=typeof t.url=="string"?t.url:new Zc({domain:Nn.domainPlaceHolder,path:t.url.path,queryParams:G_(G_({},r),t.url.queryParams)}).toString()}else{var i=t.tiles.map(function(o){return typeof o=="string"?o:new Zc({domain:Nn.domainPlaceHolder,path:o.path,queryParams:G_(G_({},r),o.queryParams)}).toString()});t.tiles=i}return t},e}(gi),Kme=window&&window.__extends||function(){var n=function(e,t){return(n=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(r,i){r.__proto__=i}:function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])}))(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),q_=function(n){function e(){var t=n!==null&&n.apply(this,arguments)||this;return t.bounds=[-180,-85.0511,180,85.0511],t.minSourceZoom=0,t.maxSourceZoom=22,t.tileSize=512,t.isTMS=!1,t.subdomains=void 0,t.tileUrl=void 0,t}return Kme(e,n),e}(O6),Zme=window&&window.__extends||function(){var n=function(e,t){return(n=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(r,i){r.__proto__=i}:function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])}))(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),uw=window&&window.__assign||function(){return(uw=Object.assign||function(n){for(var e,t=1,r=arguments.length;t<r;t++)for(var i in e=arguments[t])Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i]);return n}).apply(this,arguments)},Xme=window&&window.__values||function(n){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&n[e],r=0;if(t)return t.call(n);if(n&&typeof n.length=="number")return{next:function(){return{value:(n=n&&r>=n.length?void 0:n)&&n[r++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},hw=function(n){function e(t,r){return r=n.call(this,r)||this,t&&r.setOptions(t),r}return Zme(e,n),e.prototype.getOptions=function(){return Cr(this.options,q_._cloneCustomizer)},e.prototype.setOptions=function(t){if(t=new q_().merge(this.options,Cr(t,q_._cloneCustomizer)),this.map){if(!Ea(t.bounds,this.options.bounds)||t.isTMS!==this.options.isTMS||t.maxSourceZoom!==this.options.maxSourceZoom||t.minSourceZoom!==this.options.minSourceZoom||!Ea(t.subdomains,this.options.subdomains)||t.tileSize!==this.options.tileSize||t.tileUrl!==this.options.tileUrl)return this.options=t,void this.map.layers.add(this);this._updateBaseProperties(t,this.options),this._updatePaintProperty("raster-contrast",t.contrast,this.options.contrast),this._updatePaintProperty("raster-fade-duration",t.fadeDuration,this.options.fadeDuration),this._updatePaintProperty("raster-hue-rotate",t.hueRotation,this.options.hueRotation),this._updatePaintProperty("raster-brightness-max",t.maxBrightness,this.options.maxBrightness),this._updatePaintProperty("raster-opacity",t.opacity,this.options.opacity),this._updatePaintProperty("raster-saturation",t.saturation,this.options.saturation)}this.options=t},e.prototype._setOptionsNoUpdate=function(t){this.options=new q_().merge(this.options,Cr(t,q_._cloneCustomizer))},e.prototype._buildLayers=function(){return[uw(uw({id:this.id,type:"raster",source:this._getSourceId(),layout:{visibility:this.options.visible?"visible":"none"},paint:{"raster-contrast":this.options.contrast,"raster-fade-duration":this.options.fadeDuration,"raster-hue-rotate":this.options.hueRotation,"raster-brightness-max":this.options.maxBrightness,"raster-brightness-min":this.options.minBrightness,"raster-opacity":this.options.opacity,"raster-saturation":this.options.saturation}},this.options.filter&&{filter:this.options.filter}),{minzoom:this.options.minZoom,maxzoom:this.options.maxZoom})]},e.prototype._getLayerIds=function(){return[this.id]},e.prototype._buildSource=function(){var t,r;if(this.options.tileUrl){if(this.options.tileUrl.indexOf("{")===-1)return{type:"raster",url:this.options.tileUrl};if(this.options.tileUrl.indexOf("{subdomain}")!==-1){if(!(this.options.subdomains&&0<this.options.subdomains.length))throw new Error("The {subdomain} placeholder was included in the tileUrl but no subdomains were specified");var i=[];try{for(var o=Xme(this.options.subdomains),a=o.next();!a.done;a=o.next()){var l=a.value;i.push(this.options.tileUrl.replace(/{subdomain}/g,l))}}catch(h){t={error:h}}finally{try{a&&!a.done&&(r=o.return)&&r.call(o)}finally{if(t)throw t.error}}r=i}else r=[this.options.tileUrl]}return uw({type:"raster",bounds:this.options.bounds,maxzoom:this.options.maxSourceZoom,minzoom:this.options.minSourceZoom,scheme:this.options.isTMS?"tms":"xyz",tileSize:this.options.tileSize},r&&{tiles:r})},e.prototype._getSourceId=function(){return"".concat(this.getId(),"-RasterSource")},e.prototype._getSourceWrapper=function(){var t=this._getSourceId(),r=this._buildSource();return new L6(t,{name:t,tiles:r.tiles,type:r.type,url:r.url})},e}(U_),Qme=window&&window.__extends||function(){var n=function(e,t){return(n=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(r,i){r.__proto__=i}:function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])}))(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),$_=function(n){function e(){var t=n!==null&&n.apply(this,arguments)||this;return t.renderer=void 0,t}return Qme(e,n),e}(lh),Jme=window&&window.__extends||function(){var n=function(e,t){return(n=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(r,i){r.__proto__=i}:function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])}))(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),N6=function(n){function e(t,r){var i=n.call(this,t)||this;return i._onStyleChange=function(){var o,a;i.map._getMap().getLayer(i.id)||(o=i.map,a=(a=i.map.layers._getUserLayers().find(function(l){return l.layer.getId()==i.id}))==null?void 0:a.before,o.layers.remove(i),o.layers.add(i,a))},i.options=new $_().merge(Cr(r,$_._cloneCustomizer)),i.source=new Es,i}return Jme(e,n),e.prototype.getOptions=function(){return Cr(this.options,$_._cloneCustomizer)},e.prototype.setOptions=function(t){t=new $_().merge(this.options,Cr(t,$_._cloneCustomizer)),this.map&&this.map.triggerRepaint(),this.options=t},e.prototype.onAdd=function(t){var r,i;n.prototype.onAdd.call(this,t),this.map.events.add("stylechanged",this._onStyleChange),this.options.renderer&&this.glContext&&(i=(r=this.options.renderer).onAdd)!=null&&i.call(r,t,this.glContext)},e.prototype.onRemove=function(){var t,r;this.options.renderer&&this.glContext&&(r=(t=this.options.renderer).onRemove)!=null&&r.call(t,this.map,this.glContext),this.map.events.remove("stylechanged",this._onStyleChange),this.glContext=null,n.prototype.onRemove.call(this)},e.prototype._buildLayers=function(){var t=this;if(this.options.renderer)return[{id:this.id,type:"custom",renderingMode:this.options.renderer.renderingMode,onAdd:function(r,i){t.glContext=i},onRemove:function(r,i){},prerender:function(r,i){var o,a;t._shouldRender()&&(a=(o=t.options.renderer).prerender)!=null&&a.call(o,r,i)},render:function(r,i){t._shouldRender()&&t.options.renderer.render(r,i)}}];throw new Error("Cannot build the WebGL layer because renderer was not set.")},e.prototype._getLayerIds=function(){return[this.id]},e.prototype._getSourceIds=function(){return new Set().add(this.source.getId())},e.prototype._shouldRender=function(){var t;return!!this.map&&(t=this.map.getCamera().zoom,this.options.visible)&&this.options.minZoom<=t&&this.options.maxZoom>t},e}(Ai),eye=Object.freeze({__proto__:null,BubbleLayer:h2,HeatMapLayer:Pme,ImageLayer:Lme,Layer:Ai,LineLayer:d2,PolygonExtrusionLayer:Ume,PolygonLayer:f2,SymbolLayer:lw,TileLayer:hw,WebGLLayer:N6}),dw=function(){function n(){}return n.convertHtmlString=function(e){var t;return typeof e=="string"?((t=document.createElement("div")).innerHTML=e,t):e},n.parseWithFilter=function(e,t,r,i){var o=this;if(t===void 0&&(t=function(h){return!0}),r===void 0&&(r=function(h){return h}),i===void 0&&(i=function(){return document.createElement("div")}),typeof e=="string"){var l=new DOMParser().parseFromString(e,"text/html").body;if(l.children.length==0)return r(l.innerHTML);var a,l=l.children.length==1&&l.childNodes.length==1?l.children[0]:(a=i(),Array.from(l.childNodes).map(function(h){return a.append(h)}),a)}else l=e;return Array.from(l.children).forEach(function(h){return o.parseWithFilter(h,t,r)}),t(l)?r(l):(l.parentNode&&l.parentNode.removeChild(l),null)},n}(),tye=Yl,nye=k5;function rye(n){return tye(n)&&n.nodeType===1&&!nye(n)}var D6=ih(rye),iye=window&&window.__extends||function(){var n=function(e,t){return(n=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(r,i){r.__proto__=i}:function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])}))(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),W_=function(n){function e(){var t=n!==null&&n.apply(this,arguments)||this;return t.anchor="none",t.draggable=!1,t.closeButton=!0,t.content=document.createElement("span"),t.fillColor="#FFFFFF",t.pixelOffset=new Go(0,0),t.position=new $o(0,0),t.showPointer=!0,t}return iye(e,n),e._cloneCustomizer=function(t){if(D6(t))return t},e}(ii),oye=window&&window.__extends||function(){var n=function(e,t){return(n=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(r,i){r.__proto__=i}:function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])}))(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),fw=window&&window.__read||function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var r,i,o=t.call(n),a=[];try{for(;(e===void 0||0<e--)&&!(r=o.next()).done;)a.push(r.value)}catch(l){i={error:l}}finally{try{r&&!r.done&&(t=o.return)&&t.call(o)}finally{if(i)throw i.error}}return a},pw=function(n){function e(t){var r=n.call(this)||this;return r.attach=function(i){r.map!==i&&(r.map&&r.remove(),r.map=i,r.marker=r._createMarker(r.options),r.marker.addTo(r.map._getMap()),r.map.popups._getCollectionDiv().appendChild(r.containerDiv),r.map.popups.add(r))},r.open=function(i){if(!i&&!r.map)throw new Error("Must specify a map to open on or attach to a map in advance");r.attach(i||r.map),r.containerDiv.classList.remove(e.Css.hidden),r.map.events.add("move",r._onMove),r._onMove(),r._invokeEvent("open",{target:r,type:"open"})},r.close=function(){r.map&&r.map.events.remove("move",r._onMove),r.containerDiv.classList.add(e.Css.hidden),r._invokeEvent("close",{target:r,type:"close"})},r.remove=function(){r.map&&(r.marker.remove(),r.containerDiv.classList.remove(r.autoAnchor||r.options.anchor),r.map.events.remove("move",r._onMove),r.map.popups.remove(r),delete r.map,delete r.marker,delete r.autoAnchor)},r.isOpen=function(){return r.map&&!r.containerDiv.classList.contains(e.Css.hidden)},r._onMove=function(){var i=r._getAutoAnchor(r.map,r.options);i!==r.autoAnchor&&(r._replaceMarker(r.map,r.options,i),r.map.events.add("move",r._onMove))},r._onDown=function(i){r.map.popups._addDraggedPopup(r);var o=fw(r.map.positionsToPixels([r.options.position]),1)[0];i.type==="mousedown"?r.dragOffset=[o[0]-i.clientX,o[1]-i.clientY]:i.type==="touchstart"&&(r.dragOffset=[o[0]-i.touches[0].clientX,o[1]-i.touches[0].clientY])},r._onDragStart=function(i){i.preventDefault()},r.options=new W_().merge(Cr(t,W_._cloneCustomizer)),r.containerDiv=r._createContainerDiv(r.options),r.contentDiv=r._createContentDiv(r.options),r.containerDiv.appendChild(r.contentDiv),r.options.showPointer&&(r.arrowDiv=r._createArrowDiv(),r.containerDiv.appendChild(r.arrowDiv)),r.options.closeButton&&(r.closeBtn=r._createCloseButton(),r.contentDiv.appendChild(r.closeBtn),t=ko("close"),r.contentDiv.appendChild(t),Ti(t,r.closeBtn,!0)),r}return oye(e,n),e.prototype.setPopupOptions=function(t){this.setOptions(t)},e.prototype.setOptions=function(i){var r,i=new W_().merge(this.options,Cr(i,W_._cloneCustomizer));i.content!==this.options.content?(this.htmlContent.remove(),this.htmlContent=this._createHtmlContent(i),this.contentDiv.prepend(this.htmlContent)):i.draggable!==this.options.draggable&&this._setDraggable(this.htmlContent,i.draggable),i.closeButton&&!this.closeBtn?(this.closeBtn=this._createCloseButton(),this.contentDiv.appendChild(this.closeBtn),r=ko("close"),this.contentDiv.appendChild(r),Ti(r,this.closeBtn,!0)):!i.closeButton&&this.closeBtn&&(this.contentDiv.removeChild(this.closeBtn),delete this.closeBtn),i.showPointer&&!this.arrowDiv?(this.arrowDiv=this._createArrowDiv(),this.containerDiv.appendChild(this.arrowDiv)):!i.showPointer&&this.arrowDiv&&(this.containerDiv.removeChild(this.arrowDiv),delete this.arrowDiv),i.fillColor!==this.options.fillColor&&(this.containerDiv.style.borderColor=i.fillColor,this.contentDiv.style.backgroundColor=i.fillColor),this.marker&&(i.anchor!==this.options.anchor?this.options.anchor==="none"?(this.autoAnchor!==i.anchor&&this._replaceMarker(this.map,i),this.map.events.remove("move",this._onMove),delete this.autoAnchor):(this._replaceMarker(this.map,i),i.anchor==="none"&&this.map.events.add("move",this._onMove)):(Ea(i.position,this.options.position)||this.marker.setLngLat(i.position),Ea(i.pixelOffset,this.options.pixelOffset)||this.marker.setOffset(i.pixelOffset))),this.options=i},e.prototype.getPopupOptions=function(){return this.getOptions()},e.prototype.getOptions=function(){return Cr(this.options,W_._cloneCustomizer)},e.prototype.getPopupContainer=function(){return this.containerDiv},e.prototype._dragToPixel=function(t){this.dragging||(this.dragging=!0,this.contentDiv.style.pointerEvents="none",this._invokeEvent("dragstart",{type:"dragstart",target:this})),t=[t[0]+this.dragOffset[0],t[1]+this.dragOffset[1]],t=fw(this.map.pixelsToPositions([t]),1)[0],this.options.position=t,this.marker.setLngLat(this.options.position),this._invokeEvent("drag",{type:"drag",target:this})},e.prototype._onUp=function(){this.dragging&&(this.contentDiv.style.pointerEvents="",this._invokeEvent("dragend",{type:"dragend",target:this}),this.options.anchor==="none")&&this._onMove(),delete this.dragOffset,delete this.dragging},e.prototype._createContainerDiv=function(t){var r=this,i=document.createElement("div"),o=(i.classList.add(e.Css.container),i.classList.add(e.Css.hidden),i.style.borderColor=t.fillColor,i.setAttribute("role","dialog"),i.setAttribute("aria-label","Map Information Window"),!1);return i.addEventListener("keydown",function(a){a.key!=="Tab"&&a.key!=="Escape"&&a.key!=="Esc"||(o=!0)}),i.addEventListener("keyup",function(a){a.key!=="Tab"&&a.key!=="Escape"&&a.key!=="Esc"||(o=!1)}),i.addEventListener("focusin",function(a){r.map&&!r.isOpen()&&(r.open(r.map),a.target instanceof HTMLElement)&&a.target.focus()}),i.addEventListener("focusout",function(a){o&&a.relatedTarget instanceof Node&&!i.contains(a.relatedTarget)&&(o=!1,r.isOpen())&&r.close()}),i},e.prototype._createContentDiv=function(t){var r=document.createElement("div");return r.classList.add(e.Css.content),r.style.backgroundColor=t.fillColor,r.setAttribute("tabindex","0"),this.htmlContent=this._createHtmlContent(t),r.appendChild(this.htmlContent),r},e.prototype._createArrowDiv=function(){var t=document.createElement("div");return t.classList.add(e.Css.arrow),t},e.prototype._createCloseButton=function(){var t=document.createElement("button");return t.addEventListener("click",this.close),t.classList.add(e.Css.close),t.setAttribute("aria-label","close"),t.setAttribute("type","button"),t.setAttribute("tabindex","0"),t.innerHTML="&times;",t},e.prototype._createHtmlContent=function(t){var r=dw.convertHtmlString(t.content);return t.draggable&&this._setDraggable(r,t.draggable),r},e.prototype._createMarker=function(t,o){var i=this.marker?this.marker.getLngLat():t.position,o=(t.anchor==="none"?(this.autoAnchor=o||"bottom",this.containerDiv.classList.add(this.autoAnchor),new wa.Marker({anchor:this.autoAnchor,element:this.containerDiv,offset:t.pixelOffset})):(this.containerDiv.classList.add(t.anchor),new wa.Marker({anchor:t.anchor,element:this.containerDiv,offset:t.pixelOffset}))).setLngLat(i);return o},e.prototype._getAutoAnchor=function(t,r){var i,o,a=this.containerDiv.offsetWidth,l=this.containerDiv.offsetHeight,h=[];return(o=this.marker?(i=(o=t._getMap().project(this.marker.getLngLat())).x,o.y):(o=fw(t.positionsToPixels([r.position]),1),i=(r=fw(o[0],2))[0],r[1]))<l?h.push("top"):o>t.getCanvas().offsetHeight-l&&h.push("bottom"),i<a/2?h.push("left"):i>t.getCanvas().offsetWidth-a/2&&h.push("right"),0<h.length?h.join("-"):"bottom"},e.prototype._replaceMarker=function(t,r,i){var o=this.containerDiv.nextElementSibling;this.marker.remove(),this.containerDiv.classList.remove(this.autoAnchor||this.options.anchor),this.marker=this._createMarker(r,i),this.marker.addTo(t._getMap()),t.popups._getCollectionDiv().insertBefore(this.containerDiv,o||null)},e.prototype._setDraggable=function(t,r){r?(t.addEventListener("mousedown",this._onDown),t.addEventListener("touchstart",this._onDown),t.addEventListener("dragstart",this._onDragStart)):(t.removeEventListener("mousedown",this._onDown),t.removeEventListener("touchstart",this._onDown),t.removeEventListener("dragstart",this._onDragStart))},e.Css={arrow:"popup-arrow",close:"popup-close",container:"popup-container",content:"popup-content-container",hidden:"hidden-accessible-element"},e}(Wl),aye=window&&window.__extends||function(){var n=function(e,t){return(n=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(r,i){r.__proto__=i}:function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])}))(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),Y_=function(n){function e(){var t=n!==null&&n.apply(this,arguments)||this;return t.anchor="bottom",t.color="#1A73AA",t.draggable=!1,t.htmlContent='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24.5 36.5" id="marker_'.concat(Vd(),'" width="24.5" height="36.5" display="block"><path d="M12.25.25a12.2543,12.2543,0,0,0-12,12.4937c0,6.4436,6.4879,12.1093,11.059,22.5641.5493,1.2563,1.3327,1.2563,1.882,0C17.7621,24.8529,24.25,19.1857,24.25,12.7437A12.2543,12.2543,0,0,0,12.25.25Z"   fill="{color}" stroke="{secondaryColor}" stroke-width="0.5"/><text style="font-family: Arial, Helvetica, sans-serif; font-size: 14px; fill: white;" text-anchor="middle" x="12" y="18">{text}</text></svg>'),t.pixelOffset=new Go(0,0),t.position=new $o(0,0),t.popup=void 0,t.secondaryColor="white",t.text=void 0,t.visible=!0,t}return aye(e,n),e._cloneCustomizer=function(t){if(t instanceof pw||D6(t))return t},e}(ii),sye=window&&window.__extends||function(){var n=function(e,t){return(n=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(r,i){r.__proto__=i}:function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])}))(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),p2=function(n){function e(t){var r=n.call(this)||this;return r._onDrag=function(){var i=r.marker.getLngLat().wrap();r.options.position=new $o(i.lng,i.lat),r._invokeEvent("drag",{type:"drag",target:r})},r._onDragStart=function(){r._invokeEvent("dragstart",{type:"dragstart",target:r})},r._onDragEnd=function(){r._invokeEvent("dragend",{type:"dragend",target:r})},r._bubbleElementEvent=function(i){r._invokeEvent(i.type,{type:i.type,target:r})},r._onEleDragStart=function(i){i.preventDefault()},r.options=new Y_().merge(Cr(t,Y_._cloneCustomizer)),r._buildMarker(r.options),r}return sye(e,n),e.prototype.getOptions=function(){return Cr(this.options,Y_._cloneCustomizer)},e.prototype.getElement=function(){return this.marker.getElement()},e.prototype.setOptions=function(t){t=new Y_().merge(this.options,Cr(t,Y_._cloneCustomizer)),Ea(t.htmlContent,this.options.htmlContent)&&t.anchor===this.options.anchor?(typeof t.htmlContent!="string"||t.color===this.options.color&&t.text===this.options.text&&t.secondaryColor===this.options.secondaryColor||(this.element.innerHTML=this._getSubbedHtmlString(t)||""),t.draggable!==this.options.draggable&&(this._setDraggable(t.draggable),this.marker.setDraggable(t.draggable)),Ea(t.pixelOffset,this.options.pixelOffset)||this.marker.setOffset(t.pixelOffset),Ea(t.position,this.options.position)||this.marker.setLngLat(t.position),t.visible!==this.options.visible&&(t.visible?this.element.classList.remove(e.hiddenClass):this.element.classList.add(e.hiddenClass))):(this.marker.remove(),this._buildMarker(t),this.map&&(this.marker.addTo(this.map._getMap()),this._getCollectionContainer().appendChild(this.element))),this.options=t},e.prototype.togglePopup=function(){if(this.options.popup)if(this.options.popup.isOpen())this.options.popup.close();else{if(!this.map)throw new Error("The marker must be added to a map before calling togglePopup().");this.options.popup.setOptions({position:this.options.position}),this.options.popup.open(this.map)}},e.prototype._addToMap=function(t,r){this.map&&this.map!==t&&this._removeFromMap(),r&&(this.options.position=Zi(r),this.marker.setLngLat(this.options.position)),this.map!==t&&(this.map=t,this.marker.addTo(t._getMap()),this._getCollectionContainer().appendChild(this.element))},e.prototype._removeFromMap=function(){this.map&&(this.marker.remove(),delete this.map)},e.prototype._getId=function(){if(this.element)return(typeof this.options.htmlContent=="string"?this.element.firstChild:this.element).id},e.prototype._buildMarker=function(t){var r;typeof t.htmlContent=="string"?(r=this._getSubbedHtmlString(t)||"",this.element=dw.convertHtmlString(r)):this.element=t.htmlContent,this.element.classList.add(e.containerClass),t.draggable&&this._setDraggable(!0),t.visible||this.element.classList.add(e.hiddenClass),this.marker=new wa.Marker({element:this.element,offset:t.pixelOffset,draggable:t.draggable,anchor:t.anchor}).setLngLat(t.position),this.marker.on("drag",this._onDrag),this.marker.on("dragstart",this._onDragStart),this.marker.on("dragend",this._onDragEnd),this.element.addEventListener("click",this._bubbleElementEvent),this.element.addEventListener("dblclick",this._bubbleElementEvent),this.element.addEventListener("contextmenu",this._bubbleElementEvent),this.element.addEventListener("keydown",this._bubbleElementEvent),this.element.addEventListener("keypress",this._bubbleElementEvent),this.element.addEventListener("keyup",this._bubbleElementEvent),this.element.addEventListener("mousedown",this._bubbleElementEvent),this.element.addEventListener("mouseenter",this._bubbleElementEvent),this.element.addEventListener("mouseleave",this._bubbleElementEvent),this.element.addEventListener("mousemove",this._bubbleElementEvent),this.element.addEventListener("mouseout",this._bubbleElementEvent),this.element.addEventListener("mouseover",this._bubbleElementEvent),this.element.addEventListener("mouseup",this._bubbleElementEvent)},e.prototype._getSubbedHtmlString=function(t){return typeof t.htmlContent=="string"?t.htmlContent.replace(/{color}/gi,t.color||"").replace(/{secondaryColor}/gi,t.secondaryColor||"").replace(/{text}/gi,t.text||""):null},e.prototype._getCollectionContainer=function(){var t=this.map.getCanvasContainer().querySelector(".".concat(e.collectionContainerClass));return t||((t=document.createElement("div")).classList.add(e.collectionContainerClass),this.map.getCanvasContainer().appendChild(t)),t},e.prototype._setDraggable=function(t){t?this.element.addEventListener("dragstart",this._onEleDragStart):this.element.removeEventListener("dragstart",this._onEleDragStart)},e.collectionContainerClass="marker-collection-container",e.hiddenClass="hidden-accessible-element",e.containerClass="marker-container",e}(Wl),cye=function(){function n(){}return n.getHighContrastMode=function(){return matchMedia("(-ms-high-contrast: white-on-black)").matches?"dark":matchMedia("(-ms-high-contrast: black-on-white)").matches?"light":matchMedia("(-ms-high-contrast: active)").matches?"dark":matchMedia("(inverted-colors: inverted)").matches?"invert":null},n}();function Zl(n,e){return n||e}function qa(n,e){return n[e]}var g2,$a=void 0,Sa=null,m2="",gw="function",K_="object",Xl="prototype",y2="__proto__",Xd="undefined",mw="constructor",_2="Symbol",lye="_polyfill",vg="length",yw="name",Wo="call",_w="toString",bc=Zl(Object),v2=qa(bc,Xl),F6=Zl(String),Qd=qa(F6,Xl),uye=Zl(Math),B6=Zl(Array),vw=qa(B6,Xl),Ql=qa(vw,"slice");function Oo(n,e){try{return{v:n.apply(this,e)}}catch(t){return{e:t}}}function hye(n,e){return n=Oo(n),n.e?e:n.v}function bw(n){return function(e){return typeof e===n}}function U6(n){var e="[object "+n+"]";return function(t){return!(!t||dye(t)!==e)}}function dye(n){return v2[_w].call(n)}function Ii(n){return typeof n===Xd||n===Xd}function bt(n){return n===Sa||Ii(n)}function fye(n){return n===Sa||!z6(n)}function z6(n){return!!n||n!==$a}function pye(n){return g2=g2||["string","number","boolean",Xd,"symbol","bigint"],n!==K_&&g2.indexOf(n)!==-1}var Pn=bw("string"),Gn=bw(gw);function Wa(n){return!(!n&&bt(n)||!n||typeof n!==K_)}var hr=qa(B6,"isArray"),gye=U6("Date"),Z_=bw("number"),j6=bw("boolean"),b2=U6("Error");function Jd(n){return!!(n&&n.then&&Gn(n.then))}function ww(n){return!(!n||hye(function(){return!(n&&0+n)},!n))}var w2=qa(bc,"getOwnPropertyDescriptor");function Hs(n,e){return!!n&&v2.hasOwnProperty[Wo](n,e)}var hh=Zl(qa(bc,"hasOwn"),mye);function mye(n,e){return Hs(n,e)||!!w2(n,e)}function dr(n,e,t){if(n&&Wa(n)){for(var r in n)if(hh(n,r)&&e[Wo](t||n,r,n[r])===-1)break}}var xw={e:"enumerable",c:"configurable",v:"value",w:"writable",g:"get",s:"set"};function yye(n){var e,t={};return t[xw.c]=!0,t[xw.e]=!0,n.l&&(t.get=function(){return n.l.v},e=w2(n.l,"v"))&&e.set&&(t.set=function(r){n.l.v=r}),dr(n,function(r,i){t[xw[r]]=Ii(i)?t[xw[r]]:i}),t}var Jl=qa(bc,"defineProperty");function Pr(n,e,t){return Jl(n,e,yye(t))}function V6(n,e,t,r,i){var o={};return dr(n,function(a,l){Ew(o,a,e?l:a,i),Ew(o,l,t?l:a,i)}),r?r(o):o}function Ew(n,e,t,r){Jl(n,e,{value:t,enumerable:!0,writable:!!r})}var Ya=Zl(F6),_ye="[object Error]";function rn(n,e){var t=m2,r=v2[_w][Wo](n);r===_ye&&(n={stack:Ya(n.stack),message:Ya(n.message),name:Ya(n.name)});try{t=(t=JSON.stringify(n,Sa,e?typeof e=="number"?e:4:$a))&&t.replace(/"(\w+)"\s*:\s{0,1}/g,"$1: ")||Ya(n)}catch(i){t=" - "+rn(i,e)}return r+": "+t}function Ts(n){throw new Error(n)}function wc(n){throw new TypeError(n)}var H6=qa(bc,"freeze");function vye(n){return n}function bye(n){return n[y2]||Sa}var x2=qa(bc,"assign"),eu=qa(bc,"keys");function bg(n){return H6&&dr(n,function(e,t){(hr(t)||Wa(t))&&bg(t)}),tu(n)}var tu=Zl(H6,vye),E2=Zl(qa(bc,"getPrototypeOf"),bye);function wye(n){return V6(n,1,0,tu)}function xye(n){return V6(n,0,0,tu)}function Eye(n){var e={};return dr(n,function(t,r){Ew(e,t,r[1]),Ew(e,r[0],r[1])}),tu(e)}function Tye(n){return Eye(n)}var T2,G6=xye({asyncIterator:0,hasInstance:1,isConcatSpreadable:2,iterator:3,match:4,matchAll:5,replace:6,search:7,species:8,split:9,toPrimitive:10,toStringTag:11,unscopables:12}),q6="__tsUtils$gblCfg";function $6(){var n;return n=(n=(n=(n=typeof globalThis!==Xd?globalThis:n)||typeof self===Xd?n:self)||typeof window===Xd?n:window)||typeof global===Xd?n:global}function W6(){var n;return T2||(n=Oo($6).v||{},T2=n[q6]=n[q6]||{}),T2}function Qc(n,e,t){var r=e&&e[n];return function(i){var o,a=i&&i[n]||r;if(a||t)return o=arguments,(a||t).apply(i,a?Ql[Wo](o,1):o);wc('"'+Ya(n)+'" not defined for '+rn(i))}}function Sye(n){return function(e){return e[n]}}var Cye=qa(uye,"max"),Y6=Qc("slice",Qd),Jc=Qc("substring",Qd),dh=Qc("substr",Qd,Aye);function Aye(n,e,t){return bt(n)&&wc("Invalid "+rn(n)),t<0?m2:((e=e||0)<0&&(e=Cye(e+n[vg],0)),Ii(t)?Y6(n,e):Y6(n,e,e+t))}function S2(n,e){return Jc(n,0,e)}var C2,Tw,uo,K6="_urid";function Iye(){var n;return C2||(n=W6(),C2=n.gblSym=n.gblSym||{k:{},s:{}}),C2}function A2(n){var e={description:Ya(n),toString:function(){return _2+"("+n+")"}};return e[lye]=!0,e}function Pye(n){var e,t,r=Iye();return hh(r.k,n)||(e=A2(n),t=eu(r.s).length,e[K6]=function(){return t+"_"+e[_w]()},r.k[n]=e,r.s[e[K6]()]=Ya(n)),r.k[n]}function Mye(t){Tw=Tw||{};var e,t=G6[t];return e=t?Tw[t]=Tw[t]||A2(_2+"."+t):e}function fh(){uo=W6()}function Rye(n){var e={};return uo||fh(),e.b=uo.lzy,Jl(e,"v",{configurable:!0,get:function(){var t=n();return uo.lzy||Jl(e,"v",{value:t}),e.b=uo.lzy,t}}),e}function Gs(n){return Jl({toJSON:function(){return n}},"v",{value:n})}var X_,Z6="window";function wg(n,e){var t;return function(){return uo||fh(),(t=t&&!uo.lzy?t:Gs(Oo(n,e).v)).v}}function qs(n){return uo||fh(),(X_=X_&&n!==!1&&!uo.lzy?X_:Gs(Oo($6).v||Sa)).v}function Fi(n,e){return e=X_&&e!==!1?X_.v:qs(e),e&&e[n]?e[n]:n===Z6?Ka():Sa}function X6(){return!!ca()}var ca=wg(Fi,["document"]);function Sw(){return!!Ka()}var Ka=wg(Fi,[Z6]);function kye(){return!!el()}var el=wg(Fi,["navigator"]);function Oye(){return!!J6()}var Q_,Q6,I2,J6=wg(Fi,["history"]),Lye=wg(function(){return!!Oo(function(){return process&&(process.versions||{}).node}).v}),eB=wg(function(){return!!Oo(function(){return self&&self instanceof WorkerGlobalScope}).v});function Cw(){return Q_=Gs(Oo(Fi,[_2]).v)}function Nye(n){var e=(uo.lzy?0:Q_)||Cw();return e.v?e.v[n]:$a}function Dye(){return!!Fye()}function Fye(){return uo||fh(),((uo.lzy?0:Q_)||Cw()).v}function P2(n,e){var t=G6[n],r=(uo||fh(),(uo.lzy?0:Q_)||Cw());return r.v?r.v[t||n]:e?$a:Mye(n)}function J_(n,e){uo||fh();var t=(uo.lzy?0:Q_)||Cw();return t.v?t.v(n):e?Sa:A2(n)}function M2(n){return uo||fh(),((Q6=(uo.lzy?0:Q6)||Gs(Oo(Nye,["for"]).v)).v||Pye)(n)}function R2(n){return!!n&&Gn(n.next)}function tB(n){return!fye(n)&&Gn(n[P2(3)])}function k2(n,e,t){if(n&&(R2(n)||(n=n[(I2=I2||Gs(P2(3))).v]?n[I2.v]():null),R2(n))){var r=$a,i=$a;try{for(var o=0;!(i=n.next()).done&&e[Wo](t||n,i.value,o,n)!==-1;)o++}catch(a){r={e:a},n.throw&&(i=Sa,n.throw(r))}finally{try{i&&!i.done&&n.return&&n.return(i)}finally{if(r)throw r.e}}}}function xg(n,e,t){return n.apply(e,t)}function Eg(n,e){return!Ii(e)&&n&&(hr(e)?xg(n.push,n,e):R2(e)||tB(e)?k2(e,function(t){n.push(t)}):n.push(e)),n}function on(n,e,t){if(n)for(var r=n[vg]>>>0,i=0;i<r&&!(i in n&&e[Wo](t||n,n[i],i,n)===-1);i++);}var la=Qc("indexOf",vw),ev=Qc("map",vw);function Aw(n,e,t){return(n&&n.slice||Ql).apply(n,Ql[Wo](arguments,1))}var nB,rB,Bye=Qc("reduce",vw),ph=Zl(qa(bc,"create"),Uye);function Uye(n){var e;return n?((e=typeof n)!==K_&&e!==gw&&wc("Prototype must be an Object or function: "+rn(n)),t[Xl]=n,new t):{};function t(){}}function iB(n,e){return(bc.setPrototypeOf||function(t,r){var i;(nB=nB||Gs(((i={})[y2]=[],i instanceof Array))).v?t[y2]=r:dr(r,function(o,a){return t[o]=a})})(n,e)}function zye(n,e,t){function r(){this[mw]=e,Oo(Pr,[this,yw,{v:n,c:!0,e:!1}])}return Oo(Pr,[e,yw,{v:n,c:!0,e:!1}]),(e=iB(e,t))[Xl]=t===Sa?ph(t):(r[Xl]=t[Xl],new r),e}function oB(n,e){e&&(n[yw]=e)}function aB(n,e,t){var r=t||Error,i=r[Xl][yw],o=Error.captureStackTrace;return zye(n,function(){var a=arguments;try{Oo(oB,[r,n]);var l,h=xg(r,this,Ql[Wo](a))||this;return h!==this&&(l=E2(this))!==E2(h)&&iB(h,l),o&&o(h,this[mw]),e&&e(h,a),h}finally{Oo(oB,[r,i])}},r)}function jye(n){throw new(rB=rB||aB("UnsupportedError"))(n)}function tl(){return(Date.now||Vye)()}function Vye(){return new Date().getTime()}function Hye(n){return function(e){return bt(e)&&wc("strTrim called ["+rn(e)+"]"),e=e&&e.replace?e.replace(n,m2):e}}var O2,L2,sB,Gye=Hye(/^\s+|(?=\s)\s+$/g),ho=Qc("trim",Qd,Gye);function Ca(n){if(!n||typeof n!==K_)return!1;var e=!1;if(n!==(sB=sB||!Sw()||Ka())){L2||(O2=Function[Xl][_w],L2=O2[Wo](bc));try{var t=E2(n);e=(e=!t)||(t=Hs(t,mw)?t[mw]:t)&&typeof t===gw&&O2[Wo](t)===L2}catch{}}return e}function qye(n){return n.value&&uB(n),!0}var cB=[Kye,uB,Xye,Zye];function $ye(n,e,t,r){var i;return on(n,function(o){if(o.k===e)return i=o,-1}),i||(i={k:e,v:e},n.push(i),r(i)),i.v}function N2(n,e,t,o){var i=t.handler,o=t.path?o?t.path.concat(o):t.path:[],a={handler:t.handler,src:t.src,path:o},l=typeof e,h=!1,p=!1,g=(e&&l===K_?h=Ca(e):p=e===Sa||pye(l),{type:l,isPrim:p,isPlain:h,value:e,result:e,path:o,origin:t.src,copy:function(_,x){return N2(n,_,x?a:t,x)},copyTo:function(_,x){return lB(n,_,x,a)}});return g.isPrim?i&&i[Wo](t,g)?g.result:e:$ye(n,e,o,function(_){Pr(g,"result",{g:function(){return _.v},s:function(M){_.v=M}});for(var x=0,C=i;!(C||(x<cB.length?cB[x++]:qye))[Wo](t,g);)C=Sa})}function lB(n,e,t,r){if(!bt(t))for(var i in t)e[i]=N2(n,t[i],r,i);return e}function Wye(n,e,t){return lB([],n,e,{handler:t,src:e,path:[]})}function Yye(n,e){return N2([],n,{handler:e,src:n})}function Kye(n){var e,t=n.value;return!!hr(t)&&((e=n.result=[]).length=t.length,n.copyTo(e,t),!0)}function Zye(n){var e=n.value;return!!gye(e)&&(n.result=new Date(e.getTime()),!0)}function Xye(n){return n.type===gw}function uB(n){var e,t=n.value;return!(!t||!n.isPlain||(e=n.result={},n.copyTo(e,t),0))}function hB(n,e){return on(e,function(t){Wye(n,t)}),n}function dB(n,e,t,r,i,o,a){return hB(Yye(n)||{},Ql[Wo](arguments))}function Qye(n,e,t,r,i,o,a){return hB(n||{},Ql[Wo](arguments))}var D2,Jye=Sye(vg);function nu(){return uo||fh(),(D2=D2&&!uo.lzy?D2:Gs(Oo(Fi,["performance"]).v)).v}var fB=Qc("split",Qd);function pB(n,e,t){var r;n&&e&&(r=(e=fB(e,".")).pop(),on(e,function(i){bt(n[i])&&(n[i]={}),n=n[i]}),n[r]=t)}var gB=Qc("endsWith",Qd,e_e);function e_e(n,e,t){return Pn(n)||wc("'"+rn(n)+"' is not a string"),e=Pn(e)?e:Ya(e),t=!Ii(t)&&t<n[vg]?t:n[vg],Jc(n,t-e[vg],t)===e}var Za=Qc("indexOf",Qd),F2="ref",B2="unref",U2="hasRef",t_e="enabled";function n_e(n,e,t){var r,i=!0,o=n?e(Sa):Sa;function a(){return i=!1,o&&o[B2]&&o[B2](),r}function l(){o&&t(o),o=Sa}function h(){return o=e(o),i||a(),r}return(r={cancel:l,refresh:h})[U2]=function(){return o&&o[U2]?o[U2]():i},r[F2]=function(){return i=!0,o&&o[F2]&&o[F2](),r},r[B2]=a,{h:r=Jl(r,t_e,{get:function(){return!!o},set:function(p){!p&&o&&l(),p&&!o&&h()}}),dn:function(){o=Sa}}}function mB(n,e,t){var r=hr(e),i=r?e.length:0,o=(0<i?e[0]:r?$a:e)||setTimeout,a=(1<i?e[1]:$a)||clearTimeout,l=t[0],h=(t[0]=function(){h.dn(),xg(l,$a,Ql[Wo](arguments))},n_e(n,function(p){if(p){if(p.refresh)return p.refresh(),p;xg(a,$a,[p])}return xg(o,$a,t)},function(p){xg(a,$a,[p])}));return h.h}function $s(n,e){return mB(!0,$a,Ql[Wo](arguments))}function r_e(n,e){return mB(!1,$a,Ql[Wo](arguments))}var z2,yB=wye,i_e=Tye,gh=yB({NONE:0,PENDING:3,INACTIVE:1,ACTIVE:2}),Tg="toLowerCase",Iw="blkVal",Un="length",Pw="rdOnly",Mw="notify",Rw="warnToConsole",tv="throwInternal",Sg="setDf",ef="watch",Xi="logger",tf="apply",Ur="push",Cg="splice",_B="hdlr",Ag="cancel",nv="initialize",mh="identifier",kw="removeNotificationListener",Ow="addNotificationListener",nl="isInitialized",vB="instrumentationKey",j2="INACTIVE",rv="value",Lw="getNotifyMgr",iv="getPlugin",ru="name",ov="iKey",Ig="time",Aa="processNext",bB="getProcessTelContext",wB="pollInternalLogs",Pg="enabled",xB="stopPollingInternalLogs",yh="unload",Nw="onComplete",Dw="version",EB="loggingLevelConsole",nf="createNew",iu="teardown",Fw="messageId",rf="message",Mg="isAsync",_h="diagLog",Bw="_doTeardown",av="update",rl="getNext",sv="setNextPlugin",TB="protocol",V2="userAgent",Rg="split",H2="nodeType",of="replace",SB="logInternalMessage",ou="type",G2="handler",cv="status",CB="getResponseHeader",AB="getAllResponseHeaders",q2="isChildEvt",kg="data",Og="getCtx",il="setCtx",$2="complete",IB="itemsReceived",lv="urlString",PB="sendPOST",W2="headers",Lg="timeout",MB="setRequestHeader",Y2="traceId",K2="spanId",Z2="traceFlags";function o_e(n,e){z2=z2||aB("AggregationError",function(r,i){1<i[Un]&&(r.errors=i[1])});var t=n||"One or more errors occurred.";throw on(e,function(r,i){t+=`
`.concat(i," > ").concat(rn(r))}),new z2(t,e||[])}var X2,RB="function",kB="object",Q2="undefined",ol="prototype",J2=Object,a_e=J2[ol],OB=((qs()||{}).Symbol,(qs()||{}).Reflect,"hasOwnProperty"),s_e=function(n){for(var e,t=1,r=arguments.length;t<r;t++)for(var i in e=arguments[t])a_e[OB].call(e,i)&&(n[i]=e[i]);return n},Ia=x2||s_e,LB=function(n,e){return(LB=J2.setPrototypeOf||({__proto__:[]}instanceof Array?function(t,r){t.__proto__=r}:function(t,r){for(var i in r)r[OB](i)&&(t[i]=r[i])}))(n,e)};function au(n,e){function t(){this.constructor=n}typeof e!==RB&&e!==null&&wc("Class extends value "+String(e)+" is not a constructor or null"),LB(n,e),n[ol]=e===null?ph(e):(t[ol]=e[ol],new t)}function NB(n,e){for(var t=0,r=e.length,i=n.length;t<r;t++,i++)n[i]=e[t];return n}var Uw="constructor",su="prototype",zw="function",jw="_dynInstFuncs",eI="_isDynProxy",Ng="_dynClass",c_e="_dynCls$",tI="_dynInstChk",uv=tI,DB="_dfOpts",FB="_unknown_",nI="__proto__",Vw="_dyn"+nI,BB="__dynProto$Gbl",rI="_dynInstProto",Hw="useBaseInst",iI="setInstFuncs",oI=Object,hv=oI.getPrototypeOf,UB=oI.getOwnPropertyNames,zB=qs(),aI=zB[BB]||(zB[BB]={o:((X2={})[iI]=!0,X2[Hw]=!0,X2),n:1e3});function Gw(n){return n&&(n===oI[su]||n===Array[su])}function sI(n){return Gw(n)||n===Function[su]}function af(n){if(n){if(hv)return hv(n);var e=n[nI]||n[su]||(n[Uw]?n[Uw][su]:null),t=n[Vw]||e;Hs(n,Vw)||(delete n[rI],t=n[Vw]=n[rI]||n[Vw],n[rI]=e)}return t}function qw(n,e){var t=[];if(UB)t=UB(n);else for(var r in n)typeof r=="string"&&Hs(n,r)&&t.push(r);if(t&&0<t.length)for(var i=0;i<t.length;i++)e(t[i])}function cI(n,e,t){return e!==Uw&&typeof n[e]===zw&&(t||Hs(n,e))&&e!==nI&&e!==su}function $w(n){wc("DynamicProto: "+n)}function l_e(n){var e=ph(null);return qw(n,function(t){!e[t]&&cI(n,t,!1)&&(e[t]=n[t])}),e}function lI(n,e){for(var t=n.length-1;0<=t;t--)if(n[t]===e)return!0;return!1}function u_e(n,e,t,r){function i(h,p,g){var _,x=p[g];return x[eI]&&r&&(_=h[jw]||{})[uv]!==!1&&(x=(_[p[Ng]]||{})[g]||x),function(){return x.apply(h,arguments)}}for(var o=ph(null),a=(qw(t,function(h){o[h]=i(e,t,h)}),af(n)),l=[];a&&!sI(a)&&!lI(l,a);)qw(a,function(h){!o[h]&&cI(a,h,!hv)&&(o[h]=i(e,a,h))}),l.push(a),a=af(a);return o}function h_e(n,e,t,r){var i=null;if(n&&Hs(t,Ng)){var o=n[jw]||ph(null);if((i=(o[t[Ng]]||ph(null))[e])||$w("Missing ["+e+"] "+zw),!i[tI]&&o[uv]!==!1){for(var a=!Hs(n,e),l=af(n),h=[];a&&l&&!sI(l)&&!lI(h,l);){var p=l[e];if(p){a=p===r;break}h.push(l),l=af(l)}try{a&&(n[e]=i),i[tI]=1}catch{o[uv]=!1}}}return i}function d_e(n,e,t){var r=e[n];return typeof(r=r===t?af(e)[n]:r)!==zw&&$w("["+n+"] is not a "+zw),r}function f_e(n,e,t,r,i){var o,a;Gw(n)||Gw(o=t[jw]=t[jw]||ph(null))||(a=o[e]=o[e]||ph(null),o[uv]!==!1&&(o[uv]=!!i),Gw(a))||qw(t,function(l){function h(){return(h_e(this,g,p,h)||d_e(g,p,h)).apply(this,arguments)}var p,g;cI(t,l,!1)&&t[l]!==r[l]&&(a[l]=t[l],delete t[l],Hs(n,l)&&(!n[l]||n[l][eI])||(n[l]=(p=n,g=l,h[eI]=1,h)))})}function p_e(n,e){if(hv){for(var t=[],r=af(e);r&&!sI(r)&&!lI(t,r);){if(r===n)return!0;t.push(r),r=af(r)}return!1}return!0}function uI(n,e){return Hs(n,su)?n.name||e||FB:((n||{})[Uw]||{}).name||e||FB}function mi(a,e,p,r){Hs(a,su)||$w("theClass is an invalid class definition.");var i=a[su],o=(p_e(i,e)||$w("["+uI(a)+"] not in hierarchy of ["+uI(e)+"]"),null),a=(Hs(i,Ng)?o=i[Ng]:(o=c_e+uI(a,"_")+"$"+aI.n,aI.n++,i[Ng]=o),mi[DB]),l=!!a[Hw],h=(l&&r&&r[Hw]!==void 0&&(l=!!r[Hw]),l_e(e)),p=(p(e,u_e(i,e,h,l)),!!hv&&!!a[iI]);f_e(i,o,e,h,(p=p&&r?!!r[iI]:p)!==!1)}mi[DB]=aI.o;var Ww="Promise",hI="rejected";function cu(n,e){return jB(n,function(t){return e?e({status:"fulfilled",rejected:!1,value:t}):t},function(t){return e?e({status:hI,rejected:!0,reason:t}):t})}function jB(n,e,t,r){var i=n;try{if(Jd(n))(e||t)&&(i=n.then(e,t));else try{e&&(i=e(n))}catch(o){if(!t)throw o;i=t(o)}}finally{r&&g_e(i,r)}return i}function g_e(n,e){var t=n;return e&&(Jd(n)?t=n.finally?n.finally(e):n.then(function(r){return e(),r},function(r){throw e(),r}):e()),t}var dI,VB=["pending","resolving","resolved",hI],HB="dispatchEvent";function m_e(n){var e;return!!(e=n&&n.createEvent?n.createEvent("Event"):e)&&e.initEvent}function y_e(n,e,t,r){var i=ca(),i=(dI=dI||Gs(!!Oo(m_e,[i]).v)).v?i.createEvent("Event"):r?new Event(e):{};t&&t(i),dI.v&&i.initEvent(e,!1,!0),i&&n[HB]?n[HB](i):(r=n["on"+e])?r(i):(t=Fi("console"))&&(t.error||t.log)(e,rn(i))}var fI,GB,qB,$B,WB="unhandledRejection",__e=WB.toLowerCase(),v_e=10;function YB(n){return Gn(n)?n.toString():rn(n)}function b_e(n,e,t){var r,i,o=Aw(arguments,3),a=0,l=!1,h=[],p=!1,g=null;function _(z,ee){return p=!0,g&&g.cancel(),g=null,n(function(ce,se){h.push(function(){try{var _e=a===2?z:ee,J=Ii(_e)?r:Gn(_e)?_e(r):_e;Jd(J)?J.then(ce,se):(!_e&&a===3?se:ce)(J)}catch(pe){se(pe)}}),l&&C()},o)}function x(){return VB[a]}function C(){var z;0<h.length&&(z=h.slice(),h=[],p=!0,g&&g.cancel(),g=null,e(z))}function M(z,ee){return function(ce){a===ee&&(z===2&&Jd(ce)?(a=1,ce.then(M(2,1),M(3,1))):(a=z,l=!0,r=ce,C(),p||z!==3||(g=g||$s(L,v_e))))}}function L(){var z;p||(p=!0,Lye()?process.emit(WB,r,i):(z=Ka()||qs(),fI=fI||Gs(Oo(Fi,[Ww+"RejectionEvent"]).v),y_e(z,__e,function(ee){return Pr(ee,"promise",{g:function(){return i}}),ee.reason=r,ee},!!fI.v)))}Jl(i={then:_,catch:function(z){return _(void 0,z)},finally:function(z){var ee=z,ce=z;return Gn(z)&&(ee=function(se){return z&&z(),se},ce=function(se){throw z&&z(),se}),_(ee,ce)}},"state",{get:x}),Dye()&&(i[P2(11)]="IPromise"),i.toString=function(){return"IPromise "+x()+(l?" - "+YB(r):"")},Gn(t)||wc(Ww+": executor is not a function - "+YB(t));var F=M(3,0);try{t.call(i,M(2,0),F)}catch(z){F(z)}return i}function w_e(n){return function(e){var t=Aw(arguments,1);return n(function(r,i){try{var o=[],a=1;k2(e,function(l,h){l&&(a++,jB(l,function(p){o[h]=p,--a==0&&r(o)},i))}),--a===0&&r(o)}catch(l){i(l)}},t)}}function x_e(n){return Gs(function(e){var t=Aw(arguments,1);return n(function(r,i){var o=[],a=1;function l(h,p){a++,cu(h,function(g){g.rejected?o[p]={status:hI,reason:g.reason}:o[p]={status:"fulfilled",value:g.value},--a==0&&r(o)})}try{hr(e)?on(e,l):tB(e)?k2(e,l):wc("Input is not an iterable"),--a===0&&r(o)}catch(h){i(h)}},t)})}function E_e(n){on(n,function(e){try{e()}catch{}})}function T_e(n){var e=Z_(n)?n:0;return function(t){$s(function(){E_e(t)},e)}}function dv(n,e){return b_e(dv,T_e(e),n,e)}function S_e(n,e){var t=(GB=GB||Gs(Oo(Fi,[Ww]).v||null)).v;if(!t)return dv(n);Gn(n)||wc(Ww+": executor is not a function - "+rn(n));var r=0;return t=new t(function(i,o){n(function(a){r=2,i(a)},function(a){r=3,o(a)})}),Jl(t,"state",{get:function(){return VB[r]}}),t}function lu(n,e){return(qB=qB||Gs(S_e)).v.call(this,n,e)}var C_e=w_e(lu);function A_e(n,e){return($B=$B||x_e(lu)).v(n,e)}var al=void 0,br="",sf="channels",bo="core",pI="createPerfMgr",gI="disabled",Dg="extensionConfig",Fg="extensions",sl="processTelemetry",Yw="priority",Kw="eventsSent",fv="eventsDiscarded",Zw="eventsSendRequest",cf="perfEvent",mI="offlineEventsStored",yI="offlineBatchSent",_I="offlineBatchDrop",Xw="getPerfMgr",vI="domain",bI="path",I_e="Not dynamic - ",P_e="getPrototypeOf",M_e=/-([a-z])/g,R_e=/([^\w\d_$])/g,k_e=/^(\d+[\w\d_$])/,O_e=Object[P_e];function lf(n){return!bt(n)}function Qw(n){return n=n&&Pn(n)?(n=(n=n[of](M_e,function(e,t){return t.toUpperCase()}))[of](R_e,"_"))[of](k_e,function(e,t){return"_"+t}):n}function ua(n,e){return!(!n||!e)&&Za(n,e)!==-1}function Bg(n){return n&&n.toISOString()||""}function Dr(n){return b2(n)?n[ru]:br}function oi(n,e,t,r,i){var o=t;return!n||(o=n[e])===t||i&&!i(o)||r&&!r(t)||(n[e]=o=t),o}function Pa(n,e,t){var r;return n?!(r=n[e])&&bt(r)&&(r=Ii(t)?{}:t,n[e]=r):r=Ii(t)?{}:t,r}function KB(n,e){var t=null,r=null;return Gn(n)?t=n:r=n,function(){var i=arguments;if(r=t?t():r)return r[e][tf](r,i)}}function L_e(n,e,t){if(n&&e&&Wa(n)&&Wa(e))for(var r in e)(function(i){var o;Pn(i)&&(o=e[i],Gn(o)?t&&!t(i,!0,e,n)||(n[i]=KB(e,i)):t&&!t(i,!1,e,n)||(hh(n,i)&&delete n[i],Pr(n,i,{g:function(){return e[i]},s:function(a){e[i]=a}})))})(r);return n}function Jw(n,e,t,r,i){n&&e&&t&&(i===!1&&!Ii(n[e])||(n[e]=KB(t,r)))}function pv(n,e,t,r){return n&&e&&Wa(n)&&hr(t)&&on(t,function(i){Pn(i)&&Jw(n,i,e,i,r)}),n}function N_e(n){return function(){var e=this;n&&dr(n,function(t,r){e[t]=r})}}function ZB(n){return n=n&&x2?J2(x2({},n)):n}function XB(n,e,t,r,i,o){var a=arguments,l=a[0]||{},h=a[Un],p=!1,g=1;for(0<h&&j6(l)&&(p=l,l=a[g]||{},g++),Wa(l)||(l={});g<h;g++){var _,x,C,M,L=a[g],F=hr(L),z=Wa(L);for(_ in L)(F&&_ in L||z&&hh(L,_))&&(x=L[_],C=void 0,p&&x&&((C=hr(x))||Ca(x))&&(M=l[_],C?hr(M)||(M=[]):Ca(M)||(M={}),x=XB(p,M,x)),x!==void 0)&&(l[_]=x)}return l}function wI(n,r){var t=!1,r=r&&r.featureOptIn&&r.featureOptIn[n];return t=n&&r?(n=r.mode)==3||n==1:t}function ex(n){try{return n.responseText}catch{}return null}function QB(n,e){return n?"XDomainRequest,Response:"+ex(n)||"":e}function tx(n,e){return n?"XMLHttpRequest,Status:"+n[cv]+",Response:"+ex(n)||n.response||"":e}function JB(n,e){return e&&(Z_(e)?n=[e].concat(n):hr(e)&&(n=e.concat(n))),n}var D_e="Microsoft_ApplicationInsights_BypassAjaxInstrumentation",eU="withCredentials",F_e="timeout";function B_e(n,e,t,r,i,o){function a(h,p,g){try{h[p]=g}catch{}}r===void 0&&(r=!1),i===void 0&&(i=!1);var l=new XMLHttpRequest;return r&&a(l,D_e,r),t&&a(l,eU,t),l.open(n,e,!i),t&&a(l,eU,t),!i&&o&&a(l,F_e,o),l}function U_e(n){var e={};return Pn(n)&&on(ho(n)[Rg](/[\r\n]+/),function(t){var r,i;t&&((i=t.indexOf(": "))!==-1?(r=ho(t.substring(0,i))[Tg](),i=ho(t.substring(i+1)),e[r]=i):e[ho(t)]=1)}),e}function xI(n,e,t){return!n[t]&&e&&e[CB]&&(e=e[CB](t))&&(n[t]=ho(e)),n}var z_e="kill-duration",j_e="kill-duration-seconds",V_e="time-delta-millis";function EI(n,e){var t={};return n[AB]?t=U_e(n[AB]()):e&&(t=xI(t,n,V_e),t=xI(t,n,z_e),t=xI(t,n,j_e)),t}var H_e="documentMode",G_e="location",q_e="console",tU="JSON",$_e="crypto",W_e="msCrypto",Y_e="ReactNative",TI="msie",SI="trident/",nU="XMLHttpRequest",CI=null,rU=null,K_e=!1,gv=null,AI=null;function iU(n,e){var t,r=!1;if(n){try{(r=e in n)||(t=n[ol])&&(r=e in t)}catch{}if(!r)try{r=!Ii(new n()[e])}catch{}}return r}function cl(n){return n&&K_e&&(n=Fi("__mockLocation"),n)?n:typeof location===kB&&location?location:Fi(G_e)}function Z_e(){return typeof console!==Q2?console:Fi(q_e)}function mv(){return!!(typeof JSON===kB&&JSON||Fi(tU)!==null)}function xc(){return mv()?JSON||Fi(tU):null}function X_e(){return Fi($_e)}function Q_e(){return Fi(W_e)}function J_e(){var n=el();return!(!n||!n.product)&&n.product===Y_e}function II(){var n=el();return!n||n[V2]===rU&&CI!==null||(n=((rU=n[V2])||br)[Tg](),CI=ua(n,TI)||ua(n,SI)),CI}function oU(n){var e=((n=(n=n===void 0?null:n)?n:(e=el()||{})?(e.userAgent||br)[Tg]():br)||br)[Tg]();return ua(e,TI)?(n=ca()||{},Math.max(parseInt(e[Rg](TI)[1]),n[H_e]||0)):ua(e,SI)&&(n=parseInt(e[Rg](SI)[1]),n)?n+4:null}function yv(n){return AI=AI!==null&&n!==!1?AI:kye()&&!!el().sendBeacon}function PI(n){var e=!1;try{var e=!!Fi("fetch"),t=Fi("Request");e&&n&&t&&(e=iU(t,"keepalive"))}catch{}return e}function eve(){return gv=gv===null&&(gv=typeof XDomainRequest!==Q2)&&nx()?gv&&!iU(Fi(nU),"withCredentials"):gv}function nx(){var n=!1;try{n=!!Fi(nU)}catch{}return n}function tve(n,e){return!!(n&&n.dispatchEvent&&e)&&(n.dispatchEvent(e),!0)}function nve(n,i){var t,r=null,i={detail:i||null};return Gn(CustomEvent)?r=new CustomEvent(n,i):(t=ca())&&t.createEvent&&(r=t.createEvent("CustomEvent")).initCustomEvent(n,!0,!0,i),r}function rve(n,e,t){var r=qs();if(r&&r.CustomEvent)try{return tve(r,nve(n,{cfg:e||null,customDetails:t||null}))}catch{}return!1}var aU=4294967296,vh=4294967295,sU=123456789,cU=987654321,lU=!1,rx=sU,ix=cU;function ive(n){n<0&&(n>>>=0),rx=sU+n&vh,ix=cU-n&vh,lU=!0}function ove(){try{var n=2147483647&tl();ive((Math.random()*aU^n)+n)}catch{}}function ave(n){return 0<n?Math.floor(_v()/vh*(n+1))>>>0:0}function _v(n){var e=0,t=X_e()||Q_e();return(e=t&&t.getRandomValues?t.getRandomValues(new Uint32Array(1))[0]&vh:e)===0&&II()&&(lU||ove(),e=sve()&vh),e===0&&(e=Math.floor(aU*Math.random()|0)),n||(e>>>=0),e}function sve(n){var e=((ix=36969*(65535&ix)+(ix>>16)&vh)<<16)+(65535&(rx=18e3*(65535&rx)+(rx>>16)&vh))>>>0&vh|0;return n||(e>>>=0),e}function MI(n){n===void 0&&(n=22);for(var e=_v()>>>0,t=0,r=br;r[Un]<n;)t++,r+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(63&e),e>>>=6,t===5&&(e=(_v()<<2&4294967295|3&e)>>>0,t=0);return r}var uU="3.3.0",cve="."+MI(6),lve=0;function hU(n){return n[H2]===1||n[H2]===9||!+n[H2]}function uve(n,e){var t=e[n.id];if(!t){t={};try{hU(e)&&Pr(e,n.id,{e:!1,v:t})}catch{}}return t}function Ws(n,e){return Qw(n+lve+++((e=e===void 0?!1:e)?"."+uU:br)+cve)}function dU(n){var e={id:Ws("_aiData-"+(n||br)+"."+uU),accept:function(t){return hU(t)},get:function(t,r,i,o){var a=t[e.id];return a?a[Qw(r)]:(o&&((a=uve(e,t))[Qw(r)]=i),i)},kill:function(t,r){if(t&&t[r])try{delete t[r]}catch{}}};return e}function ox(n){return n&&Wa(n)&&(n.isVal||n.fb||hh(n,"v")||hh(n,"mrg")||hh(n,"ref")||n.set)}function fU(n,e,t){var r,i=t.dfVal||z6;if(e&&t.fb){var o=t.fb;hr(o)||(o=[o]);for(var a=0;a<o[Un];a++){var l=o[a],h=e[l];if(i(h)?r=h:n&&(i(h=n.cfg[l])&&(r=h),n.set(n.cfg,Ya(l),h)),i(r))break}}return r=!i(r)&&i(t.v)?t.v:r}function RI(n,e,t){var r,i=t;return(i=t&&ox(t)?fU(n,e,t):i)&&(ox(i)&&(i=RI(n,e,i)),hr(i)?(r=[])[Un]=i[Un]:Ca(i)&&(r={}),r)&&(dr(i,function(o,a){a&&ox(a)&&(a=RI(n,e,a)),r[o]=a}),i=r),i}function kI(n,e,t,_){var i,o,a,l,h,p,g=_,g=ox(g)?(i=g.isVal,o=g.set,h=g[Pw],x=g[Iw],a=g.mrg,!(l=g.ref)&&Ii(l)&&(l=!!a),fU(n,e,g)):_,_=(x&&n[Iw](e,t),!0),x=e[t];!x&&bt(x)||(p=x,_=!1,i&&p!==g&&!i(p)&&(p=g,_=!0),o&&(_=(p=o(p,g,e))===g)),_?p=g&&RI(n,e,g):(Ca(p)||hr(g))&&a&&g&&(Ca(g)||hr(g))&&dr(g,function(C,M){kI(n,p,C,M)}),n.set(e,t,p),l&&n.ref(e,t),h&&n[Pw](e,t)}var bh=M2("[[ai_dynCfg_1]]"),pU=M2("[[ai_blkDynCfg_1]]"),hve=M2("[[ai_frcDynCfg_1]]");function gU(n){var e;return n&&(hr(n)?(e=[])[Un]=n[Un]:Ca(n)&&(e={}),e)?(dr(n,function(t,r){e[t]=gU(r)}),e):n}function dve(n){if(n){var e=n[bh]||n;if(e.cfg&&(e.cfg===n||e.cfg[bh]===e))return e}return null}function fve(n){if(n&&(Ca(n)||hr(n)))try{n[pU]=!0}catch{}return n}function OI(n,e,t){var r=!1;return r=!t||n[e.blkVal]||(r=t[hve])||t[pU]?r:Ca(t)||hr(t)}function mU(n){wc("InvalidAccess:"+n)}var pve=["push","pop","shift","unshift","splice"],vv=function(n,e,t,r){n&&n[tv](3,108,"".concat(t," [").concat(e,"] failed - ")+rn(r))};function gve(n,e,t){hr(e)&&on(pve,function(r){var i=e[r];e[r]=function(){for(var o=[],a=0;a<arguments.length;a++)o[a]=arguments[a];var l=i[tf](this,o);return cx(n,e,t,"Patching"),l}})}function ax(n,e){return n=w2(n,e),n&&n.get}function mve(n,e,t,r){var i={n:t,h:[],trk:function(h){h&&h.fn&&(la(i.h,h)===-1&&i.h[Ur](h),n.trk(h,i))},clr:function(h){h=la(i.h,h),h!==-1&&i.h[Cg](h,1)}},o=!0,a=!1;function l(){o&&(a=a||OI(l,n,r),r&&!r[bh]&&a&&(r=cx(n,r,t,"Converting")),o=!1);var h=n.act;return h&&i.trk(h),r}l[n.prop]={chng:function(){n.add(i)}},Pr(e,i.n,{g:l,s:function(h){if(r!==h){l[n.ro]&&!n.upd&&mU("["+t+"] is read-only:"+rn(e)),o&&(a=a||OI(l,n,r),o=!1);var p,g=a&&l[n.rf];if(a)if(g){dr(r,function(_){r[_]=h?h[_]:al});try{dr(h,function(_,x){sx(n,r,_,x)}),h=r}catch(_){vv((n.hdlr||{})[Xi],t,"Assigning",_),a=!1}}else r&&r[bh]&&dr(r,function(x){var x=ax(r,x);x&&(x=x[n.prop])&&x.chng()});h!==r&&(p=h&&OI(l,n,h),!g&&p&&(h=cx(n,h,t,"Converting")),r=h,a=p),n.add(i)}}})}function sx(n,e,t,r){var i;return e&&((i=ax(e,t))&&i[n.prop]?e[t]=r:mve(n,e,t,r)),e}function LI(n,e,t,r){if(e){var i=ax(e,t),o=i&&!!i[n.prop],a=r&&r[0],l=r&&r[1],r=r&&r[2];if(!o){if(r)try{fve(e)}catch(p){vv((n.hdlr||{})[Xi],t,"Blocking",p)}try{sx(n,e,t,e[t]),i=ax(e,t)}catch(p){vv((n.hdlr||{})[Xi],t,"State",p)}}a&&(i[n.rf]=a),l&&(i[n.ro]=l),r&&(i[n.blkVal]=!0)}return e}function cx(n,e,t,r){try{dr(e,function(i,o){sx(n,e,i,o)}),e[bh]||(Jl(e,bh,{get:function(){return n[_B]}}),gve(n,e,t))}catch(i){vv((n.hdlr||{})[Xi],t,r,i)}return e}var bv="[[ai_",wv="]]";function yve(n){var e,t=J_(bv+"get"+n.uid+wv),r=J_(bv+"ro"+n.uid+wv),i=J_(bv+"rf"+n.uid+wv),o=J_(bv+"blkVal"+n.uid+wv),a=J_(bv+"dtl"+n.uid+wv),l=null,h=null;function p(_,x){var C=e.act;try{(e.act=_)&&_[a]&&(on(_[a],function(L){L.clr(_)}),_[a]=[]),x({cfg:n.cfg,set:n.set.bind(n),setDf:n[Sg].bind(n),ref:n.ref.bind(n),rdOnly:n[Pw].bind(n)})}catch(L){var M=n[Xi];throw M&&M[tv](1,107,rn(L)),L}finally{e.act=C||null}}function g(){if(l){var _=l,x=(l=null,h&&h[Ag](),h=null,[]);if(on(_,function(C){if(C&&(C[a]&&(on(C[a],function(M){M.clr(C)}),C[a]=null),C.fn))try{p(C,C.fn)}catch(M){x[Ur](M)}}),l)try{g()}catch(C){x[Ur](C)}0<x[Un]&&o_e("Watcher error(s): ",x)}}return(t={prop:t,ro:r,rf:i})[Iw]=o,t[_B]=n,t.add=function(_){if(_&&0<_.h[Un]){l=l||[],h=h||$s(function(){h=null,g()},0);for(var x=0;x<_.h[Un];x++){var C=_.h[x];C&&la(l,C)===-1&&l[Ur](C)}}},t[Mw]=g,t.use=p,t.trk=function(_,x){_&&(_=_[a]=_[a]||[],la(_,x)===-1)&&_[Ur](x)},e=t}function _ve(n,e){var t={fn:e,rm:function(){t.fn=null,e=n=null}};return Pr(t,"toJSON",{v:function(){return"WatcherHandler"+(t.fn?"":"[X]")}}),n.use(t,e),t}function vve(n,e,t){var r,i,o=dve(e);return o||(o=Ws("dyncfg",!0),(e={uid:null,cfg:t=e&&t!==!1?e:gU(e)})[Xi]=n,e[Mw]=function(){r[Mw]()},e.set=function(a,l,h){try{a=sx(r,a,l,h)}catch(p){vv(n,l,"Setting value",p)}return a[l]},e[Sg]=function(a,l){return l&&dr(l,function(h,p){kI(i,a,h,p)}),a},e[ef]=function(a){return _ve(r,a)},e.ref=function(a,l){return LI(r,a,l,((a={})[0]=!0,a))[l]},e[Pw]=function(a,l){return LI(r,a,l,((a={})[1]=!0,a))[l]},e[Iw]=function(a,l){return LI(r,a,l,((a={})[2]=!0,a))[l]},e._block=function(a,l){r.use(null,function(h){var p=r.upd;try{Ii(l)||(r.upd=l),a(h)}finally{r.upd=p}})},Pr(i=e,"uid",{c:!1,e:!1,w:!1,v:o}),cx(r=yve(i),t,"config","Creating"),i)}function bve(n,e){n?(n[Rw](e),n[tv](2,108,e)):mU(e)}function Ys(n,e,t,r){return t=vve(t,n||{},r),e&&t[Sg](t.cfg,e),t}function Qi(n,e,t){var r=n[bh]||n;return(!r.cfg||r.cfg!==n&&r.cfg[bh]!==r?(bve(t,I_e+rn(n)),Ys(n,null,t)):r)[ef](e)}function Ug(n,e){if(n&&n[yh])return n[yh](e)}function yU(n,e,t){var r;return t||(r=lu(function(i){t=i})),n&&0<Jye(n)?cu(Ug(n[0],e),function(){yU(Aw(n,1),e,t)}):t(),r}var wve=500,_U="Microsoft_ApplicationInsights_BypassAjaxInstrumentation";function xve(n,e,t){return!n&&bt(n)?e:j6(n)?n:Ya(n)[Tg]()==="true"}function ll(n){return{mrg:!0,v:n}}function vU(n,e){return{set:n,v:e}}function lx(n,e,t){return{fb:t,isVal:n,v:e}}function fo(n,e){return{fb:e,set:xve,v:!!n}}function Eve(n){return{isVal:Pn,v:Ya(n||br)}}var ux,xv,NI=[Kw,fv,Zw,cf],hx=null;function Tve(n,e){return function(){var t=arguments,r=bU(e);r&&(r=r.listener)&&r[n]&&r[n][tf](r,t)}}function Sve(){var n=Fi("Microsoft");return hx=n?n.ApplicationInsights:hx}function bU(n){var e=hx;return(e=e||n.disableDbgExt===!0?e:hx||Sve())?e.ChromeDbgExt:null}function Cve(n){if(!ux){ux={};for(var e=0;e<NI[Un];e++)ux[NI[e]]=Tve(NI[e],n)}return ux}var wU="warnToConsole",Ave="AI (Internal): ",Ive="AI: ",Pve="AITR_",Mve={loggingLevelConsole:0,loggingLevelTelemetry:1,maxMessageLimit:25,enableDebug:!1},Rve=((xv={})[0]=null,xv[1]="errorToConsole",xv[2]=wU,xv[3]="debugToConsole",xv);function xU(n){return n?'"'+n[of](/\"/g,br)+'"':br}function DI(n,e){var t,r=Z_e();r&&(t="log",r[n]&&(t=n),Gn(r[t]))&&r[t](e)}var Ev=function(){function n(e,t,r,i){r===void 0&&(r=!1),this[Fw]=e,this[rf]=(r?Ive:Ave)+e,r=br,mv()&&(r=xc().stringify(i)),e=(t?" message:"+xU(t):br)+(i?" props:"+xU(r):br),this[rf]+=e}return n.dataType="MessageData",n}();function uf(n,e){return(n||{})[Xi]||new dx(e)}var EU,zg,dx=function(){function n(e){this.identifier="DiagnosticLogger",this.queue=[];var t,r,i,o,a,l=0,h={};mi(n,this,function(p){function g(x,C){var M,L;i<=l||(L=!0,M=Pve+C[Fw],h[M]?L=!1:h[M]=!0,L&&(x<=r&&(p.queue[Ur](C),l++,_(x===1?"error":"warn",C)),l===i)&&(L=new Ev(23,M="Internal events throttle limit per PageView reached for this app.",!1),p.queue[Ur](L),x===1?p.errorToConsole(M):p[Rw](M)))}function _(x,C){var M=bU(e||{});M&&M[_h]&&M[_h](x,C)}a=Qi(Ys(e||{},Mve,p).cfg,function(x){x=x.cfg,t=x[EB],r=x.loggingLevelTelemetry,i=x.maxMessageLimit,o=x.enableDebug}),p.consoleLoggingLevel=function(){return t},p[tv]=function(x,C,M,L,F){if(C=new Ev(C,M,F=F===void 0?!1:F,L),o)throw rn(C);M=Rve[x]||wU,Ii(C[rf])?_("throw"+(x===1?"Critical":"Warning"),C):(F?(L=+C[Fw],!h[L]&&x<=t&&(p[M](C[rf]),h[L]=!0)):x<=t&&p[M](C[rf]),g(x,C))},p.debugToConsole=function(x){DI("debug",x),_("warning",x)},p[Rw]=function(x){DI("warn",x),_("warning",x)},p.errorToConsole=function(x){DI("error",x),_("error",x)},p.resetInternalMessageCount=function(){l=0,h={}},p[SB]=g,p[yh]=function(x){a&&a.rm(),a=null}})}return n.__ieDyn=1,n}();function FI(n){return n||new dx}function Ut(n,e,t,r,i,o){o===void 0&&(o=!1),FI(n)[tv](e,t,r,i,o)}function hf(n,e){FI(n)[Rw](e)}function kve(n,e,t){FI(n)[SB](e,t)}var ul,TU="toGMTString",SU="toUTCString",BI="cookie",UI="expires",CU="isCookieUseDisabled",zI="disableCookiesUsage",wh="_ckMgr",fx=null,jI=null,AU=null,IU={},px={},Ove=((EU={cookieCfg:ll(((zg={})[vI]={fb:"cookieDomain",dfVal:lf},zg.path={fb:"cookiePath",dfVal:lf},zg.enabled=al,zg.ignoreCookies=al,zg.blockedCookies=al,zg)),cookieDomain:al,cookiePath:al})[zI]=al,EU);function VI(){ul=ul||Rye(function(){return ca()})}function Lve(n,e){var t=Tv[wh]||px[wh];return t||(t=Tv[wh]=Tv(n,e),px[wh]=t),t}function gx(n){return!n||n.isEnabled()}function PU(n,e){return!!(e&&n&&hr(n.ignoreCookies))&&la(n.ignoreCookies,e)!==-1}function Nve(n,e){return!!(e&&n&&hr(n.blockedCookies)&&la(n.blockedCookies,e)!==-1)||PU(n,e)}function MU(n,r){var t,r=r[Pg];return bt(r)&&(t=void 0,Ii(n[CU])||(t=!n[CU]),r=t=Ii(n[zI])?t:!n[zI]),r}function HI(n,e){var t,r;return n?r=n.getCookieMgr():e&&(r=(t=e.cookieCfg)&&t[wh]?t[wh]:Tv(e)),r=r||Lve(e,(n||{})[Xi])}function Tv(n,e){n=Ys(n||px,null,e).cfg,a=Qi(n,function(x){x[Sg](x.cfg,Ove),r=x.ref(x.cfg,"cookieCfg"),i=r[bI]||"/",o=r[vI],l=MU(n,r)!==!1,h=r.getCookie||Dve,p=r.setCookie||NU,g=r.delCookie||NU},e),(t={isEnabled:function(){var x=MU(n,r)!==!1&&l&&RU(e),C=px[wh];return x=x&&C&&_!==C?gx(C):x},setEnabled:function(x){l=x!==!1,r[Pg]=x},set:function(x,C,M,L,F){var z,ee,ce,se=!1;return gx(_)&&!Nve(r,x)&&(z={},ee=ho(C||br),(ce=Za(ee,";"))!==-1&&(ee=ho(S2(C,ce)),z=kU(Jc(C,ce+1))),oi(z,vI,L||o,ww,Ii),bt(M)||(C=II(),Ii(z[UI])&&0<(ce=tl()+1e3*M)&&((L=new Date).setTime(ce),oi(z,UI,OU(L,C?TU:SU)||OU(L,C?TU:SU)||br,ww)),C)||oi(z,"max-age",br+M,null,Ii),(ce=cl())&&ce[TB]==="https:"&&(oi(z,"secure",null,null,Ii),jI=jI===null?!Fve((el()||{})[V2]):jI)&&oi(z,"SameSite","None",null,Ii),oi(z,bI,F||i,null,Ii),p(x,LU(ee,z)),se=!0),se},get:function(x){var C=br;return C=gx(_)&&!PU(r,x)?h(x):C},del:function(x,C){var M=!1;return M=gx(_)?_.purge(x,C):M},purge:function(x,C){var M,L=!1;return RU(e)&&((M={})[bI]=C||"/",M[UI]="Thu, 01 Jan 1970 00:00:01 GMT",C=M,II()||(C["max-age"]="0"),g(x,LU(br,C)),L=!0),L}})[yh]=function(x){a&&a.rm(),a=null};var t,r,i,o,a,l,h,p,g,_=t;return _[wh]=_}function RU(n){if(fx===null){fx=!1,ul||VI();try{var e=ul.v||{};fx=e[BI]!==void 0}catch(t){Ut(n,2,68,"Cannot access document.cookie - "+Dr(t),{exception:rn(t)})}}return fx}function kU(n){var e={};return n&&n[Un]&&on(ho(n)[Rg](";"),function(t){var r;(t=ho(t||br))&&((r=Za(t,"="))===-1?e[t]=null:e[ho(S2(t,r))]=ho(Jc(t,r+1)))}),e}function OU(n,e){return Gn(n[e])?n[e]():null}function LU(n,e){var t=n||br;return dr(e,function(r,i){t+="; "+r+(bt(i)?br:"="+i)}),t}function Dve(n){var e,t=br;return ul||VI(),ul.v&&(e=ul.v[BI]||br,AU!==e&&(IU=kU(e),AU=e),t=ho(IU[n]||br)),t}function NU(n,e){ul||VI(),ul.v&&(ul.v[BI]=n+"="+e)}function Fve(n){return!(!Pn(n)||!ua(n,"CPU iPhone OS 12")&&!ua(n,"iPad; CPU OS 12")&&!(ua(n,"Macintosh; Intel Mac OS X 10_14")&&ua(n,"Version/")&&ua(n,"Safari"))&&(!ua(n,"Macintosh; Intel Mac OS X 10_14")||!gB(n,"AppleWebKit/605.1.15 (KHTML, like Gecko)"))&&!ua(n,"Chrome/5")&&!ua(n,"Chrome/6")&&(!ua(n,"UnrealEngine")||ua(n,"Chrome"))&&!ua(n,"UCBrowser/12")&&!ua(n,"UCBrowser/11"))}var Bve={perfEvtsSendAll:!1};function Uve(n){n.h=null;var e=n.cb;n.cb=[],on(e,function(t){Oo(t.fn,[t.arg])})}function xh(n,e,t,r){on(n,function(i){i&&i[e]&&(t?(t.cb[Ur]({fn:r,arg:i}),t.h=t.h||$s(Uve,0,t)):Oo(r,[i]))})}var zve=function(){function n(e){this.listeners=[];var t,r=[],i={h:null,cb:[]},o=Ys(e,Bve)[ef](function(a){t=!!a.cfg.perfEvtsSendAll});mi(n,this,function(a){Pr(a,"listeners",{g:function(){return r}}),a[Ow]=function(l){r[Ur](l)},a[kw]=function(l){for(var h=la(r,l);-1<h;)r[Cg](h,1),h=la(r,l)},a[Kw]=function(l){xh(r,Kw,i,function(h){h[Kw](l)})},a[fv]=function(l,h){xh(r,fv,i,function(p){p[fv](l,h)})},a[Zw]=function(l,h){xh(r,Zw,h?i:null,function(p){p[Zw](l,h)})},a[cf]=function(l){!l||!t&&l[q2]()||xh(r,cf,null,function(h){l[Mg]?$s(function(){return h[cf](l)},0):h[cf](l)})},a[mI]=function(l){l&&l[Un]&&xh(r,mI,i,function(h){h[mI](l)})},a[yI]=function(l){l&&l[kg]&&xh(r,yI,i,function(h){h[yI](l)})},a[_I]=function(l,h){var p;0<l&&(p=h||0,xh(r,_I,i,function(g){g[_I](l,p)}))},a[yh]=function(l){function h(){o&&o.rm(),o=null,r=[],i.h&&i.h[Ag](),i.h=null,i.cb=[]}var p;if(xh(r,"unload",null,function(g){g=g[yh](l),g&&(p=p||[])[Ur](g)}),p)return lu(function(g){return cu(C_e(p),function(){h(),g()})});h()}})}return n.__ieDyn=1,n}(),jg="ctx",GI="ParentContextKey",Sv="ChildrenContextKey",jve=null,mx=function(){function n(e,t,r){var i,o=this;o.start=tl(),o[ru]=e,o[Mg]=r,o[q2]=function(){return!1},Gn(t)&&Pr(o,"payload",{g:function(){return!i&&Gn(t)&&(i=t(),t=null),i}}),o[Og]=function(a){return a?(a===n[GI]||a===n[Sv]?o:o[jg]||{})[a]:null},o[il]=function(a,l){a&&(a===n[GI]?(o[a]||(o[q2]=function(){return!0}),o[a]=l):a===n[Sv]?o[a]=l:(o[jg]=o[jg]||{})[a]=l)},o[$2]=function(){var a=0,l=o[Og](n[Sv]);if(hr(l))for(var h=0;h<l[Un];h++){var p=l[h];p&&(a+=p[Ig])}o[Ig]=tl()-o.start,o.exTime=o[Ig]-a,o[$2]=function(){}}}return n.ParentContextKey="parent",n.ChildrenContextKey="childEvts",n}(),Vve=function(){function n(e){this.ctx={},mi(n,this,function(t){t.create=function(r,i,o){return new mx(r,i,o)},t.fire=function(r){r&&(r[$2](),e)&&Gn(e[cf])&&e[cf](r)},t[il]=function(r,i){r&&((t[jg]=t[jg]||{})[r]=i)},t[Og]=function(r){return(t[jg]||{})[r]}})}return n.__ieDyn=1,n}(),qI="CoreUtils.doPerf";function yx(n,e,t,r,i){if(n&&(n=n[Xw]?n[Xw]():n)){var o,a=void 0,l=n[Og](qI);try{if(a=n.create(e(),r,i))return l&&a[il]&&(a[il](mx[GI],l),l[Og])&&l[il]&&((o=l[Og](mx[Sv]))||(o=[],l[il](mx[Sv],o)),o[Ur](a)),n[il](qI,a),t(a)}catch(h){a&&a[il]&&a[il]("exception",h)}finally{a&&n.fire(a),n[il](qI,l)}}return t()}function Hve(){return jve}function Eh(){for(var n,e=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"],t=br,r=0;r<4;r++)t+=e[15&(n=_v())]+e[n>>4&15]+e[n>>8&15]+e[n>>12&15]+e[n>>16&15]+e[n>>20&15]+e[n>>24&15]+e[n>>28&15];var i=e[8+(3&_v())|0];return dh(t,0,8)+dh(t,9,4)+"4"+dh(t,13,3)+i+dh(t,16,3)+dh(t,19,12)}var $I="00",Gve="ff",DU="00000000000000000000000000000000",FU="0000000000000000";function Cv(n,e,t){return!(!n||n[Un]!==e||n===t||!n.match(/^[\da-f]*$/i))}function BU(n,e,t){return Cv(n,e)?n:t}function qve(n){for(var e=(n=isNaN(n)||n<0||255<n?1:n).toString(16);e[Un]<2;)e="0"+e;return e}function UU(n,e,t,r){var i={};return i[Dw]=Cv(r,2,Gve)?r:$I,i[Y2]=WI(n)?n:Eh(),i[K2]=YI(e)?e:S2(Eh(),16),i.traceFlags=0<=t&&t<=255?t:1,i}function WI(n){return Cv(n,32,DU)}function YI(n){return Cv(n,16,FU)}function zU(n){var e,t;return n?(Cv(e=qve(n[Z2]),2)||(e="01"),t=n[Dw]||$I,"".concat((t=t!=="00"&&t!=="ff"?$I:t).toLowerCase(),"-").concat(BU(n.traceId,32,DU).toLowerCase(),"-").concat(BU(n.spanId,16,FU).toLowerCase(),"-").concat(e.toLowerCase())):""}var $ve=dU("plugin");function df(n){return $ve.get(n,"state",{},!0)}function jU(n,e){for(var t=[],r=null,i=n[rl]();i;){var o,a,l=i[iv]();l&&(r&&r[sv]&&l[sl]&&r[sv](l),a=!!(o=df(l))[nl],(a=l[nl]?l[nl]():a)||t[Ur](l),r=l,i=i[rl]())}on(t,function(h){var p=n[bo]();h[nv](n.getCfg(),p,e,n[rl]()),o=df(h),h[bo]||o[bo]||(o[bo]=p),o[nl]=!0,delete o[iu]})}function KI(n){return n.sort(function(e,t){var r,i=0;return t?(r=t[sl],e[sl]?i=r?e[Yw]-t[Yw]:1:r&&(i=-1)):i=e?1:-1,i})}function Wve(n){var e={};return{getName:function(){return e[ru]},setName:function(t){n&&n.setName(t),e[ru]=t},getTraceId:function(){return e[Y2]},setTraceId:function(t){n&&n.setTraceId(t),WI(t)&&(e[Y2]=t)},getSpanId:function(){return e[K2]},setSpanId:function(t){n&&n.setSpanId(t),YI(t)&&(e[K2]=t)},getTraceFlags:function(){return e[Z2]},setTraceFlags:function(t){n&&n.setTraceFlags(t),e[Z2]=t}}}var VU,Yve="TelemetryPluginChain",HU="_hasRun",GU="_getTelCtx",qU=0;function Kve(n,e,t){for(;n;){if(n[iv]()===t)return n;n=n[rl]()}return ff([t],e.config||{},e)}function ZI(n,e,t,r){var i=null,o=[],a=(e=e||Ys({},null,t[Xi]),r!==null&&(i=r?Kve(n,t,r):n),{_next:function(){var h=i;{var p;i=h?h[rl]():null,h||(p=o)&&0<p[Un]&&(on(p,function(g){try{g.func.call(g.self,g.args)}catch(_){Ut(t[Xi],2,73,"Unexpected Exception during onComplete - "+rn(_))}}),o=[])}return h},ctx:{core:function(){return t},diagLog:function(){return uf(t,e.cfg)},getCfg:function(){return e.cfg},getExtCfg:function(h,p){var g=l(h,!0);return p&&dr(p,function(_,x){var C;!bt(g[_])||!(C=e.cfg[_])&&bt(C)||(g[_]=C),kI(e,g,_,x)}),e[Sg](g,p)},getConfig:function(x,p,g){g===void 0&&(g=!1);var _,x=l(x,!1),C=e.cfg;return!x||!x[p]&&bt(x[p])?!C[p]&&bt(C[p])||(_=C[p]):_=x[p],_||!bt(_)?_:g},hasNext:function(){return!!i},getNext:function(){return i},setNext:function(h){i=h},iterate:function(h){for(;p=a._next();){var p=p[iv]();p&&h(p)}},onComplete:function(h,p){for(var g=[],_=2;_<arguments.length;_++)g[_-2]=arguments[_];h&&o[Ur]({func:h,self:Ii(p)?a.ctx:p,args:g})}}});function l(h,p){var g,_=null,x=e.cfg;return x&&h&&(g=x[Dg],x[Dg]=g=!g&&p?{}:g,g=e.ref(x,Dg))&&(_=g[h],g[h]=_=!_&&p?{}:_,_=e.ref(g,h)),_}return a}function Ec(n,e,t,r){var i=Ys(e),o=ZI(n,i,t,r),a=o.ctx;return a[Aa]=function(l){var h=o._next();return h&&h[sl](l,a),!h},a[nf]=function(l,h){return Ec((l=hr(l=l===void 0?null:l)?ff(l,i.cfg,t,h):l)||a[rl](),i.cfg,t,h)},a}function _x(n,e,t){var r=Ys(e.config),i=ZI(n,r,e,t),o=i.ctx;return o[Aa]=function(a){var l=i._next();return l&&l[yh](o,a),!l},o[nf]=function(a,l){return _x((a=hr(a=a===void 0?null:a)?ff(a,r.cfg,e,l):a)||o[rl](),e,l)},o}function XI(n,e,t){var r=Ys(e.config),i=ZI(n,r,e,t).ctx;return i[Aa]=function(o){return i.iterate(function(a){Gn(a[av])&&a[av](i,o)})},i[nf]=function(o,a){return XI((o=hr(o=o===void 0?null:o)?ff(o,r.cfg,e,a):o)||i[rl](),e,a)},i}function ff(n,e,t,r){var i,o=null,a=!r;return hr(n)&&0<n[Un]&&(i=null,on(n,function(l){(a=a||r!==l?a:!0)&&l&&Gn(l[sl])&&(l=Zve(l,e,t),o=o||l,i&&i._setNext(l),i=l)})),r&&!o?ff([r],e,t):o}function Zve(n,e,t){var r=null,i=Gn(n[sl]),o=Gn(n[sv]),a=n?n[mh]+"-"+n[Yw]+"-"+qU++:"Unknown-0-"+qU++,l={getPlugin:function(){return n},getNext:function(){return r},processTelemetry:function(p,g){h(g=g||function(){var _;return n&&Gn(n[GU])&&(_=n[GU]()),_=_||Ec(l,e,t),_}(),function(_){var x;return!(!n||!i||(x=df(n))[iu]||x[gI]||(o&&n[sv](r),n[sl](p,_),0))},"processTelemetry",function(){return{item:p}},!p.sync)||g[Aa](p)},unload:function(p,g){h(p,function(){var _,x,C=!1;return n&&(_=df(n),x=n[bo]||_[bo],!n||x&&x!==p.core()||_[iu]||(_[bo]=null,_[iu]=!0,_[nl]=!1,n[iu]&&n[iu](p,g)===!0&&(C=!0))),C},"unload",function(){},g[Mg])||p[Aa](g)},update:function(p,g){h(p,function(){var _,x,C=!1;return n&&(_=df(n),x=n[bo]||_[bo],!n||x&&x!==p.core()||_[iu]||n[av]&&n[av](p,g)===!0&&(C=!0)),C},"update",function(){},!1)||p[Aa](g)},_id:a,_setNext:function(p){r=p}};function h(p,g,_,x,C){var M=!1,L=n?n[mh]:Yve,F=(F=p[HU])||(p[HU]={});return p.setNext(r),n&&yx(p[bo](),function(){return L+":"+_},function(){F[a]=!0;try{var z=r?r._id:br;z&&(F[z]=!1),M=g(p)}catch(ee){z=!r||F[r._id],z&&(M=!0),r&&z||Ut(p[_h](),1,73,"Plugin ["+L+"] failed during "+_+" - "+rn(ee)+", run flags: "+rn(F))}},x,C),M}return tu(l)}function $U(){var n=[];return{add:function(e){e&&n[Ur](e)},run:function(e,t){on(n,function(r){try{r(e,t)}catch(i){Ut(e[_h](),2,73,"Unexpected error calling unload handler - "+rn(i))}}),n=[]}}}function WU(){var n=[];return{run:function(e){var t=n;n=[],on(t,function(r){try{(r.rm||r.remove).call(r)}catch(i){Ut(e,2,73,"Unloading:"+rn(i))}})},add:function(e){e&&Eg(n,e)}}}var Th="getPlugin",Xve=((VU={})[Dg]={isVal:lf,v:{}},VU),Vg=function(){function n(){var e,t,r,i,o,a=this;function l(x){var _,x=x=x===void 0?null:x;return x||(_=t||Ec(null,{},a[bo]),x=r&&r[Th]?_[nf](null,r[Th]):_[nf](null,r)),x}function h(g,_,x){Ys(g,Xve,uf(_)),!x&&_&&(x=_[bB]()[rl]());var C=r;r&&r[Th]&&(C=r[Th]()),a[bo]=_,t=Ec(x,g,_,C)}function p(){e=!1,a[bo]=null,r=t=null,o=WU(),i=$U()}p(),mi(n,a,function(g){g[nv]=function(_,x,C,M){h(_,x,M),e=!0},g[iu]=function(_,x){var C,M,L,F,z=g[bo];if(z&&(!_||z===_[bo]()))return M=!1,L=_||_x(null,z,r&&r[Th]?r[Th]():r),F=x||((_={reason:0})[Mg]=!1,_),g[Bw]&&g[Bw](L,F,ee)===!0?C=!0:ee(),C;function ee(){M||(M=!0,i.run(L,x),o.run(L[_h]()),C===!0&&L[Aa](F),p())}},g[av]=function(_,x){var C,M,L,F=g[bo];if(F&&(!_||F===_[bo]()))return M=!1,L=_||XI(null,F,r&&r[Th]?r[Th]():r),g._doUpdate&&g._doUpdate(L,x||{reason:0},z)===!0?C=!0:z(),C;function z(){M||(M=!0,h(L.getCfg(),L.core(),L[rl]()))}},Jw(g,"_addUnloadCb",function(){return i},"add"),Jw(g,"_addHook",function(){return o},"add"),Pr(g,"_unloadHooks",{g:function(){return o}})}),a[_h]=function(g){return l(g)[_h]()},a[nl]=function(){return e},a.setInitialized=function(g){e=g},a[sv]=function(g){r=g},a[Aa]=function(g,_){_?_[Aa](g):r&&Gn(r[sl])&&r[sl](g,null)},a._getTelCtx=l}return n.__ieDyn=1,n}();function Qve(n,e,t){var r={id:e,fn:t};return Eg(n,r),{remove:function(){on(n,function(i,o){if(i.id===r.id)return n[Cg](o,1),-1})}}}function Jve(n,e,t){for(var r=!1,i=n[Un],o=0;o<i;++o){var a=n[o];if(a)try{if(a.fn[tf](null,[e])===!1){r=!0;break}}catch(l){Ut(t,2,64,"Telemetry initializer failed: "+Dr(l),{exception:rn(l)},!0)}}return!r}var pf,e0e=function(n){function e(){var t,r,i=n.call(this)||this;function o(){t=0,r=[]}return i.identifier="TelemetryInitializerPlugin",i.priority=199,o(),mi(e,i,function(a,l){a.addTelemetryInitializer=function(h){return Qve(r,t++,h)},a[sl]=function(h,p){Jve(r,h,(p||a)[_h]())&&a[Aa](h,p)},a[Bw]=function(){o()}}),i}return au(e,n),e.__ieDyn=1,e}(Vg),YU="Plugins must provide initialize method",t0e="_notificationManager",KU="SDK is still unloading...",n0e="SDK is not initialized",r0e=100,i0e=5e4,QI=bg(((pf={cookieCfg:{}})[Fg]={rdOnly:!0,ref:!0,v:[]},pf[sf]={rdOnly:!0,ref:!0,v:[]},pf[Dg]={ref:!0,v:{}},pf[pI]=al,pf.loggingLevelConsole=0,pf.diagnosticLogInterval=al,pf));function o0e(n,e){return new Vve(e)}function a0e(n,e,t){var r=[],i=[],o={};return on(t,function(a){(bt(a)||bt(a[nv]))&&Ts(YU);var l=a[Yw],h=a[mh];a&&l&&(bt(o[l])?o[l]=h:hf(n,"Two extensions have same priority #"+l+" - "+o[l]+", "+h)),(!l||l<e?r:i)[Ur](a)}),(t={})[bo]=r,t[sf]=i,t}function ZU(n,e){var t=!1;return on(e,function(r){if(r===n)return t=!0,-1}),t}function JI(n,e,t,r){t&&dr(t,function(i,o){r&&Ca(o)&&Ca(e[i])&&JI(n,e[i],o,r),r&&Ca(o)&&Ca(e[i])?JI(n,e[i],o,r):n.set(e,i,o)})}function XU(n,e){var t=null,r=-1;return on(n,function(i,o){if(i.w===e)return t=i,r=o,-1}),{i:r,l:t}}function s0e(n,e){var t=XU(n,e).l;return t||n[Ur](t={w:e,rm:function(){var r=XU(n,e);r.i!==-1&&n[Cg](r.i,1)}}),t}function c0e(n,e,t){on(e,function(r){var i=Qi(n,r.w,t);delete r.w,r.rm=function(){i.rm()}})}function l0e(n,e,t,r){return e.add(n[ef](function(i){var o=i.cfg.disableDbgExt;o===!0&&r&&(t[kw](r),r=null),t&&!r&&o!==!0&&(r=Cve(i.cfg),t[Ow](r))})),r}function u0e(n){return Pr({rm:function(){n.rm()}},"toJSON",{v:function(){return"aicore::onCfgChange<"+JSON.stringify(n)+">"}})}var h0e=function(){function n(){var e,t,r,i,o,a,l,h,p,g,_,x,C,M,L,F,z,ee,ce,se,_e,J,pe,ue,xe,je,ne,Ee,ke,Be,Ze,at;mi(n,this,function(Re){function ht(){ke=!0,bt(_e)?(je=gh[j2],Ut(r,1,112,"ikey can't be resolved from promises")):je=gh.ACTIVE,Rt()}function Rt(){t&&(Re.releaseQueue(),Re[wB]())}function dn(D){return Be&&Be[Pg]||at||(D||r&&0<r.queue[Un])&&(Ze||(Ze=!0,H(e[ef](function(ae){var ae=ae.cfg.diagnosticLogInterval,q=(ae&&0<ae||(ae=1e4),!1);Be&&(q=Be[Pg],Be[Ag]()),(Be=r_e(En,ae)).unref(),Be[Pg]=q}))),Be[Pg]=!0),Be}function wt(){function D(ae){ae&&on(ae,function(q){var Ae;q[mh]&&q[Dw]&&!Q[q.identifier]&&(Ae=q[mh]+"="+q[Dw],ue[Ur](Ae),Q[q.identifier]=q)})}var Q={};ue=[],D(x),_&&on(_,function(ae){D(ae)}),D(g)}function Ge(){t=!1,(e=Ys({},QI,Re[Xi])).cfg[EB]=1,Pr(Re,"config",{g:function(){return e.cfg},s:function(Q){Re.updateCfg(Q,!1)}}),Pr(Re,"pluginVersionStringArr",{g:function(){return ue||wt(),ue}}),Pr(Re,"pluginVersionString",{g:function(){return xe||(ue||wt(),xe=ue.join(";")),xe||br}}),Pr(Re,"logger",{g:function(){return r||(r=new dx(e.cfg),e[Xi]=r),r},s:function(Q){e[Xi]=Q,r!==Q&&(Ug(r,!1),r=Q)}}),Re[Xi]=new dx(e.cfg),pe=[];var D=Re.config[Fg]||[];D.splice(0,D[Un]),Eg(D,pe),M=new e0e,Ug(o,!(i=[])),l=a=o=null,Ug(h,!1),C=!(g=[]),F=Ws("AIBaseCore",!(L=x=_=p=h=null)),z=$U(),_e=se=null,ee=WU(),je=0,Ee=ne=Be=ue=xe=null,ke=Ze=at=!(J=[])}function qn(){var D=Ec(Mn(),e.cfg,Re);return D[Nw](dn),D}function Qt(D){var Q=a0e(Re[Xi],wve,g),Q=(ue=xe=p=null,x=KI(Eg(x=(_||[])[0]||[],Q[sf])),Eg(KI(Q[bo]),x)),ae=(pe=tu(Q),Re.config[Fg]||[]),ae=(ae.splice(0,ae[Un]),Eg(ae,pe),qn());x&&0<x[Un]&&jU(ae[nf](x),Q),jU(ae,Q),D&&Pt(D)}function ln(D){var Q=null,ae=null,q=[];return on(pe,function(Ae){if(Ae[mh]===D&&Ae!==M)return ae=Ae,-1;Ae.getChannel&&q[Ur](Ae)}),!ae&&0<q[Un]&&on(q,function(Ae){if(!(ae=Ae.getChannel(D)))return-1}),Q=ae?{plugin:ae,setEnabled:function(Ae){df(ae)[gI]=!Ae},isEnabled:function(){var Ae=df(ae);return!Ae[iu]&&!Ae[gI]},remove:function(Ae,Pe){var We,rt=[ae];(We={reason:1})[Mg]=Ae=Ae===void 0?!0:Ae,Ot(rt,We,function(Et){Et&&Qt({reason:32,removed:rt}),Pe&&Pe(Et)})}}:Q}function Mn(){var D;return p||(D=(pe||[]).slice(),la(D,M)===-1&&D[Ur](M),p=ff(KI(D),e.cfg,Re)),p}function Ot(D,Q,ae){var q;D&&0<D[Un]?((q=_x(ff(D,e.cfg,Re),Re))[Nw](function(){var Ae=!1,Pe=[],We=(on(g,function(rt,Et){ZU(rt,D)?Ae=!0:Pe[Ur](rt)}),g=Pe,ue=xe=null,[]);_&&(on(_,function(rt,Et){var Bt=[];on(rt,function(Lt){ZU(Lt,D)?Ae=!0:Bt[Ur](Lt)}),We[Ur](Bt)}),_=We),ae&&ae(Ae),dn()}),q[Aa](Q)):ae(!1)}function En(){var D;r&&r.queue&&(D=r.queue.slice(0),r.queue[Un]=0,on(D,function(q){(ae={})[ru]=L||"InternalMessageId: "+q[Fw],ae[ov]=_e,ae[Ig]=Bg(new Date),ae.baseType=Ev.dataType,ae.baseData={message:q[rf]};var ae,q=ae;Re.track(q)}))}function lt(D,Q,ae,q){var Ae=1,Pe=!1,We=null;function rt(){Ae--,Pe&&Ae===0&&(We&&We[Ag](),We=null,Q&&Q(Pe),Q=null)}return q=q||5e3,x&&0<x[Un]&&qn()[nf](x).iterate(function(Et){var Bt;Et.flush&&(Ae++,Bt=!1,Et.flush(D,function(){Bt=!0,rt()},ae)||Bt||(D&&We==null?We=$s(function(){We=null,rt()},q):rt()))}),Pe=!0,rt(),!0}function Pt(D){var Q=XI(Mn(),Re);Q[Nw](dn),Re._updateHook&&Re._updateHook(Q,D)===!0||Q[Aa](D)}function he(D){var Q=Re[Xi];Q?(Ut(Q,2,73,D),dn()):Ts(D)}function B(D){var Q=Re[Lw]();Q&&Q[fv]([D],2)}function H(D){ee.add(D)}Ge(),Re._getDbgPlgTargets=function(){return[pe,i]},Re[nl]=function(){return t},Re.activeStatus=function(){return je},Re._setPendingStatus=function(){je=3},Re[nv]=function(D,Q,ae,Pe){C&&Ts(KU),Re[nl]()&&Ts("Core cannot be initialized more than once"),e=Ys(D,QI,ae||Re[Xi],!1),D=e.cfg,H(e[ef](function(We){var rt,Et,Bt,Lt,an=We.cfg;je!==3&&(Ee=an.initInMemoMaxSize||r0e,Et=an[vB],Bt=an.endpointUrl,bt(Et)?(_e=null,je=gh[j2],rt="Please provide instrumentation key",t?(Ut(r,1,100,rt),Rt()):Ts(rt)):(rt=[],_e=Jd(Et)?(rt[Ur](Et),null):Et,ne=Jd(Bt)?(rt[Ur](Bt),null):Bt,rt[Un]?(ke=!1,je=3,Et=lf(an.initTimeOut)?an.initTimeOut:i0e,Bt=A_e(rt),$s(function(){ke||ht()},Et),cu(Bt,function(Ie){try{var Te,At,xt;ke||(Ie.rejected||((Te=Ie[rv])&&Te[Un]&&(At=Te[0],_e=At&&At[rv],1<Te[Un])&&(xt=Te[1],ne=xt&&xt[rv]),_e&&(D[vB]=_e,D.endpointUrl=ne)),ht())}catch{ke||ht()}})):ht(),dr(Lt=We.ref(We.cfg,Dg),function(Ie){We.ref(Lt,Ie)})))})),ce=l0e(e,ee,(o=Pe)&&Re[Lw](),ce),H(e[ef](function(We){var rt;We.cfg.enablePerfMgr?(rt=We.cfg[pI],Ae!==rt&&(Pa(We.cfg,pI,rt=rt||o0e),Ae=rt,l=null),a||l||!Gn(rt)||(l=rt(Re,Re[Lw]()))):Ae=l=null})),Re[Xi]=ae;var Ae,Pe=D[Fg];(g=[])[Ur].apply(g,NB(NB([],Q,!1),Pe)),_=D[sf],Qt(null),x&&x[Un]!==0||Ts("No "+sf+" available"),_&&1<_[Un]&&((ae=Re[iv]("TeeChannelController"))&&ae.plugin||Ut(r,1,28,"TeeChannel required")),c0e(D,J,r),t=!(J=null),je===gh.ACTIVE&&Rt()},Re.getChannels=function(){var D=[];return x&&on(x,function(Q){D[Ur](Q)}),tu(D)},Re.track=function(D){yx(Re[Xw](),function(){return"AppInsightsCore:track"},function(){D===null&&(B(D),Ts("Invalid telemetry item")),!D[ru]&&bt(D[ru])&&(B(D),Ts("telemetry name required")),D[ov]=D[ov]||_e,D[Ig]=D[Ig]||Bg(new Date),D.ver=D.ver||"4.0",!C&&Re[nl]()&&je===gh.ACTIVE?qn()[Aa](D):je!==gh[j2]&&i[Un]<=Ee&&i[Ur](D)},function(){return{item:D}},!D.sync)},Re[bB]=qn,Re[Lw]=function(){return o||(o=new zve(e.cfg),Re[t0e]=o),o},Re[Ow]=function(D){Re.getNotifyMgr()[Ow](D)},Re[kw]=function(D){o&&o[kw](D)},Re.getCookieMgr=function(){return h=h||Tv(e.cfg,Re[Xi])},Re.setCookieMgr=function(D){h!==D&&(Ug(h,!1),h=D)},Re[Xw]=function(){return a||l||Hve()},Re.setPerfMgr=function(D){a=D},Re.eventCnt=function(){return i[Un]},Re.releaseQueue=function(){var D;t&&0<i[Un]&&(D=i,i=[],je===2?on(D,function(Q){Q[ov]=Q[ov]||_e,qn()[Aa](Q)}):Ut(r,2,20,"core init status is not active"))},Re[wB]=function(D){return L=D||null,at=!1,Be&&Be[Ag](),dn(!0)},Re[xB]=function(){at=!0,Be&&Be[Ag](),En()},pv(Re,function(){return M},["addTelemetryInitializer"]),Re[yh]=function(D,Q,ae){D===void 0&&(D=!0),t||Ts(n0e),C&&Ts(KU),(q={reason:50})[Mg]=D,q.flushComplete=!1;var q,Ae,Pe=q,We=(D&&!Q&&(Ae=lu(function(rt){Q=rt})),_x(Mn(),Re));return We[Nw](function(){ee.run(Re[Xi]),yU([h,o,r],D,function(){Ge(),Q&&Q(Pe)})},Re),En(),lt(D,function(rt){Pe.flushComplete=rt,C=!0,z.run(We,Pe),Re[xB](),We[Aa](Pe)},6,ae),Ae},Re[iv]=ln,Re.addPlugin=function(D,Q,ae,q){var Ae,Pe,We;function rt(){g[Ur](D),Pe.added=[D],Qt(Pe),q&&q(!0)}D?(Ae=ln(D[mh]))&&!Q?(q&&q(!1),he("Plugin ["+D[mh]+"] is already loaded!")):(Pe={reason:16},Ae?Ot(We=[Ae.plugin],{reason:2,isAsync:!!ae},function(Et){Et?(Pe.removed=We,Pe.reason|=32,rt()):q&&q(!1)}):rt()):(q&&q(!1),he(YU))},Re.updateCfg=function(D,Q){var ae,q;Q===void 0&&(Q=!0),Re[nl]()&&(ae={reason:1,cfg:e.cfg,oldCfg:dB({},e.cfg),newConfig:dB({},D),merge:Q},D=ae.newConfig,q=e.cfg,D[Fg]=q[Fg],D[sf]=q[sf]),e._block(function(Ae){var Pe=Ae.cfg;JI(Ae,Pe,D,Q),Q||dr(Pe,function(We){hh(D,We)||Ae.set(Pe,We,al)}),Ae[Sg](Pe,QI)},!0),e[Mw](),ae&&Pt(ae)},Re.evtNamespace=function(){return F},Re.flush=lt,Re.getTraceCtx=function(D){return se=se||Wve()},Re.setTraceCtx=function(D){se=D||null},Re.addUnloadHook=H,Jw(Re,"addUnloadCb",function(){return z},"add"),Re.onCfgChange=function(D){return D=t?Qi(e.cfg,D,Re[Xi]):s0e(J,D),u0e(D)},Re.getWParam=function(){return X6()||e.cfg.enableWParam?0:-1}})}return n.__ieDyn=1,n}();function eP(n,e){try{if(n&&n!==""){var t=xc().parse(n);if(t&&t[IB]&&t[IB]>=t.itemsAccepted&&t.itemsReceived-t.itemsAccepted===t.errors[Un])return t}}catch(r){Ut(e,1,43,"Cannot parse the response. "+(r[ru]||rn(r)),{response:n})}return null}var hl="",d0e="NoResponseBody",QU="&"+d0e+"=true",tP="POST",f0e=function(){function n(){var e,t,r,i,o,a,l,h,p,g,_,x,C,M=0;mi(n,this,function(L,F){var z=!0;function ee(ne,Ee){Ut(r,2,26,"Failed to send telemetry.",{message:ne}),se(Ee,400,{})}function ce(ne){ee("No endpoint url is provided for the batch",ne)}function se(ne,Ee,ke,Be){try{ne&&ne(Ee,ke,Be)}catch{}}function _e(ne,Ee){var ke,Be=el();return(ke=ne[lv])?(ke=ne[lv]+(x?QU:hl),ne=ne[kg],ne=i?ne:new Blob([ne],{type:"text/plain;charset=UTF-8"}),Be.sendBeacon(ke,ne)):(ce(Ee),!0)}function J(ne,Ee,ke){var Be,Ze=ne[kg];try{Ze&&(_e(ne,Ee)?se(Ee,200,{},hl):(Be=o&&o.beaconOnRetry)&&Gn(Be)?Be(ne,Ee,_e):(l&&l[PB](ne,Ee,!0),Ut(r,2,40,". Failed to send telemetry with Beacon API, retried with normal sender.")))}catch(at){i&&hf(r,"Failed to send telemetry using sendBeacon API. Ex:"+rn(at)),se(Ee,i?0:400,{},hl)}}function pe(ne,Ee,ke){var Be,Ze,at,Re,ht=ne[W2]||{},Rt=(!ke&&e&&(Be=lu(function(wt,Ge){Ze=wt,at=Ge})),i&&ke&&ne.disableXhrSync&&(ke=!1),ne[lv]);if(Rt)return Re=B_e(tP,Rt,z,!0,ke,ne[Lg]),i||Re[MB]("Content-type","application/json"),on(eu(ht),function(wt){Re[MB](wt,ht[wt])}),Re.onreadystatechange=function(){i||(dn(Re),Re.readyState===4&&Ze&&Ze(!0))},Re.onload=function(){i&&dn(Re)},Re.onerror=function(wt){se(Ee,i?Re[cv]:400,EI(Re,i),i?hl:tx(Re)),at&&at(wt)},Re.ontimeout=function(){se(Ee,i?Re[cv]:500,EI(Re,i),i?hl:tx(Re)),Ze&&Ze(!1)},Re.send(ne[kg]),Be;function dn(wt){var Ge=o&&o.xhrOnComplete;Ge&&Gn(Ge)?Ge(wt,Ee,ne):(Ge=ex(wt),se(Ee,wt[cv],EI(wt,i),Ge))}ce(Ee),Ze&&Ze(!1)}function ue(ne,Ee,ke){var Be,Ze,at,Re=ne[lv],wt=ne[kg],ht=i?wt:new Blob([wt],{type:"application/json"}),Rt=new Headers,dn=wt[Un],wt=!1,Ge=!1,qn=ne[W2]||{},Qt=((ht={method:tP,body:ht})[_U]=!0,ne.headers&&0<eu(ne.headers)[Un]&&(on(eu(qn),function(Ot){Rt.append(Ot,qn[Ot])}),ht[W2]=Rt),z&&i&&(ht.credentials="include"),ke&&(ht.keepalive=!0,M+=dn,i?ne._sendReason===2&&(wt=!0,x)&&(Re+=QU):wt=!0),new Request(Re,ht));try{Qt[_U]=!0}catch{}if(!ke&&e&&(Be=lu(function(Ot,En){Ze=Ot,at=En})),Re){try{cu(fetch(i?Re:Qt,i?ht:null),function(Ot){if(ke&&(M-=dn,dn=0),!Ge)if(Ge=!0,Ot.rejected)ln(Ot.reason&&Ot.reason[rf]),at&&at(Ot.reason);else{var En=Ot[rv];try{i||En.ok?i&&!En.body?(Mn(En,null,hl),Ze&&Ze(!0)):cu(En.text(),function(lt){Mn(En,ne,lt[rv]),Ze&&Ze(!0)}):(ln(En.statusText),Ze&&Ze(!1))}catch(lt){ln(rn(lt)),at&&at(lt)}}})}catch(Ot){Ge||(ln(rn(Ot)),at&&at(Ot))}return wt&&!Ge&&(Ge=!0,se(Ee,200,{}),Ze)&&Ze(!0),i&&!Ge&&0<ne[Lg]&&C&&C.set(function(){Ge||(Ge=!0,se(Ee,500,{}),Ze&&Ze(!0))},ne[Lg]),Be}function ln(Ot){se(Ee,i?0:400,{},i?hl:Ot)}function Mn(Ot,En,lt){var Pt=Ot[cv],he=o.fetchOnComplete;he&&Gn(he)?he(Ot,Ee,lt||hl,En):se(Ee,Pt,{},lt||hl)}ce(Ee),Ze&&Ze(!1)}function xe(ne,Ee,ke){var at=Ka(),Be=new XDomainRequest,Ze=ne[kg],at=(Be.onload=function(){var ht=ex(Be),Rt=o&&o.xdrOnComplete;Rt&&Gn(Rt)?Rt(Be,Ee,ne):se(Ee,200,{},ht)},Be.onerror=function(){se(Ee,400,{},i?hl:QB(Be))},Be.ontimeout=function(){se(Ee,500,{})},Be.onprogress=function(){},at&&at.location&&at.location[TB]||""),Re=ne[lv];Re?i||Re.lastIndexOf(at,0)===0?(at=i?Re:Re[of](/^(https?:)/,""),Be.open(tP,at),ne[Lg]&&(Be[Lg]=ne[Lg]),Be.send(Ze),i&&ke?C&&C.set(function(){Be.send(Ze)},0):Be.send(Ze)):(Ut(r,2,40,". "+(Re="Cannot send XDomain request. The endpoint URL protocol doesn't match the hosting page protocol.")),ee(Re,Ee)):ce(Ee)}function je(){M=0,x=_=g=p=h=e=t=!1,C=l=a=o=i=r=null}je(),L[nv]=function(ne,Ee){r=Ee,t&&Ut(r,1,28,"Sender is already initialized"),L.SetConfig(ne),t=!0},L._getDbgPlgTargets=function(){return[t,i,a,e]},L.SetConfig=function(ne){try{var Ee;return o=ne.senderOnCompleteCallBack||{},a=!!ne.disableCredentials,i=!!ne.isOneDs,e=!!ne.enableSendPromise,h=!!ne.disableXhr,p=!!ne.disableBeacon,g=!!ne.disableBeaconSync,C=ne.timeWrapper,x=!!ne.addNoResponse,_=!!ne.disableFetchKeepAlive,l={sendPOST:pe},i||(z=!1),a&&(Ee=cl())&&Ee.protocol&&Ee.protocol[Tg]()==="file:"&&(z=!1),!0}catch{}return!1},L.getSyncFetchPayload=function(){return M},L.getSenderInst=function(ne,Ee){if(ne&&ne[Un]){for(var ke=ne,Be=Ee,Ze=0,at=null,Re=0;at==null&&Re<ke[Un];)Ze=ke[Re],h||Ze!==1?Ze!==2||!PI(Be)||Be&&_?Ze!==3||!yv()||(Be?g:p)||(at=J):at=ue:eve()?at=xe:nx()&&(at=pe),Re++;return at?((ne={_transport:Ze,_isSync:Be})[PB]=at,ne):null}return null},L.getFallbackInst=function(){return l},L[Bw]=function(ne,Ee){je()}})}return n.__ieDyn=1,n}(),JU="on",e8="attachEvent",t8="addEventListener",n8="detachEvent",r8="removeEventListener",nP="events",rP="visibilitychange",vx="pagehide",i8="unload",o8="beforeunload",a8=Ws("aiEvtPageHide"),p0e=(Ws("aiEvtPageShow"),/\.[\.]+/g),g0e=/[\.]+$/,m0e=1,bx=dU("events"),y0e=/^([^.]*)(?:\.(.+)|)/;function s8(n){return n&&n[of]?n[of](/^[\s\.]+|(?=[\s\.])[\.\s]+$/g,br):n}function iP(i,r){r&&(t=br,hr(r)?(t=br,on(r,function(o){(o=s8(o))&&(o[0]!=="."&&(o="."+o),t+=o)})):t=s8(r),t)&&(t[0]!=="."&&(t="."+t),i=(i||br)+t);var t,r=y0e.exec(i||br)||[],i={};return i[ou]=r[1],i.ns=(r[2]||br).replace(p0e,".").replace(g0e,br)[Rg](".").sort().join("."),i}function c8(n,e,t){return n=bx.get(n,nP,{},t=t===void 0?!0:t),n[e]||(n[e]=[])}function l8(n,e,t,r){n&&e&&e[ou]&&(n[r8]?n[r8](e[ou],t,r):n[n8]&&n[n8](JU+e[ou],t))}function _0e(n,e,t,r){var i=!1;return n&&e&&e[ou]&&t&&(n[t8]?(n[t8](e[ou],t,r),i=!0):n[e8]&&(n[e8](JU+e[ou],t),i=!0)),i}function u8(n,e,t,r){for(var i=e[Un];i--;){var o=e[i];!o||t.ns&&t.ns!==o.evtName.ns||r&&!r(o)||(l8(n,o.evtName,o[G2],o.capture),e[Cg](i,1))}}function v0e(n,e,t){var r;e[ou]?u8(n,c8(n,e[ou]),e,t):(dr(r=bx.get(n,nP,{}),function(i,o){u8(n,o,e,t)}),eu(r)[Un]===0&&bx.kill(n,nP))}function Sh(n,e){var t=e?iP("xx",t=hr(e)?[n].concat(e):[n,e]).ns[Rg]("."):n;return t}function uu(n,e,t,r,i){i===void 0&&(i=!1);var o,a=!1;if(n)try{var l,h=iP(e,r);(a=_0e(n,h,t,i))&&bx.accept(n)&&((o={guid:m0e++,evtName:h})[G2]=t,o.capture=i,l=o,c8(n,h.type)[Ur](l))}catch{}return a}function Hg(n,e,t,r,i){if(i===void 0&&(i=!1),n)try{var o=iP(e,r),a=!1;v0e(n,o,function(l){return!((!o.ns||t)&&l[G2]!==t)&&(a=!0)}),a||l8(n,o,t,i)}catch{}}function b0e(n,e,t){var r=!1,i=Ka(),i=(i&&(r=uu(i,n,e,t),r=uu(i.body,n,e,t)||r),ca());return r=i&&uu(i,n,e,t)||r}function w0e(n,e,t){var r=Ka(),r=(r&&(Hg(r,n,e,t),Hg(r.body,n,e,t)),ca());r&&Hg(r,n,e,t)}function wx(n,e,t,r){var i=!1;return e&&n&&0<n[Un]&&on(n,function(o){!o||t&&la(t,o)!==-1||(i=b0e(o,e,r)||i)}),i}function x0e(n,e,t,r){var i=!1;return i=e&&n&&hr(n)&&!(i=wx(n,e,t,r))&&t&&0<t[Un]?wx(n,e,null,r):i}function oP(n,e,t){n&&hr(n)&&on(n,function(r){r&&w0e(r,e,t)})}function E0e(n,e,t){return x0e([o8,i8,vx],n,e,t)}function T0e(n,e){oP([o8,i8,vx],n,e)}function aP(n,e,t){var r=Sh(a8,t),i=wx([vx],n,e,r);return i=!(i=e&&la(e,rP)!==-1?i:wx([rP],function(o){var a=ca();n&&a&&a.visibilityState==="hidden"&&n(o)},e,r)||i)&&e?aP(n,null,t):i}function S0e(n,e){e=Sh(a8,e),oP([vx],n,e),oP([rP],null,e)}var h8="_aiHooks",d8=["req","rsp","hkErr","fnErr"];function sP(n,e){if(n)for(var t=0;t<n[Un]&&!e(n[t],t);t++);}function cP(n,e,t,r,i){0<=i&&i<=2&&sP(n,function(l,a){var l=l.cbks,h=l[d8[i]];if(h){e.ctx=function(){return r[a]=r[a]||{}};try{h[tf](e.inst,t)}catch(g){h=e.err;try{var p=l[d8[2]];p&&(e.err=g,p[tf](e.inst,t))}catch{}finally{e.err=h}}}})}function C0e(n){return function(){var e=arguments,t=n.h,r=((i={})[ru]=n.n,i.inst=this,i.ctx=null,i.set=function(h,p){(e=a([],e))[h]=p,o=a([r],e)},i),i=[],o=a([r],e);function a(h,p){return sP(p,function(g){h[Ur](g)}),h}r.evt=Fi("event"),cP(t,r,o,i,0);var l=n.f;if(l)try{r.rslt=l[tf](this,e)}catch(h){throw r.err=h,cP(t,r,o,i,3),h}return cP(t,r,o,i,1),r.rslt}}function lP(n,e,t,r){var i=null;return n&&(Hs(n,e)?i=n:t&&(i=lP(O_e(n),e,r,!1))),i}function A0e(n,e,t){return n?uP(n[ol],e,t,!1):null}function f8(o,e,t,r){var i=t&&t[h8],o=(i||((t=C0e(i={i:0,n:e,f:t,h:[]}))[h8]=i,o[e]=t),{id:i.i,cbks:r,rm:function(){var a=this.id;sP(i.h,function(l,h){if(l.id===a)return i.h[Cg](h,1),1})}});return i.i++,i.h[Ur](o),o}function uP(n,e,t,r,i){return r===void 0&&(r=!0),n&&e&&t&&(n=lP(n,e,r,i),n&&(r=n[e],typeof r===RB))?f8(n,e,r,t):null}function xx(n,e,t,r,i){return n&&e&&t&&(r=lP(n,e,r,i)||n,r)?f8(r,e,r[e],t):null}var Ex="Microsoft_ApplicationInsights_BypassAjaxInstrumentation",p8="sampleRate",hP="ProcessLegacy",g8="http.method",dP="https://dc.services.visualstudio.com",Gg="/v2/track",dl="not_specified",fP="iKey",ei=i_e({requestContextHeader:[0,"Request-Context"],requestContextTargetKey:[1,"appId"],requestContextAppIdFormat:[2,"appId=cid-v1:"],requestIdHeader:[3,"Request-Id"],traceParentHeader:[4,"traceparent"],traceStateHeader:[5,"tracestate"],sdkContextHeader:[6,"Sdk-Context"],sdkContextHeaderAppIdRequest:[7,"appId"],requestContextHeaderLowerCase:[8,"request-context"]}),qg="split",Xn="length",Av="toLowerCase",gf="ingestionendpoint",$g="toString",Tx="push",pP="removeItem",Tc="name",Ch="message",Wg="count",gP="preTriggerDate",mP="disabled",yP="interval",m8="daysOfMonth",_P="date",vP="getUTCDate",Sx="stringify",bP="pathname",y8="correlationHeaderExcludePatterns",Yg="exceptions",Sc="parsedStack",fl="properties",hu="measurements",Kg="sizeInBytes",du="typeName",Iv="severityLevel",wP="problemGroup",xP="isManual",_8="CreateFromInterface",Zg="assembly",mf="fileName",Cx="hasFullStack",Ax="level",Xg="method",Pv="line",Ix="duration",v8="receivedResponse";function b8(n,e,t){var r=e[Xn],i=I0e(n,e);if(i[Xn]!==r){for(var o=0,a=i;t[a]!==void 0;)o++,a=Jc(i,0,147)+R0e(o);i=a}return i}function I0e(n,e){var t;return e&&150<(e=ho(Ya(e)))[Xn]&&(t=Jc(e,0,150),Ut(n,2,57,"name is too long.  It has been truncated to 150 characters.",{name:e},!0)),t||e}function po(n,e,t){var r;return t===void 0&&(t=1024),e&&(t=t||1024,(e=ho(Ya(e)))[Xn]>t)&&(r=Jc(e,0,t),Ut(n,2,61,"string value is too long. It has been truncated to "+t+" characters.",{value:e},!0)),r||e}function Px(n,e){return x8(n,e,2048,66)}function w8(n,e){var t;return e&&32768<e[Xn]&&(t=Jc(e,0,32768),Ut(n,2,56,"message is too long, it has been truncated to 32768 characters.",{message:e},!0)),t||e}function P0e(n,e){var t,r;return e&&32768<(r=""+e)[Xn]&&(t=Jc(r,0,32768),Ut(n,2,52,"exception is too long, it has been truncated to 32768 characters.",{exception:e},!0)),t||e}function yf(n,e){var t;return e&&(t={},dr(e,function(r,i){if(Wa(i)&&mv())try{i=xc()[Sx](i)}catch(o){Ut(n,2,49,"custom property is not valid",{exception:o},!0)}i=po(n,i,8192),r=b8(n,r,t),t[r]=i}),e=t),e}function _f(n,e){var t;return e&&(t={},dr(e,function(r,i){r=b8(n,r,t),t[r]=i}),e=t),e}function M0e(n,e){return e&&x8(n,e,128,69)[$g]()}function x8(n,e,t,r){var i;return e&&(e=ho(Ya(e)))[Xn]>t&&(i=Jc(e,0,t),Ut(n,2,r,"input is too long, it has been truncated to "+t+" characters.",{data:e},!0)),i||e}function R0e(n){return n="00"+n,dh(n,n[Xn]-3)}var E8=ca()||{},T8=0,k0e=[null,null,null,null,null];function EP(n){var e=T8,t=k0e,r=t[e];return E8.createElement?t[e]||(r=t[e]=E8.createElement("a")):r={host:N0e(n,!0)},r.href=n,++e>=t[Xn]&&(e=0),T8=e,r}function O0e(t){var e,t=EP(t);return e=t?t.href:e}function L0e(n,e){return n?n.toUpperCase()+" "+e:e}function N0e(n,e){return n=S8(n,e)||"",n&&(e=n.match(/(www\d{0,5}\.)?([^\/:]{1,256})(:\d{1,20})?/i),e!=null&&3<e[Xn]&&Pn(e[2])&&0<e[2][Xn])?e[2]+(e[3]||""):n}function S8(n,e){var t=null;return n&&(n=n.match(/(\w{1,150}):\/\/([^\/:]{1,256})(:\d{1,20})?/i))!=null&&2<n[Xn]&&Pn(n[2])&&0<n[2][Xn]&&(t=n[2]||"",e)&&2<n[Xn]&&(e=(n[1]||"")[Av](),n=n[3]||"",t+=n=e==="http"&&n===":80"||e==="https"&&n===":443"?"":n),t}var D0e=[dP+Gg,"https://breeze.aimon.applicationinsights.io"+Gg,"https://dc-int.services.visualstudio.com"+Gg],F0e="cid-v1:";function TP(n){return la(D0e,n[Av]())!==-1}function C8(n,e,a){if(!e||n&&n.disableCorrelationHeaders)return!1;if(n&&n[y8]){for(var r=0;r<n.correlationHeaderExcludePatterns[Xn];r++)if(n[y8][r].test(e))return!1}var i=EP(e).host[Av]();if(!i||Za(i,":443")===-1&&Za(i,":80")===-1||(i=(S8(e,!0)||"")[Av]()),(!n||!n.enableCorsCorrelation)&&i&&i!==a)return!1;var o,a=n&&n.correlationHeaderDomains;if(a&&(on(a,function(h){h=new RegExp(h.toLowerCase().replace(/\\/g,"\\\\").replace(/\./g,"\\.").replace(/\*/g,".*")),o=o||h.test(i)}),!o))return!1;var l=n&&n.correlationHeaderExcludedDomains;if(!l||l[Xn]===0)return!0;for(r=0;r<l[Xn];r++)if(new RegExp(l[r].toLowerCase().replace(/\\/g,"\\\\").replace(/\./g,"\\.").replace(/\*/g,".*")).test(i))return!1;return i&&0<i[Xn]}function A8(n){if(n&&(n=B0e(n,ei[1]),n&&n!==F0e))return n}function B0e(n,e){if(n)for(var t=n[qg](","),r=0;r<t[Xn];++r){var i=t[r][qg]("=");if(i[Xn]===2&&i[0]===e)return i[1]}}function U0e(n,e,t,r){var i,o,a,l=r,h=r;return l=e&&0<e[Xn]?(a=(i=EP(e)).host,l||(i[bP]!=null?((o=i.pathname[Xn]===0?"/":i[bP]).charAt(0)!=="/"&&(o="/"+o),h=i[bP],po(n,t?t+" "+o:o)):po(n,e))):a=r,{target:a,name:l,data:h}}function Mx(){var n=nu();return n&&n.now&&n.timing&&(n=n.now()+n.timing.navigationStart,0<n)?n:tl()}function Xa(n,e){var t=null;return t=n===0||e===0||bt(n)||bt(e)?t:e-n}function SP(n,e){var t=n||{};return{getName:function(){return t[Tc]},setName:function(r){e&&e.setName(r),t[Tc]=r},getTraceId:function(){return t.traceID},setTraceId:function(r){e&&e.setTraceId(r),WI(r)&&(t.traceID=r)},getSpanId:function(){return t.parentID},setSpanId:function(r){e&&e.setSpanId(r),YI(r)&&(t.parentID=r)},getTraceFlags:function(){return t.traceFlags},setTraceFlags:function(r){e&&e.setTraceFlags(r),t.traceFlags=r}}}var Mv=yB({LocalStorage:0,SessionStorage:1}),Ah=void 0,Ih=void 0,I8="";function CP(){return kx()?Rx(Mv.LocalStorage):null}function Rx(n){try{if(bt(qs()))return null;var e=new Date()[$g](),t=Fi(n===Mv.LocalStorage?"localStorage":"sessionStorage"),r=I8+e,i=(t.setItem(r,e),t.getItem(r)!==e);if(t[pP](r),!i)return t}catch{}return null}function AP(){return Rv()?Rx(Mv.SessionStorage):null}function z0e(){Ih=Ah=!1}function IP(n){I8=n||""}function j0e(){Ah=kx(!0),Ih=Rv(!0)}function kx(n){return Ah=!n&&Ah!==void 0?Ah:!!Rx(Mv.LocalStorage)}function P8(n,e){var t=CP();if(t!==null)try{return t.getItem(e)}catch(r){Ah=!1,Ut(n,2,1,"Browser failed read of local storage. "+Dr(r),{exception:rn(r)})}return null}function M8(n,e,t){var r=CP();if(r!==null)try{return r.setItem(e,t),!0}catch(i){Ah=!1,Ut(n,2,3,"Browser failed write to local storage. "+Dr(i),{exception:rn(i)})}return!1}function V0e(n,e){var t=CP();if(t!==null)try{return t[pP](e),!0}catch(r){Ah=!1,Ut(n,2,5,"Browser failed removal of local storage item. "+Dr(r),{exception:rn(r)})}return!1}function Rv(n){return Ih=!n&&Ih!==void 0?Ih:!!Rx(Mv.SessionStorage)}function PP(n,e){var t=AP();if(t!==null)try{return t.getItem(e)}catch(r){Ih=!1,Ut(n,2,2,"Browser failed read of session storage. "+Dr(r),{exception:rn(r)})}return null}function R8(n,e,t){var r=AP();if(r!==null)try{return r.setItem(e,t),!0}catch(i){Ih=!1,Ut(n,2,4,"Browser failed write to session storage. "+Dr(i),{exception:rn(i)})}return!1}function k8(n,e){var t=AP();if(t!==null)try{return t[pP](e),!0}catch(r){Ih=!1,Ut(n,2,6,"Browser failed removal of session storage item. "+Dr(r),{exception:rn(r)})}return!1}var H0e="appInsightsThrottle",G0e=function(n,e){var t,r,i,o,a,l,h,p=this,g=!1,_=!1;function x(pe,ue,xe,je){if(g){if(!function(Rt){try{var dn=C(Rt);return ave(1e6)<=dn.limit.samplingRate}catch{}return!1}(pe))return;var ne=C(pe),Ee=se(pe),ke=L(ne,t,Ee),Be=!1,Ze=0,at=_e(pe);try{ke&&!at?(Ze=Math.min(ne.limit.maxSendNumber,Ee[Wg]+1),Be=!(Ee[Wg]=0),a[pe]=!0,Ee[gP]=new Date):(a[pe]=ke,Ee[Wg]+=1);var Re=F(pe);ee(r,Re,Ee);for(var ht=0;ht<Ze;ht++)Ut(r,xe||1,pe,ue)}catch{}return{isThrottled:Be,throttleNum:Ze}}return je&&J(pe)[Tx]({msgID:pe,message:ue,severity:xe}),null}function C(pe){return i[pe]||i[109]}function M(pe,ue){var xe,je;try{var ne=ue||{},Ee={},ke=(Ee[mP]=!!ne[mP],ne[yP]||{}),Be=(_=(ke===null?void 0:ke.daysOfMonth)&&0<(ke===null?void 0:ke.daysOfMonth[Xn]),Ee[yP]=function(Ze){var at=(Ze=Ze||{})==null?void 0:Ze.monthInterval,Re=Ze==null?void 0:Ze.dayInterval;return bt(at)&&bt(Re)&&(Ze.monthInterval=3,_||(Ze[m8]=[28],_=!0)),Ze={monthInterval:Ze==null?void 0:Ze.monthInterval,dayInterval:Ze==null?void 0:Ze.dayInterval,daysOfMonth:Ze==null?void 0:Ze.daysOfMonth}}(ke),{samplingRate:((xe=ne.limit)==null?void 0:xe.samplingRate)||100,maxSendNumber:((je=ne.limit)==null?void 0:je.maxSendNumber)||1});Ee.limit=Be,i[pe]=Ee}catch{}}function L(pe,ue,xe){var je,ne;return!(!pe||pe[mP]||!ue||!lf(xe))&&(ue=z(),xe=xe[_P],je=1,(pe=pe[yP])!=null&&pe.monthInterval&&(ne=12*(ue.getUTCFullYear()-xe.getUTCFullYear())+ue.getUTCMonth()-xe.getUTCMonth(),je=ce(pe.monthInterval,0,ne)),ne=1,_?ne=la(pe[m8],ue[vP]()):pe!=null&&pe.dayInterval&&(ue=Math.floor((ue.getTime()-xe.getTime())/864e5),ne=ce(pe.dayInterval,0,ue)),0<=je)&&0<=ne}function F(pe,ue){return ue=lf(ue)?ue:"",pe?H0e+ue+"-"+pe:null}function z(pe){try{if(!pe)return new Date;var ue=new Date(pe);if(!isNaN(ue.getDate()))return ue}catch{}return null}function ee(pe,ue,xe){try{return M8(pe,ue,ho(JSON[Sx](xe)))}catch{}}function ce(pe,ue,xe){return pe<=0?1:ue<=xe&&(xe-ue)%pe==0?Math.floor((xe-ue)/pe)+1:-1}function se(pe){try{var ue,xe=o[pe];return xe||(ue=F(pe,l),xe=function(je,ne,Ee){try{var ke,Be={date:z(),count:0};return je?{date:z((ke=JSON.parse(je))[_P])||Be[_P],count:ke[Wg]||Be[Wg],preTriggerDate:ke.preTriggerDate?z(ke[gP]):void 0}:(ee(ne,Ee,Be),Be)}catch{}return null}(P8(r,ue),r,ue),o[pe]=xe),o[pe]}catch{}return null}function _e(pe){var ue,xe=a[pe];return bt(xe)&&(xe=!1,(ue=se(pe))&&(xe=function(je){try{var ne;if(je)return ne=new Date,je.getUTCFullYear()===ne.getUTCFullYear()&&je.getUTCMonth()===ne.getUTCMonth()&&je[vP]()===ne[vP]()}catch{}return!1}(ue[gP])),a[pe]=xe),a[pe]}function J(pe){return bt((h=h||{})[pe])&&(h[pe]=[]),h[pe]}r=uf(n),a={},o={},h={},i={},M(109),l=lf(e)?e:"",n.addUnloadHook(Qi(n.config,function(pe){pe=pe.cfg,t=kx(),dr(pe.throttleMgrCfg||{},function(ue,xe){M(parseInt(ue),xe)})})),p._getDbgPlgTargets=function(){return[h]},p.getConfig=function(){return i},p.canThrottle=function(pe){var ue=se(pe);return L(C(pe),t,ue)},p.isTriggered=_e,p.isReady=function(){return g},p.flush=function(pe){try{var ue,xe=J(pe);if(xe&&0<xe[Xn])return ue=xe.slice(0),h[pe]=[],on(ue,function(je){x(je.msgID,je[Ch],je.severity,!1)}),!0}catch{}return!1},p.flushAll=function(){try{var pe;if(h)return pe=!0,dr(h,function(ue){ue=p.flush(parseInt(ue)),pe=pe&&ue}),pe}catch{}return!1},p.onReadyState=function(pe,ue){return ue===void 0&&(ue=!0),(g=!!bt(pe)||pe)&&ue?p.flushAll():null},p.sendMessage=function(pe,ue,xe){return x(pe,ue,xe,!0)}},q0e=";",$0e="=";function O8(n){var e;return n?(n=n[qg](q0e),n=Bye(n,function(t,o){var i,o=o[qg]($0e);return o[Xn]===2&&(i=o[0][Av](),o=o[1],t[i]=o),t},{}),0<eu(n)[Xn]&&(n.endpointsuffix&&(e=n.location?n.location+".":"",n[gf]=n[gf]||"https://"+e+"dc."+n.endpointsuffix),n[gf]=n[gf]||dP,gB(n[gf],"/"))&&(n[gf]=n[gf].slice(0,-1)),n):{}}var W0e=function(n,e,t){var r=this;this.ver=1,this.sampleRate=100,this.tags={},this[Tc]=po(n,t)||dl,this.data=e,this.time=Bg(new Date),this.aiDataContract={time:1,iKey:1,name:1,sampleRate:function(){return r.sampleRate===100?4:1},tags:1,data:1}},Ph=function(){function n(e,t,r,i){this.aiDataContract={ver:1,name:1,properties:0,measurements:0},this.ver=2,this[Tc]=po(e,t)||dl,this[fl]=yf(e,r),this[hu]=_f(e,i)}return n.envelopeType="Microsoft.ApplicationInsights.{0}.Event",n.dataType="EventData",n}(),Y0e="<no_method>",Qg="error",Qa="stack",MP="stackDetails",L8="errorSrc",RP="message",N8="description";function kP(n,e){var t=n;return t&&!Pn(t)&&(JSON&&JSON[Sx]?(t=JSON[Sx](n),!e||t&&t!=="{}"||(t=Gn(n[$g])?n[$g]():""+n)):t=n+" - (Missing JSON.stringify)"),t||""}function D8(n,e){var t=n;return n&&((t=t&&!Pn(t)&&(n[RP]||n[N8])||t)&&!Pn(t)&&(t=kP(t,!0)),n.filename)&&(t=t+" @"+(n.filename||"")+":"+(n.lineno||"?")+":"+(n.colno||"?")),(t=e&&e!=="String"&&e!=="Object"&&e!=="Error"&&Za(t||"",e)===-1?e+": "+t:t)||""}function K0e(n){try{if(Wa(n))return"hasFullStack"in n&&"typeName"in n}catch{}return!1}function Z0e(n){try{if(Wa(n))return"ver"in n&&"exceptions"in n&&"properties"in n}catch{}return!1}function F8(n){return n&&n.src&&Pn(n.src)&&n.obj&&hr(n.obj)}function vf(e){var e=e||"",t=(e=Pn(e)?e:Pn(e[Qa])?e[Qa]:""+e)[qg](`
`);return{src:e,obj:t}}function X0e(n){for(var e=[],t=n[qg](`
`),r=0;r<t[Xn];r++){var i=t[r];t[r+1]&&(i+="@"+t[r+1],r++),e[Tx](i)}return{src:n,obj:e}}function B8(n){var e,t=null;if(n)try{n[Qa]?t=vf(n[Qa]):n[Qg]&&n[Qg][Qa]?t=vf(n[Qg][Qa]):n.exception&&n.exception[Qa]?t=vf(n.exception[Qa]):F8(n)?t=n:F8(n[MP])?t=n[MP]:Ka()&&Ka().opera&&n[RP]?t=X0e(n[Ch]):n.reason&&n.reason[Qa]?t=vf(n.reason[Qa]):Pn(n)?t=vf(n):(e=n[RP]||n[N8]||"",Pn(n[L8])&&(e&&(e+=`
`),e+=" from "+n[L8]),e&&(t=vf(e)))}catch(r){t=vf(r)}return t||{src:"",obj:null}}function Q0e(n){var e="";return n&&(n.obj?on(n.obj,function(t){e+=t+`
`}):e=n.src||""),e}function J0e(n){if(n=n.obj,n&&0<n[Xn]){var e=[],t=0,r=0;if(on(n,function(g){var g=g[$g]();LP.regex.test(g)&&(g=new LP(g,t++),r+=g[Kg],e[Tx](g))}),32768<r)for(var i=0,o=e[Xn]-1,a=0,l=i,h=o;i<o;){if(32768<(a+=e[i][Kg]+e[o][Kg])){e.splice(l,h-l+1);break}l=i,h=o,i++,o--}}return e}function Ox(n){var e="";if(n&&!(e=n.typeName||n[Tc]||""))try{var t=/function (.{1,200})\(/.exec(n.constructor[$g]()),e=t&&1<t[Xn]?t[1]:""}catch{}return e}function OP(n){if(n)try{var e,t;if(!Pn(n))return e=Ox(n),(t=kP(n,!1))&&t!=="{}"||(n[Qg]&&(e=Ox(n=n[Qg])),t=kP(n,!0)),Za(t,e)!==0&&e!=="String"?e+":"+t:t}catch{}return""+(n||"")}var Ks=function(){function n(e,t,r,i,o,a){this.aiDataContract={ver:1,exceptions:1,severityLevel:0,properties:0,measurements:0};var l=this;l.ver=2,Z0e(t)?(l[Yg]=t[Yg]||[],l[fl]=t[fl],l[hu]=t[hu],t[Iv]&&(l[Iv]=t[Iv]),t.id&&(l.id=t.id,t[fl].id=t.id),t[wP]&&(l[wP]=t[wP]),bt(t[xP])||(l[xP]=t[xP])):(r=r||{},a&&(r.id=a),l[Yg]=[new U8(e,t,r)],l[fl]=yf(e,r),l[hu]=_f(e,i),o&&(l[Iv]=o),a&&(l.id=a))}return n.CreateAutoException=function(e,t,r,i,o,a,l,h){var p=Ox(o||a||e),g={};return g[Ch]=D8(e,p),g.url=t,g.lineNumber=r,g.columnNumber=i,g.error=OP(o||a||e),g.evt=OP(a||e),g[du]=p,g.stackDetails=B8(l||o||a),g.errorSrc=h,g},n.CreateFromInterface=function(e,t,r,i){var o=t[Yg]&&ev(t[Yg],function(a){return U8[_8](e,a)});return new n(e,Ia(Ia({},t),{exceptions:o}),r,i)},n.prototype.toInterface=function(){var l=this.exceptions,e=this.properties,t=this.measurements,r=this.severityLevel,i=this.problemGroup,o=this.id,a=this.isManual,l=l instanceof Array&&ev(l,function(p){return p.toInterface()})||void 0,h={ver:"4.0"};return h[Yg]=l,h.severityLevel=r,h.properties=e,h.measurements=t,h.problemGroup=i,h.id=o,h.isManual=a,h},n.CreateSimpleException=function(e,t,r,i,o,a){var l;return{exceptions:[((l={})[Cx]=!0,l.message=e,l.stack=o,l.typeName=t,l)]}},n.envelopeType="Microsoft.ApplicationInsights.{0}.Exception",n.dataType="ExceptionData",n.formatError=OP,n}(),U8=function(){function n(e,t,r){this.aiDataContract={id:0,outerId:0,typeName:1,message:1,hasFullStack:0,stack:0,parsedStack:2};var i,o,a=this;K0e(t)?(a[du]=t[du],a[Ch]=t[Ch],a[Qa]=t[Qa],a[Sc]=t[Sc]||[],a[Cx]=t[Cx]):(o=(i=t)&&i.evt,b2(i)||(i=i[Qg]||o||i),a[du]=po(e,Ox(i))||dl,a[Ch]=w8(e,D8(t||i,a[du]))||dl,o=t[MP]||B8(t),a[Sc]=J0e(o),hr(a[Sc])&&ev(a[Sc],function(l){l[Zg]=po(e,l[Zg]),l[mf]=po(e,l[mf])}),a[Qa]=P0e(e,Q0e(o)),a.hasFullStack=hr(a.parsedStack)&&0<a.parsedStack[Xn],r&&(r[du]=r[du]||a[du]))}return n.prototype.toInterface=function(){var e,t=this[Sc]instanceof Array&&ev(this[Sc],function(r){return r.toInterface()});return(e={id:this.id,outerId:this.outerId,typeName:this[du],message:this[Ch],hasFullStack:this[Cx],stack:this[Qa]})[Sc]=t||void 0,e},n.CreateFromInterface=function(e,t){var r=t[Sc]instanceof Array&&ev(t[Sc],function(i){return LP[_8](i)})||t[Sc];return new n(e,Ia(Ia({},t),{parsedStack:r}))},n}(),LP=function(){function n(e,t){this.aiDataContract={level:1,method:1,assembly:0,fileName:0,line:0};var r,i=this;i[Kg]=0,typeof e=="string"?(r=e,i[Ax]=t,i[Xg]=Y0e,i[Zg]=ho(r),i[mf]="",i[Pv]=0,(t=r.match(n.regex))&&5<=t[Xn]&&(i[Xg]=ho(t[2])||i[Xg],i[mf]=ho(t[4]),i[Pv]=parseInt(t[5])||0)):(i[Ax]=e[Ax],i[Xg]=e[Xg],i[Zg]=e[Zg],i[mf]=e[mf],i[Pv]=e[Pv],i[Kg]=0),i.sizeInBytes+=i.method[Xn],i.sizeInBytes+=i.fileName[Xn],i.sizeInBytes+=i.assembly[Xn],i[Kg]+=n.baseSize,i.sizeInBytes+=i.level.toString()[Xn],i.sizeInBytes+=i.line.toString()[Xn]}return n.CreateFromInterface=function(e){return new n(e,null)},n.prototype.toInterface=function(){return{level:this[Ax],method:this[Xg],assembly:this[Zg],fileName:this[mf],line:this[Pv]}},n.regex=/^([\s]+at)?[\s]{0,50}([^\@\()]+?)[\s]{0,50}(\@|\()([^\(\n]+):([0-9]+):([0-9]+)(\)?)$/,n.baseSize=58,n}(),ebe=function(){this.aiDataContract={name:1,kind:0,value:1,count:0,min:0,max:0,stdDev:0},this.kind=0},bf=function(){function n(e,t,r,i,o,a,l,h,p){this.aiDataContract={ver:1,metrics:1,properties:0},this.ver=2;var g=new ebe;g[Wg]=0<i?i:void 0,g.max=isNaN(a)||a===null?void 0:a,g.min=isNaN(o)||o===null?void 0:o,g[Tc]=po(e,t)||dl,g.value=r,g.stdDev=isNaN(l)||l===null?void 0:l,this.metrics=[g],this[fl]=yf(e,h),this[hu]=_f(e,p)}return n.envelopeType="Microsoft.ApplicationInsights.{0}.Metric",n.dataType="MetricData",n}(),kv="";function Mh(o){(isNaN(o)||o<0)&&(o=0),o=Math.round(o);var e=kv+o%1e3,t=kv+Math.floor(o/1e3)%60,r=kv+Math.floor(o/6e4)%60,i=kv+Math.floor(o/36e5)%24,o=Math.floor(o/864e5);return(0<o?o+".":kv)+(i[Xn]<2?"0"+i:i)+":"+(r[Xn]<2?"0"+r:r)+":"+(t[Xn]<2?"0"+t:t)+"."+(e[Xn]===1?"00"+e:e[Xn]===2?"0"+e:e)}function tbe(n,e,t,r,i){return!i&&Pn(n)&&(n==="Script error."||n==="Script error")}var Rh=function(){function n(e,t,r,i,o,a,l){this.aiDataContract={ver:1,name:0,url:0,duration:0,properties:0,measurements:0,id:0},this.ver=2,this.id=M0e(e,l),this.url=Px(e,r),this[Tc]=po(e,t)||dl,isNaN(i)||(this[Ix]=Mh(i)),this[fl]=yf(e,o),this[hu]=_f(e,a)}return n.envelopeType="Microsoft.ApplicationInsights.{0}.Pageview",n.dataType="PageviewData",n}(),wf=function(){function n(e,M,r,i,o,a,l,h,p,g,_,x){p===void 0&&(p="Ajax"),this.aiDataContract={id:1,ver:1,name:0,resultCode:0,duration:0,success:0,data:0,target:0,type:0,properties:0,measurements:0,kind:0,value:0,count:0,min:0,max:0,stdDev:0,dependencyKind:0,dependencySource:0,commandName:0,dependencyTypeName:0};var C=this,M=(C.ver=2,C.id=M,C[Ix]=Mh(o),C.success=a,C.resultCode=l+"",C.type=po(e,p),U0e(e,r,h,i));C.data=Px(e,i)||M.data,C.target=po(e,M.target),g&&(C.target="".concat(C.target," | ").concat(g)),C[Tc]=po(e,M[Tc]),C[fl]=yf(e,_),C[hu]=_f(e,x)}return n.envelopeType="Microsoft.ApplicationInsights.{0}.RemoteDependency",n.dataType="RemoteDependencyData",n}(),Jg=function(){function n(e,t,r,i,o){this.aiDataContract={ver:1,message:1,severityLevel:0,properties:0},this.ver=2,this[Ch]=w8(e,t=t||dl),this[fl]=yf(e,i),this[hu]=_f(e,o),r&&(this[Iv]=r)}return n.envelopeType="Microsoft.ApplicationInsights.{0}.Message",n.dataType="MessageData",n}(),em=function(){function n(e,t,r,i,o,a,l){this.aiDataContract={ver:1,name:0,url:0,duration:0,perfTotal:0,networkConnect:0,sentRequest:0,receivedResponse:0,domProcessing:0,properties:0,measurements:0};var h=this;h.ver=2,h.url=Px(e,r),h[Tc]=po(e,t)||dl,h[fl]=yf(e,o),h[hu]=_f(e,a),l&&(h.domProcessing=l.domProcessing,h[Ix]=l[Ix],h.networkConnect=l.networkConnect,h.perfTotal=l.perfTotal,h[v8]=l[v8],h.sentRequest=l.sentRequest)}return n.envelopeType="Microsoft.ApplicationInsights.{0}.PageviewPerformance",n.dataType="PageviewPerformanceData",n}(),xf=function(n,e){this.aiDataContract={baseType:1,baseData:1},this.baseType=n,this.baseData=e};function kh(n){var e="ai."+n+".";return function(t){return e+t}}var Ov=kh("application"),wo=kh("device"),Lx=kh("location"),tm=kh("operation"),NP=kh("session"),Oh=kh("user"),Ef=kh("cloud"),Lv=kh("internal"),z8=function(n){function e(){return n.call(this)||this}return au(e,n),e}(N_e({applicationVersion:Ov("ver"),applicationBuild:Ov("build"),applicationTypeId:Ov("typeId"),applicationId:Ov("applicationId"),applicationLayer:Ov("layer"),deviceId:wo("id"),deviceIp:wo("ip"),deviceLanguage:wo("language"),deviceLocale:wo("locale"),deviceModel:wo("model"),deviceFriendlyName:wo("friendlyName"),deviceNetwork:wo("network"),deviceNetworkName:wo("networkName"),deviceOEMName:wo("oemName"),deviceOS:wo("os"),deviceOSVersion:wo("osVersion"),deviceRoleInstance:wo("roleInstance"),deviceRoleName:wo("roleName"),deviceScreenResolution:wo("screenResolution"),deviceType:wo("type"),deviceMachineName:wo("machineName"),deviceVMName:wo("vmName"),deviceBrowser:wo("browser"),deviceBrowserVersion:wo("browserVersion"),locationIp:Lx("ip"),locationCountry:Lx("country"),locationProvince:Lx("province"),locationCity:Lx("city"),operationId:tm("id"),operationName:tm("name"),operationParentId:tm("parentId"),operationRootId:tm("rootId"),operationSyntheticSource:tm("syntheticSource"),operationCorrelationVector:tm("correlationVector"),sessionId:NP("id"),sessionIsFirst:NP("isFirst"),sessionIsNew:NP("isNew"),userAccountAcquisitionDate:Oh("accountAcquisitionDate"),userAccountId:Oh("accountId"),userAgent:Oh("userAgent"),userId:Oh("id"),userStoreRegion:Oh("storeRegion"),userAuthUserId:Oh("authUserId"),userAnonymousUserAcquisitionDate:Oh("anonUserAcquisitionDate"),userAuthenticatedUserAcquisitionDate:Oh("authUserAcquisitionDate"),cloudName:Ef("name"),cloudRole:Ef("role"),cloudRoleVer:Ef("roleVer"),cloudRoleInstance:Ef("roleInstance"),cloudEnvironment:Ef("environment"),cloudLocation:Ef("location"),cloudDeploymentUnit:Ef("deploymentUnit"),internalNodeName:Lv("nodeName"),internalSdkVersion:Lv("sdkVersion"),internalAgentVersion:Lv("agentVersion"),internalSnippet:Lv("snippet"),internalSdkSrc:Lv("sdkSrc")}));function Lh(n,e,t,l,i,o){t=po(l,t)||dl,(bt(n)||bt(e)||bt(t))&&Ts("Input doesn't contain all required fields");var a,l="",h=(n[fP]&&(l=n[fP],delete n[fP]),(a={})[Tc]=t,a.time=Bg(new Date),a.iKey=l,a.ext=o||{},a.tags=[],a.data={},a.baseType=e,a.baseData=n,a);return bt(i)||dr(i,function(p,g){h.data[p]=g}),h}var Ss={UserExt:"user",DeviceExt:"device",TraceExt:"trace",WebExt:"web",AppExt:"app",OSExt:"os",SessionExt:"ses",SDKExt:"sdk"},ai=new z8;function Nv(n){var e,t=null;return Gn(Event)?t=new Event(n):(e=ca())&&e.createEvent&&(t=e.createEvent("Event")).initEvent(n,!0,!0),t}function j8(n,e){Hg(n,null,null,e)}function nbe(n){var e,t=ca(),r=el(),i=!1,o=[],a=1,l=(!r||bt(r.onLine)||r.onLine||(a=2),0),h=_(),p=Sh(Ws("OfflineListener"),n);try{g(Ka())&&(i=!0),t&&(e=t.body||t).ononline&&g(e)&&(i=!0)}catch{i=!1}function g(L){var F=!1;return L&&(F=uu(L,"online",C,p))&&uu(L,"offline",M,p),F}function _(){return l!==2&&a!==2}function x(){var L=_();h!==L&&(h=L,on(o,function(F){var z={isOnline:h,rState:a,uState:l};try{F(z)}catch{}}))}function C(){a=1,x()}function M(){a=2,x()}return{isOnline:function(){return h},isListening:function(){return i},unload:function(){var L=Ka();L&&i&&(j8(L,p),t&&!Ii((L=t.body||t).ononline)&&j8(L,p),i=!1)},addListener:function(L){return o[Tx](L),{rm:function(){var F=o.indexOf(L);if(-1<F)return o.splice(F,1)}}},setOnlineState:function(L){l=L,x()}}}var Nx="AppInsightsPropertiesPlugin",V8="AppInsightsChannelPlugin",H8="ApplicationInsightsAnalytics",Dx="toString",DP="isStorageUseDisabled",nm="_addHook",Yo="core",Nh="dataType",Tf="envelopeType",Cs="diagLog",Sf="track",Fx="trackPageView",FP="trackPreviousPageVisit",Cf="sendPageViewInternal",rm="startTime",BP="properties",pl="duration",UP="sendPageViewPerformanceInternal",zP="populatePageViewPerformanceEvent",Dv="href",G8="sendExceptionInternal",jP="exception",Fv="error",VP="_onerror",HP="errorSrc",GP="lineNumber",qP="columnNumber",q8="message",$P="CreateAutoException",Bx="addTelemetryInitializer",rbe="overridePageViewDuration",$8="autoTrackPageVisitTime",W8="isBrowserLinkTrackingEnabled",Bv="length",Y8="enableAutoRouteTracking",K8="enableUnhandledPromiseRejectionTracking",WP="autoUnhandledPromiseInstrumented",YP="getEntriesByType",Z8="isPerformanceTimingSupported",X8="getPerformanceTiming",Ux="navigationStart",KP="shouldCollectDuration",Q8="isPerformanceTimingDataReady",Uv="responseStart",ibe="requestStart",zx="loadEventEnd",ZP="responseEnd",jx="connectEnd",J8="pageVisitStartTime",obe=function(){function n(e,t,r,i){mi(n,this,function(o){var a,l=null,h=[],p=!1,g=!1;function _(C){r&&r.flush(C,function(){})}function x(C){h.push(C),function M(){l=l||$s(function(){l=null;var L=h.slice(0),F=!1;h=[],on(L,function(z){z()?F=!0:h.push(z)}),0<h[Bv]&&M(),F&&_(!0)},100)}()}r&&(a=r.logger),o[Fx]=function(C,M){var L,F,z,ee,ce,se,_e=C.name,J=(!bt(_e)&&typeof _e=="string"||(F=ca(),_e=C.name=F&&F.title||""),C.uri);!bt(J)&&typeof J=="string"||(F=cl(),J=C.uri=F&&F[Dv]||""),g||((L=(F=nu())&&F[YP]&&F[YP]("navigation"))&&L[0]&&!Ii(F.timeOrigin)?(L=L[0].loadEventStart,C[rm]=new Date(F.timeOrigin+L)):(F=(M||C[BP]||{})[pl]||0,C[rm]=new Date(new Date().getTime()-F)),g=!0),i[Z8]()?(z=!1,ce=i[X8]()[Ux],0<ce&&(ee=Xa(ce,+new Date),i[KP](ee)||(ee=void 0)),bt(M)||bt(M[pl])||(se=M[pl]),!t&&isNaN(se)||(isNaN(se)&&((M=M||{})[pl]=ee),e[Cf](C,M),_(!0),z=!0),M=M||{},x(function(){var pe,ue=!1;try{i[Q8]()?(ue=!0,pe={name:_e,uri:J},i[zP](pe),pe.isValid||z?(z||(M[pl]=pe.durationMs,e[Cf](C,M)),p||(e[UP](pe,M),p=!0)):(M[pl]=ee,e[Cf](C,M))):0<ce&&6e4<Xa(ce,+new Date)&&(ue=!0,z||(M[pl]=6e4,e[Cf](C,M)))}catch(xe){Ut(a,1,38,"trackPageView failed on page load calculation: "+Dr(xe),{exception:rn(xe)})}return ue})):(e[Cf](C,M),_(!0),eB()||Ut(a,2,25,"trackPageView: navigation timing API used for calculation of page duration is not supported in this browser. This page view will be collected without duration and timing info."))},o.teardown=function(C,M){var L;l&&(l.cancel(),l=null,L=h.slice(0),h=[],on(L,function(F){F()}))}})}return n.__ieDyn=1,n}(),abe=36e5,ez=["googlebot","adsbot-google","apis-google","mediapartners-google"];function tz(){var n=nu();return n&&!!n.timing}function sbe(){var n=nu();return n&&n.getEntriesByType&&0<n.getEntriesByType("navigation")[Bv]}function cbe(){var n=nu(),n=n?n.timing:0;return n&&0<n.domainLookupStart&&0<n[Ux]&&0<n[Uv]&&0<n[ibe]&&0<n[zx]&&0<n[ZP]&&0<n[jx]&&0<n.domLoading}function nz(){return tz()?nu().timing:null}function lbe(){return sbe()?nu()[YP]("navigation")[0]:null}function ube(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var t=(el()||{}).userAgent,r=!1;if(t)for(var i=0;i<ez[Bv];i++)r=r||Za(t.toLowerCase(),ez[i])!==-1;if(r)return!1;for(i=0;i<n[Bv];i++)if(n[i]<0||abe<=n[i])return!1;return!0}var As,hbe=function(){function n(e){var t=uf(e);mi(n,this,function(r){r[zP]=function(i){i.isValid=!1;var o=lbe(),a=nz(),l=0,h=0,p=0,g=0,_=0;(o||a)&&(_=o?(l=o[pl],h=o[rm]===0?o[jx]:Xa(o[rm],o[jx]),p=Xa(o.requestStart,o[Uv]),g=Xa(o[Uv],o[ZP]),Xa(o.responseEnd,o[zx])):(l=Xa(a[Ux],a[zx]),h=Xa(a[Ux],a[jx]),p=Xa(a.requestStart,a[Uv]),g=Xa(a[Uv],a[ZP]),Xa(a.responseEnd,a[zx])),l===0?Ut(t,2,10,"error calculating page view performance.",{total:l,network:h,request:p,response:g,dom:_}):r[KP](l,h,p,g,_)?l<Math.floor(h)+Math.floor(p)+Math.floor(g)+Math.floor(_)?Ut(t,2,8,"client performance math error.",{total:l,network:h,request:p,response:g,dom:_}):(i.durationMs=l,i.perfTotal=i[pl]=Mh(l),i.networkConnect=Mh(h),i.sentRequest=Mh(p),i.receivedResponse=Mh(g),i.domProcessing=Mh(_),i.isValid=!0):Ut(t,2,45,"Invalid page load duration value. Browser perf data won't be sent.",{total:l,network:h,request:p,response:g,dom:_}))},r[X8]=nz,r[Z8]=tz,r[Q8]=cbe,r[KP]=ube})}return n.__ieDyn=1,n}(),dbe=function(){function n(e,t){var r="prevPageVisitData";mi(n,this,function(i){i[FP]=function(o,a){try{var l=function(h,p){var g=null;try{var _;g=function(){var x=null;try{var C,M;Rv()&&(C=tl(),M=PP(e,r))&&mv()&&((x=xc().parse(M)).pageVisitTime=C-x[J8],k8(e,r))}catch(L){hf(e,"Stop page visit timer failed: "+rn(L)),x=null}return x}(),Rv()&&(PP(e,r)!=null&&Ts("Cannot call startPageVisit consecutively without first calling stopPageVisit"),_=xc().stringify(new fbe(h,p)),R8(e,r,_))}catch(x){hf(e,"Call to restart failed: "+rn(x)),g=null}return g}(o,a);l&&t(l.pageName,l.pageUrl,l.pageVisitTime)}catch(h){hf(e,"Auto track page visit time failed, metric will not be collected: "+rn(h))}},Pr(i,"_logger",{g:function(){return e}}),Pr(i,"pageVisitTimeTrackingHandler",{g:function(){return t}})})}return n.__ieDyn=1,n}(),fbe=function(n,e){this[J8]=tl(),this.pageName=n,this.pageUrl=e},rz=function(n,e){var t=this,r={};t.start=function(i){r[i]!==void 0&&Ut(n,2,62,"start was called more than once for this event without calling stop.",{name:i,key:i},!0),r[i]=+new Date},t.stop=function(i,o,a,l){var h=r[i];isNaN(h)?Ut(n,2,63,"stop was called without a corresponding start.",{name:i,key:i},!0):(h=Xa(h,+new Date),t.action(i,o,h,a,l)),delete r[i],r[i]=void 0}},pbe="event";function zv(n,e){n&&n.dispatchEvent&&e&&n.dispatchEvent(e)}function gbe(n){var e;return n&&n.reason?(e=n.reason,!Pn(e)&&Gn(e[Dx])?e[Dx]():rn(e)):n||""}var iz=6e4,mbe=bg(((As={sessionRenewalMs:vU(oz,18e5),sessionExpirationMs:vU(oz,864e5),disableExceptionTracking:fo()})[$8]=fo(),As[rbe]=fo(),As[K8]=fo(),As[WP]=!1,As.samplingPercentage=lx(ybe,100),As[DP]=fo(),As[W8]=fo(),As[Y8]=fo(),As.namePrefix=Eve(),As.enableDebug=fo(),As.disableFlushOnBeforeUnload=fo(),As.disableFlushOnUnload=fo(!1,"disableFlushOnBeforeUnload"),As));function oz(n,e){return+(n=(n=n||e)<iz?iz:n)}function ybe(n){return!isNaN(n)&&0<n&&n<=100}function _be(n){Ii(n[DP])||(n[DP]?z0e:j0e)()}var vbe=function(n){function e(){var t,r,i,o,a,l,h,p,g,_,x,C,M,L,F,z,ee,ce,se,_e=n.call(this)||this;return _e.identifier=H8,_e.priority=180,_e.autoRoutePVDelay=500,mi(e,_e,function(J,pe){var ue=pe[nm];function xe(ne,Ee,ke,Be,Ze){J[Cs]().throwInternal(ne,Ee,ke,Be,Ze)}function je(){l=a=o=i=r=t=null;var ne=cl(!(z=L=M=C=x=_=g=p=h=!1));ee=ne&&ne[Dv]||"",F=se=ce=null,Pr(J,"config",{g:function(){return F}})}je(),J.getCookieMgr=function(){return HI(J[Yo])},J.processTelemetry=function(ne,Ee){J.processNext(ne,Ee)},J.trackEvent=function(ne,Ee){try{var ke=Lh(ne,Ph[Nh],Ph[Tf],J[Cs](),Ee);J[Yo][Sf](ke)}catch(Be){xe(2,39,"trackTrace failed, trace will not be collected: "+Dr(Be),{exception:rn(Be)})}},J.startTrackEvent=function(ne){try{t.start(ne)}catch(Ee){xe(1,29,"startTrackEvent failed, event will not be collected: "+Dr(Ee),{exception:rn(Ee)})}},J.stopTrackEvent=function(ne,Ee,ke){try{t.stop(ne,void 0,Ee,ke)}catch(Be){xe(1,30,"stopTrackEvent failed, event will not be collected: "+Dr(Be),{exception:rn(Be)})}},J.trackTrace=function(ne,Ee){try{var ke=Lh(ne,Jg[Nh],Jg[Tf],J[Cs](),Ee);J[Yo][Sf](ke)}catch(Be){xe(2,39,"trackTrace failed, trace will not be collected: "+Dr(Be),{exception:rn(Be)})}},J.trackMetric=function(ne,Ee){try{var ke=Lh(ne,bf[Nh],bf[Tf],J[Cs](),Ee);J[Yo][Sf](ke)}catch(Be){xe(1,36,"trackMetric failed, metric will not be collected: "+Dr(Be),{exception:rn(Be)})}},J[Fx]=function(ne,Ee){try{var ke=ne||{};i[Fx](ke,Ia(Ia(Ia({},ke.properties),ke.measurements),Ee)),z&&a[FP](ke.name,ke.uri)}catch(Be){xe(1,37,"trackPageView failed, page view will not be collected: "+Dr(Be),{exception:rn(Be)})}},J[Cf]=function(ne,Ee,ke){var Be=ca(),Be=(Be&&(ne.refUri=ne.refUri===void 0?Be.referrer:ne.refUri),bt(ne[rm])&&(Be=(Ee||ne[BP]||{})[pl]||0,ne[rm]=new Date(new Date().getTime()-Be)),Lh(ne,Rh[Nh],Rh[Tf],J[Cs](),Ee,ke));J[Yo][Sf](Be)},J[UP]=function(ne,Ee,ke){ne=Lh(ne,em[Nh],em[Tf],J[Cs](),Ee,ke),J[Yo][Sf](ne)},J.trackPageViewPerformance=function(ne,Ee){ne=ne||{};try{o[zP](ne),J[UP](ne,Ee)}catch(ke){xe(1,37,"trackPageViewPerformance failed, page view will not be collected: "+Dr(ke),{exception:rn(ke)})}},J.startTrackPage=function(ne){try{var Ee;typeof ne!="string"&&(ne=(Ee=ca())&&Ee.title||""),r.start(ne)}catch(ke){xe(1,31,"startTrackPage failed, page view may not be collected: "+Dr(ke),{exception:rn(ke)})}},J.stopTrackPage=function(ne,Ee,ke,Be){try{var Ze,at;typeof ne!="string"&&(ne=(Ze=ca())&&Ze.title||""),typeof Ee!="string"&&(Ee=(at=cl())&&at[Dv]||""),r.stop(ne,Ee,ke,Be),z&&a[FP](ne,Ee)}catch(Re){xe(1,32,"stopTrackPage failed, page view will not be collected: "+Dr(Re),{exception:rn(Re)})}},J[G8]=function(ne,Ee,ke){var Be=ne&&(ne[jP]||ne[Fv])||b2(ne)&&ne||{name:ne&&typeof ne,message:ne||dl};ne=ne||{},Be=Lh(new Ks(J[Cs](),Be,ne[BP]||Ee,ne.measurements,ne.severityLevel,ne.id).toInterface(),Ks[Nh],Ks[Tf],J[Cs](),Ee,ke),J[Yo][Sf](Be)},J.trackException=function(ne,Ee){ne&&!ne[jP]&&ne[Fv]&&(ne[jP]=ne[Fv]);try{J[G8](ne,Ee)}catch(ke){xe(1,35,"trackException failed, exception will not be collected: "+Dr(ke),{exception:rn(ke)})}},J[VP]=function(ne){var Ee=ne&&ne[Fv],ke=ne&&ne.evt;try{ke||(Rt=Ka())&&(ke=Rt[pbe]);var Be,Ze,at=ne&&ne.url||(ca()||{}).URL,Re=ne[HP]||"window.onerror@"+at+":"+(ne[GP]||0)+":"+(ne[qP]||0),ht={errorSrc:Re,url:at,lineNumber:ne[GP]||0,columnNumber:ne[qP]||0,message:ne[q8]};tbe(ne.message,ne.url,ne.lineNumber,ne.columnNumber,ne[Fv])?(Be=Ks[$P]("Script error: The browser's same-origin policy prevents us from getting the details of this exception. Consider using the 'crossorigin' attribute.",at,ne[GP]||0,ne[qP]||0,Ee,ke,null,Re),Ze=ht,Be=Lh(Be,Ks[Nh],Ks[Tf],J[Cs](),Ze),J[Yo][Sf](Be)):(ne[HP]||(ne[HP]=Re),J.trackException({exception:ne,severityLevel:3},ht))}catch(dn){var Rt=Ee?Ee.name+", "+Ee[q8]:"null";xe(1,11,"_onError threw exception while logging error, error will not be collected: "+Dr(dn),{exception:rn(dn),errorString:Rt})}},J[Bx]=function(ne){if(J[Yo])return J[Yo][Bx](ne);(l=l||[]).push(ne)},J.initialize=function(ne,Ee,ke,Be){if(!J.isInitialized()){bt(Ee)&&Ts("Error initializing"),pe.initialize(ne,Ee,ke,Be);try{var Ze,at;se=Sh(Ws(J.identifier),Ee.evtNamespace&&Ee.evtNamespace()),l&&(on(l,function(Qt){Ee[Bx](Qt)}),l=null),wt=ne,Ge=J.identifier,qn=J[Yo],J[nm](Qi(wt,function(){var Qt,ln=Ec(null,wt,qn);F=ln.getExtCfg(Ge,mbe),z=F[$8],wt.storagePrefix&&IP(wt.storagePrefix),_be(F),h=F[W8],!p&&h&&(Qt=["/browserLinkSignalR/","/__browserLink/"],J[nm](J[Bx](function(Mn){if(h&&Mn.baseType===wf[Nh]){var Ot=Mn.baseData;if(Ot){for(var En=0;En<Qt[Bv];En++)if(Ot.target&&0<=Za(Ot.target,Qt[En]))return!1}}return!0})),p=!0)})),o=new hbe(J[Yo]),i=new obe(J,F.overridePageViewDuration,J[Yo],o),a=new dbe(J[Cs](),function(Qt,ln,Mn){var Ot=Qt;Ot={PageName:Qt,PageUrl:ln},J.trackMetric({name:"PageVisitTime",average:Mn,max:Mn,min:Mn,sampleCount:1},Ot)}),(t=new rz(J[Cs](),"trackEvent")).action=function(Qt,ln,Mn,Ot,En){En=En||{},(Ot=Ot||{}).duration=Mn[Dx](),J.trackEvent({name:Qt,properties:Ot,measurements:En})},(r=new rz(J[Cs](),"trackPageView")).action=function(Qt,ln,Mn,Ot,En){(Ot=bt(Ot)?{}:Ot).duration=Mn[Dx](),J[Cf]({name:Qt,uri:ln,properties:Ot,measurements:En},Ot)},Sw()&&(Rt=Ka(),dn=cl(!0),J[nm](Qi(F,function(){(x=F.disableExceptionTracking)||C||F.autoExceptionInstrumented||(ue(xx(Rt,"onerror",{ns:se,rsp:function(Qt,ln,Mn,Ot,En,lt){x||Qt.rslt===!0||J[VP](Ks[$P](ln,Mn,Ot,En,lt,Qt.evt))}},!1)),C=!0)})),Ze=Rt,at=dn,J[nm](Qi(F,function(){M=F[K8]===!0,C=C||F[WP],M&&!L&&(ue(xx(Ze,"onunhandledrejection",{ns:se,rsp:function(Qt,ln){M&&Qt.rslt!==!0&&J[VP](Ks[$P](gbe(ln),at?at[Dv]:"",0,0,ln,Qt.evt))}},!1)),F[WP]=L=!0)})),Re=Ka(),ht=cl(!0),J[nm](Qi(F,function(){var Qt,ln,Mn,Ot;g=F[Y8]===!0,Re&&g&&!_&&Oye()&&(ln=J6(),Gn(ln.pushState))&&Gn(ln.replaceState)&&typeof Event!==Q2&&(Qt=Re,ln=ln,Mn=ht,_||(Ot=F.namePrefix||"",ue(xx(ln,"pushState",{ns:se,rsp:function(){g&&(zv(Qt,Nv(Ot+"pushState")),zv(Qt,Nv(Ot+"locationchange")))}},!0)),ue(xx(ln,"replaceState",{ns:se,rsp:function(){g&&(zv(Qt,Nv(Ot+"replaceState")),zv(Qt,Nv(Ot+"locationchange")))}},!0)),uu(Qt,Ot+"popstate",function(){g&&zv(Qt,Nv(Ot+"locationchange"))},se),uu(Qt,Ot+"locationchange",function(){ce=(ce&&(ee=ce),Mn&&Mn[Dv]||"");{var En,lt;g&&((En=function(){var Pt=null;J[Yo]&&J[Yo].getTraceCtx&&(Pt=J[Yo].getTraceCtx(!1));{var he;Pt||(he=J[Yo].getPlugin(Nx))&&(he=he.plugin.context)&&(Pt=SP(he.telemetryTrace))}return Pt}())&&(En.setTraceId(Eh()),lt="_unknown_",Mn&&Mn.pathname&&(lt=Mn.pathname+(Mn.hash||"")),En.setName(po(J[Cs](),lt))),$s((function(Pt){J[Fx]({refUri:Pt,properties:{duration:0}})}).bind(J,ee),J.autoRoutePVDelay))}},se),_=!0))})))}catch(Qt){throw J.setInitialized(!1),Qt}var Re,ht,Rt,dn,wt,Ge,qn}},J._doTeardown=function(ne,Ee){i&&i.teardown(ne,Ee),Hg(window,null,null,se),je()},Pr(J,"_pageViewManager",{g:function(){return i}}),Pr(J,"_pageViewPerformanceManager",{g:function(){return o}}),Pr(J,"_pageVisitTimeManager",{g:function(){return a}}),Pr(J,"_evtNamespace",{g:function(){return"."+se}})}),_e}return au(e,n),e.Version="3.3.0",e}(Vg),Vx="featureOptIn",az="onCfgChangeReceive",sz="nonOverrideConfigs",cz="scheduleFetchTimeout";function lz(n,e,t,r){try{var i=r<t,o=(i&&(n=null),t==0?Qye({},n):n);return o&&e&&!i&&dr(o,function(a){var l=e[a];l&&(Wa(o[a])&&Wa(l)?o[a]=lz(o[a],l,++t,r):delete o[a])}),o}catch{}return n}var Hx,im="featureOptIn.",uz=".mode",hz=".onCfg",dz=".offCfg";function bbe(n,e,t){var r,i,o,a,l,h,p,g,_,x;return e&&e.enabled?(r=(e=(e[Vx]||{})[n]||{mode:1}).mode,i=e.onCfg,e=e.offCfg,o=(t=(t||{})[n]||{mode:2}).mode,a=t.onCfg,l=t.offCfg,t=!!t.blockCdnCfg,h=im+n+hz,p=im+n+dz,g=o,_=a,x=l,t||(r===4||r===5?(g=r==4?3:2,_=i||a,x=e||l):r===2||o===2?(g=2,_=a||i,x=l||e):r===3?(g=3,_=a||i,x=l||e):r===1&&o===1&&(g=1)),(t={})[im+n+uz]=g,t[h]=_,t[p]=x,t):null}function wbe(n,e){try{var t,r;return n&&n.enabled?n[Vx]?(t=n[Vx],r=n.config||{},dr(t,function(i){var o=bbe(i,n,e.config[Vx]);bt(o)||(dr(o,function(a,l){pB(r,a,l)}),xbe(i,o,r))}),r):n.config:null}catch{}return null}function xbe(a,o,t){var r=o[im+a+uz],i=o[im+a+hz],o=o[im+a+dz],a=r===2?o:r===3?i:null;a&&dr(a,function(l,h){pB(t,l,h)})}var Ebe="ai_cfgsync",fz="GET",Tbe=18e5,om=void 0,Sbe={instrumentationKey:!0,connectionString:!0,endpointUrl:!0},Cbe=bg(((Hx={syncMode:1,blkCdnCfg:om,customEvtName:om,cfgUrl:om,overrideSyncFn:om,overrideFetchFn:om})[az]=om,Hx[cz]=Tbe,Hx[sz]=Sbe,Hx)),Abe=function(n){function e(){var t,r,i,o,a,l,h,p,g,_,x,C,M,L,F,z,ee=n.call(this)||this,ce=(ee.priority=198,!(ee.identifier="AppInsightsCfgSyncPlugin"));return mi(e,ee,function(se,_e){function J(){C=z=F=g=x=_=l=M=p=h=a=o=i=r=null}function pe(ht,Rt){if(ht){if(r=ht,Rt&&!ce)return xe();if(h&&!ce)return se.core.updateCfg(ht),!0}return!1}function ue(){try{var ht=qs();ht&&Hg(ht,null,null,o)}catch{}}function xe(ht){try{return z&&Gn(z)?z(r,ht):rve(i,r,ht)}catch{}return!1}function je(ht){try{if(ue(),ht&&(i=ht,h)){var Rt=qs();if(Rt)try{uu(Rt,i,function(wt){var wt=wt&&wt.detail;C&&wt?C(wt):(wt=(wt=wt&&wt.cfg)&&Ca(wt)&&Ze(wt))&&pe(wt)},o,!0)}catch{}}return!0}catch{}return!1}function ne(ht,Rt,dn){var wt=qs(),wt=wt&&wt.fetch||null;if(ht&&wt&&Gn(wt))try{var Ge=new Request(ht,{method:fz});cu(fetch(Ge),function(qn){var Qt=qn.value;qn.rejected?Be(Rt,400):Qt.ok?cu(Qt.text(),function(ln){Be(Rt,Qt.status,ln.value,dn)}):Be(Rt,Qt.status,null,dn)})}catch{}}function Ee(ht,Rt,dn){try{var wt=new XMLHttpRequest;wt.open(fz,ht),wt.onreadystatechange=function(){wt.readyState===XMLHttpRequest.DONE&&Be(Rt,wt.status,wt.responseText,dn)},wt.onerror=function(){Be(Rt,400)},wt.ontimeout=function(){Be(Rt,400)},wt.send()}catch{}}function ke(ht,Rt,dn){try{var wt,Ge,qn;200<=ht&&ht<400&&Rt?(x=0,(wt=xc())&&(qn=(Ge=wbe(wt.parse(Rt),se.core))&&Ca(Ge)&&Ze(Ge))&&pe(qn,dn)):x++,x<3&&at()}catch{}}function Be(ht,Rt,dn,wt){try{ht(Rt,dn,wt)}catch{}}function Ze(ht){var Rt=null;try{ht&&(Rt=lz(ht,M,0,5))}catch{}return Rt}function at(){!l&&_&&(l=$s(function(){l=null,L(a,ke,p)},_)).unref()}function Re(){l&&l.cancel(),l=null,x=0}J(),se.initialize=function(ht,Rt,dn,wt){var Ge,qn,Qt;_e.initialize(ht,Rt,dn,wt),o=Sh(Ws(se.identifier),Rt.evtNamespace&&Rt.evtNamespace()),Ge=ht,qn=se.identifier,Qt=se.core,se._addHook(Qi(Ge,function(){var ln=Ec(null,Ge,Qt),ln=(t=ln.getExtCfg(qn,Cbe),g),ln=(g=!!t.blkCdnCfg,bt(ln)||ln===g||(!g&&a?L&&L(a,ke,p):Re()),bt(h)&&(h=t.syncMode===2),bt(p)&&(p=t.syncMode===1),t.customEvtName||Ebe);i!==ln&&(h?je(ln):(ue(),i=ln)),(a=bt(a)?t.cfgUrl:a)||(r=Ge,p&&xe())})),z=t.overrideSyncFn,F=t.overrideFetchFn,C=t[az],M=t[sz],_=t[cz],L=function(){var ln=F;return bt(ln)&&(PI()?ln=ne:nx()&&(ln=Ee)),ln}(),x=0,a&&!g&&L&&L(a,ke,p)},se.getCfg=function(){return r},se.pause=function(){ce=!0,Re()},se.resume=function(){ce=!1,at()},se.setCfg=function(ht){return pe(ht)},se.sync=xe,se.updateEventListenerName=je,se._doTeardown=function(ht,Rt){ue(),Re(),J()},se._getDbgPlgTargets=function(){return[p,h,i,g,M]},se.processTelemetry=function(ht,Rt){se.processNext(ht,Rt)}}),ee}return au(e,n),e.__ieDyn=1,e}(Vg),Af="duration",Ko="tags",XP="deviceType",Ma="data",fu="name",jv="traceID",fr="length",Vv="stringify",If="measurements",gl="dataType",Pf="envelopeType",Mf="toString",Hv="_get",Rf="enqueue",kf="count",pz="eventsLimitInMem",Dh="push",Gx="item",QP="emitLineDelimitedJson",am="clear",JP="createNew",qx="markAsSent",Gv="clearSent",eM="bufferOverride",tM="BUFFER_KEY",Fh="SENT_BUFFER_KEY",sm="concat",qv="MAX_BUFFER_SIZE",$v="triggerSend",ha="diagLog",nM="initialize",Wv="_sender",rM="customHeaders",gz="maxBatchSizeInBytes",iM="onunloadDisableBeacon",oM="isBeaconApiDisabled",mz="alwaysUseXhrOverride",aM="disableXhr",yz="enableSessionStorageBuffer",Bh="_buffer",_z="onunloadDisableFetch",vz="disableSendBeaconSplit",bz="instrumentationKey",wz="enableSendPromise",$x="getSenderInst",xz="unloadTransports",Ez="convertUndefined",Tz="maxBatchInterval",Wx="serialize",cm="_onError",sM="_onPartialSuccess",Yx="_onSuccess",cM="itemsReceived",lM="itemsAccepted",uM="oriPayload",hM="baseType",Kx="sampleRate",Sz="eventsSendRequest",Cz="getSamplingScore",Ibe="getHashCodeScore",dM="baseType",ki="baseData",Lo="properties",Az="true";function Ji(n,e,t){return oi(n,e,t,ww)}function Pbe(n,e,t){for(var r=t[Ko]=t[Ko]||{},i=e.ext=e.ext||{},o=e[Ko]=e[Ko]||[],a=i.user,a=(a&&(Ji(r,ai.userAuthUserId,a.authId),Ji(r,ai.userId,a.id||a.localId)),i.app),a=(a&&Ji(r,ai.sessionId,a.sesId),i.device),a=(a&&(Ji(r,ai.deviceId,a.id||a.localId),Ji(r,ai[XP],a.deviceClass),Ji(r,ai.deviceIp,a.ip),Ji(r,ai.deviceModel,a.model),Ji(r,ai[XP],a[XP])),e.ext.web),e=(a&&(Ji(r,ai.deviceLanguage,a.browserLang),Ji(r,ai.deviceBrowserVersion,a.browserVer),Ji(r,ai.deviceBrowser,a.browser),Ji(e=(e=(e=t[Ma]=t[Ma]||{})[ki]=e[ki]||{})[Lo]=e[Lo]||{},"domain",a.domain),Ji(e,"isManual",a.isManual?Az:null),Ji(e,"screenRes",a.screenRes),Ji(e,"userConsent",a.userConsent?Az:null)),i.os),a=(e&&(Ji(r,ai.deviceOS,e[fu]),Ji(r,ai.deviceOSVersion,e.osVer)),i.trace),l=(a&&(Ji(r,ai.operationParentId,a.parentID),Ji(r,ai.operationName,po(n,a[fu])),Ji(r,ai.operationId,a[jv])),{}),h=o[fr]-1;0<=h;h--)dr(o[h],function(g,_){l[g]=_}),o.splice(h,1);dr(o,function(p,g){l[p]=g}),e=Ia(Ia({},r),l),e[ai.internalSdkVersion]||(e[ai.internalSdkVersion]=po(n,"javascript:".concat(Mbe.Version),64)),t[Ko]=ZB(e)}function Uh(n,e,t){bt(n)||dr(n,function(r,i){Z_(i)?t[r]=i:Pn(i)?e[r]=i:mv()&&(e[r]=xc()[Vv](i))})}function Of(n,e){bt(n)||dr(n,function(t,r){n[t]=r||e})}function Lf(n,e,t,r){return r=new W0e(n,r,e),Ji(r,"sampleRate",t[p8]),(t[ki]||{}).startTime&&(r.time=Bg(t[ki].startTime)),r.iKey=t.iKey,e=t.iKey.replace(/-/g,""),r[fu]=r[fu].replace("{0}",e),Pbe(n,t,r),t[Ko]=t[Ko]||[],ZB(r)}function Nf(n,e){bt(e[ki])&&Ut(n,1,46,"telemetryItem.baseData cannot be null.")}var Mbe={Version:"3.3.0"};function Rbe(n,e,a){Nf(n,e);var r,i=e[ki][If]||{},o=e[ki][Lo]||{},a=(Uh(e[Ma],o,i),bt(a)||Of(o,a),e[ki]);return bt(a)?(hf(n,"Invalid input for dependency data"),null):(r=a[Lo]&&a[Lo][g8]?a[Lo][g8]:"GET",r=new wf(n,a.id,a.target,a[fu],a[Af],a.success,a.responseCode,r,a.type,a.correlationContext,o,i),a=new xf(wf[gl],r),Lf(n,wf[Pf],e,a))}function Iz(n,e,i){Nf(n,e);var o={},r={},i=(e[dM]!==Ph[gl]&&(o.baseTypeSource=e[dM]),e[dM]===Ph[gl]?(o=e[ki][Lo]||{},r=e[ki][If]||{}):e[ki]&&Uh(e[ki],o,r),Uh(e[Ma],o,r),bt(i)||Of(o,i),e[ki][fu]),i=new Ph(n,i,o,r),o=new xf(Ph[gl],i);return Lf(n,Ph[Pf],e,o)}function kbe(n,e,i){Nf(n,e);var r=e[ki][If]||{},o=e[ki][Lo]||{},i=(Uh(e[Ma],o,r),bt(i)||Of(o,i),e[ki]),i=Ks.CreateFromInterface(n,i,o,r),o=new xf(Ks[gl],i);return Lf(n,Ks[Pf],e,o)}function Obe(n,e,o){Nf(n,e);var a=e[ki],r=a[Lo]||{},i=a[If]||{},o=(Uh(e[Ma],r,i),bt(o)||Of(r,o),new bf(n,a[fu],a.average,a.sampleCount,a.min,a.max,a.stdDev,r,i)),a=new xf(bf[gl],o);return Lf(n,bf[Pf],e,a)}function Lbe(n,e,g){Nf(n,e);var r,p=e[ki],p=(bt(p)||bt(p[Lo])||bt(p[Lo][Af])?bt(e[Ma])||bt(e[Ma][Af])||(r=e[Ma][Af],delete e[Ma][Af]):(r=p[Lo][Af],delete p[Lo][Af]),e[ki]),i=(((e.ext||{}).trace||{})[jv]&&(i=e.ext.trace[jv]),p.id||i),o=p[fu],a=p.uri,l=p[Lo]||{},h=p[If]||{},p=(bt(p.refUri)||(l.refUri=p.refUri),bt(p.pageType)||(l.pageType=p.pageType),bt(p.isLoggedIn)||(l.isLoggedIn=p.isLoggedIn[Mf]()),bt(p[Lo])||dr(p[Lo],function(_,x){l[_]=x}),Uh(e[Ma],l,h),bt(g)||Of(l,g),new Rh(n,o,a,r,l,h,i)),g=new xf(Rh[gl],p);return Lf(n,Rh[Pf],e,g)}function Nbe(n,e,l){Nf(n,e);var r=e[ki],h=r[fu],i=r.uri||r.url,o=r[Lo]||{},a=r[If]||{},l=(Uh(e[Ma],o,a),bt(l)||Of(o,l),new em(n,h,i,void 0,o,a,r)),h=new xf(em[gl],l);return Lf(n,em[Pf],e,h)}function Dbe(n,e,a){Nf(n,e);var l=e[ki].message,r=e[ki].severityLevel,i=e[ki][Lo]||{},o=e[ki][If]||{},a=(Uh(e[Ma],i,o),bt(a)||Of(i,a),new Jg(n,l,r,i,o)),l=new xf(Jg[gl],a);return Lf(n,Jg[Pf],e,l)}var Oi,zh,Pz=function(){function n(e,t){var r=[],i=!1,o=t.maxRetryCnt;this[Hv]=function(){return r},this._set=function(a){return r=a},mi(n,this,function(a){a[Rf]=function(l){a[kf]()>=t[pz]?i||(Ut(e,2,105,"Maximum in-memory buffer size reached: "+a[kf](),!0),i=!0):(l.cnt=l.cnt||0,!bt(o)&&l.cnt>o||r[Dh](l))},a[kf]=function(){return r[fr]},a.size=function(){for(var l=r[fr],h=0;h<r[fr];h++)l+=r[h].item[fr];return t[QP]||(l+=2),l},a[am]=function(){i=!(r=[])},a.getItems=function(){return r.slice(0)},a.batchPayloads=function(l){var h;return l&&0<l[fr]?(h=[],on(l,function(p){h[Dh](p[Gx])}),t[QP]?h.join(`
`):"["+h.join(",")+"]"):null},a[JP]=function(l,h,p){var g=r.slice(0),_=new(p?Mz:fM)(l=l||e,h=h||{});return on(g,function(x){_[Rf](x)}),_}})}return n.__ieDyn=1,n}(),fM=function(n){function e(t,r){return t=n.call(this,t,r)||this,mi(e,t,function(i,o){i[qx]=function(a){o[am]()},i[Gv]=function(a){}}),t}return au(e,n),e.__ieDyn=1,e}(Pz),Fbe=["AI_buffer","AI_sentBuffer"],Mz=function(n){function e(r,i){var o=n.call(this,r,i)||this,a=!1,l=i==null?void 0:i.namePrefix,h=i[eM]||{getItem:PP,setItem:R8},p=h.getItem,g=h.setItem,_=i.maxRetryCnt;return mi(e,o,function(x,C){var M=ee(e[tM]),L=ee(e[Fh]),F=function(){var J=[];try{return on(Fbe,function(pe){var ue=_e(pe);J=J[sm](ue),l&&(ue=_e(l+"_"+pe),J=J[sm](ue))}),J}catch(pe){Ut(r,2,41,"Transfer events from previous buffers: "+Dr(pe)+". previous Buffer items can not be removed",{exception:rn(pe)})}return[]}(),L=L[sm](F),F=x._set(M[sm](L));function z(J,pe){var ue=[],xe=[];return on(J,function(je){xe[Dh](je[Gx])}),on(pe,function(je){Gn(je)||la(xe,je[Gx])!==-1||ue[Dh](je)}),ue}function ee(J){return ce(l?l+"_"+J:J)}function ce(J){try{var pe=p(r,J);if(pe){var ue=xc().parse(pe);if((ue=Pn(ue)?xc().parse(ue):ue)&&hr(ue))return ue}}catch(xe){Ut(r,1,42," storage key: "+J+", "+Dr(xe),{exception:rn(xe)})}return[]}function se(J,pe){try{var J=l?l+"_"+J:J,ue=JSON[Vv](pe);g(r,J,ue)}catch(xe){g(r,J,JSON[Vv]([])),Ut(r,2,41," storage key: "+J+", "+Dr(xe)+". Buffer cleared",{exception:rn(xe)})}}function _e(J){try{var pe=ce(J),ue=[];return on(pe,function(xe){ue[Dh]({item:xe,cnt:0})}),k8(r,J),ue}catch{}return[]}F[fr]>e[qv]&&(F[fr]=e[qv]),se(e[Fh],[]),se(e[tM],F),x[Rf]=function(J){x[kf]()>=e[qv]?a||(Ut(r,2,67,"Maximum buffer size reached: "+x[kf](),!0),a=!0):(J.cnt=J.cnt||0,!bt(_)&&J.cnt>_||(C[Rf](J),se(e.BUFFER_KEY,x[Hv]())))},x[am]=function(){C[am](),se(e.BUFFER_KEY,x[Hv]()),se(e[Fh],[]),a=!1},x[qx]=function(J){se(e[tM],x._set(z(J,x[Hv]())));var pe=ee(e[Fh]);pe instanceof Array&&J instanceof Array&&((pe=pe[sm](J))[fr]>e[qv]&&(Ut(r,1,67,"Sent buffer reached its maximum size: "+pe[fr],!0),pe[fr]=e[qv]),se(e[Fh],pe))},x[Gv]=function(J){J=z(J,ee(e[Fh])),se(e[Fh],J)},x[JP]=function(J,pe,ue){ue=!!ue;var xe=x[Hv]().slice(0),je=ee(e[Fh]).slice(0),ne=(J=J||r,pe=pe||{},x[am](),new(ue?e:fM)(J,pe));return on(xe,function(Ee){ne[Rf](Ee)}),ue&&ne[qx](je),ne}}),o}var t;return au(e,n),(t=e).VERSION="_1",e.BUFFER_KEY="AI_buffer"+t.VERSION,e.SENT_BUFFER_KEY="AI_sentBuffer"+t.VERSION,e.MAX_BUFFER_SIZE=2e3,e}(Pz),Bbe=function(){function n(e){mi(n,this,function(t){function r(a,l){var h="__aiCircularRefCheck",p={};if(a)if(a[h])Ut(e,2,50,"Circular reference detected while serializing object",{name:l},!0);else if(a.aiDataContract)a[h]=!0,dr(a.aiDataContract,function(g,M){var x=Gn(M)?1&M():1&M,C=Gn(M)?4&M():4&M,M=2&M,L=a[g]!==void 0,F=Wa(a[g])&&a[g]!==null;!x||L||M?C||(x=void 0)!==(x=F?(M?i:r)(a[g],g):a[g])&&(p[g]=x):Ut(e,1,24,"Missing required field specification. The field is required but not present on source",{field:g,name:l})}),delete a[h];else if(l==="measurements")p=o(a,"number",l);else if(l==="properties")p=o(a,"string",l);else if(l==="tags")p=o(a,"string",l);else if(hr(a))p=i(a,l);else{Ut(e,2,49,"Attempting to serialize an object which does not implement ISerializable",{name:l},!0);try{xc()[Vv](a),p=a}catch(g){Ut(e,1,48,g&&Gn(g[Mf])?g[Mf]():"Error serializing object",null,!0)}}else Ut(e,1,48,"cannot serialize object because it is null or undefined",{name:l},!0);return p}function i(a,l){if(a)if(hr(a))for(var h=[],p=0;p<a[fr];p++){var g=r(a[p],l+"["+p+"]");h[Dh](g)}else Ut(e,1,54,`This field was specified as an array in the contract but the item is not an array.\r
`,{name:l},!0);return h}function o(a,l,h){var p;return a&&(p={},dr(a,function(g,_){l==="string"?_===void 0?p[g]="undefined":_===null?p[g]="null":_[Mf]?p[g]=_[Mf]():p[g]="invalid field: toString() is not defined.":l==="number"?_===void 0?p[g]="undefined":_===null?p[g]="null":(_=parseFloat(_),p[g]=_):(p[g]="invalid field: "+h+" is of unknown type.",Ut(e,1,p[g],null,!0))})),p}t[Wx]=function(a){a=r(a,"root");try{return xc()[Vv](a)}catch(l){Ut(e,1,48,l&&Gn(l[Mf])?l[Mf]():"Error serializing object",null,!0)}}})}return n.__ieDyn=1,n}(),Ube=8,zbe=function(){function n(){}return n.prototype.getHashCodeScore=function(e){return 100*(this.getHashCode(e)/n.INT_MAX_VALUE)},n.prototype.getHashCode=function(e){if(e==="")return 0;for(;e[fr]<Ube;)e=e[sm](e);for(var t=5381,r=0;r<e[fr];++r)t=(t<<5)+t+e.charCodeAt(r),t&=t;return Math.abs(t)},n.INT_MAX_VALUE=2147483647,n}(),jbe=function(){var n=new zbe,e=new z8;this[Cz]=function(t){return t[Ko]&&t[Ko][e.userId]?n.getHashCodeScore(t[Ko][e.userId]):t.ext&&t.ext.user&&t.ext.user.id?n[Ibe](t.ext.user.id):t[Ko]&&t[Ko][e.operationId]?n.getHashCodeScore(t[Ko][e.operationId]):t.ext&&t.ext.telemetryTrace&&t.ext.telemetryTrace[jv]?n.getHashCodeScore(t.ext.telemetryTrace[jv]):100*Math.random()}},Vbe=function(){function n(e,t){this.INT_MAX_VALUE=2147483647,t=t||uf(null),(100<e||e<0)&&(t.throwInternal(2,58,"Sampling rate is out of range (0..100). Sampling will be disabled, you may be sending too much data which may affect your AI service level.",{samplingRate:e},!0),e=100),this[Kx]=e,this.samplingScoreGenerator=new jbe}return n.prototype.isSampledIn=function(e){var t=this[Kx];return t==null||100<=t||e.baseType===bf[gl]||this.samplingScoreGenerator[Cz](e)<t},n}(),pu=void 0,Rz="",Hbe=65e3;function kz(n){try{return n.responseText}catch{}return null}function Gbe(n){return n&&n.sendPOST}var Oz=bg(((Oi={endpointUrl:lx(ww,dP+Gg)})[QP]=fo(),Oi[Tz]=15e3,Oi[gz]=102400,Oi.disableTelemetry=fo(),Oi[yz]=fo(!0),Oi.isRetryDisabled=fo(),Oi[oM]=fo(!0),Oi[vz]=fo(!0),Oi[aM]=fo(),Oi[_z]=fo(),Oi[iM]=fo(),Oi[bz]=pu,Oi.namePrefix=pu,Oi.samplingPercentage=lx(qbe,100),Oi[rM]=pu,Oi[Ez]=pu,Oi[pz]=1e4,Oi[eM]=!1,Oi.httpXHROverride={isVal:Gbe,v:pu},Oi[mz]=fo(),Oi.transports=pu,Oi.retryCodes=pu,Oi.maxRetryCnt={isVal:Z_,v:10},Oi));function qbe(n){return!isNaN(n)&&0<n&&n<=100}(zh={})[Ph.dataType]=Iz,zh[Jg.dataType]=Dbe,zh[Rh.dataType]=Lbe,zh[em.dataType]=Nbe,zh[Ks.dataType]=kbe,zh[bf.dataType]=Obe,zh[wf.dataType]=Rbe;var $be=zh,Wbe=function(n){function e(){var t,r,i,o,a,l,h,p,g,_,x,C,M,L,F,z,ee,ce,se,_e,J,pe,ue,xe,je,ne,Ee,ke,Be,Ze,at,Re,ht,Rt,dn=n.call(this)||this,wt=(dn.priority=1001,dn.identifier=V8,0);return mi(e,dn,function(Ge,qn){function Qt(Ie,Te){var At=kz(Ie);!Ie||At+""!="200"&&At!==""?(At=eP(At))&&At[cM]&&At[cM]>At[lM]&&!J?Ge[sM](Te,At):Ge[cm](Te,QB(Ie)):(t=0,Ge[Yx](Te,0))}function ln(Ie,Te,At){Ie.readyState===4&&ae(Ie.status,Te,Ie.responseURL,At,tx(Ie),kz(Ie)||Ie.response)}function Mn(Ie){try{var Te;if(Ie)return(Te=Ie[uM])&&Te[fr]?Te:null}catch{}return null}function Ot(Ie,Te){return!(ce||(Ie?Ie.baseData&&!Ie[hM]?(Te&&Ut(Te,1,70,"Cannot send telemetry without baseData and baseType"),1):(Ie[hM]||(Ie[hM]="EventData"),Ge[Wv]?Ge._sample.isSampledIn(Ie)?(Ie[p8]=Ge._sample[Kx],0):(Te&&Ut(Te,2,33,"Telemetry item was sampled out and not sent",{SampleRate:Ge._sample[Kx]}),1):(Te&&Ut(Te,1,28,"Sender was not initialized"),1)):(Te&&Ut(Te,1,7,"Cannot send empty telemetry"),1)))}function En(Ie,Te){var At=Ie.iKey||se,xt=e.constructEnvelope(Ie,At,Te,_e);if(xt){var qt=!1;if(Ie[Ko]&&Ie[Ko][hP]&&(on(Ie[Ko][hP],function(fn){try{fn&&fn(xt)===!1&&(qt=!0,hf(Te,"Telemetry processor check returns false"))}catch(Ke){Ut(Te,1,64,"One of telemetry initializers failed, telemetry item will not be sent: "+Dr(Ke),{exception:rn(Ke)},!0)}}),delete Ie[Ko][hP]),!qt)return xt}else Ut(Te,1,47,"Unable to create an AppInsights envelope")}function lt(Ie){var Te=Rz,At=Ge[ha]();try{var xt=Ot(Ie,At),qt=null;(qt=xt?En(Ie,At):qt)&&(Te=a[Wx](qt))}catch{}return Te}function Pt(Ie){var Te=Rz;return Te=Ie&&Ie[fr]?"["+Ie.join(",")+"]":Te}function he(Ie){var Te=D(),At={urlString:x};return At[Ma]=Ie,At.headers=Te,At}function B(Ke,Te,At,xt){xt===void 0&&(xt=!0);function qt(gt,Tt,Rn){var Qn;Qn=Te,Rn=Rn,gt===200&&Qn?Ge._onSuccess(Qn,Qn[fr]):Rn&&Ge[cm](Qn,Rn)}var fn=H(Te),Ke=Ke&&Ke.sendPOST;return Ke&&fn?(xt&&Ge._buffer[qx](Te),Ke(fn,qt,!At)):null}function H(Ie){var Te,At,xt;return hr(Ie)&&0<Ie[fr]?(At=Ge[Bh].batchPayloads(Ie),xt=D(),(Te={})[Ma]=At,Te.urlString=x,Te.headers=xt,Te.disableXhrSync=ke,Te.disableFetchKeepAlive=!Be,Te[uM]=Ie,Te):null}function D(){try{var Ie=h||{};return TP(x)&&(Ie[ei[6]]=ei[7]),Ie}catch{}return null}function Q(Ie){Ie=Ie?Ie[fr]:0,Ge[Bh].size()+Ie>M&&(g&&!g.isOnline()||Ge[$v](!0,null,10))}function ae(Ie,Te,At,xt,qt,fn){var Ke=null;Ge._appId||(Ke=eP(fn))&&Ke.appId&&(Ge._appId=Ke.appId),(Ie<200||300<=Ie)&&Ie!==0?(Ie!==301&&Ie!==307&&Ie!==308||q(At))&&!J&&Lt(Ie)?(rt(Te),Ut(Ge[ha](),2,40,". Response code "+Ie+". Will retry to send "+Te[fr]+" items.")):Ge[cm](Te,qt):g&&!g.isOnline()?J||(rt(Te,10),Ut(Ge[ha](),2,40,". Offline - Response Code: ".concat(Ie,". Offline status: ").concat(!g.isOnline(),". Will retry to send ").concat(Te.length," items."))):(q(At),Ie===206?(Ke=Ke||eP(fn))&&!J?Ge[sM](Te,Ke):Ge[cm](Te,qt):(t=0,Ge[Yx](Te,xt)))}function q(Ie){return!(10<=l||bt(Ie)||Ie===""||Ie===x)&&(x=Ie,++l,1)}function Ae(Ie,Te){if(!p)return B(ht&&ht[$x]([3],!0),Ie,Te);p(Ie,!1)}function Pe(Ie){try{if(Ie&&Ie[fr])return Pn(Ie[0])}catch{}}function We(Ie,Te){var At=null;if(hr(Ie)){for(var xt=Ie[fr],qt=0;qt<Ie[fr];qt++)xt+=Ie[qt].item[fr];return ht.getSyncFetchPayload()+xt<=Hbe?At=2:yv()?At=3:(At=1,Ut(Ge[ha](),2,40,". Failed to send telemetry with Beacon API, retried with xhrSender.")),B(ht&&ht[$x]([At],!0),Ie,Te)}return null}function rt(Ie,Te){if(Te===void 0&&(Te=1),Ie&&Ie[fr]!==0){var At=Ge[Bh];At[Gv](Ie),t++;for(var xt,qt=0,fn=Ie;qt<fn.length;qt++){var Ke=fn[qt];Ke.cnt=Ke.cnt||0,Ke.cnt++,At[Rf](Ke)}Ie=Te,Ie=t<=1?10:(xt=(Math.pow(2,t)-1)/2,xt=Math.floor(Math.random()*xt*10)+1,xt*=Ie,Math.max(Math.min(xt,3600),10)),xt=tl()+1e3*Ie,r=xt,Et()}}function Et(){var Ie;o||i||(Ie=r?Math.max(0,r-tl()):0,Ie=Math.max(pe,Ie),o=$s(function(){o=null,Ge[$v](!0,null,1)},Ie))}function Bt(){o&&o.cancel(),r=o=null}function Lt(Ie){return bt(Rt)?Ie===401||Ie===408||Ie===429||Ie===500||Ie===502||Ie===503||Ie===504:Rt[fr]&&-1<Rt.indexOf(Ie)}function an(){Ge[Wv]=null,Ge[Bh]=null,Ge._appId=null,Ge._sample=null,M=wt=l=t=0,je=_e=pu,Re=Be=ke=J=ce=L=i=!(h={}),ht=at=Ze=ue=se=ee=C=x=_=p=a=o=r=g=null,Pr(Ge,"_senderConfig",{g:function(){return XB({},Oz)}})}an(),Ge.pause=function(){Bt(),i=!0},Ge.resume=function(){i&&(i=!1,r=null,Q(),Et())},Ge.flush=function(Ie,Te,At){if(Ie===void 0&&(Ie=!0),!i){Bt();try{return Ge[$v](Ie,null,At||1)}catch(xt){Ut(Ge[ha](),1,22,"flush failed, telemetry will not be collected: "+Dr(xt),{exception:rn(xt)})}}},Ge.onunloadFlush=function(){if(!i)if(L||Ee)try{return Ge[$v](!0,Ae,2)}catch(Ie){Ut(Ge[ha](),1,20,"failed to flush with beacon sender on page unload, telemetry will not be collected: "+Dr(Ie),{exception:rn(Ie)})}else Ge.flush(!1)},Ge.addHeader=function(Ie,Te){h[Ie]=Te},Ge[nM]=function(Ie,Te,At,xt){Ge.isInitialized()&&Ut(Ge[ha](),1,28,"Sender is already initialized"),qn[nM](Ie,Te,At,xt);var qt=Ge.identifier,fn=(a=new Bbe(Te.logger),t=0,r=null,Ge[Wv]=null,l=0,Ge[ha]());_=Sh(Ws("Sender"),Te.evtNamespace&&Te.evtNamespace()),g=nbe(_),Ge._addHook(Qi(Ie,function(Ke){Ke=Ke.cfg,Ke.storagePrefix&&IP(Ke.storagePrefix);var gt=Ec(null,Ke,Te).getExtCfg(qt,Oz),Ar=(Pr(Ge,"_senderConfig",{g:function(){return gt}}),Te.activeStatus()===gh.PENDING?Ge.pause():Te.activeStatus()===gh.ACTIVE&&Ge.resume(),C!==gt.endpointUrl&&(x=C=gt.endpointUrl),ee&&ee!==gt[rM]&&on(ee,function(oe){delete h[oe.header]}),M=gt[gz],L=(gt[iM]===!1||gt[oM]===!1)&&yv(),F=gt[iM]===!1&&yv(),z=gt[oM]===!1&&yv(),Ee=gt[mz],ke=!!gt[aM],Rt=gt.retryCodes,gt[eM]),nn=!!gt[yz]&&(!!Ar||Rv()),Qn=gt.namePrefix,Rn=nn!==ue||nn&&je!==Qn||nn&&xe!==Ar;if(Ge[Bh]){if(Rn)try{Ge._buffer=Ge._buffer[JP](fn,gt,nn)}catch(oe){Ut(Ge[ha](),1,12,"failed to transfer telemetry to different buffer storage, telemetry will be lost: "+Dr(oe),{exception:rn(oe)})}Q()}else Ge[Bh]=new(nn?Mz:fM)(fn,gt);je=Qn,ue=nn,xe=Ar,Be=!gt[_z]&&PI(!0),Re=!!gt[vz],Ge._sample=new Vbe(gt.samplingPercentage,fn),function(oe,V){return V=V.disableInstrumentationKeyValidation,!bt(V)&&V?1:new RegExp("^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$").test(oe)}(se=gt[bz],Ke)||Ut(fn,1,100,"Invalid Instrumentation key "+se),ee=gt[rM],Pn(x)&&!TP(x)&&ee&&0<ee[fr]?on(ee,function(oe){dn.addHeader(oe.header,oe.value)}):ee=null,ne=gt[wz];var Tt,Rn=function(){var oe;try{var V={xdrOnComplete:function($,K,me){if(me=Mn(me),me)return Qt($,me)},fetchOnComplete:function($,K,me,Oe){if(Oe=Mn(Oe),Oe)return ae($.status,Oe,$.url,Oe[fr],$.statusText,me||"")},xhrOnComplete:function($,K,me){if(me=Mn(me),me)return ln($,me,me[fr])},beaconOnRetry:function($,K,me){var Oe=K,He=me,Ne=$&&$[uM];if(Re)at&&at(Ne,!0),Ut(Ge[ha](),2,40,". Failed to send telemetry with Beacon API, retried with normal sender.");else{for(var Ce=[],De=0;De<Ne[fr];De++){var ot=Ne[De],st=[ot],St=H(st);He(St,Oe)?Ge._onSuccess(st,st[fr]):Ce[Dh](ot)}0<Ce[fr]&&(at&&at(Ce,!0),Ut(Ge[ha](),2,40,". Failed to send telemetry with Beacon API, retried with normal sender."))}}};return(oe={})[wz]=ne,oe.isOneDs=!1,oe.disableCredentials=!1,oe[aM]=ke,oe.disableBeacon=!z,oe.disableBeaconSync=!F,oe.senderOnCompleteCallBack=V,oe}catch{}return null}(),Qn=(ht?ht.SetConfig(Rn):(ht=new f0e)[nM](Rn,fn),gt.httpXHROverride),nn=JB([3,1,2],gt.transports),Fr=ht&&ht[$x](nn,!1),ti=ht&&ht.getFallbackInst(),Ar=(Ze=function(oe,V){return B(ti,oe,V)},at=function(oe,V){return B(ti,oe,V,!1)},Fr=Ee?Qn:Fr||Qn||ti,Ge[Wv]=function(oe,V){return B(Fr,oe,V)},Be&&(p=We),JB([3,1],gt[xz]));Be||(Ar=Ar.filter(function(oe){return oe!==2})),Tt=ht&&ht[$x](Ar,!0),Tt=!Ee&&Tt||Qn,p=(p=(Ee||gt[xz]||!p)&&Tt?function(oe,V){return B(Tt,oe,V)}:p)||Ze,ce=gt.disableTelemetry,_e=gt[Ez]||pu,J=gt.isRetryDisabled,pe=gt[Tz]}))},Ge.processTelemetry=function(Ie,Te){var At,xt=(Te=Ge._getTelCtx(Te))[ha]();try{if(!Ot(Ie,xt))return;var qt=En(Ie,xt);if(!qt)return;var fn=a[Wx](qt),Ke=Ge[Bh],gt=(Q(fn),(At={})[Gx]=fn,At.cnt=0,At);Ke[Rf](gt),Et()}catch(Tt){Ut(xt,2,12,"Failed adding telemetry to the sender's buffer, some telemetry will be lost: "+Dr(Tt),{exception:rn(Tt)})}Ge.processNext(Ie,Te)},Ge.isCompletelyIdle=function(){return!i&&wt===0&&Ge._buffer[kf]()===0},Ge._xhrReadyStateChange=function(Ie,Te,At){if(!Pe(Te))return ln(Ie,Te,At)},Ge[$v]=function(Ie,Te,At){var xt;if(Ie===void 0&&(Ie=!0),!i)try{var qt=Ge[Bh];if(ce)qt[am]();else if(0<qt[kf]()){var fn=qt.getItems(),Ke=At||0,gt=Ie,Tt=function(){var Rn="getNotifyMgr";return Ge.core[Rn]?Ge.core[Rn]():Ge.core._notificationManager}();if(Tt&&Tt[Sz])try{Tt[Sz](Ke,gt)}catch(Rn){Ut(Ge[ha](),1,74,"send request notification failed: "+Dr(Rn),{exception:rn(Rn)})}xt=Te?Te.call(Ge,fn,Ie):Ge[Wv](fn,Ie)}Bt()}catch(Rn){qt=oU(),(!qt||9<qt)&&Ut(Ge[ha](),1,40,"Telemetry transmission failed, some telemetry will be lost: "+Dr(Rn),{exception:rn(Rn)})}return xt},Ge.getOfflineSupport=function(){var Ie={getUrl:function(){return x},createPayload:he};return Ie[Wx]=lt,Ie.batch=Pt,Ie.shouldProcess=function(Te){return!!Ot(Te)},Ie},Ge._doTeardown=function(Ie,Te){Ge.onunloadFlush(),Ug(g,!1),an()},Ge[cm]=function(Ie,Te,At){if(!Pe(Ie))return Ie=Ie,Te=Te,Ut(Ge[ha](),2,26,"Failed to send telemetry.",{message:Te}),void(Ge._buffer&&Ge._buffer[Gv](Ie))},Ge[sM]=function(Ie,Te){if(!Pe(Ie)){for(var At=Ie,Ie=Te,xt=[],qt=[],Te=Ie.errors.reverse(),fn=0,Ke=Te;fn<Ke.length;fn++){var gt=Ke[fn],Tt=At.splice(gt.index,1)[0];(Lt(gt.statusCode)?qt:xt)[Dh](Tt)}0<At[fr]&&Ge[Yx](At,Ie[lM]),0<xt[fr]&&Ge[cm](xt,tx(null,["partial success",Ie[lM],"of",Ie.itemsReceived].join(" "))),0<qt[fr]&&(rt(qt),Ut(Ge[ha](),2,40,"Partial success. Delivered: "+At[fr]+", Failed: "+xt[fr]+". Will retry to send "+qt[fr]+" our of "+Ie[cM]+" items"))}},Ge[Yx]=function(Ie,Te){Pe(Ie)||(Ie=Ie,Ge._buffer&&Ge._buffer[Gv](Ie))},Ge._xdrOnLoad=function(Ie,Te){if(!Pe(Te))return Qt(Ie,Te)}}),dn}return au(e,n),e.constructEnvelope=function(t,r,i,o){return t=r===t.iKey||bt(r)?t:Ia(Ia({},t),{iKey:r}),($be[t.baseType]||Iz)(i,t,o)},e}(Vg),Lz="duration",Df="properties",Cc="requestUrl",Yv="inst",Ff="length",gu="traceID",jh="spanID",Zs="traceFlags",Kv="context",lm="aborted",Zx="traceId",Xx="spanId",Qx="_addHook",Ac="core",pM="includeCorrelationHeaders",gM="getAbsoluteUrl",Bf="headers",Xs="requestHeaders",mM="setRequestHeader",Nz="trackDependencyDataInternal",Uf="startTime",um="toLowerCase",yM="enableRequestHeaderTracking",Dz="enableAjaxErrorStatusText",Fz="enableAjaxPerfTracking",Bz="maxAjaxCallsPerView",Uz="excludeRequestFromAutoTrackingPatterns",zz="addRequestContext",_M="disableAjaxTracking",jz="ajaxPerfLookupDelay",Vz="disableFetchTracking",Hz="enableResponseHeaderTracking",Ic="status",zf="statusText",hm="headerMap",vM="openDone",bM="sendDone",jf="requestSentTime",wM="abortDone",xM="getTraceId",EM="getTraceFlags",Vh="method",TM="errorStatusText",Gz="stateChangeAttached",qz="responseText",Zv="responseFinishedTime",SM="CreateTrackItem",$z="response",Wz="getAllResponseHeaders",CM="getPartAProps",Jx="perfMark",dm="name",AM="perfTiming",Xv="exception",Yz="ajaxDiagnosticsMessage",IM="correlationContext",PM="ajaxTotalDuration",Kz="eventTraceCtx";function Zz(o,i,t){var r=0,i=o[i],o=o[t];return r=i&&o?Xa(i,o):r}function Vf(n,e,a,r,i){var o=0,a=Zz(a,r,i);return o=a?Hh(n,e,Mh(a)):o}function Hh(n,e,t){var r=0;return n&&e&&t&&((n.ajaxPerf=n.ajaxPerf||{})[e]=t,r=1),r}function Ybe(n,e){var t,r=n[AM],i=e[Df]||{},o=0,_="Start",a="domainLookup",l="connect",h="request",p="response",g=l+"End",_=h+_,x=p+"End",C="transferSize",M="encodedBodySize",L="decodedBodySize",F="serverTiming";r?(o=(o=(o=(o=(o=(o=(o|=Vf(i,"End",r,"redirectStart","End"))|Vf(i,a,r,"domainLookupStart","domainLookupEnd"))|Vf(i,l,r,"connectStart",g))|Vf(i,h,r,_,"requestEnd"))|Vf(i,p,r,"responseStart",x))|Vf(i,"networkConnect",r,"startTime",g))|Vf(i,"sentRequest",r,_,x),a=(a=r[Lz])||Zz(r,"startTime",x)||0,o=(o|=Hh(i,Lz,a))|Hh(i,"perfTotal",a),(l=r[F])&&(t={},on(l,function(z,ce){var ce=Qw(z.name||""+ce),se=t[ce]||{};dr(z,function(_e,J){!(_e!=="name"&&Pn(J)||Z_(J))||!(J=se[_e]?se[_e]+";"+J:J)&&Pn(J)||(se[_e]=J)}),t[ce]=se}),o|=Hh(i,F,t)),o=(o=(o|=Hh(i,C,r[C]))|Hh(i,M,r[M]))|Hh(i,L,r[L])):n[Jx]&&(o|=Hh(i,"missing",n.perfAttempts)),o&&(e[Df]=i)}var eo,Kbe=function(){this[vM]=!1,this.setRequestHeaderDone=!1,this[bM]=!1,this[wM]=!1,this[Gz]=!1},Xz=function(){function n(e,t,r,i){var o=this,a=r;o[Jx]=null,o.completed=!1,o.requestHeadersSize=null,o[Xs]=null,o.responseReceivingDuration=null,o.callbackDuration=null,o[PM]=null,o[lm]=0,o.pageUrl=null,o[Cc]=null,o.requestSize=0,o[Vh]=null,o[Ic]=null,o[jf]=null,o.responseStartedTime=null,o[Zv]=null,o.callbackFinishedTime=null,o.endTime=null,o.xhrMonitoringState=new Kbe,o.clientFailure=0,o[gu]=e,o[jh]=t,o[Zs]=i==null?void 0:i.getTraceFlags(),o[Kz]=i?((r={})[Zx]=i[xM](),r[Xx]=i.getSpanId(),r[Zs]=i[EM](),r):null,mi(n,o,function(l){l.getAbsoluteUrl=function(){return l[Cc]?O0e(l[Cc]):null},l.getPathName=function(){return l[Cc]?Px(a,L0e(l[Vh],l[Cc])):null},l[SM]=function(h,p,g){var _;return l.ajaxTotalDuration=Math.round(1e3*Xa(l.requestSentTime,l.responseFinishedTime))/1e3,l[PM]<0?null:((_={id:"|"+l[gu]+"."+l[jh],target:l[gM]()})[dm]=l.getPathName(),_.type=h,_[Uf]=null,_.duration=l[PM],_.success=200<=+l[Ic]&&+l[Ic]<400,_.responseCode=+l[Ic],_[Df]={HttpMethod:l[Vh]},_=(h=_)[Df],l[lm]&&(_[lm]=!0),l[jf]&&(h[Uf]=new Date,h[Uf].setTime(l[jf])),Ybe(l,h),p&&0<eu(l.requestHeaders)[Ff]&&(_[Xs]=l[Xs]),g&&(p=g())&&((g=p[IM])&&(h.correlationContext=g),p[hm]&&0<eu(p.headerMap)[Ff]&&(_.responseHeaders=p[hm]),l[TM])&&(400<=l[Ic]?((g=p.type)!==""&&g!=="text"||(_.responseText=p.responseText?p[zf]+" - "+p.responseText:p[zf]),g==="json"&&(_.responseText=p.response?p[zf]+" - "+JSON.stringify(p[$z]):p[zf])):l[Ic]===0&&(_.responseText=p[zf]||"")),h)},l[CM]=function(){var h,p=null,g=l[Kz];return g&&(g[Zx]||g[Xx])&&(h=(p={})[Ss.TraceExt]=((h={})[gu]=g[Zx],h.parentID=g[Xx],h),bt(g[Zs])||(h[Zs]=g[Zs])),p}})}return n.__ieDyn=1,n}(),Qv="diagLog",Gh="_ajaxData",Hf="fetch",Jv="Failed to monitor XMLHttpRequest",Qz=", monitoring data for this ajax call ",fm=Qz+"may be incorrect.",Jz=Qz+"won't be sent.",ej="Failed to get Request-Context correlation header as it may be not included in the response or not accessible.",tj="Failed to add custom defined request context as configured call back may missing a null check.",nj="Failed to calculate the duration of the ",Zbe=0;function Xbe(){var n=qs();return!n||bt(n.Request)||bt(n.Request[ol])||bt(n[Hf])?null:n[Hf]}function Qbe(n,e){var t,r=!1,i=(nx()&&(r=!(bt(i=XMLHttpRequest[ol])||bt(i.open)||bt(i.send)||bt(i.abort))),oU());if(r=i&&i<9?!1:r)try{var o=new XMLHttpRequest,a={xh:[],i:((t={})[e]={},t)},l=(o[Gh]=a,XMLHttpRequest[ol].open);XMLHttpRequest[ol].open=l}catch(h){r=!1,e0(n,15,"Failed to enable XMLHttpRequest monitoring, extension is not supported",((i={})[Xv]=rn(h),i))}return r}var pm=function(n,e){return n&&e&&n[Gh]?(n[Gh].i||{})[e]:null},Jbe=function(n,e,t){n&&(n=(n[Gh]||{}).xh)&&n.push({n:e,v:t})},MM=function(n,e){var t=!1;return n&&(n=(n[Gh]||{}).xh)&&on(n,function(r){if(r.n===e)return t=!0,-1}),t};function eE(n,e){var t="";try{var r=pm(n,e);r&&r[Cc]&&(t+="(url: '"+r[Cc]+"')")}catch{}return t}function e0(n,e,t,r,i){Ut(n[Qv](),1,e,t,r,i)}function mu(n,e,t,r,i){Ut(n[Qv](),2,e,t,r,i)}function t0(n,e,t){return function(r){var i;e0(n,e,t,((i={ajaxDiagnosticsMessage:eE(r[Yv],n._ajaxDataId)})[Xv]=rn(r.err),i))}}function gm(n,e){return n&&e?Za(n,e):-1}function rj(n,e,t){var r={id:e,fn:t};return n.push(r),{remove:function(){on(n,function(i,o){if(i.id===r.id)return n.splice(o,1),-1})}}}function ij(n,e,t,r){var i=!0;return on(e,function(o,a){try{o.fn.call(null,t)===!1&&(i=!1)}catch(l){Ut(n&&n.logger,1,64,"Dependency "+r+" [#"+a+"] failed: "+Dr(l),{exception:rn(l)},!0)}}),i}function e1e(n,e,t,r,i,o){var a;0<n[Ff]&&((a={})[Ac]=e,a.xhr=r,a.input=i,a.init=o,a.traceId=t[gu],a.spanId=t[jh],a.traceFlags=t[Zs],a.context=t[Kv]||{},a.aborted=!!t[lm],ij(e,n,r=a,"listener"),t[gu]=r[Zx],t[jh]=r[Xx],t[Zs]=r[Zs],t[Kv]=r[Kv])}var tE="*.blob.core.",t1e=tu([tE+"windows.net",tE+"chinacloudapi.cn",tE+"cloudapi.de",tE+"usgovcloudapi.net"]),n1e=[/https:\/\/[^\/]*(\.pipe\.aria|aria\.pipe|events\.data|collector\.azure)\.[^\/]+\/(OneCollector\/1|Collector\/3)\.0/i],r1e=tu(((eo={})[Bz]=500,eo[_M]=!1,eo[Vz]=!1,eo[Uz]=void 0,eo.disableCorrelationHeaders=!1,eo.distributedTracingMode=1,eo.correlationHeaderExcludedDomains=t1e,eo.correlationHeaderDomains=void 0,eo.correlationHeaderExcludePatterns=void 0,eo.appId=void 0,eo.enableCorsCorrelation=!1,eo[yM]=!1,eo[Hz]=!1,eo[Dz]=!1,eo[Fz]=!1,eo.maxAjaxPerfLookupAttempts=3,eo[jz]=25,eo.ignoreHeaders=["Authorization","X-API-Key","WWW-Authenticate"],eo[zz]=void 0,eo.addIntEndpoints=!0,eo)),i1e=function(n){function e(){var t,r,i,o,a,l,h,p,g,_,x,C,M,L,F,z,ee,ce,se,_e,J,pe,ue,xe,je,ne,Ee,ke,Be,Ze,at=n.call(this)||this;return at.identifier=e.identifier,at.priority=120,mi(e,at,function(Re,ht){var Rt=ht[Qx];function dn(){var he=cl();Ze=r=t=!1,i=he&&he.host&&he.host[um](),L=C=_=g=l=a=!1,ee=z=!(F={}),_e=se=ce=x=p=o=null,pe=M=h=0,ue=[],xe=[],J=Ws("ajaxData"),Re._ajaxDataId=J,ke=Ee=ne=1,Be=je=null}function wt(he){var B=!0;return(he||je)&&on(je,function(H){if(H[um]()===he[um]())return B=!1,-1}),B}function Ge(he,B,H){Rt(A0e(he,B,H))}function qn(he,B,H){var D,Q,ae=!1,q=((Pn(B)?B:(B||{}).url||"")||"")[um]();return on(ce,function(Ae){var Pe=Ae;Pn(Ae)&&(Pe=new RegExp(Ae)),ae=ae||Pe.test(q)}),ae||(D=gm(q,"?"),Q=gm(q,"#"),(D=D===-1||Q!==-1&&Q<D?Q:D)!==-1&&(q=q.substring(0,D)),bt(he)?bt(B)||(ae=typeof B=="object"&&B[Ex]===!0||!!H&&H[Ex]===!0):ae=he[Ex]===!0||q[Ex]===!0,(ae=!ae&&q&&TP(q)?!0:ae)?F[q]||(F[q]=1):F[q]&&(ae=!0)),ae}function Qt(he,B,H){var D=!0,Q=r;return bt(he)||(D=H===!0||!bt(B)),Q&&D}function ln(){var he=null;return he=!(he=Re[Ac]&&Re[Ac].getTraceCtx?Re[Ac].getTraceCtx(!1):he)&&p&&p.telemetryTrace?SP(p.telemetryTrace):he}function Mn(he,B){var H;B[Cc]&&x&&C&&(H=nu())&&Gn(H.mark)&&(he=x+he+"#"+ ++Zbe,H.mark(he),H=H.getEntriesByName(he))&&H[Ff]===1&&(B[Jx]=H[0])}function Ot(he,B,H,D){var Q=B[Jx],ae=nu(),q=ne,Ae=Ee,Pe=B[Cc],We=0;(function rt(){try{if(ae&&Q){We++;for(var Et=null,Bt=ae.getEntries(),Lt=Bt[Ff]-1;0<=Lt;Lt--){var an=Bt[Lt];if(an){if(an.entryType==="resource")an.initiatorType!==he||gm(an[dm],Pe)===-1&&gm(Pe,an[dm])===-1||(Et=an);else if(an.entryType==="mark"&&an[dm]===Q[dm]){B[AM]=Et;break}if(an[Uf]<Q[Uf]-1e3)break}}}!Q||B[AM]||q<=We||B.async===!1?(Q&&Gn(ae.clearMarks)&&ae.clearMarks(Q[dm]),B.perfAttempts=We,H()):$s(rt,Ae)}catch(Ie){D(Ie)}})()}function En(he){var B="";try{bt(he)||(B+="(url: '".concat(typeof he=="string"?he:he.url,"')"))}catch(H){e0(Re,15,"Failed to grab failed fetch diagnostics message",{exception:rn(H)})}return B}function lt(he,B,H,D,Q,ae){function q(Ae,Pe,We){We=We||{},We.fetchDiagnosticsMessage=En(H),Pe&&(We.exception=rn(Pe)),mu(Re,Ae,nj+"fetch call"+Jz,We)}Q&&(Q[Zv]=Mx(),Q[Ic]=B,Ot(Hf,Q,function(){var Ae,Pe=Q[SM]("Fetch",a,ae);try{se&&(Ae=se({status:B,request:H,response:D}))}catch{mu(Re,104,tj)}Pe?(Ae!==void 0&&(Pe[Df]=Ia(Ia({},Pe.properties),Ae)),Ae=Q[CM](),Pt(xe,Re[Ac],Q,Pe,null,Ae)):q(14,null,{requestSentTime:Q[jf],responseFinishedTime:Q[Zv]})},function(Ae){q(18,Ae,null)}))}function Pt(he,B,H,D,Q,ae){var q,Ae=!0;0<he[Ff]&&((q={item:D})[Df]=Q,q.sysProperties=ae,q.context=H?H[Kv]:null,q.aborted=!!H&&!!H[lm],Ae=ij(B,he,q,"initializer")),Ae&&Re[Nz](D,Q,ae)}dn(),Re.initialize=function(he,B,H,D){var Q,ae;!Re.isInitialized()&&(ht.initialize(he,B,H,D),_e=Sh(Ws("ajax"),B&&B.evtNamespace&&B.evtNamespace()),Re[Qx](Qi(he,function(q){q=Ec(null,q.cfg,Re[Ac]),o=q.getExtCfg(e.identifier,r1e),ke=o.distributedTracingMode,a=o[yM],l=o[Dz],C=o[Fz],M=o[Bz],ce=[].concat(o[Uz]||[],o.addIntEndpoints!==!1?n1e:[]),se=o[zz],_=ke===0||ke===1,g=ke===1||ke===2,C&&(x=J),z=!!o[_M],ne=o.maxAjaxPerfLookupAttempts,Ee=o[jz],je=o.ignoreHeaders,Be=o.appId})),Qbe(Re,J)&&Re[Qx](Qi(o,function(){z=!!o[_M],a=o[yM],z||r||(Ge(XMLHttpRequest,"open",{ns:_e,req:function(q,Ae,Pe,We){var rt,Et,Bt,Lt,an,Ie,Te;z||(q=q[Yv],rt=pm(q,J),!qn(q,Pe)&&Qt(q,rt,!0)&&(rt&&rt.xhrMonitoringState[vM]||(Lt=q,Ae=Ae,Pe=Pe,We=We,an=ln(),Ie=an&&an[xM]()||Eh(),Te=dh(Eh(),0,16),Lt=(Lt=Lt[Gh]=Lt[Gh]||{xh:[],i:{}}).i=Lt.i||{},(Ie=Lt[J]=Lt[J]||new Xz(Ie,Te,Re[Qv](),(Lt=Re.core)==null?void 0:Lt.getTraceCtx()))[Zs]=an&&an[EM](),Ie[Vh]=Ae,Ie[Cc]=Pe,Ie.xhrMonitoringState[vM]=!0,Ie[Xs]={},Ie.async=We,Ie[TM]=l,rt=Ie),Et=q,(Bt=rt).xhrMonitoringState[Gz]=uu(Et,"readystatechange",function(){var At,xt,qt;try{Et&&Et.readyState===4&&Qt(Et,Bt)&&((qt=pm(xt=Et,J))[Zv]=Mx(),qt[Ic]=xt[Ic],Ot("xmlhttprequest",qt,function(){try{var gt,Tt=qt[SM]("Ajax",a,function(){(ti={statusText:xt[zf]})[hm]=null,ti[IM]=function(Ar){try{var oe=Ar[Wz]();if(oe!==null&&gm(oe[um](),ei[8])!==-1)return A8(Ar.getResponseHeader(ei[0]))}catch(V){mu(Re,18,ej,((oe={})[Yz]=eE(Ar,J),oe[Xv]=rn(V),oe))}}(xt),ti.type=xt.responseType,ti[qz]=function(Ar){try{var oe=Ar.responseType;if(oe===""||oe==="text")return Ar[qz]}catch{}return null}(xt),ti.response=xt[$z];var nn,Fr,ti;return L&&(nn=xt[Wz]())&&(nn=ho(nn).split(/[\r\n]+/),Fr={},on(nn,function(V){var V=V.split(": "),oe=V.shift(),V=V.join(": ");wt(oe)&&(Fr[oe]=V)}),ti[hm]=Fr),ti}),Rn=void 0;try{se&&(Rn=se({status:xt[Ic],xhr:xt}))}catch{mu(Re,104,tj)}Tt?(Rn!==void 0&&(Tt[Df]=Ia(Ia({},Tt.properties),Rn)),gt=qt[CM](),Pt(xe,Re[Ac],qt,Tt,null,gt)):Ke(null,{requestSentTime:qt[jf],responseFinishedTime:qt[Zv]})}finally{try{var Qn=(xt[Gh]||{i:{}}).i||{};Qn[J]&&(Qn[J]=null)}catch{}}},function(gt){Ke(gt,null)}))}catch(gt){var fn=rn(gt);fn&&gm(fn[um](),"c00c023f")!==-1||e0(Re,16,Jv+" 'readystatechange' event handler"+fm,((At={})[Yz]=eE(Et,J),At[Xv]=fn,At))}function Ke(gt,Tt){Tt=Tt||{},Tt.ajaxDiagnosticsMessage=eE(xt,J),gt&&(Tt.exception=rn(gt)),mu(Re,14,nj+"ajax call"+Jz,Tt)}},_e)))},hkErr:t0(Re,15,Jv+".open"+fm)}),Ge(XMLHttpRequest,"send",{ns:_e,req:function(q,Ae){var Pe;z||Qt(q=q[Yv],Pe=pm(q,J))&&!Pe.xhrMonitoringState[bM]&&(Mn("xhr",Pe),Pe[jf]=Mx(),Re[pM](Pe,void 0,void 0,q),Pe.xhrMonitoringState[bM]=!0)},hkErr:t0(Re,17,Jv+fm)}),Ge(XMLHttpRequest,"abort",{ns:_e,req:function(q){z||Qt(q=q[Yv],q=pm(q,J))&&!q.xhrMonitoringState[wM]&&(q[lm]=1,q.xhrMonitoringState[wM]=!0)},hkErr:t0(Re,13,Jv+".abort"+fm)}),Ge(XMLHttpRequest,"setRequestHeader",{ns:_e,req:function(q,Ae,Pe){var We;z||(q=q[Yv],(We=pm(q,J))&&Qt(q,We)&&(Jbe(q,Ae,Pe),a)&&wt(Ae)&&We&&(We[Xs][Ae]=Pe))},hkErr:t0(Re,71,Jv+".setRequestHeader"+fm)}),r=!0)})),(H=Xbe())&&(Q=qs(),ae=H.polyfill,Re[Qx](Qi(o,function(){ee=!!o[Vz],L=o[Hz],ee||t?ae&&!Ze&&(Rt(uP(Q,Hf,{ns:_e,req:function(q,Ae,Pe){qn(null,Ae,Pe)}})),Ze=!0):(Rt(uP(Q,Hf,{ns:_e,req:function(q,Ae,Pe){var We,rt;ee||!t||qn(null,Ae,Pe)||ae&&r||(We=q.ctx(),rt=function(Et,Bt){var Lt=ln(),an=Lt&&Lt[xM]()||Eh(),Ie=dh(Eh(),0,16),Ie=new Xz(an,Ie,Re[Qv](),(an=Re.core)==null?void 0:an.getTraceCtx());Ie[Zs]=Lt&&Lt[EM](),Ie[jf]=Mx(),Ie[TM]=l,an=Et instanceof Request?(Et||{}).url||"":Et,an===""&&(Lt=cl())&&Lt.href&&(an=fB(Lt.href,"#")[0]),Ie[Cc]=an,Lt="GET",Bt&&Bt[Vh]?Lt=Bt[Vh]:Et&&Et instanceof Request&&(Lt=Et[Vh]),Ie[Vh]=Lt;var Te={};return a&&new Headers((Bt?Bt[Bf]:0)||Et instanceof Request&&Et[Bf]||{}).forEach(function(At,xt){wt(xt)&&(Te[xt]=At)}),Ie[Xs]=Te,Mn(Hf,Ie),Ie}(Ae,Pe),(Ae=Re[pM](rt,Ae,Pe))!==Pe&&q.set(1,Ae),We.data=rt)},rsp:function(q,Ae){var Pe;ee||(Pe=q.ctx().data)&&(q.rslt=q.rslt.then(function(We){return lt(0,(We||{})[Ic],Ae,We,Pe,function(){(Et={statusText:(We||{})[zf]})[hm]=null,Et[IM]=function(Bt){if(Bt&&Bt[Bf])try{return A8(Bt[Bf].get(ei[0]))}catch(Lt){mu(Re,18,ej,((Bt={fetchDiagnosticsMessage:En(Bt)})[Xv]=rn(Lt),Bt))}}(We);var rt,Et;return L&&We&&(rt={},We.headers.forEach(function(Bt,Lt){wt(Lt)&&(rt[Lt]=Bt)}),Et[hm]=rt),Et}),We}).catch(function(We){throw lt(0,0,Ae,null,Pe,null,We.message||rn(We)),We}))},hkErr:t0(Re,15,"Failed to monitor Window.fetch"+fm)},!0,eB())),t=!0)})),ae)&&(Q[Hf].polyfill=ae),D=Re[Ac].getPlugin(Nx))&&(p=D.plugin[Kv])},Re._doTeardown=function(){dn()},Re.trackDependencyData=function(he,B){Pt(xe,Re[Ac],null,he,B)},Re[pM]=function(he,B,H,D){var Q,ae,q,Ae,Pe=Re._currentWindowHost||i;return e1e(ue,Re[Ac],he,D,B,H),B||B===""?(C8(o,he[gM](),Pe)&&(H=H||{},B=new Headers(H[Bf]||B instanceof Request&&B[Bf]||{}),_&&(Q="|"+he[gu]+"."+he[jh],B.set(ei[3],Q),a)&&(he[Xs][ei[3]]=Q),(ae=Be||p&&p.appId())&&(B.set(ei[0],ei[2]+ae),a)&&(he[Xs][ei[0]]=ei[2]+ae),g&&(bt(q=he[Zs])&&(q=1),Ae=zU(UU(he[gu],he[jh],q)),B.set(ei[4],Ae),a)&&(he[Xs][ei[4]]=Ae),H[Bf]=B),H):D?(C8(o,he[gM](),Pe)&&(_&&(MM(D,ei[3])?mu(Re,71,"Unable to set ["+ei[3]+"] as it has already been set by another instance"):(Q="|"+he[gu]+"."+he[jh],D[mM](ei[3],Q),a&&(he[Xs][ei[3]]=Q))),(ae=Be||p&&p.appId())&&(MM(D,ei[0])?mu(Re,71,"Unable to set ["+ei[0]+"] as it has already been set by another instance"):(D[mM](ei[0],ei[2]+ae),a&&(he[Xs][ei[0]]=ei[2]+ae))),g)&&(bt(q=he[Zs])&&(q=1),MM(D,ei[4])?mu(Re,71,"Unable to set ["+ei[4]+"] as it has already been set by another instance"):(Ae=zU(UU(he[gu],he[jh],q)),D[mM](ei[4],Ae),a&&(he[Xs][ei[4]]=Ae))),D):void 0},Re[Nz]=function(he,B,H){M===-1||h<M?(ke!==2&&ke!==1||typeof he.id!="string"||he.id[he.id[Ff]-1]==="."||(he.id+="."),bt(he[Uf])&&(he[Uf]=new Date),he=Lh(he,wf.dataType,wf.envelopeType,Re[Qv](),B,H),Re[Ac].track(he)):h===M&&e0(Re,55,"Maximum ajax per page view limit reached, ajax monitoring is paused until the next trackPageView(). In order to increase the limit set the maxAjaxCallsPerView configuration parameter.",!0),++h},Re.addDependencyListener=function(he){return rj(ue,pe++,he)},Re.addDependencyInitializer=function(he){return rj(xe,pe++,he)}}),at}return au(e,n),e.prototype.processTelemetry=function(t,r){this.processNext(t,r)},e.prototype.addDependencyInitializer=function(t){return null},e.identifier="AjaxDependencyPlugin",e}(Vg),o1e=function(){},a1e=function(){this.id="browser",this.deviceClass="Browser"},s1e="3.3.0",c1e=function(n,e){var t=this,r=Qi(n,function(){var i=n.sdkExtension;t.sdkVersion=(i?i+"_":"")+"javascript:"+s1e});e&&e.add(r)},l1e=function(){},nE="sessionManager",rE="update",iE="isUserCookieSet",oE="isNewUser",RM="getTraceCtx",kM="telemetryTrace",oj="applySessionContext",aj="applyApplicationContext",sj="applyDeviceContext",cj="applyOperationContext",lj="applyUserContext",uj="applyOperatingSystemContxt",hj="applyLocationContext",dj="applyInternalContext",Gf="accountId",aE="getSessionId",OM="namePrefix",u1e="sessionCookiePostfix",fj="userCookiePostfix",sE="idLength",LM="getNewId",cE="length",mm="automaticSession",ym="authenticatedId",n0="acquisitionDate",lE="renewalDate",r0="join",i0="cookieSeparator",NM="authUserCookieName",h1e="ai_session",d1e=864e5,f1e=18e5,p1e=6e4,pj=function(){},g1e=function(){function n(e,t,r){var i,o,a,l,h=uf(t),p=HI(t);mi(n,this,function(g){var _=Qi(e=e||{},function(M){a=e.sessionExpirationMs||d1e,l=e.sessionRenewalMs||f1e;var L=e.sessionCookiePostfix||e[OM]||"";i=h1e+L});function x(M,L){var F=!1,z=", session will be reset",ee=L.split("|");if(2<=ee[cE])try{var ce=+ee[1]||0,se=+ee[2]||0;isNaN(ce)||ce<=0?Ut(h,2,27,"AI session acquisition date is 0"+z):isNaN(se)||se<=0?Ut(h,2,27,"AI session renewal date is 0"+z):ee[0]&&(M.id=ee[0],M[n0]=ce,M[lE]=se,F=!0)}catch(_e){Ut(h,1,9,"Error parsing ai_session value ["+(L||"")+"]"+z+" - "+Dr(_e),{exception:rn(_e)})}return F}function C(z,L){var ee=z[n0],F=(z[lE]=L,l),ce=ee+a-L,z=[z.id,ee,L],ee=0,ee=ce<F?ce/1e3:F/1e3,ce=e.cookieDomain||null;p.set(i,z[r0]("|"),0<a?ee:null,ce),o=L}r&&r.add(_),g[mm]=new pj,g[rE]=function(){var M,L,F=tl(),z=!1,ee=g[mm];!(z=ee.id?z:!function(ce){var se=!1,_e=p.get(i);return(_e&&Gn(_e.split)||(_e=P8(h,i)))&&(se=x(ce,_e)),se||ce.id}(ee))&&0<a&&(M=F-ee[n0],L=F-ee[lE],z=(z=(z=M<0||L<0)||a<M)||l<L),z?(M=F,L=e[LM]||MI,g.automaticSession.id=L(e[sE]||22),g[mm][n0]=M,C(g[mm],M),kx()||Ut(h,2,0,"Browser does not support local storage. Session durations will be inaccurate.")):(!o||p1e<F-o)&&C(ee,F)},g.backup=function(){var M,L,F=g[mm];M=F.id,L=F[n0],F=F[lE],M8(h,i,[M,L,F][r0]("|"))}})}return n.__ieDyn=1,n}(),m1e=function(n,e,t,r){this.traceID=n||Eh(),this.parentID=e,n=cl(),!t&&n&&n.pathname&&(t=n.pathname),this.name=po(r,t)};function gj(n){return!(typeof n!="string"||!n||n.match(/,|;|=| |\|/))}var y1e=function(){function n(e,t,r){this.isNewUser=!1,this.isUserCookieSet=!1;var i,o=uf(t),a=HI(t);mi(n,this,function(l){Pr(l,"config",{g:function(){return e}});var h=Qi(e,function(){var x=e[fj]||"",x=(i=n.userCookieName+x,a.get(i)),x=(x&&(l[oE]=!1,0<(x=x.split(n[i0]))[cE])&&(l.id=x[0],l[iE]=!!l.id),l.id||(l.id=p(),_(g(l.id)[r0](n[i0])),x=(e[OM]||"")+"ai_session",V0e(o,x)),l[Gf]=e[Gf]||void 0,a.get(n[NM]));x&&((x=(x=decodeURI(x)).split(n[i0]))[0]&&(l[ym]=x[0]),1<x[cE])&&x[1]&&(l[Gf]=x[1])});function p(){var x=e||{};return(x[LM]||MI)(x[sE]?e[sE]:22)}function g(x){var C=Bg(new Date);return l.accountAcquisitionDate=C,l[oE]=!0,[x,C]}function _(x){l[iE]=a.set(i,x,31536e3)}r&&r.add(h),l.setAuthenticatedUserContext=function(x,C,M){M===void 0&&(M=!1),!gj(x)||C&&!gj(C)?Ut(o,2,60,"Setting auth user context failed. User auth/account id should be of type string, and not contain commas, semi-colons, equal signs, spaces, or vertical-bars.",!0):(l[ym]=x,x=l[ym],C&&(l[Gf]=C,x=[l[ym],l.accountId][r0](n[i0])),M&&a.set(n[NM],encodeURI(x)))},l.clearAuthenticatedUserContext=function(){l[ym]=null,l[Gf]=null,a.del(n[NM])},l[rE]=function(x){l.id===x&&l[iE]||_(g(x||p())[r0](n[i0]))}})}return n.cookieSeparator="|",n.userCookieName="ai_user",n.authUserCookieName="ai_authUser",n}(),uE="ext",hE="tags";function _m(n,e){n&&n[e]&&eu(n[e])[cE]===0&&delete n[e]}function mj(){return null}var Ra,DM,yu,dE,o0,yj,fE,_1e=function(){function n(e,t,r,i){var o=this,a=e.logger;mi(n,this,function(l){var h,p,g;l.appId=mj,l[aE]=mj,l.application=new o1e,l.internal=new c1e(t,i),Sw()&&(l[nE]=new g1e(t,e,i),l.device=new a1e,l.location=new l1e,l.user=new y1e(t,e,i),p=h=void 0,r&&(h=r.getTraceId(),p=r.getSpanId(),g=r.getName()),l[kM]=new m1e(h,p,g,a),l.session=new pj),l[aE]=function(){var _=l.session;return _&&Pn(_.id)||(_=(l[nE]||{})[mm])&&Pn(_.id)?_.id:null},l[oj]=function(_,x){oi(Pa(_.ext,Ss.AppExt),"sesId",l[aE](),Pn)},l[uj]=function(_,x){oi(_.ext,Ss.OSExt,l.os)},l[aj]=function(_,x){var C=l.application;C&&(oi(_=Pa(_,hE),ai.applicationVersion,C.ver,Pn),oi(_,ai.applicationBuild,C.build,Pn))},l[sj]=function(_,x){var C=l.device;C&&(oi(_=Pa(Pa(_,uE),Ss.DeviceExt),"localId",C.id,Pn),oi(_,"ip",C.ip,Pn),oi(_,"model",C.model,Pn),oi(_,"deviceClass",C.deviceClass,Pn))},l[dj]=function(_,x){var C,M=l.internal;M&&(oi(C=Pa(_,hE),ai.internalAgentVersion,M.agentVersion,Pn),oi(C,ai.internalSdkVersion,po(a,M.sdkVersion,64),Pn),_.baseType!==Ev.dataType&&_.baseType!==Rh.dataType||(oi(C,ai.internalSnippet,M.snippetVer,Pn),oi(C,ai.internalSdkSrc,M.sdkSrc,Pn)))},l[hj]=function(_,x){var C=o.location;C&&oi(Pa(_,hE,[]),ai.locationIp,C.ip,Pn)},l[cj]=function(_,x){var C=l[kM];C&&(oi(_=Pa(Pa(_,uE),Ss.TraceExt,{traceID:void 0,parentID:void 0}),"traceID",C.traceID,Pn,bt),oi(_,"name",C.name,Pn,bt),oi(_,"parentID",C.parentID,Pn,bt))},l.applyWebContext=function(_,x){var C=o.web;C&&oi(Pa(_,uE),Ss.WebExt,C)},l[lj]=function(_,x){var C=l.user;C&&(oi(Pa(_,hE,[]),ai.userAccountId,C[Gf],Pn),oi(_=Pa(Pa(_,uE),Ss.UserExt),"id",C.id,Pn),oi(_,"authId",C[ym],Pn))},l.cleanUp=function(_,x){_=_.ext,_&&(_m(_,Ss.DeviceExt),_m(_,Ss.UserExt),_m(_,Ss.WebExt),_m(_,Ss.OSExt),_m(_,Ss.AppExt),_m(_,Ss.TraceExt))}})}return n.__ieDyn=1,n}(),vm=null,v1e=bg(((Ra={})[Gf]=vm,Ra.sessionRenewalMs=18e5,Ra.samplingPercentage=100,Ra.sessionExpirationMs=864e5,Ra.cookieDomain=vm,Ra.sdkExtension=vm,Ra.isBrowserLinkTrackingEnabled=!1,Ra.appId=vm,Ra[aE]=vm,Ra[OM]=DM,Ra[u1e]=DM,Ra[fj]=DM,Ra[sE]=22,Ra[LM]=vm,Ra)),b1e=function(n){function e(){var t,r,i,o,a,l=n.call(this)||this;return l.priority=110,l.identifier=Nx,mi(e,l,function(h,p){function g(){a=!(o=i=r=t=null)}g(),Pr(h,"context",{g:function(){return o}}),h.initialize=function(_,x,C,M){var L,F,z;p.initialize(_,x,C,M),L=_,F=h.identifier,z=h.core,h._addHook(Qi(L,function(){var ee=Ec(null,L,z);L.storagePrefix&&IP(L.storagePrefix),a=L.disableUserInitMessage!==!1,t=ee.getExtCfg(F,v1e),h._extConfig=t})),i=z[RM](!1),o=new _1e(z,t,i,h._unloadHooks),r=SP(h.context[kM],i),z.setTraceCtx(r),h.context.appId=function(){var ee=z.getPlugin(V8);return ee?ee.plugin._appId:null}},h.processTelemetry=function(_,x){var C,M,L,F;bt(_)||(x=h._getTelCtx(x),_.name===Rh.envelopeType&&x.diagLog().resetInternalMessageCount(),(L=o||{}).session&&typeof o.session.id!="string"&&L[nE]&&L[nE][rE](),(C=L.user)&&!C[iE]&&C[rE](L.user.id),L=x,Pa(M=_,"tags",[]),Pa(M,"ext",{}),(F=h.context)[oj](M,L),F[aj](M,L),F[sj](M,L),F[cj](M,L),F[lj](M,L),F[uj](M,L),F.applyWebContext(M,L),F[hj](M,L),F[dj](M,L),F.cleanUp(M,L),C&&C[oE]&&(C[oE]=!1,a||(F=new Ev(72,(el()||{}).userAgent||""),kve(x.diagLog(),1,F))),h.processNext(_,x))},h._doTeardown=function(_,x){_=(_||{}).core(),_&&_[RM]&&_[RM](!1)===r&&_.setTraceCtx(i),g()}}),l}return au(e,n),e.__ieDyn=1,e}(Vg),w1e=b1e,_j="AuthenticatedUserContext",bm="track",FM="snippet",x1e="getCookieMgr",E1e="startTrackPage",T1e="stopTrackPage",BM="flush",S1e="startTrackEvent",C1e="stopTrackEvent",A1e="addTelemetryInitializer",vj="pollInternalLogs",UM="getPlugin",zM="evtNamespace",I1e=bm+"Event",P1e=bm+"Trace",M1e=bm+"Metric",R1e=bm+"PageView",k1e=bm+"Exception",O1e=bm+"DependencyData",L1e="set"+_j,N1e="clear"+_j,D1e="https://js.monitor.azure.com/scripts/b/ai.config.1.cfg.json",jM="version",qf="queue",pE="connectionString",a0="instrumentationKey",bj="instrumentationkey",gE="userOverrideEndpointUrl",mE="endpointUrl",wj="ingestionendpoint",s0="onunloadFlush",Qs="context",xj="addHousekeepingBeforeUnload",VM="sendMessage",F1e="updateSnippetDefinitions",Ej=[FM,"dependencies","properties","_snippetVersion","appInsightsNew","getSKUDefaults"],Tj="iKeyUsage",Sj="CdnUsage",Cj="SdkLoaderVer",yE=void 0,B1e={samplingRate:100,maxSendNumber:1},U1e={monthInterval:3,daysOfMonth:[28]},_E={disabled:!0,limit:ll(B1e),interval:ll(U1e)},z1e=((yu={})[pE]=yE,yu[mE]=yE,yu[a0]=yE,yu[gE]=yE,yu.diagnosticLogInterval=lx(j1e,1e4),yu.featureOptIn=((dE={})[Tj]={mode:3},dE[Sj]={mode:2},dE[Cj]={mode:2},dE),yu.throttleMgrCfg=ll(((o0={})[109]=ll(_E),o0[106]=ll(_E),o0[111]=ll(_E),o0[110]=ll(_E),o0)),yu.extensionConfig=ll(((yj={}).AppInsightsCfgSyncPlugin=ll({cfgUrl:D1e,syncMode:2}),yj)),yu);function j1e(n){return n&&0<n}var V1e=function(){function n(e){var t,r,i,o,a,l,h,p,g,_,x,C,M,L,F=this;mi(n,this,function(z){ce(),Pr(z,"config",{g:function(){return p}}),on(["pluginVersionStringArr","pluginVersionString"],function(J){Pr(z,J,{g:function(){return h?h[J]:null}})}),o=""+(e.sv||e[jM]||""),e[qf]=e[qf]||[],e[jM]=e[jM]||2;var ee=Ys(e.config||{},z1e);function ce(){a=Ws("AISKU"),x=o=i=r=t=l=null,L=M=C=!1,_=new Abe}function se(){l&&(T0e(null,l),S0e(null,l))}function _e(J){h.addUnloadHook(J)}p=ee.cfg,g=new vbe,Pr(z,"appInsights",{g:function(){return g}}),r=new w1e,t=new i1e,i=new Wbe,h=new h0e,Pr(z,"core",{g:function(){return h}}),_e(Qi(ee,function(){var J,pe,ue=p[pE];function xe(){return dv(function(je,ne){cu(ue,function(Ee){var ke=Ee&&Ee.value,Be=null;!Ee.rejected&&ke&&(Be=O8(p[pE]=ke)),je(Be)})})}Jd(ue)&&(J=dv(function(je,ne){xe().then(function(Ee){var ke=p[a0],ke=Ee&&Ee[bj]||ke;je(ke)}).catch(function(Ee){je(null)})}),bt(pe=p[gE])&&(pe=dv(function(je,ne){xe().then(function(Be){var ke=p[mE],Be=Be&&Be[wj];je(Be?Be+Gg:ke)}).catch(function(Ee){je(null)})})),p[a0]=J,p[mE]=pe),Pn(ue)&&(pe=(J=O8(ue))[wj],p.endpointUrl=p[gE]||pe+Gg,p[a0]=J[bj]||p[a0]),p.endpointUrl=p[gE]||p[mE]})),z[FM]=e,z[BM]=function(J,pe){var ue;return yx(h,function(){return"AISKU.flush"},function(){J&&!pe&&(ue=lu(function(ne){pe=ne}));function xe(){--je===0&&pe()}var je=1;on(h.getChannels(),function(ne){ne&&(je++,ne[BM](J,xe))}),xe()},null,J=J===void 0?!0:J),ue},z[s0]=function(J){J===void 0&&(J=!0),on(h.getChannels(),function(pe){pe[s0]?pe[s0]():pe[BM](J)})},z.loadAppInsights=function(J,pe,ue){return(J=J===void 0?!1:J)&&jye("Legacy Mode is no longer supported"),yx(z.core,function(){return"AISKU.loadAppInsights"},function(){h.initialize(p,[i,r,t,g,_],pe,ue),Pr(z,"context",{g:function(){return r[Qs]}}),x=x||new G0e(h);var xe,je=H1e();je&&z[Qs]&&(z[Qs].internal.sdkSrc=je),(xe=z[FM])&&(je="",bt(o)||(je+=o),z[Qs]&&z[Qs].internal&&(z[Qs].internal.snippetVer=je||"-"),dr(z,function(ne,Ee){Pn(ne)&&!Gn(Ee)&&ne&&ne[0]!=="_"&&la(Ej,ne)===-1&&xe[ne]!==Ee&&(xe[ne]=Ee)})),z.emptyQueue(),z[vj](),z[xj](z),_e(Qi(ee,function(){var ne=!1;p.throttleMgrCfg[109]&&(ne=!p.throttleMgrCfg[109].disabled),!x.isReady()&&p.extensionConfig&&p.extensionConfig[_.identifier]&&ne&&x.onReadyState(!0),C||p[pE]||!wI(Tj,p)||(x[VM](106,"See Instrumentation key support at aka.ms/IkeyMigrate"),C=!0),!M&&z[Qs].internal.sdkSrc&&z[Qs].internal.sdkSrc.indexOf("az416426")!=-1&&wI(Sj,p)&&(x[VM](110,"See Cdn support notice at aka.ms/JsActiveCdn"),M=!0),!L&&parseInt(o)<6&&wI(Cj,p)&&(x[VM](111,"An updated Sdk Loader is available, see aka.ms/SnippetVer"),L=!0)}))}),z},z[F1e]=function(J){L_e(J,z,function(pe){return pe&&la(Ej,pe)===-1})},z.emptyQueue=function(){try{if(hr(z.snippet[qf])){for(var J=z.snippet[qf].length,pe=0;pe<J;pe++)(0,z.snippet[qf][pe])();z.snippet[qf]=void 0,delete z.snippet[qf]}}catch(ue){ue&&Gn(ue.toString)&&ue.toString()}},z[xj]=function(J){var pe,ue;(Sw()||X6())&&(ue=!(pe=function(){var xe;J[s0](!1),Gn(z.core[UM])&&(xe=F.core[UM](Nx))&&(xe=xe.plugin)&&xe[Qs]&&xe[Qs]._sessionManager&&xe[Qs]._sessionManager.backup()}),l=l||Sh(a,h[zM]&&h[zM]()),_e(Qi(p,function(ne){var ne=ne.cfg,je=J.appInsights,je=Ec(null,ne,je.core).getExtCfg(je.identifier||H8),ne=(se(),ne.disablePageUnloadEvents);je.disableFlushOnBeforeUnload||(E0e(pe,ne,l)&&(ue=!0),ue=!!aP(pe,ne,l)||ue)||J_e()||Ut(h.logger,1,19,"Could not add handler for beforeunload and pagehide"),ue||je.disableFlushOnUnload||aP(pe,ne,l)})))},z.getSender=function(){return i},z.unload=function(J,pe,ue){var xe,je=!1;return J&&!pe&&(xe=lu(function(ne){pe=ne})),z[s0](J),se(),h.unload&&h.unload(J,function(ne){je||(je=!0,ce(),pe&&pe(ne))},ue),xe},pv(z,g,[x1e,I1e,R1e,"trackPageViewPerformance",k1e,"_onerror",P1e,M1e,E1e,T1e,S1e,C1e]),pv(z,function(){return t},[O1e,"addDependencyListener","addDependencyInitializer"]),pv(z,h,[A1e,vj,"stopPollingInternalLogs",UM,"addPlugin",zM,"addUnloadCb","getTraceCtx","updateCfg","onCfgChange"]),pv(z,function(){var J=r[Qs];return J?J.user:null},[L1e,N1e])})}return n.prototype.addDependencyInitializer=function(e){return null},n}();function H1e(){if(!fE){var n=null;try{var e=(document||{}).currentScript;e&&(n=e.src)}catch{}if(n){try{var t,r=n.toLowerCase();r&&(t="",on(["://js.monitor.azure.com/","://az416426.vo.msecnd.net/"],function(i,o){if(Za(r,i)!==-1)return t="cdn"+(o+1),Za(r,"/scripts/")===-1&&(Za(r,"/next/")!==-1?t+="-next":Za(r,"/beta/")!==-1&&(t+="-beta")),fE=t+"",-1}))}catch{}fE=n}}return fE}var wm,G1e=function(){function n(e){this.options=e,!this.options.disableTelemetry&&yc.appInsightsKey&&(this.appInsights=new V1e({config:{instrumentationKey:yc.appInsightsKey,disableExceptionTracking:!0,disableAjaxTracking:!0,isCookieUseDisabled:!0,maxBatchInterval:5e3}}),this.appInsights.loadAppInsights(),this.appInsights.addTelemetryInitializer(function(t){t.tags[ai.applicationVersion]=j1.getFullVersion()}))}return n.prototype.trackEvent=function(e,t){!this.options.disableTelemetry&&this.appInsights&&this.appInsights.trackEvent(e,t)},n.prototype.setAuthenticatedUserContext=function(e,t){!this.options.disableTelemetry&&this.appInsights&&this.appInsights.setAuthenticatedUserContext(e,t)},n.prototype.trackException=function(e){!this.options.disableTelemetry&&this.appInsights&&this.appInsights.trackException(e)},n.prototype.flush=function(e){!this.options.disableTelemetry&&this.appInsights&&this.appInsights.flush(e)},n}(),q1e=window&&window.__extends||function(){var n=function(e,t){return(n=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(r,i){r.__proto__=i}:function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])}))(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),Aj=function(n){function e(){var t=n!==null&&n.apply(this,arguments)||this;return t.copyrightMessage=void 0,t.copyrightContent=void 0,t.customAttribution=void 0,t.showFeedbackLink=!0,t.showLogo=!0,t}return q1e(e,n),e}(ii),$1e=window&&window.__extends||function(){var n=function(e,t){return(n=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(r,i){r.__proto__=i}:function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])}))(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),W1e=function(n){function e(t){var r=n.call(this)||this;return r.textAttribution=function(i){return[r.options.copyrightMessage,r.options.customAttribution].filter(function(o){return o}).join("")},r.updateFeedbackLink=function(){var i,o;r.feedbackAnchor&&r.map&&(i=(o=r.map.getCamera()).center,o=o.zoom,r.feedbackAnchor.href="".concat(e.feedbackLink,"&cp=").concat(i[1],"~").concat(i[0],"&lvl=").concat(o+1))},r.options=new Aj().merge(t),r}return $1e(e,n),e.prototype.onAdd=function(t){return this.map=t,this.container=this.buildContainer(t,Ro.auto),this.container.className="map-copyright without-bg",this.copyrightDiv=this.buildCopyrightDiv(),this.copyrightDiv.className="azure-map-copyright",this.container.appendChild(this.copyrightDiv),this.options.showFeedbackLink&&this.addRemoveFeedbackDiv(!0),this.container},e.prototype.onRemove=function(){n.prototype.onRemove.call(this),delete this.container},e.prototype.setOptions=function(o){var r,i=this,o=new Aj().merge(this.options,o);o.copyrightMessage===this.options.copyrightMessage&&o.customAttribution===this.options.customAttribution||(this.copyrightDiv.innerText=this.textAttribution(o)),o.copyrightContent!==this.options.copyrightContent&&(this.options.copyrightContent&&(r=Array.from(this.copyrightDiv.children).find(function(a){return a===i.options.copyrightContent}),this.copyrightDiv.removeChild(r)),0<this.copyrightDiv.childNodes.length?this.copyrightDiv.insertBefore(o.copyrightContent,this.copyrightDiv.childNodes[0]):this.copyrightDiv.appendChild(o.copyrightContent),this.options.copyrightContent=o.copyrightContent),!o.showFeedbackLink&&this.feedbackAnchor?this.addRemoveFeedbackDiv(!1):o.showFeedbackLink&&!this.feedbackAnchor&&this.addRemoveFeedbackDiv(!0),this.options=o},e.prototype.getDefaultAttributions=function(){var t=new Date().getFullYear(),r=["©".concat(t," TomTom")];return this.options.showLogo||r.push("©".concat(t," Microsoft")),r},e.prototype.buildCopyrightDiv=function(){var t=document.createElement("div");return t.innerText=this.textAttribution(this.options)||"",t},e.prototype.buildFeedbackLink=function(){var t=document.createElement("a");return t.setAttribute("alt","Provide Map Data Feedback"),t.setAttribute("aria-label","Provide Map Data Feedback"),t.innerText="Feedback",t.href=e.feedbackLink,t.target="_blank",t.rel="noopener",t.className="azure-map-feedback-text",t},e.prototype.addRemoveFeedbackDiv=function(t){t?(this.feedbackAnchor=this.buildFeedbackLink(),this.feedbackTooltip=ko("Provide Map Data Feedback"),this.container.appendChild(this.feedbackAnchor),this.container.appendChild(this.feedbackTooltip),Ti(this.feedbackTooltip,this.feedbackAnchor),(t=(t=this.map)==null?void 0:t.events)!=null&&t.add("moveend",this.updateFeedbackLink)):(this.feedbackAnchor.remove(),this.feedbackTooltip.remove(),delete this.feedbackTooltip,delete this.feedbackAnchor,(t=(t=this.map)==null?void 0:t.events)!=null&&t.remove("moveend",this.updateFeedbackLink))},e.feedbackLink="https://aka.ms/azuremaps-feedback?feedbackep=UrlAzureMapsWebSdk",e}(xs),Y1e=window&&window.__extends||function(){var n=function(e,t){return(n=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(r,i){r.__proto__=i}:function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])}))(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),Ij=function(n){function e(){var t=n!==null&&n.apply(this,arguments)||this;return t.showLogo=!0,t}return Y1e(e,n),e}(ii),K1e=window&&window.__extends||function(){var n=function(e,t){return(n=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(r,i){r.__proto__=i}:function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])}))(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),Z1e=function(n){function e(t){var r=n.call(this)||this;return r.map=null,r._onResize=function(){var i=((i=(i=r.map)==null?void 0:i.getMapContainer())==null?void 0:i.clientWidth)||0;r._setVisiblity(r.options.showLogo&&e.CONTAINER_MIN_WIDTH<=i)},r.options=new Ij().merge(t),r}return K1e(e,n),e.prototype.onAdd=function(t){return this.map=t,this.container=this.buildContainer(t,Ro.auto),this.container.className="map-logo-control",(t=this.map)!=null&&t.events.add("resize",this._onResize),this._addRemoveLogo(this.options.showLogo),this.container},e.prototype.onRemove=function(){var t;n.prototype.onRemove.call(this),(t=this.map)!=null&&t.events.remove("resize",this._onResize),this.map=null,delete this.container},e.prototype.setOptions=function(t){t=new Ij().merge(this.options,t),!t.showLogo&&this.logoAnchor?this._addRemoveLogo(!1):t.showLogo&&!this.logoAnchor&&this._addRemoveLogo(!0),this.options=t},e.prototype._addRemoveLogo=function(t){t?(this.logoAnchor=document.createElement("a"),this.logoAnchor.className="azure-map-logo",this.logoAnchor.href="https://aka.ms/azuremaps",this.logoAnchor.setAttribute("aria-label","Visit azure.microsoft.com"),this.logoAnchor.setAttribute("target","_blank"),this.container.appendChild(this.logoAnchor),this.logoTooltip=ko("Visit azure.microsoft.com"),this.container.appendChild(this.logoTooltip),Ti(this.logoTooltip,this.logoAnchor),this._setVisiblity(!0)):((t=this.logoAnchor)!=null&&t.remove(),(t=this.logoTooltip)!=null&&t.remove(),delete this.logoAnchor,this._setVisiblity(!1))},e.prototype._setVisiblity=function(t){this.container&&(this.container.style.display=t?"flex":"none")},e.CONTAINER_MIN_WIDTH=480,e}(xs),X1e=function(){function n(){}return n.throwOnError=function(o,t){function r(a){throw i.off("error",r),a.error}var i=o instanceof S9?o._getMap():o,o=(i.on("error",r),t());return i.off("error",r),o},n.tryCatch=function(e,t,r,i){try{return this.throwOnError(e,t)}catch(o){return r(o)}finally{typeof i=="function"&&i()}},n.tryFinally=function(e,t,r){try{return this.throwOnError(e,t)}finally{r()}},n}(),Pj=window&&window.__assign||function(){return(Pj=Object.assign||function(n){for(var e,t=1,r=arguments.length;t<r;t++)for(var i in e=arguments[t])Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i]);return n}).apply(this,arguments)},Q1e=function(){function n(e){this.map=e}return n.prototype.request=function(r){var t,r={domain:this.map.getServiceOptions().domain,path:"reverseGeocode",queryParams:Pj({"api-version":"2023-06-01",coordinates:"".concat(Gi(r.position[0]),",").concat(lo(r.position[1]))},r.style.view&&{view:r.style.view}),headers:{"Accept-Language":r.style.language}};return new Zc(((t=this.map.authentication)==null?void 0:t.signRequest(r))||r).get()},n}(),J1e=function(){function n(){this._labelCache={},this._labelIdx={},this._preloadedCache=new Set}return n.prototype.cache=function(e,t,r,i){i="".concat(e,"_").concat(r[0],"_").concat(r[1],"_").concat(i),this._labelIdx[t.labelType]||(this._labelIdx[t.labelType]=[],this._labelCache[t.labelType]=[]),this._labelIdx[t.labelType].indexOf(i)===-1&&(this._labelCache[t.labelType].push({name:e,radius:t.radius,minZoom:t.minZoom,maxZoom:t.maxZoom||24,position:r}),this._labelIdx[t.labelType].push(i))},n.prototype.getNearestLabel=function(e,t,r){var i=null,o=this._labelCache[e];if(o)for(var a,l=1/0,h=0,p=o.length;h<p;h++)r>=o[h].minZoom&&r<=o[h].maxZoom&&(a=Ga(o[h].position,t))<=o[h].radius&&a<=l&&(l=a,i=o[h]);return i},n.prototype._preloadCache=function(e){if(!this._preloadedCache.has(e)){this._preloadedCache.add(e);var t={source:[],labelType:"water",minZoom:0,radius:395e4,polygonSources:[]},r=e,i=r.indexOf("-");switch(r=i!==-1?r.substr(0,i):r){case"fr":this.cache("Océan Pacifique",t,[-170,32],e),this.cache("Océan Pacifique",t,[-138,-27],e),this.cache("Océan Atlantique",t,[-40,32],e),this.cache("Océan Atlantique",t,[-17,-29],e);break;case"es":this.cache("Océan Pacifique",t,[-170,32],e),this.cache("Océan Pacifique",t,[-138,-27],e),this.cache("Océano Atlántico",t,[-40,32],e),this.cache("Océano Atlántico",t,[-17,-29],e);break;case"pt":this.cache("Oceano Pacífico",t,[-170,32],e),this.cache("Oceano Pacífico",t,[-138,-27],e),this.cache("Oceano Atlântico",t,[-40,32],e),this.cache("Oceano Atlântico",t,[-17,-29],e);break;case"ja":this.cache("太平洋",t,[-170,32],e),this.cache("太平洋",t,[-138,-27],e);break;case"en":this.cache("Pacific Ocean",t,[-170,32],e),this.cache("Pacific Ocean",t,[-138,-27],e),this.cache("Atlantic Ocean",t,[-40,32],e),this.cache("Atlantic Ocean",t,[-17,-29],e),this.cache("Indian Ocean",t,[77,-26],e)}}},n}(),c0=window&&window.__awaiter||function(n,e,t,r){return new(t=t||Promise)(function(i,o){function a(p){try{h(r.next(p))}catch(g){o(g)}}function l(p){try{h(r.throw(p))}catch(g){o(g)}}function h(p){var g;p.done?i(p.value):((g=p.value)instanceof t?g:new t(function(_){_(g)})).then(a,l)}h((r=r.apply(n,e||[])).next())})},l0=window&&window.__generator||function(n,e){var t,r,i,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]},a={next:l(0),throw:l(1),return:l(2)};return typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function l(h){return function(p){var g=[h,p];if(t)throw new TypeError("Generator is already executing.");for(;o=a&&g[a=0]?0:o;)try{if(t=1,r&&(i=2&g[0]?r.return:g[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,g[1])).done)return i;switch(r=0,(g=i?[2&g[0],i.value]:g)[0]){case 0:case 1:i=g;break;case 4:return o.label++,{value:g[1],done:!1};case 5:o.label++,r=g[1],g=[0];continue;case 7:g=o.ops.pop(),o.trys.pop();continue;default:if(!(i=0<(i=o.trys).length&&i[i.length-1])&&(g[0]===6||g[0]===2)){o=0;continue}if(g[0]===3&&(!i||g[1]>i[0]&&g[1]<i[3]))o.label=g[1];else if(g[0]===6&&o.label<i[1])o.label=i[1],i=g;else{if(!(i&&o.label<i[2])){i[2]&&o.ops.pop(),o.trys.pop();continue}o.label=i[2],o.ops.push(g)}}g=e.call(n,o)}catch(_){g=[6,_],r=0}finally{t=i=0}if(5&g[0])throw g[1];return{value:g[0]?g[1]:void 0,done:!0}}}},Mj=window&&window.__read||function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var r,i,o=t.call(n),a=[];try{for(;(e===void 0||0<e--)&&!(r=o.next()).done;)a.push(r.value)}catch(l){i={error:l}}finally{try{r&&!r.done&&(t=o.return)&&t.call(o)}finally{if(i)throw i.error}}return a},ewe=window&&window.__spreadArray||function(n,e,t){if(t||arguments.length===2)for(var r,i=0,o=e.length;i<o;i++)!r&&i in e||((r=r||Array.prototype.slice.call(e,0,i))[i]=e[i]);return n.concat(r||Array.prototype.slice.call(e))},twe=function(){function n(e,t){var r=this;this._disposed=!1,this._lastHeadingTime=0,this._actionQueue=[],this._pointerUpdateDelay=3e3,this._camUpdateDelay=1e3,this._headUpdateLimit=1e3,this._controlEventDelay=500,this._moveThreshold=25,this._headingThreshold=5,this._pitchThreshold=5,this._roadPixelRadius=120,this._minRoadDistance=25,this._minIntersectionPixelDistance=50,this._labelConfig=[{source:["Ocean label","Ocean name"],labelType:"water",minZoom:0,radius:395e4,polygonSources:["Ocean","Ocean or sea"]},{source:["Sea label"],labelType:"water",minZoom:3,radius:1e6,polygonSources:["Sea","Ocean or sea"]},{source:["Country name"],labelType:"country",minZoom:0,maxZoom:5,radius:3e5},{source:["State name","State name short"],labelType:"state",minZoom:4,maxZoom:7,radius:3e5},{source:["Capital city","Large city"],labelType:"city",minZoom:8,radius:4e4},{source:["Medium city"],labelType:"city",minZoom:8,radius:3e4},{source:["Small city"],labelType:"city",minZoom:8,radius:2e4},{source:["Island label"],labelType:"city",minZoom:8,radius:1e4},{source:["Town"],labelType:"city",minZoom:10,radius:1e4},{source:["Village"],labelType:"neighbourhood",minZoom:12,radius:6e3},{source:["Amusement area label"],labelType:"poi",minZoom:14,radius:2e3,polygonSources:["Amusement park"]},{source:["Hospital label"],labelType:"poi",minZoom:14,radius:1e3,polygonSources:["Hospital"]},{source:["Shopping centre label"],labelType:"poi",minZoom:14,radius:1e3,polygonSources:["Shopping"]},{source:["Stadium label"],labelType:"poi",minZoom:14,radius:1e3,polygonSources:["Stadium"]},{source:["University/School label"],labelType:"poi",minZoom:14,radius:1e3,polygonSources:["University"]},{source:["Zoo label"],labelType:"poi",minZoom:14,radius:1e3,polygonSources:["Zoo"]},{source:["Airport Label","Airport name","Airport POI"],labelType:"majorPoi",minZoom:11,radius:3e3,polygonSources:["Airport","Runway"]},{source:["National park label"],labelType:"majorPoi",minZoom:7,radius:15e3,polygonSources:["National or state park","National park","Forest"]},{source:["Reservation label"],labelType:"majorPoi",minZoom:7,radius:15e3,polygonSources:["Reservation"]}],this._labelCache=new Set(["city","state","country","water","majorPoi"]),this._roadLayers=new Set(["Connecting road","Connecting road tunnel","International road","International road tunnel","Local road","Local road tunnel","Major local road","Major local road tunnel","Major road","Major road tunnel","Minor local road","Minor local road tunnel","Motorway","Motorway tunnel","Secondary road","Secondary road tunnel","Toll connecting road","Toll connecting road tunnel","Toll international road","Toll international road tunnel","Toll local road","Toll local road tunnel","Toll major local road","Toll major local road tunnel","Toll major road","Toll major road tunnel","Toll minor local road","Toll minor local road tunnel","Toll motorway","Toll motorway tunnel","Toll secondary road","Toll secondary road tunnel"]),this._returnDetailedDescriptions=!1,this._shortcutListener=function(i){return c0(r,void 0,void 0,function(){var o,a,l;return l0(this,function(h){switch(h.label){case 0:return i.altKey&&i.ctrlKey&&i.keyCode===68?(this._returnDetailedDescriptions=!this._returnDetailedDescriptions,l=this._map.getCamera(),a=this._map.getStyle(),o=a.language.toLowerCase(),a=a.style.toLowerCase(),[4,this._getLocDesc(l,o,a)]):[3,2];case 1:l=h.sent(),this._descCallback(l),h.label=2;case 2:return[2]}})})},this._onRotate=function(){r._rotateTimeout||(Date.now()-r._lastHeadingTime>=r._headUpdateLimit?r._rotateTimeout=setTimeout(r._updateHeading,DF.RotationDuration+25):r._rotateTimeout=setTimeout(r._updateHeading,r._headUpdateLimit-(Date.now()-r._lastHeadingTime)))},this._onMove=function(){r._moveTimeout&&(clearTimeout(r._moveTimeout),delete r._moveTimeout),r._controlTimeout&&(clearTimeout(r._controlTimeout),delete r._controlTimeout)},this._onMoveEnd=function(i){i.fromControl?r._controlTimeout=setTimeout(r._updateCam,r._controlEventDelay):r._updateCam()},this._onStyleData=function(){setTimeout(r._updateStyle)},this._onPointerDown=function(i){r._lastPointerPos=r._getEventPos(i),r._pointerTimeout=setTimeout(function(){return c0(r,void 0,void 0,function(){var o,a,l;return l0(this,function(h){switch(h.label){case 0:return a=this._map.getStyle(),o=a.language.toLowerCase(),a=a.style.toLowerCase(),(l=this._map.getCamera()).center=this._map.pixelsToPositions([this._lastPointerPos])[0],[4,this._getLocDesc(l,o,a)];case 1:return l=h.sent(),this._descCallback(l),this._onPointerUp(),[2]}})})},r._pointerUpdateDelay),r._map.getCanvas().addEventListener("mousemove",r._onPointerMove),r._map.getCanvas().addEventListener("touchmove",r._onPointerMove),r._map.getCanvas().addEventListener("mouseup",r._onPointerUp),r._map.getCanvas().addEventListener("touchend",r._onPointerUp)},this._onPointerMove=function(a){var a=r._getEventPos(a),o=r._lastPointerPos[0]-a[0],a=r._lastPointerPos[1]-a[1];Math.sqrt(o*o+a*a)>r._moveThreshold&&r._onPointerUp()},this._onPointerUp=function(){clearTimeout(r._pointerTimeout),delete r._pointerTimeout,r._map.getCanvas().removeEventListener("mousemove",r._onPointerMove),r._map.getCanvas().removeEventListener("touchmove",r._onPointerMove),r._map.getCanvas().removeEventListener("mouseup",r._onPointerUp),r._map.getCanvas().removeEventListener("touchend",r._onPointerUp)},this._updateHeading=function(){var i,o=r._map.getCamera();r._lastHead&&!r._checkHeadingThreshold(o.bearing,r._lastHead)||(i=r._getHeadingDesc(o),r._lastHead=o.bearing,r._descCallback("<p>Map heading ".concat(i,".</p>")),r._lastHeadingTime=Date.now()),delete r._rotateTimeout},this._updateStyle=function(){return c0(r,void 0,void 0,function(){var i,o,a,l;return l0(this,function(h){switch(h.label){case 0:return i=this._map.getCamera(),a=this._map.getStyle(),o=a.language.toLowerCase(),a=a.style.toLowerCase(),this._lastLang===o?[3,2]:(n._labelCache._preloadCache(o),[4,this._getLocDesc(i,o,a)]);case 1:return l=h.sent(),[3,4];case 2:return this._lastStyle===a||this._lastStyle!=="blank"?[3,4]:[4,this._getLocDesc(i,o,a)];case 3:l=h.sent(),h.label=4;case 4:return this._lastLang=o,this._lastStyle=a,l&&this._descCallback(l),[2]}})})},this._updateCam=function(i){i===void 0&&(i=!1);var o,a,l,h=r._map.getCamera();(!r._lastCam||0<r._actionQueue.length||r._checkThresholds(h,r._lastCam))&&(l=r._map.getStyle(),o=l.language.toLowerCase(),a=l.style.toLowerCase(),(l=r._getActionDesc(h))&&r._actionQueue.push(l),r._lastCam=h,r._moveTimeout&&(clearTimeout(r._moveTimeout),delete r._moveTimeout),r._moveTimeout=setTimeout(function(){return c0(r,void 0,void 0,function(){var p;return l0(this,function(g){switch(g.label){case 0:return clearTimeout(this._rotateTimeout),delete this._rotateTimeout,[4,this._getLocDesc(h,o,a)];case 1:return p=g.sent(),0<this._actionQueue.length?(this._descCallback("<p>Map ".concat(this._actionQueue.join(", then "),".</p>").concat(p)),this._actionQueue=[]):this._descCallback(p),[2]}})})},i?0:r._camUpdateDelay))},this._map=e,this._restFallback=e.getServiceOptions().enableAccessibilityLocationFallback,this._descCallback=t,this._reverseSearch=new Q1e(e),n._labelCache||(n._labelCache=new J1e),this._lastLang=this._map.getStyle().language.toLowerCase(),n._labelCache._preloadCache(this._lastLang),this._map.events.addOnce("idle",function(){var i;r._disposed||(r._updateCam(!0),r._baseVectorTileSourceId=n._baseVectorTileSourceIds.find(function(o){return r._map.sources.getById(o)}),r._baseVectorTileSourceId==="bing-mvt"&&(r._labelConfig=n._labelConfigBing,r._roadLayers=n._roadLayersBing),r._polygonStyleLayer=r._labelConfig.reduce(function(o,a){return a.polygonSources&&o.push.apply(o,ewe([],Mj(a.polygonSources),!1)),o},[]),(i=r._map._getMap()).on("move",r._onMove),i.on("moveend",r._onMoveEnd),i.on("styledata",r._onStyleData),i.on("rotate",r._onRotate),(i=r._map.getCanvas()).addEventListener("mousedown",r._onPointerDown),i.addEventListener("touchstart",r._onPointerDown))}),this._map.getMapContainer().addEventListener("keydown",this._shortcutListener)}return n.prototype.dispose=function(){this._disposed=!0;var e=this._map._getMap(),e=(e.off("move",this._onMove),e.off("moveend",this._onMoveEnd),e.off("styledata",this._onStyleData),e.off("rotate",this._onRotate),this._map.getCanvas());e.removeEventListener("mousedown",this._onPointerDown),e.removeEventListener("touchstart",this._onPointerDown),this._map.getMapContainer().removeEventListener("keydown",this._shortcutListener)},n.prototype._getEventPos=function(e){var t,r;return"touches"in e?(t=e.touches[0],r=e.target.getBoundingClientRect(),[t.pageX-r.left,t.pageY-r.top]):[e.offsetX,e.offsetY]},n.prototype._checkThresholds=function(e,t){return this._checkZoomThreshold(e.zoom,t.zoom)||this._checkPitchThreshold(e.pitch,t.pitch)||this._checkLocThreshold(e.center,t.center)||this._checkHeadingThreshold(e.bearing,t.bearing)},n.prototype._checkZoomThreshold=function(e,t){return this._round(e)!==this._round(t)},n.prototype._checkPitchThreshold=function(e,t){return Math.abs(e-t)>=this._pitchThreshold},n.prototype._checkLocThreshold=function(e,t){return e=(t=Mj(this._map.positionsToPixels([t,e]),2))[0],t=t[1],Go.getDistance(e,t)>=this._moveThreshold},n.prototype._checkHeadingThreshold=function(e,t){return e<0&&(e+=360),t<0&&(t+=360),e=Math.abs(e-t),(e=180<e?360-e:e)>=this._headingThreshold},n.prototype._getLocDesc=function(e,t,r){return c0(this,void 0,void 0,function(){var i,o,a,l,h,p,g,_,x,C=this;return l0(this,function(M){switch(M.label){case 0:return r==="blank"?[3,3]:this._map._getMap().loaded()?[3,2]:[4,new Promise(function(L){return C._map._getMap().once("idle",L)})];case 1:M.sent(),M.label=2;case 2:for(i={},o=this._map.positionsToPixels([e.center])[0],X1e.tryCatch(this._map,function(){var L=C._map._getMap();a=L.queryRenderedFeatures(o,{layers:C._polygonStyleLayer.filter(function(F){return L.getLayer(F)}),filter:["==",["geometry-type"],"Polygon"]})},function(){}),l=null,a&&0<a.length&&(l=a[0]),h=null,p=0,g=this._labelConfig.length;p<g;p++)_=this._labelConfig[p],e.zoom>=_.minZoom?_.polygonSources?l&&_.polygonSources.indexOf(l.layer["source-layer"])!==-1?(h=_.labelType,this._getClosestLabel(_,e,t,i,!1)):this._getClosestLabel(_,e,t,i,!0):this._getClosestLabel(_,e,t,i,!1):this._getClosestLabel(_,e,t,i,!0);return 8<=e.zoom&&this._processRoads(i,e,t),this._labelCache.forEach(function(L){!i[L]&&(x=null,x=L!=="water"&&L!=="majorPoi"||L===h?n._labelCache.getNearestLabel(L,e.center,e.zoom):x)&&(i[L]=x.name)}),[2,this._processLocInfo(e,h,i,!0,this._restFallback)];case 3:return[2,this._processLocInfo(e,null,null,!1,!1)]}})})},n.prototype._getHeadingDesc=function(e){var t=e.bearing;switch(t<0&&(t+=360),t=this._round(t,this._headingThreshold)){case 0:case 360:return"north";case 45:return"north east";case 90:return"east";case 135:return"south east";case 180:return"south";case 225:return"south west";case 270:return"west";case 315:return"north west";default:return"".concat(t," degrees")}},n.prototype._getClosestLabel=function(e,t,r,i,o){for(var a=e.radius,l=0,h=e.source.length;l<h;l++){var p={sourceLayer:e.source[l],filter:["has","name"]},g=this._map._getMap().querySourceFeatures(this._baseVectorTileSourceId,p),_=null,x=1/0,C=this._labelCache.has(e.labelType);if(!o||C)for(var M=0,L=g.length;M<L;M++){var F,z=g[M].geometry.type==="Point"?g[M]:ow(t.center,g[M].geometry);o||(F=g[M].geometry.type==="Point"?Ga(t.center,z.geometry.coordinates):z.properties.distance)<x&&(x=F,_=g[M]),C&&n._labelCache.cache(g[M].properties.name,e,z.geometry.coordinates,r)}o||(p=e.labelType+"Dis",_&&x<=a&&(typeof i[p]!="number"||x<=i[p])&&(i[e.labelType]=_.properties.name,i[p]=x))}},n.prototype._processRoads=function(e,t,r,i){var o=this._map._getMap().queryRenderedFeatures(i,{filter:["==",["geometry-type"],"LineString"]});if(o){for(var a,l=void 0,h=void 0,p=void 0,g=void 0,_=0,x=o.length;_<x;_++)this._roadLayers.has(o[_].layer["source-layer"])&&o[_].properties.name&&o[_].properties.name!==""&&(a=ow(t.center,o[_]),!p||a.properties.distance<p.properties.distance)&&(l&&o[_].properties.name===l.properties.name?p=a:l&&o[_].properties.name===l.properties.name?(!g||a.properties.distance<g.properties.distance)&&(g=a,h=o[_]):(g=p,h=l,p=a,l=o[_]));l&&(!e.country&&l.properties.country_code&&(e.country=l.properties.country_code,e.countryDis=0,n._labelCache.cache(e.country,{source:[],labelType:"country",radius:5e3,minZoom:0},p.geometry.coordinates,r)),!e.state&&l.properties.country_subdivision&&(e.state=l.properties.country_subdivision,e.stateDis=0,n._labelCache.cache(e.state,{source:[],labelType:"state",radius:5e3,minZoom:4},p.geometry.coordinates,r)),15<=t.zoom)&&(i=this._map.positionsToPixels([t.center,p.geometry.coordinates]),(Go.getDistance(i[0],i[1])<this._roadPixelRadius||p.properties.distance<this._minRoadDistance)&&(e.road=l.properties.name),h)&&(r=this._map.positionsToPixels([g.geometry.coordinates]),Go.getDistance(i[0],r[0])<this._minIntersectionPixelDistance||g.properties.distance<this._minRoadDistance)&&(e.secondRoad=h.properties.name,e.secondRoadDis=g.properties.distance)}},n.prototype._getActionDesc=function(e){var t,r,i;return this._lastCam&&(t=[],this._checkLocThreshold(e.center,this._lastCam.center)&&(i=["panned"],(r=Math.round(ch(this._lastCam.center,e.center)))===0||r===360?i.push("north"):r<90?i.push("north east"):r===90?i.push("east"):r<180?i.push("south east"):r===180?i.push("south"):r<270?i.push("south west"):r===270?i.push("west"):r<360&&i.push("north west"),r=Ga(this._lastCam.center,e.center,Tr.meters),i.push(1e3<r?"".concat(Ha(r/1e3,2)," kilometers"):"".concat(Ha(r,2)," meters")),t.push(i.join(" "))),this._checkZoomThreshold(e.zoom,this._lastCam.zoom)&&((i=["zoomed"]).push(this._lastCam.zoom<e.zoom?"in":"out"),1<=(r=Math.abs(this._lastCam.zoom-e.zoom))&&(r=Math.ceil(r),i.push("".concat(r,1<r?" levels":" level"))),this._getCanonicalZoom(this._lastCam.zoom)!==this._getCanonicalZoom(e.zoom)&&i.push("to ".concat(this._getCanonicalZoom(e.zoom)," level")),e.zoom>=e.maxZoom&&i.push("Zoom In button disabled, maximum zoom level reached"),r=rr.getSouth(e.bounds)<=-O_&&rr.getNorth(e.bounds)>=O_,(e.zoom<=e.minZoom||r)&&i.push("Zoom Out button disabled, minimum zoom level reached"),t.push(i.join(" "))),this._checkPitchThreshold(e.pitch,this._lastCam.pitch)&&(r=this._round(e.pitch,this._pitchThreshold),t.push("pitched to ".concat(r," degrees")),e.pitch!==60&&e.pitch!==0||(i=e.pitch===60?"maximum":"minimum",t.push("reached ".concat(i," of ").concat(e.pitch," degrees")))),this._checkHeadingThreshold(this._lastCam.bearing,e.bearing)&&t.push("rotated to ".concat(this._getHeadingDesc(e))),t.join(" and "))||null},n.prototype._getCanonicalZoom=function(e){return(e=this._round(e))<2?"world":e<5?"country":e<11?"state province":e<15?"city":"street"},n.prototype._processLocInfo=function(e,t,r,i,o){var a=this;return new Promise(function(l,h){var p=[];if(i){var g=[];if(r&&(t&&(t==="water"&&r.water?g.push(r.water):t==="majorPoi"&&r.majorPoi&&g.push(r.majorPoi)),g.length===0)&&(r.majorPoi&&8<=e.zoom?g.push(r.majorPoi):(r.poi&&14<=e.zoom?g.push(r.poi):r.road&&15<=e.zoom&&(r.secondRoad?g.push(r.road+" & "+r.secondRoad):g.push(r.road)),r.neighbourhood&&12<=e.zoom&&g.push(r.neighbourhood),r.city&&6<=e.zoom&&g.push(r.city)),r.state&&4<=e.zoom&&g.push(r.state),g.length===0?r.water?g.push(r.water):r.country&&g.push(r.country):g.length===1&&r.state&&4<=e.zoom&&r.country&&g.push(r.country)),0<g.length)p.push("<p>Location: ",g.join(", "),".</p>");else if(o&&t!=="water")return void a._reverseGeocodeDescription(e).then(function(_){l(_)},function(){h("<p>Location: unknown</p>")})}a._returnDetailedDescriptions&&(p.push("<p>Zoom: ",Ha(e.zoom,2),".</p>"),p.push("<p>Latitude: ",Ha(e.center[1],5),".</p>"),p.push("<p>Longitude: ",Ha(e.center[0],5),".</p>")),l(p.join(""))})},n.prototype._reverseGeocodeDescription=function(e){var t=this;return new Promise(function(r){var i=t._map.getStyle();t._reverseSearch.request({position:e.center,style:i}).then(function(o){var a,l={};o&&o.features&&0<o.features.length&&(a=(a=o.features[0])==null?void 0:a.properties)!=null&&a.address&&((a=o.features[0].properties.address).countryRegion&&(l.country=a.countryRegion.name,n._labelCache.cache(l.country,{source:[],labelType:"country",radius:5e3,minZoom:0},e.center,i.language)),a.adminDistricts&&(l.state=(o=a.adminDistricts[0])==null?void 0:o.shortName,n._labelCache.cache(l.state,{source:[],labelType:"state",radius:5e3,minZoom:4},e.center,i.language)),a.locality&&(l.city=a.locality,n._labelCache.cache(l.city,{source:[],labelType:"city",radius:1e3,minZoom:10},e.center,i.language)),a.addressLine)&&(l.road=a.addressLine),t._processLocInfo(e,null,l,!0,!1).then(function(h){r(h)})},function(o){t._processLocInfo(e,null,null,!0,!1).then(function(a){r(a)})}).catch(function(o){t._processLocInfo(e,null,null,!0,!1).then(function(a){r(a)})})})},n.prototype._round=function(e,t){return t===void 0&&(t=1),Math.round(e/t)*t},n._baseVectorTileSourceIds=["microsoft.base","vectorTiles","bing-mvt"],n._labelConfigBing=[{source:["water_feature"],labelType:"water",minZoom:0,radius:395e4,polygonSources:["generic_water_fill"]},{source:["water_feature"],labelType:"water",minZoom:3,radius:1e6,polygonSources:["generic_water_fill"]},{source:["country_region"],labelType:"country",minZoom:0,maxZoom:5,radius:3e5},{source:["admin_division1"],labelType:"state",minZoom:4,maxZoom:7,radius:3e5},{source:["populated_place"],labelType:"city",minZoom:8,radius:4e4},{source:["neighborhood"],labelType:"neighbourhood",minZoom:12,radius:6e3},{source:["amusement_park"],labelType:"poi",minZoom:14,radius:2e3,polygonSources:["amusement_park_fill"]},{source:["hospital"],labelType:"poi",minZoom:14,radius:1e3,polygonSources:["hospital_fill"]},{source:["shopping_center"],labelType:"poi",minZoom:14,radius:1e3,polygonSources:["shopping_center_fill"]},{source:["stadium"],labelType:"poi",minZoom:14,radius:1e3,polygonSources:["stadium_fill"]},{source:["higher_education_facility","school"],labelType:"poi",minZoom:14,radius:1e3,polygonSources:["higher_education_facility_fill","school_fill"]},{source:["zoo"],labelType:"poi",minZoom:14,radius:1e3,polygonSources:["zoo_fill"]},{source:["airport","airport_terminal"],labelType:"majorPoi",minZoom:11,radius:3e3,polygonSources:["airport_terminal_fill","airport_fill-merged7","airport_runway_fill"]},{source:["reserve"],labelType:"majorPoi",minZoom:7,radius:15e3,polygonSources:["generic_reserve_fill","land_cover_forest_fill"]}],n._roadLayersBing=new Set(["road"]),n}(),nwe=function(n){var e=this;this.addToMap=function(){e.mapViewDesc==null&&(e.initializeMapLiveStateInfo(),e.initializeMapStyleInfo(),e.createMapKeyBindingInfo(),e.map.getMapContainer().setAttribute("role","application"),e.map.getMapContainer().setAttribute("aria-label","Map Application"),e.map.getCanvasContainer().setAttribute("aria-live","polite"),e.map.getCanvasContainer().setAttribute("aria-describedby","atlas-map-state atlas-map-style"),e.map.getCanvas().setAttribute("aria-label","Interactive Map"),e.map.getCanvas().setAttribute("aria-describedby","atlas-map-shortcuts"),e.map.getCanvas().setAttribute("alt","Interactive Map"))},this.removeFromMap=function(){e.mapViewDesc!=null&&e.mapViewDesc.dispose(),delete e.mapViewDesc,e.atlasMapKeyBindings!=null&&e.map.getCanvasContainer().removeChild(e.atlasMapKeyBindings),delete e.atlasMapKeyBindings,e.atlasMapLiveStateInfo!=null&&e.map.getCanvasContainer().removeChild(e.atlasMapLiveStateInfo),delete e.atlasMapLiveStateInfo,e.atlasMapStyleInfo!=null&&e.map.getCanvasContainer().removeChild(e.atlasMapStyleInfo),delete e.atlasMapStyleInfo,e.map.getMapContainer().removeAttribute("role"),e.map.getMapContainer().removeAttribute("aria-label"),e.map.getCanvasContainer().removeAttribute("aria-live"),e.map.getCanvasContainer().removeAttribute("aria-describedby"),e.map.getCanvas().removeAttribute("aria-label"),e.map.getCanvas().removeAttribute("aria-describedby"),e.map.getCanvas().removeAttribute("alt"),e.map.events.remove("stylechanged",e.updateMapStyle)},this.createMapKeyBindingInfo=function(){e.atlasMapKeyBindings=document.createElement("div"),e.atlasMapKeyBindings.setAttribute("tabindex","-1"),e.atlasMapKeyBindings.setAttribute("aria-hidden","true"),e.atlasMapKeyBindings.id="atlas-map-shortcuts",e.atlasMapKeyBindings.classList.add("hidden-accessible-element"),e.atlasMapKeyBindings.innerHTML=["Map shortcuts:","Zoom out: hyphen.","Zoom in: plus.","Pan right 100 pixels: right arrow.","Pan left 100 pixels: left arrow.","Pan up 100 pixels: up arrow.","Pan down 100 pixels: down arrow.","Rotate 15 degrees clockwise: shift + right arrow.","Rotate 15 degrees counter clockwise: shift + left arrow.","Increase pitch 10 degrees: shift + up arrow.","Decrease pitch 10 degrees: shift + down arrow.","Jump focus to the map: Escape."].join(`
`),e.map.getCanvasContainer().appendChild(e.atlasMapKeyBindings);var t=[189,187,38,37,39,40],r=e.map._getMap()._canvas;r!=null&&r.addEventListener("keyup",function(i){t.find(function(o){return i.keyCode===o})&&(e.atlasMapKeyBindings.innerHTML="")})},this.initializeMapLiveStateInfo=function(){e.mapViewDesc=new twe(e.map,e.updateMapState),e.atlasMapLiveStateInfo=document.createElement("div"),e.atlasMapLiveStateInfo.setAttribute("tabindex","-1"),e.atlasMapLiveStateInfo.setAttribute("aria-hidden","true"),e.atlasMapLiveStateInfo.id="atlas-map-state",e.atlasMapLiveStateInfo.classList.add("hidden-accessible-element"),e.map.getCanvasContainer().appendChild(e.atlasMapLiveStateInfo)},this.initializeMapStyleInfo=function(){e.atlasMapStyleInfo=document.createElement("div"),e.atlasMapStyleInfo.setAttribute("tabindex","-1"),e.atlasMapStyleInfo.setAttribute("aria-hidden","true"),e.atlasMapStyleInfo.id="atlas-map-style",e.atlasMapStyleInfo.classList.add("hidden-accessible-element"),e.map.events.add("stylechanged",e.updateMapStyle),e.map.getCanvasContainer().appendChild(e.atlasMapStyleInfo)},this.updateMapStyle=function(){e.atlasMapStyleInfo.innerHTML="<p>Map style: ".concat(e.map.getStyle().style,".</p>")},this.updateMapState=function(t){e.atlasMapLiveStateInfo.innerHTML=t},this.map=n},rwe=function(n){var e=this;this.listenerEnabled=!1,this.lastFlowMode="none",this.addToMap=function(){if(!e.map._isReady())throw new Error("Traffic flow could not be added to the map because the map is not ready. Please use a ready event listener to guarantee the map is ready before enabling traffic flow.");e.listenerEnabled||(e.map.events.add("styledata",e.addToMap),e.listenerEnabled=!0);var t,r=e.map.getTraffic();r.flow!=="none"&&(t=e.map.layers.getLayerById("traffic_".concat(r.flow)))&&(e.lastFlowMode=r.flow,t._updateLayoutProperty("visibility","visible","none"))},this.removeFromMap=function(){var t;e.map.getTraffic(),e.lastFlowMode!="none"&&((t=e.map.layers.getLayerById("traffic_".concat(e.lastFlowMode)))&&t._updateLayoutProperty("visibility","none","visible"),e.lastFlowMode="none"),e.listenerEnabled&&(e.map.events.remove("styledata",e.addToMap),e.listenerEnabled=!1)},this.map=n},iwe=window&&window.__extends||function(){var n=function(e,t){return(n=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(r,i){r.__proto__=i}:function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])}))(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),Rj=function(n){function e(t,r,i){var a=(a=(a=(a=(a=(a=(a=(a=(a=(a=(a=(a=(a=(a=t.icon_category_12)!=null?a:t.icon_category_11)!=null?a:t.icon_category_10)!=null?a:t.icon_category_9)!=null?a:t.icon_category_8)!=null?a:t.icon_category_7)!=null?a:t.icon_category_6)!=null?a:t.icon_category_5)!=null?a:t.icon_category_4)!=null?a:t.icon_category_3)!=null?a:t.icon_category_2)!=null?a:t.icon_category_1)!=null?a:t.icon_category_0)!=null?a:t.icon_category,o=(o=(o=(o=(o=(o=(o=(o=(o=(o=(o=(o=(o=(o=t.description_12)!=null?o:t.description_11)!=null?o:t.description_10)!=null?o:t.description_9)!=null?o:t.description_8)!=null?o:t.description_7)!=null?o:t.description_6)!=null?o:t.description_5)!=null?o:t.description_4)!=null?o:t.description_3)!=null?o:t.description_2)!=null?o:t.description_1)!=null?o:t.description_0)!=null?o:t.description,a={icon:"".concat(e.getSeverityColorName(t.magnitude),"-").concat(e.getIncidentTypeIconName(a)),incidentType:e.getIncidentTypeName(a,i),description:o,delay:t.delay,color:e.getSeverityColorHexCode(t.magnitude),id:t.id};return n.call(this,r,a)||this}return iwe(e,n),e.getIncidentTypeName=function(t,r){switch(t){case 0:return r.Unknown;case 1:return r.Accident;case 2:return r.Fog;case 3:return r.Danger;case 4:return r.Rain;case 5:return r.Ice;case 6:return r.Jam;case 7:return r.LaneClosed;case 8:return r.RoadClosed;case 9:return r.RoadWorks;case 10:return r.Wind;case 11:return r.Flood;case 12:return r.Detour;default:return r.Unknown}},e.getIncidentTypeIconName=function(t){switch(t){case 0:return"unknown";case 1:return"accident";case 2:return"fog";case 3:return"danger";case 4:return"rain";case 5:return"ice";case 6:return"jam";case 7:return"lane-closed";case 8:return"road-closed";case 9:return"road-work";case 10:return"wind";case 11:return"flood";case 12:return"detour";default:return"unknown"}},e.getSeverityColorName=function(t){switch(t){case 0:return"grey";case 1:return"yellow";case 2:return"orange";case 3:return"red";default:return"grey"}},e.getSeverityColorHexCode=function(t){switch(t){case 0:return"#B5B6B7";case 1:return"#F4C951";case 2:return"#F4873F";case 3:return"#F04F4E";default:return"#B5B6B7"}},e}(_c),kj=(function(n){n.DELAY="delay",n.LENGTH="length",n.FROM="from",n.TO="to"}(wm=wm||{}),function(){function n(){}return n.build=function(e,t){t===void 0&&(t="en-US");var r,o=document.createElement("div"),a=(o.classList.add("incident-popup-title"),o.classList.add("font-segoeui-b"),o.innerText=e.properties.incidentType,o.setAttribute("aria-label","Incident Type ".concat(e.properties.incidentType)),document.createElement("div")),i=(a.classList.add("incident-popup-subtitle"),a.classList.add("font-segoeui-b"),a.setAttribute("aria-label","Incident Description ".concat(e.properties.description)),a.innerText=e.properties.description,document.createElement("div")),o=(i.classList.add("incident-popup-header"),i.style.backgroundColor=e.properties.color,i.appendChild(o),i.appendChild(a),document.createElement("div")),a=(o.classList.add("incident-popup-body"),e.properties.delay&&(a="".concat(Math.floor(e.properties.delay/60)," min"),a=this.createInfoSection(a,wm.DELAY),o.appendChild(a)),e.properties.length&&(a=new Intl.NumberFormat([t,"en-US"],{maximumFractionDigits:2}),r=void 0,r=t==="en-US"?(t=Kl(e.properties.length,"meters","miles"),"".concat(a.format(t)," miles")):(t=Kl(e.properties.length,"meters","kilometers"),"".concat(a.format(t)," km")),a=this.createInfoSection(r,wm.LENGTH),o.appendChild(a)),e.properties.from&&(t=this.createInfoSection(e.properties.from,wm.FROM),o.appendChild(t)),e.properties.to&&(r=this.createInfoSection(e.properties.to,wm.TO),o.appendChild(r)),document.createElement("div"));return a.classList.add("incident-popup-content"),a.appendChild(i),a.appendChild(o),new pw({content:a,position:e.geometry.coordinates})},n.createInfoSection=function(e,t){var r=document.createElement("div"),i=(r.classList.add("incident-popup-info"),document.createElement("div")),o=(i.classList.add("icon"),i.classList.add(t),document.createElement("span"));return o.classList.add("message"),o.classList.add("font-segoeui"),o.setAttribute("aria-label","Incident ".concat(t," ").concat(e)),o.innerText=e,r.appendChild(i),r.appendChild(o),r},n}()),owe=window&&window.__awaiter||function(n,e,t,r){return new(t=t||Promise)(function(i,o){function a(p){try{h(r.next(p))}catch(g){o(g)}}function l(p){try{h(r.throw(p))}catch(g){o(g)}}function h(p){var g;p.done?i(p.value):((g=p.value)instanceof t?g:new t(function(_){_(g)})).then(a,l)}h((r=r.apply(n,e||[])).next())})},awe=window&&window.__generator||function(n,e){var t,r,i,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]},a={next:l(0),throw:l(1),return:l(2)};return typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function l(h){return function(p){var g=[h,p];if(t)throw new TypeError("Generator is already executing.");for(;o=a&&g[a=0]?0:o;)try{if(t=1,r&&(i=2&g[0]?r.return:g[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,g[1])).done)return i;switch(r=0,(g=i?[2&g[0],i.value]:g)[0]){case 0:case 1:i=g;break;case 4:return o.label++,{value:g[1],done:!1};case 5:o.label++,r=g[1],g=[0];continue;case 7:g=o.ops.pop(),o.trys.pop();continue;default:if(!(i=0<(i=o.trys).length&&i[i.length-1])&&(g[0]===6||g[0]===2)){o=0;continue}if(g[0]===3&&(!i||g[1]>i[0]&&g[1]<i[3]))o.label=g[1];else if(g[0]===6&&o.label<i[1])o.label=i[1],i=g;else{if(!(i&&o.label<i[2])){i[2]&&o.ops.pop(),o.trys.pop();continue}o.label=i[2],o.ops.push(g)}}g=e.call(n,o)}catch(_){g=[6,_],r=0}finally{t=i=0}if(5&g[0])throw g[1];return{value:g[0]?g[1]:void 0,done:!0}}}},swe=function(){function n(r){var t=this,r=(this.incidentLayerName="incidents",this.incidentSourceName="mapcontrol_traffic_incident",this.addToMap=function(){t.map.sources.getById(t.incidentSourceName)||t.map.sources.add(t.vectorTileSource),t.map.layers.getLayerById(t.incidentLayerName)||t.map.layers.add(t.incidentLayer,"labels"),t.clickPopup=new pw({position:[0,0],pixelOffset:[0,-18]}),t.map.addEventListener("mouseover",t.incidentLayerName,t.cursorToPointer),t.map.addEventListener("mouseleave",t.incidentLayerName,t.cursorToDefault),t.map.addEventListener("click",t.incidentLayerName,t.openIncidentPopup),t.map.events.addOnce("idle",t.setAccessiblePopups),t.map.events.add("moveend",t.setAccessiblePopups)},this.accessiblePopups=[],this.setAccessiblePopups=function(){return owe(t,void 0,void 0,function(){var i,o,a,l,h,p,g=this;return awe(this,function(_){switch(_.label){case 0:return this.accessiblePopups.forEach(function(x){return x.remove()}),this.accessiblePopups=[],i=this.map.layers.getRenderedShapes(this.map.getCamera().bounds,this.incidentLayer),[4,this.map._getLocalizedStrings()];case 1:return o=_.sent(),a=function(x,C){var M=x[C],F=M.geometry.coordinates,F=new vc(new $o(F[0],F[1])),M=new Rj(M.properties,F,o),L=kj.build(M,g.incidentLanguage),F=L.getPopupContainer();return F.addEventListener("focusin",function(z){g.clickPopup.remove(),g.accessiblePopups.filter(function(ee){return ee!==L}).forEach(function(ee){return ee.remove()}),0<=C-1&&l(L,a(x,C-1)),C+1<x.length&&p(a(x,C+1)),2<=C&&C==x.length-1&&h(a(x,0)),C==0&&2<=x.length&&p(a(x,x.length-1))}),C==x.length-1&&F.addEventListener("focusout",function(z){z.relatedTarget===null&&L.close()}),g.accessiblePopups.push(L),L},l=function(x,C){C.open(g.map),C.close(),C=C.getPopupContainer(),x=x.getPopupContainer(),x.parentElement.insertBefore(C,x)},h=function(C){C.open(g.map),C.close();var C=C.getPopupContainer(),M=C.parentElement;M.insertBefore(C,M.firstElementChild)},p=function(x){x.open(g.map),x.close()},0<i.length&&p(a(i,0)),1<i.length&&p(a(i,i.length-1)),[2]}})})},this.removeFromMap=function(){var i;t.map.removeEventListener("mouseover",t.incidentLayerName,t.cursorToPointer),t.map.removeEventListener("mouseleave",t.incidentLayerName,t.cursorToDefault),t.map.removeEventListener("click",t.incidentLayerName,t.openIncidentPopup),t.map.events.remove("idle",t.setAccessiblePopups),t.map.events.remove("moveend",t.setAccessiblePopups),t.accessiblePopups.forEach(function(o){return o.remove()}),t.accessiblePopups=[],(i=t.clickPopup)!=null&&i.remove(),t.map.layers.getLayerById(t.incidentLayerName)!=null&&t.map.layers.remove(t.incidentLayerName),t.map.sources.getById(t.incidentSourceName)!=null&&t.map.sources.remove(t.incidentSourceName)},this.cursorToPointer=function(i){t.map.getCanvas().style.cursor="pointer"},this.cursorToDefault=function(i){t.map.getCanvas().style.cursor=""},this.openIncidentPopup=function(i){t.clickPopup.remove(),t.accessiblePopups.forEach(function(l){return l.close()});var o=i.position,a=i.features[0];t.map._getLocalizedStrings().then(function(l){var h=new vc(new $o(o[0],o[1])),h=new Rj(a.properties,h,l);t.clickPopup=kj.build(h,t.incidentLanguage),t.clickPopup.open(t.map),t.clickPopup.getPopupContainer().addEventListener("focusout",function(p){p.relatedTarget===null&&t.clickPopup.close()})})},this.map=r,this.vectorTileSource=new C6(this.incidentSourceName,{maxZoom:22,tiles:["https://".concat(Nn.domainPlaceHolder,"/traffic/incident/tile/pbf?api-version=1.0&zoom={z}&x={x}&y={y}")]}),this.getIncidentIconImageExpression());this.incidentLayer=new lw(this.incidentSourceName,this.incidentLayerName,{sourceLayer:"Traffic incident POI",iconOptions:{ignorePlacement:!0,allowOverlap:!0,image:r,size:.75}})}return n.prototype.getIncidentIconImageExpression=function(){return["concat",["let","magnitude",["get","magnitude"],["case",["==",["var","magnitude"],0],"grey",["==",["var","magnitude"],1],"yellow",["==",["var","magnitude"],2],"orange",["==",["var","magnitude"],3],"red",["==",["var","magnitude"],4],"grey","grey"]],"-",["let","category",["coalesce",["get","icon_category_12"],["get","icon_category_11"],["get","icon_category_10"],["get","icon_category_9"],["get","icon_category_8"],["get","icon_category_7"],["get","icon_category_6"],["get","icon_category_5"],["get","icon_category_4"],["get","icon_category_3"],["get","icon_category_2"],["get","icon_category_0"],["get","icon_category"],0],["case",["==",["var","category"],0],"unknown",["==",["var","category"],1],"accident",["==",["var","category"],2],"fog",["==",["var","category"],3],"danger",["==",["var","category"],4],"rain",["==",["var","category"],5],"ice",["==",["var","category"],6],"jam",["==",["var","category"],7],"lane-closed",["==",["var","category"],8],"road-closed",["==",["var","category"],9],"road-work",["==",["var","category"],10],"wind",["==",["var","category"],11],"flood",["==",["var","category"],12],"detour","unknown"]]]},n}(),cwe=window&&window.__extends||function(){var n=function(e,t){return(n=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(r,i){r.__proto__=i}:function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])}))(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),Oj=function(n){function e(){var t=n!==null&&n.apply(this,arguments)||this;return t.interactive=!0,t.scrollZoomInteraction=!0,t.boxZoomInteraction=!0,t.dragRotateInteraction=!0,t.dragPanInteraction=!0,t.keyboardInteraction=!0,t.dblClickZoomInteraction=!0,t.touchInteraction=!0,t.touchRotate=!0,t.wheelZoomRate=1/450,t}return cwe(e,n),e}(ii),lwe=function(){function n(e){var t=this;this._onKeyDown=function(r){r.keyCode===27&&t.map.getCanvas().focus()},this.map=e}return n.prototype.enable=function(){this.map.getMapContainer().addEventListener("keydown",this._onKeyDown)},n.prototype.disable=function(){this.map.getMapContainer().removeEventListener("keydown",this._onKeyDown)},n}(),uwe=function(){function n(e){var t=this;this._onGestureStart=function(r){t.hasTouch||(r.preventDefault(),t.initZoom=t.map.getCamera().zoom)},this._onGestureChange=function(r){t.hasTouch||(r.preventDefault(),t.map.setCamera({zoom:t.initZoom+r.scale-1}))},this._onTouchStart=function(r){t.hasTouch=!0},this._onTouchEnd=function(r){r.touches.length===0&&(t.hasTouch=!1)},this.map=e}return n.prototype.enable=function(){this.map.getCanvasContainer().addEventListener("gesturestart",this._onGestureStart),this.map.getCanvasContainer().addEventListener("gesturechange",this._onGestureChange),this.map.getCanvasContainer().addEventListener("touchstart",this._onTouchStart),this.map.getCanvasContainer().addEventListener("touchend",this._onTouchEnd)},n.prototype.disable=function(){this.map.getCanvasContainer().removeEventListener("gesturestart",this._onGestureStart),this.map.getCanvasContainer().removeEventListener("gesturechange",this._onGestureChange),this.map.getCanvasContainer().removeEventListener("touchstart",this._onTouchStart),this.map.getCanvasContainer().removeEventListener("touchend",this._onTouchEnd)},n}(),hwe=function(){function n(e,t){this.added=!1,this.map=e,this.focusShortcut=new lwe(e),this.pinchZoom=new uwe(e),this.options=new Oj().merge(t)}return n.prototype.addToMap=function(){this.added||(this.added=!0,this._setInteractions(this.options))},n.prototype.removeFromMap=function(){this.added&&(this.added=!1,this._setInteractions({interactive:!1}))},n.prototype.setOptions=function(e){this.options=new Oj().merge(this.options,e),this.added&&this._setInteractions(this.options)},n.prototype.getOptions=function(){return Object.assign({},this.options)},n.prototype._setInteractions=function(e){var t;e.interactive?(e.boxZoomInteraction?this.map._getMap().boxZoom.enable():this.map._getMap().boxZoom.disable(),e.dblClickZoomInteraction?this.map._getMap().doubleClickZoom.enable():this.map._getMap().doubleClickZoom.disable(),e.dragPanInteraction?this.map._getMap().dragPan.enable():this.map._getMap().dragPan.disable(),e.dragRotateInteraction?this.map._getMap().dragRotate.enable():this.map._getMap().dragRotate.disable(),e.keyboardInteraction?(this.map._getMap().keyboard.enable(),this.focusShortcut.enable()):(this.map._getMap().keyboard.disable(),this.focusShortcut.disable()),e.scrollZoomInteraction?(this.map._getMap().scrollZoom.enable(),this.map._getMap().scrollZoom.setWheelZoomRate(e.wheelZoomRate)):this.map._getMap().scrollZoom.disable(),t=this.map._getMap().touchZoomRotate,e.touchInteraction?(t.enable(),e.touchRotate?t.enableRotation():t.disableRotation()):t.disable(),this.pinchZoom.enable()):(this.map._getMap().boxZoom.disable(),this.map._getMap().doubleClickZoom.disable(),this.map._getMap().dragPan.disable(),this.map._getMap().dragRotate.disable(),this.map._getMap().keyboard.disable(),this.focusShortcut.disable(),this.map._getMap().scrollZoom.disable(),this.map._getMap().touchZoomRotate.disable(),this.pinchZoom.disable())},n}();function Lj(n,e,t){var r={type:"Feature"};return(t=t===void 0?{}:t).id!==0&&!t.id||(r.id=t.id),t.bbox&&(r.bbox=t.bbox),r.properties=e||{},r.geometry=n,r}function dwe(n,e,t){t===void 0&&(t={});for(var r=0,i=n;r<i.length;r++){var o=i[r];if(o.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var a=0;a<o[o.length-1].length;a++)if(o[o.length-1][a]!==o[0][a])throw new Error("First and last Position are not equivalent.")}return Lj({type:"Polygon",coordinates:n},e,t)}function fwe(n,e,t){return Lj({type:"MultiPolygon",coordinates:n},e,t=t===void 0?{}:t)}function Nj(n){return n.type==="Feature"?n.geometry:n}var Dj={exports:{}},pwe=(Dj.exports=function(){function n(he,B){if(!(he instanceof B))throw new TypeError("Cannot call a class as a function")}function e(he,B){for(var H=0;H<B.length;H++){var D=B[H];D.enumerable=D.enumerable||!1,D.configurable=!0,"value"in D&&(D.writable=!0),Object.defineProperty(he,D.key,D)}}function t(he,B,H){return B&&e(he.prototype,B),H&&e(he,H),he}var r=function(){function he(B,H){this.next=null,this.key=B,this.data=H,this.left=null,this.right=null}return he}();function i(he,B){return he>B?1:he<B?-1:0}function o(he,B,H){for(var D=new r(null,null),Q=D,ae=D;;){var q=H(he,B.key);if(q<0){if(B.left===null)break;if(H(he,B.left.key)<0){var Ae=B.left;if(B.left=Ae.right,Ae.right=B,B=Ae,B.left===null)break}ae.left=B,ae=B,B=B.left}else if(q>0){if(B.right===null)break;if(H(he,B.right.key)>0){var Ae=B.right;if(B.right=Ae.left,Ae.left=B,B=Ae,B.right===null)break}Q.right=B,Q=B,B=B.right}else break}return Q.right=B.left,ae.left=B.right,B.left=D.right,B.right=D.left,B}function a(he,B,H,D){var Q=new r(he,B);if(H===null)return Q.left=Q.right=null,Q;H=o(he,H,D);var ae=D(he,H.key);return ae<0?(Q.left=H.left,Q.right=H,H.left=null):ae>=0&&(Q.right=H.right,Q.left=H,H.right=null),Q}function l(he,B,H){var D=null,Q=null;if(B){B=o(he,B,H);var ae=H(B.key,he);ae===0?(D=B.left,Q=B.right):ae<0?(Q=B.right,B.right=null,D=B):(D=B.left,B.left=null,Q=B)}return{left:D,right:Q}}function h(he,B,H){return B===null?he:(he===null||(B=o(he.key,B,H),B.left=he),B)}function p(he,B,H,D,Q){if(he){D(""+B+(H?"└── ":"├── ")+Q(he)+`
`);var ae=B+(H?"    ":"│   ");he.left&&p(he.left,ae,!1,D,Q),he.right&&p(he.right,ae,!0,D,Q)}}var g=function(){function he(B){B===void 0&&(B=i),this._root=null,this._size=0,this._comparator=B}return he.prototype.insert=function(B,H){return this._size++,this._root=a(B,H,this._root,this._comparator)},he.prototype.add=function(B,H){var D=new r(B,H);this._root===null&&(D.left=D.right=null,this._size++,this._root=D);var Q=this._comparator,ae=o(B,this._root,Q),q=Q(B,ae.key);return q===0?this._root=ae:(q<0?(D.left=ae.left,D.right=ae,ae.left=null):q>0&&(D.right=ae.right,D.left=ae,ae.right=null),this._size++,this._root=D),this._root},he.prototype.remove=function(B){this._root=this._remove(B,this._root,this._comparator)},he.prototype._remove=function(B,H,D){var Q;if(H===null)return null;H=o(B,H,D);var ae=D(B,H.key);return ae===0?(H.left===null?Q=H.right:(Q=o(B,H.left,D),Q.right=H.right),this._size--,Q):H},he.prototype.pop=function(){var B=this._root;if(B){for(;B.left;)B=B.left;return this._root=o(B.key,this._root,this._comparator),this._root=this._remove(B.key,this._root,this._comparator),{key:B.key,data:B.data}}return null},he.prototype.findStatic=function(B){for(var H=this._root,D=this._comparator;H;){var Q=D(B,H.key);if(Q===0)return H;Q<0?H=H.left:H=H.right}return null},he.prototype.find=function(B){return this._root&&(this._root=o(B,this._root,this._comparator),this._comparator(B,this._root.key)!==0)?null:this._root},he.prototype.contains=function(B){for(var H=this._root,D=this._comparator;H;){var Q=D(B,H.key);if(Q===0)return!0;Q<0?H=H.left:H=H.right}return!1},he.prototype.forEach=function(B,H){for(var D=this._root,Q=[],ae=!1;!ae;)D!==null?(Q.push(D),D=D.left):Q.length!==0?(D=Q.pop(),B.call(H,D),D=D.right):ae=!0;return this},he.prototype.range=function(B,H,D,Q){for(var ae=[],q=this._comparator,Ae=this._root,Pe;ae.length!==0||Ae;)if(Ae)ae.push(Ae),Ae=Ae.left;else{if(Ae=ae.pop(),Pe=q(Ae.key,H),Pe>0)break;if(q(Ae.key,B)>=0&&D.call(Q,Ae))return this;Ae=Ae.right}return this},he.prototype.keys=function(){var B=[];return this.forEach(function(H){var D=H.key;return B.push(D)}),B},he.prototype.values=function(){var B=[];return this.forEach(function(H){var D=H.data;return B.push(D)}),B},he.prototype.min=function(){return this._root?this.minNode(this._root).key:null},he.prototype.max=function(){return this._root?this.maxNode(this._root).key:null},he.prototype.minNode=function(B){if(B===void 0&&(B=this._root),B)for(;B.left;)B=B.left;return B},he.prototype.maxNode=function(B){if(B===void 0&&(B=this._root),B)for(;B.right;)B=B.right;return B},he.prototype.at=function(B){for(var H=this._root,D=!1,Q=0,ae=[];!D;)if(H)ae.push(H),H=H.left;else if(ae.length>0){if(H=ae.pop(),Q===B)return H;Q++,H=H.right}else D=!0;return null},he.prototype.next=function(B){var H=this._root,D=null;if(B.right){for(D=B.right;D.left;)D=D.left;return D}for(var Q=this._comparator;H;){var ae=Q(B.key,H.key);if(ae===0)break;ae<0?(D=H,H=H.left):H=H.right}return D},he.prototype.prev=function(B){var H=this._root,D=null;if(B.left!==null){for(D=B.left;D.right;)D=D.right;return D}for(var Q=this._comparator;H;){var ae=Q(B.key,H.key);if(ae===0)break;ae<0?H=H.left:(D=H,H=H.right)}return D},he.prototype.clear=function(){return this._root=null,this._size=0,this},he.prototype.toList=function(){return C(this._root)},he.prototype.load=function(B,H,D){H===void 0&&(H=[]),D===void 0&&(D=!1);var Q=B.length,ae=this._comparator;if(D&&F(B,H,0,Q-1,ae),this._root===null)this._root=_(B,H,0,Q),this._size=Q;else{var q=L(this.toList(),x(B,H),ae);Q=this._size+Q,this._root=M({head:q},0,Q)}return this},he.prototype.isEmpty=function(){return this._root===null},Object.defineProperty(he.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),Object.defineProperty(he.prototype,"root",{get:function(){return this._root},enumerable:!0,configurable:!0}),he.prototype.toString=function(B){B===void 0&&(B=function(Q){return String(Q.key)});var H=[];return p(this._root,"",!0,function(D){return H.push(D)},B),H.join("")},he.prototype.update=function(B,H,D){var Q=this._comparator,ae=l(B,this._root,Q),q=ae.left,Ae=ae.right;Q(B,H)<0?Ae=a(H,D,Ae,Q):q=a(H,D,q,Q),this._root=h(q,Ae,Q)},he.prototype.split=function(B){return l(B,this._root,this._comparator)},he}();function _(he,B,H,D){var Q=D-H;if(Q>0){var ae=H+Math.floor(Q/2),q=he[ae],Ae=B[ae],Pe=new r(q,Ae);return Pe.left=_(he,B,H,ae),Pe.right=_(he,B,ae+1,D),Pe}return null}function x(he,B){for(var H=new r(null,null),D=H,Q=0;Q<he.length;Q++)D=D.next=new r(he[Q],B[Q]);return D.next=null,H.next}function C(he){for(var B=he,H=[],D=!1,Q=new r(null,null),ae=Q;!D;)B?(H.push(B),B=B.left):H.length>0?(B=ae=ae.next=H.pop(),B=B.right):D=!0;return ae.next=null,Q.next}function M(he,B,H){var D=H-B;if(D>0){var Q=B+Math.floor(D/2),ae=M(he,B,Q),q=he.head;return q.left=ae,he.head=he.head.next,q.right=M(he,Q+1,H),q}return null}function L(he,B,H){for(var D=new r(null,null),Q=D,ae=he,q=B;ae!==null&&q!==null;)H(ae.key,q.key)<0?(Q.next=ae,ae=ae.next):(Q.next=q,q=q.next),Q=Q.next;return ae!==null?Q.next=ae:q!==null&&(Q.next=q),D.next}function F(he,B,H,D,Q){if(!(H>=D)){for(var ae=he[H+D>>1],q=H-1,Ae=D+1;;){do q++;while(Q(he[q],ae)<0);do Ae--;while(Q(he[Ae],ae)>0);if(q>=Ae)break;var Pe=he[q];he[q]=he[Ae],he[Ae]=Pe,Pe=B[q],B[q]=B[Ae],B[Ae]=Pe}F(he,B,H,Ae,Q),F(he,B,Ae+1,D,Q)}}var z=function(B,H){return B.ll.x<=H.x&&H.x<=B.ur.x&&B.ll.y<=H.y&&H.y<=B.ur.y},ee=function(B,H){if(H.ur.x<B.ll.x||B.ur.x<H.ll.x||H.ur.y<B.ll.y||B.ur.y<H.ll.y)return null;var D=B.ll.x<H.ll.x?H.ll.x:B.ll.x,Q=B.ur.x<H.ur.x?B.ur.x:H.ur.x,ae=B.ll.y<H.ll.y?H.ll.y:B.ll.y,q=B.ur.y<H.ur.y?B.ur.y:H.ur.y;return{ll:{x:D,y:ae},ur:{x:Q,y:q}}},ce=Number.EPSILON;ce===void 0&&(ce=Math.pow(2,-52));var se=ce*ce,_e=function(B,H){if(-ce<B&&B<ce&&-ce<H&&H<ce)return 0;var D=B-H;return D*D<se*B*H?0:B<H?-1:1},J=function(){function he(){n(this,he),this.reset()}return t(he,[{key:"reset",value:function(){this.xRounder=new pe,this.yRounder=new pe}},{key:"round",value:function(H,D){return{x:this.xRounder.round(H),y:this.yRounder.round(D)}}}]),he}(),pe=function(){function he(){n(this,he),this.tree=new g,this.round(0)}return t(he,[{key:"round",value:function(H){var D=this.tree.add(H),Q=this.tree.prev(D);if(Q!==null&&_e(D.key,Q.key)===0)return this.tree.remove(H),Q.key;var ae=this.tree.next(D);return ae!==null&&_e(D.key,ae.key)===0?(this.tree.remove(H),ae.key):H}}]),he}(),ue=new J,xe=function(B,H){return B.x*H.y-B.y*H.x},je=function(B,H){return B.x*H.x+B.y*H.y},ne=function(B,H,D){var Q={x:H.x-B.x,y:H.y-B.y},ae={x:D.x-B.x,y:D.y-B.y},q=xe(Q,ae);return _e(q,0)},Ee=function(B){return Math.sqrt(je(B,B))},ke=function(B,H,D){var Q={x:H.x-B.x,y:H.y-B.y},ae={x:D.x-B.x,y:D.y-B.y};return xe(ae,Q)/Ee(ae)/Ee(Q)},Be=function(B,H,D){var Q={x:H.x-B.x,y:H.y-B.y},ae={x:D.x-B.x,y:D.y-B.y};return je(ae,Q)/Ee(ae)/Ee(Q)},Ze=function(B,H,D){return H.y===0?null:{x:B.x+H.x/H.y*(D-B.y),y:D}},at=function(B,H,D){return H.x===0?null:{x:D,y:B.y+H.y/H.x*(D-B.x)}},Re=function(B,H,D,Q){if(H.x===0)return at(D,Q,B.x);if(Q.x===0)return at(B,H,D.x);if(H.y===0)return Ze(D,Q,B.y);if(Q.y===0)return Ze(B,H,D.y);var ae=xe(H,Q);if(ae==0)return null;var q={x:D.x-B.x,y:D.y-B.y},Ae=xe(q,H)/ae,Pe=xe(q,Q)/ae,We=B.x+Pe*H.x,rt=D.x+Ae*Q.x,Et=B.y+Pe*H.y,Bt=D.y+Ae*Q.y,Lt=(We+rt)/2,an=(Et+Bt)/2;return{x:Lt,y:an}},ht=function(){t(he,null,[{key:"compare",value:function(H,D){var Q=he.comparePoints(H.point,D.point);return Q!==0?Q:(H.point!==D.point&&H.link(D),H.isLeft!==D.isLeft?H.isLeft?1:-1:dn.compare(H.segment,D.segment))}},{key:"comparePoints",value:function(H,D){return H.x<D.x?-1:H.x>D.x?1:H.y<D.y?-1:H.y>D.y?1:0}}]);function he(B,H){n(this,he),B.events===void 0?B.events=[this]:B.events.push(this),this.point=B,this.isLeft=H}return t(he,[{key:"link",value:function(H){if(H.point===this.point)throw new Error("Tried to link already linked events");for(var D=H.point.events,Q=0,ae=D.length;Q<ae;Q++){var q=D[Q];this.point.events.push(q),q.point=this.point}this.checkForConsuming()}},{key:"checkForConsuming",value:function(){for(var H=this.point.events.length,D=0;D<H;D++){var Q=this.point.events[D];if(Q.segment.consumedBy===void 0)for(var ae=D+1;ae<H;ae++){var q=this.point.events[ae];q.consumedBy===void 0&&Q.otherSE.point.events===q.otherSE.point.events&&Q.segment.consume(q.segment)}}}},{key:"getAvailableLinkedEvents",value:function(){for(var H=[],D=0,Q=this.point.events.length;D<Q;D++){var ae=this.point.events[D];ae!==this&&!ae.segment.ringOut&&ae.segment.isInResult()&&H.push(ae)}return H}},{key:"getLeftmostComparator",value:function(H){var D=this,Q=new Map,ae=function(Ae){var Pe=Ae.otherSE;Q.set(Ae,{sine:ke(D.point,H.point,Pe.point),cosine:Be(D.point,H.point,Pe.point)})};return function(q,Ae){Q.has(q)||ae(q),Q.has(Ae)||ae(Ae);var Pe=Q.get(q),We=Pe.sine,rt=Pe.cosine,Et=Q.get(Ae),Bt=Et.sine,Lt=Et.cosine;return We>=0&&Bt>=0?rt<Lt?1:rt>Lt?-1:0:We<0&&Bt<0?rt<Lt?-1:rt>Lt?1:0:Bt<We?-1:Bt>We?1:0}}}]),he}(),Rt=0,dn=function(){t(he,null,[{key:"compare",value:function(H,D){var Q=H.leftSE.point.x,ae=D.leftSE.point.x,q=H.rightSE.point.x,Ae=D.rightSE.point.x;if(Ae<Q)return 1;if(q<ae)return-1;var Pe=H.leftSE.point.y,We=D.leftSE.point.y,rt=H.rightSE.point.y,Et=D.rightSE.point.y;if(Q<ae){if(We<Pe&&We<rt)return 1;if(We>Pe&&We>rt)return-1;var Bt=H.comparePoint(D.leftSE.point);if(Bt<0)return 1;if(Bt>0)return-1;var Lt=D.comparePoint(H.rightSE.point);return Lt!==0?Lt:-1}if(Q>ae){if(Pe<We&&Pe<Et)return-1;if(Pe>We&&Pe>Et)return 1;var an=D.comparePoint(H.leftSE.point);if(an!==0)return an;var Ie=H.comparePoint(D.rightSE.point);return Ie<0?1:Ie>0?-1:1}if(Pe<We)return-1;if(Pe>We)return 1;if(q<Ae){var Te=D.comparePoint(H.rightSE.point);if(Te!==0)return Te}if(q>Ae){var At=H.comparePoint(D.rightSE.point);if(At<0)return 1;if(At>0)return-1}if(q!==Ae){var xt=rt-Pe,qt=q-Q,fn=Et-We,Ke=Ae-ae;if(xt>qt&&fn<Ke)return 1;if(xt<qt&&fn>Ke)return-1}return q>Ae?1:q<Ae||rt<Et?-1:rt>Et?1:H.id<D.id?-1:H.id>D.id?1:0}}]);function he(B,H,D,Q){n(this,he),this.id=++Rt,this.leftSE=B,B.segment=this,B.otherSE=H,this.rightSE=H,H.segment=this,H.otherSE=B,this.rings=D,this.windings=Q}return t(he,[{key:"replaceRightSE",value:function(H){this.rightSE=H,this.rightSE.segment=this,this.rightSE.otherSE=this.leftSE,this.leftSE.otherSE=this.rightSE}},{key:"bbox",value:function(){var H=this.leftSE.point.y,D=this.rightSE.point.y;return{ll:{x:this.leftSE.point.x,y:H<D?H:D},ur:{x:this.rightSE.point.x,y:H>D?H:D}}}},{key:"vector",value:function(){return{x:this.rightSE.point.x-this.leftSE.point.x,y:this.rightSE.point.y-this.leftSE.point.y}}},{key:"isAnEndpoint",value:function(H){return H.x===this.leftSE.point.x&&H.y===this.leftSE.point.y||H.x===this.rightSE.point.x&&H.y===this.rightSE.point.y}},{key:"comparePoint",value:function(H){if(this.isAnEndpoint(H))return 0;var D=this.leftSE.point,Q=this.rightSE.point,ae=this.vector();if(D.x===Q.x)return H.x===D.x?0:H.x<D.x?1:-1;var q=(H.y-D.y)/ae.y,Ae=D.x+q*ae.x;if(H.x===Ae)return 0;var Pe=(H.x-D.x)/ae.x,We=D.y+Pe*ae.y;return H.y===We?0:H.y<We?-1:1}},{key:"getIntersection",value:function(H){var D=this.bbox(),Q=H.bbox(),ae=ee(D,Q);if(ae===null)return null;var q=this.leftSE.point,Ae=this.rightSE.point,Pe=H.leftSE.point,We=H.rightSE.point,rt=z(D,Pe)&&this.comparePoint(Pe)===0,Et=z(Q,q)&&H.comparePoint(q)===0,Bt=z(D,We)&&this.comparePoint(We)===0,Lt=z(Q,Ae)&&H.comparePoint(Ae)===0;if(Et&&rt)return Lt&&!Bt?Ae:!Lt&&Bt?We:null;if(Et)return Bt&&q.x===We.x&&q.y===We.y?null:q;if(rt)return Lt&&Ae.x===Pe.x&&Ae.y===Pe.y?null:Pe;if(Lt&&Bt)return null;if(Lt)return Ae;if(Bt)return We;var an=Re(q,this.vector(),Pe,H.vector());return an===null||!z(ae,an)?null:ue.round(an.x,an.y)}},{key:"split",value:function(H){var D=[],Q=H.events!==void 0,ae=new ht(H,!0),q=new ht(H,!1),Ae=this.rightSE;this.replaceRightSE(q),D.push(q),D.push(ae);var Pe=new he(ae,Ae,this.rings.slice(),this.windings.slice());return ht.comparePoints(Pe.leftSE.point,Pe.rightSE.point)>0&&Pe.swapEvents(),ht.comparePoints(this.leftSE.point,this.rightSE.point)>0&&this.swapEvents(),Q&&(ae.checkForConsuming(),q.checkForConsuming()),D}},{key:"swapEvents",value:function(){var H=this.rightSE;this.rightSE=this.leftSE,this.leftSE=H,this.leftSE.isLeft=!0,this.rightSE.isLeft=!1;for(var D=0,Q=this.windings.length;D<Q;D++)this.windings[D]*=-1}},{key:"consume",value:function(H){for(var D=this,Q=H;D.consumedBy;)D=D.consumedBy;for(;Q.consumedBy;)Q=Q.consumedBy;var ae=he.compare(D,Q);if(ae!==0){if(ae>0){var q=D;D=Q,Q=q}if(D.prev===Q){var Ae=D;D=Q,Q=Ae}for(var Pe=0,We=Q.rings.length;Pe<We;Pe++){var rt=Q.rings[Pe],Et=Q.windings[Pe],Bt=D.rings.indexOf(rt);Bt===-1?(D.rings.push(rt),D.windings.push(Et)):D.windings[Bt]+=Et}Q.rings=null,Q.windings=null,Q.consumedBy=D,Q.leftSE.consumedBy=D.leftSE,Q.rightSE.consumedBy=D.rightSE}}},{key:"prevInResult",value:function(){return this._prevInResult!==void 0?this._prevInResult:(this.prev?this.prev.isInResult()?this._prevInResult=this.prev:this._prevInResult=this.prev.prevInResult():this._prevInResult=null,this._prevInResult)}},{key:"beforeState",value:function(){if(this._beforeState!==void 0)return this._beforeState;if(!this.prev)this._beforeState={rings:[],windings:[],multiPolys:[]};else{var H=this.prev.consumedBy||this.prev;this._beforeState=H.afterState()}return this._beforeState}},{key:"afterState",value:function(){if(this._afterState!==void 0)return this._afterState;var H=this.beforeState();this._afterState={rings:H.rings.slice(0),windings:H.windings.slice(0),multiPolys:[]};for(var D=this._afterState.rings,Q=this._afterState.windings,ae=this._afterState.multiPolys,q=0,Ae=this.rings.length;q<Ae;q++){var Pe=this.rings[q],We=this.windings[q],rt=D.indexOf(Pe);rt===-1?(D.push(Pe),Q.push(We)):Q[rt]+=We}for(var Et=[],Bt=[],Lt=0,an=D.length;Lt<an;Lt++)if(Q[Lt]!==0){var Ie=D[Lt],Te=Ie.poly;if(Bt.indexOf(Te)===-1)if(Ie.isExterior)Et.push(Te);else{Bt.indexOf(Te)===-1&&Bt.push(Te);var At=Et.indexOf(Ie.poly);At!==-1&&Et.splice(At,1)}}for(var xt=0,qt=Et.length;xt<qt;xt++){var fn=Et[xt].multiPoly;ae.indexOf(fn)===-1&&ae.push(fn)}return this._afterState}},{key:"isInResult",value:function(){if(this.consumedBy)return!1;if(this._isInResult!==void 0)return this._isInResult;var H=this.beforeState().multiPolys,D=this.afterState().multiPolys;switch(Pt.type){case"union":{var Q=H.length===0,ae=D.length===0;this._isInResult=Q!==ae;break}case"intersection":{var q,Ae;H.length<D.length?(q=H.length,Ae=D.length):(q=D.length,Ae=H.length),this._isInResult=Ae===Pt.numMultiPolys&&q<Ae;break}case"xor":{var Pe=Math.abs(H.length-D.length);this._isInResult=Pe%2===1;break}case"difference":{var We=function(Et){return Et.length===1&&Et[0].isSubject};this._isInResult=We(H)!==We(D);break}default:throw new Error("Unrecognized operation type found ".concat(Pt.type))}return this._isInResult}}],[{key:"fromRing",value:function(H,D,Q){var ae,q,Ae,Pe=ht.comparePoints(H,D);if(Pe<0)ae=H,q=D,Ae=1;else if(Pe>0)ae=D,q=H,Ae=-1;else throw new Error("Tried to create degenerate segment at [".concat(H.x,", ").concat(H.y,"]"));var We=new ht(ae,!0),rt=new ht(q,!1);return new he(We,rt,[Q],[Ae])}}]),he}(),wt=function(){function he(B,H,D){if(n(this,he),!Array.isArray(B)||B.length===0)throw new Error("Input geometry is not a valid Polygon or MultiPolygon");if(this.poly=H,this.isExterior=D,this.segments=[],typeof B[0][0]!="number"||typeof B[0][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var Q=ue.round(B[0][0],B[0][1]);this.bbox={ll:{x:Q.x,y:Q.y},ur:{x:Q.x,y:Q.y}};for(var ae=Q,q=1,Ae=B.length;q<Ae;q++){if(typeof B[q][0]!="number"||typeof B[q][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var Pe=ue.round(B[q][0],B[q][1]);Pe.x===ae.x&&Pe.y===ae.y||(this.segments.push(dn.fromRing(ae,Pe,this)),Pe.x<this.bbox.ll.x&&(this.bbox.ll.x=Pe.x),Pe.y<this.bbox.ll.y&&(this.bbox.ll.y=Pe.y),Pe.x>this.bbox.ur.x&&(this.bbox.ur.x=Pe.x),Pe.y>this.bbox.ur.y&&(this.bbox.ur.y=Pe.y),ae=Pe)}(Q.x!==ae.x||Q.y!==ae.y)&&this.segments.push(dn.fromRing(ae,Q,this))}return t(he,[{key:"getSweepEvents",value:function(){for(var H=[],D=0,Q=this.segments.length;D<Q;D++){var ae=this.segments[D];H.push(ae.leftSE),H.push(ae.rightSE)}return H}}]),he}(),Ge=function(){function he(B,H){if(n(this,he),!Array.isArray(B))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");this.exteriorRing=new wt(B[0],this,!0),this.bbox={ll:{x:this.exteriorRing.bbox.ll.x,y:this.exteriorRing.bbox.ll.y},ur:{x:this.exteriorRing.bbox.ur.x,y:this.exteriorRing.bbox.ur.y}},this.interiorRings=[];for(var D=1,Q=B.length;D<Q;D++){var ae=new wt(B[D],this,!1);ae.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=ae.bbox.ll.x),ae.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=ae.bbox.ll.y),ae.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=ae.bbox.ur.x),ae.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=ae.bbox.ur.y),this.interiorRings.push(ae)}this.multiPoly=H}return t(he,[{key:"getSweepEvents",value:function(){for(var H=this.exteriorRing.getSweepEvents(),D=0,Q=this.interiorRings.length;D<Q;D++)for(var ae=this.interiorRings[D].getSweepEvents(),q=0,Ae=ae.length;q<Ae;q++)H.push(ae[q]);return H}}]),he}(),qn=function(){function he(B,H){if(n(this,he),!Array.isArray(B))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");try{typeof B[0][0][0]=="number"&&(B=[B])}catch{}this.polys=[],this.bbox={ll:{x:Number.POSITIVE_INFINITY,y:Number.POSITIVE_INFINITY},ur:{x:Number.NEGATIVE_INFINITY,y:Number.NEGATIVE_INFINITY}};for(var D=0,Q=B.length;D<Q;D++){var ae=new Ge(B[D],this);ae.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=ae.bbox.ll.x),ae.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=ae.bbox.ll.y),ae.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=ae.bbox.ur.x),ae.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=ae.bbox.ur.y),this.polys.push(ae)}this.isSubject=H}return t(he,[{key:"getSweepEvents",value:function(){for(var H=[],D=0,Q=this.polys.length;D<Q;D++)for(var ae=this.polys[D].getSweepEvents(),q=0,Ae=ae.length;q<Ae;q++)H.push(ae[q]);return H}}]),he}(),Qt=function(){t(he,null,[{key:"factory",value:function(H){for(var D=[],Q=0,ae=H.length;Q<ae;Q++){var q=H[Q];if(!(!q.isInResult()||q.ringOut)){for(var Ae=null,Pe=q.leftSE,We=q.rightSE,rt=[Pe],Et=Pe.point,Bt=[];Ae=Pe,Pe=We,rt.push(Pe),Pe.point!==Et;)for(;;){var Lt=Pe.getAvailableLinkedEvents();if(Lt.length===0){var an=rt[0].point,Ie=rt[rt.length-1].point;throw new Error("Unable to complete output ring starting at [".concat(an.x,",")+" ".concat(an.y,"]. Last matching segment found ends at")+" [".concat(Ie.x,", ").concat(Ie.y,"]."))}if(Lt.length===1){We=Lt[0].otherSE;break}for(var Te=null,At=0,xt=Bt.length;At<xt;At++)if(Bt[At].point===Pe.point){Te=At;break}if(Te!==null){var qt=Bt.splice(Te)[0],fn=rt.splice(qt.index);fn.unshift(fn[0].otherSE),D.push(new he(fn.reverse()));continue}Bt.push({index:rt.length,point:Pe.point});var Ke=Pe.getLeftmostComparator(Ae);We=Lt.sort(Ke)[0].otherSE;break}D.push(new he(rt))}}return D}}]);function he(B){n(this,he),this.events=B;for(var H=0,D=B.length;H<D;H++)B[H].segment.ringOut=this;this.poly=null}return t(he,[{key:"getGeom",value:function(){for(var H=this.events[0].point,D=[H],Q=1,ae=this.events.length-1;Q<ae;Q++){var q=this.events[Q].point,Ae=this.events[Q+1].point;ne(q,H,Ae)!==0&&(D.push(q),H=q)}if(D.length===1)return null;var Pe=D[0],We=D[1];ne(Pe,H,We)===0&&D.shift(),D.push(D[0]);for(var rt=this.isExteriorRing()?1:-1,Et=this.isExteriorRing()?0:D.length-1,Bt=this.isExteriorRing()?D.length:-1,Lt=[],an=Et;an!=Bt;an+=rt)Lt.push([D[an].x,D[an].y]);return Lt}},{key:"isExteriorRing",value:function(){if(this._isExteriorRing===void 0){var H=this.enclosingRing();this._isExteriorRing=H?!H.isExteriorRing():!0}return this._isExteriorRing}},{key:"enclosingRing",value:function(){return this._enclosingRing===void 0&&(this._enclosingRing=this._calcEnclosingRing()),this._enclosingRing}},{key:"_calcEnclosingRing",value:function(){for(var H=this.events[0],D=1,Q=this.events.length;D<Q;D++){var ae=this.events[D];ht.compare(H,ae)>0&&(H=ae)}for(var q=H.segment.prevInResult(),Ae=q?q.prevInResult():null;;){if(!q)return null;if(!Ae)return q.ringOut;if(Ae.ringOut!==q.ringOut)return Ae.ringOut.enclosingRing()!==q.ringOut?q.ringOut:q.ringOut.enclosingRing();q=Ae.prevInResult(),Ae=q?q.prevInResult():null}}}]),he}(),ln=function(){function he(B){n(this,he),this.exteriorRing=B,B.poly=this,this.interiorRings=[]}return t(he,[{key:"addInterior",value:function(H){this.interiorRings.push(H),H.poly=this}},{key:"getGeom",value:function(){var H=[this.exteriorRing.getGeom()];if(H[0]===null)return null;for(var D=0,Q=this.interiorRings.length;D<Q;D++){var ae=this.interiorRings[D].getGeom();ae!==null&&H.push(ae)}return H}}]),he}(),Mn=function(){function he(B){n(this,he),this.rings=B,this.polys=this._composePolys(B)}return t(he,[{key:"getGeom",value:function(){for(var H=[],D=0,Q=this.polys.length;D<Q;D++){var ae=this.polys[D].getGeom();ae!==null&&H.push(ae)}return H}},{key:"_composePolys",value:function(H){for(var D=[],Q=0,ae=H.length;Q<ae;Q++){var q=H[Q];if(!q.poly)if(q.isExteriorRing())D.push(new ln(q));else{var Ae=q.enclosingRing();Ae.poly||D.push(new ln(Ae)),Ae.poly.addInterior(q)}}return D}}]),he}(),Ot=function(){function he(B){var H=arguments.length>1&&arguments[1]!==void 0?arguments[1]:dn.compare;n(this,he),this.queue=B,this.tree=new g(H),this.segments=[]}return t(he,[{key:"process",value:function(H){var D=H.segment,Q=[];if(H.consumedBy)return H.isLeft?this.queue.remove(H.otherSE):this.tree.remove(D),Q;var ae=H.isLeft?this.tree.insert(D):this.tree.find(D);if(!ae)throw new Error("Unable to find segment #".concat(D.id," ")+"[".concat(D.leftSE.point.x,", ").concat(D.leftSE.point.y,"] -> ")+"[".concat(D.rightSE.point.x,", ").concat(D.rightSE.point.y,"] ")+"in SweepLine tree. Please submit a bug report.");for(var q=ae,Ae=ae,Pe=void 0,We=void 0;Pe===void 0;)q=this.tree.prev(q),q===null?Pe=null:q.key.consumedBy===void 0&&(Pe=q.key);for(;We===void 0;)Ae=this.tree.next(Ae),Ae===null?We=null:Ae.key.consumedBy===void 0&&(We=Ae.key);if(H.isLeft){var rt=null;if(Pe){var Et=Pe.getIntersection(D);if(Et!==null&&(D.isAnEndpoint(Et)||(rt=Et),!Pe.isAnEndpoint(Et)))for(var Bt=this._splitSafely(Pe,Et),Lt=0,an=Bt.length;Lt<an;Lt++)Q.push(Bt[Lt])}var Ie=null;if(We){var Te=We.getIntersection(D);if(Te!==null&&(D.isAnEndpoint(Te)||(Ie=Te),!We.isAnEndpoint(Te)))for(var At=this._splitSafely(We,Te),xt=0,qt=At.length;xt<qt;xt++)Q.push(At[xt])}if(rt!==null||Ie!==null){var fn=null;if(rt===null)fn=Ie;else if(Ie===null)fn=rt;else{var Ke=ht.comparePoints(rt,Ie);fn=Ke<=0?rt:Ie}this.queue.remove(D.rightSE),Q.push(D.rightSE);for(var gt=D.split(fn),Tt=0,Rn=gt.length;Tt<Rn;Tt++)Q.push(gt[Tt])}Q.length>0?(this.tree.remove(D),Q.push(H)):(this.segments.push(D),D.prev=Pe)}else{if(Pe&&We){var Qn=Pe.getIntersection(We);if(Qn!==null){if(!Pe.isAnEndpoint(Qn))for(var nn=this._splitSafely(Pe,Qn),Fr=0,ti=nn.length;Fr<ti;Fr++)Q.push(nn[Fr]);if(!We.isAnEndpoint(Qn))for(var Ar=this._splitSafely(We,Qn),oe=0,V=Ar.length;oe<V;oe++)Q.push(Ar[oe])}}this.tree.remove(D)}return Q}},{key:"_splitSafely",value:function(H,D){this.tree.remove(H);var Q=H.rightSE;this.queue.remove(Q);var ae=H.split(D);return ae.push(Q),H.consumedBy===void 0&&this.tree.insert(H),ae}}]),he}(),En=typeof process<"u"&&{}.POLYGON_CLIPPING_MAX_QUEUE_SIZE||1e6,lt=typeof process<"u"&&{}.POLYGON_CLIPPING_MAX_SWEEPLINE_SEGMENTS||1e6,Pt=new(function(){function he(){n(this,he)}return t(he,[{key:"run",value:function(H,D,Q){Pt.type=H,ue.reset();for(var ae=[new qn(D,!0)],q=0,Ae=Q.length;q<Ae;q++)ae.push(new qn(Q[q],!1));if(Pt.numMultiPolys=ae.length,Pt.type==="difference")for(var Pe=ae[0],We=1;We<ae.length;)ee(ae[We].bbox,Pe.bbox)!==null?We++:ae.splice(We,1);if(Pt.type==="intersection"){for(var rt=0,Et=ae.length;rt<Et;rt++)for(var Bt=ae[rt],Lt=rt+1,an=ae.length;Lt<an;Lt++)if(ee(Bt.bbox,ae[Lt].bbox)===null)return[]}for(var Ie=new g(ht.compare),Te=0,At=ae.length;Te<At;Te++)for(var xt=ae[Te].getSweepEvents(),qt=0,fn=xt.length;qt<fn;qt++)if(Ie.insert(xt[qt]),Ie.size>En)throw new Error("Infinite loop when putting segment endpoints in a priority queue (queue size too big). Please file a bug report.");for(var Ke=new Ot(Ie),gt=Ie.size,Tt=Ie.pop();Tt;){var Rn=Tt.key;if(Ie.size===gt){var Qn=Rn.segment;throw new Error("Unable to pop() ".concat(Rn.isLeft?"left":"right"," SweepEvent ")+"[".concat(Rn.point.x,", ").concat(Rn.point.y,"] from segment #").concat(Qn.id," ")+"[".concat(Qn.leftSE.point.x,", ").concat(Qn.leftSE.point.y,"] -> ")+"[".concat(Qn.rightSE.point.x,", ").concat(Qn.rightSE.point.y,"] from queue. ")+"Please file a bug report.")}if(Ie.size>En)throw new Error("Infinite loop when passing sweep line over endpoints (queue size too big). Please file a bug report.");if(Ke.segments.length>lt)throw new Error("Infinite loop when passing sweep line over endpoints (too many sweep line segments). Please file a bug report.");for(var nn=Ke.process(Rn),Fr=0,ti=nn.length;Fr<ti;Fr++){var Ar=nn[Fr];Ar.consumedBy===void 0&&Ie.insert(Ar)}gt=Ie.size,Tt=Ie.pop()}ue.reset();var oe=Qt.factory(Ke.segments),V=new Mn(oe);return V.getGeom()}}]),he}());return{union:function(B){for(var H=arguments.length,D=new Array(H>1?H-1:0),Q=1;Q<H;Q++)D[Q-1]=arguments[Q];return Pt.run("union",B,D)},intersection:function(B){for(var H=arguments.length,D=new Array(H>1?H-1:0),Q=1;Q<H;Q++)D[Q-1]=arguments[Q];return Pt.run("intersection",B,D)},xor:function(B){for(var H=arguments.length,D=new Array(H>1?H-1:0),Q=1;Q<H;Q++)D[Q-1]=arguments[Q];return Pt.run("xor",B,D)},difference:function(B){for(var H=arguments.length,D=new Array(H>1?H-1:0),Q=1;Q<H;Q++)D[Q-1]=arguments[Q];return Pt.run("difference",B,D)}}}(),Dj.exports),gwe=ih(pwe);function mwe(n,e,t){return t===void 0&&(t={}),n=Nj(n),e=Nj(e),n=gwe.intersection(n.coordinates,e.coordinates),n.length===0?null:n.length===1?dwe(n[0],t.properties):fwe(n,t.properties)}var ywe=function(n){return function(e,t,r){var i=r.value,o=new Map;return r.value=function(){var a=this,l=arguments;!o.get(a)&&(i.apply(a,l),o.set(a,!0),setTimeout(function(){return o.delete(a)},n))},r}},_we=window&&window.__decorate||function(n,e,t,r){var i,o=arguments.length,a=o<3?e:r===null?r=Object.getOwnPropertyDescriptor(e,t):r;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(n,e,t,r);else for(var l=n.length-1;0<=l;l--)(i=n[l])&&(a=(o<3?i(a):3<o?i(e,t,a):i(e,t))||a);return 3<o&&a&&Object.defineProperty(e,t,a),a},HM=window&&window.__read||function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var r,i,o=t.call(n),a=[];try{for(;(e===void 0||0<e--)&&!(r=o.next()).done;)a.push(r.value)}catch(l){i={error:l}}finally{try{r&&!r.done&&(t=o.return)&&t.call(o)}finally{if(i)throw i.error}}return a},GM=window&&window.__spreadArray||function(n,e,t){if(t||arguments.length===2)for(var r,i=0,o=e.length;i<o;i++)!r&&i in e||((r=r||Array.prototype.slice.call(e,0,i))[i]=e[i]);return n.concat(r||Array.prototype.slice.call(e))},vwe=["DIV","SPAN","A"],qM=["data-azure-maps-attribution-minzoom","data-azure-maps-attribution-maxzoom","data-azure-maps-attribution-geometry","data-azure-maps-attribution-tileset","data-azure-maps-attribution-order","data-azure-maps-attribution-dynamic"],bwe=GM(["href"],HM(qM),!1),Fj=function(){function n(e,t){var r=this;this.lastFetchState={bounds:null,zoom:null},this.getElement=function(){return r.element},this.element=e,this.attributionChangeCallback=t}return n.prototype.equals=function(e){return this.stringRepresentation===e.stringRepresentation},Object.defineProperty(n.prototype,"stringRepresentation",{get:function(){return[this.minZoom!==void 0?"minzoom=".concat(this.minZoom):"",this.maxZoom!==void 0?"maxzoom=".concat(this.maxZoom):"",this.geometry!==void 0?this.element.attributes.getNamedItem("data-azure-maps-attribution-geometry").value:"",this.tilesetId!==void 0?"tilesetId=".concat(this.tilesetId):"",this.dynamic?"dynamic":""].filter(function(e){return 0<e.length}).join(";")},enumerable:!1,configurable:!0}),n.applicable=function(e){return Array.from(e.attributes).map(function(t){return qM.includes(t.name)}).reduce(function(t,r){return t||r},!1)},Object.defineProperty(n.prototype,"minZoom",{get:function(){var e=this.element.attributes.getNamedItem("data-azure-maps-attribution-minzoom");return e&&!isNaN(e.value)?parseInt(e.value):void 0},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"maxZoom",{get:function(){var e=this.element.attributes.getNamedItem("data-azure-maps-attribution-maxzoom");return e&&!isNaN(e.value)?parseInt(e.value):void 0},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"geometry",{get:function(){var e=this.element.attributes.getNamedItem("data-azure-maps-attribution-geometry");if(e&&e.value)try{return JSON.parse(e.value)}catch{}},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"tilesetId",{get:function(){var e=this.element.attributes.getNamedItem("data-azure-maps-attribution-tileset");return e&&e.value?e.value:void 0},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"order",{get:function(){var e=this.element.attributes.getNamedItem("data-azure-maps-attribution-order");return e&&!isNaN(e.value)?parseInt(e.value):void 0},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"dynamic",{get:function(){return this.element.attributes.getNamedItem("data-azure-maps-attribution-dynamic")!==null},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"hidesElement",{get:function(){return this.element.style.display=="none"},enumerable:!1,configurable:!0}),n.prototype.forceHide=function(){this.element.style.display="none"},n.prototype.satisfied=function(e){var t=!this.minZoom||!e.zoom||e.zoom>=this.minZoom,r=!this.maxZoom||!e.zoom||e.zoom<=this.maxZoom,i=!0;return this.geometry&&e.bounds&&(i=mwe({type:"Feature",geometry:this.geometry,properties:{}},{type:"Feature",geometry:{type:"Polygon",coordinates:[[rr.getNorthWest(e.bounds),rr.getNorthEast(e.bounds),rr.getSouthEast(e.bounds),rr.getSouthWest(e.bounds),rr.getNorthWest(e.bounds)]]},properties:{}})!==null),t&&r&&i},n.prototype.apply=function(e,l){var r=this,i=(l===void 0&&(l=null),this.satisfied(e.getCamera())),o=this.dynamic&&this.tilesetId,a=this.hidesElement,l=l&&["dragend","zoomend","pitchend"].includes(l.type);return i||a?i&&(a||o)&&(i&&a&&this.element.style.removeProperty("display"),o)&&(l?e.events.addOnce("idle",function(h){return r.fetchAndApplyDynamicAttribution(e)}):this.fetchAndApplyDynamicAttribution(e)):this.element.style.display="none",i===a},n.prototype.fetchAndApplyDynamicAttribution=function(e){var t,r,i,o=this,a=e.getCamera();this.lastFetchState&&rr.containsBoundingBox(this.lastFetchState.bounds,a.bounds)&&Math.floor(this.lastFetchState.zoom)==Math.floor(a.zoom)||(t=i2(a.center,rr.getSouthWest(a.bounds),n.viewportBufferExpansionRatio),i=((r=i2(a.center,rr.getNorthEast(a.bounds),n.viewportBufferExpansionRatio))[0]<t[0]?[[t[0],t[1],180,r[1]],[-180,t[1],r[0],r[1]]]:[[t[0],t[1],r[0],r[1]]]).map(function(h){var h=new URLSearchParams({"api-version":"2.1",tilesetId:o.tilesetId,zoom:a.zoom!==void 0?"".concat(Math.floor(a.zoom)):void 0,bounds:h.join(",")}),g="".concat("https://{{azMapsDomain}}","/map/attribution"),p={url:g,headers:{}},g=(e._substituteDomainLanguageViewAndSignInRequest(g,p),"".concat(p.url).concat(p.url.includes("?")?"&":"?").concat(h.toString()));return e._sendRequest(g,"Attribution",p.headers).then(function(_){return _.json()})}),Promise.all(i).then(function(l){o.applyAttributionResponse(l),o.lastFetchState={bounds:new rr([t[0],t[1],r[0],r[1]]),zoom:a.zoom}}).catch(function(l){return console.error(l)}))},n.prototype.applyAttributionResponse=function(a){var t,r,i,o=this,a=a.map(function(l){return l.copyrights||[]}).reduce(function(l,h){return GM(GM([],HM(l),!1),HM(h),!1)},[]);a.length!=0&&((a=dw.parseWithFilter(a.join(""),function(l){return!0},function(l){return l},function(){return o.element.innerHTML="",o.element}))===null?console.warn("Dynamic attribution is empty after filtering"):(t=typeof a=="string"?((t=document.createElement("span")).innerHTML=a,t):a,i=t===this.element?(r=document.createElement("span"),Array.from(this.element.childNodes).forEach(function(l){return r.appendChild(l)}),r):t,Array.from(this.element.attributes).filter(function(l){return qM.includes(l.name)}).forEach(function(l){return i.attributes.setNamedItem(l.cloneNode())}),i.style.display=this.element.style.display,a=this.element.parentElement,this.element.remove(),a.append(i),this.element=i,this.attributionChangeCallback(this)))},n.viewportBufferExpansionRatio=2,_we([ywe(1e3)],n.prototype,"fetchAndApplyDynamicAttribution",null),n}(),qh=window&&window.__read||function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var r,i,o=t.call(n),a=[];try{for(;(e===void 0||0<e--)&&!(r=o.next()).done;)a.push(r.value)}catch(l){i={error:l}}finally{try{r&&!r.done&&(t=o.return)&&t.call(o)}finally{if(i)throw i.error}}return a},xm=window&&window.__spreadArray||function(n,e,t){if(t||arguments.length===2)for(var r,i=0,o=e.length;i<o;i++)!r&&i in e||((r=r||Array.prototype.slice.call(e,0,i))[i]=e[i]);return n.concat(r||Array.prototype.slice.call(e))},wwe=[/all rights reserved/gi],xwe=function(){function n(e,t,r){var i,o=this;this.rules=[],this.virtualContext=((i=document.createElement("span")).className="azure-map-copyright-context",i),this.renderContext=this.virtualContext.cloneNode(!1),this.addAttributionFromSource=function(a){},this.removeAttributionFromSource=function(a){},this.getMapStyleVisibleSources=function(){var a=o.map._getMap(),l=a.getStyle();return Object.entries(l.sources).filter(function(h){var p=qh(h,1)[0];return l.layers.filter(function(g){return g&&g.source==p}).reduce(function(g,_){return!(_.layout&&_.layout.visibility==="none"||_.paint&&_.paint["icon-opacity"]===0&&_.paint["text-opacity"]===0)||g},!1)}).map(function(h){return h=qh(h,1)[0],a.getSource(h)})},this.loadAttributionOnceSourcesLoaded=function(){var a=o.getMapStyleVisibleSources();Promise.all(a.map(function(l){return new Promise(function(h,p){var g;"tiles"in l||(l==null?void 0:l.type)==="geojson"?h(l):((g=l).on("data",function _(x){x.sourceDataType=="metadata"&&(g.off("data",_),h(l))}),g.on("error",function _(x){g.off("error",_),p(x)}))}).then(function(h){return{status:"fulfilled",value:h}}).catch(function(h){return{status:"rejected",reason:h}})})).then(function(l){o.reloadAttribution()})},this.reloadAttribution=function(){var h=o.getMapStyleVisibleSources(),a=new Set,l={},h=h.filter(function(C){return"attribution"in C&&C.attribution&&"tiles"in C&&C.tiles instanceof Array&&0<C.tiles.length}).map(function(C){return dw.parseWithFilter((C=C.attribution)!=null?C:"",function(M){return vwe.includes(M.tagName)&&Array.from(M.attributes).map(function(L){return bwe.includes(L.name)}).reduce(function(L,F){return L&&F},!0)},function(M){var L,F=null;return M instanceof HTMLElement&&Fj.applicable(M)&&(F=new Fj(M,function(){return o.renderAttribution()}),a.add(F),F.order!==void 0)&&(M.style.order="".concat(F.order)),F&&M instanceof HTMLElement&&(!((L=F.stringRepresentation)in l)||F.order!==void 0&&l[L].order!==void 0&&F.order<l[L].order||F.order!==void 0&&l[L].order===void 0)&&(l[L]=F),M},function(){return document.createElement("span")})}),p=new Set(Object.values(l)),_=new Set(xm([],qh(a),!1).filter(function(C){return!p.has(C)})),g=new Set(xm([],qh(_),!1).map(function(C){return C.getElement()})),_=(xm([],qh(g),!1).filter(function(C){return C.parentElement!==null}).forEach(function(C){return C.parentElement.removeChild(C)}),o.rules=Object.values(l),h.filter(function(C){return typeof C=="string"||!g.has(C)}).map(function(C){return typeof C=="string"?new Text(C):C})),x=document.createElement("span");0<_.length?_.forEach(function(C){return x.appendChild(C)}):o.getDefaultAttribution().forEach(function(C){return x.appendChild(C)}),o.virtualContext=x,o.copyrightControl.setOptions({copyrightContent:o.renderContext}),o.applyRules(),o.renderAttribution()},this.applyRules=function(a){a===void 0&&(a=null),o.rules.reduce(function(l,h){return h=h.apply(o.map,a),l||h},!1)&&o.renderAttribution()},this.renderAttribution=function(){var a=function(p){return Array.from(p.style.display!="none"?p.children:[]).map(function(g){return a(g)}).reduce(function(g,_){return xm(xm([],qh(g),!1),qh(_),!1)},Array.from(p.style.display!="none"?p.childNodes:[]).filter(function(g){return g.nodeType==g.TEXT_NODE}))},l=o.virtualContext.cloneNode(!0),h=a(l);h.forEach(function(p){return p.textContent=xm([],qh(wwe),!1).reduce(function(g,_){return g.replace(_,"").trim()},p.textContent)}),h.reduce(function(p,g){return p.has(g.textContent)?(g.textContent="",g.parentElement&&g.parentElement.removeChild(g)):p.add(g.textContent),p},new Set),o.renderContext.innerHTML="",Array.from(l.childNodes).forEach(function(p){return o.renderContext.appendChild(p)})},this.map=e,this.copyrightControl=t,this.options=r}return n.prototype.addToMap=function(){this.map.events.add("stylechanged",this.loadAttributionOnceSourcesLoaded),this.map.events.add("dragend",this.applyRules),this.map.events.add("zoomend",this.applyRules),this.map.events.add("pitchend",this.applyRules)},n.prototype.removeFromMap=function(){this.map.events.remove("stylechanged",this.loadAttributionOnceSourcesLoaded),this.map.events.remove("dragend",this.applyRules),this.map.events.remove("zoomend",this.applyRules),this.map.events.remove("pitchend",this.applyRules)},n.prototype.getDefaultAttribution=function(){return this.copyrightControl.getDefaultAttributions().map(function(e){return e=e,(t=document.createElement("a")).textContent=e,t;var t})},n}(),Bj=function(n,e){return(Bj=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(t,r){t.__proto__=r}:function(t,r){for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(t[i]=r[i])}))(n,e)};function Zo(n,e){function t(){this.constructor=n}Bj(n,e),n.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}var yn=function(){return(yn=Object.assign||function(n){for(var e,t=1,r=arguments.length;t<r;t++)for(var i in e=arguments[t])Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i]);return n}).apply(this,arguments)};function Uj(n,e){var t={};for(i in n)Object.prototype.hasOwnProperty.call(n,i)&&e.indexOf(i)<0&&(t[i]=n[i]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(n);r<i.length;r++)e.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(n,i[r])&&(t[i[r]]=n[i[r]]);return t}function dt(n,e,t,r){return new(t=t||Promise)(function(i,o){function a(p){try{h(r.next(p))}catch(g){o(g)}}function l(p){try{h(r.throw(p))}catch(g){o(g)}}function h(p){var g;p.done?i(p.value):((g=p.value)instanceof t?g:new t(function(_){_(g)})).then(a,l)}h((r=r.apply(n,e||[])).next())})}function ft(n,e){var t,r,i,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]},a={next:l(0),throw:l(1),return:l(2)};return typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function l(h){return function(p){var g=[h,p];if(t)throw new TypeError("Generator is already executing.");for(;o;)try{if(t=1,r&&(i=2&g[0]?r.return:g[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,g[1])).done)return i;switch(r=0,(g=i?[2&g[0],i.value]:g)[0]){case 0:case 1:i=g;break;case 4:return o.label++,{value:g[1],done:!1};case 5:o.label++,r=g[1],g=[0];continue;case 7:g=o.ops.pop(),o.trys.pop();continue;default:if(!(i=0<(i=o.trys).length&&i[i.length-1])&&(g[0]===6||g[0]===2)){o=0;continue}if(g[0]===3&&(!i||g[1]>i[0]&&g[1]<i[3]))o.label=g[1];else if(g[0]===6&&o.label<i[1])o.label=i[1],i=g;else{if(!(i&&o.label<i[2])){i[2]&&o.ops.pop(),o.trys.pop();continue}o.label=i[2],o.ops.push(g)}}g=e.call(n,o)}catch(_){g=[6,_],r=0}finally{t=i=0}if(5&g[0])throw g[1];return{value:g[0]?g[1]:void 0,done:!0}}}}function Ewe(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var r,i,o=t.call(n),a=[];try{for(;(e===void 0||0<e--)&&!(r=o.next()).done;)a.push(r.value)}catch(l){i={error:l}}finally{try{r&&!r.done&&(t=o.return)&&t.call(o)}finally{if(i)throw i.error}}return a}function $M(){for(var n=[],e=0;e<arguments.length;e++)n=n.concat(Ewe(arguments[e]));return n}var zj=function(n,e){return(zj=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(t,r){t.__proto__=r}:function(t,r){for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(t[i]=r[i])}))(n,e)};function Ja(n,e){function t(){this.constructor=n}zj(n,e),n.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}var Gr=function(){return(Gr=Object.assign||function(n){for(var e,t=1,r=arguments.length;t<r;t++)for(var i in e=arguments[t])Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i]);return n}).apply(this,arguments)};function zn(n,e,t,r){return new(t=t||Promise)(function(i,o){function a(p){try{h(r.next(p))}catch(g){o(g)}}function l(p){try{h(r.throw(p))}catch(g){o(g)}}function h(p){var g;p.done?i(p.value):((g=p.value)instanceof t?g:new t(function(_){_(g)})).then(a,l)}h((r=r.apply(n,e||[])).next())})}function jn(n,e){var t,r,i,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]},a={next:l(0),throw:l(1),return:l(2)};return typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function l(h){return function(p){var g=[h,p];if(t)throw new TypeError("Generator is already executing.");for(;o;)try{if(t=1,r&&(i=2&g[0]?r.return:g[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,g[1])).done)return i;switch(r=0,(g=i?[2&g[0],i.value]:g)[0]){case 0:case 1:i=g;break;case 4:return o.label++,{value:g[1],done:!1};case 5:o.label++,r=g[1],g=[0];continue;case 7:g=o.ops.pop(),o.trys.pop();continue;default:if(!(i=0<(i=o.trys).length&&i[i.length-1])&&(g[0]===6||g[0]===2)){o=0;continue}if(g[0]===3&&(!i||g[1]>i[0]&&g[1]<i[3]))o.label=g[1];else if(g[0]===6&&o.label<i[1])o.label=i[1],i=g;else{if(!(i&&o.label<i[2])){i[2]&&o.ops.pop(),o.trys.pop();continue}o.label=i[2],o.ops.push(g)}}g=e.call(n,o)}catch(_){g=[6,_],r=0}finally{t=i=0}if(5&g[0])throw g[1];return{value:g[0]?g[1]:void 0,done:!0}}}}function vE(){for(var n=0,e=0,t=arguments.length;e<t;e++)n+=arguments[e].length;for(var r=Array(n),i=0,e=0;e<t;e++)for(var o=arguments[e],a=0,l=o.length;a<l;a++,i++)r[i]=o[a];return r}var Is,xo,$f,Wn,Em,u0,bE,wE,_u,Eo,In,vu,Js,qr,xE,Tm,$h,h0,Wh,WM,No,d0,ka,Le={LIBRARY_NAME:"MSAL.JS",SKU:"msal.js.common",CACHE_PREFIX:"msal",DEFAULT_AUTHORITY:"https://login.microsoftonline.com/common/",DEFAULT_AUTHORITY_HOST:"login.microsoftonline.com",DEFAULT_COMMON_TENANT:"common",ADFS:"adfs",DSTS:"dstsv2",AAD_INSTANCE_DISCOVERY_ENDPT:"https://login.microsoftonline.com/common/discovery/instance?api-version=1.1&authorization_endpoint=",CIAM_AUTH_URL:".ciamlogin.com",AAD_TENANT_DOMAIN_SUFFIX:".onmicrosoft.com",RESOURCE_DELIM:"|",NO_ACCOUNT:"NO_ACCOUNT",CLAIMS:"claims",CONSUMER_UTID:"9188040d-6c67-4c5b-b112-36a304b66dad",OPENID_SCOPE:"openid",PROFILE_SCOPE:"profile",OFFLINE_ACCESS_SCOPE:"offline_access",EMAIL_SCOPE:"email",CODE_RESPONSE_TYPE:"code",CODE_GRANT_TYPE:"authorization_code",RT_GRANT_TYPE:"refresh_token",FRAGMENT_RESPONSE_MODE:"fragment",S256_CODE_CHALLENGE_METHOD:"S256",URL_FORM_CONTENT_TYPE:"application/x-www-form-urlencoded;charset=utf-8",AUTHORIZATION_PENDING:"authorization_pending",NOT_DEFINED:"not_defined",EMPTY_STRING:"",NOT_APPLICABLE:"N/A",FORWARD_SLASH:"/",IMDS_ENDPOINT:"http://169.254.169.254/metadata/instance/compute/location",IMDS_VERSION:"2020-06-01",IMDS_TIMEOUT:2e3,AZURE_REGION_AUTO_DISCOVER_FLAG:"TryAutoDetect",REGIONAL_AUTH_PUBLIC_CLOUD_SUFFIX:"login.microsoft.com",REGIONAL_AUTH_NON_MSI_QUERY_STRING:"allowestsrnonmsi=true",KNOWN_PUBLIC_CLOUDS:["login.microsoftonline.com","login.windows.net","login.microsoft.com","sts.windows.net"],TOKEN_RESPONSE_TYPE:"token",ID_TOKEN_RESPONSE_TYPE:"id_token",SHR_NONCE_VALIDITY:240,INVALID_INSTANCE:"invalid_instance"},f0=[Le.OPENID_SCOPE,Le.PROFILE_SCOPE,Le.OFFLINE_ACCESS_SCOPE],jj=vE(f0,[Le.EMAIL_SCOPE]),da=(function(n){n.CONTENT_TYPE="Content-Type",n.RETRY_AFTER="Retry-After",n.CCS_HEADER="X-AnchorMailbox",n.WWWAuthenticate="WWW-Authenticate",n.AuthenticationInfo="Authentication-Info",n.X_MS_REQUEST_ID="x-ms-request-id",n.X_MS_HTTP_VERSION="x-ms-httpver"}(Is=Is||{}),function(n){n.ID_TOKEN="idtoken",n.CLIENT_INFO="client.info",n.ADAL_ID_TOKEN="adal.idtoken",n.ERROR="error",n.ERROR_DESC="error.description",n.ACTIVE_ACCOUNT="active-account",n.ACTIVE_ACCOUNT_FILTERS="active-account-filters"}(xo=xo||{}),function(n){n.COMMON="common",n.ORGANIZATIONS="organizations",n.CONSUMERS="consumers"}($f=$f||{}),function(n){n.CLIENT_ID="client_id",n.REDIRECT_URI="redirect_uri",n.RESPONSE_TYPE="response_type",n.RESPONSE_MODE="response_mode",n.GRANT_TYPE="grant_type",n.CLAIMS="claims",n.SCOPE="scope",n.ERROR="error",n.ERROR_DESCRIPTION="error_description",n.ACCESS_TOKEN="access_token",n.ID_TOKEN="id_token",n.REFRESH_TOKEN="refresh_token",n.EXPIRES_IN="expires_in",n.STATE="state",n.NONCE="nonce",n.PROMPT="prompt",n.SESSION_STATE="session_state",n.CLIENT_INFO="client_info",n.CODE="code",n.CODE_CHALLENGE="code_challenge",n.CODE_CHALLENGE_METHOD="code_challenge_method",n.CODE_VERIFIER="code_verifier",n.CLIENT_REQUEST_ID="client-request-id",n.X_CLIENT_SKU="x-client-SKU",n.X_CLIENT_VER="x-client-VER",n.X_CLIENT_OS="x-client-OS",n.X_CLIENT_CPU="x-client-CPU",n.X_CLIENT_CURR_TELEM="x-client-current-telemetry",n.X_CLIENT_LAST_TELEM="x-client-last-telemetry",n.X_MS_LIB_CAPABILITY="x-ms-lib-capability",n.X_APP_NAME="x-app-name",n.X_APP_VER="x-app-ver",n.POST_LOGOUT_URI="post_logout_redirect_uri",n.ID_TOKEN_HINT="id_token_hint",n.DEVICE_CODE="device_code",n.CLIENT_SECRET="client_secret",n.CLIENT_ASSERTION="client_assertion",n.CLIENT_ASSERTION_TYPE="client_assertion_type",n.TOKEN_TYPE="token_type",n.REQ_CNF="req_cnf",n.OBO_ASSERTION="assertion",n.REQUESTED_TOKEN_USE="requested_token_use",n.ON_BEHALF_OF="on_behalf_of",n.FOCI="foci",n.CCS_HEADER="X-AnchorMailbox",n.RETURN_SPA_CODE="return_spa_code",n.NATIVE_BROKER="nativebroker",n.LOGOUT_HINT="logout_hint"}(Wn=Wn||{}),function(n){n.ACCESS_TOKEN="access_token",n.XMS_CC="xms_cc"}(Em=Em||{}),{LOGIN:"login",SELECT_ACCOUNT:"select_account",CONSENT:"consent",NONE:"none",CREATE:"create",NO_SESSION:"no_session"}),Vj=(function(n){n.ACCOUNT="account",n.SID="sid",n.LOGIN_HINT="login_hint",n.ID_TOKEN="id_token",n.DOMAIN_HINT="domain_hint",n.ORGANIZATIONS="organizations",n.CONSUMERS="consumers",n.ACCOUNT_ID="accountIdentifier",n.HOMEACCOUNT_ID="homeAccountIdentifier"}(u0=u0||{}),{PLAIN:"plain",S256:"S256"}),YM=(function(n){n.QUERY="query",n.FRAGMENT="fragment",n.FORM_POST="form_post"}(bE=bE||{}),function(n){n.IMPLICIT_GRANT="implicit",n.AUTHORIZATION_CODE_GRANT="authorization_code",n.CLIENT_CREDENTIALS_GRANT="client_credentials",n.RESOURCE_OWNER_PASSWORD_GRANT="password",n.REFRESH_TOKEN_GRANT="refresh_token",n.DEVICE_CODE_GRANT="device_code",n.JWT_BEARER="urn:ietf:params:oauth:grant-type:jwt-bearer"}(wE=wE||{}),function(n){n.MSSTS_ACCOUNT_TYPE="MSSTS",n.ADFS_ACCOUNT_TYPE="ADFS",n.MSAV1_ACCOUNT_TYPE="MSA",n.GENERIC_ACCOUNT_TYPE="Generic"}(_u=_u||{}),function(n){n.CACHE_KEY_SEPARATOR="-",n.CLIENT_INFO_SEPARATOR="."}(Eo=Eo||{}),function(n){n.ID_TOKEN="IdToken",n.ACCESS_TOKEN="AccessToken",n.ACCESS_TOKEN_WITH_AUTH_SCHEME="AccessToken_With_AuthScheme",n.REFRESH_TOKEN="RefreshToken"}(In=In||{}),function(n){n[n.ADFS=1001]="ADFS",n[n.MSA=1002]="MSA",n[n.MSSTS=1003]="MSSTS",n[n.GENERIC=1004]="GENERIC",n[n.ACCESS_TOKEN=2001]="ACCESS_TOKEN",n[n.REFRESH_TOKEN=2002]="REFRESH_TOKEN",n[n.ID_TOKEN=2003]="ID_TOKEN",n[n.APP_METADATA=3001]="APP_METADATA",n[n.UNDEFINED=9999]="UNDEFINED"}(vu=vu||{}),"appmetadata"),Twe="client_info",p0="1",g0={CACHE_KEY:"authority-metadata",REFRESH_TIME_SECONDS:86400},Xo=(function(n){n.CONFIG="config",n.CACHE="cache",n.NETWORK="network",n.HARDCODED_VALUES="hardcoded_values"}(Js=Js||{}),{SCHEMA_VERSION:5,MAX_CUR_HEADER_BYTES:80,MAX_LAST_HEADER_BYTES:330,MAX_CACHED_ERRORS:50,CACHE_KEY:"server-telemetry",CATEGORY_SEPARATOR:"|",VALUE_SEPARATOR:",",OVERFLOW_TRUE:"1",OVERFLOW_FALSE:"0",UNKNOWN_ERROR:"unknown_error"}),m0=(function(n){n.BEARER="Bearer",n.POP="pop",n.SSH="ssh-cert"}(qr=qr||{}),{DEFAULT_THROTTLE_TIME_SECONDS:60,DEFAULT_MAX_THROTTLE_TIME_SECONDS:3600,THROTTLING_PREFIX:"throttling",X_MS_LIB_CAPABILITY_VALUE:"retry-after, h429"}),Hj={INVALID_GRANT_ERROR:"invalid_grant",CLIENT_MISMATCH_ERROR:"client_mismatch"},EE=(function(n){n.username="username",n.password="password"}(xE=xE||{}),function(n){n[n.httpSuccess=200]="httpSuccess",n[n.httpBadRequest=400]="httpBadRequest"}(Tm=Tm||{}),function(n){n.FAILED_AUTO_DETECTION="1",n.INTERNAL_CACHE="2",n.ENVIRONMENT_VARIABLE="3",n.IMDS="4"}($h=$h||{}),function(n){n.CONFIGURED_MATCHES_DETECTED="1",n.CONFIGURED_NO_AUTO_DETECTION="2",n.CONFIGURED_NOT_DETECTED="3",n.AUTO_DETECTION_REQUESTED_SUCCESSFUL="4",n.AUTO_DETECTION_REQUESTED_FAILED="5"}(h0=h0||{}),function(n){n.NO_CACHE_HIT="0",n.FORCE_REFRESH="1",n.NO_CACHED_ACCESS_TOKEN="2",n.CACHED_ACCESS_TOKEN_EXPIRED="3",n.REFRESH_CACHED_ACCESS_TOKEN="4",n.CLAIMS_REQUESTED_CACHE_SKIPPED="5"}(Wh=Wh||{}),function(n){n.Jwt="JWT",n.Jwk="JWK",n.Pop="pop"}(WM=WM||{}),{unexpectedError:{code:"unexpected_error",desc:"Unexpected error in authentication."},postRequestFailed:{code:"post_request_failed",desc:"Post request failed from the network, could be a 4xx/5xx or a network unavailability. Please check the exact error code for details."}}),wn=function(n){function e(t,r,i){var o=this,o=n.call(this,r?t+": "+r:t)||this;return Object.setPrototypeOf(o,e.prototype),o.errorCode=t||Le.EMPTY_STRING,o.errorMessage=r||Le.EMPTY_STRING,o.subError=i||Le.EMPTY_STRING,o.name="AuthError",o}return Ja(e,n),e.prototype.setCorrelationId=function(t){this.correlationId=t},e.createUnexpectedError=function(t){return new e(EE.unexpectedError.code,EE.unexpectedError.desc+": "+t)},e.createPostRequestFailed=function(t){return new e(EE.postRequestFailed.code,EE.postRequestFailed.desc+": "+t)},e}(Error),TE={createNewGuid:function(){throw wn.createUnexpectedError("Crypto interface - createNewGuid() has not been implemented")},base64Decode:function(){throw wn.createUnexpectedError("Crypto interface - base64Decode() has not been implemented")},base64Encode:function(){throw wn.createUnexpectedError("Crypto interface - base64Encode() has not been implemented")},generatePkceCodes:function(){return zn(this,void 0,void 0,function(){return jn(this,function(n){throw wn.createUnexpectedError("Crypto interface - generatePkceCodes() has not been implemented")})})},getPublicKeyThumbprint:function(){return zn(this,void 0,void 0,function(){return jn(this,function(n){throw wn.createUnexpectedError("Crypto interface - getPublicKeyThumbprint() has not been implemented")})})},removeTokenBindingKey:function(){return zn(this,void 0,void 0,function(){return jn(this,function(n){throw wn.createUnexpectedError("Crypto interface - removeTokenBindingKey() has not been implemented")})})},clearKeystore:function(){return zn(this,void 0,void 0,function(){return jn(this,function(n){throw wn.createUnexpectedError("Crypto interface - clearKeystore() has not been implemented")})})},signJwt:function(){return zn(this,void 0,void 0,function(){return jn(this,function(n){throw wn.createUnexpectedError("Crypto interface - signJwt() has not been implemented")})})},hashString:function(){return zn(this,void 0,void 0,function(){return jn(this,function(n){throw wn.createUnexpectedError("Crypto interface - hashString() has not been implemented")})})}},Mt={clientInfoDecodingError:{code:"client_info_decoding_error",desc:"The client info could not be parsed/decoded correctly. Please review the trace to determine the root cause."},clientInfoEmptyError:{code:"client_info_empty_error",desc:"The client info was empty. Please review the trace to determine the root cause."},tokenParsingError:{code:"token_parsing_error",desc:"Token cannot be parsed. Please review stack trace to determine root cause."},nullOrEmptyToken:{code:"null_or_empty_token",desc:"The token is null or empty. Please review the trace to determine the root cause."},endpointResolutionError:{code:"endpoints_resolution_error",desc:"Error: could not resolve endpoints. Please check network and try again."},networkError:{code:"network_error",desc:"Network request failed. Please check network trace to determine root cause."},unableToGetOpenidConfigError:{code:"openid_config_error",desc:"Could not retrieve endpoints. Check your authority and verify the .well-known/openid-configuration endpoint returns the required endpoints."},hashNotDeserialized:{code:"hash_not_deserialized",desc:"The hash parameters could not be deserialized. Please review the trace to determine the root cause."},blankGuidGenerated:{code:"blank_guid_generated",desc:"The guid generated was blank. Please review the trace to determine the root cause."},invalidStateError:{code:"invalid_state",desc:"State was not the expected format. Please check the logs to determine whether the request was sent using ProtocolUtils.setRequestState()."},stateMismatchError:{code:"state_mismatch",desc:"State mismatch error. Please check your network. Continued requests may cause cache overflow."},stateNotFoundError:{code:"state_not_found",desc:"State not found"},nonceMismatchError:{code:"nonce_mismatch",desc:"Nonce mismatch error. This may be caused by a race condition in concurrent requests."},nonceNotFoundError:{code:"nonce_not_found",desc:"nonce not found"},authTimeNotFoundError:{code:"auth_time_not_found",desc:"Max Age was requested and the ID token is missing the auth_time variable. auth_time is an optional claim and is not enabled by default - it must be enabled. See https://aka.ms/msaljs/optional-claims for more information."},maxAgeTranspiredError:{code:"max_age_transpired",desc:"Max Age is set to 0, or too much time has elapsed since the last end-user authentication."},noTokensFoundError:{code:"no_tokens_found",desc:"No tokens were found for the given scopes, and no authorization code was passed to acquireToken. You must retrieve an authorization code before making a call to acquireToken()."},multipleMatchingTokens:{code:"multiple_matching_tokens",desc:"The cache contains multiple tokens satisfying the requirements. Call AcquireToken again providing more requirements such as authority or account."},multipleMatchingAccounts:{code:"multiple_matching_accounts",desc:"The cache contains multiple accounts satisfying the given parameters. Please pass more info to obtain the correct account"},multipleMatchingAppMetadata:{code:"multiple_matching_appMetadata",desc:"The cache contains multiple appMetadata satisfying the given parameters. Please pass more info to obtain the correct appMetadata"},tokenRequestCannotBeMade:{code:"request_cannot_be_made",desc:"Token request cannot be made without authorization code or refresh token."},appendEmptyScopeError:{code:"cannot_append_empty_scope",desc:"Cannot append null or empty scope to ScopeSet. Please check the stack trace for more info."},removeEmptyScopeError:{code:"cannot_remove_empty_scope",desc:"Cannot remove null or empty scope from ScopeSet. Please check the stack trace for more info."},appendScopeSetError:{code:"cannot_append_scopeset",desc:"Cannot append ScopeSet due to error."},emptyInputScopeSetError:{code:"empty_input_scopeset",desc:"Empty input ScopeSet cannot be processed."},DeviceCodePollingCancelled:{code:"device_code_polling_cancelled",desc:"Caller has cancelled token endpoint polling during device code flow by setting DeviceCodeRequest.cancel = true."},DeviceCodeExpired:{code:"device_code_expired",desc:"Device code is expired."},DeviceCodeUnknownError:{code:"device_code_unknown_error",desc:"Device code stopped polling for unknown reasons."},NoAccountInSilentRequest:{code:"no_account_in_silent_request",desc:"Please pass an account object, silent flow is not supported without account information"},invalidCacheRecord:{code:"invalid_cache_record",desc:"Cache record object was null or undefined."},invalidCacheEnvironment:{code:"invalid_cache_environment",desc:"Invalid environment when attempting to create cache entry"},noAccountFound:{code:"no_account_found",desc:"No account found in cache for given key."},CachePluginError:{code:"no cache plugin set on CacheManager",desc:"ICachePlugin needs to be set before using readFromStorage or writeFromStorage"},noCryptoObj:{code:"no_crypto_object",desc:"No crypto object detected. This is required for the following operation: "},invalidCacheType:{code:"invalid_cache_type",desc:"Invalid cache type"},unexpectedAccountType:{code:"unexpected_account_type",desc:"Unexpected account type."},unexpectedCredentialType:{code:"unexpected_credential_type",desc:"Unexpected credential type."},invalidAssertion:{code:"invalid_assertion",desc:"Client assertion must meet requirements described in https://tools.ietf.org/html/rfc7515"},invalidClientCredential:{code:"invalid_client_credential",desc:"Client credential (secret, certificate, or assertion) must not be empty when creating a confidential client. An application should at most have one credential"},tokenRefreshRequired:{code:"token_refresh_required",desc:"Cannot return token from cache because it must be refreshed. This may be due to one of the following reasons: forceRefresh parameter is set to true, claims have been requested, there is no cached access token or it is expired."},userTimeoutReached:{code:"user_timeout_reached",desc:"User defined timeout for device code polling reached"},tokenClaimsRequired:{code:"token_claims_cnf_required_for_signedjwt",desc:"Cannot generate a POP jwt if the token_claims are not populated"},noAuthorizationCodeFromServer:{code:"authorization_code_missing_from_server_response",desc:"Server response does not contain an authorization code to proceed"},noAzureRegionDetected:{code:"no_azure_region_detected",desc:"No azure region was detected and no fallback was made available"},accessTokenEntityNullError:{code:"access_token_entity_null",desc:"Access token entity is null, please check logs and cache to ensure a valid access token is present."},bindingKeyNotRemovedError:{code:"binding_key_not_removed",desc:"Could not remove the credential's binding key from storage."},logoutNotSupported:{code:"end_session_endpoint_not_supported",desc:"Provided authority does not support logout."},keyIdMissing:{code:"key_id_missing",desc:"A keyId value is missing from the requested bound token's cache record and is required to match the token to it's stored binding key."},noNetworkConnectivity:{code:"no_network_connectivity",desc:"No network connectivity. Check your internet connection."},userCanceledError:{code:"user_canceled",desc:"User canceled the flow."}},en=function(n){function e(t,r){return t=n.call(this,t,r)||this,t.name="ClientAuthError",Object.setPrototypeOf(t,e.prototype),t}return Ja(e,n),e.createClientInfoDecodingError=function(t){return new e(Mt.clientInfoDecodingError.code,Mt.clientInfoDecodingError.desc+" Failed with error: "+t)},e.createClientInfoEmptyError=function(){return new e(Mt.clientInfoEmptyError.code,""+Mt.clientInfoEmptyError.desc)},e.createTokenParsingError=function(t){return new e(Mt.tokenParsingError.code,Mt.tokenParsingError.desc+" Failed with error: "+t)},e.createTokenNullOrEmptyError=function(t){return new e(Mt.nullOrEmptyToken.code,Mt.nullOrEmptyToken.desc+" Raw Token Value: "+t)},e.createEndpointDiscoveryIncompleteError=function(t){return new e(Mt.endpointResolutionError.code,Mt.endpointResolutionError.desc+" Detail: "+t)},e.createNetworkError=function(t,r){return new e(Mt.networkError.code,Mt.networkError.desc+" | Fetch client threw: "+r+" | Attempted to reach: "+t.split("?")[0])},e.createUnableToGetOpenidConfigError=function(t){return new e(Mt.unableToGetOpenidConfigError.code,Mt.unableToGetOpenidConfigError.desc+" Attempted to retrieve endpoints from: "+t)},e.createHashNotDeserializedError=function(t){return new e(Mt.hashNotDeserialized.code,Mt.hashNotDeserialized.desc+" Given Object: "+t)},e.createInvalidStateError=function(t,r){return new e(Mt.invalidStateError.code,Mt.invalidStateError.desc+" Invalid State: "+t+", Root Err: "+r)},e.createStateMismatchError=function(){return new e(Mt.stateMismatchError.code,Mt.stateMismatchError.desc)},e.createStateNotFoundError=function(t){return new e(Mt.stateNotFoundError.code,Mt.stateNotFoundError.desc+":  "+t)},e.createNonceMismatchError=function(){return new e(Mt.nonceMismatchError.code,Mt.nonceMismatchError.desc)},e.createAuthTimeNotFoundError=function(){return new e(Mt.authTimeNotFoundError.code,Mt.authTimeNotFoundError.desc)},e.createMaxAgeTranspiredError=function(){return new e(Mt.maxAgeTranspiredError.code,Mt.maxAgeTranspiredError.desc)},e.createNonceNotFoundError=function(t){return new e(Mt.nonceNotFoundError.code,Mt.nonceNotFoundError.desc+":  "+t)},e.createMultipleMatchingTokensInCacheError=function(){return new e(Mt.multipleMatchingTokens.code,Mt.multipleMatchingTokens.desc+".")},e.createMultipleMatchingAccountsInCacheError=function(){return new e(Mt.multipleMatchingAccounts.code,Mt.multipleMatchingAccounts.desc)},e.createMultipleMatchingAppMetadataInCacheError=function(){return new e(Mt.multipleMatchingAppMetadata.code,Mt.multipleMatchingAppMetadata.desc)},e.createTokenRequestCannotBeMadeError=function(){return new e(Mt.tokenRequestCannotBeMade.code,Mt.tokenRequestCannotBeMade.desc)},e.createAppendEmptyScopeToSetError=function(t){return new e(Mt.appendEmptyScopeError.code,Mt.appendEmptyScopeError.desc+" Given Scope: "+t)},e.createRemoveEmptyScopeFromSetError=function(t){return new e(Mt.removeEmptyScopeError.code,Mt.removeEmptyScopeError.desc+" Given Scope: "+t)},e.createAppendScopeSetError=function(t){return new e(Mt.appendScopeSetError.code,Mt.appendScopeSetError.desc+" Detail Error: "+t)},e.createEmptyInputScopeSetError=function(){return new e(Mt.emptyInputScopeSetError.code,""+Mt.emptyInputScopeSetError.desc)},e.createDeviceCodeCancelledError=function(){return new e(Mt.DeviceCodePollingCancelled.code,""+Mt.DeviceCodePollingCancelled.desc)},e.createDeviceCodeExpiredError=function(){return new e(Mt.DeviceCodeExpired.code,""+Mt.DeviceCodeExpired.desc)},e.createDeviceCodeUnknownError=function(){return new e(Mt.DeviceCodeUnknownError.code,""+Mt.DeviceCodeUnknownError.desc)},e.createNoAccountInSilentRequestError=function(){return new e(Mt.NoAccountInSilentRequest.code,""+Mt.NoAccountInSilentRequest.desc)},e.createNullOrUndefinedCacheRecord=function(){return new e(Mt.invalidCacheRecord.code,Mt.invalidCacheRecord.desc)},e.createInvalidCacheEnvironmentError=function(){return new e(Mt.invalidCacheEnvironment.code,Mt.invalidCacheEnvironment.desc)},e.createNoAccountFoundError=function(){return new e(Mt.noAccountFound.code,Mt.noAccountFound.desc)},e.createCachePluginError=function(){return new e(Mt.CachePluginError.code,""+Mt.CachePluginError.desc)},e.createNoCryptoObjectError=function(t){return new e(Mt.noCryptoObj.code,""+Mt.noCryptoObj.desc+t)},e.createInvalidCacheTypeError=function(){return new e(Mt.invalidCacheType.code,""+Mt.invalidCacheType.desc)},e.createUnexpectedAccountTypeError=function(){return new e(Mt.unexpectedAccountType.code,""+Mt.unexpectedAccountType.desc)},e.createUnexpectedCredentialTypeError=function(){return new e(Mt.unexpectedCredentialType.code,""+Mt.unexpectedCredentialType.desc)},e.createInvalidAssertionError=function(){return new e(Mt.invalidAssertion.code,""+Mt.invalidAssertion.desc)},e.createInvalidCredentialError=function(){return new e(Mt.invalidClientCredential.code,""+Mt.invalidClientCredential.desc)},e.createRefreshRequiredError=function(){return new e(Mt.tokenRefreshRequired.code,Mt.tokenRefreshRequired.desc)},e.createUserTimeoutReachedError=function(){return new e(Mt.userTimeoutReached.code,Mt.userTimeoutReached.desc)},e.createTokenClaimsRequiredError=function(){return new e(Mt.tokenClaimsRequired.code,Mt.tokenClaimsRequired.desc)},e.createNoAuthCodeInServerResponseError=function(){return new e(Mt.noAuthorizationCodeFromServer.code,Mt.noAuthorizationCodeFromServer.desc)},e.createBindingKeyNotRemovedError=function(){return new e(Mt.bindingKeyNotRemovedError.code,Mt.bindingKeyNotRemovedError.desc)},e.createLogoutNotSupportedError=function(){return new e(Mt.logoutNotSupported.code,Mt.logoutNotSupported.desc)},e.createKeyIdMissingError=function(){return new e(Mt.keyIdMissing.code,Mt.keyIdMissing.desc)},e.createNoNetworkConnectivityError=function(){return new e(Mt.noNetworkConnectivity.code,Mt.noNetworkConnectivity.desc)},e.createUserCanceledError=function(){return new e(Mt.userCanceledError.code,Mt.userCanceledError.desc)},e}(wn),Kt=function(){function n(){}return n.decodeAuthToken=function(e){if(n.isEmpty(e))throw en.createTokenNullOrEmptyError(e);var t=/^([^\.\s]*)\.([^\.\s]+)\.([^\.\s]*)$/.exec(e);if(!t||t.length<4)throw en.createTokenParsingError("Given token is malformed: "+JSON.stringify(e));return{header:t[1],JWSPayload:t[2],JWSSig:t[3]}},n.isEmpty=function(e){return e===void 0||!e||e.length===0},n.isEmptyObj=function(e){if(e&&!n.isEmpty(e))try{var t=JSON.parse(e);return Object.keys(t).length===0}catch{}return!0},n.startsWith=function(e,t){return e.indexOf(t)===0},n.endsWith=function(e,t){return e.length>=t.length&&e.lastIndexOf(t)===e.length-t.length},n.queryStringToObject=function(i){function t(o){return decodeURIComponent(o.replace(/\+/g," "))}var r={},i=i.split("&");return i.forEach(function(o){var a;o.trim()&&(a=(o=o.split(/=(.+)/g,2))[0],o=o[1],a)&&o&&(r[t(a)]=t(o))}),r},n.trimArrayEntries=function(e){return e.map(function(t){return t.trim()})},n.removeEmptyStringsFromArray=function(e){return e.filter(function(t){return!n.isEmpty(t)})},n.jsonParseHelper=function(e){try{return JSON.parse(e)}catch{return null}},n.matchPattern=function(e,t){return new RegExp(e.replace(/\\/g,"\\\\").replace(/\*/g,"[^ ]*").replace(/\?/g,"\\?")).test(t)},n}(),KM=(function(n){n[n.Error=0]="Error",n[n.Warning=1]="Warning",n[n.Info=2]="Info",n[n.Verbose=3]="Verbose",n[n.Trace=4]="Trace"}(No=No||{}),function(){function n(e,t,r){this.level=No.Info,e=e||n.createDefaultLoggerOptions(),this.localCallback=e.loggerCallback||function(){},this.piiLoggingEnabled=e.piiLoggingEnabled||!1,this.level=typeof e.logLevel=="number"?e.logLevel:No.Info,this.correlationId=e.correlationId||Le.EMPTY_STRING,this.packageName=t||Le.EMPTY_STRING,this.packageVersion=r||Le.EMPTY_STRING}return n.createDefaultLoggerOptions=function(){return{loggerCallback:function(){},piiLoggingEnabled:!1,logLevel:No.Info}},n.prototype.clone=function(e,t,r){return new n({loggerCallback:this.localCallback,piiLoggingEnabled:this.piiLoggingEnabled,logLevel:this.level,correlationId:r||this.correlationId},e,t)},n.prototype.logMessage=function(e,t){var r;t.logLevel>this.level||!this.piiLoggingEnabled&&t.containsPii||(r=new Date().toUTCString(),r=(Kt.isEmpty(t.correlationId)?Kt.isEmpty(this.correlationId)?"["+r+"]":"["+r+"] : ["+this.correlationId+"]":"["+r+"] : ["+t.correlationId+"]")+" : "+this.packageName+"@"+this.packageVersion+" : "+No[t.logLevel]+" - "+e,this.executeCallback(t.logLevel,r,t.containsPii||!1))},n.prototype.executeCallback=function(e,t,r){this.localCallback&&this.localCallback(e,t,r)},n.prototype.error=function(e,t){this.logMessage(e,{logLevel:No.Error,containsPii:!1,correlationId:t||Le.EMPTY_STRING})},n.prototype.errorPii=function(e,t){this.logMessage(e,{logLevel:No.Error,containsPii:!0,correlationId:t||Le.EMPTY_STRING})},n.prototype.warning=function(e,t){this.logMessage(e,{logLevel:No.Warning,containsPii:!1,correlationId:t||Le.EMPTY_STRING})},n.prototype.warningPii=function(e,t){this.logMessage(e,{logLevel:No.Warning,containsPii:!0,correlationId:t||Le.EMPTY_STRING})},n.prototype.info=function(e,t){this.logMessage(e,{logLevel:No.Info,containsPii:!1,correlationId:t||Le.EMPTY_STRING})},n.prototype.infoPii=function(e,t){this.logMessage(e,{logLevel:No.Info,containsPii:!0,correlationId:t||Le.EMPTY_STRING})},n.prototype.verbose=function(e,t){this.logMessage(e,{logLevel:No.Verbose,containsPii:!1,correlationId:t||Le.EMPTY_STRING})},n.prototype.verbosePii=function(e,t){this.logMessage(e,{logLevel:No.Verbose,containsPii:!0,correlationId:t||Le.EMPTY_STRING})},n.prototype.trace=function(e,t){this.logMessage(e,{logLevel:No.Trace,containsPii:!1,correlationId:t||Le.EMPTY_STRING})},n.prototype.tracePii=function(e,t){this.logMessage(e,{logLevel:No.Trace,containsPii:!0,correlationId:t||Le.EMPTY_STRING})},n.prototype.isPiiLoggingEnabled=function(){return this.piiLoggingEnabled||!1},n}()),Gj="@azure/msal-common",ZM="13.3.1",Vn=(function(n){n[n.None=0]="None",n.AzurePublic="https://login.microsoftonline.com",n.AzurePpe="https://login.windows-ppe.net",n.AzureChina="https://login.chinacloudapi.cn",n.AzureGermany="https://login.microsoftonline.de",n.AzureUsGovernment="https://login.microsoftonline.us"}(d0=d0||{}),{redirectUriNotSet:{code:"redirect_uri_empty",desc:"A redirect URI is required for all calls, and none has been set."},postLogoutUriNotSet:{code:"post_logout_uri_empty",desc:"A post logout redirect has not been set."},claimsRequestParsingError:{code:"claims_request_parsing_error",desc:"Could not parse the given claims request object."},authorityUriInsecure:{code:"authority_uri_insecure",desc:"Authority URIs must use https.  Please see here for valid authority configuration options: https://docs.microsoft.com/en-us/azure/active-directory/develop/msal-js-initializing-client-applications#configuration-options"},urlParseError:{code:"url_parse_error",desc:"URL could not be parsed into appropriate segments."},urlEmptyError:{code:"empty_url_error",desc:"URL was empty or null."},emptyScopesError:{code:"empty_input_scopes_error",desc:"Scopes cannot be passed as null, undefined or empty array because they are required to obtain an access token."},nonArrayScopesError:{code:"nonarray_input_scopes_error",desc:"Scopes cannot be passed as non-array."},clientIdSingleScopeError:{code:"clientid_input_scopes_error",desc:"Client ID can only be provided as a single scope."},invalidPrompt:{code:"invalid_prompt_value",desc:"Supported prompt values are 'login', 'select_account', 'consent', 'create', 'none' and 'no_session'.  Please see here for valid configuration options: https://azuread.github.io/microsoft-authentication-library-for-js/ref/modules/_azure_msal_common.html#commonauthorizationurlrequest"},invalidClaimsRequest:{code:"invalid_claims",desc:"Given claims parameter must be a stringified JSON object."},tokenRequestEmptyError:{code:"token_request_empty",desc:"Token request was empty and not found in cache."},logoutRequestEmptyError:{code:"logout_request_empty",desc:"The logout request was null or undefined."},invalidCodeChallengeMethod:{code:"invalid_code_challenge_method",desc:'code_challenge_method passed is invalid. Valid values are "plain" and "S256".'},invalidCodeChallengeParams:{code:"pkce_params_missing",desc:"Both params: code_challenge and code_challenge_method are to be passed if to be sent in the request"},invalidCloudDiscoveryMetadata:{code:"invalid_cloud_discovery_metadata",desc:"Invalid cloudDiscoveryMetadata provided. Must be a stringified JSON object containing tenant_discovery_endpoint and metadata fields"},invalidAuthorityMetadata:{code:"invalid_authority_metadata",desc:"Invalid authorityMetadata provided. Must by a stringified JSON object containing authorization_endpoint, token_endpoint, issuer fields."},untrustedAuthority:{code:"untrusted_authority",desc:"The provided authority is not a trusted authority. Please include this authority in the knownAuthorities config parameter."},invalidAzureCloudInstance:{code:"invalid_azure_cloud_instance",desc:"Invalid AzureCloudInstance provided. Please refer MSAL JS docs: aks.ms/msaljs/azure_cloud_instance for valid values"},missingSshJwk:{code:"missing_ssh_jwk",desc:"Missing sshJwk in SSH certificate request. A stringified JSON Web Key is required when using the SSH authentication scheme."},missingSshKid:{code:"missing_ssh_kid",desc:"Missing sshKid in SSH certificate request. A string that uniquely identifies the public SSH key is required when using the SSH authentication scheme."},missingNonceAuthenticationHeader:{code:"missing_nonce_authentication_header",desc:"Unable to find an authentication header containing server nonce. Either the Authentication-Info or WWW-Authenticate headers must be present in order to obtain a server nonce."},invalidAuthenticationHeader:{code:"invalid_authentication_header",desc:"Invalid authentication header provided"},authorityMismatch:{code:"authority_mismatch",desc:"Authority mismatch error. Authority provided in login request or PublicClientApplication config does not match the environment of the provided account. Please use a matching account or make an interactive request to login to this authority."}}),yi=function(n){function e(t,r){return t=n.call(this,t,r)||this,t.name="ClientConfigurationError",Object.setPrototypeOf(t,e.prototype),t}return Ja(e,n),e.createRedirectUriEmptyError=function(){return new e(Vn.redirectUriNotSet.code,Vn.redirectUriNotSet.desc)},e.createPostLogoutRedirectUriEmptyError=function(){return new e(Vn.postLogoutUriNotSet.code,Vn.postLogoutUriNotSet.desc)},e.createClaimsRequestParsingError=function(t){return new e(Vn.claimsRequestParsingError.code,Vn.claimsRequestParsingError.desc+" Given value: "+t)},e.createInsecureAuthorityUriError=function(t){return new e(Vn.authorityUriInsecure.code,Vn.authorityUriInsecure.desc+" Given URI: "+t)},e.createUrlParseError=function(t){return new e(Vn.urlParseError.code,Vn.urlParseError.desc+" Given Error: "+t)},e.createUrlEmptyError=function(){return new e(Vn.urlEmptyError.code,Vn.urlEmptyError.desc)},e.createEmptyScopesArrayError=function(){return new e(Vn.emptyScopesError.code,""+Vn.emptyScopesError.desc)},e.createClientIdSingleScopeError=function(t){return new e(Vn.clientIdSingleScopeError.code,Vn.clientIdSingleScopeError.desc+" Given Scopes: "+t)},e.createInvalidPromptError=function(t){return new e(Vn.invalidPrompt.code,Vn.invalidPrompt.desc+" Given value: "+t)},e.createInvalidClaimsRequestError=function(){return new e(Vn.invalidClaimsRequest.code,Vn.invalidClaimsRequest.desc)},e.createEmptyLogoutRequestError=function(){return new e(Vn.logoutRequestEmptyError.code,Vn.logoutRequestEmptyError.desc)},e.createEmptyTokenRequestError=function(){return new e(Vn.tokenRequestEmptyError.code,Vn.tokenRequestEmptyError.desc)},e.createInvalidCodeChallengeMethodError=function(){return new e(Vn.invalidCodeChallengeMethod.code,Vn.invalidCodeChallengeMethod.desc)},e.createInvalidCodeChallengeParamsError=function(){return new e(Vn.invalidCodeChallengeParams.code,Vn.invalidCodeChallengeParams.desc)},e.createInvalidCloudDiscoveryMetadataError=function(){return new e(Vn.invalidCloudDiscoveryMetadata.code,Vn.invalidCloudDiscoveryMetadata.desc)},e.createInvalidAuthorityMetadataError=function(){return new e(Vn.invalidAuthorityMetadata.code,Vn.invalidAuthorityMetadata.desc)},e.createUntrustedAuthorityError=function(){return new e(Vn.untrustedAuthority.code,Vn.untrustedAuthority.desc)},e.createInvalidAzureCloudInstanceError=function(){return new e(Vn.invalidAzureCloudInstance.code,Vn.invalidAzureCloudInstance.desc)},e.createMissingSshJwkError=function(){return new e(Vn.missingSshJwk.code,Vn.missingSshJwk.desc)},e.createMissingSshKidError=function(){return new e(Vn.missingSshKid.code,Vn.missingSshKid.desc)},e.createMissingNonceAuthenticationHeadersError=function(){return new e(Vn.missingNonceAuthenticationHeader.code,Vn.missingNonceAuthenticationHeader.desc)},e.createInvalidAuthenticationHeaderError=function(t,r){return new e(Vn.invalidAuthenticationHeader.code,Vn.invalidAuthenticationHeader.desc+". Invalid header: "+t+". Details: "+r)},e.createAuthorityMismatchError=function(){return new e(Vn.authorityMismatch.code,Vn.authorityMismatch.desc)},e}(en),fa=function(){function n(r){var t=this,r=r?Kt.trimArrayEntries(vE(r)):[],r=r?Kt.removeEmptyStringsFromArray(r):[];this.validateInputScopes(r),this.scopes=new Set,r.forEach(function(i){return t.scopes.add(i)})}return n.fromString=function(e){return new n((e||Le.EMPTY_STRING).split(" "))},n.createSearchScopes=function(e){return e=new n(e),e.containsOnlyOIDCScopes()?e.removeScope(Le.OFFLINE_ACCESS_SCOPE):e.removeOIDCScopes(),e},n.prototype.validateInputScopes=function(e){if(!e||e.length<1)throw yi.createEmptyScopesArrayError()},n.prototype.containsScope=function(e){var t=new n(this.printScopesLowerCase().split(" "));return!Kt.isEmpty(e)&&t.scopes.has(e.toLowerCase())},n.prototype.containsScopeSet=function(e){var t=this;return!(!e||e.scopes.size<=0)&&this.scopes.size>=e.scopes.size&&e.asArray().every(function(r){return t.containsScope(r)})},n.prototype.containsOnlyOIDCScopes=function(){var e=this,t=0;return jj.forEach(function(r){e.containsScope(r)&&(t+=1)}),this.scopes.size===t},n.prototype.appendScope=function(e){Kt.isEmpty(e)||this.scopes.add(e.trim())},n.prototype.appendScopes=function(e){var t=this;try{e.forEach(function(r){return t.appendScope(r)})}catch(r){throw en.createAppendScopeSetError(r)}},n.prototype.removeScope=function(e){if(Kt.isEmpty(e))throw en.createRemoveEmptyScopeFromSetError(e);this.scopes.delete(e.trim())},n.prototype.removeOIDCScopes=function(){var e=this;jj.forEach(function(t){e.scopes.delete(t)})},n.prototype.unionScopeSets=function(e){var t;if(e)return t=new Set,e.scopes.forEach(function(r){return t.add(r.toLowerCase())}),this.scopes.forEach(function(r){return t.add(r.toLowerCase())}),t;throw en.createEmptyInputScopeSetError()},n.prototype.intersectingScopeSets=function(r){if(!r)throw en.createEmptyInputScopeSetError();r.containsOnlyOIDCScopes()||r.removeOIDCScopes();var t=this.unionScopeSets(r),r=r.getScopeCount(),i=this.getScopeCount();return t.size<i+r},n.prototype.getScopeCount=function(){return this.scopes.size},n.prototype.asArray=function(){var e=[];return this.scopes.forEach(function(t){return e.push(t)}),e},n.prototype.printScopes=function(){return this.scopes?this.asArray().join(" "):Le.EMPTY_STRING},n.prototype.printScopesLowerCase=function(){return this.printScopes().toLowerCase()},n}();function SE(n,e){if(Kt.isEmpty(n))throw en.createClientInfoEmptyError();try{var t=e.base64Decode(n);return JSON.parse(t)}catch(r){throw en.createClientInfoDecodingError(r.message)}}function Sm(n){if(Kt.isEmpty(n))throw en.createClientInfoDecodingError("Home account ID was empty.");return n=n.split(Eo.CLIENT_INFO_SEPARATOR,2),{uid:n[0],utid:n.length<2?Le.EMPTY_STRING:n[1]}}(function(n){n[n.Default=0]="Default",n[n.Adfs=1]="Adfs",n[n.Dsts=2]="Dsts",n[n.Ciam=3]="Ciam"})(ka=ka||{});var Qo=function(){function n(){}return n.prototype.generateAccountId=function(){return[this.homeAccountId,this.environment].join(Eo.CACHE_KEY_SEPARATOR).toLowerCase()},n.prototype.generateAccountKey=function(){return n.generateAccountCacheKey({homeAccountId:this.homeAccountId,environment:this.environment,tenantId:this.realm,username:this.username,localAccountId:this.localAccountId})},n.prototype.generateType=function(){switch(this.authorityType){case _u.ADFS_ACCOUNT_TYPE:return vu.ADFS;case _u.MSAV1_ACCOUNT_TYPE:return vu.MSA;case _u.MSSTS_ACCOUNT_TYPE:return vu.MSSTS;case _u.GENERIC_ACCOUNT_TYPE:return vu.GENERIC;default:throw en.createUnexpectedAccountTypeError()}},n.prototype.getAccountInfo=function(){return{homeAccountId:this.homeAccountId,environment:this.environment,tenantId:this.realm,username:this.username,localAccountId:this.localAccountId,name:this.name,idTokenClaims:this.idTokenClaims,nativeAccountId:this.nativeAccountId}},n.generateAccountCacheKey=function(e){return[e.homeAccountId,e.environment||Le.EMPTY_STRING,e.tenantId||Le.EMPTY_STRING].join(Eo.CACHE_KEY_SEPARATOR).toLowerCase()},n.createAccount=function(g,t,r,i,o,a,l,h){var p=new n,g=(p.authorityType=_u.MSSTS_ACCOUNT_TYPE,p.clientInfo=g,p.homeAccountId=t,p.nativeAccountId=h,l||i&&i.getPreferredCache());if(g)return p.environment=g,p.realm=((t=r==null?void 0:r.claims)==null?void 0:t.tid)||Le.EMPTY_STRING,r&&(p.idTokenClaims=r.claims,p.localAccountId=((h=r==null?void 0:r.claims)==null?void 0:h.oid)||((l=r==null?void 0:r.claims)==null?void 0:l.sub)||Le.EMPTY_STRING,g=(i=r==null?void 0:r.claims)==null?void 0:i.preferred_username,h=(t=r==null?void 0:r.claims)!=null&&t.emails?r.claims.emails[0]:null,p.username=g||h||Le.EMPTY_STRING,p.name=(l=r==null?void 0:r.claims)==null?void 0:l.name),p.cloudGraphHostName=o,p.msGraphHost=a,p;throw en.createInvalidCacheEnvironmentError()},n.createGenericAccount=function(h,t,r,i,o,a){var l=new n,h=(l.authorityType=r&&r.authorityType===ka.Adfs?_u.ADFS_ACCOUNT_TYPE:_u.GENERIC_ACCOUNT_TYPE,l.homeAccountId=h,l.realm=Le.EMPTY_STRING,a||r&&r.getPreferredCache());if(h)return t&&(l.localAccountId=((a=t==null?void 0:t.claims)==null?void 0:a.oid)||((r=t==null?void 0:t.claims)==null?void 0:r.sub)||Le.EMPTY_STRING,l.username=((a=t==null?void 0:t.claims)==null?void 0:a.upn)||Le.EMPTY_STRING,l.name=((r=t==null?void 0:t.claims)==null?void 0:r.name)||Le.EMPTY_STRING,l.idTokenClaims=t==null?void 0:t.claims),l.environment=h,l.cloudGraphHostName=i,l.msGraphHost=o,l;throw en.createInvalidCacheEnvironmentError()},n.generateHomeAccountId=function(e,t,r,i,o){var a=(a=o==null?void 0:o.claims)!=null&&a.sub?o.claims.sub:Le.EMPTY_STRING;if(t!==ka.Adfs&&t!==ka.Dsts){if(e)try{var l=SE(e,i);if(!Kt.isEmpty(l.uid)&&!Kt.isEmpty(l.utid))return""+l.uid+Eo.CLIENT_INFO_SEPARATOR+l.utid}catch{}r.verbose("No client info in response")}return a},n.isAccountEntity=function(e){return!!e&&e.hasOwnProperty("homeAccountId")&&e.hasOwnProperty("environment")&&e.hasOwnProperty("realm")&&e.hasOwnProperty("localAccountId")&&e.hasOwnProperty("username")&&e.hasOwnProperty("authorityType")},n.accountInfoIsEqual=function(e,t,r){var i,o;return!(!e||!t)&&(o=!0,r&&(r=e.idTokenClaims||{},i=t.idTokenClaims||{},o=r.iat===i.iat&&r.nonce===i.nonce),e.homeAccountId===t.homeAccountId)&&e.localAccountId===t.localAccountId&&e.username===t.username&&e.tenantId===t.tenantId&&e.environment===t.environment&&e.nativeAccountId===t.nativeAccountId&&o},n}(),ml=function(){function n(e,t){if(Kt.isEmpty(e))throw en.createTokenNullOrEmptyError(e);this.rawToken=e,this.claims=n.extractTokenClaims(e,t)}return n.extractTokenClaims=function(e,t){e=Kt.decodeAuthToken(e);try{var r=e.JWSPayload,i=t.base64Decode(r);return JSON.parse(i)}catch(o){throw en.createTokenParsingError(o)}},n.checkMaxAge=function(e,t){if(t===0||Date.now()-3e5>e+t)throw en.createMaxAgeTranspiredError()},n}(),es=function(){function n(e,t,r){this.clientId=e,this.cryptoImpl=t,this.commonLogger=r.clone(Gj,ZM)}return n.prototype.getAllAccounts=function(){var e=this,t=this.getAccountKeys();return t.length<1||(t=t.reduce(function(r,i){return i=e.getAccount(i),i&&r.push(i),r},[])).length<1?[]:t.map(function(r){return e.getAccountInfoFromEntity(r)})},n.prototype.getAccountInfoFilteredBy=function(e){return e=this.getAccountsFilteredBy(e),0<e.length?this.getAccountInfoFromEntity(e[0]):null},n.prototype.getAccountInfoFromEntity=function(t){var t=t.getAccountInfo(),r=this.getIdToken(t);return r&&(t.idToken=r.secret,t.idTokenClaims=new ml(r.secret,this.cryptoImpl).claims),t},n.prototype.saveCacheRecord=function(e){return zn(this,void 0,void 0,function(){return jn(this,function(t){switch(t.label){case 0:if(e)return e.account&&this.setAccount(e.account),e.idToken&&this.setIdTokenCredential(e.idToken),e.accessToken?[4,this.saveAccessToken(e.accessToken)]:[3,2];throw en.createNullOrUndefinedCacheRecord();case 1:t.sent(),t.label=2;case 2:return e.refreshToken&&this.setRefreshTokenCredential(e.refreshToken),e.appMetadata&&this.setAppMetadata(e.appMetadata),[2]}})})},n.prototype.saveAccessToken=function(e){return zn(this,void 0,void 0,function(){var t,r,i,o,a=this;return jn(this,function(l){switch(l.label){case 0:return t={clientId:e.clientId,credentialType:e.credentialType,environment:e.environment,homeAccountId:e.homeAccountId,realm:e.realm,tokenType:e.tokenType,requestedClaimsHash:e.requestedClaimsHash},r=this.getTokenKeys(),i=fa.fromString(e.target),o=[],r.accessToken.forEach(function(h){var p;a.accessTokenKeyMatchesFilter(h,t,!1)&&(p=a.getAccessTokenCredential(h))&&a.credentialMatchesFilter(p,t)&&fa.fromString(p.target).intersectingScopeSets(i)&&o.push(a.removeAccessToken(h))}),[4,Promise.all(o)];case 1:return l.sent(),this.setAccessTokenCredential(e),[2]}})})},n.prototype.getAccountsFilteredBy=function(e){var t=this,r=this.getAccountKeys(),i=[];return r.forEach(function(o){!t.isAccountKey(o,e.homeAccountId,e.realm)||!(o=t.getAccount(o))||e.homeAccountId&&!t.matchHomeAccountId(o,e.homeAccountId)||e.localAccountId&&!t.matchLocalAccountId(o,e.localAccountId)||e.username&&!t.matchUsername(o,e.username)||e.environment&&!t.matchEnvironment(o,e.environment)||e.realm&&!t.matchRealm(o,e.realm)||e.nativeAccountId&&!t.matchNativeAccountId(o,e.nativeAccountId)||i.push(o)}),i},n.prototype.isAccountKey=function(e,t,r){return!(e.split(Eo.CACHE_KEY_SEPARATOR).length<3||t&&!e.toLowerCase().includes(t.toLowerCase())||r&&!e.toLowerCase().includes(r.toLowerCase()))},n.prototype.isCredentialKey=function(e){if(e.split(Eo.CACHE_KEY_SEPARATOR).length<6||(e=e.toLowerCase(),e.indexOf(In.ID_TOKEN.toLowerCase())===-1&&e.indexOf(In.ACCESS_TOKEN.toLowerCase())===-1&&e.indexOf(In.ACCESS_TOKEN_WITH_AUTH_SCHEME.toLowerCase())===-1&&e.indexOf(In.REFRESH_TOKEN.toLowerCase())===-1))return!1;if(-1<e.indexOf(In.REFRESH_TOKEN.toLowerCase())){var t=""+In.REFRESH_TOKEN+Eo.CACHE_KEY_SEPARATOR+this.clientId+Eo.CACHE_KEY_SEPARATOR,r=""+In.REFRESH_TOKEN+Eo.CACHE_KEY_SEPARATOR+p0+Eo.CACHE_KEY_SEPARATOR;if(e.indexOf(t.toLowerCase())===-1&&e.indexOf(r.toLowerCase())===-1)return!1}else if(e.indexOf(this.clientId.toLowerCase())===-1)return!1;return!0},n.prototype.credentialMatchesFilter=function(e,t){return!(t.clientId&&!this.matchClientId(e,t.clientId)||t.userAssertionHash&&!this.matchUserAssertionHash(e,t.userAssertionHash)||typeof t.homeAccountId=="string"&&!this.matchHomeAccountId(e,t.homeAccountId)||t.environment&&!this.matchEnvironment(e,t.environment)||t.realm&&!this.matchRealm(e,t.realm)||t.credentialType&&!this.matchCredentialType(e,t.credentialType)||t.familyId&&!this.matchFamilyId(e,t.familyId)||t.target&&!this.matchTarget(e,t.target)||(t.requestedClaimsHash||e.requestedClaimsHash)&&e.requestedClaimsHash!==t.requestedClaimsHash||e.credentialType===In.ACCESS_TOKEN_WITH_AUTH_SCHEME&&(t.tokenType&&!this.matchTokenType(e,t.tokenType)||t.tokenType===qr.SSH&&t.keyId&&!this.matchKeyId(e,t.keyId)))},n.prototype.getAppMetadataFilteredBy=function(e){return this.getAppMetadataFilteredByInternal(e.environment,e.clientId)},n.prototype.getAppMetadataFilteredByInternal=function(e,t){var r=this,i=this.getKeys(),o={};return i.forEach(function(a){var l;!r.isAppMetadata(a)||!(l=r.getAppMetadata(a))||e&&!r.matchEnvironment(l,e)||t&&!r.matchClientId(l,t)||(o[a]=l)}),o},n.prototype.getAuthorityMetadataByAlias=function(e){var t=this,r=this.getAuthorityMetadataKeys(),i=null;return r.forEach(function(o){t.isAuthorityMetadata(o)&&o.indexOf(t.clientId)!==-1&&(o=t.getAuthorityMetadata(o))&&o.aliases.indexOf(e)!==-1&&(i=o)}),i},n.prototype.removeAllAccounts=function(){return zn(this,void 0,void 0,function(){var e,t,r=this;return jn(this,function(i){switch(i.label){case 0:return e=this.getAccountKeys(),t=[],e.forEach(function(o){t.push(r.removeAccount(o))}),[4,Promise.all(t)];case 1:return i.sent(),[2]}})})},n.prototype.removeAccount=function(e){return zn(this,void 0,void 0,function(){var t;return jn(this,function(r){switch(r.label){case 0:if(t=this.getAccount(e))return[4,this.removeAccountContext(t)];throw en.createNoAccountFoundError();case 1:return r.sent(),this.removeItem(e),[2]}})})},n.prototype.removeAccountContext=function(e){return zn(this,void 0,void 0,function(){var t,r,i,o=this;return jn(this,function(a){switch(a.label){case 0:return t=this.getTokenKeys(),r=e.generateAccountId(),i=[],t.idToken.forEach(function(l){l.indexOf(r)===0&&o.removeIdToken(l)}),t.accessToken.forEach(function(l){l.indexOf(r)===0&&i.push(o.removeAccessToken(l))}),t.refreshToken.forEach(function(l){l.indexOf(r)===0&&o.removeRefreshToken(l)}),[4,Promise.all(i)];case 1:return a.sent(),[2]}})})},n.prototype.removeAccessToken=function(e){return zn(this,void 0,void 0,function(){var t;return jn(this,function(r){switch(r.label){case 0:if(!(t=this.getAccessTokenCredential(e)))return[2];if(t.credentialType.toLowerCase()!==In.ACCESS_TOKEN_WITH_AUTH_SCHEME.toLowerCase())return[3,4];if(t.tokenType!==qr.POP)return[3,4];if(!(t=t.keyId))return[3,4];r.label=1;case 1:return r.trys.push([1,3,,4]),[4,this.cryptoImpl.removeTokenBindingKey(t)];case 2:return r.sent(),[3,4];case 3:throw r.sent(),en.createBindingKeyNotRemovedError();case 4:return[2,this.removeItem(e)]}})})},n.prototype.removeAppMetadata=function(){var e=this;return this.getKeys().forEach(function(t){e.isAppMetadata(t)&&e.removeItem(t)}),!0},n.prototype.readCacheRecord=function(l,a,r){var h=this.getTokenKeys(),i=this.readAccountFromCache(l),o=this.getIdToken(l,h),a=this.getAccessToken(l,a,h),l=this.getRefreshToken(l,!1,h),h=this.readAppMetadataFromCache(r);return i&&o&&(i.idTokenClaims=new ml(o.secret,this.cryptoImpl).claims),{account:i,idToken:o,accessToken:a,refreshToken:l,appMetadata:h}},n.prototype.readAccountFromCache=function(e){return e=Qo.generateAccountCacheKey(e),this.getAccount(e)},n.prototype.getIdToken=function(i,o){var r=this,i=(this.commonLogger.trace("CacheManager - getIdToken called"),{homeAccountId:i.homeAccountId,environment:i.environment,credentialType:In.ID_TOKEN,clientId:this.clientId,realm:i.tenantId}),i=this.getIdTokensByFilter(i,o),o=i.length;return o<1?(this.commonLogger.info("CacheManager:getIdToken - No token found"),null):1<o?(this.commonLogger.info("CacheManager:getIdToken - Multiple id tokens found, clearing them"),i.forEach(function(a){r.removeIdToken(a.generateCredentialKey())}),null):(this.commonLogger.info("CacheManager:getIdToken - Returning id token"),i[0])},n.prototype.getIdTokensByFilter=function(e,i){var r=this,i=i&&i.idToken||this.getTokenKeys().idToken,o=[];return i.forEach(function(a){r.idTokenKeyMatchesFilter(a,Gr({clientId:r.clientId},e))&&(a=r.getIdTokenCredential(a))&&r.credentialMatchesFilter(a,e)&&o.push(a)}),o},n.prototype.idTokenKeyMatchesFilter=function(e,t){return e=e.toLowerCase(),!(t.clientId&&e.indexOf(t.clientId.toLowerCase())===-1||t.homeAccountId&&e.indexOf(t.homeAccountId.toLowerCase())===-1)},n.prototype.removeIdToken=function(e){this.removeItem(e)},n.prototype.removeRefreshToken=function(e){this.removeItem(e)},n.prototype.getAccessToken=function(g,t,r){var i=this,o=(this.commonLogger.trace("CacheManager - getAccessToken called"),fa.createSearchScopes(t.scopes)),a=t.authenticationScheme||qr.BEARER,h=a&&a.toLowerCase()!==qr.BEARER.toLowerCase()?In.ACCESS_TOKEN_WITH_AUTH_SCHEME:In.ACCESS_TOKEN,l={homeAccountId:g.homeAccountId,environment:g.environment,credentialType:h,clientId:this.clientId,realm:g.tenantId,target:o,tokenType:a,keyId:t.sshKid,requestedClaimsHash:t.requestedClaimsHash},h=r&&r.accessToken||this.getTokenKeys().accessToken,p=[],g=(h.forEach(function(_){i.accessTokenKeyMatchesFilter(_,l,!0)&&(_=i.getAccessTokenCredential(_))&&i.credentialMatchesFilter(_,l)&&p.push(_)}),p.length);return g<1?(this.commonLogger.info("CacheManager:getAccessToken - No token found"),null):1<g?(this.commonLogger.info("CacheManager:getAccessToken - Multiple access tokens found, clearing them"),p.forEach(function(_){i.removeAccessToken(_.generateCredentialKey())}),null):(this.commonLogger.info("CacheManager:getAccessToken - Returning access token"),p[0])},n.prototype.accessTokenKeyMatchesFilter=function(e,t,r){var i=e.toLowerCase();if(t.clientId&&i.indexOf(t.clientId.toLowerCase())===-1||t.homeAccountId&&i.indexOf(t.homeAccountId.toLowerCase())===-1||t.realm&&i.indexOf(t.realm.toLowerCase())===-1||t.requestedClaimsHash&&i.indexOf(t.requestedClaimsHash.toLowerCase())===-1)return!1;if(t.target)for(var o=t.target.asArray(),a=0;a<o.length;a++){if(r&&!i.includes(o[a].toLowerCase()))return!1;if(!r&&i.includes(o[a].toLowerCase()))return!0}return!0},n.prototype.getAccessTokensByFilter=function(e){var t=this,r=this.getTokenKeys(),i=[];return r.accessToken.forEach(function(o){t.accessTokenKeyMatchesFilter(o,e,!0)&&(o=t.getAccessTokenCredential(o))&&t.credentialMatchesFilter(o,e)&&i.push(o)}),i},n.prototype.getRefreshToken=function(l,o,r){var i=this,o=(this.commonLogger.trace("CacheManager - getRefreshToken called"),o?p0:void 0),a={homeAccountId:l.homeAccountId,environment:l.environment,credentialType:In.REFRESH_TOKEN,clientId:this.clientId,familyId:o},l=r&&r.refreshToken||this.getTokenKeys().refreshToken,h=[];return l.forEach(function(p){i.refreshTokenKeyMatchesFilter(p,a)&&(p=i.getRefreshTokenCredential(p))&&i.credentialMatchesFilter(p,a)&&h.push(p)}),h.length<1?(this.commonLogger.info("CacheManager:getRefreshToken - No refresh token found."),null):(this.commonLogger.info("CacheManager:getRefreshToken - returning refresh token"),h[0])},n.prototype.refreshTokenKeyMatchesFilter=function(e,t){return e=e.toLowerCase(),!(t.familyId&&e.indexOf(t.familyId.toLowerCase())===-1||!t.familyId&&t.clientId&&e.indexOf(t.clientId.toLowerCase())===-1||t.homeAccountId&&e.indexOf(t.homeAccountId.toLowerCase())===-1)},n.prototype.readAppMetadataFromCache=function(r){var r={environment:r,clientId:this.clientId},t=this.getAppMetadataFilteredBy(r),r=Object.keys(t).map(function(o){return t[o]}),i=r.length;if(i<1)return null;if(1<i)throw en.createMultipleMatchingAppMetadataInCacheError();return r[0]},n.prototype.isAppMetadataFOCI=function(e){return e=this.readAppMetadataFromCache(e),!(!e||e.familyId!==p0)},n.prototype.matchHomeAccountId=function(e,t){return!(typeof e.homeAccountId!="string"||t!==e.homeAccountId)},n.prototype.matchLocalAccountId=function(e,t){return!(typeof e.localAccountId!="string"||t!==e.localAccountId)},n.prototype.matchUsername=function(e,t){return!(typeof e.username!="string"||t.toLowerCase()!==e.username.toLowerCase())},n.prototype.matchUserAssertionHash=function(e,t){return!(!e.userAssertionHash||t!==e.userAssertionHash)},n.prototype.matchEnvironment=function(e,t){return t=this.getAuthorityMetadataByAlias(t),!!(t&&-1<t.aliases.indexOf(e.environment))},n.prototype.matchCredentialType=function(e,t){return e.credentialType&&t.toLowerCase()===e.credentialType.toLowerCase()},n.prototype.matchClientId=function(e,t){return!(!e.clientId||t!==e.clientId)},n.prototype.matchFamilyId=function(e,t){return!(!e.familyId||t!==e.familyId)},n.prototype.matchRealm=function(e,t){return!(!e.realm||t!==e.realm)},n.prototype.matchNativeAccountId=function(e,t){return!(!e.nativeAccountId||t!==e.nativeAccountId)},n.prototype.matchTarget=function(e,t){return!(e.credentialType!==In.ACCESS_TOKEN&&e.credentialType!==In.ACCESS_TOKEN_WITH_AUTH_SCHEME||!e.target)&&fa.fromString(e.target).containsScopeSet(t)},n.prototype.matchTokenType=function(e,t){return!(!e.tokenType||e.tokenType!==t)},n.prototype.matchKeyId=function(e,t){return!(!e.keyId||e.keyId!==t)},n.prototype.isAppMetadata=function(e){return e.indexOf(YM)!==-1},n.prototype.isAuthorityMetadata=function(e){return e.indexOf(g0.CACHE_KEY)!==-1},n.prototype.generateAuthorityMetadataCacheKey=function(e){return g0.CACHE_KEY+"-"+this.clientId+"-"+e},n.toObject=function(e,t){for(var r in t)e[r]=t[r];return e},n}(),Swe=function(n){function e(){return n!==null&&n.apply(this,arguments)||this}return Ja(e,n),e.prototype.setAccount=function(){throw wn.createUnexpectedError("Storage interface - setAccount() has not been implemented for the cacheStorage interface.")},e.prototype.getAccount=function(){throw wn.createUnexpectedError("Storage interface - getAccount() has not been implemented for the cacheStorage interface.")},e.prototype.setIdTokenCredential=function(){throw wn.createUnexpectedError("Storage interface - setIdTokenCredential() has not been implemented for the cacheStorage interface.")},e.prototype.getIdTokenCredential=function(){throw wn.createUnexpectedError("Storage interface - getIdTokenCredential() has not been implemented for the cacheStorage interface.")},e.prototype.setAccessTokenCredential=function(){throw wn.createUnexpectedError("Storage interface - setAccessTokenCredential() has not been implemented for the cacheStorage interface.")},e.prototype.getAccessTokenCredential=function(){throw wn.createUnexpectedError("Storage interface - getAccessTokenCredential() has not been implemented for the cacheStorage interface.")},e.prototype.setRefreshTokenCredential=function(){throw wn.createUnexpectedError("Storage interface - setRefreshTokenCredential() has not been implemented for the cacheStorage interface.")},e.prototype.getRefreshTokenCredential=function(){throw wn.createUnexpectedError("Storage interface - getRefreshTokenCredential() has not been implemented for the cacheStorage interface.")},e.prototype.setAppMetadata=function(){throw wn.createUnexpectedError("Storage interface - setAppMetadata() has not been implemented for the cacheStorage interface.")},e.prototype.getAppMetadata=function(){throw wn.createUnexpectedError("Storage interface - getAppMetadata() has not been implemented for the cacheStorage interface.")},e.prototype.setServerTelemetry=function(){throw wn.createUnexpectedError("Storage interface - setServerTelemetry() has not been implemented for the cacheStorage interface.")},e.prototype.getServerTelemetry=function(){throw wn.createUnexpectedError("Storage interface - getServerTelemetry() has not been implemented for the cacheStorage interface.")},e.prototype.setAuthorityMetadata=function(){throw wn.createUnexpectedError("Storage interface - setAuthorityMetadata() has not been implemented for the cacheStorage interface.")},e.prototype.getAuthorityMetadata=function(){throw wn.createUnexpectedError("Storage interface - getAuthorityMetadata() has not been implemented for the cacheStorage interface.")},e.prototype.getAuthorityMetadataKeys=function(){throw wn.createUnexpectedError("Storage interface - getAuthorityMetadataKeys() has not been implemented for the cacheStorage interface.")},e.prototype.setThrottlingCache=function(){throw wn.createUnexpectedError("Storage interface - setThrottlingCache() has not been implemented for the cacheStorage interface.")},e.prototype.getThrottlingCache=function(){throw wn.createUnexpectedError("Storage interface - getThrottlingCache() has not been implemented for the cacheStorage interface.")},e.prototype.removeItem=function(){throw wn.createUnexpectedError("Storage interface - removeItem() has not been implemented for the cacheStorage interface.")},e.prototype.containsKey=function(){throw wn.createUnexpectedError("Storage interface - containsKey() has not been implemented for the cacheStorage interface.")},e.prototype.getKeys=function(){throw wn.createUnexpectedError("Storage interface - getKeys() has not been implemented for the cacheStorage interface.")},e.prototype.getAccountKeys=function(){throw wn.createUnexpectedError("Storage interface - getAccountKeys() has not been implemented for the cacheStorage interface.")},e.prototype.getTokenKeys=function(){throw wn.createUnexpectedError("Storage interface - getTokenKeys() has not been implemented for the cacheStorage interface.")},e.prototype.clear=function(){return zn(this,void 0,void 0,function(){return jn(this,function(t){throw wn.createUnexpectedError("Storage interface - clear() has not been implemented for the cacheStorage interface.")})})},e.prototype.updateCredentialCacheKey=function(){throw wn.createUnexpectedError("Storage interface - updateCredentialCacheKey() has not been implemented for the cacheStorage interface.")},e}(es),Cwe=300,qj={tokenRenewalOffsetSeconds:Cwe,preventCorsPreflight:!1},Awe={loggerCallback:function(){},piiLoggingEnabled:!1,logLevel:No.Info,correlationId:Le.EMPTY_STRING},Iwe={claimsBasedCachingEnabled:!0},Pwe={sendGetRequestAsync:function(){return zn(this,void 0,void 0,function(){return jn(this,function(n){throw wn.createUnexpectedError("Network interface - sendGetRequestAsync() has not been implemented")})})},sendPostRequestAsync:function(){return zn(this,void 0,void 0,function(){return jn(this,function(n){throw wn.createUnexpectedError("Network interface - sendPostRequestAsync() has not been implemented")})})}},Mwe={sku:Le.SKU,version:ZM,cpu:Le.EMPTY_STRING,os:Le.EMPTY_STRING},Rwe={clientSecret:Le.EMPTY_STRING,clientAssertion:void 0},kwe={azureCloudInstance:d0.None,tenant:""+Le.DEFAULT_COMMON_TENANT},Owe={application:{appName:"",appVersion:""}};function Lwe(x){var e=x.authOptions,t=x.systemOptions,C=x.loggerOptions,r=x.cacheOptions,i=x.storageInterface,o=x.networkInterface,a=x.cryptoInterface,l=x.clientCredentials,h=x.libraryInfo,p=x.telemetry,g=x.serverTelemetryManager,_=x.persistencePlugin,x=x.serializableCache,C=Gr(Gr({},Awe),C);return{authOptions:Nwe(e),systemOptions:Gr(Gr({},qj),t),loggerOptions:C,cacheOptions:Gr(Gr({},Iwe),r),storageInterface:i||new Swe(e.clientId,TE,new KM(C)),networkInterface:o||Pwe,cryptoInterface:a||TE,clientCredentials:l||Rwe,libraryInfo:Gr(Gr({},Mwe),h),telemetry:Gr(Gr({},Owe),p),serverTelemetryManager:g||null,persistencePlugin:_||null,serializableCache:x||null}}function Nwe(n){return Gr({clientCapabilities:[],azureCloudOptions:kwe,skipAuthorityMetadataCache:!1},n)}var Ps,nt,CE,XM,Wf=function(n){function e(t,r,i){return t=n.call(this,t,r,i)||this,t.name="ServerError",Object.setPrototypeOf(t,e.prototype),t}return Ja(e,n),e}(wn),AE=function(){function n(){}return n.generateThrottlingStorageKey=function(e){return m0.THROTTLING_PREFIX+"."+JSON.stringify(e)},n.preProcess=function(e,i){var r,i=n.generateThrottlingStorageKey(i),o=e.getThrottlingCache(i);if(o){if(!(o.throttleTime<Date.now()))throw new Wf(((r=o.errorCodes)==null?void 0:r.join(" "))||Le.EMPTY_STRING,o.errorMessage,o.subError);e.removeItem(i)}},n.postProcess=function(e,t,r){(n.checkResponseStatus(r)||n.checkResponseForRetryAfter(r))&&(r={throttleTime:n.calculateThrottleTime(parseInt(r.headers[Is.RETRY_AFTER])),error:r.body.error,errorCodes:r.body.error_codes,errorMessage:r.body.error_description,subError:r.body.suberror},e.setThrottlingCache(n.generateThrottlingStorageKey(t),r))},n.checkResponseStatus=function(e){return e.status===429||500<=e.status&&e.status<600},n.checkResponseForRetryAfter=function(e){return!!e.headers&&e.headers.hasOwnProperty(Is.RETRY_AFTER)&&(e.status<200||300<=e.status)},n.calculateThrottleTime=function(t){var t=t<=0?0:t,r=Date.now()/1e3;return Math.floor(1e3*Math.min(r+(t||m0.DEFAULT_THROTTLE_TIME_SECONDS),r+m0.DEFAULT_MAX_THROTTLE_TIME_SECONDS))},n.removeThrottle=function(e,t,r,i){t={clientId:t,authority:r.authority,scopes:r.scopes,homeAccountIdentifier:i,claims:r.claims,authenticationScheme:r.authenticationScheme,resourceRequestMethod:r.resourceRequestMethod,resourceRequestUri:r.resourceRequestUri,shrClaims:r.shrClaims,sshKid:r.sshKid},i=this.generateThrottlingStorageKey(t),e.removeItem(i)},n}(),Dwe=function(){function n(e,t){this.networkClient=e,this.cacheManager=t}return n.prototype.sendPostRequest=function(e,t,r){return zn(this,void 0,void 0,function(){var i,o;return jn(this,function(a){switch(a.label){case 0:AE.preProcess(this.cacheManager,e),a.label=1;case 1:return a.trys.push([1,3,,4]),[4,this.networkClient.sendPostRequestAsync(t,r)];case 2:return i=a.sent(),[3,4];case 3:throw(o=a.sent())instanceof wn?o:en.createNetworkError(t,o);case 4:return AE.postProcess(this.cacheManager,e,i),[2,i]}})})},n}(),Yf=(function(n){n.HOME_ACCOUNT_ID="home_account_id",n.UPN="UPN"}(Ps=Ps||{}),function(){function n(){}return n.validateRedirectUri=function(e){if(Kt.isEmpty(e))throw yi.createRedirectUriEmptyError()},n.validatePrompt=function(e){var t,r=[];for(t in da)r.push(da[t]);if(r.indexOf(e)<0)throw yi.createInvalidPromptError(e)},n.validateClaims=function(e){try{JSON.parse(e)}catch{throw yi.createInvalidClaimsRequestError()}},n.validateCodeChallengeParams=function(e,t){if(Kt.isEmpty(e)||Kt.isEmpty(t))throw yi.createInvalidCodeChallengeParamsError();this.validateCodeChallengeMethod(t)},n.validateCodeChallengeMethod=function(e){if([Vj.PLAIN,Vj.S256].indexOf(e)<0)throw yi.createInvalidCodeChallengeMethodError()},n.sanitizeEQParams=function(e,t){return e?(t.forEach(function(r,i){e[i]&&delete e[i]}),Object.fromEntries(Object.entries(e).filter(function(r){return r[1]!==""}))):{}},n}()),y0=function(){function n(){this.parameters=new Map}return n.prototype.addResponseTypeCode=function(){this.parameters.set(Wn.RESPONSE_TYPE,encodeURIComponent(Le.CODE_RESPONSE_TYPE))},n.prototype.addResponseTypeForTokenAndIdToken=function(){this.parameters.set(Wn.RESPONSE_TYPE,encodeURIComponent(Le.TOKEN_RESPONSE_TYPE+" "+Le.ID_TOKEN_RESPONSE_TYPE))},n.prototype.addResponseMode=function(e){this.parameters.set(Wn.RESPONSE_MODE,encodeURIComponent(e||bE.QUERY))},n.prototype.addNativeBroker=function(){this.parameters.set(Wn.NATIVE_BROKER,encodeURIComponent("1"))},n.prototype.addScopes=function(e,t){t=(t=t===void 0?!0:t)?vE(e||[],f0):e||[],e=new fa(t),this.parameters.set(Wn.SCOPE,encodeURIComponent(e.printScopes()))},n.prototype.addClientId=function(e){this.parameters.set(Wn.CLIENT_ID,encodeURIComponent(e))},n.prototype.addRedirectUri=function(e){Yf.validateRedirectUri(e),this.parameters.set(Wn.REDIRECT_URI,encodeURIComponent(e))},n.prototype.addPostLogoutRedirectUri=function(e){Yf.validateRedirectUri(e),this.parameters.set(Wn.POST_LOGOUT_URI,encodeURIComponent(e))},n.prototype.addIdTokenHint=function(e){this.parameters.set(Wn.ID_TOKEN_HINT,encodeURIComponent(e))},n.prototype.addDomainHint=function(e){this.parameters.set(u0.DOMAIN_HINT,encodeURIComponent(e))},n.prototype.addLoginHint=function(e){this.parameters.set(u0.LOGIN_HINT,encodeURIComponent(e))},n.prototype.addCcsUpn=function(e){this.parameters.set(Is.CCS_HEADER,encodeURIComponent("UPN:"+e))},n.prototype.addCcsOid=function(e){this.parameters.set(Is.CCS_HEADER,encodeURIComponent("Oid:"+e.uid+"@"+e.utid))},n.prototype.addSid=function(e){this.parameters.set(u0.SID,encodeURIComponent(e))},n.prototype.addClaims=function(e,t){e=this.addClientCapabilitiesToClaims(e,t),Yf.validateClaims(e),this.parameters.set(Wn.CLAIMS,encodeURIComponent(e))},n.prototype.addCorrelationId=function(e){this.parameters.set(Wn.CLIENT_REQUEST_ID,encodeURIComponent(e))},n.prototype.addLibraryInfo=function(e){this.parameters.set(Wn.X_CLIENT_SKU,e.sku),this.parameters.set(Wn.X_CLIENT_VER,e.version),e.os&&this.parameters.set(Wn.X_CLIENT_OS,e.os),e.cpu&&this.parameters.set(Wn.X_CLIENT_CPU,e.cpu)},n.prototype.addApplicationTelemetry=function(e){e!=null&&e.appName&&this.parameters.set(Wn.X_APP_NAME,e.appName),e!=null&&e.appVersion&&this.parameters.set(Wn.X_APP_VER,e.appVersion)},n.prototype.addPrompt=function(e){Yf.validatePrompt(e),this.parameters.set(""+Wn.PROMPT,encodeURIComponent(e))},n.prototype.addState=function(e){Kt.isEmpty(e)||this.parameters.set(Wn.STATE,encodeURIComponent(e))},n.prototype.addNonce=function(e){this.parameters.set(Wn.NONCE,encodeURIComponent(e))},n.prototype.addCodeChallengeParams=function(e,t){if(Yf.validateCodeChallengeParams(e,t),!e||!t)throw yi.createInvalidCodeChallengeParamsError();this.parameters.set(Wn.CODE_CHALLENGE,encodeURIComponent(e)),this.parameters.set(Wn.CODE_CHALLENGE_METHOD,encodeURIComponent(t))},n.prototype.addAuthorizationCode=function(e){this.parameters.set(Wn.CODE,encodeURIComponent(e))},n.prototype.addDeviceCode=function(e){this.parameters.set(Wn.DEVICE_CODE,encodeURIComponent(e))},n.prototype.addRefreshToken=function(e){this.parameters.set(Wn.REFRESH_TOKEN,encodeURIComponent(e))},n.prototype.addCodeVerifier=function(e){this.parameters.set(Wn.CODE_VERIFIER,encodeURIComponent(e))},n.prototype.addClientSecret=function(e){this.parameters.set(Wn.CLIENT_SECRET,encodeURIComponent(e))},n.prototype.addClientAssertion=function(e){Kt.isEmpty(e)||this.parameters.set(Wn.CLIENT_ASSERTION,encodeURIComponent(e))},n.prototype.addClientAssertionType=function(e){Kt.isEmpty(e)||this.parameters.set(Wn.CLIENT_ASSERTION_TYPE,encodeURIComponent(e))},n.prototype.addOboAssertion=function(e){this.parameters.set(Wn.OBO_ASSERTION,encodeURIComponent(e))},n.prototype.addRequestTokenUse=function(e){this.parameters.set(Wn.REQUESTED_TOKEN_USE,encodeURIComponent(e))},n.prototype.addGrantType=function(e){this.parameters.set(Wn.GRANT_TYPE,encodeURIComponent(e))},n.prototype.addClientInfo=function(){this.parameters.set(Twe,"1")},n.prototype.addExtraQueryParameters=function(e){var t=this,r=Yf.sanitizeEQParams(e,this.parameters);Object.keys(r).forEach(function(i){t.parameters.set(i,e[i])})},n.prototype.addClientCapabilitiesToClaims=function(e,t){var r;if(e)try{r=JSON.parse(e)}catch{throw yi.createInvalidClaimsRequestError()}else r={};return t&&0<t.length&&(r.hasOwnProperty(Em.ACCESS_TOKEN)||(r[Em.ACCESS_TOKEN]={}),r[Em.ACCESS_TOKEN][Em.XMS_CC]={values:t}),JSON.stringify(r)},n.prototype.addUsername=function(e){this.parameters.set(xE.username,encodeURIComponent(e))},n.prototype.addPassword=function(e){this.parameters.set(xE.password,encodeURIComponent(e))},n.prototype.addPopToken=function(e){Kt.isEmpty(e)||(this.parameters.set(Wn.TOKEN_TYPE,qr.POP),this.parameters.set(Wn.REQ_CNF,encodeURIComponent(e)))},n.prototype.addSshJwk=function(e){Kt.isEmpty(e)||(this.parameters.set(Wn.TOKEN_TYPE,qr.SSH),this.parameters.set(Wn.REQ_CNF,encodeURIComponent(e)))},n.prototype.addServerTelemetry=function(e){this.parameters.set(Wn.X_CLIENT_CURR_TELEM,e.generateCurrentRequestHeaderValue()),this.parameters.set(Wn.X_CLIENT_LAST_TELEM,e.generateLastRequestHeaderValue())},n.prototype.addThrottling=function(){this.parameters.set(Wn.X_MS_LIB_CAPABILITY,m0.X_MS_LIB_CAPABILITY_VALUE)},n.prototype.addLogoutHint=function(e){this.parameters.set(Wn.LOGOUT_HINT,encodeURIComponent(e))},n.prototype.createQueryString=function(){var e=new Array;return this.parameters.forEach(function(t,r){e.push(r+"="+t)}),e.join("&")},n}(),QM=function(){function n(e,t){this.config=Lwe(e),this.logger=new KM(this.config.loggerOptions,Gj,ZM),this.cryptoUtils=this.config.cryptoInterface,this.cacheManager=this.config.storageInterface,this.networkClient=this.config.networkInterface,this.networkManager=new Dwe(this.networkClient,this.cacheManager),this.serverTelemetryManager=this.config.serverTelemetryManager,this.authority=this.config.authOptions.authority,this.performanceClient=t}return n.prototype.createTokenRequestHeaders=function(e){var t={};if(t[Is.CONTENT_TYPE]=Le.URL_FORM_CONTENT_TYPE,!this.config.systemOptions.preventCorsPreflight&&e)switch(e.type){case Ps.HOME_ACCOUNT_ID:try{var r=Sm(e.credential);t[Is.CCS_HEADER]="Oid:"+r.uid+"@"+r.utid}catch(i){this.logger.verbose("Could not parse home account ID for CCS Header: "+i)}break;case Ps.UPN:t[Is.CCS_HEADER]="UPN: "+e.credential}return t},n.prototype.executePostToTokenEndpoint=function(e,t,r,i){return zn(this,void 0,void 0,function(){var o;return jn(this,function(a){switch(a.label){case 0:return[4,this.networkManager.sendPostRequest(i,e,{body:t,headers:r})];case 1:return o=a.sent(),this.config.serverTelemetryManager&&o.status<500&&o.status!==429&&this.config.serverTelemetryManager.clearTelemetryCache(),[2,o]}})})},n.prototype.updateAuthority=function(e){if(!e.discoveryComplete())throw en.createEndpointDiscoveryIncompleteError("Updated authority has not completed endpoint discovery.");this.authority=e},n.prototype.createTokenQueryParameters=function(e){var t=new y0;return e.tokenQueryParameters&&t.addExtraQueryParameters(e.tokenQueryParameters),t.createQueryString()},n}(),JM=function(){function n(){}return n.prototype.generateAccountId=function(){return n.generateAccountIdForCacheKey(this.homeAccountId,this.environment)},n.prototype.generateCredentialId=function(){return n.generateCredentialIdForCacheKey(this.credentialType,this.clientId,this.realm,this.familyId)},n.prototype.generateTarget=function(){return n.generateTargetForCacheKey(this.target)},n.prototype.generateCredentialKey=function(){return n.generateCredentialCacheKey(this.homeAccountId,this.environment,this.credentialType,this.clientId,this.realm,this.target,this.familyId,this.tokenType,this.requestedClaimsHash)},n.prototype.generateType=function(){switch(this.credentialType){case In.ID_TOKEN:return vu.ID_TOKEN;case In.ACCESS_TOKEN:case In.ACCESS_TOKEN_WITH_AUTH_SCHEME:return vu.ACCESS_TOKEN;case In.REFRESH_TOKEN:return vu.REFRESH_TOKEN;default:throw en.createUnexpectedCredentialTypeError()}},n.generateCredentialCacheKey=function(e,t,r,i,o,a,l,h,p){return[this.generateAccountIdForCacheKey(e,t),this.generateCredentialIdForCacheKey(r,i,o,l),this.generateTargetForCacheKey(a),this.generateClaimsHashForCacheKey(p),this.generateSchemeForCacheKey(h)].join(Eo.CACHE_KEY_SEPARATOR).toLowerCase()},n.generateAccountIdForCacheKey=function(e,t){return[e,t].join(Eo.CACHE_KEY_SEPARATOR).toLowerCase()},n.generateCredentialIdForCacheKey=function(e,t,r,i){return[e,e===In.REFRESH_TOKEN&&i||t,r||Le.EMPTY_STRING].join(Eo.CACHE_KEY_SEPARATOR).toLowerCase()},n.generateTargetForCacheKey=function(e){return(e||Le.EMPTY_STRING).toLowerCase()},n.generateClaimsHashForCacheKey=function(e){return(e||Le.EMPTY_STRING).toLowerCase()},n.generateSchemeForCacheKey=function(e){return e&&e.toLowerCase()!==qr.BEARER.toLowerCase()?e.toLowerCase():Le.EMPTY_STRING},n}(),Kf=function(n){function e(){return n!==null&&n.apply(this,arguments)||this}return Ja(e,n),e.createIdTokenEntity=function(t,r,i,o,a){var l=new e;return l.credentialType=In.ID_TOKEN,l.homeAccountId=t,l.environment=r,l.clientId=o,l.secret=i,l.realm=a,l},e.isIdTokenEntity=function(t){return!!t&&t.hasOwnProperty("homeAccountId")&&t.hasOwnProperty("environment")&&t.hasOwnProperty("credentialType")&&t.hasOwnProperty("realm")&&t.hasOwnProperty("clientId")&&t.hasOwnProperty("secret")&&t.credentialType===In.ID_TOKEN},e}(JM),ec=function(){function n(){}return n.nowSeconds=function(){return Math.round(new Date().getTime()/1e3)},n.isTokenExpired=function(e,t){return(Number(e)||0)<n.nowSeconds()+t},n.wasClockTurnedBack=function(e){return Number(e)>n.nowSeconds()},n.delay=function(e,t){return new Promise(function(r){return setTimeout(function(){return r(t)},e)})},n}(),Zf=function(n){function e(){return n!==null&&n.apply(this,arguments)||this}return Ja(e,n),e.createAccessTokenEntity=function(ce,r,i,o,a,l,h,p,g,_,x,C,M,L,F){var z,ee=new e,ce=(ee.homeAccountId=ce,ee.credentialType=In.ACCESS_TOKEN,ee.secret=i,ec.nowSeconds());if(ee.cachedAt=ce.toString(),ee.expiresOn=h.toString(),ee.extendedExpiresOn=p.toString(),_&&(ee.refreshOn=_.toString()),ee.environment=r,ee.clientId=o,ee.realm=a,ee.target=l,ee.userAssertionHash=C,ee.tokenType=Kt.isEmpty(x)?qr.BEARER:x,L&&(ee.requestedClaims=L,ee.requestedClaimsHash=F),((ce=ee.tokenType)==null?void 0:ce.toLowerCase())!==qr.BEARER.toLowerCase())switch(ee.credentialType=In.ACCESS_TOKEN_WITH_AUTH_SCHEME,ee.tokenType){case qr.POP:var se=ml.extractTokenClaims(i,g);if((z=se==null?void 0:se.cnf)==null||!z.kid)throw en.createTokenClaimsRequiredError();ee.keyId=se.cnf.kid;break;case qr.SSH:ee.keyId=M}return ee},e.isAccessTokenEntity=function(t){return!!t&&t.hasOwnProperty("homeAccountId")&&t.hasOwnProperty("environment")&&t.hasOwnProperty("credentialType")&&t.hasOwnProperty("realm")&&t.hasOwnProperty("clientId")&&t.hasOwnProperty("secret")&&t.hasOwnProperty("target")&&(t.credentialType===In.ACCESS_TOKEN||t.credentialType===In.ACCESS_TOKEN_WITH_AUTH_SCHEME)},e}(JM),Cm=function(n){function e(){return n!==null&&n.apply(this,arguments)||this}return Ja(e,n),e.createRefreshTokenEntity=function(t,r,i,o,a,l){var h=new e;return h.clientId=o,h.credentialType=In.REFRESH_TOKEN,h.environment=r,h.homeAccountId=t,h.secret=i,h.userAssertionHash=l,a&&(h.familyId=a),h},e.isRefreshTokenEntity=function(t){return!!t&&t.hasOwnProperty("homeAccountId")&&t.hasOwnProperty("environment")&&t.hasOwnProperty("credentialType")&&t.hasOwnProperty("clientId")&&t.hasOwnProperty("secret")&&t.credentialType===In.REFRESH_TOKEN},e}(JM),$j=["interaction_required","consent_required","login_required"],Fwe=["message_only","additional_action","basic_action","user_password_expired","consent_required"],Am={noTokensFoundError:{code:"no_tokens_found",desc:"No refresh token found in the cache. Please sign-in."},native_account_unavailable:{code:"native_account_unavailable",desc:"The requested account is not available in the native broker. It may have been deleted or logged out. Please sign-in again using an interactive API."}},tc=function(n){function e(t,r,i,o,a,l,h){return t=n.call(this,t,r,i)||this,Object.setPrototypeOf(t,e.prototype),t.timestamp=o||Le.EMPTY_STRING,t.traceId=a||Le.EMPTY_STRING,t.correlationId=l||Le.EMPTY_STRING,t.claims=h||Le.EMPTY_STRING,t.name="InteractionRequiredAuthError",t}return Ja(e,n),e.isInteractionRequiredError=function(o,r,a){var o=!!o&&-1<$j.indexOf(o),a=!!a&&-1<Fwe.indexOf(a),l=!!r&&$j.some(function(h){return-1<r.indexOf(h)});return o||l||a},e.createNoTokensFoundError=function(){return new e(Am.noTokensFoundError.code,Am.noTokensFoundError.desc)},e.createNativeAccountUnavailableError=function(){return new e(Am.native_account_unavailable.code,Am.native_account_unavailable.desc)},e}(wn),IE=function(n,e,t,r,i){this.account=n||null,this.idToken=e||null,this.accessToken=t||null,this.refreshToken=r||null,this.appMetadata=i||null},bu=function(){function n(){}return n.setRequestState=function(e,t,r){return e=n.generateLibraryState(e,r),Kt.isEmpty(t)?e:""+e+Le.RESOURCE_DELIM+t},n.generateLibraryState=function(e,t){var r;if(e)return r={id:e.createNewGuid()},t&&(r.meta=t),t=JSON.stringify(r),e.base64Encode(t);throw en.createNoCryptoObjectError("generateLibraryState")},n.parseRequestState=function(e,t){if(!e)throw en.createNoCryptoObjectError("parseRequestState");if(Kt.isEmpty(t))throw en.createInvalidStateError(t,"Null, undefined or empty state");try{var r=t.split(Le.RESOURCE_DELIM),i=r[0],o=1<r.length?r.slice(1).join(Le.RESOURCE_DELIM):Le.EMPTY_STRING,a=e.base64Decode(i),l=JSON.parse(a);return{userRequestState:Kt.isEmpty(o)?Le.EMPTY_STRING:o,libraryState:l}}catch(h){throw en.createInvalidStateError(t,h)}},n}(),wr=function(){function n(e){if(this._urlString=e,Kt.isEmpty(this._urlString))throw yi.createUrlEmptyError();Kt.isEmpty(this.getHash())&&(this._urlString=n.canonicalizeUri(e))}return Object.defineProperty(n.prototype,"urlString",{get:function(){return this._urlString},enumerable:!1,configurable:!0}),n.canonicalizeUri=function(e){var t;return e&&(t=e.toLowerCase(),Kt.endsWith(t,"?")?t=t.slice(0,-1):Kt.endsWith(t,"?/")&&(t=t.slice(0,-2)),Kt.endsWith(t,"/")||(t+="/"),t)},n.prototype.validateAsUri=function(){var e;try{e=this.getUrlComponents()}catch(t){throw yi.createUrlParseError(t)}if(!e.HostNameAndPort||!e.PathSegments)throw yi.createUrlParseError("Given url string: "+this.urlString);if(!e.Protocol||e.Protocol.toLowerCase()!=="https:")throw yi.createInsecureAuthorityUriError(this.urlString)},n.appendQueryString=function(e,t){return Kt.isEmpty(t)?e:e.indexOf("?")<0?e+"?"+t:e+"&"+t},n.removeHashFromUrl=function(e){return n.canonicalizeUri(e.split("#")[0])},n.prototype.replaceTenantPath=function(e){var t=this.getUrlComponents(),r=t.PathSegments;return!e||r.length===0||r[0]!==$f.COMMON&&r[0]!==$f.ORGANIZATIONS||(r[0]=e),n.constructAuthorityUriFromObject(t)},n.prototype.getHash=function(){return n.parseHash(this.urlString)},n.prototype.getUrlComponents=function(){var e,t=RegExp("^(([^:/?#]+):)?(//([^/?#]*))?([^?#]*)(\\?([^#]*))?(#(.*))?"),t=this.urlString.match(t);if(t)return e=(e=(t={Protocol:t[1],HostNameAndPort:t[4],AbsolutePath:t[5],QueryString:t[7]}).AbsolutePath.split("/")).filter(function(r){return r&&0<r.length}),t.PathSegments=e,!Kt.isEmpty(t.QueryString)&&t.QueryString.endsWith("/")&&(t.QueryString=t.QueryString.substring(0,t.QueryString.length-1)),t;throw yi.createUrlParseError("Given url string: "+this.urlString)},n.getDomainFromUrl=function(e){var t=RegExp("^([^:/?#]+://)?([^/?#]*)"),t=e.match(t);if(t)return t[2];throw yi.createUrlParseError("Given url string: "+e)},n.getAbsoluteUrl=function(e,t){return e[0]===Le.FORWARD_SLASH?(t=new n(t).getUrlComponents()).Protocol+"//"+t.HostNameAndPort+e:e},n.parseHash=function(e){var t=e.indexOf("#"),r=e.indexOf("#/");return-1<r?e.substring(r+2):-1<t?e.substring(t+1):Le.EMPTY_STRING},n.parseQueryString=function(e){var t=e.indexOf("?"),r=e.indexOf("/?");return-1<r?e.substring(r+2):-1<t?e.substring(t+1):Le.EMPTY_STRING},n.constructAuthorityUriFromObject=function(e){return new n(e.Protocol+"//"+e.HostNameAndPort+"/"+e.PathSegments.join("/"))},n.getDeserializedHash=function(r){if(Kt.isEmpty(r))return{};var t=n.parseHash(r),r=Kt.queryStringToObject(Kt.isEmpty(t)?r:t);if(r)return r;throw en.createHashNotDeserializedError(JSON.stringify(r))},n.getDeserializedQueryString=function(r){if(Kt.isEmpty(r))return{};var t=n.parseQueryString(r),r=Kt.queryStringToObject(Kt.isEmpty(t)?r:t);if(r)return r;throw en.createHashNotDeserializedError(JSON.stringify(r))},n.hashContainsKnownProperties=function(e){return!(Kt.isEmpty(e)||e.indexOf("=")<0||!((e=n.getDeserializedHash(e)).code||e.error_description||e.error||e.state))},n}(),Bwe=(function(n){n.AcquireTokenByCode="acquireTokenByCode",n.AcquireTokenByRefreshToken="acquireTokenByRefreshToken",n.AcquireTokenSilent="acquireTokenSilent",n.AcquireTokenSilentAsync="acquireTokenSilentAsync",n.AcquireTokenPopup="acquireTokenPopup",n.CryptoOptsGetPublicKeyThumbprint="cryptoOptsGetPublicKeyThumbprint",n.CryptoOptsSignJwt="cryptoOptsSignJwt",n.SilentCacheClientAcquireToken="silentCacheClientAcquireToken",n.SilentIframeClientAcquireToken="silentIframeClientAcquireToken",n.SilentRefreshClientAcquireToken="silentRefreshClientAcquireToken",n.SsoSilent="ssoSilent",n.StandardInteractionClientGetDiscoveredAuthority="standardInteractionClientGetDiscoveredAuthority",n.FetchAccountIdWithNativeBroker="fetchAccountIdWithNativeBroker",n.NativeInteractionClientAcquireToken="nativeInteractionClientAcquireToken",n.BaseClientCreateTokenRequestHeaders="baseClientCreateTokenRequestHeaders",n.BrokerHandhshake="brokerHandshake",n.AcquireTokenByRefreshTokenInBroker="acquireTokenByRefreshTokenInBroker",n.AcquireTokenByBroker="acquireTokenByBroker",n.RefreshTokenClientExecuteTokenRequest="refreshTokenClientExecuteTokenRequest",n.RefreshTokenClientAcquireToken="refreshTokenClientAcquireToken",n.RefreshTokenClientAcquireTokenWithCachedRefreshToken="refreshTokenClientAcquireTokenWithCachedRefreshToken",n.RefreshTokenClientAcquireTokenByRefreshToken="refreshTokenClientAcquireTokenByRefreshToken",n.RefreshTokenClientCreateTokenRequestBody="refreshTokenClientCreateTokenRequestBody",n.AcquireTokenFromCache="acquireTokenFromCache",n.AcquireTokenBySilentIframe="acquireTokenBySilentIframe",n.InitializeBaseRequest="initializeBaseRequest",n.InitializeSilentRequest="initializeSilentRequest",n.InitializeClientApplication="initializeClientApplication",n.SilentIframeClientTokenHelper="silentIframeClientTokenHelper",n.SilentHandlerInitiateAuthRequest="silentHandlerInitiateAuthRequest",n.SilentHandlerMonitorIframeForHash="silentHandlerMonitorIframeForHash",n.SilentHandlerLoadFrame="silentHandlerLoadFrame",n.StandardInteractionClientCreateAuthCodeClient="standardInteractionClientCreateAuthCodeClient",n.StandardInteractionClientGetClientConfiguration="standardInteractionClientGetClientConfiguration",n.StandardInteractionClientInitializeAuthorizationRequest="standardInteractionClientInitializeAuthorizationRequest",n.StandardInteractionClientInitializeAuthorizationCodeRequest="standardInteractionClientInitializeAuthorizationCodeRequest",n.GetAuthCodeUrl="getAuthCodeUrl",n.HandleCodeResponseFromServer="handleCodeResponseFromServer",n.HandleCodeResponseFromHash="handleCodeResponseFromHash",n.UpdateTokenEndpointAuthority="updateTokenEndpointAuthority",n.AuthClientAcquireToken="authClientAcquireToken",n.AuthClientExecuteTokenRequest="authClientExecuteTokenRequest",n.AuthClientCreateTokenRequestBody="authClientCreateTokenRequestBody",n.AuthClientCreateQueryString="authClientCreateQueryString",n.PopTokenGenerateCnf="popTokenGenerateCnf",n.PopTokenGenerateKid="popTokenGenerateKid",n.HandleServerTokenResponse="handleServerTokenResponse",n.AuthorityFactoryCreateDiscoveredInstance="authorityFactoryCreateDiscoveredInstance",n.AuthorityResolveEndpointsAsync="authorityResolveEndpointsAsync",n.AuthorityGetCloudDiscoveryMetadataFromNetwork="authorityGetCloudDiscoveryMetadataFromNetwork",n.AuthorityUpdateCloudDiscoveryMetadata="authorityUpdateCloudDiscoveryMetadata",n.AuthorityGetEndpointMetadataFromNetwork="authorityGetEndpointMetadataFromNetwork",n.AuthorityUpdateEndpointMetadata="authorityUpdateEndpointMetadata",n.AuthorityUpdateMetadataWithRegionalInformation="authorityUpdateMetadataWithRegionalInformation",n.RegionDiscoveryDetectRegion="regionDiscoveryDetectRegion",n.RegionDiscoveryGetRegionFromIMDS="regionDiscoveryGetRegionFromIMDS",n.RegionDiscoveryGetCurrentVersion="regionDiscoveryGetCurrentVersion",n.AcquireTokenByCodeAsync="acquireTokenByCodeAsync",n.GetEndpointMetadataFromNetwork="getEndpointMetadataFromNetwork",n.GetCloudDiscoveryMetadataFromNetworkMeasurement="getCloudDiscoveryMetadataFromNetworkMeasurement",n.HandleRedirectPromiseMeasurement="handleRedirectPromiseMeasurement",n.UpdateCloudDiscoveryMetadataMeasurement="updateCloudDiscoveryMetadataMeasurement",n.UsernamePasswordClientAcquireToken="usernamePasswordClientAcquireToken",n.NativeMessageHandlerHandshake="nativeMessageHandlerHandshake",n.ClearTokensAndKeysWithClaims="clearTokensAndKeysWithClaims"}(nt=nt||{}),function(n){n[n.NotStarted=0]="NotStarted",n[n.InProgress=1]="InProgress",n[n.Completed=2]="Completed"}(CE=CE||{}),new Set(["accessTokenSize","durationMs","idTokenSize","matsSilentStatus","matsHttpStatus","refreshTokenSize","queuedTimeMs","startTimeMs","status"])),Im=(function(n){n.SW="sw",n.UHW="uhw"}(XM=XM||{}),function(){function n(e,t){this.cryptoUtils=e,this.performanceClient=t}return n.prototype.generateCnf=function(e){var t;return zn(this,void 0,void 0,function(){var r,i;return jn(this,function(o){switch(o.label){case 0:return(t=this.performanceClient)!=null&&t.addQueueMeasurement(nt.PopTokenGenerateCnf,e.correlationId),(t=this.performanceClient)!=null&&t.setPreQueueTime(nt.PopTokenGenerateKid,e.correlationId),[4,this.generateKid(e)];case 1:return i=o.sent(),r=this.cryptoUtils.base64Encode(JSON.stringify(i)),i={kid:i.kid,reqCnfString:r},[4,this.cryptoUtils.hashString(r)];case 2:return[2,(i.reqCnfHash=o.sent(),i)]}})})},n.prototype.generateKid=function(e){var t;return zn(this,void 0,void 0,function(){return jn(this,function(r){switch(r.label){case 0:return(t=this.performanceClient)!=null&&t.addQueueMeasurement(nt.PopTokenGenerateKid,e.correlationId),[4,this.cryptoUtils.getPublicKeyThumbprint(e)];case 1:return[2,{kid:r.sent(),xms_ksl:XM.SW}]}})})},n.prototype.signPopToken=function(e,t,r){return zn(this,void 0,void 0,function(){return jn(this,function(i){return[2,this.signPayload(e,t,r)]})})},n.prototype.signPayload=function(e,t,r,i){return zn(this,void 0,void 0,function(){var o,a,l,h;return jn(this,function(p){switch(p.label){case 0:return o=r.resourceRequestMethod,h=r.resourceRequestUri,a=r.shrClaims,l=r.shrNonce,h=h?new wr(h):void 0,h=h==null?void 0:h.getUrlComponents(),[4,this.cryptoUtils.signJwt(Gr({at:e,ts:ec.nowSeconds(),m:o==null?void 0:o.toUpperCase(),u:h==null?void 0:h.HostNameAndPort,nonce:l||this.cryptoUtils.createNewGuid(),p:h==null?void 0:h.AbsolutePath,q:h!=null&&h.QueryString?[[],h.QueryString]:void 0,client_claims:a||void 0},i),t,r.correlationId)];case 1:return[2,p.sent()]}})})},n}()),eR=function(){function n(){}return n.prototype.generateAppMetadataKey=function(){return n.generateAppMetadataCacheKey(this.environment,this.clientId)},n.generateAppMetadataCacheKey=function(e,t){return[YM,e,t].join(Eo.CACHE_KEY_SEPARATOR).toLowerCase()},n.createAppMetadataEntity=function(e,t,r){var i=new n;return i.clientId=e,i.environment=t,r&&(i.familyId=r),i},n.isAppMetadataEntity=function(e,t){return!!t&&e.indexOf(YM)===0&&t.hasOwnProperty("clientId")&&t.hasOwnProperty("environment")},n}(),Uwe=function(){function n(e,t){this.cache=e,this.hasChanged=t}return Object.defineProperty(n.prototype,"cacheHasChanged",{get:function(){return this.hasChanged},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"tokenCache",{get:function(){return this.cache},enumerable:!1,configurable:!0}),n}(),PE=function(){function n(e,t,r,i,o,a,l){this.clientId=e,this.cacheStorage=t,this.cryptoObj=r,this.logger=i,this.serializableCache=o,this.persistencePlugin=a,this.performanceClient=l}return n.prototype.validateServerAuthorizationCodeResponse=function(e,t,r){if(!e.state||!t)throw e.state?en.createStateNotFoundError("Cached State"):en.createStateNotFoundError("Server State");if(decodeURIComponent(e.state)!==decodeURIComponent(t))throw en.createStateMismatchError();if(e.error||e.error_description||e.suberror)throw tc.isInteractionRequiredError(e.error,e.error_description,e.suberror)?new tc(e.error||Le.EMPTY_STRING,e.error_description,e.suberror,e.timestamp||Le.EMPTY_STRING,e.trace_id||Le.EMPTY_STRING,e.correlation_id||Le.EMPTY_STRING,e.claims||Le.EMPTY_STRING):new Wf(e.error||Le.EMPTY_STRING,e.error_description,e.suberror);e.client_info&&SE(e.client_info,r)},n.prototype.validateTokenResponse=function(e){if(e.error||e.error_description||e.suberror){if(tc.isInteractionRequiredError(e.error,e.error_description,e.suberror))throw new tc(e.error,e.error_description,e.suberror,e.timestamp||Le.EMPTY_STRING,e.trace_id||Le.EMPTY_STRING,e.correlation_id||Le.EMPTY_STRING,e.claims||Le.EMPTY_STRING);var t=e.error_codes+" - ["+e.timestamp+"]: "+e.error_description+" - Correlation ID: "+e.correlation_id+" - Trace ID: "+e.trace_id;throw new Wf(e.error,t,e.suberror)}},n.prototype.handleServerTokenResponse=function(e,t,r,i,o,a,l,h,p){var g;return zn(this,void 0,void 0,function(){var _,x,C,M,L;return jn(this,function(F){switch(F.label){case 0:if((g=this.performanceClient)!=null&&g.addQueueMeasurement(nt.HandleServerTokenResponse,e.correlation_id),e.id_token){if(_=new ml(e.id_token||Le.EMPTY_STRING,this.cryptoObj),o&&!Kt.isEmpty(o.nonce)&&_.claims.nonce!==o.nonce)throw en.createNonceMismatchError();if(i.maxAge||i.maxAge===0){if(!(C=_.claims.auth_time))throw en.createAuthTimeNotFoundError();ml.checkMaxAge(C,i.maxAge)}}this.homeAccountIdentifier=Qo.generateHomeAccountId(e.client_info||Le.EMPTY_STRING,t.authorityType,this.logger,this.cryptoObj,_),o&&o.state&&(x=bu.parseRequestState(this.cryptoObj,o.state)),e.key_id=e.key_id||i.sshKid||void 0,C=this.generateCacheRecord(e,t,r,i,_,a,o),F.label=1;case 1:return F.trys.push([1,,5,8]),this.persistencePlugin&&this.serializableCache?(this.logger.verbose("Persistence enabled, calling beforeCacheAccess"),M=new Uwe(this.serializableCache,!0),[4,this.persistencePlugin.beforeCacheAccess(M)]):[3,3];case 2:F.sent(),F.label=3;case 3:return!l||h||!C.account||(L=C.account.generateAccountKey(),this.cacheStorage.getAccount(L))?[4,this.cacheStorage.saveCacheRecord(C)]:(this.logger.warning("Account used to refresh tokens not in persistence, refreshed tokens will not be stored in the cache"),[2,n.generateAuthenticationResult(this.cryptoObj,t,C,!1,i,_,x,void 0,p)]);case 4:return F.sent(),[3,8];case 5:return this.persistencePlugin&&this.serializableCache&&M?(this.logger.verbose("Persistence enabled, calling afterCacheAccess"),[4,this.persistencePlugin.afterCacheAccess(M)]):[3,7];case 6:F.sent(),F.label=7;case 7:return[7];case 8:return[2,n.generateAuthenticationResult(this.cryptoObj,t,C,!1,i,_,x,e,p)]}})})},n.prototype.generateCacheRecord=function(e,t,r,i,F,a,M){var h,p,g=t.getPreferredCache();if(Kt.isEmpty(g))throw en.createInvalidCacheEnvironmentError();!Kt.isEmpty(e.id_token)&&F&&(h=Kf.createIdTokenEntity(this.homeAccountIdentifier,g,e.id_token||Le.EMPTY_STRING,this.clientId,F.claims.tid||Le.EMPTY_STRING),p=this.generateAccountEntity(e,F,t,M));var _,x,C,M=null,L=(Kt.isEmpty(e.access_token)||(_=e.scope?fa.fromString(e.scope):new fa(i.scopes||[]),C=(x=r+((typeof e.expires_in=="string"?parseInt(e.expires_in,10):e.expires_in)||0))+((typeof e.ext_expires_in=="string"?parseInt(e.ext_expires_in,10):e.ext_expires_in)||0),r=(L=(typeof e.refresh_in=="string"?parseInt(e.refresh_in,10):e.refresh_in)||void 0)&&0<L?r+L:void 0,M=Zf.createAccessTokenEntity(this.homeAccountIdentifier,g,e.access_token||Le.EMPTY_STRING,this.clientId,F?F.claims.tid||Le.EMPTY_STRING:t.tenant,_.printScopes(),x,C,this.cryptoObj,r,e.token_type,a,e.key_id,i.claims,i.requestedClaimsHash)),null),F=(Kt.isEmpty(e.refresh_token)||(L=Cm.createRefreshTokenEntity(this.homeAccountIdentifier,g,e.refresh_token||Le.EMPTY_STRING,this.clientId,e.foci,a)),null);return Kt.isEmpty(e.foci)||(F=eR.createAppMetadataEntity(this.clientId,g,e.foci)),new IE(p,h,M,L,F)},n.prototype.generateAccountEntity=function(e,t,r,l){var o=r.authorityType,a=l?l.cloud_graph_host_name:Le.EMPTY_STRING,l=l?l.msgraph_host:Le.EMPTY_STRING;if(o===ka.Adfs)return this.logger.verbose("Authority type is ADFS, creating ADFS account"),Qo.createGenericAccount(this.homeAccountIdentifier,t,r,a,l);if(Kt.isEmpty(e.client_info)&&r.protocolMode==="AAD")throw en.createClientInfoEmptyError();return e.client_info?Qo.createAccount(e.client_info,this.homeAccountIdentifier,t,r,a,l):Qo.createGenericAccount(this.homeAccountIdentifier,t,r,a,l)},n.generateAuthenticationResult=function(e,t,r,i,o,a,l,h,p){var g;return zn(this,void 0,void 0,function(){var _,x,C,M,L,F,z,ee;return jn(this,function(ce){switch(ce.label){case 0:if(_=Le.EMPTY_STRING,x=[],C=null,L=Le.EMPTY_STRING,!r.accessToken)return[3,4];if(r.accessToken.tokenType!==qr.POP)return[3,2];if(z=new Im(e),F=r.accessToken,ee=F.secret,F=F.keyId)return[4,z.signPopToken(ee,F,o)];throw en.createKeyIdMissingError();case 1:return _=ce.sent(),[3,3];case 2:_=r.accessToken.secret,ce.label=3;case 3:x=fa.fromString(r.accessToken.target).asArray(),C=new Date(1e3*Number(r.accessToken.expiresOn)),M=new Date(1e3*Number(r.accessToken.extendedExpiresOn)),ce.label=4;case 4:return r.appMetadata&&(L=r.appMetadata.familyId===p0?p0:Le.EMPTY_STRING),z=(a==null?void 0:a.claims.oid)||(a==null?void 0:a.claims.sub)||Le.EMPTY_STRING,ee=(a==null?void 0:a.claims.tid)||Le.EMPTY_STRING,h!=null&&h.spa_accountid&&r.account&&(r.account.nativeAccountId=h==null?void 0:h.spa_accountid),[2,{authority:t.canonicalAuthority,uniqueId:z,tenantId:ee,scopes:x,account:r.account?r.account.getAccountInfo():null,idToken:a?a.rawToken:Le.EMPTY_STRING,idTokenClaims:a?a.claims:{},accessToken:_,fromCache:i,expiresOn:C,correlationId:o.correlationId,requestId:p||Le.EMPTY_STRING,extExpiresOn:M,familyId:L,tokenType:((g=r.accessToken)==null?void 0:g.tokenType)||Le.EMPTY_STRING,state:l?l.userRequestState:Le.EMPTY_STRING,cloudGraphHostName:((g=r.account)==null?void 0:g.cloudGraphHostName)||Le.EMPTY_STRING,msGraphHost:((g=r.account)==null?void 0:g.msGraphHost)||Le.EMPTY_STRING,code:h==null?void 0:h.spa_code,fromNativeBroker:!1}]}})})},n}(),Wj=function(n){function e(t,r){return t=n.call(this,t,r)||this,t.includeRedirectUri=!0,t}return Ja(e,n),e.prototype.getAuthCodeUrl=function(t){var r;return zn(this,void 0,void 0,function(){var i;return jn(this,function(o){switch(o.label){case 0:return(r=this.performanceClient)!=null&&r.addQueueMeasurement(nt.GetAuthCodeUrl,t.correlationId),(r=this.performanceClient)!=null&&r.setPreQueueTime(nt.AuthClientCreateQueryString,t.correlationId),[4,this.createAuthCodeUrlQueryString(t)];case 1:return i=o.sent(),[2,wr.appendQueryString(this.authority.authorizationEndpoint,i)]}})})},e.prototype.acquireToken=function(t,r){var i,o;return zn(this,void 0,void 0,function(){var a,l,h,p,g,_=this;return jn(this,function(x){switch(x.label){case 0:if(t&&t.code)return(i=this.performanceClient)!=null&&i.addQueueMeasurement(nt.AuthClientAcquireToken,t.correlationId),a=(i=this.performanceClient)==null?void 0:i.startMeasurement("AuthCodeClientAcquireToken",t.correlationId),this.logger.info("in acquireToken call in auth-code client"),l=ec.nowSeconds(),(i=this.performanceClient)!=null&&i.setPreQueueTime(nt.AuthClientExecuteTokenRequest,t.correlationId),[4,this.executeTokenRequest(this.authority,t)];throw en.createTokenRequestCannotBeMadeError();case 1:return h=x.sent(),p=(i=h.headers)==null?void 0:i[Is.X_MS_REQUEST_ID],(g=(o=h.headers)==null?void 0:o[Is.X_MS_HTTP_VERSION])&&a!=null&&a.addStaticFields({httpVerAuthority:g}),(g=new PE(this.config.authOptions.clientId,this.cacheManager,this.cryptoUtils,this.logger,this.config.serializableCache,this.config.persistencePlugin,this.performanceClient)).validateTokenResponse(h.body),(o=this.performanceClient)!=null&&o.setPreQueueTime(nt.HandleServerTokenResponse,t.correlationId),[2,g.handleServerTokenResponse(h.body,this.authority,l,t,r,void 0,void 0,void 0,p).then(function(C){return a!=null&&a.endMeasurement({success:!0}),C}).catch(function(C){throw _.logger.verbose("Error in fetching token in ACC",t.correlationId),a!=null&&a.endMeasurement({errorCode:C.errorCode,subErrorCode:C.subError,success:!1}),C})]}})})},e.prototype.handleFragmentResponse=function(o,r){var i=new PE(this.config.authOptions.clientId,this.cacheManager,this.cryptoUtils,this.logger,null,null),o=new wr(o),o=wr.getDeserializedHash(o.getHash());if(i.validateServerAuthorizationCodeResponse(o,r,this.cryptoUtils),o.code)return Gr(Gr({},o),{code:o.code});throw en.createNoAuthCodeInServerResponseError()},e.prototype.getLogoutUri=function(t){if(t)return t=this.createLogoutUrlQueryString(t),wr.appendQueryString(this.authority.endSessionEndpoint,t);throw yi.createEmptyLogoutRequestError()},e.prototype.executeTokenRequest=function(t,r){var i;return zn(this,void 0,void 0,function(){var o,a,l,h,p;return jn(this,function(g){switch(g.label){case 0:return(i=this.performanceClient)!=null&&i.addQueueMeasurement(nt.AuthClientExecuteTokenRequest,r.correlationId),(i=this.performanceClient)!=null&&i.setPreQueueTime(nt.AuthClientCreateTokenRequestBody,r.correlationId),o=this.createTokenQueryParameters(r),o=wr.appendQueryString(t.tokenEndpoint,o),[4,this.createTokenRequestBody(r)];case 1:if(a=g.sent(),h=void 0,r.clientInfo)try{l=SE(r.clientInfo,this.cryptoUtils),h={credential:""+l.uid+Eo.CLIENT_INFO_SEPARATOR+l.utid,type:Ps.HOME_ACCOUNT_ID}}catch(_){this.logger.verbose("Could not parse client info for CCS Header: "+_)}return h=this.createTokenRequestHeaders(h||r.ccsCredential),p={clientId:this.config.authOptions.clientId,authority:t.canonicalAuthority,scopes:r.scopes,claims:r.claims,authenticationScheme:r.authenticationScheme,resourceRequestMethod:r.resourceRequestMethod,resourceRequestUri:r.resourceRequestUri,shrClaims:r.shrClaims,sshKid:r.sshKid},[2,this.executePostToTokenEndpoint(o,a,h,p)]}})})},e.prototype.createTokenRequestBody=function(t){var r;return zn(this,void 0,void 0,function(){var i,o,a,l,h,p;return jn(this,function(g){switch(g.label){case 0:return(r=this.performanceClient)!=null&&r.addQueueMeasurement(nt.AuthClientCreateTokenRequestBody,t.correlationId),(i=new y0).addClientId(this.config.authOptions.clientId),this.includeRedirectUri?i.addRedirectUri(t.redirectUri):Yf.validateRedirectUri(t.redirectUri),i.addScopes(t.scopes),i.addAuthorizationCode(t.code),i.addLibraryInfo(this.config.libraryInfo),i.addApplicationTelemetry(this.config.telemetry.application),i.addThrottling(),this.serverTelemetryManager&&i.addServerTelemetry(this.serverTelemetryManager),t.codeVerifier&&i.addCodeVerifier(t.codeVerifier),this.config.clientCredentials.clientSecret&&i.addClientSecret(this.config.clientCredentials.clientSecret),this.config.clientCredentials.clientAssertion&&(o=this.config.clientCredentials.clientAssertion,i.addClientAssertion(o.assertion),i.addClientAssertionType(o.assertionType)),i.addGrantType(wE.AUTHORIZATION_CODE_GRANT),i.addClientInfo(),t.authenticationScheme!==qr.POP?[3,2]:(o=new Im(this.cryptoUtils,this.performanceClient),(r=this.performanceClient)!=null&&r.setPreQueueTime(nt.PopTokenGenerateCnf,t.correlationId),[4,o.generateCnf(t)]);case 1:return a=g.sent(),i.addPopToken(a.reqCnfString),[3,3];case 2:if(t.authenticationScheme===qr.SSH){if(!t.sshJwk)throw yi.createMissingSshJwkError();i.addSshJwk(t.sshJwk)}g.label=3;case 3:if(a=t.correlationId||this.config.cryptoInterface.createNewGuid(),i.addCorrelationId(a),(!Kt.isEmptyObj(t.claims)||this.config.authOptions.clientCapabilities&&0<this.config.authOptions.clientCapabilities.length)&&i.addClaims(t.claims,this.config.authOptions.clientCapabilities),l=void 0,t.clientInfo)try{h=SE(t.clientInfo,this.cryptoUtils),l={credential:""+h.uid+Eo.CLIENT_INFO_SEPARATOR+h.utid,type:Ps.HOME_ACCOUNT_ID}}catch(_){this.logger.verbose("Could not parse client info for CCS Header: "+_)}else l=t.ccsCredential;if(this.config.systemOptions.preventCorsPreflight&&l)switch(l.type){case Ps.HOME_ACCOUNT_ID:try{h=Sm(l.credential),i.addCcsOid(h)}catch(_){this.logger.verbose("Could not parse home account ID for CCS Header: "+_)}break;case Ps.UPN:i.addCcsUpn(l.credential)}return t.tokenBodyParameters&&i.addExtraQueryParameters(t.tokenBodyParameters),!t.enableSpaAuthorizationCode||t.tokenBodyParameters&&t.tokenBodyParameters[Wn.RETURN_SPA_CODE]||i.addExtraQueryParameters(((p={})[Wn.RETURN_SPA_CODE]="1",p)),[2,i.createQueryString()]}})})},e.prototype.createAuthCodeUrlQueryString=function(t){var r;return zn(this,void 0,void 0,function(){var i,o,a,l;return jn(this,function(h){switch(h.label){case 0:if((r=this.performanceClient)!=null&&r.addQueueMeasurement(nt.AuthClientCreateQueryString,t.correlationId),(i=new y0).addClientId(this.config.authOptions.clientId),o=vE(t.scopes||[],t.extraScopesToConsent||[]),i.addScopes(o),i.addRedirectUri(t.redirectUri),o=t.correlationId||this.config.cryptoInterface.createNewGuid(),i.addCorrelationId(o),i.addResponseMode(t.responseMode),i.addResponseTypeCode(),i.addLibraryInfo(this.config.libraryInfo),i.addApplicationTelemetry(this.config.telemetry.application),i.addClientInfo(),t.codeChallenge&&t.codeChallengeMethod&&i.addCodeChallengeParams(t.codeChallenge,t.codeChallengeMethod),t.prompt&&i.addPrompt(t.prompt),t.domainHint&&i.addDomainHint(t.domainHint),t.prompt!==da.SELECT_ACCOUNT)if(t.sid&&t.prompt===da.NONE)this.logger.verbose("createAuthCodeUrlQueryString: Prompt is none, adding sid from request"),i.addSid(t.sid);else if(t.account){if(o=this.extractAccountSid(t.account),l=this.extractLoginHint(t.account)){this.logger.verbose("createAuthCodeUrlQueryString: login_hint claim present on account"),i.addLoginHint(l);try{a=Sm(t.account.homeAccountId),i.addCcsOid(a)}catch{this.logger.verbose("createAuthCodeUrlQueryString: Could not parse home account ID for CCS Header")}}else if(o&&t.prompt===da.NONE){this.logger.verbose("createAuthCodeUrlQueryString: Prompt is none, adding sid from account"),i.addSid(o);try{a=Sm(t.account.homeAccountId),i.addCcsOid(a)}catch{this.logger.verbose("createAuthCodeUrlQueryString: Could not parse home account ID for CCS Header")}}else if(t.loginHint)this.logger.verbose("createAuthCodeUrlQueryString: Adding login_hint from request"),i.addLoginHint(t.loginHint),i.addCcsUpn(t.loginHint);else if(t.account.username){this.logger.verbose("createAuthCodeUrlQueryString: Adding login_hint from account"),i.addLoginHint(t.account.username);try{a=Sm(t.account.homeAccountId),i.addCcsOid(a)}catch{this.logger.verbose("createAuthCodeUrlQueryString: Could not parse home account ID for CCS Header")}}}else t.loginHint&&(this.logger.verbose("createAuthCodeUrlQueryString: No account, adding login_hint from request"),i.addLoginHint(t.loginHint),i.addCcsUpn(t.loginHint));else this.logger.verbose("createAuthCodeUrlQueryString: Prompt is select_account, ignoring account hints");return t.nonce&&i.addNonce(t.nonce),t.state&&i.addState(t.state),(!Kt.isEmpty(t.claims)||this.config.authOptions.clientCapabilities&&0<this.config.authOptions.clientCapabilities.length)&&i.addClaims(t.claims,this.config.authOptions.clientCapabilities),t.extraQueryParameters&&i.addExtraQueryParameters(t.extraQueryParameters),t.nativeBroker?(i.addNativeBroker(),t.authenticationScheme!==qr.POP?[3,2]:[4,new Im(this.cryptoUtils).generateCnf(t)]):[3,2];case 1:l=h.sent(),i.addPopToken(l.reqCnfString),h.label=2;case 2:return[2,i.createQueryString()]}})})},e.prototype.createLogoutUrlQueryString=function(t){var r=new y0;return t.postLogoutRedirectUri&&r.addPostLogoutRedirectUri(t.postLogoutRedirectUri),t.correlationId&&r.addCorrelationId(t.correlationId),t.idTokenHint&&r.addIdTokenHint(t.idTokenHint),t.state&&r.addState(t.state),t.logoutHint&&r.addLogoutHint(t.logoutHint),t.extraQueryParameters&&r.addExtraQueryParameters(t.extraQueryParameters),r.createQueryString()},e.prototype.extractAccountSid=function(t){return((t=t.idTokenClaims)==null?void 0:t.sid)||null},e.prototype.extractLoginHint=function(t){return((t=t.idTokenClaims)==null?void 0:t.login_hint)||null},e}(QM),Yj=function(n){function e(t,r){return n.call(this,t,r)||this}return Ja(e,n),e.prototype.acquireToken=function(t){var r,i,o;return zn(this,void 0,void 0,function(){var a,l,h,p,g,_=this;return jn(this,function(x){switch(x.label){case 0:return(r=this.performanceClient)!=null&&r.addQueueMeasurement(nt.RefreshTokenClientAcquireToken,t.correlationId),a=(r=this.performanceClient)==null?void 0:r.startMeasurement(nt.RefreshTokenClientAcquireToken,t.correlationId),this.logger.verbose("RefreshTokenClientAcquireToken called",t.correlationId),l=ec.nowSeconds(),(r=this.performanceClient)!=null&&r.setPreQueueTime(nt.RefreshTokenClientExecuteTokenRequest,t.correlationId),[4,this.executeTokenRequest(t,this.authority)];case 1:return h=x.sent(),p=(r=h.headers)==null?void 0:r[Is.X_MS_HTTP_VERSION],a!=null&&a.addStaticFields({refreshTokenSize:((i=h.body.refresh_token)==null?void 0:i.length)||0}),p&&a!=null&&a.addStaticFields({httpVerToken:p}),p=(i=h.headers)==null?void 0:i[Is.X_MS_REQUEST_ID],(g=new PE(this.config.authOptions.clientId,this.cacheManager,this.cryptoUtils,this.logger,this.config.serializableCache,this.config.persistencePlugin)).validateTokenResponse(h.body),(o=this.performanceClient)!=null&&o.setPreQueueTime(nt.HandleServerTokenResponse,t.correlationId),[2,g.handleServerTokenResponse(h.body,this.authority,l,t,void 0,void 0,!0,t.forceCache,p).then(function(C){return a!=null&&a.endMeasurement({success:!0}),C}).catch(function(C){throw _.logger.verbose("Error in fetching refresh token",t.correlationId),a!=null&&a.endMeasurement({errorCode:C.errorCode,subErrorCode:C.subError,success:!1}),C})]}})})},e.prototype.acquireTokenByRefreshToken=function(t){var r,i;return zn(this,void 0,void 0,function(){var o,a;return jn(this,function(l){if(!t)throw yi.createEmptyTokenRequestError();if((i=this.performanceClient)!=null&&i.addQueueMeasurement(nt.RefreshTokenClientAcquireTokenByRefreshToken,t.correlationId),!t.account)throw en.createNoAccountInSilentRequestError();if(this.cacheManager.isAppMetadataFOCI(t.account.environment))try{return(r=this.performanceClient)!=null&&r.setPreQueueTime(nt.RefreshTokenClientAcquireTokenWithCachedRefreshToken,t.correlationId),[2,this.acquireTokenWithCachedRefreshToken(t,!0)]}catch(h){if(o=h instanceof tc&&h.errorCode===Am.noTokensFoundError.code,a=h instanceof Wf&&h.errorCode===Hj.INVALID_GRANT_ERROR&&h.subError===Hj.CLIENT_MISMATCH_ERROR,o||a)return(i=this.performanceClient)!=null&&i.setPreQueueTime(nt.RefreshTokenClientAcquireTokenWithCachedRefreshToken,t.correlationId),[2,this.acquireTokenWithCachedRefreshToken(t,!1)];throw h}return(i=this.performanceClient)!=null&&i.setPreQueueTime(nt.RefreshTokenClientAcquireTokenWithCachedRefreshToken,t.correlationId),[2,this.acquireTokenWithCachedRefreshToken(t,!1)]})})},e.prototype.acquireTokenWithCachedRefreshToken=function(t,r){var i;return zn(this,void 0,void 0,function(){var o,a;return jn(this,function(l){if((i=this.performanceClient)!=null&&i.addQueueMeasurement(nt.RefreshTokenClientAcquireTokenWithCachedRefreshToken,t.correlationId),o=(i=this.performanceClient)==null?void 0:i.startMeasurement(nt.RefreshTokenClientAcquireTokenWithCachedRefreshToken,t.correlationId),this.logger.verbose("RefreshTokenClientAcquireTokenWithCachedRefreshToken called",t.correlationId),a=this.cacheManager.getRefreshToken(t.account,r))return o!=null&&o.endMeasurement({success:!0}),a=Gr(Gr({},t),{refreshToken:a.secret,authenticationScheme:t.authenticationScheme||qr.BEARER,ccsCredential:{credential:t.account.homeAccountId,type:Ps.HOME_ACCOUNT_ID}}),(i=this.performanceClient)!=null&&i.setPreQueueTime(nt.RefreshTokenClientAcquireToken,t.correlationId),[2,this.acquireToken(a)];throw o!=null&&o.discardMeasurement(),tc.createNoTokensFoundError()})})},e.prototype.executeTokenRequest=function(t,r){var i;return zn(this,void 0,void 0,function(){var o,a,l,h,p;return jn(this,function(g){switch(g.label){case 0:return(i=this.performanceClient)!=null&&i.addQueueMeasurement(nt.RefreshTokenClientExecuteTokenRequest,t.correlationId),o=(i=this.performanceClient)==null?void 0:i.startMeasurement(nt.RefreshTokenClientExecuteTokenRequest,t.correlationId),(i=this.performanceClient)!=null&&i.setPreQueueTime(nt.RefreshTokenClientCreateTokenRequestBody,t.correlationId),a=this.createTokenQueryParameters(t),a=wr.appendQueryString(r.tokenEndpoint,a),[4,this.createTokenRequestBody(t)];case 1:return l=g.sent(),h=this.createTokenRequestHeaders(t.ccsCredential),p={clientId:this.config.authOptions.clientId,authority:r.canonicalAuthority,scopes:t.scopes,claims:t.claims,authenticationScheme:t.authenticationScheme,resourceRequestMethod:t.resourceRequestMethod,resourceRequestUri:t.resourceRequestUri,shrClaims:t.shrClaims,sshKid:t.sshKid},[2,this.executePostToTokenEndpoint(a,l,h,p).then(function(_){return o!=null&&o.endMeasurement({success:!0}),_}).catch(function(_){throw o!=null&&o.endMeasurement({success:!1}),_})]}})})},e.prototype.createTokenRequestBody=function(t){var r;return zn(this,void 0,void 0,function(){var i,o,a,l;return jn(this,function(h){switch(h.label){case 0:return(r=this.performanceClient)!=null&&r.addQueueMeasurement(nt.RefreshTokenClientCreateTokenRequestBody,t.correlationId),a=t.correlationId,i=(r=this.performanceClient)==null?void 0:r.startMeasurement(nt.BaseClientCreateTokenRequestHeaders,a),(o=new y0).addClientId(this.config.authOptions.clientId),o.addScopes(t.scopes),o.addGrantType(wE.REFRESH_TOKEN_GRANT),o.addClientInfo(),o.addLibraryInfo(this.config.libraryInfo),o.addApplicationTelemetry(this.config.telemetry.application),o.addThrottling(),this.serverTelemetryManager&&o.addServerTelemetry(this.serverTelemetryManager),o.addCorrelationId(a),o.addRefreshToken(t.refreshToken),this.config.clientCredentials.clientSecret&&o.addClientSecret(this.config.clientCredentials.clientSecret),this.config.clientCredentials.clientAssertion&&(a=this.config.clientCredentials.clientAssertion,o.addClientAssertion(a.assertion),o.addClientAssertionType(a.assertionType)),t.authenticationScheme!==qr.POP?[3,2]:(a=new Im(this.cryptoUtils,this.performanceClient),(r=this.performanceClient)!=null&&r.setPreQueueTime(nt.PopTokenGenerateCnf,t.correlationId),[4,a.generateCnf(t)]);case 1:return a=h.sent(),o.addPopToken(a.reqCnfString),[3,3];case 2:if(t.authenticationScheme===qr.SSH){if(!t.sshJwk)throw i!=null&&i.endMeasurement({success:!1}),yi.createMissingSshJwkError();o.addSshJwk(t.sshJwk)}h.label=3;case 3:if((!Kt.isEmptyObj(t.claims)||this.config.authOptions.clientCapabilities&&0<this.config.authOptions.clientCapabilities.length)&&o.addClaims(t.claims,this.config.authOptions.clientCapabilities),this.config.systemOptions.preventCorsPreflight&&t.ccsCredential)switch(t.ccsCredential.type){case Ps.HOME_ACCOUNT_ID:try{l=Sm(t.ccsCredential.credential),o.addCcsOid(l)}catch(p){this.logger.verbose("Could not parse home account ID for CCS Header: "+p)}break;case Ps.UPN:o.addCcsUpn(t.ccsCredential.credential)}return i!=null&&i.endMeasurement({success:!0}),[2,o.createQueryString()]}})})},e}(QM),zwe=function(n){function e(t,r){return n.call(this,t,r)||this}return Ja(e,n),e.prototype.acquireToken=function(t){return zn(this,void 0,void 0,function(){var r;return jn(this,function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),[4,this.acquireCachedToken(t)];case 1:return[2,i.sent()];case 2:if((r=i.sent())instanceof en&&r.errorCode===Mt.tokenRefreshRequired.code)return[2,new Yj(this.config,this.performanceClient).acquireTokenByRefreshToken(t)];throw r;case 3:return[2]}})})},e.prototype.acquireCachedToken=function(t){var r,i,o;return zn(this,void 0,void 0,function(){var a;return jn(this,function(l){switch(l.label){case 0:if(!t)throw yi.createEmptyTokenRequestError();if(t.forceRefresh)throw(r=this.serverTelemetryManager)!=null&&r.setCacheOutcome(Wh.FORCE_REFRESH),this.logger.info("SilentFlowClient:acquireCachedToken - Skipping cache because forceRefresh is true."),en.createRefreshRequiredError();if(!this.config.cacheOptions.claimsBasedCachingEnabled&&!Kt.isEmptyObj(t.claims))throw(r=this.serverTelemetryManager)!=null&&r.setCacheOutcome(Wh.CLAIMS_REQUESTED_CACHE_SKIPPED),this.logger.info("SilentFlowClient:acquireCachedToken - Skipping cache because claims-based caching is disabled and claims were requested."),en.createRefreshRequiredError();if(!t.account)throw en.createNoAccountInSilentRequestError();if(a=t.authority||this.authority.getPreferredCache(),!(a=this.cacheManager.readCacheRecord(t.account,t,a)).accessToken)throw(i=this.serverTelemetryManager)!=null&&i.setCacheOutcome(Wh.NO_CACHED_ACCESS_TOKEN),this.logger.info("SilentFlowClient:acquireCachedToken - No access token found in cache for the given properties."),en.createRefreshRequiredError();if(ec.wasClockTurnedBack(a.accessToken.cachedAt)||ec.isTokenExpired(a.accessToken.expiresOn,this.config.systemOptions.tokenRenewalOffsetSeconds))throw(i=this.serverTelemetryManager)!=null&&i.setCacheOutcome(Wh.CACHED_ACCESS_TOKEN_EXPIRED),this.logger.info("SilentFlowClient:acquireCachedToken - Cached access token is expired or will expire within "+this.config.systemOptions.tokenRenewalOffsetSeconds+" seconds."),en.createRefreshRequiredError();if(a.accessToken.refreshOn&&ec.isTokenExpired(a.accessToken.refreshOn,0))throw(o=this.serverTelemetryManager)!=null&&o.setCacheOutcome(Wh.REFRESH_CACHED_ACCESS_TOKEN),this.logger.info("SilentFlowClient:acquireCachedToken - Cached access token's refreshOn property has been exceeded'."),en.createRefreshRequiredError();return this.config.serverTelemetryManager&&this.config.serverTelemetryManager.incrementCacheHits(),[4,this.generateResultFromCacheRecord(a,t)];case 1:return[2,l.sent()]}})})},e.prototype.generateResultFromCacheRecord=function(t,r){return zn(this,void 0,void 0,function(){var i,o;return jn(this,function(a){switch(a.label){case 0:if(t.idToken&&(i=new ml(t.idToken.secret,this.config.cryptoInterface)),r.maxAge||r.maxAge===0){if(!(o=i==null?void 0:i.claims.auth_time))throw en.createAuthTimeNotFoundError();ml.checkMaxAge(o,r.maxAge)}return[4,PE.generateAuthenticationResult(this.cryptoUtils,this.authority,t,!0,r,i)];case 1:return[2,a.sent()]}})})},e}(QM);function jwe(n){return n.hasOwnProperty("authorization_endpoint")&&n.hasOwnProperty("token_endpoint")&&n.hasOwnProperty("issuer")&&n.hasOwnProperty("jwks_uri")}var _0,Kj={endpointMetadata:{"https://login.microsoftonline.com/common/":{token_endpoint:"https://login.microsoftonline.com/common/oauth2/v2.0/token",token_endpoint_auth_methods_supported:["client_secret_post","private_key_jwt","client_secret_basic"],jwks_uri:"https://login.microsoftonline.com/common/discovery/v2.0/keys",response_modes_supported:["query","fragment","form_post"],subject_types_supported:["pairwise"],id_token_signing_alg_values_supported:["RS256"],response_types_supported:["code","id_token","code id_token","id_token token"],scopes_supported:["openid","profile","email","offline_access"],issuer:"https://login.microsoftonline.com/{tenantid}/v2.0",request_uri_parameter_supported:!1,userinfo_endpoint:"https://graph.microsoft.com/oidc/userinfo",authorization_endpoint:"https://login.microsoftonline.com/common/oauth2/v2.0/authorize",device_authorization_endpoint:"https://login.microsoftonline.com/common/oauth2/v2.0/devicecode",http_logout_supported:!0,frontchannel_logout_supported:!0,end_session_endpoint:"https://login.microsoftonline.com/common/oauth2/v2.0/logout",claims_supported:["sub","iss","cloud_instance_name","cloud_instance_host_name","cloud_graph_host_name","msgraph_host","aud","exp","iat","auth_time","acr","nonce","preferred_username","name","tid","ver","at_hash","c_hash","email"],kerberos_endpoint:"https://login.microsoftonline.com/common/kerberos",tenant_region_scope:null,cloud_instance_name:"microsoftonline.com",cloud_graph_host_name:"graph.windows.net",msgraph_host:"graph.microsoft.com",rbac_url:"https://pas.windows.net"},"https://login.chinacloudapi.cn/common/":{token_endpoint:"https://login.chinacloudapi.cn/common/oauth2/v2.0/token",token_endpoint_auth_methods_supported:["client_secret_post","private_key_jwt","client_secret_basic"],jwks_uri:"https://login.chinacloudapi.cn/common/discovery/v2.0/keys",response_modes_supported:["query","fragment","form_post"],subject_types_supported:["pairwise"],id_token_signing_alg_values_supported:["RS256"],response_types_supported:["code","id_token","code id_token","id_token token"],scopes_supported:["openid","profile","email","offline_access"],issuer:"https://login.partner.microsoftonline.cn/{tenantid}/v2.0",request_uri_parameter_supported:!1,userinfo_endpoint:"https://microsoftgraph.chinacloudapi.cn/oidc/userinfo",authorization_endpoint:"https://login.chinacloudapi.cn/common/oauth2/v2.0/authorize",device_authorization_endpoint:"https://login.chinacloudapi.cn/common/oauth2/v2.0/devicecode",http_logout_supported:!0,frontchannel_logout_supported:!0,end_session_endpoint:"https://login.chinacloudapi.cn/common/oauth2/v2.0/logout",claims_supported:["sub","iss","cloud_instance_name","cloud_instance_host_name","cloud_graph_host_name","msgraph_host","aud","exp","iat","auth_time","acr","nonce","preferred_username","name","tid","ver","at_hash","c_hash","email"],kerberos_endpoint:"https://login.chinacloudapi.cn/common/kerberos",tenant_region_scope:null,cloud_instance_name:"partner.microsoftonline.cn",cloud_graph_host_name:"graph.chinacloudapi.cn",msgraph_host:"microsoftgraph.chinacloudapi.cn",rbac_url:"https://pas.chinacloudapi.cn"},"https://login.microsoftonline.us/common/":{token_endpoint:"https://login.microsoftonline.us/common/oauth2/v2.0/token",token_endpoint_auth_methods_supported:["client_secret_post","private_key_jwt","client_secret_basic"],jwks_uri:"https://login.microsoftonline.us/common/discovery/v2.0/keys",response_modes_supported:["query","fragment","form_post"],subject_types_supported:["pairwise"],id_token_signing_alg_values_supported:["RS256"],response_types_supported:["code","id_token","code id_token","id_token token"],scopes_supported:["openid","profile","email","offline_access"],issuer:"https://login.microsoftonline.us/{tenantid}/v2.0",request_uri_parameter_supported:!1,userinfo_endpoint:"https://graph.microsoft.com/oidc/userinfo",authorization_endpoint:"https://login.microsoftonline.us/common/oauth2/v2.0/authorize",device_authorization_endpoint:"https://login.microsoftonline.us/common/oauth2/v2.0/devicecode",http_logout_supported:!0,frontchannel_logout_supported:!0,end_session_endpoint:"https://login.microsoftonline.us/common/oauth2/v2.0/logout",claims_supported:["sub","iss","cloud_instance_name","cloud_instance_host_name","cloud_graph_host_name","msgraph_host","aud","exp","iat","auth_time","acr","nonce","preferred_username","name","tid","ver","at_hash","c_hash","email"],kerberos_endpoint:"https://login.microsoftonline.us/common/kerberos",tenant_region_scope:null,cloud_instance_name:"microsoftonline.us",cloud_graph_host_name:"graph.windows.net",msgraph_host:"graph.microsoft.com",rbac_url:"https://pasff.usgovcloudapi.net"},"https://login.microsoftonline.com/consumers/":{token_endpoint:"https://login.microsoftonline.com/consumers/oauth2/v2.0/token",token_endpoint_auth_methods_supported:["client_secret_post","private_key_jwt","client_secret_basic"],jwks_uri:"https://login.microsoftonline.com/consumers/discovery/v2.0/keys",response_modes_supported:["query","fragment","form_post"],subject_types_supported:["pairwise"],id_token_signing_alg_values_supported:["RS256"],response_types_supported:["code","id_token","code id_token","id_token token"],scopes_supported:["openid","profile","email","offline_access"],issuer:"https://login.microsoftonline.com/9188040d-6c67-4c5b-b112-36a304b66dad/v2.0",request_uri_parameter_supported:!1,userinfo_endpoint:"https://graph.microsoft.com/oidc/userinfo",authorization_endpoint:"https://login.microsoftonline.com/consumers/oauth2/v2.0/authorize",device_authorization_endpoint:"https://login.microsoftonline.com/consumers/oauth2/v2.0/devicecode",http_logout_supported:!0,frontchannel_logout_supported:!0,end_session_endpoint:"https://login.microsoftonline.com/consumers/oauth2/v2.0/logout",claims_supported:["sub","iss","cloud_instance_name","cloud_instance_host_name","cloud_graph_host_name","msgraph_host","aud","exp","iat","auth_time","acr","nonce","preferred_username","name","tid","ver","at_hash","c_hash","email"],kerberos_endpoint:"https://login.microsoftonline.com/consumers/kerberos",tenant_region_scope:null,cloud_instance_name:"microsoftonline.com",cloud_graph_host_name:"graph.windows.net",msgraph_host:"graph.microsoft.com",rbac_url:"https://pas.windows.net"},"https://login.chinacloudapi.cn/consumers/":{token_endpoint:"https://login.chinacloudapi.cn/consumers/oauth2/v2.0/token",token_endpoint_auth_methods_supported:["client_secret_post","private_key_jwt","client_secret_basic"],jwks_uri:"https://login.chinacloudapi.cn/consumers/discovery/v2.0/keys",response_modes_supported:["query","fragment","form_post"],subject_types_supported:["pairwise"],id_token_signing_alg_values_supported:["RS256"],response_types_supported:["code","id_token","code id_token","id_token token"],scopes_supported:["openid","profile","email","offline_access"],issuer:"https://login.partner.microsoftonline.cn/9188040d-6c67-4c5b-b112-36a304b66dad/v2.0",request_uri_parameter_supported:!1,userinfo_endpoint:"https://microsoftgraph.chinacloudapi.cn/oidc/userinfo",authorization_endpoint:"https://login.chinacloudapi.cn/consumers/oauth2/v2.0/authorize",device_authorization_endpoint:"https://login.chinacloudapi.cn/consumers/oauth2/v2.0/devicecode",http_logout_supported:!0,frontchannel_logout_supported:!0,end_session_endpoint:"https://login.chinacloudapi.cn/consumers/oauth2/v2.0/logout",claims_supported:["sub","iss","cloud_instance_name","cloud_instance_host_name","cloud_graph_host_name","msgraph_host","aud","exp","iat","auth_time","acr","nonce","preferred_username","name","tid","ver","at_hash","c_hash","email"],kerberos_endpoint:"https://login.chinacloudapi.cn/consumers/kerberos",tenant_region_scope:null,cloud_instance_name:"partner.microsoftonline.cn",cloud_graph_host_name:"graph.chinacloudapi.cn",msgraph_host:"microsoftgraph.chinacloudapi.cn",rbac_url:"https://pas.chinacloudapi.cn"},"https://login.microsoftonline.us/consumers/":{token_endpoint:"https://login.microsoftonline.us/consumers/oauth2/v2.0/token",token_endpoint_auth_methods_supported:["client_secret_post","private_key_jwt","client_secret_basic"],jwks_uri:"https://login.microsoftonline.us/consumers/discovery/v2.0/keys",response_modes_supported:["query","fragment","form_post"],subject_types_supported:["pairwise"],id_token_signing_alg_values_supported:["RS256"],response_types_supported:["code","id_token","code id_token","id_token token"],scopes_supported:["openid","profile","email","offline_access"],issuer:"https://login.microsoftonline.us/9188040d-6c67-4c5b-b112-36a304b66dad/v2.0",request_uri_parameter_supported:!1,userinfo_endpoint:"https://graph.microsoft.com/oidc/userinfo",authorization_endpoint:"https://login.microsoftonline.us/consumers/oauth2/v2.0/authorize",device_authorization_endpoint:"https://login.microsoftonline.us/consumers/oauth2/v2.0/devicecode",http_logout_supported:!0,frontchannel_logout_supported:!0,end_session_endpoint:"https://login.microsoftonline.us/consumers/oauth2/v2.0/logout",claims_supported:["sub","iss","cloud_instance_name","cloud_instance_host_name","cloud_graph_host_name","msgraph_host","aud","exp","iat","auth_time","acr","nonce","preferred_username","name","tid","ver","at_hash","c_hash","email"],kerberos_endpoint:"https://login.microsoftonline.us/consumers/kerberos",tenant_region_scope:null,cloud_instance_name:"microsoftonline.us",cloud_graph_host_name:"graph.windows.net",msgraph_host:"graph.microsoft.com",rbac_url:"https://pasff.usgovcloudapi.net"},"https://login.microsoftonline.com/organizations/":{token_endpoint:"https://login.microsoftonline.com/organizations/oauth2/v2.0/token",token_endpoint_auth_methods_supported:["client_secret_post","private_key_jwt","client_secret_basic"],jwks_uri:"https://login.microsoftonline.com/organizations/discovery/v2.0/keys",response_modes_supported:["query","fragment","form_post"],subject_types_supported:["pairwise"],id_token_signing_alg_values_supported:["RS256"],response_types_supported:["code","id_token","code id_token","id_token token"],scopes_supported:["openid","profile","email","offline_access"],issuer:"https://login.microsoftonline.com/{tenantid}/v2.0",request_uri_parameter_supported:!1,userinfo_endpoint:"https://graph.microsoft.com/oidc/userinfo",authorization_endpoint:"https://login.microsoftonline.com/organizations/oauth2/v2.0/authorize",device_authorization_endpoint:"https://login.microsoftonline.com/organizations/oauth2/v2.0/devicecode",http_logout_supported:!0,frontchannel_logout_supported:!0,end_session_endpoint:"https://login.microsoftonline.com/organizations/oauth2/v2.0/logout",claims_supported:["sub","iss","cloud_instance_name","cloud_instance_host_name","cloud_graph_host_name","msgraph_host","aud","exp","iat","auth_time","acr","nonce","preferred_username","name","tid","ver","at_hash","c_hash","email"],kerberos_endpoint:"https://login.microsoftonline.com/organizations/kerberos",tenant_region_scope:null,cloud_instance_name:"microsoftonline.com",cloud_graph_host_name:"graph.windows.net",msgraph_host:"graph.microsoft.com",rbac_url:"https://pas.windows.net"},"https://login.chinacloudapi.cn/organizations/":{token_endpoint:"https://login.chinacloudapi.cn/organizations/oauth2/v2.0/token",token_endpoint_auth_methods_supported:["client_secret_post","private_key_jwt","client_secret_basic"],jwks_uri:"https://login.chinacloudapi.cn/organizations/discovery/v2.0/keys",response_modes_supported:["query","fragment","form_post"],subject_types_supported:["pairwise"],id_token_signing_alg_values_supported:["RS256"],response_types_supported:["code","id_token","code id_token","id_token token"],scopes_supported:["openid","profile","email","offline_access"],issuer:"https://login.partner.microsoftonline.cn/{tenantid}/v2.0",request_uri_parameter_supported:!1,userinfo_endpoint:"https://microsoftgraph.chinacloudapi.cn/oidc/userinfo",authorization_endpoint:"https://login.chinacloudapi.cn/organizations/oauth2/v2.0/authorize",device_authorization_endpoint:"https://login.chinacloudapi.cn/organizations/oauth2/v2.0/devicecode",http_logout_supported:!0,frontchannel_logout_supported:!0,end_session_endpoint:"https://login.chinacloudapi.cn/organizations/oauth2/v2.0/logout",claims_supported:["sub","iss","cloud_instance_name","cloud_instance_host_name","cloud_graph_host_name","msgraph_host","aud","exp","iat","auth_time","acr","nonce","preferred_username","name","tid","ver","at_hash","c_hash","email"],kerberos_endpoint:"https://login.chinacloudapi.cn/organizations/kerberos",tenant_region_scope:null,cloud_instance_name:"partner.microsoftonline.cn",cloud_graph_host_name:"graph.chinacloudapi.cn",msgraph_host:"microsoftgraph.chinacloudapi.cn",rbac_url:"https://pas.chinacloudapi.cn"},"https://login.microsoftonline.us/organizations/":{token_endpoint:"https://login.microsoftonline.us/organizations/oauth2/v2.0/token",token_endpoint_auth_methods_supported:["client_secret_post","private_key_jwt","client_secret_basic"],jwks_uri:"https://login.microsoftonline.us/organizations/discovery/v2.0/keys",response_modes_supported:["query","fragment","form_post"],subject_types_supported:["pairwise"],id_token_signing_alg_values_supported:["RS256"],response_types_supported:["code","id_token","code id_token","id_token token"],scopes_supported:["openid","profile","email","offline_access"],issuer:"https://login.microsoftonline.us/{tenantid}/v2.0",request_uri_parameter_supported:!1,userinfo_endpoint:"https://graph.microsoft.com/oidc/userinfo",authorization_endpoint:"https://login.microsoftonline.us/organizations/oauth2/v2.0/authorize",device_authorization_endpoint:"https://login.microsoftonline.us/organizations/oauth2/v2.0/devicecode",http_logout_supported:!0,frontchannel_logout_supported:!0,end_session_endpoint:"https://login.microsoftonline.us/organizations/oauth2/v2.0/logout",claims_supported:["sub","iss","cloud_instance_name","cloud_instance_host_name","cloud_graph_host_name","msgraph_host","aud","exp","iat","auth_time","acr","nonce","preferred_username","name","tid","ver","at_hash","c_hash","email"],kerberos_endpoint:"https://login.microsoftonline.us/organizations/kerberos",tenant_region_scope:null,cloud_instance_name:"microsoftonline.us",cloud_graph_host_name:"graph.windows.net",msgraph_host:"graph.microsoft.com",rbac_url:"https://pasff.usgovcloudapi.net"}},instanceDiscoveryMetadata:{"https://login.microsoftonline.com/common/":{tenant_discovery_endpoint:"https://login.microsoftonline.com/common/v2.0/.well-known/openid-configuration","api-version":"1.1",metadata:[{preferred_network:"login.microsoftonline.com",preferred_cache:"login.windows.net",aliases:["login.microsoftonline.com","login.windows.net","login.microsoft.com","sts.windows.net"]},{preferred_network:"login.partner.microsoftonline.cn",preferred_cache:"login.partner.microsoftonline.cn",aliases:["login.partner.microsoftonline.cn","login.chinacloudapi.cn"]},{preferred_network:"login.microsoftonline.de",preferred_cache:"login.microsoftonline.de",aliases:["login.microsoftonline.de"]},{preferred_network:"login.microsoftonline.us",preferred_cache:"login.microsoftonline.us",aliases:["login.microsoftonline.us","login.usgovcloudapi.net"]},{preferred_network:"login-us.microsoftonline.com",preferred_cache:"login-us.microsoftonline.com",aliases:["login-us.microsoftonline.com"]}]},"https://login.chinacloudapi.cn/common/":{tenant_discovery_endpoint:"https://login.chinacloudapi.cn/common/v2.0/.well-known/openid-configuration","api-version":"1.1",metadata:[{preferred_network:"login.microsoftonline.com",preferred_cache:"login.windows.net",aliases:["login.microsoftonline.com","login.windows.net","login.microsoft.com","sts.windows.net"]},{preferred_network:"login.partner.microsoftonline.cn",preferred_cache:"login.partner.microsoftonline.cn",aliases:["login.partner.microsoftonline.cn","login.chinacloudapi.cn"]},{preferred_network:"login.microsoftonline.de",preferred_cache:"login.microsoftonline.de",aliases:["login.microsoftonline.de"]},{preferred_network:"login.microsoftonline.us",preferred_cache:"login.microsoftonline.us",aliases:["login.microsoftonline.us","login.usgovcloudapi.net"]},{preferred_network:"login-us.microsoftonline.com",preferred_cache:"login-us.microsoftonline.com",aliases:["login-us.microsoftonline.com"]}]},"https://login.microsoftonline.us/common/":{tenant_discovery_endpoint:"https://login.microsoftonline.us/common/v2.0/.well-known/openid-configuration","api-version":"1.1",metadata:[{preferred_network:"login.microsoftonline.com",preferred_cache:"login.windows.net",aliases:["login.microsoftonline.com","login.windows.net","login.microsoft.com","sts.windows.net"]},{preferred_network:"login.partner.microsoftonline.cn",preferred_cache:"login.partner.microsoftonline.cn",aliases:["login.partner.microsoftonline.cn","login.chinacloudapi.cn"]},{preferred_network:"login.microsoftonline.de",preferred_cache:"login.microsoftonline.de",aliases:["login.microsoftonline.de"]},{preferred_network:"login.microsoftonline.us",preferred_cache:"login.microsoftonline.us",aliases:["login.microsoftonline.us","login.usgovcloudapi.net"]},{preferred_network:"login-us.microsoftonline.com",preferred_cache:"login-us.microsoftonline.com",aliases:["login-us.microsoftonline.com"]}]},"https://login.microsoftonline.com/consumers/":{tenant_discovery_endpoint:"https://login.microsoftonline.com/consumers/v2.0/.well-known/openid-configuration","api-version":"1.1",metadata:[{preferred_network:"login.microsoftonline.com",preferred_cache:"login.windows.net",aliases:["login.microsoftonline.com","login.windows.net","login.microsoft.com","sts.windows.net"]},{preferred_network:"login.partner.microsoftonline.cn",preferred_cache:"login.partner.microsoftonline.cn",aliases:["login.partner.microsoftonline.cn","login.chinacloudapi.cn"]},{preferred_network:"login.microsoftonline.de",preferred_cache:"login.microsoftonline.de",aliases:["login.microsoftonline.de"]},{preferred_network:"login.microsoftonline.us",preferred_cache:"login.microsoftonline.us",aliases:["login.microsoftonline.us","login.usgovcloudapi.net"]},{preferred_network:"login-us.microsoftonline.com",preferred_cache:"login-us.microsoftonline.com",aliases:["login-us.microsoftonline.com"]}]},"https://login.chinacloudapi.cn/consumers/":{tenant_discovery_endpoint:"https://login.chinacloudapi.cn/consumers/v2.0/.well-known/openid-configuration","api-version":"1.1",metadata:[{preferred_network:"login.microsoftonline.com",preferred_cache:"login.windows.net",aliases:["login.microsoftonline.com","login.windows.net","login.microsoft.com","sts.windows.net"]},{preferred_network:"login.partner.microsoftonline.cn",preferred_cache:"login.partner.microsoftonline.cn",aliases:["login.partner.microsoftonline.cn","login.chinacloudapi.cn"]},{preferred_network:"login.microsoftonline.de",preferred_cache:"login.microsoftonline.de",aliases:["login.microsoftonline.de"]},{preferred_network:"login.microsoftonline.us",preferred_cache:"login.microsoftonline.us",aliases:["login.microsoftonline.us","login.usgovcloudapi.net"]},{preferred_network:"login-us.microsoftonline.com",preferred_cache:"login-us.microsoftonline.com",aliases:["login-us.microsoftonline.com"]}]},"https://login.microsoftonline.us/consumers/":{tenant_discovery_endpoint:"https://login.microsoftonline.us/consumers/v2.0/.well-known/openid-configuration","api-version":"1.1",metadata:[{preferred_network:"login.microsoftonline.com",preferred_cache:"login.windows.net",aliases:["login.microsoftonline.com","login.windows.net","login.microsoft.com","sts.windows.net"]},{preferred_network:"login.partner.microsoftonline.cn",preferred_cache:"login.partner.microsoftonline.cn",aliases:["login.partner.microsoftonline.cn","login.chinacloudapi.cn"]},{preferred_network:"login.microsoftonline.de",preferred_cache:"login.microsoftonline.de",aliases:["login.microsoftonline.de"]},{preferred_network:"login.microsoftonline.us",preferred_cache:"login.microsoftonline.us",aliases:["login.microsoftonline.us","login.usgovcloudapi.net"]},{preferred_network:"login-us.microsoftonline.com",preferred_cache:"login-us.microsoftonline.com",aliases:["login-us.microsoftonline.com"]}]},"https://login.microsoftonline.com/organizations/":{tenant_discovery_endpoint:"https://login.microsoftonline.com/organizations/v2.0/.well-known/openid-configuration","api-version":"1.1",metadata:[{preferred_network:"login.microsoftonline.com",preferred_cache:"login.windows.net",aliases:["login.microsoftonline.com","login.windows.net","login.microsoft.com","sts.windows.net"]},{preferred_network:"login.partner.microsoftonline.cn",preferred_cache:"login.partner.microsoftonline.cn",aliases:["login.partner.microsoftonline.cn","login.chinacloudapi.cn"]},{preferred_network:"login.microsoftonline.de",preferred_cache:"login.microsoftonline.de",aliases:["login.microsoftonline.de"]},{preferred_network:"login.microsoftonline.us",preferred_cache:"login.microsoftonline.us",aliases:["login.microsoftonline.us","login.usgovcloudapi.net"]},{preferred_network:"login-us.microsoftonline.com",preferred_cache:"login-us.microsoftonline.com",aliases:["login-us.microsoftonline.com"]}]},"https://login.chinacloudapi.cn/organizations/":{tenant_discovery_endpoint:"https://login.chinacloudapi.cn/organizations/v2.0/.well-known/openid-configuration","api-version":"1.1",metadata:[{preferred_network:"login.microsoftonline.com",preferred_cache:"login.windows.net",aliases:["login.microsoftonline.com","login.windows.net","login.microsoft.com","sts.windows.net"]},{preferred_network:"login.partner.microsoftonline.cn",preferred_cache:"login.partner.microsoftonline.cn",aliases:["login.partner.microsoftonline.cn","login.chinacloudapi.cn"]},{preferred_network:"login.microsoftonline.de",preferred_cache:"login.microsoftonline.de",aliases:["login.microsoftonline.de"]},{preferred_network:"login.microsoftonline.us",preferred_cache:"login.microsoftonline.us",aliases:["login.microsoftonline.us","login.usgovcloudapi.net"]},{preferred_network:"login-us.microsoftonline.com",preferred_cache:"login-us.microsoftonline.com",aliases:["login-us.microsoftonline.com"]}]},"https://login.microsoftonline.us/organizations/":{tenant_discovery_endpoint:"https://login.microsoftonline.us/organizations/v2.0/.well-known/openid-configuration","api-version":"1.1",metadata:[{preferred_network:"login.microsoftonline.com",preferred_cache:"login.windows.net",aliases:["login.microsoftonline.com","login.windows.net","login.microsoft.com","sts.windows.net"]},{preferred_network:"login.partner.microsoftonline.cn",preferred_cache:"login.partner.microsoftonline.cn",aliases:["login.partner.microsoftonline.cn","login.chinacloudapi.cn"]},{preferred_network:"login.microsoftonline.de",preferred_cache:"login.microsoftonline.de",aliases:["login.microsoftonline.de"]},{preferred_network:"login.microsoftonline.us",preferred_cache:"login.microsoftonline.us",aliases:["login.microsoftonline.us","login.usgovcloudapi.net"]},{preferred_network:"login-us.microsoftonline.com",preferred_cache:"login-us.microsoftonline.com",aliases:["login-us.microsoftonline.com"]}]}}},Zj=Kj.endpointMetadata,Xj=Kj.instanceDiscoveryMetadata,tR=(function(n){n.AAD="AAD",n.OIDC="OIDC"}(_0=_0||{}),function(){function n(){this.expiresAt=ec.nowSeconds()+g0.REFRESH_TIME_SECONDS}return n.prototype.updateCloudDiscoveryMetadata=function(e,t){this.aliases=e.aliases,this.preferred_cache=e.preferred_cache,this.preferred_network=e.preferred_network,this.aliasesFromNetwork=t},n.prototype.updateEndpointMetadata=function(e,t){this.authorization_endpoint=e.authorization_endpoint,this.token_endpoint=e.token_endpoint,this.end_session_endpoint=e.end_session_endpoint,this.issuer=e.issuer,this.endpointsFromNetwork=t,this.jwks_uri=e.jwks_uri},n.prototype.updateCanonicalAuthority=function(e){this.canonical_authority=e},n.prototype.resetExpiresAt=function(){this.expiresAt=ec.nowSeconds()+g0.REFRESH_TIME_SECONDS},n.prototype.isExpired=function(){return this.expiresAt<=ec.nowSeconds()},n.isAuthorityMetadataEntity=function(e,t){return!!t&&e.indexOf(g0.CACHE_KEY)===0&&t.hasOwnProperty("aliases")&&t.hasOwnProperty("preferred_cache")&&t.hasOwnProperty("preferred_network")&&t.hasOwnProperty("canonical_authority")&&t.hasOwnProperty("authorization_endpoint")&&t.hasOwnProperty("token_endpoint")&&t.hasOwnProperty("issuer")&&t.hasOwnProperty("aliasesFromNetwork")&&t.hasOwnProperty("endpointsFromNetwork")&&t.hasOwnProperty("expiresAt")&&t.hasOwnProperty("jwks_uri")},n}());function Vwe(n){return n.hasOwnProperty("tenant_discovery_endpoint")&&n.hasOwnProperty("metadata")}function Hwe(n){return n.hasOwnProperty("error")&&n.hasOwnProperty("error_description")}var wu,go,yl,Mr,_l,Pm,_i,hn,Qj,Jj,ts,Fn,Yh,Gwe=function(){function n(e,t,r){this.networkInterface=e,this.performanceClient=t,this.correlationId=r}return n.prototype.detectRegion=function(e,t){var r,i;return zn(this,void 0,void 0,function(){var o,a,l,h;return jn(this,function(p){switch(p.label){case 0:if((r=this.performanceClient)!=null&&r.addQueueMeasurement(nt.RegionDiscoveryDetectRegion,this.correlationId),o=e)return[3,8];a=n.IMDS_OPTIONS,p.label=1;case 1:return p.trys.push([1,6,,7]),(r=this.performanceClient)!=null&&r.setPreQueueTime(nt.RegionDiscoveryGetRegionFromIMDS,this.correlationId),[4,this.getRegionFromIMDS(Le.IMDS_VERSION,a)];case 2:return(l=p.sent()).status===Tm.httpSuccess&&(o=l.body,t.region_source=$h.IMDS),l.status!==Tm.httpBadRequest?[3,5]:((i=this.performanceClient)!=null&&i.setPreQueueTime(nt.RegionDiscoveryGetCurrentVersion,this.correlationId),[4,this.getCurrentVersion(a)]);case 3:return(l=p.sent())?((i=this.performanceClient)!=null&&i.setPreQueueTime(nt.RegionDiscoveryGetRegionFromIMDS,this.correlationId),[4,this.getRegionFromIMDS(l,a)]):(t.region_source=$h.FAILED_AUTO_DETECTION,[2,null]);case 4:(h=p.sent()).status===Tm.httpSuccess&&(o=h.body,t.region_source=$h.IMDS),p.label=5;case 5:return[3,7];case 6:return p.sent(),t.region_source=$h.FAILED_AUTO_DETECTION,[2,null];case 7:return[3,9];case 8:t.region_source=$h.ENVIRONMENT_VARIABLE,p.label=9;case 9:return o||(t.region_source=$h.FAILED_AUTO_DETECTION),[2,o||null]}})})},n.prototype.getRegionFromIMDS=function(e,t){var r;return zn(this,void 0,void 0,function(){return jn(this,function(i){return(r=this.performanceClient)!=null&&r.addQueueMeasurement(nt.RegionDiscoveryGetRegionFromIMDS,this.correlationId),[2,this.networkInterface.sendGetRequestAsync(Le.IMDS_ENDPOINT+"?api-version="+e+"&format=text",t,Le.IMDS_TIMEOUT)]})})},n.prototype.getCurrentVersion=function(e){var t;return zn(this,void 0,void 0,function(){var r;return jn(this,function(i){switch(i.label){case 0:(t=this.performanceClient)!=null&&t.addQueueMeasurement(nt.RegionDiscoveryGetCurrentVersion,this.correlationId),i.label=1;case 1:return i.trys.push([1,3,,4]),[4,this.networkInterface.sendGetRequestAsync(Le.IMDS_ENDPOINT+"?format=json",e)];case 2:return(r=i.sent()).status===Tm.httpBadRequest&&r.body&&r.body["newest-versions"]&&0<r.body["newest-versions"].length?[2,r.body["newest-versions"][0]]:[2,null];case 3:return i.sent(),[2,null];case 4:return[2]}})})},n.IMDS_OPTIONS={headers:{Metadata:"true"}},n}(),v0=function(){function n(e,t,r,i,o,a,l){this.canonicalAuthority=e,this._canonicalAuthority.validateAsUri(),this.networkInterface=t,this.cacheManager=r,this.authorityOptions=i,this.regionDiscoveryMetadata={region_used:void 0,region_source:void 0,region_outcome:void 0},this.logger=o,this.performanceClient=a,this.correlationId=l,this.regionDiscovery=new Gwe(t,this.performanceClient,this.correlationId)}return n.prototype.getAuthorityType=function(e){if(e.HostNameAndPort.endsWith(Le.CIAM_AUTH_URL))return ka.Ciam;if(e=e.PathSegments,e.length)switch(e[0].toLowerCase()){case Le.ADFS:return ka.Adfs;case Le.DSTS:return ka.Dsts}return ka.Default},Object.defineProperty(n.prototype,"authorityType",{get:function(){return this.getAuthorityType(this.canonicalAuthorityUrlComponents)},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"protocolMode",{get:function(){return this.authorityOptions.protocolMode},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"options",{get:function(){return this.authorityOptions},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"canonicalAuthority",{get:function(){return this._canonicalAuthority.urlString},set:function(e){this._canonicalAuthority=new wr(e),this._canonicalAuthority.validateAsUri(),this._canonicalAuthorityUrlComponents=null},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"canonicalAuthorityUrlComponents",{get:function(){return this._canonicalAuthorityUrlComponents||(this._canonicalAuthorityUrlComponents=this._canonicalAuthority.getUrlComponents()),this._canonicalAuthorityUrlComponents},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"hostnameAndPort",{get:function(){return this.canonicalAuthorityUrlComponents.HostNameAndPort.toLowerCase()},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"tenant",{get:function(){return this.canonicalAuthorityUrlComponents.PathSegments[0]},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"authorizationEndpoint",{get:function(){if(this.discoveryComplete())return this.replacePath(this.metadata.authorization_endpoint);throw en.createEndpointDiscoveryIncompleteError("Discovery incomplete.")},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"tokenEndpoint",{get:function(){if(this.discoveryComplete())return this.replacePath(this.metadata.token_endpoint);throw en.createEndpointDiscoveryIncompleteError("Discovery incomplete.")},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"deviceCodeEndpoint",{get:function(){if(this.discoveryComplete())return this.replacePath(this.metadata.token_endpoint.replace("/token","/devicecode"));throw en.createEndpointDiscoveryIncompleteError("Discovery incomplete.")},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"endSessionEndpoint",{get:function(){if(this.discoveryComplete()){if(this.metadata.end_session_endpoint)return this.replacePath(this.metadata.end_session_endpoint);throw en.createLogoutNotSupportedError()}throw en.createEndpointDiscoveryIncompleteError("Discovery incomplete.")},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"selfSignedJwtAudience",{get:function(){if(this.discoveryComplete())return this.replacePath(this.metadata.issuer);throw en.createEndpointDiscoveryIncompleteError("Discovery incomplete.")},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"jwksUri",{get:function(){if(this.discoveryComplete())return this.replacePath(this.metadata.jwks_uri);throw en.createEndpointDiscoveryIncompleteError("Discovery incomplete.")},enumerable:!1,configurable:!0}),n.prototype.canReplaceTenant=function(e){return e.PathSegments.length===1&&!n.reservedTenantDomains.has(e.PathSegments[0])&&this.getAuthorityType(e)===ka.Default&&this.protocolMode===_0.AAD},n.prototype.replaceTenant=function(e){return e.replace(/{tenant}|{tenantid}/g,this.tenant)},n.prototype.replacePath=function(e){var t=this,r=e,i=new wr(this.metadata.canonical_authority).getUrlComponents(),o=i.PathSegments;return this.canonicalAuthorityUrlComponents.PathSegments.forEach(function(a,l){var h=o[l];l===0&&t.canReplaceTenant(i)&&h!==(l=new wr(t.metadata.authorization_endpoint).getUrlComponents().PathSegments[0])&&(t.logger.verbose("Replacing tenant domain name "+h+" with id "+l),h=l),a!==h&&(r=r.replace("/"+h+"/","/"+a+"/"))}),this.replaceTenant(r)},Object.defineProperty(n.prototype,"defaultOpenIdConfigurationEndpoint",{get:function(){return this.authorityType===ka.Adfs||this.authorityType===ka.Dsts||this.protocolMode===_0.OIDC?this.canonicalAuthority+".well-known/openid-configuration":this.canonicalAuthority+"v2.0/.well-known/openid-configuration"},enumerable:!1,configurable:!0}),n.prototype.discoveryComplete=function(){return!!this.metadata},n.prototype.resolveEndpointsAsync=function(){var e;return zn(this,void 0,void 0,function(){var t,r,i;return jn(this,function(o){switch(o.label){case 0:return(e=this.performanceClient)!=null&&e.addQueueMeasurement(nt.AuthorityResolveEndpointsAsync,this.correlationId),(t=this.cacheManager.getAuthorityMetadataByAlias(this.hostnameAndPort))||(t=new tR).updateCanonicalAuthority(this.canonicalAuthority),(e=this.performanceClient)!=null&&e.setPreQueueTime(nt.AuthorityUpdateCloudDiscoveryMetadata,this.correlationId),[4,this.updateCloudDiscoveryMetadata(t)];case 1:return r=o.sent(),this.canonicalAuthority=this.canonicalAuthority.replace(this.hostnameAndPort,t.preferred_network),(e=this.performanceClient)!=null&&e.setPreQueueTime(nt.AuthorityUpdateEndpointMetadata,this.correlationId),[4,this.updateEndpointMetadata(t)];case 2:return i=o.sent(),r!==Js.CACHE&&i!==Js.CACHE&&(t.resetExpiresAt(),t.updateCanonicalAuthority(this.canonicalAuthority)),i=this.cacheManager.generateAuthorityMetadataCacheKey(t.preferred_cache),this.cacheManager.setAuthorityMetadata(i,t),this.metadata=t,[2]}})})},n.prototype.updateEndpointMetadata=function(e){var t,r,i;return zn(this,void 0,void 0,function(){var o,a;return jn(this,function(l){switch(l.label){case 0:return(t=this.performanceClient)!=null&&t.addQueueMeasurement(nt.AuthorityUpdateEndpointMetadata,this.correlationId),(o=this.getEndpointMetadataFromConfig())?(e.updateEndpointMetadata(o,!1),[2,Js.CONFIG]):this.isAuthoritySameType(e)&&e.endpointsFromNetwork&&!e.isExpired()?[2,Js.CACHE]:((t=this.performanceClient)!=null&&t.setPreQueueTime(nt.AuthorityGetEndpointMetadataFromNetwork,this.correlationId),[4,this.getEndpointMetadataFromNetwork()]);case 1:return(o=l.sent())?(t=this.authorityOptions.azureRegionConfiguration)!=null&&t.azureRegion?((r=this.performanceClient)!=null&&r.setPreQueueTime(nt.AuthorityUpdateMetadataWithRegionalInformation,this.correlationId),[4,this.updateMetadataWithRegionalInformation(o)]):[3,3]:[3,4];case 2:o=l.sent(),l.label=3;case 3:return e.updateEndpointMetadata(o,!0),[2,Js.NETWORK];case 4:return!(a=this.getEndpointMetadataFromHardcodedValues())||this.authorityOptions.skipAuthorityMetadataCache?[3,7]:(r=this.authorityOptions.azureRegionConfiguration)!=null&&r.azureRegion?((i=this.performanceClient)!=null&&i.setPreQueueTime(nt.AuthorityUpdateMetadataWithRegionalInformation,this.correlationId),[4,this.updateMetadataWithRegionalInformation(a)]):[3,6];case 5:a=l.sent(),l.label=6;case 6:return e.updateEndpointMetadata(a,!1),[2,Js.HARDCODED_VALUES];case 7:throw en.createUnableToGetOpenidConfigError(this.defaultOpenIdConfigurationEndpoint)}})})},n.prototype.isAuthoritySameType=function(e){return new wr(e.canonical_authority).getUrlComponents().PathSegments.length===this.canonicalAuthorityUrlComponents.PathSegments.length},n.prototype.getEndpointMetadataFromConfig=function(){if(this.authorityOptions.authorityMetadata)try{return JSON.parse(this.authorityOptions.authorityMetadata)}catch{throw yi.createInvalidAuthorityMetadataError()}return null},n.prototype.getEndpointMetadataFromNetwork=function(){var e;return zn(this,void 0,void 0,function(){var t,r;return jn(this,function(i){switch(i.label){case 0:(e=this.performanceClient)!=null&&e.addQueueMeasurement(nt.AuthorityGetEndpointMetadataFromNetwork,this.correlationId),t={},i.label=1;case 1:return i.trys.push([1,3,,4]),[4,this.networkInterface.sendGetRequestAsync(this.defaultOpenIdConfigurationEndpoint,t)];case 2:return[2,jwe((r=i.sent()).body)?r.body:null];case 3:return i.sent(),[2,null];case 4:return[2]}})})},n.prototype.getEndpointMetadataFromHardcodedValues=function(){return this.canonicalAuthority in Zj?Zj[this.canonicalAuthority]:null},n.prototype.updateMetadataWithRegionalInformation=function(e){var t;return zn(this,void 0,void 0,function(){var r;return jn(this,function(i){switch(i.label){case 0:return(t=this.performanceClient)!=null&&t.addQueueMeasurement(nt.AuthorityUpdateMetadataWithRegionalInformation,this.correlationId),(r=(t=this.authorityOptions.azureRegionConfiguration)==null?void 0:t.azureRegion)?r!==Le.AZURE_REGION_AUTO_DISCOVER_FLAG?(this.regionDiscoveryMetadata.region_outcome=h0.CONFIGURED_NO_AUTO_DETECTION,this.regionDiscoveryMetadata.region_used=r,[2,n.replaceWithRegionalInformation(e,r)]):((t=this.performanceClient)!=null&&t.setPreQueueTime(nt.RegionDiscoveryDetectRegion,this.correlationId),[4,this.regionDiscovery.detectRegion((t=this.authorityOptions.azureRegionConfiguration)==null?void 0:t.environmentRegion,this.regionDiscoveryMetadata)]):[3,2];case 1:if(r=i.sent())return this.regionDiscoveryMetadata.region_outcome=h0.AUTO_DETECTION_REQUESTED_SUCCESSFUL,this.regionDiscoveryMetadata.region_used=r,[2,n.replaceWithRegionalInformation(e,r)];this.regionDiscoveryMetadata.region_outcome=h0.AUTO_DETECTION_REQUESTED_FAILED,i.label=2;case 2:return[2,e]}})})},n.prototype.updateCloudDiscoveryMetadata=function(e){var t;return zn(this,void 0,void 0,function(){var r,i;return jn(this,function(o){switch(o.label){case 0:return(t=this.performanceClient)!=null&&t.addQueueMeasurement(nt.AuthorityUpdateCloudDiscoveryMetadata,this.correlationId),this.logger.verbose("Attempting to get cloud discovery metadata in the config"),this.logger.verbosePii("Known Authorities: "+(this.authorityOptions.knownAuthorities||Le.NOT_APPLICABLE)),this.logger.verbosePii("Authority Metadata: "+(this.authorityOptions.authorityMetadata||Le.NOT_APPLICABLE)),this.logger.verbosePii("Canonical Authority: "+(e.canonical_authority||Le.NOT_APPLICABLE)),(r=this.getCloudDiscoveryMetadataFromConfig())?(this.logger.verbose("Found cloud discovery metadata in the config."),e.updateCloudDiscoveryMetadata(r,!1),[2,Js.CONFIG]):(this.logger.verbose("Did not find cloud discovery metadata in the config... Attempting to get cloud discovery metadata from the cache."),i=e.isExpired(),this.isAuthoritySameType(e)&&e.aliasesFromNetwork&&!i?(this.logger.verbose("Found metadata in the cache."),[2,Js.CACHE]):(i&&this.logger.verbose("The metadata entity is expired."),this.logger.verbose("Did not find cloud discovery metadata in the cache... Attempting to get cloud discovery metadata from the network."),(t=this.performanceClient)!=null&&t.setPreQueueTime(nt.AuthorityGetCloudDiscoveryMetadataFromNetwork,this.correlationId),[4,this.getCloudDiscoveryMetadataFromNetwork()]));case 1:if(r=o.sent())return this.logger.verbose("cloud discovery metadata was successfully returned from getCloudDiscoveryMetadataFromNetwork()"),e.updateCloudDiscoveryMetadata(r,!0),[2,Js.NETWORK];if(this.logger.verbose("Did not find cloud discovery metadata from the network... Attempting to get cloud discovery metadata from hardcoded values."),(i=this.getCloudDiscoveryMetadataFromHarcodedValues())&&!this.options.skipAuthorityMetadataCache)return this.logger.verbose("Found cloud discovery metadata from hardcoded values."),e.updateCloudDiscoveryMetadata(i,!1),[2,Js.HARDCODED_VALUES];throw this.logger.error("Did not find cloud discovery metadata from hardcoded values... Metadata could not be obtained from config, cache, network or hardcoded values. Throwing Untrusted Authority Error."),yi.createUntrustedAuthorityError()}})})},n.prototype.getCloudDiscoveryMetadataFromConfig=function(){if(this.authorityType===ka.Ciam)return this.logger.verbose("CIAM authorities do not support cloud discovery metadata, generate the aliases from authority host."),n.createCloudDiscoveryMetadataFromHost(this.hostnameAndPort);if(this.authorityOptions.cloudDiscoveryMetadata){this.logger.verbose("The cloud discovery metadata has been provided as a network response, in the config.");try{this.logger.verbose("Attempting to parse the cloud discovery metadata.");var e=JSON.parse(this.authorityOptions.cloudDiscoveryMetadata),t=n.getCloudDiscoveryMetadataFromNetworkResponse(e.metadata,this.hostnameAndPort);if(this.logger.verbose("Parsed the cloud discovery metadata."),t)return this.logger.verbose("There is returnable metadata attached to the parsed cloud discovery metadata."),t;this.logger.verbose("There is no metadata attached to the parsed cloud discovery metadata.")}catch{throw this.logger.verbose("Unable to parse the cloud discovery metadata. Throwing Invalid Cloud Discovery Metadata Error."),yi.createInvalidCloudDiscoveryMetadataError()}}return this.isInKnownAuthorities()?(this.logger.verbose("The host is included in knownAuthorities. Creating new cloud discovery metadata from the host."),n.createCloudDiscoveryMetadataFromHost(this.hostnameAndPort)):null},n.prototype.getCloudDiscoveryMetadataFromNetwork=function(){var e;return zn(this,void 0,void 0,function(){var t,r,i,o,a,l;return jn(this,function(h){switch(h.label){case 0:(e=this.performanceClient)!=null&&e.addQueueMeasurement(nt.AuthorityGetCloudDiscoveryMetadataFromNetwork,this.correlationId),t=""+Le.AAD_INSTANCE_DISCOVERY_ENDPT+this.canonicalAuthority+"oauth2/v2.0/authorize",r={},i=null,h.label=1;case 1:return h.trys.push([1,3,,4]),[4,this.networkInterface.sendGetRequestAsync(t,r)];case 2:if(l=h.sent(),a=o=void 0,Vwe(l.body))o=l.body,a=o.metadata,this.logger.verbosePii("tenant_discovery_endpoint is: "+o.tenant_discovery_endpoint);else{if(!Hwe(l.body))return this.logger.error("AAD did not return a CloudInstanceDiscoveryResponse or CloudInstanceDiscoveryErrorResponse"),[2,null];if(this.logger.warning("A CloudInstanceDiscoveryErrorResponse was returned. The cloud instance discovery network request's status code is: "+l.status),(o=l.body).error===Le.INVALID_INSTANCE)return this.logger.error("The CloudInstanceDiscoveryErrorResponse error is invalid_instance."),[2,null];this.logger.warning("The CloudInstanceDiscoveryErrorResponse error is "+o.error),this.logger.warning("The CloudInstanceDiscoveryErrorResponse error description is "+o.error_description),this.logger.warning("Setting the value of the CloudInstanceDiscoveryMetadata (returned from the network) to []"),a=[]}return this.logger.verbose("Attempting to find a match between the developer's authority and the CloudInstanceDiscoveryMetadata returned from the network request."),i=n.getCloudDiscoveryMetadataFromNetworkResponse(a,this.hostnameAndPort),[3,4];case 3:return(l=h.sent())instanceof wn?this.logger.error(`There was a network error while attempting to get the cloud discovery instance metadata.
Error: `+l.errorCode+`
Error Description: `+l.errorMessage):this.logger.error(`A non-MSALJS error was thrown while attempting to get the cloud instance discovery metadata.
Error: `+l.name+`
Error Description: `+l.message),[2,null];case 4:return i||(this.logger.warning("The developer's authority was not found within the CloudInstanceDiscoveryMetadata returned from the network request."),this.logger.verbose("Creating custom Authority for custom domain scenario."),i=n.createCloudDiscoveryMetadataFromHost(this.hostnameAndPort)),[2,i]}})})},n.prototype.getCloudDiscoveryMetadataFromHarcodedValues=function(){return this.canonicalAuthority in Xj?Xj[this.canonicalAuthority]:null},n.prototype.isInKnownAuthorities=function(){var e=this;return 0<this.authorityOptions.knownAuthorities.filter(function(t){return wr.getDomainFromUrl(t).toLowerCase()===e.hostnameAndPort}).length},n.generateAuthority=function(e,t){var r;return t&&t.azureCloudInstance!==d0.None&&(r=t.tenant||Le.DEFAULT_COMMON_TENANT,r=t.azureCloudInstance+"/"+r+"/"),r||e},n.createCloudDiscoveryMetadataFromHost=function(e){return{preferred_network:e,preferred_cache:e,aliases:[e]}},n.getCloudDiscoveryMetadataFromNetworkResponse=function(e,t){for(var r=0;r<e.length;r++){var i=e[r];if(-1<i.aliases.indexOf(t))return i}return null},n.prototype.getPreferredCache=function(){if(this.discoveryComplete())return this.metadata.preferred_cache;throw en.createEndpointDiscoveryIncompleteError("Discovery incomplete.")},n.prototype.isAlias=function(e){return-1<this.metadata.aliases.indexOf(e)},n.isPublicCloudAuthority=function(e){return 0<=Le.KNOWN_PUBLIC_CLOUDS.indexOf(e)},n.buildRegionalAuthorityString=function(i,t,r){var i=new wr(i),a=(i.validateAsUri(),i.getUrlComponents()),o=t+"."+a.HostNameAndPort,a=(this.isPublicCloudAuthority(a.HostNameAndPort)&&(o=t+"."+Le.REGIONAL_AUTH_PUBLIC_CLOUD_SUFFIX),wr.constructAuthorityUriFromObject(Gr(Gr({},i.getUrlComponents()),{HostNameAndPort:o})).urlString);return r?a+"?"+r:a},n.replaceWithRegionalInformation=function(e,t){return e.authorization_endpoint=n.buildRegionalAuthorityString(e.authorization_endpoint,t),e.token_endpoint=n.buildRegionalAuthorityString(e.token_endpoint,t,Le.REGIONAL_AUTH_NON_MSI_QUERY_STRING),e.end_session_endpoint&&(e.end_session_endpoint=n.buildRegionalAuthorityString(e.end_session_endpoint,t)),e},n.transformCIAMAuthority=function(r){var t=r.endsWith(Le.FORWARD_SLASH)?r:""+r+Le.FORWARD_SLASH,r=new wr(r).getUrlComponents();return t=r.PathSegments.length===0&&r.HostNameAndPort.endsWith(Le.CIAM_AUTH_URL)?""+t+r.HostNameAndPort.split(".")[0]+Le.AAD_TENANT_DOMAIN_SUFFIX:t},n.reservedTenantDomains=new Set(["{tenant}","{tenantid}",$f.COMMON,$f.CONSUMERS,$f.ORGANIZATIONS]),n}(),ME=function(){function n(){}return n.createDiscoveredInstance=function(e,t,r,i,o,a,l){return zn(this,void 0,void 0,function(){var h,p;return jn(this,function(g){switch(g.label){case 0:a!=null&&a.addQueueMeasurement(nt.AuthorityFactoryCreateDiscoveredInstance,l),h=v0.transformCIAMAuthority(e),h=n.createInstance(h,t,r,i,o,a,l),g.label=1;case 1:return g.trys.push([1,3,,4]),a!=null&&a.setPreQueueTime(nt.AuthorityResolveEndpointsAsync,l),[4,h.resolveEndpointsAsync()];case 2:return g.sent(),[2,h];case 3:throw p=g.sent(),en.createEndpointDiscoveryIncompleteError(p);case 4:return[2]}})})},n.createInstance=function(e,t,r,i,o,a,l){if(Kt.isEmpty(e))throw yi.createUrlEmptyError();return new v0(e,t,r,i,o,a,l)},n}(),RE=function(){function n(){this.failedRequests=[],this.errors=[],this.cacheHits=0}return n.isServerTelemetryEntity=function(r,t){var r=r.indexOf(Xo.CACHE_KEY)===0,i=!0;return t&&(i=t.hasOwnProperty("failedRequests")&&t.hasOwnProperty("errors")&&t.hasOwnProperty("cacheHits")),r&&i},n}(),e9=function(){function n(){}return n.isThrottlingEntity=function(i,t){var r=!1,i=(i&&(r=i.indexOf(m0.THROTTLING_PREFIX)===0),!0);return t&&(i=t.hasOwnProperty("throttleTime")),r&&i},n}(),qwe={sendGetRequestAsync:function(){return Promise.reject(wn.createUnexpectedError("Network interface - sendGetRequestAsync() has not been implemented for the Network interface."))},sendPostRequestAsync:function(){return Promise.reject(wn.createUnexpectedError("Network interface - sendPostRequestAsync() has not been implemented for the Network interface."))}},kE={missingKidError:{code:"missing_kid_error",desc:"The JOSE Header for the requested JWT, JWS or JWK object requires a keyId to be configured as the 'kid' header claim. No 'kid' value was provided."},missingAlgError:{code:"missing_alg_error",desc:"The JOSE Header for the requested JWT, JWS or JWK object requires an algorithm to be specified as the 'alg' header claim. No 'alg' value was provided."}},t9=function(n){function e(t,r){return t=n.call(this,t,r)||this,t.name="JoseHeaderError",Object.setPrototypeOf(t,e.prototype),t}return Ja(e,n),e.createMissingKidError=function(){return new e(kE.missingKidError.code,kE.missingKidError.desc)},e.createMissingAlgError=function(){return new e(kE.missingAlgError.code,kE.missingAlgError.desc)},e}(wn),$we=function(){function n(e){this.typ=e.typ,this.alg=e.alg,this.kid=e.kid}return n.getShrHeaderString=function(e){if(!e.kid)throw t9.createMissingKidError();if(e.alg)return e=new n({typ:e.typ||WM.Pop,kid:e.kid,alg:e.alg}),JSON.stringify(e);throw t9.createMissingAlgError()},n}(),Wwe=function(){function n(e,t){this.cacheOutcome=Wh.NO_CACHE_HIT,this.cacheManager=t,this.apiId=e.apiId,this.correlationId=e.correlationId,this.wrapperSKU=e.wrapperSKU||Le.EMPTY_STRING,this.wrapperVer=e.wrapperVer||Le.EMPTY_STRING,this.telemetryCacheKey=Xo.CACHE_KEY+Eo.CACHE_KEY_SEPARATOR+e.clientId}return n.prototype.generateCurrentRequestHeaderValue=function(){var t=""+this.apiId+Xo.VALUE_SEPARATOR+this.cacheOutcome,e=[this.wrapperSKU,this.wrapperVer].join(Xo.VALUE_SEPARATOR),t=[t,this.getRegionDiscoveryFields()].join(Xo.VALUE_SEPARATOR);return[Xo.SCHEMA_VERSION,t,e].join(Xo.CATEGORY_SEPARATOR)},n.prototype.generateLastRequestHeaderValue=function(){var e=this.getLastRequests(),o=n.maxErrorsToSend(e),t=e.failedRequests.slice(0,2*o).join(Xo.VALUE_SEPARATOR),r=e.errors.slice(0,o).join(Xo.VALUE_SEPARATOR),i=e.errors.length,o=[i,o<i?Xo.OVERFLOW_TRUE:Xo.OVERFLOW_FALSE].join(Xo.VALUE_SEPARATOR);return[Xo.SCHEMA_VERSION,e.cacheHits,t,r,o].join(Xo.CATEGORY_SEPARATOR)},n.prototype.cacheFailedRequest=function(e){var t=this.getLastRequests();t.errors.length>=Xo.MAX_CACHED_ERRORS&&(t.failedRequests.shift(),t.failedRequests.shift(),t.errors.shift()),t.failedRequests.push(this.apiId,this.correlationId),Kt.isEmpty(e.subError)?Kt.isEmpty(e.errorCode)?e&&e.toString()?t.errors.push(e.toString()):t.errors.push(Xo.UNKNOWN_ERROR):t.errors.push(e.errorCode):t.errors.push(e.subError),this.cacheManager.setServerTelemetry(this.telemetryCacheKey,t)},n.prototype.incrementCacheHits=function(){var e=this.getLastRequests();return e.cacheHits+=1,this.cacheManager.setServerTelemetry(this.telemetryCacheKey,e),e.cacheHits},n.prototype.getLastRequests=function(){var e=new RE;return this.cacheManager.getServerTelemetry(this.telemetryCacheKey)||e},n.prototype.clearTelemetryCache=function(){var e,t=this.getLastRequests(),r=n.maxErrorsToSend(t);r===t.errors.length?this.cacheManager.removeItem(this.telemetryCacheKey):((e=new RE).failedRequests=t.failedRequests.slice(2*r),e.errors=t.errors.slice(r),this.cacheManager.setServerTelemetry(this.telemetryCacheKey,e))},n.maxErrorsToSend=function(e){for(var t=0,r=0,i=e.errors.length,o=0;o<i;o++){var a=e.failedRequests[2*o]||Le.EMPTY_STRING,l=e.failedRequests[2*o+1]||Le.EMPTY_STRING,h=e.errors[o]||Le.EMPTY_STRING;if(!((r+=a.toString().length+l.toString().length+h.length+3)<Xo.MAX_LAST_HEADER_BYTES))break;t+=1}return t},n.prototype.getRegionDiscoveryFields=function(){var e=[];return e.push(this.regionUsed||Le.EMPTY_STRING),e.push(this.regionSource||Le.EMPTY_STRING),e.push(this.regionOutcome||Le.EMPTY_STRING),e.join(",")},n.prototype.updateRegionDiscoveryMetadata=function(e){this.regionUsed=e.region_used,this.regionSource=e.region_source,this.regionOutcome=e.region_outcome},n.prototype.setCacheOutcome=function(e){this.cacheOutcome=e},n}(),n9=function(){function n(e,t,r,i,o,a){this.authority=t,this.libraryName=i,this.libraryVersion=o,this.applicationTelemetry=a,this.clientId=e,this.logger=r,this.callbacks=new Map,this.eventsByCorrelationId=new Map,this.queueMeasurements=new Map,this.preQueueTimeByCorrelationId=new Map}return n.prototype.startPerformanceMeasurement=function(e,t){return{}},n.prototype.startPerformanceMeasuremeant=function(e,t){return{}},n.prototype.getIntFields=function(){return Bwe},n.prototype.getPreQueueTime=function(e,t){var r=this.preQueueTimeByCorrelationId.get(t);if(r){if(r.name===e)return r.time;this.logger.trace("PerformanceClient.getPreQueueTime: no pre-queue time found for "+e+", unable to add queue measurement")}else this.logger.trace("PerformanceClient.getPreQueueTime: no pre-queue times found for correlationId: "+t+", unable to add queue measurement")},n.prototype.calculateQueuedTime=function(e,t){return e<1?(this.logger.trace("PerformanceClient: preQueueTime should be a positive integer and not "+e),0):t<1?(this.logger.trace("PerformanceClient: currentTime should be a positive integer and not "+t),0):t<e?(this.logger.trace("PerformanceClient: currentTime is less than preQueueTime, check how time is being retrieved"),0):t-e},n.prototype.addQueueMeasurement=function(e,t,r,i){if(t){if(r===0)this.logger.trace("PerformanceClient.addQueueMeasurement: queue time provided for "+e+" is "+r);else if(!r)return void this.logger.trace("PerformanceClient.addQueueMeasurement: no queue time provided for "+e);r={eventName:e,queueTime:r,manuallyCompleted:i},i=this.queueMeasurements.get(t),i?(i.push(r),this.queueMeasurements.set(t,i)):(this.logger.trace("PerformanceClient.addQueueMeasurement: adding correlationId "+t+" to queue measurements"),this.queueMeasurements.set(t,[r])),this.preQueueTimeByCorrelationId.delete(t)}else this.logger.trace("PerformanceClient.addQueueMeasurement: correlationId not provided for "+e+", cannot add queue measurement")},n.prototype.startMeasurement=function(e,t){var r=this,i=t||this.generateId(),o=(t||this.logger.info("PerformanceClient: No correlation id provided for "+e+", generating",i),this.logger.trace("PerformanceClient: Performance measurement started for "+e,i),this.startPerformanceMeasuremeant(e,i)),a=(o.startMeasurement(),{eventId:this.generateId(),status:CE.InProgress,authority:this.authority,libraryName:this.libraryName,libraryVersion:this.libraryVersion,clientId:this.clientId,name:e,startTimeMs:Date.now(),correlationId:i,appName:(t=this.applicationTelemetry)==null?void 0:t.appName,appVersion:(e=this.applicationTelemetry)==null?void 0:e.appVersion});return this.cacheEventByCorrelationId(a),{endMeasurement:function(l){return r.endMeasurement(Gr(Gr({},a),l),o)},discardMeasurement:function(){return r.discardMeasurements(a.correlationId)},addStaticFields:function(l){return r.addStaticFields(l,a.correlationId)},increment:function(l){return r.increment(l,a.correlationId)},measurement:o,event:a}},n.prototype.endMeasurement=function(e,t){var r,i,o,a,l,h=this,p=this.eventsByCorrelationId.get(e.correlationId);return p?(i={totalQueueTime:0,totalQueueCount:0,manuallyCompletedCount:0},(r=e.eventId===p.eventId)?(i=this.getQueueInfo(e.correlationId),this.discardCache(p.correlationId)):(o=p.incompleteSubMeasurements)!=null&&o.delete(e.eventId),t!=null&&t.endMeasurement(),(o=t==null?void 0:t.flushMeasurement())?(this.logger.trace("PerformanceClient: Performance measurement ended for "+e.name+": "+o+" ms",e.correlationId),r?(a=Gr(Gr({},p),e),l=0,(t=a.incompleteSubMeasurements)!=null&&t.forEach(function(g){h.logger.trace("PerformanceClient: Incomplete submeasurement "+g.name+" found for "+e.name,a.correlationId),l++}),a.incompleteSubMeasurements=void 0,a=Gr(Gr({},a),{durationMs:Math.round(o),queuedTimeMs:i.totalQueueTime,queuedCount:i.totalQueueCount,queuedManuallyCompletedCount:i.manuallyCompletedCount,status:CE.Completed,incompleteSubsCount:l}),this.truncateIntegralFields(a,this.getIntFields()),this.emitEvents([a],e.correlationId),a):(p[e.name+"DurationMs"]=Math.floor(o),Gr({},p))):(this.logger.trace("PerformanceClient: Performance measurement not taken",p.correlationId),null)):(this.logger.trace("PerformanceClient: Measurement not found for "+e.eventId,e.correlationId),null)},n.prototype.addStaticFields=function(e,t){this.logger.trace("PerformanceClient: Updating static fields");var r=this.eventsByCorrelationId.get(t);r?this.eventsByCorrelationId.set(t,Gr(Gr({},r),e)):this.logger.trace("PerformanceClient: Event not found for",t)},n.prototype.increment=function(e,t){this.logger.trace("PerformanceClient: Updating counters");var r=this.eventsByCorrelationId.get(t);if(r)for(var i in e)r.hasOwnProperty(i)||(r[i]=0),r[i]+=e[i];else this.logger.trace("PerformanceClient: Event not found for",t)},n.prototype.cacheEventByCorrelationId=function(e){var t=this.eventsByCorrelationId.get(e.correlationId);t?(this.logger.trace("PerformanceClient: Performance measurement for "+e.name+" added/updated",e.correlationId),t.incompleteSubMeasurements=t.incompleteSubMeasurements||new Map,t.incompleteSubMeasurements.set(e.eventId,{name:e.name,startTimeMs:e.startTimeMs})):(this.logger.trace("PerformanceClient: Performance measurement for "+e.name+" started",e.correlationId),this.eventsByCorrelationId.set(e.correlationId,Gr({},e)))},n.prototype.getQueueInfo=function(e){var t=this.queueMeasurements.get(e),r=(t||this.logger.trace("PerformanceClient: no queue measurements found for for correlationId: "+e),0),i=0,o=0;return t!=null&&t.forEach(function(a){r+=a.queueTime,i++,o+=a.manuallyCompleted?1:0}),{totalQueueTime:r,totalQueueCount:i,manuallyCompletedCount:o}},n.prototype.discardMeasurements=function(e){this.logger.trace("PerformanceClient: Performance measurements discarded",e),this.eventsByCorrelationId.delete(e)},n.prototype.discardCache=function(e){this.discardMeasurements(e),this.logger.trace("PerformanceClient: QueueMeasurements discarded",e),this.queueMeasurements.delete(e),this.logger.trace("PerformanceClient: Pre-queue times discarded",e),this.preQueueTimeByCorrelationId.delete(e)},n.prototype.addPerformanceCallback=function(e){var t=this.generateId();return this.callbacks.set(t,e),this.logger.verbose("PerformanceClient: Performance callback registered with id: "+t),t},n.prototype.removePerformanceCallback=function(e){var t=this.callbacks.delete(e);return t?this.logger.verbose("PerformanceClient: Performance callback "+e+" removed."):this.logger.verbose("PerformanceClient: Performance callback "+e+" not removed."),t},n.prototype.emitEvents=function(e,t){var r=this;this.logger.verbose("PerformanceClient: Emitting performance events",t),this.callbacks.forEach(function(i,o){r.logger.trace("PerformanceClient: Emitting event to callback "+o,t),i.apply(null,[e])})},n.prototype.truncateIntegralFields=function(e,t){t.forEach(function(r){r in e&&typeof e[r]=="number"&&(e[r]=Math.floor(e[r]))})},n}(),r9=function(){function n(){}return n.prototype.startMeasurement=function(){},n.prototype.endMeasurement=function(){},n.prototype.flushMeasurement=function(){return null},n}(),Ywe=function(n){function e(){return n!==null&&n.apply(this,arguments)||this}return Ja(e,n),e.prototype.generateId=function(){return"callback-id"},e.prototype.startPerformanceMeasuremeant=function(){return new r9},e.prototype.startPerformanceMeasurement=function(){return new r9},e.prototype.calculateQueuedTime=function(t,r){return 0},e.prototype.addQueueMeasurement=function(t,r,i){},e.prototype.setPreQueueTime=function(t,r){},e}(n9),It={pkceNotGenerated:{code:"pkce_not_created",desc:"The PKCE code challenge and verifier could not be generated."},cryptoDoesNotExist:{code:"crypto_nonexistent",desc:"The crypto object or function is not available."},httpMethodNotImplementedError:{code:"http_method_not_implemented",desc:"The HTTP method given has not been implemented in this library."},emptyNavigateUriError:{code:"empty_navigate_uri",desc:"Navigation URI is empty. Please check stack trace for more info."},hashEmptyError:{code:"hash_empty_error",desc:"Hash value cannot be processed because it is empty. Please verify that your redirectUri is not clearing the hash. For more visit: aka.ms/msaljs/browser-errors."},hashDoesNotContainStateError:{code:"no_state_in_hash",desc:"Hash does not contain state. Please verify that the request originated from msal."},hashDoesNotContainKnownPropertiesError:{code:"hash_does_not_contain_known_properties",desc:"Hash does not contain known properites. Please verify that your redirectUri is not changing the hash. For more visit: aka.ms/msaljs/browser-errors."},unableToParseStateError:{code:"unable_to_parse_state",desc:"Unable to parse state. Please verify that the request originated from msal."},stateInteractionTypeMismatchError:{code:"state_interaction_type_mismatch",desc:"Hash contains state but the interaction type does not match the caller."},interactionInProgress:{code:"interaction_in_progress",desc:"Interaction is currently in progress. Please ensure that this interaction has been completed before calling an interactive API.  For more visit: aka.ms/msaljs/browser-errors."},popupWindowError:{code:"popup_window_error",desc:"Error opening popup window. This can happen if you are using IE or if popups are blocked in the browser."},emptyWindowError:{code:"empty_window_error",desc:"window.open returned null or undefined window object."},userCancelledError:{code:"user_cancelled",desc:"User cancelled the flow."},monitorPopupTimeoutError:{code:"monitor_window_timeout",desc:"Token acquisition in popup failed due to timeout. For more visit: aka.ms/msaljs/browser-errors."},monitorIframeTimeoutError:{code:"monitor_window_timeout",desc:"Token acquisition in iframe failed due to timeout. For more visit: aka.ms/msaljs/browser-errors."},redirectInIframeError:{code:"redirect_in_iframe",desc:"Redirects are not supported for iframed or brokered applications. Please ensure you are using MSAL.js in a top frame of the window if using the redirect APIs, or use the popup APIs."},blockTokenRequestsInHiddenIframeError:{code:"block_iframe_reload",desc:"Request was blocked inside an iframe because MSAL detected an authentication response. For more visit: aka.ms/msaljs/browser-errors"},blockAcquireTokenInPopupsError:{code:"block_nested_popups",desc:"Request was blocked inside a popup because MSAL detected it was running in a popup."},iframeClosedPrematurelyError:{code:"iframe_closed_prematurely",desc:"The iframe being monitored was closed prematurely."},silentLogoutUnsupportedError:{code:"silent_logout_unsupported",desc:"Silent logout not supported. Please call logoutRedirect or logoutPopup instead."},noAccountError:{code:"no_account_error",desc:"No account object provided to acquireTokenSilent and no active account has been set. Please call setActiveAccount or provide an account on the request."},silentPromptValueError:{code:"silent_prompt_value_error",desc:"The value given for the prompt value is not valid for silent requests - must be set to 'none' or 'no_session'."},noTokenRequestCacheError:{code:"no_token_request_cache_error",desc:"No token request found in cache."},unableToParseTokenRequestCacheError:{code:"unable_to_parse_token_request_cache_error",desc:"The cached token request could not be parsed."},noCachedAuthorityError:{code:"no_cached_authority_error",desc:"No cached authority found."},authRequestNotSet:{code:"auth_request_not_set_error",desc:"Auth Request not set. Please ensure initiateAuthRequest was called from the InteractionHandler"},invalidCacheType:{code:"invalid_cache_type",desc:"Invalid cache type"},notInBrowserEnvironment:{code:"non_browser_environment",desc:"Login and token requests are not supported in non-browser environments."},databaseNotOpen:{code:"database_not_open",desc:"Database is not open!"},noNetworkConnectivity:{code:"no_network_connectivity",desc:"No network connectivity. Check your internet connection."},postRequestFailed:{code:"post_request_failed",desc:"Network request failed: If the browser threw a CORS error, check that the redirectUri is registered in the Azure App Portal as type 'SPA'"},getRequestFailed:{code:"get_request_failed",desc:"Network request failed. Please check the network trace to determine root cause."},failedToParseNetworkResponse:{code:"failed_to_parse_response",desc:"Failed to parse network response. Check network trace."},unableToLoadTokenError:{code:"unable_to_load_token",desc:"Error loading token to cache."},signingKeyNotFoundInStorage:{code:"crypto_key_not_found",desc:"Cryptographic Key or Keypair not found in browser storage."},authCodeRequired:{code:"auth_code_required",desc:"An authorization code must be provided (as the `code` property on the request) to this flow."},authCodeOrNativeAccountRequired:{code:"auth_code_or_nativeAccountId_required",desc:"An authorization code or nativeAccountId must be provided to this flow."},spaCodeAndNativeAccountPresent:{code:"spa_code_and_nativeAccountId_present",desc:"Request cannot contain both spa code and native account id."},databaseUnavailable:{code:"database_unavailable",desc:"IndexedDB, which is required for persistent cryptographic key storage, is unavailable. This may be caused by browser privacy features which block persistent storage in third-party contexts."},unableToAcquireTokenFromNativePlatform:{code:"unable_to_acquire_token_from_native_platform",desc:"Unable to acquire token from native platform. For a list of possible reasons visit aka.ms/msaljs/browser-errors."},nativeHandshakeTimeout:{code:"native_handshake_timeout",desc:"Timed out while attempting to establish connection to browser extension"},nativeExtensionNotInstalled:{code:"native_extension_not_installed",desc:"Native extension is not installed. If you think this is a mistake call the initialize function."},nativeConnectionNotEstablished:{code:"native_connection_not_established",desc:"Connection to native platform has not been established. Please install a compatible browser extension and run initialize(). For more please visit aka.ms/msaljs/browser-errors."},nativeBrokerCalledBeforeInitialize:{code:"native_broker_called_before_initialize",desc:"You must call and await the initialize function before attempting to call any other MSAL API when native brokering is enabled. For more please visit aka.ms/msaljs/browser-errors."},nativePromptNotSupported:{code:"native_prompt_not_supported",desc:"The provided prompt is not supported by the native platform. This request should be routed to the web based flow."}},Vt=function(n){function e(t,r){return t=n.call(this,t,r)||this,Object.setPrototypeOf(t,e.prototype),t.name="BrowserAuthError",t}return Zo(e,n),e.createPkceNotGeneratedError=function(t){return new e(It.pkceNotGenerated.code,It.pkceNotGenerated.desc+" Detail:"+t)},e.createCryptoNotAvailableError=function(t){return new e(It.cryptoDoesNotExist.code,It.cryptoDoesNotExist.desc+" Detail:"+t)},e.createHttpMethodNotImplementedError=function(t){return new e(It.httpMethodNotImplementedError.code,It.httpMethodNotImplementedError.desc+" Given Method: "+t)},e.createEmptyNavigationUriError=function(){return new e(It.emptyNavigateUriError.code,It.emptyNavigateUriError.desc)},e.createEmptyHashError=function(t){return new e(It.hashEmptyError.code,It.hashEmptyError.desc+" Given Url: "+t)},e.createHashDoesNotContainStateError=function(){return new e(It.hashDoesNotContainStateError.code,It.hashDoesNotContainStateError.desc)},e.createHashDoesNotContainKnownPropertiesError=function(){return new e(It.hashDoesNotContainKnownPropertiesError.code,It.hashDoesNotContainKnownPropertiesError.desc)},e.createUnableToParseStateError=function(){return new e(It.unableToParseStateError.code,It.unableToParseStateError.desc)},e.createStateInteractionTypeMismatchError=function(){return new e(It.stateInteractionTypeMismatchError.code,It.stateInteractionTypeMismatchError.desc)},e.createInteractionInProgressError=function(){return new e(It.interactionInProgress.code,It.interactionInProgress.desc)},e.createPopupWindowError=function(t){var r=It.popupWindowError.desc,r=Kt.isEmpty(t)?r:r+" Details: "+t;return new e(It.popupWindowError.code,r)},e.createEmptyWindowCreatedError=function(){return new e(It.emptyWindowError.code,It.emptyWindowError.desc)},e.createUserCancelledError=function(){return new e(It.userCancelledError.code,It.userCancelledError.desc)},e.createMonitorPopupTimeoutError=function(){return new e(It.monitorPopupTimeoutError.code,It.monitorPopupTimeoutError.desc)},e.createMonitorIframeTimeoutError=function(){return new e(It.monitorIframeTimeoutError.code,It.monitorIframeTimeoutError.desc)},e.createRedirectInIframeError=function(t){return new e(It.redirectInIframeError.code,It.redirectInIframeError.desc+" (window.parent !== window) => "+t)},e.createBlockReloadInHiddenIframeError=function(){return new e(It.blockTokenRequestsInHiddenIframeError.code,It.blockTokenRequestsInHiddenIframeError.desc)},e.createBlockAcquireTokenInPopupsError=function(){return new e(It.blockAcquireTokenInPopupsError.code,It.blockAcquireTokenInPopupsError.desc)},e.createIframeClosedPrematurelyError=function(){return new e(It.iframeClosedPrematurelyError.code,It.iframeClosedPrematurelyError.desc)},e.createSilentLogoutUnsupportedError=function(){return new e(It.silentLogoutUnsupportedError.code,It.silentLogoutUnsupportedError.desc)},e.createNoAccountError=function(){return new e(It.noAccountError.code,It.noAccountError.desc)},e.createSilentPromptValueError=function(t){return new e(It.silentPromptValueError.code,It.silentPromptValueError.desc+" Given value: "+t)},e.createUnableToParseTokenRequestCacheError=function(){return new e(It.unableToParseTokenRequestCacheError.code,It.unableToParseTokenRequestCacheError.desc)},e.createNoTokenRequestCacheError=function(){return new e(It.noTokenRequestCacheError.code,It.noTokenRequestCacheError.desc)},e.createAuthRequestNotSetError=function(){return new e(It.authRequestNotSet.code,It.authRequestNotSet.desc)},e.createNoCachedAuthorityError=function(){return new e(It.noCachedAuthorityError.code,It.noCachedAuthorityError.desc)},e.createInvalidCacheTypeError=function(){return new e(It.invalidCacheType.code,""+It.invalidCacheType.desc)},e.createNonBrowserEnvironmentError=function(){return new e(It.notInBrowserEnvironment.code,It.notInBrowserEnvironment.desc)},e.createDatabaseNotOpenError=function(){return new e(It.databaseNotOpen.code,It.databaseNotOpen.desc)},e.createNoNetworkConnectivityError=function(){return new e(It.noNetworkConnectivity.code,It.noNetworkConnectivity.desc)},e.createPostRequestFailedError=function(t,r){return new e(It.postRequestFailed.code,It.postRequestFailed.desc+" | Network client threw: "+t+" | Attempted to reach: "+r.split("?")[0])},e.createGetRequestFailedError=function(t,r){return new e(It.getRequestFailed.code,It.getRequestFailed.desc+" | Network client threw: "+t+" | Attempted to reach: "+r.split("?")[0])},e.createFailedToParseNetworkResponseError=function(t){return new e(It.failedToParseNetworkResponse.code,It.failedToParseNetworkResponse.desc+" | Attempted to reach: "+t.split("?")[0])},e.createUnableToLoadTokenError=function(t){return new e(It.unableToLoadTokenError.code,It.unableToLoadTokenError.desc+" | "+t)},e.createSigningKeyNotFoundInStorageError=function(t){return new e(It.signingKeyNotFoundInStorage.code,It.signingKeyNotFoundInStorage.desc+" | No match found for KeyId: "+t)},e.createAuthCodeRequiredError=function(){return new e(It.authCodeRequired.code,It.authCodeRequired.desc)},e.createAuthCodeOrNativeAccountIdRequiredError=function(){return new e(It.authCodeOrNativeAccountRequired.code,It.authCodeOrNativeAccountRequired.desc)},e.createSpaCodeAndNativeAccountIdPresentError=function(){return new e(It.spaCodeAndNativeAccountPresent.code,It.spaCodeAndNativeAccountPresent.desc)},e.createDatabaseUnavailableError=function(){return new e(It.databaseUnavailable.code,It.databaseUnavailable.desc)},e.createUnableToAcquireTokenFromNativePlatformError=function(){return new e(It.unableToAcquireTokenFromNativePlatform.code,It.unableToAcquireTokenFromNativePlatform.desc)},e.createNativeHandshakeTimeoutError=function(){return new e(It.nativeHandshakeTimeout.code,It.nativeHandshakeTimeout.desc)},e.createNativeExtensionNotInstalledError=function(){return new e(It.nativeExtensionNotInstalled.code,It.nativeExtensionNotInstalled.desc)},e.createNativeConnectionNotEstablishedError=function(){return new e(It.nativeConnectionNotEstablished.code,It.nativeConnectionNotEstablished.desc)},e.createNativeBrokerCalledBeforeInitialize=function(){return new e(It.nativeBrokerCalledBeforeInitialize.code,It.nativeBrokerCalledBeforeInitialize.desc)},e.createNativePromptParameterNotSupportedError=function(){return new e(It.nativePromptNotSupported.code,It.nativePromptNotSupported.desc)},e}(wn),Pc={INTERACTION_IN_PROGRESS_VALUE:"interaction_in_progress",INVALID_GRANT_ERROR:"invalid_grant",POPUP_WIDTH:483,POPUP_HEIGHT:600,POPUP_NAME_PREFIX:"msal",DEFAULT_POLL_INTERVAL_MS:30,MSAL_SKU:"msal.js.browser"},b0={CHANNEL_ID:"53ee284d-920a-4b59-9d30-a60315b26836",PREFERRED_EXTENSION_ID:"ppnbnpeolgkicgegkbkbjmhlideopiji",MATS_TELEMETRY:"MATS"},i9=(function(n){n.HandshakeRequest="Handshake",n.HandshakeResponse="HandshakeResponse",n.GetToken="GetToken",n.Response="Response"}(wu=wu||{}),function(n){n.LocalStorage="localStorage",n.SessionStorage="sessionStorage",n.MemoryStorage="memoryStorage"}(go=go||{}),function(n){n.GET="GET",n.POST="POST"}(yl=yl||{}),function(n){n.AUTHORITY="authority",n.ACQUIRE_TOKEN_ACCOUNT="acquireToken.account",n.SESSION_STATE="session.state",n.REQUEST_STATE="request.state",n.NONCE_IDTOKEN="nonce.id_token",n.ORIGIN_URI="request.origin",n.RENEW_STATUS="token.renew.status",n.URL_HASH="urlHash",n.REQUEST_PARAMS="request.params",n.SCOPES="scopes",n.INTERACTION_STATUS_KEY="interaction.status",n.CCS_CREDENTIAL="ccs.credential",n.CORRELATION_ID="request.correlationId",n.NATIVE_REQUEST="request.native",n.REDIRECT_CONTEXT="request.redirect.context"}(Mr=Mr||{}),function(n){n.ACCOUNT_KEYS="msal.account.keys",n.TOKEN_KEYS="msal.token.keys"}(_l=_l||{}),function(n){n.WRAPPER_SKU="wrapper.sku",n.WRAPPER_VER="wrapper.version"}(Pm=Pm||{}),function(n){n[n.acquireTokenRedirect=861]="acquireTokenRedirect",n[n.acquireTokenPopup=862]="acquireTokenPopup",n[n.ssoSilent=863]="ssoSilent",n[n.acquireTokenSilent_authCode=864]="acquireTokenSilent_authCode",n[n.handleRedirectPromise=865]="handleRedirectPromise",n[n.acquireTokenByCode=866]="acquireTokenByCode",n[n.acquireTokenSilent_silentFlow=61]="acquireTokenSilent_silentFlow",n[n.logout=961]="logout",n[n.logoutPopup=962]="logoutPopup"}(_i=_i||{}),function(n){n.Redirect="redirect",n.Popup="popup",n.Silent="silent",n.None="none"}(hn=hn||{}),function(n){n.Startup="startup",n.Login="login",n.Logout="logout",n.AcquireToken="acquireToken",n.SsoSilent="ssoSilent",n.HandleRedirect="handleRedirect",n.None="none"}(Qj=Qj||{}),{scopes:f0}),Mm="jwk",nR=(function(n){n.React="@azure/msal-react",n.Angular="@azure/msal-angular"}(Jj=Jj||{}),"msal.db"),Kwe=1,Zwe=nR+".keys",ns=(function(n){n[n.Default=0]="Default",n[n.AccessToken=1]="AccessToken",n[n.AccessTokenAndRefreshToken=2]="AccessTokenAndRefreshToken",n[n.RefreshToken=3]="RefreshToken",n[n.RefreshTokenAndNetwork=4]="RefreshTokenAndNetwork",n[n.Skip=5]="Skip"}(ts=ts||{}),{redirectUriNotSet:{code:"redirect_uri_empty",desc:"A redirect URI is required for all calls, and none has been set."},postLogoutUriNotSet:{code:"post_logout_uri_empty",desc:"A post logout redirect has not been set."},storageNotSupportedError:{code:"storage_not_supported",desc:"Given storage configuration option was not supported."},noRedirectCallbacksSet:{code:"no_redirect_callbacks",desc:"No redirect callbacks have been set. Please call setRedirectCallbacks() with the appropriate function arguments before continuing. More information is available here: https://github.com/AzureAD/microsoft-authentication-library-for-js/wiki/MSAL-basics."},invalidCallbackObject:{code:"invalid_callback_object",desc:"The object passed for the callback was invalid. More information is available here: https://github.com/AzureAD/microsoft-authentication-library-for-js/wiki/MSAL-basics."},stubPcaInstanceCalled:{code:"stubbed_public_client_application_called",desc:"Stub instance of Public Client Application was called. If using msal-react, please ensure context is not used without a provider. For more visit: aka.ms/msaljs/browser-errors"},inMemRedirectUnavailable:{code:"in_mem_redirect_unavailable",desc:"Redirect cannot be supported. In-memory storage was selected and storeAuthStateInCookie=false, which would cause the library to be unable to handle the incoming hash. If you would like to use the redirect API, please use session/localStorage or set storeAuthStateInCookie=true."},entropyNotProvided:{code:"entropy_not_provided",desc:"The available browser crypto interface requires entropy set via system.cryptoOptions.entropy configuration option."}}),OE=function(n){function e(t,r){return t=n.call(this,t,r)||this,t.name="BrowserConfigurationAuthError",Object.setPrototypeOf(t,e.prototype),t}return Zo(e,n),e.createRedirectUriEmptyError=function(){return new e(ns.redirectUriNotSet.code,ns.redirectUriNotSet.desc)},e.createPostLogoutRedirectUriEmptyError=function(){return new e(ns.postLogoutUriNotSet.code,ns.postLogoutUriNotSet.desc)},e.createStorageNotSupportedError=function(t){return new e(ns.storageNotSupportedError.code,ns.storageNotSupportedError.desc+" Given Location: "+t)},e.createRedirectCallbacksNotSetError=function(){return new e(ns.noRedirectCallbacksSet.code,ns.noRedirectCallbacksSet.desc)},e.createStubPcaInstanceCalledError=function(){return new e(ns.stubPcaInstanceCalled.code,ns.stubPcaInstanceCalled.desc)},e.createInMemoryRedirectUnavailableError=function(){return new e(ns.inMemRedirectUnavailable.code,ns.inMemRedirectUnavailable.desc)},e.createEntropyNotProvided=function(){return new e(ns.entropyNotProvided.code,ns.entropyNotProvided.desc)},e}(wn),o9=function(){function n(e){this.validateWindowStorage(e),this.windowStorage=window[e]}return n.prototype.validateWindowStorage=function(e){if(e!==go.LocalStorage&&e!==go.SessionStorage||!window[e])throw OE.createStorageNotSupportedError(e)},n.prototype.getItem=function(e){return this.windowStorage.getItem(e)},n.prototype.setItem=function(e,t){this.windowStorage.setItem(e,t)},n.prototype.removeItem=function(e){this.windowStorage.removeItem(e)},n.prototype.getKeys=function(){return Object.keys(this.windowStorage)},n.prototype.containsKey=function(e){return this.windowStorage.hasOwnProperty(e)},n}(),rR=function(){function n(){this.cache=new Map}return n.prototype.getItem=function(e){return this.cache.get(e)||null},n.prototype.setItem=function(e,t){this.cache.set(e,t)},n.prototype.removeItem=function(e){this.cache.delete(e)},n.prototype.getKeys=function(){var e=[];return this.cache.forEach(function(t,r){e.push(r)}),e},n.prototype.containsKey=function(e){return this.cache.has(e)},n.prototype.clear=function(){this.cache.clear()},n}(),a9=function(){function n(){}return n.extractBrowserRequestState=function(e,t){if(Kt.isEmpty(t))return null;try{return bu.parseRequestState(e,t).libraryState.meta}catch(r){throw en.createInvalidStateError(t,r)}},n.parseServerResponseFromHash=function(e){return e?(e=new wr(e),wr.getDeserializedHash(e.getHash())):{}},n}(),iR=function(n){function e(t,r,i,o){return t=n.call(this,t,i,o)||this,t.COOKIE_LIFE_MULTIPLIER=864e5,t.cacheConfig=r,t.logger=o,t.internalStorage=new rR,t.browserStorage=t.setupBrowserStorage(t.cacheConfig.cacheLocation),t.temporaryCacheStorage=t.setupTemporaryCacheStorage(t.cacheConfig.temporaryCacheLocation,t.cacheConfig.cacheLocation),r.cacheMigrationEnabled&&(t.migrateCacheEntries(),t.createKeyMaps()),t}return Zo(e,n),e.prototype.setupBrowserStorage=function(t){switch(t){case go.LocalStorage:case go.SessionStorage:try{return new o9(t)}catch(r){this.logger.verbose(r);break}}return this.cacheConfig.cacheLocation=go.MemoryStorage,new rR},e.prototype.setupTemporaryCacheStorage=function(t,r){switch(r){case go.LocalStorage:case go.SessionStorage:try{return new o9(t||go.SessionStorage)}catch(i){return this.logger.verbose(i),this.internalStorage}case go.MemoryStorage:default:return this.internalStorage}},e.prototype.migrateCacheEntries=function(){var t=this,r=Le.CACHE_PREFIX+"."+xo.ID_TOKEN,i=Le.CACHE_PREFIX+"."+xo.CLIENT_INFO,o=Le.CACHE_PREFIX+"."+xo.ERROR,a=Le.CACHE_PREFIX+"."+xo.ERROR_DESC,l=[this.browserStorage.getItem(r),this.browserStorage.getItem(i),this.browserStorage.getItem(o),this.browserStorage.getItem(a)];[xo.ID_TOKEN,xo.CLIENT_INFO,xo.ERROR,xo.ERROR_DESC].forEach(function(h,p){return t.migrateCacheEntry(h,l[p])})},e.prototype.migrateCacheEntry=function(t,r){r&&this.setTemporaryCache(t,r,!0)},e.prototype.createKeyMaps=function(){var t=this,r=(this.logger.trace("BrowserCacheManager - createKeyMaps called."),this.getItem(_l.ACCOUNT_KEYS)),i=this.getItem(_l.TOKEN_KEYS+"."+this.clientId);r&&i?this.logger.verbose("BrowserCacheManager:createKeyMaps - account and token key maps already exist, skipping migration."):this.browserStorage.getKeys().forEach(function(o){var a;if(t.isCredentialKey(o)&&(a=t.getItem(o))){var l,h,p=t.validateAndParseJson(a);if(p&&p.hasOwnProperty("credentialType"))switch(p.credentialType){case In.ID_TOKEN:if(Kf.isIdTokenEntity(p))return t.logger.trace("BrowserCacheManager:createKeyMaps - idToken found, saving key to token key map"),t.logger.tracePii("BrowserCacheManager:createKeyMaps - idToken with key: "+o+" found, saving key to token key map"),h=es.toObject(new Kf,p),h=t.updateCredentialCacheKey(o,h),void t.addTokenKey(h,In.ID_TOKEN);t.logger.trace("BrowserCacheManager:createKeyMaps - key found matching idToken schema with value containing idToken credentialType field but value failed IdTokenEntity validation, skipping."),t.logger.tracePii("BrowserCacheManager:createKeyMaps - failed idToken validation on key: "+o);break;case In.ACCESS_TOKEN:case In.ACCESS_TOKEN_WITH_AUTH_SCHEME:if(Zf.isAccessTokenEntity(p))return t.logger.trace("BrowserCacheManager:createKeyMaps - accessToken found, saving key to token key map"),t.logger.tracePii("BrowserCacheManager:createKeyMaps - accessToken with key: "+o+" found, saving key to token key map"),l=es.toObject(new Zf,p),h=t.updateCredentialCacheKey(o,l),void t.addTokenKey(h,In.ACCESS_TOKEN);t.logger.trace("BrowserCacheManager:createKeyMaps - key found matching accessToken schema with value containing accessToken credentialType field but value failed AccessTokenEntity validation, skipping."),t.logger.tracePii("BrowserCacheManager:createKeyMaps - failed accessToken validation on key: "+o);break;case In.REFRESH_TOKEN:if(Cm.isRefreshTokenEntity(p))return t.logger.trace("BrowserCacheManager:createKeyMaps - refreshToken found, saving key to token key map"),t.logger.tracePii("BrowserCacheManager:createKeyMaps - refreshToken with key: "+o+" found, saving key to token key map"),l=es.toObject(new Cm,p),h=t.updateCredentialCacheKey(o,l),void t.addTokenKey(h,In.REFRESH_TOKEN);t.logger.trace("BrowserCacheManager:createKeyMaps - key found matching refreshToken schema with value containing refreshToken credentialType field but value failed RefreshTokenEntity validation, skipping."),t.logger.tracePii("BrowserCacheManager:createKeyMaps - failed refreshToken validation on key: "+o)}}t.isAccountKey(o)&&(a=t.getItem(o))&&(a=t.validateAndParseJson(a))&&Qo.isAccountEntity(a)&&(t.logger.trace("BrowserCacheManager:createKeyMaps - account found, saving key to account key map"),t.logger.tracePii("BrowserCacheManager:createKeyMaps - account with key: "+o+" found, saving key to account key map"),t.addAccountKeyToMap(o))})},e.prototype.validateAndParseJson=function(t){try{var r=JSON.parse(t);return r&&typeof r=="object"?r:null}catch{return null}},e.prototype.getItem=function(t){return this.browserStorage.getItem(t)},e.prototype.setItem=function(t,r){this.browserStorage.setItem(t,r)},e.prototype.getAccount=function(t){this.logger.trace("BrowserCacheManager.getAccount called");var r=this.getItem(t);return(r=r&&this.validateAndParseJson(r))&&Qo.isAccountEntity(r)?es.toObject(new Qo,r):(this.removeAccountKeyFromMap(t),null)},e.prototype.setAccount=function(t){this.logger.trace("BrowserCacheManager.setAccount called");var r=t.generateAccountKey();this.setItem(r,JSON.stringify(t)),this.addAccountKeyToMap(r)},e.prototype.getAccountKeys=function(){this.logger.trace("BrowserCacheManager.getAccountKeys called");var t=this.getItem(_l.ACCOUNT_KEYS);return t?JSON.parse(t):(this.logger.verbose("BrowserCacheManager.getAccountKeys - No account keys found"),[])},e.prototype.addAccountKeyToMap=function(t){this.logger.trace("BrowserCacheManager.addAccountKeyToMap called"),this.logger.tracePii("BrowserCacheManager.addAccountKeyToMap called with key: "+t);var r=this.getAccountKeys();r.indexOf(t)===-1?(r.push(t),this.setItem(_l.ACCOUNT_KEYS,JSON.stringify(r)),this.logger.verbose("BrowserCacheManager.addAccountKeyToMap account key added")):this.logger.verbose("BrowserCacheManager.addAccountKeyToMap account key already exists in map")},e.prototype.removeAccountKeyFromMap=function(i){this.logger.trace("BrowserCacheManager.removeAccountKeyFromMap called"),this.logger.tracePii("BrowserCacheManager.removeAccountKeyFromMap called with key: "+i);var r=this.getAccountKeys(),i=r.indexOf(i);-1<i?(r.splice(i,1),this.setItem(_l.ACCOUNT_KEYS,JSON.stringify(r)),this.logger.trace("BrowserCacheManager.removeAccountKeyFromMap account key removed")):this.logger.trace("BrowserCacheManager.removeAccountKeyFromMap key not found in existing map")},e.prototype.removeAccount=function(t){return dt(this,void 0,void 0,function(){return ft(this,function(r){return n.prototype.removeAccount.call(this,t),this.removeAccountKeyFromMap(t),[2]})})},e.prototype.removeIdToken=function(t){n.prototype.removeIdToken.call(this,t),this.removeTokenKey(t,In.ID_TOKEN)},e.prototype.removeAccessToken=function(t){return dt(this,void 0,void 0,function(){return ft(this,function(r){return n.prototype.removeAccessToken.call(this,t),this.removeTokenKey(t,In.ACCESS_TOKEN),[2]})})},e.prototype.removeRefreshToken=function(t){n.prototype.removeRefreshToken.call(this,t),this.removeTokenKey(t,In.REFRESH_TOKEN)},e.prototype.getTokenKeys=function(){this.logger.trace("BrowserCacheManager.getTokenKeys called");var t=this.getItem(_l.TOKEN_KEYS+"."+this.clientId);if(t){if(t=this.validateAndParseJson(t),t&&t.hasOwnProperty("idToken")&&t.hasOwnProperty("accessToken")&&t.hasOwnProperty("refreshToken"))return t;this.logger.error("BrowserCacheManager.getTokenKeys - Token keys found but in an unknown format. Returning empty key map.")}else this.logger.verbose("BrowserCacheManager.getTokenKeys - No token keys found");return{idToken:[],accessToken:[],refreshToken:[]}},e.prototype.addTokenKey=function(t,r){this.logger.trace("BrowserCacheManager addTokenKey called");var i=this.getTokenKeys();switch(r){case In.ID_TOKEN:i.idToken.indexOf(t)===-1&&(this.logger.info("BrowserCacheManager: addTokenKey - idToken added to map"),i.idToken.push(t));break;case In.ACCESS_TOKEN:i.accessToken.indexOf(t)===-1&&(this.logger.info("BrowserCacheManager: addTokenKey - accessToken added to map"),i.accessToken.push(t));break;case In.REFRESH_TOKEN:i.refreshToken.indexOf(t)===-1&&(this.logger.info("BrowserCacheManager: addTokenKey - refreshToken added to map"),i.refreshToken.push(t));break;default:this.logger.error("BrowserCacheManager:addTokenKey - CredentialType provided invalid. CredentialType: "+r),en.createUnexpectedCredentialTypeError()}this.setItem(_l.TOKEN_KEYS+"."+this.clientId,JSON.stringify(i))},e.prototype.removeTokenKey=function(t,r){this.logger.trace("BrowserCacheManager removeTokenKey called");var i=this.getTokenKeys();switch(r){case In.ID_TOKEN:this.logger.infoPii("BrowserCacheManager: removeTokenKey - attempting to remove idToken with key: "+t+" from map");var o=i.idToken.indexOf(t);-1<o?(this.logger.info("BrowserCacheManager: removeTokenKey - idToken removed from map"),i.idToken.splice(o,1)):this.logger.info("BrowserCacheManager: removeTokenKey - idToken does not exist in map. Either it was previously removed or it was never added.");break;case In.ACCESS_TOKEN:this.logger.infoPii("BrowserCacheManager: removeTokenKey - attempting to remove accessToken with key: "+t+" from map"),o=i.accessToken.indexOf(t),-1<o?(this.logger.info("BrowserCacheManager: removeTokenKey - accessToken removed from map"),i.accessToken.splice(o,1)):this.logger.info("BrowserCacheManager: removeTokenKey - accessToken does not exist in map. Either it was previously removed or it was never added.");break;case In.REFRESH_TOKEN:this.logger.infoPii("BrowserCacheManager: removeTokenKey - attempting to remove refreshToken with key: "+t+" from map"),o=i.refreshToken.indexOf(t),-1<o?(this.logger.info("BrowserCacheManager: removeTokenKey - refreshToken removed from map"),i.refreshToken.splice(o,1)):this.logger.info("BrowserCacheManager: removeTokenKey - refreshToken does not exist in map. Either it was previously removed or it was never added.");break;default:this.logger.error("BrowserCacheManager:removeTokenKey - CredentialType provided invalid. CredentialType: "+r),en.createUnexpectedCredentialTypeError()}this.setItem(_l.TOKEN_KEYS+"."+this.clientId,JSON.stringify(i))},e.prototype.getIdTokenCredential=function(t){var r=this.getItem(t);return(r=r&&this.validateAndParseJson(r))&&Kf.isIdTokenEntity(r)?(this.logger.trace("BrowserCacheManager.getIdTokenCredential: cache hit"),es.toObject(new Kf,r)):(this.logger.trace("BrowserCacheManager.getIdTokenCredential: called, no cache hit"),this.removeTokenKey(t,In.ID_TOKEN),null)},e.prototype.setIdTokenCredential=function(t){this.logger.trace("BrowserCacheManager.setIdTokenCredential called");var r=t.generateCredentialKey();this.setItem(r,JSON.stringify(t)),this.addTokenKey(r,In.ID_TOKEN)},e.prototype.getAccessTokenCredential=function(t){var r=this.getItem(t);return(r=r&&this.validateAndParseJson(r))&&Zf.isAccessTokenEntity(r)?(this.logger.trace("BrowserCacheManager.getAccessTokenCredential: cache hit"),es.toObject(new Zf,r)):(this.logger.trace("BrowserCacheManager.getAccessTokenCredential: called, no cache hit"),this.removeTokenKey(t,In.ACCESS_TOKEN),null)},e.prototype.setAccessTokenCredential=function(t){this.logger.trace("BrowserCacheManager.setAccessTokenCredential called");var r=t.generateCredentialKey();this.setItem(r,JSON.stringify(t)),this.addTokenKey(r,In.ACCESS_TOKEN)},e.prototype.getRefreshTokenCredential=function(t){var r=this.getItem(t);return(r=r&&this.validateAndParseJson(r))&&Cm.isRefreshTokenEntity(r)?(this.logger.trace("BrowserCacheManager.getRefreshTokenCredential: cache hit"),es.toObject(new Cm,r)):(this.logger.trace("BrowserCacheManager.getRefreshTokenCredential: called, no cache hit"),this.removeTokenKey(t,In.REFRESH_TOKEN),null)},e.prototype.setRefreshTokenCredential=function(t){this.logger.trace("BrowserCacheManager.setRefreshTokenCredential called");var r=t.generateCredentialKey();this.setItem(r,JSON.stringify(t)),this.addTokenKey(r,In.REFRESH_TOKEN)},e.prototype.getAppMetadata=function(t){var r=this.getItem(t);return(r=r&&this.validateAndParseJson(r))&&eR.isAppMetadataEntity(t,r)?(this.logger.trace("BrowserCacheManager.getAppMetadata: cache hit"),es.toObject(new eR,r)):(this.logger.trace("BrowserCacheManager.getAppMetadata: called, no cache hit"),null)},e.prototype.setAppMetadata=function(t){this.logger.trace("BrowserCacheManager.setAppMetadata called");var r=t.generateAppMetadataKey();this.setItem(r,JSON.stringify(t))},e.prototype.getServerTelemetry=function(t){var r=this.getItem(t);return(r=r&&this.validateAndParseJson(r))&&RE.isServerTelemetryEntity(t,r)?(this.logger.trace("BrowserCacheManager.getServerTelemetry: cache hit"),es.toObject(new RE,r)):(this.logger.trace("BrowserCacheManager.getServerTelemetry: called, no cache hit"),null)},e.prototype.setServerTelemetry=function(t,r){this.logger.trace("BrowserCacheManager.setServerTelemetry called"),this.setItem(t,JSON.stringify(r))},e.prototype.getAuthorityMetadata=function(t){var r=this.internalStorage.getItem(t);return r?(r=this.validateAndParseJson(r))&&tR.isAuthorityMetadataEntity(t,r)?(this.logger.trace("BrowserCacheManager.getAuthorityMetadata: cache hit"),es.toObject(new tR,r)):null:(this.logger.trace("BrowserCacheManager.getAuthorityMetadata: called, no cache hit"),null)},e.prototype.getAuthorityMetadataKeys=function(){var t=this;return this.internalStorage.getKeys().filter(function(r){return t.isAuthorityMetadata(r)})},e.prototype.setWrapperMetadata=function(t,r){this.internalStorage.setItem(Pm.WRAPPER_SKU,t),this.internalStorage.setItem(Pm.WRAPPER_VER,r)},e.prototype.getWrapperMetadata=function(){return[this.internalStorage.getItem(Pm.WRAPPER_SKU)||Le.EMPTY_STRING,this.internalStorage.getItem(Pm.WRAPPER_VER)||Le.EMPTY_STRING]},e.prototype.setAuthorityMetadata=function(t,r){this.logger.trace("BrowserCacheManager.setAuthorityMetadata called"),this.internalStorage.setItem(t,JSON.stringify(r))},e.prototype.getActiveAccount=function(){var t=this.generateCacheKey(xo.ACTIVE_ACCOUNT_FILTERS),t=this.getItem(t);return t?(t=this.validateAndParseJson(t))?(this.logger.trace("BrowserCacheManager.getActiveAccount: Active account filters schema found"),this.getAccountInfoByFilter({homeAccountId:t.homeAccountId,localAccountId:t.localAccountId})[0]||null):(this.logger.trace("BrowserCacheManager.getActiveAccount: No active account found"),null):(this.logger.trace("BrowserCacheManager.getActiveAccount: No active account filters cache schema found, looking for legacy schema"),t=this.generateCacheKey(xo.ACTIVE_ACCOUNT),(t=this.getItem(t))?(t=this.getAccountInfoByFilter({localAccountId:t})[0]||null)?(this.logger.trace("BrowserCacheManager.getActiveAccount: Legacy active account cache schema found"),this.logger.trace("BrowserCacheManager.getActiveAccount: Adding active account filters cache schema"),this.setActiveAccount(t),t):null:(this.logger.trace("BrowserCacheManager.getActiveAccount: No active account found"),null))},e.prototype.setActiveAccount=function(t){var r,i=this.generateCacheKey(xo.ACTIVE_ACCOUNT_FILTERS),o=this.generateCacheKey(xo.ACTIVE_ACCOUNT);t?(this.logger.verbose("setActiveAccount: Active account set"),r={homeAccountId:t.homeAccountId,localAccountId:t.localAccountId},this.browserStorage.setItem(i,JSON.stringify(r)),this.browserStorage.setItem(o,t.localAccountId)):(this.logger.verbose("setActiveAccount: No account passed, active account not set"),this.browserStorage.removeItem(i),this.browserStorage.removeItem(o))},e.prototype.getAccountInfoByFilter=function(t){var r=this.getAllAccounts();return this.logger.trace("BrowserCacheManager.getAccountInfoByFilter: total "+r.length+" accounts found"),r.filter(function(i){return!(t.username&&t.username.toLowerCase()!==i.username.toLowerCase()||t.homeAccountId&&t.homeAccountId!==i.homeAccountId||t.localAccountId&&t.localAccountId!==i.localAccountId||t.tenantId&&t.tenantId!==i.tenantId||t.environment&&t.environment!==i.environment)})},e.prototype.getAccountInfoByHints=function(t,r){var i=this.getAllAccounts().filter(function(o){var a;return r?(a=o.idTokenClaims&&o.idTokenClaims.sid,r===a):!!t&&t===o.username});if(i.length===1)return i[0];if(1<i.length)throw en.createMultipleMatchingAccountsInCacheError();return null},e.prototype.getThrottlingCache=function(t){var r=this.getItem(t);return(r=r&&this.validateAndParseJson(r))&&e9.isThrottlingEntity(t,r)?(this.logger.trace("BrowserCacheManager.getThrottlingCache: cache hit"),es.toObject(new e9,r)):(this.logger.trace("BrowserCacheManager.getThrottlingCache: called, no cache hit"),null)},e.prototype.setThrottlingCache=function(t,r){this.logger.trace("BrowserCacheManager.setThrottlingCache called"),this.setItem(t,JSON.stringify(r))},e.prototype.getTemporaryCache=function(t,r){return r=r?this.generateCacheKey(t):t,this.cacheConfig.storeAuthStateInCookie&&(t=this.getItemCookie(r),t)?(this.logger.trace("BrowserCacheManager.getTemporaryCache: storeAuthStateInCookies set to true, retrieving from cookies"),t):(t=this.temporaryCacheStorage.getItem(r),t?(this.logger.trace("BrowserCacheManager.getTemporaryCache: Temporary cache item returned"),t):this.cacheConfig.cacheLocation===go.LocalStorage&&(t=this.browserStorage.getItem(r),t)?(this.logger.trace("BrowserCacheManager.getTemporaryCache: Temporary cache item found in local storage"),t):(this.logger.trace("BrowserCacheManager.getTemporaryCache: No cache item found in local storage"),null))},e.prototype.setTemporaryCache=function(t,r,i){i=i?this.generateCacheKey(t):t,this.temporaryCacheStorage.setItem(i,r),this.cacheConfig.storeAuthStateInCookie&&(this.logger.trace("BrowserCacheManager.setTemporaryCache: storeAuthStateInCookie set to true, setting item cookie"),this.setItemCookie(i,r))},e.prototype.removeItem=function(t){this.browserStorage.removeItem(t),this.temporaryCacheStorage.removeItem(t),this.cacheConfig.storeAuthStateInCookie&&(this.logger.trace("BrowserCacheManager.removeItem: storeAuthStateInCookie is true, clearing item cookie"),this.clearItemCookie(t))},e.prototype.containsKey=function(t){return this.browserStorage.containsKey(t)||this.temporaryCacheStorage.containsKey(t)},e.prototype.getKeys=function(){return $M(this.browserStorage.getKeys(),this.temporaryCacheStorage.getKeys())},e.prototype.clear=function(){return dt(this,void 0,void 0,function(){var t=this;return ft(this,function(r){switch(r.label){case 0:return[4,this.removeAllAccounts()];case 1:return r.sent(),this.removeAppMetadata(),this.getKeys().forEach(function(i){!t.browserStorage.containsKey(i)&&!t.temporaryCacheStorage.containsKey(i)||i.indexOf(Le.CACHE_PREFIX)===-1&&i.indexOf(t.clientId)===-1||t.removeItem(i)}),this.internalStorage.clear(),[2]}})})},e.prototype.clearTokensAndKeysWithClaims=function(){return dt(this,void 0,void 0,function(){var t,r,i=this;return ft(this,function(o){switch(o.label){case 0:return this.logger.trace("BrowserCacheManager.clearTokensAndKeysWithClaims called"),t=this.getTokenKeys(),r=[],t.accessToken.forEach(function(a){var l=i.getAccessTokenCredential(a);l!=null&&l.requestedClaimsHash&&a.includes(l.requestedClaimsHash.toLowerCase())&&r.push(i.removeAccessToken(a))}),[4,Promise.all(r)];case 1:return o.sent(),0<r.length&&this.logger.warning(r.length+" access tokens with claims in the cache keys have been removed from the cache."),[2]}})})},e.prototype.setItemCookie=function(t,r,i){t=encodeURIComponent(t)+"="+encodeURIComponent(r)+";path=/;SameSite=Lax;",i&&(t+="expires="+this.getCookieExpirationTime(i)+";"),this.cacheConfig.secureCookies&&(t+="Secure;"),document.cookie=t},e.prototype.getItemCookie=function(t){for(var r=encodeURIComponent(t)+"=",i=document.cookie.split(";"),o=0;o<i.length;o++){for(var a=i[o];a.charAt(0)===" ";)a=a.substring(1);if(a.indexOf(r)===0)return decodeURIComponent(a.substring(r.length,a.length))}return Le.EMPTY_STRING},e.prototype.clearMsalCookies=function(){var t=this,r=Le.CACHE_PREFIX+"."+this.clientId;document.cookie.split(";").forEach(function(i){for(;i.charAt(0)===" ";)i=i.substring(1);var o;i.indexOf(r)===0&&(o=i.split("=")[0],t.clearItemCookie(o))})},e.prototype.clearItemCookie=function(t){this.setItemCookie(t,Le.EMPTY_STRING,-1)},e.prototype.getCookieExpirationTime=function(t){var r=new Date;return new Date(r.getTime()+t*this.COOKIE_LIFE_MULTIPLIER).toUTCString()},e.prototype.getCache=function(){return this.browserStorage},e.prototype.setCache=function(){},e.prototype.generateCacheKey=function(t){return this.validateAndParseJson(t)?JSON.stringify(t):Kt.startsWith(t,Le.CACHE_PREFIX)||Kt.startsWith(t,xo.ADAL_ID_TOKEN)?t:Le.CACHE_PREFIX+"."+this.clientId+"."+t},e.prototype.generateAuthorityKey=function(t){return t=bu.parseRequestState(this.cryptoImpl,t).libraryState.id,this.generateCacheKey(Mr.AUTHORITY+"."+t)},e.prototype.generateNonceKey=function(t){return t=bu.parseRequestState(this.cryptoImpl,t).libraryState.id,this.generateCacheKey(Mr.NONCE_IDTOKEN+"."+t)},e.prototype.generateStateKey=function(t){return t=bu.parseRequestState(this.cryptoImpl,t).libraryState.id,this.generateCacheKey(Mr.REQUEST_STATE+"."+t)},e.prototype.getCachedAuthority=function(r){var r=this.generateStateKey(r),r=this.getTemporaryCache(r);return r?(r=this.generateAuthorityKey(r),this.getTemporaryCache(r)):null},e.prototype.updateCacheEntries=function(t,r,i,o,a){this.logger.trace("BrowserCacheManager.updateCacheEntries called");var l,h=this.generateStateKey(t),h=(this.setTemporaryCache(h,t,!1),this.generateNonceKey(t)),h=(this.setTemporaryCache(h,r,!1),this.generateAuthorityKey(t));this.setTemporaryCache(h,i,!1),a?(l={credential:a.homeAccountId,type:Ps.HOME_ACCOUNT_ID},this.setTemporaryCache(Mr.CCS_CREDENTIAL,JSON.stringify(l),!0)):Kt.isEmpty(o)||(l={credential:o,type:Ps.UPN},this.setTemporaryCache(Mr.CCS_CREDENTIAL,JSON.stringify(l),!0))},e.prototype.resetRequestCache=function(t){var r=this;this.logger.trace("BrowserCacheManager.resetRequestCache called"),Kt.isEmpty(t)||this.getKeys().forEach(function(i){i.indexOf(t)!==-1&&r.removeItem(i)}),t&&(this.removeItem(this.generateStateKey(t)),this.removeItem(this.generateNonceKey(t)),this.removeItem(this.generateAuthorityKey(t))),this.removeItem(this.generateCacheKey(Mr.REQUEST_PARAMS)),this.removeItem(this.generateCacheKey(Mr.ORIGIN_URI)),this.removeItem(this.generateCacheKey(Mr.URL_HASH)),this.removeItem(this.generateCacheKey(Mr.CORRELATION_ID)),this.removeItem(this.generateCacheKey(Mr.CCS_CREDENTIAL)),this.removeItem(this.generateCacheKey(Mr.NATIVE_REQUEST)),this.setInteractionInProgress(!1)},e.prototype.cleanRequestByState=function(t){this.logger.trace("BrowserCacheManager.cleanRequestByState called"),t&&(t=this.generateStateKey(t),t=this.temporaryCacheStorage.getItem(t),this.logger.infoPii("BrowserCacheManager.cleanRequestByState: Removing temporary cache items for state: "+t),this.resetRequestCache(t||Le.EMPTY_STRING)),this.clearMsalCookies()},e.prototype.cleanRequestByInteractionType=function(t){var r=this;this.logger.trace("BrowserCacheManager.cleanRequestByInteractionType called"),this.getKeys().forEach(function(i){var o;i.indexOf(Mr.REQUEST_STATE)!==-1&&(i=r.temporaryCacheStorage.getItem(i))&&(o=a9.extractBrowserRequestState(r.cryptoImpl,i))&&o.interactionType===t&&(r.logger.infoPii("BrowserCacheManager.cleanRequestByInteractionType: Removing temporary cache items for state: "+i),r.resetRequestCache(i))}),this.clearMsalCookies(),this.setInteractionInProgress(!1)},e.prototype.cacheCodeRequest=function(t,r){this.logger.trace("BrowserCacheManager.cacheCodeRequest called"),r=r.base64Encode(JSON.stringify(t)),this.setTemporaryCache(Mr.REQUEST_PARAMS,r,!0)},e.prototype.getCachedRequest=function(t,r){this.logger.trace("BrowserCacheManager.getCachedRequest called");var i=this.getTemporaryCache(Mr.REQUEST_PARAMS,!0);if(!i)throw Vt.createNoTokenRequestCacheError();if(r=this.validateAndParseJson(r.base64Decode(i)),!r)throw Vt.createUnableToParseTokenRequestCacheError();if(this.removeItem(this.generateCacheKey(Mr.REQUEST_PARAMS)),Kt.isEmpty(r.authority)){if(i=this.generateAuthorityKey(t),t=this.getTemporaryCache(i),!t)throw Vt.createNoCachedAuthorityError();r.authority=t}return r},e.prototype.getCachedNativeRequest=function(){this.logger.trace("BrowserCacheManager.getCachedNativeRequest called");var t=this.getTemporaryCache(Mr.NATIVE_REQUEST,!0);return t?this.validateAndParseJson(t)||(this.logger.error("BrowserCacheManager.getCachedNativeRequest: Unable to parse native request"),null):(this.logger.trace("BrowserCacheManager.getCachedNativeRequest: No cached native request found"),null)},e.prototype.isInteractionInProgress=function(t){var r=this.getInteractionInProgress();return t?r===this.clientId:!!r},e.prototype.getInteractionInProgress=function(){var t=Le.CACHE_PREFIX+"."+Mr.INTERACTION_STATUS_KEY;return this.getTemporaryCache(t,!1)},e.prototype.setInteractionInProgress=function(t){var r=Le.CACHE_PREFIX+"."+Mr.INTERACTION_STATUS_KEY;if(t){if(this.getInteractionInProgress())throw Vt.createInteractionInProgressError();this.setTemporaryCache(r,this.clientId,!1)}else this.getInteractionInProgress()===this.clientId&&this.removeItem(r)},e.prototype.getLegacyLoginHint=function(){var t=this.getTemporaryCache(xo.ADAL_ID_TOKEN),r=(t&&(this.browserStorage.removeItem(xo.ADAL_ID_TOKEN),this.logger.verbose("Cached ADAL id token retrieved.")),this.getTemporaryCache(xo.ID_TOKEN,!0)),r=(r&&(this.removeItem(this.generateCacheKey(xo.ID_TOKEN)),this.logger.verbose("Cached MSAL.js v1 id token retrieved")),r||t);if(r){if(t=new ml(r,this.cryptoImpl),t.claims&&t.claims.preferred_username)return this.logger.verbose("No SSO params used and ADAL/MSAL v1 token retrieved, setting ADAL/MSAL v1 preferred_username as loginHint"),t.claims.preferred_username;if(t.claims&&t.claims.upn)return this.logger.verbose("No SSO params used and ADAL/MSAL v1 token retrieved, setting ADAL/MSAL v1 upn as loginHint"),t.claims.upn;this.logger.verbose("No SSO params used and ADAL/MSAL v1 token retrieved, however, no account hint claim found. Enable preferred_username or upn id token claim to get SSO.")}return null},e.prototype.updateCredentialCacheKey=function(t,r){var i=r.generateCredentialKey();if(t!==i){var o=this.getItem(t);if(o)return this.removeItem(t),this.setItem(i,o),this.logger.verbose("Updated an outdated "+r.credentialType+" cache key"),i;this.logger.error("Attempted to update an outdated "+r.credentialType+" cache key but no item matching the outdated key was found in storage")}return t},e.prototype.getRedirectRequestContext=function(){return this.getTemporaryCache(Mr.REDIRECT_CONTEXT,!0)},e.prototype.setRedirectRequestContext=function(t){this.setTemporaryCache(Mr.REDIRECT_CONTEXT,t,!0)},e}(es),Xwe=function(n,e){var t={cacheLocation:go.MemoryStorage,temporaryCacheLocation:go.MemoryStorage,storeAuthStateInCookie:!1,secureCookies:!1,cacheMigrationEnabled:!1,claimsBasedCachingEnabled:!0};return new iR(n,t,TE,e)},oR="@azure/msal-browser",w0="2.38.3",Qwe=function(){function n(){}return n.prototype.sendGetRequestAsync=function(e,t){return dt(this,void 0,void 0,function(){var r,i,o;return ft(this,function(a){switch(a.label){case 0:return a.trys.push([0,2,,3]),[4,fetch(e,{method:yl.GET,headers:this.getFetchHeaders(t)})];case 1:return r=a.sent(),[3,3];case 2:throw i=a.sent(),window.navigator.onLine?Vt.createGetRequestFailedError(i,e):Vt.createNoNetworkConnectivityError();case 3:return a.trys.push([3,5,,6]),o={headers:this.getHeaderDict(r.headers)},[4,r.json()];case 4:return[2,(o.body=a.sent(),o.status=r.status,o)];case 5:throw a.sent(),Vt.createFailedToParseNetworkResponseError(e);case 6:return[2]}})})},n.prototype.sendPostRequestAsync=function(e,t){return dt(this,void 0,void 0,function(){var r,i,o,a;return ft(this,function(l){switch(l.label){case 0:r=t&&t.body||Le.EMPTY_STRING,l.label=1;case 1:return l.trys.push([1,3,,4]),[4,fetch(e,{method:yl.POST,headers:this.getFetchHeaders(t),body:r})];case 2:return i=l.sent(),[3,4];case 3:throw o=l.sent(),window.navigator.onLine?Vt.createPostRequestFailedError(o,e):Vt.createNoNetworkConnectivityError();case 4:return l.trys.push([4,6,,7]),a={headers:this.getHeaderDict(i.headers)},[4,i.json()];case 5:return[2,(a.body=l.sent(),a.status=i.status,a)];case 6:throw l.sent(),Vt.createFailedToParseNetworkResponseError(e);case 7:return[2]}})})},n.prototype.getFetchHeaders=function(e){var t,r=new Headers;return e&&e.headers&&(t=e.headers,Object.keys(t).forEach(function(i){r.append(i,t[i])})),r},n.prototype.getHeaderDict=function(e){var t={};return e.forEach(function(r,i){t[i]=r}),t},n}(),Jwe=function(){function n(){}return n.prototype.sendGetRequestAsync=function(e,t){return dt(this,void 0,void 0,function(){return ft(this,function(r){return[2,this.sendRequestAsync(e,yl.GET,t)]})})},n.prototype.sendPostRequestAsync=function(e,t){return dt(this,void 0,void 0,function(){return ft(this,function(r){return[2,this.sendRequestAsync(e,yl.POST,t)]})})},n.prototype.sendRequestAsync=function(e,t,r){var i=this;return new Promise(function(o,a){var l=new XMLHttpRequest;if(l.open(t,e,!0),i.setXhrHeaders(l,r),l.onload=function(){(l.status<200||300<=l.status)&&(t===yl.POST?a(Vt.createPostRequestFailedError("Failed with status "+l.status,e)):a(Vt.createGetRequestFailedError("Failed with status "+l.status,e)));try{var h=JSON.parse(l.responseText),p={headers:i.getHeaderDict(l),body:h,status:l.status};o(p)}catch{a(Vt.createFailedToParseNetworkResponseError(e))}},l.onerror=function(){window.navigator.onLine?t===yl.POST?a(Vt.createPostRequestFailedError("Failed with status "+l.status,e)):a(Vt.createGetRequestFailedError("Failed with status "+l.status,e)):a(Vt.createNoNetworkConnectivityError())},t===yl.POST&&r&&r.body)l.send(r.body);else{if(t!==yl.GET)throw Vt.createHttpMethodNotImplementedError(t);l.send()}})},n.prototype.setXhrHeaders=function(e,t){var r;t&&t.headers&&(r=t.headers,Object.keys(r).forEach(function(i){e.setRequestHeader(i,r[i])}))},n.prototype.getHeaderDict=function(t){var t=t.getAllResponseHeaders().trim().split(/[\r\n]+/),r={};return t.forEach(function(a){var a=a.split(": "),o=a.shift(),a=a.join(": ");o&&a&&(r[o]=a)}),r},n}(),qi=function(){function n(){}return n.clearHash=function(e){e.location.hash=Le.EMPTY_STRING,typeof e.history.replaceState=="function"&&e.history.replaceState(null,Le.EMPTY_STRING,""+e.location.origin+e.location.pathname+e.location.search)},n.replaceHash=function(e){e=e.split("#"),e.shift(),window.location.hash=0<e.length?e.join("#"):Le.EMPTY_STRING},n.isInIframe=function(){return window.parent!==window},n.isInPopup=function(){return typeof window<"u"&&!!window.opener&&window.opener!==window&&typeof window.name=="string"&&window.name.indexOf(Pc.POPUP_NAME_PREFIX+".")===0},n.getCurrentUri=function(){return window.location.href.split("?")[0].split("#")[0]},n.getHomepage=function(){var e=new wr(window.location.href).getUrlComponents();return e.Protocol+"//"+e.HostNameAndPort+"/"},n.getBrowserNetworkClient=function(){return new(window.fetch&&window.Headers?Qwe:Jwe)},n.blockReloadInHiddenIframes=function(){if(wr.hashContainsKnownProperties(window.location.hash)&&n.isInIframe())throw Vt.createBlockReloadInHiddenIframeError()},n.blockRedirectInIframe=function(e,t){var r=n.isInIframe();if(e===hn.Redirect&&r&&!t)throw Vt.createRedirectInIframeError(r)},n.blockAcquireTokenInPopups=function(){if(n.isInPopup())throw Vt.createBlockAcquireTokenInPopupsError()},n.blockNonBrowserEnvironment=function(e){if(!e)throw Vt.createNonBrowserEnvironmentError()},n.blockNativeBrokerCalledBeforeInitialized=function(e,t){if(e&&!t)throw Vt.createNativeBrokerCalledBeforeInitialize()},n.detectIEOrEdge=function(){var r=window.navigator.userAgent,e=r.indexOf("MSIE "),t=r.indexOf("Trident/"),r=r.indexOf("Edge/");return 0<e||0<t||0<r},n}(),s9=function(){function n(e,t,r,i,o,a,l,h,p){this.config=e,this.browserStorage=t,this.browserCrypto=r,this.networkClient=this.config.system.networkClient,this.eventHandler=o,this.navigationClient=a,this.nativeMessageHandler=h,this.correlationId=p||this.browserCrypto.createNewGuid(),this.logger=i.clone(Pc.MSAL_SKU,w0,this.correlationId),this.performanceClient=l}return n.prototype.clearCacheOnLogout=function(e){return dt(this,void 0,void 0,function(){return ft(this,function(t){switch(t.label){case 0:if(!e)return[3,5];Qo.accountInfoIsEqual(e,this.browserStorage.getActiveAccount(),!1)&&(this.logger.verbose("Setting active account to null"),this.browserStorage.setActiveAccount(null)),t.label=1;case 1:return t.trys.push([1,3,,4]),[4,this.browserStorage.removeAccount(Qo.generateAccountCacheKey(e))];case 2:return t.sent(),this.logger.verbose("Cleared cache items belonging to the account provided in the logout request."),[3,4];case 3:return t.sent(),this.logger.error("Account provided in logout request was not found. Local cache unchanged."),[3,4];case 4:return[3,9];case 5:return t.trys.push([5,8,,9]),this.logger.verbose("No account provided in logout request, clearing all cache items.",this.correlationId),[4,this.browserStorage.clear()];case 6:return t.sent(),[4,this.browserCrypto.clearKeystore()];case 7:return t.sent(),[3,9];case 8:return t.sent(),this.logger.error("Attempted to clear all MSAL cache items and failed. Local cache unchanged."),[3,9];case 9:return[2]}})})},n.prototype.initializeBaseRequest=function(e,t){return dt(this,void 0,void 0,function(){var r,i,o;return ft(this,function(a){switch(a.label){case 0:return this.performanceClient.addQueueMeasurement(nt.InitializeBaseRequest,e.correlationId),this.logger.verbose("Initializing BaseAuthRequest"),r=e.authority||this.config.auth.authority,t?[4,this.validateRequestAuthority(r,t)]:[3,2];case 1:a.sent(),a.label=2;case 2:if(i=$M(e&&e.scopes||[]),(i=yn(yn({},e),{correlationId:this.correlationId,authority:r,scopes:i})).authenticationScheme){if(i.authenticationScheme===qr.SSH){if(!e.sshJwk)throw yi.createMissingSshJwkError();if(!e.sshKid)throw yi.createMissingSshKidError()}this.logger.verbose('Authentication Scheme set to "'+i.authenticationScheme+'" as configured in Auth request')}else i.authenticationScheme=qr.BEARER,this.logger.verbose(`Authentication Scheme wasn't explicitly set in request, defaulting to "Bearer" request`);return this.config.cache.claimsBasedCachingEnabled&&e.claims&&!Kt.isEmptyObj(e.claims)?(o=i,[4,this.browserCrypto.hashString(e.claims)]):[3,4];case 3:o.requestedClaimsHash=a.sent(),a.label=4;case 4:return[2,i]}})})},n.prototype.getRedirectUri=function(e){return this.logger.verbose("getRedirectUri called"),e=e||this.config.auth.redirectUri||qi.getCurrentUri(),wr.getAbsoluteUrl(e,qi.getCurrentUri())},n.prototype.validateRequestAuthority=function(e,t){return dt(this,void 0,void 0,function(){return ft(this,function(r){switch(r.label){case 0:return[4,this.getDiscoveredAuthority(e)];case 1:if(r.sent().isAlias(t.environment))return[2];throw yi.createAuthorityMismatchError()}})})},n.prototype.initializeServerTelemetryManager=function(e,t){return this.logger.verbose("initializeServerTelemetryManager called"),e={clientId:this.config.auth.clientId,correlationId:this.correlationId,apiId:e,forceRefresh:t||!1,wrapperSKU:this.browserStorage.getWrapperMetadata()[0],wrapperVer:this.browserStorage.getWrapperMetadata()[1]},new Wwe(e,this.browserStorage)},n.prototype.getDiscoveredAuthority=function(e){return dt(this,void 0,void 0,function(){var t;return ft(this,function(r){switch(r.label){case 0:return this.logger.verbose("getDiscoveredAuthority called"),t={protocolMode:this.config.auth.protocolMode,knownAuthorities:this.config.auth.knownAuthorities,cloudDiscoveryMetadata:this.config.auth.cloudDiscoveryMetadata,authorityMetadata:this.config.auth.authorityMetadata},e?(this.logger.verbose("Creating discovered authority with request authority"),[4,ME.createDiscoveredInstance(e,this.config.system.networkClient,this.browserStorage,t,this.logger)]):[3,2];case 1:return[2,r.sent()];case 2:return this.logger.verbose("Creating discovered authority with configured authority"),[4,ME.createDiscoveredInstance(this.config.auth.authority,this.config.system.networkClient,this.browserStorage,t,this.logger)];case 3:return[2,r.sent()]}})})},n}(),Rm=function(n){function e(){return n!==null&&n.apply(this,arguments)||this}return Zo(e,n),e.prototype.initializeAuthorizationCodeRequest=function(t){return dt(this,void 0,void 0,function(){var r,i;return ft(this,function(o){switch(o.label){case 0:return this.performanceClient.addQueueMeasurement(nt.StandardInteractionClientInitializeAuthorizationCodeRequest,t.correlationId),this.logger.verbose("initializeAuthorizationRequest called",t.correlationId),[4,this.browserCrypto.generatePkceCodes()];case 1:return r=o.sent(),i=yn(yn({},t),{redirectUri:t.redirectUri,code:Le.EMPTY_STRING,codeVerifier:r.verifier}),t.codeChallenge=r.challenge,t.codeChallengeMethod=Le.S256_CODE_CHALLENGE_METHOD,[2,i]}})})},e.prototype.initializeLogoutRequest=function(t){this.logger.verbose("initializeLogoutRequest called",t==null?void 0:t.correlationId);var r,i=yn({correlationId:this.correlationId||this.browserCrypto.createNewGuid()},t);return t?t.logoutHint?this.logger.verbose("logoutHint has already been set in logoutRequest"):t.account?(r=this.getLogoutHintFromIdTokenClaims(t.account))&&(this.logger.verbose("Setting logoutHint to login_hint ID Token Claim value for the account provided"),i.logoutHint=r):this.logger.verbose("logoutHint was not set and account was not passed into logout request, logoutHint will not be set"):this.logger.verbose("logoutHint will not be set since no logout request was configured"),t&&t.postLogoutRedirectUri===null?this.logger.verbose("postLogoutRedirectUri passed as null, not setting post logout redirect uri",i.correlationId):t&&t.postLogoutRedirectUri?(this.logger.verbose("Setting postLogoutRedirectUri to uri set on logout request",i.correlationId),i.postLogoutRedirectUri=wr.getAbsoluteUrl(t.postLogoutRedirectUri,qi.getCurrentUri())):this.config.auth.postLogoutRedirectUri===null?this.logger.verbose("postLogoutRedirectUri configured as null and no uri set on request, not passing post logout redirect",i.correlationId):this.config.auth.postLogoutRedirectUri?(this.logger.verbose("Setting postLogoutRedirectUri to configured uri",i.correlationId),i.postLogoutRedirectUri=wr.getAbsoluteUrl(this.config.auth.postLogoutRedirectUri,qi.getCurrentUri())):(this.logger.verbose("Setting postLogoutRedirectUri to current page",i.correlationId),i.postLogoutRedirectUri=wr.getAbsoluteUrl(qi.getCurrentUri(),qi.getCurrentUri())),i},e.prototype.getLogoutHintFromIdTokenClaims=function(t){if(t=t.idTokenClaims,t){if(t.login_hint)return t.login_hint;this.logger.verbose("The ID Token Claims tied to the provided account do not contain a login_hint claim, logoutHint will not be added to logout request")}else this.logger.verbose("The provided account does not contain ID Token Claims, logoutHint will not be added to logout request");return null},e.prototype.createAuthCodeClient=function(t,r,i){return dt(this,void 0,void 0,function(){var o;return ft(this,function(a){switch(a.label){case 0:return this.performanceClient.addQueueMeasurement(nt.StandardInteractionClientCreateAuthCodeClient,this.correlationId),this.performanceClient.setPreQueueTime(nt.StandardInteractionClientGetClientConfiguration,this.correlationId),[4,this.getClientConfiguration(t,r,i)];case 1:return o=a.sent(),[2,new Wj(o,this.performanceClient)]}})})},e.prototype.getClientConfiguration=function(t,r,i){return dt(this,void 0,void 0,function(){var o,a;return ft(this,function(l){switch(l.label){case 0:return this.performanceClient.addQueueMeasurement(nt.StandardInteractionClientGetClientConfiguration,this.correlationId),this.logger.verbose("getClientConfiguration called",this.correlationId),this.performanceClient.setPreQueueTime(nt.StandardInteractionClientGetDiscoveredAuthority,this.correlationId),[4,this.getDiscoveredAuthority(r,i)];case 1:return o=l.sent(),a=this.config.system.loggerOptions,[2,{authOptions:{clientId:this.config.auth.clientId,authority:o,clientCapabilities:this.config.auth.clientCapabilities},systemOptions:{tokenRenewalOffsetSeconds:this.config.system.tokenRenewalOffsetSeconds,preventCorsPreflight:!0},loggerOptions:{loggerCallback:a.loggerCallback,piiLoggingEnabled:a.piiLoggingEnabled,logLevel:a.logLevel,correlationId:this.correlationId},cacheOptions:{claimsBasedCachingEnabled:this.config.cache.claimsBasedCachingEnabled},cryptoInterface:this.browserCrypto,networkInterface:this.networkClient,storageInterface:this.browserStorage,serverTelemetryManager:t,libraryInfo:{sku:Pc.MSAL_SKU,version:w0,cpu:Le.EMPTY_STRING,os:Le.EMPTY_STRING},telemetry:this.config.telemetry}]}})})},e.prototype.validateAndExtractStateFromHash=function(t,r,i){if(this.logger.verbose("validateAndExtractStateFromHash called",i),!t.state)throw Vt.createHashDoesNotContainStateError();var o=a9.extractBrowserRequestState(this.browserCrypto,t.state);if(!o)throw Vt.createUnableToParseStateError();if(o.interactionType!==r)throw Vt.createStateInteractionTypeMismatchError();return this.logger.verbose("Returning state from hash",i),t.state},e.prototype.getDiscoveredAuthority=function(t,r){var i;return dt(this,void 0,void 0,function(){var o,a,l;return ft(this,function(h){switch(h.label){case 0:return this.performanceClient.addQueueMeasurement(nt.StandardInteractionClientGetDiscoveredAuthority,this.correlationId),this.logger.verbose("getDiscoveredAuthority called",this.correlationId),o=(i=this.performanceClient)==null?void 0:i.startMeasurement(nt.StandardInteractionClientGetDiscoveredAuthority,this.correlationId),a={protocolMode:this.config.auth.protocolMode,knownAuthorities:this.config.auth.knownAuthorities,cloudDiscoveryMetadata:this.config.auth.cloudDiscoveryMetadata,authorityMetadata:this.config.auth.authorityMetadata,skipAuthorityMetadataCache:this.config.auth.skipAuthorityMetadataCache},l=t||this.config.auth.authority,l=v0.generateAuthority(l,r||this.config.auth.azureCloudOptions),this.logger.verbose("Creating discovered authority with configured authority",this.correlationId),this.performanceClient.setPreQueueTime(nt.AuthorityFactoryCreateDiscoveredInstance,this.correlationId),[4,ME.createDiscoveredInstance(l,this.config.system.networkClient,this.browserStorage,a,this.logger,this.performanceClient,this.correlationId).then(function(p){return o.endMeasurement({success:!0}),p}).catch(function(p){throw o.endMeasurement({errorCode:p.errorCode,subErrorCode:p.subError,success:!1}),p})];case 1:return[2,h.sent()]}})})},e.prototype.initializeAuthorizationRequest=function(t,r){return dt(this,void 0,void 0,function(){var i,o,a,l,h;return ft(this,function(p){switch(p.label){case 0:return this.performanceClient.addQueueMeasurement(nt.StandardInteractionClientInitializeAuthorizationRequest,this.correlationId),this.logger.verbose("initializeAuthorizationRequest called",this.correlationId),i=this.getRedirectUri(t.redirectUri),o={interactionType:r},o=bu.setRequestState(this.browserCrypto,t&&t.state||Le.EMPTY_STRING,o),this.performanceClient.setPreQueueTime(nt.InitializeBaseRequest,this.correlationId),l=[{}],[4,this.initializeBaseRequest(t)];case 1:return a=yn.apply(void 0,[yn.apply(void 0,l.concat([p.sent()])),{redirectUri:i,state:o,nonce:t.nonce||this.browserCrypto.createNewGuid(),responseMode:bE.FRAGMENT}]),(h=t.account||this.browserStorage.getActiveAccount())&&(this.logger.verbose("Setting validated request account",this.correlationId),this.logger.verbosePii("Setting validated request account: "+h.homeAccountId,this.correlationId),a.account=h),Kt.isEmpty(a.loginHint)&&!h&&(h=this.browserStorage.getLegacyLoginHint())&&(a.loginHint=h),[2,a]}})})},e}(s9),aR=function(){function n(e,t,r,i,o){this.authModule=e,this.browserStorage=t,this.authCodeRequest=r,this.logger=i,this.performanceClient=o}return n.prototype.handleCodeResponseFromHash=function(e,t,r,i){return dt(this,void 0,void 0,function(){var o,a;return ft(this,function(l){if(this.performanceClient.addQueueMeasurement(nt.HandleCodeResponseFromHash,this.authCodeRequest.correlationId),this.logger.verbose("InteractionHandler.handleCodeResponse called"),Kt.isEmpty(e))throw Vt.createEmptyHashError(e);if(o=this.browserStorage.generateStateKey(t),!(o=this.browserStorage.getTemporaryCache(o)))throw en.createStateNotFoundError("Cached State");try{a=this.authModule.handleFragmentResponse(e,o)}catch(h){throw h instanceof Wf&&h.subError===It.userCancelledError.code?Vt.createUserCancelledError():h}return this.performanceClient.setPreQueueTime(nt.HandleCodeResponseFromServer,this.authCodeRequest.correlationId),[2,this.handleCodeResponseFromServer(a,t,r,i)]})})},n.prototype.handleCodeResponseFromServer=function(e,t,r,i,o){return o===void 0&&(o=!0),dt(this,void 0,void 0,function(){var a,l,h;return ft(this,function(p){switch(p.label){case 0:if(this.performanceClient.addQueueMeasurement(nt.HandleCodeResponseFromServer,this.authCodeRequest.correlationId),this.logger.trace("InteractionHandler.handleCodeResponseFromServer called"),a=this.browserStorage.generateStateKey(t),a=this.browserStorage.getTemporaryCache(a))return l=this.browserStorage.generateNonceKey(a),l=this.browserStorage.getTemporaryCache(l),this.authCodeRequest.code=e.code,e.cloud_instance_host_name?(this.performanceClient.setPreQueueTime(nt.UpdateTokenEndpointAuthority,this.authCodeRequest.correlationId),[4,this.updateTokenEndpointAuthority(e.cloud_instance_host_name,r,i)]):[3,2];throw en.createStateNotFoundError("Cached State");case 1:p.sent(),p.label=2;case 2:return o&&(e.nonce=l||void 0),e.state=a,e.client_info?this.authCodeRequest.clientInfo=e.client_info:(h=this.checkCcsCredentials())&&(this.authCodeRequest.ccsCredential=h),this.performanceClient.setPreQueueTime(nt.AuthClientAcquireToken,this.authCodeRequest.correlationId),[4,this.authModule.acquireToken(this.authCodeRequest,e)];case 3:return h=p.sent(),this.browserStorage.cleanRequestByState(t),[2,h]}})})},n.prototype.updateTokenEndpointAuthority=function(e,t,r){return dt(this,void 0,void 0,function(){var i;return ft(this,function(o){switch(o.label){case 0:return this.performanceClient.addQueueMeasurement(nt.UpdateTokenEndpointAuthority,this.authCodeRequest.correlationId),i="https://"+e+"/"+t.tenant+"/",[4,ME.createDiscoveredInstance(i,r,this.browserStorage,t.options,this.logger,this.performanceClient,this.authCodeRequest.correlationId)];case 1:return i=o.sent(),this.authModule.updateAuthority(i),[2]}})})},n.prototype.checkCcsCredentials=function(){var e=this.browserStorage.getTemporaryCache(Mr.CCS_CREDENTIAL,!0);if(e)try{return JSON.parse(e)}catch{this.authModule.logger.error("Cache credential could not be parsed"),this.authModule.logger.errorPii("Cache credential could not be parsed: "+e)}return null},n}(),c9=function(n){function e(t,r,i,o,a,l){return t=n.call(this,t,r,i,o,l)||this,t.browserCrypto=a,t}return Zo(e,n),e.prototype.initiateAuthRequest=function(t,r){return dt(this,void 0,void 0,function(){var i;return ft(this,function(o){switch(o.label){case 0:return this.logger.verbose("RedirectHandler.initiateAuthRequest called"),Kt.isEmpty(t)?[3,7]:(r.redirectStartPage&&(this.logger.verbose("RedirectHandler.initiateAuthRequest: redirectStartPage set, caching start page"),this.browserStorage.setTemporaryCache(Mr.ORIGIN_URI,r.redirectStartPage,!0)),this.browserStorage.setTemporaryCache(Mr.CORRELATION_ID,this.authCodeRequest.correlationId,!0),this.browserStorage.cacheCodeRequest(this.authCodeRequest,this.browserCrypto),this.logger.infoPii("RedirectHandler.initiateAuthRequest: Navigate to: "+t),i={apiId:_i.acquireTokenRedirect,timeout:r.redirectTimeout,noHistory:!1},typeof r.onRedirectNavigate!="function"?[3,4]:(this.logger.verbose("RedirectHandler.initiateAuthRequest: Invoking onRedirectNavigate callback"),r.onRedirectNavigate(t)===!1?[3,2]:(this.logger.verbose("RedirectHandler.initiateAuthRequest: onRedirectNavigate did not return false, navigating"),[4,r.navigationClient.navigateExternal(t,i)])));case 1:return o.sent(),[2];case 2:return this.logger.verbose("RedirectHandler.initiateAuthRequest: onRedirectNavigate returned false, stopping navigation"),[2];case 3:return[3,6];case 4:return this.logger.verbose("RedirectHandler.initiateAuthRequest: Navigating window to navigate url"),[4,r.navigationClient.navigateExternal(t,i)];case 5:return o.sent(),[2];case 6:return[3,8];case 7:throw this.logger.info("RedirectHandler.initiateAuthRequest: Navigate url is empty"),Vt.createEmptyNavigationUriError();case 8:return[2]}})})},e.prototype.handleCodeResponseFromHash=function(t,r,i,o){return dt(this,void 0,void 0,function(){var a,l,h,p;return ft(this,function(g){switch(g.label){case 0:if(this.logger.verbose("RedirectHandler.handleCodeResponse called"),Kt.isEmpty(t))throw Vt.createEmptyHashError(t);if(this.browserStorage.setInteractionInProgress(!1),a=this.browserStorage.generateStateKey(r),!(a=this.browserStorage.getTemporaryCache(a)))throw en.createStateNotFoundError("Cached State");try{l=this.authModule.handleFragmentResponse(t,a)}catch(_){throw _ instanceof Wf&&_.subError===It.userCancelledError.code?Vt.createUserCancelledError():_}return h=this.browserStorage.generateNonceKey(a),h=this.browserStorage.getTemporaryCache(h),this.authCodeRequest.code=l.code,l.cloud_instance_host_name?[4,this.updateTokenEndpointAuthority(l.cloud_instance_host_name,i,o)]:[3,2];case 1:g.sent(),g.label=2;case 2:return l.nonce=h||void 0,l.state=a,l.client_info?this.authCodeRequest.clientInfo=l.client_info:(p=this.checkCcsCredentials())&&(this.authCodeRequest.ccsCredential=p),[4,this.authModule.acquireToken(this.authCodeRequest,l)];case 3:return p=g.sent(),this.browserStorage.cleanRequestByState(r),[2,p]}})})},e}(aR),x0=(function(n){n.INITIALIZE_START="msal:initializeStart",n.INITIALIZE_END="msal:initializeEnd",n.ACCOUNT_ADDED="msal:accountAdded",n.ACCOUNT_REMOVED="msal:accountRemoved",n.LOGIN_START="msal:loginStart",n.LOGIN_SUCCESS="msal:loginSuccess",n.LOGIN_FAILURE="msal:loginFailure",n.ACQUIRE_TOKEN_START="msal:acquireTokenStart",n.ACQUIRE_TOKEN_SUCCESS="msal:acquireTokenSuccess",n.ACQUIRE_TOKEN_FAILURE="msal:acquireTokenFailure",n.ACQUIRE_TOKEN_NETWORK_START="msal:acquireTokenFromNetworkStart",n.SSO_SILENT_START="msal:ssoSilentStart",n.SSO_SILENT_SUCCESS="msal:ssoSilentSuccess",n.SSO_SILENT_FAILURE="msal:ssoSilentFailure",n.ACQUIRE_TOKEN_BY_CODE_START="msal:acquireTokenByCodeStart",n.ACQUIRE_TOKEN_BY_CODE_SUCCESS="msal:acquireTokenByCodeSuccess",n.ACQUIRE_TOKEN_BY_CODE_FAILURE="msal:acquireTokenByCodeFailure",n.HANDLE_REDIRECT_START="msal:handleRedirectStart",n.HANDLE_REDIRECT_END="msal:handleRedirectEnd",n.POPUP_OPENED="msal:popupOpened",n.LOGOUT_START="msal:logoutStart",n.LOGOUT_SUCCESS="msal:logoutSuccess",n.LOGOUT_FAILURE="msal:logoutFailure",n.LOGOUT_END="msal:logoutEnd",n.RESTORE_FROM_BFCACHE="msal:restoreFromBFCache"}(Fn=Fn||{}),function(n){n.USER_INTERACTION_REQUIRED="USER_INTERACTION_REQUIRED",n.USER_CANCEL="USER_CANCEL",n.NO_NETWORK="NO_NETWORK",n.TRANSIENT_ERROR="TRANSIENT_ERROR",n.PERSISTENT_ERROR="PERSISTENT_ERROR",n.DISABLED="DISABLED",n.ACCOUNT_UNAVAILABLE="ACCOUNT_UNAVAILABLE"}(Yh=Yh||{}),{extensionError:{code:"ContentError"},userSwitch:{code:"user_switch",desc:"User attempted to switch accounts in the native broker, which is not allowed. All new accounts must sign-in through the standard web flow first, please try again."},tokensNotFoundInCache:{code:"tokens_not_found_in_internal_memory_cache",desc:"Tokens not cached in MSAL JS internal memory, please make the WAM request"}}),vl=function(n){function e(t,r,i){return t=n.call(this,t,r)||this,Object.setPrototypeOf(t,e.prototype),t.name="NativeAuthError",t.ext=i,t}return Zo(e,n),e.prototype.isFatal=function(){return!(!this.ext||!this.ext.status||this.ext.status!==Yh.PERSISTENT_ERROR&&this.ext.status!==Yh.DISABLED)||this.errorCode===x0.extensionError.code},e.createError=function(t,r,i){if(i&&i.status)switch(i.status){case Yh.ACCOUNT_UNAVAILABLE:return tc.createNativeAccountUnavailableError();case Yh.USER_INTERACTION_REQUIRED:return new tc(t,r);case Yh.USER_CANCEL:return Vt.createUserCancelledError();case Yh.NO_NETWORK:return Vt.createNoNetworkConnectivityError()}return new e(t,r,i)},e.createUserSwitchError=function(){return new e(x0.userSwitch.code,x0.userSwitch.desc)},e.createTokensNotFoundInCacheError=function(){return new e(x0.tokensNotFoundInCache.code,x0.tokensNotFoundInCache.desc)},e}(wn),l9=function(n){function e(){return n!==null&&n.apply(this,arguments)||this}return Zo(e,n),e.prototype.acquireToken=function(t){return dt(this,void 0,void 0,function(){var r,i,o,a;return ft(this,function(l){switch(l.label){case 0:return r=this.performanceClient.startMeasurement(nt.SilentCacheClientAcquireToken,t.correlationId),o=this.initializeServerTelemetryManager(_i.acquireTokenSilent_silentFlow),[4,this.createSilentFlowClient(o,t.authority,t.azureCloudOptions)];case 1:i=l.sent(),this.logger.verbose("Silent auth client created"),l.label=2;case 2:return l.trys.push([2,4,,5]),[4,i.acquireCachedToken(t)];case 3:return o=l.sent(),r.endMeasurement({success:!0,fromCache:!0}),[2,o];case 4:throw(a=l.sent())instanceof Vt&&a.errorCode===It.signingKeyNotFoundInStorage.code&&this.logger.verbose("Signing keypair for bound access token not found. Refreshing bound access token and generating a new crypto keypair."),r.endMeasurement({errorCode:a instanceof wn&&a.errorCode||void 0,subErrorCode:a instanceof wn&&a.subError||void 0,success:!1}),a;case 5:return[2]}})})},e.prototype.logout=function(){return Promise.reject(Vt.createSilentLogoutUnsupportedError())},e.prototype.createSilentFlowClient=function(t,r,i){return dt(this,void 0,void 0,function(){var o;return ft(this,function(a){switch(a.label){case 0:return this.performanceClient.setPreQueueTime(nt.StandardInteractionClientGetClientConfiguration,this.correlationId),[4,this.getClientConfiguration(t,r,i)];case 1:return o=a.sent(),[2,new zwe(o,this.performanceClient)]}})})},e.prototype.initializeSilentRequest=function(t,r){return dt(this,void 0,void 0,function(){var i;return ft(this,function(o){switch(o.label){case 0:return this.performanceClient.addQueueMeasurement(nt.InitializeSilentRequest,this.correlationId),this.performanceClient.setPreQueueTime(nt.InitializeBaseRequest,this.correlationId),i=[yn({},t)],[4,this.initializeBaseRequest(t,r)];case 1:return[2,yn.apply(void 0,[yn.apply(void 0,i.concat([o.sent()])),{account:r,forceRefresh:t.forceRefresh||!1}])]}})})},e}(Rm),km=function(n){function e(t,r,i,o,a,l,h,p,g,_,x,C){return r=n.call(this,t,r,i,o,a,l,p,g,C)||this,r.apiId=h,r.accountId=_,r.nativeMessageHandler=g,r.nativeStorageManager=x,r.silentCacheClient=new l9(t,r.nativeStorageManager,i,o,a,l,p,g,C),r}return Zo(e,n),e.prototype.acquireToken=function(t){return dt(this,void 0,void 0,function(){var r,i,o,a,l;return ft(this,function(h){switch(h.label){case 0:return this.logger.trace("NativeInteractionClient - acquireToken called."),r=this.performanceClient.startMeasurement(nt.NativeInteractionClientAcquireToken,t.correlationId),i=ec.nowSeconds(),[4,this.initializeNativeRequest(t)];case 1:o=h.sent(),h.label=2;case 2:return h.trys.push([2,4,,5]),[4,this.acquireTokensFromCache(this.accountId,o)];case 3:return a=h.sent(),r.endMeasurement({success:!0,isNativeBroker:!1,fromCache:!0}),[2,a];case 4:return h.sent(),this.logger.info("MSAL internal Cache does not contain tokens, proceed to make a native call"),[3,5];case 5:return a={method:wu.GetToken,request:o},[4,this.nativeMessageHandler.sendMessage(a)];case 6:return l=h.sent(),l=this.validateNativeResponse(l),[2,this.handleNativeResponse(l,o,i).then(function(p){return r.endMeasurement({success:!0,isNativeBroker:!0,requestId:p.requestId}),p}).catch(function(p){throw r.endMeasurement({success:!1,errorCode:p.errorCode,subErrorCode:p.subError,isNativeBroker:!0}),p})]}})})},e.prototype.createSilentCacheRequest=function(t,r){return{authority:t.authority,correlationId:this.correlationId,scopes:fa.fromString(t.scope).asArray(),account:r,forceRefresh:!1}},e.prototype.acquireTokensFromCache=function(t,r){return dt(this,void 0,void 0,function(){var i,o;return ft(this,function(a){switch(a.label){case 0:if(!t)throw this.logger.warning("NativeInteractionClient:acquireTokensFromCache - No nativeAccountId provided"),en.createNoAccountFoundError();if(!(i=this.browserStorage.getAccountInfoFilteredBy({nativeAccountId:t})))throw en.createNoAccountFoundError();a.label=1;case 1:return a.trys.push([1,3,,4]),o=this.createSilentCacheRequest(r,i),[4,this.silentCacheClient.acquireToken(o)];case 2:return[2,a.sent()];case 3:throw a.sent();case 4:return[2]}})})},e.prototype.acquireTokenRedirect=function(t){return dt(this,void 0,void 0,function(){var r,i,o,a,l;return ft(this,function(h){switch(h.label){case 0:return this.logger.trace("NativeInteractionClient - acquireTokenRedirect called."),[4,this.initializeNativeRequest(t)];case 1:r=h.sent(),i={method:wu.GetToken,request:r},h.label=2;case 2:return h.trys.push([2,4,,5]),[4,this.nativeMessageHandler.sendMessage(i)];case 3:return o=h.sent(),this.validateNativeResponse(o),[3,5];case 4:if((o=h.sent())instanceof vl&&o.isFatal())throw o;return[3,5];case 5:return this.browserStorage.setTemporaryCache(Mr.NATIVE_REQUEST,JSON.stringify(r),!0),a={apiId:_i.acquireTokenRedirect,timeout:this.config.system.redirectNavigationTimeout,noHistory:!1},l=this.config.auth.navigateToLoginRequestUrl?window.location.href:this.getRedirectUri(t.redirectUri),[4,this.navigationClient.navigateExternal(l,a)];case 6:return h.sent(),[2]}})})},e.prototype.handleRedirectPromise=function(){return dt(this,void 0,void 0,function(){var t,r,i,o;return ft(this,function(a){switch(a.label){case 0:if(this.logger.trace("NativeInteractionClient - handleRedirectPromise called."),!this.browserStorage.isInteractionInProgress(!0))return this.logger.info("handleRedirectPromise called but there is no interaction in progress, returning null."),[2,null];if(!(t=this.browserStorage.getCachedNativeRequest()))return this.logger.verbose("NativeInteractionClient - handleRedirectPromise called but there is no cached request, returning null."),[2,null];r=t.prompt,t=Uj(t,["prompt"]),r&&this.logger.verbose("NativeInteractionClient - handleRedirectPromise called and prompt was included in the original request, removing prompt from cached request to prevent second interaction with native broker window."),this.browserStorage.removeItem(this.browserStorage.generateCacheKey(Mr.NATIVE_REQUEST)),r={method:wu.GetToken,request:t},i=ec.nowSeconds(),a.label=1;case 1:return a.trys.push([1,3,,4]),this.logger.verbose("NativeInteractionClient - handleRedirectPromise sending message to native broker."),[4,this.nativeMessageHandler.sendMessage(r)];case 2:return o=a.sent(),this.validateNativeResponse(o),o=this.handleNativeResponse(o,t,i),this.browserStorage.setInteractionInProgress(!1),[2,o];case 3:throw o=a.sent(),this.browserStorage.setInteractionInProgress(!1),o;case 4:return[2]}})})},e.prototype.logout=function(){return this.logger.trace("NativeInteractionClient - logout called."),Promise.reject("Logout not implemented yet")},e.prototype.handleNativeResponse=function(t,r,i){return dt(this,void 0,void 0,function(){var o,a,l,h;return ft(this,function(p){switch(p.label){case 0:if(this.logger.trace("NativeInteractionClient - handleNativeResponse called."),t.account.id!==r.accountId)throw vl.createUserSwitchError();return[4,this.getDiscoveredAuthority(r.authority)];case 1:return h=p.sent(),l=h.getPreferredCache(),o=this.createIdTokenObj(t),a=this.createHomeAccountIdentifier(t,o),l=this.createAccountEntity(t,a,o,l),[4,this.generateAuthenticationResult(t,r,o,l,h.canonicalAuthority,i)];case 2:return h=p.sent(),this.cacheAccount(l),this.cacheNativeTokens(t,r,a,l,o,h.accessToken,h.tenantId,i),[2,h]}})})},e.prototype.createIdTokenObj=function(t){return new ml(t.id_token||Le.EMPTY_STRING,this.browserCrypto)},e.prototype.createHomeAccountIdentifier=function(t,r){return Qo.generateHomeAccountId(t.client_info||Le.EMPTY_STRING,ka.Default,this.logger,this.browserCrypto,r)},e.prototype.createAccountEntity=function(t,r,i,o){return Qo.createAccount(t.client_info,r,i,void 0,void 0,void 0,o,t.account.id)},e.prototype.generateScopes=function(t,r){return t.scope?fa.fromString(t.scope):fa.fromString(r.scope)},e.prototype.generatePopAccessToken=function(t,r){return dt(this,void 0,void 0,function(){var i,o;return ft(this,function(a){switch(a.label){case 0:if(r.tokenType!==qr.POP)return[3,2];if(t.shr)return this.logger.trace("handleNativeServerResponse: SHR is enabled in native layer"),[2,t.shr];if(i=new Im(this.browserCrypto),o={resourceRequestMethod:r.resourceRequestMethod,resourceRequestUri:r.resourceRequestUri,shrClaims:r.shrClaims,shrNonce:r.shrNonce},r.keyId)return[4,i.signPopToken(t.access_token,r.keyId,o)];throw en.createKeyIdMissingError();case 1:return[2,a.sent()];case 2:return[2,t.access_token]}})})},e.prototype.generateAuthenticationResult=function(t,r,i,o,a,l){return dt(this,void 0,void 0,function(){var h,p,g,_,x,C;return ft(this,function(M){switch(M.label){case 0:return h=this.addTelemetryFromNativeResponse(t),p=t.scope?fa.fromString(t.scope):fa.fromString(r.scope),_=t.account.properties||{},g=_.UID||i.claims.oid||i.claims.sub||Le.EMPTY_STRING,_=_.TenantId||i.claims.tid||Le.EMPTY_STRING,[4,this.generatePopAccessToken(t,r)];case 1:return x=M.sent(),C=r.tokenType===qr.POP?qr.POP:qr.BEARER,[2,{authority:a,uniqueId:g,tenantId:_,scopes:p.asArray(),account:o.getAccountInfo(),idToken:t.id_token,idTokenClaims:i.claims,accessToken:x,fromCache:!!h&&this.isResponseFromCache(h),expiresOn:new Date(1e3*Number(l+t.expires_in)),tokenType:C,correlationId:this.correlationId,state:t.state,fromNativeBroker:!0}]}})})},e.prototype.cacheAccount=function(t){var r=this;this.browserStorage.setAccount(t),this.browserStorage.removeAccountContext(t).catch(function(i){r.logger.error("Error occurred while removing account context from browser storage. "+i)})},e.prototype.cacheNativeTokens=function(x,r,C,o,a,M,h,_){var g=Kf.createIdTokenEntity(C,r.authority,x.id_token||Le.EMPTY_STRING,r.clientId,a.claims.tid||Le.EMPTY_STRING),_=_+(r.tokenType===qr.POP?Le.SHR_NONCE_VALIDITY:(typeof x.expires_in=="string"?parseInt(x.expires_in,10):x.expires_in)||0),x=this.generateScopes(x,r),C=Zf.createAccessTokenEntity(C,r.authority,M,r.clientId,a?a.claims.tid||Le.EMPTY_STRING:h,x.printScopes(),_,0,this.browserCrypto),M=new IE(o,g,C);this.nativeStorageManager.saveCacheRecord(M)},e.prototype.addTelemetryFromNativeResponse=function(t){return t=this.getMATSFromResponse(t),t?(this.performanceClient.addStaticFields({extensionId:this.nativeMessageHandler.getExtensionId(),extensionVersion:this.nativeMessageHandler.getExtensionVersion(),matsBrokerVersion:t.broker_version,matsAccountJoinOnStart:t.account_join_on_start,matsAccountJoinOnEnd:t.account_join_on_end,matsDeviceJoin:t.device_join,matsPromptBehavior:t.prompt_behavior,matsApiErrorCode:t.api_error_code,matsUiVisible:t.ui_visible,matsSilentCode:t.silent_code,matsSilentBiSubCode:t.silent_bi_sub_code,matsSilentMessage:t.silent_message,matsSilentStatus:t.silent_status,matsHttpStatus:t.http_status,matsHttpEventCount:t.http_event_count},this.correlationId),t):null},e.prototype.validateNativeResponse=function(t){if(t.hasOwnProperty("access_token")&&t.hasOwnProperty("id_token")&&t.hasOwnProperty("client_info")&&t.hasOwnProperty("account")&&t.hasOwnProperty("scope")&&t.hasOwnProperty("expires_in"))return t;throw vl.createUnexpectedError("Response missing expected properties.")},e.prototype.getMATSFromResponse=function(t){if(t.properties.MATS)try{return JSON.parse(t.properties.MATS)}catch{this.logger.error("NativeInteractionClient - Error parsing MATS telemetry, returning null instead")}return null},e.prototype.isResponseFromCache=function(t){return t.is_cached===void 0?(this.logger.verbose("NativeInteractionClient - MATS telemetry does not contain field indicating if response was served from cache. Returning false."),!1):!!t.is_cached},e.prototype.initializeNativeRequest=function(t){return dt(this,void 0,void 0,function(){var r,i,o,a,l,h=this;return ft(this,function(p){switch(p.label){case 0:return this.logger.trace("NativeInteractionClient - initializeNativeRequest called"),r=t.authority||this.config.auth.authority,t.account?[4,this.validateRequestAuthority(r,t.account)]:[3,2];case 1:p.sent(),p.label=2;case 2:return(a=new wr(r)).validateAsUri(),l=t.scopes,o=Uj(t,["scopes"]),(l=new fa(l||[])).appendScopes(f0),i=function(){switch(h.apiId){case _i.ssoSilent:case _i.acquireTokenSilent_silentFlow:return h.logger.trace("initializeNativeRequest: silent request sets prompt to none"),da.NONE}if(t.prompt)switch(t.prompt){case da.NONE:case da.CONSENT:case da.LOGIN:return h.logger.trace("initializeNativeRequest: prompt is compatible with native flow"),t.prompt;default:throw h.logger.trace("initializeNativeRequest: prompt = "+t.prompt+" is not compatible with native flow"),Vt.createNativePromptParameterNotSupportedError()}else h.logger.trace("initializeNativeRequest: prompt was not provided")},o=yn(yn({},o),{accountId:this.accountId,clientId:this.config.auth.clientId,authority:a.urlString,scope:l.printScopes(),redirectUri:this.getRedirectUri(t.redirectUri),prompt:i(),correlationId:this.correlationId,tokenType:t.authenticationScheme,windowTitleSubstring:document.title,extraParameters:yn(yn(yn({},t.extraQueryParameters),t.tokenQueryParameters),{telemetry:b0.MATS_TELEMETRY}),extendedExpiryToken:!1}),t.authenticationScheme!==qr.POP?[3,4]:(a={resourceRequestUri:t.resourceRequestUri,resourceRequestMethod:t.resourceRequestMethod,shrClaims:t.shrClaims,shrNonce:t.shrNonce},[4,new Im(this.browserCrypto).generateCnf(a)]);case 3:l=p.sent(),o.reqCnf=l.reqCnfString,o.keyId=l.kid,p.label=4;case 4:return[2,o]}})})},e}(s9),Xf=function(){function n(e,t,r,i){this.logger=e,this.handshakeTimeoutMs=t,this.extensionId=i,this.resolvers=new Map,this.handshakeResolvers=new Map,this.responseId=0,this.messageChannel=new MessageChannel,this.windowListener=this.onWindowMessage.bind(this),this.performanceClient=r,this.handshakeEvent=r.startMeasurement(nt.NativeMessageHandlerHandshake)}return n.prototype.sendMessage=function(e){return dt(this,void 0,void 0,function(){var t,r=this;return ft(this,function(i){return this.logger.trace("NativeMessageHandler - sendMessage called."),t={channel:b0.CHANNEL_ID,extensionId:this.extensionId,responseId:this.responseId++,body:e},this.logger.trace("NativeMessageHandler - Sending request to browser extension"),this.logger.tracePii("NativeMessageHandler - Sending request to browser extension: "+JSON.stringify(t)),this.messageChannel.port1.postMessage(t),[2,new Promise(function(o,a){r.resolvers.set(t.responseId,{resolve:o,reject:a})})]})})},n.createProvider=function(e,t,r){return dt(this,void 0,void 0,function(){var i,o;return ft(this,function(a){switch(a.label){case 0:e.trace("NativeMessageHandler - createProvider called."),a.label=1;case 1:return a.trys.push([1,3,,5]),[4,(i=new n(e,t,r,b0.PREFERRED_EXTENSION_ID)).sendHandshakeRequest()];case 2:return a.sent(),[2,i];case 3:return a.sent(),[4,(o=new n(e,t,r)).sendHandshakeRequest()];case 4:return a.sent(),[2,o];case 5:return[2]}})})},n.prototype.sendHandshakeRequest=function(){return dt(this,void 0,void 0,function(){var e,t=this;return ft(this,function(r){return this.logger.trace("NativeMessageHandler - sendHandshakeRequest called."),window.addEventListener("message",this.windowListener,!1),e={channel:b0.CHANNEL_ID,extensionId:this.extensionId,responseId:this.responseId++,body:{method:wu.HandshakeRequest}},this.handshakeEvent.addStaticFields({extensionId:this.extensionId,extensionHandshakeTimeoutMs:this.handshakeTimeoutMs}),this.messageChannel.port1.onmessage=function(i){t.onChannelMessage(i)},window.postMessage(e,window.origin,[this.messageChannel.port2]),[2,new Promise(function(i,o){t.handshakeResolvers.set(e.responseId,{resolve:i,reject:o}),t.timeoutId=window.setTimeout(function(){window.removeEventListener("message",t.windowListener,!1),t.messageChannel.port1.close(),t.messageChannel.port2.close(),t.handshakeEvent.endMeasurement({extensionHandshakeTimedOut:!0,success:!1}),o(Vt.createNativeHandshakeTimeoutError()),t.handshakeResolvers.delete(e.responseId)},t.handshakeTimeoutMs)})]})})},n.prototype.onWindowMessage=function(e){this.logger.trace("NativeMessageHandler - onWindowMessage called"),e.source!==window||!(e=e.data).channel||e.channel!==b0.CHANNEL_ID||e.extensionId&&e.extensionId!==this.extensionId||e.body.method===wu.HandshakeRequest&&(this.logger.verbose(e.extensionId?"Extension with id: "+e.extensionId+" not installed":"No extension installed"),clearTimeout(this.timeoutId),this.messageChannel.port1.close(),this.messageChannel.port2.close(),window.removeEventListener("message",this.windowListener,!1),e=this.handshakeResolvers.get(e.responseId))&&(this.handshakeEvent.endMeasurement({success:!1,extensionInstalled:!1}),e.reject(Vt.createNativeExtensionNotInstalledError()))},n.prototype.onChannelMessage=function(e){this.logger.trace("NativeMessageHandler - onChannelMessage called.");var t=e.data,r=this.resolvers.get(t.responseId),i=this.handshakeResolvers.get(t.responseId);try{var o=t.body.method;if(o===wu.Response){if(r){var a=t.body.response;if(this.logger.trace("NativeMessageHandler - Received response from browser extension"),this.logger.tracePii("NativeMessageHandler - Received response from browser extension: "+JSON.stringify(a)),a.status!=="Success")r.reject(vl.createError(a.code,a.description,a.ext));else{if(!a.result)throw wn.createUnexpectedError("Event does not contain result.");a.result.code&&a.result.description?r.reject(vl.createError(a.result.code,a.result.description,a.result.ext)):r.resolve(a.result)}this.resolvers.delete(t.responseId)}}else o===wu.HandshakeResponse&&i&&(clearTimeout(this.timeoutId),window.removeEventListener("message",this.windowListener,!1),this.extensionId=t.extensionId,this.extensionVersion=t.body.version,this.logger.verbose("NativeMessageHandler - Received HandshakeResponse from extension: "+this.extensionId),this.handshakeEvent.endMeasurement({extensionInstalled:!0,success:!0}),i.resolve(),this.handshakeResolvers.delete(t.responseId))}catch(l){this.logger.error("Error parsing response from WAM Extension"),this.logger.errorPii("Error parsing response from WAM Extension: "+l.toString()),this.logger.errorPii("Unable to parse "+e),r?r.reject(l):i&&i.reject(l)}},n.prototype.getExtensionId=function(){return this.extensionId},n.prototype.getExtensionVersion=function(){return this.extensionVersion},n.isNativeAvailable=function(e,t,r,i){if(t.trace("isNativeAvailable called"),!e.system.allowNativeBroker)return t.trace("isNativeAvailable: allowNativeBroker is not enabled, returning false"),!1;if(!r)return t.trace("isNativeAvailable: WAM extension provider is not initialized, returning false"),!1;if(i)switch(i){case qr.BEARER:case qr.POP:return t.trace("isNativeAvailable: authenticationScheme is supported, returning true"),!0;default:return t.trace("isNativeAvailable: authenticationScheme is not supported, returning false"),!1}return!0},n}(),exe=function(n){function e(t,r,i,o,a,l,h,p,g,_){return t=n.call(this,t,r,i,o,a,l,h,g,_)||this,t.nativeStorage=p,t}return Zo(e,n),e.prototype.acquireToken=function(t){return dt(this,void 0,void 0,function(){var r,i,o,a,l,h,p,g=this;return ft(this,function(_){switch(_.label){case 0:return this.performanceClient.setPreQueueTime(nt.StandardInteractionClientInitializeAuthorizationRequest,t.correlationId),[4,this.initializeAuthorizationRequest(t,hn.Redirect)];case 1:r=_.sent(),this.browserStorage.updateCacheEntries(r.state,r.nonce,r.authority,r.loginHint||Le.EMPTY_STRING,r.account||null),i=this.initializeServerTelemetryManager(_i.acquireTokenRedirect),o=function(x){x.persisted&&(g.logger.verbose("Page was restored from back/forward cache. Clearing temporary cache."),g.browserStorage.cleanRequestByState(r.state),g.eventHandler.emitEvent(Fn.RESTORE_FROM_BFCACHE,hn.Redirect))},_.label=2;case 2:return _.trys.push([2,7,,8]),this.performanceClient.setPreQueueTime(nt.StandardInteractionClientInitializeAuthorizationCodeRequest,t.correlationId),[4,this.initializeAuthorizationCodeRequest(r)];case 3:return a=_.sent(),this.performanceClient.setPreQueueTime(nt.StandardInteractionClientCreateAuthCodeClient,t.correlationId),[4,this.createAuthCodeClient(i,r.authority,r.azureCloudOptions)];case 4:return h=_.sent(),this.logger.verbose("Auth code client created"),l=new c9(h,this.browserStorage,a,this.logger,this.browserCrypto,this.performanceClient),[4,h.getAuthCodeUrl(yn(yn({},r),{nativeBroker:Xf.isNativeAvailable(this.config,this.logger,this.nativeMessageHandler,t.authenticationScheme)}))];case 5:return h=_.sent(),p=this.getRedirectStartPage(t.redirectStartPage),this.logger.verbosePii("Redirect start page: "+p),window.addEventListener("pageshow",o),[4,l.initiateAuthRequest(h,{navigationClient:this.navigationClient,redirectTimeout:this.config.system.redirectNavigationTimeout,redirectStartPage:p,onRedirectNavigate:t.onRedirectNavigate})];case 6:return[2,_.sent()];case 7:throw(p=_.sent())instanceof wn&&p.setCorrelationId(this.correlationId),window.removeEventListener("pageshow",o),i.cacheFailedRequest(p),this.browserStorage.cleanRequestByState(r.state),p;case 8:return[2]}})})},e.prototype.handleRedirectPromise=function(t){return dt(this,void 0,void 0,function(){var r,i,o,a,l,h,p,g,_,x;return ft(this,function(C){switch(C.label){case 0:r=this.initializeServerTelemetryManager(_i.handleRedirectPromise),C.label=1;case 1:if(C.trys.push([1,10,,11]),!this.browserStorage.isInteractionInProgress(!0))return this.logger.info("handleRedirectPromise called but there is no interaction in progress, returning null."),[2,null];if(!(i=this.getRedirectResponseHash(t||window.location.hash)))return this.logger.info("handleRedirectPromise did not detect a response hash as a result of a redirect. Cleaning temporary cache."),this.browserStorage.cleanRequestByInteractionType(hn.Redirect),[2,null];o=void 0;try{a=wr.getDeserializedHash(i),o=this.validateAndExtractStateFromHash(a,hn.Redirect),this.logger.verbose("State extracted from hash")}catch(M){return this.logger.info("handleRedirectPromise was unable to extract state due to: "+M),this.browserStorage.cleanRequestByInteractionType(hn.Redirect),[2,null]}return l=this.browserStorage.getTemporaryCache(Mr.ORIGIN_URI,!0)||Le.EMPTY_STRING,h=wr.removeHashFromUrl(l),_=wr.removeHashFromUrl(window.location.href),h===_&&this.config.auth.navigateToLoginRequestUrl?(this.logger.verbose("Current page is loginRequestUrl, handling hash"),[4,this.handleHash(i,o,r)]):[3,3];case 2:return h=C.sent(),-1<l.indexOf("#")&&qi.replaceHash(l),[2,h];case 3:return this.config.auth.navigateToLoginRequestUrl?[3,4]:(this.logger.verbose("NavigateToLoginRequestUrl set to false, handling hash"),[2,this.handleHash(i,o,r)]);case 4:return qi.isInIframe()&&!this.config.system.allowRedirectInIframe?[3,9]:(this.browserStorage.setTemporaryCache(Mr.URL_HASH,i,!0),p={apiId:_i.handleRedirectPromise,timeout:this.config.system.redirectNavigationTimeout,noHistory:!0},g=!0,l&&l!=="null"?[3,6]:(_=qi.getHomepage(),this.browserStorage.setTemporaryCache(Mr.ORIGIN_URI,_,!0),this.logger.warning("Unable to get valid login request url from cache, redirecting to home page"),[4,this.navigationClient.navigateInternal(_,p)]));case 5:return g=C.sent(),[3,8];case 6:return this.logger.verbose("Navigating to loginRequestUrl: "+l),[4,this.navigationClient.navigateInternal(l,p)];case 7:g=C.sent(),C.label=8;case 8:if(!g)return[2,this.handleHash(i,o,r)];C.label=9;case 9:return[2,null];case 10:throw(x=C.sent())instanceof wn&&x.setCorrelationId(this.correlationId),r.cacheFailedRequest(x),this.browserStorage.cleanRequestByInteractionType(hn.Redirect),x;case 11:return[2]}})})},e.prototype.getRedirectResponseHash=function(t){return this.logger.verbose("getRedirectResponseHash called"),wr.hashContainsKnownProperties(t)?(qi.clearHash(window),this.logger.verbose("Hash contains known properties, returning response hash")):(t=this.browserStorage.getTemporaryCache(Mr.URL_HASH,!0),this.browserStorage.removeItem(this.browserStorage.generateCacheKey(Mr.URL_HASH)),this.logger.verbose("Hash does not contain known properties, returning cached hash")),t},e.prototype.handleHash=function(t,r,i){return dt(this,void 0,void 0,function(){var o,a,l,h=this;return ft(this,function(p){switch(p.label){case 0:if(o=this.browserStorage.getCachedRequest(r,this.browserCrypto),this.logger.verbose("handleHash called, retrieved cached request"),(a=wr.getDeserializedHash(t)).accountId){if(this.logger.verbose("Account id found in hash, calling WAM for token"),this.nativeMessageHandler)return a=new km(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,_i.acquireTokenPopup,this.performanceClient,this.nativeMessageHandler,a.accountId,this.nativeStorage,o.correlationId),l=bu.parseRequestState(this.browserCrypto,r).userRequestState,[2,a.acquireToken(yn(yn({},o),{state:l,prompt:void 0})).finally(function(){h.browserStorage.cleanRequestByState(r)})];throw Vt.createNativeConnectionNotEstablishedError()}if(a=this.browserStorage.getCachedAuthority(r))return this.performanceClient.setPreQueueTime(nt.StandardInteractionClientCreateAuthCodeClient,o.correlationId),[4,this.createAuthCodeClient(i,a)];throw Vt.createNoCachedAuthorityError();case 1:return l=p.sent(),this.logger.verbose("Auth code client created"),AE.removeThrottle(this.browserStorage,this.config.auth.clientId,o),[4,new c9(l,this.browserStorage,o,this.logger,this.browserCrypto,this.performanceClient).handleCodeResponseFromHash(t,r,l.authority,this.networkClient)];case 2:return[2,p.sent()]}})})},e.prototype.logout=function(t){return dt(this,void 0,void 0,function(){var r,i,o,a,l;return ft(this,function(h){switch(h.label){case 0:this.logger.verbose("logoutRedirect called"),r=this.initializeLogoutRequest(t),i=this.initializeServerTelemetryManager(_i.logout),h.label=1;case 1:return h.trys.push([1,10,,11]),this.eventHandler.emitEvent(Fn.LOGOUT_START,hn.Redirect,t),[4,this.clearCacheOnLogout(r.account)];case 2:return h.sent(),o={apiId:_i.logout,timeout:this.config.system.redirectNavigationTimeout,noHistory:!1},this.performanceClient.setPreQueueTime(nt.StandardInteractionClientCreateAuthCodeClient,r.correlationId),[4,this.createAuthCodeClient(i,t&&t.authority)];case 3:return a=h.sent(),this.logger.verbose("Auth code client created"),a=a.getLogoutUri(r),this.eventHandler.emitEvent(Fn.LOGOUT_SUCCESS,hn.Redirect,r),t&&typeof t.onRedirectNavigate=="function"?t.onRedirectNavigate(a)===!1?[3,5]:(this.logger.verbose("Logout onRedirectNavigate did not return false, navigating"),this.browserStorage.getInteractionInProgress()||this.browserStorage.setInteractionInProgress(!0),[4,this.navigationClient.navigateExternal(a,o)]):[3,7];case 4:return h.sent(),[2];case 5:this.browserStorage.setInteractionInProgress(!1),this.logger.verbose("Logout onRedirectNavigate returned false, stopping navigation"),h.label=6;case 6:return[3,9];case 7:return this.browserStorage.getInteractionInProgress()||this.browserStorage.setInteractionInProgress(!0),[4,this.navigationClient.navigateExternal(a,o)];case 8:return h.sent(),[2];case 9:return[3,11];case 10:throw(l=h.sent())instanceof wn&&l.setCorrelationId(this.correlationId),i.cacheFailedRequest(l),this.eventHandler.emitEvent(Fn.LOGOUT_FAILURE,hn.Redirect,null,l),this.eventHandler.emitEvent(Fn.LOGOUT_END,hn.Redirect),l;case 11:return this.eventHandler.emitEvent(Fn.LOGOUT_END,hn.Redirect),[2]}})})},e.prototype.getRedirectStartPage=function(t){return t=t||window.location.href,wr.getAbsoluteUrl(t,qi.getCurrentUri())},e}(Rm),txe=function(n){function e(t,r,i,o,a,l,h,p,g,_){return t=n.call(this,t,r,i,o,a,l,h,g,_)||this,t.unloadWindow=t.unloadWindow.bind(t),t.nativeStorage=p,t}return Zo(e,n),e.prototype.acquireToken=function(t){try{var r,i=this.generatePopupName(t.scopes||f0,t.authority||this.config.auth.authority),o=t.popupWindowAttributes||{};return this.config.system.asyncPopups?(this.logger.verbose("asyncPopups set to true, acquiring token"),this.acquireTokenPopupAsync(t,i,o)):(this.logger.verbose("asyncPopup set to false, opening popup before acquiring token"),r=this.openSizedPopup("about:blank",i,o),this.acquireTokenPopupAsync(t,i,o,r))}catch(a){return Promise.reject(a)}},e.prototype.logout=function(t){try{this.logger.verbose("logoutPopup called");var r,i=this.initializeLogoutRequest(t),o=this.generateLogoutPopupName(i),a=t&&t.authority,l=t&&t.mainWindowRedirectUri,h=(t==null?void 0:t.popupWindowAttributes)||{};return this.config.system.asyncPopups?(this.logger.verbose("asyncPopups set to true"),this.logoutPopupAsync(i,o,h,a,void 0,l)):(this.logger.verbose("asyncPopup set to false, opening popup"),r=this.openSizedPopup("about:blank",o,h),this.logoutPopupAsync(i,o,h,a,r,l))}catch(p){return Promise.reject(p)}},e.prototype.acquireTokenPopupAsync=function(t,r,i,o){return dt(this,void 0,void 0,function(){var a,l,h,p,g,_,x,C,M,L,F,z=this;return ft(this,function(ee){switch(ee.label){case 0:return this.logger.verbose("acquireTokenPopupAsync called"),a=this.initializeServerTelemetryManager(_i.acquireTokenPopup),this.performanceClient.setPreQueueTime(nt.StandardInteractionClientInitializeAuthorizationRequest,t.correlationId),[4,this.initializeAuthorizationRequest(t,hn.Popup)];case 1:l=ee.sent(),this.browserStorage.updateCacheEntries(l.state,l.nonce,l.authority,l.loginHint||Le.EMPTY_STRING,l.account||null),ee.label=2;case 2:return ee.trys.push([2,8,,9]),this.performanceClient.setPreQueueTime(nt.StandardInteractionClientInitializeAuthorizationCodeRequest,t.correlationId),[4,this.initializeAuthorizationCodeRequest(l)];case 3:return h=ee.sent(),this.performanceClient.setPreQueueTime(nt.StandardInteractionClientCreateAuthCodeClient,t.correlationId),[4,this.createAuthCodeClient(a,l.authority,l.azureCloudOptions)];case 4:return p=ee.sent(),this.logger.verbose("Auth code client created"),_=Xf.isNativeAvailable(this.config,this.logger,this.nativeMessageHandler,t.authenticationScheme),g=void 0,_&&(g=this.performanceClient.startMeasurement(nt.FetchAccountIdWithNativeBroker,t.correlationId)),[4,p.getAuthCodeUrl(yn(yn({},l),{nativeBroker:_}))];case 5:return _=ee.sent(),x=new aR(p,this.browserStorage,h,this.logger,this.performanceClient),C={popup:o,popupName:r,popupWindowAttributes:i},C=this.initiateAuthRequest(_,C),this.eventHandler.emitEvent(Fn.POPUP_OPENED,hn.Popup,{popupWindow:C},null),[4,this.monitorPopupForHash(C)];case 6:if(C=ee.sent(),F=wr.getDeserializedHash(C),M=this.validateAndExtractStateFromHash(F,hn.Popup,l.correlationId),AE.removeThrottle(this.browserStorage,this.config.auth.clientId,h),F.accountId){if(this.logger.verbose("Account id found in hash, calling WAM for token"),g&&g.endMeasurement({success:!0,isNativeBroker:!0}),this.nativeMessageHandler)return F=new km(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,_i.acquireTokenPopup,this.performanceClient,this.nativeMessageHandler,F.accountId,this.nativeStorage,l.correlationId),L=bu.parseRequestState(this.browserCrypto,M).userRequestState,[2,F.acquireToken(yn(yn({},l),{state:L,prompt:void 0})).finally(function(){z.browserStorage.cleanRequestByState(M)})];throw Vt.createNativeConnectionNotEstablishedError()}return[4,x.handleCodeResponseFromHash(C,M,p.authority,this.networkClient)];case 7:return[2,ee.sent()];case 8:throw F=ee.sent(),o&&o.close(),F instanceof wn&&F.setCorrelationId(this.correlationId),a.cacheFailedRequest(F),this.browserStorage.cleanRequestByState(l.state),F;case 9:return[2]}})})},e.prototype.logoutPopupAsync=function(t,r,i,o,a,l){return dt(this,void 0,void 0,function(){var h,p,g;return ft(this,function(_){switch(_.label){case 0:this.logger.verbose("logoutPopupAsync called"),this.eventHandler.emitEvent(Fn.LOGOUT_START,hn.Popup,t),h=this.initializeServerTelemetryManager(_i.logoutPopup),_.label=1;case 1:return _.trys.push([1,5,,6]),[4,this.clearCacheOnLogout(t.account)];case 2:return _.sent(),this.performanceClient.setPreQueueTime(nt.StandardInteractionClientCreateAuthCodeClient,t.correlationId),[4,this.createAuthCodeClient(h,o)];case 3:return p=_.sent(),this.logger.verbose("Auth code client created"),p=p.getLogoutUri(t),this.eventHandler.emitEvent(Fn.LOGOUT_SUCCESS,hn.Popup,t),p=this.openPopup(p,{popupName:r,popupWindowAttributes:i,popup:a}),this.eventHandler.emitEvent(Fn.POPUP_OPENED,hn.Popup,{popupWindow:p},null),[4,this.waitForLogoutPopup(p)];case 4:return _.sent(),l?(p={apiId:_i.logoutPopup,timeout:this.config.system.redirectNavigationTimeout,noHistory:!1},g=wr.getAbsoluteUrl(l,qi.getCurrentUri()),this.logger.verbose("Redirecting main window to url specified in the request"),this.logger.verbosePii("Redirecting main window to: "+g),this.navigationClient.navigateInternal(g,p)):this.logger.verbose("No main window navigation requested"),[3,6];case 5:throw g=_.sent(),a&&a.close(),g instanceof wn&&g.setCorrelationId(this.correlationId),this.browserStorage.setInteractionInProgress(!1),this.eventHandler.emitEvent(Fn.LOGOUT_FAILURE,hn.Popup,null,g),this.eventHandler.emitEvent(Fn.LOGOUT_END,hn.Popup),h.cacheFailedRequest(g),g;case 6:return this.eventHandler.emitEvent(Fn.LOGOUT_END,hn.Popup),[2]}})})},e.prototype.initiateAuthRequest=function(t,r){if(Kt.isEmpty(t))throw this.logger.error("Navigate url is empty"),Vt.createEmptyNavigationUriError();return this.logger.infoPii("Navigate to: "+t),this.openPopup(t,r)},e.prototype.monitorPopupForHash=function(t){var r=this;return new Promise(function(i,o){var a=r.config.system.windowHashTimeout/r.config.system.pollIntervalMilliseconds,l=0,h=(r.logger.verbose("PopupHandler.monitorPopupForHash - polling started"),setInterval(function(){if(t.closed)r.logger.error("PopupHandler.monitorPopupForHash - window closed"),r.cleanPopup(),clearInterval(h),o(Vt.createUserCancelledError());else{var p=Le.EMPTY_STRING,g=Le.EMPTY_STRING;try{p=t.location.href,g=t.location.hash}catch{}Kt.isEmpty(p)||p==="about:blank"||(r.logger.verbose("PopupHandler.monitorPopupForHash - popup window is on same origin as caller"),l++,g?(r.logger.verbose("PopupHandler.monitorPopupForHash - found hash in url"),clearInterval(h),r.cleanPopup(t),wr.hashContainsKnownProperties(g)?(r.logger.verbose("PopupHandler.monitorPopupForHash - hash contains known properties, returning."),i(g)):(r.logger.error("PopupHandler.monitorPopupForHash - found hash in url but it does not contain known properties. Check that your router is not changing the hash prematurely."),r.logger.errorPii("PopupHandler.monitorPopupForHash - hash found: "+g),o(Vt.createHashDoesNotContainKnownPropertiesError()))):a<l&&(r.logger.error("PopupHandler.monitorPopupForHash - unable to find hash in url, timing out"),clearInterval(h),o(Vt.createMonitorPopupTimeoutError())))}},r.config.system.pollIntervalMilliseconds))})},e.prototype.waitForLogoutPopup=function(t){var r=this;return new Promise(function(i){r.logger.verbose("PopupHandler.waitForLogoutPopup - polling started");var o=setInterval(function(){t.closed&&(r.logger.error("PopupHandler.waitForLogoutPopup - window closed"),r.cleanPopup(),clearInterval(o),i());var a=Le.EMPTY_STRING;try{a=t.location.href}catch{}Kt.isEmpty(a)||a==="about:blank"||(r.logger.verbose("PopupHandler.waitForLogoutPopup - popup window is on same origin as caller, closing."),clearInterval(o),r.cleanPopup(t),i())},r.config.system.pollIntervalMilliseconds)})},e.prototype.openPopup=function(t,r){try{var i=void 0;if(r.popup?(i=r.popup,this.logger.verbosePii("Navigating popup window to: "+t),i.location.assign(t)):r.popup===void 0&&(this.logger.verbosePii("Opening popup window to: "+t),i=this.openSizedPopup(t,r.popupName,r.popupWindowAttributes)),i)return i.focus&&i.focus(),this.currentWindow=i,window.addEventListener("beforeunload",this.unloadWindow),i;throw Vt.createEmptyWindowCreatedError()}catch(o){throw this.logger.error("error opening popup "+o.message),this.browserStorage.setInteractionInProgress(!1),Vt.createPopupWindowError(o.toString())}},e.prototype.openSizedPopup=function(t,r,x){var o=window.screenLeft||window.screenX,a=window.screenTop||window.screenY,l=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,h=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight,p=(p=x.popupSize)==null?void 0:p.width,g=(g=x.popupSize)==null?void 0:g.height,_=(_=x.popupPosition)==null?void 0:_.top,x=(x=x.popupPosition)==null?void 0:x.left;return(!p||p<0||l<p)&&(this.logger.verbose("Default popup window width used. Window width not configured or invalid."),p=Pc.POPUP_WIDTH),(!g||g<0||h<g)&&(this.logger.verbose("Default popup window height used. Window height not configured or invalid."),g=Pc.POPUP_HEIGHT),(!_||_<0||h<_)&&(this.logger.verbose("Default popup window top position used. Window top not configured or invalid."),_=Math.max(0,h/2-Pc.POPUP_HEIGHT/2+a)),(!x||x<0||l<x)&&(this.logger.verbose("Default popup window left position used. Window left not configured or invalid."),x=Math.max(0,l/2-Pc.POPUP_WIDTH/2+o)),window.open(t,r,"width="+p+", height="+g+", top="+_+", left="+x+", scrollbars=yes")},e.prototype.unloadWindow=function(t){this.browserStorage.cleanRequestByInteractionType(hn.Popup),this.currentWindow&&this.currentWindow.close(),t.preventDefault()},e.prototype.cleanPopup=function(t){t&&t.close(),window.removeEventListener("beforeunload",this.unloadWindow),this.browserStorage.setInteractionInProgress(!1)},e.prototype.generatePopupName=function(t,r){return Pc.POPUP_NAME_PREFIX+"."+this.config.auth.clientId+"."+t.join("-")+"."+r+"."+this.correlationId},e.prototype.generateLogoutPopupName=function(t){return t=t.account&&t.account.homeAccountId,Pc.POPUP_NAME_PREFIX+"."+this.config.auth.clientId+"."+t+"."+this.correlationId},e}(Rm),nxe=function(){function n(){}return n.prototype.navigateInternal=function(e,t){return n.defaultNavigateWindow(e,t)},n.prototype.navigateExternal=function(e,t){return n.defaultNavigateWindow(e,t)},n.defaultNavigateWindow=function(e,t){return t.noHistory?window.location.replace(e):window.location.assign(e),new Promise(function(r){setTimeout(function(){r(!0)},t.timeout)})},n}(),rxe=6e4,sR=6e3,ixe=3e4,oxe=2e3;function axe(i,l){var t=i.auth,r=i.cache,h=i.system,i=i.telemetry,o={clientId:Le.EMPTY_STRING,authority:""+Le.DEFAULT_AUTHORITY,knownAuthorities:[],cloudDiscoveryMetadata:Le.EMPTY_STRING,authorityMetadata:Le.EMPTY_STRING,redirectUri:Le.EMPTY_STRING,postLogoutRedirectUri:Le.EMPTY_STRING,navigateToLoginRequestUrl:!0,clientCapabilities:[],protocolMode:_0.AAD,azureCloudOptions:{azureCloudInstance:d0.None,tenant:Le.EMPTY_STRING},skipAuthorityMetadataCache:!1},a={cacheLocation:go.SessionStorage,temporaryCacheLocation:go.SessionStorage,storeAuthStateInCookie:!1,secureCookies:!1,cacheMigrationEnabled:!(!r||r.cacheLocation!==go.LocalStorage),claimsBasedCachingEnabled:!0},p={loggerCallback:function(){},logLevel:No.Info,piiLoggingEnabled:!1},l=yn(yn({},qj),{loggerOptions:p,networkClient:l?qi.getBrowserNetworkClient():qwe,navigationClient:new nxe,loadFrameTimeout:0,windowHashTimeout:(h==null?void 0:h.loadFrameTimeout)||rxe,iframeHashTimeout:(h==null?void 0:h.loadFrameTimeout)||sR,navigateFrameWait:l&&qi.detectIEOrEdge()?500:0,redirectNavigationTimeout:ixe,asyncPopups:!1,allowRedirectInIframe:!1,allowNativeBroker:!1,nativeBrokerHandshakeTimeout:(h==null?void 0:h.nativeBrokerHandshakeTimeout)||oxe,pollIntervalMilliseconds:Pc.DEFAULT_POLL_INTERVAL_MS,cryptoOptions:{useMsrCrypto:!1,entropy:void 0}}),h=yn(yn({},h),{loggerOptions:(h==null?void 0:h.loggerOptions)||p}),p={application:{appName:Le.EMPTY_STRING,appVersion:Le.EMPTY_STRING}};return{auth:yn(yn({},o),t),cache:yn(yn({},a),r),system:yn(yn({},l),h),telemetry:yn(yn({},p),i)}}var LE,u9=function(n){function e(t,r,i,o,a,l){return t=n.call(this,t,r,i,o,l)||this,t.navigateFrameWait=a.navigateFrameWait,t.pollIntervalMilliseconds=a.pollIntervalMilliseconds,t}return Zo(e,n),e.prototype.initiateAuthRequest=function(t){return dt(this,void 0,void 0,function(){return ft(this,function(r){switch(r.label){case 0:if(this.performanceClient.addQueueMeasurement(nt.SilentHandlerInitiateAuthRequest,this.authCodeRequest.correlationId),Kt.isEmpty(t))throw this.logger.info("Navigate url is empty"),Vt.createEmptyNavigationUriError();return this.navigateFrameWait?(this.performanceClient.setPreQueueTime(nt.SilentHandlerLoadFrame,this.authCodeRequest.correlationId),[4,this.loadFrame(t)]):[3,2];case 1:return[2,r.sent()];case 2:return[2,this.loadFrameSync(t)]}})})},e.prototype.monitorIframeForHash=function(t,r){var i=this;return this.performanceClient.addQueueMeasurement(nt.SilentHandlerMonitorIframeForHash,this.authCodeRequest.correlationId),new Promise(function(o,a){r<sR&&i.logger.warning("system.loadFrameTimeout or system.iframeHashTimeout set to lower ("+r+"ms) than the default ("+sR+"ms). This may result in timeouts.");var l=window.performance.now()+r,h=setInterval(function(){if(window.performance.now()>l)i.removeHiddenIframe(t),clearInterval(h),a(Vt.createMonitorIframeTimeoutError());else{var p=Le.EMPTY_STRING,g=t.contentWindow;try{p=g?g.location.href:Le.EMPTY_STRING}catch{}Kt.isEmpty(p)||(p=g?g.location.hash:Le.EMPTY_STRING,wr.hashContainsKnownProperties(p)&&(i.removeHiddenIframe(t),clearInterval(h),o(p)))}},i.pollIntervalMilliseconds)})},e.prototype.loadFrame=function(t){var r=this;return this.performanceClient.addQueueMeasurement(nt.SilentHandlerLoadFrame,this.authCodeRequest.correlationId),new Promise(function(i,o){var a=r.createHiddenIframe();setTimeout(function(){a?(a.src=t,i(a)):o("Unable to load iframe")},r.navigateFrameWait)})},e.prototype.loadFrameSync=function(t){var r=this.createHiddenIframe();return r.src=t,r},e.prototype.createHiddenIframe=function(){var t=document.createElement("iframe");return t.style.visibility="hidden",t.style.position="absolute",t.style.width=t.style.height="0",t.style.border="0",t.setAttribute("sandbox","allow-scripts allow-same-origin allow-forms"),document.getElementsByTagName("body")[0].appendChild(t),t},e.prototype.removeHiddenIframe=function(t){document.body===t.parentNode&&document.body.removeChild(t)},e}(aR),sxe=function(n){function e(t,r,i,o,a,l,h,p,g,_,x){return t=n.call(this,t,r,i,o,a,l,p,_,x)||this,t.apiId=h,t.nativeStorage=g,t}return Zo(e,n),e.prototype.acquireToken=function(t){return dt(this,void 0,void 0,function(){var r,i,o,a;return ft(this,function(l){switch(l.label){case 0:if(this.performanceClient.addQueueMeasurement(nt.SilentIframeClientAcquireToken,t.correlationId),this.logger.verbose("acquireTokenByIframe called"),r=this.performanceClient.startMeasurement(nt.SilentIframeClientAcquireToken,t.correlationId),Kt.isEmpty(t.loginHint)&&Kt.isEmpty(t.sid)&&(!t.account||Kt.isEmpty(t.account.username))&&this.logger.warning("No user hint provided. The authorization server may need more information to complete this request."),t.prompt&&t.prompt!==da.NONE&&t.prompt!==da.NO_SESSION)throw r.endMeasurement({success:!1}),Vt.createSilentPromptValueError(t.prompt);return this.performanceClient.setPreQueueTime(nt.StandardInteractionClientInitializeAuthorizationRequest,t.correlationId),[4,this.initializeAuthorizationRequest(yn(yn({},t),{prompt:t.prompt||da.NONE}),hn.Silent)];case 1:i=l.sent(),this.browserStorage.updateCacheEntries(i.state,i.nonce,i.authority,i.loginHint||Le.EMPTY_STRING,i.account||null),o=this.initializeServerTelemetryManager(this.apiId),l.label=2;case 2:return l.trys.push([2,5,,6]),this.performanceClient.setPreQueueTime(nt.StandardInteractionClientCreateAuthCodeClient,t.correlationId),[4,this.createAuthCodeClient(o,i.authority,i.azureCloudOptions)];case 3:return a=l.sent(),this.logger.verbose("Auth code client created"),this.performanceClient.setPreQueueTime(nt.SilentIframeClientTokenHelper,t.correlationId),[4,this.silentTokenHelper(a,i).then(function(h){return r.endMeasurement({success:!0,fromCache:!1,requestId:h.requestId}),h})];case 4:return[2,l.sent()];case 5:throw(a=l.sent())instanceof wn&&a.setCorrelationId(this.correlationId),o.cacheFailedRequest(a),this.browserStorage.cleanRequestByState(i.state),r.endMeasurement({errorCode:a instanceof wn&&a.errorCode||void 0,subErrorCode:a instanceof wn&&a.subError||void 0,success:!1}),a;case 6:return[2]}})})},e.prototype.logout=function(){return Promise.reject(Vt.createSilentLogoutUnsupportedError())},e.prototype.silentTokenHelper=function(t,r){return dt(this,void 0,void 0,function(){var i,o,a,l,h,p,g,_=this;return ft(this,function(x){switch(x.label){case 0:return this.performanceClient.addQueueMeasurement(nt.SilentIframeClientTokenHelper,r.correlationId),this.performanceClient.setPreQueueTime(nt.StandardInteractionClientInitializeAuthorizationCodeRequest,r.correlationId),[4,this.initializeAuthorizationCodeRequest(r)];case 1:return i=x.sent(),this.performanceClient.setPreQueueTime(nt.GetAuthCodeUrl,r.correlationId),[4,t.getAuthCodeUrl(yn(yn({},r),{nativeBroker:Xf.isNativeAvailable(this.config,this.logger,this.nativeMessageHandler,r.authenticationScheme)}))];case 2:return a=x.sent(),o=new u9(t,this.browserStorage,i,this.logger,this.config.system,this.performanceClient),this.performanceClient.setPreQueueTime(nt.SilentHandlerInitiateAuthRequest,r.correlationId),[4,o.initiateAuthRequest(a)];case 3:return a=x.sent(),this.performanceClient.setPreQueueTime(nt.SilentHandlerMonitorIframeForHash,r.correlationId),[4,o.monitorIframeForHash(a,this.config.system.iframeHashTimeout)];case 4:if(l=x.sent(),p=wr.getDeserializedHash(l),h=this.validateAndExtractStateFromHash(p,hn.Silent,i.correlationId),p.accountId){if(this.logger.verbose("Account id found in hash, calling WAM for token"),this.nativeMessageHandler)return p=new km(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,this.apiId,this.performanceClient,this.nativeMessageHandler,p.accountId,this.browserStorage,this.correlationId),g=bu.parseRequestState(this.browserCrypto,h).userRequestState,[2,p.acquireToken(yn(yn({},r),{state:g,prompt:r.prompt||da.NONE})).finally(function(){_.browserStorage.cleanRequestByState(h)})];throw Vt.createNativeConnectionNotEstablishedError()}return this.performanceClient.setPreQueueTime(nt.HandleCodeResponseFromHash,r.correlationId),[2,o.handleCodeResponseFromHash(l,h,t.authority,this.networkClient)]}})})},e}(Rm),cxe=function(n){function e(){return n!==null&&n.apply(this,arguments)||this}return Zo(e,n),e.prototype.acquireToken=function(t){return dt(this,void 0,void 0,function(){var r,i,o,a,l,h=this;return ft(this,function(p){switch(p.label){case 0:return this.performanceClient.addQueueMeasurement(nt.SilentRefreshClientAcquireToken,t.correlationId),this.performanceClient.setPreQueueTime(nt.InitializeBaseRequest,t.correlationId),i=[yn({},t)],[4,this.initializeBaseRequest(t,t.account)];case 1:return r=yn.apply(void 0,i.concat([p.sent()])),o=this.performanceClient.startMeasurement(nt.SilentRefreshClientAcquireToken,r.correlationId),a=this.initializeServerTelemetryManager(_i.acquireTokenSilent_silentFlow),[4,this.createRefreshTokenClient(a,r.authority,r.azureCloudOptions)];case 2:return l=p.sent(),this.logger.verbose("Refresh token client created"),this.performanceClient.setPreQueueTime(nt.RefreshTokenClientAcquireTokenByRefreshToken,t.correlationId),[2,l.acquireTokenByRefreshToken(r).then(function(g){return o.endMeasurement({success:!0,fromCache:g.fromCache,requestId:g.requestId}),g}).catch(function(g){throw g instanceof wn&&g.setCorrelationId(h.correlationId),a.cacheFailedRequest(g),o.endMeasurement({errorCode:g.errorCode,subErrorCode:g.subError,success:!1}),g})]}})})},e.prototype.logout=function(){return Promise.reject(Vt.createSilentLogoutUnsupportedError())},e.prototype.createRefreshTokenClient=function(t,r,i){return dt(this,void 0,void 0,function(){var o;return ft(this,function(a){switch(a.label){case 0:return this.performanceClient.setPreQueueTime(nt.StandardInteractionClientGetClientConfiguration,this.correlationId),[4,this.getClientConfiguration(t,r,i)];case 1:return o=a.sent(),[2,new Yj(o,this.performanceClient)]}})})},e}(Rm),lxe=function(){function n(e,t){this.eventCallbacks=new Map,this.logger=e,this.browserCrypto=t,this.listeningToStorageEvents=!1,this.handleAccountCacheChange=this.handleAccountCacheChange.bind(this)}return n.prototype.addEventCallback=function(e){var t;return typeof window<"u"?(t=this.browserCrypto.createNewGuid(),this.eventCallbacks.set(t,e),this.logger.verbose("Event callback registered with id: "+t),t):null},n.prototype.removeEventCallback=function(e){this.eventCallbacks.delete(e),this.logger.verbose("Event callback "+e+" removed.")},n.prototype.enableAccountStorageEvents=function(){typeof window<"u"&&(this.listeningToStorageEvents?this.logger.verbose("Account storage listener already registered."):(this.logger.verbose("Adding account storage listener."),this.listeningToStorageEvents=!0,window.addEventListener("storage",this.handleAccountCacheChange)))},n.prototype.disableAccountStorageEvents=function(){typeof window<"u"&&(this.listeningToStorageEvents?(this.logger.verbose("Removing account storage listener."),window.removeEventListener("storage",this.handleAccountCacheChange),this.listeningToStorageEvents=!1):this.logger.verbose("No account storage listener registered."))},n.prototype.emitEvent=function(e,t,r,i){var o,a=this;typeof window<"u"&&(o={eventType:e,interactionType:t||null,payload:r||null,error:i||null,timestamp:Date.now()},this.logger.info("Emitting event: "+e),this.eventCallbacks.forEach(function(l,h){a.logger.verbose("Emitting event to callback "+h+": "+e),l.apply(null,[o])}))},n.prototype.handleAccountCacheChange=function(e){try{var t,r,i=e.newValue||e.oldValue;i&&typeof(t=JSON.parse(i))=="object"&&Qo.isAccountEntity(t)&&(r=es.toObject(new Qo,t).getAccountInfo(),!e.oldValue&&e.newValue?(this.logger.info("Account was added to cache in a different window"),this.emitEvent(Fn.ACCOUNT_ADDED,void 0,r)):!e.newValue&&e.oldValue&&(this.logger.info("Account was removed from cache in a different window"),this.emitEvent(Fn.ACCOUNT_REMOVED,void 0,r)))}catch{}},n}(),pa=function(){function n(){}return n.decimalToHex=function(e){for(var t=e.toString(16);t.length<2;)t="0"+t;return t},n}(),h9=function(){function n(e){this.cryptoObj=e}return n.prototype.generateGuid=function(){try{var e=new Uint8Array(16);return this.cryptoObj.getRandomValues(e),e[6]|=64,e[6]&=79,e[8]|=128,e[8]&=191,pa.decimalToHex(e[0])+pa.decimalToHex(e[1])+pa.decimalToHex(e[2])+pa.decimalToHex(e[3])+"-"+pa.decimalToHex(e[4])+pa.decimalToHex(e[5])+"-"+pa.decimalToHex(e[6])+pa.decimalToHex(e[7])+"-"+pa.decimalToHex(e[8])+pa.decimalToHex(e[9])+"-"+pa.decimalToHex(e[10])+pa.decimalToHex(e[11])+pa.decimalToHex(e[12])+pa.decimalToHex(e[13])+pa.decimalToHex(e[14])+pa.decimalToHex(e[15])}catch{for(var t="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx",r="0123456789abcdef",i=0,o=Le.EMPTY_STRING,a=0;a<36;a++)t[a]!=="-"&&t[a]!=="4"&&(i=16*Math.random()|0),o+=t[a]==="x"?r[i]:t[a]==="y"?r[i=i&3|8]:t[a];return o}},n.prototype.isGuid=function(e){return/^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(e)},n}(),xu=function(){function n(){}return n.stringToUtf8Arr=function(e){for(var t,r=0,i=e.length,o=0;o<i;o++)r+=(t=e.charCodeAt(o))<128?1:t<2048?2:t<65536?3:t<2097152?4:t<67108864?5:6;for(var a=new Uint8Array(r),l=0,h=0;l<r;h++)(t=e.charCodeAt(h))<128?a[l++]=t:(t<2048?a[l++]=192+(t>>>6):(t<65536?a[l++]=224+(t>>>12):(t<2097152?a[l++]=240+(t>>>18):(t<67108864?a[l++]=248+(t>>>24):(a[l++]=252+(t>>>30),a[l++]=128+(t>>>24&63)),a[l++]=128+(t>>>18&63)),a[l++]=128+(t>>>12&63)),a[l++]=128+(t>>>6&63)),a[l++]=128+(63&t));return a},n.stringToArrayBuffer=function(e){for(var t=new ArrayBuffer(e.length),r=new Uint8Array(t),i=0;i<e.length;i++)r[i]=e.charCodeAt(i);return t},n.utf8ArrToString=function(e){for(var t,r=Le.EMPTY_STRING,i=e.length,o=0;o<i;o++)t=e[o],r+=String.fromCharCode(251<t&&t<254&&o+5<i?1073741824*(t-252)+(e[++o]-128<<24)+(e[++o]-128<<18)+(e[++o]-128<<12)+(e[++o]-128<<6)+e[++o]-128:247<t&&t<252&&o+4<i?(t-248<<24)+(e[++o]-128<<18)+(e[++o]-128<<12)+(e[++o]-128<<6)+e[++o]-128:239<t&&t<248&&o+3<i?(t-240<<18)+(e[++o]-128<<12)+(e[++o]-128<<6)+e[++o]-128:223<t&&t<240&&o+2<i?(t-224<<12)+(e[++o]-128<<6)+e[++o]-128:191<t&&t<224&&o+1<i?(t-192<<6)+e[++o]-128:t);return r},n.getSortedObjectString=function(e){return JSON.stringify(e,Object.keys(e).sort())},n}(),d9=function(){function n(){}return n.prototype.urlEncode=function(e){return encodeURIComponent(this.encode(e).replace(/=/g,Le.EMPTY_STRING).replace(/\+/g,"-").replace(/\//g,"_"))},n.prototype.urlEncodeArr=function(e){return this.base64EncArr(e).replace(/=/g,Le.EMPTY_STRING).replace(/\+/g,"-").replace(/\//g,"_")},n.prototype.encode=function(e){return e=xu.stringToUtf8Arr(e),this.base64EncArr(e)},n.prototype.base64EncArr=function(e){for(var t,r=(3-e.length%3)%3,i=Le.EMPTY_STRING,o=e.length,a=0,l=0;l<o;l++)a|=e[l]<<(16>>>(t=l%3)&24),t!=2&&e.length-l!=1||(i+=String.fromCharCode(this.uint6ToB64(a>>>18&63),this.uint6ToB64(a>>>12&63),this.uint6ToB64(a>>>6&63),this.uint6ToB64(63&a)),a=0);return r==0?i:i.substring(0,i.length-r)+(r==1?"=":"==")},n.prototype.uint6ToB64=function(e){return e<26?e+65:e<52?e+71:e<62?e-4:e===62?43:e===63?47:65},n}(),uxe=function(){function n(){}return n.prototype.decode=function(e){var t=e.replace(/-/g,"+").replace(/_/g,"/");switch(t.length%4){case 0:break;case 2:t+="==";break;case 3:t+="=";break;default:throw new Error("Invalid base64 string")}return e=this.base64DecToArr(t),xu.utf8ArrToString(e)},n.prototype.base64DecToArr=function(e,t){for(var r,i=e.replace(/[^A-Za-z0-9\+\/]/g,Le.EMPTY_STRING),o=i.length,a=t?Math.ceil((3*o+1>>>2)/t)*t:3*o+1>>>2,l=new Uint8Array(a),h=void 0,p=0,g=0,_=0;_<o;_++)if(r=3&_,p|=this.b64ToUint6(i.charCodeAt(_))<<18-6*r,r==3||o-_==1){for(h=0;h<3&&g<a;h++,g++)l[g]=p>>>(16>>>h&24)&255;p=0}return l},n.prototype.b64ToUint6=function(e){return 64<e&&e<91?e-65:96<e&&e<123?e-71:47<e&&e<58?e+4:e===43?62:e===47?63:0},n}(),hxe=32,dxe=function(){function n(e){this.base64Encode=new d9,this.cryptoObj=e}return n.prototype.generateCodes=function(){return dt(this,void 0,void 0,function(){var e,t;return ft(this,function(r){switch(r.label){case 0:return e=this.generateCodeVerifier(),[4,this.generateCodeChallengeFromVerifier(e)];case 1:return t=r.sent(),[2,{verifier:e,challenge:t}]}})})},n.prototype.generateCodeVerifier=function(){try{var e=new Uint8Array(hxe);return this.cryptoObj.getRandomValues(e),this.base64Encode.urlEncodeArr(e)}catch(t){throw Vt.createPkceNotGeneratedError(t)}},n.prototype.generateCodeChallengeFromVerifier=function(e){return dt(this,void 0,void 0,function(){var t;return ft(this,function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,this.cryptoObj.sha256Digest(e)];case 1:return t=r.sent(),[2,this.base64Encode.urlEncodeArr(new Uint8Array(t))];case 2:throw t=r.sent(),Vt.createPkceNotGeneratedError(t);case 3:return[2]}})})},n}(),fxe=function(){function n(){}return n.prototype.getRandomValues=function(e){return window.crypto.getRandomValues(e)},n.prototype.generateKey=function(e,t,r){return dt(this,void 0,void 0,function(){return ft(this,function(i){return[2,window.crypto.subtle.generateKey(e,t,r)]})})},n.prototype.exportKey=function(e){return dt(this,void 0,void 0,function(){return ft(this,function(t){return[2,window.crypto.subtle.exportKey(Mm,e)]})})},n.prototype.importKey=function(e,t,r,i){return dt(this,void 0,void 0,function(){return ft(this,function(o){return[2,window.crypto.subtle.importKey(Mm,e,t,r,i)]})})},n.prototype.sign=function(e,t,r){return dt(this,void 0,void 0,function(){return ft(this,function(i){return[2,window.crypto.subtle.sign(e,t,r)]})})},n.prototype.digest=function(e,t){return dt(this,void 0,void 0,function(){return ft(this,function(r){return[2,window.crypto.subtle.digest(e,t)]})})},n}(),pxe=function(){function n(){}return n.prototype.initPrng=function(e){return window.msrCrypto.initPrng($M(e))},n.prototype.getRandomValues=function(e){return window.msrCrypto.getRandomValues(e)},n.prototype.generateKey=function(e,t,r){return dt(this,void 0,void 0,function(){return ft(this,function(i){return[2,window.msrCrypto.subtle.generateKey(e,t,r)]})})},n.prototype.exportKey=function(e){return dt(this,void 0,void 0,function(){return ft(this,function(t){return[2,window.msrCrypto.subtle.exportKey(Mm,e)]})})},n.prototype.importKey=function(e,t,r,i){return dt(this,void 0,void 0,function(){return ft(this,function(o){return[2,window.msrCrypto.subtle.importKey(Mm,e,t,r,i)]})})},n.prototype.sign=function(e,t,r){return dt(this,void 0,void 0,function(){return ft(this,function(i){return[2,window.msrCrypto.subtle.sign(e,t,r)]})})},n.prototype.digest=function(e,t){return dt(this,void 0,void 0,function(){return ft(this,function(r){return[2,window.msrCrypto.subtle.digest(e,t)]})})},n}(),gxe=function(){function n(){}return n.prototype.getRandomValues=function(e){return window.msCrypto.getRandomValues(e)},n.prototype.generateKey=function(e,t,r){return dt(this,void 0,void 0,function(){return ft(this,function(i){return[2,new Promise(function(o,a){var l=window.msCrypto.subtle.generateKey(e,t,r);l.addEventListener("complete",function(h){o(h.target.result)}),l.addEventListener("error",function(h){a(h)})})]})})},n.prototype.exportKey=function(e){return dt(this,void 0,void 0,function(){return ft(this,function(t){return[2,new Promise(function(r,i){var o=window.msCrypto.subtle.exportKey(Mm,e);o.addEventListener("complete",function(a){var l=a.target.result,l=xu.utf8ArrToString(new Uint8Array(l)).replace(/\r/g,Le.EMPTY_STRING).replace(/\n/g,Le.EMPTY_STRING).replace(/\t/g,Le.EMPTY_STRING).split(" ").join(Le.EMPTY_STRING).replace("\0",Le.EMPTY_STRING);try{r(JSON.parse(l))}catch(h){i(h)}}),o.addEventListener("error",function(a){i(a)})})]})})},n.prototype.importKey=function(e,t,r,i){return dt(this,void 0,void 0,function(){var o,a;return ft(this,function(l){return o=xu.getSortedObjectString(e),a=xu.stringToArrayBuffer(o),[2,new Promise(function(h,p){var g=window.msCrypto.subtle.importKey(Mm,a,t,r,i);g.addEventListener("complete",function(_){h(_.target.result)}),g.addEventListener("error",function(_){p(_)})})]})})},n.prototype.sign=function(e,t,r){return dt(this,void 0,void 0,function(){return ft(this,function(i){return[2,new Promise(function(o,a){var l=window.msCrypto.subtle.sign(e,t,r);l.addEventListener("complete",function(h){o(h.target.result)}),l.addEventListener("error",function(h){a(h)})})]})})},n.prototype.digest=function(e,t){return dt(this,void 0,void 0,function(){return ft(this,function(r){return[2,new Promise(function(i,o){var a=window.msCrypto.subtle.digest(e,t.buffer);a.addEventListener("complete",function(l){i(l.target.result)}),a.addEventListener("error",function(l){o(l)})})]})})},n}(),mxe="RSASSA-PKCS1-v1_5",f9="SHA-256",yxe=2048,_xe=new Uint8Array([1,0,1]),p9=function(){function n(e,t){if(this.logger=e,this.cryptoOptions=t,this.hasBrowserCrypto())this.logger.verbose("BrowserCrypto: modern crypto interface available"),this.subtleCrypto=new fxe;else if(this.hasIECrypto())this.logger.verbose("BrowserCrypto: MS crypto interface available"),this.subtleCrypto=new gxe;else{if(!this.hasMsrCrypto()||(e=this.cryptoOptions)==null||!e.useMsrCrypto)throw this.hasMsrCrypto()&&this.logger.info("BrowserCrypto: MSR Crypto interface available but system.cryptoOptions.useMsrCrypto not enabled"),this.logger.error("BrowserCrypto: No crypto interfaces available."),Vt.createCryptoNotAvailableError("Browser crypto, msCrypto, or msrCrypto interfaces not available.");this.logger.verbose("BrowserCrypto: MSR crypto interface available"),this.subtleCrypto=new pxe}if(this.subtleCrypto.initPrng){if(this.logger.verbose("BrowserCrypto: Interface requires entropy"),(t=this.cryptoOptions)==null||!t.entropy)throw this.logger.error("BrowserCrypto: Interface requires entropy but none provided."),OE.createEntropyNotProvided();this.logger.verbose("BrowserCrypto: Entropy provided"),this.subtleCrypto.initPrng(this.cryptoOptions.entropy)}this.keygenAlgorithmOptions={name:mxe,hash:f9,modulusLength:yxe,publicExponent:_xe}}return n.prototype.hasIECrypto=function(){return"msCrypto"in window},n.prototype.hasBrowserCrypto=function(){return"crypto"in window},n.prototype.hasMsrCrypto=function(){return"msrCrypto"in window},n.prototype.sha256Digest=function(e){return dt(this,void 0,void 0,function(){var t;return ft(this,function(r){return t=xu.stringToUtf8Arr(e),[2,this.subtleCrypto.digest({name:f9},t)]})})},n.prototype.getRandomValues=function(e){return this.subtleCrypto.getRandomValues(e)},n.prototype.generateKeyPair=function(e,t){return dt(this,void 0,void 0,function(){return ft(this,function(r){return[2,this.subtleCrypto.generateKey(this.keygenAlgorithmOptions,e,t)]})})},n.prototype.exportJwk=function(e){return dt(this,void 0,void 0,function(){return ft(this,function(t){return[2,this.subtleCrypto.exportKey(e)]})})},n.prototype.importJwk=function(e,t,r){return dt(this,void 0,void 0,function(){return ft(this,function(i){return[2,this.subtleCrypto.importKey(e,this.keygenAlgorithmOptions,t,r)]})})},n.prototype.sign=function(e,t){return dt(this,void 0,void 0,function(){return ft(this,function(r){return[2,this.subtleCrypto.sign(this.keygenAlgorithmOptions,e,t)]})})},n}(),vxe=function(){function n(){this.dbName=nR,this.version=Kwe,this.tableName=Zwe,this.dbOpen=!1}return n.prototype.open=function(){return dt(this,void 0,void 0,function(){var e=this;return ft(this,function(t){return[2,new Promise(function(r,i){var o=window.indexedDB.open(e.dbName,e.version);o.addEventListener("upgradeneeded",function(a){a.target.result.createObjectStore(e.tableName)}),o.addEventListener("success",function(a){e.db=a.target.result,e.dbOpen=!0,r()}),o.addEventListener("error",function(){return i(Vt.createDatabaseUnavailableError())})})]})})},n.prototype.closeConnection=function(){var e=this.db;e&&this.dbOpen&&(e.close(),this.dbOpen=!1)},n.prototype.validateDbIsOpen=function(){return dt(this,void 0,void 0,function(){return ft(this,function(e){switch(e.label){case 0:return this.dbOpen?[3,2]:[4,this.open()];case 1:return[2,e.sent()];case 2:return[2]}})})},n.prototype.getItem=function(e){return dt(this,void 0,void 0,function(){var t=this;return ft(this,function(r){switch(r.label){case 0:return[4,this.validateDbIsOpen()];case 1:return r.sent(),[2,new Promise(function(i,o){if(!t.db)return o(Vt.createDatabaseNotOpenError());var a=t.db.transaction([t.tableName],"readonly").objectStore(t.tableName).get(e);a.addEventListener("success",function(l){t.closeConnection(),i(l.target.result)}),a.addEventListener("error",function(l){t.closeConnection(),o(l)})})]}})})},n.prototype.setItem=function(e,t){return dt(this,void 0,void 0,function(){var r=this;return ft(this,function(i){switch(i.label){case 0:return[4,this.validateDbIsOpen()];case 1:return i.sent(),[2,new Promise(function(o,a){if(!r.db)return a(Vt.createDatabaseNotOpenError());var l=r.db.transaction([r.tableName],"readwrite").objectStore(r.tableName).put(t,e);l.addEventListener("success",function(){r.closeConnection(),o()}),l.addEventListener("error",function(h){r.closeConnection(),a(h)})})]}})})},n.prototype.removeItem=function(e){return dt(this,void 0,void 0,function(){var t=this;return ft(this,function(r){switch(r.label){case 0:return[4,this.validateDbIsOpen()];case 1:return r.sent(),[2,new Promise(function(i,o){if(!t.db)return o(Vt.createDatabaseNotOpenError());var a=t.db.transaction([t.tableName],"readwrite").objectStore(t.tableName).delete(e);a.addEventListener("success",function(){t.closeConnection(),i()}),a.addEventListener("error",function(l){t.closeConnection(),o(l)})})]}})})},n.prototype.getKeys=function(){return dt(this,void 0,void 0,function(){var e=this;return ft(this,function(t){switch(t.label){case 0:return[4,this.validateDbIsOpen()];case 1:return t.sent(),[2,new Promise(function(r,i){if(!e.db)return i(Vt.createDatabaseNotOpenError());var o=e.db.transaction([e.tableName],"readonly").objectStore(e.tableName).getAllKeys();o.addEventListener("success",function(a){e.closeConnection(),r(a.target.result)}),o.addEventListener("error",function(a){e.closeConnection(),i(a)})})]}})})},n.prototype.containsKey=function(e){return dt(this,void 0,void 0,function(){var t=this;return ft(this,function(r){switch(r.label){case 0:return[4,this.validateDbIsOpen()];case 1:return r.sent(),[2,new Promise(function(i,o){if(!t.db)return o(Vt.createDatabaseNotOpenError());var a=t.db.transaction([t.tableName],"readonly").objectStore(t.tableName).count(e);a.addEventListener("success",function(l){t.closeConnection(),i(l.target.result===1)}),a.addEventListener("error",function(l){t.closeConnection(),o(l)})})]}})})},n.prototype.deleteDatabase=function(){return dt(this,void 0,void 0,function(){return ft(this,function(e){return this.db&&this.dbOpen&&this.closeConnection(),[2,new Promise(function(t,r){var i=window.indexedDB.deleteDatabase(nR);i.addEventListener("success",function(){return t(!0)}),i.addEventListener("blocked",function(){return t(!0)}),i.addEventListener("error",function(){return r(!1)})})]})})},n}(),g9=function(){function n(e,t){this.inMemoryCache=new rR,this.indexedDBCache=new vxe,this.logger=e,this.storeName=t}return n.prototype.handleDatabaseAccessError=function(e){if(!(e instanceof Vt&&e.errorCode===It.databaseUnavailable.code))throw e;this.logger.error("Could not access persistent storage. This may be caused by browser privacy features which block persistent storage in third-party contexts.")},n.prototype.getItem=function(e){return dt(this,void 0,void 0,function(){var t,r;return ft(this,function(i){switch(i.label){case 0:if(t=this.inMemoryCache.getItem(e))return[3,4];i.label=1;case 1:return i.trys.push([1,3,,4]),this.logger.verbose("Queried item not found in in-memory cache, now querying persistent storage."),[4,this.indexedDBCache.getItem(e)];case 2:return[2,i.sent()];case 3:return r=i.sent(),this.handleDatabaseAccessError(r),[3,4];case 4:return[2,t]}})})},n.prototype.setItem=function(e,t){return dt(this,void 0,void 0,function(){var r;return ft(this,function(i){switch(i.label){case 0:this.inMemoryCache.setItem(e,t),i.label=1;case 1:return i.trys.push([1,3,,4]),[4,this.indexedDBCache.setItem(e,t)];case 2:return i.sent(),[3,4];case 3:return r=i.sent(),this.handleDatabaseAccessError(r),[3,4];case 4:return[2]}})})},n.prototype.removeItem=function(e){return dt(this,void 0,void 0,function(){var t;return ft(this,function(r){switch(r.label){case 0:this.inMemoryCache.removeItem(e),r.label=1;case 1:return r.trys.push([1,3,,4]),[4,this.indexedDBCache.removeItem(e)];case 2:return r.sent(),[3,4];case 3:return t=r.sent(),this.handleDatabaseAccessError(t),[3,4];case 4:return[2]}})})},n.prototype.getKeys=function(){return dt(this,void 0,void 0,function(){var e,t;return ft(this,function(r){switch(r.label){case 0:if((e=this.inMemoryCache.getKeys()).length!==0)return[3,4];r.label=1;case 1:return r.trys.push([1,3,,4]),this.logger.verbose("In-memory cache is empty, now querying persistent storage."),[4,this.indexedDBCache.getKeys()];case 2:return[2,r.sent()];case 3:return t=r.sent(),this.handleDatabaseAccessError(t),[3,4];case 4:return[2,e]}})})},n.prototype.containsKey=function(e){return dt(this,void 0,void 0,function(){var t,r;return ft(this,function(i){switch(i.label){case 0:if(t=this.inMemoryCache.containsKey(e))return[3,4];i.label=1;case 1:return i.trys.push([1,3,,4]),this.logger.verbose("Key not found in in-memory cache, now querying persistent storage."),[4,this.indexedDBCache.containsKey(e)];case 2:return[2,i.sent()];case 3:return r=i.sent(),this.handleDatabaseAccessError(r),[3,4];case 4:return[2,t]}})})},n.prototype.clearInMemory=function(){this.logger.verbose("Deleting in-memory keystore "+this.storeName),this.inMemoryCache.clear(),this.logger.verbose("In-memory keystore "+this.storeName+" deleted")},n.prototype.clearPersistent=function(){return dt(this,void 0,void 0,function(){var e;return ft(this,function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),this.logger.verbose("Deleting persistent keystore"),[4,this.indexedDBCache.deleteDatabase()];case 1:return(e=t.sent())&&this.logger.verbose("Persistent keystore deleted"),[2,e];case 2:return e=t.sent(),this.handleDatabaseAccessError(e),[2,!1];case 3:return[2]}})})},n}(),bxe=(function(n){n.asymmetricKeys="asymmetricKeys",n.symmetricKeys="symmetricKeys"}(LE=LE||{}),function(){function n(e){this.logger=e,this.asymmetricKeys=new g9(this.logger,LE.asymmetricKeys),this.symmetricKeys=new g9(this.logger,LE.symmetricKeys)}return n.prototype.clear=function(){return dt(this,void 0,void 0,function(){var e;return ft(this,function(t){switch(t.label){case 0:this.asymmetricKeys.clearInMemory(),this.symmetricKeys.clearInMemory(),t.label=1;case 1:return t.trys.push([1,3,,4]),[4,this.asymmetricKeys.clearPersistent()];case 2:return t.sent(),[2,!0];case 3:return(e=t.sent())instanceof Error?this.logger.error("Clearing keystore failed with error: "+e.message):this.logger.error("Clearing keystore failed with unknown error"),[2,!1];case 4:return[2]}})})},n}()),wxe=function(){function n(e,t,r){this.logger=e,this.browserCrypto=new p9(this.logger,r),this.b64Encode=new d9,this.b64Decode=new uxe,this.guidGenerator=new h9(this.browserCrypto),this.pkceGenerator=new dxe(this.browserCrypto),this.cache=new bxe(this.logger),this.performanceClient=t}return n.prototype.createNewGuid=function(){return this.guidGenerator.generateGuid()},n.prototype.base64Encode=function(e){return this.b64Encode.encode(e)},n.prototype.base64Decode=function(e){return this.b64Decode.decode(e)},n.prototype.generatePkceCodes=function(){return dt(this,void 0,void 0,function(){return ft(this,function(e){return[2,this.pkceGenerator.generateCodes()]})})},n.prototype.getPublicKeyThumbprint=function(e){var t;return dt(this,void 0,void 0,function(){var r,i,o,a,l;return ft(this,function(h){switch(h.label){case 0:return r=(t=this.performanceClient)==null?void 0:t.startMeasurement(nt.CryptoOptsGetPublicKeyThumbprint,e.correlationId),[4,this.browserCrypto.generateKeyPair(n.EXTRACTABLE,n.POP_KEY_USAGES)];case 1:return i=h.sent(),[4,this.browserCrypto.exportJwk(i.publicKey)];case 2:return a=h.sent(),a={e:a.e,kty:a.kty,n:a.n},a=xu.getSortedObjectString(a),[4,this.hashString(a)];case 3:return o=h.sent(),[4,this.browserCrypto.exportJwk(i.privateKey)];case 4:return a=h.sent(),[4,this.browserCrypto.importJwk(a,!1,["sign"])];case 5:return l=h.sent(),[4,this.cache.asymmetricKeys.setItem(o,{privateKey:l,publicKey:i.publicKey,requestMethod:e.resourceRequestMethod,requestUri:e.resourceRequestUri})];case 6:return h.sent(),r&&r.endMeasurement({success:!0}),[2,o]}})})},n.prototype.removeTokenBindingKey=function(e){return dt(this,void 0,void 0,function(){return ft(this,function(t){switch(t.label){case 0:return[4,this.cache.asymmetricKeys.removeItem(e)];case 1:return t.sent(),[4,this.cache.asymmetricKeys.containsKey(e)];case 2:return[2,!t.sent()]}})})},n.prototype.clearKeystore=function(){return dt(this,void 0,void 0,function(){return ft(this,function(e){switch(e.label){case 0:return[4,this.cache.clear()];case 1:return[2,e.sent()]}})})},n.prototype.signJwt=function(e,t,r){var i;return dt(this,void 0,void 0,function(){var o,a,l,h,p,g;return ft(this,function(_){switch(_.label){case 0:return o=(i=this.performanceClient)==null?void 0:i.startMeasurement(nt.CryptoOptsSignJwt,r),[4,this.cache.asymmetricKeys.getItem(t)];case 1:if(a=_.sent())return[4,this.browserCrypto.exportJwk(a.publicKey)];throw Vt.createSigningKeyNotFoundInStorageError(t);case 2:return p=_.sent(),l=xu.getSortedObjectString(p),h=this.b64Encode.urlEncode(JSON.stringify({kid:t})),h=$we.getShrHeaderString({kid:h,alg:p.alg}),p=this.b64Encode.urlEncode(h),e.cnf={jwk:JSON.parse(l)},h=this.b64Encode.urlEncode(JSON.stringify(e)),l=p+"."+h,p=xu.stringToArrayBuffer(l),[4,this.browserCrypto.sign(a.privateKey,p)];case 3:return h=_.sent(),p=this.b64Encode.urlEncodeArr(new Uint8Array(h)),g=l+"."+p,o&&o.endMeasurement({success:!0}),[2,g]}})})},n.prototype.hashString=function(e){return dt(this,void 0,void 0,function(){var t;return ft(this,function(r){switch(r.label){case 0:return[4,this.browserCrypto.sha256Digest(e)];case 1:return t=r.sent(),t=new Uint8Array(t),[2,this.b64Encode.urlEncodeArr(t)]}})})},n.POP_KEY_USAGES=["sign","verify"],n.EXTRACTABLE=!0,n}(),m9=function(){function n(e,t){this.correlationId=t,this.measureName=n.makeMeasureName(e,t),this.startMark=n.makeStartMark(e,t),this.endMark=n.makeEndMark(e,t)}return n.makeMeasureName=function(e,t){return"msal.measure."+e+"."+t},n.makeStartMark=function(e,t){return"msal.start."+e+"."+t},n.makeEndMark=function(e,t){return"msal.end."+e+"."+t},n.supportsBrowserPerformance=function(){return typeof window<"u"&&window.performance!==void 0&&typeof window.performance.mark=="function"&&typeof window.performance.measure=="function"&&typeof window.performance.clearMarks=="function"&&typeof window.performance.clearMeasures=="function"&&typeof window.performance.getEntriesByName=="function"},n.flushMeasurements=function(e,t){if(n.supportsBrowserPerformance())try{t.forEach(function(r){r=n.makeMeasureName(r.name,e),0<window.performance.getEntriesByName(r,"measure").length&&(window.performance.clearMeasures(r),window.performance.clearMarks(n.makeStartMark(r,e)),window.performance.clearMarks(n.makeEndMark(r,e)))})}catch{}},n.prototype.startMeasurement=function(){if(n.supportsBrowserPerformance())try{window.performance.mark(this.startMark)}catch{}},n.prototype.endMeasurement=function(){if(n.supportsBrowserPerformance())try{window.performance.mark(this.endMark),window.performance.measure(this.measureName,this.startMark,this.endMark)}catch{}},n.prototype.flushMeasurement=function(){if(n.supportsBrowserPerformance())try{var e,t=window.performance.getEntriesByName(this.measureName,"measure");if(0<t.length)return e=t[0].duration,window.performance.clearMeasures(this.measureName),window.performance.clearMarks(this.startMark),window.performance.clearMarks(this.endMark),e}catch{}return null},n}(),xxe=function(n){function e(t,r,i,o,a,l,h){return t=n.call(this,t,r,i,o,a,l)||this,t.browserCrypto=new p9(t.logger,h),t.guidGenerator=new h9(t.browserCrypto),t}return Zo(e,n),e.prototype.startPerformanceMeasuremeant=function(t,r){return new m9(t,r)},e.prototype.generateId=function(){return this.guidGenerator.generateGuid()},e.prototype.getPageVisibility=function(){var t;return((t=document.visibilityState)==null?void 0:t.toString())||null},e.prototype.deleteIncompleteSubMeasurements=function(t){var r=this.eventsByCorrelationId.get(t.event.correlationId),i=r&&r.eventId===t.event.eventId,o=[];i&&r!=null&&r.incompleteSubMeasurements&&r.incompleteSubMeasurements.forEach(function(a){o.push(yn({},a))}),0<o.length&&m9.flushMeasurements(t.event.correlationId,o)},e.prototype.supportsBrowserPerformanceNow=function(){return typeof window<"u"&&window.performance!==void 0&&typeof window.performance.now=="function"},e.prototype.startMeasurement=function(t,r){var i=this,o=this.getPageVisibility(),a=n.prototype.startMeasurement.call(this,t,r);return yn(yn({},a),{endMeasurement:function(l){return l=a.endMeasurement(yn({startPageVisibility:o,endPageVisibility:i.getPageVisibility()},l)),i.deleteIncompleteSubMeasurements(a),l},discardMeasurement:function(){a.discardMeasurement(),i.deleteIncompleteSubMeasurements(a),a.measurement.flushMeasurement()}})},e.prototype.setPreQueueTime=function(t,r){var i;this.supportsBrowserPerformanceNow()?r?((i=this.preQueueTimeByCorrelationId.get(r))&&(this.logger.trace("BrowserPerformanceClient: Incomplete pre-queue "+i.name+" found",r),this.addQueueMeasurement(i.name,r,void 0,!0)),this.preQueueTimeByCorrelationId.set(r,{name:t,time:window.performance.now()})):this.logger.trace("BrowserPerformanceClient: correlationId for "+t+" not provided, unable to set telemetry queue time"):this.logger.trace("BrowserPerformanceClient: window performance API not available, unable to set telemetry queue time for "+t)},e.prototype.addQueueMeasurement=function(t,r,i,o){if(this.supportsBrowserPerformanceNow())if(r){var a,l=n.prototype.getPreQueueTime.call(this,t,r);if(l)return a=window.performance.now(),i=i||n.prototype.calculateQueuedTime.call(this,l,a),n.prototype.addQueueMeasurement.call(this,t,r,i,o)}else this.logger.trace("BrowserPerformanceClient: correlationId for "+t+" not provided, unable to add queue measurement");else this.logger.trace("BrowserPerformanceClient: window performance API not available, unable to add queue measurement for "+t)},e}(n9),Exe=function(){function n(e,t,r,i){this.isBrowserEnvironment=typeof window<"u",this.config=e,this.storage=t,this.logger=r,this.cryptoObj=i}return n.prototype.loadExternalTokens=function(e,t,r){if(this.logger.info("TokenCache - loadExternalTokens called"),!t.id_token)throw Vt.createUnableToLoadTokenError("Please ensure server response includes id token.");var i=new ml(t.id_token,this.cryptoObj);if(e.account)var o=this.loadAccount(i,e.account.environment,void 0,void 0,e.account.homeAccountId),a=new IE(o,this.loadIdToken(i,o.homeAccountId,e.account.environment,e.account.tenantId),this.loadAccessToken(e,t,o.homeAccountId,e.account.environment,e.account.tenantId,r),this.loadRefreshToken(e,t,o.homeAccountId,e.account.environment));else{if(!e.authority)throw Vt.createUnableToLoadTokenError("Please provide a request with an account or a request with authority.");var h=v0.generateAuthority(e.authority,e.azureCloudOptions),l={protocolMode:this.config.auth.protocolMode,knownAuthorities:this.config.auth.knownAuthorities,cloudDiscoveryMetadata:this.config.auth.cloudDiscoveryMetadata,authorityMetadata:this.config.auth.authorityMetadata,skipAuthorityMetadataCache:this.config.auth.skipAuthorityMetadataCache},h=new v0(h,this.config.system.networkClient,this.storage,l,this.logger);if(r.clientInfo)this.logger.trace("TokenCache - homeAccountId from options"),o=this.loadAccount(i,h.hostnameAndPort,r.clientInfo,h.authorityType);else{if(!t.client_info)throw Vt.createUnableToLoadTokenError("Please provide clientInfo in the response or options.");this.logger.trace("TokenCache - homeAccountId from response"),o=this.loadAccount(i,h.hostnameAndPort,t.client_info,h.authorityType)}a=new IE(o,this.loadIdToken(i,o.homeAccountId,h.hostnameAndPort,h.tenant),this.loadAccessToken(e,t,o.homeAccountId,h.hostnameAndPort,h.tenant,r),this.loadRefreshToken(e,t,o.homeAccountId,h.hostnameAndPort))}return this.generateAuthenticationResult(e,i,a,h)},n.prototype.loadAccount=function(e,t,r,i,o){var a;if(o?a=o:i!==void 0&&r&&(a=Qo.generateHomeAccountId(r,i,this.logger,this.cryptoObj,e)),!a)throw Vt.createUnableToLoadTokenError("Unexpected missing homeAccountId");if(o=r?Qo.createAccount(r,a,e,void 0,void 0,void 0,t):Qo.createGenericAccount(a,e,void 0,void 0,void 0,t),this.isBrowserEnvironment)return this.logger.verbose("TokenCache - loading account"),this.storage.setAccount(o),o;throw Vt.createUnableToLoadTokenError("loadExternalTokens is designed to work in browser environments only.")},n.prototype.loadIdToken=function(e,t,r,i){if(t=Kf.createIdTokenEntity(t,r,e.rawToken,this.config.auth.clientId,i),this.isBrowserEnvironment)return this.logger.verbose("TokenCache - loading id token"),this.storage.setIdTokenCredential(t),t;throw Vt.createUnableToLoadTokenError("loadExternalTokens is designed to work in browser environments only.")},n.prototype.loadAccessToken=function(l,t,g,i,o,p){if(!t.access_token)return this.logger.verbose("TokenCache - No access token provided for caching"),null;if(!t.expires_in)throw Vt.createUnableToLoadTokenError("Please ensure server response includes expires_in value.");if(!p.extendedExpiresOn)throw Vt.createUnableToLoadTokenError("Please provide an extendedExpiresOn value in the options.");var l=new fa(l.scopes).printScopes(),h=p.expiresOn||t.expires_in+new Date().getTime()/1e3,p=p.extendedExpiresOn,g=Zf.createAccessTokenEntity(g,i,t.access_token,this.config.auth.clientId,o,l,h,p,this.cryptoObj);if(this.isBrowserEnvironment)return this.logger.verbose("TokenCache - loading access token"),this.storage.setAccessTokenCredential(g),g;throw Vt.createUnableToLoadTokenError("loadExternalTokens is designed to work in browser environments only.")},n.prototype.loadRefreshToken=function(e,t,r,i){if(!t.refresh_token)return this.logger.verbose("TokenCache - No refresh token provided for caching"),null;if(r=Cm.createRefreshTokenEntity(r,i,t.refresh_token,this.config.auth.clientId),this.isBrowserEnvironment)return this.logger.verbose("TokenCache - loading refresh token"),this.storage.setRefreshTokenCredential(r),r;throw Vt.createUnableToLoadTokenError("loadExternalTokens is designed to work in browser environments only.")},n.prototype.generateAuthenticationResult=function(e,t,r,i){var o,a=Le.EMPTY_STRING,l=[],h=null,p=(r!=null&&r.accessToken&&(a=r.accessToken.secret,l=fa.fromString(r.accessToken.target).asArray(),h=new Date(1e3*Number(r.accessToken.expiresOn)),o=new Date(1e3*Number(r.accessToken.extendedExpiresOn))),(t==null?void 0:t.claims.oid)||(t==null?void 0:t.claims.sub)||Le.EMPTY_STRING),g=(t==null?void 0:t.claims.tid)||Le.EMPTY_STRING;return{authority:i?i.canonicalAuthority:Le.EMPTY_STRING,uniqueId:p,tenantId:g,scopes:l,account:r!=null&&r.account?r.account.getAccountInfo():null,idToken:t?t.rawToken:Le.EMPTY_STRING,idTokenClaims:t?t.claims:{},accessToken:a,fromCache:!0,expiresOn:h,correlationId:e.correlationId||Le.EMPTY_STRING,requestId:Le.EMPTY_STRING,extExpiresOn:o,familyId:Le.EMPTY_STRING,tokenType:((i=r==null?void 0:r.accessToken)==null?void 0:i.tokenType)||Le.EMPTY_STRING,state:Le.EMPTY_STRING,cloudGraphHostName:((p=r==null?void 0:r.account)==null?void 0:p.cloudGraphHostName)||Le.EMPTY_STRING,msGraphHost:((g=r==null?void 0:r.account)==null?void 0:g.msGraphHost)||Le.EMPTY_STRING,code:void 0,fromNativeBroker:!1}},n}(),Txe=function(n){function e(t){return t=n.call(this,t)||this,t.includeRedirectUri=!1,t}return Zo(e,n),e}(Wj),Sxe=function(n){function e(t,r,i,o,a,l,h,p,g,_){return t=n.call(this,t,r,i,o,a,l,p,g,_)||this,t.apiId=h,t}return Zo(e,n),e.prototype.acquireToken=function(t){return dt(this,void 0,void 0,function(){var r,i,o,a;return ft(this,function(l){switch(l.label){case 0:if(this.logger.trace("SilentAuthCodeClient.acquireToken called"),t.code)return this.performanceClient.setPreQueueTime(nt.StandardInteractionClientInitializeAuthorizationRequest,t.correlationId),[4,this.initializeAuthorizationRequest(t,hn.Silent)];throw Vt.createAuthCodeRequiredError();case 1:r=l.sent(),this.browserStorage.updateCacheEntries(r.state,r.nonce,r.authority,r.loginHint||Le.EMPTY_STRING,r.account||null),i=this.initializeServerTelemetryManager(this.apiId),l.label=2;case 2:return l.trys.push([2,4,,5]),o=yn(yn({},r),{code:t.code}),this.performanceClient.setPreQueueTime(nt.StandardInteractionClientGetClientConfiguration,t.correlationId),[4,this.getClientConfiguration(i,r.authority)];case 3:return a=l.sent(),a=new Txe(a),this.logger.verbose("Auth code client created"),[2,new u9(a,this.browserStorage,o,this.logger,this.config.system,this.performanceClient).handleCodeResponseFromServer({code:t.code,msgraph_host:t.msGraphHost,cloud_graph_host_name:t.cloudGraphHostName,cloud_instance_host_name:t.cloudInstanceHostName},r.state,a.authority,this.networkClient,!1)];case 4:throw(a=l.sent())instanceof wn&&a.setCorrelationId(this.correlationId),i.cacheFailedRequest(a),this.browserStorage.cleanRequestByState(r.state),a;case 5:return[2]}})})},e.prototype.logout=function(){return Promise.reject(Vt.createSilentLogoutUnsupportedError())},e}(Rm),Cxe=function(){function n(e){this.isBrowserEnvironment=typeof window<"u",this.config=axe(e,this.isBrowserEnvironment),this.initialized=!1,this.logger=new KM(this.config.system.loggerOptions,oR,w0),this.networkClient=this.config.system.networkClient,this.navigationClient=this.config.system.navigationClient,this.redirectResponse=new Map,this.hybridAuthCodeResponses=new Map,this.performanceClient=this.isBrowserEnvironment?new xxe(this.config.auth.clientId,this.config.auth.authority,this.logger,oR,w0,this.config.telemetry.application,this.config.system.cryptoOptions):new Ywe(this.config.auth.clientId,this.config.auth.authority,this.logger,oR,w0,this.config.telemetry.application),this.browserCrypto=this.isBrowserEnvironment?new wxe(this.logger,this.performanceClient,this.config.system.cryptoOptions):TE,this.eventHandler=new lxe(this.logger,this.browserCrypto),this.browserStorage=this.isBrowserEnvironment?new iR(this.config.auth.clientId,this.config.cache,this.browserCrypto,this.logger):Xwe(this.config.auth.clientId,this.logger),e={cacheLocation:go.MemoryStorage,temporaryCacheLocation:go.MemoryStorage,storeAuthStateInCookie:!1,secureCookies:!1,cacheMigrationEnabled:!1,claimsBasedCachingEnabled:!0},this.nativeInternalStorage=new iR(this.config.auth.clientId,e,this.browserCrypto,this.logger),this.tokenCache=new Exe(this.config,this.browserStorage,this.logger,this.browserCrypto),this.trackPageVisibilityWithMeasurement=this.trackPageVisibilityWithMeasurement.bind(this)}return n.prototype.initialize=function(){return dt(this,void 0,void 0,function(){var e,t,r,i,o;return ft(this,function(a){switch(a.label){case 0:if(this.logger.trace("initialize called"),this.initialized)return this.logger.info("initialize has already been called, exiting early."),[2];if(e=this.config.system.allowNativeBroker,t=this.performanceClient.startMeasurement(nt.InitializeClientApplication),this.eventHandler.emitEvent(Fn.INITIALIZE_START),!e)return[3,4];a.label=1;case 1:return a.trys.push([1,3,,4]),r=this,[4,Xf.createProvider(this.logger,this.config.system.nativeBrokerHandshakeTimeout,this.performanceClient)];case 2:return r.nativeExtensionProvider=a.sent(),[3,4];case 3:return i=a.sent(),this.logger.verbose(i),[3,4];case 4:return this.config.cache.claimsBasedCachingEnabled?[3,6]:(this.logger.verbose("Claims-based caching is disabled. Clearing the previous cache with claims"),o=this.performanceClient.startMeasurement(nt.ClearTokensAndKeysWithClaims),[4,this.browserStorage.clearTokensAndKeysWithClaims()]);case 5:a.sent(),o.endMeasurement({success:!0}),a.label=6;case 6:return this.initialized=!0,this.eventHandler.emitEvent(Fn.INITIALIZE_END),t.endMeasurement({allowNativeBroker:e,success:!0}),[2]}})})},n.prototype.handleRedirectPromise=function(e){return dt(this,void 0,void 0,function(){var t,r,i,o,a,l=this;return ft(this,function(h){return this.logger.verbose("handleRedirectPromise called"),qi.blockNativeBrokerCalledBeforeInitialized(this.config.system.allowNativeBroker,this.initialized),t=this.getAllAccounts(),this.isBrowserEnvironment?(r=e||Le.EMPTY_STRING,(i=this.redirectResponse.get(r))===void 0?(this.eventHandler.emitEvent(Fn.HANDLE_REDIRECT_START,hn.Redirect),this.logger.verbose("handleRedirectPromise has been called for the first time, storing the promise"),a=this.browserStorage.getCachedNativeRequest(),o=void 0,o=a&&Xf.isNativeAvailable(this.config,this.logger,this.nativeExtensionProvider)&&this.nativeExtensionProvider&&!e?(this.logger.trace("handleRedirectPromise - acquiring token from native platform"),new km(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,_i.handleRedirectPromise,this.performanceClient,this.nativeExtensionProvider,a.accountId,this.nativeInternalStorage,a.correlationId).handleRedirectPromise()):(this.logger.trace("handleRedirectPromise - acquiring token from web flow"),a=this.browserStorage.getTemporaryCache(Mr.CORRELATION_ID,!0)||Le.EMPTY_STRING,this.createRedirectClient(a).handleRedirectPromise(e)),i=o.then(function(p){return p&&(t.length<l.getAllAccounts().length?(l.eventHandler.emitEvent(Fn.LOGIN_SUCCESS,hn.Redirect,p),l.logger.verbose("handleRedirectResponse returned result, login success")):(l.eventHandler.emitEvent(Fn.ACQUIRE_TOKEN_SUCCESS,hn.Redirect,p),l.logger.verbose("handleRedirectResponse returned result, acquire token success"))),l.eventHandler.emitEvent(Fn.HANDLE_REDIRECT_END,hn.Redirect),p}).catch(function(p){throw 0<t.length?l.eventHandler.emitEvent(Fn.ACQUIRE_TOKEN_FAILURE,hn.Redirect,null,p):l.eventHandler.emitEvent(Fn.LOGIN_FAILURE,hn.Redirect,null,p),l.eventHandler.emitEvent(Fn.HANDLE_REDIRECT_END,hn.Redirect),p}),this.redirectResponse.set(r,i)):this.logger.verbose("handleRedirectPromise has been called previously, returning the result from the first call"),[2,i]):(this.logger.verbose("handleRedirectPromise returns null, not browser environment"),[2,null])})})},n.prototype.acquireTokenRedirect=function(e){return dt(this,void 0,void 0,function(){var t,r,i=this;return ft(this,function(o){return t=this.getRequestCorrelationId(e),this.logger.verbose("acquireTokenRedirect called",t),this.preflightBrowserEnvironmentCheck(hn.Redirect),(r=0<this.getAllAccounts().length)?this.eventHandler.emitEvent(Fn.ACQUIRE_TOKEN_START,hn.Redirect,e):this.eventHandler.emitEvent(Fn.LOGIN_START,hn.Redirect,e),[2,(this.nativeExtensionProvider&&this.canUseNative(e)?new km(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,_i.acquireTokenRedirect,this.performanceClient,this.nativeExtensionProvider,this.getNativeAccountId(e),this.nativeInternalStorage,e.correlationId).acquireTokenRedirect(e).catch(function(a){if(a instanceof vl&&a.isFatal())return i.nativeExtensionProvider=void 0,i.createRedirectClient(e.correlationId).acquireToken(e);if(a instanceof tc)return i.logger.verbose("acquireTokenRedirect - Resolving interaction required error thrown by native broker by falling back to web flow"),i.createRedirectClient(e.correlationId).acquireToken(e);throw i.browserStorage.setInteractionInProgress(!1),a}):this.createRedirectClient(e.correlationId).acquireToken(e)).catch(function(a){throw r?i.eventHandler.emitEvent(Fn.ACQUIRE_TOKEN_FAILURE,hn.Redirect,null,a):i.eventHandler.emitEvent(Fn.LOGIN_FAILURE,hn.Redirect,null,a),a})]})})},n.prototype.acquireTokenPopup=function(e){var t=this,r=this.getRequestCorrelationId(e),i=this.performanceClient.startMeasurement(nt.AcquireTokenPopup,r);try{this.logger.verbose("acquireTokenPopup called",r),this.preflightBrowserEnvironmentCheck(hn.Popup)}catch(a){return Promise.reject(a)}var o=this.getAllAccounts();return 0<o.length?this.eventHandler.emitEvent(Fn.ACQUIRE_TOKEN_START,hn.Popup,e):this.eventHandler.emitEvent(Fn.LOGIN_START,hn.Popup,e),(this.canUseNative(e)?this.acquireTokenNative(e,_i.acquireTokenPopup).then(function(a){return t.browserStorage.setInteractionInProgress(!1),i.endMeasurement({success:!0,isNativeBroker:!0,requestId:a.requestId}),a}).catch(function(a){if(a instanceof vl&&a.isFatal())return t.nativeExtensionProvider=void 0,t.createPopupClient(e.correlationId).acquireToken(e);if(a instanceof tc)return t.logger.verbose("acquireTokenPopup - Resolving interaction required error thrown by native broker by falling back to web flow"),t.createPopupClient(e.correlationId).acquireToken(e);throw t.browserStorage.setInteractionInProgress(!1),a}):this.createPopupClient(e.correlationId).acquireToken(e)).then(function(a){return o.length<t.getAllAccounts().length?t.eventHandler.emitEvent(Fn.LOGIN_SUCCESS,hn.Popup,a):t.eventHandler.emitEvent(Fn.ACQUIRE_TOKEN_SUCCESS,hn.Popup,a),i.addStaticFields({accessTokenSize:a.accessToken.length,idTokenSize:a.idToken.length}),i.endMeasurement({success:!0,requestId:a.requestId}),a}).catch(function(a){return 0<o.length?t.eventHandler.emitEvent(Fn.ACQUIRE_TOKEN_FAILURE,hn.Popup,null,a):t.eventHandler.emitEvent(Fn.LOGIN_FAILURE,hn.Popup,null,a),i.endMeasurement({errorCode:a.errorCode,subErrorCode:a.subError,success:!1}),Promise.reject(a)})},n.prototype.trackPageVisibilityWithMeasurement=function(){var e=this.ssoSilentMeasurement||this.acquireTokenByCodeAsyncMeasurement;e&&(this.logger.info("Perf: Visibility change detected in ",e.event.name),e.increment({visibilityChangeCount:1}))},n.prototype.ssoSilent=function(e){var t;return dt(this,void 0,void 0,function(){var r,i,o=this;return ft(this,function(a){return r=this.getRequestCorrelationId(e),i=yn(yn({},e),{prompt:e.prompt,correlationId:r}),this.preflightBrowserEnvironmentCheck(hn.Silent),this.ssoSilentMeasurement=this.performanceClient.startMeasurement(nt.SsoSilent,r),(t=this.ssoSilentMeasurement)!=null&&t.increment({visibilityChangeCount:0}),document.addEventListener("visibilitychange",this.trackPageVisibilityWithMeasurement),this.logger.verbose("ssoSilent called",r),this.eventHandler.emitEvent(Fn.SSO_SILENT_START,hn.Silent,i),[2,(this.canUseNative(i)?this.acquireTokenNative(i,_i.ssoSilent).catch(function(l){if(l instanceof vl&&l.isFatal())return o.nativeExtensionProvider=void 0,o.createSilentIframeClient(i.correlationId).acquireToken(i);throw l}):this.createSilentIframeClient(i.correlationId).acquireToken(i)).then(function(l){var h;return o.eventHandler.emitEvent(Fn.SSO_SILENT_SUCCESS,hn.Silent,l),(h=o.ssoSilentMeasurement)!=null&&h.addStaticFields({accessTokenSize:l.accessToken.length,idTokenSize:l.idToken.length}),(h=o.ssoSilentMeasurement)!=null&&h.endMeasurement({success:!0,isNativeBroker:l.fromNativeBroker,requestId:l.requestId}),l}).catch(function(l){var h;throw o.eventHandler.emitEvent(Fn.SSO_SILENT_FAILURE,hn.Silent,null,l),(h=o.ssoSilentMeasurement)!=null&&h.endMeasurement({errorCode:l.errorCode,subErrorCode:l.subError,success:!1}),l}).finally(function(){document.removeEventListener("visibilitychange",o.trackPageVisibilityWithMeasurement)})]})})},n.prototype.acquireTokenByCode=function(e){return dt(this,void 0,void 0,function(){var t,r,i,o,a=this;return ft(this,function(l){t=this.getRequestCorrelationId(e),this.preflightBrowserEnvironmentCheck(hn.Silent),this.logger.trace("acquireTokenByCode called",t),this.eventHandler.emitEvent(Fn.ACQUIRE_TOKEN_BY_CODE_START,hn.Silent,e),r=this.performanceClient.startMeasurement(nt.AcquireTokenByCode,e.correlationId);try{if(e.code&&e.nativeAccountId)throw Vt.createSpaCodeAndNativeAccountIdPresentError();if(e.code)return i=e.code,(o=this.hybridAuthCodeResponses.get(i))?(this.logger.verbose("Existing acquireTokenByCode request found",e.correlationId),r.discardMeasurement()):(this.logger.verbose("Initiating new acquireTokenByCode request",t),o=this.acquireTokenByCodeAsync(yn(yn({},e),{correlationId:t})).then(function(h){return a.eventHandler.emitEvent(Fn.ACQUIRE_TOKEN_BY_CODE_SUCCESS,hn.Silent,h),a.hybridAuthCodeResponses.delete(i),r.addStaticFields({accessTokenSize:h.accessToken.length,idTokenSize:h.idToken.length}),r.endMeasurement({success:!0,isNativeBroker:h.fromNativeBroker,requestId:h.requestId}),h}).catch(function(h){throw a.hybridAuthCodeResponses.delete(i),a.eventHandler.emitEvent(Fn.ACQUIRE_TOKEN_BY_CODE_FAILURE,hn.Silent,null,h),r.endMeasurement({errorCode:h.errorCode,subErrorCode:h.subError,success:!1}),h}),this.hybridAuthCodeResponses.set(i,o)),[2,o];if(e.nativeAccountId){if(this.canUseNative(e,e.nativeAccountId))return[2,this.acquireTokenNative(e,_i.acquireTokenByCode,e.nativeAccountId).catch(function(h){throw h instanceof vl&&h.isFatal()&&(a.nativeExtensionProvider=void 0),h})];throw Vt.createUnableToAcquireTokenFromNativePlatformError()}throw Vt.createAuthCodeOrNativeAccountIdRequiredError()}catch(h){throw this.eventHandler.emitEvent(Fn.ACQUIRE_TOKEN_BY_CODE_FAILURE,hn.Silent,null,h),r.endMeasurement({errorCode:h instanceof wn&&h.errorCode||void 0,subErrorCode:h instanceof wn&&h.subError||void 0,success:!1}),h}return[2]})})},n.prototype.acquireTokenByCodeAsync=function(e){var t;return dt(this,void 0,void 0,function(){var r=this;return ft(this,function(i){switch(i.label){case 0:return this.logger.trace("acquireTokenByCodeAsync called",e.correlationId),this.acquireTokenByCodeAsyncMeasurement=this.performanceClient.startMeasurement(nt.AcquireTokenByCodeAsync,e.correlationId),(t=this.acquireTokenByCodeAsyncMeasurement)!=null&&t.increment({visibilityChangeCount:0}),document.addEventListener("visibilitychange",this.trackPageVisibilityWithMeasurement),[4,this.createSilentAuthCodeClient(e.correlationId).acquireToken(e).then(function(o){var a;return(a=r.acquireTokenByCodeAsyncMeasurement)!=null&&a.endMeasurement({success:!0,fromCache:o.fromCache,isNativeBroker:o.fromNativeBroker,requestId:o.requestId}),o}).catch(function(o){var a;throw(a=r.acquireTokenByCodeAsyncMeasurement)!=null&&a.endMeasurement({errorCode:o.errorCode,subErrorCode:o.subError,success:!1}),o}).finally(function(){document.removeEventListener("visibilitychange",r.trackPageVisibilityWithMeasurement)})];case 1:return[2,i.sent()]}})})},n.prototype.acquireTokenFromCache=function(e,t,r){return dt(this,void 0,void 0,function(){return ft(this,function(i){switch(this.performanceClient.addQueueMeasurement(nt.AcquireTokenFromCache,t.correlationId),r.cacheLookupPolicy){case ts.Default:case ts.AccessToken:case ts.AccessTokenAndRefreshToken:return[2,e.acquireToken(t)];default:throw en.createRefreshRequiredError()}return[2]})})},n.prototype.acquireTokenByRefreshToken=function(e,t){return dt(this,void 0,void 0,function(){var r;return ft(this,function(i){switch(this.performanceClient.addQueueMeasurement(nt.AcquireTokenByRefreshToken,e.correlationId),t.cacheLookupPolicy){case ts.Default:case ts.AccessTokenAndRefreshToken:case ts.RefreshToken:case ts.RefreshTokenAndNetwork:return r=this.createSilentRefreshClient(e.correlationId),this.performanceClient.setPreQueueTime(nt.SilentRefreshClientAcquireToken,e.correlationId),[2,r.acquireToken(e)];default:throw en.createRefreshRequiredError()}return[2]})})},n.prototype.acquireTokenBySilentIframe=function(e){return dt(this,void 0,void 0,function(){var t;return ft(this,function(r){return this.performanceClient.addQueueMeasurement(nt.AcquireTokenBySilentIframe,e.correlationId),t=this.createSilentIframeClient(e.correlationId),this.performanceClient.setPreQueueTime(nt.SilentIframeClientAcquireToken,e.correlationId),[2,t.acquireToken(e)]})})},n.prototype.logout=function(e){return dt(this,void 0,void 0,function(){var t;return ft(this,function(r){return t=this.getRequestCorrelationId(e),this.logger.warning("logout API is deprecated and will be removed in msal-browser v3.0.0. Use logoutRedirect instead.",t),[2,this.logoutRedirect(yn({correlationId:t},e))]})})},n.prototype.logoutRedirect=function(e){return dt(this,void 0,void 0,function(){var t;return ft(this,function(r){return t=this.getRequestCorrelationId(e),this.preflightBrowserEnvironmentCheck(hn.Redirect),[2,this.createRedirectClient(t).logout(e)]})})},n.prototype.logoutPopup=function(e){try{var t=this.getRequestCorrelationId(e);return this.preflightBrowserEnvironmentCheck(hn.Popup),this.createPopupClient(t).logout(e)}catch(r){return Promise.reject(r)}},n.prototype.getAllAccounts=function(){return this.logger.verbose("getAllAccounts called"),this.isBrowserEnvironment?this.browserStorage.getAllAccounts():[]},n.prototype.getAccountByUsername=function(e){var t;return this.logger.trace("getAccountByUsername called"),e?(t=this.browserStorage.getAccountInfoFilteredBy({username:e}))?(this.logger.verbose("getAccountByUsername: Account matching username found, returning"),this.logger.verbosePii("getAccountByUsername: Returning signed-in accounts matching username: "+e),t):(this.logger.verbose("getAccountByUsername: No matching account found, returning null"),null):(this.logger.warning("getAccountByUsername: No username provided"),null)},n.prototype.getAccountByHomeId=function(e){var t;return this.logger.trace("getAccountByHomeId called"),e?(t=this.browserStorage.getAccountInfoFilteredBy({homeAccountId:e}))?(this.logger.verbose("getAccountByHomeId: Account matching homeAccountId found, returning"),this.logger.verbosePii("getAccountByHomeId: Returning signed-in accounts matching homeAccountId: "+e),t):(this.logger.verbose("getAccountByHomeId: No matching account found, returning null"),null):(this.logger.warning("getAccountByHomeId: No homeAccountId provided"),null)},n.prototype.getAccountByLocalId=function(e){var t;return this.logger.trace("getAccountByLocalId called"),e?(t=this.browserStorage.getAccountInfoFilteredBy({localAccountId:e}))?(this.logger.verbose("getAccountByLocalId: Account matching localAccountId found, returning"),this.logger.verbosePii("getAccountByLocalId: Returning signed-in accounts matching localAccountId: "+e),t):(this.logger.verbose("getAccountByLocalId: No matching account found, returning null"),null):(this.logger.warning("getAccountByLocalId: No localAccountId provided"),null)},n.prototype.setActiveAccount=function(e){this.browserStorage.setActiveAccount(e)},n.prototype.getActiveAccount=function(){return this.browserStorage.getActiveAccount()},n.prototype.preflightBrowserEnvironmentCheck=function(e,t){if(t===void 0&&(t=!0),this.logger.verbose("preflightBrowserEnvironmentCheck started"),qi.blockNonBrowserEnvironment(this.isBrowserEnvironment),qi.blockRedirectInIframe(e,this.config.system.allowRedirectInIframe),qi.blockReloadInHiddenIframes(),qi.blockAcquireTokenInPopups(),qi.blockNativeBrokerCalledBeforeInitialized(this.config.system.allowNativeBroker,this.initialized),e===hn.Redirect&&this.config.cache.cacheLocation===go.MemoryStorage&&!this.config.cache.storeAuthStateInCookie)throw OE.createInMemoryRedirectUnavailableError();e!==hn.Redirect&&e!==hn.Popup||this.preflightInteractiveRequest(t)},n.prototype.preflightInteractiveRequest=function(e){this.logger.verbose("preflightInteractiveRequest called, validating app environment"),qi.blockReloadInHiddenIframes(),e&&this.browserStorage.setInteractionInProgress(!0)},n.prototype.acquireTokenNative=function(e,t,r){return dt(this,void 0,void 0,function(){return ft(this,function(i){if(this.logger.trace("acquireTokenNative called"),this.nativeExtensionProvider)return[2,new km(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,t,this.performanceClient,this.nativeExtensionProvider,r||this.getNativeAccountId(e),this.nativeInternalStorage,e.correlationId).acquireToken(e)];throw Vt.createNativeConnectionNotEstablishedError()})})},n.prototype.canUseNative=function(e,t){if(this.logger.trace("canUseNative called"),!Xf.isNativeAvailable(this.config,this.logger,this.nativeExtensionProvider,e.authenticationScheme))return this.logger.trace("canUseNative: isNativeAvailable returned false, returning false"),!1;if(e.prompt)switch(e.prompt){case da.NONE:case da.CONSENT:case da.LOGIN:this.logger.trace("canUseNative: prompt is compatible with native flow");break;default:return this.logger.trace("canUseNative: prompt = "+e.prompt+" is not compatible with native flow, returning false"),!1}return!(!t&&!this.getNativeAccountId(e)&&(this.logger.trace("canUseNative: nativeAccountId is not available, returning false"),1))},n.prototype.getNativeAccountId=function(e){return e=e.account||this.browserStorage.getAccountInfoByHints(e.loginHint,e.sid)||this.getActiveAccount(),e&&e.nativeAccountId||""},n.prototype.createPopupClient=function(e){return new txe(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,this.performanceClient,this.nativeInternalStorage,this.nativeExtensionProvider,e)},n.prototype.createRedirectClient=function(e){return new exe(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,this.performanceClient,this.nativeInternalStorage,this.nativeExtensionProvider,e)},n.prototype.createSilentIframeClient=function(e){return new sxe(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,_i.ssoSilent,this.performanceClient,this.nativeInternalStorage,this.nativeExtensionProvider,e)},n.prototype.createSilentCacheClient=function(e){return new l9(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,this.performanceClient,this.nativeExtensionProvider,e)},n.prototype.createSilentRefreshClient=function(e){return new cxe(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,this.performanceClient,this.nativeExtensionProvider,e)},n.prototype.createSilentAuthCodeClient=function(e){return new Sxe(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,_i.acquireTokenByCode,this.performanceClient,this.nativeExtensionProvider,e)},n.prototype.addEventCallback=function(e){return this.eventHandler.addEventCallback(e)},n.prototype.removeEventCallback=function(e){this.eventHandler.removeEventCallback(e)},n.prototype.addPerformanceCallback=function(e){return this.performanceClient.addPerformanceCallback(e)},n.prototype.removePerformanceCallback=function(e){return this.performanceClient.removePerformanceCallback(e)},n.prototype.enableAccountStorageEvents=function(){this.eventHandler.enableAccountStorageEvents()},n.prototype.disableAccountStorageEvents=function(){this.eventHandler.disableAccountStorageEvents()},n.prototype.getTokenCache=function(){return this.tokenCache},n.prototype.getLogger=function(){return this.logger},n.prototype.setLogger=function(e){this.logger=e},n.prototype.initializeWrapperLibrary=function(e,t){this.browserStorage.setWrapperMetadata(e,t)},n.prototype.setNavigationClient=function(e){this.navigationClient=e},n.prototype.getConfiguration=function(){return this.config},n.prototype.getRequestCorrelationId=function(e){return e!=null&&e.correlationId?e.correlationId:this.isBrowserEnvironment?this.browserCrypto.createNewGuid():Le.EMPTY_STRING},n}(),Axe=function(n){function e(t){return t=n.call(this,t)||this,t.astsAsyncMeasurement=void 0,t.activeSilentTokenRequests=new Map,t.trackPageVisibility=t.trackPageVisibility.bind(t),t}return Zo(e,n),e.prototype.loginRedirect=function(t){return dt(this,void 0,void 0,function(){var r;return ft(this,function(i){return r=this.getRequestCorrelationId(t),this.logger.verbose("loginRedirect called",r),[2,this.acquireTokenRedirect(yn({correlationId:r},t||i9))]})})},e.prototype.loginPopup=function(t){var r=this.getRequestCorrelationId(t);return this.logger.verbose("loginPopup called",r),this.acquireTokenPopup(yn({correlationId:r},t||i9))},e.prototype.acquireTokenSilent=function(t){return dt(this,void 0,void 0,function(){var r,i,o,a,l,h=this;return ft(this,function(p){if(r=this.getRequestCorrelationId(t),(i=this.performanceClient.startMeasurement(nt.AcquireTokenSilent,r)).addStaticFields({cacheLookupPolicy:t.cacheLookupPolicy}),this.preflightBrowserEnvironmentCheck(hn.Silent),this.logger.verbose("acquireTokenSilent called",r),l=t.account||this.getActiveAccount())return a={clientId:this.config.auth.clientId,authority:t.authority||Le.EMPTY_STRING,scopes:t.scopes,homeAccountIdentifier:l.homeAccountId,claims:t.claims,authenticationScheme:t.authenticationScheme,resourceRequestMethod:t.resourceRequestMethod,resourceRequestUri:t.resourceRequestUri,shrClaims:t.shrClaims,sshKid:t.sshKid},o=JSON.stringify(a),(a=this.activeSilentTokenRequests.get(o))===void 0?(this.logger.verbose("acquireTokenSilent called for the first time, storing active request",r),this.performanceClient.setPreQueueTime(nt.AcquireTokenSilentAsync,r),l=this.acquireTokenSilentAsync(yn(yn({},t),{correlationId:r}),l).then(function(g){return h.activeSilentTokenRequests.delete(o),i.addStaticFields({accessTokenSize:g.accessToken.length,idTokenSize:g.idToken.length}),i.endMeasurement({success:!0,fromCache:g.fromCache,isNativeBroker:g.fromNativeBroker,cacheLookupPolicy:t.cacheLookupPolicy,requestId:g.requestId}),g}).catch(function(g){throw h.activeSilentTokenRequests.delete(o),i.endMeasurement({errorCode:g.errorCode,subErrorCode:g.subError,success:!1}),g}),this.activeSilentTokenRequests.set(o,l),[2,l]):(this.logger.verbose("acquireTokenSilent has been called previously, returning the result from the first call",r),i.discardMeasurement(),[2,a]);throw Vt.createNoAccountError()})})},e.prototype.trackPageVisibility=function(){this.astsAsyncMeasurement&&(this.logger.info("Perf: Visibility change detected"),this.astsAsyncMeasurement.increment({visibilityChangeCount:1}))},e.prototype.acquireTokenSilentAsync=function(t,r){var i;return dt(this,void 0,void 0,function(){var o,a,l,h,p=this;return ft(this,function(g){switch(g.label){case 0:return this.performanceClient.addQueueMeasurement(nt.AcquireTokenSilentAsync,t.correlationId),this.eventHandler.emitEvent(Fn.ACQUIRE_TOKEN_START,hn.Silent,t),this.astsAsyncMeasurement=this.performanceClient.startMeasurement(nt.AcquireTokenSilentAsync,t.correlationId),(i=this.astsAsyncMeasurement)!=null&&i.increment({visibilityChangeCount:0}),document.addEventListener("visibilitychange",this.trackPageVisibility),Xf.isNativeAvailable(this.config,this.logger,this.nativeExtensionProvider,t.authenticationScheme)&&r.nativeAccountId?(this.logger.verbose("acquireTokenSilent - attempting to acquire token from native platform"),o=yn(yn({},t),{account:r}),o=this.acquireTokenNative(o,_i.acquireTokenSilent_silentFlow).catch(function(_){return dt(p,void 0,void 0,function(){return ft(this,function(x){if(_ instanceof vl&&_.isFatal())return this.logger.verbose("acquireTokenSilent - native platform unavailable, falling back to web flow"),this.nativeExtensionProvider=void 0,[2,this.createSilentIframeClient(t.correlationId).acquireToken(t)];throw _})})}),[3,3]):[3,1];case 1:return this.logger.verbose("acquireTokenSilent - attempting to acquire token from web flow"),a=this.createSilentCacheClient(t.correlationId),this.performanceClient.setPreQueueTime(nt.InitializeSilentRequest,t.correlationId),[4,a.initializeSilentRequest(t,r)];case 2:l=g.sent(),h=yn(yn({},t),{cacheLookupPolicy:t.cacheLookupPolicy||ts.Default}),this.performanceClient.setPreQueueTime(nt.AcquireTokenFromCache,l.correlationId),o=this.acquireTokenFromCache(a,l,h).catch(function(_){if(h.cacheLookupPolicy===ts.AccessToken)throw _;return qi.blockReloadInHiddenIframes(),p.eventHandler.emitEvent(Fn.ACQUIRE_TOKEN_NETWORK_START,hn.Silent,l),p.performanceClient.setPreQueueTime(nt.AcquireTokenByRefreshToken,l.correlationId),p.acquireTokenByRefreshToken(l,h).catch(function(x){var C=x instanceof Wf,M=x instanceof tc,L=x.errorCode===Am.noTokensFoundError.code,F=x.errorCode===Pc.INVALID_GRANT_ERROR;if(C&&F&&!M&&h.cacheLookupPolicy!==ts.AccessTokenAndRefreshToken&&h.cacheLookupPolicy!==ts.RefreshToken||h.cacheLookupPolicy===ts.Skip||L)return p.logger.verbose("Refresh token expired/invalid or CacheLookupPolicy is set to Skip, attempting acquire token by iframe.",t.correlationId),p.performanceClient.setPreQueueTime(nt.AcquireTokenBySilentIframe,l.correlationId),p.acquireTokenBySilentIframe(l);throw x})}),g.label=3;case 3:return[2,o.then(function(_){var x;return p.eventHandler.emitEvent(Fn.ACQUIRE_TOKEN_SUCCESS,hn.Silent,_),(x=p.astsAsyncMeasurement)!=null&&x.endMeasurement({success:!0,fromCache:_.fromCache,isNativeBroker:_.fromNativeBroker,requestId:_.requestId}),_}).catch(function(_){var x;throw p.eventHandler.emitEvent(Fn.ACQUIRE_TOKEN_FAILURE,hn.Silent,null,_),(x=p.astsAsyncMeasurement)!=null&&x.endMeasurement({errorCode:_.errorCode,subErrorCode:_.subError,success:!1}),_}).finally(function(){document.removeEventListener("visibilitychange",p.trackPageVisibility)})]}})})},e}(Cxe);function cR(n){this.message=n}cR.prototype=new Error,cR.prototype.name="InvalidCharacterError";var y9=typeof window<"u"&&window.atob&&window.atob.bind(window)||function(n){var e=String(n).replace(/=+$/,"");if(e.length%4==1)throw new cR("'atob' failed: The string to be decoded is not correctly encoded.");for(var t,r,i=0,o=0,a="";r=e.charAt(o++);~r&&(t=i%4?64*t+r:r,i++%4)&&(a+=String.fromCharCode(255&t>>(-2*i&6))))r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(r);return a};function Ixe(n){var e=n.replace(/-/g,"+").replace(/_/g,"/");switch(e.length%4){case 0:break;case 2:e+="==";break;case 3:e+="=";break;default:throw"Illegal base64url string!"}try{return decodeURIComponent(y9(e).replace(/(.)/g,function(t,r){return r=r.charCodeAt(0).toString(16).toUpperCase(),"%"+(r=r.length<2?"0"+r:r)}))}catch{return y9(e)}}function NE(n){this.message=n}function Pxe(n,e){if(typeof n!="string")throw new NE("Invalid token specified");e=(e=e||{}).header===!0?0:1;try{return JSON.parse(Ixe(n.split(".")[e]))}catch(t){throw new NE("Invalid token specified: "+t.message)}}NE.prototype=new Error,NE.prototype.name="InvalidTokenError";var Mxe=function(){function n(e){var t=this,r=(this.fallbackStorage={},this._triggerTokenFetch=function(i){return i===void 0&&(i=!1),new Promise(function(o,a){typeof t.options.getToken!="function"?a(new Error("Token cannot be ".concat(i?"fetched":"renewed"," because getToken was not set or is not a function."))):t.options.getToken(function(l){try{var h=t._getTokenExpiry(l)-n.constants.tokenRefreshClockSkew;t._storeToken(l),t._setTimeoutTokenFetch(h),o()}catch{a(new Error("Invalid token returned by getToken function"))}},function(l){a(l)},t.map)})},this._setTimeoutTokenFetch=function(i){clearTimeout(t.tokenTimeOutHandle),t.tokenTimeOutHandle=setTimeout(t._triggerTokenFetch,Math.min(1e3*i,2147483647))},e.getServiceOptions());this.options=r.authOptions,this.sessionId=r.sessionId,this.map=e}return n.prototype.initialize=function(){var e=this;return this.initPromise||(this.initPromise=new Promise(function(t,r){if(e.options.authType===ri.subscriptionKey)t();else if(e.options.authType===ri.aad)e.options.authContext=e.options.authContext||n.getDefaultAuthContext(e.options),e.options.authContext.handleRedirectPromise().then(function(){setTimeout(function(){return e._loginAndAcquireTokenForAAD(t,r)})}).catch(function(o){r(new Error("Error logging in the AAD users: "+o))});else if(e.options.authType===ri.anonymous)t(e._triggerTokenFetch(!0));else if(e.options.authType===ri.sas){if(e.options.sasToken){var i=-1;try{i=e._getTokenExpiry(e.options.sasToken)}catch{return void r(new Error("An invalid sasToken was provided."))}if(i>n.constants.tokenRefreshClockSkew)return e._storeToken(e.options.sasToken),e._setTimeoutTokenFetch(i-n.constants.tokenRefreshClockSkew),void t()}t(e._triggerTokenFetch())}else r(new Error("An invalid authentication type was specified."))})),this.initPromise},n.prototype.dispose=function(){this.tokenTimeOutHandle&&(clearTimeout(this.tokenTimeOutHandle),this.tokenTimeOutHandle=null)},n.getDefaultAuthContext=function(e){if(!e.aadAppId)throw new Error("No AAD app ID was specified.");if(e.aadTenant)return this.defaultAuthContext||(this.defaultAuthContext=new Axe({auth:{authority:"".concat(e.aadInstance||yc.aadInstance).concat(e.aadTenant),clientId:e.aadAppId},cache:{cacheLocation:this.constants.preferredCacheLocation}})),this.defaultAuthContext;throw new Error("No AAD tenant was specified.")},n.prototype._loginAndAcquireTokenForAAD=function(e,t){var r=((r=this.options.authContext)==null?void 0:r.getAllAccounts())||[];r.length===0?(this.options.authContext.loginRedirect(),e()):(this.options.authContext.setActiveAccount(r[0]),this._acquireTokenForAAD(e,t))},n.prototype._acquireTokenForAAD=function(e,t){var r=this,i={scopes:[Nn.aadResourceId]};this.options.authContext.acquireTokenSilent(i).then(function(o){r._saveItem(n.constants.storage.tokenKey,o.accessToken);var a={map:r.map,type:n.constants.events.tokenAcquired},a=(r.map.events.invoke(n.constants.events.tokenAcquired,a),clearTimeout(r.tokenTimeOutHandle),new Date(o.expiresOn).getTime()-Date.now());r.tokenTimeOutHandle=setTimeout(function(){return r._acquireTokenForAAD()},a),e!=null&&e()}).catch(function(o){if(o instanceof tc)return r.options.authContext.acquireTokenRedirect(i),e==null?void 0:e();t!=null&&t(o)})},n.prototype.getAuthType=function(){return this.options.authType},n.prototype.getClientId=function(){return this.options.clientId},n.prototype.getToken=function(){if(this.options.authType===ri.aad)return this._getItem(n.constants.storage.tokenKey);if(this.options.authType!==ri.anonymous&&this.options.authType!==ri.sas)return this.options.authType===ri.subscriptionKey?this.options.subscriptionKey:void 0;var e=this._getItem(n.constants.storage.tokenKey);if(e){var t=this._getTokenExpiry(e);if(t<300&&0<t)this._triggerTokenFetch();else if(t<=0)throw this._saveItem(n.constants.storage.tokenKey,""),new Error(n.constants.errors.tokenExpired)}else this._triggerTokenFetch();return e},n.prototype._getTokenExpiry=function(t){var t=Pxe(t).exp,r=this._getCurrentTime();return 0<t-r?t-r:-1},n.prototype._storeToken=function(e){this._saveItem(n.constants.storage.tokenKey,e),e={map:this.map,type:n.constants.events.tokenAcquired},this.map.events.invoke(n.constants.events.tokenAcquired,e)},n.prototype._saveItem=function(e,t){return this._supportsLocalStorage()?localStorage.setItem(e,t):this._supportsSessionStorage()?sessionStorage.setItem(e,t):this.fallbackStorage[e]=t,!0},n.prototype._getItem=function(e){return this._supportsLocalStorage()?localStorage.getItem(e):this._supportsSessionStorage()?sessionStorage.getItem(e):e in this.fallbackStorage?this.fallbackStorage[e]:null},n.prototype._supportsLocalStorage=function(){try{return window.localStorage?(window.localStorage.setItem(n.constants.storage.testStorageKey,"A"),window.localStorage.getItem(n.constants.storage.testStorageKey)==="A"&&(window.localStorage.removeItem(n.constants.storage.testStorageKey),!window.localStorage.getItem(n.constants.storage.testStorageKey))):!1}catch{return!1}},n.prototype._supportsSessionStorage=function(){try{return window.sessionStorage?(window.sessionStorage.setItem(n.constants.storage.testStorageKey,"A"),window.sessionStorage.getItem(n.constants.storage.testStorageKey)==="A"&&(window.sessionStorage.removeItem(n.constants.storage.testStorageKey),!window.sessionStorage.getItem(n.constants.storage.testStorageKey))):!1}catch{return!1}},n.prototype._getCurrentTime=function(){return Math.round(new Date().getTime()/1e3)},n.prototype.signRequest=function(e){e.headers=e.headers||{},e.headers[Nn.sessionIdHeaderName]=this.sessionId,e.headers[Nn.msOriginHeaderName]=Nn.msOriginHeaderValue,e.headers[Nn.mapAgentHeaderName]="MapControl/".concat(ah," (Web)");var t=this.getToken();switch(this.options.authType){case ri.aad:case ri.anonymous:e.headers[Nn.msClientIdHeaderName]=this.options.clientId,e.headers[Nn.authorizationHeaderName]=Nn.authorizationTokenPrefix+t;break;case ri.sas:e.headers[Nn.authorizationHeaderName]=Nn.jwtSasPrefix+t;break;case ri.subscriptionKey:e.headers["subscription-key"]=t;break;default:throw new Error("An invalid authentication type was specified")}return e},n.constants={preferredCacheLocation:"localStorage",storage:{tokenKey:"access.token.key",testStorageKey:"testStorage"},events:{tokenAcquired:"tokenacquired"},tokenExpiresIn:3599,tokenRefreshClockSkew:300,errors:{tokenExpired:"Token Expired, Try again"}},n}(),_9=window&&window.__values||function(n){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&n[e],r=0;if(t)return t.call(n);if(n&&typeof n.length=="number")return{next:function(){return{value:(n=n&&r>=n.length?void 0:n)&&n[r++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},Rxe=function(){function n(e){for(var t in this.map=e,this.controlContainer=document.createElement("div"),this.controlContainer.classList.add("atlas-control-container"),xa){var r;xa.hasOwnProperty(t)&&((r=document.createElement("div")).classList.add(xa[t]),r.classList.add("subcontrol-container"),this.controlContainer.appendChild(r))}this.map.getMapContainer().appendChild(this.controlContainer),this.controls=new Set}return n.prototype.add=function(e,t){var r,i;if(Array.isArray(e))try{for(var o=_9(e),a=o.next();!a.done;a=o.next()){var l=a.value;this._add(l,t)}}catch(h){r={error:h}}finally{try{a&&!a.done&&(i=o.return)&&i.call(o)}finally{if(r)throw r.error}}else this._add(e,t)},n.prototype.getControls=function(){return Array.from(this.controls)},n.prototype.remove=function(e){var t,r;if(Array.isArray(e))try{for(var i=_9(e),o=i.next();!o.done;o=i.next()){var a=o.value;this._remove(a)}}catch(l){t={error:l}}finally{try{o&&!o.done&&(r=i.return)&&r.call(i)}finally{if(t)throw t.error}}else this._remove(e)},n.prototype._add=function(i,o){this.controls.add(i);var r=new noe().merge(o),i=i.onAdd(this.map,o),o=this.controlContainer.getElementsByClassName(r.position);if(!(0<o.length))throw new Error("Control position ".concat(r.position," does not exist."));o.item(0).appendChild(i)},n.prototype._remove=function(e){e.onRemove(),this.controls.delete(e)},n}(),Om=window&&window.__assign||function(){return(Om=Object.assign||function(n){for(var e,t=1,r=arguments.length;t<r;t++)for(var i in e=arguments[t])Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i]);return n}).apply(this,arguments)},kxe=function(){function n(e){this.callbacks=new ws,this.map=e}return n.prototype.addCallback=function(e,t,r,i,o){var a,l,h=this;if(i)a=function(C){var g=C.lngLat?new $o(C.lngLat.lng,C.lngLat.lat):void 0,_=C.point?[C.point.x,C.point.y]:void 0,x=C.features?C.features.map(function(M){return new _c(M.geometry,M.properties,M.id)}):[],C={type:C.type,originalEvent:C.originalEvent,position:g,coordinate:_,features:x};r(C)};else switch(e){case"data":case"sourcedata":case"styledata":a=function(p){p=Om(Om({dataType:p.dataType},p.dataType==="source"&&Om(Om(Om({isSourceLoaded:p.isSourceLoaded},p.sourceDataType&&{sourceDataType:p.sourceDataType}),{source:h.map.sources.getById(p.sourceId)}),p.tile&&{tile:{id:{x:p.tile.tileID.canonical.x,y:p.tile.tileID.canonical.y,z:p.tile.tileID.canonical.z},size:p.tile.tileSize,state:p.tile.state}})),{map:h.map,type:p.type}),o&&h.map.events._removeListener(e,t,r),r(p)};break;case"error":a=function(p){p={error:p.error,map:h.map,type:p.type},o&&h.map.events._removeListener(e,t,r),r(p)};break;case"touchstart":case"touchend":case"touchmove":case"touchcancel":a=function(p){if(p.originalEvent){if(p.originalEvent===l)return;l=p.originalEvent}var M=p.point?new Go(p.point.x,p.point.y):void 0,g=p.points?p.points.map(function(L){return new Go(L.x,L.y)}):[],_=p.lngLat?new $o(p.lngLat.lng,p.lngLat.lat):void 0,x=p.lngLats?p.lngLats.map(function(L){return new $o(L.lng,L.lat)}):[],C=_?h.map.layers.getRenderedShapes(new vc(_),t?[t]:void 0):[],M={map:h.map,originalEvent:p.originalEvent,pixel:M,pixels:g,position:_,positions:x,shapes:C,layerId:t||void 0,preventDefault:function(){return p.preventDefault()},type:p.type};o&&h.map.events._removeListener(e,t,r),r(M)};break;case"mousedown":case"mouseup":case"mouseover":case"mousemove":case"click":case"dblclick":case"mouseout":case"mouseenter":case"mouseleave":case"contextmenu":a=function(p){if(p.originalEvent){if(p.originalEvent===l)return;l=p.originalEvent}var x=p.lngLat?new $o(p.lngLat.lng,p.lngLat.lat):void 0,g=p.point?new Go(p.point.x,p.point.y):void 0,_=x?h.map.layers.getRenderedShapes(new vc(x),t?[t]:void 0):[],x={map:h.map,originalEvent:p.originalEvent,position:x,pixel:g,preventDefault:function(){return p.preventDefault()},shapes:_,layerId:t||void 0,type:p.type};o&&h.map.events._removeListener(e,t,r),r(x)};break;case"styleimagemissing":a=function(p){o&&h.map.events._removeListener(e,t,r),r(p.id)};break;case"wheel":a=function(p){if(p.originalEvent){if(p.originalEvent===l)return;l=p.originalEvent}var g={map:h.map,originalEvent:p.originalEvent,preventDefault:function(){return p.preventDefault()},type:p.type};o&&h.map.events._removeListener(e,t,r),r(g)};break;case"resize":a=function(p){var g,_={map:h.map,type:p.type};for(g in p)g!=="type"&&g!=="target"&&(_[g]=p[g]);o&&h.map.events._removeListener(e,t,r),r(_)};break;default:a=function(p){var g={map:h.map,type:p.type};p.originalEvent&&(g.originalEvent=p.originalEvent),o&&h.map.events._removeListener(e,t,r),r(g)}}this.callbacks.has(t)||this.callbacks.set(t,new ws),this.callbacks.get(t).has(e)||this.callbacks.get(t).set(e,new Map),this.callbacks.get(t).get(e).set(r,[a,o])},n.prototype.removeCallback=function(e,t,r){this.callbacks.has(t)&&this.callbacks.get(t).has(e)&&this.callbacks.get(t).get(e).has(r)&&this.callbacks.get(t).get(e).delete(r)},n.prototype.getModifiedCallback=function(e,t,r){if(this.callbacks.has(t)&&this.callbacks.get(t).has(e)&&this.callbacks.get(t).get(e).has(r))return this.callbacks.get(t).get(e).get(r)[0]},n.prototype.getLayerCallbacks=function(e){if(this.callbacks.has(e))return this.callbacks.get(e)},n.prototype.getEventCallbacks=function(e,t){if(this.callbacks.has(t)&&(t=this.callbacks.get(t),t.has(e)))return t.get(e)},n}(),Qf=window&&window.__values||function(n){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&n[e],r=0;if(t)return t.call(n);if(n&&typeof n.length=="number")return{next:function(){return{value:(n=n&&r>=n.length?void 0:n)&&n[r++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},lR=window&&window.__read||function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var r,i,o=t.call(n),a=[];try{for(;(e===void 0||0<e--)&&!(r=o.next()).done;)a.push(r.value)}catch(l){i={error:l}}finally{try{r&&!r.done&&(t=o.return)&&t.call(o)}finally{if(i)throw i.error}}return a},v9=["maxzoomchanged","minzoomchanged","mapconfigurationchanged"],Oxe=function(){function n(e){this.map=e,this.mapCallbackHandler=new kxe(this.map)}return n.prototype.add=function(e,t,r){var i,o;if(typeof t=="function")this._addGlobalListener(e,t,!1,!1);else{t=Array.isArray(t)?t:[t];try{for(var a=Qf(t),l=a.next();!l.done;l=a.next()){var h=l.value;h instanceof Ai&&Ai._isMBoxEvent(e)?this._addLayerListener(e,h,r,!1,!1):h._addEventListener(e,r,!1)}}catch(p){i={error:p}}finally{try{l&&!l.done&&(o=a.return)&&o.call(a)}finally{if(i)throw i.error}}}},n.prototype.addOnce=function(e,t,r){typeof t=="function"?this._addGlobalListener(e,t,!1,!0):t instanceof Ai&&Ai._isMBoxEvent(e)?this._addLayerListener(e,t,r,!1,!0):t._addEventListener(e,r,!0)},n.prototype._addLegacy=function(e,t,r){typeof t=="function"?this._addGlobalListener(e,t,!0,!1):this._addLayerListener(e,t,r,!0,!1)},n.prototype._addLayerListener=function(e,g,r,i,o){var a,l,h,p,g=g instanceof Ai?g.getId():g,_=this.map.layers.getLayerById(g),x=this.mapCallbackHandler.getModifiedCallback(e,g,r);if(x&&_)try{for(var C=Qf(_._getLayerIds()),M=C.next();!M.done;M=C.next()){var L=M.value;this.map._getMap().off(e,L,x)}}catch(ee){a={error:ee}}finally{try{M&&!M.done&&(l=C.return)&&l.call(C)}finally{if(a)throw a.error}}if(this.mapCallbackHandler.addCallback(e,g,r,i,o),_){x=this.mapCallbackHandler.getModifiedCallback(e,g,r);try{for(var F=Qf(_._getLayerIds()),z=F.next();!z.done;z=F.next())L=z.value,this.map._getMap().on(e,L,x)}catch(ee){h={error:ee}}finally{try{z&&!z.done&&(p=F.return)&&p.call(F)}finally{if(h)throw h.error}}}},n.prototype._addGlobalListener=function(e,t,r,i){var o,a,l,h;v9.includes(e)?this.map._addEventListener(e,t,i):(o=this.mapCallbackHandler.getModifiedCallback(e,"",t),this.mapCallbackHandler.addCallback(e,"",t,r,i),a=this.mapCallbackHandler.getModifiedCallback(e,"",t),e==="load"&&this.map._isLoaded()?(l={type:"load",map:this.map},setTimeout(function(){return a(l)})):e==="ready"?this.map._isReady()&&(h={type:"ready",map:this.map},setTimeout(function(){return a(h)})):(o&&this.map._getMap().off(e,o),this.map._getMap().on(e,a)))},n.prototype.invoke=function(e,t,r){if(r===void 0)this._invokeListeners(e,"",t);else if(t instanceof Ai&&Ai._isMBoxEvent(e))this._invokeListeners(e,t.getId(),r);else{if(!(t instanceof Wl))throw new Error("The invoke target is invalid.");t._invokeEvent(e,r)}},n.prototype._invokeListeners=function(e,t,r){var i=this,o=new ws(this.mapCallbackHandler.getEventCallbacks(e,t));o?o.forEach(function(a,l){a=lR(a,2),a[0],a[1]&&i._removeListener(e,t,l),l(r)}):e==="error"&&console.error("error"in r?r.error:r)},n.prototype.remove=function(e,t,r){var i,o;if(typeof t=="function")this._removeListener(e,"",t);else{t=Array.isArray(t)?t:[t];try{for(var a=Qf(t),l=a.next();!l.done;l=a.next()){var h=l.value;h instanceof Ai&&Ai._isMBoxEvent(e)?this._removeListener(e,h,r):h!=null&&h._removeEventListener(e,r)}}catch(p){i={error:p}}finally{try{l&&!l.done&&(o=a.return)&&o.call(a)}finally{if(i)throw i.error}}}},n.prototype._removeLegacy=function(e,t,r){typeof t=="function"?this._removeListener(e,"",t):this._removeListener(e,t,r)},n.prototype._removeListener=function(e,t,r){var i,o;if(v9.includes(e))this.map._removeEventListener(e,r);else{var t=t instanceof Ai?t.getId():t,a=this.mapCallbackHandler.getModifiedCallback(e,t,r);if(a)if(t){var l=this.map.layers.getLayerById(t);if(l)try{for(var h=Qf(l._getLayerIds()),p=h.next();!p.done;p=h.next()){var g=p.value;this.map._getMap().off(e,g,a)}}catch(x){i={error:x}}finally{try{p&&!p.done&&(o=h.return)&&o.call(h)}finally{if(i)throw i.error}}}else this.map._getMap().off(e,a);this.mapCallbackHandler.removeCallback(e,t,r)}},n.prototype._enableLayerEvents=function(e){var t=this,r=this.mapCallbackHandler.getLayerCallbacks(e.getId());r&&r.forEach(function(i,o){i.forEach(function(a){var l,h,p=lR(a,1)[0];try{for(var g=Qf(e._getLayerIds()),_=g.next();!_.done;_=g.next()){var x=_.value;t.map._getMap().on(o,x,p)}}catch(C){l={error:C}}finally{try{_&&!_.done&&(h=g.return)&&h.call(g)}finally{if(l)throw l.error}}})})},n.prototype._disableLayerEvents=function(e){var t=this,r=this.mapCallbackHandler.getLayerCallbacks(e.getId());r&&r.forEach(function(i,o){i.forEach(function(a){var l,h,p=lR(a,1)[0];try{for(var g=Qf(e._getLayerIds()),_=g.next();!_.done;_=g.next()){var x=_.value;t.map._getMap().off(o,x,p)}}catch(C){l={error:C}}finally{try{_&&!_.done&&(h=g.return)&&h.call(g)}finally{if(l)throw l.error}}})})},n}(),b9=window&&window.__values||function(n){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&n[e],r=0;if(t)return t.call(n);if(n&&typeof n.length=="number")return{next:function(){return{value:(n=n&&r>=n.length?void 0:n)&&n[r++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},Lxe=function(){function n(e){this.markers=new Set,this.map=e}return n.prototype.add=function(e,t){var r,i;if(Array.isArray(e))try{for(var o=b9(e),a=o.next();!a.done;a=o.next()){var l=a.value;this._addMarker(l,t)}}catch(h){r={error:h}}finally{try{a&&!a.done&&(i=o.return)&&i.call(o)}finally{if(r)throw r.error}}else this._addMarker(e,t)},n.prototype._addMarker=function(e,t){e._addToMap(this.map,t),this.markers.add(e)},n.prototype.getMarkers=function(){return Array.from(this.markers)},n.prototype.remove=function(e){var t,r;if(Array.isArray(e))try{for(var i=b9(e),o=i.next();!o.done;o=i.next()){var a=o.value;this._removeMarker(a)}}catch(l){t={error:l}}finally{try{o&&!o.done&&(r=i.return)&&r.call(i)}finally{if(t)throw t.error}}else this._removeMarker(e)},n.prototype._removeMarker=function(e){var t=this;e instanceof p2?(e._removeFromMap(),this.markers.delete(e)):this.markers.forEach(function(r){r._getId()===e&&(r._removeFromMap(),t.markers.delete(r))})},n.prototype.clear=function(){var e=this;this.markers.forEach(function(t){t._removeFromMap(),e.markers.delete(t)})},n}(),Nxe=function(){function n(e){this.userImages=new ws,this.imageLoadTimeout=5e3,this.map=e}return n.prototype.add=function(e,t,r){var i=this;return new Promise(function(o,a){var l,h,p;i.userImages.has(e)?o():t instanceof HTMLImageElement||t instanceof ImageData?(i.map._getMap().addImage(e,t,r),i.userImages.set(e,{image:t,meta:r}),o()):typeof t=="string"&&(h=void 0,h=/<svg/i.test(t)&&!/^data:/i.test(t)?"data:image/svg+xml;base64,"+window.btoa(t):t,p=!1,i.map._sendRequest(h,"Image").then(function(g){return p?void 0:g.blob()}).then(function(g){var _;!p&&g&&(clearTimeout(l),(_=new Image).onload=function(){i.map._getMap().addImage(e,_,r),i.userImages.set(e,{image:_,meta:r}),o()},_.onerror=_.onabort=function(){a("Failed to load image into HTML element.")},_.src=URL.createObjectURL(g))}).catch(function(){p||(clearTimeout(l),a("Failed to load image into HTML element."))}),l=setTimeout(function(){p=!0,a("Failed to load image within specified timeout: ".concat(i.imageLoadTimeout," ms."))},i.imageLoadTimeout))})},n.prototype.clear=function(){var e=this;this.userImages.forEach(function(t,r){e.map._getMap().removeImage(r)}),this.userImages.clear()},n.prototype.getImageIds=function(){var e=[];return this.userImages.forEach(function(t,r){e.push(r)}),e},n.prototype.createFromTemplate=function(e,t,r,i,o){return r=r||"#1A73AA",i=i||"#fff",t=(t=AF(t,o)).replace(/{color}/g,r).replace(/{secondaryColor}/g,i).replace(/{text}/g,""),this.add(e,t)},n.prototype.hasImage=function(e){return this.userImages.has(e)},n.prototype.remove=function(e){this.map._getMap().removeImage(e),this.userImages.delete(e)},n.prototype._restoreImages=function(){var e=this;this.userImages.forEach(function(t,r){e.map._getMap().hasImage(r)||e.map._getMap().addImage(r,t.image,t.meta)})},n}(),Dxe=window&&window.__extends||function(){var n=function(e,t){return(n=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(r,i){r.__proto__=i}:function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])}))(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),Fxe=window&&window.__values||function(n){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&n[e],r=0;if(t)return t.call(n);if(n&&typeof n.length=="number")return{next:function(){return{value:(n=n&&r>=n.length?void 0:n)&&n[r++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},Kh=function(n){function e(t,r){return r=n.call(this,r)||this,r.layers=t,r}return Dxe(e,n),e.prototype.getOptions=function(){return{}},e.prototype.setOptions=function(t){},e.prototype._buildLayers=function(){return this.layers},e.prototype._getLayerIds=function(){return this.layers.map(function(t){return t.id})},e.prototype._getSourceIds=function(){var t,r,i=new Set;try{for(var o=Fxe(this.layers),a=o.next();!a.done;a=o.next()){var l=a.value;"source"in l&&typeof l.source=="string"?i.add(l.source):"source"in l&&l.source&&i.add(l.id)}}catch(h){t={error:h}}finally{try{a&&!a.done&&(r=o.return)&&r.call(o)}finally{if(t)throw t.error}}return i},e.prototype._updateLayoutProperty=function(t,r,i,o){var a;Ea(r,i)||(a=this.map._getMap(),this.layers.forEach(function(l){a.getLayer(l.id)?a.setLayoutProperty(l.id,t,o||r):console.warn("Could not update layout property ".concat(t," for layer ").concat(l.id," to ").concat(o||r))}))},e}(Ai),Eu=window&&window.__values||function(n){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&n[e],r=0;if(t)return t.call(n);if(n&&typeof n.length=="number")return{next:function(){return{value:(n=n&&r>=n.length?void 0:n)&&n[r++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},Bxe=window&&window.__read||function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var r,i,o=t.call(n),a=[];try{for(;(e===void 0||0<e--)&&!(r=o.next()).done;)a.push(r.value)}catch(l){i={error:l}}finally{try{r&&!r.done&&(t=o.return)&&t.call(o)}finally{if(i)throw i.error}}return a},Uxe=window&&window.__spreadArray||function(n,e,t){if(t||arguments.length===2)for(var r,i=0,o=e.length;i<o;i++)!r&&i in e||((r=r||Array.prototype.slice.call(e,0,i))[i]=e[i]);return n.concat(r||Array.prototype.slice.call(e))},zxe=function(){function n(e){this.layerIndex=[],this.userLayers=[],this.map=e}return n.prototype.add=function(e,t){var r,i,o=t instanceof Ai?t.getId():t;if(Array.isArray(e))try{for(var a=Eu(e),l=a.next();!l.done;l=a.next()){var h=l.value;this._addLayer(h,o)}}catch(p){r={error:p}}finally{try{l&&!l.done&&(i=a.return)&&i.call(a)}finally{if(r)throw r.error}}else this._addLayer(e,o)},n.prototype._addLayer=function(e,t){if(!(this.map._isReady()||e instanceof Kh))throw new Error("The layer '".concat(e.getId(),"' could not be added to the map because ")+"the map is not ready. Please use a ready event listener to guarantee the map is ready before adding a layer to it.");var r,i,o,a;t!==e.getId()&&this.layerIndex.find(function(l){return t===l.getId()})?this._getMapboxLayerExists(e)?(i=this.layerIndex.findIndex(function(l){return l.getId()===e.getId()}),o=this.userLayers.findIndex(function(l){return l.layer.getId()===e.getId()}),this._removeMapboxLayers(e),this._addMapboxLayers(e,t),(a=this.layerIndex[i])&&this.map.events._disableLayerEvents(a),this.map.events._enableLayerEvents(e),this.layerIndex.splice(i,1),r=this.layerIndex.findIndex(function(l){return l.getId()===t}),this.layerIndex.splice(r,0,e),e instanceof Kh||(this.userLayers[o]={layer:e,before:t}),a&&a.onRemove()):(this._addMapboxLayers(e,t),this.map.events._enableLayerEvents(e),r=this.layerIndex.findIndex(function(l){return l.getId()===t}),this.layerIndex.splice(r,0,e),e instanceof Kh||this.userLayers.push({layer:e,before:t})):(i=this.layerIndex.findIndex(function(l){return l.getId()===e.getId()}),o=this.userLayers.findIndex(function(l){return l.layer.getId()===e.getId()}),0<=i&&0<=o?(a=this.layerIndex[i],this._removeMapboxLayers(a),this._addMapboxLayers(e,i+1),this.map.events._disableLayerEvents(a),this.map.events._enableLayerEvents(e),(this.layerIndex[i]=e)instanceof Kh||(this.userLayers[o]={layer:e,before:void 0}),a.onRemove()):(this._addMapboxLayers(e),this.map.events._enableLayerEvents(e),this.layerIndex.push(e),e instanceof Kh||this.userLayers.push({layer:e,before:t}))),e.onAdd(this.map)},n.prototype._addMapboxLayers=function(e,t){var r,i;if(!(e instanceof hw)||e.getOptions().tileUrl){if(!(e instanceof Kh)){e instanceof U_&&(this.map._getMap().addSource(e._getSourceId(),e._buildSource()),this.map.sources.setSourceState(e._getSourceWrapper()));var o=this._getMapboxBefore(t);try{for(var a=Eu(e._buildLayers()),l=a.next();!l.done;l=a.next()){var h=l.value;this.map._getMap().addLayer(h,o)}}catch(p){r={error:p}}finally{try{l&&!l.done&&(i=a.return)&&i.call(a)}finally{if(r)throw r.error}}}this.map.events._enableLayerEvents(e)}},n.prototype._removeMapboxLayers=function(e,t){var r,i;if(e instanceof Kh&&!t)this.map.events._disableLayerEvents(e);else{try{for(var o=Eu(e._getLayerIds()),a=o.next();!a.done;a=o.next()){var l=a.value;this.map._getMap().getLayer(l)&&this.map._getMap().removeLayer(l)}}catch(h){r={error:h}}finally{try{a&&!a.done&&(i=o.return)&&i.call(o)}finally{if(r)throw r.error}}this.map.events._disableLayerEvents(e),e instanceof U_&&this.map._getMap().getSource(e._getSourceId())&&this.map._getMap().removeSource(e._getSourceId())}},n.prototype._getMapboxLayerExists=function(e){var t=this,r=!1;return typeof e=="string"?!!(e=this.layerIndex.find(function(i){return i.getId()===e})):(e._getLayerIds().forEach(function(i){t.map._getMap().getLayer(i)&&(r=!0)}),r)},n.prototype._getMapboxBefore=function(e){var t,r,i,o;if(typeof e=="string"){var a=this.layerIndex.find(function(C){return C.getId()===e});if(!a)return;try{for(var l=Eu(a._getLayerIds()),h=l.next();!h.done;h=l.next()){var p=h.value;if(this.map._getMap().getLayer(p))return p}}catch(C){t={error:C}}finally{try{h&&!h.done&&(r=l.return)&&r.call(l)}finally{if(t)throw t.error}}e=this.layerIndex.findIndex(function(C){return C.getId()===e})+1}for(var g=e;g<this.layerIndex.length;g++)try{i=void 0;for(var _=Eu(this.layerIndex[g]._getLayerIds()),x=_.next();!x.done;x=_.next())if(p=x.value,this.map._getMap().getLayer(p))return p}catch(C){i={error:C}}finally{try{x&&!x.done&&(o=_.return)&&o.call(_)}finally{if(i)throw i.error}}},n.prototype.clear=function(){for(var e=this.layerIndex.length-1;0<=e;e--){var t=this.layerIndex[e];t&&(this._removeMapboxLayers(t,!0),this.layerIndex.splice(e,1),t.onRemove())}this.userLayers=[]},n.prototype.getLayerById=function(e){var t=this.layerIndex.find(function(r){return r.getId()===e});if(t)return t},n.prototype.getLayers=function(){return this.layerIndex.slice(0)},n.prototype._getSourceIds=function(){var e,t,r=new Set;try{for(var i=Eu(this.layerIndex),o=i.next();!o.done;o=i.next())o.value._getSourceIds().forEach(function(a){return r.add(a)})}catch(a){e={error:a}}finally{try{o&&!o.done&&(t=i.return)&&t.call(i)}finally{if(e)throw e.error}}return r},n.prototype._getUserLayers=function(){return Array.from(this.userLayers)},n.prototype.move=function(e,t){var r=e instanceof Ai?e.getId():e,i=t instanceof Ai?t.getId():t;if(!this.layerIndex.find(function(o){return o.getId()===r}))throw new Error("The layer '".concat(r,"' has not been added to the map and cannot be moved."));t=this.layerIndex.findIndex(function(o){return o.getId()===r}),this._moveMapboxLayers(this.layerIndex[t],i),e=this.layerIndex[t],this.layerIndex.splice(t,1),t=this.layerIndex.findIndex(function(o){return o.getId()===i}),-1<t?this.layerIndex.splice(t,0,e):this.layerIndex.push(e),t=this.userLayers.find(function(o){return o.layer.getId()===r}),t&&(t.before=i)},n.prototype._moveMapboxLayers=function(e,t){var r,i,o=this._getMapboxBefore(t);try{for(var a=Eu(e._getLayerIds()),l=a.next();!l.done;l=a.next()){var h=l.value;this.map._getMap().moveLayer(h,o)}}catch(p){r={error:p}}finally{try{l&&!l.done&&(i=a.return)&&i.call(a)}finally{if(r)throw r.error}}},n.prototype.getRenderedShapes=function(e,t,r){var i,o,a,l=this;if(e=e||[-180,-85.0511,180,85.0511],Array.isArray(e)?e.length===4||e.length===6?a=this.map.positionsToPixels([rr.getSouthWest(e),rr.getNorthEast(e)]):e.length!==2&&e.length!==3||(a=this.map.positionsToPixels([e])[0]):a=this.map.positionsToPixels([e.coordinates])[0],t){t=Array.isArray(t)?t:[t];var h=[],p=this;try{for(var g=Eu(t),_=g.next();!_.done;_=g.next())(function(M){var C=M instanceof Ai?M.getId():M,M=p.layerIndex.findIndex(function(L){return L.getId()===C});if(!(-1<M))throw new Error("The layer '".concat(C,"' has not been added to the map ")+"and its rendered features cannot be retrieved.");h.push.apply(h,Uxe([],Bxe(p.layerIndex[M]._getLayerIds().filter(function(L){return!!l.map._getMap().getLayer(L)})),!1))})(_.value)}catch(x){i={error:x}}finally{try{_&&!_.done&&(o=g.return)&&o.call(g)}finally{if(i)throw i.error}}}return e=this.map._getMap().queryRenderedFeatures(a,{layers:h,filter:r}),this.map.sources._mapFeaturesToShapes(e)},n.prototype.remove=function(e){var t,r;if(Array.isArray(e))try{for(var i=Eu(e),o=i.next();!o.done;o=i.next()){var a=o.value;this._removeLayer(a)}}catch(l){t={error:l}}finally{try{o&&!o.done&&(r=i.return)&&r.call(i)}finally{if(t)throw t.error}}else this._removeLayer(e)},n.prototype._removeLayer=function(e){var t=e instanceof Ai?e.getId():e,i=this.layerIndex.findIndex(function(o){return o.getId()===t});if(i==-1)throw new Error("The layer '".concat(t,"' has not been added to the map and cannot be removed."));var r=this.layerIndex[i],i=(this._removeMapboxLayers(r),this.layerIndex.splice(i,1),this.userLayers.findIndex(function(o){return o.layer.getId()===t}));i!=-1&&this.userLayers.splice(i,1),e instanceof U_&&this.map.sources.unsetSourceState(e._getSourceId()),r.onRemove()},n}(),w9=window&&window.__values||function(n){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&n[e],r=0;if(t)return t.call(n);if(n&&typeof n.length=="number")return{next:function(){return{value:(n=n&&r>=n.length?void 0:n)&&n[r++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},jxe=function(){function n(e){var t=this;this._onDrag=function(r){var i,o;r.type==="mousemove"?(i=r.clientX,o=r.clientY):r.type==="touchmove"&&(i=r.touches[0].clientX,o=r.touches[0].clientY),t.draggedPopups.forEach(function(a){a._dragToPixel([i,o])})},this._onUp=function(){t.map.getMapContainer().removeEventListener("mousemove",t._onDrag),t.map.getMapContainer().removeEventListener("touchmove",t._onDrag),t.map.getMapContainer().removeEventListener("mouseup",t._onUp),t.map.getMapContainer().removeEventListener("touchend",t._onUp),t.draggedPopups.forEach(function(r){t.draggedPopups.delete(r),r._onUp()})},this.map=e,this.popups=new Set,this.draggedPopups=new Set}return n.prototype.add=function(e){var t,r;e=Array.isArray(e)?e:[e];try{for(var i=w9(e),o=i.next();!o.done;o=i.next()){var a=o.value;this.popups.has(a)||(this.popups.add(a),a.attach(this.map))}}catch(l){t={error:l}}finally{try{o&&!o.done&&(r=i.return)&&r.call(i)}finally{if(t)throw t.error}}},n.prototype.clear=function(){var e=this;this.popups.forEach(function(t){e.popups.delete(t),t.remove()})},n.prototype.remove=function(e){var t,r;e=Array.isArray(e)?e:[e];try{for(var i=w9(e),o=i.next();!o.done;o=i.next()){var a=o.value;this.popups.has(a)&&(this.popups.delete(a),a.remove())}}catch(l){t={error:l}}finally{try{o&&!o.done&&(r=i.return)&&r.call(i)}finally{if(t)throw t.error}}},n.prototype.getPopups=function(){return Array.from(this.popups)},n.prototype._getCollectionDiv=function(){var e=this.map.getMapContainer().querySelector(".".concat(n.Css.collection));return e||((e=document.createElement("div")).classList.add(n.Css.collection),e.setAttribute("aria-label","Map Information"),this.map.getMapContainer().appendChild(e)),e},n.prototype._addDraggedPopup=function(e){this.draggedPopups.size===0&&(this.map.getMapContainer().addEventListener("mousemove",this._onDrag),this.map.getMapContainer().addEventListener("touchmove",this._onDrag),this.map.getMapContainer().addEventListener("mouseup",this._onUp),this.map.getMapContainer().addEventListener("touchend",this._onUp)),this.draggedPopups.add(e)},n.Css={collection:"popup-collection-container"},n}(),uR=window&&window.__values||function(n){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&n[e],r=0;if(t)return t.call(n);if(n&&typeof n.length=="number")return{next:function(){return{value:(n=n&&r>=n.length?void 0:n)&&n[r++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},Vxe=function(){function n(e){this.map=e,this.sources=new ws}return n.prototype.add=function(e,t){var r,i;if(t===void 0&&(t=!0),Array.isArray(e))try{for(var o=uR(e),a=o.next();!a.done;a=o.next()){var l=a.value;this._addSource(l,t)}}catch(h){r={error:h}}finally{try{a&&!a.done&&(i=o.return)&&i.call(o)}finally{if(r)throw r.error}}else this._addSource(e,t)},n.prototype.getRenderedShapes=function(e,t,r){return e=typeof e=="string"?e:e.getId(),r=this.map._getMap().querySourceFeatures(e,{sourceLayer:r,filter:t}),this.map.sources._mapFeaturesToShapes(r,!0,this.sources.get(e))},n.prototype.getFeatureState=function(e,t,r){return e=typeof e=="string"?e:e instanceof Ci?e.getId():e.id,t=typeof t=="string"?t:t.getId(),this.map._getMap().getFeatureState({id:e,source:t,sourceLayer:r})},n.prototype.removeFeatureState=function(e,t,r,i){e=typeof e=="string"?e:e instanceof Ci?e.getId():e.id,t=typeof t=="string"?t:t.getId(),this.map._getMap().removeFeatureState({id:e,source:t,sourceLayer:r},i)},n.prototype.setFeatureState=function(e,t,r,i){e=typeof e=="string"?e:e instanceof Ci?e.getId():e.id,t=typeof t=="string"?t:t.getId(),this.map._getMap().setFeatureState({id:e,source:t,sourceLayer:i},r)},n.prototype._buildSources=function(){var e={};return this.sources.forEach(function(t){e[t.getId()]=t._buildSource()}),e},n.prototype.clear=function(){var e=this;this.sources.forEach(function(t){e.remove(t)})},n.prototype.getById=function(e){return this.sources.get(e)},n.prototype.getSources=function(){return Array.from(this.sources.values())},n.prototype.isSourceLoaded=function(e){return e=e instanceof gi?e.getId():e,this.map._getMap().isSourceLoaded(e)},n.prototype.remove=function(e,t){var r,i;if(t===void 0&&(t=!0),Array.isArray(e))try{for(var o=uR(e),a=o.next();!a.done;a=o.next()){var l=a.value;this._removeSource(l,t)}}catch(h){r={error:h}}finally{try{a&&!a.done&&(i=o.return)&&i.call(o)}finally{if(r)throw r.error}}else this._removeSource(e,t)},n.prototype.setSourceState=function(e,t){t===void 0&&(t=!0),this.sources.set(e.getId(),e),e._setMap(this.map,t)},n.prototype.unsetSourceState=function(e){this.sources.has(e)&&(this.sources.get(e)._setMap(null),this.sources.delete(e))},n.prototype._removeSource=function(e,t){if(e=e instanceof gi?e.getId():e,!this.sources.has(e))throw new Error("'".concat(e,"' is not added to the map"));if(this.map._getMap().getSource(e)&&t&&this.map._getMap().removeSource(e),this.map._getMap().getSource(e)&&t)throw new Error("One or more layers have a dependency on the source '".concat(e,"'"));this.unsetSourceState(e)},n.prototype._addSource=function(e,t){if(this.sources.has(e.getId())){if(t)throw new Error("'".concat(e.getId(),"' is already added to the map"));this.unsetSourceState(e.getId())}if(t){if(!this.map._isReady())throw new Error("The source '".concat(e.getId(),"' could not be added to the map because ")+"the map is not ready. Please use a ready event listener to guarantee the map is ready before adding a source to it.");this.map._getMap().addSource(e.getId(),e._buildSource())}this.setSourceState(e)},n.prototype._mapFeaturesToShapes=function(e,t,r){var i,o,a=[];try{for(var l=uR(e),h=l.next();!h.done;h=l.next()){var p=h.value;if((r||typeof p.source=="string")&&typeof p.properties[Ci._shapeIdPropName]=="string"){var g=r||this.sources.get(p.source);if(g instanceof Es){var _=g.getShapeById(p.properties[Ci._shapeIdPropName]);if(_ instanceof Ci){a.push(_);continue}}}t||a.push(p)}}catch(x){i={error:x}}finally{try{h&&!h.done&&(o=l.return)&&o.call(l)}finally{if(i)throw i.error}}return a},n.prototype._syncSources=function(e){var t=this;e?(Object.keys(e).map(function(r){var i,o=e[r];switch(o.type){case"vector":case"raster":case"raster-dem":i=new L6(r,{name:r,tiles:o.tiles,type:o.type,url:o.url,tileSize:"tileSize"in o?o.tileSize:void 0});break;case"canvas":i=new A6(r,o);break;case"geojson":var a=new Es(r,{maxZoom:o.maxzoom,cluster:o.cluster,clusterRadius:o.clusterRadius,tolerance:o.tolerance,lineMetrics:o.lineMetrics,clusterProperties:o.clusterProperties,buffer:o.buffer,clusterMinPoints:o.clusterMinPoints,generateId:o.generateId,promoteId:o.promoteId,filter:o.filter});typeof o.data!="string"&&o.data!==void 0&&a._addNoUpdate(o.data),i=a;break;case"image":i=new u2(r,o);break;case"video":i=new P6(r,o);break;default:i=new I6(r,o)}return i}).forEach(function(r){var i=t.sources.get(r.getId()),o=i&&r._isDeepEqual(i);!o&&i&&t.unsetSourceState(i.getId()),t.setSourceState(r,!o)}),Array.from(this.sources.keys()).filter(function(r){return!(r in e)}).forEach(function(r){return t.unsetSourceState(r)})):console.warn("syncSources called with no style sources which is unexpected.")},n}(),Hxe=window&&window.__extends||function(){var n=function(e,t){return(n=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(r,i){r.__proto__=i}:function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])}))(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),Gxe=function(n){function e(){var t=n!==null&&n.apply(this,arguments)||this;return t.duration=1e3,t.type="jump",t}return Hxe(e,n),e}(ii),qxe=window&&window.__extends||function(){var n=function(e,t){return(n=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(r,i){r.__proto__=i}:function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])}))(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),$xe=function(n){function e(){var t=n!==null&&n.apply(this,arguments)||this;return t.bottom=0,t.left=0,t.right=0,t.top=0,t}return qxe(e,n),e}(ii),Wxe=window&&window.__extends||function(){var n=function(e,t){return(n=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(r,i){r.__proto__=i}:function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])}))(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),Yxe=window&&window.__values||function(n){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&n[e],r=0;if(t)return t.call(n);if(n&&typeof n.length=="number")return{next:function(){return{value:(n=n&&r>=n.length?void 0:n)&&n[r++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},Kxe=window&&window.__read||function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var r,i,o=t.call(n),a=[];try{for(;(e===void 0||0<e--)&&!(r=o.next()).done;)a.push(r.value)}catch(l){i={error:l}}finally{try{r&&!r.done&&(t=o.return)&&t.call(o)}finally{if(i)throw i.error}}return a},Zxe=window&&window.__spreadArray||function(n,e,t){if(t||arguments.length===2)for(var r,i=0,o=e.length;i<o;i++)!r&&i in e||((r=r||Array.prototype.slice.call(e,0,i))[i]=e[i]);return n.concat(r||Array.prototype.slice.call(e))},Xxe=function(n){function e(){var t=n!==null&&n.apply(this,arguments)||this;return t.bounds=[-180,-89,180,90],t.maxBounds=void 0,t.maxZoom=20,t.offset=new Go(0,0),t.padding=new $xe,t}return Wxe(e,n),e.prototype.merge=function(){for(var t,r,i=[],o=0;o<arguments.length;o++)i[o]=arguments[o];try{for(var a=Yxe(i),l=a.next();!l.done;l=a.next()){var h=l.value;h&&typeof h.padding=="number"&&(h.padding={top:h.padding,bottom:h.padding,left:h.padding,right:h.padding})}}catch(p){t={error:p}}finally{try{l&&!l.done&&(r=a.return)&&r.call(a)}finally{if(t)throw t.error}}return n.prototype.merge.apply(this,Zxe([],Kxe(i),!1))},e}(ii),Qxe=window&&window.__extends||function(){var n=function(e,t){return(n=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(r,i){r.__proto__=i}:function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])}))(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),Jxe=function(n){function e(){var t=n!==null&&n.apply(this,arguments)||this;return t.zoom=1,t.center=new $o(0,0),t.centerOffset=new Go(0,0),t.bearing=0,t.pitch=0,t.minZoom=1,t.maxZoom=20,t.minPitch=0,t.maxPitch=60,t.maxBounds=void 0,t}return Qxe(e,n),e}(ii),eEe=window&&window.__extends||function(){var n=function(e,t){return(n=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(r,i){r.__proto__=i}:function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])}))(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),E0=function(n){function e(){var t=n!==null&&n.apply(this,arguments)||this;return t.name=void 0,t.before=void 0,t.minZoom=1,t.maxZoom=20,t.overwrite=!1,t.opacity=1,t}return eEe(e,n),e}(ii),tEe=window&&window.__extends||function(){var n=function(e,t){return(n=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(r,i){r.__proto__=i}:function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])}))(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),nEe=function(n){function e(){var t=n!==null&&n.apply(this,arguments)||this;return t.color="rgba(0,0,0,.5)",t.outlineColor="#000",t.radius=1,t.outlineWidth=5,t.name="default-circles",t}return tEe(e,n),e}(E0),rEe=window&&window.__extends||function(){var n=function(e,t){return(n=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(r,i){r.__proto__=i}:function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])}))(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),iEe=function(n){function e(){var t=n!==null&&n.apply(this,arguments)||this;return t.cap="butt",t.join="miter",t.name="default-linestrings",t.color="#000",t.width=1,t}return rEe(e,n),e}(E0),oEe=window&&window.__extends||function(){var n=function(e,t){return(n=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(r,i){r.__proto__=i}:function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])}))(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),aEe=function(n){function e(){var t=n!==null&&n.apply(this,arguments)||this;return t.iconSize=1,t.fontSize=14,t.fontColor="#000",t.textFont="SegoeUi-Regular",t.cluster=!0,t.clusterIcon=void 0,t.textOffset=[0,0],t.name="default-pins",t.icon="pin-darkblue",t.title="",t}return oEe(e,n),e}(E0),sEe=window&&window.__extends||function(){var n=function(e,t){return(n=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(r,i){r.__proto__=i}:function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])}))(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),cEe=function(n){function e(){var t=n!==null&&n.apply(this,arguments)||this;return t.color="rgba(0,0,0,.5)",t.outlineColor="#000",t.name="default-polygons",t}return sEe(e,n),e}(E0),lEe=window&&window.__extends||function(){var n=function(e,t){return(n=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(r,i){r.__proto__=i}:function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])}))(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),uEe=function(n){function e(){var t=n!==null&&n.apply(this,arguments)||this;return t.name="default-raster",t}return lEe(e,n),e}(E0),hEe=window&&window.__extends||function(){var n=function(e,t){return(n=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(r,i){r.__proto__=i}:function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])}))(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),dEe=function(n){function e(){var t=n!==null&&n.apply(this,arguments)||this;return t.anchor="map",t.color="#FFFFFF",t.intensity=.5,t.position=[1.15,210,30],t}return hEe(e,n),e}(ii),fEe=window&&window.__extends||function(){var n=function(e,t){return(n=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(r,i){r.__proto__=i}:function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])}))(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),pEe=window&&window.__values||function(n){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&n[e],r=0;if(t)return t.call(n);if(n&&typeof n.length=="number")return{next:function(){return{value:(n=n&&r>=n.length?void 0:n)&&n[r++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},gEe=window&&window.__read||function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var r,i,o=t.call(n),a=[];try{for(;(e===void 0||0<e--)&&!(r=o.next()).done;)a.push(r.value)}catch(l){i={error:l}}finally{try{r&&!r.done&&(t=o.return)&&t.call(o)}finally{if(i)throw i.error}}return a},mEe=window&&window.__spreadArray||function(n,e,t){if(t||arguments.length===2)for(var r,i=0,o=e.length;i<o;i++)!r&&i in e||((r=r||Array.prototype.slice.call(e,0,i))[i]=e[i]);return n.concat(r||Array.prototype.slice.call(e))},x9=function(n){function e(){var t=n!==null&&n.apply(this,arguments)||this;return t.antialias=void 0,t.autoResize=!0,t.language=pF(),t.light=new dEe,t.preserveDrawingBuffer=!1,t.progressiveLoading=!1,t.progressiveLoadingInitialLayerGroups=["base"],t.renderWorldCopies=!0,t.showBuildingModels=!1,t.showFeedbackLink=!0,t.showLogo=!0,t.showLabels=!0,t.customAttribution=void 0,t.showTileBoundaries=!1,t.style=void 0,t.view=yF(),t.userRegion=t.view,t.styleOverrides=void 0,t.customStyleTransform=void 0,t}return fEe(e,n),e.prototype.merge=function(){for(var t,r,i=[],o=0;o<arguments.length;o++)i[o]=arguments[o];try{for(var a=pEe(i),l=a.next();!l.done;l=a.next()){var h=l.value;h&&(h.hasOwnProperty("view")?h.userRegion=h.view:h.hasOwnProperty("userRegion")&&(h.view=h.userRegion),typeof h.language=="string")&&(h.language=z1.getCode(h.language))}}catch(p){t={error:p}}finally{try{l&&!l.done&&(r=a.return)&&r.call(a)}finally{if(t)throw t.error}}return n.prototype.merge.apply(this,mEe([],gEe(i),!1))},e}(ii),yEe=window&&window.__extends||function(){var n=function(e,t){return(n=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(r,i){r.__proto__=i}:function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])}))(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),T0=window&&window.__assign||function(){return(T0=Object.assign||function(n){for(var e,t=1,r=arguments.length;t<r;t++)for(var i in e=arguments[t])Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i]);return n}).apply(this,arguments)},_Ee=window&&window.__values||function(n){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&n[e],r=0;if(t)return t.call(n);if(n&&typeof n.length=="number")return{next:function(){return{value:(n=n&&r>=n.length?void 0:n)&&n[r++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},S0=window&&window.__read||function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var r,i,o=t.call(n),a=[];try{for(;(e===void 0||0<e--)&&!(r=o.next()).done;)a.push(r.value)}catch(l){i={error:l}}finally{try{r&&!r.done&&(t=o.return)&&t.call(o)}finally{if(i)throw i.error}}return a},C0=window&&window.__spreadArray||function(n,e,t){if(t||arguments.length===2)for(var r,i=0,o=e.length;i<o;i++)!r&&i in e||((r=r||Array.prototype.slice.call(e,0,i))[i]=e[i]);return n.concat(r||Array.prototype.slice.call(e))},hR=function(n){return n.length==0?void 0:n.slice(1).reduce(function(e,t){return function(r,i){return r=e(r,i),T0(T0({},r),t(r.url,i))}},n[0])},dR=function(n){function e(){var t=n!==null&&n.apply(this,arguments)||this;return t.authOptions=sF(),t.disableTelemetry=!0,t["disable-telemetry"]=t.disableTelemetry,t.domain=MA(),t.staticAssetsDomain=cF(),t.styleDefinitionsPath=lF(),t.styleDefinitionsVersion=uF(),t.styleAPIVersion=hF(),t.mapConfiguration=void 0,t.styleSet=void 0,t.enableAccessibility=!0,t["enable-accessibility"]=t.enableAccessibility,t.enableAccessibilityLocationFallback=!0,t.maxParallelImageRequests=fF(),t.refreshExpiredTiles=!0,t.subscriptionKey=mF(),t["subscription-key"]=t.subscriptionKey,t.sessionId=gF(),t["session-id"]=t.sessionId,t._transformers=[],t.transformRequest=void 0,t.workerCount=dF(),t.fadeDuration=300,t.localIdeographFontFamily="sans-serif",t.validateStyle=!1,t}return yEe(e,n),e.prototype.merge=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var i=this.styleDefinitionsVersion;try{for(var o=_Ee(t),a=o.next();!a.done;a=o.next()){var l=a.value;l&&(l.authOptions?typeof l.authOptions.subscriptionKey=="string"&&(l.subscriptionKey=l["subscription-key"]=l.authOptions.subscriptionKey):typeof l.subscriptionKey=="string"?(l["subscription-key"]=l.subscriptionKey,l.authOptions={authType:ri.subscriptionKey,subscriptionKey:l.subscriptionKey}):typeof l["subscription-key"]=="string"&&(l.subscriptionKey=l["subscription-key"],l.authOptions={authType:ri.subscriptionKey,subscriptionKey:l["subscription-key"]}),typeof l.sessionId=="string"?l["session-id"]=l.sessionId:typeof l["session-id"]=="string"&&(l.sessionId=l["session-id"]),typeof l.disableTelemetry=="boolean"?l["disable-telemetry"]=l.disableTelemetry:typeof l["disable-telemetry"]=="boolean"&&(l.disableTelemetry=l["disable-telemetry"]),typeof l.enableAccessibility=="boolean"?l["enable-accessibility"]=l.enableAccessibility:typeof l["enable-accessibility"]=="boolean"&&(l.enableAccessibility=l["enable-accessibility"]))}}catch(x){p={error:x}}finally{try{a&&!a.done&&(g=o.return)&&g.call(o)}finally{if(p)throw p.error}}var h=this._transformers,g=t?t.filter(function(x){return x!==void 0}).reduce(function(x,C){return C0(C0([],S0(x),!1),S0(C._transformers||[]),!1)},[]):[],p=n.prototype.merge.apply(this,C0([],S0(t),!1)),g=(p.authOptions.authType!==ri.subscriptionKey&&(p["subscription-key"]=p.subscriptionKey=void 0),p.styleSet!==void 0&&p.mapConfiguration===void 0&&(p.mapConfiguration=p.styleSet),p.mapConfiguration&&typeof p.mapConfiguration!="string"&&(p.mapConfiguration=T0(T0({},p.mapConfiguration),{defaultConfiguration:p.mapConfiguration.defaultConfiguration||p.mapConfiguration.defaultStyle,configurations:p.mapConfiguration.configurations||p.mapConfiguration.styles})),this._transformers=C0(C0([],S0(h||[]),!1),S0(g.filter(function(x){return!h.includes(x)})),!1),this.transformRequest&&!this._transformers.includes(this.transformRequest)&&this._transformers.push(this.transformRequest),new Date(Date.UTC(2023,0))),_=new Date(this.styleDefinitionsVersion);return(isNaN(_.getTime())||_.getTime()<g.getTime())&&(console.warn("Style definition version ".concat(this.styleDefinitionsVersion," is invalid or deprecated, style definition version is unchanged (").concat(i,")")),this.styleDefinitionsVersion=i),this.transformRequest=hR(this._transformers),p},e.prototype.addTransformer=function(t){this._transformers||(this._transformers=[]),this._transformers.push(t),this.transformRequest=hR(this._transformers)},e.prototype.removeTransformer=function(t){this._transformers&&(this._transformers=this._transformers.filter(function(r){return t!==r}),this.transformRequest=hR(this._transformers))},e._cloneCustomizer=function(t){if(typeof t=="object")return Object.assign({},t)},e}(ii),vEe=function(){function n(){}return n.getLayerGroup=function(e){return typeof e!="string"&&e.metadata&&e.metadata["microsoft.maps:layerGroup"]?e.metadata["microsoft.maps:layerGroup"]:(e=typeof e!="string"?e.id:e).startsWith("microsoft.")&&4<=(e=e.split(".")).length?e[3]:void 0},n}(),DE=function(){function n(e){var t=this;this.isHijacked=function(){return t._hijackedToResolve!==void 0||t._hijackedToReject!==void 0},this.isResolved=function(){return t._hijackedToResolve!==void 0||t._toResolve!==void 0},this.isRejected=function(){return t._hijackedToReject!==void 0||t._toReject!==void 0},this.resultIfResolved=function(){return t._hijackedToResolve||t._toResolve},this.errorIfRejected=function(){return t._hijackedToReject||t._toReject},this._thenResolver=function(r,i){var o;t._hijackedToResolve?r(t._hijackedToResolve):t._hijackedToReject?i(t._hijackedToReject):(o=t.origin,t.origin.then(function(a){t.isHijacked()||(o!==t.origin?t._thenResolver(r,i):(t._toResolve=a,r(a)))}).catch(function(a){t.isHijacked()||(o!==t.origin?t._thenResolver(r,i):(t._toReject=a,i(a)))}))},this.origin=e,this[Symbol.toStringTag]=this.origin[Symbol.toStringTag]}return n.resolve=function(e){return new n(Promise.resolve(e))},n.reject=function(e){return new n(Promise.reject(e))},n.prototype.then=function(e,t){var r=this;return new Promise(function(i,o){r._resolve=i,r._reject=o,r._thenResolver(i,o)}).then(e,t)},n.prototype.catch=function(e){var t=this;return new Promise(function(r,i){t._resolve=r,t._reject=i,t._thenResolver(r,i)}).catch(e)},n.prototype.finally=function(e){var t=this;return new Promise(function(r,i){t._resolve=r,t._reject=i,t._thenResolver(r,i)}).finally(e)},n.prototype.hijackAndResolve=function(e){this._hijackedToResolve=e,this._resolve&&this._resolve(e)},n.prototype.hijackAndReject=function(e){this._hijackedToReject=e,this._reject&&this._reject(e)},n.prototype.switchWith=function(e){this.origin=e,this._toResolve=void 0,this._toReject=void 0},n}(),E9={road:"Road",satellite:"Satellite",satellite_road_labels:"Hybrid",grayscale_dark:"Grayscale (Dark)",grayscale_light:"Grayscale (Light)",night:"Night",road_shaded_relief:"Terra",blank:"Blank",blank_accessible:"Blank (Accessible)",high_contrast_dark:"High contrast (Dark)",high_contrast_light:"High contrast (Light)"},Mc=window&&window.__assign||function(){return(Mc=Object.assign||function(n){for(var e,t=1,r=arguments.length;t<r;t++)for(var i in e=arguments[t])Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i]);return n}).apply(this,arguments)},fR=window&&window.__awaiter||function(n,e,t,r){return new(t=t||Promise)(function(i,o){function a(p){try{h(r.next(p))}catch(g){o(g)}}function l(p){try{h(r.throw(p))}catch(g){o(g)}}function h(p){var g;p.done?i(p.value):((g=p.value)instanceof t?g:new t(function(_){_(g)})).then(a,l)}h((r=r.apply(n,e||[])).next())})},pR=window&&window.__generator||function(n,e){var t,r,i,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]},a={next:l(0),throw:l(1),return:l(2)};return typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function l(h){return function(p){var g=[h,p];if(t)throw new TypeError("Generator is already executing.");for(;o=a&&g[a=0]?0:o;)try{if(t=1,r&&(i=2&g[0]?r.return:g[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,g[1])).done)return i;switch(r=0,(g=i?[2&g[0],i.value]:g)[0]){case 0:case 1:i=g;break;case 4:return o.label++,{value:g[1],done:!1};case 5:o.label++,r=g[1],g=[0];continue;case 7:g=o.ops.pop(),o.trys.pop();continue;default:if(!(i=0<(i=o.trys).length&&i[i.length-1])&&(g[0]===6||g[0]===2)){o=0;continue}if(g[0]===3&&(!i||g[1]>i[0]&&g[1]<i[3]))o.label=g[1];else if(g[0]===6&&o.label<i[1])o.label=i[1],i=g;else{if(!(i&&o.label<i[2])){i[2]&&o.ops.pop(),o.trys.pop();continue}o.label=i[2],o.ops.push(g)}}g=e.call(n,o)}catch(_){g=[6,_],r=0}finally{t=i=0}if(5&g[0])throw g[1];return{value:g[0]?g[1]:void 0,done:!0}}}},Zh=window&&window.__read||function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var r,i,o=t.call(n),a=[];try{for(;(e===void 0||0<e--)&&!(r=o.next()).done;)a.push(r.value)}catch(l){i={error:l}}finally{try{r&&!r.done&&(t=o.return)&&t.call(o)}finally{if(i)throw i.error}}return a},gR=window&&window.__spreadArray||function(n,e,t){if(t||arguments.length===2)for(var r,i=0,o=e.length;i<o;i++)!r&&i in e||((r=r||Array.prototype.slice.call(e,0,i))[i]=e[i]);return n.concat(r||Array.prototype.slice.call(e))},bEe=window&&window.__values||function(n){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&n[e],r=0;if(t)return t.call(n);if(n&&typeof n.length=="number")return{next:function(){return{value:(n=n&&r>=n.length?void 0:n)&&n[r++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},FE={countryRegion:"cr|bv:0",adminDistrict:"ad|bv:0",adminDistrict2:"ds|bv:0",buildingFootprint:"bld|v:0_adr|lv:0",roadDetails:"g|rasterDetailsVisible:0"},wEe=function(){function n(e,t){var r=this;this.definitions=function(){var i=r.initPromise||r.initStyleset();return i},this.indoorState=void 0,this.preservedPreindoorMapConfiguration=void 0,this._progressiveLoadingState={mapStyle:void 0,pendingVisibilityChange:void 0},this._deferLayerGroupVisibilities=function(i,o){var a,l,h,p,g=o.filter(function(_){return _ in i});g.length!==0&&(a=r.map._getMap(),l=a.getZoom(),h=r.map.getStyle().style,r._progressiveLoadingState.pendingVisibilityChange&&(r.map.events.remove("load",r._progressiveLoadingState.pendingVisibilityChange),r._progressiveLoadingState.pendingVisibilityChange=null),r._progressiveLoadingState.mapStyle=h,(p=Object.entries(i).reduce(function(_,M){var M=Zh(M,2),C=M[0],M=M[1],L=g.includes(C);return gR(gR([],Zh(_),!1),Zh(M.filter(function(F){if(F.type==="custom")return!1;if(L){if(typeof F.maxzoom=="number"&&typeof F.minzoom=="number"){if(l<=F.maxzoom&&l>=F.minzoom)return!1}else if(typeof F.minzoom=="number"){if(l>=F.minzoom)return!1}else if(typeof F.maxzoom!="number"||l<=F.maxzoom)return!1}return((F=F.layout)==null?void 0:F.visibility)!=="none"})),!1)},[])).forEach(function(_){_.layout=_.layout||{},_.layout.visibility="none"}),r._progressiveLoadingState.pendingVisibilityChange=function(){r._progressiveLoadingState.pendingVisibilityChange=null;var _=r.map.getStyle().style;h===_&&(p.forEach(function(x){x.layout.visibility="visible",a.setLayoutProperty(x.id,"visibility","visible")}),(_=r.map.copyrightDelegate)!=null)&&_.reloadAttribution()},r.map.events.addOnce("load",r._progressiveLoadingState.pendingVisibilityChange))},this._onStyleData=function(i){r.map.events.invoke("stylechanged",{style:i.name,map:r.map,type:"stylechanged"})},this._lookUp=function(i){var o,a,p=r.definitions(),l=p.errorIfRejected(),h=p.resultIfResolved();if(l||!h)return null;var p=h.configurations,g=void 0;try{for(var _=bEe(p),x=_.next();!x.done;x=_.next()){var C=x.value;if(C.name===i.style)return C;C.name===h.defaultConfiguration&&(g=g||C)}}catch(M){o={error:M}}finally{try{x&&!x.done&&(a=_.return)&&a.call(_)}finally{if(o)throw o.error}}return g=g||p[0]},this._lookUpAsync=function(i){return fR(r,void 0,void 0,function(){var o;return pR(this,function(a){switch(a.label){case 0:return[4,this.definitions()];case 1:return o=a.sent(),[2,o.configurations.find(function(l){return l.name===(i.style||o.defaultConfiguration)})||o.configurations.find(function(l){return l.name===o.defaultConfiguration})||o.configurations[0]]}})})},this.map=e,this.serviceOptions=t}return n.prototype.updateIndoorState=function(e,t){var r,i,o=this,a=this.map.styles.getMapConfiguration();a?(this.preservedPreindoorMapConfiguration=a,r=this.map.getStyle().style?"".concat(this.map.getStyle().style,"_indoor").concat(e==="dark"?"_dark":"","_tileset_").concat(t):void 0,this.map.styles.setMapConfiguration("defaultIndoor_".concat(t),a==="microsoft-maps:default"?r:void 0)):(i=((a=this.indoorState)==null?void 0:a.tilesetId)!==t,this.indoorState={tilesetId:t,theme:e},this.initStyleset(),this.definitions().then(function(l){var p=(o.map.getStyle().style||l.defaultConfiguration).replace("_indoor_dark","").replace("_indoor",""),h="".concat(p,"_indoor"),p=l.configurations.find(function(g){return g.name.startsWith(h)});p&&o.map.setStyle({style:p.name},!i)}))},n.prototype.unsetIndoorState=function(){var e=this,t=this.preservedPreindoorMapConfiguration;t?this.map.styles.setMapConfiguration(t):(this.indoorState=void 0,this.initStyleset(),this.definitions().then(function(r){var i=e.map.getStyle().style;i.includes("_indoor")&&i.split("_indoor")[0]?e.map.setStyle({style:i.split("_indoor")[0]}):e.map.setStyle({style:void 0})}))},n.prototype.initStyleset=function(){var e,t=this;return e=this.serviceOptions.mapConfiguration?typeof this.serviceOptions.mapConfiguration=="string"?(e=this.map.authentication?this.map.authentication.initialize():Promise.resolve(),new DE(e.then(function(){return t._request(t.serviceOptions.domain,"".concat(Nn.styleResourcePath,"/mapconfigurations/metadata/").concat(t.serviceOptions.mapConfiguration),"StyleDefinitions").then(function(r){return Mc(Mc({},r),{defaultConfiguration:r.defaultConfiguration||r.defaultStyle,configurations:r.configurations||r.styles})})}))):DE.resolve(this.serviceOptions.mapConfiguration):(e=this.map.authentication?this.map.authentication.initialize():Promise.resolve(),new DE(e.then(function(){return t._request(t.serviceOptions.staticAssetsDomain,"".concat(Nn.stylePath,"/").concat(Nn.styleResourcePath),"StyleDefinitions",{version:t.serviceOptions.styleDefinitionsVersion,mcv:ah.replace(/\./g,"")}).then(function(r){return{version:isNaN(r.version)?0:parseFloat(r.version),defaultConfiguration:r.defaultStyle,configurations:r.styles.filter(function(i){return t.indoorState?t.indoorState.theme==="auto"?i.name.endsWith(i.theme==="dark"?"_indoor_dark":"_indoor"):i.name.endsWith(t.indoorState.theme==="dark"?"_indoor_dark":"_indoor"):!i.name.includes("indoor")}).map(function(i){return{copyright:i.copyright.join(" "),name:i.name,displayName:function(o){return o=t.indoorState&&o.includes("_indoor")?o.split("_indoor")[0]:o,o in E9?E9[o]:o}(i.name),theme:i.theme,thumbnail:new Zc({domain:t.serviceOptions.staticAssetsDomain,path:i.thumbnail,protocol:"https"}).toString(),url:new Zc({domain:t.serviceOptions.staticAssetsDomain,path:"".concat(Nn.stylePath,"/").concat(Nn.styleResourcePath,"/").concat(i.name),queryParams:{styleVersion:r.version!==void 0&&r.version!==null?r.version:t.serviceOptions.styleDefinitionsVersion,mcv:ah.replace(/\./g,"")},protocol:"https"}).toString()}})}})}))),this.initPromise&&this.initPromise.switchWith(e),this.initPromise=e,this.initPromise.then(function(r){return t.map._invokeEvent("mapconfigurationchanged",r)}),this.initPromise},n.prototype.getStyle=function(e){if(e=this._lookUp(e),!e)throw Error("Style definition is not available.");if(e.url)return e.url;if(e.style)return e.style;throw Error("Style definition neither contains URL nor style object.")},n.prototype.deriveNewStyleAndLayerGroups=function(e,t){for(var r,i,o=this.map.getStyle(),a=this.map.getTraffic(),l={},h=0;h<t.layers.length;h++){var p=t.layers[h],g=vEe.getLayerGroup(p);g?(l[g]||(l[g]=[]),l[g].push(p),o.showBuildingModels||p.type!=="fill-extrusion"?p.type==="fill-extrusion"&&(p.layout=(r=p.layout)!=null?r:{},p.layout.visibility="visible"):(p.layout=(r=p.layout)!=null?r:{},p.layout.visibility="none"),a.flow!=="none"&&g&&g==="traffic_".concat(a.flow)&&p.type=="line"&&(p.layout=(i=p.layout)!=null?i:{},p.layout.visibility="visible"),g!=="labels"&&g!=="labels_places"&&g!=="labels_indoor"||p.type!=="symbol"||(o.showLabels&&((i=p.layout)==null?void 0:i.visibility)!=="none"?(p.layout=(g=p.layout)!=null?g:{},p.layout.visibility="visible"):(p.layout=(g=p.layout)!=null?g:{},p.layout.visibility="none"))):l[p.id]=[p]}return[t,l]},n.prototype.injectUserLayersIntoStyle=function(e,t,r){return e?this.map.layers._getUserLayers().reduce(function(i,o){var a,l,h,p;return o.layer instanceof N6||(a=((l=(l=r==null?void 0:r[o.before])==null?void 0:l[0])==null?void 0:l.id)||o.before,l=e.layers.find(function(g){return g.id===o.layer.getId()}),-1<(h=t.layers.findIndex(function(g){return g.id===o.layer.getId()}))&&t.layers.splice(h,1),l&&(h=new Set(Array.from(o.layer._getSourceIds()).map(function(g){var _;return!i.sources[g]&&(_=e.sources[g])?{source:_,id:g}:void 0}).filter(function(g){return g!==void 0})),-1<(p=a?i.layers.findIndex(function(g){return g.id===a}):-1)?i.layers.splice(p,0,l):i.layers.push(l),h.forEach(function(x){var _=x.source,x=x.id;i.sources[x]=_}))),i},Mc({},t)):t},n.prototype.setStyle=function(e,t){var r=this,i=(t===void 0&&(t=!0),this._lookUp(e));if(!i)throw Error("Style definition ".concat(e.style," is not available."));if(!i.url&&!i.style)throw Error("Style definition neither contains URL nor style object.");var o,a,l,h=function(){return r._onStyleData(i)},p=function(){r.map.events.remove("styledata",h),r.map.events.addOnce("styledata",h)},g=e&&e.customStyleTransform?function(x,C){return x=e.customStyleTransform(x,C),p(),x}:function(F,M){var z=Mc(Mc({},M),{layers:gR([],Zh(M.layers),!1),sources:Mc({},M.sources)}),L=e.progressiveLoading&&!r.map._isLoaded(),M=(L&&Array.isArray(M==null?void 0:M.layers)&&((z=Mc({},M)).layers=z.layers.map(function(ee){var ce=Mc({},ee);return ee.layout&&(ce.layout=Mc({},ee.layout)),ce})),Zh(r.deriveNewStyleAndLayerGroups(F,z),2)),z=M[0],M=M[1],L=(L&&(L=e.progressiveLoadingInitialLayerGroups,Array.isArray(L))&&0<L.length&&r._deferLayerGroupVisibilities(M,L),r.injectUserLayersIntoStyle(F,z,M)),F=Object.entries(M).map(function(se){var se=Zh(se,2),ce=se[0],se=se[1];return r._buildFundamentalLayerFrom(se,ce)}),z=r.map.layers._getUserLayers().reduce(function(ee,ce){var se=ce.before?ee.findIndex(function(_e){return _e.getId()===ce.before}):-1;return-1<se?ee.splice(se,0,ce.layer):ee.push(ce.layer),ee},F);return r.map.layers.layerIndex=z,r.map.sources._syncSources(L.sources),p(),L},_=i.url;_&&e!=null&&e.styleOverrides&&(o=new URL(_),a=new URLSearchParams(o.search),0<(l=Object.entries(e==null?void 0:e.styleOverrides).filter(function(M){var M=Zh(M,2),C=M[0],M=M[1];return C in FE&&(FE[C].includes("bv")&&(M==null?void 0:M.borderVisible)===!1||!FE[C].includes("bv")&&(M==null?void 0:M.visible)===!1)}).map(function(C){var C=Zh(C,2),M=C[0];return C[1],FE[M]})).length)&&(a.set("st",l.join("_")),o.search=a.toString(),_=o.toString()),this.map._getMap().setStyle(_||i.style,{diff:t,validate:this.serviceOptions.validateStyle,transformStyle:g})},n.prototype.getTheme=function(e){if(e=this._lookUp(e),e)return e.theme.toLowerCase()},n.prototype.getThemeAsync=function(e){return fR(this,void 0,void 0,function(){return pR(this,function(t){switch(t.label){case 0:return[4,this._lookUpAsync(e)];case 1:return[2,t.sent().theme]}})})},n.prototype.setMapConfiguration=function(e,t){var r=this;typeof(this.serviceOptions.mapConfiguration=e)=="string"?this.initStyleset():this.initPromise?this.initPromise.hijackAndResolve(e):this.initPromise=DE.resolve(e),this.definitions().then(function(i){var o=i.defaultConfiguration;i.configurations.find(function(a){return a.name===t})&&(o=t),r.map.setStyle({style:o})})},n.prototype.getMapConfiguration=function(){return this.serviceOptions.mapConfiguration},n.prototype.setStyleSet=function(e){this.updateIndoorState(e==="indoor_dark"?"dark":"light",null)},n.prototype.getStyleSet=function(){return this.indoorState!==void 0?this.indoorState.theme==="dark"?"indoor_dark":"indoor":"base"},n.prototype.clearStyleSet=function(){this.unsetIndoorState()},n.prototype._buildFundamentalLayerFrom=function(e,t){if(e&&0<e.length)return(e=new Kh(e,t)).onAdd(this.map),e;throw new Error("Unable to construct fundamental map layer for ID: ".concat(t,"."))},n.prototype._transformStyleRequest=function(e,t){e.includes(Nn.domainPlaceHolder)&&(t.url=t.url.replace(Nn.domainPlaceHolder,this.serviceOptions.domain)),e.includes(Nn.stylePathHolder)&&(t.url=t.url.replace(Nn.stylePathHolder,Nn.stylePath)),e.includes(Nn.styleResourcePlaceholder)&&(t.url=t.url.replace(Nn.styleResourcePlaceholder,Nn.styleResourcePath)),(t.url.toLocaleLowerCase().includes(this.serviceOptions.domain.toLocaleLowerCase())||t.url.toLocaleLowerCase().includes(this.serviceOptions.staticAssetsDomain.toLocaleLowerCase()))&&((e=new URL(t.url)).searchParams.get(Nn.apiVersionQueryParameter)||(e.searchParams.set(Nn.apiVersionQueryParameter,this.serviceOptions.styleAPIVersion),t.url=e.href),(e=this.map.authentication)!=null&&e.signRequest(t),this._deleteAuthTokenForStaticAssets(t))},n.prototype._request=function(e,t,r,i){var o;return i===void 0&&(i={}),fR(this,void 0,void 0,function(){var a,l;return pR(this,function(h){switch(h.label){case 0:return l={url:new Zc({protocol:"https",domain:e,path:t,queryParams:Mc(((l={})[Nn.apiVersionQueryParameter]=this.serviceOptions.styleAPIVersion,l),i)}).toString()},typeof this.serviceOptions.transformRequest=="function"&&r&&(l=this.serviceOptions.transformRequest(l.url,r)),(o=this.map.authentication)!=null&&o.signRequest(l),this._deleteAuthTokenForStaticAssets(l),a={method:"GET",mode:"cors"},l.credentials&&(a.credentials=l.credentials),l.headers&&(a.headers=l.headers),[4,fetch(l.url,a).then(function(p){if(p.ok)return p.json();throw new Error("HTTP ".concat(p.status,": ").concat(p.statusText," "))})];case 1:return[2,h.sent()]}})})},n.prototype._deleteAuthTokenForStaticAssets=function(e){e.url.startsWith("https://".concat(this.serviceOptions.staticAssetsDomain,"/").concat(Nn.stylePath))&&(delete e.headers[Nn.msClientIdHeaderName],delete e.headers[Nn.authorizationHeaderName])},n}(),xEe=function(){return"ENVIRONMENT"in window&&!!window.ENVIRONMENT.hmr},T9=window&&window.__values||function(n){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&n[e],r=0;if(t)return t.call(n);if(n&&typeof n.length=="number")return{next:function(){return{value:(n=n&&r>=n.length?void 0:n)&&n[r++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},EEe=function(){function n(e){this.map=e,this.indicators=new Set}return n.prototype.add=function(e){var t,r;e=Array.isArray(e)?e:[e];try{for(var i=T9(e),o=i.next();!o.done;o=i.next()){var a=o.value;this.indicators.has(a)||(this.indicators.add(a),a.attach(this.map))}}catch(l){t={error:l}}finally{try{o&&!o.done&&(r=i.return)&&r.call(i)}finally{if(t)throw t.error}}},n.prototype.clear=function(){var e=this;this.indicators.forEach(function(t){e.indicators.delete(t),t.remove()})},n.prototype.remove=function(e){var t,r;e=Array.isArray(e)?e:[e];try{for(var i=T9(e),o=i.next();!o.done;o=i.next()){var a=o.value;this.indicators.has(a)&&(this.indicators.delete(a),a.remove())}}catch(l){t={error:l}}finally{try{o&&!o.done&&(r=i.return)&&r.call(i)}finally{if(t)throw t.error}}},n.prototype.getIndicators=function(){return Array.from(this.indicators)},n.prototype._getCollectionDiv=function(){var e=this.map.getMapContainer().querySelector(".".concat(n.Css.collection));return e||((e=document.createElement("div")).setAttribute("aria-label","map data"),e.setAttribute("role","listbox"),e.classList.add(n.Css.collection),this.map.getMapContainer().appendChild(e)),e},n.Css={collection:"accessible-indicator-collection-container"},n}(),TEe=window&&window.__extends||function(){var n=function(e,t){return(n=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(r,i){r.__proto__=i}:function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])}))(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),Tu=window&&window.__assign||function(){return(Tu=Object.assign||function(n){for(var e,t=1,r=arguments.length;t<r;t++)for(var i in e=arguments[t])Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i]);return n}).apply(this,arguments)},SEe=window&&window.__awaiter||function(n,e,t,r){return new(t=t||Promise)(function(i,o){function a(p){try{h(r.next(p))}catch(g){o(g)}}function l(p){try{h(r.throw(p))}catch(g){o(g)}}function h(p){var g;p.done?i(p.value):((g=p.value)instanceof t?g:new t(function(_){_(g)})).then(a,l)}h((r=r.apply(n,e||[])).next())})},CEe=window&&window.__generator||function(n,e){var t,r,i,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]},a={next:l(0),throw:l(1),return:l(2)};return typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function l(h){return function(p){var g=[h,p];if(t)throw new TypeError("Generator is already executing.");for(;o=a&&g[a=0]?0:o;)try{if(t=1,r&&(i=2&g[0]?r.return:g[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,g[1])).done)return i;switch(r=0,(g=i?[2&g[0],i.value]:g)[0]){case 0:case 1:i=g;break;case 4:return o.label++,{value:g[1],done:!1};case 5:o.label++,r=g[1],g=[0];continue;case 7:g=o.ops.pop(),o.trys.pop();continue;default:if(!(i=0<(i=o.trys).length&&i[i.length-1])&&(g[0]===6||g[0]===2)){o=0;continue}if(g[0]===3&&(!i||g[1]>i[0]&&g[1]<i[3]))o.label=g[1];else if(g[0]===6&&o.label<i[1])o.label=i[1],i=g;else{if(!(i&&o.label<i[2])){i[2]&&o.ops.pop(),o.trys.pop();continue}o.label=i[2],o.ops.push(g)}}g=e.call(n,o)}catch(_){g=[6,_],r=0}finally{t=i=0}if(5&g[0])throw g[1];return{value:g[0]?g[1]:void 0,done:!0}}}},AEe=window&&window.__read||function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var r,i,o=t.call(n),a=[];try{for(;(e===void 0||0<e--)&&!(r=o.next()).done;)a.push(r.value)}catch(l){i={error:l}}finally{try{r&&!r.done&&(t=o.return)&&t.call(o)}finally{if(i)throw i.error}}return a},IEe=window&&window.__spreadArray||function(n,e,t){if(t||arguments.length===2)for(var r,i=0,o=e.length;i<o;i++)!r&&i in e||((r=r||Array.prototype.slice.call(e,0,i))[i]=e[i]);return n.concat(r||Array.prototype.slice.call(e))},BE=window&&window.__values||function(n){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&n[e],r=0;if(t)return t.call(n);if(n&&typeof n.length=="number")return{next:function(){return{value:(n=n&&r>=n.length?void 0:n)&&n[r++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},S9=function(n){function e(t,r){var i,o,a=n.call(this)||this,l=(a.removed=!1,a.loaded=!1,a.ready=!1,a._resizeCallback=function(){return a.resize()},!0);a._updateGlobalDefaults(r),a.serviceOptions=new dR().merge(r),a.styleOptions=new x9().merge(r),a.trafficOptions=new ew,a.styles=new wEe(a,a.serviceOptions),a.insights=new G1e(a.serviceOptions),a.serviceOptions.authOptions.subscriptionKey&&(a.serviceOptions.authOptions.subscriptionKey=encodeURIComponent(a.serviceOptions.authOptions.subscriptionKey)),i=a.serviceOptions.authOptions.clientId||(a.serviceOptions.authOptions.subscriptionKey?a.serviceOptions.authOptions.subscriptionKey.replace(/.(?=.{3,}$)/g,"*"):"invalid-setting"),a.insights&&a.insights.setAuthenticatedUserContext(a.serviceOptions.sessionId,i),arguments[2]&&xEe()?(o=arguments[2],a.ready=!0,a.loaded=!0):(i={antialias:a.styleOptions.antialias,attributionControl:!1,container:t,fadeDuration:a.serviceOptions.fadeDuration,localIdeographFontFamily:a.serviceOptions.localIdeographFontFamily,preserveDrawingBuffer:a.styleOptions.preserveDrawingBuffer,refreshExpiredTiles:a.serviceOptions.refreshExpiredTiles,renderWorldCopies:a.styleOptions.renderWorldCopies,trackResize:!1,transformRequest:function(_,x){var C={url:_};return x==="Tile"||x==="Source"?(_.includes(Nn.legacyDomainPlaceHolder)&&a.insights&&a.insights.trackEvent({name:"TileLoad"}),a._substituteDomainLanguageViewAndSignInRequest(_,C)):x!=="Style"&&x!=="SpriteJSON"&&x!=="SpriteImage"&&x!=="Glyphs"||a.styles._transformStyleRequest(_,C),a.serviceOptions.transformRequest&&j5(C,a.serviceOptions.transformRequest(C.url,x)),C}},o=new wa.Map(i));try{a.map=o,a.authentication=new Mxe(a),a.controls=new Rxe(a),a.events=new Oxe(a),a.imageSprite=new Nxe(a),a.layers=new zxe(a),a.markers=new Lxe(a),a.sources=new Vxe(a),a.popups=new jxe(a),a.indicators=new EEe(a),a.map.getContainer().classList.add(e.Css.container),a.map.getCanvasContainer().classList.add(e.Css.canvasContainer),a.map.getCanvas().classList.add(e.Css.canvas),a._detectHighContrast(),a.copyrightControl=new W1e({showFeedbackLink:a.styleOptions.showFeedbackLink,showLogo:a.styleOptions.showLogo,customAttribution:a.styleOptions.customAttribution}),a.controls.add(a.copyrightControl,{position:xa.NonFixed}),a.logoControl=new Z1e({showLogo:a.styleOptions.showLogo}),a.controls.add(a.logoControl,{position:xa.BottomLeft});var h=a.authentication?a.authentication.initialize():Promise.resolve();if(a.removed)return a;var p=function(){a.loaded=!0,a.map.off("load",p)},g=(a.map.on("load",p),function(){a.ready=!0,a.map.off("styledata",g),a.events.invoke("ready",{map:a,type:"ready"})});a.map.on("styledata",g),a._setAutoResize(a.styleOptions.autoResize),a.map.showTileBoundaries=a.styleOptions.showTileBoundaries,a.localizedStringsPromise=z1.getStrings(a.styleOptions.language),h.then(function(){return a.styles.definitions()}).then(function(_){if(!a.removed){if(a.authentication&&!a.authentication.getToken())throw new Error("AuthenticationManager finished initializing, but no token is available");a.serviceOptions["enable-accessibility"]&&a.accessibleMapDelegate.addToMap(),a._setStyleComponents(a.styleOptions),a.copyrightDelegate&&a.copyrightDelegate.addToMap()}}).catch(function(_){_=_ instanceof Error?_:new Error(_),a.insights.trackException({error:_}),_={map:a,type:"error",error:_},a.events.invoke("error",_)}),a.setCamera(Tu(Tu({minZoom:1},r),{type:"jump",duration:0})),a.incidentDelegate=new swe(a),a.flowDelegate=new rwe(a),a.accessibleMapDelegate=new nwe(a),a.userInteractionDelegate=new hwe(a,r),a.userInteractionDelegate.addToMap(),a.copyrightDelegate=new xwe(a,a.copyrightControl,a.styleOptions)}catch(_){throw l=!1,a.insights.trackException({error:_ instanceof Error?_:new Error(_)}),_}finally{a.insights.trackEvent({name:"MapLoad"},{success:l,supported:SA(),supportedWithPerformance:SA({failIfMajorPerformanceCaveat:!0})}),a.insights.flush()}return a}return TEe(e,n),Object.defineProperty(e.prototype,"isDisposed",{get:function(){return this.removed},enumerable:!1,configurable:!0}),e.prototype.getCanvas=function(){return this.map.getCanvas()},e.prototype.getCanvasContainer=function(){return this.map.getCanvasContainer()},e.prototype.getMapContainer=function(){return this.map.getContainer()},e.prototype.getServiceOptions=function(){return Cr(this.serviceOptions,dR._cloneCustomizer)},e.prototype.setServiceOptions=function(t){this.serviceOptions=new dR().merge(this.serviceOptions,t),this.serviceOptions["enable-accessibility"]?this.accessibleMapDelegate.addToMap():this.accessibleMapDelegate.removeFromMap(),t=this.styles.serviceOptions.mapConfiguration!==this.serviceOptions.mapConfiguration||this.styles.serviceOptions.staticAssetsDomain!==this.serviceOptions.staticAssetsDomain||this.styles.serviceOptions.styleDefinitionsVersion!==this.serviceOptions.styleDefinitionsVersion||this.styles.serviceOptions.domain!==this.serviceOptions.domain||this.styles.serviceOptions.styleAPIVersion!==this.serviceOptions.styleAPIVersion,this.styles.serviceOptions=this.serviceOptions,t&&(this.styles.initPromise=null,this.setStyle({}))},e.prototype.addRequestTransformer=function(t){this.serviceOptions.addTransformer(t)},e.prototype.removeRequestTransformer=function(t){this.serviceOptions.removeTransformer(t)},e.prototype.setCamera=function(t,r){if(r===void 0&&(r=!1),"padding"in t||"offset"in t||"bounds"in t){var i,l=new Xxe().merge({maxZoom:this.getCamera().maxZoom},t),o=this._generateSafeBounds(l.bounds),h={padding:l.padding,offset:l.offset,maxZoom:l.maxZoom};if(!(i=this.map.cameraForBounds(o,h)))throw a={message:"The map cannot be fit to the current canvas with the given CameraBoundsOptions.",containerWidth:(a=(a=this.map)==null?void 0:a.getContainer())==null?void 0:a.clientWidth,containerHeight:a==null?void 0:a.clientHeight,safeBounds:o,cameraForBoundsOptions:h},new Error(JSON.stringify(a));"pitch"in t&&(i.pitch=t.pitch),"bearing"in t&&(i.bearing=t.bearing),"minPitch"in t&&this.map.setMinPitch(t.minPitch),"maxPitch"in t&&this.map.setMaxPitch(t.maxPitch),"minZoom"in t&&this.map.setMinZoom(t.minZoom),o=this._generateSafeBounds(l.maxBounds)}else h=new Jxe().merge(this.getCamera(),t),h.centerOffset&&2<=h.centerOffset.length&&(a=h.centerOffset,(l=N_([h.center],h.zoom))[0][0]+=a[0],l[0][1]+=a[1],h.center=o2(l,h.zoom)[0]),i={center:h.center,zoom:h.zoom,bearing:h.bearing,pitch:h.pitch,around:void 0},h.minZoom<1&&console.warn("Setting minZoom below 1 may result in an empty map when the zoom level is less than 1."),this.map.setMinZoom(h.minZoom),this.map.setMaxZoom(h.maxZoom),h.minPitch&&this.map.setMinPitch(h.minPitch),h.maxPitch&&this.map.setMaxPitch(h.maxPitch),this._invokeEvent("minzoomchanged",this.map.getMinZoom()),this._invokeEvent("maxzoomchanged",this.map.getMaxZoom()),o=this._generateSafeBounds(h.maxBounds);o?this.map.setMaxBounds(o):this.map.setMaxBounds(null);var a=new Gxe().merge(t),l={duration:a.duration,easing:function(p){return p},offset:[0,0],animate:!0},h={fromControl:r};a.type==="jump"?this.map.jumpTo(i,h):a.type==="ease"?this.map.easeTo(Tu(Tu({},i),l),h):a.type==="fly"&&this.map.flyTo(Tu(Tu({},i),l),h)},e.prototype.setCameraBounds=function(t){this.setCamera(t)},e.prototype.getCamera=function(){var t=this.map.getBounds().getSouthWest().toArray(),r=this.map.getBounds().getNorthEast().toArray();return{zoom:this.map.getZoom(),center:this.map.getCenter().toArray(),bearing:this.map.getBearing(),pitch:this.map.getPitch(),bounds:new rr(t,r),minZoom:this.map.getMinZoom(),maxZoom:this.map.getMaxZoom(),maxBounds:(t=this.map.getMaxBounds())==null?void 0:t.toArray().flat()}},e.prototype.setStyle=function(t,r){r===void 0&&(r=!0),delete t.preserveDrawingBuffer,t=new x9().merge(this.styleOptions,t),t.autoResize!==this.styleOptions.autoResize&&this._setAutoResize(t.autoResize),t.language!==this.styleOptions.language&&(this.localizedStringsPromise=z1.getStrings(t.language)),t.renderWorldCopies!==this.styleOptions.renderWorldCopies&&this.map.setRenderWorldCopies(t.renderWorldCopies),t.showFeedbackLink!==this.styleOptions.showFeedbackLink&&this.copyrightControl.setOptions({showFeedbackLink:t.showFeedbackLink}),t.customAttribution!==this.styleOptions.customAttribution&&this.copyrightControl.setOptions({customAttribution:t.customAttribution}),t.showLogo!==this.styleOptions.showLogo&&(this.copyrightControl.setOptions({showLogo:t.showLogo}),this.logoControl.setOptions({showLogo:t.showLogo})),t.showTileBoundaries!==this.styleOptions.showTileBoundaries&&(this.map.showTileBoundaries=t.showTileBoundaries),t.showBuildingModels&&console.warn("showBuildingModels is deprecated."),r=r&&this.styleOptions.language===t.language&&this.styleOptions.view===t.view,this.styleOptions=t,this._setStyleComponents(t,r)},e.prototype.getStyle=function(){return Zi(this.styleOptions)},e.prototype.addIcon=function(t,r){this.imageSprite.add(t,r)},e.prototype.addPins=function(t,i){var i=new aEe().merge(i),o=this.layers.getLayerById(i.name),a=!1;if(o||(a=!0,o=new lw("".concat(i.name,"-source"),i.name,{source:"".concat(i.name,"-source"),minZoom:i.minZoom,maxZoom:i.maxZoom,iconOptions:{anchor:"center",size:i.iconSize,image:["case",["has","icon"],["get","icon"],i.icon],ignorePlacement:!i.cluster,opacity:i.opacity},textOptions:{anchor:"center",textField:["case",["has","point_count"],["to-string",["get","point_count"]],["has","title"],["to-string",["get","title"]],i.title],font:["case",["has","point_count"],["literal",["StandardFontCondensed-Bold"]],["literal",[i.textFont]]],size:["case",["has","point_count"],20,i.fontSize],ignorePlacement:!i.cluster,opacity:i.opacity,offset:["case",["has","point_count"],["literal",[.5,-.45]],["literal",[i.textOffset[0]/16,i.textOffset[1]/16]]],color:i.fontColor}})),!(o instanceof lw))throw new Error("A layer with name '".concat(i.name,"' already exists but it is not a SymbolLayer.")+"A SymbolLayer should be used for rendering pins.");var l=o.getSource(),h=(typeof l=="string"?(p=l,l=this.sources.getById(p)):p=l.getId(),!1);if(l||(h=!0,l=new Es(p,{cluster:i.cluster})),!(l instanceof Es))throw new Error("The source with name '".concat(p,"' already exists but it is not a DataSource.")+"New data can only be added to a DataSource.");h&&this.sources.add(l),a&&this.layers.add(o,i.before);var p=new Yd(t);i.overwrite?l.setShapes(p):l.add(p)},e.prototype.addCircles=function(t,i){var i=new nEe().merge(i),o=this.layers.getLayerById(i.name),a=!1;if(o||(a=!0,o=new h2("".concat(i.name,"-source"),i.name,{source:"".concat(i.name,"-source"),minZoom:i.minZoom,maxZoom:i.maxZoom,opacity:i.opacity,radius:["case",["has","radius"],["get","radius"],i.radius],color:["case",["has","color"],["get","color"],i.color],strokeColor:["case",["has","outlineColor"],["get","outlineColor"],i.outlineColor],strokeWidth:["case",["has","outlineWidth"],["get","outlineWidth"],i.outlineWidth]})),!(o instanceof h2))throw new Error("A layer with name '".concat(i.name,"' already exists but it is not a BubbleLayer.")+"A BubbleLayer should be used for rendering circles.");var l=o.getSource(),h=(typeof l=="string"?(p=l,l=this.sources.getById(p)):p=l.getId(),!1);if(l||(h=!0,l=new Es(p)),!(l instanceof Es))throw new Error("The source with name '".concat(p,"' already exists but it is not a DataSource.")+"New data can only be added to a DataSource.");h&&this.sources.add(l),a&&this.layers.add(o,i.before);var p=new Yd(t);i.overwrite?l.setShapes(p):l.add(p)},e.prototype.addLinestrings=function(t,i){var i=new iEe().merge(i),o=this.layers.getLayerById(i.name),a=!1;if(o||(a=!0,o=new d2("".concat(i.name,"-source"),i.name,{source:"".concat(i.name,"-source"),minZoom:i.minZoom,maxZoom:i.maxZoom,lineCap:i.cap,lineJoin:i.join,strokeOpacity:i.opacity,strokeColor:["case",["has","color"],["get","color"],i.color],strokeWidth:["case",["has","width"],["get","width"],i.width]})),!(o instanceof d2))throw new Error("A layer with name '".concat(i.name,"' already exists but it is not a LineLayer.")+"A LineLayer should be used for rendering linestrings.");var l=o.getSource(),h=(typeof l=="string"?(p=l,l=this.sources.getById(p)):p=l.getId(),!1);if(l||(h=!0,l=new Es(p)),!(l instanceof Es))throw new Error("The source with name '".concat(p,"' already exists but it is not a DataSource.")+"New data can only be added to a DataSource.");h&&this.sources.add(l),a&&this.layers.add(o,i.before);var p=new Yd(t);i.overwrite?l.setShapes(p):l.add(p)},e.prototype.addPolygons=function(t,i){var i=new cEe().merge(i),o=this.layers.getLayerById(i.name),a=!1;if(o||(a=!0,o=new f2("".concat(i.name,"-source"),i.name,{source:"".concat(i.name,"-source"),minZoom:i.minZoom,maxZoom:i.maxZoom,fillOpacity:i.opacity,fillColor:["case",["has","color"],["get","color"],i.color]})),!(o instanceof f2))throw new Error("A layer with name '".concat(i.name,"' already exists but it is not a PolygonLayer.")+"A PolygonLayer should be used for rendering linestrings.");var l=o.getSource(),h=(typeof l=="string"?(p=l,l=this.sources.getById(p)):p=l.getId(),!1);if(l||(h=!0,l=new Es(p)),!(l instanceof Es))throw new Error("The source with name '".concat(p,"' already exists but it is not a DataSource.")+"New data can only be added to a DataSource.");h&&this.sources.add(l),a&&this.layers.add(o,i.before);var p=new Yd(t);i.overwrite?l.setShapes(p):l.add(p)},e.prototype.addRaster=function(t,o){var i,o=new uEe().merge(o),a=this.layers.getLayerById(o.name);if(!((a=a||new hw({maxZoom:o.maxZoom,minZoom:o.minZoom,opacity:o.opacity,tileSize:256,tileUrl:"{subdomain}"},o.name))instanceof hw))throw new Error("A layer with name '".concat(o.name,"' already exists but it is not a TileLayer.")+"A TileLayer should be used for rendering raster images.");if(a.getOptions().tileUrl!=="{subdomain}")throw new Error("A TileLayer with name '".concat(o.name,"' already exists but was configured ")+"for a single tile url [default for new TileLayer(...)].");(i=!o.overwrite&&a.getOptions().subdomains||[]).push.apply(i,IEe([],AEe(t),!1)),a._setOptionsNoUpdate({subdomains:i}),this.layers.add(a,o.before)},e.prototype.getLayers=function(){return this.layers.getLayers().map(function(t){return t.getId()})},e.prototype.removeLayers=function(t){var r,i;try{for(var o=BE(t),a=o.next();!a.done;a=o.next()){var l,h=a.value;this.layers.getLayerById(h)&&(this.layers.remove(h),l="".concat(h,"-source"),this.sources.getById(l))&&this.sources.remove(l)}}catch(p){r={error:p}}finally{try{a&&!a.done&&(i=o.return)&&i.call(o)}finally{if(r)throw r.error}}},e.prototype.addHtml=function(t,r){t.id||(t.id="marker_".concat(Vd()));var i=new p2({htmlContent:t});return this.markers.add(i,r),t.id},e.prototype.removeHtml=function(t){this.markers.remove(t)},e.prototype.addEventListener=function(t,r,i){this.events._addLegacy(t,r,i)},e.prototype.removeEventListener=function(t,r,i){this.events._removeLegacy(t,r,i)},e.prototype.setUserInteraction=function(t){this.userInteractionDelegate.setOptions(t)},e.prototype.getUserInteraction=function(){return this.userInteractionDelegate.getOptions()},e.prototype.addControl=function(t,r){this.controls.add(t,r)},e.prototype.removeControl=function(t){this.controls.remove(t)},e.prototype.setTraffic=function(t){var r=this.trafficOptions.incidents,i=this.trafficOptions.flow;if(this.trafficOptions=new ew().merge(this.trafficOptions,t),this.controls.getControls().filter(function(o){return o instanceof V5}).forEach(function(o){return o.updateButtonState()}),this.incidentDelegate&&(this.trafficOptions.incidents?r||this.incidentDelegate.addToMap():this.incidentDelegate.removeFromMap()),this.trafficOptions.flow&&this.trafficOptions.flow!=="none"){["absolute","relative-delay"].includes(this.trafficOptions.flow)&&console.warn("The 'absolute' and 'relative-delay' flow options are deprecated. Please use 'relative' instead.");try{this.trafficOptions.flow!==i&&this.flowDelegate.addToMap()}catch(o){throw this.trafficOptions.flow=i,o}}else this.flowDelegate.removeFromMap()},e.prototype.getTraffic=function(){return Zi(this.trafficOptions)},e.prototype.remove=function(){this.dispose()},e.prototype.clear=function(){this.popups.clear(),this.layers.clear(),this.sources.clear(),this.markers.clear(),this.indicators.clear()},e.prototype.dispose=function(){var t;for(this.clear(),this.map.remove(),(t=this.authentication)!=null&&t.dispose(),this.removed=!0,(t=this.resizeObserver)!=null&&t.disconnect(),this.resizeObserver=null;this.getMapContainer().firstChild;){var r=this.getMapContainer().firstChild;this.getMapContainer().removeChild(r)}},e.prototype.resize=function(t,r,i){typeof t!="number"&&typeof t!="string"||typeof r!="number"&&typeof r!="string"?i=t:(t=t,this.getMapContainer().style.height=typeof t=="number"?"".concat(t,"px"):t,this.getMapContainer().style.width=typeof r=="number"?"".concat(r,"px"):r),t=this.getMapContainer().style.overflow,this.getMapContainer().style.overflow="hidden",this.map.resize(i),this.getMapContainer().style.overflow=t},e.prototype.pixelsToPositions=function(t){var r,i,o=[];try{for(var a=BE(t),l=a.next();!l.done;l=a.next()){var h=l.value,p=this.map.unproject(h);o.push(new $o(p.lng,p.lat))}}catch(g){r={error:g}}finally{try{l&&!l.done&&(i=a.return)&&i.call(a)}finally{if(r)throw r.error}}return o},e.prototype.positionsToPixels=function(t){var r,i,o=[];try{for(var a=BE(t),l=a.next();!l.done;l=a.next()){var h=l.value,p=this.map.project(h);o.push(new Go(p.x,p.y))}}catch(g){r={error:g}}finally{try{l&&!l.done&&(i=a.return)&&i.call(a)}finally{if(r)throw r.error}}return o},e.prototype.areTilesLoaded=function(){return this.map.areTilesLoaded()},e.prototype.stop=function(){this.map.stop()},e.prototype.triggerRepaint=function(){this.map.triggerRepaint()},e.prototype.enableElevation=function(t,r){this.map.setTerrain(typeof t=="string"?{source:t,exaggeration:r}:{source:t.getId(),exaggeration:r})},e.prototype.disableElevation=function(){this.map.setTerrain(null)},e.prototype._getMap=function(){return this.map},e.prototype._rebuildStyle=function(t){return t===void 0&&(t=!0),SEe(this,void 0,void 0,function(){return CEe(this,function(r){return this.styles.setStyle(this.styleOptions,t),this.imageSprite._restoreImages(),[2]})})},e.prototype._isLoaded=function(){return this.loaded},e.prototype._isReady=function(){return this.ready},e.prototype._getLocalizedStrings=function(){return this.localizedStringsPromise},e.prototype._sendRequest=function(t,r,i){var o;return(o=typeof this.serviceOptions.transformRequest=="function"?this.serviceOptions.transformRequest(t,r):o)?fetch(o.url||t,{credentials:o.credentials,headers:Tu(Tu({},i),o.headers),method:"GET",mode:"cors"}):fetch(t,{headers:i,method:"GET",mode:"cors"})},e.prototype._substituteDomainLanguageViewAndSignInRequest=function(t,r){var i;(t.includes(Nn.legacyDomainPlaceHolder)||t.includes(Nn.domainPlaceHolder))&&(i=new RegExp("[^{]".concat(Nn.legacyDomainPlaceHolder,"[^}]")),t.match(i)&&(r.url=r.url.replace(Nn.legacyDomainPlaceHolder,Nn.domainPlaceHolder)),Zc.protoRegEx.test(this.serviceOptions.domain)?(i=r.url.indexOf(Nn.domainPlaceHolder),r.url=this.serviceOptions.domain+r.url.substring(i+Nn.domainPlaceHolder.length)):r.url=r.url.replace(Nn.domainPlaceHolder,this.serviceOptions.domain)),(r.url.toLocaleLowerCase().includes(this.serviceOptions.domain.toLocaleLowerCase())||r.url.toLocaleLowerCase().includes(this.serviceOptions.staticAssetsDomain.toLocaleLowerCase()))&&(i=this.authentication)!=null&&i.signRequest(r),t.includes(Nn.languagePlaceHolder)&&(r.url=r.url.replace(Nn.languagePlaceHolder,this.styleOptions.language)),t.includes(Nn.viewPlaceHolder)&&(r.url=this.styleOptions.view?r.url.replace(Nn.viewPlaceHolder,this.styleOptions.view):r.url.replace(Nn.viewPlaceHolder,"").replace("&".concat(Nn.viewParameter,"="),""))},e.prototype._setAutoResize=function(t){t?(this.resizeObserver||(this.resizeObserver=new ResizeObserver(this._resizeCallback)),this.resizeObserver.observe(this.map.getContainer())):this.resizeObserver&&this.resizeObserver.unobserve(this.map.getContainer())},e.prototype._setStyleComponents=function(t,r){var i=this;r===void 0&&(r=!0),this.removed||this.styles.definitions().then(function(o){var a,l,h=!0;if(i.styleOptions.style)try{for(var p=BE(o.configurations),g=p.next();!g.done;g=p.next()){var _=g.value;if(i.styleOptions.style===_.name){h=!1;break}}}catch(x){a={error:x}}finally{try{g&&!g.done&&(l=p.return)&&l.call(p)}finally{if(a)throw a.error}}h&&(i.styleOptions.style=o.defaultConfiguration),i.styleOptions=t,i._rebuildStyle(r)})},e.prototype._updateGlobalDefaults=function(t){t&&(t.authOptions&&!RA()&&_F(t.authOptions),t.domain&&!IF()&&vF(t.domain),t.styleDefinitionsPath&&!PF()&&bF(t.styleDefinitionsPath),t.workerCount&&!MF()&&wF(t.workerCount),t.maxParallelImageRequests&&!RF()&&xF(t.maxParallelImageRequests),!t.subscriptionKey&&!t["subscription-key"]||RA()||SF(t.subscriptionKey||t["subscription-key"]),!t.sessionId&&!t["session-id"]||OF()||TF(t.sessionId||t["session-id"]),t.language&&!kF()&&EF(t.language),!t.userRegion&&!t.view||LF()||CF(t.userRegion||t.view))},e.prototype._generateSafeBounds=function(t){if(t){var r=rr.getSouth(t),i=rr.getWest(t),o=rr.getNorth(t),a=rr.getEast(t);if(!(isFinite(r)&&isFinite(i)&&isFinite(o)&&isFinite(a)))throw new Error("The bounds specified are invalid: [".concat(t,"]"));for(;a<i;)a+=360;return new rr([i,r,a,o])}return t},e.prototype._detectHighContrast=function(){var t,r;switch(cye.getHighContrastMode()){case"invert":case"light":t=e.Css.hcLight,r="high_contrast_light";break;case"dark":t=e.Css.hcDark,r="high_contrast_dark"}t&&this.map.getContainer().classList.add(t),r&&this.styleOptions.style==="road"&&(this.styleOptions.style=r)},e.Css={canvasContainer:"atlas-map-canvas-container",canvas:"atlas-map-canvas",container:"atlas-map",hcDark:"high-contrast-dark",hcLight:"high-contrast-light"},e}(Wl),PEe=window&&window.__read||function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var r,i,o=t.call(n),a=[];try{for(;(e===void 0||0<e--)&&!(r=o.next()).done;)a.push(r.value)}catch(l){i={error:l}}finally{try{r&&!r.done&&(t=o.return)&&t.call(o)}finally{if(i)throw i.error}}return a},MEe=window&&window.__spreadArray||function(n,e,t){if(t||arguments.length===2)for(var r,i=0,o=e.length;i<o;i++)!r&&i in e||((r=r||Array.prototype.slice.call(e,0,i))[i]=e[i]);return n.concat(r||Array.prototype.slice.call(e))},REe=function(){function n(){this.detectHyperlinks=!0,this.parsePropertyPaths=!0}return n.applyTemplate=function(e,t){var r,i,o,a=this,l=document.createElement("div");return l.classList.add(n.Css.template),e&&(typeof(t=t||{}).singleDescription!="boolean"&&(t.singleDescription=!0),t.sandboxContent=typeof t.sandboxContent!="boolean"||t.sandboxContent,t.title&&typeof t.content=="string"&&(t.content.includes("{title}")||t.content.includes("{name}"))||(e.title?t.title="{title}":e.name&&(t.title="{name}")),typeof t.detectHyperlinks!="boolean"&&(t.detectHyperlinks=!0),typeof t.parsePropertyPaths!="boolean"&&(t.parsePropertyPaths=!0),t.textColor&&(l.style.color=t.textColor),t.fillColor&&(l.style.backgroundColor=t.fillColor),t.title&&((o=this._applyStringTemplate(e,t.title,t)).innerText=o.textContent||o.innerText||"",this._appendChild(l,o,n.Css.title)),(r=document.createElement("div")).classList.add(n.Css.content),Array.isArray(t.content)?0<t.content.length&&t.content[0].propertyPath?this._appendChild(r,this._generateContent(e,t.content,t),n.Css.item):t.content.forEach(function(h){a._appendChild(r,a._generateContent(e,h,t),n.Css.item)}):(i=0,o=void(e.description&&Object.keys(e).forEach(function(h){a._ignoreProperty(h,e[h])||i++})),i===1||t.singleDescription&&e.description||i===2&&e.Snippet?(o=document.createElement("div")).innerHTML=e.description:o=this._generateContent(e,t.content,t),this._appendChild(r,o,n.Css.item)),r.innerHTML!=="")&&(t.sandboxContent?l.appendChild(n._createSandboxedIframe(r,t)):l.appendChild(r)),l},n._createSandboxedIframe=function(i,t){var r=document.createElement("iframe"),i=(r.sandbox.add("allow-popups"),i.innerHTML),o=!1,_=100,a=550,l=10,g=(document.body.scrollWidth<=340&&(a=300,_=50),i.split(/<(tr|div|br|li|h[0-9]|p>)/)),p=Math.max.apply(Math,MEe([],PEe(g.map(function(x){return x.replace(/<[a-zA-Z0-9\s=\/]+>/g,"").length})),!1))-1,h=Math.ceil(3.5*p),p=(h<a&&(a=h,_=p),i.includes("<img")||i.includes("<video")?(o=!0,r.width="550px"):(h=-1<i.indexOf(n.Css.table)?25:20,l+=Math.max(.5*g.length*h,Math.ceil(i.replace(/<[a-zA-Z0-9\s=\/]+>/g,"").length/_)*h)),r.width=a+"px",r.height=o||280<l?"280px":l+"px",t.textColor?"color:".concat(t.textColor,";"):""),g=t.fillColor?"background-color:".concat(t.fillColor,";"):"",_='<html><head><title></title><meta charset="utf-8" /><meta http-equiv="x-ua-compatible" content="IE=Edge" />'+'<link rel="stylesheet" href="'.concat(n._cssUrl,'" type="text/css"/>')+"<style>html, body{margin:0;padding:0;".concat(p).concat(g,"}</style></head>")+'<body><div class="'.concat(n.Css.template,'" style="padding:0;width:').concat(a-20,'px">').concat(i,"</div></body></html>");return r.srcdoc===void 0?r.src="data:text/html;charset=utf-8,"+encodeURI(_):r.srcdoc=_,r},n._appendChild=function(e,t,r){t&&(r&&(t.className=(t.className?t.className+" ":"")+r),e.appendChild(t))},n._generateContent=function(e,t,r){return t?Array.isArray(t)?this._generatePropertyInfoTable(e,t,r):this._applyStringTemplate(e,t,r):(t=this._generateDynamicTableHtml(e,null,r))?((e=document.createElement("div")).innerHTML=t,e):null},n._applyStringTemplate=function(e,t,r){if(t){for(var i,o,a=t,l=this._placeholderRx.exec(t);l;)2<=l.length&&(i=this._getPropertyValue(e,l[1],r),a=a.replace(l[0],i)),l=this._placeholderRx.exec(t);if(a)return(a=a.trim()).includes("<")&&(a=a.replace(/[\r\n]+/g,"<br/>")),(o=document.createElement("div")).innerHTML=a,o}return null},n._getPropertyValue=function(e,t,r,i){var o=r.parsePropertyPaths?t.split("/"):[t],a=o.length;if(0<a&&e){var l=o[0],h=e[l];if(r.detectHyperlinks&&t==="link"&&(!i||i.hyperlinkFormat)){var p,g,_,x=[];if(Array.isArray(h)?h.forEach(function(z){z.href?x.push(z):typeof z=="string"&&x.push({href:z})}):h.href&&x.push(h),0<x.length)return i&&i.hyperlinkFormat?p=i.hyperlinkFormat:r&&r.hyperlinkFormat&&(p=r.hyperlinkFormat),g=p&&p.target?p.target:"_blank",_=[],x.forEach(function(z){z.title||p&&p.label||!z.rel||_.push(z.rel," - "),_.push('<a href="',z.href,'" target="',g,'">'),z.title?_.push(z.title):p&&p.label?_.push(p.label):_.push(z.href),_.push("</a>","<br/>")}),_.pop(),_.join("")}if(h!=null){for(var C=void 0,C=1;C<a&&(h=h[o[C]],l=o[C],h!=null);C++);if(C===a&&h!=null){if(e=void 0,(e=h.value!==void 0?h.value:h)instanceof Date)return i&&i.dateFormat?e.toLocaleString(void 0,i.dateFormat):r.dateFormat?e.toLocaleString(void 0,r.dateFormat):e.toISOString();if(typeof e=="object")return(M=this._generateDynamicTableHtml(e,o.slice(1),r))||"";if(typeof e=="number"){if(i){if(i.dateFormat)return new Date(e).toLocaleString(void 0,i.dateFormat);if(i.numberFormat)return e.toLocaleString(void 0,i.numberFormat)}else if(/(timestamp|date)/gi.test(l))return new Date(e).toISOString();return e.toLocaleString(void 0,r.numberFormat)}if(typeof e=="string"&&e!==""&&!/[\n\r<>\s]/g.test(e)&&(r.detectHyperlinks||i&&i.hyperlinkFormat)){var M,e=e.trim(),t=this._isUrlRx.test(e)||i&&i.hyperlinkFormat,L=this._isImageUrlRx.test(e)&&(t||e.startsWith("data:image")),F=this._emailRx.test(e);if(t||L||F)return t=void 0,M=void(i&&i.hyperlinkFormat?t=i.hyperlinkFormat:r&&r.hyperlinkFormat&&(t=r.hyperlinkFormat)),M=t&&t.target?' target="'.concat(t.target,'"'):' target="_blank"',i="".concat(t&&t.label?t.label:e),t&&t.scheme?e=t.scheme+e:F&&(e="mailto:"+e),r=t&&t.label?' alt="'.concat(t.label,'"'):"",(t&&t.isImage||L)&&(i='<img src="'.concat(e,'" style="max-width:100%"').concat(r,'"/>')),'<a href="'.concat(e,'"').concat(M,">").concat(i,"</a>")}return e.toString()}}}return""},n._generatePropertyInfoTable=function(e,t,r){var i,o;return e&&t&&0<t.length?((i=[]).push('<table class="'.concat((o=this).Css.table,'">')),t.forEach(function(a){var l=o._getPropertyValue(e,a.propertyPath,r,a);a.hideLabel?i.push('<tr><td colspan="2">',l,"</td></tr>"):(a=a.label||a.propertyPath.split("/")[0],i.push("<tr><th>",a,"</th><td>",l,"</td></tr>"))}),i.push("</table>"),(t=document.createElement("div")).innerHTML=i.join(""),t):null},n._generateDynamicTableHtml=function(e,t,r){var i,o,a,l,h=this;return!e||((i=[]).push('<table class="'.concat((o=this).Css.table,'">')),a=t&&0<t.length?t.join("/")+"/":"",l=0,Object.keys(e).forEach(function(p){h._ignoreProperty(p,e[p])||(i.push("<tr><th>",p,"</th><td>",o._getPropertyValue(e,a+p,r),"</td></tr>"),l++)}),l===0)?null:(i.push("</table>"),i.join(""))},n._ignoreProperty=function(e,t){switch(e){case"title":case"name":case"base":case"popupTemplate":case"anchor":case"icon":case"image":case"imageUrl":case"rotation":case"color":case"size":case"offset":case"strokeColor":case"strokeWidth":case"strokeOpacity":case"subType":case"fillColor":case"fillOpacity":case"visibility":case"visible":return!0;default:if(e.indexOf("_")===0||t==null||t==="")return!0}return!1},n._placeholderRx=/\{([a-zA-Z0-9_\/\s]+)\}/gi,n._isUrlRx=/^(http|https|ftp|tel|mailto):\/\//i,n._isImageUrlRx=/(^data:image|.png$|.jpg$|.jpeg$|.gif$|.bmp$|.svg|.tif|.tiff$)/i,n._emailRx=/^[^\.\s@:](?:[^\s@:]*[^\s@:\.])?@[^\.\s@]+(?:\.[^\.\s@]+)*$/,n._cssUrl=new Zc({domain:yc.staticAssetsDomain,path:"sdk/javascript/mapcontrol/".concat(j1.getEndpointVersion(),"/atlas.min.css")}).toString(),n.Css={template:"azure-maps-control-popup-template",title:"azure-maps-control-popup-template-title",content:"azure-maps-control-popup-template-content",item:"azure-maps-control-popup-template-content-item",table:"azure-maps-control-popup-template-table"},n}(),C9=(NF(),Object.freeze({__proto__:null,get AuthenticationType(){return ri},get ControlPosition(){return xa},get ControlStyle(){return Ro},HtmlMarker:p2,Map:S9,Pixel:Go,Popup:pw,PopupTemplate:REe,Shape:Ci,_enableRTLTextPlugin:NF,_getAssetDomain:Jie,_getDomain:eoe,_hasMaxParallelImageRequests:RF,_hasSetAuthenticationOptions:RA,_hasSetDomain:IF,_hasSetLanguage:kF,_hasSetSessionId:OF,_hasSetStyleDefinitionsPath:PF,_hasSetStyleDefinitionsVersion:Qie,_hasSetView:LF,_hasWorkerCount:MF,addImageTemplate:$ie,addProtocol:Zie,clearPrewarmedResources:Kie,control:Jge,data:Nge,getAllImageTemplateNames:Wie,getAuthenticationOptions:sF,getDomain:MA,getImageTemplate:AF,getLanguage:pF,getMaxParallelImageRequests:fF,getSessionId:gF,getStaticAssetsDomain:cF,getStyleAPIVersion:hF,getStyleDefinitionsPath:lF,getStyleDefinitionsVersion:uF,getSubscriptionKey:mF,getUserRegion:zie,getVersion:jie,getView:yF,getWorkerCount:dF,internal:ioe,isSupported:Vie,layer:eye,math:Gge,prewarm:Yie,removeProtocol:Xie,setAuthenticationOptions:_F,setDomain:vF,setLanguage:EF,setMaxParallelImageRequests:xF,setSessionId:TF,setStyleAPIVersion:Gie,setStyleDefinitionsPath:bF,setStyleDefinitionsVersion:Hie,setSubscriptionKey:SF,setUserRegion:CF,setView:qie,setWorkerCount:wF,source:bme}));let A9,mR,I9,A0;function kEe(){OEe().then(n=>{({locations:mR,flows:I9}=n);const[e,t]=[globalThis.innerWidth,globalThis.innerHeight],r=F4(mR,a=>[a.lon,a.lat],[e,t],{pad:.3});A0=new C9.Map("myMap",{style:"grayscale_dark",interactive:!1,center:[r.longitude,r.latitude],zoom:r.zoom,bearing:r.bearing,pitch:r.pitch,authOptions:{authType:"sas",getToken:function(a,l,h){var p="https://samples.azuremaps.com/api/GetAzureMapsSasToken";fetch(p).then(g=>g.text()).then(g=>a(g))}}}),A0.events.add("ready",()=>{A0.controls.add(new C9.control.StyleControl({mapStyles:["road","grayscale_light","grayscale_dark","night","satellite"]}),{position:"top-right"})}),A9=new sC({canvas:"deck-canvas",width:"100%",height:"100%",initialViewState:r,controller:!0,map:!0,onViewStateChange:({viewState:a})=>{A0.setCamera({center:[a.longitude,a.latitude],zoom:a.zoom,bearing:a.bearing,pitch:a.pitch})},layers:[]}),yR(),document.querySelectorAll(".control").forEach(a=>{a.onchange=yR}),document.getElementById("darkMode").onchange=LEe;const i=document.getElementById("deck-canvas"),o=document.getElementById("myMap");o.insertBefore(i,o.querySelector(".atlas-control-container"))})}async function OEe(){const[n,e]=await Promise.all([V4("/data/flowmap/locations.csv",t=>({id:t.id,name:t.name,lat:+t.lat,lon:+t.lon})),V4("/data/flowmap/flows.csv",t=>({origin:t.origin,dest:t.dest,count:+t.count}))]);return{locations:n,flows:e}}function yR(){A9.setProps({layers:[new B4({id:"my-flowmap-layer",data:{locations:mR,flows:I9},pickable:!0,darkMode:I0("darkMode"),colorScheme:FEe("colorScheme"),clusteringEnabled:I0("clusteringEnabled"),getLocationId:n=>n.id,getLocationLat:n=>n.lat,getLocationLon:n=>n.lon,getFlowOriginId:n=>n.origin,getFlowDestId:n=>n.dest,getFlowMagnitude:n=>n.count,getLocationName:n=>n.name,onHover:n=>NEe(DEe(n))})]})}function LEe(){A0.setStyle({style:I0("darkMode")?"grayscale_dark":"grayscale_light"}),document.getElementById("deck-canvas").style.mixBlendMode=I0("darkMode")?"screen":"darken",document.getElementById("container").style.backgroundColor=I0("darkMode")?"#000":"#fff",yR()}function NEe(n){const e=document.getElementById("tooltip");if(!n){e.style.display="none";return}e.style.left=`${n.position.left}px`,e.style.top=`${n.position.top}px`,e.innerHTML=n.content,e.style.display="block"}function DEe(n){if(!n)return;const{x:e,y:t,object:r}=n,i={left:e,top:t};switch(r==null?void 0:r.type){case cg.LOCATION:const o=document.createElement("b");o.innerText=r.name.replaceAll('"',"");const a=document.createElement("li");a.innerText=`Incoming trips: ${r.totals.incomingCount}`;const l=document.createElement("li");l.innerText=`Outgoing trips: ${r.totals.outgoingCount}`;const h=document.createElement("li");return h.innerText=`Internal or round trips: ${r.totals.internalCount}`,{position:i,content:[o,a,l,h].map(x=>x.outerHTML).join("")};case cg.FLOW:const p=document.createElement("b");p.innerText="Route Info";const g=document.createElement("li");g.innerText=`Bike Station: ${r.origin.id.slice(2,-2)} → ${r.dest.id.slice(2,-2)}`;const _=document.createElement("li");return _.innerText=`Trips Count: ${r.count}`,{position:i,content:[p,g,_].map(x=>x.outerHTML).join("")}}}function FEe(n){var e=document.getElementById(n);return e.options[e.selectedIndex].value}function I0(n){return document.getElementById(n).checked}document.body.onload=kEe});
