function pH(n,e){for(var t=0;t<e.length;t++){const r=e[t];if(typeof r!="string"&&!Array.isArray(r)){for(const i in r)if(i!=="default"&&!(i in n)){const o=Object.getOwnPropertyDescriptor(r,i);o&&Object.defineProperty(n,i,o.get?o:{enumerable:!0,get:()=>r[i]})}}}return Object.freeze(Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const a of o.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&r(a)}).observe(document,{childList:!0,subtree:!0});function t(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerPolicy&&(o.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?o.credentials="include":i.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(i){if(i.ep)return;i.ep=!0;const o=t(i);fetch(i.href,o)}})();function sx(n,e){if(!n)throw new Error(e||"loader assertion failed.")}const qP=!!(typeof process!="object"||String(process)!=="[object process]"||process.browser),CO=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);CO&&parseFloat(CO[1]);const gH="3.4.15";function vu(n,e){if(!n)throw new Error(e||"loaders.gl assertion failed.")}const Aw=typeof process!="object"||String(process)!=="[object process]"||process.browser,mH=typeof window<"u"&&typeof window.orientation<"u",AO=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);AO&&parseFloat(AO[1]);function f0(n){"@babel/helpers - typeof";return f0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},f0(n)}function yH(n,e){if(f0(n)!="object"||!n)return n;var t=n[Symbol.toPrimitive];if(t!==void 0){var r=t.call(n,e||"default");if(f0(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(n)}function _H(n){var e=yH(n,"string");return f0(e)=="symbol"?e:e+""}function Y(n,e,t){return(e=_H(e))in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}class vH{constructor(e,t){Y(this,"name",void 0),Y(this,"workerThread",void 0),Y(this,"isRunning",!0),Y(this,"result",void 0),Y(this,"_resolve",()=>{}),Y(this,"_reject",()=>{}),this.name=e,this.workerThread=t,this.result=new Promise((r,i)=>{this._resolve=r,this._reject=i})}postMessage(e,t){this.workerThread.postMessage({source:"loaders.gl",type:e,payload:t})}done(e){vu(this.isRunning),this.isRunning=!1,this._resolve(e)}error(e){vu(this.isRunning),this.isRunning=!1,this._reject(e)}}let NS=class{terminate(){}};const DS=new Map;function bH(n){vu(n.source&&!n.url||!n.source&&n.url);let e=DS.get(n.source||n.url);return e||(n.url&&(e=wH(n.url),DS.set(n.url,e)),n.source&&(e=p5(n.source),DS.set(n.source,e))),vu(e),e}function wH(n){if(!n.startsWith("http"))return n;const e=xH(n);return p5(e)}function p5(n){const e=new Blob([n],{type:"application/javascript"});return URL.createObjectURL(e)}function xH(n){return`try {
  importScripts('`.concat(n,`');
} catch (error) {
  console.error(error);
  throw error;
}`)}function g5(n){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,t=arguments.length>2?arguments[2]:void 0;const r=t||new Set;if(n){if(IO(n))r.add(n);else if(IO(n.buffer))r.add(n.buffer);else if(!ArrayBuffer.isView(n)){if(e&&typeof n=="object")for(const i in n)g5(n[i],e,r)}}return t===void 0?Array.from(r):[]}function IO(n){return n?n instanceof ArrayBuffer||typeof MessagePort<"u"&&n instanceof MessagePort||typeof ImageBitmap<"u"&&n instanceof ImageBitmap||typeof OffscreenCanvas<"u"&&n instanceof OffscreenCanvas:!1}const FS=()=>{};class _2{static isSupported(){return typeof Worker<"u"&&Aw||typeof NS<"u"&&!Aw}constructor(e){Y(this,"name",void 0),Y(this,"source",void 0),Y(this,"url",void 0),Y(this,"terminated",!1),Y(this,"worker",void 0),Y(this,"onMessage",void 0),Y(this,"onError",void 0),Y(this,"_loadableURL","");const{name:t,source:r,url:i}=e;vu(r||i),this.name=t,this.source=r,this.url=i,this.onMessage=FS,this.onError=o=>console.log(o),this.worker=Aw?this._createBrowserWorker():this._createNodeWorker()}destroy(){this.onMessage=FS,this.onError=FS,this.worker.terminate(),this.terminated=!0}get isRunning(){return!!this.onMessage}postMessage(e,t){t=t||g5(e),this.worker.postMessage(e,t)}_getErrorFromErrorEvent(e){let t="Failed to load ";return t+="worker ".concat(this.name," from ").concat(this.url,". "),e.message&&(t+="".concat(e.message," in ")),e.lineno&&(t+=":".concat(e.lineno,":").concat(e.colno)),new Error(t)}_createBrowserWorker(){this._loadableURL=bH({source:this.source,url:this.url});const e=new Worker(this._loadableURL,{name:this.name});return e.onmessage=t=>{t.data?this.onMessage(t.data):this.onError(new Error("No data received"))},e.onerror=t=>{this.onError(this._getErrorFromErrorEvent(t)),this.terminated=!0},e.onmessageerror=t=>console.error(t),e}_createNodeWorker(){let e;if(this.url){const r=this.url.includes(":/")||this.url.startsWith("/")?this.url:"./".concat(this.url);e=new NS(r,{eval:!1})}else if(this.source)e=new NS(this.source,{eval:!0});else throw new Error("no worker");return e.on("message",t=>{this.onMessage(t)}),e.on("error",t=>{this.onError(t)}),e.on("exit",t=>{}),e}}class EH{static isSupported(){return _2.isSupported()}constructor(e){Y(this,"name","unnamed"),Y(this,"source",void 0),Y(this,"url",void 0),Y(this,"maxConcurrency",1),Y(this,"maxMobileConcurrency",1),Y(this,"onDebug",()=>{}),Y(this,"reuseWorkers",!0),Y(this,"props",{}),Y(this,"jobQueue",[]),Y(this,"idleQueue",[]),Y(this,"count",0),Y(this,"isDestroyed",!1),this.source=e.source,this.url=e.url,this.setProps(e)}destroy(){this.idleQueue.forEach(e=>e.destroy()),this.isDestroyed=!0}setProps(e){this.props={...this.props,...e},e.name!==void 0&&(this.name=e.name),e.maxConcurrency!==void 0&&(this.maxConcurrency=e.maxConcurrency),e.maxMobileConcurrency!==void 0&&(this.maxMobileConcurrency=e.maxMobileConcurrency),e.reuseWorkers!==void 0&&(this.reuseWorkers=e.reuseWorkers),e.onDebug!==void 0&&(this.onDebug=e.onDebug)}async startJob(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:(o,a,l)=>o.done(l),r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:(o,a)=>o.error(a);const i=new Promise(o=>(this.jobQueue.push({name:e,onMessage:t,onError:r,onStart:o}),this));return this._startQueuedJob(),await i}async _startQueuedJob(){if(!this.jobQueue.length)return;const e=this._getAvailableWorker();if(!e)return;const t=this.jobQueue.shift();if(t){this.onDebug({message:"Starting job",name:t.name,workerThread:e,backlog:this.jobQueue.length});const r=new vH(t.name,e);e.onMessage=i=>t.onMessage(r,i.type,i.payload),e.onError=i=>t.onError(r,i),t.onStart(r);try{await r.result}finally{this.returnWorkerToQueue(e)}}}returnWorkerToQueue(e){this.isDestroyed||!this.reuseWorkers||this.count>this._getMaxConcurrency()?(e.destroy(),this.count--):this.idleQueue.push(e),this.isDestroyed||this._startQueuedJob()}_getAvailableWorker(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this._getMaxConcurrency()){this.count++;const e="".concat(this.name.toLowerCase()," (#").concat(this.count," of ").concat(this.maxConcurrency,")");return new _2({name:e,source:this.source,url:this.url})}return null}_getMaxConcurrency(){return mH?this.maxMobileConcurrency:this.maxConcurrency}}const TH={maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:!0,onDebug:()=>{}};class ou{static isSupported(){return _2.isSupported()}static getWorkerFarm(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return ou._workerFarm=ou._workerFarm||new ou({}),ou._workerFarm.setProps(e),ou._workerFarm}constructor(e){Y(this,"props",void 0),Y(this,"workerPools",new Map),this.props={...TH},this.setProps(e),this.workerPools=new Map}destroy(){for(const e of this.workerPools.values())e.destroy();this.workerPools=new Map}setProps(e){this.props={...this.props,...e};for(const t of this.workerPools.values())t.setProps(this._getWorkerPoolProps())}getWorkerPool(e){const{name:t,source:r,url:i}=e;let o=this.workerPools.get(t);return o||(o=new EH({name:t,source:r,url:i}),o.setProps(this._getWorkerPoolProps()),this.workerPools.set(t,o)),o}_getWorkerPoolProps(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}}}Y(ou,"_workerFarm",void 0);const SH="latest";function CH(n){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const t=e[n.id]||{},r="".concat(n.id,"-worker.js");let i=t.workerUrl;if(!i&&n.id==="compression"&&(i=e.workerUrl),e._workerType==="test"&&(i="modules/".concat(n.module,"/dist/").concat(r)),!i){let o=n.version;o==="latest"&&(o=SH);const a=o?"@".concat(o):"";i="https://unpkg.com/@loaders.gl/".concat(n.module).concat(a,"/dist/").concat(r)}return vu(i),i}function AH(n){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:gH;vu(n,"no worker provided");const t=n.version;return!(!e||!t)}const IH={},PH=Object.freeze(Object.defineProperty({__proto__:null,default:IH},Symbol.toStringTag,{value:"Module"}));function MH(n,e){return!ou.isSupported()||!Aw&&!(e!=null&&e._nodeWorkers)?!1:n.worker&&(e==null?void 0:e.worker)}async function RH(n,e,t,r,i){const o=n.id,a=CH(n,t),h=ou.getWorkerFarm(t).getWorkerPool({name:o,url:a});t=JSON.parse(JSON.stringify(t)),r=JSON.parse(JSON.stringify(r||{}));const p=await h.startJob("process-on-worker",kH.bind(null,i));return p.postMessage("process",{input:e,options:t,context:r}),await(await p.result).result}async function kH(n,e,t,r){switch(t){case"done":e.done(r);break;case"error":e.error(new Error(r.error));break;case"process":const{id:i,input:o,options:a}=r;try{const l=await n(o,a);e.postMessage("done",{id:i,result:l})}catch(l){const h=l instanceof Error?l.message:"unknown error";e.postMessage("error",{id:i,error:h})}break;default:console.warn("parse-with-worker unknown message ".concat(t))}}function OH(n,e,t){if(t=t||n.byteLength,n.byteLength<t||e.byteLength<t)return!1;const r=new Uint8Array(n),i=new Uint8Array(e);for(let o=0;o<r.length;++o)if(r[o]!==i[o])return!1;return!0}function LH(){for(var n=arguments.length,e=new Array(n),t=0;t<n;t++)e[t]=arguments[t];const r=e.map(l=>l instanceof ArrayBuffer?new Uint8Array(l):l),i=r.reduce((l,h)=>l+h.byteLength,0),o=new Uint8Array(i);let a=0;for(const l of r)o.set(l,a),a+=l.byteLength;return o.buffer}async function NH(n){const e=[];for await(const t of n)e.push(t);return LH(...e)}function PO(){let n;if(typeof window<"u"&&window.performance)n=window.performance.now();else if(typeof process<"u"&&process.hrtime){const e=process.hrtime();n=e[0]*1e3+e[1]/1e6}else n=Date.now();return n}class MO{constructor(e,t){Y(this,"name",void 0),Y(this,"type",void 0),Y(this,"sampleSize",1),Y(this,"time",void 0),Y(this,"count",void 0),Y(this,"samples",void 0),Y(this,"lastTiming",void 0),Y(this,"lastSampleTime",void 0),Y(this,"lastSampleCount",void 0),Y(this,"_count",0),Y(this,"_time",0),Y(this,"_samples",0),Y(this,"_startTime",0),Y(this,"_timerPending",!1),this.name=e,this.type=t,this.reset()}setSampleSize(e){return this.sampleSize=e,this}incrementCount(){return this.addCount(1),this}decrementCount(){return this.subtractCount(1),this}addCount(e){return this._count+=e,this._samples++,this._checkSampling(),this}subtractCount(e){return this._count-=e,this._samples++,this._checkSampling(),this}addTime(e){return this._time+=e,this.lastTiming=e,this._samples++,this._checkSampling(),this}timeStart(){return this._startTime=PO(),this._timerPending=!0,this}timeEnd(){return this._timerPending?(this.addTime(PO()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}getSampleAverageCount(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}getSampleAverageTime(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}getSampleHz(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}getAverageCount(){return this.samples>0?this.count/this.samples:0}getAverageTime(){return this.samples>0?this.time/this.samples:0}getHz(){return this.time>0?this.samples/(this.time/1e3):0}reset(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}_checkSampling(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}}class $P{constructor(e){Y(this,"id",void 0),Y(this,"stats",{}),this.id=e.id,this.stats={},this._initializeStats(e.stats),Object.seal(this)}get(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"count";return this._getOrCreate({name:e,type:t})}get size(){return Object.keys(this.stats).length}reset(){for(const e in this.stats)this.stats[e].reset();return this}forEach(e){for(const t in this.stats)e(this.stats[t])}getTable(){const e={};return this.forEach(t=>{e[t.name]={time:t.time||0,count:t.count||0,average:t.getAverageTime()||0,hz:t.getHz()||0}}),e}_initializeStats(){(arguments.length>0&&arguments[0]!==void 0?arguments[0]:[]).forEach(t=>this._getOrCreate(t))}_getOrCreate(e){if(!e||!e.name)return null;const{name:t,type:r}=e;return this.stats[t]||(e instanceof MO?this.stats[t]=e:this.stats[t]=new MO(t,r)),this.stats[t]}}let DH="";const RO={};function FH(n){for(const e in RO)if(n.startsWith(e)){const t=RO[e];n=n.replace(e,t)}return!n.startsWith("http://")&&!n.startsWith("https://")&&(n="".concat(DH).concat(n)),n}function BH(n){return n&&typeof n=="object"&&n.isBuffer}function m5(n){if(BH(n))return n;if(n instanceof ArrayBuffer)return n;if(ArrayBuffer.isView(n))return n.byteOffset===0&&n.byteLength===n.buffer.byteLength?n.buffer:n.buffer.slice(n.byteOffset,n.byteOffset+n.byteLength);if(typeof n=="string"){const e=n;return new TextEncoder().encode(e).buffer}if(n&&typeof n=="object"&&n._toArrayBuffer)return n._toArrayBuffer();throw new Error("toArrayBuffer")}function y5(n){const e=n?n.lastIndexOf("/"):-1;return e>=0?n.substr(e+1):""}function UH(n){const e=n?n.lastIndexOf("/"):-1;return e>=0?n.substr(0,e):""}const zH=n=>typeof n=="boolean",Bv=n=>typeof n=="function",X0=n=>n!==null&&typeof n=="object",kO=n=>X0(n)&&n.constructor==={}.constructor,jH=n=>n&&typeof n[Symbol.iterator]=="function",VH=n=>n&&typeof n[Symbol.asyncIterator]=="function",ep=n=>typeof Response<"u"&&n instanceof Response||n&&n.arrayBuffer&&n.text&&n.json,tp=n=>typeof Blob<"u"&&n instanceof Blob,HH=n=>n&&typeof n=="object"&&n.isBuffer,GH=n=>typeof ReadableStream<"u"&&n instanceof ReadableStream||X0(n)&&Bv(n.tee)&&Bv(n.cancel)&&Bv(n.getReader),qH=n=>X0(n)&&Bv(n.read)&&Bv(n.pipe)&&zH(n.readable),_5=n=>GH(n)||qH(n),$H=/^data:([-\w.]+\/[-\w.+]+)(;|,)/,WH=/^([-\w.]+\/[-\w.+]+)/;function YH(n){const e=WH.exec(n);return e?e[1]:n}function OO(n){const e=$H.exec(n);return e?e[1]:""}const v5=/\?.*/;function KH(n){const e=n.match(v5);return e&&e[0]}function WP(n){return n.replace(v5,"")}function KE(n){return ep(n)?n.url:tp(n)?n.name||"":typeof n=="string"?n:""}function YP(n){if(ep(n)){const e=n,t=e.headers.get("content-type")||"",r=WP(e.url);return YH(t)||OO(r)}return tp(n)?n.type||"":typeof n=="string"?OO(n):""}function ZH(n){return ep(n)?n.headers["content-length"]||-1:tp(n)?n.size:typeof n=="string"?n.length:n instanceof ArrayBuffer||ArrayBuffer.isView(n)?n.byteLength:-1}async function b5(n){if(ep(n))return n;const e={},t=ZH(n);t>=0&&(e["content-length"]=String(t));const r=KE(n),i=YP(n);i&&(e["content-type"]=i);const o=await JH(n);o&&(e["x-first-bytes"]=o),typeof n=="string"&&(n=new TextEncoder().encode(n));const a=new Response(n,{headers:e});return Object.defineProperty(a,"url",{value:r}),a}async function XH(n){if(!n.ok){const e=await QH(n);throw new Error(e)}}async function QH(n){let e="Failed to fetch resource ".concat(n.url," (").concat(n.status,"): ");try{const t=n.headers.get("Content-Type");let r=n.statusText;t.includes("application/json")&&(r+=" ".concat(await n.text())),e+=r,e=e.length>60?"".concat(e.slice(0,60),"..."):e}catch{}return e}async function JH(n){if(typeof n=="string")return"data:,".concat(n.slice(0,5));if(n instanceof Blob){const t=n.slice(0,5);return await new Promise(r=>{const i=new FileReader;i.onload=o=>{var a;return r(o==null||(a=o.target)===null||a===void 0?void 0:a.result)},i.readAsDataURL(t)})}if(n instanceof ArrayBuffer){const t=n.slice(0,5),r=eG(t);return"data:base64,".concat(r)}return null}function eG(n){let e="";const t=new Uint8Array(n);for(let r=0;r<t.byteLength;r++)e+=String.fromCharCode(t[r]);return btoa(e)}async function LO(n,e){if(typeof n=="string"){n=FH(n);let t=e;return e!=null&&e.fetch&&typeof(e==null?void 0:e.fetch)!="function"&&(t=e.fetch),await fetch(n,t)}return await b5(n)}function w5(n){if(typeof window<"u"&&typeof window.process=="object"&&window.process.type==="renderer"||typeof process<"u"&&typeof process.versions=="object"&&process.versions.electron)return!0;const e=typeof navigator=="object"&&typeof navigator.userAgent=="string"&&navigator.userAgent,t=n||e;return!!(t&&t.indexOf("Electron")>=0)}function Ou(){return!(typeof process=="object"&&String(process)==="[object process]"&&!process.browser)||w5()}const Iw={self:typeof self<"u"&&self,window:typeof window<"u"&&window,global:typeof global<"u"&&global,document:typeof document<"u"&&document,process:typeof process=="object"&&process},I1=Iw.window||Iw.self||Iw.global,T_=Iw.process||{},x5=typeof __VERSION__<"u"?__VERSION__:"untranspiled source";Ou();const BS=globalThis;function E5(n){if(!n&&!Ou())return"Node";if(w5(n))return"Electron";const t=n||(typeof navigator<"u"?navigator:{}).userAgent||"";if(t.indexOf("Edge")>-1)return"Edge";const r=t.indexOf("MSIE ")!==-1,i=t.indexOf("Trident/")!==-1;return r||i?"IE":BS.chrome?"Chrome":BS.safari?"Safari":BS.mozInnerScreenX?"Firefox":"Unknown"}function tG(n){try{const e=window[n],t="__storage_test__";return e.setItem(t,t),e.removeItem(t),e}catch{return null}}class nG{constructor(e,t){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"sessionStorage";Y(this,"storage",void 0),Y(this,"id",void 0),Y(this,"config",void 0),this.storage=tG(r),this.id=e,this.config=t,this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(e){if(Object.assign(this.config,e),this.storage){const t=JSON.stringify(this.config);this.storage.setItem(this.id,t)}}_loadConfiguration(){let e={};if(this.storage){const t=this.storage.getItem(this.id);e=t?JSON.parse(t):{}}return Object.assign(this.config,e),this}}function rG(n){let e;return n<10?e="".concat(n.toFixed(2),"ms"):n<100?e="".concat(n.toFixed(1),"ms"):n<1e3?e="".concat(n.toFixed(0),"ms"):e="".concat((n/1e3).toFixed(2),"s"),e}function iG(n){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:8;const t=Math.max(e-n.length,0);return"".concat(" ".repeat(t)).concat(n)}function US(n,e,t){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:600;const i=n.src.replace(/\(/g,"%28").replace(/\)/g,"%29");n.width>r&&(t=Math.min(t,r/n.width));const o=n.width*t,a=n.height*t,l=["font-size:1px;","padding:".concat(Math.floor(a/2),"px ").concat(Math.floor(o/2),"px;"),"line-height:".concat(a,"px;"),"background:url(".concat(i,");"),"background-size:".concat(o,"px ").concat(a,"px;"),"color:transparent;"].join("");return["".concat(e," %c+"),l]}let cx;(function(n){n[n.BLACK=30]="BLACK",n[n.RED=31]="RED",n[n.GREEN=32]="GREEN",n[n.YELLOW=33]="YELLOW",n[n.BLUE=34]="BLUE",n[n.MAGENTA=35]="MAGENTA",n[n.CYAN=36]="CYAN",n[n.WHITE=37]="WHITE",n[n.BRIGHT_BLACK=90]="BRIGHT_BLACK",n[n.BRIGHT_RED=91]="BRIGHT_RED",n[n.BRIGHT_GREEN=92]="BRIGHT_GREEN",n[n.BRIGHT_YELLOW=93]="BRIGHT_YELLOW",n[n.BRIGHT_BLUE=94]="BRIGHT_BLUE",n[n.BRIGHT_MAGENTA=95]="BRIGHT_MAGENTA",n[n.BRIGHT_CYAN=96]="BRIGHT_CYAN",n[n.BRIGHT_WHITE=97]="BRIGHT_WHITE"})(cx||(cx={}));function NO(n){return typeof n=="string"?cx[n.toUpperCase()]||cx.WHITE:n}function oG(n,e,t){return!Ou&&typeof n=="string"&&(e&&(e=NO(e),n="\x1B[".concat(e,"m").concat(n,"\x1B[39m")),t&&(e=NO(t),n="\x1B[".concat(t+10,"m").concat(n,"\x1B[49m"))),n}function aG(n){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:["constructor"];const t=Object.getPrototypeOf(n),r=Object.getOwnPropertyNames(t);for(const i of r)typeof n[i]=="function"&&(e.find(o=>i===o)||(n[i]=n[i].bind(n)))}function lx(n,e){if(!n)throw new Error(e||"Assertion failed")}function dg(){let n;if(Ou&&"performance"in I1){var e,t;n=I1==null||(e=I1.performance)===null||e===void 0||(t=e.now)===null||t===void 0?void 0:t.call(e)}else if("hrtime"in T_){var r;const i=T_==null||(r=T_.hrtime)===null||r===void 0?void 0:r.call(T_);n=i[0]*1e3+i[1]/1e6}else n=Date.now();return n}const fg={debug:Ou&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},sG={enabled:!0,level:0};function ec(){}const DO={},FO={once:!0};class Q0{constructor(){let{id:e}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{id:""};Y(this,"id",void 0),Y(this,"VERSION",x5),Y(this,"_startTs",dg()),Y(this,"_deltaTs",dg()),Y(this,"_storage",void 0),Y(this,"userData",{}),Y(this,"LOG_THROTTLE_TIMEOUT",0),this.id=e,this.userData={},this._storage=new nG("__probe-".concat(this.id,"__"),sG),this.timeStamp("".concat(this.id," started")),aG(this),Object.seal(this)}set level(e){this.setLevel(e)}get level(){return this.getLevel()}isEnabled(){return this._storage.config.enabled}getLevel(){return this._storage.config.level}getTotal(){return Number((dg()-this._startTs).toPrecision(10))}getDelta(){return Number((dg()-this._deltaTs).toPrecision(10))}set priority(e){this.level=e}get priority(){return this.level}getPriority(){return this.level}enable(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return this._storage.setConfiguration({enabled:e}),this}setLevel(e){return this._storage.setConfiguration({level:e}),this}get(e){return this._storage.config[e]}set(e,t){this._storage.setConfiguration({[e]:t})}settings(){console.table?console.table(this._storage.config):console.log(this._storage.config)}assert(e,t){lx(e,t)}warn(e){return this._getLogFunction(0,e,fg.warn,arguments,FO)}error(e){return this._getLogFunction(0,e,fg.error,arguments)}deprecated(e,t){return this.warn("`".concat(e,"` is deprecated and will be removed in a later version. Use `").concat(t,"` instead"))}removed(e,t){return this.error("`".concat(e,"` has been removed. Use `").concat(t,"` instead"))}probe(e,t){return this._getLogFunction(e,t,fg.log,arguments,{time:!0,once:!0})}log(e,t){return this._getLogFunction(e,t,fg.debug,arguments)}info(e,t){return this._getLogFunction(e,t,console.info,arguments)}once(e,t){for(var r=arguments.length,i=new Array(r>2?r-2:0),o=2;o<r;o++)i[o-2]=arguments[o];return this._getLogFunction(e,t,fg.debug||fg.info,arguments,FO)}table(e,t,r){return t?this._getLogFunction(e,t,console.table||ec,r&&[r],{tag:hG(t)}):ec}image(e){let{logLevel:t,priority:r,image:i,message:o="",scale:a=1}=e;return this._shouldLog(t||r)?Ou?uG({image:i,message:o,scale:a}):lG():ec}time(e,t){return this._getLogFunction(e,t,console.time?console.time:console.info)}timeEnd(e,t){return this._getLogFunction(e,t,console.timeEnd?console.timeEnd:console.info)}timeStamp(e,t){return this._getLogFunction(e,t,console.timeStamp||ec)}group(e,t){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{collapsed:!1};const i=BO({logLevel:e,message:t,opts:r}),{collapsed:o}=r;return i.method=(o?console.groupCollapsed:console.group)||console.info,this._getLogFunction(i)}groupCollapsed(e,t){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return this.group(e,t,Object.assign({},r,{collapsed:!0}))}groupEnd(e){return this._getLogFunction(e,"",console.groupEnd||ec)}withGroup(e,t,r){this.group(e,t)();try{r()}finally{this.groupEnd(e)()}}trace(){console.trace&&console.trace()}_shouldLog(e){return this.isEnabled()&&this.getLevel()>=T5(e)}_getLogFunction(e,t,r,i,o){if(this._shouldLog(e)){o=BO({logLevel:e,message:t,args:i,opts:o}),r=r||o.method,lx(r),o.total=this.getTotal(),o.delta=this.getDelta(),this._deltaTs=dg();const a=o.tag||o.message;if(o.once)if(!DO[a])DO[a]=dg();else return ec;return t=cG(this.id,o.message,o),r.bind(console,t,...o.args)}return ec}}Y(Q0,"VERSION",x5);function T5(n){if(!n)return 0;let e;switch(typeof n){case"number":e=n;break;case"object":e=n.logLevel||n.priority||0;break;default:return 0}return lx(Number.isFinite(e)&&e>=0),e}function BO(n){const{logLevel:e,message:t}=n;n.logLevel=T5(e);const r=n.args?Array.from(n.args):[];for(;r.length&&r.shift()!==t;);switch(typeof e){case"string":case"function":t!==void 0&&r.unshift(t),n.message=e;break;case"object":Object.assign(n,e);break}typeof n.message=="function"&&(n.message=n.message());const i=typeof n.message;return lx(i==="string"||i==="object"),Object.assign(n,{args:r},n.opts)}function cG(n,e,t){if(typeof e=="string"){const r=t.time?iG(rG(t.total)):"";e=t.time?"".concat(n,": ").concat(r,"  ").concat(e):"".concat(n,": ").concat(e),e=oG(e,t.color,t.background)}return e}function lG(n){return console.warn("removed"),ec}function uG(n){let{image:e,message:t="",scale:r=1}=n;if(typeof e=="string"){const o=new Image;return o.onload=()=>{const a=US(o,t,r);console.log(...a)},o.src=e,ec}const i=e.nodeName||"";if(i.toLowerCase()==="img")return console.log(...US(e,t,r)),ec;if(i.toLowerCase()==="canvas"){const o=new Image;return o.onload=()=>console.log(...US(o,t,r)),o.src=e.toDataURL(),ec}return ec}function hG(n){for(const e in n)for(const t in n[e])return t||"untitled";return"empty"}const UO=new Q0({id:"loaders.gl"});class dG{log(){return()=>{}}info(){return()=>{}}warn(){return()=>{}}error(){return()=>{}}}class fG{constructor(){Y(this,"console",void 0),this.console=console}log(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return this.console.log.bind(this.console,...t)}info(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return this.console.info.bind(this.console,...t)}warn(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return this.console.warn.bind(this.console,...t)}error(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return this.console.error.bind(this.console,...t)}}const S5={fetch:null,mimeType:void 0,nothrow:!1,log:new fG,CDN:"https://unpkg.com/@loaders.gl",worker:!0,maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:qP,_nodeWorkers:!1,_workerType:"",limit:0,_limitMB:0,batchSize:"auto",batchDebounceMs:0,metadata:!1,transforms:[]},pG={throws:"nothrow",dataType:"(no longer used)",uri:"baseUri",method:"fetch.method",headers:"fetch.headers",body:"fetch.body",mode:"fetch.mode",credentials:"fetch.credentials",cache:"fetch.cache",redirect:"fetch.redirect",referrer:"fetch.referrer",referrerPolicy:"fetch.referrerPolicy",integrity:"fetch.integrity",keepalive:"fetch.keepalive",signal:"fetch.signal"};function C5(){globalThis.loaders=globalThis.loaders||{};const{loaders:n}=globalThis;return n._state=n._state||{},n._state}const A5=()=>{const n=C5();return n.globalOptions=n.globalOptions||{...S5},n.globalOptions};function gG(n,e,t,r){return t=t||[],t=Array.isArray(t)?t:[t],mG(n,t),_G(e,n,r)}function mG(n,e){zO(n,null,S5,pG,e);for(const t of e){const r=n&&n[t.id]||{},i=t.options&&t.options[t.id]||{},o=t.deprecatedOptions&&t.deprecatedOptions[t.id]||{};zO(r,t.id,i,o,e)}}function zO(n,e,t,r,i){const o=e||"Top level",a=e?"".concat(e,"."):"";for(const l in n){const h=!e&&X0(n[l]),p=l==="baseUri"&&!e,g=l==="workerUrl"&&e;if(!(l in t)&&!p&&!g){if(l in r)UO.warn("".concat(o," loader option '").concat(a).concat(l,"' no longer supported, use '").concat(r[l],"'"))();else if(!h){const _=yG(l,i);UO.warn("".concat(o," loader option '").concat(a).concat(l,"' not recognized. ").concat(_))()}}}}function yG(n,e){const t=n.toLowerCase();let r="";for(const i of e)for(const o in i.options){if(n===o)return"Did you mean '".concat(i.id,".").concat(o,"'?");const a=o.toLowerCase();(t.startsWith(a)||a.startsWith(t))&&(r=r||"Did you mean '".concat(i.id,".").concat(o,"'?"))}return r}function _G(n,e,t){const i={...n.options||{}};return vG(i,t),i.log===null&&(i.log=new dG),jO(i,A5()),jO(i,e),i}function jO(n,e){for(const t in e)if(t in e){const r=e[t];kO(r)&&kO(n[t])?n[t]={...n[t],...e[t]}:n[t]=e[t]}}function vG(n,e){e&&!("baseUri"in n)&&(n.baseUri=e)}function KP(n){var e;return n?(Array.isArray(n)&&(n=n[0]),Array.isArray((e=n)===null||e===void 0?void 0:e.extensions)):!1}function ZP(n){var e,t;sx(n,"null loader"),sx(KP(n),"invalid loader");let r;return Array.isArray(n)&&(r=n[1],n=n[0],n={...n,options:{...n.options,...r}}),((e=n)!==null&&e!==void 0&&e.parseTextSync||(t=n)!==null&&t!==void 0&&t.parseText)&&(n.text=!0),n.text||(n.binary=!0),n}const I5=()=>{const n=C5();return n.loaderRegistry=n.loaderRegistry||[],n.loaderRegistry};function bG(n){const e=I5();n=Array.isArray(n)?n:[n];for(const t of n){const r=ZP(t);e.find(i=>r===i)||e.unshift(r)}}function wG(){return I5()}const xG=new Q0({id:"loaders.gl"}),EG=/\.([^.]+)$/;async function TG(n){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],t=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0;if(!P5(n))return null;let i=VO(n,e,{...t,nothrow:!0},r);if(i)return i;if(tp(n)&&(n=await n.slice(0,10).arrayBuffer(),i=VO(n,e,t,r)),!i&&!(t!=null&&t.nothrow))throw new Error(M5(n));return i}function VO(n){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],t=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0;if(!P5(n))return null;if(e&&!Array.isArray(e))return ZP(e);let i=[];e&&(i=i.concat(e)),t!=null&&t.ignoreRegisteredLoaders||i.push(...wG()),CG(i);const o=SG(n,i,t,r);if(!o&&!(t!=null&&t.nothrow))throw new Error(M5(n));return o}function SG(n,e,t,r){const i=KE(n),o=YP(n),a=WP(i)||(r==null?void 0:r.url);let l=null,h="";if(t!=null&&t.mimeType&&(l=zS(e,t==null?void 0:t.mimeType),h="match forced by supplied MIME type ".concat(t==null?void 0:t.mimeType)),l=l||AG(e,a),h=h||(l?"matched url ".concat(a):""),l=l||zS(e,o),h=h||(l?"matched MIME type ".concat(o):""),l=l||PG(e,n),h=h||(l?"matched initial data ".concat(R5(n)):""),l=l||zS(e,t==null?void 0:t.fallbackMimeType),h=h||(l?"matched fallback MIME type ".concat(o):""),h){var p;xG.log(1,"selectLoader selected ".concat((p=l)===null||p===void 0?void 0:p.name,": ").concat(h,"."))}return l}function P5(n){return!(n instanceof Response&&n.status===204)}function M5(n){const e=KE(n),t=YP(n);let r="No valid loader found (";r+=e?"".concat(y5(e),", "):"no url provided, ",r+="MIME type: ".concat(t?'"'.concat(t,'"'):"not provided",", ");const i=n?R5(n):"";return r+=i?' first bytes: "'.concat(i,'"'):"first bytes: not available",r+=")",r}function CG(n){for(const e of n)ZP(e)}function AG(n,e){const t=e&&EG.exec(e),r=t&&t[1];return r?IG(n,r):null}function IG(n,e){e=e.toLowerCase();for(const t of n)for(const r of t.extensions)if(r.toLowerCase()===e)return t;return null}function zS(n,e){for(const t of n)if(t.mimeTypes&&t.mimeTypes.includes(e)||e==="application/x.".concat(t.id))return t;return null}function PG(n,e){if(!e)return null;for(const t of n)if(typeof e=="string"){if(MG(e,t))return t}else if(ArrayBuffer.isView(e)){if(HO(e.buffer,e.byteOffset,t))return t}else if(e instanceof ArrayBuffer&&HO(e,0,t))return t;return null}function MG(n,e){return e.testText?e.testText(n):(Array.isArray(e.tests)?e.tests:[e.tests]).some(r=>n.startsWith(r))}function HO(n,e,t){return(Array.isArray(t.tests)?t.tests:[t.tests]).some(i=>RG(n,e,t,i))}function RG(n,e,t,r){if(r instanceof ArrayBuffer)return OH(r,n,r.byteLength);switch(typeof r){case"function":return r(n,t);case"string":const i=v2(n,e,r.length);return r===i;default:return!1}}function R5(n){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5;return typeof n=="string"?n.slice(0,e):ArrayBuffer.isView(n)?v2(n.buffer,n.byteOffset,e):n instanceof ArrayBuffer?v2(n,0,e):""}function v2(n,e,t){if(n.byteLength<e+t)return"";const r=new DataView(n);let i="";for(let o=0;o<t;o++)i+=String.fromCharCode(r.getUint8(e+o));return i}const kG=256*1024;function*OG(n,e){const t=(e==null?void 0:e.chunkSize)||kG;let r=0;const i=new TextEncoder;for(;r<n.length;){const o=Math.min(n.length-r,t),a=n.slice(r,r+o);r+=o,yield i.encode(a)}}const LG=256*1024;function NG(n){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return function*(){const{chunkSize:t=LG}=e;let r=0;for(;r<n.byteLength;){const i=Math.min(n.byteLength-r,t),o=new ArrayBuffer(i),a=new Uint8Array(n,r,i);new Uint8Array(o).set(a),r+=i,yield o}}()}const DG=1024*1024;async function*FG(n,e){const t=(e==null?void 0:e.chunkSize)||DG;let r=0;for(;r<n.size;){const i=r+t,o=await n.slice(r,i).arrayBuffer();r=i,yield o}}function GO(n,e){return qP?BG(n,e):UG(n)}async function*BG(n,e){const t=n.getReader();let r;try{for(;;){const i=r||t.read();e!=null&&e._streamReadAhead&&(r=t.read());const{done:o,value:a}=await i;if(o)return;yield m5(a)}}catch{t.releaseLock()}}async function*UG(n,e){for await(const t of n)yield m5(t)}function zG(n,e){if(typeof n=="string")return OG(n,e);if(n instanceof ArrayBuffer)return NG(n,e);if(tp(n))return FG(n,e);if(_5(n))return GO(n,e);if(ep(n))return GO(n.body,e);throw new Error("makeIterator")}const k5="Cannot convert supplied data type";function jG(n,e,t){if(e.text&&typeof n=="string")return n;if(HH(n)&&(n=n.buffer),n instanceof ArrayBuffer){const r=n;return e.text&&!e.binary?new TextDecoder("utf8").decode(r):r}if(ArrayBuffer.isView(n)){if(e.text&&!e.binary)return new TextDecoder("utf8").decode(n);let r=n.buffer;const i=n.byteLength||n.length;return(n.byteOffset!==0||i!==r.byteLength)&&(r=r.slice(n.byteOffset,n.byteOffset+i)),r}throw new Error(k5)}async function VG(n,e,t){const r=n instanceof ArrayBuffer||ArrayBuffer.isView(n);if(typeof n=="string"||r)return jG(n,e);if(tp(n)&&(n=await b5(n)),ep(n)){const i=n;return await XH(i),e.binary?await i.arrayBuffer():await i.text()}if(_5(n)&&(n=zG(n,t)),jH(n)||VH(n))return NH(n);throw new Error(k5)}function O5(n,e){const t=A5(),r=n||t;return typeof r.fetch=="function"?r.fetch:X0(r.fetch)?i=>LO(i,r):e!=null&&e.fetch?e==null?void 0:e.fetch:LO}function HG(n,e,t){if(t)return t;const r={fetch:O5(e,n),...n};if(r.url){const i=WP(r.url);r.baseUrl=i,r.queryString=KH(r.url),r.filename=y5(i),r.baseUrl=UH(i)}return Array.isArray(r.loaders)||(r.loaders=null),r}function GG(n,e){if(!e&&n&&!Array.isArray(n))return n;let t;if(n&&(t=Array.isArray(n)?n:[n]),e&&e.loaders){const r=Array.isArray(e.loaders)?e.loaders:[e.loaders];t=t?[...t,...r]:r}return t&&t.length?t:null}async function XP(n,e,t,r){vu(!r||typeof r=="object"),e&&!Array.isArray(e)&&!KP(e)&&(r=void 0,t=e,e=void 0),n=await n,t=t||{};const i=KE(n),a=GG(e,r),l=await TG(n,a,t);return l?(t=gG(t,l,a,i),r=HG({url:i,parse:XP,loaders:a},t,r||null),await qG(l,n,t,r)):null}async function qG(n,e,t,r){if(AH(n),ep(e)){const i=e,{ok:o,redirected:a,status:l,statusText:h,type:p,url:g}=i,_=Object.fromEntries(i.headers.entries());r.response={headers:_,ok:o,redirected:a,status:l,statusText:h,type:p,url:g}}if(e=await VG(e,n,t),n.parseTextSync&&typeof e=="string")return t.dataType="text",n.parseTextSync(e,t,r,n);if(MH(n,t))return await RH(n,e,t,r,XP);if(n.parseText&&typeof e=="string")return await n.parseText(e,t,r,n);if(n.parse)return await n.parse(e,t,r,n);throw vu(!n.parseSync),new Error("".concat(n.id," loader - no parser found and worker is disabled"))}async function ux(n,e,t,r){!Array.isArray(e)&&!KP(e)&&(t=e,e=void 0);const i=O5(t);let o=n;return typeof n=="string"&&(o=await i(n)),tp(n)&&(o=await i(n)),await XP(o,e,t)}const $G="3.4.15",{_parseImageNode:WG}=globalThis,b2=typeof Image<"u",w2=typeof ImageBitmap<"u",YG=!!WG,x2=qP?!0:YG;function KG(n){switch(n){case"auto":return w2||b2||x2;case"imagebitmap":return w2;case"image":return b2;case"data":return x2;default:throw new Error("@loaders.gl/images: image ".concat(n," not supported in this environment"))}}function ZG(){if(w2)return"imagebitmap";if(b2)return"image";if(x2)return"data";throw new Error("Install '@loaders.gl/polyfills' to parse images under Node.js")}function XG(n){const e=JG(n);if(!e)throw new Error("Not an image");return e}function QG(n){switch(XG(n)){case"data":return n;case"image":case"imagebitmap":const e=document.createElement("canvas"),t=e.getContext("2d");if(!t)throw new Error("getImageData");return e.width=n.width,e.height=n.height,t.drawImage(n,0,0),t.getImageData(0,0,n.width,n.height);default:throw new Error("getImageData")}}function JG(n){return typeof ImageBitmap<"u"&&n instanceof ImageBitmap?"imagebitmap":typeof Image<"u"&&n instanceof Image?"image":n&&typeof n=="object"&&n.data&&n.width&&n.height?"data":null}const eq=/^data:image\/svg\+xml/,tq=/\.svg((\?|#).*)?$/;function QP(n){return n&&(eq.test(n)||tq.test(n))}function nq(n,e){if(QP(e)){let r=new TextDecoder().decode(n);try{typeof unescape=="function"&&typeof encodeURIComponent=="function"&&(r=unescape(encodeURIComponent(r)))}catch(o){throw new Error(o.message)}return"data:image/svg+xml;base64,".concat(btoa(r))}return L5(n,e)}function L5(n,e){if(QP(e))throw new Error("SVG cannot be parsed directly to imagebitmap");return new Blob([new Uint8Array(n)])}async function N5(n,e,t){const r=nq(n,t),i=self.URL||self.webkitURL,o=typeof r!="string"&&i.createObjectURL(r);try{return await rq(o||r,e)}finally{o&&i.revokeObjectURL(o)}}async function rq(n,e){const t=new Image;return t.src=n,e.image&&e.image.decode&&t.decode?(await t.decode(),t):await new Promise((r,i)=>{try{t.onload=()=>r(t),t.onerror=o=>i(new Error("Could not load image ".concat(n,": ").concat(o)))}catch(o){i(o)}})}const iq={};let qO=!0;async function oq(n,e,t){let r;QP(t)?r=await N5(n,e,t):r=L5(n,t);const i=e&&e.imagebitmap;return await aq(r,i)}async function aq(n){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;if((sq(e)||!qO)&&(e=null),e)try{return await createImageBitmap(n,e)}catch(t){console.warn(t),qO=!1}return await createImageBitmap(n)}function sq(n){for(const e in n||iq)return!1;return!0}function cq(n){return!dq(n,"ftyp",4)||!(n[8]&96)?null:lq(n)}function lq(n){switch(uq(n,8,12).replace("\0"," ").trim()){case"avif":case"avis":return{extension:"avif",mimeType:"image/avif"};default:return null}}function uq(n,e,t){return String.fromCharCode(...n.slice(e,t))}function hq(n){return[...n].map(e=>e.charCodeAt(0))}function dq(n,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const r=hq(e);for(let i=0;i<r.length;++i)if(r[i]!==n[i+t])return!1;return!0}const cl=!1,Uv=!0;function D5(n){const e=J0(n);return pq(e)||yq(e)||gq(e)||mq(e)||fq(e)}function fq(n){const e=new Uint8Array(n instanceof DataView?n.buffer:n),t=cq(e);return t?{mimeType:t.mimeType,width:0,height:0}:null}function pq(n){const e=J0(n);return e.byteLength>=24&&e.getUint32(0,cl)===2303741511?{mimeType:"image/png",width:e.getUint32(16,cl),height:e.getUint32(20,cl)}:null}function gq(n){const e=J0(n);return e.byteLength>=10&&e.getUint32(0,cl)===1195984440?{mimeType:"image/gif",width:e.getUint16(6,Uv),height:e.getUint16(8,Uv)}:null}function mq(n){const e=J0(n);return e.byteLength>=14&&e.getUint16(0,cl)===16973&&e.getUint32(2,Uv)===e.byteLength?{mimeType:"image/bmp",width:e.getUint32(18,Uv),height:e.getUint32(22,Uv)}:null}function yq(n){const e=J0(n);if(!(e.byteLength>=3&&e.getUint16(0,cl)===65496&&e.getUint8(2)===255))return null;const{tableMarkers:r,sofMarkers:i}=_q();let o=2;for(;o+9<e.byteLength;){const a=e.getUint16(o,cl);if(i.has(a))return{mimeType:"image/jpeg",height:e.getUint16(o+5,cl),width:e.getUint16(o+7,cl)};if(!r.has(a))return null;o+=2,o+=e.getUint16(o,cl)}return null}function _q(){const n=new Set([65499,65476,65484,65501,65534]);for(let t=65504;t<65520;++t)n.add(t);return{tableMarkers:n,sofMarkers:new Set([65472,65473,65474,65475,65477,65478,65479,65481,65482,65483,65485,65486,65487,65502])}}function J0(n){if(n instanceof DataView)return n;if(ArrayBuffer.isView(n))return new DataView(n.buffer);if(n instanceof ArrayBuffer)return new DataView(n);throw new Error("toDataView")}async function vq(n,e){const{mimeType:t}=D5(n)||{},r=globalThis._parseImageNode;return sx(r),await r(n,t)}async function bq(n,e,t){e=e||{};const i=(e.image||{}).type||"auto",{url:o}=t||{},a=wq(i);let l;switch(a){case"imagebitmap":l=await oq(n,e,o);break;case"image":l=await N5(n,e,o);break;case"data":l=await vq(n);break;default:sx(!1)}return i==="data"&&(l=QG(l)),l}function wq(n){switch(n){case"auto":case"data":return ZG();default:return KG(n),n}}const xq=["png","jpg","jpeg","gif","webp","bmp","ico","svg","avif"],Eq=["image/png","image/jpeg","image/gif","image/webp","image/avif","image/bmp","image/vnd.microsoft.icon","image/svg+xml"],Tq={image:{type:"auto",decode:!0}},Sq={id:"image",module:"images",name:"Images",version:$G,mimeTypes:Eq,extensions:xq,parse:bq,tests:[n=>!!D5(new DataView(n))],options:Tq},Fr=new Q0({id:"deck"});let E2={};function Cq(n){E2=n}function fa(n,e,t,r){Fr.level>0&&E2[n]&&E2[n].call(null,e,t,r)}function Aq(n){const e=n[0],t=n[n.length-1];return e==="{"&&t==="}"||e==="["&&t==="]"}const Iq={id:"JSON",name:"JSON",module:"",version:"",options:{},extensions:["json","geojson"],mimeTypes:["application/json","application/geo+json"],testText:Aq,parseTextSync:JSON.parse};function Pq(){const n="8.9.36",e=globalThis.deck&&globalThis.deck.VERSION;if(e&&e!==n)throw new Error("deck.gl - multiple versions detected: ".concat(e," vs ").concat(n));return e||(Fr.log(1,"deck.gl ".concat(n))(),globalThis.deck={...globalThis.deck,VERSION:n,version:n,log:Fr,_registerLoggers:Cq},bG([Iq,[Sq,{imagebitmap:{premultiplyAlpha:"none"}}]])),n}const Mq=Pq(),Xr={DEFAULT:-1,LNGLAT:1,METER_OFFSETS:2,LNGLAT_OFFSETS:3,CARTESIAN:0};Object.defineProperty(Xr,"IDENTITY",{get:()=>(Fr.deprecated("COORDINATE_SYSTEM.IDENTITY","COORDINATE_SYSTEM.CARTESIAN")(),0)});const ll={WEB_MERCATOR:1,GLOBE:2,WEB_MERCATOR_AUTO_OFFSET:4,IDENTITY:0},Um={common:0,meters:1,pixels:2},$O={click:{handler:"onClick"},panstart:{handler:"onDragStart"},panmove:{handler:"onDrag"},panend:{handler:"onDragEnd"}},Tn=new Q0({id:"luma.gl"});function Ma(n,e){if(!n)throw new Error(e||"luma.gl: assertion failed.")}const Rq="Invalid WebGLRenderingContext",kq="Requires WebGL2";function ZE(n){return typeof WebGLRenderingContext<"u"&&n instanceof WebGLRenderingContext||typeof WebGL2RenderingContext<"u"&&n instanceof WebGL2RenderingContext?!0:!!(n&&Number.isFinite(n._version))}function vr(n){return typeof WebGL2RenderingContext<"u"&&n instanceof WebGL2RenderingContext?!0:!!(n&&n._version===2)}function Oq(n){return vr(n)?n:null}function XE(n){return Ma(ZE(n),Rq),n}function ga(n){return Ma(vr(n),kq),n}const xv={};function Lq(n){globalThis.console&&globalThis.console.error&&globalThis.console.error(n)}function Nq(n){globalThis.console&&globalThis.console.log&&globalThis.console.log(n)}function Dq(n,e){xv[n]=!0,e!==void 0&&Lq(e)}function Fq(n){const e=n.getError;n.getError=function(){let r;do r=e.apply(n),r!==0&&(xv[r]=!0);while(r!==0);for(r in xv)if(xv[r])return delete xv[r],parseInt(r,10);return 0}}const eb=function n(e){const t=e.gl;this.ext=e,this.isAlive=!0,this.hasBeenBound=!1,this.elementArrayBuffer=null,this.attribs=new Array(e.maxVertexAttribs);for(let r=0;r<this.attribs.length;r++){const i=new n.VertexAttrib(t);this.attribs[r]=i}this.maxAttrib=0};eb.VertexAttrib=function(e){this.enabled=!1,this.buffer=null,this.size=4,this.type=5126,this.normalized=!1,this.stride=16,this.offset=0,this.cached="",this.recache()};eb.VertexAttrib.prototype.recache=function(){this.cached=[this.size,this.type,this.normalized,this.stride,this.offset].join(":")};const np=function(e){const t=this;this.gl=e,Fq(e);const r=this.original={getParameter:e.getParameter,enableVertexAttribArray:e.enableVertexAttribArray,disableVertexAttribArray:e.disableVertexAttribArray,bindBuffer:e.bindBuffer,getVertexAttrib:e.getVertexAttrib,vertexAttribPointer:e.vertexAttribPointer};e.getParameter=function(o){return o===t.VERTEX_ARRAY_BINDING_OES?t.currentVertexArrayObject===t.defaultVertexArrayObject?null:t.currentVertexArrayObject:r.getParameter.apply(this,arguments)},e.enableVertexAttribArray=function(o){const a=t.currentVertexArrayObject;a.maxAttrib=Math.max(a.maxAttrib,o);const l=a.attribs[o];return l.enabled=!0,r.enableVertexAttribArray.apply(this,arguments)},e.disableVertexAttribArray=function(o){const a=t.currentVertexArrayObject;a.maxAttrib=Math.max(a.maxAttrib,o);const l=a.attribs[o];return l.enabled=!1,r.disableVertexAttribArray.apply(this,arguments)},e.bindBuffer=function(o,a){switch(o){case 34962:t.currentArrayBuffer=a;break;case 34963:t.currentVertexArrayObject.elementArrayBuffer=a;break}return r.bindBuffer.apply(this,arguments)},e.getVertexAttrib=function(o,a){const h=t.currentVertexArrayObject.attribs[o];switch(a){case 34975:return h.buffer;case 34338:return h.enabled;case 34339:return h.size;case 34340:return h.stride;case 34341:return h.type;case 34922:return h.normalized;default:return r.getVertexAttrib.apply(this,arguments)}},e.vertexAttribPointer=function(o,a,l,h,p,g){const _=t.currentVertexArrayObject;_.maxAttrib=Math.max(_.maxAttrib,o);const x=_.attribs[o];return x.buffer=t.currentArrayBuffer,x.size=a,x.type=l,x.normalized=h,x.stride=p,x.offset=g,x.recache(),r.vertexAttribPointer.apply(this,arguments)},e.instrumentExtension&&e.instrumentExtension(this,"OES_vertex_array_object"),e.canvas&&e.canvas.addEventListener("webglcontextrestored",()=>{Nq("OESVertexArrayObject emulation library context restored"),t.reset_()},!0),this.reset_()};np.prototype.VERTEX_ARRAY_BINDING_OES=34229;np.prototype.reset_=function(){if(this.vertexArrayObjects!==void 0)for(let r=0;r<this.vertexArrayObjects.length;++r)this.vertexArrayObjects.isAlive=!1;const t=this.gl;this.maxVertexAttribs=t.getParameter(34921),this.defaultVertexArrayObject=new eb(this),this.currentVertexArrayObject=null,this.currentArrayBuffer=null,this.vertexArrayObjects=[this.defaultVertexArrayObject],this.bindVertexArrayOES(null)};np.prototype.createVertexArrayOES=function(){const e=new eb(this);return this.vertexArrayObjects.push(e),e};np.prototype.deleteVertexArrayOES=function(e){e.isAlive=!1,this.vertexArrayObjects.splice(this.vertexArrayObjects.indexOf(e),1),this.currentVertexArrayObject===e&&this.bindVertexArrayOES(null)};np.prototype.isVertexArrayOES=function(e){return!!(e&&e instanceof eb&&e.hasBeenBound&&e.ext===this)};np.prototype.bindVertexArrayOES=function(e){const t=this.gl;if(e&&!e.isAlive){Dq(1282,"bindVertexArrayOES: attempt to bind deleted arrayObject");return}const r=this.original,i=this.currentVertexArrayObject;this.currentVertexArrayObject=e||this.defaultVertexArrayObject,this.currentVertexArrayObject.hasBeenBound=!0;const o=this.currentVertexArrayObject;if(i===o)return;(!i||o.elementArrayBuffer!==i.elementArrayBuffer)&&r.bindBuffer.call(t,34963,o.elementArrayBuffer);let a=this.currentArrayBuffer;const l=Math.max(i?i.maxAttrib:0,o.maxAttrib);for(let h=0;h<=l;h++){const p=o.attribs[h],g=i?i.attribs[h]:null;if((!i||p.enabled!==g.enabled)&&(p.enabled?r.enableVertexAttribArray.call(t,h):r.disableVertexAttribArray.call(t,h)),p.enabled){let _=!1;(!i||p.buffer!==g.buffer)&&(a!==p.buffer&&(r.bindBuffer.call(t,34962,p.buffer),a=p.buffer),_=!0),(_||p.cached!==g.cached)&&r.vertexAttribPointer.call(t,h,p.size,p.type,p.normalized,p.stride,p.offset)}}this.currentArrayBuffer!==a&&r.bindBuffer.call(t,34962,this.currentArrayBuffer)};function Bq(n){if(typeof n.createVertexArray=="function")return;const e=n.getSupportedExtensions;n.getSupportedExtensions=function(){const i=e.call(this)||[];return i.indexOf("OES_vertex_array_object")<0&&i.push("OES_vertex_array_object"),i};const t=n.getExtension;n.getExtension=function(i){const o=t.call(this,i);return o||(i!=="OES_vertex_array_object"?null:(n.__OESVertexArrayObject||(this.__OESVertexArrayObject=new np(this)),this.__OESVertexArrayObject))}}const WO="OES_element_index",YO="WEBGL_draw_buffers",Uq="EXT_disjoint_timer_query",zq="EXT_disjoint_timer_query_webgl2",jq="EXT_texture_filter_anisotropic",KO="WEBGL_debug_renderer_info",Vq=35723,Hq=4352,Gq=36795,qq=34047,$q=37445,Wq=37446,gi=n=>vr(n)?void 0:0,Yq={3074:n=>vr(n)?void 0:36064,[Vq]:n=>vr(n)?void 0:Hq,35977:gi,32937:gi,[Gq]:(n,e)=>{const t=vr(n)?n.getExtension(zq):n.getExtension(Uq);return t&&t.GPU_DISJOINT_EXT?e(t.GPU_DISJOINT_EXT):0},[$q]:(n,e)=>{const t=n.getExtension(KO);return e(t&&t.UNMASKED_VENDOR_WEBGL||7936)},[Wq]:(n,e)=>{const t=n.getExtension(KO);return e(t&&t.UNMASKED_RENDERER_WEBGL||7937)},[qq]:(n,e)=>{const t=n.luma.extensions[jq];return t?e(t.MAX_TEXTURE_MAX_ANISOTROPY_EXT):1},32883:gi,35071:gi,37447:gi,36063:(n,e)=>{if(!vr(n)){const t=n.getExtension(YO);return t?e(t.MAX_COLOR_ATTACHMENTS_WEBGL):0}},35379:gi,35374:gi,35377:gi,34852:n=>{if(!vr(n)){const e=n.getExtension(YO);return e?e.MAX_DRAW_BUFFERS_WEBGL:0}},36203:n=>n.getExtension(WO)?2147483647:65535,33001:n=>n.getExtension(WO)?16777216:65535,33e3:n=>16777216,37157:gi,35373:gi,35657:gi,36183:gi,37137:gi,34045:gi,35978:gi,35979:gi,35968:gi,35376:gi,35375:gi,35659:gi,37154:gi,35371:gi,35658:gi,35076:gi,35077:gi,35380:gi};function Kq(n,e,t){const r=Yq[t],i=typeof r=="function"?r(n,e,t):r;return i!==void 0?i:e(t)}const Zq="OES_vertex_array_object",F5="ANGLE_instanced_arrays",Xq="WEBGL_draw_buffers",Qq="EXT_disjoint_timer_query",Jq="EXT_texture_filter_anisotropic",e$="VertexArray requires WebGL2 or OES_vertex_array_object extension";function t$(n,e){return{webgl2:vr(n),ext:n.getExtension(e)}}const B5={[Zq]:{meta:{suffix:"OES"},createVertexArray:()=>{Ma(!1,e$)},deleteVertexArray:()=>{},bindVertexArray:()=>{},isVertexArray:()=>!1},[F5]:{meta:{suffix:"ANGLE"},vertexAttribDivisor(n,e){Ma(e===0,"WebGL instanced rendering not supported")},drawElementsInstanced:()=>{},drawArraysInstanced:()=>{}},[Xq]:{meta:{suffix:"WEBGL"},drawBuffers:()=>{Ma(!1)}},[Qq]:{meta:{suffix:"EXT"},createQuery:()=>{Ma(!1)},deleteQuery:()=>{Ma(!1)},beginQuery:()=>{Ma(!1)},endQuery:()=>{},getQuery(n,e){return this.getQueryObject(n,e)},getQueryParameter(n,e){return this.getQueryObject(n,e)},getQueryObject:()=>{}}},jS={readBuffer:(n,e,t)=>{vr(n)&&e(t)},getVertexAttrib:(n,e,t,r)=>{const{webgl2:i,ext:o}=t$(n,F5);let a;switch(r){case 35069:a=i?void 0:!1;break;case 35070:a=!i&&!o?0:void 0;break}return a!==void 0?a:e(t,r)},getProgramParameter:(n,e,t,r)=>{if(!vr(n))switch(r){case 35967:return 35981;case 35971:return 0;case 35382:return 0}return e(t,r)},getInternalformatParameter:(n,e,t,r,i)=>{if(!vr(n))switch(i){case 32937:return new Int32Array([0])}return n.getInternalformatParameter(t,r,i)},getTexParameter(n,e,t,r){switch(r){case 34046:const{extensions:i}=n.luma,o=i[Jq];r=o&&o.TEXTURE_MAX_ANISOTROPY_EXT||34046;break}return e(t,r)},getParameter:Kq,hint(n,e,t,r){return e(t,r)}};function n$(n){n.luma=n.luma||{};const{luma:e}=n;return e.polyfilled||(Bq(n),r$(n),o$(n,B5),i$(n,{target:e,target2:n}),e.polyfilled=!0),n}globalThis.polyfillContext=n$;function r$(n){n.luma.extensions={};const e=n.getSupportedExtensions()||[];for(const t of e)n.luma[t]=n.getExtension(t)}function i$(n,e){let{target:t,target2:r}=e;Object.keys(jS).forEach(i=>{if(typeof jS[i]=="function"){const o=n[i]?n[i].bind(n):()=>{},a=jS[i].bind(null,n,o);t[i]=a,r[i]=a}})}function o$(n,e){for(const t of Object.getOwnPropertyNames(e))t!=="overrides"&&a$(n,{extension:t,target:n.luma,target2:n})}function a$(n,e){let{extension:t,target:r,target2:i}=e;const o=B5[t];Ma(o);const{meta:a={}}=o,{suffix:l=""}=a,h=n.getExtension(t);for(const p of Object.keys(o)){const g="".concat(p).concat(l);let _=null;p==="meta"||typeof n[p]=="function"||(h&&typeof h[g]=="function"?_=function(){return h[g](...arguments)}:typeof o[p]=="function"&&(_=o[p].bind(r))),_&&(r[p]=_,i[p]=_)}}const JP={3042:!1,32773:new Float32Array([0,0,0,0]),32777:32774,34877:32774,32969:1,32968:0,32971:1,32970:0,3106:new Float32Array([0,0,0,0]),3107:[!0,!0,!0,!0],2884:!1,2885:1029,2929:!1,2931:1,2932:513,2928:new Float32Array([0,1]),2930:!0,3024:!0,36006:null,2886:2305,33170:4352,2849:1,32823:!1,32824:0,10752:0,32938:1,32939:!1,3089:!1,3088:new Int32Array([0,0,1024,1024]),2960:!1,2961:0,2968:4294967295,36005:4294967295,2962:519,2967:0,2963:4294967295,34816:519,36003:0,36004:4294967295,2964:7680,2965:7680,2966:7680,34817:7680,34818:7680,34819:7680,2978:[0,0,1024,1024],3333:4,3317:4,37440:!1,37441:!1,37443:37444,35723:4352,36010:null,35977:!1,3330:0,3332:0,3331:0,3314:0,32878:0,3316:0,3315:0,32877:0},lh=(n,e,t)=>e?n.enable(t):n.disable(t),ZO=(n,e,t)=>n.hint(t,e),ws=(n,e,t)=>n.pixelStorei(t,e),s$=(n,e)=>{const t=vr(n)?36009:36160;return n.bindFramebuffer(t,e)},c$=(n,e)=>n.bindFramebuffer(36008,e);function S_(n){return Array.isArray(n)||ArrayBuffer.isView(n)}const l$={3042:lh,32773:(n,e)=>n.blendColor(...e),32777:"blendEquation",34877:"blendEquation",32969:"blendFunc",32968:"blendFunc",32971:"blendFunc",32970:"blendFunc",3106:(n,e)=>n.clearColor(...e),3107:(n,e)=>n.colorMask(...e),2884:lh,2885:(n,e)=>n.cullFace(e),2929:lh,2931:(n,e)=>n.clearDepth(e),2932:(n,e)=>n.depthFunc(e),2928:(n,e)=>n.depthRange(...e),2930:(n,e)=>n.depthMask(e),3024:lh,35723:ZO,36006:s$,2886:(n,e)=>n.frontFace(e),33170:ZO,2849:(n,e)=>n.lineWidth(e),32823:lh,32824:"polygonOffset",10752:"polygonOffset",35977:lh,32938:"sampleCoverage",32939:"sampleCoverage",3089:lh,3088:(n,e)=>n.scissor(...e),2960:lh,2961:(n,e)=>n.clearStencil(e),2968:(n,e)=>n.stencilMaskSeparate(1028,e),36005:(n,e)=>n.stencilMaskSeparate(1029,e),2962:"stencilFuncFront",2967:"stencilFuncFront",2963:"stencilFuncFront",34816:"stencilFuncBack",36003:"stencilFuncBack",36004:"stencilFuncBack",2964:"stencilOpFront",2965:"stencilOpFront",2966:"stencilOpFront",34817:"stencilOpBack",34818:"stencilOpBack",34819:"stencilOpBack",2978:(n,e)=>n.viewport(...e),3333:ws,3317:ws,37440:ws,37441:ws,37443:ws,3330:ws,3332:ws,3331:ws,36010:c$,3314:ws,32878:ws,3316:ws,3315:ws,32877:ws,framebuffer:(n,e)=>{const t=e&&"handle"in e?e.handle:e;return n.bindFramebuffer(36160,t)},blend:(n,e)=>e?n.enable(3042):n.disable(3042),blendColor:(n,e)=>n.blendColor(...e),blendEquation:(n,e)=>{e=S_(e)?e:[e,e],n.blendEquationSeparate(...e)},blendFunc:(n,e)=>{e=S_(e)&&e.length===2?[...e,...e]:e,n.blendFuncSeparate(...e)},clearColor:(n,e)=>n.clearColor(...e),clearDepth:(n,e)=>n.clearDepth(e),clearStencil:(n,e)=>n.clearStencil(e),colorMask:(n,e)=>n.colorMask(...e),cull:(n,e)=>e?n.enable(2884):n.disable(2884),cullFace:(n,e)=>n.cullFace(e),depthTest:(n,e)=>e?n.enable(2929):n.disable(2929),depthFunc:(n,e)=>n.depthFunc(e),depthMask:(n,e)=>n.depthMask(e),depthRange:(n,e)=>n.depthRange(...e),dither:(n,e)=>e?n.enable(3024):n.disable(3024),derivativeHint:(n,e)=>{n.hint(35723,e)},frontFace:(n,e)=>n.frontFace(e),mipmapHint:(n,e)=>n.hint(33170,e),lineWidth:(n,e)=>n.lineWidth(e),polygonOffsetFill:(n,e)=>e?n.enable(32823):n.disable(32823),polygonOffset:(n,e)=>n.polygonOffset(...e),sampleCoverage:(n,e)=>n.sampleCoverage(...e),scissorTest:(n,e)=>e?n.enable(3089):n.disable(3089),scissor:(n,e)=>n.scissor(...e),stencilTest:(n,e)=>e?n.enable(2960):n.disable(2960),stencilMask:(n,e)=>{e=S_(e)?e:[e,e];const[t,r]=e;n.stencilMaskSeparate(1028,t),n.stencilMaskSeparate(1029,r)},stencilFunc:(n,e)=>{e=S_(e)&&e.length===3?[...e,...e]:e;const[t,r,i,o,a,l]=e;n.stencilFuncSeparate(1028,t,r,i),n.stencilFuncSeparate(1029,o,a,l)},stencilOp:(n,e)=>{e=S_(e)&&e.length===3?[...e,...e]:e;const[t,r,i,o,a,l]=e;n.stencilOpSeparate(1028,t,r,i),n.stencilOpSeparate(1029,o,a,l)},viewport:(n,e)=>n.viewport(...e)};function qi(n,e,t){return e[n]!==void 0?e[n]:t[n]}const u$={blendEquation:(n,e,t)=>n.blendEquationSeparate(qi(32777,e,t),qi(34877,e,t)),blendFunc:(n,e,t)=>n.blendFuncSeparate(qi(32969,e,t),qi(32968,e,t),qi(32971,e,t),qi(32970,e,t)),polygonOffset:(n,e,t)=>n.polygonOffset(qi(32824,e,t),qi(10752,e,t)),sampleCoverage:(n,e,t)=>n.sampleCoverage(qi(32938,e,t),qi(32939,e,t)),stencilFuncFront:(n,e,t)=>n.stencilFuncSeparate(1028,qi(2962,e,t),qi(2967,e,t),qi(2963,e,t)),stencilFuncBack:(n,e,t)=>n.stencilFuncSeparate(1029,qi(34816,e,t),qi(36003,e,t),qi(36004,e,t)),stencilOpFront:(n,e,t)=>n.stencilOpSeparate(1028,qi(2964,e,t),qi(2965,e,t),qi(2966,e,t)),stencilOpBack:(n,e,t)=>n.stencilOpSeparate(1029,qi(34817,e,t),qi(34818,e,t),qi(34819,e,t))},XO={enable:(n,e)=>n({[e]:!0}),disable:(n,e)=>n({[e]:!1}),pixelStorei:(n,e,t)=>n({[e]:t}),hint:(n,e,t)=>n({[e]:t}),bindFramebuffer:(n,e,t)=>{switch(e){case 36160:return n({36006:t,36010:t});case 36009:return n({36006:t});case 36008:return n({36010:t});default:return null}},blendColor:(n,e,t,r,i)=>n({32773:new Float32Array([e,t,r,i])}),blendEquation:(n,e)=>n({32777:e,34877:e}),blendEquationSeparate:(n,e,t)=>n({32777:e,34877:t}),blendFunc:(n,e,t)=>n({32969:e,32968:t,32971:e,32970:t}),blendFuncSeparate:(n,e,t,r,i)=>n({32969:e,32968:t,32971:r,32970:i}),clearColor:(n,e,t,r,i)=>n({3106:new Float32Array([e,t,r,i])}),clearDepth:(n,e)=>n({2931:e}),clearStencil:(n,e)=>n({2961:e}),colorMask:(n,e,t,r,i)=>n({3107:[e,t,r,i]}),cullFace:(n,e)=>n({2885:e}),depthFunc:(n,e)=>n({2932:e}),depthRange:(n,e,t)=>n({2928:new Float32Array([e,t])}),depthMask:(n,e)=>n({2930:e}),frontFace:(n,e)=>n({2886:e}),lineWidth:(n,e)=>n({2849:e}),polygonOffset:(n,e,t)=>n({32824:e,10752:t}),sampleCoverage:(n,e,t)=>n({32938:e,32939:t}),scissor:(n,e,t,r,i)=>n({3088:new Int32Array([e,t,r,i])}),stencilMask:(n,e)=>n({2968:e,36005:e}),stencilMaskSeparate:(n,e,t)=>n({[e===1028?2968:36005]:t}),stencilFunc:(n,e,t,r)=>n({2962:e,2967:t,2963:r,34816:e,36003:t,36004:r}),stencilFuncSeparate:(n,e,t,r,i)=>n({[e===1028?2962:34816]:t,[e===1028?2967:36003]:r,[e===1028?2963:36004]:i}),stencilOp:(n,e,t,r)=>n({2964:e,2965:t,2966:r,34817:e,34818:t,34819:r}),stencilOpSeparate:(n,e,t,r,i)=>n({[e===1028?2964:34817]:t,[e===1028?2965:34818]:r,[e===1028?2966:34819]:i}),viewport:(n,e,t,r,i)=>n({2978:[e,t,r,i]})},Xc=(n,e)=>n.isEnabled(e),QO={3042:Xc,2884:Xc,2929:Xc,3024:Xc,32823:Xc,32926:Xc,32928:Xc,3089:Xc,2960:Xc,35977:Xc};function U5(n){for(const e in n)return!1;return!0}function h$(n,e){if(n===e)return!0;const t=Array.isArray(n)||ArrayBuffer.isView(n),r=Array.isArray(e)||ArrayBuffer.isView(e);if(t&&r&&n.length===e.length){for(let i=0;i<n.length;++i)if(n[i]!==e[i])return!1;return!0}return!1}function JO(n,e){const t=n[e].bind(n);n[e]=function(){const i=arguments.length<=0?void 0:arguments[0];return i in n.state.cache?n.state.enable?n.state.cache[i]:t(...arguments):t(...arguments)},Object.defineProperty(n[e],"name",{value:"".concat(e,"-from-cache"),configurable:!1})}function d$(n,e,t){const r=n[e].bind(n);n[e]=function(){for(var o=arguments.length,a=new Array(o),l=0;l<o;l++)a[l]=arguments[l];const{valueChanged:h,oldValue:p}=t(n.state._updateCache,...a);return h&&r(...a),p},Object.defineProperty(n[e],"name",{value:"".concat(e,"-to-cache"),configurable:!1})}function f$(n){const e=n.useProgram.bind(n);n.useProgram=function(r){n.state.program!==r&&(e(r),n.state.program=r)}}class p${constructor(e){let{copyState:t=!1,log:r=()=>{}}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.gl=e,this.program=null,this.stateStack=[],this.enable=!0,this.cache=t?m$(e):Object.assign({},JP),this.log=r,this._updateCache=this._updateCache.bind(this),Object.seal(this)}push(){this.stateStack.push({})}pop(){Ma(this.stateStack.length>0);const e=this.stateStack[this.stateStack.length-1];bu(this.gl,e),this.stateStack.pop()}_updateCache(e){let t=!1,r;const i=this.stateStack.length>0&&this.stateStack[this.stateStack.length-1];for(const o in e){Ma(o!==void 0);const a=e[o],l=this.cache[o];h$(a,l)||(t=!0,r=l,i&&!(o in i)&&(i[o]=l),this.cache[o]=a)}return{valueChanged:t,oldValue:r}}}function z5(n){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{enable:t=!0,copyState:r}=e;if(Ma(r!==void 0),!n.state){const{polyfillContext:i}=globalThis;i&&i(n),n.state=new p$(n,{copyState:r}),f$(n);for(const o in XO){const a=XO[o];d$(n,o,a)}JO(n,"getParameter"),JO(n,"isEnabled")}return n.state.enable=t,n}function g$(n){n.state||z5(n,{copyState:!1}),n.state.push()}function eL(n){Ma(n.state),n.state.pop()}function bu(n,e){if(Ma(ZE(n),"setParameters requires a WebGL context"),U5(e))return;const t={};for(const i in e){const o=Number(i),a=l$[i];a&&(typeof a=="string"?t[a]=!0:a(n,e[i],o))}const r=n.state&&n.state.cache;if(r)for(const i in t){const o=u$[i];o(n,e,r)}}function m$(n,e){if(e=e||JP,typeof e=="number"){const i=e,o=QO[i];return o?o(n,i):n.getParameter(i)}const t=Array.isArray(e)?e:Object.keys(e),r={};for(const i of t){const o=QO[i];r[i]=o?o(n,Number(i)):n.getParameter(Number(i))}return r}function y$(n){bu(n,JP)}function Ic(n,e,t){if(U5(e))return t(n);const{nocatch:r=!0}=e;g$(n),bu(n,e);let i;if(r)i=t(n),eL(n);else try{i=t(n)}finally{eL(n)}return i}function zm(n){const{luma:e}=n;if(n.canvas&&e){const t=e.canvasSizeInfo,r="clientWidth"in t?t.clientWidth:n.canvas.clientWidth;return r?n.drawingBufferWidth/r:1}return 1}function VS(n,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;const r=zm(n),i=n.drawingBufferWidth,o=n.drawingBufferHeight;return v$(e,r,i,o,t)}function _$(n){const e=typeof window>"u"?1:window.devicePixelRatio||1;return Number.isFinite(n)?n<=0?1:n:n?e:1}function v$(n,e,t,r,i){const o=tL(n[0],e,t);let a=nL(n[1],e,r,i),l=tL(n[0]+1,e,t);const h=l===t-1?l:l-1;l=nL(n[1]+1,e,r,i);let p;return i?(l=l===0?l:l+1,p=a,a=l):p=l===r-1?l:l-1,{x:o,y:a,width:Math.max(h-o+1,1),height:Math.max(p-a+1,1)}}function tL(n,e,t){return Math.min(Math.round(n*e),t-1)}function nL(n,e,t,r){return r?Math.max(0,t-1-Math.round(n*e)):Math.min(Math.round(n*e),t-1)}const eM=Ou(),b$=eM&&typeof document<"u",j5={webgl2:!0,webgl1:!0,throwOnError:!0,manageState:!0,canvas:null,debug:!1,width:800,height:600};function V5(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};Ma(eM,`createGLContext only available in the browser.
Create your own headless context or use 'createHeadlessContext' from @luma.gl/test-utils`),n=Object.assign({},j5,n);const{width:e,height:t}=n;function r(l){if(n.throwOnError)throw new Error(l);return console.error(l),null}n.onError=r;let i;const{canvas:o}=n,a=T$({canvas:o,width:e,height:t,onError:r});return i=E$(a,n),i?(i=tM(i,n),S$(i),i):null}function tM(n){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!n||n._instrumented)return n;n._version=n._version||C$(n),n.luma=n.luma||{},n.luma.canvasSizeInfo=n.luma.canvasSizeInfo||{},e=Object.assign({},j5,e);const{manageState:t,debug:r}=e;return t&&z5(n,{copyState:!1,log:function(){for(var i=arguments.length,o=new Array(i),a=0;a<i;a++)o[a]=arguments[a];return Tn.log(1,...o)()}}),eM&&r&&(globalThis.makeDebugContext?(n=globalThis.makeDebugContext(n,e),Tn.level=Math.max(Tn.level,1)):Tn.warn('WebGL debug mode not activated. import "@luma.gl/debug" to enable.')()),n._instrumented=!0,n}function w$(n){const e=n.getParameter(7936),t=n.getParameter(7937),r=n.getExtension("WEBGL_debug_renderer_info"),i=r&&n.getParameter(r.UNMASKED_VENDOR_WEBGL||7936),o=r&&n.getParameter(r.UNMASKED_RENDERER_WEBGL||7937);return{vendor:i||e,renderer:o||t,vendorMasked:e,rendererMasked:t,version:n.getParameter(7938),shadingLanguageVersion:n.getParameter(35724)}}function x$(n){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(n.canvas){const r=_$(e.useDevicePixels);A$(n,r,e);return}const t=n.getExtension("STACKGL_resize_drawingbuffer");t&&"width"in e&&"height"in e&&t.resize(e.width,e.height)}function E$(n,e){const{onError:t}=e;let r=null;const i=h=>r=h.statusMessage||r;n.addEventListener("webglcontextcreationerror",i,!1);const{webgl1:o=!0,webgl2:a=!0}=e;let l=null;return a&&(l=l||n.getContext("webgl2",e),l=l||n.getContext("experimental-webgl2",e)),o&&(l=l||n.getContext("webgl",e),l=l||n.getContext("experimental-webgl",e)),n.removeEventListener("webglcontextcreationerror",i,!1),l?(e.onContextLost&&n.addEventListener("webglcontextlost",e.onContextLost,!1),e.onContextRestored&&n.addEventListener("webglcontextrestored",e.onContextRestored,!1),l):t("Failed to create ".concat(a&&!o?"WebGL2":"WebGL"," context: ").concat(r||"Unknown error"))}function T$(n){let{canvas:e,width:t=800,height:r=600,onError:i}=n,o;return typeof e=="string"?(b$&&document.readyState==="complete"||i("createGLContext called on canvas '".concat(e,"' before page was loaded")),o=document.getElementById(e)):e?o=e:(o=document.createElement("canvas"),o.id="lumagl-canvas",o.style.width=Number.isFinite(t)?"".concat(t,"px"):"100%",o.style.height=Number.isFinite(r)?"".concat(r,"px"):"100%",document.body.insertBefore(o,document.body.firstChild)),o}function S$(n){const e=vr(n)?"WebGL2":"WebGL1",t=w$(n),r=t?"(".concat(t.vendor,",").concat(t.renderer,")"):"",i=n.debug?" debug":"";Tn.info(1,"".concat(e).concat(i," context ").concat(r))()}function C$(n){return typeof WebGL2RenderingContext<"u"&&n instanceof WebGL2RenderingContext?2:1}function A$(n,e,t){let r="width"in t?t.width:n.canvas.clientWidth,i="height"in t?t.height:n.canvas.clientHeight;(!r||!i)&&(Tn.log(1,"Canvas clientWidth/clientHeight is 0")(),e=1,r=n.canvas.width||1,i=n.canvas.height||1),n.luma=n.luma||{},n.luma.canvasSizeInfo=n.luma.canvasSizeInfo||{};const o=n.luma.canvasSizeInfo;if(o.clientWidth!==r||o.clientHeight!==i||o.devicePixelRatio!==e){let a=e;const l=Math.floor(r*a),h=Math.floor(i*a);n.canvas.width=l,n.canvas.height=h,(n.drawingBufferWidth!==l||n.drawingBufferHeight!==h)&&(Tn.warn("Device pixel ratio clamped")(),a=Math.min(n.drawingBufferWidth/r,n.drawingBufferHeight/i),n.canvas.width=Math.floor(r*a),n.canvas.height=Math.floor(i*a)),Object.assign(n.luma.canvasSizeInfo,{clientWidth:r,clientHeight:i,devicePixelRatio:e})}}const zv="8.5.21",I$="set luma.log.level=1 (or higher) to trace rendering";class P${constructor(){this.stats=new Map}get(e){return this.stats.has(e)||this.stats.set(e,new $P({id:e})),this.stats.get(e)}}const gf=new P$;if(globalThis.luma&&globalThis.luma.VERSION!==zv)throw new Error("luma.gl - multiple VERSIONs detected: ".concat(globalThis.luma.VERSION," vs ").concat(zv));globalThis.luma||(Ou()&&Tn.log(1,"luma.gl ".concat(zv," - ").concat(I$))(),globalThis.luma=globalThis.luma||{VERSION:zv,version:zv,log:Tn,stats:gf,globals:{modules:{},nodeIO:{}}});function M$(n){return typeof window<"u"&&window.requestAnimationFrame?window.requestAnimationFrame(n):setTimeout(n,1e3/60)}function R$(n){return typeof window<"u"&&window.cancelAnimationFrame?window.cancelAnimationFrame(n):clearTimeout(n)}function Jt(n,e){if(!n)throw new Error(e||"luma.gl: assertion failed.")}function HS(n,e){if(typeof e!="string")return e;const t=Number(e);if(!isNaN(t))return t;e=e.replace(/^.*\./,"");const r=n[e];return Jt(r!==void 0,"Accessing undefined constant GL.".concat(e)),r}function $h(n,e){e=Number(e);for(const t in n)if(n[t]===e)return"GL.".concat(t);return String(e)}const GS={};function rd(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"id";GS[n]=GS[n]||1;const e=GS[n]++;return"".concat(n,"-").concat(e)}function rL(n){return Jt(typeof n=="number","Input must be a number"),n&&(n&n-1)===0}function jm(n){let e=!0;for(const t in n){e=!1;break}return e}function H5(n,e,t,r){const i="See luma.gl ".concat(t," Upgrade Guide at https://luma.gl/docs/upgrade-guide"),o=Object.getPrototypeOf(n);r.forEach(a=>{o.methodName||(o[a]=()=>{throw Tn.removed("Calling removed method ".concat(e,".").concat(a,": "),i)(),new Error(a)})})}const pg="Resource subclass must define virtual methods";let Lu=class{get[Symbol.toStringTag](){return"Resource"}constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};XE(e);const{id:r,userData:i={}}=t;this.gl=e,this.gl2=e,this.id=r||rd(this[Symbol.toStringTag]),this.userData=i,this._bound=!1,this._handle=t.handle,this._handle===void 0&&(this._handle=this._createHandle()),this.byteLength=0,this._addStats()}toString(){return"".concat(this[Symbol.toStringTag]||this.constructor.name,"(").concat(this.id,")")}get handle(){return this._handle}delete(){let{deleteChildren:e=!1}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const t=this._handle&&this._deleteHandle(this._handle);return this._handle&&this._removeStats(),this._handle=null,t&&e&&t.filter(Boolean).forEach(r=>r.delete()),this}bind(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.handle;if(typeof e!="function")return this._bindHandle(e),this;let t;return this._bound?t=e():(this._bindHandle(this.handle),this._bound=!0,t=e(),this._bound=!1,this._bindHandle(null)),t}unbind(){this.bind(null)}getParameter(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};e=HS(this.gl,e),Jt(e);const i=(this.constructor.PARAMETERS||{})[e];if(i){const o=vr(this.gl);if(!((!("webgl2"in i)||o)&&(!("extension"in i)||this.gl.getExtension(i.extension)))){const l=i.webgl1,h="webgl2"in i?i.webgl2:i.webgl1;return o?h:l}}return this._getParameter(e,t)}getParameters(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{parameters:t,keys:r}=e,i=this.constructor.PARAMETERS||{},o=vr(this.gl),a={},l=t||Object.keys(i);for(const h of l){const p=i[h];if(p&&(!("webgl2"in p)||o)&&(!("extension"in p)||this.gl.getExtension(p.extension))){const _=r?$h(this.gl,h):h;a[_]=this.getParameter(h,e),r&&p.type==="GLenum"&&(a[_]=$h(this.gl,a[_]))}}return a}setParameter(e,t){e=HS(this.gl,e),Jt(e);const i=(this.constructor.PARAMETERS||{})[e];if(i){const o=vr(this.gl);if(!((!("webgl2"in i)||o)&&(!("extension"in i)||this.gl.getExtension(i.extension))))throw new Error("Parameter not available on this platform");i.type==="GLenum"&&(t=HS(t))}return this._setParameter(e,t),this}setParameters(e){for(const t in e)this.setParameter(t,e[t]);return this}stubRemovedMethods(e,t,r){return H5(this,e,t,r)}initialize(e){}_createHandle(){throw new Error(pg)}_deleteHandle(){throw new Error(pg)}_bindHandle(e){throw new Error(pg)}_getOptsFromHandle(){throw new Error(pg)}_getParameter(e,t){throw new Error(pg)}_setParameter(e,t){throw new Error(pg)}_context(){return this.gl.luma=this.gl.luma||{},this.gl.luma}_addStats(){const e=this[Symbol.toStringTag],t=gf.get("Resource Counts");t.get("Resources Created").incrementCount(),t.get("".concat(e,"s Created")).incrementCount(),t.get("".concat(e,"s Active")).incrementCount()}_removeStats(){const e=this[Symbol.toStringTag];gf.get("Resource Counts").get("".concat(e,"s Active")).decrementCount()}_trackAllocatedMemory(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this[Symbol.toStringTag];this._trackAllocatedMemoryForContext(e,t),this._trackAllocatedMemoryForContext(e,t,this.gl.canvas&&this.gl.canvas.id),this.byteLength=e}_trackAllocatedMemoryForContext(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this[Symbol.toStringTag],r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"";const i=gf.get("Memory Usage".concat(r));i.get("GPU Memory").addCount(e),i.get("".concat(t," Memory")).addCount(e)}_trackDeallocatedMemory(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this[Symbol.toStringTag];this._trackDeallocatedMemoryForContext(e),this._trackDeallocatedMemoryForContext(e,this.gl.canvas&&this.gl.canvas.id),this.byteLength=0}_trackDeallocatedMemoryForContext(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this[Symbol.toStringTag],t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";const r=gf.get("Memory Usage".concat(t));r.get("GPU Memory").subtractCount(this.byteLength),r.get("".concat(e," Memory")).subtractCount(this.byteLength)}};const k$="Failed to deduce GL constant from typed array";function T2(n){switch(ArrayBuffer.isView(n)?n.constructor:n){case Float32Array:return 5126;case Uint16Array:return 5123;case Uint32Array:return 5125;case Uint8Array:return 5121;case Uint8ClampedArray:return 5121;case Int8Array:return 5120;case Int16Array:return 5122;case Int32Array:return 5124;default:throw new Error(k$)}}function p0(n){let{clamped:e=!0}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};switch(n){case 5126:return Float32Array;case 5123:case 33635:case 32819:case 32820:return Uint16Array;case 5125:return Uint32Array;case 5121:return e?Uint8ClampedArray:Uint8Array;case 5120:return Int8Array;case 5122:return Int16Array;case 5124:return Int32Array;default:throw new Error("Failed to deduce typed array type from GL constant")}}function O$(n){let{data:e,width:t,height:r,bytesPerPixel:i=4,temp:o}=n;const a=t*i;o=o||new Uint8Array(a);for(let l=0;l<r/2;++l){const h=l*a,p=(r-l-1)*a;o.set(e.subarray(h,h+a)),e.copyWithin(h,p,p+a),e.set(o,p)}}function L$(n){let{data:e,width:t,height:r}=n;const i=Math.round(t/2),o=Math.round(r/2),a=new Uint8Array(i*o*4);for(let l=0;l<o;l++)for(let h=0;h<i;h++)for(let p=0;p<4;p++)a[(l*i+h)*4+p]=e[(l*2*t+h*2)*4+p];return{data:a,width:i,height:o}}function S2(n,e,t){const{removedProps:r={},deprecatedProps:i={},replacedProps:o={}}=t;for(const l in r)if(l in e){const p=r[l]?"".concat(n,".").concat(r[l]):"N/A";Tn.removed("".concat(n,".").concat(l),p)()}for(const l in i)if(l in e){const h=i[l];Tn.deprecated("".concat(n,".").concat(l),"".concat(n,".").concat(h))()}let a=null;for(const l in o)if(l in e){const h=o[l];Tn.deprecated("".concat(n,".").concat(l),"".concat(n,".").concat(h))(),a=a||Object.assign({},e),a[h]=e[l],delete a[l]}return a||e}const N$={offset:0,stride:0,type:5126,size:1,divisor:0,normalized:!1,integer:!1},D$={deprecatedProps:{instanced:"divisor",isInstanced:"divisor"}};class Rs{static getBytesPerElement(e){return p0(e.type||5126).BYTES_PER_ELEMENT}static getBytesPerVertex(e){return Jt(e.size),p0(e.type||5126).BYTES_PER_ELEMENT*e.size}static resolve(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return new Rs(N$,...t)}constructor(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];t.forEach(i=>this._assign(i)),Object.freeze(this)}toString(){return JSON.stringify(this)}get BYTES_PER_ELEMENT(){return Rs.getBytesPerElement(this)}get BYTES_PER_VERTEX(){return Rs.getBytesPerVertex(this)}_assign(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return e=S2("Accessor",e,D$),e.type!==void 0&&(this.type=e.type,(e.type===5124||e.type===5125)&&(this.integer=!0)),e.size!==void 0&&(this.size=e.size),e.offset!==void 0&&(this.offset=e.offset),e.stride!==void 0&&(this.stride=e.stride),e.normalized!==void 0&&(this.normalized=e.normalized),e.integer!==void 0&&(this.integer=e.integer),e.divisor!==void 0&&(this.divisor=e.divisor),e.buffer!==void 0&&(this.buffer=e.buffer),e.index!==void 0&&(typeof e.index=="boolean"?this.index=e.index?1:0:this.index=e.index),e.instanced!==void 0&&(this.divisor=e.instanced?1:0),e.isInstanced!==void 0&&(this.divisor=e.isInstanced?1:0),this}}const iL=10,G5={offset:"accessor.offset",stride:"accessor.stride",type:"accessor.type",size:"accessor.size",divisor:"accessor.divisor",normalized:"accessor.normalized",integer:"accessor.integer",instanced:"accessor.divisor",isInstanced:"accessor.divisor"},F$={removedProps:{},replacedProps:{bytes:"byteLength"},deprecatedProps:G5},B$={removedProps:G5};class ui extends Lu{get[Symbol.toStringTag](){return"Buffer"}constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(e,t),this.stubRemovedMethods("Buffer","v6.0",["layout","setLayout","getIndexedParameter"]),this.target=t.target||(this.gl.webgl2?36662:34962),this.initialize(t),Object.seal(this)}getElementCount(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.accessor;return Math.round(this.byteLength/Rs.getBytesPerElement(e))}getVertexCount(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.accessor;return Math.round(this.byteLength/Rs.getBytesPerVertex(e))}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return ArrayBuffer.isView(e)&&(e={data:e}),Number.isFinite(e)&&(e={byteLength:e}),e=S2("Buffer",e,F$),this.usage=e.usage||35044,this.debugData=null,this.setAccessor(Object.assign({},e,e.accessor)),e.data?this._setData(e.data,e.offset,e.byteLength):this._setByteLength(e.byteLength||0),this}setProps(e){return e=S2("Buffer",e,B$),"accessor"in e&&this.setAccessor(e.accessor),this}setAccessor(e){return e=Object.assign({},e),delete e.buffer,this.accessor=new Rs(e),this}reallocate(e){return e>this.byteLength?(this._setByteLength(e),!0):(this.bytesUsed=e,!1)}setData(e){return this.initialize(e)}subData(e){ArrayBuffer.isView(e)&&(e={data:e});const{data:t,offset:r=0,srcOffset:i=0}=e,o=e.byteLength||e.length;Jt(t);const a=this.gl.webgl2?36663:this.target;return this.gl.bindBuffer(a,this.handle),i!==0||o!==void 0?(ga(this.gl),this.gl.bufferSubData(this.target,r,t,i,o)):this.gl.bufferSubData(a,r,t),this.gl.bindBuffer(a,null),this.debugData=null,this._inferType(t),this}copyData(e){let{sourceBuffer:t,readOffset:r=0,writeOffset:i=0,size:o}=e;const{gl:a}=this;return ga(a),a.bindBuffer(36662,t.handle),a.bindBuffer(36663,this.handle),a.copyBufferSubData(36662,36663,r,i,o),a.bindBuffer(36662,null),a.bindBuffer(36663,null),this.debugData=null,this}getData(){let{dstData:e=null,srcByteOffset:t=0,dstOffset:r=0,length:i=0}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};ga(this.gl);const o=p0(this.accessor.type||5126,{clamped:!1}),a=this._getAvailableElementCount(t),l=r;let h,p;e?(p=e.length,h=p-l):(h=Math.min(a,i||a),p=l+h);const g=Math.min(a,h);return i=i||g,Jt(i<=g),e=e||new o(p),this.gl.bindBuffer(36662,this.handle),this.gl.getBufferSubData(36662,t,e,r,i),this.gl.bindBuffer(36662,null),e}bind(){let{target:e=this.target,index:t=this.accessor&&this.accessor.index,offset:r=0,size:i}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return e===35345||e===35982?i!==void 0?this.gl.bindBufferRange(e,t,this.handle,r,i):(Jt(r===0),this.gl.bindBufferBase(e,t,this.handle)):this.gl.bindBuffer(e,this.handle),this}unbind(){let{target:e=this.target,index:t=this.accessor&&this.accessor.index}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return e===35345||e===35982?this.gl.bindBufferBase(e,t,null):this.gl.bindBuffer(e,null),this}getDebugData(){return this.debugData?{data:this.debugData,changed:!1}:(this.debugData=this.getData({length:Math.min(iL,this.byteLength)}),{data:this.debugData,changed:!0})}invalidateDebugData(){this.debugData=null}_setData(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:e.byteLength+t;Jt(ArrayBuffer.isView(e)),this._trackDeallocatedMemory();const i=this._getTarget();this.gl.bindBuffer(i,this.handle),this.gl.bufferData(i,r,this.usage),this.gl.bufferSubData(i,t,e),this.gl.bindBuffer(i,null),this.debugData=e.slice(0,iL),this.bytesUsed=r,this._trackAllocatedMemory(r);const o=T2(e);return Jt(o),this.setAccessor(new Rs(this.accessor,{type:o})),this}_setByteLength(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.usage;Jt(e>=0),this._trackDeallocatedMemory();let r=e;e===0&&(r=new Float32Array(0));const i=this._getTarget();return this.gl.bindBuffer(i,this.handle),this.gl.bufferData(i,r,t),this.gl.bindBuffer(i,null),this.usage=t,this.debugData=null,this.bytesUsed=e,this._trackAllocatedMemory(e),this}_getTarget(){return this.gl.webgl2?36663:this.target}_getAvailableElementCount(e){const t=p0(this.accessor.type||5126,{clamped:!1}),r=e/t.BYTES_PER_ELEMENT;return this.getElementCount()-r}_inferType(e){this.accessor.type||this.setAccessor(new Rs(this.accessor,{type:T2(e)}))}_createHandle(){return this.gl.createBuffer()}_deleteHandle(){this.gl.deleteBuffer(this.handle),this._trackDeallocatedMemory()}_getParameter(e){this.gl.bindBuffer(this.target,this.handle);const t=this.gl.getBufferParameter(this.target,e);return this.gl.bindBuffer(this.target,null),t}get type(){return Tn.deprecated("Buffer.type","Buffer.accessor.type")(),this.accessor.type}get bytes(){return Tn.deprecated("Buffer.bytes","Buffer.byteLength")(),this.byteLength}setByteLength(e){return Tn.deprecated("setByteLength","reallocate")(),this.reallocate(e)}updateAccessor(e){return Tn.deprecated("updateAccessor(...)","setAccessor(new Accessor(buffer.accessor, ...)")(),this.accessor=new Rs(this.accessor,e),this}}const nM={6407:{dataFormat:6407,types:[5121,33635]},6408:{dataFormat:6408,types:[5121,32819,32820]},6406:{dataFormat:6406,types:[5121]},6409:{dataFormat:6409,types:[5121]},6410:{dataFormat:6410,types:[5121]},33326:{dataFormat:6403,types:[5126],gl2:!0},33328:{dataFormat:33319,types:[5126],gl2:!0},34837:{dataFormat:6407,types:[5126],gl2:!0},34836:{dataFormat:6408,types:[5126],gl2:!0}},q5={6403:1,36244:1,33319:2,33320:2,6407:3,36248:3,6408:4,36249:4,6402:1,34041:1,6406:1,6409:1,6410:2},$5={5126:4,5125:4,5124:4,5123:2,5122:2,5131:2,5120:1,5121:1};function U$(n,e){const t=nM[e];if(!t)return!1;if(t.gl1===void 0&&t.gl2===void 0)return!0;const r=vr(n)&&t.gl2||t.gl1;return typeof r=="string"?n.getExtension(r):r}function z$(n,e){const t=nM[e];switch(t&&t.types[0]){case 5126:return n.getExtension("OES_texture_float_linear");case 5131:return n.getExtension("OES_texture_half_float_linear");default:return!0}}const j$=[9729,9728],oL=globalThis.WebGLBuffer||function(){};class zf extends Lu{get[Symbol.toStringTag](){return"Texture"}static isSupported(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{format:r,linearFiltering:i}=t;let o=!0;return r&&(o=o&&U$(e,r),o=o&&(!i||z$(e,r))),o}constructor(e,t){const{id:r=rd("texture"),handle:i,target:o}=t;super(e,{id:r,handle:i}),this.target=o,this.textureUnit=void 0,this.loaded=!1,this.width=void 0,this.height=void 0,this.depth=void 0,this.format=void 0,this.type=void 0,this.dataFormat=void 0,this.border=void 0,this.textureUnit=void 0,this.mipmaps=void 0}toString(){return"Texture(".concat(this.id,",").concat(this.width,"x").concat(this.height,")")}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=e.data;if(t instanceof Promise)return t.then(te=>this.initialize(Object.assign({},e,{pixels:te,data:te}))),this;const r=typeof HTMLVideoElement<"u"&&t instanceof HTMLVideoElement;if(r&&t.readyState<HTMLVideoElement.HAVE_METADATA)return this._video=null,t.addEventListener("loadeddata",()=>this.initialize(e)),this;const{pixels:i=null,format:o=6408,border:a=0,recreate:l=!1,parameters:h={},pixelStore:p={},textureUnit:g=void 0}=e;t||(t=i);let{width:_,height:x,dataFormat:C,type:M,compressed:L=!1,mipmaps:D=!0}=e;const{depth:z=0}=e;return{width:_,height:x,compressed:L,dataFormat:C,type:M}=this._deduceParameters({format:o,type:M,dataFormat:C,compressed:L,data:t,width:_,height:x}),this.width=_,this.height=x,this.depth=z,this.format=o,this.type=M,this.dataFormat=C,this.border=a,this.textureUnit=g,Number.isFinite(this.textureUnit)&&(this.gl.activeTexture(33984+this.textureUnit),this.gl.bindTexture(this.target,this.handle)),D&&this._isNPOT()&&(Tn.warn("texture: ".concat(this," is Non-Power-Of-Two, disabling mipmaping"))(),D=!1,this._updateForNPOT(h)),this.mipmaps=D,this.setImageData({data:t,width:_,height:x,depth:z,format:o,type:M,dataFormat:C,border:a,mipmaps:D,parameters:p,compressed:L}),D&&this.generateMipmap(),this.setParameters(h),l&&(this.data=t),r&&(this._video={video:t,parameters:h,lastTime:t.readyState>=HTMLVideoElement.HAVE_CURRENT_DATA?t.currentTime:-1}),this}update(){if(this._video){const{video:e,parameters:t,lastTime:r}=this._video;if(r===e.currentTime||e.readyState<HTMLVideoElement.HAVE_CURRENT_DATA)return;this.setSubImageData({data:e,parameters:t}),this.mipmaps&&this.generateMipmap(),this._video.lastTime=e.currentTime}}resize(e){let{height:t,width:r,mipmaps:i=!1}=e;return r!==this.width||t!==this.height?this.initialize({width:r,height:t,format:this.format,type:this.type,dataFormat:this.dataFormat,border:this.border,mipmaps:i}):this}generateMipmap(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this._isNPOT()?(Tn.warn("texture: ".concat(this," is Non-Power-Of-Two, disabling mipmaping"))(),this):(this.mipmaps=!0,this.gl.bindTexture(this.target,this.handle),Ic(this.gl,e,()=>{this.gl.generateMipmap(this.target)}),this.gl.bindTexture(this.target,null),this)}setImageData(e){this._trackDeallocatedMemory("Texture");const{target:t=this.target,pixels:r=null,level:i=0,format:o=this.format,border:a=this.border,offset:l=0,parameters:h={}}=e;let{data:p=null,type:g=this.type,width:_=this.width,height:x=this.height,dataFormat:C=this.dataFormat,compressed:M=!1}=e;p||(p=r),{type:g,dataFormat:C,compressed:M,width:_,height:x}=this._deduceParameters({format:o,type:g,dataFormat:C,compressed:M,data:p,width:_,height:x});const{gl:L}=this;L.bindTexture(this.target,this.handle);let D=null;({data:p,dataType:D}=this._getDataType({data:p,compressed:M}));let z,te=0;if(Ic(this.gl,h,()=>{switch(D){case"null":L.texImage2D(t,i,o,_,x,a,C,g,p);break;case"typed-array":L.texImage2D(t,i,o,_,x,a,C,g,p,l);break;case"buffer":z=ga(L),z.bindBuffer(35052,p.handle||p),z.texImage2D(t,i,o,_,x,a,C,g,l),z.bindBuffer(35052,null);break;case"browser-object":vr(L)?L.texImage2D(t,i,o,_,x,a,C,g,p):L.texImage2D(t,i,o,C,g,p);break;case"compressed":for(const[le,ce]of p.entries())L.compressedTexImage2D(t,le,ce.format,ce.width,ce.height,a,ce.data),te+=ce.levelSize;break;default:Jt(!1,"Unknown image data type")}}),D==="compressed")this._trackAllocatedMemory(te,"Texture");else if(p&&p.byteLength)this._trackAllocatedMemory(p.byteLength,"Texture");else{const le=q5[this.dataFormat]||4,ce=$5[this.type]||1;this._trackAllocatedMemory(this.width*this.height*le*ce,"Texture")}return this.loaded=!0,this}setSubImageData(e){let{target:t=this.target,pixels:r=null,data:i=null,x:o=0,y:a=0,width:l=this.width,height:h=this.height,level:p=0,format:g=this.format,type:_=this.type,dataFormat:x=this.dataFormat,compressed:C=!1,offset:M=0,border:L=this.border,parameters:D={}}=e;if({type:_,dataFormat:x,compressed:C,width:l,height:h}=this._deduceParameters({format:g,type:_,dataFormat:x,compressed:C,data:i,width:l,height:h}),Jt(this.depth===0,"texSubImage not supported for 3D textures"),i||(i=r),i&&i.data){const z=i;i=z.data,l=z.shape[0],h=z.shape[1]}i instanceof ui&&(i=i.handle),this.gl.bindTexture(this.target,this.handle),Ic(this.gl,D,()=>{if(C)this.gl.compressedTexSubImage2D(t,p,o,a,l,h,g,i);else if(i===null)this.gl.texSubImage2D(t,p,o,a,l,h,x,_,null);else if(ArrayBuffer.isView(i))this.gl.texSubImage2D(t,p,o,a,l,h,x,_,i,M);else if(i instanceof oL){const z=ga(this.gl);z.bindBuffer(35052,i),z.texSubImage2D(t,p,o,a,l,h,x,_,M),z.bindBuffer(35052,null)}else vr(this.gl)?ga(this.gl).texSubImage2D(t,p,o,a,l,h,x,_,i):this.gl.texSubImage2D(t,p,o,a,x,_,i)}),this.gl.bindTexture(this.target,null)}copyFramebuffer(){return Tn.error("Texture.copyFramebuffer({...}) is no logner supported, use copyToTexture(source, target, opts})")(),null}getActiveUnit(){return this.gl.getParameter(34016)-33984}bind(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.textureUnit;const{gl:t}=this;return e!==void 0&&(this.textureUnit=e,t.activeTexture(33984+e)),t.bindTexture(this.target,this.handle),e}unbind(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.textureUnit;const{gl:t}=this;return e!==void 0&&(this.textureUnit=e,t.activeTexture(33984+e)),t.bindTexture(this.target,null),e}_getDataType(e){let{data:t,compressed:r=!1}=e;return r?{data:t,dataType:"compressed"}:t===null?{data:t,dataType:"null"}:ArrayBuffer.isView(t)?{data:t,dataType:"typed-array"}:t instanceof ui?{data:t.handle,dataType:"buffer"}:t instanceof oL?{data:t,dataType:"buffer"}:{data:t,dataType:"browser-object"}}_deduceParameters(e){const{format:t,data:r}=e;let{width:i,height:o,dataFormat:a,type:l,compressed:h}=e;const p=nM[t];return a=a||p&&p.dataFormat,l=l||p&&p.types[0],h=h||p&&p.compressed,{width:i,height:o}=this._deduceImageSize(r,i,o),{dataFormat:a,type:l,compressed:h,width:i,height:o,format:t,data:r}}_deduceImageSize(e,t,r){let i;return typeof ImageData<"u"&&e instanceof ImageData?i={width:e.width,height:e.height}:typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement?i={width:e.naturalWidth,height:e.naturalHeight}:typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement?i={width:e.width,height:e.height}:typeof ImageBitmap<"u"&&e instanceof ImageBitmap?i={width:e.width,height:e.height}:typeof HTMLVideoElement<"u"&&e instanceof HTMLVideoElement?i={width:e.videoWidth,height:e.videoHeight}:e?i={width:t,height:r}:i={width:t>=0?t:1,height:r>=0?r:1},Jt(i,"Could not deduced texture size"),Jt(t===void 0||i.width===t,"Deduced texture width does not match supplied width"),Jt(r===void 0||i.height===r,"Deduced texture height does not match supplied height"),i}_createHandle(){return this.gl.createTexture()}_deleteHandle(){this.gl.deleteTexture(this.handle),this._trackDeallocatedMemory("Texture")}_getParameter(e){switch(e){case 4096:return this.width;case 4097:return this.height;default:this.gl.bindTexture(this.target,this.handle);const t=this.gl.getTexParameter(this.target,e);return this.gl.bindTexture(this.target,null),t}}_setParameter(e,t){switch(this.gl.bindTexture(this.target,this.handle),t=this._getNPOTParam(e,t),e){case 33082:case 33083:this.gl.texParameterf(this.handle,e,t);break;case 4096:case 4097:Jt(!1);break;default:this.gl.texParameteri(this.target,e,t);break}return this.gl.bindTexture(this.target,null),this}_isNPOT(){return vr(this.gl)||!this.width||!this.height?!1:!rL(this.width)||!rL(this.height)}_updateForNPOT(e){e[this.gl.TEXTURE_MIN_FILTER]===void 0&&(e[this.gl.TEXTURE_MIN_FILTER]=this.gl.LINEAR),e[this.gl.TEXTURE_WRAP_S]===void 0&&(e[this.gl.TEXTURE_WRAP_S]=this.gl.CLAMP_TO_EDGE),e[this.gl.TEXTURE_WRAP_T]===void 0&&(e[this.gl.TEXTURE_WRAP_T]=this.gl.CLAMP_TO_EDGE)}_getNPOTParam(e,t){if(this._isNPOT())switch(e){case 10241:j$.indexOf(t)===-1&&(t=9729);break;case 10242:case 10243:t!==33071&&(t=33071);break}return t}}let V$="";function H$(n,e){return Jt(typeof n=="string"),n=V$+n,new Promise((t,r)=>{try{const i=new Image;i.onload=()=>t(i),i.onerror=()=>r(new Error("Could not load image ".concat(n,"."))),i.crossOrigin=e&&e.crossOrigin||"anonymous",i.src=n}catch(i){r(i)}})}class Bs extends zf{get[Symbol.toStringTag](){return"Texture2D"}static isSupported(e,t){return zf.isSupported(e,t)}constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};XE(e),(t instanceof Promise||typeof t=="string")&&(t={data:t}),typeof t.data=="string"&&(t=Object.assign({},t,{data:H$(t.data)})),super(e,Object.assign({},t,{target:3553})),this.initialize(t),Object.seal(this)}}const C2=[34069,34070,34071,34072,34073,34074];class W5 extends zf{get[Symbol.toStringTag](){return"TextureCube"}constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};XE(e),super(e,Object.assign({},t,{target:34067})),this.initialize(t),Object.seal(this)}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{mipmaps:t=!0,parameters:r={}}=e;return this.opts=e,this.setCubeMapImageData(e).then(()=>{this.loaded=!0,t&&this.generateMipmap(e),this.setParameters(r)}),this}subImage(e){let{face:t,data:r,x:i=0,y:o=0,mipmapLevel:a=0}=e;return this._subImage({target:t,data:r,x:i,y:o,mipmapLevel:a})}async setCubeMapImageData(e){let{width:t,height:r,pixels:i,data:o,border:a=0,format:l=6408,type:h=5121}=e;const{gl:p}=this,g=i||o,_=await Promise.all(C2.map(x=>{const C=g[x];return Promise.all(Array.isArray(C)?C:[C])}));this.bind(),C2.forEach((x,C)=>{_[C].length>1&&this.opts.mipmaps!==!1&&Tn.warn("".concat(this.id," has mipmap and multiple LODs."))(),_[C].forEach((M,L)=>{t&&r?p.texImage2D(x,L,l,t,r,a,l,h,M):p.texImage2D(x,L,l,l,h,M)})}),this.unbind()}setImageDataForFace(e){const{face:t,width:r,height:i,pixels:o,data:a,border:l=0,format:h=6408,type:p=5121}=e,{gl:g}=this,_=o||a;return this.bind(),_ instanceof Promise?_.then(x=>this.setImageDataForFace(Object.assign({},e,{face:t,data:x,pixels:x}))):this.width||this.height?g.texImage2D(t,0,h,r,i,l,h,p,_):g.texImage2D(t,0,h,h,p,_),this}}W5.FACES=C2;class G$ extends zf{get[Symbol.toStringTag](){return"Texture3D"}static isSupported(e){return vr(e)}constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};ga(e),t=Object.assign({depth:1},t,{target:32879,unpackFlipY:!1}),super(e,t),this.initialize(t),Object.seal(this)}setImageData(e){let{level:t=0,dataFormat:r=6408,width:i,height:o,depth:a=1,border:l=0,format:h,type:p=5121,offset:g=0,data:_,parameters:x={}}=e;if(this._trackDeallocatedMemory("Texture"),this.gl.bindTexture(this.target,this.handle),Ic(this.gl,x,()=>{ArrayBuffer.isView(_)&&this.gl.texImage3D(this.target,t,r,i,o,a,l,h,p,_),_ instanceof ui&&(this.gl.bindBuffer(35052,_.handle),this.gl.texImage3D(this.target,t,r,i,o,a,l,h,p,g))}),_&&_.byteLength)this._trackAllocatedMemory(_.byteLength,"Texture");else{const C=q5[this.dataFormat]||4,M=$5[this.type]||1;this._trackAllocatedMemory(this.width*this.height*this.depth*C*M,"Texture")}return this.loaded=!0,this}}const zd="EXT_color_buffer_float",aL={33189:{bpp:2},33190:{gl2:!0,bpp:3},36012:{gl2:!0,bpp:4},36168:{bpp:1},34041:{bpp:4},35056:{gl2:!0,bpp:4},36013:{gl2:!0,bpp:5},32854:{bpp:2},36194:{bpp:2},32855:{bpp:2},33321:{gl2:!0,bpp:1},33330:{gl2:!0,bpp:1},33329:{gl2:!0,bpp:1},33332:{gl2:!0,bpp:2},33331:{gl2:!0,bpp:2},33334:{gl2:!0,bpp:4},33333:{gl2:!0,bpp:4},33323:{gl2:!0,bpp:2},33336:{gl2:!0,bpp:2},33335:{gl2:!0,bpp:2},33338:{gl2:!0,bpp:4},33337:{gl2:!0,bpp:4},33340:{gl2:!0,bpp:8},33339:{gl2:!0,bpp:8},32849:{gl2:!0,bpp:3},32856:{gl2:!0,bpp:4},32857:{gl2:!0,bpp:4},36220:{gl2:!0,bpp:4},36238:{gl2:!0,bpp:4},36975:{gl2:!0,bpp:4},36214:{gl2:!0,bpp:8},36232:{gl2:!0,bpp:8},36226:{gl2:!0,bpp:16},36208:{gl2:!0,bpp:16},33325:{gl2:zd,bpp:2},33327:{gl2:zd,bpp:4},34842:{gl2:zd,bpp:8},33326:{gl2:zd,bpp:4},33328:{gl2:zd,bpp:8},34836:{gl2:zd,bpp:16},35898:{gl2:zd,bpp:4}};function q$(n,e,t){const r=t[e];if(!r)return!1;const i=vr(n)&&r.gl2||r.gl1;return typeof i=="string"?n.getExtension(i):i}class Xg extends Lu{get[Symbol.toStringTag](){return"Renderbuffer"}static isSupported(e){let{format:t}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{format:null};return!t||q$(e,t,aL)}static getSamplesForFormat(e,t){let{format:r}=t;return e.getInternalformatParameter(36161,r,32937)}constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(e,t),this.initialize(t),Object.seal(this)}initialize(e){let{format:t,width:r=1,height:i=1,samples:o=0}=e;return Jt(t,"Needs format"),this._trackDeallocatedMemory(),this.gl.bindRenderbuffer(36161,this.handle),o!==0&&vr(this.gl)?this.gl.renderbufferStorageMultisample(36161,o,t,r,i):this.gl.renderbufferStorage(36161,t,r,i),this.format=t,this.width=r,this.height=i,this.samples=o,this._trackAllocatedMemory(this.width*this.height*(this.samples||1)*aL[this.format].bpp),this}resize(e){let{width:t,height:r}=e;return t!==this.width||r!==this.height?this.initialize({width:t,height:r,format:this.format,samples:this.samples}):this}_createHandle(){return this.gl.createRenderbuffer()}_deleteHandle(){this.gl.deleteRenderbuffer(this.handle),this._trackDeallocatedMemory()}_bindHandle(e){this.gl.bindRenderbuffer(36161,e)}_syncHandle(e){this.format=this.getParameter(36164),this.width=this.getParameter(36162),this.height=this.getParameter(36163),this.samples=this.getParameter(36011)}_getParameter(e){return this.gl.bindRenderbuffer(36161,this.handle),this.gl.getRenderbufferParameter(36161,e)}}const $$=256,W$=1024,Y$=16384,sL=6144,cL=6145,lL=6146,uL=34041,Y5="clear: bad arguments";function rM(n){let{framebuffer:e=null,color:t=null,depth:r=null,stencil:i=null}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const o={};e&&(o.framebuffer=e);let a=0;t&&(a|=Y$,t!==!0&&(o.clearColor=t)),r&&(a|=$$,r!==!0&&(o.clearDepth=r)),i&&(a|=W$,r!==!0&&(o.clearStencil=r)),Jt(a!==0,Y5),Ic(n,o,()=>{n.clear(a)})}function K$(n){let{framebuffer:e=null,buffer:t=sL,drawBuffer:r=0,value:i=[0,0,0,0]}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};ga(n),Ic(n,{framebuffer:e},()=>{switch(t){case sL:switch(i.constructor){case Int32Array:n.clearBufferiv(t,r,i);break;case Uint32Array:n.clearBufferuiv(t,r,i);break;case Float32Array:default:n.clearBufferfv(t,r,i)}break;case cL:n.clearBufferfv(cL,0,[i]);break;case lL:n.clearBufferiv(lL,0,[i]);break;case uL:const[o,a]=i;n.clearBufferfi(uL,0,o,a);break;default:Jt(!1,Y5)}})}function Z$(n){switch(n){case 6406:case 33326:case 6403:return 1;case 33328:case 33319:return 2;case 6407:case 34837:return 3;case 6408:case 34836:return 4;default:return Jt(!1),0}}function QE(n){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{sourceX:t=0,sourceY:r=0,sourceFormat:i=6408}=e;let{sourceAttachment:o=36064,target:a=null,sourceWidth:l,sourceHeight:h,sourceType:p}=e;const{framebuffer:g,deleteFramebuffer:_}=K5(n);Jt(g);const{gl:x,handle:C,attachments:M}=g;l=l||g.width,h=h||g.height,o===36064&&C===null&&(o=1028),Jt(M[o]),p=p||M[o].type,a=Q$(a,p,i,l,h),p=p||T2(a);const L=x.bindFramebuffer(36160,C);return x.readPixels(t,r,l,h,i,p,a),x.bindFramebuffer(36160,L||null),_&&g.delete(),a}function hL(n){let{sourceAttachment:e=36064,targetMaxHeight:t=Number.MAX_SAFE_INTEGER}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},r=QE(n,{sourceAttachment:e}),{width:i,height:o}=n;for(;o>t;)({data:r,width:i,height:o}=L$({data:r,width:i,height:o}));O$({data:r,width:i,height:o});const a=document.createElement("canvas");a.width=i,a.height=o;const l=a.getContext("2d"),h=l.createImageData(i,o);return h.data.set(r),l.putImageData(h,0,0),a.toDataURL()}function X$(n,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const{sourceX:r=0,sourceY:i=0,targetMipmaplevel:o=0,targetInternalFormat:a=6408}=t;let{targetX:l,targetY:h,targetZ:p,width:g,height:_}=t;const{framebuffer:x,deleteFramebuffer:C}=K5(n);Jt(x);const{gl:M,handle:L}=x,D=typeof l<"u"||typeof h<"u"||typeof p<"u";l=l||0,h=h||0,p=p||0;const z=M.bindFramebuffer(36160,L);Jt(e);let te=null;if(e instanceof zf&&(te=e,g=Number.isFinite(g)?g:te.width,_=Number.isFinite(_)?_:te.height,te.bind(0),e=te.target),!D)M.copyTexImage2D(e,o,a,r,i,g,_,0);else switch(e){case 3553:case 34067:M.copyTexSubImage2D(e,o,l,h,r,i,g,_);break;case 35866:case 32879:ga(M).copyTexSubImage3D(e,o,l,h,p,r,i,g,_);break}return te&&te.unbind(),M.bindFramebuffer(36160,z||null),C&&x.delete(),te}function K5(n){return n instanceof Co?{framebuffer:n,deleteFramebuffer:!1}:{framebuffer:cW(n),deleteFramebuffer:!0}}function Q$(n,e,t,r,i){if(n)return n;e=e||5121;const o=p0(e,{clamped:!1}),a=Z$(t);return new o(r*i*a)}const Oi={WEBGL2:"WEBGL2",VERTEX_ARRAY_OBJECT:"VERTEX_ARRAY_OBJECT",TIMER_QUERY:"TIMER_QUERY",INSTANCED_RENDERING:"INSTANCED_RENDERING",MULTIPLE_RENDER_TARGETS:"MULTIPLE_RENDER_TARGETS",ELEMENT_INDEX_UINT32:"ELEMENT_INDEX_UINT32",BLEND_EQUATION_MINMAX:"BLEND_EQUATION_MINMAX",FLOAT_BLEND:"FLOAT_BLEND",COLOR_ENCODING_SRGB:"COLOR_ENCODING_SRGB",TEXTURE_DEPTH:"TEXTURE_DEPTH",TEXTURE_FLOAT:"TEXTURE_FLOAT",TEXTURE_HALF_FLOAT:"TEXTURE_HALF_FLOAT",TEXTURE_FILTER_LINEAR_FLOAT:"TEXTURE_FILTER_LINEAR_FLOAT",TEXTURE_FILTER_LINEAR_HALF_FLOAT:"TEXTURE_FILTER_LINEAR_HALF_FLOAT",TEXTURE_FILTER_ANISOTROPIC:"TEXTURE_FILTER_ANISOTROPIC",COLOR_ATTACHMENT_RGBA32F:"COLOR_ATTACHMENT_RGBA32F",COLOR_ATTACHMENT_FLOAT:"COLOR_ATTACHMENT_FLOAT",COLOR_ATTACHMENT_HALF_FLOAT:"COLOR_ATTACHMENT_HALF_FLOAT",GLSL_FRAG_DATA:"GLSL_FRAG_DATA",GLSL_FRAG_DEPTH:"GLSL_FRAG_DEPTH",GLSL_DERIVATIVES:"GLSL_DERIVATIVES",GLSL_TEXTURE_LOD:"GLSL_TEXTURE_LOD"};function J$(n){const e=new Bs(n,{format:6408,type:5126,dataFormat:6408}),t=new Co(n,{id:"test-framebuffer",check:!1,attachments:{36064:e}}),r=t.getStatus();return e.delete(),t.delete(),r===36053}const Z5={[Oi.WEBGL2]:[!1,!0],[Oi.VERTEX_ARRAY_OBJECT]:["OES_vertex_array_object",!0],[Oi.TIMER_QUERY]:["EXT_disjoint_timer_query","EXT_disjoint_timer_query_webgl2"],[Oi.INSTANCED_RENDERING]:["ANGLE_instanced_arrays",!0],[Oi.MULTIPLE_RENDER_TARGETS]:["WEBGL_draw_buffers",!0],[Oi.ELEMENT_INDEX_UINT32]:["OES_element_index_uint",!0],[Oi.BLEND_EQUATION_MINMAX]:["EXT_blend_minmax",!0],[Oi.FLOAT_BLEND]:["EXT_float_blend"],[Oi.COLOR_ENCODING_SRGB]:["EXT_sRGB",!0],[Oi.TEXTURE_DEPTH]:["WEBGL_depth_texture",!0],[Oi.TEXTURE_FLOAT]:["OES_texture_float",!0],[Oi.TEXTURE_HALF_FLOAT]:["OES_texture_half_float",!0],[Oi.TEXTURE_FILTER_LINEAR_FLOAT]:["OES_texture_float_linear"],[Oi.TEXTURE_FILTER_LINEAR_HALF_FLOAT]:["OES_texture_half_float_linear"],[Oi.TEXTURE_FILTER_ANISOTROPIC]:["EXT_texture_filter_anisotropic"],[Oi.COLOR_ATTACHMENT_RGBA32F]:[J$,"EXT_color_buffer_float"],[Oi.COLOR_ATTACHMENT_FLOAT]:[!1,"EXT_color_buffer_float"],[Oi.COLOR_ATTACHMENT_HALF_FLOAT]:["EXT_color_buffer_half_float"],[Oi.GLSL_FRAG_DATA]:["WEBGL_draw_buffers",!0],[Oi.GLSL_FRAG_DEPTH]:["EXT_frag_depth",!0],[Oi.GLSL_DERIVATIVES]:["OES_standard_derivatives",!0],[Oi.GLSL_TEXTURE_LOD]:["EXT_shader_texture_lod",!0]},eW=2;function tW(n,e){return X5(n,e)}function X5(n,e){return e=Array.isArray(e)?e:[e],e.every(t=>Q5(n,t))}function nW(n){n.luma=n.luma||{},n.luma.caps=n.luma.caps||{};for(const e in Z5)n.luma.caps[e]===void 0&&(n.luma.caps[e]=Q5(n,e));return n.luma.caps}function Q5(n,e){return n.luma=n.luma||{},n.luma.caps=n.luma.caps||{},n.luma.caps[e]===void 0&&(n.luma.caps[e]=rW(n,e)),n.luma.caps[e]||Tn.log(eW,"Feature: ".concat(e," not supported"))(),n.luma.caps[e]}function rW(n,e){const t=Z5[e];Jt(t,e);let r;const i=vr(n)&&t[1]||t[0];if(typeof i=="function")r=i(n);else if(Array.isArray(i)){r=!0;for(const o of i)r=r&&!!n.getExtension(o)}else typeof i=="string"?r=!!n.getExtension(i):typeof i=="boolean"?r=i:Jt(!1);return r}const dL="Multiple render targets not supported";class Co extends Lu{get[Symbol.toStringTag](){return"Framebuffer"}static isSupported(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{colorBufferFloat:r,colorBufferHalfFloat:i}=t;let o=!0;return r&&(o=!!(e.getExtension("EXT_color_buffer_float")||e.getExtension("WEBGL_color_buffer_float")||e.getExtension("OES_texture_float"))),i&&(o=o&&!!(e.getExtension("EXT_color_buffer_float")||e.getExtension("EXT_color_buffer_half_float"))),o}static getDefaultFramebuffer(e){return e.luma=e.luma||{},e.luma.defaultFramebuffer=e.luma.defaultFramebuffer||new Co(e,{id:"default-framebuffer",handle:null,attachments:{}}),e.luma.defaultFramebuffer}get MAX_COLOR_ATTACHMENTS(){const e=ga(this.gl);return e.getParameter(e.MAX_COLOR_ATTACHMENTS)}get MAX_DRAW_BUFFERS(){const e=ga(this.gl);return e.getParameter(e.MAX_DRAW_BUFFERS)}constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(e,t),this.width=null,this.height=null,this.attachments={},this.readBuffer=36064,this.drawBuffers=[36064],this.ownResources=[],this.initialize(t),Object.seal(this)}get color(){return this.attachments[36064]||null}get texture(){return this.attachments[36064]||null}get depth(){return this.attachments[36096]||this.attachments[33306]||null}get stencil(){return this.attachments[36128]||this.attachments[33306]||null}initialize(e){let{width:t=1,height:r=1,attachments:i=null,color:o=!0,depth:a=!0,stencil:l=!1,check:h=!0,readBuffer:p=void 0,drawBuffers:g=void 0}=e;if(Jt(t>=0&&r>=0,"Width and height need to be integers"),this.width=t,this.height=r,i)for(const _ in i){const x=i[_];(Array.isArray(x)?x[0]:x).resize({width:t,height:r})}else i=this._createDefaultAttachments(o,a,l,t,r);this.update({clearAttachments:!0,attachments:i,readBuffer:p,drawBuffers:g}),i&&h&&this.checkStatus()}delete(){for(const e of this.ownResources)e.delete();return super.delete(),this}update(e){let{attachments:t={},readBuffer:r,drawBuffers:i,clearAttachments:o=!1,resizeAttachments:a=!0}=e;this.attach(t,{clearAttachments:o,resizeAttachments:a});const{gl:l}=this,h=l.bindFramebuffer(36160,this.handle);return r&&this._setReadBuffer(r),i&&this._setDrawBuffers(i),l.bindFramebuffer(36160,h||null),this}resize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},{width:t,height:r}=e;if(this.handle===null)return Jt(t===void 0&&r===void 0),this.width=this.gl.drawingBufferWidth,this.height=this.gl.drawingBufferHeight,this;t===void 0&&(t=this.gl.drawingBufferWidth),r===void 0&&(r=this.gl.drawingBufferHeight),t!==this.width&&r!==this.height&&Tn.log(2,"Resizing framebuffer ".concat(this.id," to ").concat(t,"x").concat(r))();for(const i in this.attachments)this.attachments[i].resize({width:t,height:r});return this.width=t,this.height=r,this}attach(e){let{clearAttachments:t=!1,resizeAttachments:r=!0}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const i={};t&&Object.keys(this.attachments).forEach(a=>{i[a]=null}),Object.assign(i,e);const o=this.gl.bindFramebuffer(36160,this.handle);for(const a in i){Jt(a!==void 0,"Misspelled framebuffer binding point?");const l=Number(a),h=i[l];let p=h;if(!p)this._unattach(l);else if(p instanceof Xg)this._attachRenderbuffer({attachment:l,renderbuffer:p});else if(Array.isArray(h)){const[g,_=0,x=0]=h;p=g,this._attachTexture({attachment:l,texture:g,layer:_,level:x})}else this._attachTexture({attachment:l,texture:p,layer:0,level:0});r&&p&&p.resize({width:this.width,height:this.height})}this.gl.bindFramebuffer(36160,o||null),Object.assign(this.attachments,e),Object.keys(this.attachments).filter(a=>!this.attachments[a]).forEach(a=>{delete this.attachments[a]})}checkStatus(){const e=this.getStatus();if(e!==36053)throw new Error(oW(e));return this}getStatus(){const{gl:e}=this,t=e.bindFramebuffer(36160,this.handle),r=e.checkFramebufferStatus(36160);return e.bindFramebuffer(36160,t||null),r}clear(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{color:t,depth:r,stencil:i,drawBuffers:o=[]}=e,a=this.gl.bindFramebuffer(36160,this.handle);return(t||r||i)&&rM(this.gl,{color:t,depth:r,stencil:i}),o.forEach((l,h)=>{K$(this.gl,{drawBuffer:h,value:l})}),this.gl.bindFramebuffer(36160,a||null),this}readPixels(){return Tn.error("Framebuffer.readPixels() is no logner supported, use readPixelsToArray(framebuffer)")(),null}readPixelsToBuffer(){return Tn.error("Framebuffer.readPixelsToBuffer()is no logner supported, use readPixelsToBuffer(framebuffer)")(),null}copyToDataUrl(){return Tn.error("Framebuffer.copyToDataUrl() is no logner supported, use copyToDataUrl(framebuffer)")(),null}copyToImage(){return Tn.error("Framebuffer.copyToImage() is no logner supported, use copyToImage(framebuffer)")(),null}copyToTexture(){return Tn.error("Framebuffer.copyToTexture({...}) is no logner supported, use copyToTexture(source, target, opts})")(),null}blit(){return Tn.error("Framebuffer.blit({...}) is no logner supported, use blit(source, target, opts)")(),null}invalidate(e){let{attachments:t=[],x:r=0,y:i=0,width:o,height:a}=e;const l=ga(this.gl),h=l.bindFramebuffer(36008,this.handle);return r===0&&i===0&&o===void 0&&a===void 0?l.invalidateFramebuffer(36008,t):l.invalidateFramebuffer(36008,t,r,i,o,a),l.bindFramebuffer(36008,h),this}getAttachmentParameter(e,t,r){let i=this._getAttachmentParameterFallback(t);return i===null&&(this.gl.bindFramebuffer(36160,this.handle),i=this.gl.getFramebufferAttachmentParameter(36160,e,t),this.gl.bindFramebuffer(36160,null)),r&&i>1e3&&(i=$h(this.gl,i)),i}getAttachmentParameters(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:36064,t=arguments.length>1?arguments[1]:void 0,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:this.constructor.ATTACHMENT_PARAMETERS||[];const i={};for(const o of r){const a=t?$h(this.gl,o):o;i[a]=this.getAttachmentParameter(e,o,t)}return i}getParameters(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;const t=Object.keys(this.attachments),r={};for(const i of t){const o=Number(i),a=e?$h(this.gl,o):o;r[a]=this.getAttachmentParameters(o,e)}return r}show(){return typeof window<"u"&&window.open(hL(this),"luma-debug-texture"),this}log(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";if(e>Tn.level||typeof window>"u")return this;t=t||"Framebuffer ".concat(this.id);const r=hL(this,{targetMaxHeight:100});return Tn.image({logLevel:e,message:t,image:r},t)(),this}bind(){let{target:e=36160}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.gl.bindFramebuffer(e,this.handle),this}unbind(){let{target:e=36160}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.gl.bindFramebuffer(e,null),this}_createDefaultAttachments(e,t,r,i,o){let a=null;return e&&(a=a||{},a[36064]=new Bs(this.gl,{id:"".concat(this.id,"-color0"),pixels:null,format:6408,type:5121,width:i,height:o,mipmaps:!1,parameters:{10241:9729,10240:9729,10242:33071,10243:33071}}),this.ownResources.push(a[36064])),t&&r?(a=a||{},a[33306]=new Xg(this.gl,{id:"".concat(this.id,"-depth-stencil"),format:35056,width:i,height:111}),this.ownResources.push(a[33306])):t?(a=a||{},a[36096]=new Xg(this.gl,{id:"".concat(this.id,"-depth"),format:33189,width:i,height:o}),this.ownResources.push(a[36096])):r&&Jt(!1),a}_unattach(e){const t=this.attachments[e];t&&(t instanceof Xg?this.gl.framebufferRenderbuffer(36160,e,36161,null):this.gl.framebufferTexture2D(36160,e,3553,null,0),delete this.attachments[e])}_attachRenderbuffer(e){let{attachment:t=36064,renderbuffer:r}=e;const{gl:i}=this;i.framebufferRenderbuffer(36160,t,36161,r.handle),this.attachments[t]=r}_attachTexture(e){let{attachment:t=36064,texture:r,layer:i,level:o}=e;const{gl:a}=this;switch(a.bindTexture(r.target,r.handle),r.target){case 35866:case 32879:ga(a).framebufferTextureLayer(36160,t,r.target,o,i);break;case 34067:const h=iW(i);a.framebufferTexture2D(36160,t,h,r.handle,o);break;case 3553:a.framebufferTexture2D(36160,t,3553,r.handle,o);break;default:Jt(!1,"Illegal texture type")}a.bindTexture(r.target,null),this.attachments[t]=r}_setReadBuffer(e){const t=Oq(this.gl);t?t.readBuffer(e):Jt(e===36064||e===1029,dL),this.readBuffer=e}_setDrawBuffers(e){const{gl:t}=this,r=ga(t);if(r)r.drawBuffers(e);else{const i=t.getExtension("WEBGL_draw_buffers");i?i.drawBuffersWEBGL(e):Jt(e.length===1&&(e[0]===36064||e[0]===1029),dL)}this.drawBuffers=e}_getAttachmentParameterFallback(e){const t=nW(this.gl);switch(e){case 36052:return t.WEBGL2?null:0;case 33298:case 33299:case 33300:case 33301:case 33302:case 33303:return t.WEBGL2?null:8;case 33297:return t.WEBGL2?null:5125;case 33296:return!t.WEBGL2&&!t.EXT_sRGB?9729:null;default:return null}}_createHandle(){return this.gl.createFramebuffer()}_deleteHandle(){this.gl.deleteFramebuffer(this.handle)}_bindHandle(e){return this.gl.bindFramebuffer(36160,e)}}function iW(n){return n<34069?n+34069:n}function oW(n){return(Co.STATUS||{})[n]||"Framebuffer error ".concat(n)}const aW=[36049,36048,33296,33298,33299,33300,33301,33302,33303];Co.ATTACHMENT_PARAMETERS=aW;function sW(n,e){Jt(n instanceof Bs||n instanceof W5||n instanceof G$);const t=n.constructor,{gl:r,width:i,height:o,format:a,type:l,dataFormat:h,border:p,mipmaps:g}=n,_=Object.assign({width:i,height:o,format:a,type:l,dataFormat:h,border:p,mipmaps:g},e);return new t(r,_)}function cW(n,e){const{gl:t,width:r,height:i,id:o}=n;return new Co(t,Object.assign({},e,{id:"framebuffer-for-".concat(o),width:r,height:i,attachments:{36064:n}}))}function Pw(n){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"unnamed";const t=/#define[\s*]SHADER_NAME[\s*]([A-Za-z0-9_-]+)[\s*]/,r=n.match(t);return r?r[1]:e}const lW=35632,uW=35633;function hW(n){switch(n){case lW:return"fragment";case uW:return"vertex";default:return"unknown type"}}function dW(n,e,t,r){const i=n.split(/\r?\n/),o={},a={},l=r||Pw(e)||"(unnamed)",h="".concat(hW(t)," shader ").concat(l);for(let g=0;g<i.length;g++){const _=i[g];if(_.length<=1)continue;const x=_.split(":"),C=x[0],M=parseInt(x[2],10);if(isNaN(M))throw new Error("GLSL compilation error in ".concat(h,": ").concat(n));C!=="WARNING"?o[M]=_:a[M]=_}const p=fW(e);return{shaderName:h,errors:fL(o,p),warnings:fL(a,p)}}function fL(n,e){let t="";for(let r=0;r<e.length;r++){const i=e[r];if(!(!n[r+3]&&!n[r+2]&&!n[r+1])&&(t+="".concat(i,`
`),n[r+1])){const o=n[r+1],a=o.split(":",3),l=a[0],h=parseInt(a[1],10)||0,p=o.substring(a.join(":").length+1).trim();t+=J5("^^^ ".concat(l,": ").concat(p,`

`),h)}}return t}function fW(n){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:": ";const r=n.split(/\r?\n/),i=String(r.length+e-1).length;return r.map((o,a)=>{const l=String(a+e),h=l.length;return J5(l,i-h)+t+o})}function J5(n,e){let t="";for(let r=0;r<e;++r)t+=" ";return"".concat(t).concat(n)}function e6(n){let e=100;const t=n.match(/[^\s]+/g);if(t.length>=2&&t[0]==="#version"){const r=parseInt(t[1],10);Number.isFinite(r)&&(e=r)}return e}const pW="Shader: GLSL source code must be a JavaScript string";class g0 extends Lu{get[Symbol.toStringTag](){return"Shader"}static getTypeName(e){switch(e){case 35633:return"vertex-shader";case 35632:return"fragment-shader";default:return Jt(!1),"unknown"}}constructor(e,t){XE(e),Jt(typeof t.source=="string",pW);const r=Pw(t.source,null)||t.id||rd("unnamed ".concat(g0.getTypeName(t.shaderType)));super(e,{id:r}),this.shaderType=t.shaderType,this.source=t.source,this.initialize(t)}initialize(e){let{source:t}=e;const r=Pw(t,null);r&&(this.id=rd(r)),this._compile(t)}getParameter(e){return this.gl.getShaderParameter(this.handle,e)}toString(){return"".concat(g0.getTypeName(this.shaderType),":").concat(this.id)}getName(){return Pw(this.source)||"unnamed-shader"}getSource(){return this.gl.getShaderSource(this.handle)}getTranslatedSource(){const e=this.gl.getExtension("WEBGL_debug_shaders");return e?e.getTranslatedShaderSource(this.handle):"No translated source available. WEBGL_debug_shaders not implemented"}_compile(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.source;if(e.startsWith("#version ")||(e=`#version 100
`.concat(e)),this.source=e,this.gl.shaderSource(this.handle,this.source),this.gl.compileShader(this.handle),!this.getParameter(35713)){const r=this.gl.getShaderInfoLog(this.handle),{shaderName:i,errors:o,warnings:a}=dW(r,this.source,this.shaderType,this.id);throw Tn.error("GLSL compilation errors in ".concat(i,`
`).concat(o))(),Tn.warn("GLSL compilation warnings in ".concat(i,`
`).concat(a))(),new Error("GLSL compilation errors in ".concat(i))}}_deleteHandle(){this.gl.deleteShader(this.handle)}_getOptsFromHandle(){return{type:this.getParameter(35663),source:this.getSource()}}}let qS=class extends g0{get[Symbol.toStringTag](){return"VertexShader"}constructor(e,t){typeof t=="string"&&(t={source:t}),super(e,Object.assign({},t,{shaderType:35633}))}_createHandle(){return this.gl.createShader(35633)}},$S=class extends g0{get[Symbol.toStringTag](){return"FragmentShader"}constructor(e,t){typeof t=="string"&&(t={source:t}),super(e,Object.assign({},t,{shaderType:35632}))}_createHandle(){return this.gl.createShader(35632)}};const gW={5126:Si.bind(null,"uniform1fv",xs,1,la),35664:Si.bind(null,"uniform2fv",xs,2,la),35665:Si.bind(null,"uniform3fv",xs,3,la),35666:Si.bind(null,"uniform4fv",xs,4,la),5124:Si.bind(null,"uniform1iv",uh,1,la),35667:Si.bind(null,"uniform2iv",uh,2,la),35668:Si.bind(null,"uniform3iv",uh,3,la),35669:Si.bind(null,"uniform4iv",uh,4,la),35670:Si.bind(null,"uniform1iv",uh,1,la),35671:Si.bind(null,"uniform2iv",uh,2,la),35672:Si.bind(null,"uniform3iv",uh,3,la),35673:Si.bind(null,"uniform4iv",uh,4,la),35674:Si.bind(null,"uniformMatrix2fv",xs,4,Kl),35675:Si.bind(null,"uniformMatrix3fv",xs,9,Kl),35676:Si.bind(null,"uniformMatrix4fv",xs,16,Kl),35678:qo,35680:qo,5125:Si.bind(null,"uniform1uiv",P1,1,la),36294:Si.bind(null,"uniform2uiv",P1,2,la),36295:Si.bind(null,"uniform3uiv",P1,3,la),36296:Si.bind(null,"uniform4uiv",P1,4,la),35685:Si.bind(null,"uniformMatrix2x3fv",xs,6,Kl),35686:Si.bind(null,"uniformMatrix2x4fv",xs,8,Kl),35687:Si.bind(null,"uniformMatrix3x2fv",xs,6,Kl),35688:Si.bind(null,"uniformMatrix3x4fv",xs,12,Kl),35689:Si.bind(null,"uniformMatrix4x2fv",xs,8,Kl),35690:Si.bind(null,"uniformMatrix4x3fv",xs,12,Kl),35678:qo,35680:qo,35679:qo,35682:qo,36289:qo,36292:qo,36293:qo,36298:qo,36299:qo,36300:qo,36303:qo,36306:qo,36307:qo,36308:qo,36311:qo},mW={},yW={},_W={},pL=[0];function iM(n,e,t,r){e===1&&typeof n=="boolean"&&(n=n?1:0),Number.isFinite(n)&&(pL[0]=n,n=pL);const i=n.length;if(i%e&&Tn.warn("Uniform size should be multiples of ".concat(e),n)(),n instanceof t)return n;let o=r[i];o||(o=new t(i),r[i]=o);for(let a=0;a<i;a++)o[a]=n[a];return o}function xs(n,e){return iM(n,e,Float32Array,mW)}function uh(n,e){return iM(n,e,Int32Array,yW)}function P1(n,e){return iM(n,e,Uint32Array,_W)}function gL(n,e,t){const r=gW[t.type];if(!r)throw new Error("Unknown GLSL uniform type ".concat(t.type));return r().bind(null,n,e)}function vW(n){if(n[n.length-1]!=="]")return{name:n,length:1,isArray:!1};const e=/([^[]*)(\[[0-9]+\])?/,t=n.match(e);if(!t||t.length<2)throw new Error("Failed to parse GLSL uniform name ".concat(n));return{name:t[1],length:t[2]||1,isArray:!!t[2]}}function bW(n,e,t){for(const r in n){const i=n[r];if((!t||!!t[r])&&!wW(i))throw e=e?"".concat(e," "):"",console.error("".concat(e," Bad uniform ").concat(r),i),new Error("".concat(e," Bad uniform ").concat(r))}return!0}function wW(n){return Array.isArray(n)||ArrayBuffer.isView(n)?EW(n):isFinite(n)||n===!0||n===!1||n instanceof zf||n instanceof Xg?!0:n instanceof Co?!!n.texture:!1}function xW(n,e,t){if(Array.isArray(t)||ArrayBuffer.isView(t))if(n[e]){const r=n[e];for(let i=0,o=t.length;i<o;++i)r[i]=t[i]}else n[e]=t.slice();else n[e]=t}function EW(n){if(n.length===0)return!1;const e=Math.min(n.length,16);for(let t=0;t<e;++t)if(!Number.isFinite(n[t]))return!1;return!0}function qo(){let n=null;return(e,t,r)=>{const i=n!==r;return i&&(e.uniform1i(t,r),n=r),i}}function Si(n,e,t,r){let i=null,o=null;return(a,l,h)=>{const p=e(h,t),g=p.length;let _=!1;if(i===null)i=new Float32Array(g),o=g,_=!0;else{Jt(o===g,"Uniform length cannot change.");for(let x=0;x<g;++x)if(p[x]!==i[x]){_=!0;break}}return _&&(r(a,n,l,p),i.set(p)),_}}function la(n,e,t,r){n[e](t,r)}function Kl(n,e,t,r){n[e](t,!1,r)}const TW=5120,SW=5121,CW=5122,AW=5123,mL=0,M1=1,IW=2,PW=3,R1=4,MW=5,RW=6,xo=5126,kW=35664,OW=35665,LW=35666,C_=5124,NW=35667,DW=35668,FW=35669,A_=5125,BW=36294,UW=36295,zW=36296,jW=35670,VW=35671,HW=35672,GW=35673,qW=35674,$W=35675,WW=35676,YW=35685,KW=35686,ZW=35687,XW=35688,QW=35689,JW=35690,A2={[xo]:[xo,1,"float"],[kW]:[xo,2,"vec2"],[OW]:[xo,3,"vec3"],[LW]:[xo,4,"vec4"],[C_]:[C_,1,"int"],[NW]:[C_,2,"ivec2"],[DW]:[C_,3,"ivec3"],[FW]:[C_,4,"ivec4"],[A_]:[A_,1,"uint"],[BW]:[A_,2,"uvec2"],[UW]:[A_,3,"uvec3"],[zW]:[A_,4,"uvec4"],[jW]:[xo,1,"bool"],[VW]:[xo,2,"bvec2"],[HW]:[xo,3,"bvec3"],[GW]:[xo,4,"bvec4"],[qW]:[xo,8,"mat2"],[YW]:[xo,8,"mat2x3"],[KW]:[xo,8,"mat2x4"],[$W]:[xo,12,"mat3"],[ZW]:[xo,12,"mat3x2"],[XW]:[xo,12,"mat3x4"],[WW]:[xo,16,"mat4"],[QW]:[xo,16,"mat4x2"],[JW]:[xo,16,"mat4x3"]};function eY(n){switch(n){case mL:return mL;case M1:return M1;case PW:return M1;case IW:return M1;case R1:return R1;case MW:return R1;case RW:return R1;default:return Jt(!1),0}}function yL(n){const e=A2[n];if(!e)return null;const[t,r]=e;return{type:t,components:r}}function t6(n,e){switch(n){case TW:case SW:case CW:case AW:n=xo;break}for(const t in A2){const[r,i,o]=A2[t];if(r===n&&i===e)return{glType:t,name:o}}return null}class tY{constructor(e){this.id=e.id,this.attributeInfos=[],this.attributeInfosByName={},this.attributeInfosByLocation=[],this.varyingInfos=[],this.varyingInfosByName={},Object.seal(this),this._readAttributesFromProgram(e),this._readVaryingsFromProgram(e)}getAttributeInfo(e){const t=Number(e);return Number.isFinite(t)?this.attributeInfosByLocation[t]:this.attributeInfosByName[e]||null}getAttributeLocation(e){const t=this.getAttributeInfo(e);return t?t.location:-1}getAttributeAccessor(e){const t=this.getAttributeInfo(e);return t?t.accessor:null}getVaryingInfo(e){const t=Number(e);return Number.isFinite(t)?this.varyingInfos[t]:this.varyingInfosByName[e]||null}getVaryingIndex(e){const t=this.getVaryingInfo();return t?t.location:-1}getVaryingAccessor(e){const t=this.getVaryingInfo();return t?t.accessor:null}_readAttributesFromProgram(e){const{gl:t}=e,r=t.getProgramParameter(e.handle,35721);for(let i=0;i<r;i++){const{name:o,type:a,size:l}=t.getActiveAttrib(e.handle,i),h=t.getAttribLocation(e.handle,o);h>=0&&this._addAttribute(h,o,a,l)}this.attributeInfos.sort((i,o)=>i.location-o.location)}_readVaryingsFromProgram(e){const{gl:t}=e;if(!vr(t))return;const r=t.getProgramParameter(e.handle,35971);for(let i=0;i<r;i++){const{name:o,type:a,size:l}=t.getTransformFeedbackVarying(e.handle,i);this._addVarying(i,o,a,l)}this.varyingInfos.sort((i,o)=>i.location-o.location)}_addAttribute(e,t,r,i){const{type:o,components:a}=yL(r),l={type:o,size:i*a};this._inferProperties(e,t,l);const h={location:e,name:t,accessor:new Rs(l)};this.attributeInfos.push(h),this.attributeInfosByLocation[e]=h,this.attributeInfosByName[h.name]=h}_inferProperties(e,t,r){/instance/i.test(t)&&(r.divisor=1)}_addVarying(e,t,r,i){const{type:o,components:a}=yL(r),l=new Rs({type:o,size:i*a}),h={location:e,name:t,accessor:l};this.varyingInfos.push(h),this.varyingInfosByName[h.name]=h}}const _L=4,nY=35981,rY=["setVertexArray","setAttributes","setBuffers","unsetBuffers","use","getUniformCount","getUniformInfo","getUniformLocation","getUniformValue","getVarying","getFragDataLocation","getAttachedShaders","getAttributeCount","getAttributeLocation","getAttributeInfo"];class n6 extends Lu{get[Symbol.toStringTag](){return"Program"}constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(e,t),this.stubRemovedMethods("Program","v6.0",rY),this._isCached=!1,this.initialize(t),Object.seal(this),this._setId(t.id)}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{hash:t,vs:r,fs:i,varyings:o,bufferMode:a=nY}=e;return this.hash=t||"",this.vs=typeof r=="string"?new qS(this.gl,{id:"".concat(e.id,"-vs"),source:r}):r,this.fs=typeof i=="string"?new $S(this.gl,{id:"".concat(e.id,"-fs"),source:i}):i,Jt(this.vs instanceof qS),Jt(this.fs instanceof $S),this.uniforms={},this._textureUniforms={},o&&o.length>0&&(ga(this.gl),this.varyings=o,this.gl2.transformFeedbackVaryings(this.handle,o,a)),this._compileAndLink(),this._readUniformLocationsFromLinkedProgram(),this.configuration=new tY(this),this.setProps(e)}delete(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this._isCached?this:super.delete(e)}setProps(e){return"uniforms"in e&&this.setUniforms(e.uniforms),this}draw(e){let{logPriority:t,drawMode:r=4,vertexCount:i,offset:o=0,start:a,end:l,isIndexed:h=!1,indexType:p=5123,instanceCount:g=0,isInstanced:_=g>0,vertexArray:x=null,transformFeedback:C,framebuffer:M,parameters:L={},uniforms:D,samplers:z}=e;if((D||z)&&(Tn.deprecated("Program.draw({uniforms})","Program.setUniforms(uniforms)")(),this.setUniforms(D||{})),Tn.priority>=t){const te=M?M.id:"default",le="mode=".concat($h(this.gl,r)," verts=").concat(i," ")+"instances=".concat(g," indexType=").concat($h(this.gl,p)," ")+"isInstanced=".concat(_," isIndexed=").concat(h," ")+"Framebuffer=".concat(te);Tn.log(t,le)()}return Jt(x),this.gl.useProgram(this.handle),!this._areTexturesRenderable()||i===0||_&&g===0?!1:(x.bindForDraw(i,g,()=>{if(M!==void 0&&(L=Object.assign({},L,{framebuffer:M})),C){const te=eY(r);C.begin(te)}this._bindTextures(),Ic(this.gl,L,()=>{h&&_?this.gl2.drawElementsInstanced(r,i,p,o,g):h&&vr(this.gl)&&!isNaN(a)&&!isNaN(l)?this.gl2.drawRangeElements(r,a,l,i,p,o):h?this.gl.drawElements(r,i,p,o):_?this.gl2.drawArraysInstanced(r,o,i,g):this.gl.drawArrays(r,o,i)}),C&&C.end()}),!0)}setUniforms(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};Tn.priority>=2&&bW(e,this.id,this._uniformSetters),this.gl.useProgram(this.handle);for(const t in e){const r=e[t],i=this._uniformSetters[t];if(i){let o=r,a=!1;if(o instanceof Co&&(o=o.texture),o instanceof zf)if(a=this.uniforms[t]!==r,a){i.textureIndex===void 0&&(i.textureIndex=this._textureIndexCounter++);const l=o,{textureIndex:h}=i;l.bind(h),o=h,this._textureUniforms[t]=l}else o=i.textureIndex;else this._textureUniforms[t]&&delete this._textureUniforms[t];(i(o)||a)&&xW(this.uniforms,t,r)}}return this}_areTexturesRenderable(){let e=!0;for(const t in this._textureUniforms){const r=this._textureUniforms[t];r.update(),e=e&&r.loaded}return e}_bindTextures(){for(const e in this._textureUniforms){const t=this._uniformSetters[e].textureIndex;this._textureUniforms[e].bind(t)}}_createHandle(){return this.gl.createProgram()}_deleteHandle(){this.gl.deleteProgram(this.handle)}_getOptionsFromHandle(e){const t=this.gl.getAttachedShaders(e),r={};for(const i of t)switch(this.gl.getShaderParameter(this.handle,35663)){case 35633:r.vs=new qS({handle:i});break;case 35632:r.fs=new $S({handle:i});break}return r}_getParameter(e){return this.gl.getProgramParameter(this.handle,e)}_setId(e){if(!e){const t=this._getName();this.id=rd(t)}}_getName(){let e=this.vs.getName()||this.fs.getName();return e=e.replace(/shader/i,""),e=e?"".concat(e,"-program"):"program",e}_compileAndLink(){const{gl:e}=this;if(e.attachShader(this.handle,this.vs.handle),e.attachShader(this.handle,this.fs.handle),Tn.time(_L,"linkProgram for ".concat(this._getName()))(),e.linkProgram(this.handle),Tn.timeEnd(_L,"linkProgram for ".concat(this._getName()))(),e.debug||Tn.level>0){if(!e.getProgramParameter(this.handle,35714))throw new Error("Error linking: ".concat(e.getProgramInfoLog(this.handle)));if(e.validateProgram(this.handle),!e.getProgramParameter(this.handle,35715))throw new Error("Error validating: ".concat(e.getProgramInfoLog(this.handle)))}}_readUniformLocationsFromLinkedProgram(){const{gl:e}=this;this._uniformSetters={},this._uniformCount=this._getParameter(35718);for(let t=0;t<this._uniformCount;t++){const r=this.gl.getActiveUniform(this.handle,t),{name:i}=vW(r.name);let o=e.getUniformLocation(this.handle,i);if(this._uniformSetters[i]=gL(e,o,r),r.size>1)for(let a=0;a<r.size;a++)o=e.getUniformLocation(this.handle,"".concat(i,"[").concat(a,"]")),this._uniformSetters["".concat(i,"[").concat(a,"]")]=gL(e,o,r)}this._textureIndexCounter=0}getActiveUniforms(e,t){return this.gl2.getActiveUniforms(this.handle,e,t)}getUniformBlockIndex(e){return this.gl2.getUniformBlockIndex(this.handle,e)}getActiveUniformBlockParameter(e,t){return this.gl2.getActiveUniformBlockParameter(this.handle,e,t)}uniformBlockBinding(e,t){this.gl2.uniformBlockBinding(this.handle,e,t)}}const iY=34918,oY=34919,aY=35007,sY=36795,cY=35976,lY=35887,uY=36202;class hx extends Lu{get[Symbol.toStringTag](){return"Query"}static isSupported(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];const r=vr(e),i=X5(e,Oi.TIMER_QUERY);let o=r||i;for(const a of t)switch(a){case"queries":o=o&&r;break;case"timers":o=o&&i;break;default:Jt(!1)}return o}constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(e,t),this.target=null,this._queryPending=!1,this._pollingPromise=null,Object.seal(this)}beginTimeElapsedQuery(){return this.begin(aY)}beginOcclusionQuery(){let{conservative:e=!1}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.begin(e?uY:lY)}beginTransformFeedbackQuery(){return this.begin(cY)}begin(e){return this._queryPending?this:(this.target=e,this.gl2.beginQuery(this.target,this.handle),this)}end(){return this._queryPending?this:(this.target&&(this.gl2.endQuery(this.target),this.target=null,this._queryPending=!0),this)}isResultAvailable(){if(!this._queryPending)return!1;const e=this.gl2.getQueryParameter(this.handle,oY);return e&&(this._queryPending=!1),e}isTimerDisjoint(){return this.gl2.getParameter(sY)}getResult(){return this.gl2.getQueryParameter(this.handle,iY)}getTimerMilliseconds(){return this.getResult()/1e6}createPoll(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Number.POSITIVE_INFINITY;if(this._pollingPromise)return this._pollingPromise;let t=0;return this._pollingPromise=new Promise((r,i)=>{const o=()=>{this.isResultAvailable()?(r(this.getResult()),this._pollingPromise=null):t++>e?(i("Timed out"),this._pollingPromise=null):requestAnimationFrame(o)};requestAnimationFrame(o)}),this._pollingPromise}_createHandle(){return hx.isSupported(this.gl)?this.gl2.createQuery():null}_deleteHandle(){this.gl2.deleteQuery(this.handle)}}class r6 extends Lu{get[Symbol.toStringTag](){return"TransformFeedback"}static isSupported(e){return vr(e)}constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};ga(e),super(e,t),this.initialize(t),this.stubRemovedMethods("TransformFeedback","v6.0",["pause","resume"]),Object.seal(this)}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.buffers={},this.unused={},this.configuration=null,this.bindOnUse=!0,jm(this.buffers)||this.bind(()=>this._unbindBuffers()),this.setProps(e),this}setProps(e){"program"in e&&(this.configuration=e.program&&e.program.configuration),"configuration"in e&&(this.configuration=e.configuration),"bindOnUse"in e&&(e=e.bindOnUse),"buffers"in e&&this.setBuffers(e.buffers)}setBuffers(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.bind(()=>{for(const t in e)this.setBuffer(t,e[t])}),this}setBuffer(e,t){const r=this._getVaryingIndex(e),{buffer:i,byteSize:o,byteOffset:a}=this._getBufferParams(t);return r<0?(this.unused[e]=i,Tn.warn("".concat(this.id," unused varying buffer ").concat(e))(),this):(this.buffers[r]=t,this.bindOnUse||this._bindBuffer(r,i,a,o),this)}begin(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return this.gl.bindTransformFeedback(36386,this.handle),this._bindBuffers(),this.gl.beginTransformFeedback(e),this}end(){return this.gl.endTransformFeedback(),this._unbindBuffers(),this.gl.bindTransformFeedback(36386,null),this}_getBufferParams(e){let t,r,i;return e instanceof ui?i=e:(i=e.buffer,r=e.byteSize,t=e.byteOffset),(t!==void 0||r!==void 0)&&(t=t||0,r=r||i.byteLength-t),{buffer:i,byteOffset:t,byteSize:r}}_getVaryingInfo(e){return this.configuration&&this.configuration.getVaryingInfo(e)}_getVaryingIndex(e){if(this.configuration)return this.configuration.getVaryingInfo(e).location;const t=Number(e);return Number.isFinite(t)?t:-1}_bindBuffers(){if(this.bindOnUse)for(const e in this.buffers){const{buffer:t,byteSize:r,byteOffset:i}=this._getBufferParams(this.buffers[e]);this._bindBuffer(e,t,i,r)}}_unbindBuffers(){if(this.bindOnUse)for(const e in this.buffers)this._bindBuffer(e,null)}_bindBuffer(e,t){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,i=arguments.length>3?arguments[3]:void 0;const o=t&&t.handle;return!o||i===void 0?this.gl.bindBufferBase(35982,e,o):this.gl.bindBufferRange(35982,e,o,r,i),this}_createHandle(){return this.gl.createTransformFeedback()}_deleteHandle(){this.gl.deleteTransformFeedback(this.handle)}_bindHandle(e){this.gl.bindTransformFeedback(36386,this.handle)}}let k1=null;function hY(n){return(!k1||k1.byteLength<n)&&(k1=new ArrayBuffer(n)),k1}function dY(n,e){const t=hY(n.BYTES_PER_ELEMENT*e);return new n(t,0,e)}function fY(n){let{target:e,source:t,start:r=0,count:i=1}=n;const o=t.length,a=i*o;let l=0;for(let h=r;l<o;l++)e[h++]=t[l];for(;l<a;)l<a-l?(e.copyWithin(r+l,r,r+l),l*=2):(e.copyWithin(r+l,r,r+a-l),l=a);return e}const pY="elements must be GL.ELEMENT_ARRAY_BUFFER";class Cs extends Lu{get[Symbol.toStringTag](){return"VertexArrayObject"}static isSupported(e){return(arguments.length>1&&arguments[1]!==void 0?arguments[1]:{}).constantAttributeZero?vr(e)||E5()==="Chrome":!0}static getDefaultArray(e){return e.luma=e.luma||{},e.luma.defaultVertexArray||(e.luma.defaultVertexArray=new Cs(e,{handle:null,isDefaultArray:!0})),e.luma.defaultVertexArray}static getMaxAttributes(e){return Cs.MAX_ATTRIBUTES=Cs.MAX_ATTRIBUTES||e.getParameter(34921),Cs.MAX_ATTRIBUTES}static setConstant(e,t,r){switch(r.constructor){case Float32Array:Cs._setConstantFloatArray(e,t,r);break;case Int32Array:Cs._setConstantIntArray(e,t,r);break;case Uint32Array:Cs._setConstantUintArray(e,t,r);break;default:Jt(!1)}}constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const r=t.id||t.program&&t.program.id;super(e,Object.assign({},t,{id:r})),this.buffer=null,this.bufferValue=null,this.isDefaultArray=t.isDefaultArray||!1,this.gl2=e,this.initialize(t),Object.seal(this)}delete(){return super.delete(),this.buffer&&this.buffer.delete(),this}get MAX_ATTRIBUTES(){return Cs.getMaxAttributes(this.gl)}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.setProps(e)}setProps(e){return this}setElementBuffer(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;return Jt(!e||e.target===34963,pY),this.bind(()=>{this.gl.bindBuffer(34963,e?e.handle:null)}),this}setBuffer(e,t,r){if(t.target===34963)return this.setElementBuffer(t,r);const{size:i,type:o,stride:a,offset:l,normalized:h,integer:p,divisor:g}=r,{gl:_,gl2:x}=this;return e=Number(e),this.bind(()=>{_.bindBuffer(34962,t.handle),p?(Jt(vr(_)),x.vertexAttribIPointer(e,i,o,a,l)):_.vertexAttribPointer(e,i,o,h,a,l),_.enableVertexAttribArray(e),x.vertexAttribDivisor(e,g||0)}),this}enable(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return!t&&e===0&&!Cs.isSupported(this.gl,{constantAttributeZero:!0})||(e=Number(e),this.bind(()=>t?this.gl.enableVertexAttribArray(e):this.gl.disableVertexAttribArray(e))),this}getConstantBuffer(e,t){const r=this._normalizeConstantArrayValue(t),i=r.byteLength*e,o=r.length*e;let a=!this.buffer;if(this.buffer=this.buffer||new ui(this.gl,i),a=a||this.buffer.reallocate(i),a=a||!this._compareConstantArrayValues(r,this.bufferValue),a){const l=dY(t.constructor,o);fY({target:l,source:r,start:0,count:o}),this.buffer.subData(l),this.bufferValue=t}return this.buffer}_normalizeConstantArrayValue(e){return Array.isArray(e)?new Float32Array(e):e}_compareConstantArrayValues(e,t){if(!e||!t||e.length!==t.length||e.constructor!==t.constructor)return!1;for(let r=0;r<e.length;++r)if(e[r]!==t[r])return!1;return!0}static _setConstantFloatArray(e,t,r){switch(r.length){case 1:e.vertexAttrib1fv(t,r);break;case 2:e.vertexAttrib2fv(t,r);break;case 3:e.vertexAttrib3fv(t,r);break;case 4:e.vertexAttrib4fv(t,r);break;default:Jt(!1)}}static _setConstantIntArray(e,t,r){switch(Jt(vr(e)),r.length){case 1:e.vertexAttribI1iv(t,r);break;case 2:e.vertexAttribI2iv(t,r);break;case 3:e.vertexAttribI3iv(t,r);break;case 4:e.vertexAttribI4iv(t,r);break;default:Jt(!1)}}static _setConstantUintArray(e,t,r){switch(Jt(vr(e)),r.length){case 1:e.vertexAttribI1uiv(t,r);break;case 2:e.vertexAttribI2uiv(t,r);break;case 3:e.vertexAttribI3uiv(t,r);break;case 4:e.vertexAttribI4uiv(t,r);break;default:Jt(!1)}}_createHandle(){return this.gl.createVertexArray()}_deleteHandle(e){return this.gl2.deleteVertexArray(e),[this.elements]}_bindHandle(e){this.gl2.bindVertexArray(e)}_getParameter(e,t){let{location:r}=t;return Jt(Number.isFinite(r)),this.bind(()=>{switch(e){case 34373:return this.gl.getVertexAttribOffset(r,e);default:return this.gl.getVertexAttrib(r,e)}})}}const gY="VertexArray: attributes must be Buffers or constants (i.e. typed array)",mY=/^(.+)__LOCATION_([0-9]+)$/,yY=["setBuffers","setGeneric","clearBindings","setLocations","setGenericValues","setDivisor","enable","disable"];class _Y{constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const r=t.id||t.program&&t.program.id;this.id=r,this.gl=e,this.configuration=null,this.elements=null,this.elementsAccessor=null,this.values=null,this.accessors=null,this.unused=null,this.drawParams=null,this.buffer=null,this.attributes={},this.vertexArrayObject=new Cs(e),H5(this,"VertexArray","v6.0",yY),this.initialize(t),Object.seal(this)}delete(){this.buffer&&this.buffer.delete(),this.vertexArrayObject.delete()}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.reset(),this.configuration=null,this.bindOnUse=!1,this.setProps(e)}reset(){this.elements=null,this.elementsAccessor=null;const{MAX_ATTRIBUTES:e}=this.vertexArrayObject;return this.values=new Array(e).fill(null),this.accessors=new Array(e).fill(null),this.unused={},this.drawParams=null,this}setProps(e){return"program"in e&&(this.configuration=e.program&&e.program.configuration),"configuration"in e&&(this.configuration=e.configuration),"attributes"in e&&this.setAttributes(e.attributes),"elements"in e&&this.setElementBuffer(e.elements),"bindOnUse"in e&&(e=e.bindOnUse),this}clearDrawParams(){this.drawParams=null}getDrawParams(){return this.drawParams=this.drawParams||this._updateDrawParams(),this.drawParams}setAttributes(e){return Object.assign(this.attributes,e),this.vertexArrayObject.bind(()=>{for(const t in e){const r=e[t];this._setAttribute(t,r)}this.gl.bindBuffer(34962,null)}),this}setElementBuffer(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return this.elements=e,this.elementsAccessor=t,this.clearDrawParams(),this.vertexArrayObject.setElementBuffer(e,t),this}setBuffer(e,t){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(t.target===34963)return this.setElementBuffer(t,r);const{location:i,accessor:o}=this._resolveLocationAndAccessor(e,t,t.accessor,r);return i>=0&&(this.values[i]=t,this.accessors[i]=o,this.clearDrawParams(),this.vertexArrayObject.setBuffer(i,t,o)),this}setConstant(e,t){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const{location:i,accessor:o}=this._resolveLocationAndAccessor(e,t,Object.assign({size:t.length},r));return i>=0&&(t=this.vertexArrayObject._normalizeConstantArrayValue(t),this.values[i]=t,this.accessors[i]=o,this.clearDrawParams(),this.vertexArrayObject.enable(i,!1)),this}unbindBuffers(){return this.vertexArrayObject.bind(()=>{this.elements&&this.vertexArrayObject.setElementBuffer(null),this.buffer=this.buffer||new ui(this.gl,{accessor:{size:4}});for(let e=0;e<this.vertexArrayObject.MAX_ATTRIBUTES;e++)this.values[e]instanceof ui&&(this.gl.disableVertexAttribArray(e),this.gl.bindBuffer(34962,this.buffer.handle),this.gl.vertexAttribPointer(e,1,5126,!1,0,0))}),this}bindBuffers(){return this.vertexArrayObject.bind(()=>{this.elements&&this.setElementBuffer(this.elements);for(let e=0;e<this.vertexArrayObject.MAX_ATTRIBUTES;e++){const t=this.values[e];t instanceof ui&&this.setBuffer(e,t)}}),this}bindForDraw(e,t,r){let i;return this.vertexArrayObject.bind(()=>{this._setConstantAttributes(e,t),i=r()}),i}_resolveLocationAndAccessor(e,t,r,i){const o={location:-1,accessor:null},{location:a,name:l}=this._getAttributeIndex(e);if(!Number.isFinite(a)||a<0)return this.unused[e]=t,Tn.once(3,()=>"unused value ".concat(e," in ").concat(this.id))(),o;const h=this._getAttributeInfo(l||a);if(!h)return o;const p=this.accessors[a]||{},g=Rs.resolve(h.accessor,p,r,i),{size:_,type:x}=g;return Jt(Number.isFinite(_)&&Number.isFinite(x)),{location:a,accessor:g}}_getAttributeInfo(e){return this.configuration&&this.configuration.getAttributeInfo(e)}_getAttributeIndex(e){const t=Number(e);if(Number.isFinite(t))return{location:t};const r=mY.exec(e),i=r?r[1]:e,o=r?Number(r[2]):0;return this.configuration?{location:this.configuration.getAttributeLocation(i)+o,name:i}:{location:-1}}_setAttribute(e,t){if(t instanceof ui)this.setBuffer(e,t);else if(Array.isArray(t)&&t.length&&t[0]instanceof ui){const r=t[0],i=t[1];this.setBuffer(e,r,i)}else if(ArrayBuffer.isView(t)||Array.isArray(t)){const r=t;this.setConstant(e,r)}else if(t.buffer instanceof ui){const r=t;this.setBuffer(e,r.buffer,r)}else throw new Error(gY)}_setConstantAttributes(e,t){const r=Math.max(e|0,t|0);let i=this.values[0];ArrayBuffer.isView(i)&&this._setConstantAttributeZero(i,r);for(let o=1;o<this.vertexArrayObject.MAX_ATTRIBUTES;o++)i=this.values[o],ArrayBuffer.isView(i)&&this._setConstantAttribute(o,i)}_setConstantAttributeZero(e,t){if(Cs.isSupported(this.gl,{constantAttributeZero:!0})){this._setConstantAttribute(0,e);return}const r=this.vertexArrayObject.getConstantBuffer(t,e);this.vertexArrayObject.setBuffer(0,r,this.accessors[0])}_setConstantAttribute(e,t){Cs.setConstant(this.gl,e,t)}_updateDrawParams(){const e={isIndexed:!1,isInstanced:!1,indexCount:1/0,vertexCount:1/0,instanceCount:1/0};for(let t=0;t<this.vertexArrayObject.MAX_ATTRIBUTES;t++)this._updateDrawParamsForLocation(e,t);return this.elements&&(e.elementCount=this.elements.getElementCount(this.elements.accessor),e.isIndexed=!0,e.indexType=this.elementsAccessor.type||this.elements.accessor.type,e.indexOffset=this.elementsAccessor.offset||0),e.indexCount===1/0&&(e.indexCount=0),e.vertexCount===1/0&&(e.vertexCount=0),e.instanceCount===1/0&&(e.instanceCount=0),e}_updateDrawParamsForLocation(e,t){const r=this.values[t],i=this.accessors[t];if(!r)return;const{divisor:o}=i,a=o>0;if(e.isInstanced=e.isInstanced||a,r instanceof ui){const l=r;if(a){const h=l.getVertexCount(i);e.instanceCount=Math.min(e.instanceCount,h)}else{const h=l.getVertexCount(i);e.vertexCount=Math.min(e.vertexCount,h)}}}setElements(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return Tn.deprecated("setElements","setElementBuffer")(),this.setElementBuffer(e,t)}}function vY(n,e){const{maxElts:t=16,size:r=1}=e;let i="[";for(let a=0;a<n.length&&a<t;++a)a>0&&(i+=",".concat(a%r===0?" ":"")),i+=m0(n[a],e);const o=n.length>t?"...":"]";return"".concat(i).concat(o)}function m0(n){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const t=1e-16,{isInteger:r=!1}=e;if(Array.isArray(n)||ArrayBuffer.isView(n))return vY(n,e);if(!Number.isFinite(n))return String(n);if(Math.abs(n)<t)return r?"0":"0.";if(r||Math.abs(n)>100&&Math.abs(n)<1e4)return n.toFixed(0);const i=n.toPrecision(2);return i.indexOf(".0")===i.length-2?i.slice(0,-1):i}function vL(n){let{header:e="Uniforms",program:t,uniforms:r,undefinedOnly:i=!1}=n;Jt(t);const o=".*_.*",a=".*Matrix",l=t._uniformSetters,h={},p=Object.keys(l).sort();let g=0;for(const C of p)!C.match(o)&&!C.match(a)&&WS({table:h,header:e,uniforms:r,uniformName:C,undefinedOnly:i})&&g++;for(const C of p)C.match(a)&&WS({table:h,header:e,uniforms:r,uniformName:C,undefinedOnly:i})&&g++;for(const C of p)h[C]||WS({table:h,header:e,uniforms:r,uniformName:C,undefinedOnly:i})&&g++;let _=0;const x={};if(!i)for(const C in r){const M=r[C];h[C]||(_++,x[C]={Type:"NOT USED: ".concat(M),[e]:m0(M)})}return{table:h,count:g,unusedTable:x,unusedCount:_}}function WS(n){let{table:e,header:t,uniforms:r,uniformName:i,undefinedOnly:o}=n;const a=r[i],l=bY(a);return!o||!l?(e[i]={[t]:l?m0(a):"N/A","Uniform Type":l?a:"NOT PROVIDED"},!0):!1}function bY(n){return n!=null}function wY(n){let{vertexArray:e,header:t="Attributes"}=n;if(!e.configuration)return{};const r={};e.elements&&(r.ELEMENT_ARRAY_BUFFER=bL(e,e.elements,null,t));const i=e.values;for(const o in i){const a=e._getAttributeInfo(o);if(a){let l="".concat(o,": ").concat(a.name);const h=e.accessors[a.location];h&&(l="".concat(o,": ").concat(xY(a.name,h))),r[l]=bL(e,i[o],h,t)}}return r}function bL(n,e,t,r){const{gl:i}=n;if(!e)return{[r]:"null","Format ":"N/A"};let o="NOT PROVIDED",a=1,l=0,h=0,p,g,_;if(t&&(o=t.type,a=t.size,o=String(o).replace("Array",""),p=o.indexOf("nt")!==-1),e instanceof ui){const x=e,{data:C,changed:M}=x.getDebugData();g=M?"*":"",_=C,h=x.byteLength,l=h/C.BYTES_PER_ELEMENT/a;let L;if(t){const D=t.divisor>0;L="".concat(D?"I ":"P "," ").concat(l," (x").concat(a,"=").concat(h," bytes ").concat($h(i,o),")")}else p=!0,L="".concat(h," bytes");return{[r]:"".concat(g).concat(m0(_,{size:a,isInteger:p})),"Format ":L}}return _=e,a=e.length,o=String(e.constructor.name).replace("Array",""),p=o.indexOf("nt")!==-1,{[r]:"".concat(m0(_,{size:a,isInteger:p})," (constant)"),"Format ":"".concat(a,"x").concat(o," (constant)")}}function xY(n,e){const{type:t,size:r}=e,i=t6(t,r);return i?"".concat(n," (").concat(i.name,")"):n}function EY(n){const e={},t="Accessors for ".concat(n.id);for(const r of n.attributeInfos)if(r){const i=wL(r);e["in ".concat(i)]={[t]:JSON.stringify(r.accessor)}}for(const r of n.varyingInfos)if(r){const i=wL(r);e["out ".concat(i)]={[t]:JSON.stringify(r.accessor)}}return e}function wL(n){const{type:e,size:t}=n.accessor,r=t6(e,t);return r?"".concat(r.name," ").concat(n.name):n.name}const xL=Ou()&&typeof document<"u";let TY=0;class SY{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{onCreateContext:t=D=>V5(D),onAddHTML:r=null,onInitialize:i=()=>{},onRender:o=()=>{},onFinalize:a=()=>{},onError:l,gl:h=null,glOptions:p={},debug:g=!1,createFramebuffer:_=!1,autoResizeViewport:x=!0,autoResizeDrawingBuffer:C=!0,stats:M=gf.get("animation-loop-".concat(TY++))}=e;let{useDevicePixels:L=!0}=e;"useDevicePixelRatio"in e&&(Tn.deprecated("useDevicePixelRatio","useDevicePixels")(),L=e.useDevicePixelRatio),this.props={onCreateContext:t,onAddHTML:r,onInitialize:i,onRender:o,onFinalize:a,onError:l,gl:h,glOptions:p,debug:g,createFramebuffer:_},this.gl=h,this.needsRedraw=null,this.timeline=null,this.stats=M,this.cpuTime=this.stats.get("CPU Time"),this.gpuTime=this.stats.get("GPU Time"),this.frameRate=this.stats.get("Frame Rate"),this._initialized=!1,this._running=!1,this._animationFrameId=null,this._nextFramePromise=null,this._resolveNextFrame=null,this._cpuStartTime=0,this.setProps({autoResizeViewport:x,autoResizeDrawingBuffer:C,useDevicePixels:L}),this.start=this.start.bind(this),this.stop=this.stop.bind(this),this._pageLoadPromise=null,this._onMousemove=this._onMousemove.bind(this),this._onMouseleave=this._onMouseleave.bind(this)}delete(){this.stop(),this._setDisplay(null)}setNeedsRedraw(e){return Jt(typeof e=="string"),this.needsRedraw=this.needsRedraw||e,this}setProps(e){return"autoResizeViewport"in e&&(this.autoResizeViewport=e.autoResizeViewport),"autoResizeDrawingBuffer"in e&&(this.autoResizeDrawingBuffer=e.autoResizeDrawingBuffer),"useDevicePixels"in e&&(this.useDevicePixels=e.useDevicePixels),this}start(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(this._running)return this;this._running=!0;const t=this._getPageLoadPromise().then(()=>!this._running||this._initialized?null:(this._createWebGLContext(e),this._createFramebuffer(),this._startEventHandling(),this._initializeCallbackData(),this._updateCallbackData(),this._resizeCanvasDrawingBuffer(),this._resizeViewport(),this._gpuTimeQuery=hx.isSupported(this.gl,["timers"])?new hx(this.gl):null,this._initialized=!0,this.onInitialize(this.animationProps))).then(r=>{this._running&&(this._addCallbackData(r||{}),r!==!1&&this._startLoop())});return this.props.onError&&t.catch(this.props.onError),this}redraw(){return this.isContextLost()?this:(this._beginTimers(),this._setupFrame(),this._updateCallbackData(),this._renderFrame(this.animationProps),this._clearNeedsRedraw(),this.offScreen&&this.gl.commit&&this.gl.commit(),this._resolveNextFrame&&(this._resolveNextFrame(this),this._nextFramePromise=null,this._resolveNextFrame=null),this._endTimers(),this)}stop(){return this._running&&(this._finalizeCallbackData(),this._cancelAnimationFrame(this._animationFrameId),this._nextFramePromise=null,this._resolveNextFrame=null,this._animationFrameId=null,this._running=!1),this}attachTimeline(e){return this.timeline=e,this.timeline}detachTimeline(){this.timeline=null}waitForRender(){return this.setNeedsRedraw("waitForRender"),this._nextFramePromise||(this._nextFramePromise=new Promise(e=>{this._resolveNextFrame=e})),this._nextFramePromise}async toDataURL(){return this.setNeedsRedraw("toDataURL"),await this.waitForRender(),this.gl.canvas.toDataURL()}isContextLost(){return this.gl.isContextLost()}onCreateContext(){return this.props.onCreateContext(...arguments)}onInitialize(){return this.props.onInitialize(...arguments)}onRender(){return this.props.onRender(...arguments)}onFinalize(){return this.props.onFinalize(...arguments)}getHTMLControlValue(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;const r=document.getElementById(e);return r?Number(r.value):t}setViewParameters(){return Tn.removed("AnimationLoop.setViewParameters","AnimationLoop.setProps")(),this}_startLoop(){const e=()=>{this._running&&(this.redraw(),this._animationFrameId=this._requestAnimationFrame(e))};this._cancelAnimationFrame(this._animationFrameId),this._animationFrameId=this._requestAnimationFrame(e)}_getPageLoadPromise(){return this._pageLoadPromise||(this._pageLoadPromise=xL?new Promise((e,t)=>{if(xL&&document.readyState==="complete"){e(document);return}window.addEventListener("load",()=>{e(document)})}):Promise.resolve({})),this._pageLoadPromise}_setDisplay(e){this.display&&(this.display.delete(),this.display.animationLoop=null),e&&(e.animationLoop=this),this.display=e}_cancelAnimationFrame(e){return this.display&&this.display.cancelAnimationFrame?this.display.cancelAnimationFrame(e):R$(e)}_requestAnimationFrame(e){if(this._running)return this.display&&this.display.requestAnimationFrame?this.display.requestAnimationFrame(e):M$(e)}_renderFrame(){if(this.display){this.display._renderFrame(...arguments);return}this.onRender(...arguments)}_clearNeedsRedraw(){this.needsRedraw=null}_setupFrame(){this._resizeCanvasDrawingBuffer(),this._resizeViewport(),this._resizeFramebuffer()}_initializeCallbackData(){this.animationProps={gl:this.gl,stop:this.stop,canvas:this.gl.canvas,framebuffer:this.framebuffer,useDevicePixels:this.useDevicePixels,needsRedraw:null,startTime:Date.now(),engineTime:0,tick:0,tock:0,time:0,_timeline:this.timeline,_loop:this,_animationLoop:this,_mousePosition:null}}_updateCallbackData(){const{width:e,height:t,aspect:r}=this._getSizeAndAspect();(e!==this.animationProps.width||t!==this.animationProps.height)&&this.setNeedsRedraw("drawing buffer resized"),r!==this.animationProps.aspect&&this.setNeedsRedraw("drawing buffer aspect changed"),this.animationProps.width=e,this.animationProps.height=t,this.animationProps.aspect=r,this.animationProps.needsRedraw=this.needsRedraw,this.animationProps.engineTime=Date.now()-this.animationProps.startTime,this.timeline&&this.timeline.update(this.animationProps.engineTime),this.animationProps.tick=Math.floor(this.animationProps.time/1e3*60),this.animationProps.tock++,this.animationProps.time=this.timeline?this.timeline.getTime():this.animationProps.engineTime,this.animationProps._offScreen=this.offScreen}_finalizeCallbackData(){this.onFinalize(this.animationProps)}_addCallbackData(e){typeof e=="object"&&e!==null&&(this.animationProps=Object.assign({},this.animationProps,e))}_createWebGLContext(e){if(this.offScreen=e.canvas&&typeof OffscreenCanvas<"u"&&e.canvas instanceof OffscreenCanvas,e=Object.assign({},e,this.props.glOptions),this.gl=this.props.gl?tM(this.props.gl,e):this.onCreateContext(e),!ZE(this.gl))throw new Error("AnimationLoop.onCreateContext - illegal context returned");y$(this.gl),this._createInfoDiv()}_createInfoDiv(){if(this.gl.canvas&&this.props.onAddHTML){const e=document.createElement("div");document.body.appendChild(e),e.style.position="relative";const t=document.createElement("div");t.style.position="absolute",t.style.left="10px",t.style.bottom="10px",t.style.width="300px",t.style.background="white",e.appendChild(this.gl.canvas),e.appendChild(t);const r=this.props.onAddHTML(t);r&&(t.innerHTML=r)}}_getSizeAndAspect(){const e=this.gl.drawingBufferWidth,t=this.gl.drawingBufferHeight;let r=1;const{canvas:i}=this.gl;return i&&i.clientHeight?r=i.clientWidth/i.clientHeight:e>0&&t>0&&(r=e/t),{width:e,height:t,aspect:r}}_resizeViewport(){this.autoResizeViewport&&this.gl.viewport(0,0,this.gl.drawingBufferWidth,this.gl.drawingBufferHeight)}_resizeCanvasDrawingBuffer(){this.autoResizeDrawingBuffer&&x$(this.gl,{useDevicePixels:this.useDevicePixels})}_createFramebuffer(){this.props.createFramebuffer&&(this.framebuffer=new Co(this.gl))}_resizeFramebuffer(){this.framebuffer&&this.framebuffer.resize({width:this.gl.drawingBufferWidth,height:this.gl.drawingBufferHeight})}_beginTimers(){this.frameRate.timeEnd(),this.frameRate.timeStart(),this._gpuTimeQuery&&this._gpuTimeQuery.isResultAvailable()&&!this._gpuTimeQuery.isTimerDisjoint()&&this.stats.get("GPU Time").addTime(this._gpuTimeQuery.getTimerMilliseconds()),this._gpuTimeQuery&&this._gpuTimeQuery.beginTimeElapsedQuery(),this.cpuTime.timeStart()}_endTimers(){this.cpuTime.timeEnd(),this._gpuTimeQuery&&this._gpuTimeQuery.end()}_startEventHandling(){const{canvas:e}=this.gl;e&&(e.addEventListener("mousemove",this._onMousemove),e.addEventListener("mouseleave",this._onMouseleave))}_onMousemove(e){this.animationProps._mousePosition=[e.offsetX,e.offsetY]}_onMouseleave(e){this.animationProps._mousePosition=null}}const tb="vs",oM="fs";function Ds(n,e){if(!n)throw new Error(e||"shadertools: assertion failed.")}const YS={number:{validate(n,e){return Number.isFinite(n)&&(!("max"in e)||n<=e.max)&&(!("min"in e)||n>=e.min)}},array:{validate(n,e){return Array.isArray(n)||ArrayBuffer.isView(n)}}};function CY(n){const e={};for(const t in n){const r=n[t],i=AY(r);e[t]=i}return e}function AY(n){let e=EL(n);return e==="object"?n?"type"in n?Object.assign({},n,YS[n.type]):"value"in n?(e=EL(n.value),Object.assign({type:e},n,YS[e])):{type:"object",value:n}:{type:"object",value:null}:Object.assign({type:e,value:n},YS[e])}function EL(n){return Array.isArray(n)||ArrayBuffer.isView(n)?"array":typeof n}const IY="vs",PY="fs";class TL{constructor(e){let{name:t,vs:r,fs:i,dependencies:o=[],uniforms:a,getUniforms:l,deprecations:h=[],defines:p={},inject:g={},vertexShader:_,fragmentShader:x}=e;Ds(typeof t=="string"),this.name=t,this.vs=r||_,this.fs=i||x,this.getModuleUniforms=l,this.dependencies=o,this.deprecations=this._parseDeprecationDefinitions(h),this.defines=p,this.injections=MY(g),a&&(this.uniforms=CY(a))}getModuleSource(e){let t;switch(e){case IY:t=this.vs||"";break;case PY:t=this.fs||"";break;default:Ds(!1)}return"#define MODULE_".concat(this.name.toUpperCase().replace(/[^0-9a-z]/gi,"_"),`
`).concat(t,"// END MODULE_").concat(this.name,`

`)}getUniforms(e,t){return this.getModuleUniforms?this.getModuleUniforms(e,t):this.uniforms?this._defaultGetUniforms(e):{}}getDefines(){return this.defines}checkDeprecations(e,t){this.deprecations.forEach(r=>{r.regex.test(e)&&(r.deprecated?t.deprecated(r.old,r.new)():t.removed(r.old,r.new)())})}_parseDeprecationDefinitions(e){return e.forEach(t=>{switch(t.type){case"function":t.regex=new RegExp("\\b".concat(t.old,"\\("));break;default:t.regex=new RegExp("".concat(t.type," ").concat(t.old,";"))}}),e}_defaultGetUniforms(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const t={},r=this.uniforms;for(const i in r){const o=r[i];i in e&&!o.private?(o.validate&&Ds(o.validate(e[i],o),"".concat(this.name,": invalid ").concat(i)),t[i]=e[i]):t[i]=o.value}return t}}function MY(n){const e={vs:{},fs:{}};for(const t in n){let r=n[t];const i=t.slice(0,2);typeof r=="string"&&(r={order:0,injection:r}),e[i][t]=r}return e}function RY(n){return kY(o6(n))}function kY(n){const e={},t={};return i6({modules:n,level:0,moduleMap:e,moduleDepth:t}),Object.keys(t).sort((r,i)=>t[i]-t[r]).map(r=>e[r])}function i6(n){let{modules:e,level:t,moduleMap:r,moduleDepth:i}=n;if(t>=5)throw new Error("Possible loop in shader dependency graph");for(const o of e)r[o.name]=o,(i[o.name]===void 0||i[o.name]<t)&&(i[o.name]=t);for(const o of e)o.dependencies&&i6({modules:o.dependencies,level:t+1,moduleMap:r,moduleDepth:i})}function o6(n,e){return n.map(t=>(t instanceof TL||(Ds(typeof t!="string","Shader module use by name is deprecated. Import shader module '".concat(t,"' and use it directly.")),Ds(t.name,"shader module has no name"),t=new TL(t),t.dependencies=o6(t.dependencies)),t))}function OY(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const e=typeof window<"u"?window.navigator||{}:{},t=n.userAgent||e.userAgent||"",r=t.indexOf("MSIE ")!==-1,i=t.indexOf("Trident/")!==-1;return r||i}const LY=7936,NY=7937,DY=7938,FY=35724,aM={GLSL_FRAG_DATA:["WEBGL_draw_buffers",!0],GLSL_FRAG_DEPTH:["EXT_frag_depth",!0],GLSL_DERIVATIVES:["OES_standard_derivatives",!0],GLSL_TEXTURE_LOD:["EXT_shader_texture_lod",!0]},ef={};Object.keys(aM).forEach(n=>{ef[n]=n});function BY(n){return typeof WebGL2RenderingContext<"u"&&n instanceof WebGL2RenderingContext?!0:!!(n&&n._version===2)}function UY(n){const e=n.getExtension("WEBGL_debug_renderer_info"),t=n.getParameter(e&&e.UNMASKED_VENDOR_WEBGL||LY),r=n.getParameter(e&&e.UNMASKED_RENDERER_WEBGL||NY);return{gpuVendor:zY(t,r),vendor:t,renderer:r,version:n.getParameter(DY),shadingLanguageVersion:n.getParameter(FY)}}function zY(n,e){return n.match(/NVIDIA/i)||e.match(/NVIDIA/i)?"NVIDIA":n.match(/INTEL/i)||e.match(/INTEL/i)?"INTEL":n.match(/AMD/i)||e.match(/AMD/i)||n.match(/ATI/i)||e.match(/ATI/i)?"AMD":"UNKNOWN GPU"}const KS={};function SL(n,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const r=aM[e];if(Ds(r,e),!OY(t))return!0;if(e in KS)return KS[e];const i=r[0],o=t.behavior||"enable",a="#extension GL_".concat(i," : ").concat(o,`
void main(void) {}`),l=n.createShader(35633);n.shaderSource(l,a),n.compileShader(l);const h=n.getShaderParameter(l,35713);return n.deleteShader(l),KS[e]=h,h}function jY(n,e){const t=aM[e];Ds(t,e);const r=BY(n)&&t[1]||t[0],i=typeof r=="string"?!!n.getExtension(r):r;return Ds(i===!1||i===!0),i}function O1(n,e){return e=Array.isArray(e)?e:[e],e.every(t=>jY(n,t))}function VY(n){switch(UY(n).gpuVendor.toLowerCase()){case"nvidia":return`#define NVIDIA_GPU
// Nvidia optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
`;case"intel":return`#define INTEL_GPU
// Intel optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
// Intel's built-in 'tan' function doesn't have acceptable precision
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`;case"amd":return`#define AMD_GPU
`;default:return`#define DEFAULT_GPU
// Prevent driver from optimizing away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
// Intel's built-in 'tan' function doesn't have acceptable precision
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`}}function HY(n,e,t){let r=`#if (__VERSION__ > 120)

# define FEATURE_GLSL_DERIVATIVES
# define FEATURE_GLSL_DRAW_BUFFERS
# define FEATURE_GLSL_FRAG_DEPTH
# define FEATURE_GLSL_TEXTURE_LOD

// DEPRECATED FLAGS, remove in v9
# define FRAG_DEPTH
# define DERIVATIVES
# define DRAW_BUFFERS
# define TEXTURE_LOD

#endif // __VERSION
`;return O1(n,ef.GLSL_FRAG_DEPTH)&&(r+=`
// FRAG_DEPTH => gl_FragDepth is available
#ifdef GL_EXT_frag_depth
#extension GL_EXT_frag_depth : enable
# define FEATURE_GLSL_FRAG_DEPTH
# define FRAG_DEPTH
# define gl_FragDepth gl_FragDepthEXT
#endif
`),O1(n,ef.GLSL_DERIVATIVES)&&SL(n,ef.GLSL_DERIVATIVES)&&(r+=`
// DERIVATIVES => dxdF, dxdY and fwidth are available
#ifdef GL_OES_standard_derivatives
#extension GL_OES_standard_derivatives : enable
# define FEATURE_GLSL_DERIVATIVES
# define DERIVATIVES
#endif
`),O1(n,ef.GLSL_FRAG_DATA)&&SL(n,ef.GLSL_FRAG_DATA,{behavior:"require"})&&(r+=`
// DRAW_BUFFERS => gl_FragData[] is available
#ifdef GL_EXT_draw_buffers
#extension GL_EXT_draw_buffers : require
#define FEATURE_GLSL_DRAW_BUFFERS
#define DRAW_BUFFERS
#endif
`),O1(n,ef.GLSL_TEXTURE_LOD)&&(r+=`// TEXTURE_LOD => texture2DLod etc are available
#ifdef GL_EXT_shader_texture_lod
#extension GL_EXT_shader_texture_lod : enable

# define FEATURE_GLSL_TEXTURE_LOD
# define TEXTURE_LOD

#endif
`),r}const GY=`#ifdef MODULE_LOGDEPTH
  logdepth_adjustPosition(gl_Position);
#endif
`,qY=`#ifdef MODULE_MATERIAL
  gl_FragColor = material_filterColor(gl_FragColor);
#endif

#ifdef MODULE_LIGHTING
  gl_FragColor = lighting_filterColor(gl_FragColor);
#endif

#ifdef MODULE_FOG
  gl_FragColor = fog_filterColor(gl_FragColor);
#endif

#ifdef MODULE_PICKING
  gl_FragColor = picking_filterHighlightColor(gl_FragColor);
  gl_FragColor = picking_filterPickingColor(gl_FragColor);
#endif

#ifdef MODULE_LOGDEPTH
  logdepth_setFragDepth();
#endif
`,$Y={[tb]:GY,[oM]:qY},Mw="__LUMA_INJECT_DECLARATIONS__",CL=/void\s+main\s*\([^)]*\)\s*\{\n?/,AL=/}\n?[^{}]*$/,ZS=[];function IL(n,e,t){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;const i=e===tb;for(const o in t){const a=t[o];a.sort((h,p)=>h.order-p.order),ZS.length=a.length;for(let h=0,p=a.length;h<p;++h)ZS[h]=a[h].injection;const l="".concat(ZS.join(`
`),`
`);switch(o){case"vs:#decl":i&&(n=n.replace(Mw,l));break;case"vs:#main-start":i&&(n=n.replace(CL,h=>h+l));break;case"vs:#main-end":i&&(n=n.replace(AL,h=>l+h));break;case"fs:#decl":i||(n=n.replace(Mw,l));break;case"fs:#main-start":i||(n=n.replace(CL,h=>h+l));break;case"fs:#main-end":i||(n=n.replace(AL,h=>l+h));break;default:n=n.replace(o,h=>h+l)}}return n=n.replace(Mw,""),r&&(n=n.replace(/\}\s*$/,o=>o+$Y[e])),n}function I2(n){const e={};return Ds(Array.isArray(n)&&n.length>1),n.forEach(t=>{for(const r in t)e[r]=e[r]?"".concat(e[r],`
`).concat(t[r]):t[r]}),e}function Vm(n){return new RegExp("\\b".concat(n,"[ \\t]+(\\w+[ \\t]+\\w+(\\[\\w+\\])?;)"),"g")}const a6=[[/^(#version[ \t]+(100|300[ \t]+es))?[ \t]*\n/,`#version 300 es
`],[/\btexture(2D|2DProj|Cube)Lod(EXT)?\(/g,"textureLod("],[/\btexture(2D|2DProj|Cube)(EXT)?\(/g,"texture("]],WY=[...a6,[Vm("attribute"),"in $1"],[Vm("varying"),"out $1"]],YY=[...a6,[Vm("varying"),"in $1"]],s6=[[/^#version[ \t]+300[ \t]+es/,"#version 100"],[/\btexture(2D|2DProj|Cube)Lod\(/g,"texture$1LodEXT("],[/\btexture\(/g,"texture2D("],[/\btextureLod\(/g,"texture2DLodEXT("]],KY=[...s6,[Vm("in"),"attribute $1"],[Vm("out"),"varying $1"]],ZY=[...s6,[Vm("in"),"varying $1"]],P2="gl_FragColor",M2=/\bout[ \t]+vec4[ \t]+(\w+)[ \t]*;\n?/,XY=/void\s+main\s*\([^)]*\)\s*\{\n?/;function QY(n,e,t){switch(e){case 300:return t?dx(n,WY):JY(n);case 100:return t?dx(n,KY):eK(n);default:throw new Error("unknown GLSL version ".concat(e))}}function dx(n,e){for(const[t,r]of e)n=n.replace(t,r);return n}function JY(n){n=dx(n,YY);const e=n.match(M2);if(e){const t=e[1];n=n.replace(new RegExp("\\b".concat(P2,"\\b"),"g"),t)}else{const t="fragmentColor";n=n.replace(XY,r=>"out vec4 ".concat(t,`;
`).concat(r)).replace(new RegExp("\\b".concat(P2,"\\b"),"g"),t)}return n}function eK(n){n=dx(n,ZY);const e=n.match(M2);if(e){const t=e[1];n=n.replace(M2,"").replace(new RegExp("\\b".concat(t,"\\b"),"g"),P2)}return n}const tK=`

`.concat(Mw,`

`),c6={[tb]:"vertex",[oM]:"fragment"},nK=`precision highp float;

`;function rK(n,e){const{vs:t,fs:r}=e,i=RY(e.modules||[]);return{gl:n,vs:PL(n,Object.assign({},e,{source:t,type:tb,modules:i})),fs:PL(n,Object.assign({},e,{source:r,type:oM,modules:i})),getUniforms:iK(i)}}function PL(n,e){let{id:t,source:r,type:i,modules:o,defines:a={},hookFunctions:l=[],inject:h={},transpileToGLSL100:p=!1,prologue:g=!0,log:_}=e;Ds(typeof r=="string","shader source must be a string");const x=i===tb,C=r.split(`
`);let M=100,L="",D=r;C[0].indexOf("#version ")===0?(M=300,L=C[0],D=C.slice(1).join(`
`)):L="#version ".concat(M);const z={};o.forEach(pe=>{Object.assign(z,pe.getDefines())}),Object.assign(z,a);let te=g?"".concat(L,`
`).concat(aK({id:t,source:r,type:i}),`
`).concat(oK({type:i}),`
`).concat(VY(n),`
`).concat(HY(n),`
`).concat(sK(z),`
`).concat(x?"":nK,`
`):"".concat(L,`
`);const le=lK(l),ce={},_e={},J={};for(const pe in h){const ue=typeof h[pe]=="string"?{injection:h[pe],order:0}:h[pe],xe=pe.match(/^(v|f)s:(#)?([\w-]+)$/);if(xe){const je=xe[2],ne=xe[3];je?ne==="decl"?_e[pe]=[ue]:J[pe]=[ue]:ce[pe]=[ue]}else J[pe]=[ue]}for(const pe of o){_&&pe.checkDeprecations(D,_);const ue=pe.getModuleSource(i,M);te+=ue;const xe=pe.injections[i];for(const je in xe){const ne=je.match(/^(v|f)s:#([\w-]+)$/);if(ne){const ke=ne[2]==="decl"?_e:J;ke[je]=ke[je]||[],ke[je].push(xe[je])}else ce[je]=ce[je]||[],ce[je].push(xe[je])}}return te+=tK,te=IL(te,i,_e),te+=cK(le[i],ce),te+=D,te=IL(te,i,J),te=QY(te,p?100:M,x),te}function iK(n){return function(t){const r={};for(const i of n){const o=i.getUniforms(t,r);Object.assign(r,o)}return r}}function oK(n){let{type:e}=n;return`
#define SHADER_TYPE_`.concat(c6[e].toUpperCase(),`
`)}function aK(n){let{id:e,source:t,type:r}=n;return e&&typeof e=="string"&&t.indexOf("SHADER_NAME")===-1?`
#define SHADER_NAME `.concat(e,"_").concat(c6[r],`

`):""}function sK(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=0,t="";for(const r in n){e===0&&(t+=`
// APPLICATION DEFINES
`),e++;const i=n[r];(i||Number.isFinite(i))&&(t+="#define ".concat(r.toUpperCase()," ").concat(n[r],`
`))}return e===0&&(t+=`
`),t}function cK(n,e){let t="";for(const r in n){const i=n[r];if(t+="void ".concat(i.signature,` {
`),i.header&&(t+="  ".concat(i.header)),e[r]){const o=e[r];o.sort((a,l)=>a.order-l.order);for(const a of o)t+="  ".concat(a.injection,`
`)}i.footer&&(t+="  ".concat(i.footer)),t+=`}
`}return t}function lK(n){const e={vs:{},fs:{}};return n.forEach(t=>{let r;typeof t!="string"?(r=t,t=r.hook):r={},t=t.trim();const[i,o]=t.split(":"),a=t.replace(/\(.+/,"");e[i][a]=Object.assign(r,{signature:o})}),e}const uK="void main() {gl_FragColor = vec4(0);}",l6=`out vec4 transform_output;
void main() {
  transform_output = vec4(0);
}`,hK=`#version 300 es
`.concat(l6);function u6(n,e){e=Array.isArray(e)?e:[e];const t=n.replace(/^\s+/,"").split(/\s+/),[r,i,o]=t;if(!e.includes(r)||!i||!o)return null;const a=o.split(";")[0];return{qualifier:r,type:i,name:a}}function h6(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{version:e=100,input:t,inputType:r,output:i}=n;if(!t)return e===300?hK:e>300?"#version ".concat(e,`
`).concat(l6):uK;const o=pK(t,r);return e>=300?"#version ".concat(e," ").concat(e===300?"es":"",`
in `).concat(r," ").concat(t,`;
out vec4 `).concat(i,`;
void main() {
  `).concat(i," = ").concat(o,`;
}`):"varying ".concat(r," ").concat(t,`;
void main() {
  gl_FragColor = `).concat(o,`;
}`)}function dK(n){switch(n){case"float":return"x";case"vec2":return"xy";case"vec3":return"xyz";case"vec4":return"xyzw";default:return Ds(!1),null}}function fK(n){switch(n){case"float":return 1;case"vec2":return 2;case"vec3":return 3;case"vec4":return 4;default:return Ds(!1),null}}function pK(n,e){switch(e){case"float":return"vec4(".concat(n,", 0.0, 0.0, 1.0)");case"vec2":return"vec4(".concat(n,", 0.0, 1.0)");case"vec3":return"vec4(".concat(n,", 1.0)");case"vec4":return n;default:return Ds(!1),null}}const gK=`#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND
const float TWO_PI = 6.2831854820251465;
const float PI_2 = 1.5707963705062866;
const float PI_16 = 0.1963495463132858;

const float SIN_TABLE_0 = 0.19509032368659973;
const float SIN_TABLE_1 = 0.3826834261417389;
const float SIN_TABLE_2 = 0.5555702447891235;
const float SIN_TABLE_3 = 0.7071067690849304;

const float COS_TABLE_0 = 0.9807852506637573;
const float COS_TABLE_1 = 0.9238795042037964;
const float COS_TABLE_2 = 0.8314695954322815;
const float COS_TABLE_3 = 0.7071067690849304;

const float INVERSE_FACTORIAL_3 = 1.666666716337204e-01;
const float INVERSE_FACTORIAL_5 = 8.333333767950535e-03;
const float INVERSE_FACTORIAL_7 = 1.9841270113829523e-04;
const float INVERSE_FACTORIAL_9 = 2.75573188446287533e-06;

float sin_taylor_fp32(float a) {
  float r, s, t, x;

  if (a == 0.0) {
    return 0.0;
  }

  x = -a * a;
  s = a;
  r = a;

  r = r * x;
  t = r * INVERSE_FACTORIAL_3;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_5;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_7;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_9;
  s = s + t;

  return s;
}

void sincos_taylor_fp32(float a, out float sin_t, out float cos_t) {
  if (a == 0.0) {
    sin_t = 0.0;
    cos_t = 1.0;
  }
  sin_t = sin_taylor_fp32(a);
  cos_t = sqrt(1.0 - sin_t * sin_t);
}

float tan_taylor_fp32(float a) {
    float sin_a;
    float cos_a;

    if (a == 0.0) {
        return 0.0;
    }
    float z = floor(a / TWO_PI);
    float r = a - TWO_PI * z;

    float t;
    float q = floor(r / PI_2 + 0.5);
    int j = int(q);

    if (j < -2 || j > 2) {
        return 1.0 / 0.0;
    }

    t = r - PI_2 * q;

    q = floor(t / PI_16 + 0.5);
    int k = int(q);
    int abs_k = int(abs(float(k)));

    if (abs_k > 4) {
        return 1.0 / 0.0;
    } else {
        t = t - PI_16 * q;
    }

    float u = 0.0;
    float v = 0.0;

    float sin_t, cos_t;
    float s, c;
    sincos_taylor_fp32(t, sin_t, cos_t);

    if (k == 0) {
        s = sin_t;
        c = cos_t;
    } else {
        if (abs(float(abs_k) - 1.0) < 0.5) {
            u = COS_TABLE_0;
            v = SIN_TABLE_0;
        } else if (abs(float(abs_k) - 2.0) < 0.5) {
            u = COS_TABLE_1;
            v = SIN_TABLE_1;
        } else if (abs(float(abs_k) - 3.0) < 0.5) {
            u = COS_TABLE_2;
            v = SIN_TABLE_2;
        } else if (abs(float(abs_k) - 4.0) < 0.5) {
            u = COS_TABLE_3;
            v = SIN_TABLE_3;
        }
        if (k > 0) {
            s = u * sin_t + v * cos_t;
            c = u * cos_t - v * sin_t;
        } else {
            s = u * sin_t - v * cos_t;
            c = u * cos_t + v * sin_t;
        }
    }

    if (j == 0) {
        sin_a = s;
        cos_a = c;
    } else if (j == 1) {
        sin_a = c;
        cos_a = -s;
    } else if (j == -1) {
        sin_a = -c;
        cos_a = s;
    } else {
        sin_a = -s;
        cos_a = -c;
    }
    return sin_a / cos_a;
}
#endif

float tan_fp32(float a) {
#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND
  return tan_taylor_fp32(a);
#else
  return tan(a);
#endif
}
`,mK={name:"fp32",vs:gK,fs:null};function ML(n,e){if(!n)throw new Error("math.gl assertion ".concat(e))}const Os={EPSILON:1e-12,debug:!1,precision:4,printTypes:!1,printDegrees:!1,printRowMajor:!0};function yK(n,{precision:e=Os.precision}={}){return n=_K(n),"".concat(parseFloat(n.toPrecision(e)))}function Hm(n){return Array.isArray(n)||ArrayBuffer.isView(n)&&!(n instanceof DataView)}function Uh(n,e,t){return bK(n,r=>Math.max(e,Math.min(t,r)))}function fx(n,e,t){return Hm(n)?n.map((r,i)=>fx(r,e[i],t)):t*e+(1-t)*n}function y0(n,e,t){const r=Os.EPSILON;t&&(Os.EPSILON=t);try{if(n===e)return!0;if(Hm(n)&&Hm(e)){if(n.length!==e.length)return!1;for(let i=0;i<n.length;++i)if(!y0(n[i],e[i]))return!1;return!0}return n&&n.equals?n.equals(e):e&&e.equals?e.equals(n):typeof n=="number"&&typeof e=="number"?Math.abs(n-e)<=Os.EPSILON*Math.max(1,Math.abs(n),Math.abs(e)):!1}finally{Os.EPSILON=r}}function _K(n){return Math.round(n/Os.EPSILON)*Os.EPSILON}function vK(n){return n.clone?n.clone():new Array(n.length)}function bK(n,e,t){if(Hm(n)){const r=n;t=t||vK(r);for(let i=0;i<t.length&&i<r.length;++i)t[i]=e(n[i],i,t);return t}return e(n)}function wK(n){function e(){var t=Reflect.construct(n,Array.from(arguments));return Object.setPrototypeOf(t,Object.getPrototypeOf(this)),t}return e.prototype=Object.create(n.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),Object.setPrototypeOf?Object.setPrototypeOf(e,n):e.__proto__=n,e}class d6 extends wK(Array){clone(){return new this.constructor().copy(this)}fromArray(e,t=0){for(let r=0;r<this.ELEMENTS;++r)this[r]=e[r+t];return this.check()}toArray(e=[],t=0){for(let r=0;r<this.ELEMENTS;++r)e[t+r]=this[r];return e}from(e){return Array.isArray(e)?this.copy(e):this.fromObject(e)}to(e){return e===this?this:Hm(e)?this.toArray(e):this.toObject(e)}toTarget(e){return e?this.to(e):this}toFloat32Array(){return new Float32Array(this)}toString(){return this.formatString(Os)}formatString(e){let t="";for(let r=0;r<this.ELEMENTS;++r)t+=(r>0?", ":"")+yK(this[r],e);return"".concat(e.printTypes?this.constructor.name:"","[").concat(t,"]")}equals(e){if(!e||this.length!==e.length)return!1;for(let t=0;t<this.ELEMENTS;++t)if(!y0(this[t],e[t]))return!1;return!0}exactEquals(e){if(!e||this.length!==e.length)return!1;for(let t=0;t<this.ELEMENTS;++t)if(this[t]!==e[t])return!1;return!0}negate(){for(let e=0;e<this.ELEMENTS;++e)this[e]=-this[e];return this.check()}lerp(e,t,r){if(r===void 0)return this.lerp(this,e,t);for(let i=0;i<this.ELEMENTS;++i){const o=e[i];this[i]=o+r*(t[i]-o)}return this.check()}min(e){for(let t=0;t<this.ELEMENTS;++t)this[t]=Math.min(e[t],this[t]);return this.check()}max(e){for(let t=0;t<this.ELEMENTS;++t)this[t]=Math.max(e[t],this[t]);return this.check()}clamp(e,t){for(let r=0;r<this.ELEMENTS;++r)this[r]=Math.min(Math.max(this[r],e[r]),t[r]);return this.check()}add(...e){for(const t of e)for(let r=0;r<this.ELEMENTS;++r)this[r]+=t[r];return this.check()}subtract(...e){for(const t of e)for(let r=0;r<this.ELEMENTS;++r)this[r]-=t[r];return this.check()}scale(e){if(typeof e=="number")for(let t=0;t<this.ELEMENTS;++t)this[t]*=e;else for(let t=0;t<this.ELEMENTS&&t<e.length;++t)this[t]*=e[t];return this.check()}multiplyByScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]*=e;return this.check()}check(){if(Os.debug&&!this.validate())throw new Error("math.gl: ".concat(this.constructor.name," some fields set to invalid numbers'"));return this}validate(){let e=this.length===this.ELEMENTS;for(let t=0;t<this.ELEMENTS;++t)e=e&&Number.isFinite(this[t]);return e}sub(e){return this.subtract(e)}setScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]=e;return this.check()}addScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]+=e;return this.check()}subScalar(e){return this.addScalar(-e)}multiplyScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]*=e;return this.check()}divideScalar(e){return this.multiplyByScalar(1/e)}clampScalar(e,t){for(let r=0;r<this.ELEMENTS;++r)this[r]=Math.min(Math.max(this[r],e),t);return this.check()}get elements(){return this}}function xK(n,e){if(n.length!==e)return!1;for(let t=0;t<n.length;++t)if(!Number.isFinite(n[t]))return!1;return!0}function Ms(n){if(!Number.isFinite(n))throw new Error("Invalid number ".concat(n));return n}function XS(n,e,t=""){if(Os.debug&&!xK(n,e))throw new Error("math.gl: ".concat(t," some fields set to invalid numbers'"));return n}class EK extends d6{get x(){return this[0]}set x(e){this[0]=Ms(e)}get y(){return this[1]}set y(e){this[1]=Ms(e)}len(){return Math.sqrt(this.lengthSquared())}magnitude(){return this.len()}lengthSquared(){let e=0;for(let t=0;t<this.ELEMENTS;++t)e+=this[t]*this[t];return e}magnitudeSquared(){return this.lengthSquared()}distance(e){return Math.sqrt(this.distanceSquared(e))}distanceSquared(e){let t=0;for(let r=0;r<this.ELEMENTS;++r){const i=this[r]-e[r];t+=i*i}return Ms(t)}dot(e){let t=0;for(let r=0;r<this.ELEMENTS;++r)t+=this[r]*e[r];return Ms(t)}normalize(){const e=this.magnitude();if(e!==0)for(let t=0;t<this.ELEMENTS;++t)this[t]/=e;return this.check()}multiply(...e){for(const t of e)for(let r=0;r<this.ELEMENTS;++r)this[r]*=t[r];return this.check()}divide(...e){for(const t of e)for(let r=0;r<this.ELEMENTS;++r)this[r]/=t[r];return this.check()}lengthSq(){return this.lengthSquared()}distanceTo(e){return this.distance(e)}distanceToSquared(e){return this.distanceSquared(e)}getComponent(e){return ML(e>=0&&e<this.ELEMENTS,"index is out of range"),Ms(this[e])}setComponent(e,t){return ML(e>=0&&e<this.ELEMENTS,"index is out of range"),this[e]=t,this.check()}addVectors(e,t){return this.copy(e).add(t)}subVectors(e,t){return this.copy(e).subtract(t)}multiplyVectors(e,t){return this.copy(e).multiply(t)}addScaledVector(e,t){return this.add(new this.constructor(e).multiplyScalar(t))}}var uo=1e-6,Gm=typeof Float32Array<"u"?Float32Array:Array;Math.hypot||(Math.hypot=function(){for(var n=0,e=arguments.length;e--;)n+=arguments[e]*arguments[e];return Math.sqrt(n)});function TK(){var n=new Gm(2);return Gm!=Float32Array&&(n[0]=0,n[1]=0),n}function px(n,e,t){return n[0]=e[0]+t[0],n[1]=e[1]+t[1],n}function f6(n,e){return n[0]=-e[0],n[1]=-e[1],n}function p6(n,e,t,r){var i=e[0],o=e[1];return n[0]=i+r*(t[0]-i),n[1]=o+r*(t[1]-o),n}function SK(n,e,t){var r=e[0],i=e[1];return n[0]=t[0]*r+t[4]*i+t[12],n[1]=t[1]*r+t[5]*i+t[13],n}(function(){var n=TK();return function(e,t,r,i,o,a){var l,h;for(t||(t=2),r||(r=0),i?h=Math.min(i*t+r,e.length):h=e.length,l=r;l<h;l+=t)n[0]=e[l],n[1]=e[l+1],o(n,n,a),e[l]=n[0],e[l+1]=n[1];return e}})();function CK(n,e,t){const r=e[0],i=e[1],o=t[3]*r+t[7]*i||1;return n[0]=(t[0]*r+t[4]*i)/o,n[1]=(t[1]*r+t[5]*i)/o,n}function g6(n,e,t){const r=e[0],i=e[1],o=e[2],a=t[3]*r+t[7]*i+t[11]*o||1;return n[0]=(t[0]*r+t[4]*i+t[8]*o)/a,n[1]=(t[1]*r+t[5]*i+t[9]*o)/a,n[2]=(t[2]*r+t[6]*i+t[10]*o)/a,n}function AK(n,e,t){const r=e[0],i=e[1];return n[0]=t[0]*r+t[2]*i,n[1]=t[1]*r+t[3]*i,n[2]=e[2],n}function IK(){var n=new Gm(3);return Gm!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0),n}function PK(n,e,t){return n[0]=e[0]+t[0],n[1]=e[1]+t[1],n[2]=e[2]+t[2],n}function MK(n,e,t){return n[0]=e[0]-t[0],n[1]=e[1]-t[1],n[2]=e[2]-t[2],n}function RK(n,e,t){return n[0]=e[0]*t[0],n[1]=e[1]*t[1],n[2]=e[2]*t[2],n}function kK(n,e){return n[0]=-e[0],n[1]=-e[1],n[2]=-e[2],n}function OK(n,e){return n[0]*e[0]+n[1]*e[1]+n[2]*e[2]}function LK(n,e,t){var r=e[0],i=e[1],o=e[2],a=t[0],l=t[1],h=t[2];return n[0]=i*h-o*l,n[1]=o*a-r*h,n[2]=r*l-i*a,n}function m6(n,e,t){var r=e[0],i=e[1],o=e[2],a=t[3]*r+t[7]*i+t[11]*o+t[15];return a=a||1,n[0]=(t[0]*r+t[4]*i+t[8]*o+t[12])/a,n[1]=(t[1]*r+t[5]*i+t[9]*o+t[13])/a,n[2]=(t[2]*r+t[6]*i+t[10]*o+t[14])/a,n}function NK(n,e,t){var r=e[0],i=e[1],o=e[2];return n[0]=r*t[0]+i*t[3]+o*t[6],n[1]=r*t[1]+i*t[4]+o*t[7],n[2]=r*t[2]+i*t[5]+o*t[8],n}function DK(n,e,t){var r=t[0],i=t[1],o=t[2],a=t[3],l=e[0],h=e[1],p=e[2],g=i*p-o*h,_=o*l-r*p,x=r*h-i*l,C=i*x-o*_,M=o*g-r*x,L=r*_-i*g,D=a*2;return g*=D,_*=D,x*=D,C*=2,M*=2,L*=2,n[0]=l+g+C,n[1]=h+_+M,n[2]=p+x+L,n}function FK(n,e,t,r){var i=[],o=[];return i[0]=e[0]-t[0],i[1]=e[1]-t[1],i[2]=e[2]-t[2],o[0]=i[0],o[1]=i[1]*Math.cos(r)-i[2]*Math.sin(r),o[2]=i[1]*Math.sin(r)+i[2]*Math.cos(r),n[0]=o[0]+t[0],n[1]=o[1]+t[1],n[2]=o[2]+t[2],n}function BK(n,e,t,r){var i=[],o=[];return i[0]=e[0]-t[0],i[1]=e[1]-t[1],i[2]=e[2]-t[2],o[0]=i[2]*Math.sin(r)+i[0]*Math.cos(r),o[1]=i[1],o[2]=i[2]*Math.cos(r)-i[0]*Math.sin(r),n[0]=o[0]+t[0],n[1]=o[1]+t[1],n[2]=o[2]+t[2],n}function UK(n,e,t,r){var i=[],o=[];return i[0]=e[0]-t[0],i[1]=e[1]-t[1],i[2]=e[2]-t[2],o[0]=i[0]*Math.cos(r)-i[1]*Math.sin(r),o[1]=i[0]*Math.sin(r)+i[1]*Math.cos(r),o[2]=i[2],n[0]=o[0]+t[0],n[1]=o[1]+t[1],n[2]=o[2]+t[2],n}function zK(n,e){var t=n[0],r=n[1],i=n[2],o=e[0],a=e[1],l=e[2],h=Math.sqrt(t*t+r*r+i*i),p=Math.sqrt(o*o+a*a+l*l),g=h*p,_=g&&OK(n,e)/g;return Math.acos(Math.min(Math.max(_,-1),1))}var jK=MK,VK=RK;(function(){var n=IK();return function(e,t,r,i,o,a){var l,h;for(t||(t=3),r||(r=0),i?h=Math.min(i*t+r,e.length):h=e.length,l=r;l<h;l+=t)n[0]=e[l],n[1]=e[l+1],n[2]=e[l+2],o(n,n,a),e[l]=n[0],e[l+1]=n[1],e[l+2]=n[2];return e}})();const QS=[0,0,0];let L1;class Tl extends EK{static get ZERO(){return L1||(L1=new Tl(0,0,0),Object.freeze(L1)),L1}constructor(e=0,t=0,r=0){super(-0,-0,-0),arguments.length===1&&Hm(e)?this.copy(e):(Os.debug&&(Ms(e),Ms(t),Ms(r)),this[0]=e,this[1]=t,this[2]=r)}set(e,t,r){return this[0]=e,this[1]=t,this[2]=r,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this.check()}fromObject(e){return Os.debug&&(Ms(e.x),Ms(e.y),Ms(e.z)),this[0]=e.x,this[1]=e.y,this[2]=e.z,this.check()}toObject(e){return e.x=this[0],e.y=this[1],e.z=this[2],e}get ELEMENTS(){return 3}get z(){return this[2]}set z(e){this[2]=Ms(e)}angle(e){return zK(this,e)}cross(e){return LK(this,this,e),this.check()}rotateX({radians:e,origin:t=QS}){return FK(this,this,t,e),this.check()}rotateY({radians:e,origin:t=QS}){return BK(this,this,t,e),this.check()}rotateZ({radians:e,origin:t=QS}){return UK(this,this,t,e),this.check()}transform(e){return this.transformAsPoint(e)}transformAsPoint(e){return m6(this,this,e),this.check()}transformAsVector(e){return g6(this,this,e),this.check()}transformByMatrix3(e){return NK(this,this,e),this.check()}transformByMatrix2(e){return AK(this,this,e),this.check()}transformByQuaternion(e){return DK(this,this,e),this.check()}}class HK extends d6{toString(){let e="[";if(Os.printRowMajor){e+="row-major:";for(let t=0;t<this.RANK;++t)for(let r=0;r<this.RANK;++r)e+=" ".concat(this[r*this.RANK+t])}else{e+="column-major:";for(let t=0;t<this.ELEMENTS;++t)e+=" ".concat(this[t])}return e+="]",e}getElementIndex(e,t){return t*this.RANK+e}getElement(e,t){return this[t*this.RANK+e]}setElement(e,t,r){return this[t*this.RANK+e]=Ms(r),this}getColumn(e,t=new Array(this.RANK).fill(-0)){const r=e*this.RANK;for(let i=0;i<this.RANK;++i)t[i]=this[r+i];return t}setColumn(e,t){const r=e*this.RANK;for(let i=0;i<this.RANK;++i)this[r+i]=t[i];return this}}function GK(n){return n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function qK(n,e){if(n===e){var t=e[1],r=e[2],i=e[3],o=e[6],a=e[7],l=e[11];n[1]=e[4],n[2]=e[8],n[3]=e[12],n[4]=t,n[6]=e[9],n[7]=e[13],n[8]=r,n[9]=o,n[11]=e[14],n[12]=i,n[13]=a,n[14]=l}else n[0]=e[0],n[1]=e[4],n[2]=e[8],n[3]=e[12],n[4]=e[1],n[5]=e[5],n[6]=e[9],n[7]=e[13],n[8]=e[2],n[9]=e[6],n[10]=e[10],n[11]=e[14],n[12]=e[3],n[13]=e[7],n[14]=e[11],n[15]=e[15];return n}function gx(n,e){var t=e[0],r=e[1],i=e[2],o=e[3],a=e[4],l=e[5],h=e[6],p=e[7],g=e[8],_=e[9],x=e[10],C=e[11],M=e[12],L=e[13],D=e[14],z=e[15],te=t*l-r*a,le=t*h-i*a,ce=t*p-o*a,_e=r*h-i*l,J=r*p-o*l,pe=i*p-o*h,ue=g*L-_*M,xe=g*D-x*M,je=g*z-C*M,ne=_*D-x*L,Ee=_*z-C*L,ke=x*z-C*D,Be=te*ke-le*Ee+ce*ne+_e*je-J*xe+pe*ue;return Be?(Be=1/Be,n[0]=(l*ke-h*Ee+p*ne)*Be,n[1]=(i*Ee-r*ke-o*ne)*Be,n[2]=(L*pe-D*J+z*_e)*Be,n[3]=(x*J-_*pe-C*_e)*Be,n[4]=(h*je-a*ke-p*xe)*Be,n[5]=(t*ke-i*je+o*xe)*Be,n[6]=(D*ce-M*pe-z*le)*Be,n[7]=(g*pe-x*ce+C*le)*Be,n[8]=(a*Ee-l*je+p*ue)*Be,n[9]=(r*je-t*Ee-o*ue)*Be,n[10]=(M*J-L*ce+z*te)*Be,n[11]=(_*ce-g*J-C*te)*Be,n[12]=(l*xe-a*ne-h*ue)*Be,n[13]=(t*ne-r*xe+i*ue)*Be,n[14]=(L*le-M*_e-D*te)*Be,n[15]=(g*_e-_*le+x*te)*Be,n):null}function $K(n){var e=n[0],t=n[1],r=n[2],i=n[3],o=n[4],a=n[5],l=n[6],h=n[7],p=n[8],g=n[9],_=n[10],x=n[11],C=n[12],M=n[13],L=n[14],D=n[15],z=e*a-t*o,te=e*l-r*o,le=e*h-i*o,ce=t*l-r*a,_e=t*h-i*a,J=r*h-i*l,pe=p*M-g*C,ue=p*L-_*C,xe=p*D-x*C,je=g*L-_*M,ne=g*D-x*M,Ee=_*D-x*L;return z*Ee-te*ne+le*je+ce*xe-_e*ue+J*pe}function gl(n,e,t){var r=e[0],i=e[1],o=e[2],a=e[3],l=e[4],h=e[5],p=e[6],g=e[7],_=e[8],x=e[9],C=e[10],M=e[11],L=e[12],D=e[13],z=e[14],te=e[15],le=t[0],ce=t[1],_e=t[2],J=t[3];return n[0]=le*r+ce*l+_e*_+J*L,n[1]=le*i+ce*h+_e*x+J*D,n[2]=le*o+ce*p+_e*C+J*z,n[3]=le*a+ce*g+_e*M+J*te,le=t[4],ce=t[5],_e=t[6],J=t[7],n[4]=le*r+ce*l+_e*_+J*L,n[5]=le*i+ce*h+_e*x+J*D,n[6]=le*o+ce*p+_e*C+J*z,n[7]=le*a+ce*g+_e*M+J*te,le=t[8],ce=t[9],_e=t[10],J=t[11],n[8]=le*r+ce*l+_e*_+J*L,n[9]=le*i+ce*h+_e*x+J*D,n[10]=le*o+ce*p+_e*C+J*z,n[11]=le*a+ce*g+_e*M+J*te,le=t[12],ce=t[13],_e=t[14],J=t[15],n[12]=le*r+ce*l+_e*_+J*L,n[13]=le*i+ce*h+_e*x+J*D,n[14]=le*o+ce*p+_e*C+J*z,n[15]=le*a+ce*g+_e*M+J*te,n}function _0(n,e,t){var r=t[0],i=t[1],o=t[2],a,l,h,p,g,_,x,C,M,L,D,z;return e===n?(n[12]=e[0]*r+e[4]*i+e[8]*o+e[12],n[13]=e[1]*r+e[5]*i+e[9]*o+e[13],n[14]=e[2]*r+e[6]*i+e[10]*o+e[14],n[15]=e[3]*r+e[7]*i+e[11]*o+e[15]):(a=e[0],l=e[1],h=e[2],p=e[3],g=e[4],_=e[5],x=e[6],C=e[7],M=e[8],L=e[9],D=e[10],z=e[11],n[0]=a,n[1]=l,n[2]=h,n[3]=p,n[4]=g,n[5]=_,n[6]=x,n[7]=C,n[8]=M,n[9]=L,n[10]=D,n[11]=z,n[12]=a*r+g*i+M*o+e[12],n[13]=l*r+_*i+L*o+e[13],n[14]=h*r+x*i+D*o+e[14],n[15]=p*r+C*i+z*o+e[15]),n}function JE(n,e,t){var r=t[0],i=t[1],o=t[2];return n[0]=e[0]*r,n[1]=e[1]*r,n[2]=e[2]*r,n[3]=e[3]*r,n[4]=e[4]*i,n[5]=e[5]*i,n[6]=e[6]*i,n[7]=e[7]*i,n[8]=e[8]*o,n[9]=e[9]*o,n[10]=e[10]*o,n[11]=e[11]*o,n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15],n}function WK(n,e,t,r){var i=r[0],o=r[1],a=r[2],l=Math.hypot(i,o,a),h,p,g,_,x,C,M,L,D,z,te,le,ce,_e,J,pe,ue,xe,je,ne,Ee,ke,Be,Ze;return l<uo?null:(l=1/l,i*=l,o*=l,a*=l,h=Math.sin(t),p=Math.cos(t),g=1-p,_=e[0],x=e[1],C=e[2],M=e[3],L=e[4],D=e[5],z=e[6],te=e[7],le=e[8],ce=e[9],_e=e[10],J=e[11],pe=i*i*g+p,ue=o*i*g+a*h,xe=a*i*g-o*h,je=i*o*g-a*h,ne=o*o*g+p,Ee=a*o*g+i*h,ke=i*a*g+o*h,Be=o*a*g-i*h,Ze=a*a*g+p,n[0]=_*pe+L*ue+le*xe,n[1]=x*pe+D*ue+ce*xe,n[2]=C*pe+z*ue+_e*xe,n[3]=M*pe+te*ue+J*xe,n[4]=_*je+L*ne+le*Ee,n[5]=x*je+D*ne+ce*Ee,n[6]=C*je+z*ne+_e*Ee,n[7]=M*je+te*ne+J*Ee,n[8]=_*ke+L*Be+le*Ze,n[9]=x*ke+D*Be+ce*Ze,n[10]=C*ke+z*Be+_e*Ze,n[11]=M*ke+te*Be+J*Ze,e!==n&&(n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n)}function y6(n,e,t){var r=Math.sin(t),i=Math.cos(t),o=e[4],a=e[5],l=e[6],h=e[7],p=e[8],g=e[9],_=e[10],x=e[11];return e!==n&&(n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[3],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n[4]=o*i+p*r,n[5]=a*i+g*r,n[6]=l*i+_*r,n[7]=h*i+x*r,n[8]=p*i-o*r,n[9]=g*i-a*r,n[10]=_*i-l*r,n[11]=x*i-h*r,n}function YK(n,e,t){var r=Math.sin(t),i=Math.cos(t),o=e[0],a=e[1],l=e[2],h=e[3],p=e[8],g=e[9],_=e[10],x=e[11];return e!==n&&(n[4]=e[4],n[5]=e[5],n[6]=e[6],n[7]=e[7],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n[0]=o*i-p*r,n[1]=a*i-g*r,n[2]=l*i-_*r,n[3]=h*i-x*r,n[8]=o*r+p*i,n[9]=a*r+g*i,n[10]=l*r+_*i,n[11]=h*r+x*i,n}function _6(n,e,t){var r=Math.sin(t),i=Math.cos(t),o=e[0],a=e[1],l=e[2],h=e[3],p=e[4],g=e[5],_=e[6],x=e[7];return e!==n&&(n[8]=e[8],n[9]=e[9],n[10]=e[10],n[11]=e[11],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n[0]=o*i+p*r,n[1]=a*i+g*r,n[2]=l*i+_*r,n[3]=h*i+x*r,n[4]=p*i-o*r,n[5]=g*i-a*r,n[6]=_*i-l*r,n[7]=x*i-h*r,n}function KK(n,e){var t=e[0],r=e[1],i=e[2],o=e[3],a=t+t,l=r+r,h=i+i,p=t*a,g=r*a,_=r*l,x=i*a,C=i*l,M=i*h,L=o*a,D=o*l,z=o*h;return n[0]=1-_-M,n[1]=g+z,n[2]=x-D,n[3]=0,n[4]=g-z,n[5]=1-p-M,n[6]=C+L,n[7]=0,n[8]=x+D,n[9]=C-L,n[10]=1-p-_,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function ZK(n,e,t,r,i,o,a){var l=1/(t-e),h=1/(i-r),p=1/(o-a);return n[0]=o*2*l,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=o*2*h,n[6]=0,n[7]=0,n[8]=(t+e)*l,n[9]=(i+r)*h,n[10]=(a+o)*p,n[11]=-1,n[12]=0,n[13]=0,n[14]=a*o*2*p,n[15]=0,n}function XK(n,e,t,r,i){var o=1/Math.tan(e/2),a;return n[0]=o/t,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=o,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=-1,n[12]=0,n[13]=0,n[15]=0,i!=null&&i!==1/0?(a=1/(r-i),n[10]=(i+r)*a,n[14]=2*i*r*a):(n[10]=-1,n[14]=-2*r),n}var v6=XK;function QK(n,e,t,r,i,o,a){var l=1/(e-t),h=1/(r-i),p=1/(o-a);return n[0]=-2*l,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=-2*h,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=2*p,n[11]=0,n[12]=(e+t)*l,n[13]=(i+r)*h,n[14]=(a+o)*p,n[15]=1,n}var JK=QK;function eZ(n,e,t,r){var i,o,a,l,h,p,g,_,x,C,M=e[0],L=e[1],D=e[2],z=r[0],te=r[1],le=r[2],ce=t[0],_e=t[1],J=t[2];return Math.abs(M-ce)<uo&&Math.abs(L-_e)<uo&&Math.abs(D-J)<uo?GK(n):(g=M-ce,_=L-_e,x=D-J,C=1/Math.hypot(g,_,x),g*=C,_*=C,x*=C,i=te*x-le*_,o=le*g-z*x,a=z*_-te*g,C=Math.hypot(i,o,a),C?(C=1/C,i*=C,o*=C,a*=C):(i=0,o=0,a=0),l=_*a-x*o,h=x*i-g*a,p=g*o-_*i,C=Math.hypot(l,h,p),C?(C=1/C,l*=C,h*=C,p*=C):(l=0,h=0,p=0),n[0]=i,n[1]=l,n[2]=g,n[3]=0,n[4]=o,n[5]=h,n[6]=_,n[7]=0,n[8]=a,n[9]=p,n[10]=x,n[11]=0,n[12]=-(i*M+o*L+a*D),n[13]=-(l*M+h*L+p*D),n[14]=-(g*M+_*L+x*D),n[15]=1,n)}function RL(n,e){var t=n[0],r=n[1],i=n[2],o=n[3],a=n[4],l=n[5],h=n[6],p=n[7],g=n[8],_=n[9],x=n[10],C=n[11],M=n[12],L=n[13],D=n[14],z=n[15],te=e[0],le=e[1],ce=e[2],_e=e[3],J=e[4],pe=e[5],ue=e[6],xe=e[7],je=e[8],ne=e[9],Ee=e[10],ke=e[11],Be=e[12],Ze=e[13],at=e[14],Re=e[15];return Math.abs(t-te)<=uo*Math.max(1,Math.abs(t),Math.abs(te))&&Math.abs(r-le)<=uo*Math.max(1,Math.abs(r),Math.abs(le))&&Math.abs(i-ce)<=uo*Math.max(1,Math.abs(i),Math.abs(ce))&&Math.abs(o-_e)<=uo*Math.max(1,Math.abs(o),Math.abs(_e))&&Math.abs(a-J)<=uo*Math.max(1,Math.abs(a),Math.abs(J))&&Math.abs(l-pe)<=uo*Math.max(1,Math.abs(l),Math.abs(pe))&&Math.abs(h-ue)<=uo*Math.max(1,Math.abs(h),Math.abs(ue))&&Math.abs(p-xe)<=uo*Math.max(1,Math.abs(p),Math.abs(xe))&&Math.abs(g-je)<=uo*Math.max(1,Math.abs(g),Math.abs(je))&&Math.abs(_-ne)<=uo*Math.max(1,Math.abs(_),Math.abs(ne))&&Math.abs(x-Ee)<=uo*Math.max(1,Math.abs(x),Math.abs(Ee))&&Math.abs(C-ke)<=uo*Math.max(1,Math.abs(C),Math.abs(ke))&&Math.abs(M-Be)<=uo*Math.max(1,Math.abs(M),Math.abs(Be))&&Math.abs(L-Ze)<=uo*Math.max(1,Math.abs(L),Math.abs(Ze))&&Math.abs(D-at)<=uo*Math.max(1,Math.abs(D),Math.abs(at))&&Math.abs(z-Re)<=uo*Math.max(1,Math.abs(z),Math.abs(Re))}function tZ(){var n=new Gm(4);return Gm!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0,n[3]=0),n}function nZ(n,e,t){return n[0]=e[0]*t,n[1]=e[1]*t,n[2]=e[2]*t,n[3]=e[3]*t,n}function nb(n,e,t){var r=e[0],i=e[1],o=e[2],a=e[3];return n[0]=t[0]*r+t[4]*i+t[8]*o+t[12]*a,n[1]=t[1]*r+t[5]*i+t[9]*o+t[13]*a,n[2]=t[2]*r+t[6]*i+t[10]*o+t[14]*a,n[3]=t[3]*r+t[7]*i+t[11]*o+t[15]*a,n}(function(){var n=tZ();return function(e,t,r,i,o,a){var l,h;for(t||(t=4),r||(r=0),i?h=Math.min(i*t+r,e.length):h=e.length,l=r;l<h;l+=t)n[0]=e[l],n[1]=e[l+1],n[2]=e[l+2],n[3]=e[l+3],o(n,n,a),e[l]=n[0],e[l+1]=n[1],e[l+2]=n[2],e[l+3]=n[3];return e}})();var R2;(function(n){n[n.COL0ROW0=0]="COL0ROW0",n[n.COL0ROW1=1]="COL0ROW1",n[n.COL0ROW2=2]="COL0ROW2",n[n.COL0ROW3=3]="COL0ROW3",n[n.COL1ROW0=4]="COL1ROW0",n[n.COL1ROW1=5]="COL1ROW1",n[n.COL1ROW2=6]="COL1ROW2",n[n.COL1ROW3=7]="COL1ROW3",n[n.COL2ROW0=8]="COL2ROW0",n[n.COL2ROW1=9]="COL2ROW1",n[n.COL2ROW2=10]="COL2ROW2",n[n.COL2ROW3=11]="COL2ROW3",n[n.COL3ROW0=12]="COL3ROW0",n[n.COL3ROW1=13]="COL3ROW1",n[n.COL3ROW2=14]="COL3ROW2",n[n.COL3ROW3=15]="COL3ROW3"})(R2||(R2={}));const rZ=45*Math.PI/180,iZ=1,JS=.1,eC=500,oZ=Object.freeze([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);class Sl extends HK{static get IDENTITY(){return sZ()}static get ZERO(){return aZ()}get ELEMENTS(){return 16}get RANK(){return 4}get INDICES(){return R2}constructor(e){super(-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(e)?this.copy(e):this.identity()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this[4]=e[4],this[5]=e[5],this[6]=e[6],this[7]=e[7],this[8]=e[8],this[9]=e[9],this[10]=e[10],this[11]=e[11],this[12]=e[12],this[13]=e[13],this[14]=e[14],this[15]=e[15],this.check()}set(e,t,r,i,o,a,l,h,p,g,_,x,C,M,L,D){return this[0]=e,this[1]=t,this[2]=r,this[3]=i,this[4]=o,this[5]=a,this[6]=l,this[7]=h,this[8]=p,this[9]=g,this[10]=_,this[11]=x,this[12]=C,this[13]=M,this[14]=L,this[15]=D,this.check()}setRowMajor(e,t,r,i,o,a,l,h,p,g,_,x,C,M,L,D){return this[0]=e,this[1]=o,this[2]=p,this[3]=C,this[4]=t,this[5]=a,this[6]=g,this[7]=M,this[8]=r,this[9]=l,this[10]=_,this[11]=L,this[12]=i,this[13]=h,this[14]=x,this[15]=D,this.check()}toRowMajor(e){return e[0]=this[0],e[1]=this[4],e[2]=this[8],e[3]=this[12],e[4]=this[1],e[5]=this[5],e[6]=this[9],e[7]=this[13],e[8]=this[2],e[9]=this[6],e[10]=this[10],e[11]=this[14],e[12]=this[3],e[13]=this[7],e[14]=this[11],e[15]=this[15],e}identity(){return this.copy(oZ)}fromObject(e){return this.check()}fromQuaternion(e){return KK(this,e),this.check()}frustum(e){const{left:t,right:r,bottom:i,top:o,near:a=JS,far:l=eC}=e;return l===1/0?cZ(this,t,r,i,o,a):ZK(this,t,r,i,o,a,l),this.check()}lookAt(e){const{eye:t,center:r=[0,0,0],up:i=[0,1,0]}=e;return eZ(this,t,r,i),this.check()}ortho(e){const{left:t,right:r,bottom:i,top:o,near:a=JS,far:l=eC}=e;return JK(this,t,r,i,o,a,l),this.check()}orthographic(e){const{fovy:t=rZ,aspect:r=iZ,focalDistance:i=1,near:o=JS,far:a=eC}=e;kL(t);const l=t/2,h=i*Math.tan(l),p=h*r;return this.ortho({left:-p,right:p,bottom:-h,top:h,near:o,far:a})}perspective(e){const{fovy:t=45*Math.PI/180,aspect:r=1,near:i=.1,far:o=500}=e;return kL(t),v6(this,t,r,i,o),this.check()}determinant(){return $K(this)}getScale(e=[-0,-0,-0]){return e[0]=Math.sqrt(this[0]*this[0]+this[1]*this[1]+this[2]*this[2]),e[1]=Math.sqrt(this[4]*this[4]+this[5]*this[5]+this[6]*this[6]),e[2]=Math.sqrt(this[8]*this[8]+this[9]*this[9]+this[10]*this[10]),e}getTranslation(e=[-0,-0,-0]){return e[0]=this[12],e[1]=this[13],e[2]=this[14],e}getRotation(e,t){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0],t=t||[-0,-0,-0];const r=this.getScale(t),i=1/r[0],o=1/r[1],a=1/r[2];return e[0]=this[0]*i,e[1]=this[1]*o,e[2]=this[2]*a,e[3]=0,e[4]=this[4]*i,e[5]=this[5]*o,e[6]=this[6]*a,e[7]=0,e[8]=this[8]*i,e[9]=this[9]*o,e[10]=this[10]*a,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}getRotationMatrix3(e,t){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0],t=t||[-0,-0,-0];const r=this.getScale(t),i=1/r[0],o=1/r[1],a=1/r[2];return e[0]=this[0]*i,e[1]=this[1]*o,e[2]=this[2]*a,e[3]=this[4]*i,e[4]=this[5]*o,e[5]=this[6]*a,e[6]=this[8]*i,e[7]=this[9]*o,e[8]=this[10]*a,e}transpose(){return qK(this,this),this.check()}invert(){return gx(this,this),this.check()}multiplyLeft(e){return gl(this,e,this),this.check()}multiplyRight(e){return gl(this,this,e),this.check()}rotateX(e){return y6(this,this,e),this.check()}rotateY(e){return YK(this,this,e),this.check()}rotateZ(e){return _6(this,this,e),this.check()}rotateXYZ(e){return this.rotateX(e[0]).rotateY(e[1]).rotateZ(e[2])}rotateAxis(e,t){return WK(this,this,e,t),this.check()}scale(e){return JE(this,this,Array.isArray(e)?e:[e,e,e]),this.check()}translate(e){return _0(this,this,e),this.check()}transform(e,t){return e.length===4?(t=nb(t||[-0,-0,-0,-0],e,this),XS(t,4),t):this.transformAsPoint(e,t)}transformAsPoint(e,t){const{length:r}=e;let i;switch(r){case 2:i=SK(t||[-0,-0],e,this);break;case 3:i=m6(t||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return XS(i,e.length),i}transformAsVector(e,t){let r;switch(e.length){case 2:r=CK(t||[-0,-0],e,this);break;case 3:r=g6(t||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return XS(r,e.length),r}transformPoint(e,t){return this.transformAsPoint(e,t)}transformVector(e,t){return this.transformAsPoint(e,t)}transformDirection(e,t){return this.transformAsVector(e,t)}makeRotationX(e){return this.identity().rotateX(e)}makeTranslation(e,t,r){return this.identity().translate([e,t,r])}}let N1,D1;function aZ(){return N1||(N1=new Sl([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),Object.freeze(N1)),N1}function sZ(){return D1||(D1=new Sl,Object.freeze(D1)),D1}function kL(n){if(n>Math.PI*2)throw Error("expected radians")}function cZ(n,e,t,r,i,o){const a=2*o/(t-e),l=2*o/(i-r),h=(t+e)/(t-e),p=(i+r)/(i-r),g=-1,_=-1,x=-2*o;return n[0]=a,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=l,n[6]=0,n[7]=0,n[8]=h,n[9]=p,n[10]=g,n[11]=_,n[12]=0,n[13]=0,n[14]=x,n[15]=0,n}const lZ=new Uint8Array([0,255,255,255]),uZ={pickingSelectedColor:null,pickingHighlightColor:lZ,pickingActive:!1,pickingAttribute:!1};function hZ(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:uZ;const e={};if(n.pickingSelectedColor!==void 0)if(!n.pickingSelectedColor)e.picking_uSelectedColorValid=0;else{const t=n.pickingSelectedColor.slice(0,3);e.picking_uSelectedColorValid=1,e.picking_uSelectedColor=t}if(n.pickingHighlightColor){const t=Array.from(n.pickingHighlightColor,r=>r/255);Number.isFinite(t[3])||(t[3]=1),e.picking_uHighlightColor=t}return n.pickingActive!==void 0&&(e.picking_uActive=!!n.pickingActive,e.picking_uAttribute=!!n.pickingAttribute),e}const dZ=`uniform bool picking_uActive;
uniform bool picking_uAttribute;
uniform vec3 picking_uSelectedColor;
uniform bool picking_uSelectedColorValid;

out vec4 picking_vRGBcolor_Avalid;

const float COLOR_SCALE = 1. / 255.;

bool picking_isColorValid(vec3 color) {
  return dot(color, vec3(1.0)) > 0.001;
}

bool isVertexPicked(vec3 vertexColor) {
  return
    picking_uSelectedColorValid &&
    !picking_isColorValid(abs(vertexColor - picking_uSelectedColor));
}

void picking_setPickingColor(vec3 pickingColor) {
  if (picking_uActive) {
    picking_vRGBcolor_Avalid.a = float(picking_isColorValid(pickingColor));

    if (!picking_uAttribute) {
      picking_vRGBcolor_Avalid.rgb = pickingColor * COLOR_SCALE;
    }
  } else {
    picking_vRGBcolor_Avalid.a = float(isVertexPicked(pickingColor));
  }
}

void picking_setPickingAttribute(float value) {
  if (picking_uAttribute) {
    picking_vRGBcolor_Avalid.r = value;
  }
}
void picking_setPickingAttribute(vec2 value) {
  if (picking_uAttribute) {
    picking_vRGBcolor_Avalid.rg = value;
  }
}
void picking_setPickingAttribute(vec3 value) {
  if (picking_uAttribute) {
    picking_vRGBcolor_Avalid.rgb = value;
  }
}
`,fZ=`uniform bool picking_uActive;
uniform vec3 picking_uSelectedColor;
uniform vec4 picking_uHighlightColor;

in vec4 picking_vRGBcolor_Avalid;
vec4 picking_filterHighlightColor(vec4 color) {
  if (picking_uActive) {
    return color;
  }
  bool selected = bool(picking_vRGBcolor_Avalid.a);

  if (selected) {
    float highLightAlpha = picking_uHighlightColor.a;
    float blendedAlpha = highLightAlpha + color.a * (1.0 - highLightAlpha);
    float highLightRatio = highLightAlpha / blendedAlpha;

    vec3 blendedRGB = mix(color.rgb, picking_uHighlightColor.rgb, highLightRatio);
    return vec4(blendedRGB, blendedAlpha);
  } else {
    return color;
  }
}
vec4 picking_filterPickingColor(vec4 color) {
  if (picking_uActive) {
    if (picking_vRGBcolor_Avalid.a == 0.0) {
      discard;
    }
    return picking_vRGBcolor_Avalid;
  }
  return color;
}
vec4 picking_filterColor(vec4 color) {
  vec4 highightColor = picking_filterHighlightColor(color);
  return picking_filterPickingColor(highightColor);
}

`,pZ={name:"picking",vs:dZ,fs:fZ,getUniforms:hZ},gZ=`attribute float transform_elementID;
vec2 transform_getPixelSizeHalf(vec2 size) {
  return vec2(1.) / (2. * size);
}

vec2 transform_getPixelIndices(vec2 texSize, vec2 pixelSizeHalf) {
  float yIndex = floor((transform_elementID / texSize[0]) + pixelSizeHalf[1]);
  float xIndex = transform_elementID - (yIndex * texSize[0]);
  return vec2(xIndex, yIndex);
}
vec2 transform_getTexCoord(vec2 size) {
  vec2 pixelSizeHalf = transform_getPixelSizeHalf(size);
  vec2 indices = transform_getPixelIndices(size, pixelSizeHalf);
  vec2 coord = indices / size + pixelSizeHalf;
  return coord;
}
vec2 transform_getPos(vec2 size) {
  vec2 texCoord = transform_getTexCoord(size);
  vec2 pos = (texCoord * (2.0, 2.0)) - (1., 1.);
  return pos;
}
vec4 transform_getInput(sampler2D texSampler, vec2 size) {
  vec2 texCoord = transform_getTexCoord(size);
  vec4 textureColor = texture2D(texSampler, texCoord);
  return textureColor;
}
`,mZ={name:"transform",vs:gZ,fs:null};class rb{static getDefaultProgramManager(e){return e.luma=e.luma||{},e.luma.defaultProgramManager=e.luma.defaultProgramManager||new rb(e),e.luma.defaultProgramManager}constructor(e){this.gl=e,this._programCache={},this._getUniforms={},this._registeredModules={},this._hookFunctions=[],this._defaultModules=[],this._hashes={},this._hashCounter=0,this.stateHash=0,this._useCounts={}}addDefaultModule(e){this._defaultModules.find(t=>t.name===e.name)||this._defaultModules.push(e),this.stateHash++}removeDefaultModule(e){const t=typeof e=="string"?e:e.name;this._defaultModules=this._defaultModules.filter(r=>r.name!==t),this.stateHash++}addShaderHook(e,t){t&&(e=Object.assign(t,{hook:e})),this._hookFunctions.push(e),this.stateHash++}get(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{vs:t="",fs:r="",defines:i={},inject:o={},varyings:a=[],bufferMode:l=35981,transpileToGLSL100:h=!1}=e,p=this._getModuleList(e.modules),g=this._getHash(t),_=this._getHash(r),x=p.map(le=>this._getHash(le.name)).sort(),C=a.map(le=>this._getHash(le)),M=Object.keys(i).sort(),L=Object.keys(o).sort(),D=[],z=[];for(const le of M)D.push(this._getHash(le)),D.push(this._getHash(i[le]));for(const le of L)z.push(this._getHash(le)),z.push(this._getHash(o[le]));const te="".concat(g,"/").concat(_,"D").concat(D.join("/"),"M").concat(x.join("/"),"I").concat(z.join("/"),"V").concat(C.join("/"),"H").concat(this.stateHash,"B").concat(l).concat(h?"T":"");if(!this._programCache[te]){const le=rK(this.gl,{vs:t,fs:r,modules:p,inject:o,defines:i,hookFunctions:this._hookFunctions,transpileToGLSL100:h});this._programCache[te]=new n6(this.gl,{hash:te,vs:le.vs,fs:le.fs,varyings:a,bufferMode:l}),this._getUniforms[te]=le.getUniforms||(ce=>{}),this._useCounts[te]=0}return this._useCounts[te]++,this._programCache[te]}getUniforms(e){return this._getUniforms[e.hash]||null}release(e){const t=e.hash;this._useCounts[t]--,this._useCounts[t]===0&&(this._programCache[t].delete(),delete this._programCache[t],delete this._getUniforms[t],delete this._useCounts[t])}_getHash(e){return this._hashes[e]===void 0&&(this._hashes[e]=this._hashCounter++),this._hashes[e]}_getModuleList(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];const t=new Array(this._defaultModules.length+e.length),r={};let i=0;for(let o=0,a=this._defaultModules.length;o<a;++o){const l=this._defaultModules[o],h=l.name;t[i++]=l,r[h]=!0}for(let o=0,a=e.length;o<a;++o){const l=e[o],h=l.name;r[h]||(t[i++]=l,r[h]=!0)}return t.length=i,t}}const yZ={POSITION:"positions",NORMAL:"normals",COLOR_0:"colors",TEXCOORD_0:"texCoords",TEXCOORD_1:"texCoords1",TEXCOORD_2:"texCoords2"};function _Z(n,e,t){const r={};let i=e.indices;for(const o in e.attributes){const a=e.attributes[o],l=vZ(o,t);if(o==="indices")i=a;else if(a.constant)r[l]=a.value;else{const h=a.value,p={...a};delete p.value,r[l]=[new ui(n,h),p],bZ(o,p)}}if(i){const o=i.value||i;Jt(o instanceof Uint16Array||o instanceof Uint32Array,'attribute array for "indices" must be of integer type');const a={size:1,isIndexed:i.isIndexed===void 0?!0:i.isIndexed};r.indices=[new ui(n,{data:o,target:34963}),a]}return r}function vZ(n,e){const{attributeMap:t=yZ}=e||{};return t&&t[n]||n}function bZ(n,e){let t;switch(n){case"texCoords":case"texCoord1":case"texCoord2":case"texCoord3":t="uvs";break;case"vertices":case"positions":case"normals":case"pickingColors":t="vectors";break}switch(t){case"vectors":e.size=e.size||3;break;case"uvs":e.size=e.size||2;break}Jt(Number.isFinite(e.size),"attribute ".concat(n," needs size"))}const gg=2,wZ=1e4,xZ="Model needs drawMode and vertexCount",OL=()=>{},EZ={};class rp{constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{id:r=rd("model")}=t;Jt(ZE(e)),this.id=r,this.gl=e,this.id=t.id||rd("Model"),this.lastLogTime=0,this.animated=!1,this.initialize(t)}initialize(e){this.props={},this.programManager=e.programManager||rb.getDefaultProgramManager(this.gl),this._programManagerState=-1,this._managedProgram=!1;const{program:t=null,vs:r,fs:i,modules:o,defines:a,inject:l,varyings:h,bufferMode:p,transpileToGLSL100:g}=e;this.programProps={program:t,vs:r,fs:i,modules:o,defines:a,inject:l,varyings:h,bufferMode:p,transpileToGLSL100:g},this.program=null,this.vertexArray=null,this._programDirty=!0,this.userData={},this.needsRedraw=!0,this._attributes={},this.attributes={},this.uniforms={},this.pickable=!0,this._checkProgram(),this.setUniforms(Object.assign({},this.getModuleUniforms(e.moduleSettings))),this.drawMode=e.drawMode!==void 0?e.drawMode:4,this.vertexCount=e.vertexCount||0,this.geometryBuffers={},this.isInstanced=e.isInstanced||e.instanced||e.instanceCount>0,this._setModelProps(e),this.geometry={},Jt(this.drawMode!==void 0&&Number.isFinite(this.vertexCount),xZ)}setProps(e){this._setModelProps(e)}delete(){for(const e in this._attributes)this._attributes[e]!==this.attributes[e]&&this._attributes[e].delete();this._managedProgram&&(this.programManager.release(this.program),this._managedProgram=!1),this.vertexArray.delete(),this._deleteGeometryBuffers()}getDrawMode(){return this.drawMode}getVertexCount(){return this.vertexCount}getInstanceCount(){return this.instanceCount}getAttributes(){return this.attributes}getProgram(){return this.program}setProgram(e){const{program:t,vs:r,fs:i,modules:o,defines:a,inject:l,varyings:h,bufferMode:p,transpileToGLSL100:g}=e;this.programProps={program:t,vs:r,fs:i,modules:o,defines:a,inject:l,varyings:h,bufferMode:p,transpileToGLSL100:g},this._programDirty=!0}getUniforms(){return this.uniforms}setDrawMode(e){return this.drawMode=e,this}setVertexCount(e){return Jt(Number.isFinite(e)),this.vertexCount=e,this}setInstanceCount(e){return Jt(Number.isFinite(e)),this.instanceCount=e,this}setGeometry(e){return this.drawMode=e.drawMode,this.vertexCount=e.getVertexCount(),this._deleteGeometryBuffers(),this.geometryBuffers=_Z(this.gl,e),this.vertexArray.setAttributes(this.geometryBuffers),this}setAttributes(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(jm(e))return this;const t={};for(const r in e){const i=e[r];t[r]=i.getValue?i.getValue():i}return this.vertexArray.setAttributes(t),this}setUniforms(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return Object.assign(this.uniforms,e),this}getModuleUniforms(e){this._checkProgram();const t=this.programManager.getUniforms(this.program);return t?t(e):{}}updateModuleSettings(e){const t=this.getModuleUniforms(e||{});return this.setUniforms(t)}clear(e){return rM(this.program.gl,e),this}draw(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._checkProgram();const{moduleSettings:t=null,framebuffer:r,uniforms:i={},attributes:o={},transformFeedback:a=this.transformFeedback,parameters:l={},vertexArray:h=this.vertexArray}=e;this.setAttributes(o),this.updateModuleSettings(t),this.setUniforms(i);let p;Tn.priority>=gg&&(p=this._logDrawCallStart(gg));const g=this.vertexArray.getDrawParams(),{isIndexed:_=g.isIndexed,indexType:x=g.indexType,indexOffset:C=g.indexOffset,vertexArrayInstanced:M=g.isInstanced}=this.props;M&&!this.isInstanced&&Tn.warn("Found instanced attributes on non-instanced model",this.id)();const{isInstanced:L,instanceCount:D}=this,{onBeforeRender:z=OL,onAfterRender:te=OL}=this.props;z(),this.program.setUniforms(this.uniforms);const le=this.program.draw(Object.assign(EZ,e,{logPriority:p,uniforms:null,framebuffer:r,parameters:l,drawMode:this.getDrawMode(),vertexCount:this.getVertexCount(),vertexArray:h,transformFeedback:a,isIndexed:_,indexType:x,isInstanced:L,instanceCount:D,offset:_?C:0}));return te(),Tn.priority>=gg&&this._logDrawCallEnd(p,h,r),le}transform(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{discard:t=!0,feedbackBuffers:r,unbindModels:i=[]}=e;let{parameters:o}=e;r&&this._setFeedbackBuffers(r),t&&(o=Object.assign({},o,{35977:t})),i.forEach(a=>a.vertexArray.unbindBuffers());try{this.draw(Object.assign({},e,{parameters:o}))}finally{i.forEach(a=>a.vertexArray.bindBuffers())}return this}render(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return Tn.warn("Model.render() is deprecated. Use Model.setUniforms() and Model.draw()")(),this.setUniforms(e).draw()}_setModelProps(e){Object.assign(this.props,e),"uniforms"in e&&this.setUniforms(e.uniforms),"pickable"in e&&(this.pickable=e.pickable),"instanceCount"in e&&(this.instanceCount=e.instanceCount),"geometry"in e&&this.setGeometry(e.geometry),"attributes"in e&&this.setAttributes(e.attributes),"_feedbackBuffers"in e&&this._setFeedbackBuffers(e._feedbackBuffers)}_checkProgram(){if(!(this._programDirty||this.programManager.stateHash!==this._programManagerState))return;let{program:t}=this.programProps;if(t)this._managedProgram=!1;else{const{vs:r,fs:i,modules:o,inject:a,defines:l,varyings:h,bufferMode:p,transpileToGLSL100:g}=this.programProps;t=this.programManager.get({vs:r,fs:i,modules:o,inject:a,defines:l,varyings:h,bufferMode:p,transpileToGLSL100:g}),this.program&&this._managedProgram&&this.programManager.release(this.program),this._programManagerState=this.programManager.stateHash,this._managedProgram=!0}Jt(t instanceof n6,"Model needs a program"),this._programDirty=!1,t!==this.program&&(this.program=t,this.vertexArray?this.vertexArray.setProps({program:this.program,attributes:this.vertexArray.attributes}):this.vertexArray=new _Y(this.gl,{program:this.program}),this.setUniforms(Object.assign({},this.getModuleUniforms())))}_deleteGeometryBuffers(){for(const e in this.geometryBuffers){const t=this.geometryBuffers[e][0]||this.geometryBuffers[e];t instanceof ui&&t.delete()}}_setAnimationProps(e){this.animated&&Jt(e,"Model.draw(): animated uniforms but no animationProps")}_setFeedbackBuffers(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(jm(e))return this;const{gl:t}=this.program;return this.transformFeedback=this.transformFeedback||new r6(t,{program:this.program}),this.transformFeedback.setBuffers(e),this}_logDrawCallStart(e){const t=e>3?0:wZ;if(!(Date.now()-this.lastLogTime<t))return this.lastLogTime=Date.now(),Tn.group(gg,">>> DRAWING MODEL ".concat(this.id),{collapsed:Tn.level<=2})(),e}_logDrawCallEnd(e,t,r,i){if(e===void 0)return;const o=wY({vertexArray:t,header:"".concat(this.id," attributes"),attributes:this._attributes}),{table:a,unusedTable:l,unusedCount:h}=vL({header:"".concat(this.id," uniforms"),program:this.program,uniforms:Object.assign({},this.program.uniforms,r)}),{table:p,count:g}=vL({header:"".concat(this.id," uniforms"),program:this.program,uniforms:Object.assign({},this.program.uniforms,r),undefinedOnly:!0});g>0&&Tn.log("MISSING UNIFORMS",Object.keys(p))(),h>0&&Tn.log("UNUSED UNIFORMS",Object.keys(l))();const _=EY(this.vertexArray.configuration);Tn.table(e,o)(),Tn.table(e,a)(),Tn.table(e+1,_)(),i&&i.log({logLevel:gg,message:"Rendered to ".concat(i.id)}),Tn.groupEnd(gg)()}}class TZ{constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.gl=e,this.currentIndex=0,this.feedbackMap={},this.varyings=null,this.bindings=[],this.resources={},this._initialize(t),Object.seal(this)}setupResources(e){for(const t of this.bindings)this._setupTransformFeedback(t,e)}updateModelProps(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{varyings:t}=this;return t.length>0&&(e=Object.assign({},e,{varyings:t})),e}getDrawOptions(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const t=this.bindings[this.currentIndex],{sourceBuffers:r,transformFeedback:i}=t;return{attributes:Object.assign({},r,e.attributes),transformFeedback:i}}swap(){return this.feedbackMap?(this.currentIndex=this._getNextIndex(),!0):!1}update(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._setupBuffers(e)}getBuffer(e){const{feedbackBuffers:t}=this.bindings[this.currentIndex],r=e?t[e]:null;return r?r instanceof ui?r:r.buffer:null}getData(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{varyingName:t}=e,r=this.getBuffer(t);return r?r.getData():null}delete(){for(const e in this.resources)this.resources[e].delete()}_initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._setupBuffers(e),this.varyings=e.varyings||Object.keys(this.bindings[this.currentIndex].feedbackBuffers),this.varyings.length>0&&Jt(vr(this.gl))}_getFeedbackBuffers(e){const{sourceBuffers:t={}}=e,r={};if(this.bindings[this.currentIndex]&&Object.assign(r,this.bindings[this.currentIndex].feedbackBuffers),this.feedbackMap)for(const i in this.feedbackMap){const o=this.feedbackMap[i];i in t&&(r[o]=i)}Object.assign(r,e.feedbackBuffers);for(const i in r){const o=r[i];if(typeof o=="string"){const a=t[o],{byteLength:l,usage:h,accessor:p}=a;r[i]=this._createNewBuffer(i,{byteLength:l,usage:h,accessor:p})}}return r}_setupBuffers(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{sourceBuffers:t=null}=e;Object.assign(this.feedbackMap,e.feedbackMap);const r=this._getFeedbackBuffers(e);this._updateBindings({sourceBuffers:t,feedbackBuffers:r})}_setupTransformFeedback(e,t){let{model:r}=t;const{program:i}=r;e.transformFeedback=new r6(this.gl,{program:i,buffers:e.feedbackBuffers})}_updateBindings(e){if(this.bindings[this.currentIndex]=this._updateBinding(this.bindings[this.currentIndex],e),this.feedbackMap){const{sourceBuffers:t,feedbackBuffers:r}=this._swapBuffers(this.bindings[this.currentIndex]),i=this._getNextIndex();this.bindings[i]=this._updateBinding(this.bindings[i],{sourceBuffers:t,feedbackBuffers:r})}}_updateBinding(e,t){return e?(Object.assign(e.sourceBuffers,t.sourceBuffers),Object.assign(e.feedbackBuffers,t.feedbackBuffers),e.transformFeedback&&e.transformFeedback.setBuffers(e.feedbackBuffers),e):{sourceBuffers:Object.assign({},t.sourceBuffers),feedbackBuffers:Object.assign({},t.feedbackBuffers)}}_swapBuffers(e){if(!this.feedbackMap)return null;const t=Object.assign({},e.sourceBuffers),r=Object.assign({},e.feedbackBuffers);for(const i in this.feedbackMap){const o=this.feedbackMap[i];t[i]=e.feedbackBuffers[o],r[o]=e.sourceBuffers[i],Jt(r[o]instanceof ui)}return{sourceBuffers:t,feedbackBuffers:r}}_createNewBuffer(e,t){const r=new ui(this.gl,t);return this.resources[e]&&this.resources[e].delete(),this.resources[e]=r,r}_getNextIndex(){return(this.currentIndex+1)%2}}const SZ="transform_uSampler_",mx="transform_uSize_",LL="transform_position";function CZ(n){let{vs:e,sourceTextureMap:t,targetTextureVarying:r,targetTexture:i}=n,a=Object.keys(t).length,l=null;const h={};let p=e,g={};if(a>0||r){const _=p.split(`
`),x=_.slice();if(_.forEach((C,M,L)=>{if(a>0){const D=RZ(C,t);if(D){const{updatedLine:z,inject:te}=D;x[M]=z,g=I2([g,te]),Object.assign(h,D.samplerTextureMap),a--}}r&&!l&&(l=MZ(C,r))}),r){Jt(i);const C="".concat(mx).concat(r),M="uniform vec2 ".concat(C,`;
`),L="     vec2 ".concat(LL," = transform_getPos(").concat(C,`);
     gl_Position = vec4(`).concat(LL,`, 0, 1.);
`);g=I2([g,{"vs:#decl":M,"vs:#main-start":L}])}p=x.join(`
`)}return{vs:p,targetTextureType:l,inject:g,samplerTextureMap:h}}function AZ(n){let{sourceTextureMap:e,targetTextureVarying:t,targetTexture:r}=n;const i={};let o,a;t&&({width:o,height:a}=r,i["".concat(mx).concat(t)]=[o,a]);for(const l in e)({width:o,height:a}=e[l]),i["".concat(mx).concat(l)]=[o,a];return i}function IZ(n){return u6(n,["attribute","in"])}function PZ(n){const e="".concat(SZ).concat(n),t="".concat(mx).concat(n),r="  uniform sampler2D ".concat(e,`;
  uniform vec2 `).concat(t,";");return{samplerName:e,sizeName:t,uniformDeclerations:r}}function MZ(n,e){const t=u6(n,["varying","out"]);return t&&t.name===e?t.type:null}function RZ(n,e){const t={},r=IZ(n);if(!r)return null;const{type:i,name:o}=r;if(o&&e[o]){const a="// ".concat(n," => Replaced by Transform with a sampler"),{samplerName:l,sizeName:h,uniformDeclerations:p}=PZ(o),g=dK(i),_="  ".concat(i," ").concat(o," = transform_getInput(").concat(l,", ").concat(h,").").concat(g,`;
`);return t[l]=o,{updatedLine:a,inject:{"vs:#decl":p,"vs:#main-start":_},samplerTextureMap:t}}return null}const kZ={10241:9728,10240:9728,10242:33071,10243:33071},OZ="transform_output";class LZ{constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.gl=e,this.id=this.currentIndex=0,this._swapTexture=null,this.targetTextureVarying=null,this.targetTextureType=null,this.samplerTextureMap=null,this.bindings=[],this.resources={},this._initialize(t),Object.seal(this)}updateModelProps(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const t=this._processVertexShader(e);return Object.assign({},e,t)}getDrawOptions(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{sourceBuffers:t,sourceTextures:r,framebuffer:i,targetTexture:o}=this.bindings[this.currentIndex],a=Object.assign({},t,e.attributes),l=Object.assign({},e.uniforms),h=Object.assign({},e.parameters);let p=e.discard;if(this.hasSourceTextures||this.hasTargetTexture){a.transform_elementID=this.elementIDBuffer;for(const _ in this.samplerTextureMap){const x=this.samplerTextureMap[_];l[_]=r[x]}this._setSourceTextureParameters();const g=AZ({sourceTextureMap:r,targetTextureVarying:this.targetTextureVarying,targetTexture:o});Object.assign(l,g)}return this.hasTargetTexture&&(p=!1,h.viewport=[0,0,i.width,i.height]),{attributes:a,framebuffer:i,uniforms:l,discard:p,parameters:h}}swap(){return this._swapTexture?(this.currentIndex=this._getNextIndex(),!0):!1}update(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._setupTextures(e)}getTargetTexture(){const{targetTexture:e}=this.bindings[this.currentIndex];return e}getData(){let{packed:e=!1}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{framebuffer:t}=this.bindings[this.currentIndex],r=QE(t);if(!e)return r;const i=r.constructor,o=fK(this.targetTextureType),a=new i(r.length*o/4);let l=0;for(let h=0;h<r.length;h+=4)for(let p=0;p<o;p++)a[l++]=r[h+p];return a}getFramebuffer(){return this.bindings[this.currentIndex].framebuffer}delete(){this.ownTexture&&this.ownTexture.delete(),this.elementIDBuffer&&this.elementIDBuffer.delete()}_initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{_targetTextureVarying:t,_swapTexture:r}=e;this._swapTexture=r,this.targetTextureVarying=t,this.hasTargetTexture=t,this._setupTextures(e)}_createTargetTexture(e){const{sourceTextures:t,textureOrReference:r}=e;if(r instanceof Bs)return r;const i=t[r];return i?(this._targetRefTexName=r,this._createNewTexture(i)):null}_setupTextures(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{sourceBuffers:t,_sourceTextures:r={},_targetTexture:i}=e,o=this._createTargetTexture({sourceTextures:r,textureOrReference:i});this.hasSourceTextures=this.hasSourceTextures||r&&Object.keys(r).length>0,this._updateBindings({sourceBuffers:t,sourceTextures:r,targetTexture:o}),"elementCount"in e&&this._updateElementIDBuffer(e.elementCount)}_updateElementIDBuffer(e){if(typeof e!="number"||this.elementCount>=e)return;const t=new Float32Array(e);t.forEach((r,i,o)=>{o[i]=i}),this.elementIDBuffer?this.elementIDBuffer.setData({data:t}):this.elementIDBuffer=new ui(this.gl,{data:t,accessor:{size:1}}),this.elementCount=e}_updateBindings(e){if(this.bindings[this.currentIndex]=this._updateBinding(this.bindings[this.currentIndex],e),this._swapTexture){const{sourceTextures:t,targetTexture:r}=this._swapTextures(this.bindings[this.currentIndex]),i=this._getNextIndex();this.bindings[i]=this._updateBinding(this.bindings[i],{sourceTextures:t,targetTexture:r})}}_updateBinding(e,t){const{sourceBuffers:r,sourceTextures:i,targetTexture:o}=t;if(e||(e={sourceBuffers:{},sourceTextures:{},targetTexture:null}),Object.assign(e.sourceTextures,i),Object.assign(e.sourceBuffers,r),o){e.targetTexture=o;const{width:a,height:l}=o,{framebuffer:h}=e;h?(h.update({attachments:{36064:o},resizeAttachments:!1}),h.resize({width:a,height:l})):e.framebuffer=new Co(this.gl,{id:"transform-framebuffer",width:a,height:l,attachments:{36064:o}})}return e}_setSourceTextureParameters(){const e=this.currentIndex,{sourceTextures:t}=this.bindings[e];for(const r in t)t[r].setParameters(kZ)}_swapTextures(e){if(!this._swapTexture)return null;const t=Object.assign({},e.sourceTextures);t[this._swapTexture]=e.targetTexture;const r=e.sourceTextures[this._swapTexture];return{sourceTextures:t,targetTexture:r}}_createNewTexture(e){const t=sW(e,{parameters:{10241:9728,10240:9728,10242:33071,10243:33071},pixelStore:{37440:!1}});return this.ownTexture&&this.ownTexture.delete(),this.ownTexture=t,t}_getNextIndex(){return(this.currentIndex+1)%2}_processVertexShader(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{sourceTextures:t,targetTexture:r}=this.bindings[this.currentIndex],{vs:i,uniforms:o,targetTextureType:a,inject:l,samplerTextureMap:h}=CZ({vs:e.vs,sourceTextureMap:t,targetTextureVarying:this.targetTextureVarying,targetTexture:r}),p=I2([e.inject||{},l]);this.targetTextureType=a,this.samplerTextureMap=h;const g=e._fs||h6({version:e6(i),input:this.targetTextureVarying,inputType:a,output:OZ}),_=this.hasSourceTextures||this.targetTextureVarying?[mZ].concat(e.modules||[]):e.modules;return{vs:i,fs:g,modules:_,uniforms:o,inject:p}}}class sM{static isSupported(e){return vr(e)}constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.gl=e,this.model=null,this.elementCount=0,this.bufferTransform=null,this.textureTransform=null,this.elementIDBuffer=null,this._initialize(t),Object.seal(this)}delete(){const{model:e,bufferTransform:t,textureTransform:r}=this;e&&e.delete(),t&&t.delete(),r&&r.delete()}run(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{clearRenderTarget:t=!0}=e,r=this._updateDrawOptions(e);t&&r.framebuffer&&r.framebuffer.clear({color:!0}),this.model.transform(r)}swap(){let e=!1;const t=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const r of t)e=e||r.swap();Jt(e,"Nothing to swap")}getBuffer(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;return this.bufferTransform&&this.bufferTransform.getBuffer(e)}getData(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const t=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const r of t){const i=r.getData(e);if(i)return i}return null}getFramebuffer(){return this.textureTransform&&this.textureTransform.getFramebuffer()}update(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};"elementCount"in e&&this.model.setVertexCount(e.elementCount);const t=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const r of t)r.update(e)}_initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{gl:t}=this;this._buildResourceTransforms(t,e),e=this._updateModelProps(e),this.model=new rp(t,Object.assign({},e,{fs:e.fs||h6({version:e6(e.vs)}),id:e.id||"transform-model",drawMode:e.drawMode||0,vertexCount:e.elementCount})),this.bufferTransform&&this.bufferTransform.setupResources({model:this.model})}_updateModelProps(e){let t=Object.assign({},e);const r=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const i of r)t=i.updateModelProps(t);return t}_buildResourceTransforms(e,t){NZ(t)&&(this.bufferTransform=new TZ(e,t)),DZ(t)&&(this.textureTransform=new LZ(e,t)),Jt(this.bufferTransform||this.textureTransform,"must provide source/feedback buffers or source/target textures")}_updateDrawOptions(e){let t=Object.assign({},e);const r=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const i of r)t=Object.assign(t,i.getDrawOptions(t));return t}}function NZ(n){return!!(!jm(n.feedbackBuffers)||!jm(n.feedbackMap)||n.varyings&&n.varyings.length>0)}function DZ(n){return!!(!jm(n._sourceTextures)||n._targetTexture||n._targetTextureVarying)}const NL={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6};class hy{static get DRAW_MODE(){return NL}constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{id:t=rd("geometry"),drawMode:r=NL.TRIANGLES,attributes:i={},indices:o=null,vertexCount:a=null}=e;this.id=t,this.drawMode=r|0,this.attributes={},this.userData={},this._setAttributes(i,o),this.vertexCount=a||this._calculateVertexCount(this.attributes,this.indices)}get mode(){return this.drawMode}getVertexCount(){return this.vertexCount}getAttributes(){return this.indices?{indices:this.indices,...this.attributes}:this.attributes}_print(e){return"Geometry ".concat(this.id," attribute ").concat(e)}_setAttributes(e,t){t&&(this.indices=ArrayBuffer.isView(t)?{value:t,size:1}:t);for(const r in e){let i=e[r];i=ArrayBuffer.isView(i)?{value:i}:i,Jt(ArrayBuffer.isView(i.value),"".concat(this._print(r),": must be typed array or object with value as typed array")),(r==="POSITION"||r==="positions")&&!i.size&&(i.size=3),r==="indices"?(Jt(!this.indices),this.indices=i):this.attributes[r]=i}return this.indices&&this.indices.isIndexed!==void 0&&(this.indices=Object.assign({},this.indices),delete this.indices.isIndexed),this}_calculateVertexCount(e,t){if(t)return t.value.length;let r=1/0;for(const i in e){const o=e[i],{value:a,size:l,constant:h}=o;!h&&a&&l>=1&&(r=Math.min(r,a.length/l))}return Jt(Number.isFinite(r)),r}}let FZ=1,BZ=1;class b6{constructor(){this.time=0,this.channels=new Map,this.animations=new Map,this.playing=!1,this.lastEngineTime=-1}addChannel(e){const{delay:t=0,duration:r=Number.POSITIVE_INFINITY,rate:i=1,repeat:o=1}=e,a=FZ++,l={time:0,delay:t,duration:r,rate:i,repeat:o};return this._setChannelTime(l,this.time),this.channels.set(a,l),a}removeChannel(e){this.channels.delete(e);for(const[t,r]of this.animations)r.channel===e&&this.detachAnimation(t)}isFinished(e){const t=this.channels.get(e);return t===void 0?!1:this.time>=t.delay+t.duration*t.repeat}getTime(e){if(e===void 0)return this.time;const t=this.channels.get(e);return t===void 0?-1:t.time}setTime(e){this.time=Math.max(0,e);const t=this.channels.values();for(const i of t)this._setChannelTime(i,this.time);const r=this.animations.values();for(const i of r){const{animation:o,channel:a}=i;o.setTime(this.getTime(a))}}play(){this.playing=!0}pause(){this.playing=!1,this.lastEngineTime=-1}reset(){this.setTime(0)}attachAnimation(e,t){const r=BZ++;return this.animations.set(r,{animation:e,channel:t}),e.setTime(this.getTime(t)),r}detachAnimation(e){this.animations.delete(e)}update(e){this.playing&&(this.lastEngineTime===-1&&(this.lastEngineTime=e),this.setTime(this.time+(e-this.lastEngineTime)),this.lastEngineTime=e)}_setChannelTime(e,t){const r=t-e.delay,i=e.duration*e.repeat;r>=i?e.time=e.duration*e.rate:(e.time=Math.max(0,r)%e.duration,e.time*=e.rate)}}const UZ=[255,255,255],zZ=1;let jZ=0;class VZ{constructor(e={}){Y(this,"id",void 0),Y(this,"color",void 0),Y(this,"intensity",void 0),Y(this,"type","ambient");const{color:t=UZ}=e,{intensity:r=zZ}=e;this.id=e.id||"ambient-".concat(jZ++),this.color=t,this.intensity=r}}const HZ=[255,255,255],GZ=1,qZ=[0,0,-1];let $Z=0;class DL{constructor(e={}){Y(this,"id",void 0),Y(this,"color",void 0),Y(this,"intensity",void 0),Y(this,"type","directional"),Y(this,"direction",void 0),Y(this,"shadow",void 0);const{color:t=HZ}=e,{intensity:r=GZ}=e,{direction:i=qZ}=e,{_shadow:o=!1}=e;this.id=e.id||"directional-".concat($Z++),this.color=t,this.intensity=r,this.type="directional",this.direction=new Tl(i).normalize().toArray(),this.shadow=o}getProjectedLight(e){return this}}class WZ{constructor(e,t={id:"pass"}){Y(this,"id",void 0),Y(this,"gl",void 0),Y(this,"props",void 0);const{id:r}=t;this.id=r,this.gl=e,this.props={...t}}setProps(e){Object.assign(this.props,e)}render(e){}cleanup(){}}class cM extends WZ{constructor(...e){super(...e),Y(this,"_lastRenderIndex",-1)}render(e){const t=this.gl;return bu(t,{framebuffer:e.target}),this._drawLayers(e)}_drawLayers(e){const{target:t,moduleParameters:r,viewports:i,views:o,onViewportActive:a,clearStack:l=!0,clearCanvas:h=!0}=e;e.pass=e.pass||"unknown";const p=this.gl;h&&KZ(p,t),l&&(this._lastRenderIndex=-1);const g=[];for(const _ of i){const x=o&&o[_.id];a==null||a(_);const C=this._getDrawLayerParams(_,e),M=_.subViewports||[_];for(const L of M){const D=this._drawLayersInViewport(p,{target:t,moduleParameters:r,viewport:L,view:x,pass:e.pass,layers:e.layers},C);g.push(D)}}return g}_getDrawLayerParams(e,{layers:t,pass:r,isPicking:i=!1,layerFilter:o,cullRect:a,effects:l,moduleParameters:h},p=!1){const g=[],_=w6(this._lastRenderIndex+1),x={layer:t[0],viewport:e,isPicking:i,renderPass:r,cullRect:a},C={};for(let M=0;M<t.length;M++){const L=t[M],D=this._shouldDrawLayer(L,x,o,C),z={shouldDrawLayer:D};D&&!p&&(z.layerRenderIndex=_(L,D),z.moduleParameters=this._getModuleParameters(L,l,r,h),z.layerParameters=this.getLayerParameters(L,M,e)),g[M]=z}return g}_drawLayersInViewport(e,{layers:t,moduleParameters:r,pass:i,target:o,viewport:a,view:l},h){const p=YZ(e,{moduleParameters:r,target:o,viewport:a});if(l&&l.props.clear){const _=l.props.clear===!0?{color:!0,depth:!0}:l.props.clear;Ic(e,{scissorTest:!0,scissor:p},()=>rM(e,_))}const g={totalCount:t.length,visibleCount:0,compositeCount:0,pickableCount:0};bu(e,{viewport:p});for(let _=0;_<t.length;_++){const x=t[_],{shouldDrawLayer:C,layerRenderIndex:M,moduleParameters:L,layerParameters:D}=h[_];if(C&&x.props.pickable&&g.pickableCount++,x.isComposite)g.compositeCount++;else if(C){g.visibleCount++,this._lastRenderIndex=Math.max(this._lastRenderIndex,M),L.viewport=a;try{x._drawLayer({moduleParameters:L,uniforms:{layerIndex:M},parameters:D})}catch(z){x.raiseError(z,"drawing ".concat(x," to ").concat(i))}}}return g}shouldDrawLayer(e){return!0}getModuleParameters(e,t){return null}getLayerParameters(e,t,r){return e.props.parameters}_shouldDrawLayer(e,t,r,i){if(!(e.props.visible&&this.shouldDrawLayer(e)))return!1;t.layer=e;let a=e.parent;for(;a;){if(!a.props.visible||!a.filterSubLayer(t))return!1;t.layer=a,a=a.parent}if(r){const l=t.layer.id;if(l in i||(i[l]=r(t)),!i[l])return!1}return e.activateViewport(t.viewport),!0}_getModuleParameters(e,t,r,i){var o;const a=Object.assign(Object.create(((o=e.internalState)===null||o===void 0?void 0:o.propsInTransition)||e.props),{autoWrapLongitude:e.wrapLongitude,viewport:e.context.viewport,mousePosition:e.context.mousePosition,pickingActive:0,devicePixelRatio:zm(this.gl)});if(t)for(const h of t){var l;Object.assign(a,(l=h.getModuleParameters)===null||l===void 0?void 0:l.call(h,e))}return Object.assign(a,this.getModuleParameters(e,t),i)}}function w6(n=0,e={}){const t={},r=(i,o)=>{const a=i.props._offset,l=i.id,h=i.parent&&i.parent.id;let p;if(h&&!(h in e)&&r(i.parent,!1),h in t){const g=t[h]=t[h]||w6(e[h],e);p=g(i,o),t[l]=g}else Number.isFinite(a)?(p=a+(e[h]||0),t[l]=null):p=n;return o&&p>=n&&(n=p+1),e[l]=p,p};return r}function YZ(n,{moduleParameters:e,target:t,viewport:r}){const i=t&&t.id!=="default-framebuffer",o=e&&e.devicePixelRatio||zm(n),a=i?t.height:n.drawingBufferHeight,l=r;return[l.x*o,a-(l.y+l.height)*o,l.width*o,l.height*o]}function KZ(n,e){const t=e?e.width:n.drawingBufferWidth,r=e?e.height:n.drawingBufferHeight;bu(n,{viewport:[0,0,t,r]}),n.clear(16640)}class ZZ extends cM{constructor(e,t){super(e,t),Y(this,"shadowMap",void 0),Y(this,"depthBuffer",void 0),Y(this,"fbo",void 0),this.shadowMap=new Bs(e,{width:1,height:1,parameters:{10241:9729,10240:9729,10242:33071,10243:33071}}),this.depthBuffer=new Xg(e,{format:33189,width:1,height:1}),this.fbo=new Co(e,{id:"shadowmap",width:1,height:1,attachments:{36064:this.shadowMap,36096:this.depthBuffer}})}render(e){const t=this.fbo;Ic(this.gl,{depthRange:[0,1],depthTest:!0,blend:!1,clearColor:[1,1,1,1]},()=>{const r=e.viewports[0],i=zm(this.gl),o=r.width*i,a=r.height*i;(o!==t.width||a!==t.height)&&t.resize({width:o,height:a}),super.render({...e,target:t,pass:"shadow"})})}shouldDrawLayer(e){return e.props.shadowEnabled!==!1}getModuleParameters(){return{drawToShadowMap:!0}}delete(){this.fbo&&(this.fbo.delete(),this.fbo=null),this.shadowMap&&(this.shadowMap.delete(),this.shadowMap=null),this.depthBuffer&&(this.depthBuffer.delete(),this.depthBuffer=null)}}const x6="#define SMOOTH_EDGE_RADIUS 0.5",XZ=`
`.concat(x6,`

struct VertexGeometry {
  vec4 position;
  vec3 worldPosition;
  vec3 worldPositionAlt;
  vec3 normal;
  vec2 uv;
  vec3 pickingColor;
} geometry = VertexGeometry(
  vec4(0.0, 0.0, 1.0, 0.0),
  vec3(0.0),
  vec3(0.0),
  vec3(0.0),
  vec2(0.0),
  vec3(0.0)
);
`),QZ=`
`.concat(x6,`

struct FragmentGeometry {
  vec2 uv;
} geometry;

float smoothedge(float edge, float x) {
  return smoothstep(edge - SMOOTH_EDGE_RADIUS, edge + SMOOTH_EDGE_RADIUS, x);
}
`),JZ={name:"geometry",vs:XZ,fs:QZ},eX=Object.keys(Xr).map(n=>"const int COORDINATE_SYSTEM_".concat(n," = ").concat(Xr[n],";")).join(""),tX=Object.keys(ll).map(n=>"const int PROJECTION_MODE_".concat(n," = ").concat(ll[n],";")).join(""),nX=Object.keys(Um).map(n=>"const int UNIT_".concat(n.toUpperCase()," = ").concat(Um[n],";")).join(""),rX="".concat(eX,`
`).concat(tX,`
`).concat(nX,`

uniform int project_uCoordinateSystem;
uniform int project_uProjectionMode;
uniform float project_uScale;
uniform bool project_uWrapLongitude;
uniform vec3 project_uCommonUnitsPerMeter;
uniform vec3 project_uCommonUnitsPerWorldUnit;
uniform vec3 project_uCommonUnitsPerWorldUnit2;
uniform vec4 project_uCenter;
uniform mat4 project_uModelMatrix;
uniform mat4 project_uViewProjectionMatrix;
uniform vec2 project_uViewportSize;
uniform float project_uDevicePixelRatio;
uniform float project_uFocalDistance;
uniform vec3 project_uCameraPosition;
uniform vec3 project_uCoordinateOrigin;
uniform vec3 project_uCommonOrigin;
uniform bool project_uPseudoMeters;

const float TILE_SIZE = 512.0;
const float PI = 3.1415926536;
const float WORLD_SCALE = TILE_SIZE / (PI * 2.0);
const vec3 ZERO_64_LOW = vec3(0.0);
const float EARTH_RADIUS = 6370972.0;
const float GLOBE_RADIUS = 256.0;
float project_size_at_latitude(float lat) {
  float y = clamp(lat, -89.9, 89.9);
  return 1.0 / cos(radians(y));
}

float project_size() {
  if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR &&
    project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT &&
    project_uPseudoMeters == false) {
    
    if (geometry.position.w == 0.0) {
      return project_size_at_latitude(geometry.worldPosition.y);
    }
  
    float y = geometry.position.y / TILE_SIZE * 2.0 - 1.0;
    float y2 = y * y;
    float y4 = y2 * y2;
    float y6 = y4 * y2;
    return 1.0 + 4.9348 * y2 + 4.0587 * y4 + 1.5642 * y6;
  }
  return 1.0;
}

float project_size_at_latitude(float meters, float lat) {
  return meters * project_uCommonUnitsPerMeter.z * project_size_at_latitude(lat);
}
float project_size(float meters) {
  return meters * project_uCommonUnitsPerMeter.z * project_size();
}

vec2 project_size(vec2 meters) {
  return meters * project_uCommonUnitsPerMeter.xy * project_size();
}

vec3 project_size(vec3 meters) {
  return meters * project_uCommonUnitsPerMeter * project_size();
}

vec4 project_size(vec4 meters) {
  return vec4(meters.xyz * project_uCommonUnitsPerMeter, meters.w);
}
mat3 project_get_orientation_matrix(vec3 up) {
  vec3 uz = normalize(up);
  vec3 ux = abs(uz.z) == 1.0 ? vec3(1.0, 0.0, 0.0) : normalize(vec3(uz.y, -uz.x, 0));
  vec3 uy = cross(uz, ux);
  return mat3(ux, uy, uz);
}

bool project_needs_rotation(vec3 commonPosition, out mat3 transform) {
  if (project_uProjectionMode == PROJECTION_MODE_GLOBE) {
    transform = project_get_orientation_matrix(commonPosition);
    return true;
  }
  return false;
}
vec3 project_normal(vec3 vector) {
  vec4 normal_modelspace = project_uModelMatrix * vec4(vector, 0.0);
  vec3 n = normalize(normal_modelspace.xyz * project_uCommonUnitsPerMeter);
  mat3 rotation;
  if (project_needs_rotation(geometry.position.xyz, rotation)) {
    n = rotation * n;
  }
  return n;
}

vec4 project_offset_(vec4 offset) {
  float dy = offset.y;
  vec3 commonUnitsPerWorldUnit = project_uCommonUnitsPerWorldUnit + project_uCommonUnitsPerWorldUnit2 * dy;
  return vec4(offset.xyz * commonUnitsPerWorldUnit, offset.w);
}
vec2 project_mercator_(vec2 lnglat) {
  float x = lnglat.x;
  if (project_uWrapLongitude) {
    x = mod(x + 180., 360.0) - 180.;
  }
  float y = clamp(lnglat.y, -89.9, 89.9);
  return vec2(
    radians(x) + PI,
    PI + log(tan_fp32(PI * 0.25 + radians(y) * 0.5))
  ) * WORLD_SCALE;
}

vec3 project_globe_(vec3 lnglatz) {
  float lambda = radians(lnglatz.x);
  float phi = radians(lnglatz.y);
  float cosPhi = cos(phi);
  float D = (lnglatz.z / EARTH_RADIUS + 1.0) * GLOBE_RADIUS;

  return vec3(
    sin(lambda) * cosPhi,
    -cos(lambda) * cosPhi,
    sin(phi)
  ) * D;
}
vec4 project_position(vec4 position, vec3 position64Low) {
  vec4 position_world = project_uModelMatrix * position;
  if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR) {
    if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      return vec4(
        project_mercator_(position_world.xy),
        project_size_at_latitude(position_world.z, position_world.y),
        position_world.w
      );
    }
    if (project_uCoordinateSystem == COORDINATE_SYSTEM_CARTESIAN) {
      position_world.xyz += project_uCoordinateOrigin;
    }
  }
  if (project_uProjectionMode == PROJECTION_MODE_GLOBE) {
    if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      return vec4(
        project_globe_(position_world.xyz),
        position_world.w
      );
    }
  }
  if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
    if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      if (abs(position_world.y - project_uCoordinateOrigin.y) > 0.25) {
        return vec4(
          project_mercator_(position_world.xy) - project_uCommonOrigin.xy,
          project_size(position_world.z),
          position_world.w
        );
      }
    }
  }
  if (project_uProjectionMode == PROJECTION_MODE_IDENTITY ||
    (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET &&
    (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
     project_uCoordinateSystem == COORDINATE_SYSTEM_CARTESIAN))) {
    position_world.xyz -= project_uCoordinateOrigin;
  }
  return project_offset_(position_world) + project_offset_(project_uModelMatrix * vec4(position64Low, 0.0));
}

vec4 project_position(vec4 position) {
  return project_position(position, ZERO_64_LOW);
}

vec3 project_position(vec3 position, vec3 position64Low) {
  vec4 projected_position = project_position(vec4(position, 1.0), position64Low);
  return projected_position.xyz;
}

vec3 project_position(vec3 position) {
  vec4 projected_position = project_position(vec4(position, 1.0), ZERO_64_LOW);
  return projected_position.xyz;
}

vec2 project_position(vec2 position) {
  vec4 projected_position = project_position(vec4(position, 0.0, 1.0), ZERO_64_LOW);
  return projected_position.xy;
}

vec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {
  return viewProjectionMatrix * position + center;
}
vec4 project_common_position_to_clipspace(vec4 position) {
  return project_common_position_to_clipspace(position, project_uViewProjectionMatrix, project_uCenter);
}
vec2 project_pixel_size_to_clipspace(vec2 pixels) {
  vec2 offset = pixels / project_uViewportSize * project_uDevicePixelRatio * 2.0;
  return offset * project_uFocalDistance;
}

float project_size_to_pixel(float meters) {
  return project_size(meters) * project_uScale;
}
float project_size_to_pixel(float size, int unit) {
  if (unit == UNIT_METERS) return project_size_to_pixel(size);
  if (unit == UNIT_COMMON) return size * project_uScale;
  return size;
}
float project_pixel_size(float pixels) {
  return pixels / project_uScale;
}
vec2 project_pixel_size(vec2 pixels) {
  return pixels / project_uScale;
}
`);function iX(n,e){if(n===e)return!0;if(Array.isArray(n)){const t=n.length;if(!e||e.length!==t)return!1;for(let r=0;r<t;r++)if(n[r]!==e[r])return!1;return!0}return!1}function ib(n){let e={},t;return r=>{for(const i in r)if(!iX(r[i],e[i])){t=n(r),e=r;break}return t}}const FL=[0,0,0,0],oX=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],E6=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],aX=[0,0,0],T6=[0,0,0],sX=ib(uX);function S6(n,e,t=T6){t.length<3&&(t=[t[0],t[1],0]);let r=t,i,o=!0;switch(e===Xr.LNGLAT_OFFSETS||e===Xr.METER_OFFSETS?i=t:i=n.isGeospatial?[Math.fround(n.longitude),Math.fround(n.latitude),0]:null,n.projectionMode){case ll.WEB_MERCATOR:(e===Xr.LNGLAT||e===Xr.CARTESIAN)&&(i=[0,0,0],o=!1);break;case ll.WEB_MERCATOR_AUTO_OFFSET:e===Xr.LNGLAT?r=i:e===Xr.CARTESIAN&&(r=[Math.fround(n.center[0]),Math.fround(n.center[1]),0],i=n.unprojectPosition(r),r[0]-=t[0],r[1]-=t[1],r[2]-=t[2]);break;case ll.IDENTITY:r=n.position.map(Math.fround),r[2]=r[2]||0;break;case ll.GLOBE:o=!1,i=null;break;default:o=!1}return{geospatialOrigin:i,shaderCoordinateOrigin:r,offsetMode:o}}function cX(n,e,t){const{viewMatrixUncentered:r,projectionMatrix:i}=n;let{viewMatrix:o,viewProjectionMatrix:a}=n,l=FL,h=FL,p=n.cameraPosition;const{geospatialOrigin:g,shaderCoordinateOrigin:_,offsetMode:x}=S6(n,e,t);return x&&(h=n.projectPosition(g||_),p=[p[0]-h[0],p[1]-h[1],p[2]-h[2]],h[3]=1,l=nb([],h,a),o=r||o,a=gl([],i,o),a=gl([],a,oX)),{viewMatrix:o,viewProjectionMatrix:a,projectionCenter:l,originCommon:h,cameraPosCommon:p,shaderCoordinateOrigin:_,geospatialOrigin:g}}function lX({viewport:n,devicePixelRatio:e=1,modelMatrix:t=null,coordinateSystem:r=Xr.DEFAULT,coordinateOrigin:i=T6,autoWrapLongitude:o=!1}){r===Xr.DEFAULT&&(r=n.isGeospatial?Xr.LNGLAT:Xr.CARTESIAN);const a=sX({viewport:n,devicePixelRatio:e,coordinateSystem:r,coordinateOrigin:i});return a.project_uWrapLongitude=o,a.project_uModelMatrix=t||E6,a}function uX({viewport:n,devicePixelRatio:e,coordinateSystem:t,coordinateOrigin:r}){const{projectionCenter:i,viewProjectionMatrix:o,originCommon:a,cameraPosCommon:l,shaderCoordinateOrigin:h,geospatialOrigin:p}=cX(n,t,r),g=n.getDistanceScales(),_=[n.width*e,n.height*e],x=nb([],[0,0,-n.focalDistance,1],n.projectionMatrix)[3]||1,C={project_uCoordinateSystem:t,project_uProjectionMode:n.projectionMode,project_uCoordinateOrigin:h,project_uCommonOrigin:a.slice(0,3),project_uCenter:i,project_uPseudoMeters:!!n._pseudoMeters,project_uViewportSize:_,project_uDevicePixelRatio:e,project_uFocalDistance:x,project_uCommonUnitsPerMeter:g.unitsPerMeter,project_uCommonUnitsPerWorldUnit:g.unitsPerMeter,project_uCommonUnitsPerWorldUnit2:aX,project_uScale:n.scale,project_uWrapLongitude:!1,project_uViewProjectionMatrix:o,project_uModelMatrix:E6,project_uCameraPosition:l};if(p){const M=n.getDistanceScales(p);switch(t){case Xr.METER_OFFSETS:C.project_uCommonUnitsPerWorldUnit=M.unitsPerMeter,C.project_uCommonUnitsPerWorldUnit2=M.unitsPerMeter2;break;case Xr.LNGLAT:case Xr.LNGLAT_OFFSETS:n._pseudoMeters||(C.project_uCommonUnitsPerMeter=M.unitsPerMeter),C.project_uCommonUnitsPerWorldUnit=M.unitsPerDegree,C.project_uCommonUnitsPerWorldUnit2=M.unitsPerDegree2;break;case Xr.CARTESIAN:C.project_uCommonUnitsPerWorldUnit=[1,1,M.unitsPerMeter[2]],C.project_uCommonUnitsPerWorldUnit2=[0,0,M.unitsPerMeter2[2]];break}}return C}const hX={};function dX(n=hX){return"viewport"in n?lX(n):{}}const lM={name:"project",dependencies:[mK,JZ],vs:rX,getUniforms:dX};function Rw(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function gm(n,e){const t=nb([],e,n);return nZ(t,t,1/t[3]),t}function BL(n,e){const t=n%e;return t<0?e+t:t}function k2(n,e,t){return n<e?e:n>t?t:n}function fX(n){return Math.log(n)*Math.LOG2E}const uM=Math.log2||fX;function wu(n,e){if(!n)throw new Error(e||"@math.gl/web-mercator: assertion failed.")}const Cc=Math.PI,C6=Cc/4,ic=Cc/180,O2=180/Cc,qm=512,yx=4003e4,F1=85.051129,A6=1.5;function pX(n){return Math.pow(2,n)}function gX(n){return uM(n)}function zh(n){const[e,t]=n;wu(Number.isFinite(e)),wu(Number.isFinite(t)&&t>=-90&&t<=90,"invalid latitude");const r=e*ic,i=t*ic,o=qm*(r+Cc)/(2*Cc),a=qm*(Cc+Math.log(Math.tan(C6+i*.5)))/(2*Cc);return[o,a]}function uu(n){const[e,t]=n,r=e/qm*(2*Cc)-Cc,i=2*(Math.atan(Math.exp(t/qm*(2*Cc)-Cc))-C6);return[r*O2,i*O2]}function mX(n){const{latitude:e}=n;wu(Number.isFinite(e));const t=Math.cos(e*ic);return gX(yx*t)-9}function tC(n){const e=Math.cos(n*ic);return qm/yx/e}function _x(n){const{latitude:e,longitude:t,highPrecision:r=!1}=n;wu(Number.isFinite(e)&&Number.isFinite(t));const i=qm,o=Math.cos(e*ic),a=i/360,l=a/o,h=i/yx/o,p={unitsPerMeter:[h,h,h],metersPerUnit:[1/h,1/h,1/h],unitsPerDegree:[a,l,h],degreesPerUnit:[1/a,1/l,1/h]};if(r){const g=ic*Math.tan(e*ic)/o,_=a*g/2,x=i/yx*g,C=x/l*h;p.unitsPerDegree2=[0,_,x],p.unitsPerMeter2=[C,0,C]}return p}function I6(n,e){const[t,r,i]=n,[o,a,l]=e,{unitsPerMeter:h,unitsPerMeter2:p}=_x({longitude:t,latitude:r,highPrecision:!0}),g=zh(n);g[0]+=o*(h[0]+p[0]*a),g[1]+=a*(h[1]+p[1]*a);const _=uu(g),x=(i||0)+(l||0);return Number.isFinite(i)||Number.isFinite(l)?[_[0],_[1],x]:_}function P6(n){const{height:e,pitch:t,bearing:r,altitude:i,scale:o,center:a}=n,l=Rw();_0(l,l,[0,0,-i]),y6(l,l,-t*ic),_6(l,l,r*ic);const h=o/e;return JE(l,l,[h,h,h]),a&&_0(l,l,kK([],a)),l}function M6(n){const{width:e,height:t,altitude:r,pitch:i=0,offset:o,center:a,scale:l,nearZMultiplier:h=1,farZMultiplier:p=1}=n;let{fovy:g=$m(A6)}=n;r!==void 0&&(g=$m(r));const _=g*ic,x=i*ic,C=hM(g);let M=C;a&&(M+=a[2]*l/Math.cos(x)/t);const L=_*(.5+(o?o[1]:0)/t),D=Math.sin(L)*M/Math.sin(k2(Math.PI/2-x-L,.01,Math.PI-.01)),z=Math.sin(x)*D+M,te=M*10,le=Math.min(z*p,te);return{fov:_,aspect:e/t,focalDistance:C,near:h,far:le}}function yX(n){const{fov:e,aspect:t,near:r,far:i}=M6(n);return v6([],e,t,r,i)}function $m(n){return 2*Math.atan(.5/n)*O2}function hM(n){return .5/Math.tan(.5*n*ic)}function dM(n,e){const[t,r,i=0]=n;return wu(Number.isFinite(t)&&Number.isFinite(r)&&Number.isFinite(i)),gm(e,[t,r,i,1])}function v0(n,e,t=0){const[r,i,o]=n;if(wu(Number.isFinite(r)&&Number.isFinite(i),"invalid pixel coordinate"),Number.isFinite(o))return gm(e,[r,i,o,1]);const a=gm(e,[r,i,0,1]),l=gm(e,[r,i,1,1]),h=a[2],p=l[2],g=h===p?0:((t||0)-h)/(p-h);return p6([],a,l,g)}function fM(n){const{width:e,height:t,bounds:r,minExtent:i=0,maxZoom:o=24,offset:a=[0,0]}=n,[[l,h],[p,g]]=r,_=_X(n.padding),x=zh([l,k2(g,-F1,F1)]),C=zh([p,k2(h,-F1,F1)]),M=[Math.max(Math.abs(C[0]-x[0]),i),Math.max(Math.abs(C[1]-x[1]),i)],L=[e-_.left-_.right-Math.abs(a[0])*2,t-_.top-_.bottom-Math.abs(a[1])*2];wu(L[0]>0&&L[1]>0);const D=L[0]/M[0],z=L[1]/M[1],te=(_.right-_.left)/2/D,le=(_.top-_.bottom)/2/z,ce=[(C[0]+x[0])/2+te,(C[1]+x[1])/2+le],_e=uu(ce),J=Math.min(o,uM(Math.abs(Math.min(D,z))));return wu(Number.isFinite(J)),{longitude:_e[0],latitude:_e[1],zoom:J}}function _X(n=0){return typeof n=="number"?{top:n,bottom:n,left:n,right:n}:(wu(Number.isFinite(n.top)&&Number.isFinite(n.bottom)&&Number.isFinite(n.left)&&Number.isFinite(n.right)),n)}const UL=Math.PI/180;function R6(n,e=0){const{width:t,height:r,unproject:i}=n,o={targetZ:e},a=i([0,r],o),l=i([t,r],o);let h,p;const g=n.fovy?.5*n.fovy*UL:Math.atan(.5/n.altitude),_=(90-n.pitch)*UL;return g>_-.01?(h=zL(n,0,e),p=zL(n,t,e)):(h=i([0,0],o),p=i([t,0],o)),[a,l,p,h]}function zL(n,e,t){const{pixelUnprojectionMatrix:r}=n,i=gm(r,[e,0,1,1]),o=gm(r,[e,n.height,1,1]),l=(t*n.distanceScales.unitsPerMeter[2]-i[2])/(o[2]-i[2]),h=p6([],i,o,l),p=uu(h);return p.push(t),p}let vX=class L2{constructor(e={width:1,height:1}){Y(this,"latitude",void 0),Y(this,"longitude",void 0),Y(this,"zoom",void 0),Y(this,"pitch",void 0),Y(this,"bearing",void 0),Y(this,"altitude",void 0),Y(this,"fovy",void 0),Y(this,"meterOffset",void 0),Y(this,"center",void 0),Y(this,"width",void 0),Y(this,"height",void 0),Y(this,"scale",void 0),Y(this,"distanceScales",void 0),Y(this,"viewMatrix",void 0),Y(this,"projectionMatrix",void 0),Y(this,"viewProjectionMatrix",void 0),Y(this,"pixelProjectionMatrix",void 0),Y(this,"pixelUnprojectionMatrix",void 0),Y(this,"equals",z=>z instanceof L2?z.width===this.width&&z.height===this.height&&RL(z.projectionMatrix,this.projectionMatrix)&&RL(z.viewMatrix,this.viewMatrix):!1),Y(this,"project",(z,te={})=>{const{topLeft:le=!0}=te,ce=this.projectPosition(z),_e=dM(ce,this.pixelProjectionMatrix),[J,pe]=_e,ue=le?pe:this.height-pe;return z.length===2?[J,ue]:[J,ue,_e[2]]}),Y(this,"unproject",(z,te={})=>{const{topLeft:le=!0,targetZ:ce=void 0}=te,[_e,J,pe]=z,ue=le?J:this.height-J,xe=ce&&ce*this.distanceScales.unitsPerMeter[2],je=v0([_e,ue,pe],this.pixelUnprojectionMatrix,xe),[ne,Ee,ke]=this.unprojectPosition(je);return Number.isFinite(pe)?[ne,Ee,ke]:Number.isFinite(ce)?[ne,Ee,ce]:[ne,Ee]}),Y(this,"projectPosition",z=>{const[te,le]=zh(z),ce=(z[2]||0)*this.distanceScales.unitsPerMeter[2];return[te,le,ce]}),Y(this,"unprojectPosition",z=>{const[te,le]=uu(z),ce=(z[2]||0)*this.distanceScales.metersPerUnit[2];return[te,le,ce]});let{width:t,height:r,altitude:i=null,fovy:o=null}=e;const{latitude:a=0,longitude:l=0,zoom:h=0,pitch:p=0,bearing:g=0,position:_=null,nearZMultiplier:x=.02,farZMultiplier:C=1.01}=e;t=t||1,r=r||1,o===null&&i===null?(i=A6,o=$m(i)):o===null?o=$m(i):i===null&&(i=hM(o));const M=pX(h);i=Math.max(.75,i);const L=_x({longitude:l,latitude:a}),D=zh([l,a]);D.push(0),_&&PK(D,D,VK([],_,L.unitsPerMeter)),this.projectionMatrix=yX({width:t,height:r,scale:M,center:D,pitch:p,fovy:o,nearZMultiplier:x,farZMultiplier:C}),this.viewMatrix=P6({height:r,scale:M,center:D,pitch:p,bearing:g,altitude:i}),this.width=t,this.height=r,this.scale=M,this.latitude=a,this.longitude=l,this.zoom=h,this.pitch=p,this.bearing=g,this.altitude=i,this.fovy=o,this.center=D,this.meterOffset=_||[0,0,0],this.distanceScales=L,this._initMatrices(),Object.freeze(this)}_initMatrices(){const{width:e,height:t,projectionMatrix:r,viewMatrix:i}=this,o=Rw();gl(o,o,r),gl(o,o,i),this.viewProjectionMatrix=o;const a=Rw();JE(a,a,[e/2,-t/2,1]),_0(a,a,[1,-1,0]),gl(a,a,o);const l=gx(Rw(),a);if(!l)throw new Error("Pixel project matrix not invertible");this.pixelProjectionMatrix=a,this.pixelUnprojectionMatrix=l}projectFlat(e){return zh(e)}unprojectFlat(e){return uu(e)}getMapCenterByLngLatPosition({lngLat:e,pos:t}){const r=v0(t,this.pixelUnprojectionMatrix),i=zh(e),o=px([],i,f6([],r)),a=px([],this.center,o);return uu(a)}fitBounds(e,t={}){const{width:r,height:i}=this,{longitude:o,latitude:a,zoom:l}=fM(Object.assign({width:r,height:i,bounds:e},t));return new L2({width:r,height:i,longitude:o,latitude:a,zoom:l})}getBounds(e){const t=this.getBoundingRegion(e),r=Math.min(...t.map(l=>l[0])),i=Math.max(...t.map(l=>l[0])),o=Math.min(...t.map(l=>l[1])),a=Math.max(...t.map(l=>l[1]));return[[r,o],[i,a]]}getBoundingRegion(e={}){return R6(this,e.z||0)}getLocationAtPoint({lngLat:e,pos:t}){return this.getMapCenterByLngLatPosition({lngLat:e,pos:t})}};const jL=512;function bX(n){const{width:e,height:t,pitch:r=0}=n;let{longitude:i,latitude:o,zoom:a,bearing:l=0}=n;(i<-180||i>180)&&(i=BL(i+180,360)-180),(l<-180||l>180)&&(l=BL(l+180,360)-180);const h=uM(t/jL);if(a<=h)a=h,o=0;else{const p=t/2/Math.pow(2,a),g=uu([0,p])[1];if(o<g)o=g;else{const _=uu([0,jL-p])[1];o>_&&(o=_)}}return{width:e,height:t,longitude:i,latitude:o,zoom:a,pitch:r,bearing:l}}const wX=`
const int max_lights = 2;
uniform mat4 shadow_uViewProjectionMatrices[max_lights];
uniform vec4 shadow_uProjectCenters[max_lights];
uniform bool shadow_uDrawShadowMap;
uniform bool shadow_uUseShadowMap;
uniform int shadow_uLightId;
uniform float shadow_uLightCount;

varying vec3 shadow_vPosition[max_lights];

vec4 shadow_setVertexPosition(vec4 position_commonspace) {
  if (shadow_uDrawShadowMap) {
    return project_common_position_to_clipspace(position_commonspace, shadow_uViewProjectionMatrices[shadow_uLightId], shadow_uProjectCenters[shadow_uLightId]);
  }
  if (shadow_uUseShadowMap) {
    for (int i = 0; i < max_lights; i++) {
      if(i < int(shadow_uLightCount)) {
        vec4 shadowMap_position = project_common_position_to_clipspace(position_commonspace, shadow_uViewProjectionMatrices[i], shadow_uProjectCenters[i]);
        shadow_vPosition[i] = (shadowMap_position.xyz / shadowMap_position.w + 1.0) / 2.0;
      }
    }
  }
  return gl_Position;
}
`,xX=`
const int max_lights = 2;
uniform bool shadow_uDrawShadowMap;
uniform bool shadow_uUseShadowMap;
uniform sampler2D shadow_uShadowMap0;
uniform sampler2D shadow_uShadowMap1;
uniform vec4 shadow_uColor;
uniform float shadow_uLightCount;

varying vec3 shadow_vPosition[max_lights];

const vec4 bitPackShift = vec4(1.0, 255.0, 65025.0, 16581375.0);
const vec4 bitUnpackShift = 1.0 / bitPackShift;
const vec4 bitMask = vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0,  0.0);

float shadow_getShadowWeight(vec3 position, sampler2D shadowMap) {
  vec4 rgbaDepth = texture2D(shadowMap, position.xy);

  float z = dot(rgbaDepth, bitUnpackShift);
  return smoothstep(0.001, 0.01, position.z - z);
}

vec4 shadow_filterShadowColor(vec4 color) {
  if (shadow_uDrawShadowMap) {
    vec4 rgbaDepth = fract(gl_FragCoord.z * bitPackShift);
    rgbaDepth -= rgbaDepth.gbaa * bitMask;
    return rgbaDepth;
  }
  if (shadow_uUseShadowMap) {
    float shadowAlpha = 0.0;
    shadowAlpha += shadow_getShadowWeight(shadow_vPosition[0], shadow_uShadowMap0);
    if(shadow_uLightCount > 1.0) {
      shadowAlpha += shadow_getShadowWeight(shadow_vPosition[1], shadow_uShadowMap1);
    }
    shadowAlpha *= shadow_uColor.a / shadow_uLightCount;
    float blendedAlpha = shadowAlpha + color.a * (1.0 - shadowAlpha);

    return vec4(
      mix(color.rgb, shadow_uColor.rgb, shadowAlpha / blendedAlpha),
      blendedAlpha
    );
  }
  return color;
}
`,EX=ib(IX),TX=ib(PX),SX=[0,0,0,1],CX=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0];function AX(n,e){const[t,r,i]=n,o=v0([t,r,i],e);return Number.isFinite(i)?o:[o[0],o[1],0]}function IX({viewport:n,center:e}){return new Sl(n.viewProjectionMatrix).invert().transform(e)}function PX({viewport:n,shadowMatrices:e}){const t=[],r=n.pixelUnprojectionMatrix,i=n.isGeospatial?void 0:1,o=[[0,0,i],[n.width,0,i],[0,n.height,i],[n.width,n.height,i],[0,0,-1],[n.width,0,-1],[0,n.height,-1],[n.width,n.height,-1]].map(a=>AX(a,r));for(const a of e){const l=a.clone().translate(new Tl(n.center).negate()),h=o.map(g=>l.transform(g)),p=new Sl().ortho({left:Math.min(...h.map(g=>g[0])),right:Math.max(...h.map(g=>g[0])),bottom:Math.min(...h.map(g=>g[1])),top:Math.max(...h.map(g=>g[1])),near:Math.min(...h.map(g=>-g[2])),far:Math.max(...h.map(g=>-g[2]))});t.push(p.multiplyRight(a))}return t}function MX(n,e){const{shadowEnabled:t=!0}=n;if(!t||!n.shadowMatrices||!n.shadowMatrices.length)return{shadow_uDrawShadowMap:!1,shadow_uUseShadowMap:!1};const r={shadow_uDrawShadowMap:!!n.drawToShadowMap,shadow_uUseShadowMap:n.shadowMaps?n.shadowMaps.length>0:!1,shadow_uColor:n.shadowColor||SX,shadow_uLightId:n.shadowLightId||0,shadow_uLightCount:n.shadowMatrices.length},i=EX({viewport:n.viewport,center:e.project_uCenter}),o=[],a=TX({shadowMatrices:n.shadowMatrices,viewport:n.viewport}).slice();for(let l=0;l<n.shadowMatrices.length;l++){const h=a[l],p=h.clone().translate(new Tl(n.viewport.center).negate());e.project_uCoordinateSystem===Xr.LNGLAT&&e.project_uProjectionMode===ll.WEB_MERCATOR?(a[l]=p,o[l]=i):(a[l]=h.clone().multiplyRight(CX),o[l]=p.transform(i))}for(let l=0;l<a.length;l++)r["shadow_uViewProjectionMatrices[".concat(l,"]")]=a[l],r["shadow_uProjectCenters[".concat(l,"]")]=o[l],n.shadowMaps&&n.shadowMaps.length>0?r["shadow_uShadowMap".concat(l)]=n.shadowMaps[l]:r["shadow_uShadowMap".concat(l)]=n.dummyShadowMap;return r}const nC={name:"shadow",dependencies:[lM],vs:wX,fs:xX,inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    position = shadow_setVertexPosition(geometry.position);
    `,"fs:DECKGL_FILTER_COLOR":`
    color = shadow_filterShadowColor(color);
    `},getUniforms:(n={},e={})=>"viewport"in n&&(n.drawToShadowMap||n.shadowMaps&&n.shadowMaps.length>0)?MX(n,e):{}},RX={color:[255,255,255],intensity:1},VL=[{color:[255,255,255],intensity:1,direction:[-1,3,-1]},{color:[255,255,255],intensity:.9,direction:[1,-8,-2.5]}],kX=[0,0,0,200/255];class k6{constructor(e={}){Y(this,"id","lighting-effect"),Y(this,"props",void 0),Y(this,"shadowColor",kX),Y(this,"shadow",void 0),Y(this,"ambientLight",void 0),Y(this,"directionalLights",void 0),Y(this,"pointLights",void 0),Y(this,"shadowPasses",[]),Y(this,"shadowMaps",[]),Y(this,"dummyShadowMap",null),Y(this,"programManager",void 0),Y(this,"shadowMatrices",void 0),this.setProps(e)}setProps(e){this.ambientLight=null,this.directionalLights=[],this.pointLights=[];for(const t in e){const r=e[t];switch(r.type){case"ambient":this.ambientLight=r;break;case"directional":this.directionalLights.push(r);break;case"point":this.pointLights.push(r);break}}this._applyDefaultLights(),this.shadow=this.directionalLights.some(t=>t.shadow),this.props=e}preRender(e,{layers:t,layerFilter:r,viewports:i,onViewportActive:o,views:a}){if(this.shadow){this.shadowMatrices=this._calculateMatrices(),this.shadowPasses.length===0&&this._createShadowPasses(e),this.programManager||(this.programManager=rb.getDefaultProgramManager(e),nC&&this.programManager.addDefaultModule(nC)),this.dummyShadowMap||(this.dummyShadowMap=new Bs(e,{width:1,height:1}));for(let l=0;l<this.shadowPasses.length;l++)this.shadowPasses[l].render({layers:t,layerFilter:r,viewports:i,onViewportActive:o,views:a,moduleParameters:{shadowLightId:l,dummyShadowMap:this.dummyShadowMap,shadowMatrices:this.shadowMatrices}})}}getModuleParameters(e){const t=this.shadow?{shadowMaps:this.shadowMaps,dummyShadowMap:this.dummyShadowMap,shadowColor:this.shadowColor,shadowMatrices:this.shadowMatrices}:{};return t.lightSources={ambientLight:this.ambientLight,directionalLights:this.directionalLights.map(r=>r.getProjectedLight({layer:e})),pointLights:this.pointLights.map(r=>r.getProjectedLight({layer:e}))},t}cleanup(){for(const e of this.shadowPasses)e.delete();this.shadowPasses.length=0,this.shadowMaps.length=0,this.dummyShadowMap&&(this.dummyShadowMap.delete(),this.dummyShadowMap=null),this.shadow&&this.programManager&&(this.programManager.removeDefaultModule(nC),this.programManager=null)}_calculateMatrices(){const e=[];for(const t of this.directionalLights){const r=new Sl().lookAt({eye:new Tl(t.direction).negate()});e.push(r)}return e}_createShadowPasses(e){for(let t=0;t<this.directionalLights.length;t++){const r=new ZZ(e);this.shadowPasses[t]=r,this.shadowMaps[t]=r.shadowMap}}_applyDefaultLights(){const{ambientLight:e,pointLights:t,directionalLights:r}=this;!e&&t.length===0&&r.length===0&&(this.ambientLight=new VZ(RX),this.directionalLights.push(new DL(VL[0]),new DL(VL[1])))}}class OX{constructor(e={}){Y(this,"_pool",[]),Y(this,"opts",{overAlloc:2,poolSize:100}),this.setOptions(e)}setOptions(e){Object.assign(this.opts,e)}allocate(e,t,{size:r=1,type:i,padding:o=0,copy:a=!1,initialize:l=!1,maxCount:h}){const p=i||e&&e.constructor||Float32Array,g=t*r+o;if(ArrayBuffer.isView(e)){if(g<=e.length)return e;if(g*e.BYTES_PER_ELEMENT<=e.buffer.byteLength)return new p(e.buffer,0,g)}let _=1/0;h&&(_=h*r+o);const x=this._allocate(p,g,l,_);return e&&a?x.set(e):l||x.fill(0,0,4),this._release(e),x}release(e){this._release(e)}_allocate(e,t,r,i){let o=Math.max(Math.ceil(t*this.opts.overAlloc),1);o>i&&(o=i);const a=this._pool,l=e.BYTES_PER_ELEMENT*o,h=a.findIndex(p=>p.byteLength>=l);if(h>=0){const p=new e(a.splice(h,1)[0],0,o);return r&&p.fill(0),p}return new e(o)}_release(e){if(!ArrayBuffer.isView(e))return;const t=this._pool,{buffer:r}=e,{byteLength:i}=r,o=t.findIndex(a=>a.byteLength>=i);o<0?t.push(r):(o>0||t.length<this.opts.poolSize)&&t.splice(o,0,r),t.length>this.opts.poolSize&&t.shift()}}const b0=new OX;function Ev(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function LX(n){return[n[12],n[13],n[14]]}function NX(n){return{left:mg(n[3]+n[0],n[7]+n[4],n[11]+n[8],n[15]+n[12]),right:mg(n[3]-n[0],n[7]-n[4],n[11]-n[8],n[15]-n[12]),bottom:mg(n[3]+n[1],n[7]+n[5],n[11]+n[9],n[15]+n[13]),top:mg(n[3]-n[1],n[7]-n[5],n[11]-n[9],n[15]-n[13]),near:mg(n[3]+n[2],n[7]+n[6],n[11]+n[10],n[15]+n[14]),far:mg(n[3]-n[2],n[7]-n[6],n[11]-n[10],n[15]-n[14])}}const HL=new Tl;function mg(n,e,t,r){HL.set(n,e,t);const i=HL.len();return{distance:r/i,normal:new Tl(-n/i,-e/i,-t/i)}}function DX(n){return n-Math.fround(n)}let I_;function rC(n,e){const{size:t=1,startIndex:r=0}=e,i=e.endIndex!==void 0?e.endIndex:n.length,o=(i-r)/t;I_=b0.allocate(I_,o,{type:Float32Array,size:t*2});let a=r,l=0;for(;a<i;){for(let h=0;h<t;h++){const p=n[a++];I_[l+h]=p,I_[l+h+t]=DX(p)}l+=t*2}return I_.subarray(0,o*t*2)}function FX(n){let e=null,t=!1;for(const r of n)r&&(e?(t||(e=[[e[0][0],e[0][1]],[e[1][0],e[1][1]]],t=!0),e[0][0]=Math.min(e[0][0],r[0][0]),e[0][1]=Math.min(e[0][1],r[0][1]),e[1][0]=Math.max(e[1][0],r[1][0]),e[1][1]=Math.max(e[1][1],r[1][1])):e=r);return e}const BX=Math.PI/180,UX=Ev(),GL=[0,0,0],zX={unitsPerMeter:[1,1,1],metersPerUnit:[1,1,1]};function jX({width:n,height:e,orthographic:t,fovyRadians:r,focalDistance:i,padding:o,near:a,far:l}){const h=n/e,p=t?new Sl().orthographic({fovy:r,aspect:h,focalDistance:i,near:a,far:l}):new Sl().perspective({fovy:r,aspect:h,near:a,far:l});if(o){const{left:g=0,right:_=0,top:x=0,bottom:C=0}=o,M=Uh((g+n-_)/2,0,n)-n/2,L=Uh((x+e-C)/2,0,e)-e/2;p[8]-=M*2/n,p[9]+=L*2/e}return p}class dy{constructor(e={}){Y(this,"id",void 0),Y(this,"x",void 0),Y(this,"y",void 0),Y(this,"width",void 0),Y(this,"height",void 0),Y(this,"padding",void 0),Y(this,"isGeospatial",void 0),Y(this,"zoom",void 0),Y(this,"focalDistance",void 0),Y(this,"position",void 0),Y(this,"modelMatrix",void 0),Y(this,"distanceScales",void 0),Y(this,"scale",void 0),Y(this,"center",void 0),Y(this,"cameraPosition",void 0),Y(this,"projectionMatrix",void 0),Y(this,"viewMatrix",void 0),Y(this,"viewMatrixUncentered",void 0),Y(this,"viewMatrixInverse",void 0),Y(this,"viewProjectionMatrix",void 0),Y(this,"pixelProjectionMatrix",void 0),Y(this,"pixelUnprojectionMatrix",void 0),Y(this,"resolution",void 0),Y(this,"_frustumPlanes",{}),this.id=e.id||this.constructor.displayName||"viewport",this.x=e.x||0,this.y=e.y||0,this.width=e.width||1,this.height=e.height||1,this.zoom=e.zoom||0,this.padding=e.padding,this.distanceScales=e.distanceScales||zX,this.focalDistance=e.focalDistance||1,this.position=e.position||GL,this.modelMatrix=e.modelMatrix||null;const{longitude:t,latitude:r}=e;this.isGeospatial=Number.isFinite(r)&&Number.isFinite(t),this._initProps(e),this._initMatrices(e),this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}get subViewports(){return null}get metersPerPixel(){return this.distanceScales.metersPerUnit[2]/this.scale}get projectionMode(){return this.isGeospatial?this.zoom<12?ll.WEB_MERCATOR:ll.WEB_MERCATOR_AUTO_OFFSET:ll.IDENTITY}equals(e){return e instanceof dy?this===e?!0:e.width===this.width&&e.height===this.height&&e.scale===this.scale&&y0(e.projectionMatrix,this.projectionMatrix)&&y0(e.viewMatrix,this.viewMatrix):!1}project(e,{topLeft:t=!0}={}){const r=this.projectPosition(e),i=dM(r,this.pixelProjectionMatrix),[o,a]=i,l=t?a:this.height-a;return e.length===2?[o,l]:[o,l,i[2]]}unproject(e,{topLeft:t=!0,targetZ:r}={}){const[i,o,a]=e,l=t?o:this.height-o,h=r&&r*this.distanceScales.unitsPerMeter[2],p=v0([i,l,a],this.pixelUnprojectionMatrix,h),[g,_,x]=this.unprojectPosition(p);return Number.isFinite(a)?[g,_,x]:Number.isFinite(r)?[g,_,r]:[g,_]}projectPosition(e){const[t,r]=this.projectFlat(e),i=(e[2]||0)*this.distanceScales.unitsPerMeter[2];return[t,r,i]}unprojectPosition(e){const[t,r]=this.unprojectFlat(e),i=(e[2]||0)*this.distanceScales.metersPerUnit[2];return[t,r,i]}projectFlat(e){if(this.isGeospatial){const t=zh(e);return t[1]=Uh(t[1],-318,830),t}return e}unprojectFlat(e){return this.isGeospatial?uu(e):e}getBounds(e={}){const t={targetZ:e.z||0},r=this.unproject([0,0],t),i=this.unproject([this.width,0],t),o=this.unproject([0,this.height],t),a=this.unproject([this.width,this.height],t);return[Math.min(r[0],i[0],o[0],a[0]),Math.min(r[1],i[1],o[1],a[1]),Math.max(r[0],i[0],o[0],a[0]),Math.max(r[1],i[1],o[1],a[1])]}getDistanceScales(e){return e?_x({longitude:e[0],latitude:e[1],highPrecision:!0}):this.distanceScales}containsPixel({x:e,y:t,width:r=1,height:i=1}){return e<this.x+this.width&&this.x<e+r&&t<this.y+this.height&&this.y<t+i}getFrustumPlanes(){return this._frustumPlanes.near?this._frustumPlanes:(Object.assign(this._frustumPlanes,NX(this.viewProjectionMatrix)),this._frustumPlanes)}panByPosition(e,t){return null}_initProps(e){const t=e.longitude,r=e.latitude;this.isGeospatial&&(Number.isFinite(e.zoom)||(this.zoom=mX({latitude:r})+Math.log2(this.focalDistance)),this.distanceScales=e.distanceScales||_x({latitude:r,longitude:t}));const i=Math.pow(2,this.zoom);this.scale=i;const{position:o,modelMatrix:a}=e;let l=GL;if(o&&(l=a?new Sl(a).transformAsVector(o,[]):o),this.isGeospatial){const h=this.projectPosition([t,r,0]);this.center=new Tl(l).scale(this.distanceScales.unitsPerMeter).add(h)}else this.center=this.projectPosition(l)}_initMatrices(e){const{viewMatrix:t=UX,projectionMatrix:r=null,orthographic:i=!1,fovyRadians:o,fovy:a=75,near:l=.1,far:h=1e3,padding:p=null,focalDistance:g=1}=e;this.viewMatrixUncentered=t,this.viewMatrix=new Sl().multiplyRight(t).translate(new Tl(this.center).negate()),this.projectionMatrix=r||jX({width:this.width,height:this.height,orthographic:i,fovyRadians:o||a*BX,focalDistance:g,padding:p,near:l,far:h});const _=Ev();gl(_,_,this.projectionMatrix),gl(_,_,this.viewMatrix),this.viewProjectionMatrix=_,this.viewMatrixInverse=gx([],this.viewMatrix)||this.viewMatrix,this.cameraPosition=LX(this.viewMatrixInverse);const x=Ev(),C=Ev();JE(x,x,[this.width/2,-this.height/2,1]),_0(x,x,[1,-1,0]),gl(C,x,this.viewProjectionMatrix),this.pixelProjectionMatrix=C,this.pixelUnprojectionMatrix=gx(Ev(),this.pixelProjectionMatrix),this.pixelUnprojectionMatrix||Fr.warn("Pixel project matrix not invertible")()}}Y(dy,"displayName","Viewport");class Wm extends dy{constructor(e={}){const{latitude:t=0,longitude:r=0,zoom:i=0,pitch:o=0,bearing:a=0,nearZMultiplier:l=.1,farZMultiplier:h=1.01,nearZ:p,farZ:g,orthographic:_=!1,projectionMatrix:x,repeat:C=!1,worldOffset:M=0,position:L,padding:D,legacyMeterSizes:z=!1}=e;let{width:te,height:le,altitude:ce=1.5}=e;const _e=Math.pow(2,i);te=te||1,le=le||1;let J,pe=null;if(x)ce=x[5]/2,J=$m(ce);else{e.fovy?(J=e.fovy,ce=hM(J)):J=$m(ce);let xe;if(D){const{top:je=0,bottom:ne=0}=D;xe=[0,Uh((je+le-ne)/2,0,le)-le/2]}pe=M6({width:te,height:le,scale:_e,center:L&&[0,0,L[2]*tC(t)],offset:xe,pitch:o,fovy:J,nearZMultiplier:l,farZMultiplier:h}),Number.isFinite(p)&&(pe.near=p),Number.isFinite(g)&&(pe.far=g)}let ue=P6({height:le,pitch:o,bearing:a,scale:_e,altitude:ce});M&&(ue=new Sl().translate([512*M,0,0]).multiplyLeft(ue)),super({...e,width:te,height:le,viewMatrix:ue,longitude:r,latitude:t,zoom:i,...pe,fovy:J,focalDistance:ce}),Y(this,"longitude",void 0),Y(this,"latitude",void 0),Y(this,"pitch",void 0),Y(this,"bearing",void 0),Y(this,"altitude",void 0),Y(this,"fovy",void 0),Y(this,"orthographic",void 0),Y(this,"_subViewports",void 0),Y(this,"_pseudoMeters",void 0),this.latitude=t,this.longitude=r,this.zoom=i,this.pitch=o,this.bearing=a,this.altitude=ce,this.fovy=J,this.orthographic=_,this._subViewports=C?[]:null,this._pseudoMeters=z,Object.freeze(this)}get subViewports(){if(this._subViewports&&!this._subViewports.length){const e=this.getBounds(),t=Math.floor((e[0]+180)/360),r=Math.ceil((e[2]-180)/360);for(let i=t;i<=r;i++){const o=i?new Wm({...this,worldOffset:i}):this;this._subViewports.push(o)}}return this._subViewports}projectPosition(e){if(this._pseudoMeters)return super.projectPosition(e);const[t,r]=this.projectFlat(e),i=(e[2]||0)*tC(e[1]);return[t,r,i]}unprojectPosition(e){if(this._pseudoMeters)return super.unprojectPosition(e);const[t,r]=this.unprojectFlat(e),i=(e[2]||0)/tC(r);return[t,r,i]}addMetersToLngLat(e,t){return I6(e,t)}panByPosition(e,t){const r=v0(t,this.pixelUnprojectionMatrix),i=this.projectFlat(e),o=px([],i,f6([],r)),a=px([],this.center,o),[l,h]=this.unprojectFlat(a);return{longitude:l,latitude:h}}getBounds(e={}){const t=R6(this,e.z||0);return[Math.min(t[0][0],t[1][0],t[2][0],t[3][0]),Math.min(t[0][1],t[1][1],t[2][1],t[3][1]),Math.max(t[0][0],t[1][0],t[2][0],t[3][0]),Math.max(t[0][1],t[1][1],t[2][1],t[3][1])]}fitBounds(e,t={}){const{width:r,height:i}=this,{longitude:o,latitude:a,zoom:l}=fM({width:r,height:i,bounds:e,...t});return new Wm({width:r,height:i,longitude:o,latitude:a,zoom:l})}}Y(Wm,"displayName","WebMercatorViewport");const qL=[0,0,0];function iC(n,e,t=!1){const r=e.projectPosition(n);if(t&&e instanceof Wm){const[i,o,a=0]=n,l=e.getDistanceScales([i,o]);r[2]=a*l.unitsPerMeter[2]}return r}function VX(n){const{viewport:e,modelMatrix:t,coordinateOrigin:r}=n;let{coordinateSystem:i,fromCoordinateSystem:o,fromCoordinateOrigin:a}=n;return i===Xr.DEFAULT&&(i=e.isGeospatial?Xr.LNGLAT:Xr.CARTESIAN),o===void 0&&(o=i),a===void 0&&(a=r),{viewport:e,coordinateSystem:i,coordinateOrigin:r,modelMatrix:t,fromCoordinateSystem:o,fromCoordinateOrigin:a}}function O6(n,{viewport:e,modelMatrix:t,coordinateSystem:r,coordinateOrigin:i,offsetMode:o}){let[a,l,h=0]=n;switch(t&&([a,l,h]=nb([],[a,l,h,1],t)),r){case Xr.LNGLAT:return iC([a,l,h],e,o);case Xr.LNGLAT_OFFSETS:return iC([a+i[0],l+i[1],h+(i[2]||0)],e,o);case Xr.METER_OFFSETS:return iC(I6(i,[a,l,h]),e,o);case Xr.CARTESIAN:default:return e.isGeospatial?[a+i[0],l+i[1],h+i[2]]:e.projectPosition([a,l,h])}}function HX(n,e){const{viewport:t,coordinateSystem:r,coordinateOrigin:i,modelMatrix:o,fromCoordinateSystem:a,fromCoordinateOrigin:l}=VX(e),{autoOffset:h=!0}=e,{geospatialOrigin:p=qL,shaderCoordinateOrigin:g=qL,offsetMode:_=!1}=h?S6(t,r,i):{},x=O6(n,{viewport:t,modelMatrix:o,coordinateSystem:a,coordinateOrigin:l,offsetMode:_});if(_){const C=t.projectPosition(p||g);jK(x,x,C)}return x}const $L={blendFunc:[1,0,32771,0],blendEquation:32774};class L6 extends cM{constructor(...e){super(...e),Y(this,"pickZ",void 0),Y(this,"_colorEncoderState",null)}render(e){return"pickingFBO"in e?this._drawPickingBuffer(e):super.render(e)}_drawPickingBuffer({layers:e,layerFilter:t,views:r,viewports:i,onViewportActive:o,pickingFBO:a,deviceRect:{x:l,y:h,width:p,height:g},cullRect:_,effects:x,pass:C="picking",pickZ:M,moduleParameters:L}){const D=this.gl;this.pickZ=M;const z=this._resetColorEncoder(M),te=Ic(D,{scissorTest:!0,scissor:[l,h,p,g],clearColor:[0,0,0,0],depthMask:!0,depthTest:!0,depthRange:[0,1],colorMask:[!0,!0,!0,!0],...$L,blend:!M},()=>super.render({target:a,layers:e,layerFilter:t,views:r,viewports:i,onViewportActive:o,cullRect:_,effects:x==null?void 0:x.filter(ce=>ce.useInPicking),pass:C,isPicking:!0,moduleParameters:L}));return this._colorEncoderState=null,{decodePickingColor:z&&qX.bind(null,z),stats:te}}shouldDrawLayer(e){const{pickable:t,operation:r}=e.props;return t&&r.includes("draw")||r.includes("terrain")||r.includes("mask")}getModuleParameters(){return{pickingActive:1,pickingAttribute:this.pickZ,lightSources:{}}}getLayerParameters(e,t,r){const i={...e.props.parameters},{pickable:o,operation:a}=e.props;return this._colorEncoderState?o&&a.includes("draw")&&(Object.assign(i,$L),i.blend=!0,i.blendColor=GX(this._colorEncoderState,e,r)):i.blend=!1,a.includes("terrain")&&(i.blend=!1),i}_resetColorEncoder(e){return this._colorEncoderState=e?null:{byLayer:new Map,byAlpha:[]},this._colorEncoderState}}function GX(n,e,t){const{byLayer:r,byAlpha:i}=n;let o,a=r.get(e);return a?(a.viewports.push(t),o=a.a):(o=r.size+1,o<=255?(a={a:o,layer:e,viewports:[t]},r.set(e,a),i[o]=a):(Fr.warn("Too many pickable layers, only picking the first 255")(),o=0)),[0,0,0,o/255]}function qX(n,e){const t=n.byAlpha[e[3]];return t&&{pickedLayer:t.layer,pickedViewports:t.viewports,pickedObjectIndex:t.layer.decodePickingColor(e)}}const Dg={NO_STATE:"Awaiting state",MATCHED:"Matched. State transferred from previous layer",INITIALIZED:"Initialized",AWAITING_GC:"Discarded. Awaiting garbage collection",AWAITING_FINALIZATION:"No longer matched. Awaiting garbage collection",FINALIZED:"Finalized! Awaiting garbage collection"},vx=Symbol.for("component"),Wh=Symbol.for("propTypes"),oC=Symbol.for("deprecatedProps"),mm=Symbol.for("asyncPropDefaults"),jf=Symbol.for("asyncPropOriginal"),jh=Symbol.for("asyncPropResolved");function pM(n,e=()=>!0){return Array.isArray(n)?N6(n,e,[]):e(n)?[n]:[]}function N6(n,e,t){let r=-1;for(;++r<n.length;){const i=n[r];Array.isArray(i)?N6(i,e,t):e(i)&&t.push(i)}return t}function $X({target:n,source:e,start:t=0,count:r=1}){const i=e.length,o=r*i;let a=0;for(let l=t;a<i;a++)n[l++]=e[a];for(;a<o;)a<o-a?(n.copyWithin(t+a,t,t+a),a*=2):(n.copyWithin(t+a,t,t+o-a),a=o);return n}class WX{constructor(e,t,r){Y(this,"id",void 0),Y(this,"context",void 0),Y(this,"isLoaded",void 0),Y(this,"persistent",void 0),Y(this,"_loadCount",0),Y(this,"_subscribers",new Set),Y(this,"_data",void 0),Y(this,"_loader",void 0),Y(this,"_error",void 0),Y(this,"_content",void 0),this.id=e,this.context=r,this.setData(t)}subscribe(e){this._subscribers.add(e)}unsubscribe(e){this._subscribers.delete(e)}inUse(){return this._subscribers.size>0}delete(){}getData(){return this.isLoaded?this._error?Promise.reject(this._error):this._content:this._loader.then(()=>this.getData())}setData(e,t){if(e===this._data&&!t)return;this._data=e;const r=++this._loadCount;let i=e;typeof e=="string"&&(i=ux(e)),i instanceof Promise?(this.isLoaded=!1,this._loader=i.then(o=>{this._loadCount===r&&(this.isLoaded=!0,this._error=void 0,this._content=o)}).catch(o=>{this._loadCount===r&&(this.isLoaded=!0,this._error=o||!0)})):(this.isLoaded=!0,this._error=void 0,this._content=e);for(const o of this._subscribers)o.onChange(this.getData())}}class YX{constructor({gl:e,protocol:t}){Y(this,"protocol",void 0),Y(this,"_context",void 0),Y(this,"_resources",void 0),Y(this,"_consumers",void 0),Y(this,"_pruneRequest",void 0),this.protocol=t||"resource://",this._context={gl:e,resourceManager:this},this._resources={},this._consumers={},this._pruneRequest=null}contains(e){return e.startsWith(this.protocol)?!0:e in this._resources}add({resourceId:e,data:t,forceUpdate:r=!1,persistent:i=!0}){let o=this._resources[e];o?o.setData(t,r):(o=new WX(e,t,this._context),this._resources[e]=o),o.persistent=i}remove(e){const t=this._resources[e];t&&(t.delete(),delete this._resources[e])}unsubscribe({consumerId:e}){const t=this._consumers[e];if(t){for(const r in t){const i=t[r],o=this._resources[i.resourceId];o&&o.unsubscribe(i)}delete this._consumers[e],this.prune()}}subscribe({resourceId:e,onChange:t,consumerId:r,requestId:i="default"}){const{_resources:o,protocol:a}=this;e.startsWith(a)&&(e=e.replace(a,""),o[e]||this.add({resourceId:e,data:null,persistent:!1}));const l=o[e];if(this._track(r,i,l,t),l)return l.getData()}prune(){this._pruneRequest||(this._pruneRequest=setTimeout(()=>this._prune(),0))}finalize(){for(const e in this._resources)this._resources[e].delete()}_track(e,t,r,i){const o=this._consumers,a=o[e]=o[e]||{},l=a[t]||{},h=l.resourceId&&this._resources[l.resourceId];h&&(h.unsubscribe(l),this.prune()),r&&(a[t]=l,l.onChange=i,l.resourceId=r.id,r.subscribe(l))}_prune(){this._pruneRequest=null;for(const e of Object.keys(this._resources)){const t=this._resources[e];!t.persistent&&!t.inUse()&&(t.delete(),delete this._resources[e])}}}const KX=`
vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset, out vec4 commonPosition
) {
  vec3 projectedPosition = project_position(position, position64Low);
  mat3 rotation;
  if (project_needs_rotation(projectedPosition, rotation)) {
    // offset is specified as ENU
    // when in globe projection, rotate offset so that the ground alighs with the surface of the globe
    offset = rotation * offset;
  }
  commonPosition = vec4(projectedPosition + offset, 1.0);
  return project_common_position_to_clipspace(commonPosition);
}

vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset
) {
  vec4 commonPosition;
  return project_position_to_clipspace(position, position64Low, offset, commonPosition);
}
`,fy={name:"project32",dependencies:[lM],vs:KX},py={inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    // for picking depth values
    picking_setPickingAttribute(position.z / position.w);
  `,"vs:DECKGL_FILTER_COLOR":`
  picking_setPickingColor(geometry.pickingColor);
  `,"fs:#decl":`
uniform bool picking_uAttribute;
  `,"fs:DECKGL_FILTER_COLOR":{order:99,injection:`
  // use highlight color if this fragment belongs to the selected object.
  color = picking_filterHighlightColor(color);

  // use picking color if rendering to picking FBO.
  color = picking_filterPickingColor(color);
    `}},...pZ},ZX=[lM],XX=["vs:DECKGL_FILTER_SIZE(inout vec3 size, VertexGeometry geometry)","vs:DECKGL_FILTER_GL_POSITION(inout vec4 position, VertexGeometry geometry)","vs:DECKGL_FILTER_COLOR(inout vec4 color, VertexGeometry geometry)","fs:DECKGL_FILTER_COLOR(inout vec4 color, FragmentGeometry geometry)"];function QX(n){const e=rb.getDefaultProgramManager(n);for(const t of ZX)e.addDefaultModule(t);for(const t of XX)e.addShaderHook(t);return e}const JX="layerManager.setLayers",eQ="layerManager.activateViewport";let tQ=class{constructor(e,{deck:t,stats:r,viewport:i,timeline:o}={}){Y(this,"layers",void 0),Y(this,"context",void 0),Y(this,"resourceManager",void 0),Y(this,"_lastRenderedLayers",[]),Y(this,"_needsRedraw",!1),Y(this,"_needsUpdate",!1),Y(this,"_nextLayers",null),Y(this,"_debug",!1),Y(this,"activateViewport",a=>{fa(eQ,this,a),a&&(this.context.viewport=a)}),this.layers=[],this.resourceManager=new YX({gl:e,protocol:"deck://"}),this.context={mousePosition:null,userData:{},layerManager:this,gl:e,deck:t,programManager:e&&QX(e),stats:r||new $P({id:"deck.gl"}),viewport:i||new dy({id:"DEFAULT-INITIAL-VIEWPORT"}),timeline:o||new b6,resourceManager:this.resourceManager,onError:void 0},Object.seal(this)}finalize(){this.resourceManager.finalize();for(const e of this.layers)this._finalizeLayer(e)}needsRedraw(e={clearRedrawFlags:!1}){let t=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);for(const r of this.layers){const i=r.getNeedsRedraw(e);t=t||i}return t}needsUpdate(){return this._nextLayers&&this._nextLayers!==this._lastRenderedLayers?"layers changed":this._needsUpdate}setNeedsRedraw(e){this._needsRedraw=this._needsRedraw||e}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e}getLayers({layerIds:e}={}){return e?this.layers.filter(t=>e.find(r=>t.id.indexOf(r)===0)):this.layers}setProps(e){"debug"in e&&(this._debug=e.debug),"userData"in e&&(this.context.userData=e.userData),"layers"in e&&(this._nextLayers=e.layers),"onError"in e&&(this.context.onError=e.onError)}setLayers(e,t){fa(JX,this,t,e),this._lastRenderedLayers=e;const r=pM(e,Boolean);for(const i of r)i.context=this.context;this._updateLayers(this.layers,r)}updateLayers(){const e=this.needsUpdate();e&&(this.setNeedsRedraw("updating layers: ".concat(e)),this.setLayers(this._nextLayers||this._lastRenderedLayers,e)),this._nextLayers=null}_handleError(e,t,r){r.raiseError(t,"".concat(e," of ").concat(r))}_updateLayers(e,t){const r={};for(const a of e)r[a.id]?Fr.warn("Multiple old layers with same id ".concat(a.id))():r[a.id]=a;const i=[];this._updateSublayersRecursively(t,r,i),this._finalizeOldLayers(r);let o=!1;for(const a of i)if(a.hasUniformTransition()){o="Uniform transition in ".concat(a);break}this._needsUpdate=o,this.layers=i}_updateSublayersRecursively(e,t,r){for(const i of e){i.context=this.context;const o=t[i.id];o===null&&Fr.warn("Multiple new layers with same id ".concat(i.id))(),t[i.id]=null;let a=null;try{this._debug&&o!==i&&i.validateProps(),o?(this._transferLayerState(o,i),this._updateLayer(i)):this._initializeLayer(i),r.push(i),a=i.isComposite?i.getSubLayers():null}catch(l){this._handleError("matching",l,i)}a&&this._updateSublayersRecursively(a,t,r)}}_finalizeOldLayers(e){for(const t in e){const r=e[t];r&&this._finalizeLayer(r)}}_initializeLayer(e){try{e._initialize(),e.lifecycle=Dg.INITIALIZED}catch(t){this._handleError("initialization",t,e)}}_transferLayerState(e,t){t._transferState(e),t.lifecycle=Dg.MATCHED,t!==e&&(e.lifecycle=Dg.AWAITING_GC)}_updateLayer(e){try{e._update()}catch(t){this._handleError("update",t,e)}}_finalizeLayer(e){this._needsRedraw=this._needsRedraw||"finalized ".concat(e),e.lifecycle=Dg.AWAITING_FINALIZATION;try{e._finalize(),e.lifecycle=Dg.FINALIZED}catch(t){this._handleError("finalization",t,e)}}};function ul(n,e,t){if(n===e)return!0;if(!t||!n||!e)return!1;if(Array.isArray(n)){if(!Array.isArray(e)||n.length!==e.length)return!1;for(let r=0;r<n.length;r++)if(!ul(n[r],e[r],t-1))return!1;return!0}if(Array.isArray(e))return!1;if(typeof n=="object"&&typeof e=="object"){const r=Object.keys(n),i=Object.keys(e);if(r.length!==i.length)return!1;for(const o of r)if(!e.hasOwnProperty(o)||!ul(n[o],e[o],t-1))return!1;return!0}return!1}class nQ{constructor(e){Y(this,"width",void 0),Y(this,"height",void 0),Y(this,"views",void 0),Y(this,"viewState",void 0),Y(this,"controllers",void 0),Y(this,"timeline",void 0),Y(this,"_viewports",void 0),Y(this,"_viewportMap",void 0),Y(this,"_isUpdating",void 0),Y(this,"_needsRedraw",void 0),Y(this,"_needsUpdate",void 0),Y(this,"_eventManager",void 0),Y(this,"_eventCallbacks",void 0),this.views=[],this.width=100,this.height=100,this.viewState={},this.controllers={},this.timeline=e.timeline,this._viewports=[],this._viewportMap={},this._isUpdating=!1,this._needsRedraw="First render",this._needsUpdate="Initialize",this._eventManager=e.eventManager,this._eventCallbacks={onViewStateChange:e.onViewStateChange,onInteractionStateChange:e.onInteractionStateChange},Object.seal(this),this.setProps(e)}finalize(){for(const e in this.controllers){const t=this.controllers[e];t&&t.finalize()}this.controllers={}}needsRedraw(e={clearRedrawFlags:!1}){const t=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),t}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e,this._needsRedraw=this._needsRedraw||e}updateViewStates(){for(const e in this.controllers){const t=this.controllers[e];t&&t.updateTransition()}}getViewports(e){return e?this._viewports.filter(t=>t.containsPixel(e)):this._viewports}getViews(){const e={};return this.views.forEach(t=>{e[t.id]=t}),e}getView(e){return this.views.find(t=>t.id===e)}getViewState(e){const t=typeof e=="string"?this.getView(e):e,r=t&&this.viewState[t.getViewStateId()]||this.viewState;return t?t.filterViewState(r):r}getViewport(e){return this._viewportMap[e]}unproject(e,t){const r=this.getViewports(),i={x:e[0],y:e[1]};for(let o=r.length-1;o>=0;--o){const a=r[o];if(a.containsPixel(i)){const l=e.slice();return l[0]-=a.x,l[1]-=a.y,a.unproject(l,t)}}return null}setProps(e){e.views&&this._setViews(e.views),e.viewState&&this._setViewState(e.viewState),("width"in e||"height"in e)&&this._setSize(e.width,e.height),this._isUpdating||this._update()}_update(){this._isUpdating=!0,this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._isUpdating=!1}_setSize(e,t){(e!==this.width||t!==this.height)&&(this.width=e,this.height=t,this.setNeedsUpdate("Size changed"))}_setViews(e){e=pM(e,Boolean),this._diffViews(e,this.views)&&this.setNeedsUpdate("views changed"),this.views=e}_setViewState(e){e?(!ul(e,this.viewState,3)&&this.setNeedsUpdate("viewState changed"),this.viewState=e):Fr.warn("missing `viewState` or `initialViewState`")()}_onViewStateChange(e,t){this._eventCallbacks.onViewStateChange&&this._eventCallbacks.onViewStateChange({...t,viewId:e})}_createController(e,t){const r=t.type;return new r({timeline:this.timeline,eventManager:this._eventManager,onViewStateChange:this._onViewStateChange.bind(this,t.id),onStateChange:this._eventCallbacks.onInteractionStateChange,makeViewport:o=>{var a;return(a=this.getView(e.id))===null||a===void 0?void 0:a.makeViewport({viewState:o,width:this.width,height:this.height})}})}_updateController(e,t,r,i){const o=e.controller;if(o&&r){const a={...t,...o,id:e.id,x:r.x,y:r.y,width:r.width,height:r.height};return(!i||i.constructor!==o.type)&&(i=this._createController(e,a)),i&&i.setProps(a),i}return null}_rebuildViewports(){const{views:e}=this,t=this.controllers;this._viewports=[],this.controllers={};let r=!1;for(let i=e.length;i--;){const o=e[i],a=this.getViewState(o),l=o.makeViewport({viewState:a,width:this.width,height:this.height});let h=t[o.id];const p=!!o.controller;p&&!h&&(r=!0),(r||!p)&&h&&(h.finalize(),h=null),this.controllers[o.id]=this._updateController(o,a,l,h),l&&this._viewports.unshift(l)}for(const i in t){const o=t[i];o&&!this.controllers[i]&&o.finalize()}this._buildViewportMap()}_buildViewportMap(){this._viewportMap={},this._viewports.forEach(e=>{e.id&&(this._viewportMap[e.id]=this._viewportMap[e.id]||e)})}_diffViews(e,t){return e.length!==t.length?!0:e.some((r,i)=>!e[i].equals(t[i]))}}const rQ=/([0-9]+\.?[0-9]*)(%|px)/;function hh(n){switch(typeof n){case"number":return{position:n,relative:!1};case"string":const e=rQ.exec(n);if(e&&e.length>=3){const t=e[2]==="%",r=parseFloat(e[1]);return{position:t?r/100:r,relative:t}}default:throw new Error("Could not parse position string ".concat(n))}}function dh(n,e){return n.relative?Math.round(n.position*e):n.position}function Yo(n,e){if(!n)throw new Error(e||"deck.gl: assertion failed.")}class iQ{constructor(e){Y(this,"id",void 0),Y(this,"viewportInstance",void 0),Y(this,"_x",void 0),Y(this,"_y",void 0),Y(this,"_width",void 0),Y(this,"_height",void 0),Y(this,"_padding",void 0),Y(this,"props",void 0);const{id:t,x:r=0,y:i=0,width:o="100%",height:a="100%",padding:l=null,viewportInstance:h}=e||{};Yo(!h||h instanceof dy),this.viewportInstance=h,this.id=t||this.constructor.displayName||"view",this.props={...e,id:this.id},this._x=hh(r),this._y=hh(i),this._width=hh(o),this._height=hh(a),this._padding=l&&{left:hh(l.left||0),right:hh(l.right||0),top:hh(l.top||0),bottom:hh(l.bottom||0)},this.equals=this.equals.bind(this),Object.seal(this)}equals(e){return this===e?!0:this.viewportInstance?e.viewportInstance?this.viewportInstance.equals(e.viewportInstance):!1:this.ViewportType===e.ViewportType&&ul(this.props,e.props,2)}makeViewport({width:e,height:t,viewState:r}){if(this.viewportInstance)return this.viewportInstance;r=this.filterViewState(r);const i=this.getDimensions({width:e,height:t});return!i.height||!i.width?null:new this.ViewportType({...r,...this.props,...i})}getViewStateId(){const{viewState:e}=this.props;return typeof e=="string"?e:(e==null?void 0:e.id)||this.id}filterViewState(e){if(this.props.viewState&&typeof this.props.viewState=="object"){if(!this.props.viewState.id)return this.props.viewState;const t={...e};for(const r in this.props.viewState)r!=="id"&&(t[r]=this.props.viewState[r]);return t}return e}getDimensions({width:e,height:t}){const r={x:dh(this._x,e),y:dh(this._y,t),width:dh(this._width,e),height:dh(this._height,t)};return this._padding&&(r.padding={left:dh(this._padding.left,e),top:dh(this._padding.top,t),right:dh(this._padding.right,e),bottom:dh(this._padding.bottom,t)}),r}get controller(){const e=this.props.controller;return e?e===!0?{type:this.ControllerType}:typeof e=="function"?{type:e}:{type:this.ControllerType,...e}:null}}class ob{constructor(e){Y(this,"_inProgress",void 0),Y(this,"_handle",void 0),Y(this,"_timeline",void 0),Y(this,"time",void 0),Y(this,"settings",void 0),this._inProgress=!1,this._handle=null,this._timeline=e,this.time=0,this.settings={duration:0}}get inProgress(){return this._inProgress}start(e){var t,r;this.cancel(),this.settings=e,this._inProgress=!0,(t=(r=this.settings).onStart)===null||t===void 0||t.call(r,this)}end(){if(this._inProgress){var e,t;this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1,(e=(t=this.settings).onEnd)===null||e===void 0||e.call(t,this)}}cancel(){if(this._inProgress){var e,t;(e=(t=this.settings).onInterrupt)===null||e===void 0||e.call(t,this),this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1}}update(){var e,t;if(!this._inProgress)return!1;if(this._handle===null){const{_timeline:r,settings:i}=this;this._handle=r.addChannel({delay:r.getTime(),duration:i.duration})}return this.time=this._timeline.getTime(this._handle),this._onUpdate(),(e=(t=this.settings).onUpdate)===null||e===void 0||e.call(t,this),this._timeline.isFinished(this._handle)&&this.end(),!0}_onUpdate(){}}const WL=()=>{},N2={BREAK:1,SNAP_TO_END:2,IGNORE:3},oQ=n=>n,aQ=N2.BREAK;class sQ{constructor(e){Y(this,"getControllerState",void 0),Y(this,"props",void 0),Y(this,"propsInTransition",void 0),Y(this,"transition",void 0),Y(this,"onViewStateChange",void 0),Y(this,"onStateChange",void 0),Y(this,"_onTransitionUpdate",t=>{const{time:r,settings:{interpolator:i,startProps:o,endProps:a,duration:l,easing:h}}=t,p=h(r/l),g=i.interpolateProps(o,a,p);this.propsInTransition=this.getControllerState({...this.props,...g}).getViewportProps(),this.onViewStateChange({viewState:this.propsInTransition,oldViewState:this.props})}),this.getControllerState=e.getControllerState,this.propsInTransition=null,this.transition=new ob(e.timeline),this.onViewStateChange=e.onViewStateChange||WL,this.onStateChange=e.onStateChange||WL}finalize(){this.transition.cancel()}getViewportInTransition(){return this.propsInTransition}processViewStateChange(e){let t=!1;const r=this.props;if(this.props=e,!r||this._shouldIgnoreViewportChange(r,e))return!1;if(this._isTransitionEnabled(e)){let i=r;if(this.transition.inProgress){const{interruption:o,endProps:a}=this.transition.settings;i={...r,...o===N2.SNAP_TO_END?a:this.propsInTransition||r}}this._triggerTransition(i,e),t=!0}else this.transition.cancel();return t}updateTransition(){this.transition.update()}_isTransitionEnabled(e){const{transitionDuration:t,transitionInterpolator:r}=e;return(t>0||t==="auto")&&!!r}_isUpdateDueToCurrentTransition(e){return this.transition.inProgress&&this.propsInTransition?this.transition.settings.interpolator.arePropsEqual(e,this.propsInTransition):!1}_shouldIgnoreViewportChange(e,t){return this.transition.inProgress?this.transition.settings.interruption===N2.IGNORE||this._isUpdateDueToCurrentTransition(t):this._isTransitionEnabled(t)?t.transitionInterpolator.arePropsEqual(e,t):!0}_triggerTransition(e,t){const r=this.getControllerState(e),i=this.getControllerState(t).shortestPathFrom(r),o=t.transitionInterpolator,a=o.getDuration?o.getDuration(e,t):t.transitionDuration;if(a===0)return;const l=o.initializeProps(e,i);this.propsInTransition={};const h={duration:a,easing:t.transitionEasing||oQ,interpolator:o,interruption:t.transitionInterruption||aQ,startProps:l.start,endProps:l.end,onStart:t.onTransitionStart,onUpdate:this._onTransitionUpdate,onInterrupt:this._onTransitionEnd(t.onTransitionInterrupt),onEnd:this._onTransitionEnd(t.onTransitionEnd)};this.transition.start(h),this.onStateChange({inTransition:!0}),this.updateTransition()}_onTransitionEnd(e){return t=>{this.propsInTransition=null,this.onStateChange({inTransition:!1,isZooming:!1,isPanning:!1,isRotating:!1}),e==null||e(t)}}}class cQ{constructor(e){Y(this,"_propsToCompare",void 0),Y(this,"_propsToExtract",void 0),Y(this,"_requiredProps",void 0);const{compare:t,extract:r,required:i}=e;this._propsToCompare=t,this._propsToExtract=r||t,this._requiredProps=i}arePropsEqual(e,t){for(const r of this._propsToCompare)if(!(r in e)||!(r in t)||!y0(e[r],t[r]))return!1;return!0}initializeProps(e,t){const r={},i={};for(const o of this._propsToExtract)(o in e||o in t)&&(r[o]=e[o],i[o]=t[o]);return this._checkRequiredProps(r),this._checkRequiredProps(i),{start:r,end:i}}getDuration(e,t){return t.transitionDuration}_checkRequiredProps(e){this._requiredProps&&this._requiredProps.forEach(t=>{const r=e[t];Yo(Number.isFinite(r)||Array.isArray(r),"".concat(t," is required for transition"))})}}const lQ=["longitude","latitude","zoom","bearing","pitch"],uQ=["longitude","latitude","zoom"];class D6 extends cQ{constructor(e={}){const t=Array.isArray(e)?e:e.transitionProps,r=Array.isArray(e)?{}:e;r.transitionProps=Array.isArray(t)?{compare:t,required:t}:t||{compare:lQ,required:uQ},super(r.transitionProps),Y(this,"opts",void 0),this.opts=r}initializeProps(e,t){const r=super.initializeProps(e,t),{makeViewport:i,around:o}=this.opts;if(i&&o){const a=i(e),l=i(t),h=a.unproject(o);r.start.around=o,Object.assign(r.end,{around:l.project(h),aroundPosition:h,width:t.width,height:t.height})}return r}interpolateProps(e,t,r){const i={};for(const o of this._propsToExtract)i[o]=fx(e[o]||0,t[o]||0,r);if(t.aroundPosition&&this.opts.makeViewport){const o=this.opts.makeViewport({...t,...i});Object.assign(i,o.panByPosition(t.aroundPosition,fx(e.around,t.around,r)))}return i}}const fh={transitionDuration:0},hQ=300,B1=n=>1-(1-n)*(1-n),yg={WHEEL:["wheel"],PAN:["panstart","panmove","panend"],PINCH:["pinchstart","pinchmove","pinchend"],TRIPLE_PAN:["tripanstart","tripanmove","tripanend"],DOUBLE_TAP:["doubletap"],KEYBOARD:["keydown"]},jd={};class dQ{constructor(e){Y(this,"props",void 0),Y(this,"state",{}),Y(this,"transitionManager",void 0),Y(this,"eventManager",void 0),Y(this,"onViewStateChange",void 0),Y(this,"onStateChange",void 0),Y(this,"makeViewport",void 0),Y(this,"_controllerState",void 0),Y(this,"_events",{}),Y(this,"_interactionState",{isDragging:!1}),Y(this,"_customEvents",[]),Y(this,"_eventStartBlocked",null),Y(this,"_panMove",!1),Y(this,"invertPan",!1),Y(this,"dragMode","rotate"),Y(this,"inertia",0),Y(this,"scrollZoom",!0),Y(this,"dragPan",!0),Y(this,"dragRotate",!0),Y(this,"doubleClickZoom",!0),Y(this,"touchZoom",!0),Y(this,"touchRotate",!1),Y(this,"keyboard",!0),this.transitionManager=new sQ({...e,getControllerState:t=>new this.ControllerState(t),onViewStateChange:this._onTransition.bind(this),onStateChange:this._setInteractionState.bind(this)}),this.handleEvent=this.handleEvent.bind(this),this.eventManager=e.eventManager,this.onViewStateChange=e.onViewStateChange||(()=>{}),this.onStateChange=e.onStateChange||(()=>{}),this.makeViewport=e.makeViewport}set events(e){this.toggleEvents(this._customEvents,!1),this.toggleEvents(e,!0),this._customEvents=e,this.props&&this.setProps(this.props)}finalize(){for(const t in this._events)if(this._events[t]){var e;(e=this.eventManager)===null||e===void 0||e.off(t,this.handleEvent)}this.transitionManager.finalize()}handleEvent(e){this._controllerState=void 0;const t=this._eventStartBlocked;switch(e.type){case"panstart":return t?!1:this._onPanStart(e);case"panmove":return this._onPan(e);case"panend":return this._onPanEnd(e);case"pinchstart":return t?!1:this._onPinchStart(e);case"pinchmove":return this._onPinch(e);case"pinchend":return this._onPinchEnd(e);case"tripanstart":return t?!1:this._onTriplePanStart(e);case"tripanmove":return this._onTriplePan(e);case"tripanend":return this._onTriplePanEnd(e);case"doubletap":return this._onDoubleTap(e);case"wheel":return this._onWheel(e);case"keydown":return this._onKeyDown(e);default:return!1}}get controllerState(){return this._controllerState=this._controllerState||new this.ControllerState({makeViewport:this.makeViewport,...this.props,...this.state}),this._controllerState}getCenter(e){const{x:t,y:r}=this.props,{offsetCenter:i}=e;return[i.x-t,i.y-r]}isPointInBounds(e,t){const{width:r,height:i}=this.props;if(t&&t.handled)return!1;const o=e[0]>=0&&e[0]<=r&&e[1]>=0&&e[1]<=i;return o&&t&&t.stopPropagation(),o}isFunctionKeyPressed(e){const{srcEvent:t}=e;return!!(t.metaKey||t.altKey||t.ctrlKey||t.shiftKey)}isDragging(){return this._interactionState.isDragging||!1}blockEvents(e){const t=setTimeout(()=>{this._eventStartBlocked===t&&(this._eventStartBlocked=null)},e);this._eventStartBlocked=t}setProps(e){e.dragMode&&(this.dragMode=e.dragMode),this.props=e,"transitionInterpolator"in e||(e.transitionInterpolator=this._getTransitionProps().transitionInterpolator),this.transitionManager.processViewStateChange(e);const{inertia:t}=e;this.inertia=Number.isFinite(t)?t:t===!0?hQ:0;const{scrollZoom:r=!0,dragPan:i=!0,dragRotate:o=!0,doubleClickZoom:a=!0,touchZoom:l=!0,touchRotate:h=!1,keyboard:p=!0}=e,g=!!this.onViewStateChange;this.toggleEvents(yg.WHEEL,g&&r),this.toggleEvents(yg.PAN,g),this.toggleEvents(yg.PINCH,g&&(l||h)),this.toggleEvents(yg.TRIPLE_PAN,g&&h),this.toggleEvents(yg.DOUBLE_TAP,g&&a),this.toggleEvents(yg.KEYBOARD,g&&p),this.scrollZoom=r,this.dragPan=i,this.dragRotate=o,this.doubleClickZoom=a,this.touchZoom=l,this.touchRotate=h,this.keyboard=p}updateTransition(){this.transitionManager.updateTransition()}toggleEvents(e,t){this.eventManager&&e.forEach(r=>{this._events[r]!==t&&(this._events[r]=t,t?this.eventManager.on(r,this.handleEvent):this.eventManager.off(r,this.handleEvent))})}updateViewport(e,t=null,r={}){const i={...e.getViewportProps(),...t},o=this.controllerState!==e;if(this.state=e.getState(),this._setInteractionState(r),o){const a=this.controllerState&&this.controllerState.getViewportProps();this.onViewStateChange&&this.onViewStateChange({viewState:i,interactionState:this._interactionState,oldViewState:a})}}_onTransition(e){this.onViewStateChange({...e,interactionState:this._interactionState})}_setInteractionState(e){Object.assign(this._interactionState,e),this.onStateChange(this._interactionState)}_onPanStart(e){const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;let r=this.isFunctionKeyPressed(e)||e.rightButton||!1;(this.invertPan||this.dragMode==="pan")&&(r=!r);const i=this.controllerState[r?"panStart":"rotateStart"]({pos:t});return this._panMove=r,this.updateViewport(i,fh,{isDragging:!0}),!0}_onPan(e){return this.isDragging()?this._panMove?this._onPanMove(e):this._onPanRotate(e):!1}_onPanEnd(e){return this.isDragging()?this._panMove?this._onPanMoveEnd(e):this._onPanRotateEnd(e):!1}_onPanMove(e){if(!this.dragPan)return!1;const t=this.getCenter(e),r=this.controllerState.pan({pos:t});return this.updateViewport(r,fh,{isDragging:!0,isPanning:!0}),!0}_onPanMoveEnd(e){const{inertia:t}=this;if(this.dragPan&&t&&e.velocity){const r=this.getCenter(e),i=[r[0]+e.velocityX*t/2,r[1]+e.velocityY*t/2],o=this.controllerState.pan({pos:i}).panEnd();this.updateViewport(o,{...this._getTransitionProps(),transitionDuration:t,transitionEasing:B1},{isDragging:!1,isPanning:!0})}else{const r=this.controllerState.panEnd();this.updateViewport(r,null,{isDragging:!1,isPanning:!1})}return!0}_onPanRotate(e){if(!this.dragRotate)return!1;const t=this.getCenter(e),r=this.controllerState.rotate({pos:t});return this.updateViewport(r,fh,{isDragging:!0,isRotating:!0}),!0}_onPanRotateEnd(e){const{inertia:t}=this;if(this.dragRotate&&t&&e.velocity){const r=this.getCenter(e),i=[r[0]+e.velocityX*t/2,r[1]+e.velocityY*t/2],o=this.controllerState.rotate({pos:i}).rotateEnd();this.updateViewport(o,{...this._getTransitionProps(),transitionDuration:t,transitionEasing:B1},{isDragging:!1,isRotating:!0})}else{const r=this.controllerState.rotateEnd();this.updateViewport(r,null,{isDragging:!1,isRotating:!1})}return!0}_onWheel(e){if(!this.scrollZoom)return!1;const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;e.srcEvent.preventDefault();const{speed:r=.01,smooth:i=!1}=this.scrollZoom===!0?{}:this.scrollZoom,{delta:o}=e;let a=2/(1+Math.exp(-Math.abs(o*r)));o<0&&a!==0&&(a=1/a);const l=this.controllerState.zoom({pos:t,scale:a});return this.updateViewport(l,{...this._getTransitionProps({around:t}),transitionDuration:i?250:1},{isZooming:!0,isPanning:!0}),!0}_onTriplePanStart(e){const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;const r=this.controllerState.rotateStart({pos:t});return this.updateViewport(r,fh,{isDragging:!0}),!0}_onTriplePan(e){if(!this.touchRotate||!this.isDragging())return!1;const t=this.getCenter(e);t[0]-=e.deltaX;const r=this.controllerState.rotate({pos:t});return this.updateViewport(r,fh,{isDragging:!0,isRotating:!0}),!0}_onTriplePanEnd(e){if(!this.isDragging())return!1;const{inertia:t}=this;if(this.touchRotate&&t&&e.velocityY){const r=this.getCenter(e),i=[r[0],r[1]+=e.velocityY*t/2],o=this.controllerState.rotate({pos:i});this.updateViewport(o,{...this._getTransitionProps(),transitionDuration:t,transitionEasing:B1},{isDragging:!1,isRotating:!0}),this.blockEvents(t)}else{const r=this.controllerState.rotateEnd();this.updateViewport(r,null,{isDragging:!1,isRotating:!1})}return!0}_onPinchStart(e){const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;const r=this.controllerState.zoomStart({pos:t}).rotateStart({pos:t});return jd._startPinchRotation=e.rotation,jd._lastPinchEvent=e,this.updateViewport(r,fh,{isDragging:!0}),!0}_onPinch(e){if(!this.touchZoom&&!this.touchRotate||!this.isDragging())return!1;let t=this.controllerState;if(this.touchZoom){const{scale:r}=e,i=this.getCenter(e);t=t.zoom({pos:i,scale:r})}if(this.touchRotate){const{rotation:r}=e;t=t.rotate({deltaAngleX:jd._startPinchRotation-r})}return this.updateViewport(t,fh,{isDragging:!0,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:this.touchRotate}),jd._lastPinchEvent=e,!0}_onPinchEnd(e){if(!this.isDragging())return!1;const{inertia:t}=this,{_lastPinchEvent:r}=jd;if(this.touchZoom&&t&&r&&e.scale!==r.scale){const i=this.getCenter(e);let o=this.controllerState.rotateEnd();const a=Math.log2(e.scale),l=(a-Math.log2(r.scale))/(e.deltaTime-r.deltaTime),h=Math.pow(2,a+l*t/2);o=o.zoom({pos:i,scale:h}).zoomEnd(),this.updateViewport(o,{...this._getTransitionProps({around:i}),transitionDuration:t,transitionEasing:B1},{isDragging:!1,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:!1}),this.blockEvents(t)}else{const i=this.controllerState.zoomEnd().rotateEnd();this.updateViewport(i,null,{isDragging:!1,isPanning:!1,isZooming:!1,isRotating:!1})}return jd._startPinchRotation=null,jd._lastPinchEvent=null,!0}_onDoubleTap(e){if(!this.doubleClickZoom)return!1;const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;const r=this.isFunctionKeyPressed(e),i=this.controllerState.zoom({pos:t,scale:r?.5:2});return this.updateViewport(i,this._getTransitionProps({around:t}),{isZooming:!0,isPanning:!0}),this.blockEvents(100),!0}_onKeyDown(e){if(!this.keyboard)return!1;const t=this.isFunctionKeyPressed(e),{zoomSpeed:r,moveSpeed:i,rotateSpeedX:o,rotateSpeedY:a}=this.keyboard===!0?{}:this.keyboard,{controllerState:l}=this;let h;const p={};switch(e.srcEvent.code){case"Minus":h=t?l.zoomOut(r).zoomOut(r):l.zoomOut(r),p.isZooming=!0;break;case"Equal":h=t?l.zoomIn(r).zoomIn(r):l.zoomIn(r),p.isZooming=!0;break;case"ArrowLeft":t?(h=l.rotateLeft(o),p.isRotating=!0):(h=l.moveLeft(i),p.isPanning=!0);break;case"ArrowRight":t?(h=l.rotateRight(o),p.isRotating=!0):(h=l.moveRight(i),p.isPanning=!0);break;case"ArrowUp":t?(h=l.rotateUp(a),p.isRotating=!0):(h=l.moveUp(i),p.isPanning=!0);break;case"ArrowDown":t?(h=l.rotateDown(a),p.isRotating=!0):(h=l.moveDown(i),p.isPanning=!0);break;default:return!1}return this.updateViewport(h,this._getTransitionProps(),p),!0}_getTransitionProps(e){const{transition:t}=this;return!t||!t.transitionInterpolator?fh:e?{...t,transitionInterpolator:new D6({...e,...t.transitionInterpolator.opts,makeViewport:this.controllerState.makeViewport})}:t}}class fQ{constructor(e,t){Y(this,"_viewportProps",void 0),Y(this,"_state",void 0),this._viewportProps=this.applyConstraints(e),this._state=t}getViewportProps(){return this._viewportProps}getState(){return this._state}}const YL=5,pQ=1.2;class gQ extends fQ{constructor(e){const{width:t,height:r,latitude:i,longitude:o,zoom:a,bearing:l=0,pitch:h=0,altitude:p=1.5,position:g=[0,0,0],maxZoom:_=20,minZoom:x=0,maxPitch:C=60,minPitch:M=0,startPanLngLat:L,startZoomLngLat:D,startRotatePos:z,startBearing:te,startPitch:le,startZoom:ce,normalize:_e=!0}=e;Yo(Number.isFinite(o)),Yo(Number.isFinite(i)),Yo(Number.isFinite(a)),super({width:t,height:r,latitude:i,longitude:o,zoom:a,bearing:l,pitch:h,altitude:p,maxZoom:_,minZoom:x,maxPitch:C,minPitch:M,normalize:_e,position:g},{startPanLngLat:L,startZoomLngLat:D,startRotatePos:z,startBearing:te,startPitch:le,startZoom:ce}),Y(this,"makeViewport",void 0),this.makeViewport=e.makeViewport}panStart({pos:e}){return this._getUpdatedState({startPanLngLat:this._unproject(e)})}pan({pos:e,startPos:t}){const r=this.getState().startPanLngLat||this._unproject(t);if(!r)return this;const o=this.makeViewport(this.getViewportProps()).panByPosition(r,e);return this._getUpdatedState(o)}panEnd(){return this._getUpdatedState({startPanLngLat:null})}rotateStart({pos:e}){return this._getUpdatedState({startRotatePos:e,startBearing:this.getViewportProps().bearing,startPitch:this.getViewportProps().pitch})}rotate({pos:e,deltaAngleX:t=0,deltaAngleY:r=0}){const{startRotatePos:i,startBearing:o,startPitch:a}=this.getState();if(!i||o===void 0||a===void 0)return this;let l;return e?l=this._getNewRotation(e,i,a,o):l={bearing:o+t,pitch:a+r},this._getUpdatedState(l)}rotateEnd(){return this._getUpdatedState({startBearing:null,startPitch:null})}zoomStart({pos:e}){return this._getUpdatedState({startZoomLngLat:this._unproject(e),startZoom:this.getViewportProps().zoom})}zoom({pos:e,startPos:t,scale:r}){let{startZoom:i,startZoomLngLat:o}=this.getState();if(o||(i=this.getViewportProps().zoom,o=this._unproject(t)||this._unproject(e)),!o)return this;const{maxZoom:a,minZoom:l}=this.getViewportProps();let h=i+Math.log2(r);h=Uh(h,l,a);const p=this.makeViewport({...this.getViewportProps(),zoom:h});return this._getUpdatedState({zoom:h,...p.panByPosition(o,e)})}zoomEnd(){return this._getUpdatedState({startZoomLngLat:null,startZoom:null})}zoomIn(e=2){return this._zoomFromCenter(e)}zoomOut(e=2){return this._zoomFromCenter(1/e)}moveLeft(e=100){return this._panFromCenter([e,0])}moveRight(e=100){return this._panFromCenter([-e,0])}moveUp(e=100){return this._panFromCenter([0,e])}moveDown(e=100){return this._panFromCenter([0,-e])}rotateLeft(e=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing-e})}rotateRight(e=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing+e})}rotateUp(e=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch+e})}rotateDown(e=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch-e})}shortestPathFrom(e){const t=e.getViewportProps(),r={...this.getViewportProps()},{bearing:i,longitude:o}=r;return Math.abs(i-t.bearing)>180&&(r.bearing=i<0?i+360:i-360),Math.abs(o-t.longitude)>180&&(r.longitude=o<0?o+360:o-360),r}applyConstraints(e){const{maxZoom:t,minZoom:r,zoom:i}=e;e.zoom=Uh(i,r,t);const{maxPitch:o,minPitch:a,pitch:l}=e;e.pitch=Uh(l,a,o);const{normalize:h=!0}=e;return h&&Object.assign(e,bX(e)),e}_zoomFromCenter(e){const{width:t,height:r}=this.getViewportProps();return this.zoom({pos:[t/2,r/2],scale:e})}_panFromCenter(e){const{width:t,height:r}=this.getViewportProps();return this.pan({startPos:[t/2,r/2],pos:[t/2+e[0],r/2+e[1]]})}_getUpdatedState(e){return new this.constructor({makeViewport:this.makeViewport,...this.getViewportProps(),...this.getState(),...e})}_unproject(e){const t=this.makeViewport(this.getViewportProps());return e&&t.unproject(e)}_getNewRotation(e,t,r,i){const o=e[0]-t[0],a=e[1]-t[1],l=e[1],h=t[1],{width:p,height:g}=this.getViewportProps(),_=o/p;let x=0;a>0?Math.abs(g-h)>YL&&(x=a/(h-g)*pQ):a<0&&h>YL&&(x=1-l/h),x=Uh(x,-1,1);const{minPitch:C,maxPitch:M}=this.getViewportProps(),L=i+180*_;let D=r;return x>0?D=r+x*(M-r):x<0&&(D=r-x*(C-r)),{pitch:D,bearing:L}}}class mQ extends dQ{constructor(...e){super(...e),Y(this,"ControllerState",gQ),Y(this,"transition",{transitionDuration:300,transitionInterpolator:new D6({transitionProps:{compare:["longitude","latitude","zoom","bearing","pitch","position"],required:["longitude","latitude","zoom"]}})}),Y(this,"dragMode","pan")}setProps(e){e.position=e.position||[0,0,0];const t=this.props;super.setProps(e),(!t||t.height!==e.height)&&this.updateViewport(new this.ControllerState({makeViewport:this.makeViewport,...e,...this.state}))}}class F6 extends iQ{get ViewportType(){return Wm}get ControllerType(){return mQ}}Y(F6,"displayName","MapView");const yQ=new k6;function _Q(n,e){var t,r;const i=(t=n.order)!==null&&t!==void 0?t:1/0,o=(r=e.order)!==null&&r!==void 0?r:1/0;return i-o}class vQ{constructor(){Y(this,"effects",void 0),Y(this,"_resolvedEffects",[]),Y(this,"_defaultEffects",[]),Y(this,"_needsRedraw",void 0),this.effects=[],this._needsRedraw="Initial render",this._setEffects([])}addDefaultEffect(e){const t=this._defaultEffects;if(!t.find(r=>r.id===e.id)){const r=t.findIndex(i=>_Q(i,e)>0);r<0?t.push(e):t.splice(r,0,e),this._setEffects(this.effects)}}setProps(e){"effects"in e&&(ul(e.effects,this.effects,1)||this._setEffects(e.effects))}needsRedraw(e={clearRedrawFlags:!1}){const t=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),t}getEffects(){return this._resolvedEffects}_setEffects(e){const t={};for(const i of this.effects)t[i.id]=i;const r=[];for(const i of e){const o=t[i.id];o&&o!==i?o.setProps?(o.setProps(i.props),r.push(o)):(o.cleanup(),r.push(i)):r.push(i),delete t[i.id]}for(const i in t)t[i].cleanup();this.effects=r,this._resolvedEffects=r.concat(this._defaultEffects),e.some(i=>i instanceof k6)||this._resolvedEffects.push(yQ),this._needsRedraw="effects changed"}finalize(){for(const e of this._resolvedEffects)e.cleanup();this.effects.length=0,this._resolvedEffects.length=0,this._defaultEffects.length=0}}class bQ extends cM{shouldDrawLayer(e){const{operation:t}=e.props;return t.includes("draw")||t.includes("terrain")}}const wQ="deckRenderer.renderLayers";class xQ{constructor(e){Y(this,"gl",void 0),Y(this,"layerFilter",void 0),Y(this,"drawPickingColors",void 0),Y(this,"drawLayersPass",void 0),Y(this,"pickLayersPass",void 0),Y(this,"renderCount",void 0),Y(this,"_needsRedraw",void 0),Y(this,"renderBuffers",void 0),Y(this,"lastPostProcessEffect",void 0),this.gl=e,this.layerFilter=null,this.drawPickingColors=!1,this.drawLayersPass=new bQ(e),this.pickLayersPass=new L6(e),this.renderCount=0,this._needsRedraw="Initial render",this.renderBuffers=[],this.lastPostProcessEffect=null}setProps(e){this.layerFilter!==e.layerFilter&&(this.layerFilter=e.layerFilter,this._needsRedraw="layerFilter changed"),this.drawPickingColors!==e.drawPickingColors&&(this.drawPickingColors=e.drawPickingColors,this._needsRedraw="drawPickingColors changed")}renderLayers(e){if(!e.viewports.length)return;const t=this.drawPickingColors?this.pickLayersPass:this.drawLayersPass,r={layerFilter:this.layerFilter,isPicking:this.drawPickingColors,...e,target:e.target||Co.getDefaultFramebuffer(this.gl)};r.effects&&this._preRender(r.effects,r);const i=this.lastPostProcessEffect?this.renderBuffers[0]:r.target,o=t.render({...r,target:i});r.effects&&this._postRender(r.effects,r),this.renderCount++,fa(wQ,this,o,e)}needsRedraw(e={clearRedrawFlags:!1}){const t=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),t}finalize(){const{renderBuffers:e}=this;for(const t of e)t.delete();e.length=0}_preRender(e,t){this.lastPostProcessEffect=null,t.preRenderStats=t.preRenderStats||{};for(const r of e)t.preRenderStats[r.id]=r.preRender(this.gl,t),r.postRender&&(this.lastPostProcessEffect=r.id);this.lastPostProcessEffect&&this._resizeRenderBuffers()}_resizeRenderBuffers(){const{renderBuffers:e}=this;e.length===0&&e.push(new Co(this.gl),new Co(this.gl));for(const t of e)t.resize()}_postRender(e,t){const{renderBuffers:r}=this,i={...t,inputBuffer:r[0],swapBuffer:r[1],target:null};for(const o of e)if(o.postRender){if(o.id===this.lastPostProcessEffect){i.target=t.target,o.postRender(this.gl,i);break}const a=o.postRender(this.gl,i);i.inputBuffer=a,i.swapBuffer=a===r[0]?r[1]:r[0]}}}const EQ={pickedColor:null,pickedObjectIndex:-1};function TQ({pickedColors:n,decodePickingColor:e,deviceX:t,deviceY:r,deviceRadius:i,deviceRect:o}){const{x:a,y:l,width:h,height:p}=o;let g=i*i,_=-1,x=0;for(let C=0;C<p;C++){const M=C+l-r,L=M*M;if(L>g)x+=4*h;else for(let D=0;D<h;D++){if(n[x+3]-1>=0){const te=D+a-t,le=te*te+L;le<=g&&(g=le,_=x)}x+=4}}if(_>=0){const C=n.slice(_,_+4),M=e(C);if(M){const L=Math.floor(_/4/h),D=_/4-L*h;return{...M,pickedColor:C,pickedX:a+D,pickedY:l+L}}Fr.error("Picked non-existent layer. Is picking buffer corrupt?")()}return EQ}function SQ({pickedColors:n,decodePickingColor:e}){const t=new Map;if(n){for(let r=0;r<n.length;r+=4)if(n[r+3]-1>=0){const o=n.slice(r,r+4),a=o.join(",");if(!t.has(a)){const l=e(o);l?t.set(a,{...l,color:o}):Fr.error("Picked non-existent layer. Is picking buffer corrupt?")()}}}return Array.from(t.values())}function B6({pickInfo:n,viewports:e,pixelRatio:t,x:r,y:i,z:o}){let a=e[0];e.length>1&&(a=AQ((n==null?void 0:n.pickedViewports)||e,{x:r,y:i}));let l;if(a){const h=[r-a.x,i-a.y];o!==void 0&&(h[2]=o),l=a.unproject(h)}return{color:null,layer:null,viewport:a,index:-1,picked:!1,x:r,y:i,pixel:[r,i],coordinate:l,devicePixel:n&&"pickedX"in n?[n.pickedX,n.pickedY]:void 0,pixelRatio:t}}function CQ(n){const{pickInfo:e,lastPickedInfo:t,mode:r,layers:i}=n,{pickedColor:o,pickedLayer:a,pickedObjectIndex:l}=e,h=a?[a]:[];if(r==="hover"){const _=t.index,x=t.layerId,C=a?a.props.id:null;if(C!==x||l!==_){if(C!==x){const M=i.find(L=>L.props.id===x);M&&h.unshift(M)}t.layerId=C,t.index=l,t.info=null}}const p=B6(n),g=new Map;return g.set(null,p),h.forEach(_=>{let x={...p};_===a&&(x.color=o,x.index=l,x.picked=!0),x=U6({layer:_,info:x,mode:r});const C=x.layer;_===a&&r==="hover"&&(t.info=x),g.set(C.id,x),r==="hover"&&C.updateAutoHighlight(x)}),g}function U6({layer:n,info:e,mode:t}){for(;n&&e;){const r=e.layer||null;e.sourceLayer=r,e.layer=n,e=n.getPickingInfo({info:e,mode:t,sourceLayer:r}),n=n.parent}return e}function AQ(n,e){for(let t=n.length-1;t>=0;t--){const r=n[t];if(r.containsPixel(e))return r}return n[0]}class IQ{constructor(e){Y(this,"gl",void 0),Y(this,"pickingFBO",void 0),Y(this,"depthFBO",void 0),Y(this,"pickLayersPass",void 0),Y(this,"layerFilter",void 0),Y(this,"lastPickedInfo",void 0),Y(this,"_pickable",!0),this.gl=e,this.pickLayersPass=new L6(e),this.lastPickedInfo={index:-1,layerId:null,info:null}}setProps(e){"layerFilter"in e&&(this.layerFilter=e.layerFilter),"_pickable"in e&&(this._pickable=e._pickable)}finalize(){this.pickingFBO&&this.pickingFBO.delete(),this.depthFBO&&(this.depthFBO.color.delete(),this.depthFBO.delete())}pickObject(e){return this._pickClosestObject(e)}pickObjects(e){return this._pickVisibleObjects(e)}getLastPickedObject({x:e,y:t,layers:r,viewports:i},o=this.lastPickedInfo.info){const a=o&&o.layer&&o.layer.id,l=o&&o.viewport&&o.viewport.id,h=a?r.find(x=>x.id===a):null,p=l&&i.find(x=>x.id===l)||i[0],g=p&&p.unproject([e-p.x,t-p.y]);return{...o,...{x:e,y:t,viewport:p,coordinate:g,layer:h}}}_resizeBuffer(){var e,t;const{gl:r}=this;if(!this.pickingFBO&&(this.pickingFBO=new Co(r),Co.isSupported(r,{colorBufferFloat:!0}))){const i=new Co(r);i.attach({36064:new Bs(r,{format:vr(r)?34836:6408,type:5126})}),this.depthFBO=i}(e=this.pickingFBO)===null||e===void 0||e.resize({width:r.canvas.width,height:r.canvas.height}),(t=this.depthFBO)===null||t===void 0||t.resize({width:r.canvas.width,height:r.canvas.height})}_getPickable(e){if(this._pickable===!1)return null;const t=e.filter(r=>this.pickLayersPass.shouldDrawLayer(r)&&!r.isComposite);return t.length?t:null}_pickClosestObject({layers:e,views:t,viewports:r,x:i,y:o,radius:a=0,depth:l=1,mode:h="query",unproject3D:p,onViewportActive:g,effects:_}){const x=this._getPickable(e),C=zm(this.gl);if(!x)return{result:[],emptyInfo:B6({viewports:r,x:i,y:o,pixelRatio:C})};this._resizeBuffer();const M=VS(this.gl,[i,o],!0),L=[M.x+Math.floor(M.width/2),M.y+Math.floor(M.height/2)],D=Math.round(a*C),{width:z,height:te}=this.pickingFBO,le=this._getPickingRect({deviceX:L[0],deviceY:L[1],deviceRadius:D,deviceWidth:z,deviceHeight:te}),ce={x:i-a,y:o-a,width:a*2+1,height:a*2+1};let _e;const J=[],pe=new Set;for(let ue=0;ue<l;ue++){let xe;if(le){const ne=this._drawAndSample({layers:x,views:t,viewports:r,onViewportActive:g,deviceRect:le,cullRect:ce,effects:_,pass:"picking:".concat(h)});xe=TQ({...ne,deviceX:L[0],deviceY:L[1],deviceRadius:D,deviceRect:le})}else xe={pickedColor:null,pickedObjectIndex:-1};let je;if(xe.pickedLayer&&p&&this.depthFBO){const{pickedColors:ne}=this._drawAndSample({layers:[xe.pickedLayer],views:t,viewports:r,onViewportActive:g,deviceRect:{x:xe.pickedX,y:xe.pickedY,width:1,height:1},cullRect:ce,effects:_,pass:"picking:".concat(h,":z")},!0);ne[3]&&(je=ne[0])}xe.pickedLayer&&ue+1<l&&(pe.add(xe.pickedLayer),xe.pickedLayer.disablePickingIndex(xe.pickedObjectIndex)),_e=CQ({pickInfo:xe,lastPickedInfo:this.lastPickedInfo,mode:h,layers:x,viewports:r,x:i,y:o,z:je,pixelRatio:C});for(const ne of _e.values())ne.layer&&J.push(ne);if(!xe.pickedColor)break}for(const ue of pe)ue.restorePickingColors();return{result:J,emptyInfo:_e.get(null)}}_pickVisibleObjects({layers:e,views:t,viewports:r,x:i,y:o,width:a=1,height:l=1,mode:h="query",maxObjects:p=null,onViewportActive:g,effects:_}){const x=this._getPickable(e);if(!x)return[];this._resizeBuffer();const C=zm(this.gl),M=VS(this.gl,[i,o],!0),L=M.x,D=M.y+M.height,z=VS(this.gl,[i+a,o+l],!0),te=z.x+z.width,le=z.y,ce={x:L,y:le,width:te-L,height:D-le},_e=this._drawAndSample({layers:x,views:t,viewports:r,onViewportActive:g,deviceRect:ce,cullRect:{x:i,y:o,width:a,height:l},effects:_,pass:"picking:".concat(h)}),J=SQ(_e),pe=new Map,ue=Number.isFinite(p);for(let je=0;je<J.length;je++){var xe;if(ue&&p&&pe.size>=p)break;const ne=J[je];let Ee={color:ne.pickedColor,layer:null,index:ne.pickedObjectIndex,picked:!0,x:i,y:o,pixelRatio:C};Ee=U6({layer:ne.pickedLayer,info:Ee,mode:h});const ke=(xe=Ee.object)!==null&&xe!==void 0?xe:"".concat(Ee.layer.id,"[").concat(Ee.index,"]");pe.has(ke)||pe.set(ke,Ee)}return Array.from(pe.values())}_drawAndSample({layers:e,views:t,viewports:r,onViewportActive:i,deviceRect:o,cullRect:a,effects:l,pass:h},p=!1){const g=p?this.depthFBO:this.pickingFBO,_={layers:e,layerFilter:this.layerFilter,views:t,viewports:r,onViewportActive:i,pickingFBO:g,deviceRect:o,cullRect:a,effects:l,pass:h,pickZ:p,preRenderStats:{}};for(const te of l)te.useInPicking&&(_.preRenderStats[te.id]=te.preRender(this.gl,_));const{decodePickingColor:x}=this.pickLayersPass.render(_),{x:C,y:M,width:L,height:D}=o,z=new(p?Float32Array:Uint8Array)(L*D*4);return QE(g,{sourceX:C,sourceY:M,sourceWidth:L,sourceHeight:D,target:z}),{pickedColors:z,decodePickingColor:x}}_getPickingRect({deviceX:e,deviceY:t,deviceRadius:r,deviceWidth:i,deviceHeight:o}){const a=Math.max(0,e-r),l=Math.max(0,t-r),h=Math.min(i,e+r+1)-a,p=Math.min(o,t+r+1)-l;return h<=0||p<=0?null:{x:a,y:l,width:h,height:p}}}const PQ={zIndex:"1",position:"absolute",pointerEvents:"none",color:"#a0a7b4",backgroundColor:"#29323c",padding:"10px",top:"0",left:"0",display:"none"};class MQ{constructor(e){Y(this,"el",null),Y(this,"isVisible",!1);const t=e.parentElement;t&&(this.el=document.createElement("div"),this.el.className="deck-tooltip",Object.assign(this.el.style,PQ),t.appendChild(this.el))}setTooltip(e,t,r){const i=this.el;if(i){if(typeof e=="string")i.innerText=e;else if(e)e.text&&(i.innerText=e.text),e.html&&(i.innerHTML=e.html),e.className&&(i.className=e.className);else{this.isVisible=!1,i.style.display="none";return}this.isVisible=!0,i.style.display="block",i.style.transform="translate(".concat(t,"px, ").concat(r,"px)"),e&&typeof e=="object"&&"style"in e&&Object.assign(i.style,e.style)}}remove(){this.el&&(this.el.remove(),this.el=null)}}var ip=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function RQ(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}function kQ(n){if(n.__esModule)return n;var e=n.default;if(typeof e=="function"){var t=function r(){return this instanceof r?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(n).forEach(function(r){var i=Object.getOwnPropertyDescriptor(n,r);Object.defineProperty(t,r,i.get?i:{enumerable:!0,get:function(){return n[r]}})}),t}var z6={exports:{}};/*! Hammer.JS - v2.0.7 - 2016-04-22
 * http://hammerjs.github.io/
 *
 * Copyright (c) 2016 Jorik Tangelder;
 * Licensed under the MIT license */(function(n){(function(e,t,r,i){var o=["","webkit","Moz","MS","ms","o"],a=t.createElement("div"),l="function",h=Math.round,p=Math.abs,g=Date.now;function _(ee,se,Se){return setTimeout(le(ee,Se),se)}function x(ee,se,Se){return Array.isArray(ee)?(C(ee,Se[se],Se),!0):!1}function C(ee,se,Se){var qe;if(ee)if(ee.forEach)ee.forEach(se,Se);else if(ee.length!==i)for(qe=0;qe<ee.length;)se.call(Se,ee[qe],qe,ee),qe++;else for(qe in ee)ee.hasOwnProperty(qe)&&se.call(Se,ee[qe],qe,ee)}function M(ee,se,Se){var qe="DEPRECATED METHOD: "+se+`
`+Se+` AT 
`;return function(){var yt=new Error("get-stack-trace"),Qt=yt&&yt.stack?yt.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",Zn=e.console&&(e.console.warn||e.console.log);return Zn&&Zn.call(e.console,qe,Qt),ee.apply(this,arguments)}}var L;typeof Object.assign!="function"?L=function(se){if(se===i||se===null)throw new TypeError("Cannot convert undefined or null to object");for(var Se=Object(se),qe=1;qe<arguments.length;qe++){var yt=arguments[qe];if(yt!==i&&yt!==null)for(var Qt in yt)yt.hasOwnProperty(Qt)&&(Se[Qt]=yt[Qt])}return Se}:L=Object.assign;var D=M(function(se,Se,qe){for(var yt=Object.keys(Se),Qt=0;Qt<yt.length;)(!qe||qe&&se[yt[Qt]]===i)&&(se[yt[Qt]]=Se[yt[Qt]]),Qt++;return se},"extend","Use `assign`."),z=M(function(se,Se){return D(se,Se,!0)},"merge","Use `assign`.");function te(ee,se,Se){var qe=se.prototype,yt;yt=ee.prototype=Object.create(qe),yt.constructor=ee,yt._super=qe,Se&&L(yt,Se)}function le(ee,se){return function(){return ee.apply(se,arguments)}}function ce(ee,se){return typeof ee==l?ee.apply(se&&se[0]||i,se):ee}function _e(ee,se){return ee===i?se:ee}function J(ee,se,Se){C(je(se),function(qe){ee.addEventListener(qe,Se,!1)})}function pe(ee,se,Se){C(je(se),function(qe){ee.removeEventListener(qe,Se,!1)})}function ue(ee,se){for(;ee;){if(ee==se)return!0;ee=ee.parentNode}return!1}function xe(ee,se){return ee.indexOf(se)>-1}function je(ee){return ee.trim().split(/\s+/g)}function ne(ee,se,Se){if(ee.indexOf&&!Se)return ee.indexOf(se);for(var qe=0;qe<ee.length;){if(Se&&ee[qe][Se]==se||!Se&&ee[qe]===se)return qe;qe++}return-1}function Ee(ee){return Array.prototype.slice.call(ee,0)}function ke(ee,se,Se){for(var qe=[],yt=[],Qt=0;Qt<ee.length;){var Zn=se?ee[Qt][se]:ee[Qt];ne(yt,Zn)<0&&qe.push(ee[Qt]),yt[Qt]=Zn,Qt++}return Se&&(se?qe=qe.sort(function(Vi,lo){return Vi[se]>lo[se]}):qe=qe.sort()),qe}function Be(ee,se){for(var Se,qe,yt=se[0].toUpperCase()+se.slice(1),Qt=0;Qt<o.length;){if(Se=o[Qt],qe=Se?Se+yt:se,qe in ee)return qe;Qt++}return i}var Ze=1;function at(){return Ze++}function Re(ee){var se=ee.ownerDocument||ee;return se.defaultView||se.parentWindow||e}var ht=/mobile|tablet|ip(ad|hone|od)|android/i,Rt="ontouchstart"in e,hn=Be(e,"PointerEvent")!==i,wt=Rt&&ht.test(navigator.userAgent),Ge="touch",Gn="pen",Xt="mouse",ln="kinect",Mn=25,Ot=1,En=2,lt=4,It=8,he=1,B=2,H=4,F=8,Q=16,ae=B|H,q=F|Q,Ae=ae|q,Pe=["x","y"],We=["clientX","clientY"];function rt(ee,se){var Se=this;this.manager=ee,this.callback=se,this.element=ee.element,this.target=ee.options.inputTarget,this.domHandler=function(qe){ce(ee.options.enable,[ee])&&Se.handler(qe)},this.init()}rt.prototype={handler:function(){},init:function(){this.evEl&&J(this.element,this.evEl,this.domHandler),this.evTarget&&J(this.target,this.evTarget,this.domHandler),this.evWin&&J(Re(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&pe(this.element,this.evEl,this.domHandler),this.evTarget&&pe(this.target,this.evTarget,this.domHandler),this.evWin&&pe(Re(this.element),this.evWin,this.domHandler)}};function Et(ee){var se,Se=ee.options.inputClass;return Se?se=Se:hn?se=$:wt?se=ot:Rt?se=en:se=Lr,new se(ee,Bt)}function Bt(ee,se,Se){var qe=Se.pointers.length,yt=Se.changedPointers.length,Qt=se&Ot&&qe-yt===0,Zn=se&(lt|It)&&qe-yt===0;Se.isFirst=!!Qt,Se.isFinal=!!Zn,Qt&&(ee.session={}),Se.eventType=se,Lt(ee,Se),ee.emit("hammer.input",Se),ee.recognize(Se),ee.session.prevInput=Se}function Lt(ee,se){var Se=ee.session,qe=se.pointers,yt=qe.length;Se.firstInput||(Se.firstInput=Te(se)),yt>1&&!Se.firstMultiple?Se.firstMultiple=Te(se):yt===1&&(Se.firstMultiple=!1);var Qt=Se.firstInput,Zn=Se.firstMultiple,Ti=Zn?Zn.center:Qt.center,Vi=se.center=At(qe);se.timeStamp=g(),se.deltaTime=se.timeStamp-Qt.timeStamp,se.angle=Ke(Ti,Vi),se.distance=dn(Ti,Vi),an(Se,se),se.offsetDirection=qt(se.deltaX,se.deltaY);var lo=xt(se.deltaTime,se.deltaX,se.deltaY);se.overallVelocityX=lo.x,se.overallVelocityY=lo.y,se.overallVelocity=p(lo.x)>p(lo.y)?lo.x:lo.y,se.scale=Zn?Tt(Zn.pointers,qe):1,se.rotation=Zn?gt(Zn.pointers,qe):0,se.maxPointers=Se.prevInput?se.pointers.length>Se.prevInput.maxPointers?se.pointers.length:Se.prevInput.maxPointers:se.pointers.length,Ie(Se,se);var wa=ee.element;ue(se.srcEvent.target,wa)&&(wa=se.srcEvent.target),se.target=wa}function an(ee,se){var Se=se.center,qe=ee.offsetDelta||{},yt=ee.prevDelta||{},Qt=ee.prevInput||{};(se.eventType===Ot||Qt.eventType===lt)&&(yt=ee.prevDelta={x:Qt.deltaX||0,y:Qt.deltaY||0},qe=ee.offsetDelta={x:Se.x,y:Se.y}),se.deltaX=yt.x+(Se.x-qe.x),se.deltaY=yt.y+(Se.y-qe.y)}function Ie(ee,se){var Se=ee.lastInterval||se,qe=se.timeStamp-Se.timeStamp,yt,Qt,Zn,Ti;if(se.eventType!=It&&(qe>Mn||Se.velocity===i)){var Vi=se.deltaX-Se.deltaX,lo=se.deltaY-Se.deltaY,wa=xt(qe,Vi,lo);Qt=wa.x,Zn=wa.y,yt=p(wa.x)>p(wa.y)?wa.x:wa.y,Ti=qt(Vi,lo),ee.lastInterval=se}else yt=Se.velocity,Qt=Se.velocityX,Zn=Se.velocityY,Ti=Se.direction;se.velocity=yt,se.velocityX=Qt,se.velocityY=Zn,se.direction=Ti}function Te(ee){for(var se=[],Se=0;Se<ee.pointers.length;)se[Se]={clientX:h(ee.pointers[Se].clientX),clientY:h(ee.pointers[Se].clientY)},Se++;return{timeStamp:g(),pointers:se,center:At(se),deltaX:ee.deltaX,deltaY:ee.deltaY}}function At(ee){var se=ee.length;if(se===1)return{x:h(ee[0].clientX),y:h(ee[0].clientY)};for(var Se=0,qe=0,yt=0;yt<se;)Se+=ee[yt].clientX,qe+=ee[yt].clientY,yt++;return{x:h(Se/se),y:h(qe/se)}}function xt(ee,se,Se){return{x:se/ee||0,y:Se/ee||0}}function qt(ee,se){return ee===se?he:p(ee)>=p(se)?ee<0?B:H:se<0?F:Q}function dn(ee,se,Se){Se||(Se=Pe);var qe=se[Se[0]]-ee[Se[0]],yt=se[Se[1]]-ee[Se[1]];return Math.sqrt(qe*qe+yt*yt)}function Ke(ee,se,Se){Se||(Se=Pe);var qe=se[Se[0]]-ee[Se[0]],yt=se[Se[1]]-ee[Se[1]];return Math.atan2(yt,qe)*180/Math.PI}function gt(ee,se){return Ke(se[1],se[0],We)+Ke(ee[1],ee[0],We)}function Tt(ee,se){return dn(se[0],se[1],We)/dn(ee[0],ee[1],We)}var Rn={mousedown:Ot,mousemove:En,mouseup:lt},Xn="mousedown",nn="mousemove mouseup";function Lr(){this.evEl=Xn,this.evWin=nn,this.pressed=!1,rt.apply(this,arguments)}te(Lr,rt,{handler:function(se){var Se=Rn[se.type];Se&Ot&&se.button===0&&(this.pressed=!0),Se&En&&se.which!==1&&(Se=lt),this.pressed&&(Se&lt&&(this.pressed=!1),this.callback(this.manager,Se,{pointers:[se],changedPointers:[se],pointerType:Xt,srcEvent:se}))}});var Qr={pointerdown:Ot,pointermove:En,pointerup:lt,pointercancel:It,pointerout:It},Tr={2:Ge,3:Gn,4:Xt,5:ln},oe="pointerdown",V="pointermove pointerup pointercancel";e.MSPointerEvent&&!e.PointerEvent&&(oe="MSPointerDown",V="MSPointerMove MSPointerUp MSPointerCancel");function $(){this.evEl=oe,this.evWin=V,rt.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}te($,rt,{handler:function(se){var Se=this.store,qe=!1,yt=se.type.toLowerCase().replace("ms",""),Qt=Qr[yt],Zn=Tr[se.pointerType]||se.pointerType,Ti=Zn==Ge,Vi=ne(Se,se.pointerId,"pointerId");Qt&Ot&&(se.button===0||Ti)?Vi<0&&(Se.push(se),Vi=Se.length-1):Qt&(lt|It)&&(qe=!0),!(Vi<0)&&(Se[Vi]=se,this.callback(this.manager,Qt,{pointers:Se,changedPointers:[se],pointerType:Zn,srcEvent:se}),qe&&Se.splice(Vi,1))}});var K={touchstart:Ot,touchmove:En,touchend:lt,touchcancel:It},me="touchstart",Oe="touchstart touchmove touchend touchcancel";function He(){this.evTarget=me,this.evWin=Oe,this.started=!1,rt.apply(this,arguments)}te(He,rt,{handler:function(se){var Se=K[se.type];if(Se===Ot&&(this.started=!0),!!this.started){var qe=Le.call(this,se,Se);Se&(lt|It)&&qe[0].length-qe[1].length===0&&(this.started=!1),this.callback(this.manager,Se,{pointers:qe[0],changedPointers:qe[1],pointerType:Ge,srcEvent:se})}}});function Le(ee,se){var Se=Ee(ee.touches),qe=Ee(ee.changedTouches);return se&(lt|It)&&(Se=ke(Se.concat(qe),"identifier",!0)),[Se,qe]}var Ce={touchstart:Ot,touchmove:En,touchend:lt,touchcancel:It},De="touchstart touchmove touchend touchcancel";function ot(){this.evTarget=De,this.targetIds={},rt.apply(this,arguments)}te(ot,rt,{handler:function(se){var Se=Ce[se.type],qe=st.call(this,se,Se);qe&&this.callback(this.manager,Se,{pointers:qe[0],changedPointers:qe[1],pointerType:Ge,srcEvent:se})}});function st(ee,se){var Se=Ee(ee.touches),qe=this.targetIds;if(se&(Ot|En)&&Se.length===1)return qe[Se[0].identifier]=!0,[Se,Se];var yt,Qt,Zn=Ee(ee.changedTouches),Ti=[],Vi=this.target;if(Qt=Se.filter(function(lo){return ue(lo.target,Vi)}),se===Ot)for(yt=0;yt<Qt.length;)qe[Qt[yt].identifier]=!0,yt++;for(yt=0;yt<Zn.length;)qe[Zn[yt].identifier]&&Ti.push(Zn[yt]),se&(lt|It)&&delete qe[Zn[yt].identifier],yt++;if(Ti.length)return[ke(Qt.concat(Ti),"identifier",!0),Ti]}var St=2500,un=25;function en(){rt.apply(this,arguments);var ee=le(this.handler,this);this.touch=new ot(this.manager,ee),this.mouse=new Lr(this.manager,ee),this.primaryTouch=null,this.lastTouches=[]}te(en,rt,{handler:function(se,Se,qe){var yt=qe.pointerType==Ge,Qt=qe.pointerType==Xt;if(!(Qt&&qe.sourceCapabilities&&qe.sourceCapabilities.firesTouchEvents)){if(yt)yn.call(this,Se,qe);else if(Qt&&er.call(this,qe))return;this.callback(se,Se,qe)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});function yn(ee,se){ee&Ot?(this.primaryTouch=se.changedPointers[0].identifier,Kn.call(this,se)):ee&(lt|It)&&Kn.call(this,se)}function Kn(ee){var se=ee.changedPointers[0];if(se.identifier===this.primaryTouch){var Se={x:se.clientX,y:se.clientY};this.lastTouches.push(Se);var qe=this.lastTouches,yt=function(){var Qt=qe.indexOf(Se);Qt>-1&&qe.splice(Qt,1)};setTimeout(yt,St)}}function er(ee){for(var se=ee.srcEvent.clientX,Se=ee.srcEvent.clientY,qe=0;qe<this.lastTouches.length;qe++){var yt=this.lastTouches[qe],Qt=Math.abs(se-yt.x),Zn=Math.abs(Se-yt.y);if(Qt<=un&&Zn<=un)return!0}return!1}var On=Be(a.style,"touchAction"),Dn=On!==i,fn="compute",pn="auto",Wn="manipulation",Nr="none",ni="pan-x",ji="pan-y",Ei=Fc();function co(ee,se){this.manager=ee,this.set(se)}co.prototype={set:function(ee){ee==fn&&(ee=this.compute()),Dn&&this.manager.element.style&&Ei[ee]&&(this.manager.element.style[On]=ee),this.actions=ee.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var ee=[];return C(this.manager.recognizers,function(se){ce(se.options.enable,[se])&&(ee=ee.concat(se.getTouchAction()))}),zu(ee.join(" "))},preventDefaults:function(ee){var se=ee.srcEvent,Se=ee.offsetDirection;if(this.manager.session.prevented){se.preventDefault();return}var qe=this.actions,yt=xe(qe,Nr)&&!Ei[Nr],Qt=xe(qe,ji)&&!Ei[ji],Zn=xe(qe,ni)&&!Ei[ni];if(yt){var Ti=ee.pointers.length===1,Vi=ee.distance<2,lo=ee.deltaTime<250;if(Ti&&Vi&&lo)return}if(!(Zn&&Qt)&&(yt||Qt&&Se&ae||Zn&&Se&q))return this.preventSrc(se)},preventSrc:function(ee){this.manager.session.prevented=!0,ee.preventDefault()}};function zu(ee){if(xe(ee,Nr))return Nr;var se=xe(ee,ni),Se=xe(ee,ji);return se&&Se?Nr:se||Se?se?ni:ji:xe(ee,Wn)?Wn:pn}function Fc(){if(!Dn)return!1;var ee={},se=e.CSS&&e.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach(function(Se){ee[Se]=se?e.CSS.supports("touch-action",Se):!0}),ee}var Ll=1,oa=2,rr=4,Ao=8,va=Ao,Zi=16,Gr=32;function hs(ee){this.options=L({},this.defaults,ee||{}),this.id=at(),this.manager=null,this.options.enable=_e(this.options.enable,!0),this.state=Ll,this.simultaneous={},this.requireFail=[]}hs.prototype={defaults:{},set:function(ee){return L(this.options,ee),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(ee){if(x(ee,"recognizeWith",this))return this;var se=this.simultaneous;return ee=Bc(ee,this),se[ee.id]||(se[ee.id]=ee,ee.recognizeWith(this)),this},dropRecognizeWith:function(ee){return x(ee,"dropRecognizeWith",this)?this:(ee=Bc(ee,this),delete this.simultaneous[ee.id],this)},requireFailure:function(ee){if(x(ee,"requireFailure",this))return this;var se=this.requireFail;return ee=Bc(ee,this),ne(se,ee)===-1&&(se.push(ee),ee.requireFailure(this)),this},dropRequireFailure:function(ee){if(x(ee,"dropRequireFailure",this))return this;ee=Bc(ee,this);var se=ne(this.requireFail,ee);return se>-1&&this.requireFail.splice(se,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(ee){return!!this.simultaneous[ee.id]},emit:function(ee){var se=this,Se=this.state;function qe(yt){se.manager.emit(yt,ee)}Se<Ao&&qe(se.options.event+Uo(Se)),qe(se.options.event),ee.additionalEvent&&qe(ee.additionalEvent),Se>=Ao&&qe(se.options.event+Uo(Se))},tryEmit:function(ee){if(this.canEmit())return this.emit(ee);this.state=Gr},canEmit:function(){for(var ee=0;ee<this.requireFail.length;){if(!(this.requireFail[ee].state&(Gr|Ll)))return!1;ee++}return!0},recognize:function(ee){var se=L({},ee);if(!ce(this.options.enable,[this,se])){this.reset(),this.state=Gr;return}this.state&(va|Zi|Gr)&&(this.state=Ll),this.state=this.process(se),this.state&(oa|rr|Ao|Zi)&&this.tryEmit(se)},process:function(ee){},getTouchAction:function(){},reset:function(){}};function Uo(ee){return ee&Zi?"cancel":ee&Ao?"end":ee&rr?"move":ee&oa?"start":""}function zo(ee){return ee==Q?"down":ee==F?"up":ee==B?"left":ee==H?"right":""}function Bc(ee,se){var Se=se.manager;return Se?Se.get(ee):ee}function Xi(){hs.apply(this,arguments)}te(Xi,hs,{defaults:{pointers:1},attrTest:function(ee){var se=this.options.pointers;return se===0||ee.pointers.length===se},process:function(ee){var se=this.state,Se=ee.eventType,qe=se&(oa|rr),yt=this.attrTest(ee);return qe&&(Se&It||!yt)?se|Zi:qe||yt?Se&lt?se|Ao:se&oa?se|rr:oa:Gr}});function ri(){Xi.apply(this,arguments),this.pX=null,this.pY=null}te(ri,Xi,{defaults:{event:"pan",threshold:10,pointers:1,direction:Ae},getTouchAction:function(){var ee=this.options.direction,se=[];return ee&ae&&se.push(ji),ee&q&&se.push(ni),se},directionTest:function(ee){var se=this.options,Se=!0,qe=ee.distance,yt=ee.direction,Qt=ee.deltaX,Zn=ee.deltaY;return yt&se.direction||(se.direction&ae?(yt=Qt===0?he:Qt<0?B:H,Se=Qt!=this.pX,qe=Math.abs(ee.deltaX)):(yt=Zn===0?he:Zn<0?F:Q,Se=Zn!=this.pY,qe=Math.abs(ee.deltaY))),ee.direction=yt,Se&&qe>se.threshold&&yt&se.direction},attrTest:function(ee){return Xi.prototype.attrTest.call(this,ee)&&(this.state&oa||!(this.state&oa)&&this.directionTest(ee))},emit:function(ee){this.pX=ee.deltaX,this.pY=ee.deltaY;var se=zo(ee.direction);se&&(ee.additionalEvent=this.options.event+se),this._super.emit.call(this,ee)}});function ds(){Xi.apply(this,arguments)}te(ds,Xi,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[Nr]},attrTest:function(ee){return this._super.attrTest.call(this,ee)&&(Math.abs(ee.scale-1)>this.options.threshold||this.state&oa)},emit:function(ee){if(ee.scale!==1){var se=ee.scale<1?"in":"out";ee.additionalEvent=this.options.event+se}this._super.emit.call(this,ee)}});function ba(){hs.apply(this,arguments),this._timer=null,this._input=null}te(ba,hs,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[pn]},process:function(ee){var se=this.options,Se=ee.pointers.length===se.pointers,qe=ee.distance<se.threshold,yt=ee.deltaTime>se.time;if(this._input=ee,!qe||!Se||ee.eventType&(lt|It)&&!yt)this.reset();else if(ee.eventType&Ot)this.reset(),this._timer=_(function(){this.state=va,this.tryEmit()},se.time,this);else if(ee.eventType&lt)return va;return Gr},reset:function(){clearTimeout(this._timer)},emit:function(ee){this.state===va&&(ee&&ee.eventType&lt?this.manager.emit(this.options.event+"up",ee):(this._input.timeStamp=g(),this.manager.emit(this.options.event,this._input)))}});function ir(){Xi.apply(this,arguments)}te(ir,Xi,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[Nr]},attrTest:function(ee){return this._super.attrTest.call(this,ee)&&(Math.abs(ee.rotation)>this.options.threshold||this.state&oa)}});function za(){Xi.apply(this,arguments)}te(za,Xi,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:ae|q,pointers:1},getTouchAction:function(){return ri.prototype.getTouchAction.call(this)},attrTest:function(ee){var se=this.options.direction,Se;return se&(ae|q)?Se=ee.overallVelocity:se&ae?Se=ee.overallVelocityX:se&q&&(Se=ee.overallVelocityY),this._super.attrTest.call(this,ee)&&se&ee.offsetDirection&&ee.distance>this.options.threshold&&ee.maxPointers==this.options.pointers&&p(Se)>this.options.velocity&&ee.eventType&lt},emit:function(ee){var se=zo(ee.offsetDirection);se&&this.manager.emit(this.options.event+se,ee),this.manager.emit(this.options.event,ee)}});function Un(){hs.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}te(Un,hs,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[Wn]},process:function(ee){var se=this.options,Se=ee.pointers.length===se.pointers,qe=ee.distance<se.threshold,yt=ee.deltaTime<se.time;if(this.reset(),ee.eventType&Ot&&this.count===0)return this.failTimeout();if(qe&&yt&&Se){if(ee.eventType!=lt)return this.failTimeout();var Qt=this.pTime?ee.timeStamp-this.pTime<se.interval:!0,Zn=!this.pCenter||dn(this.pCenter,ee.center)<se.posThreshold;this.pTime=ee.timeStamp,this.pCenter=ee.center,!Zn||!Qt?this.count=1:this.count+=1,this._input=ee;var Ti=this.count%se.taps;if(Ti===0)return this.hasRequireFailures()?(this._timer=_(function(){this.state=va,this.tryEmit()},se.interval,this),oa):va}return Gr},failTimeout:function(){return this._timer=_(function(){this.state=Gr},this.options.interval,this),Gr},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==va&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}});function ja(ee,se){return se=se||{},se.recognizers=_e(se.recognizers,ja.defaults.preset),new Vu(ee,se)}ja.VERSION="2.0.7",ja.defaults={domEvents:!1,touchAction:fn,enable:!0,inputTarget:null,inputClass:null,preset:[[ir,{enable:!1}],[ds,{enable:!1},["rotate"]],[za,{direction:ae}],[ri,{direction:ae},["swipe"]],[Un],[Un,{event:"doubletap",taps:2},["tap"]],[ba]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};var Us=1,ju=2;function Vu(ee,se){this.options=L({},ja.defaults,se||{}),this.options.inputTarget=this.options.inputTarget||ee,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=ee,this.input=Et(this),this.touchAction=new co(this,this.options.touchAction),Uc(this,!0),C(this.options.recognizers,function(Se){var qe=this.add(new Se[0](Se[1]));Se[2]&&qe.recognizeWith(Se[2]),Se[3]&&qe.requireFailure(Se[3])},this)}Vu.prototype={set:function(ee){return L(this.options,ee),ee.touchAction&&this.touchAction.update(),ee.inputTarget&&(this.input.destroy(),this.input.target=ee.inputTarget,this.input.init()),this},stop:function(ee){this.session.stopped=ee?ju:Us},recognize:function(ee){var se=this.session;if(!se.stopped){this.touchAction.preventDefaults(ee);var Se,qe=this.recognizers,yt=se.curRecognizer;(!yt||yt&&yt.state&va)&&(yt=se.curRecognizer=null);for(var Qt=0;Qt<qe.length;)Se=qe[Qt],se.stopped!==ju&&(!yt||Se==yt||Se.canRecognizeWith(yt))?Se.recognize(ee):Se.reset(),!yt&&Se.state&(oa|rr|Ao)&&(yt=se.curRecognizer=Se),Qt++}},get:function(ee){if(ee instanceof hs)return ee;for(var se=this.recognizers,Se=0;Se<se.length;Se++)if(se[Se].options.event==ee)return se[Se];return null},add:function(ee){if(x(ee,"add",this))return this;var se=this.get(ee.options.event);return se&&this.remove(se),this.recognizers.push(ee),ee.manager=this,this.touchAction.update(),ee},remove:function(ee){if(x(ee,"remove",this))return this;if(ee=this.get(ee),ee){var se=this.recognizers,Se=ne(se,ee);Se!==-1&&(se.splice(Se,1),this.touchAction.update())}return this},on:function(ee,se){if(ee!==i&&se!==i){var Se=this.handlers;return C(je(ee),function(qe){Se[qe]=Se[qe]||[],Se[qe].push(se)}),this}},off:function(ee,se){if(ee!==i){var Se=this.handlers;return C(je(ee),function(qe){se?Se[qe]&&Se[qe].splice(ne(Se[qe],se),1):delete Se[qe]}),this}},emit:function(ee,se){this.options.domEvents&&Nl(ee,se);var Se=this.handlers[ee]&&this.handlers[ee].slice();if(!(!Se||!Se.length)){se.type=ee,se.preventDefault=function(){se.srcEvent.preventDefault()};for(var qe=0;qe<Se.length;)Se[qe](se),qe++}},destroy:function(){this.element&&Uc(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}};function Uc(ee,se){var Se=ee.element;if(Se.style){var qe;C(ee.options.cssProps,function(yt,Qt){qe=Be(Se.style,Qt),se?(ee.oldCssProps[qe]=Se.style[qe],Se.style[qe]=yt):Se.style[qe]=ee.oldCssProps[qe]||""}),se||(ee.oldCssProps={})}}function Nl(ee,se){var Se=t.createEvent("Event");Se.initEvent(ee,!0,!0),Se.gesture=se,se.target.dispatchEvent(Se)}L(ja,{INPUT_START:Ot,INPUT_MOVE:En,INPUT_END:lt,INPUT_CANCEL:It,STATE_POSSIBLE:Ll,STATE_BEGAN:oa,STATE_CHANGED:rr,STATE_ENDED:Ao,STATE_RECOGNIZED:va,STATE_CANCELLED:Zi,STATE_FAILED:Gr,DIRECTION_NONE:he,DIRECTION_LEFT:B,DIRECTION_RIGHT:H,DIRECTION_UP:F,DIRECTION_DOWN:Q,DIRECTION_HORIZONTAL:ae,DIRECTION_VERTICAL:q,DIRECTION_ALL:Ae,Manager:Vu,Input:rt,TouchAction:co,TouchInput:ot,MouseInput:Lr,PointerEventInput:$,TouchMouseInput:en,SingleTouchInput:He,Recognizer:hs,AttrRecognizer:Xi,Tap:Un,Pan:ri,Swipe:za,Pinch:ds,Rotate:ir,Press:ba,on:J,off:pe,each:C,merge:z,extend:D,assign:L,inherit:te,bindFn:le,prefixed:Be});var zs=typeof e<"u"?e:typeof self<"u"?self:{};zs.Hammer=ja,typeof i=="function"&&i.amd?i(function(){return ja}):n.exports?n.exports=ja:e[r]=ja})(window,document,"Hammer")})(z6);var ab=z6.exports;const OQ=RQ(ab),Qc=pH({__proto__:null,default:OQ},[ab]),j6=1,V6=2,D2=4,LQ={mousedown:j6,mousemove:V6,mouseup:D2};function NQ(n,e){for(let t=0;t<n.length;t++)if(e(n[t]))return!0;return!1}function DQ(n){const e=n.prototype.handler;n.prototype.handler=function(r){const i=this.store;r.button>0&&r.type==="pointerdown"&&(NQ(i,o=>o.pointerId===r.pointerId)||i.push(r)),e.call(this,r)}}function FQ(n){n.prototype.handler=function(t){let r=LQ[t.type];r&j6&&t.button>=0&&(this.pressed=!0),r&V6&&t.buttons===0&&(r=D2),this.pressed&&(r&D2&&(this.pressed=!1),this.callback(this.manager,r,{pointers:[t],changedPointers:[t],pointerType:"mouse",srcEvent:t}))}}DQ(ab.PointerEventInput);FQ(ab.MouseInput);const BQ=ab.Manager;class eT{constructor(e,t,r){this.element=e,this.callback=t,this.options={enable:!0,...r}}}const UQ=Qc?[[Qc.Pan,{event:"tripan",pointers:3,threshold:0,enable:!1}],[Qc.Rotate,{enable:!1}],[Qc.Pinch,{enable:!1}],[Qc.Swipe,{enable:!1}],[Qc.Pan,{threshold:0,enable:!1}],[Qc.Press,{enable:!1}],[Qc.Tap,{event:"doubletap",taps:2,enable:!1}],[Qc.Tap,{event:"anytap",enable:!1}],[Qc.Tap,{enable:!1}]]:null,KL={tripan:["rotate","pinch","pan"],rotate:["pinch"],pinch:["pan"],pan:["press","doubletap","anytap","tap"],doubletap:["anytap"],anytap:["tap"]},zQ={doubletap:["tap"]},jQ={pointerdown:"pointerdown",pointermove:"pointermove",pointerup:"pointerup",touchstart:"pointerdown",touchmove:"pointermove",touchend:"pointerup",mousedown:"pointerdown",mousemove:"pointermove",mouseup:"pointerup"},gM={KEY_EVENTS:["keydown","keyup"],MOUSE_EVENTS:["mousedown","mousemove","mouseup","mouseover","mouseout","mouseleave"],WHEEL_EVENTS:["wheel","mousewheel"]},VQ={tap:"tap",anytap:"anytap",doubletap:"doubletap",press:"press",pinch:"pinch",pinchin:"pinch",pinchout:"pinch",pinchstart:"pinch",pinchmove:"pinch",pinchend:"pinch",pinchcancel:"pinch",rotate:"rotate",rotatestart:"rotate",rotatemove:"rotate",rotateend:"rotate",rotatecancel:"rotate",tripan:"tripan",tripanstart:"tripan",tripanmove:"tripan",tripanup:"tripan",tripandown:"tripan",tripanleft:"tripan",tripanright:"tripan",tripanend:"tripan",tripancancel:"tripan",pan:"pan",panstart:"pan",panmove:"pan",panup:"pan",pandown:"pan",panleft:"pan",panright:"pan",panend:"pan",pancancel:"pan",swipe:"swipe",swipeleft:"swipe",swiperight:"swipe",swipeup:"swipe",swipedown:"swipe"},ZL={click:"tap",anyclick:"anytap",dblclick:"doubletap",mousedown:"pointerdown",mousemove:"pointermove",mouseup:"pointerup",mouseover:"pointerover",mouseout:"pointerout",mouseleave:"pointerleave"},HQ=typeof navigator<"u"&&navigator.userAgent?navigator.userAgent.toLowerCase():"",Qg=typeof window<"u"?window:global;let F2=!1;try{const n={get passive(){return F2=!0,!0}};Qg.addEventListener("test",null,n),Qg.removeEventListener("test",null)}catch{F2=!1}const GQ=HQ.indexOf("firefox")!==-1,{WHEEL_EVENTS:qQ}=gM,XL="wheel",QL=4.000244140625,$Q=40,WQ=.25;class YQ extends eT{constructor(e,t,r){super(e,t,r),this.handleEvent=i=>{if(!this.options.enable)return;let o=i.deltaY;Qg.WheelEvent&&(GQ&&i.deltaMode===Qg.WheelEvent.DOM_DELTA_PIXEL&&(o/=Qg.devicePixelRatio),i.deltaMode===Qg.WheelEvent.DOM_DELTA_LINE&&(o*=$Q)),o!==0&&o%QL===0&&(o=Math.floor(o/QL)),i.shiftKey&&o&&(o=o*WQ),this.callback({type:XL,center:{x:i.clientX,y:i.clientY},delta:-o,srcEvent:i,pointerType:"mouse",target:i.target})},this.events=(this.options.events||[]).concat(qQ),this.events.forEach(i=>e.addEventListener(i,this.handleEvent,F2?{passive:!1}:!1))}destroy(){this.events.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,t){e===XL&&(this.options.enable=t)}}const{MOUSE_EVENTS:KQ}=gM,JL="pointermove",eN="pointerover",tN="pointerout",nN="pointerenter",rN="pointerleave";class ZQ extends eT{constructor(e,t,r){super(e,t,r),this.handleEvent=o=>{this.handleOverEvent(o),this.handleOutEvent(o),this.handleEnterEvent(o),this.handleLeaveEvent(o),this.handleMoveEvent(o)},this.pressed=!1;const{enable:i}=this.options;this.enableMoveEvent=i,this.enableLeaveEvent=i,this.enableEnterEvent=i,this.enableOutEvent=i,this.enableOverEvent=i,this.events=(this.options.events||[]).concat(KQ),this.events.forEach(o=>e.addEventListener(o,this.handleEvent))}destroy(){this.events.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,t){e===JL&&(this.enableMoveEvent=t),e===eN&&(this.enableOverEvent=t),e===tN&&(this.enableOutEvent=t),e===nN&&(this.enableEnterEvent=t),e===rN&&(this.enableLeaveEvent=t)}handleOverEvent(e){this.enableOverEvent&&e.type==="mouseover"&&this._emit(eN,e)}handleOutEvent(e){this.enableOutEvent&&e.type==="mouseout"&&this._emit(tN,e)}handleEnterEvent(e){this.enableEnterEvent&&e.type==="mouseenter"&&this._emit(nN,e)}handleLeaveEvent(e){this.enableLeaveEvent&&e.type==="mouseleave"&&this._emit(rN,e)}handleMoveEvent(e){if(this.enableMoveEvent)switch(e.type){case"mousedown":e.button>=0&&(this.pressed=!0);break;case"mousemove":e.buttons===0&&(this.pressed=!1),this.pressed||this._emit(JL,e);break;case"mouseup":this.pressed=!1;break}}_emit(e,t){this.callback({type:e,center:{x:t.clientX,y:t.clientY},srcEvent:t,pointerType:"mouse",target:t.target})}}const{KEY_EVENTS:XQ}=gM,iN="keydown",oN="keyup";class QQ extends eT{constructor(e,t,r){super(e,t,r),this.handleEvent=i=>{const o=i.target||i.srcElement;o.tagName==="INPUT"&&o.type==="text"||o.tagName==="TEXTAREA"||(this.enableDownEvent&&i.type==="keydown"&&this.callback({type:iN,srcEvent:i,key:i.key,target:i.target}),this.enableUpEvent&&i.type==="keyup"&&this.callback({type:oN,srcEvent:i,key:i.key,target:i.target}))},this.enableDownEvent=this.options.enable,this.enableUpEvent=this.options.enable,this.events=(this.options.events||[]).concat(XQ),e.tabIndex=this.options.tabIndex||0,e.style.outline="none",this.events.forEach(i=>e.addEventListener(i,this.handleEvent))}destroy(){this.events.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,t){e===iN&&(this.enableDownEvent=t),e===oN&&(this.enableUpEvent=t)}}const aN="contextmenu";class JQ extends eT{constructor(e,t,r){super(e,t,r),this.handleEvent=i=>{this.options.enable&&this.callback({type:aN,center:{x:i.clientX,y:i.clientY},srcEvent:i,pointerType:"mouse",target:i.target})},e.addEventListener("contextmenu",this.handleEvent)}destroy(){this.element.removeEventListener("contextmenu",this.handleEvent)}enableEventType(e,t){e===aN&&(this.options.enable=t)}}const sN=1,B2=2,cN=4,eJ={pointerdown:sN,pointermove:B2,pointerup:cN,mousedown:sN,mousemove:B2,mouseup:cN},tJ=0,nJ=1,rJ=2,iJ=1,oJ=2,aJ=4;function sJ(n){const e=eJ[n.srcEvent.type];if(!e)return null;const{buttons:t,button:r}=n.srcEvent;let i=!1,o=!1,a=!1;return e===B2?(i=!!(t&iJ),o=!!(t&aJ),a=!!(t&oJ)):(i=r===tJ,o=r===nJ,a=r===rJ),{leftButton:i,middleButton:o,rightButton:a}}function cJ(n,e){const t=n.center;if(!t)return null;const r=e.getBoundingClientRect(),i=r.width/e.offsetWidth||1,o=r.height/e.offsetHeight||1,a={x:(t.x-r.left-e.clientLeft)/i,y:(t.y-r.top-e.clientTop)/o};return{center:t,offsetCenter:a}}const aC={srcElement:"root",priority:0};class lJ{constructor(e){this.handleEvent=t=>{if(this.isEmpty())return;const r=this._normalizeEvent(t);let i=t.srcEvent.target;for(;i&&i!==r.rootElement;){if(this._emit(r,i),r.handled)return;i=i.parentNode}this._emit(r,"root")},this.eventManager=e,this.handlers=[],this.handlersByElement=new Map,this._active=!1}isEmpty(){return!this._active}add(e,t,r,i=!1,o=!1){const{handlers:a,handlersByElement:l}=this;let h=aC;typeof r=="string"||r&&r.addEventListener?h={...aC,srcElement:r}:r&&(h={...aC,...r});let p=l.get(h.srcElement);p||(p=[],l.set(h.srcElement,p));const g={type:e,handler:t,srcElement:h.srcElement,priority:h.priority};i&&(g.once=!0),o&&(g.passive=!0),a.push(g),this._active=this._active||!g.passive;let _=p.length-1;for(;_>=0&&!(p[_].priority>=g.priority);)_--;p.splice(_+1,0,g)}remove(e,t){const{handlers:r,handlersByElement:i}=this;for(let o=r.length-1;o>=0;o--){const a=r[o];if(a.type===e&&a.handler===t){r.splice(o,1);const l=i.get(a.srcElement);l.splice(l.indexOf(a),1),l.length===0&&i.delete(a.srcElement)}}this._active=r.some(o=>!o.passive)}_emit(e,t){const r=this.handlersByElement.get(t);if(r){let i=!1;const o=()=>{e.handled=!0},a=()=>{e.handled=!0,i=!0},l=[];for(let h=0;h<r.length;h++){const{type:p,handler:g,once:_}=r[h];if(g({...e,type:p,stopPropagation:o,stopImmediatePropagation:a}),_&&l.push(r[h]),i)break}for(let h=0;h<l.length;h++){const{type:p,handler:g}=l[h];this.remove(p,g)}}}_normalizeEvent(e){const t=this.eventManager.getElement();return{...e,...sJ(e),...cJ(e,t),preventDefault:()=>{e.srcEvent.preventDefault()},stopImmediatePropagation:null,stopPropagation:null,handled:!1,rootElement:t}}}const uJ={events:null,recognizers:null,recognizerOptions:{},Manager:BQ,touchAction:"none",tabIndex:0};let hJ=class{constructor(e=null,t){this._onBasicInput=i=>{const{srcEvent:o}=i,a=jQ[o.type];a&&this.manager.emit(a,i)},this._onOtherEvent=i=>{this.manager.emit(i.type,i)},this.options={...uJ,...t},this.events=new Map,this.setElement(e);const{events:r}=this.options;r&&this.on(r)}getElement(){return this.element}setElement(e){if(this.element&&this.destroy(),this.element=e,!e)return;const{options:t}=this,r=t.Manager;this.manager=new r(e,{touchAction:t.touchAction,recognizers:t.recognizers||UQ}).on("hammer.input",this._onBasicInput),t.recognizers||Object.keys(KL).forEach(i=>{const o=this.manager.get(i);o&&KL[i].forEach(a=>{o.recognizeWith(a)})});for(const i in t.recognizerOptions){const o=this.manager.get(i);if(o){const a=t.recognizerOptions[i];delete a.enable,o.set(a)}}this.wheelInput=new YQ(e,this._onOtherEvent,{enable:!1}),this.moveInput=new ZQ(e,this._onOtherEvent,{enable:!1}),this.keyInput=new QQ(e,this._onOtherEvent,{enable:!1,tabIndex:t.tabIndex}),this.contextmenuInput=new JQ(e,this._onOtherEvent,{enable:!1});for(const[i,o]of this.events)o.isEmpty()||(this._toggleRecognizer(o.recognizerName,!0),this.manager.on(i,o.handleEvent))}destroy(){this.element&&(this.wheelInput.destroy(),this.moveInput.destroy(),this.keyInput.destroy(),this.contextmenuInput.destroy(),this.manager.destroy(),this.wheelInput=null,this.moveInput=null,this.keyInput=null,this.contextmenuInput=null,this.manager=null,this.element=null)}on(e,t,r){this._addEventHandler(e,t,r,!1)}once(e,t,r){this._addEventHandler(e,t,r,!0)}watch(e,t,r){this._addEventHandler(e,t,r,!1,!0)}off(e,t){this._removeEventHandler(e,t)}_toggleRecognizer(e,t){const{manager:r}=this;if(!r)return;const i=r.get(e);if(i&&i.options.enable!==t){i.set({enable:t});const o=zQ[e];o&&!this.options.recognizers&&o.forEach(a=>{const l=r.get(a);t?(l.requireFailure(e),i.dropRequireFailure(a)):l.dropRequireFailure(e)})}this.wheelInput.enableEventType(e,t),this.moveInput.enableEventType(e,t),this.keyInput.enableEventType(e,t),this.contextmenuInput.enableEventType(e,t)}_addEventHandler(e,t,r,i,o){if(typeof e!="string"){r=t;for(const g in e)this._addEventHandler(g,e[g],r,i,o);return}const{manager:a,events:l}=this,h=ZL[e]||e;let p=l.get(h);p||(p=new lJ(this),l.set(h,p),p.recognizerName=VQ[h]||h,a&&a.on(h,p.handleEvent)),p.add(e,t,r,i,o),p.isEmpty()||this._toggleRecognizer(p.recognizerName,!0)}_removeEventHandler(e,t){if(typeof e!="string"){for(const a in e)this._removeEventHandler(a,e[a]);return}const{events:r}=this,i=ZL[e]||e,o=r.get(i);if(o&&(o.remove(e,t),o.isEmpty())){const{recognizerName:a}=o;let l=!1;for(const h of r.values())if(h.recognizerName===a&&!h.isEmpty()){l=!0;break}l||this._toggleRecognizer(a,!1)}}};function Vd(){}const dJ=({isDragging:n})=>n?"grabbing":"grab",H6={id:"",width:"100%",height:"100%",style:null,viewState:null,initialViewState:null,pickingRadius:0,layerFilter:null,glOptions:{},parameters:{},parent:null,gl:null,canvas:null,layers:[],effects:[],views:null,controller:null,useDevicePixels:!0,touchAction:"none",eventRecognizerOptions:{},_framebuffer:null,_animate:!1,_pickable:!0,_typedArrayManagerProps:{},_customRender:null,onWebGLInitialized:Vd,onResize:Vd,onViewStateChange:Vd,onInteractionStateChange:Vd,onBeforeRender:Vd,onAfterRender:Vd,onLoad:Vd,onError:n=>Fr.error(n.message,n.cause)(),onHover:null,onClick:null,onDragStart:null,onDrag:null,onDragEnd:null,_onMetrics:null,getCursor:dJ,getTooltip:null,debug:!1,drawPickingColors:!1};class mM{constructor(e){Y(this,"props",void 0),Y(this,"width",0),Y(this,"height",0),Y(this,"userData",{}),Y(this,"canvas",null),Y(this,"viewManager",null),Y(this,"layerManager",null),Y(this,"effectManager",null),Y(this,"deckRenderer",null),Y(this,"deckPicker",null),Y(this,"eventManager",null),Y(this,"tooltip",null),Y(this,"metrics",void 0),Y(this,"animationLoop",void 0),Y(this,"stats",void 0),Y(this,"viewState",void 0),Y(this,"cursorState",void 0),Y(this,"_needsRedraw",void 0),Y(this,"_pickRequest",void 0),Y(this,"_lastPointerDownInfo",null),Y(this,"_metricsCounter",void 0),Y(this,"_onPointerMove",t=>{const{_pickRequest:r}=this;if(t.type==="pointerleave")r.x=-1,r.y=-1,r.radius=0;else{if(t.leftButton||t.rightButton)return;{const i=t.offsetCenter;if(!i)return;r.x=i.x,r.y=i.y,r.radius=this.props.pickingRadius}}this.layerManager&&(this.layerManager.context.mousePosition={x:r.x,y:r.y}),r.event=t}),Y(this,"_onEvent",t=>{const r=$O[t.type],i=t.offsetCenter;if(!r||!i||!this.layerManager)return;const o=this.layerManager.getLayers(),a=this.deckPicker.getLastPickedObject({x:i.x,y:i.y,layers:o,viewports:this.getViewports(i)},this._lastPointerDownInfo),{layer:l}=a,h=l&&(l[r.handler]||l.props[r.handler]),p=this.props[r.handler];let g=!1;h&&(g=h.call(l,a,t)),!g&&p&&p(a,t)}),Y(this,"_onPointerDown",t=>{const r=t.offsetCenter,i=this._pick("pickObject","pickObject Time",{x:r.x,y:r.y,radius:this.props.pickingRadius});this._lastPointerDownInfo=i.result[0]||i.emptyInfo}),this.props={...H6,...e},e=this.props,this._needsRedraw="Initial render",this._pickRequest={mode:"hover",x:-1,y:-1,radius:0,event:null},this.cursorState={isHovering:!1,isDragging:!1},e.viewState&&e.initialViewState&&Fr.warn("View state tracking is disabled. Use either `initialViewState` for auto update or `viewState` for manual update.")(),E5()==="IE"&&Fr.warn("IE 11 is not supported")(),this.viewState=e.initialViewState,e.gl||typeof document<"u"&&(this.canvas=this._createCanvas(e)),this.animationLoop=this._createAnimationLoop(e),this.stats=new $P({id:"deck.gl"}),this.metrics={fps:0,setPropsTime:0,updateAttributesTime:0,framesRedrawn:0,pickTime:0,pickCount:0,gpuTime:0,gpuTimePerFrame:0,cpuTime:0,cpuTimePerFrame:0,bufferMemory:0,textureMemory:0,renderbufferMemory:0,gpuMemory:0},this._metricsCounter=0,this.setProps(e),e._typedArrayManagerProps&&b0.setOptions(e._typedArrayManagerProps),this.animationLoop.start()}finalize(){var e,t,r,i,o,a,l,h;if((e=this.animationLoop)===null||e===void 0||e.stop(),this.animationLoop=null,this._lastPointerDownInfo=null,(t=this.layerManager)===null||t===void 0||t.finalize(),this.layerManager=null,(r=this.viewManager)===null||r===void 0||r.finalize(),this.viewManager=null,(i=this.effectManager)===null||i===void 0||i.finalize(),this.effectManager=null,(o=this.deckRenderer)===null||o===void 0||o.finalize(),this.deckRenderer=null,(a=this.deckPicker)===null||a===void 0||a.finalize(),this.deckPicker=null,(l=this.eventManager)===null||l===void 0||l.destroy(),this.eventManager=null,(h=this.tooltip)===null||h===void 0||h.remove(),this.tooltip=null,!this.props.canvas&&!this.props.gl&&this.canvas){var p;(p=this.canvas.parentElement)===null||p===void 0||p.removeChild(this.canvas),this.canvas=null}}setProps(e){this.stats.get("setProps Time").timeStart(),"onLayerHover"in e&&Fr.removed("onLayerHover","onHover")(),"onLayerClick"in e&&Fr.removed("onLayerClick","onClick")(),e.initialViewState&&!ul(this.props.initialViewState,e.initialViewState,3)&&(this.viewState=e.initialViewState),Object.assign(this.props,e),this._setCanvasSize(this.props);const t=Object.create(this.props);Object.assign(t,{views:this._getViews(),width:this.width,height:this.height,viewState:this._getViewState()}),this.animationLoop.setProps(t),this.layerManager&&(this.viewManager.setProps(t),this.layerManager.activateViewport(this.getViewports()[0]),this.layerManager.setProps(t),this.effectManager.setProps(t),this.deckRenderer.setProps(t),this.deckPicker.setProps(t)),this.stats.get("setProps Time").timeEnd()}needsRedraw(e={clearRedrawFlags:!1}){if(!this.layerManager)return!1;if(this.props._animate)return"Deck._animate";let t=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);const r=this.viewManager.needsRedraw(e),i=this.layerManager.needsRedraw(e),o=this.effectManager.needsRedraw(e),a=this.deckRenderer.needsRedraw(e);return t=t||r||i||o||a,t}redraw(e){if(!this.layerManager)return;let t=this.needsRedraw({clearRedrawFlags:!0});t=e||t,t&&(this.stats.get("Redraw Count").incrementCount(),this.props._customRender?this.props._customRender(t):this._drawLayers(t))}get isInitialized(){return this.viewManager!==null}getViews(){return Yo(this.viewManager),this.viewManager.views}getViewports(e){return Yo(this.viewManager),this.viewManager.getViewports(e)}getCanvas(){return this.canvas}pickObject(e){const t=this._pick("pickObject","pickObject Time",e).result;return t.length?t[0]:null}pickMultipleObjects(e){return e.depth=e.depth||10,this._pick("pickObject","pickMultipleObjects Time",e).result}pickObjects(e){return this._pick("pickObjects","pickObjects Time",e)}_addResources(e,t=!1){for(const r in e)this.layerManager.resourceManager.add({resourceId:r,data:e[r],forceUpdate:t})}_removeResources(e){for(const t of e)this.layerManager.resourceManager.remove(t)}_addDefaultEffect(e){this.effectManager.addDefaultEffect(e)}_pick(e,t,r){Yo(this.deckPicker);const{stats:i}=this;i.get("Pick Count").incrementCount(),i.get(t).timeStart();const o=this.deckPicker[e]({layers:this.layerManager.getLayers(r),views:this.viewManager.getViews(),viewports:this.getViewports(r),onViewportActive:this.layerManager.activateViewport,effects:this.effectManager.getEffects(),...r});return i.get(t).timeEnd(),o}_createCanvas(e){let t=e.canvas;return typeof t=="string"&&(t=document.getElementById(t),Yo(t)),t||(t=document.createElement("canvas"),t.id=e.id||"deckgl-overlay",(e.parent||document.body).appendChild(t)),Object.assign(t.style,e.style),t}_setCanvasSize(e){if(!this.canvas)return;const{width:t,height:r}=e;if(t||t===0){const o=Number.isFinite(t)?"".concat(t,"px"):t;this.canvas.style.width=o}if(r||r===0){var i;const o=Number.isFinite(r)?"".concat(r,"px"):r;this.canvas.style.position=((i=e.style)===null||i===void 0?void 0:i.position)||"absolute",this.canvas.style.height=o}}_updateCanvasSize(){var e,t;const{canvas:r}=this;if(!r)return;const i=(e=r.clientWidth)!==null&&e!==void 0?e:r.width,o=(t=r.clientHeight)!==null&&t!==void 0?t:r.height;if(i!==this.width||o!==this.height){var a,l;this.width=i,this.height=o,(a=this.viewManager)===null||a===void 0||a.setProps({width:i,height:o}),(l=this.layerManager)===null||l===void 0||l.activateViewport(this.getViewports()[0]),this.props.onResize({width:i,height:o})}}_createAnimationLoop(e){const{width:t,height:r,gl:i,glOptions:o,debug:a,onError:l,onBeforeRender:h,onAfterRender:p,useDevicePixels:g}=e;return new SY({width:t,height:r,useDevicePixels:g,autoResizeDrawingBuffer:!i,autoResizeViewport:!1,gl:i,onCreateContext:_=>V5({...o,..._,canvas:this.canvas,debug:a,onContextLost:()=>this._onContextLost()}),onInitialize:_=>this._setGLContext(_.gl),onRender:this._onRenderFrame.bind(this),onBeforeRender:h,onAfterRender:p,onError:l})}_getViewState(){return this.props.viewState||this.viewState}_getViews(){let e=this.props.views||[new F6({id:"default-view"})];return e=Array.isArray(e)?e:[e],e.length&&this.props.controller&&(e[0].props.controller=this.props.controller),e}_onContextLost(){const{onError:e}=this.props;this.animationLoop&&e&&e(new Error("WebGL context is lost"))}_pickAndCallback(){const{_pickRequest:e}=this;if(e.event){const{result:r,emptyInfo:i}=this._pick("pickObject","pickObject Time",e);this.cursorState.isHovering=r.length>0;let o=i,a=!1;for(const l of r){var t;o=l,a=((t=l.layer)===null||t===void 0?void 0:t.onHover(l,e.event))||a}if(!a&&this.props.onHover&&this.props.onHover(o,e.event),this.props.getTooltip&&this.tooltip){const l=this.props.getTooltip(o);this.tooltip.setTooltip(l,o.x,o.y)}e.event=null}}_updateCursor(){const e=this.props.parent||this.canvas;e&&(e.style.cursor=this.props.getCursor(this.cursorState))}_setGLContext(e){if(this.layerManager)return;this.canvas||(this.canvas=e.canvas,tM(e,{enable:!0,copyState:!0})),this.tooltip=new MQ(this.canvas),bu(e,{blend:!0,blendFunc:[770,771,1,771],polygonOffsetFill:!0,depthTest:!0,depthFunc:515}),this.props.onWebGLInitialized(e);const t=new b6;t.play(),this.animationLoop.attachTimeline(t),this.eventManager=new hJ(this.props.parent||e.canvas,{touchAction:this.props.touchAction,recognizerOptions:this.props.eventRecognizerOptions,events:{pointerdown:this._onPointerDown,pointermove:this._onPointerMove,pointerleave:this._onPointerMove}});for(const i in $O)this.eventManager.on(i,this._onEvent);this.viewManager=new nQ({timeline:t,eventManager:this.eventManager,onViewStateChange:this._onViewStateChange.bind(this),onInteractionStateChange:this._onInteractionStateChange.bind(this),views:this._getViews(),viewState:this._getViewState(),width:this.width,height:this.height});const r=this.viewManager.getViewports()[0];this.layerManager=new tQ(e,{deck:this,stats:this.stats,viewport:r,timeline:t}),this.effectManager=new vQ,this.deckRenderer=new xQ(e),this.deckPicker=new IQ(e),this.setProps(this.props),this._updateCanvasSize(),this.props.onLoad()}_drawLayers(e,t){const{gl:r}=this.layerManager.context;bu(r,this.props.parameters),this.props.onBeforeRender({gl:r}),this.deckRenderer.renderLayers({target:this.props._framebuffer,layers:this.layerManager.getLayers(),viewports:this.viewManager.getViewports(),onViewportActive:this.layerManager.activateViewport,views:this.viewManager.getViews(),pass:"screen",effects:this.effectManager.getEffects(),...t}),this.props.onAfterRender({gl:r})}_onRenderFrame(e){this._getFrameStats(),this._metricsCounter++%60===0&&(this._getMetrics(),this.stats.reset(),Fr.table(4,this.metrics)(),this.props._onMetrics&&this.props._onMetrics(this.metrics)),this._updateCanvasSize(),this._updateCursor(),this.tooltip.isVisible&&this.viewManager.needsRedraw()&&this.tooltip.setTooltip(null),this.layerManager.updateLayers(),this._pickAndCallback(),this.redraw(),this.viewManager&&this.viewManager.updateViewStates()}_onViewStateChange(e){const t=this.props.onViewStateChange(e)||e.viewState;this.viewState&&(this.viewState={...this.viewState,[e.viewId]:t},this.props.viewState||this.viewManager&&this.viewManager.setProps({viewState:this.viewState}))}_onInteractionStateChange(e){this.cursorState.isDragging=e.isDragging||!1,this.props.onInteractionStateChange(e)}_getFrameStats(){const{stats:e}=this;e.get("frameRate").timeEnd(),e.get("frameRate").timeStart();const t=this.animationLoop.stats;e.get("GPU Time").addTime(t.get("GPU Time").lastTiming),e.get("CPU Time").addTime(t.get("CPU Time").lastTiming)}_getMetrics(){const{metrics:e,stats:t}=this;e.fps=t.get("frameRate").getHz(),e.setPropsTime=t.get("setProps Time").time,e.updateAttributesTime=t.get("Update Attributes").time,e.framesRedrawn=t.get("Redraw Count").count,e.pickTime=t.get("pickObject Time").time+t.get("pickMultipleObjects Time").time+t.get("pickObjects Time").time,e.pickCount=t.get("Pick Count").count,e.gpuTime=t.get("GPU Time").time,e.cpuTime=t.get("CPU Time").time,e.gpuTimePerFrame=t.get("GPU Time").getAverageTime(),e.cpuTimePerFrame=t.get("CPU Time").getAverageTime();const r=gf.get("Memory Usage");e.bufferMemory=r.get("Buffer Memory").count,e.textureMemory=r.get("Texture Memory").count,e.renderbufferMemory=r.get("Renderbuffer Memory").count,e.gpuMemory=r.get("GPU Memory").count}}Y(mM,"defaultProps",H6);Y(mM,"VERSION",Mq);class sC{constructor(e,t){Y(this,"opts",void 0),Y(this,"source",void 0),this.opts=t,this.source=e}get value(){return this.source.value}getValue(){const e=this.source.getBuffer(),t=this.getAccessor();if(e)return[e,t];const{value:r}=this.source,{size:i}=t;let o=r;if(r&&r.length!==i){o=new Float32Array(i);const a=t.elementOffset||0;for(let l=0;l<i;++l)o[l]=r[a+l]}return o}getAccessor(){return{...this.source.getAccessor(),...this.opts}}}function fJ(n){switch(n){case 5126:return Float32Array;case 5130:return Float64Array;case 5123:case 33635:case 32819:case 32820:return Uint16Array;case 5125:return Uint32Array;case 5121:return Uint8ClampedArray;case 5120:return Int8Array;case 5122:return Int16Array;case 5124:return Int32Array;default:throw new Error("Unknown GL type")}}function kw(n){return n.stride||n.size*n.bytesPerElement}function G6(n,e){e.offset&&Fr.removed("shaderAttribute.offset","vertexOffset, elementOffset")();const t=kw(n),r=e.vertexOffset!==void 0?e.vertexOffset:n.vertexOffset||0,i=e.elementOffset||0,o=r*t+i*n.bytesPerElement+(n.offset||0);return{...e,offset:o,stride:t}}function pJ(n,e){const t=G6(n,e);return{high:t,low:{...t,offset:t.offset+n.size*4}}}class gJ{constructor(e,t,r){Y(this,"gl",void 0),Y(this,"id",void 0),Y(this,"size",void 0),Y(this,"settings",void 0),Y(this,"value",void 0),Y(this,"doublePrecision",void 0),Y(this,"_buffer",void 0),Y(this,"state",void 0),this.gl=e,this.id=t.id||"",this.size=t.size||1;const i=t.logicalType||t.type,o=i===5130;let{defaultValue:a}=t;a=Number.isFinite(a)?[a]:a||new Array(this.size).fill(0);let l;o?l=5126:!i&&t.isIndexed?l=e&&tW(e,Oi.ELEMENT_INDEX_UINT32)?5125:5123:l=i||5126;let h=fJ(i||l||5126);this.doublePrecision=o,o&&t.fp64===!1&&(h=Float32Array),this.value=null,this.settings={...t,defaultType:h,defaultValue:a,logicalType:i,type:l,size:this.size,bytesPerElement:h.BYTES_PER_ELEMENT},this.state={...r,externalBuffer:null,bufferAccessor:this.settings,allocatedValue:null,numInstances:0,bounds:null,constant:!1},this._buffer=null}get isConstant(){return this.state.constant}get buffer(){if(!this._buffer){const{isIndexed:e,type:t}=this.settings;this._buffer=new ui(this.gl,{id:this.id,target:e?34963:34962,accessor:{type:t}})}return this._buffer}get byteOffset(){const e=this.getAccessor();return e.vertexOffset?e.vertexOffset*kw(e):0}get numInstances(){return this.state.numInstances}set numInstances(e){this.state.numInstances=e}delete(){this._buffer&&(this._buffer.delete(),this._buffer=null),b0.release(this.state.allocatedValue)}getShaderAttributes(e,t){if(this.doublePrecision){const r={},i=this.value instanceof Float64Array,o=pJ(this.getAccessor(),t||{});return r[e]=new sC(this,o.high),r["".concat(e,"64Low")]=i?new sC(this,o.low):new Float32Array(this.size),r}if(t){const r=G6(this.getAccessor(),t);return{[e]:new sC(this,r)}}return{[e]:this}}getBuffer(){return this.state.constant?null:this.state.externalBuffer||this._buffer}getValue(){return this.state.constant?this.value:[this.getBuffer(),this.getAccessor()]}getAccessor(){return this.state.bufferAccessor}getBounds(){if(this.state.bounds)return this.state.bounds;let e=null;if(this.state.constant&&this.value){const t=Array.from(this.value);e=[t,t]}else{const{value:t,numInstances:r,size:i}=this,o=r*i;if(t&&o&&t.length>=o){const a=new Array(i).fill(1/0),l=new Array(i).fill(-1/0);for(let h=0;h<o;)for(let p=0;p<i;p++){const g=t[h++];g<a[p]&&(a[p]=g),g>l[p]&&(l[p]=g)}e=[a,l]}}return this.state.bounds=e,e}setData(e){const{state:t}=this;let r;ArrayBuffer.isView(e)?r={value:e}:e instanceof ui?r={buffer:e}:r=e;const i={...this.settings,...r};if(t.bufferAccessor=i,t.bounds=null,r.constant){let o=r.value;if(o=this._normalizeValue(o,[],0),this.settings.normalized&&(o=this.normalizeConstant(o)),!(!t.constant||!this._areValuesEqual(o,this.value)))return!1;t.externalBuffer=null,t.constant=!0,this.value=o}else if(r.buffer){const o=r.buffer;t.externalBuffer=o,t.constant=!1,this.value=r.value||null;const a=r.value instanceof Float64Array;i.type=r.type||o.accessor.type,i.bytesPerElement=o.accessor.BYTES_PER_ELEMENT*(a?2:1),i.stride=kw(i)}else if(r.value){this._checkExternalBuffer(r);let o=r.value;t.externalBuffer=null,t.constant=!1,this.value=o,i.bytesPerElement=o.BYTES_PER_ELEMENT,i.stride=kw(i);const{buffer:a,byteOffset:l}=this;this.doublePrecision&&o instanceof Float64Array&&(o=rC(o,i));const h=o.byteLength+l+i.stride*2;a.byteLength<h&&a.reallocate(h),a.setAccessor(null),a.subData({data:o,offset:l}),i.type=r.type||a.accessor.type}return!0}updateSubBuffer(e={}){this.state.bounds=null;const t=this.value,{startOffset:r=0,endOffset:i}=e;this.buffer.subData({data:this.doublePrecision&&t instanceof Float64Array?rC(t,{size:this.size,startIndex:r,endIndex:i}):t.subarray(r,i),offset:r*t.BYTES_PER_ELEMENT+this.byteOffset})}allocate(e,t=!1){const{state:r}=this,i=r.allocatedValue,o=b0.allocate(i,e+1,{size:this.size,type:this.settings.defaultType,copy:t});this.value=o;const{buffer:a,byteOffset:l}=this;return a.byteLength<o.byteLength+l&&(a.reallocate(o.byteLength+l),t&&i&&a.subData({data:i instanceof Float64Array?rC(i,this):i,offset:l})),r.allocatedValue=o,r.constant=!1,r.externalBuffer=null,r.bufferAccessor=this.settings,!0}_checkExternalBuffer(e){const{value:t}=e;if(!ArrayBuffer.isView(t))throw new Error("Attribute ".concat(this.id," value is not TypedArray"));const r=this.settings.defaultType;let i=!1;if(this.doublePrecision&&(i=t.BYTES_PER_ELEMENT<4),i)throw new Error("Attribute ".concat(this.id," does not support ").concat(t.constructor.name));!(t instanceof r)&&this.settings.normalized&&!("normalized"in e)&&Fr.warn("Attribute ".concat(this.id," is normalized"))()}normalizeConstant(e){switch(this.settings.type){case 5120:return new Float32Array(e).map(t=>(t+128)/255*2-1);case 5122:return new Float32Array(e).map(t=>(t+32768)/65535*2-1);case 5121:return new Float32Array(e).map(t=>t/255);case 5123:return new Float32Array(e).map(t=>t/65535);default:return e}}_normalizeValue(e,t,r){const{defaultValue:i,size:o}=this.settings;if(Number.isFinite(e))return t[r]=e,t;if(!e){let a=o;for(;--a>=0;)t[r+a]=i[a];return t}switch(o){case 4:t[r+3]=Number.isFinite(e[3])?e[3]:i[3];case 3:t[r+2]=Number.isFinite(e[2])?e[2]:i[2];case 2:t[r+1]=Number.isFinite(e[1])?e[1]:i[1];case 1:t[r+0]=Number.isFinite(e[0])?e[0]:i[0];break;default:let a=o;for(;--a>=0;)t[r+a]=Number.isFinite(e[a])?e[a]:i[a]}return t}_areValuesEqual(e,t){if(!e||!t)return!1;const{size:r}=this;for(let i=0;i<r;i++)if(e[i]!==t[i])return!1;return!0}}const lN=[],uN=[];function yM(n,e=0,t=1/0){let r=lN;const i={index:-1,data:n,target:[]};return n?typeof n[Symbol.iterator]=="function"?r=n:n.length>0&&(uN.length=n.length,r=uN):r=lN,(e>0||Number.isFinite(t))&&(r=(Array.isArray(r)?r:Array.from(r)).slice(e,t),i.index=e-1),{iterable:r,objectInfo:i}}function q6(n){return n&&n[Symbol.asyncIterator]}function mJ(n,e){const{size:t,stride:r,offset:i,startIndices:o,nested:a}=e,l=n.BYTES_PER_ELEMENT,h=r?r/l:t,p=i?i/l:0,g=Math.floor((n.length-p)/h);return(_,{index:x,target:C})=>{if(!o){const z=x*h+p;for(let te=0;te<t;te++)C[te]=n[z+te];return C}const M=o[x],L=o[x+1]||g;let D;if(a){D=new Array(L-M);for(let z=M;z<L;z++){const te=z*h+p;C=new Array(t);for(let le=0;le<t;le++)C[le]=n[te+le];D[z-M]=C}}else if(h===t)D=n.subarray(M*t+p,L*t+p);else{D=new n.constructor((L-M)*t);let z=0;for(let te=M;te<L;te++){const le=te*h+p;for(let ce=0;ce<t;ce++)D[z++]=n[le+ce]}}return D}}const yJ=[],Ow=[[0,1/0]];function _J(n,e){if(n===Ow||(e[0]<0&&(e[0]=0),e[0]>=e[1]))return n;const t=[],r=n.length;let i=0;for(let o=0;o<r;o++){const a=n[o];a[1]<e[0]?(t.push(a),i=o+1):a[0]>e[1]?t.push(a):e=[Math.min(a[0],e[0]),Math.max(a[1],e[1])]}return t.splice(i,0,e),t}function cC(n){const{source:e,target:t,start:r=0,size:i,getData:o}=n,a=n.end||t.length,l=e.length,h=a-r;if(l>h){t.set(e.subarray(0,h),r);return}if(t.set(e,r),!o)return;let p=l;for(;p<h;){const g=o(p,e);for(let _=0;_<i;_++)t[r+p]=g[_]||0,p++}}function vJ({source:n,target:e,size:t,getData:r,sourceStartIndices:i,targetStartIndices:o}){if(!Array.isArray(o))return cC({source:n,target:e,size:t,getData:r}),e;let a=0,l=0;const h=r&&((g,_)=>r(g+l,_)),p=Math.min(i.length,o.length);for(let g=1;g<p;g++){const _=i[g]*t,x=o[g]*t;cC({source:n.subarray(a,_),target:e,start:l,end:x,size:t,getData:h}),a=_,l=x}return l<e.length&&cC({source:[],target:e,start:l,size:t,getData:h}),e}const bJ={interpolation:{duration:0,easing:n=>n},spring:{stiffness:.05,damping:.5}};function $6(n,e){if(!n)return null;Number.isFinite(n)&&(n={type:"interpolation",duration:n});const t=n.type||"interpolation";return{...bJ[t],...e,...n,type:t}}function W6(n,e){const t=e.getBuffer();return t?[t,{divisor:0,size:e.size,normalized:e.settings.normalized}]:e.value}function Y6(n){switch(n){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error('No defined attribute type for size "'.concat(n,'"'))}}function K6(n){n.push(n.shift())}function _M(n,e){const{doublePrecision:t,settings:r,value:i,size:o}=n,a=t&&i instanceof Float64Array?2:1;return(r.noAlloc?i.length:e*o)*a}function Z6({buffer:n,numInstances:e,attribute:t,fromLength:r,fromStartIndices:i,getData:o=a=>a}){const a=t.doublePrecision&&t.value instanceof Float64Array?2:1,l=t.size*a,h=t.byteOffset,p=t.startIndices,g=i&&p,_=_M(t,e),x=t.isConstant;if(!g&&r>=_)return;const C=x?t.value:t.getBuffer().getData({srcByteOffset:h});if(t.settings.normalized&&!x){const z=o;o=(te,le)=>t.normalizeConstant(z(te,le))}const M=x?(z,te)=>o(C,te):(z,te)=>o(C.subarray(z,z+l),te),L=n.getData({length:r}),D=new Float32Array(_);vJ({source:L,target:D,sourceStartIndices:i,targetStartIndices:p,size:l,getData:M}),n.byteLength<D.byteLength+h&&n.reallocate(D.byteLength+h),n.subData({data:D,offset:h})}class vM extends gJ{constructor(e,t){super(e,t,{startIndices:null,lastExternalBuffer:null,binaryValue:null,binaryAccessor:null,needsUpdate:!0,needsRedraw:!1,updateRanges:Ow}),Y(this,"constant",!1),this.settings.update=t.update||(t.accessor?this._autoUpdater:void 0),Object.seal(this.settings),Object.seal(this.state),this._validateAttributeUpdaters()}get startIndices(){return this.state.startIndices}set startIndices(e){this.state.startIndices=e}needsUpdate(){return this.state.needsUpdate}needsRedraw({clearChangedFlags:e=!1}={}){const t=this.state.needsRedraw;return this.state.needsRedraw=t&&!e,t}getUpdateTriggers(){const{accessor:e}=this.settings;return[this.id].concat(typeof e!="function"&&e||[])}supportsTransition(){return!!this.settings.transition}getTransitionSetting(e){if(!e||!this.supportsTransition())return null;const{accessor:t}=this.settings,r=this.settings.transition,i=Array.isArray(t)?e[t.find(o=>e[o])]:e[t];return $6(i,r)}setNeedsUpdate(e=this.id,t){if(this.state.needsUpdate=this.state.needsUpdate||e,this.setNeedsRedraw(e),t){const{startRow:r=0,endRow:i=1/0}=t;this.state.updateRanges=_J(this.state.updateRanges,[r,i])}else this.state.updateRanges=Ow}clearNeedsUpdate(){this.state.needsUpdate=!1,this.state.updateRanges=yJ}setNeedsRedraw(e=this.id){this.state.needsRedraw=this.state.needsRedraw||e}allocate(e){const{state:t,settings:r}=this;return r.noAlloc?!1:r.update?(super.allocate(e,t.updateRanges!==Ow),!0):!1}updateBuffer({numInstances:e,data:t,props:r,context:i}){if(!this.needsUpdate())return!1;const{state:{updateRanges:o},settings:{update:a,noAlloc:l}}=this;let h=!0;if(a){for(const[p,g]of o)a.call(i,this,{data:t,startRow:p,endRow:g,props:r,numInstances:e});if(this.value)if(this.constant||this.buffer.byteLength<this.value.byteLength+this.byteOffset)this.setData({value:this.value,constant:this.constant}),this.constant=!1;else for(const[p,g]of o){const _=Number.isFinite(p)?this.getVertexOffset(p):0,x=Number.isFinite(g)?this.getVertexOffset(g):l||!Number.isFinite(e)?this.value.length:e*this.size;super.updateSubBuffer({startOffset:_,endOffset:x})}this._checkAttributeArray()}else h=!1;return this.clearNeedsUpdate(),this.setNeedsRedraw(),h}setConstantValue(e){return e===void 0||typeof e=="function"?!1:(this.setData({constant:!0,value:e})&&this.setNeedsRedraw(),this.clearNeedsUpdate(),!0)}setExternalBuffer(e){const{state:t}=this;return e?(this.clearNeedsUpdate(),t.lastExternalBuffer===e||(t.lastExternalBuffer=e,this.setNeedsRedraw(),this.setData(e)),!0):(t.lastExternalBuffer=null,!1)}setBinaryValue(e,t=null){const{state:r,settings:i}=this;if(!e)return r.binaryValue=null,r.binaryAccessor=null,!1;if(i.noAlloc)return!1;if(r.binaryValue===e)return this.clearNeedsUpdate(),!0;if(r.binaryValue=e,this.setNeedsRedraw(),i.transform||t!==this.startIndices){ArrayBuffer.isView(e)&&(e={value:e});const a=e;Yo(ArrayBuffer.isView(a.value),"invalid ".concat(i.accessor));const l=!!a.size&&a.size!==this.size;return r.binaryAccessor=mJ(a.value,{size:a.size||this.size,stride:a.stride,offset:a.offset,startIndices:t,nested:l}),!1}return this.clearNeedsUpdate(),this.setData(e),!0}getVertexOffset(e){const{startIndices:t}=this;return(t?e<t.length?t[e]:this.numInstances:e)*this.size}getShaderAttributes(){const e=this.settings.shaderAttributes||{[this.id]:null},t={};for(const r in e)Object.assign(t,super.getShaderAttributes(r,e[r]));return t}_autoUpdater(e,{data:t,startRow:r,endRow:i,props:o,numInstances:a}){if(e.constant)return;const{settings:l,state:h,value:p,size:g,startIndices:_}=e,{accessor:x,transform:C}=l,M=h.binaryAccessor||(typeof x=="function"?x:o[x]);Yo(typeof M=="function",'accessor "'.concat(x,'" is not a function'));let L=e.getVertexOffset(r);const{iterable:D,objectInfo:z}=yM(t,r,i);for(const te of D){z.index++;let le=M(te,z);if(C&&(le=C.call(this,le)),_){const ce=(z.index<_.length-1?_[z.index+1]:a)-_[z.index];if(le&&Array.isArray(le[0])){let _e=L;for(const J of le)e._normalizeValue(J,p,_e),_e+=g}else le&&le.length>g?p.set(le,L):(e._normalizeValue(le,z.target,0),$X({target:p,source:z.target,start:L,count:ce}));L+=ce*g}else e._normalizeValue(le,p,L),L+=g}}_validateAttributeUpdaters(){const{settings:e}=this;if(!(e.noAlloc||typeof e.update=="function"))throw new Error("Attribute ".concat(this.id," missing update or accessor"))}_checkAttributeArray(){const{value:e}=this,t=Math.min(4,this.size);if(e&&e.length>=t){let r=!0;switch(t){case 4:r=r&&Number.isFinite(e[3]);case 3:r=r&&Number.isFinite(e[2]);case 2:r=r&&Number.isFinite(e[1]);case 1:r=r&&Number.isFinite(e[0]);break;default:r=!1}if(!r)throw new Error("Illegal attribute generated for ".concat(this.id))}}}class wJ{constructor({gl:e,attribute:t,timeline:r}){Y(this,"gl",void 0),Y(this,"type","interpolation"),Y(this,"attributeInTransition",void 0),Y(this,"settings",void 0),Y(this,"attribute",void 0),Y(this,"transition",void 0),Y(this,"currentStartIndices",void 0),Y(this,"currentLength",void 0),Y(this,"transform",void 0),Y(this,"buffers",void 0),this.gl=e,this.transition=new ob(r),this.attribute=t,this.attributeInTransition=new vM(e,t.settings),this.currentStartIndices=t.startIndices,this.currentLength=0,this.transform=EJ(e,t);const i={byteLength:0,usage:35050};this.buffers=[new ui(e,i),new ui(e,i)]}get inProgress(){return this.transition.inProgress}start(e,t){if(e.duration<=0){this.transition.cancel();return}this.settings=e;const{gl:r,buffers:i,attribute:o}=this;K6(i);const a={numInstances:t,attribute:o,fromLength:this.currentLength,fromStartIndices:this.currentStartIndices,getData:e.enter};for(const l of i)Z6({buffer:l,...a});this.currentStartIndices=o.startIndices,this.currentLength=_M(o,t),this.attributeInTransition.setData({buffer:i[1],value:o.value}),this.transition.start(e),this.transform.update({elementCount:Math.floor(this.currentLength/o.size),sourceBuffers:{aFrom:i[0],aTo:W6(r,o)},feedbackBuffers:{vCurrent:i[1]}})}update(){const e=this.transition.update();if(e){const{duration:t,easing:r}=this.settings,{time:i}=this.transition;let o=i/t;r&&(o=r(o)),this.transform.run({uniforms:{time:o}})}return e}cancel(){this.transition.cancel(),this.transform.delete();for(const e of this.buffers)e.delete();this.buffers.length=0}}const xJ=`
#define SHADER_NAME interpolation-transition-vertex-shader

uniform float time;
attribute ATTRIBUTE_TYPE aFrom;
attribute ATTRIBUTE_TYPE aTo;
varying ATTRIBUTE_TYPE vCurrent;

void main(void) {
  vCurrent = mix(aFrom, aTo, time);
  gl_Position = vec4(0.0);
}
`;function EJ(n,e){const t=Y6(e.size);return new sM(n,{vs:xJ,defines:{ATTRIBUTE_TYPE:t},varyings:["vCurrent"]})}class TJ{constructor({gl:e,attribute:t,timeline:r}){Y(this,"gl",void 0),Y(this,"type","spring"),Y(this,"attributeInTransition",void 0),Y(this,"settings",void 0),Y(this,"attribute",void 0),Y(this,"transition",void 0),Y(this,"currentStartIndices",void 0),Y(this,"currentLength",void 0),Y(this,"texture",void 0),Y(this,"framebuffer",void 0),Y(this,"transform",void 0),Y(this,"buffers",void 0),this.gl=e,this.type="spring",this.transition=new ob(r),this.attribute=t,this.attributeInTransition=new vM(e,{...t.settings,normalized:!1}),this.currentStartIndices=t.startIndices,this.currentLength=0,this.texture=CJ(e),this.framebuffer=AJ(e,this.texture),this.transform=SJ(e,t,this.framebuffer);const i={byteLength:0,usage:35050};this.buffers=[new ui(e,i),new ui(e,i),new ui(e,i)]}get inProgress(){return this.transition.inProgress}start(e,t){const{gl:r,buffers:i,attribute:o}=this,a={numInstances:t,attribute:o,fromLength:this.currentLength,fromStartIndices:this.currentStartIndices,getData:e.enter};for(const l of i)Z6({buffer:l,...a});this.settings=e,this.currentStartIndices=o.startIndices,this.currentLength=_M(o,t),this.attributeInTransition.setData({buffer:i[1],value:o.value}),this.transition.start({...e,duration:1/0}),this.transform.update({elementCount:Math.floor(this.currentLength/o.size),sourceBuffers:{aTo:W6(r,o)}})}update(){const{buffers:e,transform:t,framebuffer:r,transition:i}=this;if(!i.update())return!1;const a=this.settings;return t.update({sourceBuffers:{aPrev:e[0],aCur:e[1]},feedbackBuffers:{vNext:e[2]}}),t.run({framebuffer:r,discard:!1,clearRenderTarget:!0,uniforms:{stiffness:a.stiffness,damping:a.damping},parameters:{depthTest:!1,blend:!0,viewport:[0,0,1,1],blendFunc:[1,1],blendEquation:[32776,32776]}}),K6(e),this.attributeInTransition.setData({buffer:e[1],value:this.attribute.value}),QE(r)[0]>0||i.end(),!0}cancel(){this.transition.cancel(),this.transform.delete();for(const e of this.buffers)e.delete();this.buffers.length=0,this.texture.delete(),this.framebuffer.delete()}}function SJ(n,e,t){const r=Y6(e.size);return new sM(n,{framebuffer:t,vs:`
#define SHADER_NAME spring-transition-vertex-shader

#define EPSILON 0.00001

uniform float stiffness;
uniform float damping;
attribute ATTRIBUTE_TYPE aPrev;
attribute ATTRIBUTE_TYPE aCur;
attribute ATTRIBUTE_TYPE aTo;
varying ATTRIBUTE_TYPE vNext;
varying float vIsTransitioningFlag;

ATTRIBUTE_TYPE getNextValue(ATTRIBUTE_TYPE cur, ATTRIBUTE_TYPE prev, ATTRIBUTE_TYPE dest) {
  ATTRIBUTE_TYPE velocity = cur - prev;
  ATTRIBUTE_TYPE delta = dest - cur;
  ATTRIBUTE_TYPE spring = delta * stiffness;
  ATTRIBUTE_TYPE damper = velocity * -1.0 * damping;
  return spring + damper + velocity + cur;
}

void main(void) {
  bool isTransitioning = length(aCur - aPrev) > EPSILON || length(aTo - aCur) > EPSILON;
  vIsTransitioningFlag = isTransitioning ? 1.0 : 0.0;

  vNext = getNextValue(aCur, aPrev, aTo);
  gl_Position = vec4(0, 0, 0, 1);
  gl_PointSize = 100.0;
}
`,fs:`
#define SHADER_NAME spring-transition-is-transitioning-fragment-shader

varying float vIsTransitioningFlag;

void main(void) {
  if (vIsTransitioningFlag == 0.0) {
    discard;
  }
  gl_FragColor = vec4(1.0);
}`,defines:{ATTRIBUTE_TYPE:r},varyings:["vNext"]})}function CJ(n){return new Bs(n,{data:new Uint8Array(4),format:6408,type:5121,border:0,mipmaps:!1,dataFormat:6408,width:1,height:1})}function AJ(n,e){return new Co(n,{id:"spring-transition-is-transitioning-framebuffer",width:1,height:1,attachments:{36064:e}})}const IJ={interpolation:wJ,spring:TJ};class PJ{constructor(e,{id:t,timeline:r}){Y(this,"id",void 0),Y(this,"isSupported",void 0),Y(this,"gl",void 0),Y(this,"timeline",void 0),Y(this,"transitions",void 0),Y(this,"needsRedraw",void 0),Y(this,"numInstances",void 0),this.id=t,this.gl=e,this.timeline=r,this.transitions={},this.needsRedraw=!1,this.numInstances=1,this.isSupported=sM.isSupported(e)}finalize(){for(const e in this.transitions)this._removeTransition(e)}update({attributes:e,transitions:t,numInstances:r}){this.numInstances=r||1;for(const i in e){const o=e[i],a=o.getTransitionSetting(t);a&&this._updateAttribute(i,o,a)}for(const i in this.transitions){const o=e[i];(!o||!o.getTransitionSetting(t))&&this._removeTransition(i)}}hasAttribute(e){const t=this.transitions[e];return t&&t.inProgress}getAttributes(){const e={};for(const t in this.transitions){const r=this.transitions[t];r.inProgress&&(e[t]=r.attributeInTransition)}return e}run(){if(!this.isSupported||this.numInstances===0)return!1;for(const t in this.transitions)this.transitions[t].update()&&(this.needsRedraw=!0);const e=this.needsRedraw;return this.needsRedraw=!1,e}_removeTransition(e){this.transitions[e].cancel(),delete this.transitions[e]}_updateAttribute(e,t,r){const i=this.transitions[e];let o=!i||i.type!==r.type;if(o){if(!this.isSupported){Fr.warn("WebGL2 not supported by this browser. Transition for ".concat(e," is disabled."))();return}i&&this._removeTransition(e);const a=IJ[r.type];a?this.transitions[e]=new a({attribute:t,timeline:this.timeline,gl:this.gl}):(Fr.error("unsupported transition type '".concat(r.type,"'"))(),o=!1)}(o||t.needsRedraw())&&(this.needsRedraw=!0,this.transitions[e].start(r,this.numInstances))}}const hN="attributeManager.invalidate",MJ="attributeManager.updateStart",RJ="attributeManager.updateEnd",kJ="attribute.updateStart",OJ="attribute.allocate",LJ="attribute.updateEnd";class NJ{constructor(e,{id:t="attribute-manager",stats:r,timeline:i}={}){Y(this,"id",void 0),Y(this,"gl",void 0),Y(this,"attributes",void 0),Y(this,"updateTriggers",void 0),Y(this,"needsRedraw",void 0),Y(this,"userData",void 0),Y(this,"stats",void 0),Y(this,"attributeTransitionManager",void 0),Y(this,"mergeBoundsMemoized",ib(FX)),this.id=t,this.gl=e,this.attributes={},this.updateTriggers={},this.needsRedraw=!0,this.userData={},this.stats=r,this.attributeTransitionManager=new PJ(e,{id:"".concat(t,"-transitions"),timeline:i}),Object.seal(this)}finalize(){for(const e in this.attributes)this.attributes[e].delete();this.attributeTransitionManager.finalize()}getNeedsRedraw(e={clearRedrawFlags:!1}){const t=this.needsRedraw;return this.needsRedraw=this.needsRedraw&&!e.clearRedrawFlags,t&&this.id}setNeedsRedraw(){this.needsRedraw=!0}add(e){this._add(e)}addInstanced(e){this._add(e,{instanced:1})}remove(e){for(const t of e)this.attributes[t]!==void 0&&(this.attributes[t].delete(),delete this.attributes[t])}invalidate(e,t){const r=this._invalidateTrigger(e,t);fa(hN,this,e,r)}invalidateAll(e){for(const t in this.attributes)this.attributes[t].setNeedsUpdate(t,e);fa(hN,this,"all")}update({data:e,numInstances:t,startIndices:r=null,transitions:i,props:o={},buffers:a={},context:l={}}){let h=!1;fa(MJ,this),this.stats&&this.stats.get("Update Attributes").timeStart();for(const p in this.attributes){const g=this.attributes[p],_=g.settings.accessor;g.startIndices=r,g.numInstances=t,o[p]&&Fr.removed("props.".concat(p),"data.attributes.".concat(p))(),g.setExternalBuffer(a[p])||g.setBinaryValue(typeof _=="string"?a[_]:void 0,e.startIndices)||typeof _=="string"&&!a[_]&&g.setConstantValue(o[_])||g.needsUpdate()&&(h=!0,this._updateAttribute({attribute:g,numInstances:t,data:e,props:o,context:l})),this.needsRedraw=this.needsRedraw||g.needsRedraw()}h&&fa(RJ,this,t),this.stats&&this.stats.get("Update Attributes").timeEnd(),this.attributeTransitionManager.update({attributes:this.attributes,numInstances:t,transitions:i})}updateTransition(){const{attributeTransitionManager:e}=this,t=e.run();return this.needsRedraw=this.needsRedraw||t,t}getAttributes(){return this.attributes}getBounds(e){const t=e.map(r=>{var i;return(i=this.attributes[r])===null||i===void 0?void 0:i.getBounds()});return this.mergeBoundsMemoized(t)}getChangedAttributes(e={clearChangedFlags:!1}){const{attributes:t,attributeTransitionManager:r}=this,i={...r.getAttributes()};for(const o in t){const a=t[o];a.needsRedraw(e)&&!r.hasAttribute(o)&&(i[o]=a)}return i}getShaderAttributes(e,t={}){e||(e=this.getAttributes());const r={};for(const i in e)t[i]||Object.assign(r,e[i].getShaderAttributes());return r}_add(e,t={}){for(const r in e){const i=e[r];this.attributes[r]=this._createAttribute(r,i,t)}this._mapUpdateTriggersToAttributes()}_createAttribute(e,t,r){const i={...t,id:e,size:t.isIndexed&&1||t.size||1,divisor:r.instanced?1:t.divisor||0};return new vM(this.gl,i)}_mapUpdateTriggersToAttributes(){const e={};for(const t in this.attributes)this.attributes[t].getUpdateTriggers().forEach(i=>{e[i]||(e[i]=[]),e[i].push(t)});this.updateTriggers=e}_invalidateTrigger(e,t){const{attributes:r,updateTriggers:i}=this,o=i[e];return o&&o.forEach(a=>{const l=r[a];l&&l.setNeedsUpdate(l.id,t)}),o}_updateAttribute(e){const{attribute:t,numInstances:r}=e;if(fa(kJ,t),t.constant){t.setConstantValue(t.value);return}t.allocate(r)&&fa(OJ,t,r),t.updateBuffer(e)&&(this.needsRedraw=!0,fa(LJ,t,r))}}class DJ extends ob{get value(){return this._value}_onUpdate(){const{time:e,settings:{fromValue:t,toValue:r,duration:i,easing:o}}=this,a=o(e/i);this._value=fx(t,r,a)}}const dN=1e-5;function fN(n,e,t,r,i){const o=e-n,l=(t-e)*i,h=-o*r;return l+h+o+e}function FJ(n,e,t,r,i){if(Array.isArray(t)){const o=[];for(let a=0;a<t.length;a++)o[a]=fN(n[a],e[a],t[a],r,i);return o}return fN(n,e,t,r,i)}function pN(n,e){if(Array.isArray(n)){let t=0;for(let r=0;r<n.length;r++){const i=n[r]-e[r];t+=i*i}return Math.sqrt(t)}return Math.abs(n-e)}class BJ extends ob{get value(){return this._currValue}_onUpdate(){const{fromValue:e,toValue:t,damping:r,stiffness:i}=this.settings,{_prevValue:o=e,_currValue:a=e}=this;let l=FJ(o,a,t,r,i);const h=pN(l,t),p=pN(l,a);h<dN&&p<dN&&(l=t,this.end()),this._prevValue=a,this._currValue=l}}const UJ={interpolation:DJ,spring:BJ};class zJ{constructor(e){this.transitions=new Map,this.timeline=e}get active(){return this.transitions.size>0}add(e,t,r,i){const{transitions:o}=this;if(o.has(e)){const h=o.get(e),{value:p=h.settings.fromValue}=h;t=p,this.remove(e)}if(i=$6(i),!i)return;const a=UJ[i.type];if(!a){Fr.error("unsupported transition type '".concat(i.type,"'"))();return}const l=new a(this.timeline);l.start({...i,fromValue:t,toValue:r}),o.set(e,l)}remove(e){const{transitions:t}=this;t.has(e)&&(t.get(e).cancel(),t.delete(e))}update(){const e={};for(const[t,r]of this.transitions)r.update(),e[t]=r.value,r.inProgress||this.remove(t);return e}clear(){for(const e of this.transitions.keys())this.remove(e)}}function jJ(n){const e=n[Wh];for(const t in e){const r=e[t],{validate:i}=r;if(i&&!i(n[t],r))throw new Error("Invalid prop ".concat(t,": ").concat(n[t]))}}function VJ(n,e){const t=X6({newProps:n,oldProps:e,propTypes:n[Wh],ignoreProps:{data:null,updateTriggers:null,extensions:null,transitions:null}}),r=GJ(n,e);let i=!1;return r||(i=qJ(n,e)),{dataChanged:r,propsChanged:t,updateTriggersChanged:i,extensionsChanged:$J(n,e),transitionsChanged:HJ(n,e)}}function HJ(n,e){if(!n.transitions)return!1;const t={},r=n[Wh];let i=!1;for(const o in n.transitions){const a=r[o],l=a&&a.type;(l==="number"||l==="color"||l==="array")&&U2(n[o],e[o],a)&&(t[o]=!0,i=!0)}return i?t:!1}function X6({newProps:n,oldProps:e,ignoreProps:t={},propTypes:r={},triggerName:i="props"}){if(e===n)return!1;if(typeof n!="object"||n===null||typeof e!="object"||e===null)return"".concat(i," changed shallowly");for(const o of Object.keys(n))if(!(o in t)){if(!(o in e))return"".concat(i,".").concat(o," added");const a=U2(n[o],e[o],r[o]);if(a)return"".concat(i,".").concat(o," ").concat(a)}for(const o of Object.keys(e))if(!(o in t)){if(!(o in n))return"".concat(i,".").concat(o," dropped");if(!Object.hasOwnProperty.call(n,o)){const a=U2(n[o],e[o],r[o]);if(a)return"".concat(i,".").concat(o," ").concat(a)}}return!1}function U2(n,e,t){let r=t&&t.equal;return r&&!r(n,e,t)||!r&&(r=n&&e&&n.equals,r&&!r.call(n,e))?"changed deeply":!r&&e!==n?"changed shallowly":null}function GJ(n,e){if(e===null)return"oldProps is null, initial diff";let t=!1;const{dataComparator:r,_dataDiff:i}=n;return r?r(n.data,e.data)||(t="Data comparator detected a change"):n.data!==e.data&&(t="A new data container was supplied"),t&&i&&(t=i(n.data,e.data)||t),t}function qJ(n,e){if(e===null)return{all:!0};if("all"in n.updateTriggers&&gN(n,e,"all"))return{all:!0};const t={};let r=!1;for(const i in n.updateTriggers)i!=="all"&&gN(n,e,i)&&(t[i]=!0,r=!0);return r?t:!1}function $J(n,e){if(e===null)return!0;const t=e.extensions,{extensions:r}=n;if(r===t)return!1;if(!t||!r||r.length!==t.length)return!0;for(let i=0;i<r.length;i++)if(!r[i].equals(t[i]))return!0;return!1}function gN(n,e,t){let r=n.updateTriggers[t];r=r??{};let i=e.updateTriggers[t];return i=i??{},X6({oldProps:i,newProps:r,triggerName:t})}const WJ="count(): argument not an object",YJ="count(): argument not a container";function KJ(n){if(!XJ(n))throw new Error(WJ);if(typeof n.count=="function")return n.count();if(Number.isFinite(n.size))return n.size;if(Number.isFinite(n.length))return n.length;if(ZJ(n))return Object.keys(n).length;throw new Error(YJ)}function ZJ(n){return n!==null&&typeof n=="object"&&n.constructor===Object}function XJ(n){return n!==null&&typeof n=="object"}function QJ(n,e){if(!e)return n;const t={...n,...e};if("defines"in e&&(t.defines={...n.defines,...e.defines}),"modules"in e&&(t.modules=(n.modules||[]).concat(e.modules),e.modules.some(r=>r.name==="project64"))){const r=t.modules.findIndex(i=>i.name==="project32");r>=0&&t.modules.splice(r,1)}if("inject"in e)if(!n.inject)t.inject=e.inject;else{const r={...n.inject};for(const i in e.inject)r[i]=(r[i]||"")+e.inject[i];t.inject=r}return t}const JJ={10241:9987,10240:9729,10242:33071,10243:33071},z2={};function eee(n,e,t,r){if(t instanceof Bs)return t;t.constructor&&t.constructor.name!=="Object"&&(t={data:t});let i=null;t.compressed&&(i={10241:t.data.length>1?9985:9729});const o=new Bs(e,{...t,parameters:{...JJ,...i,...r}});return z2[o.id]=n,o}function tee(n,e){!e||!(e instanceof Bs)||z2[e.id]===n&&(e.delete(),delete z2[e.id])}const nee={boolean:{validate(n,e){return!0},equal(n,e,t){return!!n==!!e}},number:{validate(n,e){return Number.isFinite(n)&&(!("max"in e)||n<=e.max)&&(!("min"in e)||n>=e.min)}},color:{validate(n,e){return e.optional&&!n||j2(n)&&(n.length===3||n.length===4)},equal(n,e,t){return ul(n,e,1)}},accessor:{validate(n,e){const t=bx(n);return t==="function"||t===bx(e.value)},equal(n,e,t){return typeof e=="function"?!0:ul(n,e,1)}},array:{validate(n,e){return e.optional&&!n||j2(n)},equal(n,e,t){const{compare:r}=t,i=Number.isInteger(r)?r:r?1:0;return r?ul(n,e,i):n===e}},object:{equal(n,e,t){if(t.ignore)return!0;const{compare:r}=t,i=Number.isInteger(r)?r:r?1:0;return r?ul(n,e,i):n===e}},function:{validate(n,e){return e.optional&&!n||typeof n=="function"},equal(n,e,t){return!t.compare&&t.ignore!==!1||n===e}},data:{transform:(n,e,t)=>{const{dataTransform:r}=t.props;return r&&n?r(n):n}},image:{transform:(n,e,t)=>{const r=t.context;return!r||!r.gl?null:eee(t.id,r.gl,n,{...e.parameters,...t.props.textureParameters})},release:(n,e,t)=>{tee(t.id,n)}}};function ree(n){const e={},t={},r={};for(const[i,o]of Object.entries(n)){const a=o==null?void 0:o.deprecatedFor;if(a)r[i]=Array.isArray(a)?a:[a];else{const l=iee(i,o);e[i]=l,t[i]=l.value}}return{propTypes:e,defaultProps:t,deprecatedProps:r}}function iee(n,e){switch(bx(e)){case"object":return P_(n,e);case"array":return P_(n,{type:"array",value:e,compare:!1});case"boolean":return P_(n,{type:"boolean",value:e});case"number":return P_(n,{type:"number",value:e});case"function":return P_(n,{type:"function",value:e,compare:!0});default:return{name:n,type:"unknown",value:e}}}function P_(n,e){return"type"in e?{name:n,...nee[e.type],...e}:"value"in e?{name:n,type:bx(e.value),...e}:{name:n,type:"object",value:e}}function j2(n){return Array.isArray(n)||ArrayBuffer.isView(n)}function bx(n){return j2(n)?"array":n===null?"null":typeof n}function oee(n,e){let t;for(let o=e.length-1;o>=0;o--){const a=e[o];"extensions"in a&&(t=a.extensions)}const r=V2(n.constructor,t),i=Object.create(r);i[vx]=n,i[jf]={},i[jh]={};for(let o=0;o<e.length;++o){const a=e[o];for(const l in a)i[l]=a[l]}return Object.freeze(i),i}const aee="_mergedDefaultProps";function V2(n,e){let t=aee;if(e)for(const i of e){const o=i.constructor;o&&(t+=":".concat(o.extensionName||o.name))}const r=Q6(n,t);return r||(n[t]=see(n,e||[]))}function see(n,e){if(!n.prototype)return null;const r=Object.getPrototypeOf(n),i=V2(r),o=Q6(n,"defaultProps")||{},a=ree(o),l=Object.assign(Object.create(null),i,a.defaultProps),h=Object.assign(Object.create(null),i==null?void 0:i[Wh],a.propTypes),p=Object.assign(Object.create(null),i==null?void 0:i[oC],a.deprecatedProps);for(const g of e){const _=V2(g.constructor);_&&(Object.assign(l,_),Object.assign(h,_[Wh]),Object.assign(p,_[oC]))}return cee(l,n),uee(l,h),lee(l,p),l[Wh]=h,l[oC]=p,e.length===0&&!bM(n,"_propTypes")&&(n._propTypes=h),l}function cee(n,e){const t=dee(e);Object.defineProperties(n,{id:{writable:!0,value:t}})}function lee(n,e){for(const t in e)Object.defineProperty(n,t,{enumerable:!1,set(r){const i="".concat(this.id,": ").concat(t);for(const o of e[t])bM(this,o)||(this[o]=r);Fr.deprecated(i,e[t].join("/"))()}})}function uee(n,e){const t={},r={};for(const i in e){const o=e[i],{name:a,value:l}=o;o.async&&(t[a]=l,r[a]=hee(a))}n[mm]=t,n[jf]={},Object.defineProperties(n,r)}function hee(n){return{enumerable:!0,set(e){typeof e=="string"||e instanceof Promise||q6(e)?this[jf][n]=e:this[jh][n]=e},get(){if(this[jh]){if(n in this[jh])return this[jh][n]||this[mm][n];if(n in this[jf]){const e=this[vx]&&this[vx].internalState;if(e&&e.hasAsyncProp(n))return e.getAsyncProp(n)||this[mm][n]}}return this[mm][n]}}}function bM(n,e){return Object.prototype.hasOwnProperty.call(n,e)}function Q6(n,e){return bM(n,e)&&n[e]}function dee(n){const e=n.componentName;return e||Fr.warn("".concat(n.name,".componentName not specified"))(),e||n.name}let fee=0;class wM{constructor(...e){Y(this,"id",void 0),Y(this,"props",void 0),Y(this,"count",void 0),this.props=oee(this,e),this.id=this.props.id,this.count=fee++}clone(e){const{props:t}=this,r={};for(const i in t[mm])i in t[jh]?r[i]=t[jh][i]:i in t[jf]&&(r[i]=t[jf][i]);return new this.constructor({...t,...r,...e})}}Y(wM,"componentName","Component");Y(wM,"defaultProps",{});const pee=Object.freeze({});class gee{constructor(e){Y(this,"component",void 0),Y(this,"onAsyncPropUpdated",void 0),Y(this,"asyncProps",void 0),Y(this,"oldProps",void 0),Y(this,"oldAsyncProps",void 0),this.component=e,this.asyncProps={},this.onAsyncPropUpdated=()=>{},this.oldProps=null,this.oldAsyncProps=null}finalize(){for(const e in this.asyncProps){const t=this.asyncProps[e];t&&t.type&&t.type.release&&t.type.release(t.resolvedValue,t.type,this.component)}this.asyncProps={},this.component=null,this.resetOldProps()}getOldProps(){return this.oldAsyncProps||this.oldProps||pee}resetOldProps(){this.oldAsyncProps=null,this.oldProps=this.component?this.component.props:null}hasAsyncProp(e){return e in this.asyncProps}getAsyncProp(e){const t=this.asyncProps[e];return t&&t.resolvedValue}isAsyncPropLoading(e){if(e){const t=this.asyncProps[e];return!!(t&&t.pendingLoadCount>0&&t.pendingLoadCount!==t.resolvedLoadCount)}for(const t in this.asyncProps)if(this.isAsyncPropLoading(t))return!0;return!1}reloadAsyncProp(e,t){this._watchPromise(e,Promise.resolve(t))}setAsyncProps(e){this.component=e[vx]||this.component;const t=e[jh]||{},r=e[jf]||e,i=e[mm]||{};for(const o in t){const a=t[o];this._createAsyncPropData(o,i[o]),this._updateAsyncProp(o,a),t[o]=this.getAsyncProp(o)}for(const o in r){const a=r[o];this._createAsyncPropData(o,i[o]),this._updateAsyncProp(o,a)}}_fetch(e,t){return null}_onResolve(e,t){}_onError(e,t){}_updateAsyncProp(e,t){if(this._didAsyncInputValueChange(e,t)){if(typeof t=="string"&&(t=this._fetch(e,t)),t instanceof Promise){this._watchPromise(e,t);return}if(q6(t)){this._resolveAsyncIterable(e,t);return}this._setPropValue(e,t)}}_freezeAsyncOldProps(){if(!this.oldAsyncProps&&this.oldProps){this.oldAsyncProps=Object.create(this.oldProps);for(const e in this.asyncProps)Object.defineProperty(this.oldAsyncProps,e,{enumerable:!0,value:this.oldProps[e]})}}_didAsyncInputValueChange(e,t){const r=this.asyncProps[e];return t===r.resolvedValue||t===r.lastValue?!1:(r.lastValue=t,!0)}_setPropValue(e,t){this._freezeAsyncOldProps();const r=this.asyncProps[e];r&&(t=this._postProcessValue(r,t),r.resolvedValue=t,r.pendingLoadCount++,r.resolvedLoadCount=r.pendingLoadCount)}_setAsyncPropValue(e,t,r){const i=this.asyncProps[e];i&&r>=i.resolvedLoadCount&&t!==void 0&&(this._freezeAsyncOldProps(),i.resolvedValue=t,i.resolvedLoadCount=r,this.onAsyncPropUpdated(e,t))}_watchPromise(e,t){const r=this.asyncProps[e];if(r){r.pendingLoadCount++;const i=r.pendingLoadCount;t.then(o=>{this.component&&(o=this._postProcessValue(r,o),this._setAsyncPropValue(e,o,i),this._onResolve(e,o))}).catch(o=>{this._onError(e,o)})}}async _resolveAsyncIterable(e,t){if(e!=="data"){this._setPropValue(e,t);return}const r=this.asyncProps[e];if(!r)return;r.pendingLoadCount++;const i=r.pendingLoadCount;let o=[],a=0;for await(const l of t){if(!this.component)return;const{dataTransform:h}=this.component.props;h?o=h(l,o):o=o.concat(l),Object.defineProperty(o,"__diff",{enumerable:!1,value:[{startRow:a,endRow:o.length}]}),a=o.length,this._setAsyncPropValue(e,o,i)}this._onResolve(e,o)}_postProcessValue(e,t){const r=e.type;return r&&this.component&&(r.release&&r.release(e.resolvedValue,r,this.component),r.transform)?r.transform(t,r,this.component):t}_createAsyncPropData(e,t){if(!this.asyncProps[e]){const i=this.component&&this.component.props[Wh];this.asyncProps[e]={type:i&&i[e],lastValue:null,resolvedValue:t,pendingLoadCount:0,resolvedLoadCount:0}}}}class mee extends gee{constructor({attributeManager:e,layer:t}){super(t),Y(this,"attributeManager",void 0),Y(this,"needsRedraw",void 0),Y(this,"needsUpdate",void 0),Y(this,"subLayers",void 0),Y(this,"usesPickingColorCache",void 0),Y(this,"hasPickingBuffer",void 0),Y(this,"changeFlags",void 0),Y(this,"viewport",void 0),Y(this,"uniformTransitions",void 0),Y(this,"propsInTransition",void 0),this.attributeManager=e,this.needsRedraw=!0,this.needsUpdate=!0,this.subLayers=null,this.usesPickingColorCache=!1}get layer(){return this.component}_fetch(e,t){const r=this.layer,i=r==null?void 0:r.props.fetch;return i?i(t,{propName:e,layer:r}):super._fetch(e,t)}_onResolve(e,t){const r=this.layer;if(r){const i=r.props.onDataLoad;e==="data"&&i&&i(t,{propName:e,layer:r})}}_onError(e,t){const r=this.layer;r&&r.raiseError(t,"loading ".concat(e," of ").concat(this.layer))}}const yee="layer.changeFlag",_ee="layer.initialize",vee="layer.update",bee="layer.finalize",wee="layer.matched",mN=2**24-1,xee=Object.freeze([]),Eee=ib(({oldViewport:n,viewport:e})=>n.equals(e));let Jc=new Uint8ClampedArray(0);const Tee={data:{type:"data",value:xee,async:!0},dataComparator:{type:"function",value:null,optional:!0},_dataDiff:{type:"function",value:n=>n&&n.__diff,optional:!0},dataTransform:{type:"function",value:null,optional:!0},onDataLoad:{type:"function",value:null,optional:!0},onError:{type:"function",value:null,optional:!0},fetch:{type:"function",value:(n,{propName:e,layer:t,loaders:r,loadOptions:i,signal:o})=>{const{resourceManager:a}=t.context;if(i=i||t.getLoadOptions(),r=r||t.props.loaders,o){var l;i={...i,fetch:{...(l=i)===null||l===void 0?void 0:l.fetch,signal:o}}}let h=a.contains(n);return!h&&!i&&(a.add({resourceId:n,data:ux(n,r),persistent:!1}),h=!0),h?a.subscribe({resourceId:n,onChange:p=>{var g;return(g=t.internalState)===null||g===void 0?void 0:g.reloadAsyncProp(e,p)},consumerId:t.id,requestId:e}):ux(n,r,i)}},updateTriggers:{},visible:!0,pickable:!1,opacity:{type:"number",min:0,max:1,value:1},operation:"draw",onHover:{type:"function",value:null,optional:!0},onClick:{type:"function",value:null,optional:!0},onDragStart:{type:"function",value:null,optional:!0},onDrag:{type:"function",value:null,optional:!0},onDragEnd:{type:"function",value:null,optional:!0},coordinateSystem:Xr.DEFAULT,coordinateOrigin:{type:"array",value:[0,0,0],compare:!0},modelMatrix:{type:"array",value:null,compare:!0,optional:!0},wrapLongitude:!1,positionFormat:"XYZ",colorFormat:"RGBA",parameters:{type:"object",value:{},optional:!0,compare:2},loadOptions:{type:"object",value:null,optional:!0,ignore:!0},transitions:null,extensions:[],loaders:{type:"array",value:[],optional:!0,ignore:!0},getPolygonOffset:{type:"function",value:({layerIndex:n})=>[0,-n*100]},highlightedObjectIndex:null,autoHighlight:!1,highlightColor:{type:"accessor",value:[0,0,128,128]}};let Nu=class extends wM{constructor(...e){super(...e),Y(this,"internalState",null),Y(this,"lifecycle",Dg.NO_STATE),Y(this,"context",void 0),Y(this,"state",void 0),Y(this,"parent",null)}static get componentName(){return Object.prototype.hasOwnProperty.call(this,"layerName")?this.layerName:""}get root(){let e=this;for(;e.parent;)e=e.parent;return e}toString(){const e=this.constructor.layerName||this.constructor.name;return"".concat(e,"({id: '").concat(this.props.id,"'})")}project(e){Yo(this.internalState);const t=this.internalState.viewport||this.context.viewport,r=O6(e,{viewport:t,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem}),[i,o,a]=dM(r,t.pixelProjectionMatrix);return e.length===2?[i,o]:[i,o,a]}unproject(e){return Yo(this.internalState),(this.internalState.viewport||this.context.viewport).unproject(e)}projectPosition(e,t){Yo(this.internalState);const r=this.internalState.viewport||this.context.viewport;return HX(e,{viewport:r,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem,...t})}get isComposite(){return!1}setState(e){this.setChangeFlags({stateChanged:!0}),Object.assign(this.state,e),this.setNeedsRedraw()}setNeedsRedraw(){this.internalState&&(this.internalState.needsRedraw=!0)}setNeedsUpdate(){this.internalState&&(this.context.layerManager.setNeedsUpdate(String(this)),this.internalState.needsUpdate=!0)}get isLoaded(){return this.internalState?!this.internalState.isAsyncPropLoading():!1}get wrapLongitude(){return this.props.wrapLongitude}isPickable(){return this.props.pickable&&this.props.visible}getModels(){return this.state&&(this.state.models||this.state.model&&[this.state.model])||[]}setModuleParameters(e){for(const t of this.getModels())t.updateModuleSettings(e)}getAttributeManager(){return this.internalState&&this.internalState.attributeManager}getCurrentLayer(){return this.internalState&&this.internalState.layer}getLoadOptions(){return this.props.loadOptions}use64bitPositions(){const{coordinateSystem:e}=this.props;return e===Xr.DEFAULT||e===Xr.LNGLAT||e===Xr.CARTESIAN}onHover(e,t){return this.props.onHover&&this.props.onHover(e,t)||!1}onClick(e,t){return this.props.onClick&&this.props.onClick(e,t)||!1}nullPickingColor(){return[0,0,0]}encodePickingColor(e,t=[]){return t[0]=e+1&255,t[1]=e+1>>8&255,t[2]=e+1>>8>>8&255,t}decodePickingColor(e){Yo(e instanceof Uint8Array);const[t,r,i]=e;return t+r*256+i*65536-1}getNumInstances(){return Number.isFinite(this.props.numInstances)?this.props.numInstances:this.state&&this.state.numInstances!==void 0?this.state.numInstances:KJ(this.props.data)}getStartIndices(){return this.props.startIndices?this.props.startIndices:this.state&&this.state.startIndices?this.state.startIndices:null}getBounds(){var e;return(e=this.getAttributeManager())===null||e===void 0?void 0:e.getBounds(["positions","instancePositions"])}getShaders(e){for(const t of this.props.extensions)e=QJ(e,t.getShaders.call(this,t));return e}shouldUpdateState(e){return e.changeFlags.propsOrDataChanged}updateState(e){const t=this.getAttributeManager(),{dataChanged:r}=e.changeFlags;if(r&&t)if(Array.isArray(r))for(const i of r)t.invalidateAll(i);else t.invalidateAll();if(t){const{props:i}=e,o=this.internalState.hasPickingBuffer,a=Number.isInteger(i.highlightedObjectIndex)||i.pickable||i.extensions.some(l=>l.getNeedsPickingBuffer.call(this,l));if(o!==a){this.internalState.hasPickingBuffer=a;const{pickingColors:l,instancePickingColors:h}=t.attributes,p=l||h;p&&(a&&p.constant&&(p.constant=!1,t.invalidate(p.id)),!p.value&&!a&&(p.constant=!0,p.value=[0,0,0]))}}}finalizeState(e){for(const r of this.getModels())r.delete();const t=this.getAttributeManager();t&&t.finalize(),this.context&&this.context.resourceManager.unsubscribe({consumerId:this.id}),this.internalState&&(this.internalState.uniformTransitions.clear(),this.internalState.finalize())}draw(e){for(const t of this.getModels())t.draw(e)}getPickingInfo({info:e,mode:t,sourceLayer:r}){const{index:i}=e;return i>=0&&Array.isArray(this.props.data)&&(e.object=this.props.data[i]),e}raiseError(e,t){var r,i;if(t&&(e=new Error("".concat(t,": ").concat(e.message),{cause:e})),!((r=(i=this.props).onError)!==null&&r!==void 0&&r.call(i,e))){var o,a;(o=this.context)===null||o===void 0||(a=o.onError)===null||a===void 0||a.call(o,e,this)}}getNeedsRedraw(e={clearRedrawFlags:!1}){return this._getNeedsRedraw(e)}needsUpdate(){return this.internalState?this.internalState.needsUpdate||this.hasUniformTransition()||this.shouldUpdateState(this._getUpdateParams()):!1}hasUniformTransition(){var e;return((e=this.internalState)===null||e===void 0?void 0:e.uniformTransitions.active)||!1}activateViewport(e){if(!this.internalState)return;const t=this.internalState.viewport;this.internalState.viewport=e,(!t||!Eee({oldViewport:t,viewport:e}))&&(this.setChangeFlags({viewportChanged:!0}),this.isComposite?this.needsUpdate()&&this.setNeedsUpdate():this._update())}invalidateAttribute(e="all"){const t=this.getAttributeManager();t&&(e==="all"?t.invalidateAll():t.invalidate(e))}updateAttributes(e){for(const t of this.getModels())this._setModelAttributes(t,e)}_updateAttributes(){const e=this.getAttributeManager();if(!e)return;const t=this.props,r=this.getNumInstances(),i=this.getStartIndices();e.update({data:t.data,numInstances:r,startIndices:i,props:t,transitions:t.transitions,buffers:t.data.attributes,context:this});const o=e.getChangedAttributes({clearChangedFlags:!0});this.updateAttributes(o)}_updateAttributeTransition(){const e=this.getAttributeManager();e&&e.updateTransition()}_updateUniformTransition(){const{uniformTransitions:e}=this.internalState;if(e.active){const t=e.update(),r=Object.create(this.props);for(const i in t)Object.defineProperty(r,i,{value:t[i]});return r}return this.props}calculateInstancePickingColors(e,{numInstances:t}){if(e.constant)return;const r=Math.floor(Jc.length/3);if(this.internalState.usesPickingColorCache=!0,r<t){t>mN&&Fr.warn("Layer has too many data objects. Picking might not be able to distinguish all objects.")(),Jc=b0.allocate(Jc,t,{size:3,copy:!0,maxCount:Math.max(t,mN)});const i=Math.floor(Jc.length/3),o=[];for(let a=r;a<i;a++)this.encodePickingColor(a,o),Jc[a*3+0]=o[0],Jc[a*3+1]=o[1],Jc[a*3+2]=o[2]}e.value=Jc.subarray(0,t*3)}_setModelAttributes(e,t){const r=this.getAttributeManager(),i=e.userData.excludeAttributes||{},o=r.getShaderAttributes(t,i);e.setAttributes(o)}disablePickingIndex(e){const t=this.props.data;if(!("attributes"in t)){this._disablePickingIndex(e);return}const{pickingColors:r,instancePickingColors:i}=this.getAttributeManager().attributes,o=r||i,a=o&&t.attributes&&t.attributes[o.id];if(a&&a.value){const l=a.value,h=this.encodePickingColor(e);for(let p=0;p<t.length;p++){const g=o.getVertexOffset(p);l[g]===h[0]&&l[g+1]===h[1]&&l[g+2]===h[2]&&this._disablePickingIndex(p)}}else this._disablePickingIndex(e)}_disablePickingIndex(e){const{pickingColors:t,instancePickingColors:r}=this.getAttributeManager().attributes,i=t||r;if(!i)return;const o=i.getVertexOffset(e),a=i.getVertexOffset(e+1);i.buffer.subData({data:new Uint8Array(a-o),offset:o})}restorePickingColors(){const{pickingColors:e,instancePickingColors:t}=this.getAttributeManager().attributes,r=e||t;r&&(this.internalState.usesPickingColorCache&&r.value.buffer!==Jc.buffer&&(r.value=Jc.subarray(0,r.value.length)),r.updateSubBuffer({startOffset:0}))}_initialize(){Yo(!this.internalState),Yo(Number.isFinite(this.props.coordinateSystem)),fa(_ee,this);const e=this._getAttributeManager();e&&e.addInstanced({instancePickingColors:{type:5121,size:3,noAlloc:!0,update:this.calculateInstancePickingColors}}),this.internalState=new mee({attributeManager:e,layer:this}),this._clearChangeFlags(),this.state={},Object.defineProperty(this.state,"attributeManager",{get:()=>(Fr.deprecated("layer.state.attributeManager","layer.getAttributeManager()")(),e)}),this.internalState.uniformTransitions=new zJ(this.context.timeline),this.internalState.onAsyncPropUpdated=this._onAsyncPropUpdated.bind(this),this.internalState.setAsyncProps(this.props),this.initializeState(this.context);for(const t of this.props.extensions)t.initializeState.call(this,this.context,t);this.setChangeFlags({dataChanged:"init",propsChanged:"init",viewportChanged:!0,extensionsChanged:!0}),this._update()}_transferState(e){fa(wee,this,this===e);const{state:t,internalState:r}=e;this!==e&&(this.internalState=r,this.state=t,this.internalState.setAsyncProps(this.props),this._diffProps(this.props,this.internalState.getOldProps()))}_update(){const e=this.needsUpdate();if(fa(vee,this,e),!e)return;const t=this.props,r=this.context,i=this.internalState,o=r.viewport,a=this._updateUniformTransition();i.propsInTransition=a,r.viewport=i.viewport||o,this.props=a;try{const l=this._getUpdateParams(),h=this.getModels();if(r.gl)this.updateState(l);else try{this.updateState(l)}catch{}for(const g of this.props.extensions)g.updateState.call(this,l,g);const p=this.getModels()[0]!==h[0];this._postUpdate(l,p)}finally{r.viewport=o,this.props=t,this._clearChangeFlags(),i.needsUpdate=!1,i.resetOldProps()}}_finalize(){fa(bee,this),this.finalizeState(this.context);for(const e of this.props.extensions)e.finalizeState.call(this,this.context,e)}_drawLayer({moduleParameters:e=null,uniforms:t={},parameters:r={}}){this._updateAttributeTransition();const i=this.props,o=this.context;this.props=this.internalState.propsInTransition||i;const a=this.props.opacity;t.opacity=Math.pow(a,1/2.2);try{e&&this.setModuleParameters(e);const{getPolygonOffset:l}=this.props,h=l&&l(t)||[0,0];bu(o.gl,{polygonOffset:h}),Ic(o.gl,r,()=>{const p={moduleParameters:e,uniforms:t,parameters:r,context:o};for(const g of this.props.extensions)g.draw.call(this,p,g);this.draw(p)})}finally{this.props=i}}getChangeFlags(){var e;return(e=this.internalState)===null||e===void 0?void 0:e.changeFlags}setChangeFlags(e){if(!this.internalState)return;const{changeFlags:t}=this.internalState;for(const i in e)if(e[i]){let o=!1;switch(i){case"dataChanged":const a=e[i],l=t[i];a&&Array.isArray(l)&&(t.dataChanged=Array.isArray(a)?l.concat(a):a,o=!0);default:t[i]||(t[i]=e[i],o=!0)}o&&fa(yee,this,i,e)}const r=!!(t.dataChanged||t.updateTriggersChanged||t.propsChanged||t.extensionsChanged);t.propsOrDataChanged=r,t.somethingChanged=r||t.viewportChanged||t.stateChanged}_clearChangeFlags(){this.internalState.changeFlags={dataChanged:!1,propsChanged:!1,updateTriggersChanged:!1,viewportChanged:!1,stateChanged:!1,extensionsChanged:!1,propsOrDataChanged:!1,somethingChanged:!1}}_diffProps(e,t){const r=VJ(e,t);if(r.updateTriggersChanged)for(const o in r.updateTriggersChanged)r.updateTriggersChanged[o]&&this.invalidateAttribute(o);if(r.transitionsChanged)for(const o in r.transitionsChanged){var i;this.internalState.uniformTransitions.add(o,t[o],e[o],(i=e.transitions)===null||i===void 0?void 0:i[o])}return this.setChangeFlags(r)}validateProps(){jJ(this.props)}updateAutoHighlight(e){this.props.autoHighlight&&!Number.isInteger(this.props.highlightedObjectIndex)&&this._updateAutoHighlight(e)}_updateAutoHighlight(e){const t={pickingSelectedColor:e.picked?e.color:null},{highlightColor:r}=this.props;e.picked&&typeof r=="function"&&(t.pickingHighlightColor=r(e)),this.setModuleParameters(t),this.setNeedsRedraw()}_getAttributeManager(){const e=this.context;return new NJ(e.gl,{id:this.props.id,stats:e.stats,timeline:e.timeline})}_postUpdate(e,t){const{props:r,oldProps:i}=e;this.setNeedsRedraw(),this._updateAttributes();const{model:o}=this.state;o==null||o.setInstanceCount(this.getNumInstances());const{autoHighlight:a,highlightedObjectIndex:l,highlightColor:h}=r;if(t||i.autoHighlight!==a||i.highlightedObjectIndex!==l||i.highlightColor!==h){const p={};a||(p.pickingSelectedColor=null),Array.isArray(h)&&(p.pickingHighlightColor=h),(t||l!==i.highlightedObjectIndex)&&(p.pickingSelectedColor=Number.isFinite(l)&&l>=0?this.encodePickingColor(l):null),this.setModuleParameters(p)}}_getUpdateParams(){return{props:this.props,oldProps:this.internalState.getOldProps(),context:this.context,changeFlags:this.internalState.changeFlags}}_getNeedsRedraw(e){if(!this.internalState)return!1;let t=!1;t=t||this.internalState.needsRedraw&&this.id;const r=this.getAttributeManager(),i=r?r.getNeedsRedraw(e):!1;if(t=t||i,t)for(const o of this.props.extensions)o.onNeedsRedraw.call(this,o);return this.internalState.needsRedraw=this.internalState.needsRedraw&&!e.clearRedrawFlags,t}_onAsyncPropUpdated(){this._diffProps(this.props,this.internalState.getOldProps()),this.setNeedsUpdate()}};Y(Nu,"defaultProps",Tee);Y(Nu,"layerName","Layer");const See="compositeLayer.renderLayers";class xM extends Nu{get isComposite(){return!0}get isLoaded(){return super.isLoaded&&this.getSubLayers().every(e=>e.isLoaded)}getSubLayers(){return this.internalState&&this.internalState.subLayers||[]}initializeState(e){}setState(e){super.setState(e),this.setNeedsUpdate()}getPickingInfo({info:e}){const{object:t}=e;return t&&t.__source&&t.__source.parent&&t.__source.parent.id===this.id&&(e.object=t.__source.object,e.index=t.__source.index),e}filterSubLayer(e){return!0}shouldRenderSubLayer(e,t){return t&&t.length}getSubLayerClass(e,t){const{_subLayerProps:r}=this.props;return r&&r[e]&&r[e].type||t}getSubLayerRow(e,t,r){return e.__source={parent:this,object:t,index:r},e}getSubLayerAccessor(e){if(typeof e=="function"){const t={index:-1,data:this.props.data,target:[]};return(r,i)=>r&&r.__source?(t.index=r.__source.index,e(r.__source.object,t)):e(r,i)}return e}getSubLayerProps(e={}){var t;const{opacity:r,pickable:i,visible:o,parameters:a,getPolygonOffset:l,highlightedObjectIndex:h,autoHighlight:p,highlightColor:g,coordinateSystem:_,coordinateOrigin:x,wrapLongitude:C,positionFormat:M,modelMatrix:L,extensions:D,fetch:z,operation:te,_subLayerProps:le}=this.props,ce={id:"",updateTriggers:{},opacity:r,pickable:i,visible:o,parameters:a,getPolygonOffset:l,highlightedObjectIndex:h,autoHighlight:p,highlightColor:g,coordinateSystem:_,coordinateOrigin:x,wrapLongitude:C,positionFormat:M,modelMatrix:L,extensions:D,fetch:z,operation:te},_e=le&&e.id&&le[e.id],J=_e&&_e.updateTriggers,pe=e.id||"sublayer";if(_e){const ue=this.props[Wh],xe=e.type?e.type._propTypes:{};for(const je in _e){const ne=xe[je]||ue[je];ne&&ne.type==="accessor"&&(_e[je]=this.getSubLayerAccessor(_e[je]))}}Object.assign(ce,e,_e),ce.id="".concat(this.props.id,"-").concat(pe),ce.updateTriggers={all:(t=this.props.updateTriggers)===null||t===void 0?void 0:t.all,...e.updateTriggers,...J};for(const ue of D){const xe=ue.getSubLayerProps.call(this,ue);xe&&Object.assign(ce,xe,{updateTriggers:Object.assign(ce.updateTriggers,xe.updateTriggers)})}return ce}_updateAutoHighlight(e){for(const t of this.getSubLayers())t.updateAutoHighlight(e)}_getAttributeManager(){return null}_postUpdate(e,t){let r=this.internalState.subLayers;const i=!r||this.needsUpdate();if(i){const o=this.renderLayers();r=pM(o,Boolean),this.internalState.subLayers=r}fa(See,this,i,r);for(const o of r)o.parent=this}}Y(xM,"layerName","CompositeLayer");const Ac={DEPTH_BUFFER_BIT:256,STENCIL_BUFFER_BIT:1024,COLOR_BUFFER_BIT:16384,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,ZERO:0,ONE:1,SRC_COLOR:768,ONE_MINUS_SRC_COLOR:769,SRC_ALPHA:770,ONE_MINUS_SRC_ALPHA:771,DST_ALPHA:772,ONE_MINUS_DST_ALPHA:773,DST_COLOR:774,ONE_MINUS_DST_COLOR:775,SRC_ALPHA_SATURATE:776,CONSTANT_COLOR:32769,ONE_MINUS_CONSTANT_COLOR:32770,CONSTANT_ALPHA:32771,ONE_MINUS_CONSTANT_ALPHA:32772,FUNC_ADD:32774,FUNC_SUBTRACT:32778,FUNC_REVERSE_SUBTRACT:32779,BLEND_EQUATION:32777,BLEND_EQUATION_RGB:32777,BLEND_EQUATION_ALPHA:34877,BLEND_DST_RGB:32968,BLEND_SRC_RGB:32969,BLEND_DST_ALPHA:32970,BLEND_SRC_ALPHA:32971,BLEND_COLOR:32773,ARRAY_BUFFER_BINDING:34964,ELEMENT_ARRAY_BUFFER_BINDING:34965,LINE_WIDTH:2849,ALIASED_POINT_SIZE_RANGE:33901,ALIASED_LINE_WIDTH_RANGE:33902,CULL_FACE_MODE:2885,FRONT_FACE:2886,DEPTH_RANGE:2928,DEPTH_WRITEMASK:2930,DEPTH_CLEAR_VALUE:2931,DEPTH_FUNC:2932,STENCIL_CLEAR_VALUE:2961,STENCIL_FUNC:2962,STENCIL_FAIL:2964,STENCIL_PASS_DEPTH_FAIL:2965,STENCIL_PASS_DEPTH_PASS:2966,STENCIL_REF:2967,STENCIL_VALUE_MASK:2963,STENCIL_WRITEMASK:2968,STENCIL_BACK_FUNC:34816,STENCIL_BACK_FAIL:34817,STENCIL_BACK_PASS_DEPTH_FAIL:34818,STENCIL_BACK_PASS_DEPTH_PASS:34819,STENCIL_BACK_REF:36003,STENCIL_BACK_VALUE_MASK:36004,STENCIL_BACK_WRITEMASK:36005,VIEWPORT:2978,SCISSOR_BOX:3088,COLOR_CLEAR_VALUE:3106,COLOR_WRITEMASK:3107,UNPACK_ALIGNMENT:3317,PACK_ALIGNMENT:3333,MAX_TEXTURE_SIZE:3379,MAX_VIEWPORT_DIMS:3386,SUBPIXEL_BITS:3408,RED_BITS:3410,GREEN_BITS:3411,BLUE_BITS:3412,ALPHA_BITS:3413,DEPTH_BITS:3414,STENCIL_BITS:3415,POLYGON_OFFSET_UNITS:10752,POLYGON_OFFSET_FACTOR:32824,TEXTURE_BINDING_2D:32873,SAMPLE_BUFFERS:32936,SAMPLES:32937,SAMPLE_COVERAGE_VALUE:32938,SAMPLE_COVERAGE_INVERT:32939,COMPRESSED_TEXTURE_FORMATS:34467,VENDOR:7936,RENDERER:7937,VERSION:7938,IMPLEMENTATION_COLOR_READ_TYPE:35738,IMPLEMENTATION_COLOR_READ_FORMAT:35739,BROWSER_DEFAULT_WEBGL:37444,STATIC_DRAW:35044,STREAM_DRAW:35040,DYNAMIC_DRAW:35048,ARRAY_BUFFER:34962,ELEMENT_ARRAY_BUFFER:34963,BUFFER_SIZE:34660,BUFFER_USAGE:34661,CURRENT_VERTEX_ATTRIB:34342,VERTEX_ATTRIB_ARRAY_ENABLED:34338,VERTEX_ATTRIB_ARRAY_SIZE:34339,VERTEX_ATTRIB_ARRAY_STRIDE:34340,VERTEX_ATTRIB_ARRAY_TYPE:34341,VERTEX_ATTRIB_ARRAY_NORMALIZED:34922,VERTEX_ATTRIB_ARRAY_POINTER:34373,VERTEX_ATTRIB_ARRAY_BUFFER_BINDING:34975,CULL_FACE:2884,FRONT:1028,BACK:1029,FRONT_AND_BACK:1032,BLEND:3042,DEPTH_TEST:2929,DITHER:3024,POLYGON_OFFSET_FILL:32823,SAMPLE_ALPHA_TO_COVERAGE:32926,SAMPLE_COVERAGE:32928,SCISSOR_TEST:3089,STENCIL_TEST:2960,NO_ERROR:0,INVALID_ENUM:1280,INVALID_VALUE:1281,INVALID_OPERATION:1282,OUT_OF_MEMORY:1285,CONTEXT_LOST_WEBGL:37442,CW:2304,CCW:2305,DONT_CARE:4352,FASTEST:4353,NICEST:4354,GENERATE_MIPMAP_HINT:33170,BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,INT:5124,UNSIGNED_INT:5125,FLOAT:5126,DOUBLE:5130,DEPTH_COMPONENT:6402,ALPHA:6406,RGB:6407,RGBA:6408,LUMINANCE:6409,LUMINANCE_ALPHA:6410,UNSIGNED_SHORT_4_4_4_4:32819,UNSIGNED_SHORT_5_5_5_1:32820,UNSIGNED_SHORT_5_6_5:33635,FRAGMENT_SHADER:35632,VERTEX_SHADER:35633,COMPILE_STATUS:35713,DELETE_STATUS:35712,LINK_STATUS:35714,VALIDATE_STATUS:35715,ATTACHED_SHADERS:35717,ACTIVE_ATTRIBUTES:35721,ACTIVE_UNIFORMS:35718,MAX_VERTEX_ATTRIBS:34921,MAX_VERTEX_UNIFORM_VECTORS:36347,MAX_VARYING_VECTORS:36348,MAX_COMBINED_TEXTURE_IMAGE_UNITS:35661,MAX_VERTEX_TEXTURE_IMAGE_UNITS:35660,MAX_TEXTURE_IMAGE_UNITS:34930,MAX_FRAGMENT_UNIFORM_VECTORS:36349,SHADER_TYPE:35663,SHADING_LANGUAGE_VERSION:35724,CURRENT_PROGRAM:35725,NEVER:512,ALWAYS:519,LESS:513,EQUAL:514,LEQUAL:515,GREATER:516,GEQUAL:518,NOTEQUAL:517,KEEP:7680,REPLACE:7681,INCR:7682,DECR:7683,INVERT:5386,INCR_WRAP:34055,DECR_WRAP:34056,NEAREST:9728,LINEAR:9729,NEAREST_MIPMAP_NEAREST:9984,LINEAR_MIPMAP_NEAREST:9985,NEAREST_MIPMAP_LINEAR:9986,LINEAR_MIPMAP_LINEAR:9987,TEXTURE_MAG_FILTER:10240,TEXTURE_MIN_FILTER:10241,TEXTURE_WRAP_S:10242,TEXTURE_WRAP_T:10243,TEXTURE_2D:3553,TEXTURE:5890,TEXTURE_CUBE_MAP:34067,TEXTURE_BINDING_CUBE_MAP:34068,TEXTURE_CUBE_MAP_POSITIVE_X:34069,TEXTURE_CUBE_MAP_NEGATIVE_X:34070,TEXTURE_CUBE_MAP_POSITIVE_Y:34071,TEXTURE_CUBE_MAP_NEGATIVE_Y:34072,TEXTURE_CUBE_MAP_POSITIVE_Z:34073,TEXTURE_CUBE_MAP_NEGATIVE_Z:34074,MAX_CUBE_MAP_TEXTURE_SIZE:34076,TEXTURE0:33984,ACTIVE_TEXTURE:34016,REPEAT:10497,CLAMP_TO_EDGE:33071,MIRRORED_REPEAT:33648,TEXTURE_WIDTH:4096,TEXTURE_HEIGHT:4097,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,INT_VEC2:35667,INT_VEC3:35668,INT_VEC4:35669,BOOL:35670,BOOL_VEC2:35671,BOOL_VEC3:35672,BOOL_VEC4:35673,FLOAT_MAT2:35674,FLOAT_MAT3:35675,FLOAT_MAT4:35676,SAMPLER_2D:35678,SAMPLER_CUBE:35680,LOW_FLOAT:36336,MEDIUM_FLOAT:36337,HIGH_FLOAT:36338,LOW_INT:36339,MEDIUM_INT:36340,HIGH_INT:36341,FRAMEBUFFER:36160,RENDERBUFFER:36161,RGBA4:32854,RGB5_A1:32855,RGB565:36194,DEPTH_COMPONENT16:33189,STENCIL_INDEX:6401,STENCIL_INDEX8:36168,DEPTH_STENCIL:34041,RENDERBUFFER_WIDTH:36162,RENDERBUFFER_HEIGHT:36163,RENDERBUFFER_INTERNAL_FORMAT:36164,RENDERBUFFER_RED_SIZE:36176,RENDERBUFFER_GREEN_SIZE:36177,RENDERBUFFER_BLUE_SIZE:36178,RENDERBUFFER_ALPHA_SIZE:36179,RENDERBUFFER_DEPTH_SIZE:36180,RENDERBUFFER_STENCIL_SIZE:36181,FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE:36048,FRAMEBUFFER_ATTACHMENT_OBJECT_NAME:36049,FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL:36050,FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE:36051,COLOR_ATTACHMENT0:36064,DEPTH_ATTACHMENT:36096,STENCIL_ATTACHMENT:36128,DEPTH_STENCIL_ATTACHMENT:33306,NONE:0,FRAMEBUFFER_COMPLETE:36053,FRAMEBUFFER_INCOMPLETE_ATTACHMENT:36054,FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:36055,FRAMEBUFFER_INCOMPLETE_DIMENSIONS:36057,FRAMEBUFFER_UNSUPPORTED:36061,FRAMEBUFFER_BINDING:36006,RENDERBUFFER_BINDING:36007,READ_FRAMEBUFFER:36008,DRAW_FRAMEBUFFER:36009,MAX_RENDERBUFFER_SIZE:34024,INVALID_FRAMEBUFFER_OPERATION:1286,UNPACK_FLIP_Y_WEBGL:37440,UNPACK_PREMULTIPLY_ALPHA_WEBGL:37441,UNPACK_COLORSPACE_CONVERSION_WEBGL:37443,READ_BUFFER:3074,UNPACK_ROW_LENGTH:3314,UNPACK_SKIP_ROWS:3315,UNPACK_SKIP_PIXELS:3316,PACK_ROW_LENGTH:3330,PACK_SKIP_ROWS:3331,PACK_SKIP_PIXELS:3332,TEXTURE_BINDING_3D:32874,UNPACK_SKIP_IMAGES:32877,UNPACK_IMAGE_HEIGHT:32878,MAX_3D_TEXTURE_SIZE:32883,MAX_ELEMENTS_VERTICES:33e3,MAX_ELEMENTS_INDICES:33001,MAX_TEXTURE_LOD_BIAS:34045,MAX_FRAGMENT_UNIFORM_COMPONENTS:35657,MAX_VERTEX_UNIFORM_COMPONENTS:35658,MAX_ARRAY_TEXTURE_LAYERS:35071,MIN_PROGRAM_TEXEL_OFFSET:35076,MAX_PROGRAM_TEXEL_OFFSET:35077,MAX_VARYING_COMPONENTS:35659,FRAGMENT_SHADER_DERIVATIVE_HINT:35723,RASTERIZER_DISCARD:35977,VERTEX_ARRAY_BINDING:34229,MAX_VERTEX_OUTPUT_COMPONENTS:37154,MAX_FRAGMENT_INPUT_COMPONENTS:37157,MAX_SERVER_WAIT_TIMEOUT:37137,MAX_ELEMENT_INDEX:36203,RED:6403,RGB8:32849,RGBA8:32856,RGB10_A2:32857,TEXTURE_3D:32879,TEXTURE_WRAP_R:32882,TEXTURE_MIN_LOD:33082,TEXTURE_MAX_LOD:33083,TEXTURE_BASE_LEVEL:33084,TEXTURE_MAX_LEVEL:33085,TEXTURE_COMPARE_MODE:34892,TEXTURE_COMPARE_FUNC:34893,SRGB:35904,SRGB8:35905,SRGB8_ALPHA8:35907,COMPARE_REF_TO_TEXTURE:34894,RGBA32F:34836,RGB32F:34837,RGBA16F:34842,RGB16F:34843,TEXTURE_2D_ARRAY:35866,TEXTURE_BINDING_2D_ARRAY:35869,R11F_G11F_B10F:35898,RGB9_E5:35901,RGBA32UI:36208,RGB32UI:36209,RGBA16UI:36214,RGB16UI:36215,RGBA8UI:36220,RGB8UI:36221,RGBA32I:36226,RGB32I:36227,RGBA16I:36232,RGB16I:36233,RGBA8I:36238,RGB8I:36239,RED_INTEGER:36244,RGB_INTEGER:36248,RGBA_INTEGER:36249,R8:33321,RG8:33323,R16F:33325,R32F:33326,RG16F:33327,RG32F:33328,R8I:33329,R8UI:33330,R16I:33331,R16UI:33332,R32I:33333,R32UI:33334,RG8I:33335,RG8UI:33336,RG16I:33337,RG16UI:33338,RG32I:33339,RG32UI:33340,R8_SNORM:36756,RG8_SNORM:36757,RGB8_SNORM:36758,RGBA8_SNORM:36759,RGB10_A2UI:36975,TEXTURE_IMMUTABLE_FORMAT:37167,TEXTURE_IMMUTABLE_LEVELS:33503,UNSIGNED_INT_2_10_10_10_REV:33640,UNSIGNED_INT_10F_11F_11F_REV:35899,UNSIGNED_INT_5_9_9_9_REV:35902,FLOAT_32_UNSIGNED_INT_24_8_REV:36269,UNSIGNED_INT_24_8:34042,HALF_FLOAT:5131,RG:33319,RG_INTEGER:33320,INT_2_10_10_10_REV:36255,CURRENT_QUERY:34917,QUERY_RESULT:34918,QUERY_RESULT_AVAILABLE:34919,ANY_SAMPLES_PASSED:35887,ANY_SAMPLES_PASSED_CONSERVATIVE:36202,MAX_DRAW_BUFFERS:34852,DRAW_BUFFER0:34853,DRAW_BUFFER1:34854,DRAW_BUFFER2:34855,DRAW_BUFFER3:34856,DRAW_BUFFER4:34857,DRAW_BUFFER5:34858,DRAW_BUFFER6:34859,DRAW_BUFFER7:34860,DRAW_BUFFER8:34861,DRAW_BUFFER9:34862,DRAW_BUFFER10:34863,DRAW_BUFFER11:34864,DRAW_BUFFER12:34865,DRAW_BUFFER13:34866,DRAW_BUFFER14:34867,DRAW_BUFFER15:34868,MAX_COLOR_ATTACHMENTS:36063,COLOR_ATTACHMENT1:36065,COLOR_ATTACHMENT2:36066,COLOR_ATTACHMENT3:36067,COLOR_ATTACHMENT4:36068,COLOR_ATTACHMENT5:36069,COLOR_ATTACHMENT6:36070,COLOR_ATTACHMENT7:36071,COLOR_ATTACHMENT8:36072,COLOR_ATTACHMENT9:36073,COLOR_ATTACHMENT10:36074,COLOR_ATTACHMENT11:36075,COLOR_ATTACHMENT12:36076,COLOR_ATTACHMENT13:36077,COLOR_ATTACHMENT14:36078,COLOR_ATTACHMENT15:36079,SAMPLER_3D:35679,SAMPLER_2D_SHADOW:35682,SAMPLER_2D_ARRAY:36289,SAMPLER_2D_ARRAY_SHADOW:36292,SAMPLER_CUBE_SHADOW:36293,INT_SAMPLER_2D:36298,INT_SAMPLER_3D:36299,INT_SAMPLER_CUBE:36300,INT_SAMPLER_2D_ARRAY:36303,UNSIGNED_INT_SAMPLER_2D:36306,UNSIGNED_INT_SAMPLER_3D:36307,UNSIGNED_INT_SAMPLER_CUBE:36308,UNSIGNED_INT_SAMPLER_2D_ARRAY:36311,MAX_SAMPLES:36183,SAMPLER_BINDING:35097,PIXEL_PACK_BUFFER:35051,PIXEL_UNPACK_BUFFER:35052,PIXEL_PACK_BUFFER_BINDING:35053,PIXEL_UNPACK_BUFFER_BINDING:35055,COPY_READ_BUFFER:36662,COPY_WRITE_BUFFER:36663,COPY_READ_BUFFER_BINDING:36662,COPY_WRITE_BUFFER_BINDING:36663,FLOAT_MAT2x3:35685,FLOAT_MAT2x4:35686,FLOAT_MAT3x2:35687,FLOAT_MAT3x4:35688,FLOAT_MAT4x2:35689,FLOAT_MAT4x3:35690,UNSIGNED_INT_VEC2:36294,UNSIGNED_INT_VEC3:36295,UNSIGNED_INT_VEC4:36296,UNSIGNED_NORMALIZED:35863,SIGNED_NORMALIZED:36764,VERTEX_ATTRIB_ARRAY_INTEGER:35069,VERTEX_ATTRIB_ARRAY_DIVISOR:35070,TRANSFORM_FEEDBACK_BUFFER_MODE:35967,MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS:35968,TRANSFORM_FEEDBACK_VARYINGS:35971,TRANSFORM_FEEDBACK_BUFFER_START:35972,TRANSFORM_FEEDBACK_BUFFER_SIZE:35973,TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN:35976,MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS:35978,MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS:35979,INTERLEAVED_ATTRIBS:35980,SEPARATE_ATTRIBS:35981,TRANSFORM_FEEDBACK_BUFFER:35982,TRANSFORM_FEEDBACK_BUFFER_BINDING:35983,TRANSFORM_FEEDBACK:36386,TRANSFORM_FEEDBACK_PAUSED:36387,TRANSFORM_FEEDBACK_ACTIVE:36388,TRANSFORM_FEEDBACK_BINDING:36389,FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING:33296,FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE:33297,FRAMEBUFFER_ATTACHMENT_RED_SIZE:33298,FRAMEBUFFER_ATTACHMENT_GREEN_SIZE:33299,FRAMEBUFFER_ATTACHMENT_BLUE_SIZE:33300,FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE:33301,FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE:33302,FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE:33303,FRAMEBUFFER_DEFAULT:33304,DEPTH24_STENCIL8:35056,DRAW_FRAMEBUFFER_BINDING:36006,READ_FRAMEBUFFER_BINDING:36010,RENDERBUFFER_SAMPLES:36011,FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER:36052,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE:36182,UNIFORM_BUFFER:35345,UNIFORM_BUFFER_BINDING:35368,UNIFORM_BUFFER_START:35369,UNIFORM_BUFFER_SIZE:35370,MAX_VERTEX_UNIFORM_BLOCKS:35371,MAX_FRAGMENT_UNIFORM_BLOCKS:35373,MAX_COMBINED_UNIFORM_BLOCKS:35374,MAX_UNIFORM_BUFFER_BINDINGS:35375,MAX_UNIFORM_BLOCK_SIZE:35376,MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS:35377,MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS:35379,UNIFORM_BUFFER_OFFSET_ALIGNMENT:35380,ACTIVE_UNIFORM_BLOCKS:35382,UNIFORM_TYPE:35383,UNIFORM_SIZE:35384,UNIFORM_BLOCK_INDEX:35386,UNIFORM_OFFSET:35387,UNIFORM_ARRAY_STRIDE:35388,UNIFORM_MATRIX_STRIDE:35389,UNIFORM_IS_ROW_MAJOR:35390,UNIFORM_BLOCK_BINDING:35391,UNIFORM_BLOCK_DATA_SIZE:35392,UNIFORM_BLOCK_ACTIVE_UNIFORMS:35394,UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES:35395,UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER:35396,UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER:35398,OBJECT_TYPE:37138,SYNC_CONDITION:37139,SYNC_STATUS:37140,SYNC_FLAGS:37141,SYNC_FENCE:37142,SYNC_GPU_COMMANDS_COMPLETE:37143,UNSIGNALED:37144,SIGNALED:37145,ALREADY_SIGNALED:37146,TIMEOUT_EXPIRED:37147,CONDITION_SATISFIED:37148,WAIT_FAILED:37149,SYNC_FLUSH_COMMANDS_BIT:1,COLOR:6144,DEPTH:6145,STENCIL:6146,MIN:32775,MAX:32776,DEPTH_COMPONENT24:33190,STREAM_READ:35041,STREAM_COPY:35042,STATIC_READ:35045,STATIC_COPY:35046,DYNAMIC_READ:35049,DYNAMIC_COPY:35050,DEPTH_COMPONENT32F:36012,DEPTH32F_STENCIL8:36013,INVALID_INDEX:4294967295,TIMEOUT_IGNORED:-1,MAX_CLIENT_WAIT_TIMEOUT_WEBGL:37447,VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE:35070,UNMASKED_VENDOR_WEBGL:37445,UNMASKED_RENDERER_WEBGL:37446,MAX_TEXTURE_MAX_ANISOTROPY_EXT:34047,TEXTURE_MAX_ANISOTROPY_EXT:34046,COMPRESSED_RGB_S3TC_DXT1_EXT:33776,COMPRESSED_RGBA_S3TC_DXT1_EXT:33777,COMPRESSED_RGBA_S3TC_DXT3_EXT:33778,COMPRESSED_RGBA_S3TC_DXT5_EXT:33779,COMPRESSED_R11_EAC:37488,COMPRESSED_SIGNED_R11_EAC:37489,COMPRESSED_RG11_EAC:37490,COMPRESSED_SIGNED_RG11_EAC:37491,COMPRESSED_RGB8_ETC2:37492,COMPRESSED_RGBA8_ETC2_EAC:37493,COMPRESSED_SRGB8_ETC2:37494,COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:37495,COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:37496,COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:37497,COMPRESSED_RGB_PVRTC_4BPPV1_IMG:35840,COMPRESSED_RGBA_PVRTC_4BPPV1_IMG:35842,COMPRESSED_RGB_PVRTC_2BPPV1_IMG:35841,COMPRESSED_RGBA_PVRTC_2BPPV1_IMG:35843,COMPRESSED_RGB_ETC1_WEBGL:36196,COMPRESSED_RGB_ATC_WEBGL:35986,COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL:35986,COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL:34798,UNSIGNED_INT_24_8_WEBGL:34042,HALF_FLOAT_OES:36193,RGBA32F_EXT:34836,RGB32F_EXT:34837,FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE_EXT:33297,UNSIGNED_NORMALIZED_EXT:35863,MIN_EXT:32775,MAX_EXT:32776,SRGB_EXT:35904,SRGB_ALPHA_EXT:35906,SRGB8_ALPHA8_EXT:35907,FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING_EXT:33296,FRAGMENT_SHADER_DERIVATIVE_HINT_OES:35723,COLOR_ATTACHMENT0_WEBGL:36064,COLOR_ATTACHMENT1_WEBGL:36065,COLOR_ATTACHMENT2_WEBGL:36066,COLOR_ATTACHMENT3_WEBGL:36067,COLOR_ATTACHMENT4_WEBGL:36068,COLOR_ATTACHMENT5_WEBGL:36069,COLOR_ATTACHMENT6_WEBGL:36070,COLOR_ATTACHMENT7_WEBGL:36071,COLOR_ATTACHMENT8_WEBGL:36072,COLOR_ATTACHMENT9_WEBGL:36073,COLOR_ATTACHMENT10_WEBGL:36074,COLOR_ATTACHMENT11_WEBGL:36075,COLOR_ATTACHMENT12_WEBGL:36076,COLOR_ATTACHMENT13_WEBGL:36077,COLOR_ATTACHMENT14_WEBGL:36078,COLOR_ATTACHMENT15_WEBGL:36079,DRAW_BUFFER0_WEBGL:34853,DRAW_BUFFER1_WEBGL:34854,DRAW_BUFFER2_WEBGL:34855,DRAW_BUFFER3_WEBGL:34856,DRAW_BUFFER4_WEBGL:34857,DRAW_BUFFER5_WEBGL:34858,DRAW_BUFFER6_WEBGL:34859,DRAW_BUFFER7_WEBGL:34860,DRAW_BUFFER8_WEBGL:34861,DRAW_BUFFER9_WEBGL:34862,DRAW_BUFFER10_WEBGL:34863,DRAW_BUFFER11_WEBGL:34864,DRAW_BUFFER12_WEBGL:34865,DRAW_BUFFER13_WEBGL:34866,DRAW_BUFFER14_WEBGL:34867,DRAW_BUFFER15_WEBGL:34868,MAX_COLOR_ATTACHMENTS_WEBGL:36063,MAX_DRAW_BUFFERS_WEBGL:34852,VERTEX_ARRAY_BINDING_OES:34229,QUERY_COUNTER_BITS_EXT:34916,CURRENT_QUERY_EXT:34917,QUERY_RESULT_EXT:34918,QUERY_RESULT_AVAILABLE_EXT:34919,TIME_ELAPSED_EXT:35007,TIMESTAMP_EXT:36392,GPU_DISJOINT_EXT:36795},Cee=`#define SHADER_NAME animated-flow-lines-layer-fragment-shader

precision highp float;

uniform float animationTailLength;

varying vec4 vColor;
varying float sourceToTarget;
varying vec2 uv;
                                   
void main(void) {
  geometry.uv = uv;

  gl_FragColor = vec4(vColor.xyz, vColor.w * smoothstep(1.0 - animationTailLength, 1.0, fract(sourceToTarget)));

  DECKGL_FILTER_COLOR(gl_FragColor, geometry);
}
`,Aee=`#define SHADER_NAME animated-flow-lines-layer-vertex-shader
#define SPEED 0.015
#define NUM_PARTS 5.0

attribute vec3 positions;
attribute vec3 instanceSourcePositions;
attribute vec3 instanceTargetPositions;
attribute vec3 instanceSourcePositions64Low;
attribute vec3 instanceTargetPositions64Low;
attribute vec4 instanceColors;
attribute vec3 instancePickingColors;
attribute float instanceWidths;
attribute float instancePickable;
attribute float instanceStaggering;

uniform float opacity;
uniform float currentTime;
uniform float thicknessUnit;
    
varying vec4 vColor;
varying float sourceToTarget;
varying vec2 uv;

// offset vector by strokeWidth pixels
// offset_direction is -1 (left) or 1 (right)
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction, float width) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace * project_uViewportSize);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);

  return dir_screenspace * offset_direction * width / 2.0;
}

void main(void) {
  geometry.worldPosition = instanceSourcePositions;
  geometry.worldPositionAlt = instanceTargetPositions;

  // Position
  vec4 source_commonspace;
  vec4 target_commonspace;
  vec4 source = project_position_to_clipspace(instanceSourcePositions, instanceSourcePositions64Low, vec3(0.), source_commonspace);
  vec4 target = project_position_to_clipspace(instanceTargetPositions, instanceTargetPositions64Low, vec3(0.), target_commonspace);

  float widthPixels = instanceWidths * thicknessUnit;
  
  
  // linear interpolation of source & target to pick right coord
  float segmentIndex = positions.x;
  vec4 p = mix(source, target, segmentIndex);
  geometry.position = mix(source_commonspace, target_commonspace, segmentIndex);
  uv = positions.xy;
  geometry.uv = uv;
  if (instancePickable > 0.5) {
    geometry.pickingColor = instancePickingColors;
  }
  
  // extrude
  vec3 offset = vec3(
    getExtrusionOffset(target.xy - source.xy, positions.y, widthPixels),
    0.0);
  DECKGL_FILTER_SIZE(offset, geometry);
  gl_Position = p + vec4(project_pixel_size_to_clipspace(offset.xy), 0.0, 0.0);
  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);

  // Color
  vColor = vec4(instanceColors.rgb, instanceColors.a * opacity) / 255.;
  DECKGL_FILTER_COLOR(vColor, geometry);

  sourceToTarget = positions.x * length(source - target) * NUM_PARTS - currentTime * SPEED + instanceStaggering; 
}
`,Iee=[0,132,193,255],J6=1800,Pee=20,yN=J6/Pee;class Lw extends Nu{constructor(e){super(e)}getShaders(){return super.getShaders({vs:Aee,fs:Cee,modules:[fy,py],shaderCache:this.context.shaderCache})}initializeState(){this.getAttributeManager().addInstanced({instanceSourcePositions:{size:3,type:Ac.DOUBLE,transition:!0,accessor:"getSourcePosition"},instanceTargetPositions:{size:3,type:Ac.DOUBLE,transition:!0,accessor:"getTargetPosition"},instanceColors:{size:4,type:Ac.UNSIGNED_BYTE,transition:!0,accessor:"getColor",defaultValue:[0,0,0,255]},instanceWidths:{size:1,transition:!0,accessor:"getThickness",defaultValue:1},instanceStaggering:{accessor:"getStaggering",size:1,transition:!1},instancePickable:{accessor:"getPickable",size:1,transition:!1}})}getNeedsRedraw(){return!0}updateState({props:e,oldProps:t,changeFlags:r}){var i;if(super.updateState({props:e,oldProps:t,changeFlags:r}),r.extensionsChanged){const{gl:o}=this.context;(i=this.state.model)==null||i.delete(),this.state.model=this._getModel(o),this.getAttributeManager().invalidateAll()}}draw({uniforms:e}){const{thicknessUnit:t,animationTailLength:r}=this.props,o=Date.now()/1e3%yN/yN*J6;this.state.model.setUniforms({...e,thicknessUnit:t*4,animationTailLength:r,currentTime:o}).draw()}_getModel(e){const t=[0,-1,0,0,1,0,1,-1,0,1,1,0];return new rp(e,Object.assign({},this.getShaders(),{id:this.props.id,geometry:new hy({drawMode:Ac.TRIANGLE_STRIP,attributes:{positions:new Float32Array(t)}}),isInstanced:!0}))}}Lw.defaultProps={currentTime:0,animationTailLength:.7,getSourcePosition:{type:"accessor",value:n=>[0,0]},getTargetPosition:{type:"accessor",value:n=>[0,0]},getPickable:{type:"accessor",value:n=>1},getStaggering:{type:"accessor",value:(n,{index:e})=>Math.random()},getColor:{type:"accessor",value:Iee},getThickness:{type:"accessor",value:1},thicknessUnit:15*2,parameters:{depthTest:!1}};const Mee=`#define SHADER_NAME flow-line-layer-fragment-shader

precision highp float;

varying vec4 vColor;
varying vec2 uv;

void main(void) {
  if (vColor.a == 0.0) {
    discard;
  }

  geometry.uv = uv;
  gl_FragColor = vColor;
  DECKGL_FILTER_COLOR(gl_FragColor, geometry);
}
`,Ree=`#define SHADER_NAME flow-line-layer-vertex-shader

attribute vec3 positions;
attribute vec3 normals;
attribute vec4 instanceColors;
attribute float instanceThickness;    // 0..0.5
attribute vec3 instanceSourcePositions;
attribute vec3 instanceTargetPositions;
attribute vec3 instanceSourcePositions64Low;
attribute vec3 instanceTargetPositions64Low;
attribute vec3 instancePickingColors;
attribute vec2 instanceEndpointOffsets;
attribute float instancePickable;

uniform vec4 outlineColor;
uniform float thicknessUnit;
uniform float gap;
uniform float opacity;

varying vec4 vColor;
varying vec2 uv;

void main(void) {
  geometry.worldPosition = instanceSourcePositions;
  geometry.worldPositionAlt = instanceTargetPositions;
  
  // Position
  vec4 source_commonspace;    
  vec4 target_commonspace;
  vec4 source = project_position_to_clipspace(instanceSourcePositions, instanceSourcePositions64Low, vec3(0.), source_commonspace);
  vec4 target = project_position_to_clipspace(instanceTargetPositions, instanceTargetPositions64Low, vec3(0.), target_commonspace);

  // linear interpolation of source & target to pick right coord
  float sourceOrTarget = positions.x;
  geometry.position = mix(source_commonspace, target_commonspace, sourceOrTarget);
  uv = positions.xy;
  geometry.uv = uv;
  if (instancePickable > 0.5) {
    geometry.pickingColor = instancePickingColors;
  }
  
  // set the clamp limits in pixel size 
  float lengthCommon = length(target_commonspace - source_commonspace);    
  vec2 offsetDistances = project_pixel_size(positions.yz) * thicknessUnit;
  
  vec2 limitedOffsetDistances = clamp(   
    project_pixel_size(positions.yz) * thicknessUnit,
    -lengthCommon*.8, lengthCommon*.8
  );
  float startOffsetCommon = project_pixel_size(instanceEndpointOffsets[0]);
  float endOffsetCommon = project_pixel_size(instanceEndpointOffsets[1]);
  float endpointOffset = mix(
    clamp(startOffsetCommon, 0.0, lengthCommon*.2),
    -clamp(endOffsetCommon, 0.0, lengthCommon*.2),
    positions.x
  );

  vec2 flowlineDir = normalize(target_commonspace.xy - source_commonspace.xy);
  vec2 perpendicularDir = vec2(-flowlineDir.y, flowlineDir.x);
  vec2 normalsCommon = project_pixel_size(normals.xy);
  float gapCommon = project_pixel_size(gap);
  vec3 offsetCommon = vec3(
    flowlineDir * (instanceThickness * limitedOffsetDistances[1] + normalsCommon.y + endpointOffset * 1.05) -
    perpendicularDir * (instanceThickness * limitedOffsetDistances[0] + gapCommon + normalsCommon.x),
    0.0
  );
  
  DECKGL_FILTER_SIZE(offsetCommon, geometry);
  vec4 position_commonspace = mix(source_commonspace, target_commonspace, sourceOrTarget);
  vec4 offset_commonspace = vec4(offsetCommon, 0.0);
  gl_Position = project_common_position_to_clipspace(position_commonspace + offset_commonspace);
      
  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
  
  vec4 fillColor = vec4(instanceColors.rgb, instanceColors.a * opacity) / 255.;
  vColor = mix(fillColor, vec4(outlineColor.xyz, outlineColor.w * fillColor.w), normals.z);
  DECKGL_FILTER_COLOR(vColor, geometry);
}
`,kee=[0,132,193,255],Oee=1,_N=[1,0,0,1,2,-3,1,1,-3,1,0,0,1,1,-3,0,1,0,1,0,0,0,1,0,0,0,0];function Lee(n,e){return[-e,2*n,1,2*n,-n,1,n,-n,1,-e,2*n,1,n,-n,1,n,-n,1,-e,2*n,1,n,-n,1,-e,-n,1]}const Nee=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];class Jg extends Nu{constructor(e){super(e)}getShaders(){return super.getShaders({vs:Ree,fs:Mee,modules:[fy,py],shaderCache:this.context.shaderCache})}initializeState(){const{attributeManager:e}=this.state;e.addInstanced({instanceSourcePositions:{accessor:"getSourcePosition",size:3,transition:!1,type:Ac.DOUBLE},instanceTargetPositions:{accessor:"getTargetPosition",size:3,transition:!1,type:Ac.DOUBLE},instanceThickness:{accessor:"getThickness",size:1,transition:!1},instanceEndpointOffsets:{accessor:"getEndpointOffsets",size:2,transition:!1},instanceColors:{accessor:"getColor",size:4,type:Ac.UNSIGNED_BYTE,transition:!1},instancePickable:{accessor:"getPickable",size:1,transition:!1}})}updateState({props:e,oldProps:t,changeFlags:r}){if(super.updateState({props:e,oldProps:t,changeFlags:r}),r.extensionsChanged){const{gl:i}=this.context;this.state.model&&this.state.model.delete(),this.setState({model:this._getModel(i)}),this.getAttributeManager().invalidateAll()}}draw({uniforms:e}){const{gl:t}=this.context,{outlineColor:r,thicknessUnit:i}=this.props;t.lineWidth(1),this.state.model.setUniforms({...e,outlineColor:r.map(o=>o/255),thicknessUnit:i*2,gap:.5}).draw()}_getModel(e){let t=[],r=[];const{drawOutline:i,outlineThickness:o}=this.props;if(i){t=t.concat(_N);const a=o,l=Oee;r=r.concat(Lee(a,l))}return t=t.concat(_N),r=r.concat(Nee),new rp(e,{id:this.props.id,...this.getShaders(),geometry:new hy({drawMode:Ac.TRIANGLES,attributes:{positions:new Float32Array(t),normals:new Float32Array(r)}}),isInstanced:!0,shaderCache:this.context.shaderCache})}}Jg.layerName="FlowLinesLayer";Jg.defaultProps={getSourcePosition:{type:"accessor",value:n=>[0,0]},getTargetPosition:{type:"accessor",value:n=>[0,0]},getColor:{type:"accessor",value:kee},getThickness:{type:"accessor",value:n=>n.count},getPickable:{type:"accessor",value:n=>1},drawOutline:!0,thicknessUnit:12,outlineThickness:1,outlineColor:[255,255,255,255],parameters:{depthTest:!1}};const Dee=`#define SHADER_NAME flow-circles-layer-fragment-shader
#define SOFT_OUTLINE 0.05
#define EPS 0.05
precision highp float;

uniform vec4 emptyColor;
uniform float outlineEmptyMix;

varying vec4 vColor;
varying vec2 unitPosition;
varying float unitInRadius;
varying float unitOutRadius;

float when_gt(float x, float y) {
  return max(sign(x - y), 0.0);
}

void main(void) {
  geometry.uv = unitPosition;
  float distToCenter = length(unitPosition);
  if (distToCenter > 1.0) {
    discard;
  }

  // See https://stackoverflow.com/questions/47285778
  vec4 ringColor = mix(
    emptyColor / 255., vColor,
    when_gt(unitInRadius, unitOutRadius)
  );
  vec4 outlineColor = mix(
    mix(vColor, emptyColor / 255., outlineEmptyMix),
    vColor,
    when_gt(unitInRadius, unitOutRadius)
  );
  
  float innerR = min(unitInRadius, unitOutRadius) * (1.0 - SOFT_OUTLINE);
  
  // Inner circle
  float step2 = innerR - 2.0 * EPS; 
  float step3 = innerR - EPS;
  
  // Ring
  float step4 = innerR;
  // float step5 = 1.0 - SOFT_OUTLINE - EPS;
  // float step6 = 1.0 - SOFT_OUTLINE;
  float step5 = 1.0 - 5.0 * EPS;
  float step6 = 1.0;
  
  gl_FragColor = vColor;
  gl_FragColor = mix(gl_FragColor, emptyColor / 255., smoothstep(step2, step3, distToCenter));
  gl_FragColor = mix(gl_FragColor, ringColor, smoothstep(step3, step4, distToCenter));
  gl_FragColor = mix(gl_FragColor, outlineColor, smoothstep(step5, step6, distToCenter));
  // gl_FragColor = mix(gl_FragColor, emptyColor / 255., smoothstep(step6, 1.0, distToCenter));
  gl_FragColor.a = vColor.a;
  gl_FragColor.a *= smoothstep(0.0, SOFT_OUTLINE, 1.0 - distToCenter);
  DECKGL_FILTER_COLOR(gl_FragColor, geometry);
}
`,Fee=`#define SHADER_NAME flow-circles-layer-vertex-shader
#define radiusScale 100

attribute vec3 positions;

attribute vec3 instancePositions;
attribute vec3 instancePositions64Low;
attribute float instanceInRadius;
attribute float instanceOutRadius;
attribute vec4 instanceColors;
attribute vec3 instancePickingColors;

uniform float opacity;
uniform vec4 emptyColor;
uniform float outlineEmptyMix;

varying vec4 vColor;
varying vec2 unitPosition;
varying float unitInRadius;
varying float unitOutRadius;

void main(void) {
  geometry.worldPosition = instancePositions;

  float outerRadiusPixels = max(instanceInRadius, instanceOutRadius);
  unitInRadius = instanceInRadius / outerRadiusPixels; 
  unitOutRadius = instanceOutRadius / outerRadiusPixels; 

  // position on the containing square in [-1, 1] space
  unitPosition = positions.xy;
  geometry.uv = unitPosition;
  geometry.pickingColor = instancePickingColors;
                                                                                                    
  // Find the center of the point and add the current vertex
  vec3 offset = positions * project_pixel_size(outerRadiusPixels);
  DECKGL_FILTER_SIZE(offset, geometry);
  gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset, geometry.position);
  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
                            
  // Apply opacity to instance color, or return instance picking color
  vColor = vec4(instanceColors.rgb / 255., instanceColors.a / 255. * opacity);
  DECKGL_FILTER_COLOR(vColor, geometry);
}
`,eB=[0,0,0,255],Bee=[255,255,255,255],Uee=.4;class jv extends Nu{constructor(e){super(e)}getShaders(){return super.getShaders({vs:Fee,fs:Dee,modules:[fy,py]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:Ac.DOUBLE,fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceInRadius:{size:1,transition:!0,accessor:"getInRadius",defaultValue:1},instanceOutRadius:{size:1,transition:!0,accessor:"getOutRadius",defaultValue:1},instanceColors:{size:4,transition:!0,type:Ac.UNSIGNED_BYTE,accessor:"getColor",defaultValue:eB}})}updateState({props:e,oldProps:t,changeFlags:r}){if(super.updateState({props:e,oldProps:t,changeFlags:r}),r.extensionsChanged){const{gl:i}=this.context;this.state.model&&this.state.model.delete(),this.setState({model:this._getModel(i)}),this.getAttributeManager().invalidateAll()}}draw({uniforms:e}){const{emptyColor:t,outlineEmptyMix:r}=this.props;this.state.model.setUniforms({...e,emptyColor:t,outlineEmptyMix:r}).draw()}_getModel(e){const t=[-1,-1,0,1,-1,0,1,1,0,-1,1,0];return new rp(e,Object.assign(this.getShaders(),{id:this.props.id,geometry:new hy({drawMode:Ac.TRIANGLE_FAN,vertexCount:4,attributes:{positions:{size:3,value:new Float32Array(t)}}}),isInstanced:!0}))}}jv.layerName="FlowCirclesLayer";jv.defaultProps={getColor:{type:"accessor",value:eB},emptyColor:{type:"accessor",value:Bee},outlineEmptyMix:{type:"accessor",value:Uee},getPosition:{type:"accessor",value:n=>n.position},getInRadius:{type:"accessor",value:1},getOutRadius:{type:"accessor",value:1},parameters:{depthTest:!1}};const zee=`#define SHADER_NAME icon-layer-vertex-shader

attribute vec2 positions;

attribute vec3 instancePositions;
attribute vec3 instancePositions64Low;
attribute float instanceSizes;
attribute float instanceAngles;
attribute vec4 instanceColors;
attribute vec3 instancePickingColors;
attribute vec4 instanceIconFrames;
attribute float instanceColorModes;
attribute vec2 instanceOffsets;
attribute vec2 instancePixelOffset;

uniform float sizeScale;
uniform vec2 iconsTextureDim;
uniform float sizeMinPixels;
uniform float sizeMaxPixels;
uniform bool billboard;
uniform int sizeUnits;

varying float vColorMode;
varying vec4 vColor;
varying vec2 vTextureCoords;
varying vec2 uv;

vec2 rotate_by_angle(vec2 vertex, float angle) {
  float angle_radian = angle * PI / 180.0;
  float cos_angle = cos(angle_radian);
  float sin_angle = sin(angle_radian);
  mat2 rotationMatrix = mat2(cos_angle, -sin_angle, sin_angle, cos_angle);
  return rotationMatrix * vertex;
}

void main(void) {
  geometry.worldPosition = instancePositions;
  geometry.uv = positions;
  geometry.pickingColor = instancePickingColors;
  uv = positions;

  vec2 iconSize = instanceIconFrames.zw;
  float sizePixels = clamp(
    project_size_to_pixel(instanceSizes * sizeScale, sizeUnits), 
    sizeMinPixels, sizeMaxPixels
  );
  float instanceScale = iconSize.y == 0.0 ? 0.0 : sizePixels / iconSize.y;
  vec2 pixelOffset = positions / 2.0 * iconSize + instanceOffsets;
  pixelOffset = rotate_by_angle(pixelOffset, instanceAngles) * instanceScale;
  pixelOffset += instancePixelOffset;
  pixelOffset.y *= -1.0;

  if (billboard)  {
    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
    DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
    vec3 offset = vec3(pixelOffset, 0.0);
    DECKGL_FILTER_SIZE(offset, geometry);
    gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);

  } else {
    vec3 offset_common = vec3(project_pixel_size(pixelOffset), 0.0);
    DECKGL_FILTER_SIZE(offset_common, geometry);
    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset_common, geometry.position); 
    DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
  }

  vTextureCoords = mix(
    instanceIconFrames.xy,
    instanceIconFrames.xy + iconSize,
    (positions.xy + 1.0) / 2.0
  ) / iconsTextureDim;

  vColor = instanceColors;
  DECKGL_FILTER_COLOR(vColor, geometry);

  vColorMode = instanceColorModes;
}
`,jee=`#define SHADER_NAME icon-layer-fragment-shader

precision highp float;

uniform float opacity;
uniform sampler2D iconsTexture;
uniform float alphaCutoff;

varying float vColorMode;
varying vec4 vColor;
varying vec2 vTextureCoords;
varying vec2 uv;

void main(void) {
  geometry.uv = uv;

  vec4 texColor = texture2D(iconsTexture, vTextureCoords);
  vec3 color = mix(texColor.rgb, vColor.rgb, vColorMode);
  float a = texColor.a * opacity * vColor.a;

  if (a < alphaCutoff) {
    discard;
  }

  gl_FragColor = vec4(color, a);
  DECKGL_FILTER_COLOR(gl_FragColor, geometry);
}
`,Vee=1024,Hee=4,vN=()=>{},bN={10241:9987,10240:9729,10242:33071,10243:33071};function Gee(n){return Math.pow(2,Math.ceil(Math.log2(n)))}function qee(n,e,t,r){const i=Math.min(t/e.width,r/e.height),o=Math.floor(e.width*i),a=Math.floor(e.height*i);return i===1?{data:e,width:o,height:a}:(n.canvas.height=a,n.canvas.width=o,n.clearRect(0,0,o,a),n.drawImage(e,0,0,e.width,e.height,0,0,o,a),{data:n.canvas,width:o,height:a})}function w0(n){return n&&(n.id||n.url)}function $ee(n,e,t,r){const i=n.width,o=n.height,a=new Bs(n.gl,{width:e,height:t,parameters:r});return X$(n,a,{targetY:0,width:i,height:o}),n.delete(),a}function wN(n,e,t){for(let r=0;r<e.length;r++){const{icon:i,xOffset:o}=e[r],a=w0(i);n[a]={...i,x:o,y:t}}}function Wee({icons:n,buffer:e,mapping:t={},xOffset:r=0,yOffset:i=0,rowHeight:o=0,canvasWidth:a}){let l=[];for(let h=0;h<n.length;h++){const p=n[h],g=w0(p);if(!t[g]){const{height:_,width:x}=p;r+x+e>a&&(wN(t,l,i),r=0,i=o+i+e,o=0,l=[]),l.push({icon:p,xOffset:r}),r=r+x+e,o=Math.max(o,_)}}return l.length>0&&wN(t,l,i),{mapping:t,rowHeight:o,xOffset:r,yOffset:i,canvasWidth:a,canvasHeight:Gee(o+i+e)}}function Yee(n,e,t){if(!n||!e)return null;t=t||{};const r={},{iterable:i,objectInfo:o}=yM(n);for(const a of i){o.index++;const l=e(a,o),h=w0(l);if(!l)throw new Error("Icon is missing.");if(!l.url)throw new Error("Icon url is missing.");!r[h]&&(!t[h]||l.url!==t[h].url)&&(r[h]={...l,source:a,sourceIndex:o.index})}return r}class Kee{constructor(e,{onUpdate:t=vN,onError:r=vN}){Y(this,"gl",void 0),Y(this,"onUpdate",void 0),Y(this,"onError",void 0),Y(this,"_loadOptions",null),Y(this,"_texture",null),Y(this,"_externalTexture",null),Y(this,"_mapping",{}),Y(this,"_textureParameters",null),Y(this,"_pendingCount",0),Y(this,"_autoPacking",!1),Y(this,"_xOffset",0),Y(this,"_yOffset",0),Y(this,"_rowHeight",0),Y(this,"_buffer",Hee),Y(this,"_canvasWidth",Vee),Y(this,"_canvasHeight",0),Y(this,"_canvas",null),this.gl=e,this.onUpdate=t,this.onError=r}finalize(){var e;(e=this._texture)===null||e===void 0||e.delete()}getTexture(){return this._texture||this._externalTexture}getIconMapping(e){const t=this._autoPacking?w0(e):e;return this._mapping[t]||{}}setProps({loadOptions:e,autoPacking:t,iconAtlas:r,iconMapping:i,textureParameters:o}){if(e&&(this._loadOptions=e),t!==void 0&&(this._autoPacking=t),i&&(this._mapping=i),r){var a;(a=this._texture)===null||a===void 0||a.delete(),this._texture=null,this._externalTexture=r}o&&(this._textureParameters=o)}get isLoaded(){return this._pendingCount===0}packIcons(e,t){if(!this._autoPacking||typeof document>"u")return;const r=Object.values(Yee(e,t,this._mapping)||{});if(r.length>0){const{mapping:i,xOffset:o,yOffset:a,rowHeight:l,canvasHeight:h}=Wee({icons:r,buffer:this._buffer,canvasWidth:this._canvasWidth,mapping:this._mapping,rowHeight:this._rowHeight,xOffset:this._xOffset,yOffset:this._yOffset});this._rowHeight=l,this._mapping=i,this._xOffset=o,this._yOffset=a,this._canvasHeight=h,this._texture||(this._texture=new Bs(this.gl,{width:this._canvasWidth,height:this._canvasHeight,parameters:this._textureParameters||bN})),this._texture.height!==this._canvasHeight&&(this._texture=$ee(this._texture,this._canvasWidth,this._canvasHeight,this._textureParameters||bN)),this.onUpdate(),this._canvas=this._canvas||document.createElement("canvas"),this._loadIcons(r)}}_loadIcons(e){const t=this._canvas.getContext("2d",{willReadFrequently:!0});for(const r of e)this._pendingCount++,ux(r.url,this._loadOptions).then(i=>{const o=w0(r),a=this._mapping[o],{x:l,y:h,width:p,height:g}=a,{data:_,width:x,height:C}=qee(t,i,p,g);this._texture.setSubImageData({data:_,x:l+(p-x)/2,y:h+(g-C)/2,width:x,height:C}),a.width=x,a.height=C,this._texture.generateMipmap(),this.onUpdate()}).catch(i=>{this.onError({url:r.url,source:r.source,sourceIndex:r.sourceIndex,loadOptions:this._loadOptions,error:i})}).finally(()=>{this._pendingCount--})}}const tB=[0,0,0,255],Zee={iconAtlas:{type:"image",value:null,async:!0},iconMapping:{type:"object",value:{},async:!0},sizeScale:{type:"number",value:1,min:0},billboard:!0,sizeUnits:"pixels",sizeMinPixels:{type:"number",min:0,value:0},sizeMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},alphaCutoff:{type:"number",value:.05,min:0,max:1},getPosition:{type:"accessor",value:n=>n.position},getIcon:{type:"accessor",value:n=>n.icon},getColor:{type:"accessor",value:tB},getSize:{type:"accessor",value:1},getAngle:{type:"accessor",value:0},getPixelOffset:{type:"accessor",value:[0,0]},onIconError:{type:"function",value:null,optional:!0},textureParameters:{type:"object",ignore:!0}};class EM extends Nu{constructor(...e){super(...e),Y(this,"state",void 0)}getShaders(){return super.getShaders({vs:zee,fs:jee,modules:[fy,py]})}initializeState(){this.state={iconManager:new Kee(this.context.gl,{onUpdate:this._onUpdate.bind(this),onError:this._onError.bind(this)})},this.getAttributeManager().addInstanced({instancePositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceSizes:{size:1,transition:!0,accessor:"getSize",defaultValue:1},instanceOffsets:{size:2,accessor:"getIcon",transform:this.getInstanceOffset},instanceIconFrames:{size:4,accessor:"getIcon",transform:this.getInstanceIconFrame},instanceColorModes:{size:1,type:5121,accessor:"getIcon",transform:this.getInstanceColorMode},instanceColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,transition:!0,accessor:"getColor",defaultValue:tB},instanceAngles:{size:1,transition:!0,accessor:"getAngle"},instancePixelOffset:{size:2,transition:!0,accessor:"getPixelOffset"}})}updateState(e){super.updateState(e);const{props:t,oldProps:r,changeFlags:i}=e,o=this.getAttributeManager(),{iconAtlas:a,iconMapping:l,data:h,getIcon:p,textureParameters:g}=t,{iconManager:_}=this.state,x=a||this.internalState.isAsyncPropLoading("iconAtlas");if(_.setProps({loadOptions:t.loadOptions,autoPacking:!x,iconAtlas:a,iconMapping:x?l:null,textureParameters:g}),x?r.iconMapping!==t.iconMapping&&o.invalidate("getIcon"):(i.dataChanged||i.updateTriggersChanged&&(i.updateTriggersChanged.all||i.updateTriggersChanged.getIcon))&&_.packIcons(h,p),i.extensionsChanged){var C;const{gl:M}=this.context;(C=this.state.model)===null||C===void 0||C.delete(),this.state.model=this._getModel(M),o.invalidateAll()}}get isLoaded(){return super.isLoaded&&this.state.iconManager.isLoaded}finalizeState(e){super.finalizeState(e),this.state.iconManager.finalize()}draw({uniforms:e}){const{sizeScale:t,sizeMinPixels:r,sizeMaxPixels:i,sizeUnits:o,billboard:a,alphaCutoff:l}=this.props,{iconManager:h}=this.state,p=h.getTexture();p&&this.state.model.setUniforms(e).setUniforms({iconsTexture:p,iconsTextureDim:[p.width,p.height],sizeUnits:Um[o],sizeScale:t,sizeMinPixels:r,sizeMaxPixels:i,billboard:a,alphaCutoff:l}).draw()}_getModel(e){const t=[-1,-1,-1,1,1,1,1,-1];return new rp(e,{...this.getShaders(),id:this.props.id,geometry:new hy({drawMode:6,attributes:{positions:{size:2,value:new Float32Array(t)}}}),isInstanced:!0})}_onUpdate(){this.setNeedsRedraw()}_onError(e){var t;const r=(t=this.getCurrentLayer())===null||t===void 0?void 0:t.props.onIconError;r?r(e):Fr.error(e.error.message)()}getInstanceOffset(e){const{width:t,height:r,anchorX:i=t/2,anchorY:o=r/2}=this.state.iconManager.getIconMapping(e);return[t/2-i,r/2-o]}getInstanceColorMode(e){return this.state.iconManager.getIconMapping(e).mask?1:0}getInstanceIconFrame(e){const{x:t,y:r,width:i,height:o}=this.state.iconManager.getIconMapping(e);return[t,r,i,o]}}Y(EM,"defaultProps",Zee);Y(EM,"layerName","IconLayer");const Xee=`#define SHADER_NAME scatterplot-layer-vertex-shader

attribute vec3 positions;

attribute vec3 instancePositions;
attribute vec3 instancePositions64Low;
attribute float instanceRadius;
attribute float instanceLineWidths;
attribute vec4 instanceFillColors;
attribute vec4 instanceLineColors;
attribute vec3 instancePickingColors;

uniform float opacity;
uniform float radiusScale;
uniform float radiusMinPixels;
uniform float radiusMaxPixels;
uniform float lineWidthScale;
uniform float lineWidthMinPixels;
uniform float lineWidthMaxPixels;
uniform float stroked;
uniform bool filled;
uniform bool antialiasing;
uniform bool billboard;
uniform int radiusUnits;
uniform int lineWidthUnits;

varying vec4 vFillColor;
varying vec4 vLineColor;
varying vec2 unitPosition;
varying float innerUnitRadius;
varying float outerRadiusPixels;


void main(void) {
  geometry.worldPosition = instancePositions;
  outerRadiusPixels = clamp(
    project_size_to_pixel(radiusScale * instanceRadius, radiusUnits),
    radiusMinPixels, radiusMaxPixels
  );
  float lineWidthPixels = clamp(
    project_size_to_pixel(lineWidthScale * instanceLineWidths, lineWidthUnits),
    lineWidthMinPixels, lineWidthMaxPixels
  );
  outerRadiusPixels += stroked * lineWidthPixels / 2.0;
  float edgePadding = antialiasing ? (outerRadiusPixels + SMOOTH_EDGE_RADIUS) / outerRadiusPixels : 1.0;
  unitPosition = edgePadding * positions.xy;
  geometry.uv = unitPosition;
  geometry.pickingColor = instancePickingColors;

  innerUnitRadius = 1.0 - stroked * lineWidthPixels / outerRadiusPixels;
  
  if (billboard) {
    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
    DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
    vec3 offset = edgePadding * positions * outerRadiusPixels;
    DECKGL_FILTER_SIZE(offset, geometry);
    gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
  } else {
    vec3 offset = edgePadding * positions * project_pixel_size(outerRadiusPixels);
    DECKGL_FILTER_SIZE(offset, geometry);
    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset, geometry.position);
    DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
  }
  vFillColor = vec4(instanceFillColors.rgb, instanceFillColors.a * opacity);
  DECKGL_FILTER_COLOR(vFillColor, geometry);
  vLineColor = vec4(instanceLineColors.rgb, instanceLineColors.a * opacity);
  DECKGL_FILTER_COLOR(vLineColor, geometry);
}
`,Qee=`#define SHADER_NAME scatterplot-layer-fragment-shader

precision highp float;

uniform bool filled;
uniform float stroked;
uniform bool antialiasing;

varying vec4 vFillColor;
varying vec4 vLineColor;
varying vec2 unitPosition;
varying float innerUnitRadius;
varying float outerRadiusPixels;

void main(void) {
  geometry.uv = unitPosition;

  float distToCenter = length(unitPosition) * outerRadiusPixels;
  float inCircle = antialiasing ? 
    smoothedge(distToCenter, outerRadiusPixels) : 
    step(distToCenter, outerRadiusPixels);

  if (inCircle == 0.0) {
    discard;
  }

  if (stroked > 0.5) {
    float isLine = antialiasing ? 
      smoothedge(innerUnitRadius * outerRadiusPixels, distToCenter) :
      step(innerUnitRadius * outerRadiusPixels, distToCenter);

    if (filled) {
      gl_FragColor = mix(vFillColor, vLineColor, isLine);
    } else {
      if (isLine == 0.0) {
        discard;
      }
      gl_FragColor = vec4(vLineColor.rgb, vLineColor.a * isLine);
    }
  } else if (!filled) {
    discard;
  } else {
    gl_FragColor = vFillColor;
  }

  gl_FragColor.a *= inCircle;
  DECKGL_FILTER_COLOR(gl_FragColor, geometry);
}
`,xN=[0,0,0,255],Jee={radiusUnits:"meters",radiusScale:{type:"number",min:0,value:1},radiusMinPixels:{type:"number",min:0,value:0},radiusMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},lineWidthUnits:"meters",lineWidthScale:{type:"number",min:0,value:1},lineWidthMinPixels:{type:"number",min:0,value:0},lineWidthMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},stroked:!1,filled:!0,billboard:!1,antialiasing:!0,getPosition:{type:"accessor",value:n=>n.position},getRadius:{type:"accessor",value:1},getFillColor:{type:"accessor",value:xN},getLineColor:{type:"accessor",value:xN},getLineWidth:{type:"accessor",value:1},strokeWidth:{deprecatedFor:"getLineWidth"},outline:{deprecatedFor:"stroked"},getColor:{deprecatedFor:["getFillColor","getLineColor"]}};class TM extends Nu{getShaders(){return super.getShaders({vs:Xee,fs:Qee,modules:[fy,py]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceRadius:{size:1,transition:!0,accessor:"getRadius",defaultValue:1},instanceFillColors:{size:this.props.colorFormat.length,transition:!0,normalized:!0,type:5121,accessor:"getFillColor",defaultValue:[0,0,0,255]},instanceLineColors:{size:this.props.colorFormat.length,transition:!0,normalized:!0,type:5121,accessor:"getLineColor",defaultValue:[0,0,0,255]},instanceLineWidths:{size:1,transition:!0,accessor:"getLineWidth",defaultValue:1}})}updateState(e){if(super.updateState(e),e.changeFlags.extensionsChanged){var t;const{gl:r}=this.context;(t=this.state.model)===null||t===void 0||t.delete(),this.state.model=this._getModel(r),this.getAttributeManager().invalidateAll()}}draw({uniforms:e}){const{radiusUnits:t,radiusScale:r,radiusMinPixels:i,radiusMaxPixels:o,stroked:a,filled:l,billboard:h,antialiasing:p,lineWidthUnits:g,lineWidthScale:_,lineWidthMinPixels:x,lineWidthMaxPixels:C}=this.props;this.state.model.setUniforms(e).setUniforms({stroked:a?1:0,filled:l,billboard:h,antialiasing:p,radiusUnits:Um[t],radiusScale:r,radiusMinPixels:i,radiusMaxPixels:o,lineWidthUnits:Um[g],lineWidthScale:_,lineWidthMinPixels:x,lineWidthMaxPixels:C}).draw()}_getModel(e){const t=[-1,-1,0,1,-1,0,1,1,0,-1,1,0];return new rp(e,{...this.getShaders(),id:this.props.id,geometry:new hy({drawMode:6,vertexCount:4,attributes:{positions:{size:3,value:new Float32Array(t)}}}),isInstanced:!0})}}Y(TM,"defaultProps",Jee);Y(TM,"layerName","ScatterplotLayer");const ete=`#define SHADER_NAME multi-icon-layer-fragment-shader

precision highp float;

uniform float opacity;
uniform sampler2D iconsTexture;
uniform float gamma;
uniform bool sdf;
uniform float alphaCutoff;
uniform float sdfBuffer;
uniform float outlineBuffer;
uniform vec4 outlineColor;

varying vec4 vColor;
varying vec2 vTextureCoords;
varying vec2 uv;

void main(void) {
  geometry.uv = uv;

  if (!picking_uActive) {
    float alpha = texture2D(iconsTexture, vTextureCoords).a;
    vec4 color = vColor;
    if (sdf) {
      float distance = alpha;
      alpha = smoothstep(sdfBuffer - gamma, sdfBuffer + gamma, distance);

      if (outlineBuffer > 0.0) {
        float inFill = alpha;
        float inBorder = smoothstep(outlineBuffer - gamma, outlineBuffer + gamma, distance);
        color = mix(outlineColor, vColor, inFill);
        alpha = inBorder;
      }
    }
    float a = alpha * color.a;
    
    if (a < alphaCutoff) {
      discard;
    }

    gl_FragColor = vec4(color.rgb, a * opacity);
  }

  DECKGL_FILTER_COLOR(gl_FragColor, geometry);
}
`,lC=192/256,EN=[],tte={getIconOffsets:{type:"accessor",value:n=>n.offsets},alphaCutoff:.001,smoothing:.1,outlineWidth:0,outlineColor:{type:"color",value:[0,0,0,255]}};class SM extends EM{constructor(...e){super(...e),Y(this,"state",void 0)}getShaders(){return{...super.getShaders(),fs:ete}}initializeState(){super.initializeState(),this.getAttributeManager().addInstanced({instanceOffsets:{size:2,accessor:"getIconOffsets"},instancePickingColors:{type:5121,size:3,accessor:(t,{index:r,target:i})=>this.encodePickingColor(r,i)}})}updateState(e){super.updateState(e);const{props:t,oldProps:r}=e;let{outlineColor:i}=t;i!==r.outlineColor&&(i=i.map(o=>o/255),i[3]=Number.isFinite(i[3])?i[3]:1,this.setState({outlineColor:i})),!t.sdf&&t.outlineWidth&&Fr.warn("".concat(this.id,": fontSettings.sdf is required to render outline"))()}draw(e){const{sdf:t,smoothing:r,outlineWidth:i}=this.props,{outlineColor:o}=this.state,a=i?Math.max(r,lC*(1-i)):-1;if(e.uniforms={...e.uniforms,sdfBuffer:lC,outlineBuffer:a,gamma:r,sdf:!!t,outlineColor:o},super.draw(e),t&&i){const{iconManager:l}=this.state;l.getTexture()&&this.state.model.draw({uniforms:{outlineBuffer:lC}})}}getInstanceOffset(e){return e?Array.from(e).flatMap(t=>super.getInstanceOffset(t)):EN}getInstanceColorMode(e){return 1}getInstanceIconFrame(e){return e?Array.from(e).flatMap(t=>super.getInstanceIconFrame(t)):EN}}Y(SM,"defaultProps",tte);Y(SM,"layerName","MultiIconLayer");const Vv=1e20;class nte{constructor({fontSize:e=24,buffer:t=3,radius:r=8,cutoff:i=.25,fontFamily:o="sans-serif",fontWeight:a="normal",fontStyle:l="normal"}={}){this.buffer=t,this.cutoff=i,this.radius=r;const h=this.size=e+t*4,p=this._createCanvas(h),g=this.ctx=p.getContext("2d",{willReadFrequently:!0});g.font=`${l} ${a} ${e}px ${o}`,g.textBaseline="alphabetic",g.textAlign="left",g.fillStyle="black",this.gridOuter=new Float64Array(h*h),this.gridInner=new Float64Array(h*h),this.f=new Float64Array(h),this.z=new Float64Array(h+1),this.v=new Uint16Array(h)}_createCanvas(e){const t=document.createElement("canvas");return t.width=t.height=e,t}draw(e){const{width:t,actualBoundingBoxAscent:r,actualBoundingBoxDescent:i,actualBoundingBoxLeft:o,actualBoundingBoxRight:a}=this.ctx.measureText(e),l=Math.ceil(r),h=0,p=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(a-o))),g=Math.min(this.size-this.buffer,l+Math.ceil(i)),_=p+2*this.buffer,x=g+2*this.buffer,C=Math.max(_*x,0),M=new Uint8ClampedArray(C),L={data:M,width:_,height:x,glyphWidth:p,glyphHeight:g,glyphTop:l,glyphLeft:h,glyphAdvance:t};if(p===0||g===0)return L;const{ctx:D,buffer:z,gridInner:te,gridOuter:le}=this;D.clearRect(z,z,p,g),D.fillText(e,z,z+l);const ce=D.getImageData(z,z,p,g);le.fill(Vv,0,C),te.fill(0,0,C);for(let _e=0;_e<g;_e++)for(let J=0;J<p;J++){const pe=ce.data[4*(_e*p+J)+3]/255;if(pe===0)continue;const ue=(_e+z)*_+J+z;if(pe===1)le[ue]=0,te[ue]=Vv;else{const xe=.5-pe;le[ue]=xe>0?xe*xe:0,te[ue]=xe<0?xe*xe:0}}TN(le,0,0,_,x,_,this.f,this.v,this.z),TN(te,z,z,p,g,_,this.f,this.v,this.z);for(let _e=0;_e<C;_e++){const J=Math.sqrt(le[_e])-Math.sqrt(te[_e]);M[_e]=Math.round(255-255*(J/this.radius+this.cutoff))}return L}}function TN(n,e,t,r,i,o,a,l,h){for(let p=e;p<e+r;p++)SN(n,t*o+p,o,i,a,l,h);for(let p=t;p<t+i;p++)SN(n,p*o+e,1,r,a,l,h)}function SN(n,e,t,r,i,o,a){o[0]=0,a[0]=-Vv,a[1]=Vv,i[0]=n[e];for(let l=1,h=0,p=0;l<r;l++){i[l]=n[e+l*t];const g=l*l;do{const _=o[h];p=(i[l]-i[_]+g-_*_)/(l-_)/2}while(p<=a[h]&&--h>-1);h++,o[h]=l,a[h]=p,a[h+1]=Vv}for(let l=0,h=0;l<r;l++){for(;a[h+1]<l;)h++;const p=o[h],g=l-p;n[e+l*t]=i[p]+g*g}}const rte=32,ite=[];function ote(n){return Math.pow(2,Math.ceil(Math.log2(n)))}function ate({characterSet:n,getFontWidth:e,fontHeight:t,buffer:r,maxCanvasWidth:i,mapping:o={},xOffset:a=0,yOffset:l=0}){let h=0,p=a;const g=t+r*2;for(const _ of n)if(!o[_]){const x=e(_);p+x+r*2>i&&(p=0,h++),o[_]={x:p+r,y:l+h*g+r,width:x,height:g,layoutWidth:x,layoutHeight:t},p+=x+r*2}return{mapping:o,xOffset:p,yOffset:l+h*g,canvasHeight:ote(l+(h+1)*g)}}function nB(n,e,t,r){let i=0;for(let a=e;a<t;a++){var o;const l=n[a];i+=((o=r[l])===null||o===void 0?void 0:o.layoutWidth)||0}return i}function rB(n,e,t,r,i,o){let a=e,l=0;for(let h=e;h<t;h++){const p=nB(n,h,h+1,i);l+p>r&&(a<h&&o.push(h),a=h,l=0),l+=p}return l}function ste(n,e,t,r,i,o){let a=e,l=e,h=e,p=0;for(let g=e;g<t;g++)if((n[g]===" "||n[g+1]===" "||g+1===t)&&(h=g+1),h>l){let _=nB(n,l,h,i);p+_>r&&(a<l&&(o.push(l),a=l,p=0),_>r&&(_=rB(n,l,h,r,i,o),a=o[o.length-1])),l=h,p+=_}return p}function cte(n,e,t,r,i=0,o){o===void 0&&(o=n.length);const a=[];return e==="break-all"?rB(n,i,o,t,r,a):ste(n,i,o,t,r,a),a}function lte(n,e,t,r,i,o){let a=0,l=0;for(let h=e;h<t;h++){const p=n[h],g=r[p];g?(l||(l=g.layoutHeight),i[h]=a+g.layoutWidth/2,a+=g.layoutWidth):(Fr.warn("Missing character: ".concat(p," (").concat(p.codePointAt(0),")"))(),i[h]=a,a+=rte)}o[0]=a,o[1]=l}function ute(n,e,t,r,i){const o=Array.from(n),a=o.length,l=new Array(a),h=new Array(a),p=new Array(a),g=(t==="break-word"||t==="break-all")&&isFinite(r)&&r>0,_=[0,0],x=[0,0];let C=0,M=0,L=0;for(let z=0;z<=a;z++){const te=o[z];if((te===`
`||z===a)&&(L=z),L>M){const le=g?cte(o,t,r,i,M,L):ite;for(let ce=0;ce<=le.length;ce++){const _e=ce===0?M:le[ce-1],J=ce<le.length?le[ce]:L;lte(o,_e,J,i,l,x);for(let pe=_e;pe<J;pe++){var D;const ue=o[pe],xe=((D=i[ue])===null||D===void 0?void 0:D.layoutOffsetY)||0;h[pe]=C+x[1]/2+xe,p[pe]=x[0]}C=C+x[1]*e,_[0]=Math.max(_[0],x[0])}M=L}te===`
`&&(l[M]=0,h[M]=0,p[M]=0,M++)}return _[1]=C,{x:l,y:h,rowWidth:p,size:_}}function hte({value:n,length:e,stride:t,offset:r,startIndices:i,characterSet:o}){const a=n.BYTES_PER_ELEMENT,l=t?t/a:1,h=r?r/a:0,p=i[e]||Math.ceil((n.length-h)/l),g=o&&new Set,_=new Array(e);let x=n;if(l>1||h>0){const C=n.constructor;x=new C(p);for(let M=0;M<p;M++)x[M]=n[M*l+h]}for(let C=0;C<e;C++){const M=i[C],L=i[C+1]||p,D=x.subarray(M,L);_[C]=String.fromCodePoint.apply(null,D),g&&D.forEach(g.add,g)}if(g)for(const C of g)o.add(String.fromCodePoint(C));return{texts:_,characterCount:p}}class iB{constructor(e=5){Y(this,"limit",void 0),Y(this,"_cache",{}),Y(this,"_order",[]),this.limit=e}get(e){const t=this._cache[e];return t&&(this._deleteOrder(e),this._appendOrder(e)),t}set(e,t){this._cache[e]?(this.delete(e),this._cache[e]=t,this._appendOrder(e)):(Object.keys(this._cache).length===this.limit&&this.delete(this._order[0]),this._cache[e]=t,this._appendOrder(e))}delete(e){this._cache[e]&&(delete this._cache[e],this._deleteOrder(e))}_deleteOrder(e){const t=this._order.indexOf(e);t>=0&&this._order.splice(t,1)}_appendOrder(e){this._order.push(e)}}function dte(){const n=[];for(let e=32;e<128;e++)n.push(String.fromCharCode(e));return n}const ym={fontFamily:"Monaco, monospace",fontWeight:"normal",characterSet:dte(),fontSize:64,buffer:4,sdf:!1,cutoff:.25,radius:12,smoothing:.1},CN=1024,AN=.9,IN=1.2,oB=3;let wx=new iB(oB);function fte(n,e){let t;typeof e=="string"?t=new Set(Array.from(e)):t=new Set(e);const r=wx.get(n);if(!r)return t;for(const i in r.mapping)t.has(i)&&t.delete(i);return t}function pte(n,e){for(let t=0;t<n.length;t++)e.data[4*t+3]=n[t]}function PN(n,e,t,r){n.font="".concat(r," ").concat(t,"px ").concat(e),n.fillStyle="#000",n.textBaseline="alphabetic",n.textAlign="left"}function gte(n){Fr.assert(Number.isFinite(n)&&n>=oB,"Invalid cache limit"),wx=new iB(n)}class mte{constructor(){Y(this,"props",{...ym}),Y(this,"_key",void 0),Y(this,"_atlas",void 0)}get texture(){return this._atlas}get mapping(){return this._atlas&&this._atlas.mapping}get scale(){const{fontSize:e,buffer:t}=this.props;return(e*IN+t*2)/e}setProps(e={}){Object.assign(this.props,e),this._key=this._getKey();const t=fte(this._key,this.props.characterSet),r=wx.get(this._key);if(r&&t.size===0){this._atlas!==r&&(this._atlas=r);return}const i=this._generateFontAtlas(t,r);this._atlas=i,wx.set(this._key,i)}_generateFontAtlas(e,t){const{fontFamily:r,fontWeight:i,fontSize:o,buffer:a,sdf:l,radius:h,cutoff:p}=this.props;let g=t&&t.data;g||(g=document.createElement("canvas"),g.width=CN);const _=g.getContext("2d",{willReadFrequently:!0});PN(_,r,o,i);const{mapping:x,canvasHeight:C,xOffset:M,yOffset:L}=ate({getFontWidth:D=>_.measureText(D).width,fontHeight:o*IN,buffer:a,characterSet:e,maxCanvasWidth:CN,...t&&{mapping:t.mapping,xOffset:t.xOffset,yOffset:t.yOffset}});if(g.height!==C){const D=_.getImageData(0,0,g.width,g.height);g.height=C,_.putImageData(D,0,0)}if(PN(_,r,o,i),l){const D=new nte({fontSize:o,buffer:a,radius:h,cutoff:p,fontFamily:r,fontWeight:"".concat(i)});for(const z of e){const{data:te,width:le,height:ce,glyphTop:_e}=D.draw(z);x[z].width=le,x[z].layoutOffsetY=o*AN-_e;const J=_.createImageData(le,ce);pte(te,J),_.putImageData(J,x[z].x,x[z].y)}}else for(const D of e)_.fillText(D,x[D].x,x[D].y+a+o*AN);return{xOffset:M,yOffset:L,mapping:x,data:g,width:g.width,height:g.height}}_getKey(){const{fontFamily:e,fontWeight:t,fontSize:r,buffer:i,sdf:o,radius:a,cutoff:l}=this.props;return o?"".concat(e," ").concat(t," ").concat(r," ").concat(i," ").concat(a," ").concat(l):"".concat(e," ").concat(t," ").concat(r," ").concat(i)}}const yte=`#define SHADER_NAME text-background-layer-vertex-shader

attribute vec2 positions;

attribute vec3 instancePositions;
attribute vec3 instancePositions64Low;
attribute vec4 instanceRects;
attribute float instanceSizes;
attribute float instanceAngles;
attribute vec2 instancePixelOffsets;
attribute float instanceLineWidths;
attribute vec4 instanceFillColors;
attribute vec4 instanceLineColors;
attribute vec3 instancePickingColors;

uniform bool billboard;
uniform float opacity;
uniform float sizeScale;
uniform float sizeMinPixels;
uniform float sizeMaxPixels;
uniform vec4 padding;
uniform int sizeUnits;

varying vec4 vFillColor;
varying vec4 vLineColor;
varying float vLineWidth;
varying vec2 uv;
varying vec2 dimensions;

vec2 rotate_by_angle(vec2 vertex, float angle) {
  float angle_radian = radians(angle);
  float cos_angle = cos(angle_radian);
  float sin_angle = sin(angle_radian);
  mat2 rotationMatrix = mat2(cos_angle, -sin_angle, sin_angle, cos_angle);
  return rotationMatrix * vertex;
}

void main(void) {
  geometry.worldPosition = instancePositions;
  geometry.uv = positions;
  geometry.pickingColor = instancePickingColors;
  uv = positions;
  vLineWidth = instanceLineWidths;
  float sizePixels = clamp(
    project_size_to_pixel(instanceSizes * sizeScale, sizeUnits),
    sizeMinPixels, sizeMaxPixels
  );

  dimensions = instanceRects.zw * sizePixels + padding.xy + padding.zw;

  vec2 pixelOffset = (positions * instanceRects.zw + instanceRects.xy) * sizePixels + mix(-padding.xy, padding.zw, positions);
  pixelOffset = rotate_by_angle(pixelOffset, instanceAngles);
  pixelOffset += instancePixelOffsets;
  pixelOffset.y *= -1.0;

  if (billboard)  {
    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
    DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
    vec3 offset = vec3(pixelOffset, 0.0);
    DECKGL_FILTER_SIZE(offset, geometry);
    gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
  } else {
    vec3 offset_common = vec3(project_pixel_size(pixelOffset), 0.0);
    DECKGL_FILTER_SIZE(offset_common, geometry);
    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset_common, geometry.position);
    DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
  }
  vFillColor = vec4(instanceFillColors.rgb, instanceFillColors.a * opacity);
  DECKGL_FILTER_COLOR(vFillColor, geometry);
  vLineColor = vec4(instanceLineColors.rgb, instanceLineColors.a * opacity);
  DECKGL_FILTER_COLOR(vLineColor, geometry);
}
`,_te=`#define SHADER_NAME text-background-layer-fragment-shader

precision highp float;

uniform bool stroked;

varying vec4 vFillColor;
varying vec4 vLineColor;
varying float vLineWidth;
varying vec2 uv;
varying vec2 dimensions;

void main(void) {
  geometry.uv = uv;

  vec2 pixelPosition = uv * dimensions;
  if (stroked) {
    float distToEdge = min(
      min(pixelPosition.x, dimensions.x - pixelPosition.x),
      min(pixelPosition.y, dimensions.y - pixelPosition.y)
    );
    float isBorder = smoothedge(distToEdge, vLineWidth);
    gl_FragColor = mix(vFillColor, vLineColor, isBorder);
  } else {
    gl_FragColor = vFillColor;
  }

  DECKGL_FILTER_COLOR(gl_FragColor, geometry);
}
`,vte={billboard:!0,sizeScale:1,sizeUnits:"pixels",sizeMinPixels:0,sizeMaxPixels:Number.MAX_SAFE_INTEGER,padding:{type:"array",value:[0,0,0,0]},getPosition:{type:"accessor",value:n=>n.position},getSize:{type:"accessor",value:1},getAngle:{type:"accessor",value:0},getPixelOffset:{type:"accessor",value:[0,0]},getBoundingRect:{type:"accessor",value:[0,0,0,0]},getFillColor:{type:"accessor",value:[0,0,0,255]},getLineColor:{type:"accessor",value:[0,0,0,255]},getLineWidth:{type:"accessor",value:1}};class CM extends Nu{constructor(...e){super(...e),Y(this,"state",void 0)}getShaders(){return super.getShaders({vs:yte,fs:_te,modules:[fy,py]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceSizes:{size:1,transition:!0,accessor:"getSize",defaultValue:1},instanceAngles:{size:1,transition:!0,accessor:"getAngle"},instanceRects:{size:4,accessor:"getBoundingRect"},instancePixelOffsets:{size:2,transition:!0,accessor:"getPixelOffset"},instanceFillColors:{size:4,transition:!0,normalized:!0,type:5121,accessor:"getFillColor",defaultValue:[0,0,0,255]},instanceLineColors:{size:4,transition:!0,normalized:!0,type:5121,accessor:"getLineColor",defaultValue:[0,0,0,255]},instanceLineWidths:{size:1,transition:!0,accessor:"getLineWidth",defaultValue:1}})}updateState(e){super.updateState(e);const{changeFlags:t}=e;if(t.extensionsChanged){var r;const{gl:i}=this.context;(r=this.state.model)===null||r===void 0||r.delete(),this.state.model=this._getModel(i),this.getAttributeManager().invalidateAll()}}draw({uniforms:e}){const{billboard:t,sizeScale:r,sizeUnits:i,sizeMinPixels:o,sizeMaxPixels:a,getLineWidth:l}=this.props;let{padding:h}=this.props;h.length<4&&(h=[h[0],h[1],h[0],h[1]]),this.state.model.setUniforms(e).setUniforms({billboard:t,stroked:!!l,padding:h,sizeUnits:Um[i],sizeScale:r,sizeMinPixels:o,sizeMaxPixels:a}).draw()}_getModel(e){const t=[0,0,1,0,1,1,0,1];return new rp(e,{...this.getShaders(),id:this.props.id,geometry:new hy({drawMode:6,vertexCount:4,attributes:{positions:{size:2,value:new Float32Array(t)}}}),isInstanced:!0})}}Y(CM,"defaultProps",vte);Y(CM,"layerName","TextBackgroundLayer");const MN={start:1,middle:0,end:-1},RN={top:1,center:0,bottom:-1},uC=[0,0,0,255],bte=1,wte={billboard:!0,sizeScale:1,sizeUnits:"pixels",sizeMinPixels:0,sizeMaxPixels:Number.MAX_SAFE_INTEGER,background:!1,getBackgroundColor:{type:"accessor",value:[255,255,255,255]},getBorderColor:{type:"accessor",value:uC},getBorderWidth:{type:"accessor",value:0},backgroundPadding:{type:"array",value:[0,0,0,0]},characterSet:{type:"object",value:ym.characterSet},fontFamily:ym.fontFamily,fontWeight:ym.fontWeight,lineHeight:bte,outlineWidth:{type:"number",value:0,min:0},outlineColor:{type:"color",value:uC},fontSettings:{type:"object",value:{},compare:1},wordBreak:"break-word",maxWidth:{type:"number",value:-1},getText:{type:"accessor",value:n=>n.text},getPosition:{type:"accessor",value:n=>n.position},getColor:{type:"accessor",value:uC},getSize:{type:"accessor",value:32},getAngle:{type:"accessor",value:0},getTextAnchor:{type:"accessor",value:"middle"},getAlignmentBaseline:{type:"accessor",value:"center"},getPixelOffset:{type:"accessor",value:[0,0]},backgroundColor:{deprecatedFor:["background","getBackgroundColor"]}};class AM extends xM{constructor(...e){super(...e),Y(this,"state",void 0),Y(this,"getBoundingRect",(t,r)=>{let{size:[i,o]}=this.transformParagraph(t,r);const{fontSize:a}=this.state.fontAtlasManager.props;i/=a,o/=a;const{getTextAnchor:l,getAlignmentBaseline:h}=this.props,p=MN[typeof l=="function"?l(t,r):l],g=RN[typeof h=="function"?h(t,r):h];return[(p-1)*i/2,(g-1)*o/2,i,o]}),Y(this,"getIconOffsets",(t,r)=>{const{getTextAnchor:i,getAlignmentBaseline:o}=this.props,{x:a,y:l,rowWidth:h,size:[p,g]}=this.transformParagraph(t,r),_=MN[typeof i=="function"?i(t,r):i],x=RN[typeof o=="function"?o(t,r):o],C=a.length,M=new Array(C*2);let L=0;for(let D=0;D<C;D++){const z=(1-_)*(p-h[D])/2;M[L++]=(_-1)*p/2+z+a[D],M[L++]=(x-1)*g/2+l[D]}return M})}initializeState(){this.state={styleVersion:0,fontAtlasManager:new mte},this.props.maxWidth>0&&Fr.warn("v8.9 breaking change: TextLayer maxWidth is now relative to text size")()}updateState(e){const{props:t,oldProps:r,changeFlags:i}=e;(i.dataChanged||i.updateTriggersChanged&&(i.updateTriggersChanged.all||i.updateTriggersChanged.getText))&&this._updateText(),(this._updateFontAtlas()||t.lineHeight!==r.lineHeight||t.wordBreak!==r.wordBreak||t.maxWidth!==r.maxWidth)&&this.setState({styleVersion:this.state.styleVersion+1})}getPickingInfo({info:e}){return e.object=e.index>=0?this.props.data[e.index]:null,e}_updateFontAtlas(){const{fontSettings:e,fontFamily:t,fontWeight:r}=this.props,{fontAtlasManager:i,characterSet:o}=this.state,a={...e,characterSet:o,fontFamily:t,fontWeight:r};if(!i.mapping)return i.setProps(a),!0;for(const l in a)if(a[l]!==i.props[l])return i.setProps(a),!0;return!1}_updateText(){var e;const{data:t,characterSet:r}=this.props,i=(e=t.attributes)===null||e===void 0?void 0:e.getText;let{getText:o}=this.props,a=t.startIndices,l;const h=r==="auto"&&new Set;if(i&&a){const{texts:p,characterCount:g}=hte({...ArrayBuffer.isView(i)?{value:i}:i,length:t.length,startIndices:a,characterSet:h});l=g,o=(_,{index:x})=>p[x]}else{const{iterable:p,objectInfo:g}=yM(t);a=[0],l=0;for(const _ of p){g.index++;const x=Array.from(o(_,g)||"");h&&x.forEach(h.add,h),l+=x.length,a.push(l)}}this.setState({getText:o,startIndices:a,numInstances:l,characterSet:h||r})}transformParagraph(e,t){const{fontAtlasManager:r}=this.state,i=r.mapping,o=this.state.getText,{wordBreak:a,lineHeight:l,maxWidth:h}=this.props,p=o(e,t)||"";return ute(p,l,a,h*r.props.fontSize,i)}renderLayers(){const{startIndices:e,numInstances:t,getText:r,fontAtlasManager:{scale:i,texture:o,mapping:a},styleVersion:l}=this.state,{data:h,_dataDiff:p,getPosition:g,getColor:_,getSize:x,getAngle:C,getPixelOffset:M,getBackgroundColor:L,getBorderColor:D,getBorderWidth:z,backgroundPadding:te,background:le,billboard:ce,fontSettings:_e,outlineWidth:J,outlineColor:pe,sizeScale:ue,sizeUnits:xe,sizeMinPixels:je,sizeMaxPixels:ne,transitions:Ee,updateTriggers:ke}=this.props,Be=this.getSubLayerClass("characters",SM),Ze=this.getSubLayerClass("background",CM);return[le&&new Ze({getFillColor:L,getLineColor:D,getLineWidth:z,padding:te,getPosition:g,getSize:x,getAngle:C,getPixelOffset:M,billboard:ce,sizeScale:ue,sizeUnits:xe,sizeMinPixels:je,sizeMaxPixels:ne,transitions:Ee&&{getPosition:Ee.getPosition,getAngle:Ee.getAngle,getSize:Ee.getSize,getFillColor:Ee.getBackgroundColor,getLineColor:Ee.getBorderColor,getLineWidth:Ee.getBorderWidth,getPixelOffset:Ee.getPixelOffset}},this.getSubLayerProps({id:"background",updateTriggers:{getPosition:ke.getPosition,getAngle:ke.getAngle,getSize:ke.getSize,getFillColor:ke.getBackgroundColor,getLineColor:ke.getBorderColor,getLineWidth:ke.getBorderWidth,getPixelOffset:ke.getPixelOffset,getBoundingRect:{getText:ke.getText,getTextAnchor:ke.getTextAnchor,getAlignmentBaseline:ke.getAlignmentBaseline,styleVersion:l}}}),{data:h.attributes&&h.attributes.background?{length:h.length,attributes:h.attributes.background}:h,_dataDiff:p,autoHighlight:!1,getBoundingRect:this.getBoundingRect}),new Be({sdf:_e.sdf,smoothing:Number.isFinite(_e.smoothing)?_e.smoothing:ym.smoothing,outlineWidth:J/(_e.radius||ym.radius),outlineColor:pe,iconAtlas:o,iconMapping:a,getPosition:g,getColor:_,getSize:x,getAngle:C,getPixelOffset:M,billboard:ce,sizeScale:ue*i,sizeUnits:xe,sizeMinPixels:je*i,sizeMaxPixels:ne*i,transitions:Ee&&{getPosition:Ee.getPosition,getAngle:Ee.getAngle,getColor:Ee.getColor,getSize:Ee.getSize,getPixelOffset:Ee.getPixelOffset}},this.getSubLayerProps({id:"characters",updateTriggers:{all:ke.getText,getPosition:ke.getPosition,getAngle:ke.getAngle,getColor:ke.getColor,getSize:ke.getSize,getPixelOffset:ke.getPixelOffset,getIconOffsets:{getTextAnchor:ke.getTextAnchor,getAlignmentBaseline:ke.getAlignmentBaseline,styleVersion:l}}}),{data:h,_dataDiff:p,startIndices:e,numInstances:t,getIconOffsets:this.getIconOffsets,getIcon:r})]}static set fontAtlasCacheLimit(e){gte(e)}}Y(AM,"defaultProps",wte);Y(AM,"layerName","TextLayer");function IM(n){const{children:e}=n;return e&&e.length>0}function Tv(n){const{zoom:e}=n;return e!==void 0}function hC(n){return n&&!!n.aggregate}var em;(function(n){n.ALL="ALL",n.INCOMING="INCOMING",n.OUTGOING="OUTGOING",n.BETWEEN="BETWEEN"})(em||(em={}));function Ki(n){for(var e=n.length/6|0,t=new Array(e),r=0;r<e;)t[r]="#"+n.slice(r*6,++r*6);return t}function gy(n,e,t){n.prototype=e.prototype=t,t.constructor=n}function sb(n,e){var t=Object.create(n.prototype);for(var r in e)t[r]=e[r];return t}function hd(){}var Vf=.7,Ym=1/Vf,_m="\\s*([+-]?\\d+)\\s*",x0="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",ml="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",xte=/^#([0-9a-f]{3,8})$/,Ete=new RegExp(`^rgb\\(${_m},${_m},${_m}\\)$`),Tte=new RegExp(`^rgb\\(${ml},${ml},${ml}\\)$`),Ste=new RegExp(`^rgba\\(${_m},${_m},${_m},${x0}\\)$`),Cte=new RegExp(`^rgba\\(${ml},${ml},${ml},${x0}\\)$`),Ate=new RegExp(`^hsl\\(${x0},${ml},${ml}\\)$`),Ite=new RegExp(`^hsla\\(${x0},${ml},${ml},${x0}\\)$`),kN={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};gy(hd,Hf,{copy(n){return Object.assign(new this.constructor,this,n)},displayable(){return this.rgb().displayable()},hex:ON,formatHex:ON,formatHex8:Pte,formatHsl:Mte,formatRgb:LN,toString:LN});function ON(){return this.rgb().formatHex()}function Pte(){return this.rgb().formatHex8()}function Mte(){return aB(this).formatHsl()}function LN(){return this.rgb().formatRgb()}function Hf(n){var e,t;return n=(n+"").trim().toLowerCase(),(e=xte.exec(n))?(t=e[1].length,e=parseInt(e[1],16),t===6?NN(e):t===3?new No(e>>8&15|e>>4&240,e>>4&15|e&240,(e&15)<<4|e&15,1):t===8?U1(e>>24&255,e>>16&255,e>>8&255,(e&255)/255):t===4?U1(e>>12&15|e>>8&240,e>>8&15|e>>4&240,e>>4&15|e&240,((e&15)<<4|e&15)/255):null):(e=Ete.exec(n))?new No(e[1],e[2],e[3],1):(e=Tte.exec(n))?new No(e[1]*255/100,e[2]*255/100,e[3]*255/100,1):(e=Ste.exec(n))?U1(e[1],e[2],e[3],e[4]):(e=Cte.exec(n))?U1(e[1]*255/100,e[2]*255/100,e[3]*255/100,e[4]):(e=Ate.exec(n))?BN(e[1],e[2]/100,e[3]/100,1):(e=Ite.exec(n))?BN(e[1],e[2]/100,e[3]/100,e[4]):kN.hasOwnProperty(n)?NN(kN[n]):n==="transparent"?new No(NaN,NaN,NaN,0):null}function NN(n){return new No(n>>16&255,n>>8&255,n&255,1)}function U1(n,e,t,r){return r<=0&&(n=e=t=NaN),new No(n,e,t,r)}function PM(n){return n instanceof hd||(n=Hf(n)),n?(n=n.rgb(),new No(n.r,n.g,n.b,n.opacity)):new No}function E0(n,e,t,r){return arguments.length===1?PM(n):new No(n,e,t,r??1)}function No(n,e,t,r){this.r=+n,this.g=+e,this.b=+t,this.opacity=+r}gy(No,E0,sb(hd,{brighter(n){return n=n==null?Ym:Math.pow(Ym,n),new No(this.r*n,this.g*n,this.b*n,this.opacity)},darker(n){return n=n==null?Vf:Math.pow(Vf,n),new No(this.r*n,this.g*n,this.b*n,this.opacity)},rgb(){return this},clamp(){return new No(Sf(this.r),Sf(this.g),Sf(this.b),xx(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:DN,formatHex:DN,formatHex8:Rte,formatRgb:FN,toString:FN}));function DN(){return`#${mf(this.r)}${mf(this.g)}${mf(this.b)}`}function Rte(){return`#${mf(this.r)}${mf(this.g)}${mf(this.b)}${mf((isNaN(this.opacity)?1:this.opacity)*255)}`}function FN(){const n=xx(this.opacity);return`${n===1?"rgb(":"rgba("}${Sf(this.r)}, ${Sf(this.g)}, ${Sf(this.b)}${n===1?")":`, ${n})`}`}function xx(n){return isNaN(n)?1:Math.max(0,Math.min(1,n))}function Sf(n){return Math.max(0,Math.min(255,Math.round(n)||0))}function mf(n){return n=Sf(n),(n<16?"0":"")+n.toString(16)}function BN(n,e,t,r){return r<=0?n=e=t=NaN:t<=0||t>=1?n=e=NaN:e<=0&&(n=NaN),new Tc(n,e,t,r)}function aB(n){if(n instanceof Tc)return new Tc(n.h,n.s,n.l,n.opacity);if(n instanceof hd||(n=Hf(n)),!n)return new Tc;if(n instanceof Tc)return n;n=n.rgb();var e=n.r/255,t=n.g/255,r=n.b/255,i=Math.min(e,t,r),o=Math.max(e,t,r),a=NaN,l=o-i,h=(o+i)/2;return l?(e===o?a=(t-r)/l+(t<r)*6:t===o?a=(r-e)/l+2:a=(e-t)/l+4,l/=h<.5?o+i:2-o-i,a*=60):l=h>0&&h<1?0:a,new Tc(a,l,h,n.opacity)}function kte(n,e,t,r){return arguments.length===1?aB(n):new Tc(n,e,t,r??1)}function Tc(n,e,t,r){this.h=+n,this.s=+e,this.l=+t,this.opacity=+r}gy(Tc,kte,sb(hd,{brighter(n){return n=n==null?Ym:Math.pow(Ym,n),new Tc(this.h,this.s,this.l*n,this.opacity)},darker(n){return n=n==null?Vf:Math.pow(Vf,n),new Tc(this.h,this.s,this.l*n,this.opacity)},rgb(){var n=this.h%360+(this.h<0)*360,e=isNaN(n)||isNaN(this.s)?0:this.s,t=this.l,r=t+(t<.5?t:1-t)*e,i=2*t-r;return new No(dC(n>=240?n-240:n+120,i,r),dC(n,i,r),dC(n<120?n+240:n-120,i,r),this.opacity)},clamp(){return new Tc(UN(this.h),z1(this.s),z1(this.l),xx(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const n=xx(this.opacity);return`${n===1?"hsl(":"hsla("}${UN(this.h)}, ${z1(this.s)*100}%, ${z1(this.l)*100}%${n===1?")":`, ${n})`}`}}));function UN(n){return n=(n||0)%360,n<0?n+360:n}function z1(n){return Math.max(0,Math.min(1,n||0))}function dC(n,e,t){return(n<60?e+(t-e)*n/60:n<180?t:n<240?e+(t-e)*(240-n)/60:e)*255}const sB=Math.PI/180,cB=180/Math.PI,Ex=18,lB=.96422,uB=1,hB=.82521,dB=4/29,vm=6/29,fB=3*vm*vm,Ote=vm*vm*vm;function pB(n){if(n instanceof yl)return new yl(n.l,n.a,n.b,n.opacity);if(n instanceof au)return gB(n);n instanceof No||(n=PM(n));var e=mC(n.r),t=mC(n.g),r=mC(n.b),i=fC((.2225045*e+.7168786*t+.0606169*r)/uB),o,a;return e===t&&t===r?o=a=i:(o=fC((.4360747*e+.3850649*t+.1430804*r)/lB),a=fC((.0139322*e+.0971045*t+.7141733*r)/hB)),new yl(116*i-16,500*(o-i),200*(i-a),n.opacity)}function Lte(n,e,t,r){return arguments.length===1?pB(n):new yl(n,e,t,r??1)}function yl(n,e,t,r){this.l=+n,this.a=+e,this.b=+t,this.opacity=+r}gy(yl,Lte,sb(hd,{brighter(n){return new yl(this.l+Ex*(n??1),this.a,this.b,this.opacity)},darker(n){return new yl(this.l-Ex*(n??1),this.a,this.b,this.opacity)},rgb(){var n=(this.l+16)/116,e=isNaN(this.a)?n:n+this.a/500,t=isNaN(this.b)?n:n-this.b/200;return e=lB*pC(e),n=uB*pC(n),t=hB*pC(t),new No(gC(3.1338561*e-1.6168667*n-.4906146*t),gC(-.9787684*e+1.9161415*n+.033454*t),gC(.0719453*e-.2289914*n+1.4052427*t),this.opacity)}}));function fC(n){return n>Ote?Math.pow(n,1/3):n/fB+dB}function pC(n){return n>vm?n*n*n:fB*(n-dB)}function gC(n){return 255*(n<=.0031308?12.92*n:1.055*Math.pow(n,1/2.4)-.055)}function mC(n){return(n/=255)<=.04045?n/12.92:Math.pow((n+.055)/1.055,2.4)}function Nte(n){if(n instanceof au)return new au(n.h,n.c,n.l,n.opacity);if(n instanceof yl||(n=pB(n)),n.a===0&&n.b===0)return new au(NaN,0<n.l&&n.l<100?0:NaN,n.l,n.opacity);var e=Math.atan2(n.b,n.a)*cB;return new au(e<0?e+360:e,Math.sqrt(n.a*n.a+n.b*n.b),n.l,n.opacity)}function tT(n,e,t,r){return arguments.length===1?Nte(n):new au(n,e,t,r??1)}function au(n,e,t,r){this.h=+n,this.c=+e,this.l=+t,this.opacity=+r}function gB(n){if(isNaN(n.h))return new yl(n.l,0,0,n.opacity);var e=n.h*sB;return new yl(n.l,Math.cos(e)*n.c,Math.sin(e)*n.c,n.opacity)}gy(au,tT,sb(hd,{brighter(n){return new au(this.h,this.c,this.l+Ex*(n??1),this.opacity)},darker(n){return new au(this.h,this.c,this.l-Ex*(n??1),this.opacity)},rgb(){return gB(this).rgb()}}));var mB=-.14861,MM=1.78277,RM=-.29227,nT=-.90649,T0=1.97294,zN=T0*nT,jN=T0*MM,VN=MM*RM-nT*mB;function Dte(n){if(n instanceof Cf)return new Cf(n.h,n.s,n.l,n.opacity);n instanceof No||(n=PM(n));var e=n.r/255,t=n.g/255,r=n.b/255,i=(VN*r+zN*e-jN*t)/(VN+zN-jN),o=r-i,a=(T0*(t-i)-RM*o)/nT,l=Math.sqrt(a*a+o*o)/(T0*i*(1-i)),h=l?Math.atan2(a,o)*cB-120:NaN;return new Cf(h<0?h+360:h,l,i,n.opacity)}function id(n,e,t,r){return arguments.length===1?Dte(n):new Cf(n,e,t,r??1)}function Cf(n,e,t,r){this.h=+n,this.s=+e,this.l=+t,this.opacity=+r}gy(Cf,id,sb(hd,{brighter(n){return n=n==null?Ym:Math.pow(Ym,n),new Cf(this.h,this.s,this.l*n,this.opacity)},darker(n){return n=n==null?Vf:Math.pow(Vf,n),new Cf(this.h,this.s,this.l*n,this.opacity)},rgb(){var n=isNaN(this.h)?0:(this.h+120)*sB,e=+this.l,t=isNaN(this.s)?0:this.s*e*(1-e),r=Math.cos(n),i=Math.sin(n);return new No(255*(e+t*(mB*r+MM*i)),255*(e+t*(RM*r+nT*i)),255*(e+t*(T0*r)),this.opacity)}}));function Fte(n,e,t,r,i){var o=n*n,a=o*n;return((1-3*n+3*o-a)*e+(4-6*o+3*a)*t+(1+3*n+3*o-3*a)*r+a*i)/6}function yB(n){var e=n.length-1;return function(t){var r=t<=0?t=0:t>=1?(t=1,e-1):Math.floor(t*e),i=n[r],o=n[r+1],a=r>0?n[r-1]:2*i-o,l=r<e-1?n[r+2]:2*o-i;return Fte((t-r/e)*e,a,i,o,l)}}const rT=n=>()=>n;function _B(n,e){return function(t){return n+t*e}}function Bte(n,e,t){return n=Math.pow(n,t),e=Math.pow(e,t)-n,t=1/t,function(r){return Math.pow(n+r*e,t)}}function Ute(n,e){var t=e-n;return t?_B(n,t>180||t<-180?t-360*Math.round(t/360):t):rT(isNaN(n)?e:n)}function zte(n){return(n=+n)==1?bm:function(e,t){return t-e?Bte(e,t,n):rT(isNaN(e)?t:e)}}function bm(n,e){var t=e-n;return t?_B(n,t):rT(isNaN(n)?e:n)}const HN=function n(e){var t=zte(e);function r(i,o){var a=t((i=E0(i)).r,(o=E0(o)).r),l=t(i.g,o.g),h=t(i.b,o.b),p=bm(i.opacity,o.opacity);return function(g){return i.r=a(g),i.g=l(g),i.b=h(g),i.opacity=p(g),i+""}}return r.gamma=n,r}(1);function jte(n){return function(e){var t=e.length,r=new Array(t),i=new Array(t),o=new Array(t),a,l;for(a=0;a<t;++a)l=E0(e[a]),r[a]=l.r||0,i[a]=l.g||0,o[a]=l.b||0;return r=n(r),i=n(i),o=n(o),l.opacity=1,function(h){return l.r=r(h),l.g=i(h),l.b=o(h),l+""}}}var vB=jte(yB);function Vte(n,e){e||(e=[]);var t=n?Math.min(e.length,n.length):0,r=e.slice(),i;return function(o){for(i=0;i<t;++i)r[i]=n[i]*(1-o)+e[i]*o;return r}}function Hte(n){return ArrayBuffer.isView(n)&&!(n instanceof DataView)}function Gte(n,e){var t=e?e.length:0,r=n?Math.min(t,n.length):0,i=new Array(r),o=new Array(t),a;for(a=0;a<r;++a)i[a]=iT(n[a],e[a]);for(;a<t;++a)o[a]=e[a];return function(l){for(a=0;a<r;++a)o[a]=i[a](l);return o}}function qte(n,e){var t=new Date;return n=+n,e=+e,function(r){return t.setTime(n*(1-r)+e*r),t}}function Tx(n,e){return n=+n,e=+e,function(t){return n*(1-t)+e*t}}function $te(n,e){var t={},r={},i;(n===null||typeof n!="object")&&(n={}),(e===null||typeof e!="object")&&(e={});for(i in e)i in n?t[i]=iT(n[i],e[i]):r[i]=e[i];return function(o){for(i in t)r[i]=t[i](o);return r}}var H2=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,yC=new RegExp(H2.source,"g");function Wte(n){return function(){return n}}function Yte(n){return function(e){return n(e)+""}}function Kte(n,e){var t=H2.lastIndex=yC.lastIndex=0,r,i,o,a=-1,l=[],h=[];for(n=n+"",e=e+"";(r=H2.exec(n))&&(i=yC.exec(e));)(o=i.index)>t&&(o=e.slice(t,o),l[a]?l[a]+=o:l[++a]=o),(r=r[0])===(i=i[0])?l[a]?l[a]+=i:l[++a]=i:(l[++a]=null,h.push({i:a,x:Tx(r,i)})),t=yC.lastIndex;return t<e.length&&(o=e.slice(t),l[a]?l[a]+=o:l[++a]=o),l.length<2?h[0]?Yte(h[0].x):Wte(e):(e=h.length,function(p){for(var g=0,_;g<e;++g)l[(_=h[g]).i]=_.x(p);return l.join("")})}function iT(n,e){var t=typeof e,r;return e==null||t==="boolean"?rT(e):(t==="number"?Tx:t==="string"?(r=Hf(e))?(e=r,HN):Kte:e instanceof Hf?HN:e instanceof Date?qte:Hte(e)?Vte:Array.isArray(e)?Gte:typeof e.valueOf!="function"&&typeof e.toString!="function"||isNaN(e)?$te:Tx)(n,e)}function bB(n,e){return n=+n,e=+e,function(t){return Math.round(n*(1-t)+e*t)}}function wB(n){return function e(t){t=+t;function r(i,o){var a=n((i=id(i)).h,(o=id(o)).h),l=bm(i.s,o.s),h=bm(i.l,o.l),p=bm(i.opacity,o.opacity);return function(g){return i.h=a(g),i.s=l(g),i.l=h(Math.pow(g,t)),i.opacity=p(g),i+""}}return r.gamma=e,r}(1)}wB(Ute);var xB=wB(bm);const Fo=n=>vB(n[n.length-1]);var EB=new Array(3).concat("e5f5f999d8c92ca25f","edf8fbb2e2e266c2a4238b45","edf8fbb2e2e266c2a42ca25f006d2c","edf8fbccece699d8c966c2a42ca25f006d2c","edf8fbccece699d8c966c2a441ae76238b45005824","f7fcfde5f5f9ccece699d8c966c2a441ae76238b45005824","f7fcfde5f5f9ccece699d8c966c2a441ae76238b45006d2c00441b").map(Ki);Fo(EB);var TB=new Array(3).concat("e0ecf49ebcda8856a7","edf8fbb3cde38c96c688419d","edf8fbb3cde38c96c68856a7810f7c","edf8fbbfd3e69ebcda8c96c68856a7810f7c","edf8fbbfd3e69ebcda8c96c68c6bb188419d6e016b","f7fcfde0ecf4bfd3e69ebcda8c96c68c6bb188419d6e016b","f7fcfde0ecf4bfd3e69ebcda8c96c68c6bb188419d810f7c4d004b").map(Ki);Fo(TB);var SB=new Array(3).concat("e0f3dba8ddb543a2ca","f0f9e8bae4bc7bccc42b8cbe","f0f9e8bae4bc7bccc443a2ca0868ac","f0f9e8ccebc5a8ddb57bccc443a2ca0868ac","f0f9e8ccebc5a8ddb57bccc44eb3d32b8cbe08589e","f7fcf0e0f3dbccebc5a8ddb57bccc44eb3d32b8cbe08589e","f7fcf0e0f3dbccebc5a8ddb57bccc44eb3d32b8cbe0868ac084081").map(Ki);Fo(SB);var CB=new Array(3).concat("fee8c8fdbb84e34a33","fef0d9fdcc8afc8d59d7301f","fef0d9fdcc8afc8d59e34a33b30000","fef0d9fdd49efdbb84fc8d59e34a33b30000","fef0d9fdd49efdbb84fc8d59ef6548d7301f990000","fff7ecfee8c8fdd49efdbb84fc8d59ef6548d7301f990000","fff7ecfee8c8fdd49efdbb84fc8d59ef6548d7301fb300007f0000").map(Ki);Fo(CB);var AB=new Array(3).concat("ece2f0a6bddb1c9099","f6eff7bdc9e167a9cf02818a","f6eff7bdc9e167a9cf1c9099016c59","f6eff7d0d1e6a6bddb67a9cf1c9099016c59","f6eff7d0d1e6a6bddb67a9cf3690c002818a016450","fff7fbece2f0d0d1e6a6bddb67a9cf3690c002818a016450","fff7fbece2f0d0d1e6a6bddb67a9cf3690c002818a016c59014636").map(Ki);Fo(AB);var IB=new Array(3).concat("ece7f2a6bddb2b8cbe","f1eef6bdc9e174a9cf0570b0","f1eef6bdc9e174a9cf2b8cbe045a8d","f1eef6d0d1e6a6bddb74a9cf2b8cbe045a8d","f1eef6d0d1e6a6bddb74a9cf3690c00570b0034e7b","fff7fbece7f2d0d1e6a6bddb74a9cf3690c00570b0034e7b","fff7fbece7f2d0d1e6a6bddb74a9cf3690c00570b0045a8d023858").map(Ki);Fo(IB);var PB=new Array(3).concat("e7e1efc994c7dd1c77","f1eef6d7b5d8df65b0ce1256","f1eef6d7b5d8df65b0dd1c77980043","f1eef6d4b9dac994c7df65b0dd1c77980043","f1eef6d4b9dac994c7df65b0e7298ace125691003f","f7f4f9e7e1efd4b9dac994c7df65b0e7298ace125691003f","f7f4f9e7e1efd4b9dac994c7df65b0e7298ace125698004367001f").map(Ki);Fo(PB);var MB=new Array(3).concat("fde0ddfa9fb5c51b8a","feebe2fbb4b9f768a1ae017e","feebe2fbb4b9f768a1c51b8a7a0177","feebe2fcc5c0fa9fb5f768a1c51b8a7a0177","feebe2fcc5c0fa9fb5f768a1dd3497ae017e7a0177","fff7f3fde0ddfcc5c0fa9fb5f768a1dd3497ae017e7a0177","fff7f3fde0ddfcc5c0fa9fb5f768a1dd3497ae017e7a017749006a").map(Ki);Fo(MB);var RB=new Array(3).concat("edf8b17fcdbb2c7fb8","ffffcca1dab441b6c4225ea8","ffffcca1dab441b6c42c7fb8253494","ffffccc7e9b47fcdbb41b6c42c7fb8253494","ffffccc7e9b47fcdbb41b6c41d91c0225ea80c2c84","ffffd9edf8b1c7e9b47fcdbb41b6c41d91c0225ea80c2c84","ffffd9edf8b1c7e9b47fcdbb41b6c41d91c0225ea8253494081d58").map(Ki);Fo(RB);var kB=new Array(3).concat("f7fcb9addd8e31a354","ffffccc2e69978c679238443","ffffccc2e69978c67931a354006837","ffffccd9f0a3addd8e78c67931a354006837","ffffccd9f0a3addd8e78c67941ab5d238443005a32","ffffe5f7fcb9d9f0a3addd8e78c67941ab5d238443005a32","ffffe5f7fcb9d9f0a3addd8e78c67941ab5d238443006837004529").map(Ki);Fo(kB);var OB=new Array(3).concat("fff7bcfec44fd95f0e","ffffd4fed98efe9929cc4c02","ffffd4fed98efe9929d95f0e993404","ffffd4fee391fec44ffe9929d95f0e993404","ffffd4fee391fec44ffe9929ec7014cc4c028c2d04","ffffe5fff7bcfee391fec44ffe9929ec7014cc4c028c2d04","ffffe5fff7bcfee391fec44ffe9929ec7014cc4c02993404662506").map(Ki);Fo(OB);var LB=new Array(3).concat("ffeda0feb24cf03b20","ffffb2fecc5cfd8d3ce31a1c","ffffb2fecc5cfd8d3cf03b20bd0026","ffffb2fed976feb24cfd8d3cf03b20bd0026","ffffb2fed976feb24cfd8d3cfc4e2ae31a1cb10026","ffffccffeda0fed976feb24cfd8d3cfc4e2ae31a1cb10026","ffffccffeda0fed976feb24cfd8d3cfc4e2ae31a1cbd0026800026").map(Ki);Fo(LB);var NB=new Array(3).concat("deebf79ecae13182bd","eff3ffbdd7e76baed62171b5","eff3ffbdd7e76baed63182bd08519c","eff3ffc6dbef9ecae16baed63182bd08519c","eff3ffc6dbef9ecae16baed64292c62171b5084594","f7fbffdeebf7c6dbef9ecae16baed64292c62171b5084594","f7fbffdeebf7c6dbef9ecae16baed64292c62171b508519c08306b").map(Ki);Fo(NB);var DB=new Array(3).concat("e5f5e0a1d99b31a354","edf8e9bae4b374c476238b45","edf8e9bae4b374c47631a354006d2c","edf8e9c7e9c0a1d99b74c47631a354006d2c","edf8e9c7e9c0a1d99b74c47641ab5d238b45005a32","f7fcf5e5f5e0c7e9c0a1d99b74c47641ab5d238b45005a32","f7fcf5e5f5e0c7e9c0a1d99b74c47641ab5d238b45006d2c00441b").map(Ki);Fo(DB);var FB=new Array(3).concat("f0f0f0bdbdbd636363","f7f7f7cccccc969696525252","f7f7f7cccccc969696636363252525","f7f7f7d9d9d9bdbdbd969696636363252525","f7f7f7d9d9d9bdbdbd969696737373525252252525","fffffff0f0f0d9d9d9bdbdbd969696737373525252252525","fffffff0f0f0d9d9d9bdbdbd969696737373525252252525000000").map(Ki);Fo(FB);var BB=new Array(3).concat("efedf5bcbddc756bb1","f2f0f7cbc9e29e9ac86a51a3","f2f0f7cbc9e29e9ac8756bb154278f","f2f0f7dadaebbcbddc9e9ac8756bb154278f","f2f0f7dadaebbcbddc9e9ac8807dba6a51a34a1486","fcfbfdefedf5dadaebbcbddc9e9ac8807dba6a51a34a1486","fcfbfdefedf5dadaebbcbddc9e9ac8807dba6a51a354278f3f007d").map(Ki);Fo(BB);var UB=new Array(3).concat("fee0d2fc9272de2d26","fee5d9fcae91fb6a4acb181d","fee5d9fcae91fb6a4ade2d26a50f15","fee5d9fcbba1fc9272fb6a4ade2d26a50f15","fee5d9fcbba1fc9272fb6a4aef3b2ccb181d99000d","fff5f0fee0d2fcbba1fc9272fb6a4aef3b2ccb181d99000d","fff5f0fee0d2fcbba1fc9272fb6a4aef3b2ccb181da50f1567000d").map(Ki);Fo(UB);var zB=new Array(3).concat("fee6cefdae6be6550d","feeddefdbe85fd8d3cd94701","feeddefdbe85fd8d3ce6550da63603","feeddefdd0a2fdae6bfd8d3ce6550da63603","feeddefdd0a2fdae6bfd8d3cf16913d948018c2d04","fff5ebfee6cefdd0a2fdae6bfd8d3cf16913d948018c2d04","fff5ebfee6cefdd0a2fdae6bfd8d3cf16913d94801a636037f2704").map(Ki);Fo(zB);var Zte=xB(id(-100,.75,.35),id(80,1.5,.8)),Xte=xB(id(260,.75,.35),id(80,1.5,.8));id();function oT(n){var e=n.length;return function(t){return n[Math.max(0,Math.min(e-1,Math.floor(t*e)))]}}const Qte=oT(Ki("44015444025645045745055946075a46085c460a5d460b5e470d60470e6147106347116447136548146748166848176948186a481a6c481b6d481c6e481d6f481f70482071482173482374482475482576482677482878482979472a7a472c7a472d7b472e7c472f7d46307e46327e46337f463480453581453781453882443983443a83443b84433d84433e85423f854240864241864142874144874045884046883f47883f48893e49893e4a893e4c8a3d4d8a3d4e8a3c4f8a3c508b3b518b3b528b3a538b3a548c39558c39568c38588c38598c375a8c375b8d365c8d365d8d355e8d355f8d34608d34618d33628d33638d32648e32658e31668e31678e31688e30698e306a8e2f6b8e2f6c8e2e6d8e2e6e8e2e6f8e2d708e2d718e2c718e2c728e2c738e2b748e2b758e2a768e2a778e2a788e29798e297a8e297b8e287c8e287d8e277e8e277f8e27808e26818e26828e26828e25838e25848e25858e24868e24878e23888e23898e238a8d228b8d228c8d228d8d218e8d218f8d21908d21918c20928c20928c20938c1f948c1f958b1f968b1f978b1f988b1f998a1f9a8a1e9b8a1e9c891e9d891f9e891f9f881fa0881fa1881fa1871fa28720a38620a48621a58521a68522a78522a88423a98324aa8325ab8225ac8226ad8127ad8128ae8029af7f2ab07f2cb17e2db27d2eb37c2fb47c31b57b32b67a34b67935b77937b87838b9773aba763bbb753dbc743fbc7340bd7242be7144bf7046c06f48c16e4ac16d4cc26c4ec36b50c46a52c56954c56856c66758c7655ac8645cc8635ec96260ca6063cb5f65cb5e67cc5c69cd5b6ccd5a6ece5870cf5773d05675d05477d1537ad1517cd2507fd34e81d34d84d44b86d54989d5488bd6468ed64590d74393d74195d84098d83e9bd93c9dd93ba0da39a2da37a5db36a8db34aadc32addc30b0dd2fb2dd2db5de2bb8de29bade28bddf26c0df25c2df23c5e021c8e020cae11fcde11dd0e11cd2e21bd5e21ad8e219dae319dde318dfe318e2e418e5e419e7e419eae51aece51befe51cf1e51df4e61ef6e620f8e621fbe723fde725"));var Jte=oT(Ki("00000401000501010601010802010902020b02020d03030f03031204041405041606051806051a07061c08071e0907200a08220b09240c09260d0a290e0b2b100b2d110c2f120d31130d34140e36150e38160f3b180f3d19103f1a10421c10441d11471e114920114b21114e22115024125325125527125829115a2a115c2c115f2d11612f116331116533106734106936106b38106c390f6e3b0f703d0f713f0f72400f74420f75440f764510774710784910784a10794c117a4e117b4f127b51127c52137c54137d56147d57157e59157e5a167e5c167f5d177f5f187f601880621980641a80651a80671b80681c816a1c816b1d816d1d816e1e81701f81721f817320817521817621817822817922827b23827c23827e24828025828125818326818426818627818827818928818b29818c29818e2a81902a81912b81932b80942c80962c80982d80992d809b2e7f9c2e7f9e2f7fa02f7fa1307ea3307ea5317ea6317da8327daa337dab337cad347cae347bb0357bb2357bb3367ab5367ab73779b83779ba3878bc3978bd3977bf3a77c03a76c23b75c43c75c53c74c73d73c83e73ca3e72cc3f71cd4071cf4070d0416fd2426fd3436ed5446dd6456cd8456cd9466bdb476adc4869de4968df4a68e04c67e24d66e34e65e44f64e55064e75263e85362e95462ea5661eb5760ec5860ed5a5fee5b5eef5d5ef05f5ef1605df2625df2645cf3655cf4675cf4695cf56b5cf66c5cf66e5cf7705cf7725cf8745cf8765cf9785df9795df97b5dfa7d5efa7f5efa815ffb835ffb8560fb8761fc8961fc8a62fc8c63fc8e64fc9065fd9266fd9467fd9668fd9869fd9a6afd9b6bfe9d6cfe9f6dfea16efea36ffea571fea772fea973feaa74feac76feae77feb078feb27afeb47bfeb67cfeb77efeb97ffebb81febd82febf84fec185fec287fec488fec68afec88cfeca8dfecc8ffecd90fecf92fed194fed395fed597fed799fed89afdda9cfddc9efddea0fde0a1fde2a3fde3a5fde5a7fde7a9fde9aafdebacfcecaefceeb0fcf0b2fcf2b4fcf4b6fcf6b8fcf7b9fcf9bbfcfbbdfcfdbf")),ene=oT(Ki("00000401000501010601010802010a02020c02020e03021004031204031405041706041907051b08051d09061f0a07220b07240c08260d08290e092b10092d110a30120a32140b34150b37160b39180c3c190c3e1b0c411c0c431e0c451f0c48210c4a230c4c240c4f260c51280b53290b552b0b572d0b592f0a5b310a5c320a5e340a5f3609613809623909633b09643d09653e0966400a67420a68440a68450a69470b6a490b6a4a0c6b4c0c6b4d0d6c4f0d6c510e6c520e6d540f6d550f6d57106e59106e5a116e5c126e5d126e5f136e61136e62146e64156e65156e67166e69166e6a176e6c186e6d186e6f196e71196e721a6e741a6e751b6e771c6d781c6d7a1d6d7c1d6d7d1e6d7f1e6c801f6c82206c84206b85216b87216b88226a8a226a8c23698d23698f24699025689225689326679526679727669827669a28659b29649d29649f2a63a02a63a22b62a32c61a52c60a62d60a82e5fa92e5eab2f5ead305dae305cb0315bb1325ab3325ab43359b63458b73557b93556ba3655bc3754bd3853bf3952c03a51c13a50c33b4fc43c4ec63d4dc73e4cc83f4bca404acb4149cc4248ce4347cf4446d04545d24644d34743d44842d54a41d74b3fd84c3ed94d3dda4e3cdb503bdd513ade5238df5337e05536e15635e25734e35933e45a31e55c30e65d2fe75e2ee8602de9612bea632aeb6429eb6628ec6726ed6925ee6a24ef6c23ef6e21f06f20f1711ff1731df2741cf3761bf37819f47918f57b17f57d15f67e14f68013f78212f78410f8850ff8870ef8890cf98b0bf98c0af98e09fa9008fa9207fa9407fb9606fb9706fb9906fb9b06fb9d07fc9f07fca108fca309fca50afca60cfca80dfcaa0ffcac11fcae12fcb014fcb216fcb418fbb61afbb81dfbba1ffbbc21fbbe23fac026fac228fac42afac62df9c72ff9c932f9cb35f8cd37f8cf3af7d13df7d340f6d543f6d746f5d949f5db4cf4dd4ff4df53f4e156f3e35af3e55df2e661f2e865f2ea69f1ec6df1ed71f1ef75f1f179f2f27df2f482f3f586f3f68af4f88ef5f992f6fa96f8fb9af9fc9dfafda1fcffa4")),tne=oT(Ki("0d088710078813078916078a19068c1b068d1d068e20068f2206902406912605912805922a05932c05942e05952f059631059733059735049837049938049a3a049a3c049b3e049c3f049c41049d43039e44039e46039f48039f4903a04b03a14c02a14e02a25002a25102a35302a35502a45601a45801a45901a55b01a55c01a65e01a66001a66100a76300a76400a76600a76700a86900a86a00a86c00a86e00a86f00a87100a87201a87401a87501a87701a87801a87a02a87b02a87d03a87e03a88004a88104a78305a78405a78606a68707a68808a68a09a58b0aa58d0ba58e0ca48f0da4910ea3920fa39410a29511a19613a19814a099159f9a169f9c179e9d189d9e199da01a9ca11b9ba21d9aa31e9aa51f99a62098a72197a82296aa2395ab2494ac2694ad2793ae2892b02991b12a90b22b8fb32c8eb42e8db52f8cb6308bb7318ab83289ba3388bb3488bc3587bd3786be3885bf3984c03a83c13b82c23c81c33d80c43e7fc5407ec6417dc7427cc8437bc9447aca457acb4679cc4778cc4977cd4a76ce4b75cf4c74d04d73d14e72d24f71d35171d45270d5536fd5546ed6556dd7566cd8576bd9586ada5a6ada5b69db5c68dc5d67dd5e66de5f65de6164df6263e06363e16462e26561e26660e3685fe4695ee56a5de56b5de66c5ce76e5be76f5ae87059e97158e97257ea7457eb7556eb7655ec7754ed7953ed7a52ee7b51ef7c51ef7e50f07f4ff0804ef1814df1834cf2844bf3854bf3874af48849f48948f58b47f58c46f68d45f68f44f79044f79143f79342f89441f89540f9973ff9983ef99a3efa9b3dfa9c3cfa9e3bfb9f3afba139fba238fca338fca537fca636fca835fca934fdab33fdac33fdae32fdaf31fdb130fdb22ffdb42ffdb52efeb72dfeb82cfeba2cfebb2bfebd2afebe2afec029fdc229fdc328fdc527fdc627fdc827fdca26fdcb26fccd25fcce25fcd025fcd225fbd324fbd524fbd724fad824fada24f9dc24f9dd25f8df25f8e125f7e225f7e425f6e626f6e826f5e926f5eb27f4ed27f3ee27f3f027f2f227f1f426f1f525f0f724f0f921"));function wm(n,e){return n==null||e==null?NaN:n<e?-1:n>e?1:n>=e?0:NaN}function Sx(n,e){return n==null||e==null?NaN:e<n?-1:e>n?1:e>=n?0:NaN}function jB(n){let e,t,r;n.length!==2?(e=wm,t=(l,h)=>wm(n(l),h),r=(l,h)=>n(l)-h):(e=n===wm||n===Sx?n:nne,t=n,r=n);function i(l,h,p=0,g=l.length){if(p<g){if(e(h,h)!==0)return g;do{const _=p+g>>>1;t(l[_],h)<0?p=_+1:g=_}while(p<g)}return p}function o(l,h,p=0,g=l.length){if(p<g){if(e(h,h)!==0)return g;do{const _=p+g>>>1;t(l[_],h)<=0?p=_+1:g=_}while(p<g)}return p}function a(l,h,p=0,g=l.length){const _=i(l,h,p,g-1);return _>p&&r(l[_-1],h)>-r(l[_],h)?_-1:_}return{left:i,center:a,right:o}}function nne(){return 0}function rne(n){return n===null?NaN:+n}const VB=jB(wm),ine=VB.right,one=VB.left;jB(rne).center;function G2(n,e){let t,r;if(e===void 0)for(const i of n)i!=null&&(t===void 0?i>=i&&(t=r=i):(t>i&&(t=i),r<i&&(r=i)));else{let i=-1;for(let o of n)(o=e(o,++i,n))!=null&&(t===void 0?o>=o&&(t=r=o):(t>o&&(t=o),r<o&&(r=o)))}return[t,r]}class aT{constructor(){this._partials=new Float64Array(32),this._n=0}add(e){const t=this._partials;let r=0;for(let i=0;i<this._n&&i<32;i++){const o=t[i],a=e+o,l=Math.abs(e)<Math.abs(o)?e-(a-o):o-(a-e);l&&(t[r++]=l),e=a}return t[r]=e,this._n=r+1,this}valueOf(){const e=this._partials;let t=this._n,r,i,o,a=0;if(t>0){for(a=e[--t];t>0&&(r=a,i=e[--t],a=r+i,o=i-(a-r),!o););t>0&&(o<0&&e[t-1]<0||o>0&&e[t-1]>0)&&(i=o*2,r=a+i,i==r-a&&(a=r))}return a}}class ane extends Map{constructor(e,t=lne){if(super(),Object.defineProperties(this,{_intern:{value:new Map},_key:{value:t}}),e!=null)for(const[r,i]of e)this.set(r,i)}get(e){return super.get(GN(this,e))}has(e){return super.has(GN(this,e))}set(e,t){return super.set(sne(this,e),t)}delete(e){return super.delete(cne(this,e))}}function GN({_intern:n,_key:e},t){const r=e(t);return n.has(r)?n.get(r):t}function sne({_intern:n,_key:e},t){const r=e(t);return n.has(r)?n.get(r):(n.set(r,t),t)}function cne({_intern:n,_key:e},t){const r=e(t);return n.has(r)&&(t=n.get(r),n.delete(r)),t}function lne(n){return n!==null&&typeof n=="object"?n.valueOf():n}function une(n){return n}function HB(n,e,...t){return hne(n,une,e,t)}function hne(n,e,t,r){return function i(o,a){if(a>=r.length)return t(o);const l=new ane,h=r[a++];let p=-1;for(const g of o){const _=h(g,++p,o),x=l.get(_);x?x.push(g):l.set(_,[g])}for(const[g,_]of l)l.set(g,i(_,a));return e(l)}(n,0)}const dne=Math.sqrt(50),fne=Math.sqrt(10),pne=Math.sqrt(2);function Cx(n,e,t){const r=(e-n)/Math.max(0,t),i=Math.floor(Math.log10(r)),o=r/Math.pow(10,i),a=o>=dne?10:o>=fne?5:o>=pne?2:1;let l,h,p;return i<0?(p=Math.pow(10,-i)/a,l=Math.round(n*p),h=Math.round(e*p),l/p<n&&++l,h/p>e&&--h,p=-p):(p=Math.pow(10,i)*a,l=Math.round(n/p),h=Math.round(e/p),l*p<n&&++l,h*p>e&&--h),h<l&&.5<=t&&t<2?Cx(n,e,t*2):[l,h,p]}function gne(n,e,t){if(e=+e,n=+n,t=+t,!(t>0))return[];if(n===e)return[n];const r=e<n,[i,o,a]=r?Cx(e,n,t):Cx(n,e,t);if(!(o>=i))return[];const l=o-i+1,h=new Array(l);if(r)if(a<0)for(let p=0;p<l;++p)h[p]=(o-p)/-a;else for(let p=0;p<l;++p)h[p]=(o-p)*a;else if(a<0)for(let p=0;p<l;++p)h[p]=(i+p)/-a;else for(let p=0;p<l;++p)h[p]=(i+p)*a;return h}function q2(n,e,t){return e=+e,n=+n,t=+t,Cx(n,e,t)[2]}function mne(n,e,t){e=+e,n=+n,t=+t;const r=e<n,i=r?q2(e,n,t):q2(n,e,t);return(r?-1:1)*(i<0?1/-i:i)}function GB(n,e){let t;if(e===void 0)for(const r of n)r!=null&&(t>r||t===void 0&&r>=r)&&(t=r);else{let r=-1;for(let i of n)(i=e(i,++r,n))!=null&&(t>i||t===void 0&&i>=i)&&(t=i)}return t}function qB(n,e,t){n=+n,e=+e,t=(i=arguments.length)<2?(e=n,n=0,1):i<3?1:+t;for(var r=-1,i=Math.max(0,Math.ceil((e-n)/t))|0,o=new Array(i);++r<i;)o[r]=n+r*t;return o}function $B(n,e){switch(arguments.length){case 0:break;case 1:this.range(n);break;default:this.range(e).domain(n);break}return this}function WB(n,e){switch(arguments.length){case 0:break;case 1:{typeof n=="function"?this.interpolator(n):this.range(n);break}default:{this.domain(n),typeof e=="function"?this.interpolator(e):this.range(e);break}}return this}function yne(n){return function(){return n}}function _ne(n){return+n}var qN=[0,1];function nc(n){return n}function $2(n,e){return(e-=n=+n)?function(t){return(t-n)/e}:yne(isNaN(e)?NaN:.5)}function vne(n,e){var t;return n>e&&(t=n,n=e,e=t),function(r){return Math.max(n,Math.min(e,r))}}function bne(n,e,t){var r=n[0],i=n[1],o=e[0],a=e[1];return i<r?(r=$2(i,r),o=t(a,o)):(r=$2(r,i),o=t(o,a)),function(l){return o(r(l))}}function wne(n,e,t){var r=Math.min(n.length,e.length)-1,i=new Array(r),o=new Array(r),a=-1;for(n[r]<n[0]&&(n=n.slice().reverse(),e=e.slice().reverse());++a<r;)i[a]=$2(n[a],n[a+1]),o[a]=t(e[a],e[a+1]);return function(l){var h=ine(n,l,1,r)-1;return o[h](i[h](l))}}function YB(n,e){return e.domain(n.domain()).range(n.range()).interpolate(n.interpolate()).clamp(n.clamp()).unknown(n.unknown())}function KB(){var n=qN,e=qN,t=iT,r,i,o,a=nc,l,h,p;function g(){var x=Math.min(n.length,e.length);return a!==nc&&(a=vne(n[0],n[x-1])),l=x>2?wne:bne,h=p=null,_}function _(x){return x==null||isNaN(x=+x)?o:(h||(h=l(n.map(r),e,t)))(r(a(x)))}return _.invert=function(x){return a(i((p||(p=l(e,n.map(r),Tx)))(x)))},_.domain=function(x){return arguments.length?(n=Array.from(x,_ne),g()):n.slice()},_.range=function(x){return arguments.length?(e=Array.from(x),g()):e.slice()},_.rangeRound=function(x){return e=Array.from(x),t=bB,g()},_.clamp=function(x){return arguments.length?(a=x?!0:nc,g()):a!==nc},_.interpolate=function(x){return arguments.length?(t=x,g()):t},_.unknown=function(x){return arguments.length?(o=x,_):o},function(x,C){return r=x,i=C,g()}}function xne(){return KB()(nc,nc)}function Ene(n){return Math.abs(n=Math.round(n))>=1e21?n.toLocaleString("en").replace(/,/g,""):n.toString(10)}function Ax(n,e){if((t=(n=e?n.toExponential(e-1):n.toExponential()).indexOf("e"))<0)return null;var t,r=n.slice(0,t);return[r.length>1?r[0]+r.slice(2):r,+n.slice(t+1)]}function Km(n){return n=Ax(Math.abs(n)),n?n[1]:NaN}function Tne(n,e){return function(t,r){for(var i=t.length,o=[],a=0,l=n[0],h=0;i>0&&l>0&&(h+l+1>r&&(l=Math.max(1,r-h)),o.push(t.substring(i-=l,i+l)),!((h+=l+1)>r));)l=n[a=(a+1)%n.length];return o.reverse().join(e)}}function Sne(n){return function(e){return e.replace(/[0-9]/g,function(t){return n[+t]})}}var Cne=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function Ix(n){if(!(e=Cne.exec(n)))throw new Error("invalid format: "+n);var e;return new kM({fill:e[1],align:e[2],sign:e[3],symbol:e[4],zero:e[5],width:e[6],comma:e[7],precision:e[8]&&e[8].slice(1),trim:e[9],type:e[10]})}Ix.prototype=kM.prototype;function kM(n){this.fill=n.fill===void 0?" ":n.fill+"",this.align=n.align===void 0?">":n.align+"",this.sign=n.sign===void 0?"-":n.sign+"",this.symbol=n.symbol===void 0?"":n.symbol+"",this.zero=!!n.zero,this.width=n.width===void 0?void 0:+n.width,this.comma=!!n.comma,this.precision=n.precision===void 0?void 0:+n.precision,this.trim=!!n.trim,this.type=n.type===void 0?"":n.type+""}kM.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function Ane(n){e:for(var e=n.length,t=1,r=-1,i;t<e;++t)switch(n[t]){case".":r=i=t;break;case"0":r===0&&(r=t),i=t;break;default:if(!+n[t])break e;r>0&&(r=0);break}return r>0?n.slice(0,r)+n.slice(i+1):n}var ZB;function Ine(n,e){var t=Ax(n,e);if(!t)return n+"";var r=t[0],i=t[1],o=i-(ZB=Math.max(-8,Math.min(8,Math.floor(i/3)))*3)+1,a=r.length;return o===a?r:o>a?r+new Array(o-a+1).join("0"):o>0?r.slice(0,o)+"."+r.slice(o):"0."+new Array(1-o).join("0")+Ax(n,Math.max(0,e+o-1))[0]}function $N(n,e){var t=Ax(n,e);if(!t)return n+"";var r=t[0],i=t[1];return i<0?"0."+new Array(-i).join("0")+r:r.length>i+1?r.slice(0,i+1)+"."+r.slice(i+1):r+new Array(i-r.length+2).join("0")}const WN={"%":(n,e)=>(n*100).toFixed(e),b:n=>Math.round(n).toString(2),c:n=>n+"",d:Ene,e:(n,e)=>n.toExponential(e),f:(n,e)=>n.toFixed(e),g:(n,e)=>n.toPrecision(e),o:n=>Math.round(n).toString(8),p:(n,e)=>$N(n*100,e),r:$N,s:Ine,X:n=>Math.round(n).toString(16).toUpperCase(),x:n=>Math.round(n).toString(16)};function YN(n){return n}var KN=Array.prototype.map,ZN=["y","z","a","f","p","n","","m","","k","M","G","T","P","E","Z","Y"];function Pne(n){var e=n.grouping===void 0||n.thousands===void 0?YN:Tne(KN.call(n.grouping,Number),n.thousands+""),t=n.currency===void 0?"":n.currency[0]+"",r=n.currency===void 0?"":n.currency[1]+"",i=n.decimal===void 0?".":n.decimal+"",o=n.numerals===void 0?YN:Sne(KN.call(n.numerals,String)),a=n.percent===void 0?"%":n.percent+"",l=n.minus===void 0?"":n.minus+"",h=n.nan===void 0?"NaN":n.nan+"";function p(_){_=Ix(_);var x=_.fill,C=_.align,M=_.sign,L=_.symbol,D=_.zero,z=_.width,te=_.comma,le=_.precision,ce=_.trim,_e=_.type;_e==="n"?(te=!0,_e="g"):WN[_e]||(le===void 0&&(le=12),ce=!0,_e="g"),(D||x==="0"&&C==="=")&&(D=!0,x="0",C="=");var J=L==="$"?t:L==="#"&&/[boxX]/.test(_e)?"0"+_e.toLowerCase():"",pe=L==="$"?r:/[%p]/.test(_e)?a:"",ue=WN[_e],xe=/[defgprs%]/.test(_e);le=le===void 0?6:/[gprs]/.test(_e)?Math.max(1,Math.min(21,le)):Math.max(0,Math.min(20,le));function je(ne){var Ee=J,ke=pe,Be,Ze,at;if(_e==="c")ke=ue(ne)+ke,ne="";else{ne=+ne;var Re=ne<0||1/ne<0;if(ne=isNaN(ne)?h:ue(Math.abs(ne),le),ce&&(ne=Ane(ne)),Re&&+ne==0&&M!=="+"&&(Re=!1),Ee=(Re?M==="("?M:l:M==="-"||M==="("?"":M)+Ee,ke=(_e==="s"?ZN[8+ZB/3]:"")+ke+(Re&&M==="("?")":""),xe){for(Be=-1,Ze=ne.length;++Be<Ze;)if(at=ne.charCodeAt(Be),48>at||at>57){ke=(at===46?i+ne.slice(Be+1):ne.slice(Be))+ke,ne=ne.slice(0,Be);break}}}te&&!D&&(ne=e(ne,1/0));var ht=Ee.length+ne.length+ke.length,Rt=ht<z?new Array(z-ht+1).join(x):"";switch(te&&D&&(ne=e(Rt+ne,Rt.length?z-ke.length:1/0),Rt=""),C){case"<":ne=Ee+ne+ke+Rt;break;case"=":ne=Ee+Rt+ne+ke;break;case"^":ne=Rt.slice(0,ht=Rt.length>>1)+Ee+ne+ke+Rt.slice(ht);break;default:ne=Rt+Ee+ne+ke;break}return o(ne)}return je.toString=function(){return _+""},je}function g(_,x){var C=p((_=Ix(_),_.type="f",_)),M=Math.max(-8,Math.min(8,Math.floor(Km(x)/3)))*3,L=Math.pow(10,-M),D=ZN[8+M/3];return function(z){return C(L*z)+D}}return{format:p,formatPrefix:g}}var j1,XB,QB;Mne({thousands:",",grouping:[3],currency:["$",""]});function Mne(n){return j1=Pne(n),XB=j1.format,QB=j1.formatPrefix,j1}function Rne(n){return Math.max(0,-Km(Math.abs(n)))}function kne(n,e){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(Km(e)/3)))*3-Km(Math.abs(n)))}function One(n,e){return n=Math.abs(n),e=Math.abs(e)-n,Math.max(0,Km(e)-Km(n))+1}function Lne(n,e,t,r){var i=mne(n,e,t),o;switch(r=Ix(r??",f"),r.type){case"s":{var a=Math.max(Math.abs(n),Math.abs(e));return r.precision==null&&!isNaN(o=kne(i,a))&&(r.precision=o),QB(r,a)}case"":case"e":case"g":case"p":case"r":{r.precision==null&&!isNaN(o=One(i,Math.max(Math.abs(n),Math.abs(e))))&&(r.precision=o-(r.type==="e"));break}case"f":case"%":{r.precision==null&&!isNaN(o=Rne(i))&&(r.precision=o-(r.type==="%")*2);break}}return XB(r)}function OM(n){var e=n.domain;return n.ticks=function(t){var r=e();return gne(r[0],r[r.length-1],t??10)},n.tickFormat=function(t,r){var i=e();return Lne(i[0],i[i.length-1],t??10,r)},n.nice=function(t){t==null&&(t=10);var r=e(),i=0,o=r.length-1,a=r[i],l=r[o],h,p,g=10;for(l<a&&(p=a,a=l,l=p,p=i,i=o,o=p);g-- >0;){if(p=q2(a,l,t),p===h)return r[i]=a,r[o]=l,e(r);if(p>0)a=Math.floor(a/p)*p,l=Math.ceil(l/p)*p;else if(p<0)a=Math.ceil(a*p)/p,l=Math.floor(l*p)/p;else break;h=p}return n},n}function JB(){var n=xne();return n.copy=function(){return YB(n,JB())},$B.apply(n,arguments),OM(n)}function XN(n){return function(e){return e<0?-Math.pow(-e,n):Math.pow(e,n)}}function Nne(n){return n<0?-Math.sqrt(-n):Math.sqrt(n)}function Dne(n){return n<0?-n*n:n*n}function eU(n){var e=n(nc,nc),t=1;function r(){return t===1?n(nc,nc):t===.5?n(Nne,Dne):n(XN(t),XN(1/t))}return e.exponent=function(i){return arguments.length?(t=+i,r()):t},OM(e)}function LM(){var n=eU(KB());return n.copy=function(){return YB(n,LM()).exponent(n.exponent())},$B.apply(n,arguments),n}function Fne(){return LM.apply(null,arguments).exponent(.5)}const _C=new Date,vC=new Date;function ra(n,e,t,r){function i(o){return n(o=arguments.length===0?new Date:new Date(+o)),o}return i.floor=o=>(n(o=new Date(+o)),o),i.ceil=o=>(n(o=new Date(o-1)),e(o,1),n(o),o),i.round=o=>{const a=i(o),l=i.ceil(o);return o-a<l-o?a:l},i.offset=(o,a)=>(e(o=new Date(+o),a==null?1:Math.floor(a)),o),i.range=(o,a,l)=>{const h=[];if(o=i.ceil(o),l=l==null?1:Math.floor(l),!(o<a)||!(l>0))return h;let p;do h.push(p=new Date(+o)),e(o,l),n(o);while(p<o&&o<a);return h},i.filter=o=>ra(a=>{if(a>=a)for(;n(a),!o(a);)a.setTime(a-1)},(a,l)=>{if(a>=a)if(l<0)for(;++l<=0;)for(;e(a,-1),!o(a););else for(;--l>=0;)for(;e(a,1),!o(a););}),t&&(i.count=(o,a)=>(_C.setTime(+o),vC.setTime(+a),n(_C),n(vC),Math.floor(t(_C,vC))),i.every=o=>(o=Math.floor(o),!isFinite(o)||!(o>0)?null:o>1?i.filter(r?a=>r(a)%o===0:a=>i.count(0,a)%o===0):i)),i}const S0=1e3,od=S0*60,C0=od*60,A0=C0*24,tU=A0*7,nU=ra(n=>{n.setTime(n-n.getMilliseconds())},(n,e)=>{n.setTime(+n+e*S0)},(n,e)=>(e-n)/S0,n=>n.getUTCSeconds());nU.range;const rU=ra(n=>{n.setTime(n-n.getMilliseconds()-n.getSeconds()*S0)},(n,e)=>{n.setTime(+n+e*od)},(n,e)=>(e-n)/od,n=>n.getMinutes());rU.range;const Bne=ra(n=>{n.setUTCSeconds(0,0)},(n,e)=>{n.setTime(+n+e*od)},(n,e)=>(e-n)/od,n=>n.getUTCMinutes());Bne.range;const iU=ra(n=>{n.setTime(n-n.getMilliseconds()-n.getSeconds()*S0-n.getMinutes()*od)},(n,e)=>{n.setTime(+n+e*C0)},(n,e)=>(e-n)/C0,n=>n.getHours());iU.range;const Une=ra(n=>{n.setUTCMinutes(0,0,0)},(n,e)=>{n.setTime(+n+e*C0)},(n,e)=>(e-n)/C0,n=>n.getUTCHours());Une.range;const sT=ra(n=>n.setHours(0,0,0,0),(n,e)=>n.setDate(n.getDate()+e),(n,e)=>(e-n-(e.getTimezoneOffset()-n.getTimezoneOffset())*od)/A0,n=>n.getDate()-1);sT.range;const NM=ra(n=>{n.setUTCHours(0,0,0,0)},(n,e)=>{n.setUTCDate(n.getUTCDate()+e)},(n,e)=>(e-n)/A0,n=>n.getUTCDate()-1);NM.range;const zne=ra(n=>{n.setUTCHours(0,0,0,0)},(n,e)=>{n.setUTCDate(n.getUTCDate()+e)},(n,e)=>(e-n)/A0,n=>Math.floor(n/A0));zne.range;function op(n){return ra(e=>{e.setDate(e.getDate()-(e.getDay()+7-n)%7),e.setHours(0,0,0,0)},(e,t)=>{e.setDate(e.getDate()+t*7)},(e,t)=>(t-e-(t.getTimezoneOffset()-e.getTimezoneOffset())*od)/tU)}const oU=op(0),Px=op(1),jne=op(2),Vne=op(3),Zm=op(4),Hne=op(5),Gne=op(6);oU.range;Px.range;jne.range;Vne.range;Zm.range;Hne.range;Gne.range;function ap(n){return ra(e=>{e.setUTCDate(e.getUTCDate()-(e.getUTCDay()+7-n)%7),e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCDate(e.getUTCDate()+t*7)},(e,t)=>(t-e)/tU)}const aU=ap(0),Mx=ap(1),qne=ap(2),$ne=ap(3),Xm=ap(4),Wne=ap(5),Yne=ap(6);aU.range;Mx.range;qne.range;$ne.range;Xm.range;Wne.range;Yne.range;const sU=ra(n=>{n.setDate(1),n.setHours(0,0,0,0)},(n,e)=>{n.setMonth(n.getMonth()+e)},(n,e)=>e.getMonth()-n.getMonth()+(e.getFullYear()-n.getFullYear())*12,n=>n.getMonth());sU.range;const Kne=ra(n=>{n.setUTCDate(1),n.setUTCHours(0,0,0,0)},(n,e)=>{n.setUTCMonth(n.getUTCMonth()+e)},(n,e)=>e.getUTCMonth()-n.getUTCMonth()+(e.getUTCFullYear()-n.getUTCFullYear())*12,n=>n.getUTCMonth());Kne.range;const ad=ra(n=>{n.setMonth(0,1),n.setHours(0,0,0,0)},(n,e)=>{n.setFullYear(n.getFullYear()+e)},(n,e)=>e.getFullYear()-n.getFullYear(),n=>n.getFullYear());ad.every=n=>!isFinite(n=Math.floor(n))||!(n>0)?null:ra(e=>{e.setFullYear(Math.floor(e.getFullYear()/n)*n),e.setMonth(0,1),e.setHours(0,0,0,0)},(e,t)=>{e.setFullYear(e.getFullYear()+t*n)});ad.range;const Gf=ra(n=>{n.setUTCMonth(0,1),n.setUTCHours(0,0,0,0)},(n,e)=>{n.setUTCFullYear(n.getUTCFullYear()+e)},(n,e)=>e.getUTCFullYear()-n.getUTCFullYear(),n=>n.getUTCFullYear());Gf.every=n=>!isFinite(n=Math.floor(n))||!(n>0)?null:ra(e=>{e.setUTCFullYear(Math.floor(e.getUTCFullYear()/n)*n),e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCFullYear(e.getUTCFullYear()+t*n)});Gf.range;function bC(n){if(0<=n.y&&n.y<100){var e=new Date(-1,n.m,n.d,n.H,n.M,n.S,n.L);return e.setFullYear(n.y),e}return new Date(n.y,n.m,n.d,n.H,n.M,n.S,n.L)}function wC(n){if(0<=n.y&&n.y<100){var e=new Date(Date.UTC(-1,n.m,n.d,n.H,n.M,n.S,n.L));return e.setUTCFullYear(n.y),e}return new Date(Date.UTC(n.y,n.m,n.d,n.H,n.M,n.S,n.L))}function M_(n,e,t){return{y:n,m:e,d:t,H:0,M:0,S:0,L:0}}function Zne(n){var e=n.dateTime,t=n.date,r=n.time,i=n.periods,o=n.days,a=n.shortDays,l=n.months,h=n.shortMonths,p=R_(i),g=k_(i),_=R_(o),x=k_(o),C=R_(a),M=k_(a),L=R_(l),D=k_(l),z=R_(h),te=k_(h),le={a:Re,A:ht,b:Rt,B:hn,c:null,d:rD,e:rD,f:vre,g:Pre,G:Rre,H:mre,I:yre,j:_re,L:cU,m:bre,M:wre,p:wt,q:Ge,Q:aD,s:sD,S:xre,u:Ere,U:Tre,V:Sre,w:Cre,W:Are,x:null,X:null,y:Ire,Y:Mre,Z:kre,"%":oD},ce={a:Gn,A:Xt,b:ln,B:Mn,c:null,d:iD,e:iD,f:Dre,g:$re,G:Yre,H:Ore,I:Lre,j:Nre,L:uU,m:Fre,M:Bre,p:Ot,q:En,Q:aD,s:sD,S:Ure,u:zre,U:jre,V:Vre,w:Hre,W:Gre,x:null,X:null,y:qre,Y:Wre,Z:Kre,"%":oD},_e={a:je,A:ne,b:Ee,B:ke,c:Be,d:tD,e:tD,f:dre,g:eD,G:JN,H:nD,I:nD,j:cre,L:hre,m:sre,M:lre,p:xe,q:are,Q:pre,s:gre,S:ure,u:tre,U:nre,V:rre,w:ere,W:ire,x:Ze,X:at,y:eD,Y:JN,Z:ore,"%":fre};le.x=J(t,le),le.X=J(r,le),le.c=J(e,le),ce.x=J(t,ce),ce.X=J(r,ce),ce.c=J(e,ce);function J(lt,It){return function(he){var B=[],H=-1,F=0,Q=lt.length,ae,q,Ae;for(he instanceof Date||(he=new Date(+he));++H<Q;)lt.charCodeAt(H)===37&&(B.push(lt.slice(F,H)),(q=QN[ae=lt.charAt(++H)])!=null?ae=lt.charAt(++H):q=ae==="e"?" ":"0",(Ae=It[ae])&&(ae=Ae(he,q)),B.push(ae),F=H+1);return B.push(lt.slice(F,H)),B.join("")}}function pe(lt,It){return function(he){var B=M_(1900,void 0,1),H=ue(B,lt,he+="",0),F,Q;if(H!=he.length)return null;if("Q"in B)return new Date(B.Q);if("s"in B)return new Date(B.s*1e3+("L"in B?B.L:0));if(It&&!("Z"in B)&&(B.Z=0),"p"in B&&(B.H=B.H%12+B.p*12),B.m===void 0&&(B.m="q"in B?B.q:0),"V"in B){if(B.V<1||B.V>53)return null;"w"in B||(B.w=1),"Z"in B?(F=wC(M_(B.y,0,1)),Q=F.getUTCDay(),F=Q>4||Q===0?Mx.ceil(F):Mx(F),F=NM.offset(F,(B.V-1)*7),B.y=F.getUTCFullYear(),B.m=F.getUTCMonth(),B.d=F.getUTCDate()+(B.w+6)%7):(F=bC(M_(B.y,0,1)),Q=F.getDay(),F=Q>4||Q===0?Px.ceil(F):Px(F),F=sT.offset(F,(B.V-1)*7),B.y=F.getFullYear(),B.m=F.getMonth(),B.d=F.getDate()+(B.w+6)%7)}else("W"in B||"U"in B)&&("w"in B||(B.w="u"in B?B.u%7:"W"in B?1:0),Q="Z"in B?wC(M_(B.y,0,1)).getUTCDay():bC(M_(B.y,0,1)).getDay(),B.m=0,B.d="W"in B?(B.w+6)%7+B.W*7-(Q+5)%7:B.w+B.U*7-(Q+6)%7);return"Z"in B?(B.H+=B.Z/100|0,B.M+=B.Z%100,wC(B)):bC(B)}}function ue(lt,It,he,B){for(var H=0,F=It.length,Q=he.length,ae,q;H<F;){if(B>=Q)return-1;if(ae=It.charCodeAt(H++),ae===37){if(ae=It.charAt(H++),q=_e[ae in QN?It.charAt(H++):ae],!q||(B=q(lt,he,B))<0)return-1}else if(ae!=he.charCodeAt(B++))return-1}return B}function xe(lt,It,he){var B=p.exec(It.slice(he));return B?(lt.p=g.get(B[0].toLowerCase()),he+B[0].length):-1}function je(lt,It,he){var B=C.exec(It.slice(he));return B?(lt.w=M.get(B[0].toLowerCase()),he+B[0].length):-1}function ne(lt,It,he){var B=_.exec(It.slice(he));return B?(lt.w=x.get(B[0].toLowerCase()),he+B[0].length):-1}function Ee(lt,It,he){var B=z.exec(It.slice(he));return B?(lt.m=te.get(B[0].toLowerCase()),he+B[0].length):-1}function ke(lt,It,he){var B=L.exec(It.slice(he));return B?(lt.m=D.get(B[0].toLowerCase()),he+B[0].length):-1}function Be(lt,It,he){return ue(lt,e,It,he)}function Ze(lt,It,he){return ue(lt,t,It,he)}function at(lt,It,he){return ue(lt,r,It,he)}function Re(lt){return a[lt.getDay()]}function ht(lt){return o[lt.getDay()]}function Rt(lt){return h[lt.getMonth()]}function hn(lt){return l[lt.getMonth()]}function wt(lt){return i[+(lt.getHours()>=12)]}function Ge(lt){return 1+~~(lt.getMonth()/3)}function Gn(lt){return a[lt.getUTCDay()]}function Xt(lt){return o[lt.getUTCDay()]}function ln(lt){return h[lt.getUTCMonth()]}function Mn(lt){return l[lt.getUTCMonth()]}function Ot(lt){return i[+(lt.getUTCHours()>=12)]}function En(lt){return 1+~~(lt.getUTCMonth()/3)}return{format:function(lt){var It=J(lt+="",le);return It.toString=function(){return lt},It},parse:function(lt){var It=pe(lt+="",!1);return It.toString=function(){return lt},It},utcFormat:function(lt){var It=J(lt+="",ce);return It.toString=function(){return lt},It},utcParse:function(lt){var It=pe(lt+="",!0);return It.toString=function(){return lt},It}}}var QN={"-":"",_:" ",0:"0"},Bo=/^\s*\d+/,Xne=/^%/,Qne=/[\\^$*+?|[\]().{}]/g;function Br(n,e,t){var r=n<0?"-":"",i=(r?-n:n)+"",o=i.length;return r+(o<t?new Array(t-o+1).join(e)+i:i)}function Jne(n){return n.replace(Qne,"\\$&")}function R_(n){return new RegExp("^(?:"+n.map(Jne).join("|")+")","i")}function k_(n){return new Map(n.map((e,t)=>[e.toLowerCase(),t]))}function ere(n,e,t){var r=Bo.exec(e.slice(t,t+1));return r?(n.w=+r[0],t+r[0].length):-1}function tre(n,e,t){var r=Bo.exec(e.slice(t,t+1));return r?(n.u=+r[0],t+r[0].length):-1}function nre(n,e,t){var r=Bo.exec(e.slice(t,t+2));return r?(n.U=+r[0],t+r[0].length):-1}function rre(n,e,t){var r=Bo.exec(e.slice(t,t+2));return r?(n.V=+r[0],t+r[0].length):-1}function ire(n,e,t){var r=Bo.exec(e.slice(t,t+2));return r?(n.W=+r[0],t+r[0].length):-1}function JN(n,e,t){var r=Bo.exec(e.slice(t,t+4));return r?(n.y=+r[0],t+r[0].length):-1}function eD(n,e,t){var r=Bo.exec(e.slice(t,t+2));return r?(n.y=+r[0]+(+r[0]>68?1900:2e3),t+r[0].length):-1}function ore(n,e,t){var r=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(e.slice(t,t+6));return r?(n.Z=r[1]?0:-(r[2]+(r[3]||"00")),t+r[0].length):-1}function are(n,e,t){var r=Bo.exec(e.slice(t,t+1));return r?(n.q=r[0]*3-3,t+r[0].length):-1}function sre(n,e,t){var r=Bo.exec(e.slice(t,t+2));return r?(n.m=r[0]-1,t+r[0].length):-1}function tD(n,e,t){var r=Bo.exec(e.slice(t,t+2));return r?(n.d=+r[0],t+r[0].length):-1}function cre(n,e,t){var r=Bo.exec(e.slice(t,t+3));return r?(n.m=0,n.d=+r[0],t+r[0].length):-1}function nD(n,e,t){var r=Bo.exec(e.slice(t,t+2));return r?(n.H=+r[0],t+r[0].length):-1}function lre(n,e,t){var r=Bo.exec(e.slice(t,t+2));return r?(n.M=+r[0],t+r[0].length):-1}function ure(n,e,t){var r=Bo.exec(e.slice(t,t+2));return r?(n.S=+r[0],t+r[0].length):-1}function hre(n,e,t){var r=Bo.exec(e.slice(t,t+3));return r?(n.L=+r[0],t+r[0].length):-1}function dre(n,e,t){var r=Bo.exec(e.slice(t,t+6));return r?(n.L=Math.floor(r[0]/1e3),t+r[0].length):-1}function fre(n,e,t){var r=Xne.exec(e.slice(t,t+1));return r?t+r[0].length:-1}function pre(n,e,t){var r=Bo.exec(e.slice(t));return r?(n.Q=+r[0],t+r[0].length):-1}function gre(n,e,t){var r=Bo.exec(e.slice(t));return r?(n.s=+r[0],t+r[0].length):-1}function rD(n,e){return Br(n.getDate(),e,2)}function mre(n,e){return Br(n.getHours(),e,2)}function yre(n,e){return Br(n.getHours()%12||12,e,2)}function _re(n,e){return Br(1+sT.count(ad(n),n),e,3)}function cU(n,e){return Br(n.getMilliseconds(),e,3)}function vre(n,e){return cU(n,e)+"000"}function bre(n,e){return Br(n.getMonth()+1,e,2)}function wre(n,e){return Br(n.getMinutes(),e,2)}function xre(n,e){return Br(n.getSeconds(),e,2)}function Ere(n){var e=n.getDay();return e===0?7:e}function Tre(n,e){return Br(oU.count(ad(n)-1,n),e,2)}function lU(n){var e=n.getDay();return e>=4||e===0?Zm(n):Zm.ceil(n)}function Sre(n,e){return n=lU(n),Br(Zm.count(ad(n),n)+(ad(n).getDay()===4),e,2)}function Cre(n){return n.getDay()}function Are(n,e){return Br(Px.count(ad(n)-1,n),e,2)}function Ire(n,e){return Br(n.getFullYear()%100,e,2)}function Pre(n,e){return n=lU(n),Br(n.getFullYear()%100,e,2)}function Mre(n,e){return Br(n.getFullYear()%1e4,e,4)}function Rre(n,e){var t=n.getDay();return n=t>=4||t===0?Zm(n):Zm.ceil(n),Br(n.getFullYear()%1e4,e,4)}function kre(n){var e=n.getTimezoneOffset();return(e>0?"-":(e*=-1,"+"))+Br(e/60|0,"0",2)+Br(e%60,"0",2)}function iD(n,e){return Br(n.getUTCDate(),e,2)}function Ore(n,e){return Br(n.getUTCHours(),e,2)}function Lre(n,e){return Br(n.getUTCHours()%12||12,e,2)}function Nre(n,e){return Br(1+NM.count(Gf(n),n),e,3)}function uU(n,e){return Br(n.getUTCMilliseconds(),e,3)}function Dre(n,e){return uU(n,e)+"000"}function Fre(n,e){return Br(n.getUTCMonth()+1,e,2)}function Bre(n,e){return Br(n.getUTCMinutes(),e,2)}function Ure(n,e){return Br(n.getUTCSeconds(),e,2)}function zre(n){var e=n.getUTCDay();return e===0?7:e}function jre(n,e){return Br(aU.count(Gf(n)-1,n),e,2)}function hU(n){var e=n.getUTCDay();return e>=4||e===0?Xm(n):Xm.ceil(n)}function Vre(n,e){return n=hU(n),Br(Xm.count(Gf(n),n)+(Gf(n).getUTCDay()===4),e,2)}function Hre(n){return n.getUTCDay()}function Gre(n,e){return Br(Mx.count(Gf(n)-1,n),e,2)}function qre(n,e){return Br(n.getUTCFullYear()%100,e,2)}function $re(n,e){return n=hU(n),Br(n.getUTCFullYear()%100,e,2)}function Wre(n,e){return Br(n.getUTCFullYear()%1e4,e,4)}function Yre(n,e){var t=n.getUTCDay();return n=t>=4||t===0?Xm(n):Xm.ceil(n),Br(n.getUTCFullYear()%1e4,e,4)}function Kre(){return"+0000"}function oD(){return"%"}function aD(n){return+n}function sD(n){return Math.floor(+n/1e3)}var _g,Ra,Fg;Zre({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});function Zre(n){return _g=Zne(n),Ra=_g.format,Fg=_g.parse,_g.utcFormat,_g.utcParse,_g}function dU(){var n=0,e=1,t,r,i,o,a=nc,l=!1,h;function p(_){return _==null||isNaN(_=+_)?h:a(i===0?.5:(_=(o(_)-t)*i,l?Math.max(0,Math.min(1,_)):_))}p.domain=function(_){return arguments.length?([n,e]=_,t=o(n=+n),r=o(e=+e),i=t===r?0:1/(r-t),p):[n,e]},p.clamp=function(_){return arguments.length?(l=!!_,p):l},p.interpolator=function(_){return arguments.length?(a=_,p):a};function g(_){return function(x){var C,M;return arguments.length?([C,M]=x,a=_(C,M),p):[a(0),a(1)]}}return p.range=g(iT),p.rangeRound=g(bB),p.unknown=function(_){return arguments.length?(h=_,p):h},function(_){return o=_,t=_(n),r=_(e),i=t===r?0:1/(r-t),p}}function fU(n,e){return e.domain(n.domain()).interpolator(n.interpolator()).clamp(n.clamp()).unknown(n.unknown())}function pU(){var n=OM(dU()(nc));return n.copy=function(){return fU(n,pU())},WB.apply(n,arguments)}function gU(){var n=eU(dU());return n.copy=function(){return fU(n,gU()).exponent(n.exponent())},WB.apply(n,arguments)}const Xre="#fff",Qre=.4,DM="rgba(240,240,240,0.5)",Jre=[DM,"#137CBD"],eie="rgba(220,220,220,0.5)",tie=[DM,"#f6654e"],nie=[DM,"#00a9cc"],rie=[255,255,255,255];function iie(n){return Math.round(n*255)}function cD(n,e){const t=Hf(n);if(!t)return console.warn("Invalid color: ",n),`rgba(255, 255, 255, ${e})`;const r=t.rgb();return`rgba(${r.r}, ${r.g}, ${r.b}, ${e})`}function _l(n){if(Array.isArray(n))return n;const e=Hf(n);if(!e)return console.warn("Invalid color: ",n),rie;const t=e.rgb();return[Math.floor(t.r),Math.floor(t.g),Math.floor(t.b),iie(e.opacity)]}function ol(n,e){return n?_l(n):typeof e=="string"?_l(e):e}const ko=n=>n[n.length-1];var W2;(function(n){n.primary="#162d3c"})(W2||(W2={}));const lD=20,vg=n=>qB(0,lD+1).map(e=>n(e/lD)).reverse(),Y2="rgba(240,240,240,0.5)",oie=[Y2,W2.primary],aie=["#f7feae","#b7e6a5","#7ccba2","#46aea0","#089099","#00718b","#045275"],sie=["#d3f2a3","#97e196","#6cc08b","#4c9b82","#217a79","#105965","#074050"],mU=["#d1eeea","#a8dbd9","#85c4c9","#68abb8","#4f90a6","#3b738f","#2a5674"],cie=mU,lie={Blues:ko(NB),BluGrn:["#c4e6c3","#96d2a4","#6dbc90","#4da284","#36877a","#266b6e","#1d4f60"],BluYl:aie,BrwnYl:["#ede5cf","#e0c2a2","#d39c83","#c1766f","#a65461","#813753","#541f3f"],BuGn:ko(EB),BuPu:ko(TB),Burg:["#ffc6c4","#f4a3a8","#e38191","#cc607d","#ad466c","#8b3058","#672044"],BurgYl:["#fbe6c5","#f5ba98","#ee8a82","#dc7176","#c8586c","#9c3f5d","#70284a"],Cool:vg(Xte),DarkMint:["#d2fbd4","#a5dbc2","#7bbcb0","#559c9e","#3a7c89","#235d72","#123f5a"],Emrld:sie,GnBu:ko(SB),Grayish:oie,Greens:ko(DB),Greys:ko(FB),Inferno:vg(ene),Magenta:["#f3cbd3","#eaa9bd","#dd88ac","#ca699d","#b14d8e","#91357d","#6c2167"],Magma:vg(Jte),Mint:["#e4f1e1","#b4d9cc","#89c0b6","#63a6a0","#448c8a","#287274","#0d585f"],Oranges:ko(zB),OrRd:ko(CB),OrYel:["#ecda9a","#efc47e","#f3ad6a","#f7945d","#f97b57","#f66356","#ee4d5a"],Peach:["#fde0c5","#facba6","#f8b58b","#f59e72","#f2855d","#ef6a4c","#eb4a40"],Plasma:vg(tne),PinkYl:["#fef6b5","#ffdd9a","#ffc285","#ffa679","#fa8a76","#f16d7a","#e15383"],PuBu:ko(IB),PuBuGn:ko(AB),PuRd:ko(PB),Purp:["#f3e0f7","#e4c7f1","#d1afe8","#b998dd","#9f82ce","#826dba","#63589f"],Purples:ko(BB),PurpOr:["#f9ddda","#f2b9c4","#e597b9","#ce78b3","#ad5fad","#834ba0","#573b88"],RdPu:ko(MB),RedOr:["#f6d2a9","#f5b78e","#f19c7c","#ea8171","#dd686c","#ca5268","#b13f64"],Reds:ko(UB),Sunset:["#f3e79b","#fac484","#f8a07e","#eb7f86","#ce6693","#a059a0","#5c53a5"],SunsetDark:["#fcde9c","#faa476","#f0746e","#e34f6f","#dc3977","#b9257a","#7c1d6f"],Teal:mU,TealGrn:["#b0f2bc","#89e8ac","#67dba5","#4cc8a3","#38b2a3","#2c98a0","#257d98"],Viridis:vg(Qte),Warm:vg(Zte),YlGn:ko(kB),YlGnBu:ko(RB),YlOrBr:ko(OB),YlOrRd:ko(LB)},uie="#f52020",hie="#17a5be",die={negative:{flows:{scheme:[Y2,hie]}},positive:{flows:{scheme:[Y2,uie]}},locationAreas:{outline:"rgba(92,112,128,0.5)",normal:"rgba(220,220,220,0.5)"},outlineColor:"rgb(230,233,237)"};function fie(n){return yU(!1,n.colorScheme,n.darkMode,n.fadeEnabled,n.fadeOpacityEnabled,n.fadeAmount,n.animationEnabled)}function yU(n,e,t,r,i,o,a){if(n)return die;let l;Array.isArray(e)?l=e:(l=e&&lie[e]||cie,t&&(l=l.slice().reverse()));{const h=qB(0,Math.max(10,l.length)),p=h.length-1,g=pU(vB(l)).domain([0,p]);if(!r||o===0)l=h.map((_,x)=>g(x));else{const _=LM().exponent(1.5).domain([p,0]).range([0,2*o/100]);l=h.map((x,C)=>{const M=g(C),L=_(C);if(M==null||L==null)return"#000";const D=tT(M);return D.l=t?D.l-D.l*L:D.l+(100-D.l)*L,D.c=D.c-D.c*(L/4),i&&(D.opacity=D.opacity*(1-L)),D.toString()})}}return{darkMode:t,flows:{scheme:l},locationCircles:{outgoing:t?"#000":"#fff"},outlineColor:t?"#000":"rgba(255, 255, 255, 0.5)"}}function pie(n){const e=yB,t=n.length;let r=new Array(t),i=new Array(t),o=new Array(t),a=new Array(t),l,h;for(l=0;l<t;++l)h=E0(n[l]),r[l]=h.r||0,i[l]=h.g||0,o[l]=h.b||0,a[l]=h.opacity||0;return r=e(r),i=e(i),o=e(o),a=e(a),function(p){return h.r=r(p),h.g=i(p),h.b=o(p),h.opacity=a(p),h+""}}function xC(n,e,t){const r=gU(pie(e)).exponent(t?.5:.3333333333333333).domain(n);return i=>_l(r(i))}function gie(n,e,t){const r=e?e[0]:0,i=e?e[1]:0;if(_U(n)){const a=xC([0,i],n.positive.flows.scheme,t),l=xC([0,r],n.negative.flows.scheme,t);return h=>h>=0?a(h):l(h)}const o=xC([0,i||0],n.flows.scheme,t);return a=>o(a)}function mie(n){return n.positive!==void 0}function _U(n){return n.positive!==void 0}function yie(n,e){const t=n&&n.normal||eie,r=tT(t),i=_l(t);return{normal:i,connected:ol(n&&n.connected,i),highlighted:ol(n&&n.highlighted,cD(r[e?"brighter":"darker"](1).toString(),.5)),selected:ol(n&&n.selected,cD(r[e?"brighter":"darker"](2).toString(),.8)),outline:ol(n&&n.outline,_l(r[e?"brighter":"darker"](4).toString()))}}function K2(n,e,t){var h,p;const r=n&&n.flows&&n.flows.scheme||e,i=tT(r[r.length-1]),o=ol(n&&n.flows&&n.flows.highlighted,_l(i[t?"brighter":"darker"](.7).toString())),a=ol((h=n==null?void 0:n.locationCircles)==null?void 0:h.empty,t?"#000":"#fff"),l=ol(n&&n.locationCircles&&n.locationCircles.inner,i.toString());return{flows:{scheme:r,highlighted:o},locationCircles:{inner:l,outgoing:ol(n&&n.locationCircles&&n.locationCircles.outgoing,t?"#000":"#fff"),incoming:ol(n&&n.locationCircles&&n.locationCircles.incoming,i[t?"brighter":"darker"](1.25).toString()),highlighted:ol(n&&n.locationCircles&&n.locationCircles.highlighted,o),empty:a,outlineEmptyMix:((p=n==null?void 0:n.locationCircles)==null?void 0:p.outlineEmptyMix)??.4}}}function vU(n){const e=!!(n&&n.darkMode);return{darkMode:e,locationAreas:yie(n&&n.locationAreas,e),outlineColor:_l(n&&n.outlineColor||Xre),dimmedOpacity:n&&n.dimmedOpacity!=null?n.dimmedOpacity:Qre}}function _ie(n){const e=vU(n);return{...e,...K2(n,Jre,e.darkMode)}}function vie(n){const e=vU(n);return{...e,positive:K2(n&&n.positive,tie,e.darkMode),negative:K2(n&&n.negative,nie,e.darkMode)}}const uD=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array],EC=1,O_=8;class cT{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[t,r]=new Uint8Array(e,0,2);if(t!==219)throw new Error("Data does not appear to be in a KDBush format.");const i=r>>4;if(i!==EC)throw new Error(`Got v${i} data when expected v${EC}.`);const o=uD[r&15];if(!o)throw new Error("Unrecognized array type.");const[a]=new Uint16Array(e,2,1),[l]=new Uint32Array(e,4,1);return new cT(l,a,o,e)}constructor(e,t=64,r=Float64Array,i){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+t,2),65535),this.ArrayType=r,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;const o=uD.indexOf(this.ArrayType),a=e*2*this.ArrayType.BYTES_PER_ELEMENT,l=e*this.IndexArrayType.BYTES_PER_ELEMENT,h=(8-l%8)%8;if(o<0)throw new Error(`Unexpected typed array class: ${r}.`);i&&i instanceof ArrayBuffer?(this.data=i,this.ids=new this.IndexArrayType(this.data,O_,e),this.coords=new this.ArrayType(this.data,O_+l+h,e*2),this._pos=e*2,this._finished=!0):(this.data=new ArrayBuffer(O_+a+l+h),this.ids=new this.IndexArrayType(this.data,O_,e),this.coords=new this.ArrayType(this.data,O_+l+h,e*2),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,(EC<<4)+o]),new Uint16Array(this.data,2,1)[0]=t,new Uint32Array(this.data,4,1)[0]=e)}add(e,t){const r=this._pos>>1;return this.ids[r]=r,this.coords[this._pos++]=e,this.coords[this._pos++]=t,r}finish(){const e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return Z2(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,t,r,i){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:o,coords:a,nodeSize:l}=this,h=[0,o.length-1,0],p=[];for(;h.length;){const g=h.pop()||0,_=h.pop()||0,x=h.pop()||0;if(_-x<=l){for(let D=x;D<=_;D++){const z=a[2*D],te=a[2*D+1];z>=e&&z<=r&&te>=t&&te<=i&&p.push(o[D])}continue}const C=x+_>>1,M=a[2*C],L=a[2*C+1];M>=e&&M<=r&&L>=t&&L<=i&&p.push(o[C]),(g===0?e<=M:t<=L)&&(h.push(x),h.push(C-1),h.push(1-g)),(g===0?r>=M:i>=L)&&(h.push(C+1),h.push(_),h.push(1-g))}return p}within(e,t,r){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:i,coords:o,nodeSize:a}=this,l=[0,i.length-1,0],h=[],p=r*r;for(;l.length;){const g=l.pop()||0,_=l.pop()||0,x=l.pop()||0;if(_-x<=a){for(let D=x;D<=_;D++)hD(o[2*D],o[2*D+1],e,t)<=p&&h.push(i[D]);continue}const C=x+_>>1,M=o[2*C],L=o[2*C+1];hD(M,L,e,t)<=p&&h.push(i[C]),(g===0?e-r<=M:t-r<=L)&&(l.push(x),l.push(C-1),l.push(1-g)),(g===0?e+r>=M:t+r>=L)&&(l.push(C+1),l.push(_),l.push(1-g))}return h}}function Z2(n,e,t,r,i,o){if(i-r<=t)return;const a=r+i>>1;bU(n,e,a,r,i,o),Z2(n,e,t,r,a-1,1-o),Z2(n,e,t,a+1,i,1-o)}function bU(n,e,t,r,i,o){for(;i>r;){if(i-r>600){const p=i-r+1,g=t-r+1,_=Math.log(p),x=.5*Math.exp(2*_/3),C=.5*Math.sqrt(_*x*(p-x)/p)*(g-p/2<0?-1:1),M=Math.max(r,Math.floor(t-g*x/p+C)),L=Math.min(i,Math.floor(t+(p-g)*x/p+C));bU(n,e,t,M,L,o)}const a=e[2*t+o];let l=r,h=i;for(L_(n,e,r,t),e[2*i+o]>a&&L_(n,e,r,i);l<h;){for(L_(n,e,l,h),l++,h--;e[2*l+o]<a;)l++;for(;e[2*h+o]>a;)h--}e[2*r+o]===a?L_(n,e,r,h):(h++,L_(n,e,h,i)),h<=t&&(r=h+1),t<=h&&(i=h-1)}}function L_(n,e,t,r){TC(n,t,r),TC(e,2*t,2*r),TC(e,2*t+1,2*r+1)}function TC(n,e,t){const r=n[e];n[e]=n[t],n[t]=r}function hD(n,e,t,r){const i=n-t,o=e-r;return i*i+o*o}var Rx="NOT_FOUND";function bie(n){var e;return{get:function(r){return e&&n(e.key,r)?e.value:Rx},put:function(r,i){e={key:r,value:i}},getEntries:function(){return e?[e]:[]},clear:function(){e=void 0}}}function wie(n,e){var t=[];function r(l){var h=t.findIndex(function(g){return e(l,g.key)});if(h>-1){var p=t[h];return h>0&&(t.splice(h,1),t.unshift(p)),p.value}return Rx}function i(l,h){r(l)===Rx&&(t.unshift({key:l,value:h}),t.length>n&&t.pop())}function o(){return t}function a(){t=[]}return{get:r,put:i,getEntries:o,clear:a}}var xie=function(e,t){return e===t};function Eie(n){return function(t,r){if(t===null||r===null||t.length!==r.length)return!1;for(var i=t.length,o=0;o<i;o++)if(!n(t[o],r[o]))return!1;return!0}}function wU(n,e){var t=typeof e=="object"?e:{equalityCheck:e},r=t.equalityCheck,i=r===void 0?xie:r,o=t.maxSize,a=o===void 0?1:o,l=t.resultEqualityCheck,h=Eie(i),p=a===1?bie(h):wie(a,h);function g(){var _=p.get(arguments);if(_===Rx){if(_=n.apply(null,arguments),l){var x=p.getEntries(),C=x.find(function(M){return l(M.value,_)});C&&(_=C.value)}p.put(arguments,_)}return _}return g.clearCache=function(){return p.clear()},g}function Tie(n){var e=Array.isArray(n[0])?n[0]:n;if(!e.every(function(r){return typeof r=="function"})){var t=e.map(function(r){return typeof r=="function"?"function "+(r.name||"unnamed")+"()":typeof r}).join(", ");throw new Error("createSelector expects all input-selectors to be functions, but received the following types: ["+t+"]")}return e}function xU(n){for(var e=arguments.length,t=new Array(e>1?e-1:0),r=1;r<e;r++)t[r-1]=arguments[r];var i=function(){for(var a=arguments.length,l=new Array(a),h=0;h<a;h++)l[h]=arguments[h];var p=0,g,_={memoizeOptions:void 0},x=l.pop();if(typeof x=="object"&&(_=x,x=l.pop()),typeof x!="function")throw new Error("createSelector expects an output function after the inputs, but received: ["+typeof x+"]");var C=_,M=C.memoizeOptions,L=M===void 0?t:M,D=Array.isArray(L)?L:[L],z=Tie(l),te=n.apply(void 0,[function(){return p++,x.apply(null,arguments)}].concat(D)),le=n(function(){for(var _e=[],J=z.length,pe=0;pe<J;pe++)_e.push(z[pe].apply(null,arguments));return g=te.apply(null,_e),g});return Object.assign(le,{resultFunc:x,memoizedResultFunc:te,dependencies:z,lastResult:function(){return g},recomputations:function(){return p},resetRecomputations:function(){return p=0}}),le};return i}var Fn=xU(wU),FM={exports:{}};FM.exports;(function(n){(function(e,t,r){function i(h){var p=this,g=l();p.next=function(){var _=2091639*p.s0+p.c*23283064365386963e-26;return p.s0=p.s1,p.s1=p.s2,p.s2=_-(p.c=_|0)},p.c=1,p.s0=g(" "),p.s1=g(" "),p.s2=g(" "),p.s0-=g(h),p.s0<0&&(p.s0+=1),p.s1-=g(h),p.s1<0&&(p.s1+=1),p.s2-=g(h),p.s2<0&&(p.s2+=1),g=null}function o(h,p){return p.c=h.c,p.s0=h.s0,p.s1=h.s1,p.s2=h.s2,p}function a(h,p){var g=new i(h),_=p&&p.state,x=g.next;return x.int32=function(){return g.next()*4294967296|0},x.double=function(){return x()+(x()*2097152|0)*11102230246251565e-32},x.quick=x,_&&(typeof _=="object"&&o(_,g),x.state=function(){return o(g,{})}),x}function l(){var h=4022871197,p=function(g){g=String(g);for(var _=0;_<g.length;_++){h+=g.charCodeAt(_);var x=.02519603282416938*h;h=x>>>0,x-=h,x*=h,h=x>>>0,x-=h,h+=x*4294967296}return(h>>>0)*23283064365386963e-26};return p}t&&t.exports?t.exports=a:r&&r.amd?r(function(){return a}):this.alea=a})(ip,n,!1)})(FM);var Sie=FM.exports,BM={exports:{}};BM.exports;(function(n){(function(e,t,r){function i(l){var h=this,p="";h.x=0,h.y=0,h.z=0,h.w=0,h.next=function(){var _=h.x^h.x<<11;return h.x=h.y,h.y=h.z,h.z=h.w,h.w^=h.w>>>19^_^_>>>8},l===(l|0)?h.x=l:p+=l;for(var g=0;g<p.length+64;g++)h.x^=p.charCodeAt(g)|0,h.next()}function o(l,h){return h.x=l.x,h.y=l.y,h.z=l.z,h.w=l.w,h}function a(l,h){var p=new i(l),g=h&&h.state,_=function(){return(p.next()>>>0)/4294967296};return _.double=function(){do var x=p.next()>>>11,C=(p.next()>>>0)/4294967296,M=(x+C)/(1<<21);while(M===0);return M},_.int32=p.next,_.quick=_,g&&(typeof g=="object"&&o(g,p),_.state=function(){return o(p,{})}),_}t&&t.exports?t.exports=a:r&&r.amd?r(function(){return a}):this.xor128=a})(ip,n,!1)})(BM);var Cie=BM.exports,UM={exports:{}};UM.exports;(function(n){(function(e,t,r){function i(l){var h=this,p="";h.next=function(){var _=h.x^h.x>>>2;return h.x=h.y,h.y=h.z,h.z=h.w,h.w=h.v,(h.d=h.d+362437|0)+(h.v=h.v^h.v<<4^(_^_<<1))|0},h.x=0,h.y=0,h.z=0,h.w=0,h.v=0,l===(l|0)?h.x=l:p+=l;for(var g=0;g<p.length+64;g++)h.x^=p.charCodeAt(g)|0,g==p.length&&(h.d=h.x<<10^h.x>>>4),h.next()}function o(l,h){return h.x=l.x,h.y=l.y,h.z=l.z,h.w=l.w,h.v=l.v,h.d=l.d,h}function a(l,h){var p=new i(l),g=h&&h.state,_=function(){return(p.next()>>>0)/4294967296};return _.double=function(){do var x=p.next()>>>11,C=(p.next()>>>0)/4294967296,M=(x+C)/(1<<21);while(M===0);return M},_.int32=p.next,_.quick=_,g&&(typeof g=="object"&&o(g,p),_.state=function(){return o(p,{})}),_}t&&t.exports?t.exports=a:r&&r.amd?r(function(){return a}):this.xorwow=a})(ip,n,!1)})(UM);var Aie=UM.exports,zM={exports:{}};zM.exports;(function(n){(function(e,t,r){function i(l){var h=this;h.next=function(){var g=h.x,_=h.i,x,C;return x=g[_],x^=x>>>7,C=x^x<<24,x=g[_+1&7],C^=x^x>>>10,x=g[_+3&7],C^=x^x>>>3,x=g[_+4&7],C^=x^x<<7,x=g[_+7&7],x=x^x<<13,C^=x^x<<9,g[_]=C,h.i=_+1&7,C};function p(g,_){var x,C=[];if(_===(_|0))C[0]=_;else for(_=""+_,x=0;x<_.length;++x)C[x&7]=C[x&7]<<15^_.charCodeAt(x)+C[x+1&7]<<13;for(;C.length<8;)C.push(0);for(x=0;x<8&&C[x]===0;++x);for(x==8?C[7]=-1:C[x],g.x=C,g.i=0,x=256;x>0;--x)g.next()}p(h,l)}function o(l,h){return h.x=l.x.slice(),h.i=l.i,h}function a(l,h){l==null&&(l=+new Date);var p=new i(l),g=h&&h.state,_=function(){return(p.next()>>>0)/4294967296};return _.double=function(){do var x=p.next()>>>11,C=(p.next()>>>0)/4294967296,M=(x+C)/(1<<21);while(M===0);return M},_.int32=p.next,_.quick=_,g&&(g.x&&o(g,p),_.state=function(){return o(p,{})}),_}t&&t.exports?t.exports=a:r&&r.amd?r(function(){return a}):this.xorshift7=a})(ip,n,!1)})(zM);var Iie=zM.exports,jM={exports:{}};jM.exports;(function(n){(function(e,t,r){function i(l){var h=this;h.next=function(){var g=h.w,_=h.X,x=h.i,C,M;return h.w=g=g+1640531527|0,M=_[x+34&127],C=_[x=x+1&127],M^=M<<13,C^=C<<17,M^=M>>>15,C^=C>>>12,M=_[x]=M^C,h.i=x,M+(g^g>>>16)|0};function p(g,_){var x,C,M,L,D,z=[],te=128;for(_===(_|0)?(C=_,_=null):(_=_+"\0",C=0,te=Math.max(te,_.length)),M=0,L=-32;L<te;++L)_&&(C^=_.charCodeAt((L+32)%_.length)),L===0&&(D=C),C^=C<<10,C^=C>>>15,C^=C<<4,C^=C>>>13,L>=0&&(D=D+1640531527|0,x=z[L&127]^=C+D,M=x==0?M+1:0);for(M>=128&&(z[(_&&_.length||0)&127]=-1),M=127,L=4*128;L>0;--L)C=z[M+34&127],x=z[M=M+1&127],C^=C<<13,x^=x<<17,C^=C>>>15,x^=x>>>12,z[M]=C^x;g.w=D,g.X=z,g.i=M}p(h,l)}function o(l,h){return h.i=l.i,h.w=l.w,h.X=l.X.slice(),h}function a(l,h){l==null&&(l=+new Date);var p=new i(l),g=h&&h.state,_=function(){return(p.next()>>>0)/4294967296};return _.double=function(){do var x=p.next()>>>11,C=(p.next()>>>0)/4294967296,M=(x+C)/(1<<21);while(M===0);return M},_.int32=p.next,_.quick=_,g&&(g.X&&o(g,p),_.state=function(){return o(p,{})}),_}t&&t.exports?t.exports=a:r&&r.amd?r(function(){return a}):this.xor4096=a})(ip,n,!1)})(jM);var Pie=jM.exports,VM={exports:{}};VM.exports;(function(n){(function(e,t,r){function i(l){var h=this,p="";h.next=function(){var _=h.b,x=h.c,C=h.d,M=h.a;return _=_<<25^_>>>7^x,x=x-C|0,C=C<<24^C>>>8^M,M=M-_|0,h.b=_=_<<20^_>>>12^x,h.c=x=x-C|0,h.d=C<<16^x>>>16^M,h.a=M-_|0},h.a=0,h.b=0,h.c=-1640531527,h.d=1367130551,l===Math.floor(l)?(h.a=l/4294967296|0,h.b=l|0):p+=l;for(var g=0;g<p.length+20;g++)h.b^=p.charCodeAt(g)|0,h.next()}function o(l,h){return h.a=l.a,h.b=l.b,h.c=l.c,h.d=l.d,h}function a(l,h){var p=new i(l),g=h&&h.state,_=function(){return(p.next()>>>0)/4294967296};return _.double=function(){do var x=p.next()>>>11,C=(p.next()>>>0)/4294967296,M=(x+C)/(1<<21);while(M===0);return M},_.int32=p.next,_.quick=_,g&&(typeof g=="object"&&o(g,p),_.state=function(){return o(p,{})}),_}t&&t.exports?t.exports=a:r&&r.amd?r(function(){return a}):this.tychei=a})(ip,n,!1)})(VM);var Mie=VM.exports,EU={exports:{}};const Rie=kQ(PH);(function(n){(function(e,t,r){var i=256,o=6,a=52,l="random",h=r.pow(i,o),p=r.pow(2,a),g=p*2,_=i-1,x;function C(ce,_e,J){var pe=[];_e=_e==!0?{entropy:!0}:_e||{};var ue=z(D(_e.entropy?[ce,le(t)]:ce??te(),3),pe),xe=new M(pe),je=function(){for(var ne=xe.g(o),Ee=h,ke=0;ne<p;)ne=(ne+ke)*i,Ee*=i,ke=xe.g(1);for(;ne>=g;)ne/=2,Ee/=2,ke>>>=1;return(ne+ke)/Ee};return je.int32=function(){return xe.g(4)|0},je.quick=function(){return xe.g(4)/4294967296},je.double=je,z(le(xe.S),t),(_e.pass||J||function(ne,Ee,ke,Be){return Be&&(Be.S&&L(Be,xe),ne.state=function(){return L(xe,{})}),ke?(r[l]=ne,Ee):ne})(je,ue,"global"in _e?_e.global:this==r,_e.state)}function M(ce){var _e,J=ce.length,pe=this,ue=0,xe=pe.i=pe.j=0,je=pe.S=[];for(J||(ce=[J++]);ue<i;)je[ue]=ue++;for(ue=0;ue<i;ue++)je[ue]=je[xe=_&xe+ce[ue%J]+(_e=je[ue])],je[xe]=_e;(pe.g=function(ne){for(var Ee,ke=0,Be=pe.i,Ze=pe.j,at=pe.S;ne--;)Ee=at[Be=_&Be+1],ke=ke*i+at[_&(at[Be]=at[Ze=_&Ze+Ee])+(at[Ze]=Ee)];return pe.i=Be,pe.j=Ze,ke})(i)}function L(ce,_e){return _e.i=ce.i,_e.j=ce.j,_e.S=ce.S.slice(),_e}function D(ce,_e){var J=[],pe=typeof ce,ue;if(_e&&pe=="object")for(ue in ce)try{J.push(D(ce[ue],_e-1))}catch{}return J.length?J:pe=="string"?ce:ce+"\0"}function z(ce,_e){for(var J=ce+"",pe,ue=0;ue<J.length;)_e[_&ue]=_&(pe^=_e[_&ue]*19)+J.charCodeAt(ue++);return le(_e)}function te(){try{var ce;return x&&(ce=x.randomBytes)?ce=ce(i):(ce=new Uint8Array(i),(e.crypto||e.msCrypto).getRandomValues(ce)),le(ce)}catch{var _e=e.navigator,J=_e&&_e.plugins;return[+new Date,e,J,e.screen,le(t)]}}function le(ce){return String.fromCharCode.apply(0,ce)}if(z(r.random(),t),n.exports){n.exports=C;try{x=Rie}catch{}}else r["seed"+l]=C})(typeof self<"u"?self:ip,[],Math)})(EU);var kie=EU.exports,Oie=Sie,Lie=Cie,Nie=Aie,Die=Iie,Fie=Pie,Bie=Mie,sp=kie;sp.alea=Oie;sp.xor128=Lie;sp.xorwow=Nie;sp.xorshift7=Die;sp.xor4096=Fie;sp.tychei=Bie;var Uie=sp;const zie={minZoom:0,maxZoom:16,radius:40,extent:512,nodeSize:64,makeClusterName:(n,e)=>{},makeClusterId:n=>`{[${n}]}`};function jie(n){const{index:e}=n;return e!=null}function TU(n){const{id:e}=n;return e!=null}function Vie(n,e,t,r){const{getLocationLon:i,getLocationLat:o,getLocationId:a}=e,l={...zie,...r},{minZoom:h,maxZoom:p,nodeSize:g,makeClusterName:_,makeClusterId:x}=l,C=new Array(p+1);let M=new Array,L=0;for(const ue of n){const xe=i(ue),je=o(ue);M.push({x:Wie(xe),y:Yie(je),weight:t(a(ue)),zoom:1/0,index:L,parentId:-1,location:ue}),L++}const D=ue=>{const xe=new cT(ue.length,g,Float32Array);for(let je=0;je<ue.length;je++)xe.add(ue[je].x,ue[je].y);return xe.finish(),xe.points=ue,xe};C[p+1]=D(M);let z=p+1;for(let ue=p;ue>=h;ue--){const xe=Gie(M,ue,C[z],l);xe.length===M.length?(C[ue]=C[z],C[z]=void 0,z=ue,M=xe):(z=ue,M=xe,C[ue]=D(M))}if(C.length===0)return[];const te=C.map(ue=>ue==null?void 0:ue.points.length),le=GB(te.filter(ue=>ue>0));let ce=Zie(te)??te.length-1;const _e=Kie(n,e);if(_e<L){const ue=Xie(te,xe=>xe<=_e);ue>=0&&(ue<ce&&(C[ue+1]=C[ce],C.splice(ue+2)),ce=ue+1)}const J=Math.min(ce,le?te.lastIndexOf(le):ce),pe=new Array;z=NaN;for(let ue=ce;ue>=J;ue--){let xe;const je=C[ue];if(!je)continue;C[z]&&ue<ce&&(xe=HB(C[z].points,Ee=>Ee.map(ke=>ke.id?x(ke.id):a(ke.location)),Ee=>Ee.parentId));const ne=[];for(const Ee of je.points){const{x:ke,y:Be,numPoints:Ze,location:at}=Ee;if(jie(Ee))ne.push({id:a(at),zoom:ue,lat:o(at),lon:i(at)});else if(TU(Ee)){const{id:Re}=Ee,ht=xe&&xe.get(Re);if(!ht){console.warn("Omitting cluster with no children, point:",Ee);continue}const Rt={id:x(Re),name:_(Re,Ze),zoom:ue,lat:$ie(Be),lon:qie(ke),children:ht??[]};ne.push(Rt)}}pe.push({zoom:ue,nodes:ne}),z=ue}return pe}function Hie(n,e,t,r,i){return{x:n,y:e,zoom:1/0,id:t,parentId:-1,numPoints:r,weight:i}}function Gie(n,e,t,r){const i=[],{radius:o,extent:a}=r,l=o/(a*Math.pow(2,e));for(let h=0;h<n.length;h++){const p=n[h];if(p.zoom<=e)continue;p.zoom=e;const g=t.within(p.x,p.y,l);let _=p.weight||1,x=TU(p)?p.numPoints:1,C=p.x*_,M=p.y*_;const L=(h<<5)+(e+1);for(const D of g){const z=t.points[D];if(z.zoom<=e)continue;z.zoom=e;const te=z.weight||1,le=z.numPoints||1;C+=z.x*te,M+=z.y*te,_+=te,x+=le,z.parentId=L}x===1?i.push(p):(p.parentId=L,i.push(Hie(C/_,M/_,L,x,_)))}return i}function qie(n){return(n-.5)*360}function $ie(n){const e=(180-n*360)*Math.PI/180;return 360*Math.atan(Math.exp(e))/Math.PI-90}function Wie(n){return n/360+.5}function Yie(n){const e=Math.sin(n*Math.PI/180),t=.5-.25*Math.log((1+e)/(1-e))/Math.PI;return t<0?0:t>1?1:t}function Kie(n,e){const{getLocationLon:t,getLocationLat:r}=e,i=new Map;let o=0;for(const a of n){const l=t(a),h=r(a),p=`${l},${h}`,g=i.get(p);g||o++,i.set(p,g?g+1:1)}return o}function Zie(n){let e=-1/0,t;for(let r=0;r<n.length;r++){const i=n[r];typeof i=="number"&&i>e&&(e=i,t=r)}return t}function Xie(n,e){for(let t=n.length-1;t>=0;t--)if(e(n[t],t,n))return t;return-1}function Qie(n){const e=new Map,t=new Map,r=new Map;for(const{zoom:_,nodes:x}of n){e.set(_,x);for(const C of x)if(IM(C))t.set(C.id,C);else{const{id:M}=C,L=r.get(M);(L==null||L>_)&&r.set(M,_)}}const[i,o]=G2(n,_=>_.zoom);if(i==null||o==null)throw new Error("Could not determine minZoom or maxZoom");const a=new Map;for(const _ of t.values()){const{zoom:x}=_;let C=a.get(x);C||(C=new Map,a.set(x,C)),l(_,M=>{C==null||C.set(M,_)})}function l(_,x){for(const C of _.children){const M=t.get(C);M?l(M,x):x(C)}}const h=(_,x=o)=>{const C=[],M=(L,D)=>{if(x>L.zoom)for(const z of L.children){const te=t.get(z);te?M(te,D):D.push(z)}else D.push(L.id)};return M(_,C),C};function p(_,x){const C=a.get(x);if(!C)return;const M=C.get(_);return M?M.id:void 0}return{availableZoomLevels:n.map(_=>+_.zoom).sort((_,x)=>wm(_,x)),getClusterNodesFor:_=>{if(_!==void 0)return e.get(_)},getClusterById:_=>t.get(_),getMinZoomForLocation:_=>r.get(_)||i,expandCluster:h,findClusterFor:p,aggregateFlows:(_,x,{getFlowOriginId:C,getFlowDestId:M,getFlowMagnitude:L},D={})=>{if(x>o)return _;const z=[],te=new Map,le=(_e,J)=>`${_e}:${J}`,{flowCountsMapReduce:ce={map:L,reduce:(_e,J)=>(_e||0)+J}}=D;for(const _e of _){const J=C(_e),pe=M(_e),ue=p(J,x)||J,xe=p(pe,x)||pe,je=le(ue,xe);if(ue===J&&xe===pe)z.push(_e);else{let ne=te.get(je);ne?ne.count=ce.reduce(ne.count,ce.map(_e)):(ne={origin:ue,dest:xe,count:ce.map(_e),aggregate:!0},z.push(ne),te.set(je,ne))}}return z}}}function Jie(n,{getFlowOriginId:e,getFlowDestId:t,getFlowMagnitude:r}){const i={incoming:new Map,outgoing:new Map};for(const o of n){const a=e(o),l=t(o),h=r(o);i.incoming.set(l,(i.incoming.get(l)||0)+h),i.outgoing.set(a,(i.outgoing.get(a)||0)+h)}return o=>Math.max(Math.abs(i.incoming.get(o)||0),Math.abs(i.outgoing.get(o)||0))}function eoe(n,e){if(!n.length)throw new Error("No available zoom levels");return n[Math.min(one(n,Math.floor(e)),n.length-1)]}class X2{constructor(e){this.getLocationId=t=>Tv(t)?t.id:this.accessors.getLocationId(t),this.getLocationName=t=>{let r;return Tv(t)&&IM(t)?r=t.name:this.accessors.getLocationName&&(r=this.accessors.getLocationName(t)),r||(r=`${this.getLocationId(t)}`),r},this.getLocationLat=t=>Tv(t)?t.lat:this.accessors.getLocationLat(t),this.getLocationLon=t=>Tv(t)?t.lon:this.accessors.getLocationLon(t),this.getFlowOriginId=t=>hC(t)?t.origin:this.accessors.getFlowOriginId(t),this.getFlowDestId=t=>hC(t)?t.dest:this.accessors.getFlowDestId(t),this.getFlowMagnitude=t=>hC(t)?t.count:this.accessors.getFlowMagnitude(t),this.getFlowTime=t=>{const{getFlowTime:r}=this.accessors;return r?r(t):void 0},this.accessors=e}setAccessors(e){this.accessors=e}getFlowmapDataAccessors(){return this.accessors}}const toe=(n,e=0)=>{const t=e,r=new vX({...n,width:n.width+t*2,height:n.height+t*2}).getBounds();return[r[0][0],r[0][1],r[1][0],r[1][1]]},noe=n=>{if(n)return JB().range([.025,.5]).domain([0,Math.max.apply(null,n.map(e=>Math.abs(e||0)))])};function roe(n,e,t,r,i){const{getLocationId:o,getLocationName:a,getLocationClusterName:l}=r,h=p=>{const g=t.get(p);return g?a?a(g):o(g)||p:`"${p}"`};for(const p of e)for(const g of p.nodes)if(IM(g)){const _=n.expandCluster(g);if(_.sort((x,C)=>Sx(i(x),i(C))),l)g.name=l(_);else{const x=_[0],C=_.length===2?_[1]:void 0;g.name=`"${h(x)}" and ${C?`"${h(C)}"`:`${_.length-1} others`}`}}else g.name=h(g.id)}Fg("%Y-%m-%d"),Fg("%Y-%m-%d %H:%M"),Fg("%Y-%m-%d %H:%M:%S"),Fg("%Y"),Fg("%Y-%m");var Ah;(function(n){n.SECOND="SECOND",n.MINUTE="MINUTE",n.HOUR="HOUR",n.DAY="DAY",n.MONTH="MONTH",n.YEAR="YEAR"})(Ah||(Ah={}));Ra(".%L");const ioe=Ra(":%S"),ooe=Ra("%I:%M"),aoe=Ra("%I %p"),soe=Ra("%a %d");Ra("%b %d");const coe=Ra("%b"),loe=Ra("%Y"),Hv=[{order:0,key:Ah.SECOND,interval:nU,format:ioe,formatFull:Ra("%Y-%m-%d %H:%M:%S")},{order:1,key:Ah.MINUTE,interval:rU,format:ooe,formatFull:Ra("%Y-%m-%d %H:%M")},{order:2,key:Ah.HOUR,interval:iU,format:aoe,formatFull:Ra("%a %d %b %Y, %I %p")},{order:3,key:Ah.DAY,interval:sT,format:soe,formatFull:Ra("%a %d %b %Y")},{order:4,key:Ah.MONTH,interval:sU,format:coe,formatFull:Ra("%b %Y")},{order:5,key:Ah.YEAR,interval:ad,format:loe,formatFull:Ra("%Y")}];function dD(n){return Hv.find(e=>e.key===n)}function uoe(n){return Hv.find(e=>e.order===n)}function hoe(n){let e;for(const t of Hv){const{interval:r}=t;if(r(n)<n)return e||t;e=t}return Hv[Hv.length-1]}const doe=20;class foe{constructor(e){this.getFlowsFromProps=(t,r)=>r.flows,this.getLocationsFromProps=(t,r)=>r.locations,this.getClusterLevelsFromProps=(t,r)=>r.clusterLevels,this.getMaxTopFlowsDisplayNum=(t,r)=>t.settings.maxTopFlowsDisplayNum,this.getSelectedLocations=(t,r)=>{var i;return(i=t.filter)==null?void 0:i.selectedLocations},this.getLocationFilterMode=(t,r)=>{var i;return(i=t.filter)==null?void 0:i.locationFilterMode},this.getClusteringEnabled=(t,r)=>t.settings.clusteringEnabled,this.getLocationTotalsEnabled=(t,r)=>t.settings.locationTotalsEnabled,this.getLocationLabelsEnabled=(t,r)=>t.settings.locationLabelsEnabled,this.getZoom=(t,r)=>t.viewport.zoom,this.getViewport=(t,r)=>t.viewport,this.getSelectedTimeRange=(t,r)=>{var i;return(i=t.filter)==null?void 0:i.selectedTimeRange},this.getColorScheme=(t,r)=>t.settings.colorScheme,this.getDarkMode=(t,r)=>t.settings.darkMode,this.getFadeEnabled=(t,r)=>t.settings.fadeEnabled,this.getFadeOpacityEnabled=(t,r)=>t.settings.fadeOpacityEnabled,this.getFadeAmount=(t,r)=>t.settings.fadeAmount,this.getAnimate=(t,r)=>t.settings.animationEnabled,this.getInvalidLocationIds=Fn(this.getLocationsFromProps,t=>{if(!t)return;const r=[];for(const i of t){const o=this.accessors.getLocationId(i),a=this.accessors.getLocationLon(i),l=this.accessors.getLocationLat(i);(!(-90<=l&&l<=90)||!(-180<=a&&a<=180))&&r.push(o)}return r.length>0?r:void 0}),this.getLocations=Fn(this.getLocationsFromProps,this.getInvalidLocationIds,(t,r)=>{if(!t)return;if(!r||r.length===0)return t;const i=new Set(r),o=[];for(const a of t){const l=this.accessors.getLocationId(a);i.has(l)||o.push(a)}return o}),this.getLocationIds=Fn(this.getLocations,t=>{if(!t)return;const r=new Set;for(const i of t)r.add(this.accessors.getLocationId(i));return r}),this.getSelectedLocationsSet=Fn(this.getSelectedLocations,t=>t&&t.length>0?new Set(t):void 0),this.getSortedFlowsForKnownLocations=Fn(this.getFlowsFromProps,this.getLocationIds,(t,r)=>{if(!r||!t)return;const i=[];for(const o of t){const a=this.accessors.getFlowOriginId(o),l=this.accessors.getFlowDestId(o);r.has(a)&&r.has(l)&&i.push(o)}return i.sort((o,a)=>Sx(Math.abs(this.accessors.getFlowMagnitude(o)),Math.abs(this.accessors.getFlowMagnitude(a))))}),this.getActualTimeExtent=Fn(this.getSortedFlowsForKnownLocations,t=>{if(!t)return;let r=null,i=null;for(const o of t){const a=this.accessors.getFlowTime(o);a&&((r==null||r>a)&&(r=a),(i==null||i<a)&&(i=a))}if(!(!r||!i))return[r,i]}),this.getTimeGranularityKey=Fn(this.getSortedFlowsForKnownLocations,this.getActualTimeExtent,(t,r)=>{if(!t||!r)return;const i=GB(t,a=>{const l=this.accessors.getFlowTime(a);return l?hoe(l).order:null});if(i==null)return;const o=uoe(i);return o?o.key:void 0}),this.getTimeExtent=Fn(this.getActualTimeExtent,this.getTimeGranularityKey,(t,r)=>{const i=r?dD(r):void 0;if(!t||!(i!=null&&i.interval))return;const{interval:o}=i;return[t[0],o.offset(o.floor(t[1]),1)]}),this.getSortedFlowsForKnownLocationsFilteredByTime=Fn(this.getSortedFlowsForKnownLocations,this.getTimeExtent,this.getSelectedTimeRange,(t,r,i)=>{if(t)return!r||!i||r[0]===i[0]&&r[1]===i[1]?t:t.filter(o=>{const a=this.accessors.getFlowTime(o);return a&&i[0]<=a&&a<i[1]})}),this.getLocationsHavingFlows=Fn(this.getSortedFlowsForKnownLocations,this.getLocations,(t,r)=>{if(!r||!t)return r;const i=new Set;for(const a of t)i.add(this.accessors.getFlowOriginId(a)),i.add(this.accessors.getFlowDestId(a));const o=[];for(const a of r)i.has(this.accessors.getLocationId(a))&&o.push(a);return o}),this.getLocationsById=Fn(this.getLocationsHavingFlows,t=>{if(!t)return;const r=new Map;for(const i of t)r.set(this.accessors.getLocationId(i),i);return r}),this.getLocationWeightGetter=Fn(this.getSortedFlowsForKnownLocations,t=>t?Jie(t,this.accessors.getFlowmapDataAccessors()):void 0),this.getClusterLevels=Fn(this.getClusterLevelsFromProps,this.getLocationsHavingFlows,this.getLocationWeightGetter,(t,r,i)=>t||(!r||!i?void 0:Vie(r,this.accessors.getFlowmapDataAccessors(),i,{maxZoom:doe}))),this.getClusterIndex=Fn(this.getLocationsById,this.getLocationWeightGetter,this.getClusterLevels,(t,r,i)=>{if(!t||!r||!i)return;const o=Qie(i);return roe(o,i,t,this.accessors.getFlowmapDataAccessors(),r),o}),this.getAvailableClusterZoomLevels=Fn(this.getClusterIndex,this.getSelectedLocations,(t,r)=>{if(!t)return;let i=Number.POSITIVE_INFINITY,o=Number.NEGATIVE_INFINITY;const a=l=>{const h=t.getClusterById(l);if(h)o=Math.max(o,h.zoom),i=Math.min(i,h.zoom);else{const p=t.getMinZoomForLocation(l);o=Math.max(o,p)}};if(r)for(const l of r)a(l);return t.availableZoomLevels.filter(l=>o<=l&&l<=i)}),this._getClusterZoom=Fn(this.getClusterIndex,this.getZoom,this.getAvailableClusterZoomLevels,(t,r,i)=>!t||!i||r==null?void 0:eoe(i,r)),this.getClusterZoom=(t,r)=>{const{settings:i}=t;if(i.clusteringEnabled)return i.clusteringAuto||i.clusteringLevel==null?this._getClusterZoom(t,r):i.clusteringLevel},this.getLocationsForSearchBox=Fn(this.getClusteringEnabled,this.getLocationsHavingFlows,this.getSelectedLocations,this.getClusterZoom,this.getClusterIndex,(t,r,i,o,a)=>{if(!r)return;let l=Array.from(r);if(a&&i){const h=[];for(const p of i){const g=a.getClusterById(p);g&&!l.find(_=>(Tv(_)?_.id:this.accessors.getLocationId(_))===p)&&h.push(g)}h.length>0&&(l=l.concat(h))}return l}),this.getDiffMode=Fn(this.getFlowsFromProps,t=>{if(t){for(const r of t)if(this.accessors.getFlowMagnitude(r)<0)return!0}return!1}),this._getFlowmapColors=Fn(this.getDiffMode,this.getColorScheme,this.getDarkMode,this.getFadeEnabled,this.getFadeOpacityEnabled,this.getFadeAmount,this.getAnimate,yU),this.getFlowmapColorsRGBA=Fn(this._getFlowmapColors,t=>mie(t)?vie(t):_ie(t)),this.getUnknownLocations=Fn(this.getLocationIds,this.getFlowsFromProps,this.getSortedFlowsForKnownLocations,(t,r,i)=>{if(!t||!r||i)return;const o=new Set;for(const a of r)t.has(this.accessors.getFlowOriginId(a))||o.add(this.accessors.getFlowOriginId(a)),t.has(this.accessors.getFlowDestId(a))||o.add(this.accessors.getFlowDestId(a));return o}),this.getSortedAggregatedFilteredFlows=Fn(this.getClusterIndex,this.getClusteringEnabled,this.getSortedFlowsForKnownLocationsFilteredByTime,this.getClusterZoom,this.getTimeExtent,(t,r,i,o,a)=>{if(!i)return;let l;return r&&t&&o!=null?l=t.aggregateFlows(i,o,this.accessors.getFlowmapDataAccessors()):l=poe(i,this.accessors.getFlowmapDataAccessors()),l.sort((h,p)=>Sx(Math.abs(this.accessors.getFlowMagnitude(h)),Math.abs(this.accessors.getFlowMagnitude(p)))),l}),this.getExpandedSelectedLocationsSet=Fn(this.getClusteringEnabled,this.getSelectedLocationsSet,this.getClusterIndex,(t,r,i)=>{if(!r||!i)return r;const o=new Set;for(const a of r){const l=i.getClusterById(a);if(l){const h=i.expandCluster(l);for(const p of h)o.add(p)}else o.add(a)}return o}),this.getTotalCountsByTime=Fn(this.getSortedFlowsForKnownLocations,this.getTimeGranularityKey,this.getTimeExtent,this.getExpandedSelectedLocationsSet,this.getLocationFilterMode,(t,r,i,o,a)=>{const l=r?dD(r):void 0;if(!t||!l||!i)return;const h=t.reduce((p,g)=>{if(this.isFlowInSelection(g,o,a)){const _=l.interval(this.accessors.getFlowTime(g)).getTime();p.set(_,(p.get(_)??0)+this.accessors.getFlowMagnitude(g))}return p},new Map);return Array.from(h.entries()).map(([p,g])=>({time:new Date(p),count:g}))}),this.getMaxLocationCircleSize=Fn(this.getLocationTotalsEnabled,t=>t?17:1),this.getViewportBoundingBox=Fn(this.getViewport,this.getMaxLocationCircleSize,toe),this.getLocationsForZoom=Fn(this.getClusteringEnabled,this.getLocationsHavingFlows,this.getClusterIndex,this.getClusterZoom,(t,r,i,o)=>t&&i?i.getClusterNodesFor(o):r),this.getLocationTotals=Fn(this.getLocationsForZoom,this.getSortedAggregatedFilteredFlows,this.getSelectedLocationsSet,this.getLocationFilterMode,(t,r,i,o)=>{if(!r)return;const a=new Map,l=(h,p)=>{const g=a.get(h)??{incomingCount:0,outgoingCount:0,internalCount:0};return p.incomingCount!=null&&(g.incomingCount+=p.incomingCount),p.outgoingCount!=null&&(g.outgoingCount+=p.outgoingCount),p.internalCount!=null&&(g.internalCount+=p.internalCount),g};for(const h of r)if(this.isFlowInSelection(h,i,o)){const p=this.accessors.getFlowOriginId(h),g=this.accessors.getFlowDestId(h),_=this.accessors.getFlowMagnitude(h);p===g?a.set(p,l(p,{internalCount:_})):(a.set(p,l(p,{outgoingCount:_})),a.set(g,l(g,{incomingCount:_})))}return a}),this.getLocationsTree=Fn(this.getLocationsForZoom,t=>{if(!t)return;const r=Array.isArray(t)?t:Array.from(t),i=new cT(r.length,64,Float32Array);for(let o=0;o<r.length;o++){const a=r[o];i.add(SC(this.accessors.getLocationLon(a)),CC(this.accessors.getLocationLat(a)))}return i.finish(),i.points=r,i}),this._getLocationIdsInViewport=Fn(this.getLocationsTree,this.getViewportBoundingBox,(t,r)=>{const i=this._getLocationsInBboxIndices(t,r);if(i)return new Set(i.map(o=>t.points[o].id))}),this.getLocationIdsInViewport=xU(wU,(t,r,i)=>{if(t===r)return!0;if(t==null||r==null||t.size!==r.size)return!1;for(const o of t)if(!r.has(o))return!1;return!0})(this._getLocationIdsInViewport,t=>{if(t)return t}),this.getTotalUnfilteredCount=Fn(this.getSortedFlowsForKnownLocations,t=>{if(t)return t.reduce((r,i)=>r+this.accessors.getFlowMagnitude(i),0)}),this.getTotalFilteredCount=Fn(this.getSortedAggregatedFilteredFlows,this.getSelectedLocationsSet,this.getLocationFilterMode,(t,r,i)=>t?t.reduce((a,l)=>this.isFlowInSelection(l,r,i)?a+this.accessors.getFlowMagnitude(l):a,0):void 0),this._getLocationTotalsExtent=Fn(this.getLocationTotals,t=>fD(t,void 0)),this._getLocationTotalsForViewportExtent=Fn(this.getLocationTotals,this.getLocationIdsInViewport,(t,r)=>fD(t,r)),this.getLocationTotalsExtent=(t,r)=>t.settings.adaptiveScalesEnabled?this._getLocationTotalsForViewportExtent(t,r):this._getLocationTotalsExtent(t,r),this.getFlowsForFlowmapLayer=Fn(this.getSortedAggregatedFilteredFlows,this.getLocationIdsInViewport,this.getSelectedLocationsSet,this.getLocationFilterMode,this.getMaxTopFlowsDisplayNum,(t,r,i,o,a)=>{if(!t||!r)return;const l=[];let h=0;for(const p of t){const g=this.accessors.getFlowOriginId(p),_=this.accessors.getFlowDestId(p);if((r.has(g)||r.has(_))&&this.isFlowInSelection(p,i,o)&&g!==_&&(l.push(p),h++),h>a)break}return l.reverse()}),this._getFlowMagnitudeExtent=Fn(this.getSortedAggregatedFilteredFlows,this.getSelectedLocationsSet,this.getLocationFilterMode,(t,r,i)=>{if(!t)return;let o;for(const a of t)if(this.accessors.getFlowOriginId(a)!==this.accessors.getFlowDestId(a)&&this.isFlowInSelection(a,r,i)){const l=this.accessors.getFlowMagnitude(a);o==null?o=[l,l]:(l<o[0]&&(o[0]=l),l>o[1]&&(o[1]=l))}return o}),this._getAdaptiveFlowMagnitudeExtent=Fn(this.getFlowsForFlowmapLayer,t=>{if(!t)return;const r=G2(t,this.accessors.getFlowMagnitude);return r[0]!==void 0&&r[1]!==void 0?r:void 0}),this.getFlowMagnitudeExtent=(t,r)=>t.settings.adaptiveScalesEnabled?this._getAdaptiveFlowMagnitudeExtent(t,r):this._getFlowMagnitudeExtent(t,r),this.getLocationMaxAbsTotalGetter=Fn(this.getLocationTotals,t=>r=>{const i=t==null?void 0:t.get(r);if(i)return Math.max(Math.abs(i.incomingCount+i.internalCount),Math.abs(i.outgoingCount+i.internalCount))}),this.getFlowThicknessScale=Fn(this.getFlowMagnitudeExtent,noe),this.getCircleSizeScale=Fn(this.getMaxLocationCircleSize,this.getLocationTotalsEnabled,this.getLocationTotalsExtent,(t,r,i)=>{if(!r)return()=>t;if(i)return Fne().range([0,t]).domain([0,Math.max.apply(null,i.map(o=>Math.abs(o||0)))])}),this.getInCircleSizeGetter=Fn(this.getCircleSizeScale,this.getLocationTotals,(t,r)=>i=>{const o=r==null?void 0:r.get(i);return o&&t&&t(Math.abs(o.incomingCount+o.internalCount))||0}),this.getOutCircleSizeGetter=Fn(this.getCircleSizeScale,this.getLocationTotals,(t,r)=>i=>{const o=r==null?void 0:r.get(i);return o&&t&&t(Math.abs(o.outgoingCount+o.internalCount))||0}),this.getSortedLocationsForZoom=Fn(this.getLocationsForZoom,this.getInCircleSizeGetter,this.getOutCircleSizeGetter,(t,r,i)=>t?[...t].sort((a,l)=>{const h=this.accessors.getLocationId(a),p=this.accessors.getLocationId(l);return wm(Math.max(r(h),i(h)),Math.max(r(p),i(p)))}):void 0),this.getLocationsForFlowmapLayer=Fn(this.getSortedLocationsForZoom,t=>t),this.getLocationsForFlowmapLayerById=Fn(this.getLocationsForFlowmapLayer,t=>{if(t)return t.reduce((r,i)=>(r.set(this.accessors.getLocationId(i),i),r),new Map)}),this.getLocationOrClusterByIdGetter=Fn(this.getClusterIndex,this.getLocationsById,(t,r)=>i=>(t==null?void 0:t.getClusterById(i))??(r==null?void 0:r.get(i))),this.getLayersData=Fn(this.getLocationsForFlowmapLayer,this.getFlowsForFlowmapLayer,this.getFlowmapColorsRGBA,this.getLocationsForFlowmapLayerById,this.getLocationIdsInViewport,this.getInCircleSizeGetter,this.getOutCircleSizeGetter,this.getFlowThicknessScale,this.getAnimate,this.getLocationLabelsEnabled,(t,r,i,o,a,l,h,p,g,_)=>this._prepareLayersData(t,r,i,o,a,l,h,p,g,_)),this.accessors=new X2(e),this.setAccessors(e)}setAccessors(e){this.accessors=new X2(e)}getAggregateAccessors(){return this.accessors}prepareLayersData(e,t){const r=this.getLocationsForFlowmapLayer(e,t)||[],i=this.getFlowsForFlowmapLayer(e,t)||[],o=this.getFlowmapColorsRGBA(e,t),a=this.getLocationsForFlowmapLayerById(e,t),l=this.getLocationIdsInViewport(e,t),h=this.getInCircleSizeGetter(e,t),p=this.getOutCircleSizeGetter(e,t),g=this.getFlowThicknessScale(e,t),_=this.getLocationLabelsEnabled(e,t);return this._prepareLayersData(r,i,o,a,l,h,p,g,e.settings.animationEnabled,_)}_prepareLayersData(e,t,r,i,o,a,l,h,p,g){e||(e=[]),t||(t=[]);const{getFlowOriginId:_,getFlowDestId:x,getFlowMagnitude:C,getLocationId:M,getLocationLon:L,getLocationLat:D,getLocationName:z}=this.accessors,te=G2(t,Ze=>C(Ze)),le=gie(r,te,!1),ce=Float32Array.from(function*(){for(const Ze of e)yield L(Ze),yield D(Ze)}()),_e=_U(r)?r.positive.locationCircles.inner:r.locationCircles.inner,J=Uint8Array.from(function*(){for(const Ze of e)yield*_e}()),pe=Float32Array.from(function*(){for(const Ze of e){const at=M(Ze);yield o!=null&&o.has(at)?a(at):1}}()),ue=Float32Array.from(function*(){for(const Ze of e){const at=M(Ze);yield o!=null&&o.has(at)?l(at):1}}()),xe=Float32Array.from(function*(){for(const Ze of t){const at=i==null?void 0:i.get(_(Ze));yield at?L(at):0,yield at?D(at):0}}()),je=Float32Array.from(function*(){for(const Ze of t){const at=i==null?void 0:i.get(x(Ze));yield at?L(at):0,yield at?D(at):0}}()),ne=Float32Array.from(function*(){for(const Ze of t)yield h&&h(C(Ze))||0}()),Ee=Float32Array.from(function*(){for(const Ze of t){const at=_(Ze),Re=x(Ze);yield Math.max(a(at),l(at)),yield Math.max(a(Re),l(Re))}}()),ke=Uint8Array.from(function*(){for(const Ze of t)yield*le(C(Ze))}()),Be=p?Float32Array.from(function*(){for(const Ze of t)yield new Uie.alea(`${_(Ze)}-${x(Ze)}`)()}()):void 0;return{circleAttributes:{length:e.length,attributes:{getPosition:{value:ce,size:2},getColor:{value:J,size:4},getInRadius:{value:pe,size:1},getOutRadius:{value:ue,size:1}}},lineAttributes:{length:t.length,attributes:{getSourcePosition:{value:xe,size:2},getTargetPosition:{value:je,size:2},getThickness:{value:ne,size:1},getColor:{value:ke,size:4},getEndpointOffsets:{value:Ee,size:2},...Be?{getStaggering:{value:Be,size:1}}:{}}},...g?{locationLabels:e.map(z)}:void 0}}getLocationsInBbox(e,t){if(e)return this._getLocationsInBboxIndices(e,t).map(r=>e.points[r])}_getLocationsInBboxIndices(e,t){if(!e)return;const[r,i,o,a]=t,[l,h,p,g]=[SC(r),CC(i),SC(o),CC(a)];return e.range(Math.min(l,p),Math.min(h,g),Math.max(l,p),Math.max(h,g))}isFlowInSelection(e,t,r){const i=this.accessors.getFlowOriginId(e),o=this.accessors.getFlowDestId(e);if(t)switch(r){case em.ALL:return t.has(i)||t.has(o);case em.BETWEEN:return t.has(i)&&t.has(o);case em.INCOMING:return t.has(o);case em.OUTGOING:return t.has(i)}return!0}}function fD(n,e){if(!n)return;let t;for(const[r,{incomingCount:i,outgoingCount:o,internalCount:a}]of n.entries())if(e==null||e.has(r)){const l=Math.min(i+a,o+a,a),h=Math.max(i+a,o+a,a);t?(l<t[0]&&(t[0]=l),h>t[1]&&(t[1]=h)):t=[l,h]}return t}function SC(n){return n/360+.5}function CC(n){const e=Math.sin(n*Math.PI/180),t=.5-.25*Math.log((1+e)/(1-e))/Math.PI;return t<0?0:t>1?1:t}function poe(n,e){const t=HB(n,i=>{const o=e.getFlowOriginId(i[0]),a=e.getFlowDestId(i[0]);return{aggregate:!0,origin:o,dest:a,count:i.reduce((h,p)=>{const g=e.getFlowMagnitude(p);return g&&!isNaN(g)&&isFinite(g)?h+g:h},0)}},e.getFlowOriginId,e.getFlowDestId),r=[];for(const i of t.values())for(const o of i.values())r.push(o);return r}function AC(n,e){const{getInRadius:t,getOutRadius:r}=n.attributes;return Math.max(t.value[e],r.value[e])}function pD(n,e){const{getPosition:t}=n.attributes;return[t.value[e*2],t.value[e*2+1]]}function goe(n,e){const{getColor:t,getEndpointOffsets:r,getSourcePosition:i,getTargetPosition:o,getThickness:a,getStaggering:l}=n.attributes;return{length:1,attributes:{getColor:{value:t.value.subarray(e*4,(e+1)*4),size:4},getEndpointOffsets:{value:r.value.subarray(e*2,(e+1)*2),size:2},getSourcePosition:{value:i.value.subarray(e*2,(e+1)*2),size:2},getTargetPosition:{value:o.value.subarray(e*2,(e+1)*2),size:2},getThickness:{value:a.value.subarray(e,e+1),size:1},...l?{getStaggering:{value:l.value.subarray(e,e+1),size:1}}:void 0}}}var Q2=1e-6,cb=Math.PI,gD=cb/2,SU=cb/4,mD=cb*2,IC=180/cb,Qm=cb/180,HM=Math.abs,CU=Math.atan2,I0=Math.cos,P0=Math.sin,moe=Math.sqrt;function yoe(n){return n>1?gD:n<-1?-gD:Math.asin(n)}function V1(){}function kx(n,e){n&&_D.hasOwnProperty(n.type)&&_D[n.type](n,e)}var yD={Feature:function(n,e){kx(n.geometry,e)},FeatureCollection:function(n,e){for(var t=n.features,r=-1,i=t.length;++r<i;)kx(t[r].geometry,e)}},_D={Sphere:function(n,e){e.sphere()},Point:function(n,e){n=n.coordinates,e.point(n[0],n[1],n[2])},MultiPoint:function(n,e){for(var t=n.coordinates,r=-1,i=t.length;++r<i;)n=t[r],e.point(n[0],n[1],n[2])},LineString:function(n,e){J2(n.coordinates,e,0)},MultiLineString:function(n,e){for(var t=n.coordinates,r=-1,i=t.length;++r<i;)J2(t[r],e,0)},Polygon:function(n,e){vD(n.coordinates,e)},MultiPolygon:function(n,e){for(var t=n.coordinates,r=-1,i=t.length;++r<i;)vD(t[r],e)},GeometryCollection:function(n,e){for(var t=n.geometries,r=-1,i=t.length;++r<i;)kx(t[r],e)}};function J2(n,e,t){var r=-1,i=n.length-t,o;for(e.lineStart();++r<i;)o=n[r],e.point(o[0],o[1],o[2]);e.lineEnd()}function vD(n,e){var t=-1,r=n.length;for(e.polygonStart();++t<r;)J2(n[t],e,1);e.polygonEnd()}function _oe(n,e){n&&yD.hasOwnProperty(n.type)?yD[n.type](n,e):kx(n,e)}var Ox=new aT,bD=new aT,AU,IU,eI,tI,nI,xu={point:V1,lineStart:V1,lineEnd:V1,polygonStart:function(){Ox=new aT,xu.lineStart=voe,xu.lineEnd=boe},polygonEnd:function(){var n=+Ox;bD.add(n<0?mD+n:n),this.lineStart=this.lineEnd=this.point=V1},sphere:function(){bD.add(mD)}};function voe(){xu.point=woe}function boe(){PU(AU,IU)}function woe(n,e){xu.point=PU,AU=n,IU=e,n*=Qm,e*=Qm,eI=n,tI=I0(e=e/2+SU),nI=P0(e)}function PU(n,e){n*=Qm,e*=Qm,e=e/2+SU;var t=n-eI,r=t>=0?1:-1,i=r*t,o=I0(e),a=P0(e),l=nI*a,h=tI*o+l*I0(i),p=l*r*P0(i);Ox.add(CU(p,h)),eI=n,tI=o,nI=a}function xoe(n){return[CU(n[1],n[0]),yoe(n[2])]}function Eoe(n){var e=n[0],t=n[1],r=I0(t);return[r*I0(e),r*P0(e),P0(t)]}function wD(n,e){return[n[1]*e[2]-n[2]*e[1],n[2]*e[0]-n[0]*e[2],n[0]*e[1]-n[1]*e[0]]}function Toe(n){var e=moe(n[0]*n[0]+n[1]*n[1]+n[2]*n[2]);n[0]/=e,n[1]/=e,n[2]/=e}var Ui,es,Wi,ks,tf,MU,RU,xm,Gv,Ih,Eu,ru={point:rI,lineStart:xD,lineEnd:ED,polygonStart:function(){ru.point=OU,ru.lineStart=Soe,ru.lineEnd=Coe,Gv=new aT,xu.polygonStart()},polygonEnd:function(){xu.polygonEnd(),ru.point=rI,ru.lineStart=xD,ru.lineEnd=ED,Ox<0?(Ui=-(Wi=180),es=-(ks=90)):Gv>Q2?ks=90:Gv<-Q2&&(es=-90),Eu[0]=Ui,Eu[1]=Wi},sphere:function(){Ui=-(Wi=180),es=-(ks=90)}};function rI(n,e){Ih.push(Eu=[Ui=n,Wi=n]),e<es&&(es=e),e>ks&&(ks=e)}function kU(n,e){var t=Eoe([n*Qm,e*Qm]);if(xm){var r=wD(xm,t),i=[r[1],-r[0],0],o=wD(i,r);Toe(o),o=xoe(o);var a=n-tf,l=a>0?1:-1,h=o[0]*IC*l,p,g=HM(a)>180;g^(l*tf<h&&h<l*n)?(p=o[1]*IC,p>ks&&(ks=p)):(h=(h+360)%360-180,g^(l*tf<h&&h<l*n)?(p=-o[1]*IC,p<es&&(es=p)):(e<es&&(es=e),e>ks&&(ks=e))),g?n<tf?Is(Ui,n)>Is(Ui,Wi)&&(Wi=n):Is(n,Wi)>Is(Ui,Wi)&&(Ui=n):Wi>=Ui?(n<Ui&&(Ui=n),n>Wi&&(Wi=n)):n>tf?Is(Ui,n)>Is(Ui,Wi)&&(Wi=n):Is(n,Wi)>Is(Ui,Wi)&&(Ui=n)}else Ih.push(Eu=[Ui=n,Wi=n]);e<es&&(es=e),e>ks&&(ks=e),xm=t,tf=n}function xD(){ru.point=kU}function ED(){Eu[0]=Ui,Eu[1]=Wi,ru.point=rI,xm=null}function OU(n,e){if(xm){var t=n-tf;Gv.add(HM(t)>180?t+(t>0?360:-360):t)}else MU=n,RU=e;xu.point(n,e),kU(n,e)}function Soe(){xu.lineStart()}function Coe(){OU(MU,RU),xu.lineEnd(),HM(Gv)>Q2&&(Ui=-(Wi=180)),Eu[0]=Ui,Eu[1]=Wi,xm=null}function Is(n,e){return(e-=n)<0?e+360:e}function Aoe(n,e){return n[0]-e[0]}function TD(n,e){return n[0]<=n[1]?n[0]<=e&&e<=n[1]:e<n[0]||n[1]<e}function Ioe(n){var e,t,r,i,o,a,l;if(ks=Wi=-(Ui=es=1/0),Ih=[],_oe(n,ru),t=Ih.length){for(Ih.sort(Aoe),e=1,r=Ih[0],o=[r];e<t;++e)i=Ih[e],TD(r,i[0])||TD(r,i[1])?(Is(r[0],i[1])>Is(r[0],r[1])&&(r[1]=i[1]),Is(i[0],r[1])>Is(r[0],r[1])&&(r[0]=i[0])):o.push(r=i);for(a=-1/0,t=o.length-1,e=0,r=o[t];e<=t;r=i,++e)i=o[e],(l=Is(r[1],i[0]))>a&&(a=l,Ui=i[0],Wi=r[1])}return Ih=Eu=null,Ui===1/0||es===1/0?[[NaN,NaN],[NaN,NaN]]:[[Ui,es],[Wi,ks]]}function Poe(n,e,t){const{pad:r=.05,maxZoom:i=100}=t||{},o=Ioe(n),[[a,l],[h,p]]=o,g=r?[[a-r*(h-a),l-r*(p-l)],[h+r*(h-a),p+r*(p-l)]]:o,[_,x]=e;return{...fM({width:_,height:x,bounds:g,padding:t==null?void 0:t.padding,maxZoom:i}),width:_,height:x,bearing:0,pitch:0}}function LU(n,e,t,r){const i=a=>({type:"Point",coordinates:e(a)});let o;if(Array.isArray(n))o=n.map(i);else{o=[];for(const a of n)o.push(i(a))}return Poe({type:"GeometryCollection",geometries:o},t,r)}function Moe(n){return n&&n.locations&&n.flows}function Roe(n){return n&&typeof n.setFlowmapState=="function"&&typeof n.getViewportForLocations=="function"&&typeof n.getFlowByIndex=="function"&&typeof n.getLocationById=="function"&&typeof n.getLocationByIndex=="function"&&typeof n.getLayersData=="function"}class koe{constructor(e){this.selectors=new foe(e),this.flowmapData=void 0,this.flowmapState=void 0}setAccessors(e){this.selectors.setAccessors(e)}setFlowmapData(e){this.flowmapData=e}getSelectors(){return this.selectors}getFlowmapData(){return this.flowmapData}async setFlowmapState(e){this.flowmapState=e}getFlowmapState(){return this.flowmapState}async getFlowByIndex(e){if(!this.flowmapState||!this.flowmapData)return;const t=this.selectors.getFlowsForFlowmapLayer(this.flowmapState,this.flowmapData);return t==null?void 0:t[e]}async getLocationByIndex(e){if(!this.flowmapState||!this.flowmapData)return;const t=this.selectors.getLocationsForFlowmapLayer(this.flowmapState,this.flowmapData);return t==null?void 0:t[e]}async getLayersData(){if(!(!this.flowmapState||!this.flowmapData))return this.selectors.getLayersData(this.flowmapState,this.flowmapData)}async getLocationById(e){if(!this.flowmapState||!this.flowmapData)return;const t=this.selectors.getClusterIndex(this.flowmapState,this.flowmapData);if(t){const i=t.getClusterById(e);if(i)return i}const r=this.selectors.getLocationsById(this.flowmapState,this.flowmapData);return r==null?void 0:r.get(e)}async getTotalsForLocation(e){var t;if(!(!this.flowmapState||!this.flowmapData))return(t=this.selectors.getLocationTotals(this.flowmapState,this.flowmapData))==null?void 0:t.get(e)}async getViewportForLocations(e,t){var r;if((r=this.flowmapData)!=null&&r.locations)return LU(this.flowmapData.locations,i=>[this.selectors.accessors.getLocationLon(i),this.selectors.accessors.getLocationLat(i)],e,t)}async updateLayersData(e){e(await this.getLayersData())}getClusterZoom(){return this.flowmapState&&this.flowmapData?this.selectors.getClusterZoom(this.flowmapState,this.flowmapData):void 0}getClusterIndex(){return this.flowmapState&&this.flowmapData?this.selectors.getClusterIndex(this.flowmapState,this.flowmapData):void 0}getLocationsById(){return this.flowmapState&&this.flowmapData?this.selectors.getLocationsById(this.flowmapState,this.flowmapData):void 0}getLocationTotals(){return this.flowmapState&&this.flowmapData?this.selectors.getLocationTotals(this.flowmapState,this.flowmapData):void 0}getFlowsForFlowmapLayer(){return this.flowmapState&&this.flowmapData?this.selectors.getFlowsForFlowmapLayer(this.flowmapState,this.flowmapData):void 0}}var Jm;(function(n){n.LOCATION="location",n.FLOW="flow"})(Jm||(Jm={}));const Ooe=["filter","locationsEnabled","locationTotalsEnabled","locationLabelsEnabled","adaptiveScalesEnabled","animationEnabled","clusteringEnabled","clusteringLevel","fadeEnabled","fadeOpacityEnabled","clusteringAuto","darkMode","fadeAmount","colorScheme","highlightColor","maxTopFlowsDisplayNum"];var tm;(function(n){n.LOCATION="location",n.FLOW="flow"})(tm||(tm={}));class NU extends xM{constructor(e){super({...e,onHover:(t,r)=>{const i=Date.now();this.setState({highlightedObject:this._getHighlightedObject(t),lastHoverTime:i});const{onHover:o}=e;o&&this._getFlowmapLayerPickingInfo(t).then(a=>{var l;(((l=this.state)==null?void 0:l.lastHoverTime)??0)<=i&&(this.setState({pickingInfo:a}),o(a,r))})},onClick:(t,r)=>{const{onClick:i}=e,o=Date.now();this.setState({lastClickTime:o}),i&&this._getFlowmapLayerPickingInfo(t).then(a=>{var l;(((l=this.state)==null?void 0:l.lastClickTime)??0)<=o&&(this.setState({pickingInfo:a}),a&&i(a,r))})}})}initializeState(){this.state={accessors:new X2(this.props),dataProvider:this._getOrMakeDataProvider(),layersData:void 0,highlightedObject:void 0,pickingInfo:void 0,lastHoverTime:void 0,lastClickTime:void 0}}getPickingInfo({info:e}){var t,r;if(!e.object){const i=(r=(t=this.state)==null?void 0:t.pickingInfo)==null?void 0:r.object;if(i)return{...e,object:i,picked:!0}}return e}_getOrMakeDataProvider(){const{data:e,dataProvider:t}=this.props;if(Roe(t))return t;if(Moe(e)){const r=new koe(this.props);return r.setFlowmapData(e),r}throw new Error("FlowmapLayer: data must be a FlowmapDataProvider or FlowmapData")}_updateDataProvider(){this.setState({dataProvider:this._getOrMakeDataProvider()})}shouldUpdateState(e){const{changeFlags:t}=e;return t.viewportChanged?!0:super.shouldUpdateState(e)}updateState({oldProps:e,props:t,changeFlags:r}){if(r.propsChanged,r.dataChanged&&this._updateDataProvider(),(r.viewportChanged||r.dataChanged)&&this.setState({highlightedObject:void 0}),r.viewportChanged||r.dataChanged||r.propsChanged&&Ooe.some(i=>e[i]!==t[i])){const{dataProvider:i}=this.state||{};i&&(i.setFlowmapState(this._getFlowmapState()),i.updateLayersData(o=>{this.setState({layersData:o,highlightedObject:void 0})},r))}}_getSettingsState(){const{locationsEnabled:e,locationTotalsEnabled:t,locationLabelsEnabled:r,adaptiveScalesEnabled:i,animationEnabled:o,clusteringEnabled:a,clusteringLevel:l,fadeEnabled:h,fadeOpacityEnabled:p,clusteringAuto:g,darkMode:_,fadeAmount:x,colorScheme:C,highlightColor:M,maxTopFlowsDisplayNum:L}=this.props;return{locationsEnabled:e,locationTotalsEnabled:t,locationLabelsEnabled:r,adaptiveScalesEnabled:i,animationEnabled:o,clusteringEnabled:a,clusteringLevel:l,fadeEnabled:h,fadeOpacityEnabled:p,clusteringAuto:g,darkMode:_,fadeAmount:x,colorScheme:C,highlightColor:M,maxTopFlowsDisplayNum:L}}_getFlowmapState(){return{viewport:Loe(this.context.viewport),filter:this.props.filter,settings:this._getSettingsState()}}async _getFlowmapLayerPickingInfo(e){var l;const{index:t,sourceLayer:r}=e,{dataProvider:i,accessors:o}=this.state||{};if(!i||!o)return;const a={...e,picked:e.picked,layer:e.layer,index:e.index,x:e.x,y:e.y,coordinate:e.coordinate,event:e.event};if(r instanceof Jg||r instanceof Lw){const h=t===-1?void 0:await i.getFlowByIndex(t);if(h){const p=await i.getLocationById(o.getFlowOriginId(h)),g=await i.getLocationById(o.getFlowDestId(h));if(p&&g)return{...a,object:{type:Jm.FLOW,flow:h,origin:p,dest:g,count:o.getFlowMagnitude(h)}}}}else if(r instanceof jv){const h=t===-1?void 0:await i.getLocationByIndex(t);if(h){const p=o.getLocationId(h),g=o.getLocationName(h),_=await i.getTotalsForLocation(p),{circleAttributes:x}=((l=this.state)==null?void 0:l.layersData)||{};if(_&&x){const C=AC(x,e.index);return{...a,object:{type:Jm.LOCATION,location:h,id:p,name:g,totals:_,circleRadius:C}}}}}}_getHighlightedObject(e){var i,o;const{index:t,sourceLayer:r}=e;if(!(t<0)){if(r instanceof Jg||r instanceof Lw){const{lineAttributes:a}=((i=this.state)==null?void 0:i.layersData)||{};if(a){let l=goe(a,t);return this.props.fadeOpacityEnabled&&(l={...l,attributes:{...l.attributes,getColor:{...l.attributes.getColor,value:new Uint8Array([...l.attributes.getColor.value.slice(0,3),255])}}}),{type:tm.FLOW,lineAttributes:l}}}else if(r instanceof jv){const{circleAttributes:a}=((o=this.state)==null?void 0:o.layersData)||{};if(a)return{type:tm.LOCATION,coords:pD(a,t),radius:AC(a,t)}}}}renderLayers(){var t;const e=[];if((t=this.state)!=null&&t.layersData){const{layersData:r,highlightedObject:i}=this.state,{circleAttributes:o,lineAttributes:a,locationLabels:l}=r||{};if(o&&a){const h=fie(this._getSettingsState()),p=_l(h.outlineColor||(this.props.darkMode?"#000":"#fff")),g={data:a,parameters:{...this.props.parameters,depthTest:!1}};if(this.props.animationEnabled?e.push(new Lw({...this.getSubLayerProps({...g,id:"animated-flow-lines",drawOutline:!1,thicknessUnit:20})})):e.push(new Jg({...this.getSubLayerProps({...g,id:"flow-lines",drawOutline:!0,outlineColor:p})})),e.push(new jv(this.getSubLayerProps({id:"circles",data:o,emptyColor:this.props.darkMode?[0,0,0,255]:[255,255,255,255],outlineEmptyMix:.4}))),i)switch(i.type){case tm.LOCATION:e.push(new TM({...this.getSubLayerProps({id:"location-highlight",data:[i],pickable:!1,antialiasing:!0,stroked:!0,filled:!1,lineWidthUnits:"pixels",getLineWidth:2,radiusUnits:"pixels",getRadius:_=>_.radius,getLineColor:_l(this.props.highlightColor),getPosition:_=>_.coords})}));break;case tm.FLOW:e.push(new Jg({...this.getSubLayerProps({id:"flow-highlight",data:i.lineAttributes,drawOutline:!0,pickable:!1,outlineColor:_l(this.props.highlightColor),outlineThickness:1,parameters:{depthTest:!1}})}));break}}l&&e.push(new AM(this.getSubLayerProps({id:"location-labels",data:l,maxWidth:1e3,pickable:!1,fontFamily:"Helvetica",getPixelOffset:(h,{index:p})=>[0,AC(o,p)+5],getPosition:(h,{index:p})=>pD(o,p),getText:h=>h,getSize:10,getColor:[255,255,255,255],getAngle:0,getTextAnchor:"middle",getAlignmentBaseline:"top"})))}return e}}NU.defaultProps={darkMode:!0,fadeAmount:50,locationsEnabled:!0,locationTotalsEnabled:!0,locationLabelsEnabled:!1,animationEnabled:!1,clusteringEnabled:!0,fadeEnabled:!0,fadeOpacityEnabled:!1,clusteringAuto:!0,clusteringLevel:void 0,adaptiveScalesEnabled:!0,colorScheme:"Teal",highlightColor:"orange",maxTopFlowsDisplayNum:5e3};function Loe(n){const{width:e,height:t,longitude:r,latitude:i,zoom:o,pitch:a,bearing:l}=n;return{width:e,height:t,longitude:r,latitude:i,zoom:o,pitch:a,bearing:l}}var SD={},PC={},MC=34,N_=10,RC=13;function DU(n){return new Function("d","return {"+n.map(function(e,t){return JSON.stringify(e)+": d["+t+'] || ""'}).join(",")+"}")}function Noe(n,e){var t=DU(n);return function(r,i){return e(t(r),i,n)}}function CD(n){var e=Object.create(null),t=[];return n.forEach(function(r){for(var i in r)i in e||t.push(e[i]=i)}),t}function Za(n,e){var t=n+"",r=t.length;return r<e?new Array(e-r+1).join(0)+t:t}function Doe(n){return n<0?"-"+Za(-n,6):n>9999?"+"+Za(n,6):Za(n,4)}function Foe(n){var e=n.getUTCHours(),t=n.getUTCMinutes(),r=n.getUTCSeconds(),i=n.getUTCMilliseconds();return isNaN(n)?"Invalid Date":Doe(n.getUTCFullYear())+"-"+Za(n.getUTCMonth()+1,2)+"-"+Za(n.getUTCDate(),2)+(i?"T"+Za(e,2)+":"+Za(t,2)+":"+Za(r,2)+"."+Za(i,3)+"Z":r?"T"+Za(e,2)+":"+Za(t,2)+":"+Za(r,2)+"Z":t||e?"T"+Za(e,2)+":"+Za(t,2)+"Z":"")}function Boe(n){var e=new RegExp('["'+n+`
\r]`),t=n.charCodeAt(0);function r(_,x){var C,M,L=i(_,function(D,z){if(C)return C(D,z-1);M=D,C=x?Noe(D,x):DU(D)});return L.columns=M||[],L}function i(_,x){var C=[],M=_.length,L=0,D=0,z,te=M<=0,le=!1;_.charCodeAt(M-1)===N_&&--M,_.charCodeAt(M-1)===RC&&--M;function ce(){if(te)return PC;if(le)return le=!1,SD;var J,pe=L,ue;if(_.charCodeAt(pe)===MC){for(;L++<M&&_.charCodeAt(L)!==MC||_.charCodeAt(++L)===MC;);return(J=L)>=M?te=!0:(ue=_.charCodeAt(L++))===N_?le=!0:ue===RC&&(le=!0,_.charCodeAt(L)===N_&&++L),_.slice(pe+1,J-1).replace(/""/g,'"')}for(;L<M;){if((ue=_.charCodeAt(J=L++))===N_)le=!0;else if(ue===RC)le=!0,_.charCodeAt(L)===N_&&++L;else if(ue!==t)continue;return _.slice(pe,J)}return te=!0,_.slice(pe,M)}for(;(z=ce())!==PC;){for(var _e=[];z!==SD&&z!==PC;)_e.push(z),z=ce();x&&(_e=x(_e,D++))==null||C.push(_e)}return C}function o(_,x){return _.map(function(C){return x.map(function(M){return g(C[M])}).join(n)})}function a(_,x){return x==null&&(x=CD(_)),[x.map(g).join(n)].concat(o(_,x)).join(`
`)}function l(_,x){return x==null&&(x=CD(_)),o(_,x).join(`
`)}function h(_){return _.map(p).join(`
`)}function p(_){return _.map(g).join(n)}function g(_){return _==null?"":_ instanceof Date?Foe(_):e.test(_+="")?'"'+_.replace(/"/g,'""')+'"':_}return{parse:r,parseRows:i,format:a,formatBody:l,formatRows:h,formatRow:p,formatValue:g}}var Uoe=Boe(","),zoe=Uoe.parse;function joe(n){if(!n.ok)throw new Error(n.status+" "+n.statusText);return n.text()}function Voe(n,e){return fetch(n,e).then(joe)}function Hoe(n){return function(e,t,r){return arguments.length===2&&typeof t=="function"&&(r=t,t=void 0),Voe(e,t).then(function(i){return n(i,r)})}}var AD=Hoe(zoe);/*!
MICROSOFT SOFTWARE LICENSE TERMS
MICROSOFT AZURE MAPS WEB SDK
These license terms are an agreement between you and Microsoft Corporation (or one of its affiliates). They apply to the software named above and any Microsoft services or software updates (except to the extent such services or updates are accompanied by new or additional terms, in which case those different terms apply prospectively and do not alter your or Microsofts rights relating to pre-updated software or services). IF YOU COMPLY WITH THESE LICENSE TERMS, YOU HAVE THE RIGHTS BELOW.  BY USING THE SOFTWARE, YOU ACCEPT THESE TERMS.
1. INSTALLATION AND USE RIGHTS.
  a) General. You may install and use any number of copies of the software to develop and test your applications.
  b) User Region Parameters. The software will allow you to select from a View list to set the map view within your application for a given customer. By default the View parameter (also referred to as user region parameter is set to Unified.  Countries/Regions that are not on the View list will default to the Unified View. It is your responsibility to determine the location of your users, and then set the View parameter correctly for that location. The View parameter must be used in compliance with applicable laws, including those regarding mapping, of the country where maps, images and other data and third party content that You are authorized to access via the software is made available. 
  c) Third Party Software. The software may include third party applications that Microsoft, not the third party, licenses to you under this agreement. Any included notices for third party applications are for your information only.
  d) Microsoft Online Subscription Agreement. Some features of the software provide access to, or rely on, Microsoft Azure Services. The use of those services (but not the software) is governed by the separate terms and privacy policies associated with your Microsoft Azure subscription. The services may not be available in all regions. For more information see https://go.microsoft.com/fwLink/?LinkID=522330&amp;clcid=0x9.
2. DISTRIBUTABLE CODE. The software is comprised of Distributable Code. Distributable Code is code that you are permitted to distribute in applications you develop if you comply with the terms below and otherwise set forth in these license terms. 
  a) Distribution Rights. 
    i. You may copy and distribute the object code form of the software.
    i. Third Party Distribution. You may permit distributors of your applications to copy and distribute any of this distributable code you elect to distribute with your applications.
  b) Distribution Requirements. For any code you distribute, you must:
    i. add significant primary functionality to it in your applications;
    ii. require distributors and external end users to agree to terms that protect it and Microsoft at least as much as this agreement; and
    iii. indemnify, defend, and hold harmless Microsoft from any claims, including attorneys fees, related to the distribution or use of your applications, except to the extent that any claim is based solely on the unmodified distributable code.
  c) Distribution Restrictions. You may not:
    i. use Microsofts trademarks or trade dress in your application in any way that suggests your application comes from or is endorsed by Microsoft; or
    ii. modify or distribute the source code of any distributable code so that any part of it becomes subject to any license that requires that the distributable code, any other part of the software, or any of Microsofts other intellectual property be disclosed or distributed in source code form, or that others have the right to modify it.
3. DATA COLLECTION. The software may collect information about you and your use of the software and send that to Microsoft. Microsoft may use this information to provide services and improve Microsofts products and services. Your opt-out rights, if any, are described in the product documentation. Some features in the software may enable collection of data from users of your applications that access or use the software. If you use these features to enable data collection in your applications, you must comply with applicable law, including getting any required user consent, and maintain a prominent privacy policy that accurately informs users about how you use, collect, and share their data. You can learn more about Microsofts data collection and use in the product documentation and the Microsoft Privacy Statement at https://go.microsoft.com/fwlink/?LinkId=512132. You agree to comply with all applicable provisions of the Microsoft Privacy Statement.
4. SCOPE OF LICENSE. The software is licensed, not sold. Microsoft reserves all other rights. Unless applicable law gives you more rights despite this limitation, you will not (and have no right to):
  a) work around any technical limitations in the software that only allow you to use it in certain ways;
  b) reverse engineer, decompile, or disassemble the software, or attempt to do so, except and only to the extent permitted by licensing terms governing the use of open-source components that may be included with the software;
  c) remove, minimize, block, or modify any notices of Microsoft or its suppliers in the software;
  d) use the software in any way that is against the law or to create or propagate malware; or
  e) share, publish, distribute, or lend the software (except for any distributable code, subject to the terms above), provide the software as a stand-alone hosted solution for others to use, or transfer the software or this agreement to any third party.
5. EXPORT RESTRICTIONS. You must comply with all domestic and international export laws and regulations that apply to the software, which include restrictions on destinations, end users, and end use. For further information on export restrictions, visit http://aka.ms/exporting.
6. SUPPORT SERVICES. Microsoft is not obligated under this agreement to provide any support services for the software. Any support provided is as is, with all faults, and without warranty of any kind.
7. UPDATES. The software may periodically check for updates, and download and install them for you. You may obtain updates only from Microsoft or authorized sources. Microsoft may need to update your system to provide you with updates. You agree to receive these automatic updates without any additional notice. Updates may not include or support all existing software features, services, or peripheral devices.
8. ENTIRE AGREEMENT. This agreement, and any other terms Microsoft may provide for supplements, updates, or third-party applications, is the entire agreement for the software.
9. APPLICABLE LAW AND PLACE TO RESOLVE DISPUTES. If you acquired the software in the United States or Canada, the laws of the state or province where you live (or, if a business, where your principal place of business is located) govern the interpretation of this agreement, claims for its breach, and all other claims (including consumer protection, unfair competition, and tort claims), regardless of conflict of laws principles. If you acquired the software in any other country, its laws apply. If U.S. federal jurisdiction exists, you and Microsoft consent to exclusive jurisdiction and venue in the federal court in King County, Washington for all disputes heard in court. If not, you and Microsoft consent to exclusive jurisdiction and venue in the Superior Court of King County, Washington for all disputes heard in court.
10. CONSUMER RIGHTS; REGIONAL VARIATIONS. This agreement describes certain legal rights. You may have other rights, including consumer rights, under the laws of your state or country. Separate and apart from your relationship with Microsoft, you may also have rights with respect to the party from which you acquired the software. This agreement does not change those other rights if the laws of your state or country do not permit it to do so. For example, if you acquired the software in one of the below regions, or mandatory country law applies, then the following provisions apply to you:
  a) Australia. You have statutory guarantees under the Australian Consumer Law and nothing in this agreement is intended to affect those rights.
  b) Canada. If you acquired this software in Canada, you may stop receiving updates by turning off the automatic update feature, disconnecting your device from the Internet (if and when you re-connect to the Internet, however, the software will resume checking for and installing updates), or uninstalling the software. The product documentation, if any, may also specify how to turn off updates for your specific device or software.
  c) Germany and Austria.
    i. Warranty. The properly licensed software will perform substantially as described in any Microsoft materials that accompany the software. However, Microsoft gives no contractual guarantee in relation to the licensed software.
    ii. Limitation of Liability. In case of intentional conduct, gross negligence, claims based on the Product Liability Act, as well as, in case of death or personal or physical injury, Microsoft is liable according to the statutory law.
  Subject to the foregoing clause ii., Microsoft will only be liable for slight negligence if Microsoft is in breach of such material contractual obligations, the fulfillment of which facilitate the due performance of this agreement, the breach of which would endanger the purpose of this agreement and the compliance with which a party may constantly trust in (so-called "cardinal obligations"). In other cases of slight negligence, Microsoft will not be liable for slight negligence.
11. DISCLAIMER OF WARRANTY. THE SOFTWARE IS LICENSED AS IS. YOU BEAR THE RISK OF USING IT. MICROSOFT GIVES NO EXPRESS WARRANTIES, GUARANTEES, OR CONDITIONS. TO THE EXTENT PERMITTED UNDER APPLICABLE LAWS, MICROSOFT EXCLUDES ALL IMPLIED WARRANTIES, INCLUDING MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE, AND NON-INFRINGEMENT.
12. LIMITATION ON AND EXCLUSION OF DAMAGES. IF YOU HAVE ANY BASIS FOR RECOVERING DAMAGES DESPITE THE PRECEDING DISCLAIMER OF WARRANTY, YOU CAN RECOVER FROM MICROSOFT AND ITS SUPPLIERS ONLY DIRECT DAMAGES UP TO U.S. $5.00. YOU CANNOT RECOVER ANY OTHER DAMAGES, INCLUDING CONSEQUENTIAL, LOST PROFITS, SPECIAL, INDIRECT, OR INCIDENTAL DAMAGES.
This limitation applies to (a) anything related to the software, services, content (including code) on third party Internet sites, or third party applications; and (b) claims for breach of contract, warranty, guarantee, or condition; strict liability, negligence, or other tort; or any other claim; in each case to the extent permitted by applicable law.
It also applies even if Microsoft knew or should have known about the possibility of the damages. The above limitation or exclusion may not apply to you because your state, province, or country may not allow the exclusion or limitation of incidental, consequential, or other damages.
Please note: As this software is distributed in Canada, some of the clauses in this agreement are provided below in French.
Remarque: Ce logiciel tant distribu au Canada, certaines des clauses dans ce contrat sont fournies ci-dessous en franais.
EXONRATION DE GARANTIE. Le logiciel vis par une licence est offert  tel quel . Toute utilisation de ce logiciel est  votre seule risque et pril. Microsoft naccorde aucune autre garantie expresse. Vous pouvez bnficier de droits additionnels en vertu du droit local sur la protection des consommateurs, que ce contrat ne peut modifier. La ou elles sont permises par le droit locale, les garanties implicites de qualit marchande, dadquation  un usage particulier et dabsence de contrefaon sont exclues.
LIMITATION DES DOMMAGES-INTRTS ET EXCLUSION DE RESPONSABILIT POUR LES DOMMAGES. Vous pouvez obtenir de Microsoft et de ses fournisseurs une indemnisation en cas de dommages directs uniquement  hauteur de 5,00 $ US. Vous ne pouvez prtendre  aucune indemnisation pour les autres dommages, y compris les dommages spciaux, indirects ou accessoires et pertes de bnfices.
Cette limitation concerne:
 tout ce qui est reli au logiciel, aux services ou au contenu (y compris le code) figurant sur des sites Internet tiers ou dans des programmes tiers; et
 les rclamations au titre de violation de contrat ou de garantie, ou au titre de responsabilit stricte, de ngligence ou dune autre faute dans la limite autorise par la loi en vigueur.
Elle sapplique galement, mme si Microsoft connaissait ou devrait connatre lventualit dun tel dommage. Si votre pays nautorise pas lexclusion ou la limitation de responsabilit pour les dommages indirects, accessoires ou de quelque nature que ce soit, il se peut que la limitation ou lexclusion ci-dessus ne sappliquera pas  votre gard.
EFFET JURIDIQUE. Le prsent contrat dcrit certains droits juridiques. Vous pourriez avoir dautres droits prvus par les lois de votre pays. Le prsent contrat ne modifie pas les droits que vous confrent les lois de votre pays si celles-ci ne le permettent pas.
*/var H1=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function dd(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}function Goe(n){var e,t;return n.__esModule?n:(typeof(e=n.default)=="function"?(t=function r(){return this instanceof r?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)}).prototype=e.prototype:t={},Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(n).forEach(function(r){var i=Object.getOwnPropertyDescriptor(n,r);Object.defineProperty(t,r,i.get?i:{enumerable:!0,get:function(){return n[r]}})}),t)}var ID={exports:{}},qoe=(function(){var n;n=function(){var e={},t={};function r(i,o,a){t[i]=a,i==="index"&&(a="var sharedModule = {}; ("+t.shared+")(sharedModule); ("+t.worker+")(sharedModule);",t.shared(i={}),t.index(e,i),typeof window<"u")&&e.setWorkerUrl(window.URL.createObjectURL(new Blob([a],{type:"text/javascript"})))}return r("shared",0,function(i){function o(u,c,d,m){return new(d=d||Promise)(function(b,E){function S(O){try{I(m.next(O))}catch(k){E(k)}}function A(O){try{I(m.throw(O))}catch(k){E(k)}}function I(O){var k;O.done?b(O.value):((k=O.value)instanceof d?k:new d(function(U){U(k)})).then(S,A)}I((m=m.apply(u,c||[])).next())})}function a(u){return u&&u.__esModule&&Object.prototype.hasOwnProperty.call(u,"default")?u.default:u}var l=h;function h(u,c){this.x=u,this.y=c}h.prototype={clone:function(){return new h(this.x,this.y)},add:function(u){return this.clone()._add(u)},sub:function(u){return this.clone()._sub(u)},multByPoint:function(u){return this.clone()._multByPoint(u)},divByPoint:function(u){return this.clone()._divByPoint(u)},mult:function(u){return this.clone()._mult(u)},div:function(u){return this.clone()._div(u)},rotate:function(u){return this.clone()._rotate(u)},rotateAround:function(u,c){return this.clone()._rotateAround(u,c)},matMult:function(u){return this.clone()._matMult(u)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(u){return this.x===u.x&&this.y===u.y},dist:function(u){return Math.sqrt(this.distSqr(u))},distSqr:function(d){var c=d.x-this.x,d=d.y-this.y;return c*c+d*d},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(u){return Math.atan2(this.y-u.y,this.x-u.x)},angleWith:function(u){return this.angleWithSep(u.x,u.y)},angleWithSep:function(u,c){return Math.atan2(this.x*c-this.y*u,this.x*u+this.y*c)},_matMult:function(d){var c=d[0]*this.x+d[1]*this.y,d=d[2]*this.x+d[3]*this.y;return this.x=c,this.y=d,this},_add:function(u){return this.x+=u.x,this.y+=u.y,this},_sub:function(u){return this.x-=u.x,this.y-=u.y,this},_mult:function(u){return this.x*=u,this.y*=u,this},_div:function(u){return this.x/=u,this.y/=u,this},_multByPoint:function(u){return this.x*=u.x,this.y*=u.y,this},_divByPoint:function(u){return this.x/=u.x,this.y/=u.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var u=this.y;return this.y=this.x,this.x=-u,this},_rotate:function(m){var c=Math.cos(m),m=Math.sin(m),d=c*this.x-m*this.y,m=m*this.x+c*this.y;return this.x=d,this.y=m,this},_rotateAround:function(b,c){var d=Math.cos(b),b=Math.sin(b),m=c.x+d*(this.x-c.x)-b*(this.y-c.y),b=c.y+b*(this.x-c.x)+d*(this.y-c.y);return this.x=m,this.y=b,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},h.convert=function(u){return!(u instanceof h)&&Array.isArray(u)?new h(u[0],u[1]):u};var p=a(l),g=_;function _(u,c,d,m){this.cx=3*u,this.bx=3*(d-u)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*c,this.by=3*(m-c)-this.cy,this.ay=1-this.cy-this.by,this.p1x=u,this.p1y=c,this.p2x=d,this.p2y=m}_.prototype={sampleCurveX:function(u){return((this.ax*u+this.bx)*u+this.cx)*u},sampleCurveY:function(u){return((this.ay*u+this.by)*u+this.cy)*u},sampleCurveDerivativeX:function(u){return(3*this.ax*u+2*this.bx)*u+this.cx},solveCurveX:function(u,c){if(c===void 0&&(c=1e-6),u<0)return 0;if(1<u)return 1;for(var d=u,m=0;m<8;m++){var b=this.sampleCurveX(d)-u;if(Math.abs(b)<c)return d;var E=this.sampleCurveDerivativeX(d);if(Math.abs(E)<1e-6)break;d-=b/E}for(var S=0,A=1,d=u,m=0;m<20&&(b=this.sampleCurveX(d),!(Math.abs(b-u)<c));m++)b<u?S=d:A=d,d=.5*(A-S)+S;return d},solve:function(u,c){return this.sampleCurveY(this.solveCurveX(u,c))}};var x=a(g);let C;function M(){return C=C??(typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function")}let L;function D(){if(L==null&&(L=!1,M())){var u=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(u){for(let m=0;m<25;m++){var c=4*m;u.fillStyle=`rgb(${c},${1+c},${2+c})`,u.fillRect(m%5,Math.floor(m/5),1,1)}var d=u.getImageData(0,0,5,5).data;for(let m=0;m<100;m++)if(m%4!=3&&d[m]!==m){L=!0;break}}}return L||!1}function z(u){var c,d;return u<=0?0:1<=u?1:(d=(c=u*u)*u,4*(u<.5?d:3*(u-c)+d-.75))}function te(u,c,d,m){const b=new x(u,c,d,m);return function(E){return b.solve(E)}}g=te(.25,.1,.25,1);function le(u,c,d){return Math.min(d,Math.max(c,u))}function ce(b,c,d){var m=d-c,b=((b-c)%m+m)%m+c;return b===c?d:b}function _e(u,...c){for(const d of c)for(const m in d)u[m]=d[m];return u}let J=1;function pe(u,c,d){var m={};for(const b in u)m[b]=c.call(d||this,u[b],b,u);return m}function ue(u,c,d){var m={};for(const b in u)c.call(d||this,u[b],b,u)&&(m[b]=u[b]);return m}function xe(u){return Array.isArray(u)?u.map(xe):typeof u=="object"&&u?pe(u,xe):u}function je(u,c){for(let d=0;d<u.length;d++)if(0<=c.indexOf(u[d]))return 1}const ne={};function Ee(u){ne[u]||(typeof console<"u"&&console.warn(u),ne[u]=!0)}function ke(u,c,d){return(d.y-u.y)*(c.x-u.x)>(c.y-u.y)*(d.x-u.x)}function Be(u){return typeof WorkerGlobalScope<"u"&&u!==void 0&&u instanceof WorkerGlobalScope}let Ze=null;function at(u){return typeof ImageBitmap<"u"&&u instanceof ImageBitmap}const Re="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function ht(u,c,d,m,b){return o(this,void 0,void 0,function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");var E,S,A,I,O,k,U,W,re,ie=new VideoFrame(u,{timestamp:0});try{var fe=ie==null?void 0:ie.format;if(!fe||!fe.startsWith("BGR")&&!fe.startsWith("RGB"))throw new Error("Unrecognized format "+fe);var we=fe.startsWith("BGR"),de=new Uint8ClampedArray(m*b*4);if(yield ie.copyTo(de,(E=u,S=c,A=d,I=m,O=b,k=4*Math.max(-S,0),k=(Math.max(0,A)-A)*I*4+k,U=4*I,W=Math.max(0,S),re=Math.max(0,A),{rect:{x:W,y:re,width:Math.min(E.width,S+I)-W,height:Math.min(E.height,A+O)-re},layout:[{offset:k,stride:U}]})),we)for(let Ve=0;Ve<de.length;Ve+=4){var Me=de[Ve];de[Ve]=de[Ve+2],de[Ve+2]=Me}return de}finally{ie.close()}})}let Rt,hn;function wt(u,c,d,m){return u.addEventListener(c,d,m),{unsubscribe:()=>{u.removeEventListener(c,d,m)}}}const Ge="AbortError";function Gn(){return new Error(Ge)}const Xt={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function ln(u){return Xt.REGISTERED_PROTOCOLS[u.substring(0,u.indexOf("://"))]}const Mn="global-dispatcher";class Ot extends Error{constructor(c,d,m,b){super(`AJAXError: ${d} (${c}): `+m),this.status=c,this.statusText=d,this.url=m,this.body=b}}const En=()=>Be(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,lt=u=>/^file:/.test(u)||/^file:/.test(En())&&!/^\w+:/.test(u);function It(u,c){if(/:\/\//.test(u.url)&&!/^https?:|^file:/.test(u.url)){var d=ln(u.url);if(d)return d(u,c);if(Be(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:u,targetMapId:Mn},c)}if(!lt(u.url)){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return function(E,S){return o(this,void 0,void 0,function*(){var A=new Request(E.url,{method:E.method||"GET",body:E.body,credentials:E.credentials,headers:E.headers,cache:E.cache,referrer:En(),signal:S.signal}),A=(E.type==="json"&&A.headers.set("Accept","application/json"),yield fetch(A));if(!A.ok)throw I=yield A.blob(),new Ot(A.status,A.statusText,E.url,I);var I=yield E.type==="arrayBuffer"||E.type==="image"?A.arrayBuffer():E.type==="json"?A.json():A.text();if(S.signal.aborted)throw Gn();return{data:I,cacheControl:A.headers.get("Cache-Control"),expires:A.headers.get("Expires")}})}(u,c);if(Be(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:u,mustQueue:!0,targetMapId:Mn},c)}return m=u,b=c,new Promise((E,S)=>{const A=new XMLHttpRequest;A.open(m.method||"GET",m.url,!0),m.type!=="arrayBuffer"&&m.type!=="image"||(A.responseType="arraybuffer");for(const I in m.headers)A.setRequestHeader(I,m.headers[I]);m.type==="json"&&(A.responseType="text",A.setRequestHeader("Accept","application/json")),A.withCredentials=m.credentials==="include",A.onerror=()=>{S(new Error(A.statusText))},A.onload=()=>{if(!b.signal.aborted)if((200<=A.status&&A.status<300||A.status===0)&&A.response!==null){let O=A.response;if(m.type==="json")try{O=JSON.parse(A.response)}catch(k){return void S(k)}E({data:O,cacheControl:A.getResponseHeader("Cache-Control"),expires:A.getResponseHeader("Expires")})}else{var I=new Blob([A.response],{type:A.getResponseHeader("Content-Type")});S(new Ot(A.status,A.statusText,m.url,I))}},b.signal.addEventListener("abort",()=>{A.abort(),S(Gn())}),A.send(m.body)});var m,b}function he(u){var c;return!u||u.indexOf("://")<=0||u.indexOf("data:image/")===0||u.indexOf("blob:")===0||(u=new URL(u),c=window.location,u.protocol===c.protocol&&u.host===c.host)}function B(u,c,d){d[u]&&d[u].indexOf(c)!==-1||(d[u]=d[u]||[],d[u].push(c))}function H(u,c,d){d&&d[u]&&(c=d[u].indexOf(c))!==-1&&d[u].splice(c,1)}class F{constructor(c,d={}){_e(this,d),this.type=c}}class Q extends F{constructor(c,d={}){super("error",_e({error:c},d))}}class ae{on(c,d){return this._listeners=this._listeners||{},B(c,d,this._listeners),this}off(c,d){return H(c,d,this._listeners),H(c,d,this._oneTimeListeners),this}once(c,d){return d?(this._oneTimeListeners=this._oneTimeListeners||{},B(c,d,this._oneTimeListeners),this):new Promise(m=>this.once(c,m))}fire(c,d){var m=(c=typeof c=="string"?new F(c,d||{}):c).type;if(this.listens(m)){for(const b of(c.target=this)._listeners&&this._listeners[m]?this._listeners[m].slice():[])b.call(this,c);for(const b of this._oneTimeListeners&&this._oneTimeListeners[m]?this._oneTimeListeners[m].slice():[])H(m,b,this._oneTimeListeners),b.call(this,c);d=this._eventedParent,d&&(_e(c,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),d.fire(c))}else c instanceof Q&&console.error(c.error);return this}listens(c){return this._listeners&&this._listeners[c]&&0<this._listeners[c].length||this._oneTimeListeners&&this._oneTimeListeners[c]&&0<this._oneTimeListeners[c].length||this._eventedParent&&this._eventedParent.listens(c)}setEventedParent(c,d){return this._eventedParent=c,this._eventedParentData=d,this}}var q={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sky:{type:"sky"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const Ae=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function Pe(u,c){if(Array.isArray(u)){if(!Array.isArray(c)||u.length!==c.length)return;for(let d=0;d<u.length;d++)if(!Pe(u[d],c[d]))return;return 1}if(typeof u!="object"||u===null||c===null)return u===c;if(typeof c=="object"&&Object.keys(u).length===Object.keys(c).length){for(const d in u)if(!Pe(u[d],c[d]))return;return 1}}function We(u,c){u.push(c)}function rt(u,c,d){We(d,{command:"addSource",args:[u,c[u]]})}function Et(u,c,d){We(c,{command:"removeSource",args:[u]}),d[u]=!0}function Bt(u,c,d,m){c=c||{};let b;for(b in u=u||{})!Object.prototype.hasOwnProperty.call(u,b)||Object.prototype.hasOwnProperty.call(c,b)||Et(b,d,m);for(b in c)Object.prototype.hasOwnProperty.call(c,b)&&(Object.prototype.hasOwnProperty.call(u,b)?Pe(u[b],c[b])||(u[b].type==="geojson"&&c[b].type==="geojson"&&function(I,O,k){let U;for(U in I[k])if(Object.prototype.hasOwnProperty.call(I[k],U)&&U!=="data"&&!Pe(I[k][U],O[k][U]))return;for(U in O[k])if(Object.prototype.hasOwnProperty.call(O[k],U)&&U!=="data"&&!Pe(I[k][U],O[k][U]))return;return 1}(u,c,b)?We(d,{command:"setGeoJSONSourceData",args:[b,c[b].data]}):(E=b,S=c,Et(E,A=d,m),rt(E,S,A))):rt(b,c,d));var E,S,A}function Lt(u,c,d,m,b,E){c=c||{};for(const S in u=u||{})!Object.prototype.hasOwnProperty.call(u,S)||Pe(u[S],c[S])||d.push({command:E,args:[m,S,c[S],b]});for(const S in c)!Object.prototype.hasOwnProperty.call(c,S)||Object.prototype.hasOwnProperty.call(u,S)||Pe(u[S],c[S])||d.push({command:E,args:[m,S,c[S],b]})}function an(u){return u.id}function Ie(u,c){return u[c.id]=c,u}class Te{constructor(c,d,m,b){this.message=(c?c+": ":"")+m,b&&(this.identifier=b),d!=null&&d.__line__&&(this.line=d.__line__)}}function At(u,...c){for(const d of c)for(const m in d)u[m]=d[m];return u}class xt extends Error{constructor(c,d){super(d),this.message=d,this.key=c}}class qt{constructor(c,d=[]){this.parent=c,this.bindings={};for(var[m,b]of d)this.bindings[m]=b}concat(c){return new qt(this,c)}get(c){if(this.bindings[c])return this.bindings[c];if(this.parent)return this.parent.get(c);throw new Error(c+" not found in scope.")}has(c){return!!this.bindings[c]||!!this.parent&&this.parent.has(c)}}const dn={kind:"null"},Ke={kind:"number"},gt={kind:"string"},Tt={kind:"boolean"},Rn={kind:"color"},Xn={kind:"object"},nn={kind:"value"},Lr={kind:"collator"},Qr={kind:"formatted"},Tr={kind:"padding"},oe={kind:"resolvedImage"},V={kind:"variableAnchorOffsetCollection"};function $(u,c){return{kind:"array",itemType:u,N:c}}function K(u){var c;return u.kind==="array"?(c=K(u.itemType),typeof u.N=="number"?`array<${c}, ${u.N}>`:u.itemType.kind==="value"?"array":`array<${c}>`):u.kind}const me=[dn,Ke,gt,Tt,Rn,Qr,Xn,$(nn),Tr,oe,V];function Oe(u,c){if(c.kind==="error")return null;if(u.kind==="array"){if(c.kind==="array"&&(c.N===0&&c.itemType.kind==="value"||!Oe(u.itemType,c.itemType))&&(typeof u.N!="number"||u.N===c.N))return null}else{if(u.kind===c.kind)return null;if(u.kind==="value"){for(const d of me)if(!Oe(d,c))return null}}return`Expected ${K(u)} but found ${K(c)} instead.`}function He(u,c){return c.some(d=>d.kind===u.kind)}function Le(u,c){return c.some(d=>d==="null"?u===null:d==="array"?Array.isArray(u):d==="object"?u&&!Array.isArray(u)&&typeof u=="object":d===typeof u)}function Ce(u,c){return u.kind==="array"&&c.kind==="array"?u.itemType.kind===c.itemType.kind&&typeof u.N=="number":u.kind===c.kind}const De=.96422,ot=1,st=.82521,St=4/29,un=6/29,en=3*un*un,yn=un*un*un,Kn=Math.PI/180,er=180/Math.PI;function On(u){return(u%=360)<0&&(u+=360),u}function Dn([A,c,d,m]){let b,E;var S=pn((.2225045*(A=fn(A))+.7168786*(c=fn(c))+.0606169*(d=fn(d)))/ot),A=(A===c&&c===d?b=E=S:(b=pn((.4360747*A+.3850649*c+.1430804*d)/De),E=pn((.0139322*A+.0971045*c+.7141733*d)/st)),116*S-16);return[A<0?0:A,500*(b-S),200*(S-E),m]}function fn(u){return u<=.04045?u/12.92:Math.pow((u+.055)/1.055,2.4)}function pn(u){return u>yn?Math.pow(u,1/3):u/en+St}function Wn([u,c,d,m]){return u=(u+16)/116,c=isNaN(c)?u:u+c/500,d=isNaN(d)?u:u-d/200,u=ot*ni(u),[Nr(3.1338561*(c=De*ni(c))-1.6168667*u-.4906146*(d=st*ni(d))),Nr(-.9787684*c+1.9161415*u+.033454*d),Nr(.0719453*c-.2289914*u+1.4052427*d),m]}function Nr(u){return(u=u<=.00304?12.92*u:1.055*Math.pow(u,1/2.4)-.055)<0?0:1<u?1:u}function ni(u){return u>un?u*u*u:en*(u-St)}function ji(c){var[c,d,m,b]=Dn(c),E=Math.sqrt(d*d+m*m);return[Math.round(1e4*E)?On(Math.atan2(m,d)*er):NaN,E,c,b]}function Ei(u){if((u=u.toLowerCase().trim())==="transparent")return[0,0,0,0];var ie=oa[u];if(ie)return[ie,d,c]=ie,[ie/255,d/255,c/255,1];if(u.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(u))return ie=u.length<6?1:2,[co(u.slice(d=1,d+=ie)),co(u.slice(d,d+=ie)),co(u.slice(d,d+=ie)),co(u.slice(d,d+ie)||"ff")];if(u.startsWith("rgb")){var c=u.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(c){var[,d,ie,c,m,b,E,S,A,I,O,k]=c,c=[c||" ",E||" ",I].join("");return(c==="  "||c==="  /"||c===",,"||c===",,,")&&(E=[ie,b,A].join(""),I=E==="%%%"?100:E===""?255:0,I&&(c=[Fc(+d/I,0,1),Fc(+m/I,0,1),Fc(+S/I,0,1),O?zu(+O,k):1],Ll(c)))?c:void 0}}var U,W,re,ie=u.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(ie){var[,b,A,E,d,m,S,I,O]=ie,k=[A||" ",d||" ",S].join("");if((k==="  "||k==="  /"||k===",,"||k===",,,")&&(c=[+b,Fc(+E,0,100),Fc(+m,0,100),I?zu(+I,O):1],Ll(c)))return[U,W,re,u]=[c][0],U=On(U),W/=100,re/=100,[fe(0),fe(8),fe(4),u]}function fe(de){var de=(de+U/30)%12,Me=W*Math.min(re,1-re);return re-Me*Math.max(-1,Math.min(de-3,9-de,1))}}function co(u){return parseInt(u.padEnd(2,u),16)/255}function zu(u,c){return Fc(c?u/100:u,0,1)}function Fc(u,c,d){return Math.min(Math.max(c,u),d)}function Ll(u){return!u.some(Number.isNaN)}const oa={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};class rr{constructor(c,d,m,b=1,E=!0){this.r=c,this.g=d,this.b=m,this.a=b,E||(this.r*=b,this.g*=b,this.b*=b,b)||this.overwriteGetter("rgb",[c,d,m,b])}static parse(c){return c instanceof rr?c:typeof c=="string"&&(c=Ei(c))?new rr(...c,!1):void 0}get rgb(){var{r:c,g:d,b:m,a:b}=this,E=b||1/0;return this.overwriteGetter("rgb",[c/E,d/E,m/E,b])}get hcl(){return this.overwriteGetter("hcl",ji(this.rgb))}get lab(){return this.overwriteGetter("lab",Dn(this.rgb))}overwriteGetter(c,d){return Object.defineProperty(this,c,{value:d}),d}toString(){var[c,d,m,b]=this.rgb;return`rgba(${[c,d,m].map(E=>Math.round(255*E)).join(",")},${b})`}}rr.black=new rr(0,0,0,1),rr.white=new rr(1,1,1,1),rr.transparent=new rr(0,0,0,0),rr.red=new rr(1,0,0,1);class Ao{constructor(c,d,m){this.sensitivity=c?d?"variant":"case":d?"accent":"base",this.locale=m,this.collator=new Intl.Collator(this.locale||[],{sensitivity:this.sensitivity,usage:"search"})}compare(c,d){return this.collator.compare(c,d)}resolvedLocale(){return new Intl.Collator(this.locale||[]).resolvedOptions().locale}}class va{constructor(c,d,m,b,E){this.text=c,this.image=d,this.scale=m,this.fontStack=b,this.textColor=E}}class Zi{constructor(c){this.sections=c}static fromString(c){return new Zi([new va(c,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(c=>c.text.length!==0||c.image&&c.image.name.length!==0)}static factory(c){return c instanceof Zi?c:Zi.fromString(c)}toString(){return this.sections.length===0?"":this.sections.map(c=>c.text).join("")}}class Gr{constructor(c){this.values=c.slice()}static parse(c){if(c instanceof Gr)return c;if(typeof c=="number")return new Gr([c,c,c,c]);if(Array.isArray(c)&&!(c.length<1||4<c.length)){for(const d of c)if(typeof d!="number")return;switch(c.length){case 1:c=[c[0],c[0],c[0],c[0]];break;case 2:c=[c[0],c[1],c[0],c[1]];break;case 3:c=[c[0],c[1],c[2],c[1]]}return new Gr(c)}}toString(){return JSON.stringify(this.values)}}const hs=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class Uo{constructor(c){this.values=c.slice()}static parse(c){if(c instanceof Uo)return c;if(Array.isArray(c)&&!(c.length<1)&&c.length%2==0){for(let b=0;b<c.length;b+=2){var d=c[b],m=c[b+1];if(typeof d!="string"||!hs.has(d)||!Array.isArray(m)||m.length!==2||typeof m[0]!="number"||typeof m[1]!="number")return}return new Uo(c)}}toString(){return JSON.stringify(this.values)}}class zo{constructor(c){this.name=c.name,this.available=c.available}toString(){return this.name}static fromString(c){return c?new zo({name:c,available:!1}):null}}function Bc(u,c,d,m){return typeof u=="number"&&0<=u&&u<=255&&typeof c=="number"&&0<=c&&c<=255&&typeof d=="number"&&0<=d&&d<=255?m===void 0||typeof m=="number"&&0<=m&&m<=1?null:`Invalid rgba value [${[u,c,d,m].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof m=="number"?[u,c,d,m]:[u,c,d]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Xi(u){if(u===null||typeof u=="string"||typeof u=="boolean"||typeof u=="number"||u instanceof rr||u instanceof Ao||u instanceof Zi||u instanceof Gr||u instanceof Uo||u instanceof zo)return 1;if(Array.isArray(u)){for(const c of u)if(!Xi(c))return;return 1}if(typeof u=="object"){for(const c in u)if(!Xi(u[c]))return;return 1}}function ri(u){if(u===null)return dn;if(typeof u=="string")return gt;if(typeof u=="boolean")return Tt;if(typeof u=="number")return Ke;if(u instanceof rr)return Rn;if(u instanceof Ao)return Lr;if(u instanceof Zi)return Qr;if(u instanceof Gr)return Tr;if(u instanceof Uo)return V;if(u instanceof zo)return oe;if(Array.isArray(u)){var c=u.length;let m;for(const b of u){var d=ri(b);if(m){if(m!==d){m=nn;break}}else m=d}return $(m||nn,c)}return Xn}function ds(u){var c=typeof u;return u===null?"":c=="string"||c=="number"||c=="boolean"?String(u):u instanceof rr||u instanceof Zi||u instanceof Gr||u instanceof Uo||u instanceof zo?u.toString():JSON.stringify(u)}class ba{constructor(c,d){this.type=c,this.value=d}static parse(c,d){if(c.length!==2)return d.error(`'literal' expression requires exactly one argument, but found ${c.length-1} instead.`);if(!Xi(c[1]))return d.error("invalid value");c=c[1];let m=ri(c);return d=d.expectedType,m.kind!=="array"||m.N!==0||!d||d.kind!=="array"||typeof d.N=="number"&&d.N!==0||(m=d),new ba(m,c)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}class ir{constructor(c){this.name="ExpressionEvaluationError",this.message=c}toJSON(){return this.message}}const za={string:gt,number:Ke,boolean:Tt,object:Xn};class Un{constructor(c,d){this.type=c,this.args=d}static parse(c,d){if(c.length<2)return d.error("Expected at least one argument.");let m=1,b;var E=c[0];if(E==="array"){let I;if(2<c.length){const k=c[1];if(typeof k!="string"||!(k in za)||k==="object")return d.error('The item type argument of "array" must be one of string, number, boolean',1);I=za[k],m++}else I=nn;let O;if(3<c.length){if(c[2]!==null&&(typeof c[2]!="number"||c[2]<0||c[2]!==Math.floor(c[2])))return d.error('The length argument to "array" must be a positive integer literal',2);O=c[2],m++}b=$(I,O)}else{if(!za[E])throw new Error("Types doesn't contain name = "+E);b=za[E]}for(var S=[];m<c.length;m++){var A=d.parse(c[m],m,nn);if(!A)return null;S.push(A)}return new Un(b,S)}evaluate(c){for(let m=0;m<this.args.length;m++){var d=this.args[m].evaluate(c);if(!Oe(this.type,ri(d)))return d;if(m===this.args.length-1)throw new ir(`Expected value to be of type ${K(this.type)}, but found ${K(ri(d))} instead.`)}throw new Error}eachChild(c){this.args.forEach(c)}outputDefined(){return this.args.every(c=>c.outputDefined())}}const ja={"to-boolean":Tt,"to-color":Rn,"to-number":Ke,"to-string":gt};class Us{constructor(c,d){this.type=c,this.args=d}static parse(c,d){if(c.length<2)return d.error("Expected at least one argument.");var m=c[0];if(!ja[m])throw new Error(`Can't parse ${m} as it is not part of the known types`);if((m==="to-boolean"||m==="to-string")&&c.length!==2)return d.error("Expected one argument.");var m=ja[m],b=[];for(let S=1;S<c.length;S++){var E=d.parse(c[S],S,nn);if(!E)return null;b.push(E)}return new Us(m,b)}evaluate(c){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(c);case"color":{let S,A;for(const I of this.args){if(S=I.evaluate(c),A=null,S instanceof rr)return S;if(typeof S=="string"){var d=c.parseColor(S);if(d)return d}else if(Array.isArray(S)&&!(A=S.length<3||4<S.length?`Invalid rbga value ${JSON.stringify(S)}: expected an array containing either three or four numeric values.`:Bc(S[0],S[1],S[2],S[3])))return new rr(S[0]/255,S[1]/255,S[2]/255,S[3])}throw new ir(A||`Could not parse color from value '${typeof S=="string"?S:JSON.stringify(S)}'`)}case"padding":{let S;for(const A of this.args){S=A.evaluate(c);var m=Gr.parse(S);if(m)return m}throw new ir(`Could not parse padding from value '${typeof S=="string"?S:JSON.stringify(S)}'`)}case"variableAnchorOffsetCollection":{let S;for(const A of this.args){S=A.evaluate(c);var b=Uo.parse(S);if(b)return b}throw new ir(`Could not parse variableAnchorOffsetCollection from value '${typeof S=="string"?S:JSON.stringify(S)}'`)}case"number":{let S=null;for(const A of this.args){if((S=A.evaluate(c))===null)return 0;var E=Number(S);if(!isNaN(E))return E}throw new ir(`Could not convert ${JSON.stringify(S)} to number.`)}case"formatted":return Zi.fromString(ds(this.args[0].evaluate(c)));case"resolvedImage":return zo.fromString(ds(this.args[0].evaluate(c)));default:return ds(this.args[0].evaluate(c))}}eachChild(c){this.args.forEach(c)}outputDefined(){return this.args.every(c=>c.outputDefined())}}const ju=["Unknown","Point","LineString","Polygon"];class Vu{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?ju[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(c){let d=this._parseColorCache[c];return d=d||(this._parseColorCache[c]=rr.parse(c))}}class Uc{constructor(c,d,m=[],b,E=new qt,S=[]){this.registry=c,this.path=m,this.key=m.map(A=>`[${A}]`).join(""),this.scope=E,this.errors=S,this.expectedType=b,this._isConstant=d}parse(c,d,m,b,E={}){return(d?this.concat(d,m,b):this)._parse(c,E)}_parse(c,d){function m(A,I,O){return O==="assert"?new Un(I,[A]):O==="coerce"?new Us(I,[A]):A}if(c!==null&&typeof c!="string"&&typeof c!="boolean"&&typeof c!="number"||(c=["literal",c]),Array.isArray(c)){if(c.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');var b=c[0];if(typeof b!="string")return this.error(`Expression name must be a string, but found ${typeof b} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;var E=this.registry[b];if(E){let A=E.parse(c,this);if(!A)return null;if(this.expectedType){var E=this.expectedType,S=A.type;if(E.kind!=="string"&&E.kind!=="number"&&E.kind!=="boolean"&&E.kind!=="object"&&E.kind!=="array"||S.kind!=="value")if(E.kind!=="color"&&E.kind!=="formatted"&&E.kind!=="resolvedImage"||S.kind!=="value"&&S.kind!=="string")if(E.kind!=="padding"||S.kind!=="value"&&S.kind!=="number"&&S.kind!=="array")if(E.kind!=="variableAnchorOffsetCollection"||S.kind!=="value"&&S.kind!=="array"){if(this.checkSubtype(E,S))return null}else A=m(A,E,d.typeAnnotation||"coerce");else A=m(A,E,d.typeAnnotation||"coerce");else A=m(A,E,d.typeAnnotation||"coerce");else A=m(A,E,d.typeAnnotation||"assert")}if(!(A instanceof ba)&&A.type.kind!=="resolvedImage"&&this._isConstant(A)){S=new Vu;try{A=new ba(A.type,A.evaluate(S))}catch(I){return this.error(I.message),null}}return A}return this.error(`Unknown expression "${b}". If you wanted a literal array, use ["literal", [...]].`,0)}return c===void 0?this.error("'undefined' value invalid. Use null instead."):typeof c=="object"?this.error('Bare objects invalid. Use ["literal", {...}] instead.'):this.error(`Expected an array, but found ${typeof c} instead.`)}concat(c,d,m){return c=typeof c=="number"?this.path.concat(c):this.path,m=m?this.scope.concat(m):this.scope,new Uc(this.registry,this._isConstant,c,d||null,m,this.errors)}error(c,...d){d=""+this.key+d.map(m=>`[${m}]`).join(""),this.errors.push(new xt(d,c))}checkSubtype(c,d){return c=Oe(c,d),c&&this.error(c),c}}class Nl{constructor(c,d,m){this.type=Lr,this.locale=m,this.caseSensitive=c,this.diacriticSensitive=d}static parse(c,d){if(c.length!==2)return d.error("Expected one argument.");if(c=c[1],typeof c!="object"||Array.isArray(c))return d.error("Collator options argument must be an object.");var m=d.parse(c["case-sensitive"]!==void 0&&c["case-sensitive"],1,Tt);if(!m)return null;var b=d.parse(c["diacritic-sensitive"]!==void 0&&c["diacritic-sensitive"],1,Tt);if(!b)return null;let E=null;return c.locale&&!(E=d.parse(c.locale,1,gt))?null:new Nl(m,b,E)}evaluate(c){return new Ao(this.caseSensitive.evaluate(c),this.diacriticSensitive.evaluate(c),this.locale?this.locale.evaluate(c):null)}eachChild(c){c(this.caseSensitive),c(this.diacriticSensitive),this.locale&&c(this.locale)}outputDefined(){return!1}}const zs=8192;function ee(u,c){u[0]=Math.min(u[0],c[0]),u[1]=Math.min(u[1],c[1]),u[2]=Math.max(u[2],c[0]),u[3]=Math.max(u[3],c[1])}function se(u,c){return!(u[0]<=c[0]||u[2]>=c[2]||u[1]<=c[1]||u[3]>=c[3])}function Se(m,b){var d=(180+m[0])/360,m=(m=m[1],(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+m*Math.PI/360)))/360),b=Math.pow(2,b.z);return[Math.round(d*b*zs),Math.round(m*b*zs)]}function qe(u,c){let d=!1;for(let O=0,k=c.length;O<k;O++){var m=c[O];for(let U=0,W=m.length;U<W-1;U++){if(b=u,E=m[U],S=m[U+1],I=A=void 0,A=b[0]-E[0],E=b[1]-E[1],I=b[0]-S[0],b=b[1]-S[1],A*b-I*E==0&&A*I<=0&&E*b<=0)return;S=u,A=m[U],I=m[U+1],A[1]>S[1]!=I[1]>S[1]&&S[0]<(I[0]-A[0])*(S[1]-A[1])/(I[1]-A[1])+A[0]&&(d=!d)}}var b,E,S,A,I;return d}function yt(b,S,O,I){var k=b[0]-O[0],b=b[1]-O[1],E=S[0]-O[0],S=S[1]-O[1],A=I[0]-O[0],I=I[1]-O[1],O=k*I-A*b,k=E*I-A*S;return 0<O&&k<0||O<0&&0<k}function Qt(u,c,d){for(const O of d)for(let k=0;k<O.length-1;++k)if(m=u,b=c,E=O[k],S=O[k+1],I=A=void 0,A=[b[0]-m[0],b[1]-m[1]],(I=[S[0]-E[0],S[1]-E[1]])[0]*A[1]-I[1]*A[0]!=0&&!(!yt(m,b,E,S)||!yt(E,S,m,b)))return 1;var m,b,E,S,A,I}function Zn(u,c){for(let d=0;d<u.length;++d)if(!qe(u[d],c))return;for(let d=0;d<u.length-1;++d)if(Qt(u[d],u[d+1],c))return;return 1}function Ti(u,c,d){var m=[];for(let S=0;S<u.length;S++){var b=[];for(let A=0;A<u[S].length;A++){var E=Se(u[S][A],d);ee(c,E),b.push(E)}m.push(b)}return m}function Vi(u,c,d){var m=[];for(let E=0;E<u.length;E++){var b=Ti(u[E],c,d);m.push(b)}return m}function lo(u,c,d,m){if(u[0]<d[0]||u[0]>d[2]){var b=.5*m;let E=u[0]-d[0]>b?-m:d[0]-u[0]>b?m:0;E===0&&(E=u[0]-d[2]>b?-m:d[2]-u[0]>b?m:0),u[0]+=E}ee(c,u)}function wa(u,c,d,m){var b=Math.pow(2,m.z)*zs,E=[m.x*zs,m.y*zs],S=[];for(const I of u)for(const O of I){var A=[O.x+E[0],O.y+E[1]];lo(A,c,d,b),S.push(A)}return S}function vp(u,c,d,m){var b=Math.pow(2,m.z)*zs,E=[m.x*zs,m.y*zs],S=[];for(const O of u){var A=[];for(const k of O){var I=[k.x+E[0],k.y+E[1]];ee(c,I),A.push(I)}S.push(A)}if(c[2]-c[0]<=b/2){(m=c)[0]=m[1]=1/0,m[2]=m[3]=-1/0;for(const O of S)for(const k of O)lo(k,c,d,b)}return S}function Sb(u,c){var d=[1/0,1/0,-1/0,-1/0],m=[1/0,1/0,-1/0,-1/0],b=u.canonicalID();if(c.type==="Polygon"){var E=Ti(c.coordinates,m,b),S=wa(u.geometry(),d,m,b);if(!se(d,m))return!1;for(const I of S)if(!qe(I,E))return!1}if(c.type==="MultiPolygon"){var A=Vi(c.coordinates,m,b),S=wa(u.geometry(),d,m,b);if(!se(d,m))return!1;for(const O of S)if(!function(k,U){for(let W=0;W<U.length;W++)if(qe(k,U[W]))return 1}(O,A))return!1}return!0}function Cb(u,c){var d=[1/0,1/0,-1/0,-1/0],m=[1/0,1/0,-1/0,-1/0],b=u.canonicalID();if(c.type==="Polygon"){var E=Ti(c.coordinates,m,b),S=vp(u.geometry(),d,m,b);if(!se(d,m))return!1;for(const I of S)if(!Zn(I,E))return!1}if(c.type==="MultiPolygon"){var A=Vi(c.coordinates,m,b),S=vp(u.geometry(),d,m,b);if(!se(d,m))return!1;for(const O of S)if(!function(k,U){for(let W=0;W<U.length;W++)if(Zn(k,U[W]))return 1}(O,A))return!1}return!0}class Dl{constructor(c,d){this.type=Tt,this.geojson=c,this.geometries=d}static parse(c,d){if(c.length!==2)return d.error(`'within' expression requires exactly one argument, but found ${c.length-1} instead.`);if(Xi(c[1])){if(c=c[1],c.type==="FeatureCollection"){var m=[];for(const A of c.features){var{type:b,coordinates:E}=A.geometry;b==="Polygon"&&m.push(E),b==="MultiPolygon"&&m.push(...E)}if(m.length)return S={type:"MultiPolygon",coordinates:m},new Dl(c,S)}else if(c.type==="Feature"){var S=c.geometry.type;if(S==="Polygon"||S==="MultiPolygon")return new Dl(c,c.geometry)}else if(c.type==="Polygon"||c.type==="MultiPolygon")return new Dl(c,c)}return d.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(c){if(c.geometry()!=null&&c.canonicalID()!=null){if(c.geometryType()==="Point")return Sb(c,this.geometries);if(c.geometryType()==="LineString")return Cb(c,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}class _d{constructor(c,d){this.type=d.type,this.name=c,this.boundExpression=d}static parse(c,d){return c.length!==2||typeof c[1]!="string"?d.error("'var' expression requires exactly one string literal argument."):(c=c[1],d.scope.has(c)?new _d(c,d.scope.get(c)):d.error(`Unknown variable "${c}". Make sure "${c}" has been bound in an enclosing "let" expression before using it.`,1))}evaluate(c){return this.boundExpression.evaluate(c)}eachChild(){}outputDefined(){return!1}}class xa{constructor(c,d,m,b){this.name=c,this.type=d,this._evaluate=m,this.args=b}evaluate(c){return this._evaluate(c,this.args)}eachChild(c){this.args.forEach(c)}outputDefined(){return!1}static parse(c,d){var m=c[0],A=xa.definitions[m];if(!A)return d.error(`Unknown expression "${m}". If you wanted a literal array, use ["literal", [...]].`,0);var b,E,S=Array.isArray(A)?A[0]:A.type,A=Array.isArray(A)?[[A[1],A[2]]]:A.overloads,I=A.filter(([de])=>!Array.isArray(de)||de.length===c.length-1);let O=null;for([b,E]of I){O=new Uc(d.registry,bp,d.path,null,d.scope);var k=[];let de=!1;for(let Me=1;Me<c.length;Me++){var W=c[Me],U=Array.isArray(b)?b[Me-1]:b.type,W=O.parse(W,1+k.length,U);if(!W){de=!0;break}k.push(W)}if(!de)if(Array.isArray(b)&&b.length!==k.length)O.error(`Expected ${b.length} arguments, but found ${k.length} instead.`);else{for(let Me=0;Me<k.length;Me++){var re=Array.isArray(b)?b[Me]:b.type,ie=k[Me];O.concat(Me+1).checkSubtype(re,ie.type)}if(O.errors.length===0)return new xa(m,S,E,k)}}if(I.length===1)d.errors.push(...O.errors);else{var I=(I.length?I:A).map(([Me])=>BT(Me)).join(" | "),fe=[];for(let Me=1;Me<c.length;Me++){var we=d.parse(c[Me],1+fe.length);if(!we)return null;fe.push(K(we.type))}d.error(`Expected arguments of type ${I}, but found (${fe.join(", ")}) instead.`)}return null}static register(c,d){for(const m in xa.definitions=d)c[m]=xa}}function BT(u){return Array.isArray(u)?`(${u.map(K).join(", ")})`:`(${K(u.type)}...)`}function bp(u){if(u instanceof _d)return bp(u.boundExpression);if(u instanceof xa&&u.name==="error"||u instanceof Nl||u instanceof Dl)return!1;const c=u instanceof Us||u instanceof Un;let d=!0;return u.eachChild(m=>{d=c?d&&bp(m):d&&m instanceof ba}),!!d&&wp(u)&&xp(u,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function wp(u){if(u instanceof xa&&(u.name==="get"&&u.args.length===1||u.name==="feature-state"||u.name==="has"&&u.args.length===1||u.name==="properties"||u.name==="geometry-type"||u.name==="id"||/^filter-/.test(u.name))||u instanceof Dl)return!1;let c=!0;return u.eachChild(d=>{c&&!wp(d)&&(c=!1)}),c}function vd(u){if(!(u instanceof xa&&u.name==="feature-state")){let c=!0;return u.eachChild(d=>{c&&!vd(d)&&(c=!1)}),c}}function xp(u,c){if(u instanceof xa&&0<=c.indexOf(u.name))return!1;let d=!0;return u.eachChild(m=>{d&&!xp(m,c)&&(d=!1)}),d}function Ep(u,c){var d=u.length-1;let m=0,b=d;for(var E,S,A;m<=b;)if(S=u[E=Math.floor((m+b)/2)],A=u[E+1],S<=c){if(E===d||c<A)return E;m=E+1}else{if(!(c<S))throw new ir("Input is not a number.");b=E-1}return 0}class Fl{constructor(c,d,m){this.type=c,this.input=d,this.labels=[],this.outputs=[];for(var[b,E]of m)this.labels.push(b),this.outputs.push(E)}static parse(c,d){if(c.length-1<4)return d.error(`Expected at least 4 arguments, but found only ${c.length-1}.`);if((c.length-1)%2!=0)return d.error("Expected an even number of arguments.");var m=d.parse(c[1],1,Ke);if(!m)return null;var b=[];let E=null;d.expectedType&&d.expectedType.kind!=="value"&&(E=d.expectedType);for(let k=1;k<c.length;k+=2){var S=k===1?-1/0:c[k],A=c[k+1],I=k,O=k+1;if(typeof S!="number")return d.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',I);if(b.length&&b[b.length-1][0]>=S)return d.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',I);if(I=d.parse(A,O,E),!I)return null;E=E||I.type,b.push([S,I])}return new Fl(E,m,b)}evaluate(c){var d,m,b=this.labels,E=this.outputs;return(b.length===1||(d=this.input.evaluate(c))<=b[0]?E[0]:d>=b[(m=b.length)-1]?E[m-1]:E[Ep(b,d)]).evaluate(c)}eachChild(c){c(this.input);for(const d of this.outputs)c(d)}outputDefined(){return this.outputs.every(c=>c.outputDefined())}}function Tp(u){return u&&u.__esModule&&Object.prototype.hasOwnProperty.call(u,"default")?u.default:u}var wd=br;function br(u,c,d,m){this.cx=3*u,this.bx=3*(d-u)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*c,this.by=3*(m-c)-this.cy,this.ay=1-this.cy-this.by,this.p1x=u,this.p1y=c,this.p2x=d,this.p2y=m}br.prototype={sampleCurveX:function(u){return((this.ax*u+this.bx)*u+this.cx)*u},sampleCurveY:function(u){return((this.ay*u+this.by)*u+this.cy)*u},sampleCurveDerivativeX:function(u){return(3*this.ax*u+2*this.bx)*u+this.cx},solveCurveX:function(u,c){if(c===void 0&&(c=1e-6),u<0)return 0;if(1<u)return 1;for(var d=u,m=0;m<8;m++){var b=this.sampleCurveX(d)-u;if(Math.abs(b)<c)return d;var E=this.sampleCurveDerivativeX(d);if(Math.abs(E)<1e-6)break;d-=b/E}for(var S=0,A=1,d=u,m=0;m<20&&(b=this.sampleCurveX(d),!(Math.abs(b-u)<c));m++)b<u?S=d:A=d,d=.5*(A-S)+S;return d},solve:function(u,c){return this.sampleCurveY(this.solveCurveX(u,c))}};var UT=Tp(wd);function Bl(u,c,d){return u+d*(c-u)}function Sp(u,c,d){return u.map((m,b)=>Bl(m,c[b],d))}const Ea={number:Bl,color:function(u,c,d,m="rgb"){switch(m){case"rgb":var[b,E,k,S]=Sp(u.rgb,c.rgb,d);return new rr(b,E,k,S,!1);case"hcl":{var[b,E,k,S]=u.hcl,[I,O,U,A]=c.hcl;let we,de;if(isNaN(b)||isNaN(I))isNaN(b)?isNaN(I)?we=NaN:(we=I,k!==1&&k!==0||(de=O)):(we=b,U!==1&&U!==0||(de=E));else{let Ye=I-b;b<I&&180<Ye?Ye-=360:I<b&&180<b-I&&(Ye+=360),we=b+d*Ye}[I,b,E,O]=[[we,de??Bl(E,O,d),Bl(k,U,d),Bl(S,A,d)]][0],I=isNaN(I)?0:I*Kn;var[k,U,S,A]=Wn([E,Math.cos(I)*b,Math.sin(I)*b,O]);return new rr(k,U,S,A,!1)}case"lab":var[I,O,k,U]=Wn(Sp(u.lab,c.lab,d));return new rr(I,O,k,U,!1)}},array:Sp,padding:function(u,c,d){return new Gr(Sp(u.values,c.values,d))},variableAnchorOffsetCollection:function(u,c,d){var m=u.values,b=c.values;if(m.length!==b.length)throw new ir(`Cannot interpolate values of different length. from: ${u.toString()}, to: `+c.toString());var E=[];for(let k=0;k<m.length;k+=2){if(m[k]!==b[k])throw new ir(`Cannot interpolate values containing mismatched anchors. from[${k}]: ${m[k]}, to[${k}]: `+b[k]);E.push(m[k]);var[S,A]=m[k+1],[I,O]=b[k+1];E.push([Bl(S,I,d),Bl(A,O,d)])}return new Uo(E)}};class Ta{constructor(c,d,m,b,E){this.type=c,this.operator=d,this.interpolation=m,this.input=b,this.labels=[],this.outputs=[];for(var[S,A]of E)this.labels.push(S),this.outputs.push(A)}static interpolationFactor(c,d,m,b){let E=0;return c.name==="exponential"?E=Cy(d,c.base,m,b):c.name==="linear"?E=Cy(d,1,m,b):c.name==="cubic-bezier"&&(c=c.controlPoints,c=new UT(c[0],c[1],c[2],c[3]),E=c.solve(Cy(d,1,m,b))),E}static parse(c,d){let[m,b,E,...S]=c;if(!Array.isArray(b)||b.length===0)return d.error("Expected an interpolation type expression.",1);if(b[0]==="linear")b={name:"linear"};else if(b[0]==="exponential"){var A=b[1];if(typeof A!="number")return d.error("Exponential interpolation requires a numeric base.",1,1);b={name:"exponential",base:A}}else{if(b[0]!=="cubic-bezier")return d.error("Unknown interpolation type "+String(b[0]),1,0);if(A=b.slice(1),A.length!==4||A.some(ie=>typeof ie!="number"||ie<0||1<ie))return d.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);b={name:"cubic-bezier",controlPoints:A}}if(c.length-1<4)return d.error(`Expected at least 4 arguments, but found only ${c.length-1}.`);if((c.length-1)%2!=0)return d.error("Expected an even number of arguments.");if(!(E=d.parse(E,2,Ke)))return null;var I=[];let O=null;m==="interpolate-hcl"||m==="interpolate-lab"?O=Rn:d.expectedType&&d.expectedType.kind!=="value"&&(O=d.expectedType);for(let ie=0;ie<S.length;ie+=2){var k=S[ie],U=S[ie+1],W=ie+3,re=ie+4;if(typeof k!="number")return d.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',W);if(I.length&&I[I.length-1][0]>=k)return d.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',W);if(W=d.parse(U,re,O),!W)return null;O=O||W.type,I.push([k,W])}return Ce(O,Ke)||Ce(O,Rn)||Ce(O,Tr)||Ce(O,V)||Ce(O,$(Ke))?new Ta(O,m,b,E,I):d.error(`Type ${K(O)} is not interpolatable.`)}evaluate(c){var S=this.labels,d=this.outputs;if(S.length===1)return d[0].evaluate(c);var m=this.input.evaluate(c);if(m<=S[0])return d[0].evaluate(c);var b=S.length;if(m>=S[b-1])return d[b-1].evaluate(c);var b=Ep(S,m),E=S[b],S=S[b+1],A=Ta.interpolationFactor(this.interpolation,m,E,S),I=d[b].evaluate(c),O=d[b+1].evaluate(c);switch(this.operator){case"interpolate":return Ea[this.type.kind](I,O,A);case"interpolate-hcl":return Ea.color(I,O,A,"hcl");case"interpolate-lab":return Ea.color(I,O,A,"lab")}}eachChild(c){c(this.input);for(const d of this.outputs)c(d)}outputDefined(){return this.outputs.every(c=>c.outputDefined())}}function Cy(u,c,d,m){return m-=d,u-=d,m==0?0:c===1?u/m:(Math.pow(c,u)-1)/(Math.pow(c,m)-1)}class bd{constructor(c,d){this.type=c,this.args=d}static parse(c,d){if(c.length<2)return d.error("Expectected at least one argument.");let m=null;const b=d.expectedType;b&&b.kind!=="value"&&(m=b);var E=[];for(const A of c.slice(1)){var S=d.parse(A,1+E.length,m,void 0,{typeAnnotation:"omit"});if(!S)return null;m=m||S.type,E.push(S)}if(m)return b&&E.some(A=>Oe(b,A.type))?new bd(nn,E):new bd(m,E);throw new Error("No output type")}evaluate(c){let d=null,m=0,b;for(const E of this.args)if(m++,(d=(d=E.evaluate(c))&&d instanceof zo&&!d.available&&(b=b||d.name,d=null,m===this.args.length)?b:d)!==null)break;return d}eachChild(c){this.args.forEach(c)}outputDefined(){return this.args.every(c=>c.outputDefined())}}class Cp{constructor(c,d){this.type=d.type,this.bindings=[].concat(c),this.result=d}evaluate(c){return this.result.evaluate(c)}eachChild(c){for(const d of this.bindings)c(d[1]);c(this.result)}static parse(c,d){if(c.length<4)return d.error(`Expected at least 3 arguments, but found ${c.length-1} instead.`);var m=[];for(let A=1;A<c.length-1;A+=2){var b=c[A];if(typeof b!="string")return d.error(`Expected string, but found ${typeof b} instead.`,A);if(/[^a-zA-Z0-9_]/.test(b))return d.error("Variable names must contain only alphanumeric characters or '_'.",A);var E=d.parse(c[A+1],A+1);if(!E)return null;m.push([b,E])}var S=d.parse(c[c.length-1],c.length-1,d.expectedType,m);return S?new Cp(m,S):null}outputDefined(){return this.result.outputDefined()}}function Ab(u,c){return u==="=="||u==="!="?c.kind==="boolean"||c.kind==="string"||c.kind==="number"||c.kind==="null"||c.kind==="value":c.kind==="string"||c.kind==="number"||c.kind==="value"}function Ib(u,c,d,m){return m.compare(c,d)===0}function Hu(u,c,d){const m=u!=="=="&&u!=="!=";return class FU{constructor(E,S,A){this.type=Tt,this.lhs=E,this.rhs=S,this.collator=A,this.hasUntypedArgument=E.type.kind==="value"||S.type.kind==="value"}static parse(E,S){if(E.length!==3&&E.length!==4)return S.error("Expected two or three arguments.");var A=E[0];let I=S.parse(E[1],1,nn);if(!I)return null;if(!Ab(A,I.type))return S.concat(1).error(`"${A}" comparisons are not supported for type '${K(I.type)}'.`);let O=S.parse(E[2],2,nn);if(!O)return null;if(!Ab(A,O.type))return S.concat(2).error(`"${A}" comparisons are not supported for type '${K(O.type)}'.`);if(I.type.kind!==O.type.kind&&I.type.kind!=="value"&&O.type.kind!=="value")return S.error(`Cannot compare types '${K(I.type)}' and '${K(O.type)}'.`);m&&(I.type.kind==="value"&&O.type.kind!=="value"?I=new Un(O.type,[I]):I.type.kind!=="value"&&O.type.kind==="value"&&(O=new Un(I.type,[O])));let k=null;if(E.length===4){if(I.type.kind!=="string"&&O.type.kind!=="string"&&I.type.kind!=="value"&&O.type.kind!=="value")return S.error("Cannot use collator to compare non-string types.");if(!(k=S.parse(E[3],3,Lr)))return null}return new FU(I,O,k)}evaluate(E){var S=this.lhs.evaluate(E),A=this.rhs.evaluate(E);if(m&&this.hasUntypedArgument){var I=ri(S),O=ri(A);if(I.kind!==O.kind||I.kind!=="string"&&I.kind!=="number")throw new ir(`Expected arguments for "${u}" to be (string, string) or (number, number), but found (${I.kind}, ${O.kind}) instead.`)}return this.collator&&!m&&this.hasUntypedArgument&&(I=ri(S),O=ri(A),I.kind!=="string"||O.kind!=="string")?c(E,S,A):this.collator?d(E,S,A,this.collator.evaluate(E)):c(E,S,A)}eachChild(E){E(this.lhs),E(this.rhs),this.collator&&E(this.collator)}outputDefined(){return!0}}}var wd=Hu("==",function(u,c,d){return c===d},Ib),to=Hu("!=",function(u,c,d){return c!==d},function(u,c,d,m){return!Ib(0,c,d,m)}),$a=Hu("<",function(u,c,d){return c<d},function(u,c,d,m){return m.compare(c,d)<0}),xd=Hu(">",function(u,c,d){return d<c},function(u,c,d,m){return 0<m.compare(c,d)}),fc=Hu("<=",function(u,c,d){return c<=d},function(u,c,d,m){return m.compare(c,d)<=0}),Mr=Hu(">=",function(u,c,d){return d<=c},function(u,c,d,m){return 0<=m.compare(c,d)});class Ap{constructor(c){this.type=Qr,this.sections=c}static parse(c,d){if(c.length<2)return d.error("Expected at least one argument.");var m=c[1];if(!Array.isArray(m)&&typeof m=="object")return d.error("First argument must be an image or text section.");var b=[];let E=!1;for(let I=1;I<=c.length-1;++I){var S=c[I];if(E&&typeof S=="object"&&!Array.isArray(S)){E=!1;let O=null;if(S["font-scale"]&&!(O=d.parse(S["font-scale"],1,Ke)))return null;let k=null;if(S["text-font"]&&!(k=d.parse(S["text-font"],1,$(gt))))return null;let U=null;if(S["text-color"]&&!(U=d.parse(S["text-color"],1,Rn)))return null;S=b[b.length-1],S.scale=O,S.font=k,S.textColor=U}else{if(S=d.parse(c[I],1,nn),!S)return null;var A=S.type.kind;if(A!=="string"&&A!=="value"&&A!=="null"&&A!=="resolvedImage")return d.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");E=!0,b.push({content:S,scale:null,font:null,textColor:null})}}return new Ap(b)}evaluate(c){return new Zi(this.sections.map(d=>{var m=d.content.evaluate(c);return ri(m)===oe?new va("",m,null,null,null):new va(ds(m),null,d.scale?d.scale.evaluate(c):null,d.font?d.font.evaluate(c).join(","):null,d.textColor?d.textColor.evaluate(c):null)}))}eachChild(c){for(const d of this.sections)c(d.content),d.scale&&c(d.scale),d.font&&c(d.font),d.textColor&&c(d.textColor)}outputDefined(){return!1}}const Gu={"==":wd,"!=":to,">":xd,"<":$a,">=":Mr,"<=":fc,array:Un,at:class BU{constructor(c,d,m){this.type=c,this.index=d,this.input=m}static parse(c,d){var m;return c.length!==3?d.error(`Expected 2 arguments, but found ${c.length-1} instead.`):(m=d.parse(c[1],1,Ke),c=d.parse(c[2],2,$(d.expectedType||nn)),m&&c?(d=c.type,new BU(d.itemType,m,c)):null)}evaluate(m){var d=this.index.evaluate(m),m=this.input.evaluate(m);if(d<0)throw new ir(`Array index out of bounds: ${d} < 0.`);if(d>=m.length)throw new ir(`Array index out of bounds: ${d} > ${m.length-1}.`);if(d!==Math.floor(d))throw new ir(`Array index must be an integer, but found ${d} instead.`);return m[d]}eachChild(c){c(this.index),c(this.input)}outputDefined(){return!1}},boolean:Un,case:class UU{constructor(c,d,m){this.type=c,this.branches=d,this.otherwise=m}static parse(c,d){if(c.length<4)return d.error(`Expected at least 3 arguments, but found only ${c.length-1}.`);if(c.length%2!=0)return d.error("Expected an odd number of arguments.");let m;d.expectedType&&d.expectedType.kind!=="value"&&(m=d.expectedType);var b=[];for(let I=1;I<c.length-1;I+=2){var E=d.parse(c[I],I,Tt);if(!E)return null;var S=d.parse(c[I+1],I+1,m);if(!S)return null;b.push([E,S]),m=m||S.type}var A=d.parse(c[c.length-1],c.length-1,m);if(!A)return null;if(m)return new UU(m,b,A);throw new Error("Can't infer output type")}evaluate(c){for(var[d,m]of this.branches)if(d.evaluate(c))return m.evaluate(c);return this.otherwise.evaluate(c)}eachChild(c){for(var[d,m]of this.branches)c(d),c(m);c(this.otherwise)}outputDefined(){return this.branches.every(([,c])=>c.outputDefined())&&this.otherwise.outputDefined()}},coalesce:bd,collator:Nl,format:Ap,image:class zU{constructor(c){this.type=oe,this.input=c}static parse(c,d){return c.length!==2?d.error("Expected two arguments."):(c=d.parse(c[1],1,gt))?new zU(c):d.error("No image name provided.")}evaluate(c){var d=this.input.evaluate(c),m=zo.fromString(d);return m&&c.availableImages&&(m.available=-1<c.availableImages.indexOf(d)),m}eachChild(c){c(this.input)}outputDefined(){return!1}},in:class jU{constructor(c,d){this.type=Tt,this.needle=c,this.haystack=d}static parse(c,d){var m;return c.length!==3?d.error(`Expected 2 arguments, but found ${c.length-1} instead.`):(m=d.parse(c[1],1,nn),c=d.parse(c[2],2,nn),m&&c?He(m.type,[Tt,gt,Ke,dn,nn])?new jU(m,c):d.error(`Expected first argument to be of type boolean, string, number or null, but found ${K(m.type)} instead`):null)}evaluate(c){var d=this.needle.evaluate(c);if(!(c=this.haystack.evaluate(c)))return!1;if(!Le(d,["boolean","string","number","null"]))throw new ir(`Expected first argument to be of type boolean, string, number or null, but found ${K(ri(d))} instead.`);if(Le(c,["string","array"]))return 0<=c.indexOf(d);throw new ir(`Expected second argument to be of type array or string, but found ${K(ri(c))} instead.`)}eachChild(c){c(this.needle),c(this.haystack)}outputDefined(){return!0}},"index-of":class iI{constructor(c,d,m){this.type=Ke,this.needle=c,this.haystack=d,this.fromIndex=m}static parse(c,d){var m,b;return c.length<=2||5<=c.length?d.error(`Expected 3 or 4 arguments, but found ${c.length-1} instead.`):(m=d.parse(c[1],1,nn),b=d.parse(c[2],2,nn),m&&b?He(m.type,[Tt,gt,Ke,dn,nn])?c.length===4?(c=d.parse(c[3],3,Ke))?new iI(m,b,c):null:new iI(m,b):d.error(`Expected first argument to be of type boolean, string, number or null, but found ${K(m.type)} instead`):null)}evaluate(c){var d=this.needle.evaluate(c),m=this.haystack.evaluate(c);if(!Le(d,["boolean","string","number","null"]))throw new ir(`Expected first argument to be of type boolean, string, number or null, but found ${K(ri(d))} instead.`);if(Le(m,["string","array"]))return this.fromIndex?(c=this.fromIndex.evaluate(c),m.indexOf(d,c)):m.indexOf(d);throw new ir(`Expected second argument to be of type array or string, but found ${K(ri(m))} instead.`)}eachChild(c){c(this.needle),c(this.haystack),this.fromIndex&&c(this.fromIndex)}outputDefined(){return!1}},interpolate:Ta,"interpolate-hcl":Ta,"interpolate-lab":Ta,length:class VU{constructor(c){this.type=Ke,this.input=c}static parse(c,d){return c.length!==2?d.error(`Expected 1 argument, but found ${c.length-1} instead.`):(c=d.parse(c[1],1))?c.type.kind!=="array"&&c.type.kind!=="string"&&c.type.kind!=="value"?d.error(`Expected argument of type string or array, but found ${K(c.type)} instead.`):new VU(c):null}evaluate(c){if(typeof(c=this.input.evaluate(c))=="string"||Array.isArray(c))return c.length;throw new ir(`Expected value to be of type string or array, but found ${K(ri(c))} instead.`)}eachChild(c){c(this.input)}outputDefined(){return!1}},let:Cp,literal:ba,match:class HU{constructor(c,d,m,b,E,S){this.inputType=c,this.type=d,this.input=m,this.cases=b,this.outputs=E,this.otherwise=S}static parse(c,d){if(c.length<5)return d.error(`Expected at least 4 arguments, but found only ${c.length-1}.`);if(c.length%2!=1)return d.error("Expected an even number of arguments.");let m,b;d.expectedType&&d.expectedType.kind!=="value"&&(b=d.expectedType);var E={},S=[];for(let U=2;U<c.length-1;U+=2){let W=c[U];var A=c[U+1],I=(Array.isArray(W)||(W=[W]),d.concat(U));if(W.length===0)return I.error("Expected at least one branch label.");for(const re of W){if(typeof re!="number"&&typeof re!="string")return I.error("Branch labels must be numbers or strings.");if(typeof re=="number"&&Math.abs(re)>Number.MAX_SAFE_INTEGER)return I.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof re=="number"&&Math.floor(re)!==re)return I.error("Numeric branch labels must be integer values.");if(m){if(I.checkSubtype(m,ri(re)))return null}else m=ri(re);if(E[String(re)]!==void 0)return I.error("Branch labels must be unique.");E[String(re)]=S.length}if(!(A=d.parse(A,U,b)))return null;b=b||A.type,S.push(A)}var O,k=d.parse(c[1],1,nn);return!k||!(O=d.parse(c[c.length-1],c.length-1,b))||k.type.kind!=="value"&&d.concat(1).checkSubtype(m,k.type)?null:new HU(m,b,k,E,S,O)}evaluate(c){var d=this.input.evaluate(c);return(ri(d)===this.inputType&&this.outputs[this.cases[d]]||this.otherwise).evaluate(c)}eachChild(c){c(this.input),this.outputs.forEach(c),c(this.otherwise)}outputDefined(){return this.outputs.every(c=>c.outputDefined())&&this.otherwise.outputDefined()}},number:Un,"number-format":class GU{constructor(c,d,m,b,E){this.type=gt,this.number=c,this.locale=d,this.currency=m,this.minFractionDigits=b,this.maxFractionDigits=E}static parse(c,d){if(c.length!==3)return d.error("Expected two arguments.");var m=d.parse(c[1],1,Ke);if(!m)return null;if(typeof(c=c[2])!="object"||Array.isArray(c))return d.error("NumberFormat options argument must be an object.");let b=null;if(c.locale&&!(b=d.parse(c.locale,1,gt)))return null;let E=null;if(c.currency&&!(E=d.parse(c.currency,1,gt)))return null;let S=null;if(c["min-fraction-digits"]&&!(S=d.parse(c["min-fraction-digits"],1,Ke)))return null;let A=null;return c["max-fraction-digits"]&&!(A=d.parse(c["max-fraction-digits"],1,Ke))?null:new GU(m,b,E,S,A)}evaluate(c){return new Intl.NumberFormat(this.locale?this.locale.evaluate(c):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(c):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(c):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(c):void 0}).format(this.number.evaluate(c))}eachChild(c){c(this.number),this.locale&&c(this.locale),this.currency&&c(this.currency),this.minFractionDigits&&c(this.minFractionDigits),this.maxFractionDigits&&c(this.maxFractionDigits)}outputDefined(){return!1}},object:Un,slice:class oI{constructor(c,d,m,b){this.type=c,this.input=d,this.beginIndex=m,this.endIndex=b}static parse(c,d){var m,b;return c.length<=2||5<=c.length?d.error(`Expected 3 or 4 arguments, but found ${c.length-1} instead.`):(m=d.parse(c[1],1,nn),b=d.parse(c[2],2,Ke),m&&b?He(m.type,[$(nn),gt,nn])?c.length===4?(c=d.parse(c[3],3,Ke))?new oI(m.type,m,b,c):null:new oI(m.type,m,b):d.error(`Expected first argument to be of type array or string, but found ${K(m.type)} instead`):null)}evaluate(c){var d=this.input.evaluate(c),m=this.beginIndex.evaluate(c);if(Le(d,["string","array"]))return this.endIndex?(c=this.endIndex.evaluate(c),d.slice(m,c)):d.slice(m);throw new ir(`Expected first argument to be of type array or string, but found ${K(ri(d))} instead.`)}eachChild(c){c(this.input),c(this.beginIndex),this.endIndex&&c(this.endIndex)}outputDefined(){return!1}},step:Fl,string:Un,"to-boolean":Us,"to-color":Us,"to-number":Us,"to-string":Us,var:_d,within:Dl};function Pb(u,[c,d,m,b]){if(c=c.evaluate(u),d=d.evaluate(u),m=m.evaluate(u),b=b?b.evaluate(u):1,u=Bc(c,d,m,b),u)throw new ir(u);return new rr(c/255,d/255,m/255,b,!1)}function Ay(u,c){return c=c[u],c===void 0?null:c}function Ul(u){return{type:u}}function Iy(u){return{result:"success",value:u}}function qu(u){return{result:"error",value:u}}function $u(u){return u["property-type"]==="data-driven"||u["property-type"]==="cross-faded-data-driven"}function Mb(u){return u.expression&&-1<u.expression.parameters.indexOf("zoom")}function Py(u){return u.expression&&u.expression.interpolated}function yr(u){return u instanceof Number?"number":u instanceof String?"string":u instanceof Boolean?"boolean":Array.isArray(u)?"array":u===null?"null":typeof u}function Ip(u){return typeof u=="object"&&u!==null&&!Array.isArray(u)}function zT(u){return u}function Rb(u,c){var d=c.type==="color",m=u.stops&&typeof u.stops[0][0]=="object",b=m||u.property!==void 0,b=m||!b,E=u.type||(Py(c)?"exponential":"interval");if(d||c.type==="padding"){const re=(d?rr:Gr).parse;(u=At({},u)).stops&&(u.stops=u.stops.map(ie=>[ie[0],re(ie[1])])),u.default?u.default=re(u.default):u.default=re(c.default)}if(u.colorSpace&&(d=u.colorSpace)!=="rgb"&&d!=="hcl"&&d!=="lab")throw new Error(`Unknown color space: "${u.colorSpace}"`);let S,A,I;if(E==="exponential")S=Pp;else if(E==="interval")S=VT;else if(E==="categorical"){S=jT,A=Object.create(null);for(const re of u.stops)A[re[0]]=re[1];I=typeof u.stops[0][0]}else{if(E!=="identity")throw new Error(`Unknown function type "${E}"`);S=HT}if(m){var O={},k=[];for(let ie=0;ie<u.stops.length;ie++){var U=u.stops[ie],W=U[0].zoom;O[W]===void 0&&(O[W]={zoom:W,type:u.type,property:u.property,default:u.default,stops:[]},k.push(W)),O[W].stops.push([U[0].value,U[1]])}const re=[];for(const ie of k)re.push([O[ie].zoom,Rb(O[ie],c)]);return d={name:"linear"},{kind:"composite",interpolationType:d,interpolationFactor:Ta.interpolationFactor.bind(void 0,d),zoomStops:re.map(ie=>ie[0]),evaluate({zoom:ie},fe){return Pp({stops:re,base:u.base},c,ie).evaluate(ie,fe)}}}return b?{kind:"camera",interpolationType:m=E==="exponential"?{name:"exponential",base:u.base!==void 0?u.base:1}:null,interpolationFactor:Ta.interpolationFactor.bind(void 0,m),zoomStops:u.stops.map(re=>re[0]),evaluate:({zoom:re})=>S(u,c,re,A,I)}:{kind:"source",evaluate(re,ie){return ie=ie&&ie.properties?ie.properties[u.property]:void 0,ie===void 0?Ed(u.default,c.default):S(u,c,ie,A,I)}}}function Ed(u,c,d){return u!==void 0?u:c!==void 0?c:d!==void 0?d:void 0}function jT(u,c,d,m,b){return Ed(typeof d===b?m[d]:void 0,u.default,c.default)}function VT(u,c,d){return yr(d)!=="number"?Ed(u.default,c.default):((c=u.stops.length)===1||d<=u.stops[0][0]?u.stops[0]:d>=u.stops[c-1][0]?u.stops[c-1]:(c=Ep(u.stops.map(m=>m[0]),d),u.stops[c]))[1]}function Pp(u,c,d){var m=u.base!==void 0?u.base:1;if(yr(d)!=="number")return Ed(u.default,c.default);var b=u.stops.length;if(b===1||d<=u.stops[0][0])return u.stops[0][1];if(d>=u.stops[b-1][0])return u.stops[b-1][1];b=Ep(u.stops.map(O=>O[0]),d);const E=function(O,k,U,W){return W-=U,O-=U,W==0?0:k===1?O/W:(Math.pow(k,O)-1)/(Math.pow(k,W)-1)}(d,m,u.stops[b][0],u.stops[b+1][0]),S=u.stops[b][1],A=u.stops[b+1][1],I=Ea[c.type]||zT;return typeof S.evaluate=="function"?{evaluate(...U){var k=S.evaluate.apply(void 0,U),U=A.evaluate.apply(void 0,U);if(k!==void 0&&U!==void 0)return I(k,U,E,u.colorSpace)}}:I(S,A,E,u.colorSpace)}function HT(u,c,d){switch(c.type){case"color":d=rr.parse(d);break;case"formatted":d=Zi.fromString(d.toString());break;case"resolvedImage":d=zo.fromString(d.toString());break;case"padding":d=Gr.parse(d);break;default:yr(d)===c.type||c.type==="enum"&&c.values[d]||(d=void 0)}return Ed(d,u.default,c.default)}xa.register(Gu,{error:[{kind:"error"},[gt],(u,[c])=>{throw new ir(c.evaluate(u))}],typeof:[gt,[nn],(u,[c])=>K(ri(c.evaluate(u)))],"to-rgba":[$(Ke,4),[Rn],(m,[d])=>{var[d,m,b,E]=d.evaluate(m).rgb;return[255*d,255*m,255*b,E]}],rgb:[Rn,[Ke,Ke,Ke],Pb],rgba:[Rn,[Ke,Ke,Ke,Ke],Pb],has:{type:Tt,overloads:[[[gt],(u,[c])=>c.evaluate(u)in u.properties()],[[gt,Xn],(u,[c,d])=>c.evaluate(u)in d.evaluate(u)]]},get:{type:nn,overloads:[[[gt],(u,[c])=>Ay(c.evaluate(u),u.properties())],[[gt,Xn],(u,[c,d])=>Ay(c.evaluate(u),d.evaluate(u))]]},"feature-state":[nn,[gt],(u,[c])=>Ay(c.evaluate(u),u.featureState||{})],properties:[Xn,[],u=>u.properties()],"geometry-type":[gt,[],u=>u.geometryType()],id:[nn,[],u=>u.id()],zoom:[Ke,[],u=>u.globals.zoom],"heatmap-density":[Ke,[],u=>u.globals.heatmapDensity||0],"line-progress":[Ke,[],u=>u.globals.lineProgress||0],accumulated:[nn,[],u=>u.globals.accumulated===void 0?null:u.globals.accumulated],"+":[Ke,Ul(Ke),(u,c)=>{let d=0;for(const m of c)d+=m.evaluate(u);return d}],"*":[Ke,Ul(Ke),(u,c)=>{let d=1;for(const m of c)d*=m.evaluate(u);return d}],"-":{type:Ke,overloads:[[[Ke,Ke],(u,[c,d])=>c.evaluate(u)-d.evaluate(u)],[[Ke],(u,[c])=>-c.evaluate(u)]]},"/":[Ke,[Ke,Ke],(u,[c,d])=>c.evaluate(u)/d.evaluate(u)],"%":[Ke,[Ke,Ke],(u,[c,d])=>c.evaluate(u)%d.evaluate(u)],ln2:[Ke,[],()=>Math.LN2],pi:[Ke,[],()=>Math.PI],e:[Ke,[],()=>Math.E],"^":[Ke,[Ke,Ke],(u,[c,d])=>Math.pow(c.evaluate(u),d.evaluate(u))],sqrt:[Ke,[Ke],(u,[c])=>Math.sqrt(c.evaluate(u))],log10:[Ke,[Ke],(u,[c])=>Math.log(c.evaluate(u))/Math.LN10],ln:[Ke,[Ke],(u,[c])=>Math.log(c.evaluate(u))],log2:[Ke,[Ke],(u,[c])=>Math.log(c.evaluate(u))/Math.LN2],sin:[Ke,[Ke],(u,[c])=>Math.sin(c.evaluate(u))],cos:[Ke,[Ke],(u,[c])=>Math.cos(c.evaluate(u))],tan:[Ke,[Ke],(u,[c])=>Math.tan(c.evaluate(u))],asin:[Ke,[Ke],(u,[c])=>Math.asin(c.evaluate(u))],acos:[Ke,[Ke],(u,[c])=>Math.acos(c.evaluate(u))],atan:[Ke,[Ke],(u,[c])=>Math.atan(c.evaluate(u))],min:[Ke,Ul(Ke),(u,c)=>Math.min(...c.map(d=>d.evaluate(u)))],max:[Ke,Ul(Ke),(u,c)=>Math.max(...c.map(d=>d.evaluate(u)))],abs:[Ke,[Ke],(u,[c])=>Math.abs(c.evaluate(u))],round:[Ke,[Ke],(u,[c])=>(c=c.evaluate(u),c<0?-Math.round(-c):Math.round(c))],floor:[Ke,[Ke],(u,[c])=>Math.floor(c.evaluate(u))],ceil:[Ke,[Ke],(u,[c])=>Math.ceil(c.evaluate(u))],"filter-==":[Tt,[gt,nn],(u,[c,d])=>u.properties()[c.value]===d.value],"filter-id-==":[Tt,[nn],(u,[c])=>u.id()===c.value],"filter-type-==":[Tt,[gt],(u,[c])=>u.geometryType()===c.value],"filter-<":[Tt,[gt,nn],(u,[c,d])=>(u=u.properties()[c.value],c=d.value,typeof u==typeof c&&u<c)],"filter-id-<":[Tt,[nn],(u,[c])=>(u=u.id(),c=c.value,typeof u==typeof c&&u<c)],"filter->":[Tt,[gt,nn],(u,[c,d])=>(u=u.properties()[c.value],c=d.value,typeof u==typeof c&&c<u)],"filter-id->":[Tt,[nn],(u,[c])=>(u=u.id(),c=c.value,typeof u==typeof c&&c<u)],"filter-<=":[Tt,[gt,nn],(u,[c,d])=>(u=u.properties()[c.value],c=d.value,typeof u==typeof c&&u<=c)],"filter-id-<=":[Tt,[nn],(u,[c])=>(u=u.id(),c=c.value,typeof u==typeof c&&u<=c)],"filter->=":[Tt,[gt,nn],(u,[c,d])=>(u=u.properties()[c.value],c=d.value,typeof u==typeof c&&c<=u)],"filter-id->=":[Tt,[nn],(u,[c])=>(u=u.id(),c=c.value,typeof u==typeof c&&c<=u)],"filter-has":[Tt,[nn],(u,[c])=>c.value in u.properties()],"filter-has-id":[Tt,[],u=>u.id()!==null&&u.id()!==void 0],"filter-type-in":[Tt,[$(gt)],(u,[c])=>0<=c.value.indexOf(u.geometryType())],"filter-id-in":[Tt,[$(nn)],(u,[c])=>0<=c.value.indexOf(u.id())],"filter-in-small":[Tt,[gt,$(nn)],(u,[c,d])=>0<=d.value.indexOf(u.properties()[c.value])],"filter-in-large":[Tt,[gt,$(nn)],(u,[c,d])=>{for(var m=u.properties()[c.value],b=d.value,E=0,S=d.value.length-1;E<=S;){var A=E+S>>1;if(b[A]===m)return!0;b[A]>m?S=A-1:E=1+A}return!1}],all:{type:Tt,overloads:[[[Tt,Tt],(u,[c,d])=>c.evaluate(u)&&d.evaluate(u)],[Ul(Tt),(u,c)=>{for(const d of c)if(!d.evaluate(u))return!1;return!0}]]},any:{type:Tt,overloads:[[[Tt,Tt],(u,[c,d])=>c.evaluate(u)||d.evaluate(u)],[Ul(Tt),(u,c)=>{for(const d of c)if(d.evaluate(u))return!0;return!1}]]},"!":[Tt,[Tt],(u,[c])=>!c.evaluate(u)],"is-supported-script":[Tt,[gt],(u,[c])=>{var d=u.globals&&u.globals.isSupportedScript;return!d||d(c.evaluate(u))}],upcase:[gt,[gt],(u,[c])=>c.evaluate(u).toUpperCase()],downcase:[gt,[gt],(u,[c])=>c.evaluate(u).toLowerCase()],concat:[gt,Ul(nn),(u,c)=>c.map(d=>ds(d.evaluate(u))).join("")],"resolved-locale":[gt,[Lr],(u,[c])=>c.evaluate(u).resolvedLocale()]});class My{constructor(c,d){this.expression=c,this._warningHistory={},this._evaluator=new Vu,this._defaultValue=d?kb(d):null,this._enumValues=d&&d.type==="enum"?d.values:null}evaluateWithoutErrorHandling(c,d,m,b,E,S){return this._evaluator.globals=c,this._evaluator.feature=d,this._evaluator.featureState=m,this._evaluator.canonical=b,this._evaluator.availableImages=E||null,this._evaluator.formattedSection=S,this.expression.evaluate(this._evaluator)}evaluate(c,d,m,b,E,S){this._evaluator.globals=c,this._evaluator.feature=d||null,this._evaluator.featureState=m||null,this._evaluator.canonical=b,this._evaluator.availableImages=E||null,this._evaluator.formattedSection=S||null;try{var A=this.expression.evaluate(this._evaluator);if(A==null||typeof A=="number"&&A!=A)return this._defaultValue;if(!this._enumValues||A in this._enumValues)return A;throw new ir(`Expected value to be one of ${Object.keys(this._enumValues).map(I=>JSON.stringify(I)).join(", ")}, but found ${JSON.stringify(A)} instead.`)}catch(I){return this._warningHistory[I.message]||(this._warningHistory[I.message]=!0,typeof console<"u"&&console.warn(I.message)),this._defaultValue}}}function Mp(u){return Array.isArray(u)&&0<u.length&&typeof u[0]=="string"&&u[0]in Gu}function Rp(u,c){var d=new Uc(Gu,bp,[],c?(m=c,d={color:Rn,string:gt,number:Ke,enum:gt,boolean:Tt,formatted:Qr,padding:Tr,resolvedImage:oe,variableAnchorOffsetCollection:V},m.type!=="array"?d[m.type]:$(d[m.value]||nn,m.length)):void 0),m=d.parse(u,void 0,void 0,void 0,c&&c.type==="string"?{typeAnnotation:"coerce"}:void 0);return m?Iy(new My(m,c)):qu(d.errors)}class hi{constructor(c,d){this.kind=c,this._styleExpression=d,this.isStateDependent=c!=="constant"&&!vd(d.expression)}evaluateWithoutErrorHandling(c,d,m,b,E,S){return this._styleExpression.evaluateWithoutErrorHandling(c,d,m,b,E,S)}evaluate(c,d,m,b,E,S){return this._styleExpression.evaluate(c,d,m,b,E,S)}}class kp{constructor(c,d,m,b){this.kind=c,this.zoomStops=m,this._styleExpression=d,this.isStateDependent=c!=="camera"&&!vd(d.expression),this.interpolationType=b}evaluateWithoutErrorHandling(c,d,m,b,E,S){return this._styleExpression.evaluateWithoutErrorHandling(c,d,m,b,E,S)}evaluate(c,d,m,b,E,S){return this._styleExpression.evaluate(c,d,m,b,E,S)}interpolationFactor(c,d,m){return this.interpolationType?Ta.interpolationFactor(this.interpolationType,c,d,m):0}}function ur(u){return u._styleExpression!==void 0}function ii(E,c){var d,m,b,E=Rp(E,c);return E.result==="error"?E:(d=wp(m=E.value.expression))||$u(c)?(b=xp(m,["zoom"]))||Mb(c)?(m=function S(A){let I=null;if(A instanceof Cp)I=S(A.result);else if(A instanceof bd){for(const O of A.args)if(I=S(O))break}else(A instanceof Fl||A instanceof Ta)&&A.input instanceof xa&&A.input.name==="zoom"&&(I=A);return I instanceof xt||A.eachChild(O=>{const k=S(O);k instanceof xt?I=k:!I&&k?I=new xt("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):I&&k&&I!==k&&(I=new xt("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),I}(m))||b?m instanceof xt?qu([m]):m instanceof Ta&&!Py(c)?qu([new xt("",'"interpolate" expressions cannot be used with this property')]):m?(b=m instanceof Ta?m.interpolation:void 0,Iy(d?new kp("camera",E.value,m.labels,b):new kp("composite",E.value,m.labels,b))):Iy(d?new hi("constant",E.value):new hi("source",E.value)):qu([new xt("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')]):qu([new xt("","zoom expressions not supported")]):qu([new xt("","data expressions not supported")])}class qr{constructor(c,d){this._parameters=c,this._specification=d,At(this,Rb(this._parameters,this._specification))}static deserialize(c){return new qr(c._parameters,c._specification)}static serialize(c){return{_parameters:c._parameters,_specification:c._specification}}}function Op(u,c){if(Ip(u))return new qr(u,c);if(Mp(u)){var d=ii(u,c);if(d.result==="error")throw new Error(d.value.map(m=>m.key+": "+m.message).join(", "));return d.value}{let m=u;return c.type==="color"&&typeof u=="string"?m=rr.parse(u):c.type!=="padding"||typeof u!="number"&&!Array.isArray(u)?c.type==="variableAnchorOffsetCollection"&&Array.isArray(u)&&(m=Uo.parse(u)):m=Gr.parse(u),{kind:"constant",evaluate:()=>m}}}function kb(u){return u.type==="color"&&Ip(u.default)?new rr(0,0,0,0):u.type==="color"?rr.parse(u.default)||null:u.type==="padding"?Gr.parse(u.default)||null:u.type==="variableAnchorOffsetCollection"?Uo.parse(u.default)||null:u.default===void 0?null:u.default}function Ry(u){if(u===!0||u===!1)return 1;if(Array.isArray(u)&&u.length!==0)switch(u[0]){case"has":return 2<=u.length&&u[1]!=="$id"&&u[1]!=="$type";case"in":return 3<=u.length&&(typeof u[1]!="string"||Array.isArray(u[2]));case"!in":case"!has":case"none":return;case"==":case"!=":case">":case">=":case"<":case"<=":return u.length!==3||Array.isArray(u[1])||Array.isArray(u[2]);case"any":case"all":for(const c of u.slice(1))if(!Ry(c)&&typeof c!="boolean")return;return 1;default:return 1}}const GT={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function Lp(u){if(u==null)return{filter:()=>!0,needGeometry:!1};const c=Rp(u=Ry(u)?u:Np(u),GT);if(c.result==="error")throw new Error(c.value.map(d=>d.key+": "+d.message).join(", "));return{filter:(d,m,b)=>c.value.evaluate(d,m,{},b),needGeometry:function d(m){if(!Array.isArray(m))return!1;if(m[0]==="within")return!0;for(let b=1;b<m.length;b++)if(d(m[b]))return!0;return!1}(u)}}function Ob(u,c){return u<c?-1:c<u?1:0}function Np(u){var c,d;return!u||(c=u[0],u.length<=1?c!=="any":c==="=="?ky(u[1],u[2],"=="):c==="!="?Dp(ky(u[1],u[2],"==")):c==="<"||c===">"||c==="<="||c===">="?ky(u[1],u[2],c):c==="any"?(d=u.slice(1),["any"].concat(d.map(Np))):c==="all"?["all"].concat(u.slice(1).map(Np)):c==="none"?["all"].concat(u.slice(1).map(Np).map(Dp)):c==="in"?Lb(u[1],u.slice(2)):c==="!in"?Dp(Lb(u[1],u.slice(2))):c==="has"?Oy(u[1]):c==="!has"?Dp(Oy(u[1])):c!=="within"||u)}function ky(u,c,d){switch(u){case"$type":return["filter-type-"+d,c];case"$id":return["filter-id-"+d,c];default:return["filter-"+d,u,c]}}function Lb(u,c){if(c.length===0)return!1;switch(u){case"$type":return["filter-type-in",["literal",c]];case"$id":return["filter-id-in",["literal",c]];default:return 200<c.length&&!c.some(d=>typeof d!=typeof c[0])?["filter-in-large",u,["literal",c.sort(Ob)]]:["filter-in-small",u,["literal",c]]}}function Oy(u){switch(u){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",u]}}function Dp(u){return["!",u]}function Nb(u){let c="";for(const d of Ae)c+="/"+function m(b){var E=typeof b;if(E=="number"||E=="boolean"||E=="string"||b==null)return JSON.stringify(b);if(Array.isArray(b)){let I="[";for(const O of b)I+=m(O)+",";return I+"]"}var S=Object.keys(b).sort();let A="{";for(let I=0;I<S.length;I++)A+=`${JSON.stringify(S[I])}:${m(b[S[I]])},`;return A+"}"}(u[d]);return c}function Db(d){var c=d.key,d=d.value;return d?[new Te(c,d,"constants have been deprecated as of v8")]:[]}function di(u){return u instanceof Number||u instanceof String||u instanceof Boolean?u.valueOf():u}function zl(u){if(Array.isArray(u))return u.map(zl);if(u instanceof Object&&!(u instanceof Number||u instanceof String||u instanceof Boolean)){var c={};for(const d in u)c[d]=zl(u[d]);return c}return di(u)}function Va(u){var c=u.key,d=u.value,m=u.valueSpec||{},b=u.objectElementValidators||{},E=u.style,S=u.styleSpec,A=u.validateSpec;let I=[];if(u=yr(d),u!=="object")return[new Te(c,d,`object expected, ${u} found`)];for(const U in d){var O=U.split(".")[0],k=m[O]||m["*"];let W;if(b[O])W=b[O];else if(m[O])W=A;else if(b["*"])W=b["*"];else{if(!m["*"]){I.push(new Te(c,d[U],`unknown property "${U}"`));continue}W=A}I=I.concat(W({key:(c&&c+".")+U,value:d[U],valueSpec:k,style:E,styleSpec:S,object:d,objectKey:U,validateSpec:A},d))}for(const U in m)b[U]||m[U].required&&m[U].default===void 0&&d[U]===void 0&&I.push(new Te(c,d,`missing required property "${U}"`));return I}function Ly(u){var c=u.value,d=u.valueSpec,m=u.validateSpec,b=u.style,E=u.styleSpec,S=u.key,A=u.arrayElementValidator||m;if(yr(c)!=="array")return[new Te(S,c,`array expected, ${yr(c)} found`)];if(d.length&&c.length!==d.length)return[new Te(S,c,`array length ${d.length} expected, length ${c.length} found`)];if(d["min-length"]&&c.length<d["min-length"])return[new Te(S,c,`array length at least ${d["min-length"]} expected, length ${c.length} found`)];let I={type:d.value,values:d.values},O=(E.$version<7&&(I.function=d.function),yr(d.value)==="object"&&(I=d.value),[]);for(let k=0;k<c.length;k++)O=O.concat(A({array:c,arrayIndex:k,value:c[k],valueSpec:I,validateSpec:u.validateSpec,style:b,styleSpec:E,key:`${S}[${k}]`}));return O}function Ny(m){var c=m.key,d=m.value,m=m.valueSpec;let b=yr(d);return(b=b==="number"&&d!=d?"NaN":b)!=="number"?[new Te(c,d,`number expected, ${b} found`)]:"minimum"in m&&d<m.minimum?[new Te(c,d,d+" is less than the minimum value "+m.minimum)]:"maximum"in m&&d>m.maximum?[new Te(c,d,d+" is greater than the maximum value "+m.maximum)]:[]}function Fb(u){const c=u.valueSpec,d=di(u.value.type);let m,b={},E,S;var A=d!=="categorical"&&u.value.property===void 0,I=!A;const O=yr(u.value.stops)==="array"&&yr(u.value.stops[0])==="array"&&yr(u.value.stops[0][0])==="object";var k=Va({key:u.key,value:u.value,valueSpec:u.styleSpec.function,validateSpec:u.validateSpec,style:u.style,styleSpec:u.styleSpec,objectElementValidators:{stops:function(re){if(d==="identity")return[new Te(re.key,re.value,'identity function may not have a "stops" property')];let ie=[];var fe=re.value;return ie=ie.concat(Ly({key:re.key,value:fe,valueSpec:re.valueSpec,validateSpec:re.validateSpec,style:re.style,styleSpec:re.styleSpec,arrayElementValidator:U})),yr(fe)==="array"&&fe.length===0&&ie.push(new Te(re.key,fe,"array must have at least one stop")),ie},default:function(re){return re.validateSpec({key:re.key,value:re.value,valueSpec:c,validateSpec:re.validateSpec,style:re.style,styleSpec:re.styleSpec})}}});return d==="identity"&&A&&k.push(new Te(u.key,u.value,'missing required property "property"')),d==="identity"||u.value.stops||k.push(new Te(u.key,u.value,'missing required property "stops"')),d==="exponential"&&u.valueSpec.expression&&!Py(u.valueSpec)&&k.push(new Te(u.key,u.value,"exponential functions not supported")),8<=u.styleSpec.$version&&(I&&!$u(u.valueSpec)?k.push(new Te(u.key,u.value,"property functions not supported")):A&&!Mb(u.valueSpec)&&k.push(new Te(u.key,u.value,"zoom functions not supported"))),d!=="categorical"&&!O||u.value.property!==void 0||k.push(new Te(u.key,u.value,'"property" property is required')),k;function U(re){let ie=[];var fe=re.value,we=re.key;if(yr(fe)!=="array")return[new Te(we,fe,`array expected, ${yr(fe)} found`)];if(fe.length!==2)return[new Te(we,fe,`array length 2 expected, length ${fe.length} found`)];if(O){if(yr(fe[0])!=="object")return[new Te(we,fe,`object expected, ${yr(fe[0])} found`)];if(fe[0].zoom===void 0)return[new Te(we,fe,"object stop key must have zoom")];if(fe[0].value===void 0)return[new Te(we,fe,"object stop key must have value")];if(S&&S>di(fe[0].zoom))return[new Te(we,fe[0].zoom,"stop zoom values must appear in ascending order")];di(fe[0].zoom)!==S&&(S=di(fe[0].zoom),E=void 0,b={}),ie=ie.concat(Va({key:we+"[0]",value:fe[0],valueSpec:{zoom:{}},validateSpec:re.validateSpec,style:re.style,styleSpec:re.styleSpec,objectElementValidators:{zoom:Ny,value:W}}))}else ie=ie.concat(W({key:we+"[0]",value:fe[0],valueSpec:{},validateSpec:re.validateSpec,style:re.style,styleSpec:re.styleSpec},fe));return Mp(zl(fe[1]))?ie.concat([new Te(we+"[1]",fe[1],"expressions are not allowed in function stops.")]):ie.concat(re.validateSpec({key:we+"[1]",value:fe[1],valueSpec:c,validateSpec:re.validateSpec,style:re.style,styleSpec:re.styleSpec}))}function W(re,de){var fe=yr(re.value),we=di(re.value),de=re.value!==null?re.value:de;if(m){if(fe!==m)return[new Te(re.key,de,fe+" stop domain type must match previous stop domain type "+m)]}else m=fe;if(fe!=="number"&&fe!=="string"&&fe!=="boolean")return[new Te(re.key,de,"stop domain value must be a number, string, or boolean")];if(fe==="number"||d==="categorical")return d!=="categorical"||fe!=="number"||isFinite(we)&&Math.floor(we)===we?d!=="categorical"&&fe==="number"&&E!==void 0&&we<E?[new Te(re.key,de,"stop domain values must appear in ascending order")]:(E=we,d==="categorical"&&we in b?[new Te(re.key,de,"stop domain values must be unique")]:(b[we]=!0,[])):[new Te(re.key,de,"integer expected, found "+we)];{let Me=`number expected, ${fe} found`;return $u(c)&&d===void 0&&(Me+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Te(re.key,de,Me)]}}}function Wu(u){var c=(u.expressionContext==="property"?ii:Rp)(zl(u.value),u.valueSpec);if(c.result==="error")return c.value.map(d=>new Te(""+u.key+d.key,u.value,d.message));if(c=c.value.expression||c.value._styleExpression.expression,u.expressionContext==="property"&&u.propertyKey==="text-font"&&!c.outputDefined())return[new Te(u.key,u.value,`Invalid data expression for "${u.propertyKey}". Output values must be contained as literals within the expression.`)];if(u.expressionContext==="property"&&u.propertyType==="layout"&&!vd(c))return[new Te(u.key,u.value,'"feature-state" data expressions are not supported with layout properties.')];if(u.expressionContext==="filter"&&!vd(c))return[new Te(u.key,u.value,'"feature-state" data expressions are not supported with filters.')];if(u.expressionContext&&u.expressionContext.indexOf("cluster")===0){if(!xp(c,["zoom","feature-state"]))return[new Te(u.key,u.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(u.expressionContext==="cluster-initial"&&!wp(c))return[new Te(u.key,u.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Td(m){var c=m.key,d=m.value,m=m.valueSpec,b=[];return Array.isArray(m.values)?m.values.indexOf(di(d))===-1&&b.push(new Te(c,d,`expected one of [${m.values.join(", ")}], ${JSON.stringify(d)} found`)):Object.keys(m.values).indexOf(di(d))===-1&&b.push(new Te(c,d,`expected one of [${Object.keys(m.values).join(", ")}], ${JSON.stringify(d)} found`)),b}function Dy(u){return Ry(zl(u.value))?Wu(At({},u,{expressionContext:"filter",valueSpec:{value:"boolean"}})):function c(d){const m=d.value,b=d.key;if(yr(m)!=="array")return[new Te(b,m,`array expected, ${yr(m)} found`)];const E=d.styleSpec;let S,A=[];if(m.length<1)return[new Te(b,m,"filter array must have at least 1 element")];switch(A=A.concat(Td({key:b+"[0]",value:m[0],valueSpec:E.filter_operator,style:d.style,styleSpec:d.styleSpec})),di(m[0])){case"<":case"<=":case">":case">=":2<=m.length&&di(m[1])==="$type"&&A.push(new Te(b,m,`"$type" cannot be use with operator "${m[0]}"`));case"==":case"!=":m.length!==3&&A.push(new Te(b,m,`filter array for operator "${m[0]}" must have 3 elements`));case"in":case"!in":2<=m.length&&(S=yr(m[1]))!=="string"&&A.push(new Te(b+"[1]",m[1],`string expected, ${S} found`));for(let I=2;I<m.length;I++)S=yr(m[I]),di(m[1])==="$type"?A=A.concat(Td({key:`${b}[${I}]`,value:m[I],valueSpec:E.geometry_type,style:d.style,styleSpec:d.styleSpec})):S!=="string"&&S!=="number"&&S!=="boolean"&&A.push(new Te(`${b}[${I}]`,m[I],`string, number, or boolean expected, ${S} found`));break;case"any":case"all":case"none":for(let I=1;I<m.length;I++)A=A.concat(c({key:`${b}[${I}]`,value:m[I],style:d.style,styleSpec:d.styleSpec}));break;case"has":case"!has":S=yr(m[1]),m.length!==2?A.push(new Te(b,m,`filter array for "${m[0]}" operator must have 2 elements`)):S!=="string"&&A.push(new Te(b+"[1]",m[1],`string expected, ${S} found`));break;case"within":S=yr(m[1]),m.length!==2?A.push(new Te(b,m,`filter array for "${m[0]}" operator must have 2 elements`)):S!=="object"&&A.push(new Te(b+"[1]",m[1],`object expected, ${S} found`))}return A}(u)}function Bb(u,c){var d=u.key,m=u.validateSpec,b=u.style,E=u.styleSpec,S=u.value,A=u.objectKey,I=E[c+"_"+u.layerType];if(!I)return[];var O=A.match(/^(.*)-transition$/);if(c==="paint"&&O&&I[O[1]]&&I[O[1]].transition)return m({key:d,value:S,valueSpec:E.transition,style:b,styleSpec:E});if(O=u.valueSpec||I[A],!O)return[new Te(d,S,`unknown property "${A}"`)];let k;return yr(S)==="string"&&$u(O)&&!O.tokens&&(k=/^{([^}]+)}$/.exec(S))?[new Te(d,S,`"${A}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(k[1])} }\`.`)]:(I=[],u.layerType==="symbol"&&(A==="text-field"&&b&&!b.glyphs&&I.push(new Te(d,S,'use of "text-field" requires a style "glyphs" property')),A==="text-font")&&Ip(zl(S))&&di(S.type)==="identity"&&I.push(new Te(d,S,'"text-font" does not support identity functions')),I.concat(m({key:u.key,value:S,valueSpec:O,style:b,styleSpec:E,expressionContext:"property",propertyType:c,propertyKey:A})))}function Fy(u){return Bb(u,"paint")}function By(u){return Bb(u,"layout")}function Sd(u){let c=[];const d=u.value,m=u.key;var b,E,S=u.style;const A=u.styleSpec;d.type||d.ref||c.push(new Te(m,d,'either "type" or "ref" is required'));let I=di(d.type);const O=di(d.ref);if(d.id){var k=di(d.id);for(let W=0;W<u.arrayIndex;W++){var U=S.layers[W];di(U.id)===k&&c.push(new Te(m,d.id,`duplicate layer id "${d.id}", previously used at line `+U.id.__line__))}}if("ref"in d){["type","source","source-layer","filter","layout"].forEach(re=>{re in d&&c.push(new Te(m,d[re],`"${re}" is prohibited for ref layers`))});let W;S.layers.forEach(re=>{di(re.id)===O&&(W=re)}),W?W.ref?c.push(new Te(m,d.ref,"ref cannot reference another ref layer")):I=di(W.type):c.push(new Te(m,d.ref,`ref layer "${O}" not found`))}else I!=="background"&&(d.source?(E=(b=S.sources&&S.sources[d.source])&&di(b.type),b?E==="vector"&&I==="raster"?c.push(new Te(m,d.source,`layer "${d.id}" requires a raster source`)):E!=="raster-dem"&&I==="hillshade"?c.push(new Te(m,d.source,`layer "${d.id}" requires a raster-dem source`)):E==="raster"&&I!=="raster"?c.push(new Te(m,d.source,`layer "${d.id}" requires a vector source`)):E!=="vector"||d["source-layer"]?E==="raster-dem"&&I!=="hillshade"?c.push(new Te(m,d.source,"raster-dem source can only be used with layer type 'hillshade'.")):I!=="line"||!d.paint||!d.paint["line-gradient"]||E==="geojson"&&b.lineMetrics||c.push(new Te(m,d,`layer "${d.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):c.push(new Te(m,d,`layer "${d.id}" must specify a "source-layer"`)):c.push(new Te(m,d.source,`source "${d.source}" not found`))):c.push(new Te(m,d,'missing required property "source"')));return c=c.concat(Va({key:m,value:d,valueSpec:A.layer,style:u.style,styleSpec:u.styleSpec,validateSpec:u.validateSpec,objectElementValidators:{"*"(){return[]},type(){return u.validateSpec({key:m+".type",value:d.type,valueSpec:A.layer.type,style:u.style,styleSpec:u.styleSpec,validateSpec:u.validateSpec,object:d,objectKey:"type"})},filter:Dy,layout(W){return Va({layer:d,key:W.key,value:W.value,style:W.style,styleSpec:W.styleSpec,validateSpec:W.validateSpec,objectElementValidators:{"*"(re){return By(At({layerType:I},re))}}})},paint(W){return Va({layer:d,key:W.key,value:W.value,style:W.style,styleSpec:W.styleSpec,validateSpec:W.validateSpec,objectElementValidators:{"*"(re){return Fy(At({layerType:I},re))}}})}}}))}function jl(d){var c=d.value,d=d.key,m=yr(c);return m!=="string"?[new Te(d,c,`string expected, ${m} found`)]:[]}const Ub={promoteId:function({key:u,value:c}){{if(yr(c)==="string")return jl({key:u,value:c});var d=[];for(const m in c)d.push(...jl({key:u+"."+m,value:c[m]}));return d}}};function zb(u){var c=u.value,d=u.key,m=u.styleSpec,b=u.style,E=u.validateSpec;if(!c.type)return[new Te(d,c,'"type" is required')];var S=di(c.type);let A;switch(S){case"vector":case"raster":return A=Va({key:d,value:c,valueSpec:m["source_"+S.replace("-","_")],style:u.style,styleSpec:m,objectElementValidators:Ub,validateSpec:E});case"raster-dem":return A=function(k){var U=(de=k.sourceName)!=null?de:"",W=k.value,re=k.styleSpec,ie=re.source_raster_dem,fe=k.style;let we=[];var de=yr(W);if(W!==void 0)if(de!=="object")we.push(new Te("source_raster_dem",W,`object expected, ${de} found`));else{var Me=di(W.encoding)==="custom",Ve=["redFactor","greenFactor","blueFactor","baseShift"],$e=k.value.encoding?`"${k.value.encoding}"`:"Default";for(const Ye in W)!Me&&Ve.includes(Ye)?we.push(new Te(Ye,W[Ye],`In "${U}": "${Ye}" is only valid when "encoding" is set to "custom". ${$e} encoding found`)):ie[Ye]?we=we.concat(k.validateSpec({key:Ye,value:W[Ye],valueSpec:ie[Ye],validateSpec:k.validateSpec,style:fe,styleSpec:re})):we.push(new Te(Ye,W[Ye],`unknown property "${Ye}"`))}return we}({sourceName:d,value:c,style:u.style,styleSpec:m,validateSpec:E});case"geojson":if(A=Va({key:d,value:c,valueSpec:m.source_geojson,style:b,styleSpec:m,validateSpec:E,objectElementValidators:Ub}),c.cluster)for(const k in c.clusterProperties){var[O,I]=c.clusterProperties[k],O=typeof O=="string"?[O,["accumulated"],["get",k]]:O;A.push(...Wu({key:`${d}.${k}.map`,value:I,validateSpec:E,expressionContext:"cluster-map"})),A.push(...Wu({key:`${d}.${k}.reduce`,value:O,validateSpec:E,expressionContext:"cluster-reduce"}))}return A;case"video":return Va({key:d,value:c,valueSpec:m.source_video,style:b,validateSpec:E,styleSpec:m});case"image":return Va({key:d,value:c,valueSpec:m.source_image,style:b,validateSpec:E,styleSpec:m});case"canvas":return[new Te(d,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Td({key:d+".type",value:c.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:b,validateSpec:E,styleSpec:m})}}function jb(u){var c=u.value,d=u.styleSpec,m=d.light,b=u.style;let E=[];var S=yr(c);if(c!==void 0){if(S!=="object")return E=E.concat([new Te("light",c,`object expected, ${S} found`)]);for(const I in c){var A=I.match(/^(.*)-transition$/);E=A&&m[A[1]]&&m[A[1]].transition?E.concat(u.validateSpec({key:I,value:c[I],valueSpec:d.transition,validateSpec:u.validateSpec,style:b,styleSpec:d})):m[I]?E.concat(u.validateSpec({key:I,value:c[I],valueSpec:m[I],validateSpec:u.validateSpec,style:b,styleSpec:d})):E.concat([new Te(I,c[I],`unknown property "${I}"`)])}}return E}function Vb(E){var c=E.value,d=E.styleSpec,m=d.sky,b=E.style,E=yr(c);if(c===void 0)return[];if(E!=="object")return[new Te("sky",c,`object expected, ${E} found`)];let S=[];for(const A in c)S=m[A]?S.concat(pc({key:A,value:c[A],valueSpec:m[A],style:b,styleSpec:d})):S.concat([new Te(A,c[A],`unknown property "${A}"`)]);return S}function Uy(u){var c=u.value,d=u.styleSpec,m=d.terrain,b=u.style;let E=[];var S=yr(c);if(c!==void 0){if(S!=="object")return E=E.concat([new Te("terrain",c,`object expected, ${S} found`)]);for(const A in c)E=m[A]?E.concat(u.validateSpec({key:A,value:c[A],valueSpec:m[A],validateSpec:u.validateSpec,style:b,styleSpec:d})):E.concat([new Te(A,c[A],`unknown property "${A}"`)])}return E}function Hb(u){let c=[];var d=u.value,m=u.key;if(Array.isArray(d)){var b=[],E=[];for(const S in d)d[S].id&&b.includes(d[S].id)&&c.push(new Te(m,d,`all the sprites' ids must be unique, but ${d[S].id} is duplicated`)),b.push(d[S].id),d[S].url&&E.includes(d[S].url)&&c.push(new Te(m,d,`all the sprites' URLs must be unique, but ${d[S].url} is duplicated`)),E.push(d[S].url),c=c.concat(Va({key:`${m}[${S}]`,value:d[S],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:u.validateSpec}));return c}return jl({key:m,value:d})}const Fp={"*"(){return[]},array:Ly,boolean:function(d){var c=d.value,d=d.key,m=yr(c);return m!=="boolean"?[new Te(d,c,`boolean expected, ${m} found`)]:[]},number:Ny,color:function(u){var c=u.key,d=yr(u=u.value);return d!=="string"?[new Te(c,u,`color expected, ${d} found`)]:rr.parse(String(u))?[]:[new Te(c,u,`color expected, "${u}" found`)]},constants:Db,enum:Td,filter:Dy,function:Fb,layer:Sd,object:Va,source:zb,light:jb,sky:Vb,terrain:Uy,string:jl,formatted:function(u){return jl(u).length===0?[]:Wu(u)},resolvedImage:function(u){return jl(u).length===0?[]:Wu(u)},padding:function(u){var c=u.key,d=u.value;if(yr(d)!=="array")return Ny({key:c,value:d,valueSpec:{}});{if(d.length<1||4<d.length)return[new Te(c,d,`padding requires 1 to 4 values; ${d.length} values found`)];var m={type:"number"};let b=[];for(let E=0;E<d.length;E++)b=b.concat(u.validateSpec({key:`${c}[${E}]`,value:d[E],validateSpec:u.validateSpec,valueSpec:m}));return b}},variableAnchorOffsetCollection:function(u){var c=u.key,d=u.value,m=yr(d),b=u.styleSpec;if(m!=="array"||d.length<1||d.length%2!=0)return[new Te(c,d,"variableAnchorOffsetCollection requires a non-empty array of even length")];let E=[];for(let S=0;S<d.length;S+=2)E=(E=E.concat(Td({key:`${c}[${S}]`,value:d[S],valueSpec:b.layout_symbol["text-anchor"]}))).concat(Ly({key:`${c}[${S+1}]`,value:d[S+1],valueSpec:{length:2,value:"number"},validateSpec:u.validateSpec,style:u.style,styleSpec:b}));return E},sprite:Hb};function pc(u){var c=u.value,d=u.valueSpec,m=u.styleSpec;return u.validateSpec=pc,d.expression&&Ip(di(c))?Fb(u):d.expression&&Mp(zl(c))?Wu(u):d.type&&Fp[d.type]?Fp[d.type](u):Va(At({},u,{valueSpec:d.type?m[d.type]:d}))}function Cd(m){var c=m.value,d=m.key,m=jl(m);return m.length||(c.indexOf("{fontstack}")===-1&&m.push(new Te(d,c,'"glyphs" url must include a "{fontstack}" token')),c.indexOf("{range}")===-1&&m.push(new Te(d,c,'"glyphs" url must include a "{range}" token'))),m}function aa(u,c=q){let d=[];return d=d.concat(pc({key:"",value:u,valueSpec:c.$root,styleSpec:c,style:u,validateSpec:pc,objectElementValidators:{glyphs:Cd,"*"(){return[]}}})),zy(d=u.constants?d.concat(Db({key:"constants",value:u.constants,style:u,styleSpec:c,validateSpec:pc})):d)}function Ha(u){return function(c){return u({...c,validateSpec:pc})}}function zy(u){return[].concat(u).sort((c,d)=>c.line-d.line)}function fs(u){return function(...c){return zy(u.apply(this,c))}}aa.source=fs(Ha(zb)),aa.sprite=fs(Ha(Hb)),aa.glyphs=fs(Ha(Cd)),aa.light=fs(Ha(jb)),aa.sky=fs(Ha(Vb)),aa.terrain=fs(Ha(Uy)),aa.layer=fs(Ha(Sd)),aa.filter=fs(Ha(Dy)),aa.paintProperty=fs(Ha(Fy)),aa.layoutProperty=fs(Ha(By));const Ad=aa;wd=Ad.light;const qT=Ad.paintProperty,$T=Ad.layoutProperty;function Gb(u,c){let d=!1;if(c&&c.length)for(const m of c)u.fire(new Q(new Error(m.message))),d=!0;return d}class Id{constructor(c,d,m){var b=this.cells=[];if(c instanceof ArrayBuffer){this.arrayBuffer=c;var E=new Int32Array(this.arrayBuffer);c=E[0],d=E[1],m=E[2],this.d=d+2*m;for(let k=0;k<this.d*this.d;k++){var S=E[3+k],A=E[3+k+1];b.push(S===A?null:E.subarray(S,A))}var I=E[3+b.length],O=E[3+b.length+1];this.keys=E.subarray(I,O),this.bboxes=E.subarray(O),this.insert=this._insertReadonly}else{this.d=d+2*m;for(let k=0;k<this.d*this.d;k++)b.push([]);this.keys=[],this.bboxes=[]}this.n=d,this.extent=c,this.padding=m,this.scale=d/c,this.uid=0,I=m/d*c,this.min=-I,this.max=c+I}insert(c,d,m,b,E){this._forEachCell(d,m,b,E,this._insertCell,this.uid++,void 0,void 0),this.keys.push(c),this.bboxes.push(d),this.bboxes.push(m),this.bboxes.push(b),this.bboxes.push(E)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(c,d,m,b,E,S){this.cells[E].push(S)}query(c,d,m,b,E){var S=this.min,A=this.max;return c<=S&&d<=S&&A<=m&&A<=b&&!E?Array.prototype.slice.call(this.keys):(this._forEachCell(c,d,m,b,this._queryCell,S=[],{},E),S)}_queryCell(c,d,m,b,E,S,A,I){var O=this.cells[E];if(O!==null){var k=this.keys,U=this.bboxes;for(let ie=0;ie<O.length;ie++){var W,re=O[ie];A[re]===void 0&&(W=4*re,(I?I(U[0+W],U[1+W],U[2+W],U[3+W]):c<=U[2+W]&&d<=U[3+W]&&m>=U[0+W]&&b>=U[1+W])?(A[re]=!0,S.push(k[re])):A[re]=!1)}}}_forEachCell(c,d,m,b,E,S,A,I){var O=this._convertToCellCoord(c),k=this._convertToCellCoord(d),U=this._convertToCellCoord(m),W=this._convertToCellCoord(b);for(let ie=O;ie<=U;ie++)for(let fe=k;fe<=W;fe++){var re=this.d*fe+ie;if((!I||I(this._convertFromCellCoord(ie),this._convertFromCellCoord(fe),this._convertFromCellCoord(ie+1),this._convertFromCellCoord(fe+1)))&&E.call(this,c,d,m,b,re,S,A,I))return}}_convertFromCellCoord(c){return(c-this.padding)/this.scale}_convertToCellCoord(c){return Math.max(0,Math.min(this.d-1,Math.floor(c*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;var c=this.cells,d=3+this.cells.length+1+1;let m=0;for(let A=0;A<this.cells.length;A++)m+=this.cells[A].length;var b=new Int32Array(d+m+this.keys.length+this.bboxes.length);b[0]=this.extent,b[1]=this.n,b[2]=this.padding;let E=d;for(let A=0;A<c.length;A++){var S=c[A];b[3+A]=E,b.set(S,E),E+=S.length}return b[3+c.length]=E,b.set(this.keys,E),E+=this.keys.length,b[3+c.length+1]=E,b.set(this.bboxes,E),E+=this.bboxes.length,b.buffer}static serialize(c,d){return c=c.toArrayBuffer(),d&&d.push(c),{buffer:c}}static deserialize(c){return new Id(c.buffer)}}const ps={};function Vt(u,c,d={}){if(ps[u])throw new Error(u+" is already registered.");Object.defineProperty(c,"_classRegistryKey",{value:u,writeable:!1}),ps[u]={klass:c,omit:d.omit||[],shallow:d.shallow||[]}}Vt("Object",Object),Vt("TransferableGridIndex",Id),Vt("Color",rr),Vt("Error",Error),Vt("AJAXError",Ot),Vt("ResolvedImage",zo),Vt("StylePropertyFunction",qr),Vt("StyleExpression",My,{omit:["_evaluator"]}),Vt("ZoomDependentExpression",kp),Vt("ZoomConstantExpression",hi),Vt("CompoundExpression",xa,{omit:["_evaluate"]});for(const u in Gu)Gu[u]._classRegistryKey||Vt("Expression_"+u,Gu[u]);function sa(u){return u&&typeof ArrayBuffer<"u"&&(u instanceof ArrayBuffer||u.constructor&&u.constructor.name==="ArrayBuffer")}function gc(u,c){if(u==null||typeof u=="boolean"||typeof u=="number"||typeof u=="string"||u instanceof Boolean||u instanceof Number||u instanceof String||u instanceof Date||u instanceof RegExp||u instanceof Blob||u instanceof Error)return u;if(sa(u)||at(u))return c&&c.push(u),u;if(ArrayBuffer.isView(u))return m=u,c&&c.push(m.buffer),m;if(u instanceof ImageData)return c&&c.push(u.data.buffer),u;if(Array.isArray(u)){var d=[];for(const A of u)d.push(gc(A,c));return d}if(typeof u!="object")throw new Error("can't serialize object of type "+typeof u);var m=u.constructor,b=m._classRegistryKey;if(!b)throw new Error("can't serialize object of unregistered class "+m.name);if(!ps[b])throw new Error(b+" is not registered.");var E,S=m.serialize?m.serialize(u,c):{};if(m.serialize){if(c&&S===c[c.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const A in u)!u.hasOwnProperty(A)||0<=ps[b].omit.indexOf(A)||(E=u[A],S[A]=0<=ps[b].shallow.indexOf(A)?E:gc(E,c));u instanceof Error&&(S.message=u.message)}if(S.$name)throw new Error("$name property is reserved for worker serialization logic.");return b!=="Object"&&(S.$name=b),S}function Yu(u){if(u==null||typeof u=="boolean"||typeof u=="number"||typeof u=="string"||u instanceof Boolean||u instanceof Number||u instanceof String||u instanceof Date||u instanceof RegExp||u instanceof Blob||u instanceof Error||sa(u)||at(u)||ArrayBuffer.isView(u)||u instanceof ImageData)return u;if(Array.isArray(u))return u.map(Yu);if(typeof u!="object")throw new Error("can't deserialize object of type "+typeof u);var c=u.$name||"Object";if(!ps[c])throw new Error("can't deserialize unregistered class "+c);var d=ps[c].klass;if(!d)throw new Error("can't deserialize unregistered class "+c);if(d.deserialize)return d.deserialize(u);var m,b=Object.create(d.prototype);for(const E of Object.keys(u))E!=="$name"&&(m=u[E],b[E]=0<=ps[c].shallow.indexOf(E)?m:Yu(m));return b}class qb{constructor(){this.first=!0}update(c,d){var m=Math.floor(c);return this.first?(this.first=!1,this.lastIntegerZoom=m,this.lastIntegerZoomTime=0,this.lastZoom=c,this.lastFloorZoom=m,!0):(this.lastFloorZoom>m?(this.lastIntegerZoom=m+1,this.lastIntegerZoomTime=d):this.lastFloorZoom<m&&(this.lastIntegerZoom=m,this.lastIntegerZoomTime=d),c!==this.lastZoom&&(this.lastZoom=c,this.lastFloorZoom=m,!0))}}const Ft={"Latin-1 Supplement":u=>128<=u&&u<=255,Arabic:u=>1536<=u&&u<=1791,"Arabic Supplement":u=>1872<=u&&u<=1919,"Arabic Extended-A":u=>2208<=u&&u<=2303,"Hangul Jamo":u=>4352<=u&&u<=4607,"Unified Canadian Aboriginal Syllabics":u=>5120<=u&&u<=5759,Khmer:u=>6016<=u&&u<=6143,"Unified Canadian Aboriginal Syllabics Extended":u=>6320<=u&&u<=6399,"General Punctuation":u=>8192<=u&&u<=8303,"Letterlike Symbols":u=>8448<=u&&u<=8527,"Number Forms":u=>8528<=u&&u<=8591,"Miscellaneous Technical":u=>8960<=u&&u<=9215,"Control Pictures":u=>9216<=u&&u<=9279,"Optical Character Recognition":u=>9280<=u&&u<=9311,"Enclosed Alphanumerics":u=>9312<=u&&u<=9471,"Geometric Shapes":u=>9632<=u&&u<=9727,"Miscellaneous Symbols":u=>9728<=u&&u<=9983,"Miscellaneous Symbols and Arrows":u=>11008<=u&&u<=11263,"CJK Radicals Supplement":u=>11904<=u&&u<=12031,"Kangxi Radicals":u=>12032<=u&&u<=12255,"Ideographic Description Characters":u=>12272<=u&&u<=12287,"CJK Symbols and Punctuation":u=>12288<=u&&u<=12351,Hiragana:u=>12352<=u&&u<=12447,Katakana:u=>12448<=u&&u<=12543,Bopomofo:u=>12544<=u&&u<=12591,"Hangul Compatibility Jamo":u=>12592<=u&&u<=12687,Kanbun:u=>12688<=u&&u<=12703,"Bopomofo Extended":u=>12704<=u&&u<=12735,"CJK Strokes":u=>12736<=u&&u<=12783,"Katakana Phonetic Extensions":u=>12784<=u&&u<=12799,"Enclosed CJK Letters and Months":u=>12800<=u&&u<=13055,"CJK Compatibility":u=>13056<=u&&u<=13311,"CJK Unified Ideographs Extension A":u=>13312<=u&&u<=19903,"Yijing Hexagram Symbols":u=>19904<=u&&u<=19967,"CJK Unified Ideographs":u=>19968<=u&&u<=40959,"Yi Syllables":u=>40960<=u&&u<=42127,"Yi Radicals":u=>42128<=u&&u<=42191,"Hangul Jamo Extended-A":u=>43360<=u&&u<=43391,"Hangul Syllables":u=>44032<=u&&u<=55215,"Hangul Jamo Extended-B":u=>55216<=u&&u<=55295,"Private Use Area":u=>57344<=u&&u<=63743,"CJK Compatibility Ideographs":u=>63744<=u&&u<=64255,"Arabic Presentation Forms-A":u=>64336<=u&&u<=65023,"Vertical Forms":u=>65040<=u&&u<=65055,"CJK Compatibility Forms":u=>65072<=u&&u<=65103,"Small Form Variants":u=>65104<=u&&u<=65135,"Arabic Presentation Forms-B":u=>65136<=u&&u<=65279,"Halfwidth and Fullwidth Forms":u=>65280<=u&&u<=65519};function Vl(u){for(const c of u)if(Pd(c.charCodeAt(0)))return!0;return!1}function $b(u){for(const d of u)if(c=d.charCodeAt(0),Ft.Arabic(c)||Ft["Arabic Supplement"](c)||Ft["Arabic Extended-A"](c)||Ft["Arabic Presentation Forms-A"](c)||Ft["Arabic Presentation Forms-B"](c))return;var c;return 1}function Pd(u){return u===746||u===747||!(u<4352)&&(Ft["Bopomofo Extended"](u)||Ft.Bopomofo(u)||Ft["CJK Compatibility Forms"](u)&&!(65097<=u&&u<=65103)||Ft["CJK Compatibility Ideographs"](u)||Ft["CJK Compatibility"](u)||Ft["CJK Radicals Supplement"](u)||Ft["CJK Strokes"](u)||!(!Ft["CJK Symbols and Punctuation"](u)||12296<=u&&u<=12305||12308<=u&&u<=12319||u===12336)||Ft["CJK Unified Ideographs Extension A"](u)||Ft["CJK Unified Ideographs"](u)||Ft["Enclosed CJK Letters and Months"](u)||Ft["Hangul Compatibility Jamo"](u)||Ft["Hangul Jamo Extended-A"](u)||Ft["Hangul Jamo Extended-B"](u)||Ft["Hangul Jamo"](u)||Ft["Hangul Syllables"](u)||Ft.Hiragana(u)||Ft["Ideographic Description Characters"](u)||Ft.Kanbun(u)||Ft["Kangxi Radicals"](u)||Ft["Katakana Phonetic Extensions"](u)||Ft.Katakana(u)&&u!==12540||!(!Ft["Halfwidth and Fullwidth Forms"](u)||u===65288||u===65289||u===65293||65306<=u&&u<=65310||u===65339||u===65341||u===65343||65371<=u&&u<=65503||u===65507||65512<=u&&u<=65519)||!(!Ft["Small Form Variants"](u)||65112<=u&&u<=65118||65123<=u&&u<=65126)||Ft["Unified Canadian Aboriginal Syllabics"](u)||Ft["Unified Canadian Aboriginal Syllabics Extended"](u)||Ft["Vertical Forms"](u)||Ft["Yijing Hexagram Symbols"](u)||Ft["Yi Syllables"](u)||!!Ft["Yi Radicals"](u))}function Wb(u){return!(Pd(u)||(u=u,Ft["Latin-1 Supplement"](u)&&(u===167||u===169||u===174||u===177||u===188||u===189||u===190||u===215||u===247))||Ft["General Punctuation"](u)&&(u===8214||u===8224||u===8225||u===8240||u===8241||u===8251||u===8252||u===8258||u===8263||u===8264||u===8265||u===8273)||Ft["Letterlike Symbols"](u)||Ft["Number Forms"](u)||Ft["Miscellaneous Technical"](u)&&(8960<=u&&u<=8967||8972<=u&&u<=8991||8996<=u&&u<=9e3||u===9003||9085<=u&&u<=9114||9150<=u&&u<=9165||u===9167||9169<=u&&u<=9179||9186<=u&&u<=9215)||Ft["Control Pictures"](u)&&u!==9251||Ft["Optical Character Recognition"](u)||Ft["Enclosed Alphanumerics"](u)||Ft["Geometric Shapes"](u)||Ft["Miscellaneous Symbols"](u)&&!(9754<=u&&u<=9759)||Ft["Miscellaneous Symbols and Arrows"](u)&&(11026<=u&&u<=11055||11088<=u&&u<=11097||11192<=u&&u<=11243)||Ft["CJK Symbols and Punctuation"](u)||Ft.Katakana(u)||Ft["Private Use Area"](u)||Ft["CJK Compatibility Forms"](u)||Ft["Small Form Variants"](u)||Ft["Halfwidth and Fullwidth Forms"](u)||u===8734||u===8756||u===8757||9984<=u&&u<=10087||10102<=u&&u<=10131||u===65532||u===65533)}function Yb(u){return 1424<=u&&u<=2303||Ft["Arabic Presentation Forms-A"](u)||Ft["Arabic Presentation Forms-B"](u)}function jy(u,c){for(const m of u)if(d=m.charCodeAt(0),!c&&Yb(d)||2304<=d&&d<=3583||3840<=d&&d<=4255||Ft.Khmer(d))return!1;var d;return!0}const Hl=new class{constructor(){this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null}setState(u){this.pluginStatus=u.pluginStatus,this.pluginURL=u.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(u){this.applyArabicShaping=u.applyArabicShaping,this.processBidirectionalText=u.processBidirectionalText,this.processStyledBidirectionalText=u.processStyledBidirectionalText}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getPluginURL(){return this.pluginURL}getRTLTextPluginStatus(){return this.pluginStatus}};class Ur{constructor(c,d){this.zoom=c,d?(this.now=d.now,this.fadeDuration=d.fadeDuration,this.zoomHistory=d.zoomHistory,this.transition=d.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new qb,this.transition={})}isSupportedScript(c){return jy(c,Hl.getRTLTextPluginStatus()==="loaded")}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){var c=this.zoom,d=c-Math.floor(c),m=this.crossFadingFactor();return c>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:d+(1-d)*m}:{fromScale:.5,toScale:1,t:1-(1-m)*d}}}class Bp{constructor(c,d){this.property=c,this.value=d,this.expression=Op(d===void 0?c.specification.default:d,c.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(c,d,m){return this.property.possiblyEvaluate(this,c,d,m)}}class Vy{constructor(c){this.property=c,this.value=new Bp(c,void 0)}transitioned(c,d){return new Hy(this.property,this.value,d,_e({},c.transition,this.transition),c.now)}untransitioned(){return new Hy(this.property,this.value,null,{},0)}}class Up{constructor(c){this._properties=c,this._values=Object.create(c.defaultTransitionablePropertyValues)}getValue(c){return xe(this._values[c].value.value)}setValue(c,d){Object.prototype.hasOwnProperty.call(this._values,c)||(this._values[c]=new Vy(this._values[c].property)),this._values[c].value=new Bp(this._values[c].property,d===null?void 0:xe(d))}getTransition(c){return xe(this._values[c].transition)}setTransition(c,d){Object.prototype.hasOwnProperty.call(this._values,c)||(this._values[c]=new Vy(this._values[c].property)),this._values[c].transition=xe(d)||void 0}serialize(){var c={};for(const m of Object.keys(this._values)){var d=this.getValue(m),d=(d!==void 0&&(c[m]=d),this.getTransition(m));d!==void 0&&(c[m+"-transition"]=d)}return c}transitioned(c,d){var m=new zp(this._properties);for(const b of Object.keys(this._values))m._values[b]=this._values[b].transitioned(c,d._values[b]);return m}untransitioned(){var c=new zp(this._properties);for(const d of Object.keys(this._values))c._values[d]=this._values[d].untransitioned();return c}}class Hy{constructor(c,d,m,b,E){this.property=c,this.value=d,this.begin=E+b.delay||0,this.end=this.begin+b.duration||0,c.specification.transition&&(b.delay||b.duration)&&(this.prior=m)}possiblyEvaluate(c,d,m){var b=c.now||0,E=this.value.possiblyEvaluate(c,d,m),S=this.prior;return S?b>this.end||this.value.isDataDriven()?(this.prior=null,E):b<this.begin?S.possiblyEvaluate(c,d,m):(b=(b-this.begin)/(this.end-this.begin),this.property.interpolate(S.possiblyEvaluate(c,d,m),E,z(b))):E}}class zp{constructor(c){this._properties=c,this._values=Object.create(c.defaultTransitioningPropertyValues)}possiblyEvaluate(c,d,m){var b=new Md(this._properties);for(const E of Object.keys(this._values))b._values[E]=this._values[E].possiblyEvaluate(c,d,m);return b}hasTransition(){for(const c of Object.keys(this._values))if(this._values[c].prior)return!0;return!1}}class WT{constructor(c){this._properties=c,this._values=Object.create(c.defaultPropertyValues)}hasValue(c){return this._values[c].value!==void 0}getValue(c){return xe(this._values[c].value)}setValue(c,d){this._values[c]=new Bp(this._values[c].property,d===null?void 0:xe(d))}serialize(){var c={};for(const m of Object.keys(this._values)){var d=this.getValue(m);d!==void 0&&(c[m]=d)}return c}possiblyEvaluate(c,d,m){var b=new Md(this._properties);for(const E of Object.keys(this._values))b._values[E]=this._values[E].possiblyEvaluate(c,d,m);return b}}class Ga{constructor(c,d,m){this.property=c,this.value=d,this.parameters=m}isConstant(){return this.value.kind==="constant"}constantOr(c){return this.value.kind==="constant"?this.value.value:c}evaluate(c,d,m,b){return this.property.evaluate(this.value,this.parameters,c,d,m,b)}}class Md{constructor(c){this._properties=c,this._values=Object.create(c.defaultPossiblyEvaluatedValues)}get(c){return this._values[c]}}class sn{constructor(c){this.specification=c}possiblyEvaluate(c,d){if(c.isDataDriven())throw new Error("Value should not be data driven");return c.expression.evaluate(d)}interpolate(c,d,m){var b=this.specification.type,b=Ea[b];return b?b(c,d,m):c}}class wn{constructor(c,d){this.specification=c,this.overrides=d}possiblyEvaluate(c,d,m,b){return c.expression.kind==="constant"||c.expression.kind==="camera"?new Ga(this,{kind:"constant",value:c.expression.evaluate(d,null,{},m,b)},d):new Ga(this,c.expression,d)}interpolate(c,d,m){var b;return c.value.kind!=="constant"||d.value.kind!=="constant"?c:c.value.value===void 0||d.value.value===void 0?new Ga(this,{kind:"constant",value:void 0},c.parameters):(b=this.specification.type,(b=Ea[b])?(b=b(c.value.value,d.value.value,m),new Ga(this,{kind:"constant",value:b},c.parameters)):c)}evaluate(c,d,m,b,E,S){return c.kind==="constant"?c.value:c.evaluate(d,m,b,E,S)}}class Gl extends wn{possiblyEvaluate(c,d,m,b){return c.value===void 0?new Ga(this,{kind:"constant",value:void 0},d):c.expression.kind==="constant"?(m=c.expression.evaluate(d,null,{},m,b),b=c.property.specification.type==="resolvedImage"&&typeof m!="string"?m.name:m,m=this._calculate(b,b,b,d),new Ga(this,{kind:"constant",value:m},d)):c.expression.kind==="camera"?(b=this._calculate(c.expression.evaluate({zoom:d.zoom-1}),c.expression.evaluate({zoom:d.zoom}),c.expression.evaluate({zoom:d.zoom+1}),d),new Ga(this,{kind:"constant",value:b},d)):new Ga(this,c.expression,d)}evaluate(c,d,m,b,E,S){return c.kind==="source"?(E=c.evaluate(d,m,b,E,S),this._calculate(E,E,E,d)):c.kind==="composite"?this._calculate(c.evaluate({zoom:Math.floor(d.zoom)-1},m,b),c.evaluate({zoom:Math.floor(d.zoom)},m,b),c.evaluate({zoom:Math.floor(d.zoom)+1},m,b),d):c.value}_calculate(c,d,m,b){return b.zoom>b.zoomHistory.lastIntegerZoom?{from:c,to:d}:{from:m,to:d}}interpolate(c){return c}}class jp{constructor(c){this.specification=c}possiblyEvaluate(c,d,m,b){if(c.value!==void 0)return c.expression.kind==="constant"?(m=c.expression.evaluate(d,null,{},m,b),this._calculate(m,m,m,d)):this._calculate(c.expression.evaluate(new Ur(Math.floor(d.zoom-1),d)),c.expression.evaluate(new Ur(Math.floor(d.zoom),d)),c.expression.evaluate(new Ur(Math.floor(d.zoom+1),d)),d)}_calculate(c,d,m,b){return b.zoom>b.zoomHistory.lastIntegerZoom?{from:c,to:d}:{from:m,to:d}}interpolate(c){return c}}class Vp{constructor(c){this.specification=c}possiblyEvaluate(c,d,m,b){return!!c.expression.evaluate(d,null,{},m,b)}interpolate(){return!1}}class jo{constructor(c){this.properties=c,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const b in c){var m=c[b],d=(m.specification.overridable&&this.overridableProperties.push(b),this.defaultPropertyValues[b]=new Bp(m,void 0)),m=this.defaultTransitionablePropertyValues[b]=new Vy(m);this.defaultTransitioningPropertyValues[b]=m.untransitioned(),this.defaultPossiblyEvaluatedValues[b]=d.possiblyEvaluate({})}}}Vt("DataDrivenProperty",wn),Vt("DataConstantProperty",sn),Vt("CrossFadedDataDrivenProperty",Gl),Vt("CrossFadedProperty",jp),Vt("ColorRampProperty",Vp);const Rd="-transition";class qa extends ae{constructor(c,d){if(super(),this.id=c.id,this.type=c.type,this._featureFilter={filter:()=>!0,needGeometry:!1},c.type!=="custom"&&(this.metadata=c.metadata,this.minzoom=c.minzoom,this.maxzoom=c.maxzoom,c.type!=="background"&&(this.source=c.source,this.sourceLayer=c["source-layer"],this.filter=c.filter),d.layout&&(this._unevaluatedLayout=new WT(d.layout)),d.paint)){this._transitionablePaint=new Up(d.paint);for(const m in c.paint)this.setPaintProperty(m,c.paint[m],{validate:!1});for(const m in c.layout)this.setLayoutProperty(m,c.layout[m],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Md(d.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(c){return c==="visibility"?this.visibility:this._unevaluatedLayout.getValue(c)}setLayoutProperty(c,d,m={}){if(d!=null){var b=`layers.${this.id}.layout.`+c;if(this._validate($T,b,c,d,m))return}c==="visibility"?this.visibility=d:this._unevaluatedLayout.setValue(c,d)}getPaintProperty(c){return c.endsWith(Rd)?this._transitionablePaint.getTransition(c.slice(0,-Rd.length)):this._transitionablePaint.getValue(c)}setPaintProperty(c,d,m={}){if(d!=null){var b=`layers.${this.id}.paint.`+c;if(this._validate(qT,b,c,d,m))return!1}var E;return c.endsWith(Rd)?(this._transitionablePaint.setTransition(c.slice(0,-Rd.length),d||void 0),!1):(m=(b=this._transitionablePaint._values[c]).property.specification["property-type"]==="cross-faded-data-driven",E=b.value.isDataDriven(),b=b.value,this._transitionablePaint.setValue(c,d),this._handleSpecialPaintPropertyUpdate(c),(d=this._transitionablePaint._values[c].value).isDataDriven()||E||m||this._handleOverridablePaintPropertyUpdate(c,b,d))}_handleSpecialPaintPropertyUpdate(c){}_handleOverridablePaintPropertyUpdate(c,d,m){return!1}isHidden(c){return!!(this.minzoom&&c<this.minzoom)||!!(this.maxzoom&&c>=this.maxzoom)||this.visibility==="none"}updateTransitions(c){this._transitioningPaint=this._transitionablePaint.transitioned(c,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(c,d){c.getCrossfadeParameters&&(this._crossfadeParameters=c.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(c,void 0,d)),this.paint=this._transitioningPaint.possiblyEvaluate(c,void 0,d)}serialize(){var c={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(c.layout=c.layout||{},c.layout.visibility=this.visibility),ue(c,(d,m)=>!(d===void 0||m==="layout"&&!Object.keys(d).length||m==="paint"&&!Object.keys(d).length))}_validate(c,d,m,b,E={}){return(!E||E.validate!==!1)&&Gb(this,c.call(Ad,{key:d,layerType:this.type,objectKey:m,value:b,styleSpec:q,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const d in this.paint._values){var c=this.paint.get(d);if(c instanceof Ga&&$u(c.property.specification)&&(c.value.kind==="source"||c.value.kind==="composite")&&c.value.isStateDependent)return!0}return!1}}const Kb={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class kd{constructor(c,d){this._structArray=c,this._pos1=d*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class fi{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(c,d){return c._trim(),d&&(c.isTransferred=!0,d.push(c.arrayBuffer)),{length:c.length,arrayBuffer:c.arrayBuffer}}static deserialize(c){var d=Object.create(this.prototype);return d.arrayBuffer=c.arrayBuffer,d.length=c.length,d.capacity=c.arrayBuffer.byteLength/d.bytesPerElement,d._refreshViews(),d}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(c){this.reserve(c),this.length=c}reserve(c){c>this.capacity&&(this.capacity=Math.max(c,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement),c=this.uint8,this._refreshViews(),c)&&this.uint8.set(c)}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function Di(u,c=1){let d=0,m=0;return{members:u.map(b=>{E=b.type;var E=Kb[E].BYTES_PER_ELEMENT,S=d=Gy(d,Math.max(c,E)),A=b.components||1;return m=Math.max(m,E),d+=E*A,{name:b.name,type:b.type,components:A,offset:S}}),size:Gy(d,Math.max(m,c)),alignment:c}}function Gy(u,c){return Math.ceil(u/c)*c}class Ku extends fi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(c,d){var m=this.length;return this.resize(m+1),this.emplace(m,c,d)}emplace(c,d,m){var b=2*c;return this.int16[0+b]=d,this.int16[1+b]=m,c}}Ku.prototype.bytesPerElement=4,Vt("StructArrayLayout2i4",Ku);class Od extends fi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(c,d,m){var b=this.length;return this.resize(b+1),this.emplace(b,c,d,m)}emplace(c,d,m,b){var E=3*c;return this.int16[0+E]=d,this.int16[1+E]=m,this.int16[2+E]=b,c}}Od.prototype.bytesPerElement=6,Vt("StructArrayLayout3i6",Od);class qy extends fi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(c,d,m,b){var E=this.length;return this.resize(E+1),this.emplace(E,c,d,m,b)}emplace(c,d,m,b,E){var S=4*c;return this.int16[0+S]=d,this.int16[1+S]=m,this.int16[2+S]=b,this.int16[3+S]=E,c}}qy.prototype.bytesPerElement=8,Vt("StructArrayLayout4i8",qy);class $y extends fi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(c,d,m,b,E,S){var A=this.length;return this.resize(A+1),this.emplace(A,c,d,m,b,E,S)}emplace(c,d,m,b,E,S,A){var I=6*c;return this.int16[0+I]=d,this.int16[1+I]=m,this.int16[2+I]=b,this.int16[3+I]=E,this.int16[4+I]=S,this.int16[5+I]=A,c}}$y.prototype.bytesPerElement=12,Vt("StructArrayLayout2i4i12",$y);class Hp extends fi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(c,d,m,b,E,S){var A=this.length;return this.resize(A+1),this.emplace(A,c,d,m,b,E,S)}emplace(c,d,m,b,E,S,A){var I=4*c,O=8*c;return this.int16[0+I]=d,this.int16[1+I]=m,this.uint8[4+O]=b,this.uint8[5+O]=E,this.uint8[6+O]=S,this.uint8[7+O]=A,c}}Hp.prototype.bytesPerElement=8,Vt("StructArrayLayout2i4ub8",Hp);class Zu extends fi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(c,d){var m=this.length;return this.resize(m+1),this.emplace(m,c,d)}emplace(c,d,m){var b=2*c;return this.float32[0+b]=d,this.float32[1+b]=m,c}}Zu.prototype.bytesPerElement=8,Vt("StructArrayLayout2f8",Zu);class Gp extends fi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(c,d,m,b,E,S,A,I,O,k){var U=this.length;return this.resize(U+1),this.emplace(U,c,d,m,b,E,S,A,I,O,k)}emplace(c,d,m,b,E,S,A,I,O,k,U){var W=10*c;return this.uint16[0+W]=d,this.uint16[1+W]=m,this.uint16[2+W]=b,this.uint16[3+W]=E,this.uint16[4+W]=S,this.uint16[5+W]=A,this.uint16[6+W]=I,this.uint16[7+W]=O,this.uint16[8+W]=k,this.uint16[9+W]=U,c}}Gp.prototype.bytesPerElement=20,Vt("StructArrayLayout10ui20",Gp);class qp extends fi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(c,d,m,b,E,S,A,I,O,k,U,W){var re=this.length;return this.resize(re+1),this.emplace(re,c,d,m,b,E,S,A,I,O,k,U,W)}emplace(c,d,m,b,E,S,A,I,O,k,U,W,re){var ie=12*c;return this.int16[0+ie]=d,this.int16[1+ie]=m,this.int16[2+ie]=b,this.int16[3+ie]=E,this.uint16[4+ie]=S,this.uint16[5+ie]=A,this.uint16[6+ie]=I,this.uint16[7+ie]=O,this.int16[8+ie]=k,this.int16[9+ie]=U,this.int16[10+ie]=W,this.int16[11+ie]=re,c}}qp.prototype.bytesPerElement=24,Vt("StructArrayLayout4i4ui4i24",qp);class Xu extends fi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(c,d,m){var b=this.length;return this.resize(b+1),this.emplace(b,c,d,m)}emplace(c,d,m,b){var E=3*c;return this.float32[0+E]=d,this.float32[1+E]=m,this.float32[2+E]=b,c}}Xu.prototype.bytesPerElement=12,Vt("StructArrayLayout3f12",Xu);class Wy extends fi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(c){var d=this.length;return this.resize(d+1),this.emplace(d,c)}emplace(c,d){return this.uint32[0+ +c]=d,c}}Wy.prototype.bytesPerElement=4,Vt("StructArrayLayout1ul4",Wy);class Ld extends fi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(c,d,m,b,E,S,A,I,O){var k=this.length;return this.resize(k+1),this.emplace(k,c,d,m,b,E,S,A,I,O)}emplace(c,d,m,b,E,S,A,I,O,k){var U=10*c,W=5*c;return this.int16[0+U]=d,this.int16[1+U]=m,this.int16[2+U]=b,this.int16[3+U]=E,this.int16[4+U]=S,this.int16[5+U]=A,this.uint32[3+W]=I,this.uint16[8+U]=O,this.uint16[9+U]=k,c}}Ld.prototype.bytesPerElement=20,Vt("StructArrayLayout6i1ul2ui20",Ld);class Yy extends fi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(c,d,m,b,E,S){var A=this.length;return this.resize(A+1),this.emplace(A,c,d,m,b,E,S)}emplace(c,d,m,b,E,S,A){var I=6*c;return this.int16[0+I]=d,this.int16[1+I]=m,this.int16[2+I]=b,this.int16[3+I]=E,this.int16[4+I]=S,this.int16[5+I]=A,c}}Yy.prototype.bytesPerElement=12,Vt("StructArrayLayout2i2i2i12",Yy);class Ky extends fi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(c,d,m,b,E){var S=this.length;return this.resize(S+1),this.emplace(S,c,d,m,b,E)}emplace(c,d,m,b,E,S){var A=4*c,I=8*c;return this.float32[0+A]=d,this.float32[1+A]=m,this.float32[2+A]=b,this.int16[6+I]=E,this.int16[7+I]=S,c}}Ky.prototype.bytesPerElement=16,Vt("StructArrayLayout2f1f2i16",Ky);class $p extends fi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(c,d,m,b){var E=this.length;return this.resize(E+1),this.emplace(E,c,d,m,b)}emplace(c,d,m,b,E){var S=12*c,A=3*c;return this.uint8[0+S]=d,this.uint8[1+S]=m,this.float32[1+A]=b,this.float32[2+A]=E,c}}$p.prototype.bytesPerElement=12,Vt("StructArrayLayout2ub2f12",$p);class Nd extends fi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(c,d,m){var b=this.length;return this.resize(b+1),this.emplace(b,c,d,m)}emplace(c,d,m,b){var E=3*c;return this.uint16[0+E]=d,this.uint16[1+E]=m,this.uint16[2+E]=b,c}}Nd.prototype.bytesPerElement=6,Vt("StructArrayLayout3ui6",Nd);class Wp extends fi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(c,d,m,b,E,S,A,I,O,k,U,W,re,ie,fe,we,de){var Me=this.length;return this.resize(Me+1),this.emplace(Me,c,d,m,b,E,S,A,I,O,k,U,W,re,ie,fe,we,de)}emplace(c,d,m,b,E,S,A,I,O,k,U,W,re,ie,fe,we,de,Me){var Ve=24*c,$e=12*c,Ye=48*c;return this.int16[0+Ve]=d,this.int16[1+Ve]=m,this.uint16[2+Ve]=b,this.uint16[3+Ve]=E,this.uint32[2+$e]=S,this.uint32[3+$e]=A,this.uint32[4+$e]=I,this.uint16[10+Ve]=O,this.uint16[11+Ve]=k,this.uint16[12+Ve]=U,this.float32[7+$e]=W,this.float32[8+$e]=re,this.uint8[36+Ye]=ie,this.uint8[37+Ye]=fe,this.uint8[38+Ye]=we,this.uint32[10+$e]=de,this.int16[22+Ve]=Me,c}}Wp.prototype.bytesPerElement=48,Vt("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",Wp);class Zy extends fi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(c,d,m,b,E,S,A,I,O,k,U,W,re,ie,fe,we,de,Me,Ve,$e,Ye,et,mt,Ut,Nt,ut,kt,vt){var dt=this.length;return this.resize(dt+1),this.emplace(dt,c,d,m,b,E,S,A,I,O,k,U,W,re,ie,fe,we,de,Me,Ve,$e,Ye,et,mt,Ut,Nt,ut,kt,vt)}emplace(c,d,m,b,E,S,A,I,O,k,U,W,re,ie,fe,we,de,Me,Ve,$e,Ye,et,mt,Ut,Nt,ut,kt,vt,dt){var tt=32*c,Gt=16*c;return this.int16[0+tt]=d,this.int16[1+tt]=m,this.int16[2+tt]=b,this.int16[3+tt]=E,this.int16[4+tt]=S,this.int16[5+tt]=A,this.int16[6+tt]=I,this.int16[7+tt]=O,this.uint16[8+tt]=k,this.uint16[9+tt]=U,this.uint16[10+tt]=W,this.uint16[11+tt]=re,this.uint16[12+tt]=ie,this.uint16[13+tt]=fe,this.uint16[14+tt]=we,this.uint16[15+tt]=de,this.uint16[16+tt]=Me,this.uint16[17+tt]=Ve,this.uint16[18+tt]=$e,this.uint16[19+tt]=Ye,this.uint16[20+tt]=et,this.uint16[21+tt]=mt,this.uint16[22+tt]=Ut,this.uint32[12+Gt]=Nt,this.float32[13+Gt]=ut,this.float32[14+Gt]=kt,this.uint16[30+tt]=vt,this.uint16[31+tt]=dt,c}}Zy.prototype.bytesPerElement=64,Vt("StructArrayLayout8i15ui1ul2f2ui64",Zy);class Yp extends fi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(c){var d=this.length;return this.resize(d+1),this.emplace(d,c)}emplace(c,d){return this.float32[0+ +c]=d,c}}Yp.prototype.bytesPerElement=4,Vt("StructArrayLayout1f4",Yp);class Xy extends fi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(c,d,m){var b=this.length;return this.resize(b+1),this.emplace(b,c,d,m)}emplace(c,d,m,b){var E=3*c;return this.uint16[0+6*c]=d,this.float32[1+E]=m,this.float32[2+E]=b,c}}Xy.prototype.bytesPerElement=12,Vt("StructArrayLayout1ui2f12",Xy);class Qy extends fi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(c,d,m){var b=this.length;return this.resize(b+1),this.emplace(b,c,d,m)}emplace(c,d,m,b){var E=4*c;return this.uint32[0+2*c]=d,this.uint16[2+E]=m,this.uint16[3+E]=b,c}}Qy.prototype.bytesPerElement=8,Vt("StructArrayLayout1ul2ui8",Qy);class Jy extends fi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(c,d){var m=this.length;return this.resize(m+1),this.emplace(m,c,d)}emplace(c,d,m){var b=2*c;return this.uint16[0+b]=d,this.uint16[1+b]=m,c}}Jy.prototype.bytesPerElement=4,Vt("StructArrayLayout2ui4",Jy);class zc extends fi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(c){var d=this.length;return this.resize(d+1),this.emplace(d,c)}emplace(c,d){return this.uint16[0+ +c]=d,c}}zc.prototype.bytesPerElement=2,Vt("StructArrayLayout1ui2",zc);class e_ extends fi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(c,d,m,b){var E=this.length;return this.resize(E+1),this.emplace(E,c,d,m,b)}emplace(c,d,m,b,E){var S=4*c;return this.float32[0+S]=d,this.float32[1+S]=m,this.float32[2+S]=b,this.float32[3+S]=E,c}}e_.prototype.bytesPerElement=16,Vt("StructArrayLayout4f16",e_);class Zb extends kd{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new p(this.anchorPointX,this.anchorPointY)}}Zb.prototype.size=20;class Xb extends Ld{get(c){return new Zb(this,c)}}Vt("CollisionBoxArray",Xb);class Qb extends kd{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(c){this._structArray.uint8[this._pos1+37]=c}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(c){this._structArray.uint8[this._pos1+38]=c}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(c){this._structArray.uint32[this._pos4+10]=c}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}Qb.prototype.size=48;class t_ extends Wp{get(c){return new Qb(this,c)}}Vt("PlacedSymbolArray",t_);class Jb extends kd{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(c){this._structArray.uint32[this._pos4+12]=c}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}Jb.prototype.size=64;class e1 extends Zy{get(c){return new Jb(this,c)}}Vt("SymbolInstanceArray",e1);class t1 extends Yp{getoffsetX(c){return this.float32[+c+0]}}Vt("GlyphOffsetArray",t1);class n1 extends Od{getx(c){return this.int16[3*c+0]}gety(c){return this.int16[3*c+1]}gettileUnitDistanceFromAnchor(c){return this.int16[3*c+2]}}Vt("SymbolLineVertexArray",n1);class Qu extends kd{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}Qu.prototype.size=12;class r1 extends Xy{get(c){return new Qu(this,c)}}Vt("TextAnchorOffsetArray",r1);class n_ extends kd{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}n_.prototype.size=8;class Kp extends Qy{get(c){return new n_(this,c)}}Vt("FeatureIndexArray",Kp);class r_ extends Ku{}class i_ extends Ku{}class YT extends Ku{}class Zp extends $y{}class Xp extends Hp{}class KT extends Zu{}class Ju extends Gp{}class i1 extends qp{}class Dd extends Xu{}class ZT extends Wy{}class o1 extends Yy{}class XT extends $p{}class eh extends Nd{}class Qp extends Jy{}const QT=Di([{name:"a_pos",components:2,type:"Int16"}],4).members;class w{constructor(c=[]){this.segments=c}prepareSegment(c,d,m,b){let E=this.segments[this.segments.length-1];return c>w.MAX_VERTEX_ARRAY_LENGTH&&Ee(`Max vertices per segment is ${w.MAX_VERTEX_ARRAY_LENGTH}: bucket requested `+c),(!E||E.vertexLength+c>w.MAX_VERTEX_ARRAY_LENGTH||E.sortKey!==b)&&(E={vertexOffset:d.length,primitiveOffset:m.length,vertexLength:0,primitiveLength:0},b!==void 0&&(E.sortKey=b),this.segments.push(E)),E}get(){return this.segments}destroy(){for(const c of this.segments)for(const d in c.vaos)c.vaos[d].destroy()}static simpleSegment(c,d,m,b){return new w([{vertexOffset:c,primitiveOffset:d,vertexLength:m,primitiveLength:b,vaos:{},sortKey:0}])}}function s(u,c){return 256*(u=le(Math.floor(u),0,255))+(c=le(Math.floor(c),0,255))}w.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Vt("SegmentVector",w);const f=Di([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);to={exports:{}},xd={exports:{},exports:function(u,c){for(var d,m,b=3&u.length,E=u.length-b,S=c,A=3432918353,I=461845907,O=0;O<E;)m=255&u.charCodeAt(O)|(255&u.charCodeAt(++O))<<8|(255&u.charCodeAt(++O))<<16|(255&u.charCodeAt(++O))<<24,++O,S=27492+(65535&(d=5*(65535&(S=(S^=m=(65535&(m=(m=(65535&m)*A+(((m>>>16)*A&65535)<<16)&4294967295)<<15|m>>>17))*I+(((m>>>16)*I&65535)<<16)&4294967295)<<13|S>>>19))+((5*(S>>>16)&65535)<<16)&4294967295))+((58964+(d>>>16)&65535)<<16);switch(m=0,b){case 3:m^=(255&u.charCodeAt(O+2))<<16;case 2:m^=(255&u.charCodeAt(O+1))<<8;case 1:S^=m=(65535&(m=(m=(65535&(m^=255&u.charCodeAt(O)))*A+(((m>>>16)*A&65535)<<16)&4294967295)<<15|m>>>17))*I+(((m>>>16)*I&65535)<<16)&4294967295}return S=2246822507*(65535&(S=(S^=u.length)^S>>>16))+((2246822507*(S>>>16)&65535)<<16)&4294967295,S=3266489909*(65535&(S^=S>>>13))+((3266489909*(S>>>16)&65535)<<16)&4294967295,(S^=S>>>16)>>>0}},$a={exports:{},exports:function(u,c){for(var d,m=u.length,b=c^m,E=0;4<=m;)d=1540483477*(65535&(d=255&u.charCodeAt(E)|(255&u.charCodeAt(++E))<<8|(255&u.charCodeAt(++E))<<16|(255&u.charCodeAt(++E))<<24))+((1540483477*(d>>>16)&65535)<<16),b=1540483477*(65535&b)+((1540483477*(b>>>16)&65535)<<16)^1540483477*(65535&(d^=d>>>24))+((1540483477*(d>>>16)&65535)<<16),m-=4,++E;switch(m){case 3:b^=(255&u.charCodeAt(E+2))<<16;case 2:b^=(255&u.charCodeAt(E+1))<<8;case 1:b=1540483477*(65535&(b^=255&u.charCodeAt(E)))+((1540483477*(b>>>16)&65535)<<16)}return b=1540483477*(65535&(b^=b>>>13))+((1540483477*(b>>>16)&65535)<<16),(b^=b>>>15)>>>0}},Mr=xd.exports,fc=$a.exports,to.exports=Mr,to.exports.murmur3=Mr,to.exports.murmur2=fc;var y=a(to.exports);class v{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(c,d,m,b){this.ids.push(T(c)),this.positions.push(d,m,b)}getPositions(c){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");var d=T(c);let m=0,b=this.ids.length-1;for(;m<b;){var E=m+b>>1;this.ids[E]>=d?b=E:m=1+E}for(var S=[];this.ids[m]===d;){var A=this.positions[3*m],I=this.positions[3*m+1],O=this.positions[3*m+2];S.push({index:A,start:I,end:O}),m++}return S}static serialize(b,d){var m=new Float64Array(b.ids),b=new Uint32Array(b.positions);return P(m,b,0,m.length-1),d&&d.push(m.buffer,b.buffer),{ids:m,positions:b}}static deserialize(c){var d=new v;return d.ids=c.ids,d.positions=c.positions,d.indexed=!0,d}}function T(u){var c=+u;return!isNaN(c)&&c<=Number.MAX_SAFE_INTEGER?c:y(String(u))}function P(u,c,d,m){for(;d<m;){var b=u[d+m>>1];let E=d-1,S=m+1;for(;;){for(;u[++E]<b;);for(;u[--S]>b;);if(E>=S)break;R(u,E,S),R(c,3*E,3*S),R(c,3*E+1,3*S+1),R(c,3*E+2,3*S+2)}S-d<m-S?(P(u,c,d,S),d=S+1):(P(u,c,S+1,m),m=S)}}function R(u,c,d){var m=u[c];u[c]=u[d],u[d]=m}Vt("FeaturePositionMap",v);class N{constructor(c,d){this.gl=c.gl,this.location=d}}class G extends N{constructor(c,d){super(c,d),this.current=0}set(c){this.current!==c&&(this.current=c,this.gl.uniform1f(this.location,c))}}class Z extends N{constructor(c,d){super(c,d),this.current=[0,0,0,0]}set(c){c[0]===this.current[0]&&c[1]===this.current[1]&&c[2]===this.current[2]&&c[3]===this.current[3]||(this.current=c,this.gl.uniform4f(this.location,c[0],c[1],c[2],c[3]))}}class j extends N{constructor(c,d){super(c,d),this.current=rr.transparent}set(c){c.r===this.current.r&&c.g===this.current.g&&c.b===this.current.b&&c.a===this.current.a||(this.current=c,this.gl.uniform4f(this.location,c.r,c.g,c.b,c.a))}}const X=new Float32Array(16);function ge(u){return[s(255*u.r,255*u.g),s(255*u.b,255*u.a)]}class ye{constructor(c,d,m){this.value=c,this.uniformNames=d.map(b=>"u_"+b),this.type=m}setUniform(c,d,m){c.set(m.constantOr(this.value))}getBinding(c,d,m){return new(this.type==="color"?j:G)(c,d)}}class be{constructor(c,d){this.uniformNames=d.map(m=>"u_"+m),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(c,d){this.pixelRatioFrom=d.pixelRatio,this.pixelRatioTo=c.pixelRatio,this.patternFrom=d.tlbr,this.patternTo=c.tlbr}setUniform(c,d,m,b){b=b==="u_pattern_to"?this.patternTo:b==="u_pattern_from"?this.patternFrom:b==="u_pixel_ratio_to"?this.pixelRatioTo:b==="u_pixel_ratio_from"?this.pixelRatioFrom:null,b&&c.set(b)}getBinding(c,d,m){return new(m.substr(0,9)==="u_pattern"?Z:G)(c,d)}}class ve{constructor(c,d,m,b){this.expression=c,this.type=m,this.maxValue=0,this.paintVertexAttributes=d.map(E=>({name:"a_"+E,type:"Float32",components:m==="color"?2:1,offset:0})),this.paintVertexArray=new b}populatePaintArray(c,A,m,b,E){var S=this.paintVertexArray.length,A=this.expression.evaluate(new Ur(0),A,{},b,[],E);this.paintVertexArray.resize(c),this._setPaintValue(S,c,A)}updatePaintArray(c,d,m,b){m=this.expression.evaluate({zoom:0},m,b),this._setPaintValue(c,d,m)}_setPaintValue(c,d,m){if(this.type==="color"){var b=ge(m);for(let E=c;E<d;E++)this.paintVertexArray.emplace(E,b[0],b[1])}else{for(let E=c;E<d;E++)this.paintVertexArray.emplace(E,m);this.maxValue=Math.max(this.maxValue,Math.abs(m))}}upload(c){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=c.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Fe{constructor(c,d,m,b,E,S){this.expression=c,this.uniformNames=d.map(A=>`u_${A}_t`),this.type=m,this.useIntegerZoom=b,this.zoom=E,this.maxValue=0,this.paintVertexAttributes=d.map(A=>({name:"a_"+A,type:"Float32",components:m==="color"?4:2,offset:0})),this.paintVertexArray=new S}populatePaintArray(c,A,m,I,E){var S=this.expression.evaluate(new Ur(this.zoom),A,{},I,[],E),A=this.expression.evaluate(new Ur(this.zoom+1),A,{},I,[],E),I=this.paintVertexArray.length;this.paintVertexArray.resize(c),this._setPaintValue(I,c,S,A)}updatePaintArray(c,d,S,b){var E=this.expression.evaluate({zoom:this.zoom},S,b),S=this.expression.evaluate({zoom:this.zoom+1},S,b);this._setPaintValue(c,d,E,S)}_setPaintValue(c,d,m,b){if(this.type==="color"){var E=ge(m),S=ge(b);for(let A=c;A<d;A++)this.paintVertexArray.emplace(A,E[0],E[1],S[0],S[1])}else{for(let A=c;A<d;A++)this.paintVertexArray.emplace(A,m,b);this.maxValue=Math.max(this.maxValue,Math.abs(m),Math.abs(b))}}upload(c){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=c.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(c,d){d=this.useIntegerZoom?Math.floor(d.zoom):d.zoom,d=le(this.expression.interpolationFactor(d,this.zoom,this.zoom+1),0,1),c.set(d)}getBinding(c,d,m){return new G(c,d)}}class Ue{constructor(c,d,m,b,E,S){this.expression=c,this.type=d,this.useIntegerZoom=m,this.zoom=b,this.layerId=S,this.zoomInPaintVertexArray=new E,this.zoomOutPaintVertexArray=new E}populatePaintArray(c,d,m){var b=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(c),this.zoomOutPaintVertexArray.resize(c),this._setPaintValues(b,c,d.patterns&&d.patterns[this.layerId],m)}updatePaintArray(c,d,m,b,E){this._setPaintValues(c,d,m.patterns&&m.patterns[this.layerId],E)}_setPaintValues(c,d,m,b){if(b&&m){var{min:m,mid:E,max:S}=m,A=b[m],I=b[E],O=b[S];if(A&&I&&O)for(let U=c;U<d;U++)this.zoomInPaintVertexArray.emplace(U,I.tl[0],I.tl[1],I.br[0],I.br[1],A.tl[0],A.tl[1],A.br[0],A.br[1],I.pixelRatio,A.pixelRatio),this.zoomOutPaintVertexArray.emplace(U,I.tl[0],I.tl[1],I.br[0],I.br[1],O.tl[0],O.tl[1],O.br[0],O.br[1],I.pixelRatio,O.pixelRatio)}}upload(c){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=c.createVertexBuffer(this.zoomInPaintVertexArray,f.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=c.createVertexBuffer(this.zoomOutPaintVertexArray,f.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class ze{constructor(c,d,m){this.binders={},this._buffers=[];var b,E,S,A,I,O,k=[];for(const U in c.paint._values)m(U)&&(O=c.paint.get(U))instanceof Ga&&$u(O.property.specification)&&(b=Je(U,c.type),E=O.value,S=O.property.specification.type,A=O.property.useIntegerZoom,O=(O=O.property.specification["property-type"])==="cross-faded"||O==="cross-faded-data-driven",E.kind==="constant"?(this.binders[U]=O?new be(E.value,b):new ye(E.value,b,S),k.push("/u_"+U)):E.kind==="source"||O?(I=Xe(U,S,"source"),this.binders[U]=O?new Ue(E,S,A,d,I,c.id):new ve(E,b,S,I),k.push("/a_"+U)):(O=Xe(U,S,"composite"),this.binders[U]=new Fe(E,b,S,A,d,O),k.push("/z_"+U)));this.cacheKey=k.sort().join("")}getMaxValue(c){return c=this.binders[c],c instanceof ve||c instanceof Fe?c.maxValue:0}populatePaintArrays(c,d,m,b,E){for(const A in this.binders){var S=this.binders[A];(S instanceof ve||S instanceof Fe||S instanceof Ue)&&S.populatePaintArray(c,d,m,b,E)}}setConstantPatternPositions(c,d){for(const b in this.binders){var m=this.binders[b];m instanceof be&&m.setConstantPatternPositions(c,d)}}updatePaintArrays(c,d,m,b,E){let S=!1;for(const k in c)for(const U of d.getPositions(k)){var A=m.feature(U.index);for(const W in this.binders){var I,O=this.binders[W];(O instanceof ve||O instanceof Fe||O instanceof Ue)&&O.expression.isStateDependent===!0&&(I=b.paint.get(W),O.expression=I.value,O.updatePaintArray(U.start,U.end,A,c[k],E),S=!0)}}return S}defines(){var c=[];for(const m in this.binders){var d=this.binders[m];(d instanceof ye||d instanceof be)&&c.push(...d.uniformNames.map(b=>"#define HAS_UNIFORM_"+b))}return c}getBinderAttributes(){var c=[];for(const m in this.binders){var d=this.binders[m];if(d instanceof ve||d instanceof Fe)for(let b=0;b<d.paintVertexAttributes.length;b++)c.push(d.paintVertexAttributes[b].name);else if(d instanceof Ue)for(let b=0;b<f.members.length;b++)c.push(f.members[b].name)}return c}getBinderUniforms(){var c=[];for(const m in this.binders){var d=this.binders[m];if(d instanceof ye||d instanceof be||d instanceof Fe)for(const b of d.uniformNames)c.push(b)}return c}getPaintVertexBuffers(){return this._buffers}getUniforms(c,d){var m=[];for(const S in this.binders){var b,E=this.binders[S];if(E instanceof ye||E instanceof be||E instanceof Fe)for(const A of E.uniformNames)d[A]&&(b=E.getBinding(c,d[A],A),m.push({name:A,property:S,binding:b}))}return m}setUniforms(c,d,m,b){for(var{name:E,property:S,binding:A}of d)this.binders[S].setUniform(A,b,m.get(S),E)}updatePaintBuffers(c){this._buffers=[];for(const b in this.binders){var d,m=this.binders[b];c&&m instanceof Ue?(d=c.fromScale===2?m.zoomInPaintVertexBuffer:m.zoomOutPaintVertexBuffer)&&this._buffers.push(d):(m instanceof ve||m instanceof Fe)&&m.paintVertexBuffer&&this._buffers.push(m.paintVertexBuffer)}}upload(c){for(const m in this.binders){var d=this.binders[m];(d instanceof ve||d instanceof Fe||d instanceof Ue)&&d.upload(c)}this.updatePaintBuffers()}destroy(){for(const d in this.binders){var c=this.binders[d];(c instanceof ve||c instanceof Fe||c instanceof Ue)&&c.destroy()}}}class Qe{constructor(c,d,m=()=>!0){this.programConfigurations={};for(const b of c)this.programConfigurations[b.id]=new ze(b,d,m);this.needsUpload=!1,this._featureMap=new v,this._bufferOffset=0}populatePaintArrays(c,d,m,b,E,S){for(const A in this.programConfigurations)this.programConfigurations[A].populatePaintArrays(c,d,b,E,S);d.id!==void 0&&this._featureMap.add(d.id,m,this._bufferOffset,c),this._bufferOffset=c,this.needsUpload=!0}updatePaintArrays(c,d,m,b){for(const E of m)this.needsUpload=this.programConfigurations[E.id].updatePaintArrays(c,this._featureMap,d,E,b)||this.needsUpload}get(c){return this.programConfigurations[c]}upload(c){if(this.needsUpload){for(const d in this.programConfigurations)this.programConfigurations[d].upload(c);this.needsUpload=!1}}destroy(){for(const c in this.programConfigurations)this.programConfigurations[c].destroy()}}function Je(u,c){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[u]||[u.replace(c+"-","").replace(/-/g,"_")]}function Xe(b,c,d){var m={color:{source:Zu,composite:e_},number:{source:Yp,composite:Zu}},b=(b=b,{"line-pattern":{source:Ju,composite:Ju},"fill-pattern":{source:Ju,composite:Ju},"fill-extrusion-pattern":{source:Ju,composite:Ju}}[b]);return b&&b[d]||m[c][d]}Vt("ConstantBinder",ye),Vt("CrossFadedConstantBinder",be),Vt("SourceExpressionBinder",ve),Vt("CrossFadedCompositeBinder",Ue),Vt("CompositeExpressionBinder",Fe),Vt("ProgramConfiguration",ze,{omit:["_buffers"]}),Vt("ProgramConfigurationSet",Qe);const ct=8192,it=Math.pow(2,14)-1,_t=-it-1;function Dt(u){var c=ct/u.extent,d=u.loadGeometry();for(let A=0;A<d.length;A++){var m=d[A];for(let I=0;I<m.length;I++){var b=m[I],E=Math.round(b.x*c),S=Math.round(b.y*c);b.x=le(E,_t,it),b.y=le(S,_t,it),(E<b.x||E>b.x+1||S<b.y||S>b.y+1)&&Ee("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return d}function Yt(u,c){return{type:u.type,id:u.id,properties:u.properties,geometry:c?Dt(u):[]}}function _n(u,c,d,m,b){u.emplaceBack(2*c+(m+1)/2,2*d+(b+1)/2)}class vn{constructor(c){this.zoom=c.zoom,this.overscaling=c.overscaling,this.layers=c.layers,this.layerIds=this.layers.map(d=>d.id),this.index=c.index,this.hasPattern=!1,this.layoutVertexArray=new i_,this.indexArray=new eh,this.segments=new w,this.programConfigurations=new Qe(c.layers,c.zoom),this.stateDependentLayerIds=this.layers.filter(d=>d.isStateDependent()).map(d=>d.id)}populate(c,d,m){var b,E,S,A,I=this.layers[0],O=[];let k=null,U=!1;I.type==="circle"&&(k=I.layout.get("circle-sort-key"),U=!k.isConstant());for({feature:b,id:E,index:S,sourceLayerIndex:A}of c){var W,re=this.layers[0]._featureFilter.needGeometry,ie=Yt(b,re);this.layers[0]._featureFilter.filter(new Ur(this.zoom),ie,m)&&(W=U?k.evaluate(ie,{},m):void 0,re={id:E,properties:b.properties,type:b.type,sourceLayerIndex:A,index:S,geometry:re?ie.geometry:Dt(b),patterns:{},sortKey:W},O.push(re))}U&&O.sort((Ve,$e)=>Ve.sortKey-$e.sortKey);for(const Ve of O){var{geometry:fe,index:we,sourceLayerIndex:de}=Ve,Me=c[we].feature;this.addFeature(Ve,fe,we,m),d.featureIndex.insert(Me,fe,we,de,this.index)}}update(c,d,m){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(c,d,this.stateDependentLayers,m)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(c){this.uploaded||(this.layoutVertexBuffer=c.createVertexBuffer(this.layoutVertexArray,QT),this.indexBuffer=c.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(c),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(c,d,m,b){for(const I of d)for(const O of I){var E=O.x,S=O.y;if(!(E<0||E>=ct||S<0||S>=ct)){var A=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,c.sortKey);const k=A.vertexLength;_n(this.layoutVertexArray,E,S,-1,-1),_n(this.layoutVertexArray,E,S,1,-1),_n(this.layoutVertexArray,E,S,1,1),_n(this.layoutVertexArray,E,S,-1,1),this.indexArray.emplaceBack(k,k+1,k+2),this.indexArray.emplaceBack(k,k+3,k+2),A.vertexLength+=4,A.primitiveLength+=2}}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,c,m,{},b)}}function Kt(u,c){for(let d=0;d<u.length;d++)if(or(c,u[d]))return!0;for(let d=0;d<c.length;d++)if(or(u,c[d]))return!0;return!!$t(u,c)}function Ct(u,c,d){return or(u,c)||!!tr(c,u,d)}function cn(u,c){if(u.length===1)return Qn(c,u[0]);for(let m=0;m<c.length;m++){var d=c[m];for(let b=0;b<d.length;b++)if(or(u,d[b]))return!0}for(let m=0;m<u.length;m++)if(Qn(c,u[m]))return!0;for(let m=0;m<c.length;m++)if($t(u,c[m]))return!0;return!1}function Cn(u,c,d){for(let b=0;b<c.length;b++){var m=c[b];if(3<=u.length){for(let E=0;E<m.length;E++)if(or(u,m[E]))return!0}if(function(E,S,A){if(1<E.length){if($t(E,S))return 1;for(let I=0;I<S.length;I++)if(tr(S[I],E,A))return 1}for(let I=0;I<E.length;I++)if(tr(E[I],S,A))return 1}(u,m,d))return!0}return!1}function $t(u,c){var d,m;if(u.length!==0&&c.length!==0)for(let I=0;I<u.length-1;I++){var b=u[I],E=u[I+1];for(let O=0;O<c.length-1;O++){var S=c[O],A=c[O+1];if(m=E,ke(d=b,S=S,A=A)!==ke(m,S,A)&&ke(d,m,S)!==ke(d,m,A))return 1}}}function tr(u,c,d){var m=d*d;if(c.length===1)return u.distSqr(c[0])<m;for(let b=1;b<c.length;b++)if(Ir(u,c[b-1],c[b])<m)return 1}function Ir(u,c,d){var m=c.distSqr(d);return m===0||(m=((u.x-c.x)*(d.x-c.x)+(u.y-c.y)*(d.y-c.y))/m)<0?u.distSqr(c):1<m?u.distSqr(d):u.distSqr(d.sub(c)._mult(m)._add(c))}function Qn(u,c){let d=!1,m,b,E;for(let S=0;S<u.length;S++)for(let A=0,I=(m=u[S]).length-1;A<m.length;I=A++)b=m[A],E=m[I],b.y>c.y!=E.y>c.y&&c.x<(E.x-b.x)*(c.y-b.y)/(E.y-b.y)+b.x&&(d=!d);return d}function or(u,c){let d=!1;for(let E=0,S=u.length-1;E<u.length;S=E++){var m=u[E],b=u[S];m.y>c.y!=b.y>c.y&&c.x<(b.x-m.x)*(c.y-m.y)/(b.y-m.y)+m.x&&(d=!d)}return d}function Ln(u,c,d,m,b){for(const S of u)if(c<=S.x&&d<=S.y&&m>=S.x&&b>=S.y)return!0;var E=[new p(c,d),new p(c,b),new p(m,b),new p(m,d)];if(2<u.length){for(const S of E)if(or(u,S))return!0}for(let S=0;S<u.length-1;S++)if(function(A,I,O){var k=O[0],U=O[2];if(!(A.x<k.x&&I.x<k.x||A.x>U.x&&I.x>U.x||A.y<k.y&&I.y<k.y||A.y>U.y&&I.y>U.y))return k=ke(A,I,O[0]),k!==ke(A,I,O[1])||k!==ke(A,I,O[2])||k!==ke(A,I,O[3])}(u[S],u[S+1],E))return!0;return!1}function Pr(u,c,d){var m=c.paint.get(u).value;return m.kind==="constant"?m.value:d.programConfigurations.get(c.id).getMaxValue(u)}function ar(u){return Math.sqrt(u[0]*u[0]+u[1]*u[1])}function wr(u,c,d,m,b){if(!c[0]&&!c[1])return u;var E=p.convert(c)._mult(b),S=(d==="viewport"&&E._rotate(-m),[]);for(let I=0;I<u.length;I++){var A=u[I];S.push(A.sub(E))}return S}function _o(u,c){var d=[];for(let I=0;I<u.length;I++){var m=u[I],b=[];for(let O=0;O<m.length;O++){var S=m[O-1],E=m[O],A=m[O+1],S=O===0?new p(0,0):E.sub(S)._unit()._perp(),A=O===m.length-1?new p(0,0):A.sub(E)._unit()._perp(),S=S._add(A)._unit(),A=S.x*A.x+S.y*A.y;A!=0&&S._mult(1/A),b.push(S._mult(c)._add(E))}d.push(b)}return d}Vt("CircleBucket",vn,{omit:["layers"]});let Qi,gs;var vo={get paint(){return gs=gs||new jo({"circle-radius":new wn(q.paint_circle["circle-radius"]),"circle-color":new wn(q.paint_circle["circle-color"]),"circle-blur":new wn(q.paint_circle["circle-blur"]),"circle-opacity":new wn(q.paint_circle["circle-opacity"]),"circle-translate":new sn(q.paint_circle["circle-translate"]),"circle-translate-anchor":new sn(q.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new sn(q.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new sn(q.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new wn(q.paint_circle["circle-stroke-width"]),"circle-stroke-color":new wn(q.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new wn(q.paint_circle["circle-stroke-opacity"])})},get layout(){return Qi=Qi||new jo({"circle-sort-key":new wn(q.layout_circle["circle-sort-key"])})}},oi=1e-6,pi=typeof Float32Array<"u"?Float32Array:Array;function js(){var u=new pi(9);return pi!=Float32Array&&(u[1]=0,u[2]=0,u[3]=0,u[5]=0,u[6]=0,u[7]=0),u[0]=1,u[4]=1,u[8]=1,u}function zr(u){return u[0]=1,u[1]=0,u[2]=0,u[3]=0,u[4]=0,u[5]=1,u[6]=0,u[7]=0,u[8]=0,u[9]=0,u[10]=1,u[11]=0,u[12]=0,u[13]=0,u[14]=0,u[15]=1,u}function bo(u,Me,d){var m=Me[0],b=Me[1],E=Me[2],S=Me[3],A=Me[4],I=Me[5],O=Me[6],k=Me[7],U=Me[8],W=Me[9],re=Me[10],ie=Me[11],fe=Me[12],we=Me[13],de=Me[14],Me=Me[15],Ve=d[0],$e=d[1],Ye=d[2],et=d[3];return u[0]=Ve*m+$e*A+Ye*U+et*fe,u[1]=Ve*b+$e*I+Ye*W+et*we,u[2]=Ve*E+$e*O+Ye*re+et*de,u[3]=Ve*S+$e*k+Ye*ie+et*Me,Ve=d[4],$e=d[5],Ye=d[6],et=d[7],u[4]=Ve*m+$e*A+Ye*U+et*fe,u[5]=Ve*b+$e*I+Ye*W+et*we,u[6]=Ve*E+$e*O+Ye*re+et*de,u[7]=Ve*S+$e*k+Ye*ie+et*Me,Ve=d[8],$e=d[9],Ye=d[10],et=d[11],u[8]=Ve*m+$e*A+Ye*U+et*fe,u[9]=Ve*b+$e*I+Ye*W+et*we,u[10]=Ve*E+$e*O+Ye*re+et*de,u[11]=Ve*S+$e*k+Ye*ie+et*Me,Ve=d[12],$e=d[13],Ye=d[14],et=d[15],u[12]=Ve*m+$e*A+Ye*U+et*fe,u[13]=Ve*b+$e*I+Ye*W+et*we,u[14]=Ve*E+$e*O+Ye*re+et*de,u[15]=Ve*S+$e*k+Ye*ie+et*Me,u}Math.hypot||(Math.hypot=function(){for(var u=0,c=arguments.length;c--;)u+=arguments[c]*arguments[c];return Math.sqrt(u)});function jr(u,c,d,m,b){return c=1/Math.tan(c/2),u[0]=c/d,u[1]=0,u[2]=0,u[3]=0,u[4]=0,u[5]=c,u[6]=0,u[7]=0,u[8]=0,u[9]=0,u[11]=-1,u[12]=0,u[13]=0,u[15]=0,b!=null&&b!==1/0?(u[10]=(b+m)*(d=1/(m-b)),u[14]=2*b*m*d):(u[10]=-1,u[14]=-2*m),u}function $r(u,c,d,m,b,E,S){var A=1/(c-d),I=1/(m-b),O=1/(E-S);return u[0]=-2*A,u[1]=0,u[2]=0,u[3]=0,u[4]=0,u[5]=-2*I,u[6]=0,u[7]=0,u[8]=0,u[9]=0,u[10]=2*O,u[11]=0,u[12]=(c+d)*A,u[13]=(b+m)*I,u[14]=(S+E)*O,u[15]=1,u}xd=bo;function Io(){var u=new pi(3);return pi!=Float32Array&&(u[0]=0,u[1]=0,u[2]=0),u}function ai(u,c,d){var m=new pi(3);return m[0]=u,m[1]=c,m[2]=d,m}function Ji(u,c){var b=c[0],d=c[1],m=c[2],b=b*b+d*d+m*m;return 0<b&&(b=1/Math.sqrt(b)),u[0]=c[0]*b,u[1]=c[1]*b,u[2]=c[2]*b,u}function jc(u,c){return u[0]*c[0]+u[1]*c[1]+u[2]*c[2]}function Vs(u,E,I){var m=E[0],b=E[1],E=E[2],S=I[0],A=I[1],I=I[2];return u[0]=b*I-E*A,u[1]=E*S-m*I,u[2]=m*A-b*S,u}function Fi(u,c,d){return u[0]=c[0]-d[0],u[1]=c[1]-d[1],u[2]=c[2]-d[2],u}function Hs(u,S,d){var m=S[0],b=S[1],E=S[2],S=S[3];return u[0]=d[0]*m+d[4]*b+d[8]*E+d[12]*S,u[1]=d[1]*m+d[5]*b+d[9]*E+d[13]*S,u[2]=d[2]*m+d[6]*b+d[10]*E+d[14]*S,u[3]=d[3]*m+d[7]*b+d[11]*E+d[15]*S,u}Io();function Vc(u,c,d){return u[0]=c[0]*d[0],u[1]=c[1]*d[1],u[2]=c[2]*d[2],u[3]=c[3]*d[3],u}function Zr(){var u=new pi(4);return pi!=Float32Array&&(u[0]=0,u[1]=0,u[2]=0),u[3]=1,u}$a=new pi(4),pi!=Float32Array&&($a[0]=0,$a[1]=0,$a[2]=0,$a[3]=0),Io(),ai(1,0,0),ai(0,1,0),Zr(),Zr(),js();function Mi(d){var c=d[0],d=d[1];return c*c+d*d}Mr=new pi(2),pi!=Float32Array&&(Mr[0]=0,Mr[1]=0);class Gs extends qa{constructor(c){super(c,vo)}createBucket(c){return new vn(c)}queryRadius(c){return Pr("circle-radius",this,c)+Pr("circle-stroke-width",this,c)+ar(this.paint.get("circle-translate"))}queryIntersectsFeature(O,k,m,b,E,S,A,I){var O=wr(O,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),S.angle,A),k=this.paint.get("circle-radius").evaluate(k,m)+this.paint.get("circle-stroke-width").evaluate(k,m),U=this.paint.get("circle-pitch-alignment")==="map",W=U?O:th(O,I),re=U?k*A:k;for(const we of b)for(const de of we){var ie=U?de:qs(de,I);let Me=re;var fe=Hs([],[de.x,de.y,0,1],I);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?Me*=fe[3]/S.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(Me*=S.cameraToCenterDistance/fe[3]),Ct(W,ie,Me))return!0}return!1}}function qs(u,c){return u=Hs([],[u.x,u.y,0,1],c),new p(u[0]/u[3],u[1]/u[3])}function th(u,c){return u.map(d=>qs(d,c))}class Hc extends vn{}Vt("HeatmapBucket",Hc,{omit:["layers"]});let o_;var a1={get paint(){return o_=o_||new jo({"heatmap-radius":new wn(q.paint_heatmap["heatmap-radius"]),"heatmap-weight":new wn(q.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new sn(q.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Vp(q.paint_heatmap["heatmap-color"]),"heatmap-opacity":new sn(q.paint_heatmap["heatmap-opacity"])})}};function ms(u,{width:c,height:d},m,b){if(b){if(b instanceof Uint8ClampedArray)b=new Uint8Array(b.buffer);else if(b.length!==c*d*m)throw new RangeError(`mismatched image size. expected: ${b.length} but got: `+c*d*m)}else b=new Uint8Array(c*d*m);return u.width=c,u.height=d,u.data=b,u}function nh(u,{width:c,height:d},m){var b;c===u.width&&d===u.height||(mc(u,b=ms({},{width:c,height:d},m),{x:0,y:0},{x:0,y:0},{width:Math.min(u.width,c),height:Math.min(u.height,d)},m),u.width=c,u.height=d,u.data=b.data)}function mc(u,c,d,m,b,E){if(b.width!==0&&b.height!==0){if(b.width>u.width||b.height>u.height||d.x>u.width-b.width||d.y>u.height-b.height)throw new RangeError("out of range source coordinates for image copy");if(b.width>c.width||b.height>c.height||m.x>c.width-b.width||m.y>c.height-b.height)throw new RangeError("out of range destination coordinates for image copy");var S=u.data,A=c.data;if(S===A)throw new Error("srcData equals dstData, so image is already copied");for(let k=0;k<b.height;k++){var I=((d.y+k)*u.width+d.x)*E,O=((m.y+k)*c.width+m.x)*E;for(let U=0;U<b.width*E;U++)A[O+U]=S[I+U]}}}class a_{constructor(c,d){ms(this,c,1,d)}resize(c){nh(this,c,1)}clone(){return new a_({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(c,d,m,b,E){mc(c,d,m,b,E,1)}}class ys{constructor(c,d){ms(this,c,4,d)}resize(c){nh(this,c,4)}replace(c,d){d?this.data.set(c):c instanceof Uint8ClampedArray?this.data=new Uint8Array(c.buffer):this.data=c}clone(){return new ys({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(c,d,m,b,E){mc(c,d,m,b,E,4)}}function hk(u){const c={};var d=u.resolution||256,m=u.clips?u.clips.length:1;const b=u.image||new ys({width:d,height:m});if(Math.log(d)/Math.LN2%1!=0)throw new Error("width is not a power of 2 - "+d);var E=(k,U,W)=>{c[u.evaluationKey]=W,W=u.expression.evaluate(c),b.data[k+U+0]=Math.floor(255*W.r/W.a),b.data[k+U+1]=Math.floor(255*W.g/W.a),b.data[k+U+2]=Math.floor(255*W.b/W.a),b.data[k+U+3]=Math.floor(255*W.a)};if(u.clips)for(let k=0,U=0;k<m;++k,U+=4*d)for(let W=0,re=0;W<d;W++,re+=4){var S=W/(d-1),{start:A,end:I}=u.clips[k];E(U,re,A*(1-S)+I*S)}else for(let k=0,U=0;k<d;k++,U+=4){var O=k/(d-1);E(0,U,O)}return b}Vt("AlphaImage",a_),Vt("RGBAImage",ys);class $V extends qa{createBucket(c){return new Hc(c)}constructor(c){super(c,a1),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(c){c==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){var c=this._transitionablePaint._values["heatmap-color"].value.expression;this.colorRamp=hk({expression:c,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let dk;var WV={get paint(){return dk=dk||new jo({"hillshade-illumination-direction":new sn(q.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new sn(q.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new sn(q.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new sn(q.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new sn(q.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new sn(q.paint_hillshade["hillshade-accent-color"])})}};class YV extends qa{constructor(c){super(c,WV)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}const KV=Di([{name:"a_pos",components:2,type:"Int16"}],4).members;fc={exports:{}};function JT(u,c,d){d=d||2;var m,b,E,S,A,I=c&&c.length,O=I?c[0]*d:u.length,k=fk(u,0,O,d,!0),U=[];if(k&&k.next!==k.prev){if(I&&(k=function(fe,we,de,Me){var Ve,$e,Ye,et,mt=[];for(Ve=0,$e=we.length;Ve<$e;Ve++)et=we[Ve]*Me,Ye=Ve<$e-1?we[Ve+1]*Me:fe.length,(et=fk(fe,et,Ye,Me,!1))===et.next&&(et.steiner=!0),mt.push(function(Ut){for(var Nt=Ut,ut=Ut;(Nt.x<ut.x||Nt.x===ut.x&&Nt.y<ut.y)&&(ut=Nt),Nt=Nt.next,Nt!==Ut;);return ut}(et));for(mt.sort(ZV),Ve=0;Ve<mt.length;Ve++)de=function(Ut,Nt){var ut=function(kt,vt){var dt,tt=vt,Gt=kt.x,zt=kt.y,Wt=-1/0;do if(zt<=tt.y&&zt>=tt.next.y&&tt.next.y!==tt.y){var Sn=tt.x+(zt-tt.y)*(tt.next.x-tt.x)/(tt.next.y-tt.y);if(Sn<=Gt&&Wt<Sn&&(Wt=Sn,dt=tt.x<tt.next.x?tt:tt.next,Sn===Gt))return dt}while(tt=tt.next,tt!==vt);if(!dt)return null;var qn,An=dt,pr=dt.x,mn=dt.y,kn=1/0;for(tt=dt;Gt>=tt.x&&tt.x>=pr&&Gt!==tt.x&&Jp(zt<mn?Gt:Wt,zt,pr,mn,zt<mn?Wt:Gt,zt,tt.x,tt.y)&&(qn=Math.abs(zt-tt.y)/(Gt-tt.x),c_(tt,kt))&&(qn<kn||qn===kn&&(tt.x>dt.x||tt.x===dt.x&&function(sr,Rr){return Bi(sr.prev,sr,Rr.prev)<0&&Bi(Rr.next,sr,sr.next)<0}(dt,tt)))&&(dt=tt,kn=qn),tt=tt.next,tt!==An;);return dt}(Ut,Nt);return ut?(Fd(Ut=gk(ut,Ut),Ut.next),Fd(ut,ut.next)):Nt}(mt[Ve],de);return de}(u,c,k,d)),u.length>80*d){for(var W=m=u[0],re=b=u[1],ie=d;ie<O;ie+=d)(E=u[ie])<W&&(W=E),(S=u[ie+1])<re&&(re=S),m<E&&(m=E),b<S&&(b=S);A=(A=Math.max(m-W,b-re))!==0?32767/A:0}s_(k,U,d,W,re,A,0)}return U}function fk(u,c,d,m,b){var E,S;if(b===0<nS(u,c,d,m))for(E=c;E<d;E+=m)S=mk(E,u[E],u[E+1],S);else for(E=d-m;c<=E;E-=m)S=mk(E,u[E],u[E+1],S);return S&&s1(S,S.next)&&(l_(S),S=S.next),S}function Fd(u,c){if(!u)return u;c=c||u;var d,m=u;do if(d=!1,m.steiner||!s1(m,m.next)&&Bi(m.prev,m,m.next)!==0)m=m.next;else{if(l_(m),(m=c=m.prev)===m.next)break;d=!0}while(d||m!==c);return c}function s_(u,c,d,m,b,E,S){if(u){if(!S&&E){for(var A=u,I=m,O=b,k=E,U=A;U.z===0&&(U.z=eS(U.x,U.y,I,O,k)),U.prevZ=U.prev,U.nextZ=U.next,(U=U.next)!==A;);U.prevZ.nextZ=null,U.prevZ=null;var W,re,ie,fe,we,de,Me,Ve,$e=U,Ye=1;do for(re=$e,we=$e=null,de=0;re;){for(de++,ie=re,W=Me=0;W<Ye&&(Me++,ie=ie.nextZ);W++);for(Ve=Ye;0<Me||0<Ve&&ie;)Me!==0&&(Ve===0||!ie||re.z<=ie.z)?(re=(fe=re).nextZ,Me--):(ie=(fe=ie).nextZ,Ve--),we?we.nextZ=fe:$e=fe,fe.prevZ=we,we=fe;re=ie}while(we.nextZ=null,Ye*=2,1<de)}for(var et,mt,Ut=u;u.prev!==u.next;)if(et=u.prev,mt=u.next,E?function(Nt,ut,kt,vt){var dt=Nt.prev,tt=Nt,Gt=Nt.next;if(!(0<=Bi(dt,tt,Gt))){for(var zt=dt.x,Wt=tt.x,Sn=Gt.x,qn=dt.y,An=tt.y,pr=Gt.y,mn=zt<Wt?zt<Sn?zt:Sn:Wt<Sn?Wt:Sn,kn=qn<An?qn<pr?qn:pr:An<pr?An:pr,sr=Wt<zt?Sn<zt?zt:Sn:Sn<Wt?Wt:Sn,Rr=An<qn?pr<qn?qn:pr:pr<An?An:pr,vs=eS(mn,kn,ut,kt,vt),ca=eS(sr,Rr,ut,kt,vt),cr=Nt.prevZ,nr=Nt.nextZ;cr&&cr.z>=vs&&nr&&nr.z<=ca;){if(cr.x>=mn&&cr.x<=sr&&cr.y>=kn&&cr.y<=Rr&&cr!==dt&&cr!==Gt&&Jp(zt,qn,Wt,An,Sn,pr,cr.x,cr.y)&&0<=Bi(cr.prev,cr,cr.next)||(cr=cr.prevZ,nr.x>=mn&&nr.x<=sr&&nr.y>=kn&&nr.y<=Rr&&nr!==dt&&nr!==Gt&&Jp(zt,qn,Wt,An,Sn,pr,nr.x,nr.y)&&0<=Bi(nr.prev,nr,nr.next)))return;nr=nr.nextZ}for(;cr&&cr.z>=vs;){if(cr.x>=mn&&cr.x<=sr&&cr.y>=kn&&cr.y<=Rr&&cr!==dt&&cr!==Gt&&Jp(zt,qn,Wt,An,Sn,pr,cr.x,cr.y)&&0<=Bi(cr.prev,cr,cr.next))return;cr=cr.prevZ}for(;nr&&nr.z<=ca;){if(nr.x>=mn&&nr.x<=sr&&nr.y>=kn&&nr.y<=Rr&&nr!==dt&&nr!==Gt&&Jp(zt,qn,Wt,An,Sn,pr,nr.x,nr.y)&&0<=Bi(nr.prev,nr,nr.next))return;nr=nr.nextZ}return 1}}(u,m,b,E):function(vt){var ut=vt.prev,kt=vt,vt=vt.next;if(!(0<=Bi(ut,kt,vt))){for(var dt=ut.x,tt=kt.x,Gt=vt.x,zt=ut.y,Wt=kt.y,Sn=vt.y,qn=dt<tt?dt<Gt?dt:Gt:tt<Gt?tt:Gt,An=zt<Wt?zt<Sn?zt:Sn:Wt<Sn?Wt:Sn,pr=tt<dt?Gt<dt?dt:Gt:Gt<tt?tt:Gt,mn=Wt<zt?Sn<zt?zt:Sn:Sn<Wt?Wt:Sn,kn=vt.next;kn!==ut;){if(kn.x>=qn&&kn.x<=pr&&kn.y>=An&&kn.y<=mn&&Jp(dt,zt,tt,Wt,Gt,Sn,kn.x,kn.y)&&0<=Bi(kn.prev,kn,kn.next))return;kn=kn.next}return 1}}(u))c.push(et.i/d|0),c.push(u.i/d|0),c.push(mt.i/d|0),l_(u),u=mt.next,Ut=mt.next;else if((u=mt)===Ut){S?S===1?s_(u=function(Nt,ut,kt){var vt=Nt;do var dt=vt.prev,tt=vt.next.next;while(!s1(dt,tt)&&pk(dt,vt,vt.next,tt)&&c_(dt,tt)&&c_(tt,dt)&&(ut.push(dt.i/kt|0),ut.push(vt.i/kt|0),ut.push(tt.i/kt|0),l_(vt),l_(vt.next),vt=Nt=tt),vt=vt.next,vt!==Nt);return Fd(vt)}(Fd(u),c,d),c,d,m,b,E,2):S===2&&function(Nt,ut,kt,vt,dt,tt){var Gt=Nt;do for(var zt,Wt=Gt.next.next;Wt!==Gt.prev;){if(Gt.i!==Wt.i&&function(Sn,qn){return Sn.next.i!==qn.i&&Sn.prev.i!==qn.i&&!function(An,pr){var mn=An;do if(mn.i!==An.i&&mn.next.i!==An.i&&mn.i!==pr.i&&mn.next.i!==pr.i&&pk(mn,mn.next,An,pr))return 1;while(mn=mn.next,mn!==An)}(Sn,qn)&&(c_(Sn,qn)&&c_(qn,Sn)&&function(An,pr){for(var mn=An,kn=!1,sr=(An.x+pr.x)/2,Rr=(An.y+pr.y)/2;mn.y>Rr!=mn.next.y>Rr&&mn.next.y!==mn.y&&sr<(mn.next.x-mn.x)*(Rr-mn.y)/(mn.next.y-mn.y)+mn.x&&(kn=!kn),mn=mn.next,mn!==An;);return kn}(Sn,qn)&&(Bi(Sn.prev,Sn,qn.prev)||Bi(Sn,qn.prev,qn))||s1(Sn,qn)&&0<Bi(Sn.prev,Sn,Sn.next)&&0<Bi(qn.prev,qn,qn.next))}(Gt,Wt))return zt=gk(Gt,Wt),Gt=Fd(Gt,Gt.next),zt=Fd(zt,zt.next),s_(Gt,ut,kt,vt,dt,tt,0),s_(zt,ut,kt,vt,dt,tt,0);Wt=Wt.next}while(Gt=Gt.next,Gt!==Nt)}(u,c,d,m,b,E):s_(Fd(u),c,d,m,b,E,1);break}}}function ZV(u,c){return u.x-c.x}function eS(u,c,d,m,b){return(u=1431655765&((u=858993459&((u=252645135&((u=16711935&((u=(u-d)*b|0)|u<<8))|u<<4))|u<<2))|u<<1))|(c=1431655765&((c=858993459&((c=252645135&((c=16711935&((c=(c-m)*b|0)|c<<8))|c<<4))|c<<2))|c<<1))<<1}function Jp(u,c,d,m,b,E,S,A){return(u-S)*(E-A)<=(b-S)*(c-A)&&(d-S)*(c-A)<=(u-S)*(m-A)&&(b-S)*(m-A)<=(d-S)*(E-A)}function Bi(u,c,d){return(c.y-u.y)*(d.x-c.x)-(c.x-u.x)*(d.y-c.y)}function s1(u,c){return u.x===c.x&&u.y===c.y}function pk(u,c,d,m){var b=l1(Bi(u,c,d)),E=l1(Bi(u,c,m)),S=l1(Bi(d,m,u)),A=l1(Bi(d,m,c));return b!==E&&S!==A||b===0&&c1(u,d,c)||E===0&&c1(u,m,c)||S===0&&c1(d,u,m)||!(A!==0||!c1(d,c,m))}function c1(u,c,d){return c.x<=Math.max(u.x,d.x)&&c.x>=Math.min(u.x,d.x)&&c.y<=Math.max(u.y,d.y)&&c.y>=Math.min(u.y,d.y)}function l1(u){return 0<u?1:u<0?-1:0}function c_(u,c){return Bi(u.prev,u,u.next)<0?0<=Bi(u,c,u.next)&&0<=Bi(u,u.prev,c):Bi(u,c,u.prev)<0||Bi(u,u.next,c)<0}function gk(u,c){var d=new tS(u.i,u.x,u.y),m=new tS(c.i,c.x,c.y),b=u.next,E=c.prev;return(u.next=c).prev=u,(d.next=b).prev=d,(m.next=d).prev=m,(E.next=m).prev=E,m}function mk(u,c,d,m){return u=new tS(u,c,d),m?(u.next=m.next,(u.prev=m).next.prev=u,m.next=u):(u.prev=u).next=u,u}function l_(u){u.next.prev=u.prev,u.prev.next=u.next,u.prevZ&&(u.prevZ.nextZ=u.nextZ),u.nextZ&&(u.nextZ.prevZ=u.prevZ)}function tS(u,c,d){this.i=u,this.x=c,this.y=d,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function nS(u,c,d,m){for(var b=0,E=c,S=d-m;E<d;E+=m)b+=(u[S]-u[E])*(u[E+1]+u[S+1]),S=E;return b}fc.exports=JT,(fc.exports.default=JT).deviation=function(u,c,d,m){var b=c&&c.length,E=b?c[0]*d:u.length,S=Math.abs(nS(u,0,E,d));if(b)for(var A=0,I=c.length;A<I;A++){var O=c[A]*d,k=A<I-1?c[A+1]*d:u.length;S-=Math.abs(nS(u,O,k,d))}for(var U=0,A=0;A<m.length;A+=3){var W=m[A]*d,re=m[A+1]*d,ie=m[A+2]*d;U+=Math.abs((u[W]-u[ie])*(u[1+re]-u[1+W])-(u[W]-u[re])*(u[1+ie]-u[1+W]))}return S===0&&U===0?0:Math.abs((U-S)/S)},JT.flatten=function(u){for(var c=u[0][0].length,d={vertices:[],holes:[],dimensions:c},m=0,b=0;b<u.length;b++){for(var E=0;E<u[b].length;E++)for(var S=0;S<c;S++)d.vertices.push(u[b][E][S]);0<b&&(m+=u[b-1].length,d.holes.push(m))}return d};var yk=a(fc.exports);function XV(u,c,d,m,b){(function E(S,A,I,O,k){for(;I<O;){600<O-I&&(U=O-I+1,fe=A-I+1,re=Math.log(U),W=.5*Math.exp(2*re/3),re=.5*Math.sqrt(re*W*(U-W)/U)*(fe-U/2<0?-1:1),ie=Math.max(I,Math.floor(A-fe*W/U+re)),fe=Math.min(O,Math.floor(A+(U-fe)*W/U+re)),E(S,A,ie,fe,k));var U,W,re,ie,fe,we=S[A],de=I,Me=O;for(u_(S,I,A),0<k(S[O],we)&&u_(S,I,O);de<Me;){for(u_(S,de,Me),de++,Me--;k(S[de],we)<0;)de++;for(;0<k(S[Me],we);)Me--}k(S[I],we)===0?u_(S,I,Me):u_(S,++Me,O),Me<=A&&(I=Me+1),A<=Me&&(O=Me-1)}})(u,c,d||0,m||u.length-1,b||QV)}function u_(u,c,d){var m=u[c];u[c]=u[d],u[d]=m}function QV(u,c){return u<c?-1:c<u?1:0}function rS(u,c){var d=u.length;if(d<=1)return[u];var m=[];let b,E;for(let A=0;A<d;A++){var S=function(I){let O=0;for(let k=0,U=I.length,W=U-1,re,ie;k<U;W=k++)re=I[k],ie=I[W],O+=(ie.x-re.x)*(re.y+ie.y);return O}(u[A]);S!==0&&(u[A].area=Math.abs(S),(E=E===void 0?S<0:E)===S<0?(b&&m.push(b),b=[u[A]]):b.push(u[A]))}if(b&&m.push(b),1<c)for(let A=0;A<m.length;A++)m[A].length<=c||(XV(m[A],c,1,m[A].length-1,JV),m[A]=m[A].slice(0,c));return m}function JV(u,c){return c.area-u.area}function iS(u,c,d){var m=d.patternDependencies;let b=!1;for(const S of c){var E=S.paint.get(u+"-pattern"),E=(E.isConstant()||(b=!0),E.constantOr(null));E&&(b=!0,m[E.to]=!0,m[E.from]=!0)}return b}function oS(u,c,d,m,b){var E=b.patternDependencies;for(const O of c){var S,A,I=O.paint.get(u+"-pattern").value;I.kind!=="constant"&&(S=I.evaluate({zoom:m-1},d,{},b.availableImages),A=I.evaluate({zoom:m},d,{},b.availableImages),I=I.evaluate({zoom:m+1},d,{},b.availableImages),S=S&&S.name?S.name:S,A=A&&A.name?A.name:A,I=I&&I.name?I.name:I,E[S]=!0,E[A]=!0,E[I]=!0,d.patterns[O.id]={min:S,mid:A,max:I})}return d}class aS{constructor(c){this.zoom=c.zoom,this.overscaling=c.overscaling,this.layers=c.layers,this.layerIds=this.layers.map(d=>d.id),this.index=c.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new YT,this.indexArray=new eh,this.indexArray2=new Qp,this.programConfigurations=new Qe(c.layers,c.zoom),this.segments=new w,this.segments2=new w,this.stateDependentLayerIds=this.layers.filter(d=>d.isStateDependent()).map(d=>d.id)}populate(c,d,m){this.hasPattern=iS("fill",this.layers,d);var b,E,S,A,I=this.layers[0].layout.get("fill-sort-key"),O=!I.isConstant(),k=[];for({feature:b,id:E,index:S,sourceLayerIndex:A}of c){var U,W=this.layers[0]._featureFilter.needGeometry,re=Yt(b,W);this.layers[0]._featureFilter.filter(new Ur(this.zoom),re,m)&&(U=O?I.evaluate(re,{},m,d.availableImages):void 0,W={id:E,properties:b.properties,type:b.type,sourceLayerIndex:A,index:S,geometry:W?re.geometry:Dt(b),patterns:{},sortKey:U},k.push(W))}O&&k.sort((Me,Ve)=>Me.sortKey-Ve.sortKey);for(const Me of k){var{geometry:ie,index:fe,sourceLayerIndex:we}=Me,de=(this.hasPattern?(de=oS("fill",this.layers,Me,this.zoom,d),this.patternFeatures.push(de)):this.addFeature(Me,ie,fe,m,{}),c[fe].feature);d.featureIndex.insert(de,ie,fe,we,this.index)}}update(c,d,m){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(c,d,this.stateDependentLayers,m)}addFeatures(c,d,m){for(const b of this.patternFeatures)this.addFeature(b,b.geometry,b.index,d,m)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(c){this.uploaded||(this.layoutVertexBuffer=c.createVertexBuffer(this.layoutVertexArray,KV),this.indexBuffer=c.createIndexBuffer(this.indexArray),this.indexBuffer2=c.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(c),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(c,d,m,b,E){for(const re of rS(d,500)){let ie=0;for(const fe of re)ie+=fe.length;var S=this.segments.prepareSegment(ie,this.layoutVertexArray,this.indexArray),A=S.vertexLength,I=[],O=[];for(const fe of re)if(fe.length!==0){fe!==re[0]&&O.push(I.length/2);var k=this.segments2.prepareSegment(fe.length,this.layoutVertexArray,this.indexArray2),U=k.vertexLength;this.layoutVertexArray.emplaceBack(fe[0].x,fe[0].y),this.indexArray2.emplaceBack(U+fe.length-1,U),I.push(fe[0].x),I.push(fe[0].y);for(let we=1;we<fe.length;we++)this.layoutVertexArray.emplaceBack(fe[we].x,fe[we].y),this.indexArray2.emplaceBack(U+we-1,U+we),I.push(fe[we].x),I.push(fe[we].y);k.vertexLength+=fe.length,k.primitiveLength+=fe.length}var W=yk(I,O);for(let fe=0;fe<W.length;fe+=3)this.indexArray.emplaceBack(A+W[fe],A+W[fe+1],A+W[fe+2]);S.vertexLength+=ie,S.primitiveLength+=W.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,c,m,E,b)}}Vt("FillBucket",aS,{omit:["layers","patternFeatures"]});let _k,vk;var e7={get paint(){return vk=vk||new jo({"fill-antialias":new sn(q.paint_fill["fill-antialias"]),"fill-opacity":new wn(q.paint_fill["fill-opacity"]),"fill-color":new wn(q.paint_fill["fill-color"]),"fill-outline-color":new wn(q.paint_fill["fill-outline-color"]),"fill-translate":new sn(q.paint_fill["fill-translate"]),"fill-translate-anchor":new sn(q.paint_fill["fill-translate-anchor"]),"fill-pattern":new Gl(q.paint_fill["fill-pattern"])})},get layout(){return _k=_k||new jo({"fill-sort-key":new wn(q.layout_fill["fill-sort-key"])})}};class t7 extends qa{constructor(c){super(c,e7)}recalculate(c,d){super.recalculate(c,d),c=this.paint._values["fill-outline-color"],c.value.kind==="constant"&&c.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(c){return new aS(c)}queryRadius(){return ar(this.paint.get("fill-translate"))}queryIntersectsFeature(c,d,m,b,E,S,A){return cn(wr(c,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),S.angle,A),b)}isTileClipped(){return!0}}to=Di([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4);const n7=Di([{name:"a_centroid",components:2,type:"Int16"}],4),r7=to.members;var rh={},i7=l,$a=eg;function eg(u,c,d,m,b){this.properties={},this.extent=d,this.type=0,this._pbf=u,this._geometry=-1,this._keys=m,this._values=b,u.readFields(o7,this,c)}function o7(u,c,d){if(u==1)c.id=d.readVarint();else if(u==2)for(var m=d,b=c,E=m.readVarint()+m.pos;m.pos<E;){var S=b._keys[m.readVarint()],A=b._values[m.readVarint()];b.properties[S]=A}else u==3?c.type=d.readVarint():u==4&&(c._geometry=d.pos)}eg.types=["Unknown","Point","LineString","Polygon"],eg.prototype.loadGeometry=function(){for(var u,c,d=this._pbf,m=(d.pos=this._geometry,d.readVarint()+d.pos),b=1,E=0,S=0,A=0,I=[];d.pos<m;)if(E<=0&&(b=7&(c=d.readVarint()),E=c>>3),E--,b===1||b===2)S+=d.readSVarint(),A+=d.readSVarint(),b===1&&(u&&I.push(u),u=[]),u.push(new i7(S,A));else{if(b!==7)throw new Error("unknown command "+b);u&&u.push(u[0].clone())}return u&&I.push(u),I},eg.prototype.bbox=function(){for(var u,c=this._pbf,d=(c.pos=this._geometry,c.readVarint()+c.pos),m=1,b=0,E=0,S=0,A=1/0,I=-1/0,O=1/0,k=-1/0;c.pos<d;)if(b<=0&&(m=7&(u=c.readVarint()),b=u>>3),b--,m===1||m===2)(E+=c.readSVarint())<A&&(A=E),I<E&&(I=E),(S+=c.readSVarint())<O&&(O=S),k<S&&(k=S);else if(m!==7)throw new Error("unknown command "+m);return[A,O,I,k]},eg.prototype.toGeoJSON=function(u,c,I){var m,b=this.extent*Math.pow(2,I),E=this.extent*u,S=this.extent*c,A=this.loadGeometry(),I=eg.types[this.type];function O(W){for(var re=0;re<W.length;re++){var ie=W[re],fe=180-360*(ie.y+S)/b;W[re]=[360*(ie.x+E)/b-180,360/Math.PI*Math.atan(Math.exp(fe*Math.PI/180))-90]}}switch(this.type){case 1:for(var k=[],U=0;U<A.length;U++)k[U]=A[U][0];O(A=k);break;case 2:for(U=0;U<A.length;U++)O(A[U]);break;case 3:for(A=function(W){var re=W.length;if(re<=1)return[W];for(var ie,fe,we=[],de=0;de<re;de++){var Me=function(Ve){for(var $e,Ye,et=0,mt=0,Ut=Ve.length,Nt=Ut-1;mt<Ut;Nt=mt++)$e=Ve[mt],Ye=Ve[Nt],et+=(Ye.x-$e.x)*($e.y+Ye.y);return et}(W[de]);Me!==0&&((fe=fe===void 0?Me<0:fe)===Me<0?(ie&&we.push(ie),ie=[W[de]]):ie.push(W[de]))}return ie&&we.push(ie),we}(A),U=0;U<A.length;U++)for(m=0;m<A[U].length;m++)O(A[U][m])}return A.length===1?A=A[0]:I="Multi"+I,u={type:"Feature",geometry:{type:I,coordinates:A},properties:this.properties},"id"in this&&(u.id=this.id),u};var a7=$a,Mr=bk;function bk(u,c){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=u,this._keys=[],this._values=[],this._features=[],u.readFields(s7,this,c),this.length=this._features.length}function s7(u,c,d){u===15?c.version=d.readVarint():u===1?c.name=d.readString():u===5?c.extent=d.readVarint():u===2?c._features.push(d.pos):u===3?c._keys.push(d.readString()):u===4&&c._values.push(function(m){for(var b=null,E=m.readVarint()+m.pos;m.pos<E;){var S=m.readVarint()>>3;b=S==1?m.readString():S==2?m.readFloat():S==3?m.readDouble():S==4?m.readVarint64():S==5?m.readVarint():S==6?m.readSVarint():S==7?m.readBoolean():null}return b}(d))}bk.prototype.feature=function(u){if(u<0||u>=this._features.length)throw new Error("feature index out of bounds");return this._pbf.pos=this._features[u],u=this._pbf.readVarint()+this._pbf.pos,new a7(this._pbf,u,this.extent,this._keys,this._values)};var c7=Mr;function l7(u,c,d){u===3&&(u=new c7(d,d.readVarint()+d.pos)).length&&(c[u.name]=u)}rh.VectorTile=function(u,c){this.layers=u.readFields(l7,{},c)},rh.VectorTileFeature=$a,rh.VectorTileLayer=Mr;const u7=rh.VectorTileFeature.types,sS=Math.pow(2,13);function h_(u,c,d,m,b,E,S,A){u.emplaceBack(c,d,2*Math.floor(m*sS)+S,b*sS*2,E*sS*2,Math.round(A))}class cS{constructor(c){this.zoom=c.zoom,this.overscaling=c.overscaling,this.layers=c.layers,this.layerIds=this.layers.map(d=>d.id),this.index=c.index,this.hasPattern=!1,this.layoutVertexArray=new Zp,this.centroidVertexArray=new r_,this.indexArray=new eh,this.programConfigurations=new Qe(c.layers,c.zoom),this.segments=new w,this.stateDependentLayerIds=this.layers.filter(d=>d.isStateDependent()).map(d=>d.id)}populate(c,d,m){this.features=[],this.hasPattern=iS("fill-extrusion",this.layers,d);for(var{feature:b,id:E,index:S,sourceLayerIndex:A}of c){var I=this.layers[0]._featureFilter.needGeometry,O=Yt(b,I);this.layers[0]._featureFilter.filter(new Ur(this.zoom),O,m)&&(E={id:E,sourceLayerIndex:A,index:S,geometry:I?O.geometry:Dt(b),properties:b.properties,type:b.type,patterns:{}},this.hasPattern?this.features.push(oS("fill-extrusion",this.layers,E,this.zoom,d)):this.addFeature(E,E.geometry,S,m,{}),d.featureIndex.insert(b,E.geometry,S,A,this.index,!0))}}addFeatures(c,d,m){for(const E of this.features){var b=E.geometry;this.addFeature(E,b,E.index,d,m)}}update(c,d,m){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(c,d,this.stateDependentLayers,m)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(c){this.uploaded||(this.layoutVertexBuffer=c.createVertexBuffer(this.layoutVertexArray,r7),this.centroidVertexBuffer=c.createVertexBuffer(this.centroidVertexArray,n7.members,!0),this.indexBuffer=c.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(c),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(c,d,m,b,E){var S={x:0,y:0,vertexCount:0};for(const we of rS(d,500)){let de=0;for(const Ve of we)de+=Ve.length;let Me=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(const Ve of we)if(Ve.length!==0&&!d7(Ve)){let $e=0;for(let Ye=0;Ye<Ve.length;Ye++){var A,I,O,k=Ve[Ye];1<=Ye&&(h7(k,A=Ve[Ye-1])||(Me.vertexLength+4>w.MAX_VERTEX_ARRAY_LENGTH&&(Me=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray)),I=k.sub(A)._perp()._unit(),O=A.dist(k),32768<$e+O&&($e=0),h_(this.layoutVertexArray,k.x,k.y,I.x,I.y,0,0,$e),h_(this.layoutVertexArray,k.x,k.y,I.x,I.y,0,1,$e),S.x+=2*k.x,S.y+=2*k.y,S.vertexCount+=2,$e+=O,h_(this.layoutVertexArray,A.x,A.y,I.x,I.y,0,0,$e),h_(this.layoutVertexArray,A.x,A.y,I.x,I.y,0,1,$e),S.x+=2*A.x,S.y+=2*A.y,S.vertexCount+=2,k=Me.vertexLength,this.indexArray.emplaceBack(k,k+2,k+1),this.indexArray.emplaceBack(k+1,k+2,k+3),Me.vertexLength+=4,Me.primitiveLength+=2))}}if(Me.vertexLength+de>w.MAX_VERTEX_ARRAY_LENGTH&&(Me=this.segments.prepareSegment(de,this.layoutVertexArray,this.indexArray)),u7[c.type]==="Polygon"){var U=[],W=[],re=Me.vertexLength;for(const Ve of we)if(Ve.length!==0){Ve!==we[0]&&W.push(U.length/2);for(let $e=0;$e<Ve.length;$e++){var ie=Ve[$e];h_(this.layoutVertexArray,ie.x,ie.y,0,0,1,1,0),S.x+=ie.x,S.y+=ie.y,S.vertexCount+=1,U.push(ie.x),U.push(ie.y)}}var fe=yk(U,W);for(let Ve=0;Ve<fe.length;Ve+=3)this.indexArray.emplaceBack(re+fe[Ve],re+fe[Ve+2],re+fe[Ve+1]);Me.primitiveLength+=fe.length/3,Me.vertexLength+=de}}for(let we=0;we<S.vertexCount;we++)this.centroidVertexArray.emplaceBack(Math.floor(S.x/S.vertexCount),Math.floor(S.y/S.vertexCount));this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,c,m,E,b)}}function h7(u,c){return u.x===c.x&&(u.x<0||u.x>ct)||u.y===c.y&&(u.y<0||u.y>ct)}function d7(u){return u.every(c=>c.x<0)||u.every(c=>c.x>ct)||u.every(c=>c.y<0)||u.every(c=>c.y>ct)}Vt("FillExtrusionBucket",cS,{omit:["layers","features"]});let wk;var f7={get paint(){return wk=wk||new jo({"fill-extrusion-opacity":new sn(q["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new wn(q["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new sn(q["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new sn(q["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Gl(q["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new wn(q["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new wn(q["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new sn(q["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class p7 extends qa{constructor(c){super(c,f7)}createBucket(c){return new cS(c)}queryRadius(){return ar(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(c,d,m,b,E,S,A,I){return c=wr(c,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),S.angle,A),A=this.paint.get("fill-extrusion-height").evaluate(d,m),d=this.paint.get("fill-extrusion-base").evaluate(d,m),m=y7(c,I,0,0),c=m7(b,d,A,I),g7(c[0],c[1],m)}}function d_(u,c){return u.x*c.x+u.y*c.y}function xk(u,c){if(u.length===1){let k=0;var d=c[k++];let U;for(;!U||d.equals(U);)if(!(U=c[k++]))return 1/0;for(;k<c.length;k++){var m=c[k],O=u[0],E=U.sub(d),S=m.sub(d),O=O.sub(d),I=d_(E,E),b=d_(E,S),A=d_(S,S),E=d_(O,E),O=d_(O,S),S=I*A-b*b,A=(A*E-b*O)/S,I=(I*O-b*E)/S,O=d.z*(1-A-I)+U.z*A+m.z*I;if(isFinite(O))return O}return 1/0}{let k=1/0;for(const U of c)k=Math.min(k,U.z);return k}}function g7(u,c,d){let m=1/0;cn(d,c)&&(m=xk(d,c[0]));for(let O=0;O<c.length;O++){var b=c[O],E=u[O];for(let k=0;k<b.length-1;k++){var S=b[k],I=b[k+1],A=E[k],I=[S,I,E[k+1],A,S];Kt(d,I)&&(m=Math.min(m,xk(d,I)))}}return m!==1/0&&m}function m7(u,c,d,m){var b=[],E=[],S=m[8]*c,A=m[9]*c,I=m[10]*c,O=m[11]*c,k=m[8]*d,U=m[9]*d,W=m[10]*d,re=m[11]*d;for(const Ut of u){var ie=[],fe=[];for(const Nt of Ut){var Ye=Nt.x,we=Nt.y,et=m[0]*Ye+m[4]*we+m[12],mt=m[1]*Ye+m[5]*we+m[13],$e=m[2]*Ye+m[6]*we+m[14],Ye=m[3]*Ye+m[7]*we+m[15],we=$e+I,de=Ye+O,Me=et+k,Ve=mt+U,$e=$e+W,Ye=Ye+re,et=new p((et+S)/de,(mt+A)/de),mt=(et.z=we/de,ie.push(et),new p(Me/Ye,Ve/Ye));mt.z=$e/Ye,fe.push(mt)}b.push(ie),E.push(fe)}return[b,E]}function y7(u,c,d,m){var b=[];for(const S of u){var E=[S.x,S.y,m,1];Hs(E,E,c),b.push(new p(E[0]/E[3],E[1]/E[3]))}return b}const _7=Di([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4).members,v7=Di([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]).members,b7=rh.VectorTileFeature.types,w7=Math.cos(Math.PI/180*37.5),Ek=Math.pow(2,14)/.5;class lS{constructor(c){this.zoom=c.zoom,this.overscaling=c.overscaling,this.layers=c.layers,this.layerIds=this.layers.map(d=>d.id),this.index=c.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(d=>{this.gradients[d.id]={}}),this.layoutVertexArray=new Xp,this.layoutVertexArray2=new KT,this.indexArray=new eh,this.programConfigurations=new Qe(c.layers,c.zoom),this.segments=new w,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(d=>d.isStateDependent()).map(d=>d.id)}populate(c,d,m){this.hasPattern=iS("line",this.layers,d);var b,E,S,A,I=this.layers[0].layout.get("line-sort-key"),O=!I.isConstant(),k=[];for({feature:b,id:E,index:S,sourceLayerIndex:A}of c){var U,W=this.layers[0]._featureFilter.needGeometry,re=Yt(b,W);this.layers[0]._featureFilter.filter(new Ur(this.zoom),re,m)&&(U=O?I.evaluate(re,{},m):void 0,W={id:E,properties:b.properties,type:b.type,sourceLayerIndex:A,index:S,geometry:W?re.geometry:Dt(b),patterns:{},sortKey:U},k.push(W))}O&&k.sort((Me,Ve)=>Me.sortKey-Ve.sortKey);for(const Me of k){var{geometry:ie,index:fe,sourceLayerIndex:we}=Me,de=(this.hasPattern?(de=oS("line",this.layers,Me,this.zoom,d),this.patternFeatures.push(de)):this.addFeature(Me,ie,fe,m,{}),c[fe].feature);d.featureIndex.insert(de,ie,fe,we,this.index)}}update(c,d,m){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(c,d,this.stateDependentLayers,m)}addFeatures(c,d,m){for(const b of this.patternFeatures)this.addFeature(b,b.geometry,b.index,d,m)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(c){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=c.createVertexBuffer(this.layoutVertexArray2,v7)),this.layoutVertexBuffer=c.createVertexBuffer(this.layoutVertexArray,_7),this.indexBuffer=c.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(c),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(c){if(c.properties&&Object.prototype.hasOwnProperty.call(c.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(c.properties,"mapbox_clip_end"))return{start:+c.properties.mapbox_clip_start,end:+c.properties.mapbox_clip_end}}addFeature(c,d,m,b,E){var S=this.layers[0].layout,A=S.get("line-join").evaluate(c,{}),I=S.get("line-cap"),O=S.get("line-miter-limit"),k=S.get("line-round-limit");this.lineClips=this.lineFeatureClips(c);for(const U of d)this.addLine(U,c,A,I,O,k);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,c,m,E,b)}addLine(c,d,m,b,E,S){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let mt=0;mt<c.length-1;mt++)this.totalDistance+=c[mt].dist(c[mt+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}var A=b7[d.type]==="Polygon";let I=c.length;for(;2<=I&&c[I-1].equals(c[I-2]);)I--;let O=0;for(;O<I-1&&c[O].equals(c[O+1]);)O++;if(!(I<(A?3:2))){m==="bevel"&&(E=1.05);var k,U=this.overscaling<=16?15*ct/(512*this.overscaling):0,W=this.segments.prepareSegment(10*I,this.layoutVertexArray,this.indexArray);let mt,Ut,Nt,ut;this.e1=this.e2=-1,A&&(mt=c[I-2],ut=c[O].sub(mt)._unit()._perp());for(let kt=O;kt<I;kt++)if(!(k=kt===I-1?A?c[O+1]:void 0:c[kt+1])||!c[kt].equals(k)){ut&&(Nt=ut),mt&&(Ut=mt),mt=c[kt],ut=k?k.sub(mt)._unit()._perp():Nt;let vt=(Nt=Nt||ut).add(ut);vt.x===0&&vt.y===0||vt._unit();var re=Nt.x*ut.x+Nt.y*ut.y,we=vt.x*ut.x+vt.y*ut.y,ie=we!=0?1/we:1/0,fe=2*Math.sqrt(2-2*we),we=we<w7&&Ut&&k,de=0<Nt.x*ut.y-Nt.y*ut.x,Me=(we&&kt>O&&2*U<(Me=mt.dist(Ut))&&(Me=mt.sub(mt.sub(Ut)._mult(U/Me)._round()),this.updateDistance(Ut,Me),this.addCurrentVertex(Me,Nt,0,0,W),Ut=Me),Ut&&k);let dt=Me?m:A?"butt":b;if(Me&&dt==="round"&&(ie<S?dt="miter":ie<=2&&(dt="fakeround")),(dt=dt==="miter"&&E<ie?"bevel":dt)==="bevel"&&(2<ie&&(dt="flipbevel"),ie<E)&&(dt="miter"),Ut&&this.updateDistance(Ut,mt),dt==="miter")vt._mult(ie),this.addCurrentVertex(mt,vt,0,0,W);else if(dt==="flipbevel")100<ie?vt=ut.mult(-1):(Ve=ie*Nt.add(ut).mag()/Nt.sub(ut).mag(),vt._perp()._mult(Ve*(de?-1:1))),this.addCurrentVertex(mt,vt,0,0,W),this.addCurrentVertex(mt,vt.mult(-1),0,0,W);else if(dt==="bevel"||dt==="fakeround"){var Ve=-Math.sqrt(ie*ie-1),ie=de?Ve:0,$e=de?0:Ve;if(Ut&&this.addCurrentVertex(mt,Nt,ie,$e,W),dt==="fakeround"){var Ye=Math.round(180*fe/Math.PI/20);for(let Gt=1;Gt<Ye;Gt++){let zt=Gt/Ye;zt!==.5&&(et=zt-.5,zt+=zt*et*(zt-1)*((1.0904+re*(re*(3.55645-1.43519*re)-3.2452))*et*et+(.848013+re*(.215638*re-1.06021))));var et=ut.sub(Nt)._mult(zt)._add(Nt)._unit()._mult(de?-1:1);this.addHalfVertex(mt,et.x,et.y,!1,de,0,W)}}k&&this.addCurrentVertex(mt,ut,-ie,-$e,W)}else dt==="butt"?this.addCurrentVertex(mt,vt,0,0,W):dt==="square"?(fe=Ut?1:-1,this.addCurrentVertex(mt,vt,fe,fe,W)):dt==="round"&&(Ut&&(this.addCurrentVertex(mt,Nt,0,0,W),this.addCurrentVertex(mt,Nt,1,1,W,!0)),k)&&(this.addCurrentVertex(mt,ut,-1,-1,W,!0),this.addCurrentVertex(mt,ut,0,0,W));we&&kt<I-1&&2*U<(ie=mt.dist(k))&&($e=mt.add(k.sub(mt)._mult(U/ie)._round()),this.updateDistance(mt,$e),this.addCurrentVertex($e,ut,0,0,W),mt=$e)}}}addCurrentVertex(c,d,m,b,E,S=!1){var A=d.x+d.y*m,I=d.y-d.x*m,O=-d.x+d.y*b,k=-d.y-d.x*b;this.addHalfVertex(c,A,I,S,!1,m,E),this.addHalfVertex(c,O,k,S,!0,-b,E),this.distance>Ek/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(c,d,m,b,E,S))}addHalfVertex({x:c,y:k},m,b,E,S,A,I){var O=.5*(this.lineClips?this.scaledDistance*(Ek-1):this.scaledDistance),k=(this.layoutVertexArray.emplaceBack((c<<1)+(E?1:0),(k<<1)+(S?1:0),Math.round(63*m)+128,Math.round(63*b)+128,1+(A===0?0:A<0?-1:1)|(63&O)<<2,O>>6),this.lineClips&&(c=this.scaledDistance-this.lineClips.start,E=this.lineClips.end-this.lineClips.start,this.layoutVertexArray2.emplaceBack(c/E,this.lineClipsArray.length)),I.vertexLength++);0<=this.e1&&0<=this.e2&&(this.indexArray.emplaceBack(this.e1,this.e2,k),I.primitiveLength++),S?this.e2=k:this.e1=k}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(c,d){this.distance+=c.dist(d),this.updateScaledDistance()}}Vt("LineBucket",lS,{omit:["layers","patternFeatures"]});let Tk,Sk;var Ck={get paint(){return Sk=Sk||new jo({"line-opacity":new wn(q.paint_line["line-opacity"]),"line-color":new wn(q.paint_line["line-color"]),"line-translate":new sn(q.paint_line["line-translate"]),"line-translate-anchor":new sn(q.paint_line["line-translate-anchor"]),"line-width":new wn(q.paint_line["line-width"]),"line-gap-width":new wn(q.paint_line["line-gap-width"]),"line-offset":new wn(q.paint_line["line-offset"]),"line-blur":new wn(q.paint_line["line-blur"]),"line-dasharray":new jp(q.paint_line["line-dasharray"]),"line-pattern":new Gl(q.paint_line["line-pattern"]),"line-gradient":new Vp(q.paint_line["line-gradient"])})},get layout(){return Tk=Tk||new jo({"line-cap":new sn(q.layout_line["line-cap"]),"line-join":new wn(q.layout_line["line-join"]),"line-miter-limit":new sn(q.layout_line["line-miter-limit"]),"line-round-limit":new sn(q.layout_line["line-round-limit"]),"line-sort-key":new wn(q.layout_line["line-sort-key"])})}};class x7 extends wn{possiblyEvaluate(c,d){return d=new Ur(Math.floor(d.zoom),{now:d.now,fadeDuration:d.fadeDuration,zoomHistory:d.zoomHistory,transition:d.transition}),super.possiblyEvaluate(c,d)}evaluate(c,d,m,b){return d=_e({},d,{zoom:Math.floor(d.zoom)}),super.evaluate(c,d,m,b)}}let uS;class E7 extends qa{constructor(c){super(c,Ck),this.gradientVersion=0,uS||((uS=new x7(Ck.paint.properties["line-width"].specification)).useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(c){c==="line-gradient"&&(ur(c=this.gradientExpression())?this.stepInterpolant=c._styleExpression.expression instanceof Fl:this.stepInterpolant=!1,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER)}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(c,d){super.recalculate(c,d),this.paint._values["line-floorwidth"]=uS.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,c)}createBucket(c){return new lS(c)}queryRadius(m){var d=Ak(Pr("line-width",this,m),Pr("line-gap-width",this,m)),m=Pr("line-offset",this,m);return d/2+Math.abs(m)+ar(this.paint.get("line-translate"))}queryIntersectsFeature(c,d,m,b,E,S,A){return c=wr(c,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),S.angle,A),S=A/2*Ak(this.paint.get("line-width").evaluate(d,m),this.paint.get("line-gap-width").evaluate(d,m)),d=this.paint.get("line-offset").evaluate(d,m),Cn(c,b=d?_o(b,d*A):b,S)}isTileClipped(){return!0}}function Ak(u,c){return 0<c?c+2*u:u}const T7=Di([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),S7=Di([{name:"a_projected_pos",components:3,type:"Float32"}],4),C7=(Di([{name:"a_fade_opacity",components:1,type:"Uint32"}],4),Di([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}])),Ik=(Di([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]),Di([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4));fc=Di([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function A7(u,c,d){return u.sections.forEach(m=>{var b,E;m.text=(m=m.text,E=d,(b=(b=c).layout.get("text-transform").evaluate(E,{}))==="uppercase"?m=m.toLocaleUpperCase():b==="lowercase"&&(m=m.toLocaleLowerCase()),m=Hl.applyArabicShaping?Hl.applyArabicShaping(m):m)}),u}function I7(u){const c={},d={},m=[];let b=0;function E(fe){m.push(u[fe]),b++}function S(fe,we,de){var Me=d[fe];return delete d[fe],d[we]=Me,m[Me].geometry[0].pop(),m[Me].geometry[0]=m[Me].geometry[0].concat(de[0]),Me}function A(fe,we,de){var Me=c[we];return delete c[we],c[fe]=Me,m[Me].geometry[0].shift(),m[Me].geometry[0]=de[0].concat(m[Me].geometry[0]),Me}function I(fe,we,de){return de=de?we[0][we[0].length-1]:we[0][0],`${fe}:${de.x}:`+de.y}for(let fe=0;fe<u.length;fe++){var O,k,U,W,ie=u[fe],re=ie.geometry,ie=ie.text?ie.text.toString():null;ie?(O=I(ie,re),k=I(ie,re,!0),O in d&&k in c&&d[O]!==c[k]?(U=A(O,k,re),W=S(O,k,m[U].geometry),delete c[O],delete d[k],d[I(ie,m[W].geometry,!0)]=W,m[U].geometry=null):O in d?S(O,k,re):k in c?A(O,k,re):(E(fe),c[O]=b-1,d[k]=b-1)):E(fe)}return m.filter(fe=>fe.geometry)}Di([{name:"triangle",components:3,type:"Uint16"}]),Di([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),Di([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),Di([{type:"Float32",name:"offsetX"}]),Di([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),Di([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const f_={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};function P7(u){let c="";for(let b=0;b<u.length;b++){var d=u.charCodeAt(b+1)||null,m=u.charCodeAt(b-1)||null;(!d||!Wb(d)||f_[u[b+1]])&&(!m||!Wb(m)||f_[u[b-1]])&&f_[u[b]]?c+=f_[u[b]]:c+=u[b]}return c}var eo=24,to={read:function(u,c,d,m,re){var E,S,A=8*re-m-1,I=(1<<A)-1,O=I>>1,k=-7,U=d?re-1:0,W=d?-1:1,re=u[c+U];for(U+=W,E=re&(1<<-k)-1,re>>=-k,k+=A;0<k;E=256*E+u[c+U],U+=W,k-=8);for(S=E&(1<<-k)-1,E>>=-k,k+=m;0<k;S=256*S+u[c+U],U+=W,k-=8);if(E===0)E=1-O;else{if(E===I)return S?NaN:1/0*(re?-1:1);S+=Math.pow(2,m),E-=O}return(re?-1:1)*S*Math.pow(2,E-m)},write:function(u,c,d,m,b,ie){var S,A,I=8*ie-b-1,O=(1<<I)-1,k=O>>1,U=b===23?Math.pow(2,-24)-Math.pow(2,-77):0,W=m?0:ie-1,re=m?1:-1,ie=c<0||c===0&&1/c<0?1:0;for(c=Math.abs(c),isNaN(c)||c===1/0?(A=isNaN(c)?1:0,S=O):(S=Math.floor(Math.log(c)/Math.LN2),c*(m=Math.pow(2,-S))<1&&(S--,m*=2),2<=(c+=1<=S+k?U/m:U*Math.pow(2,1-k))*m&&(S++,m/=2),O<=S+k?(A=0,S=O):1<=S+k?(A=(c*m-1)*Math.pow(2,b),S+=k):(A=c*Math.pow(2,k-1)*Math.pow(2,b),S=0));8<=b;u[d+W]=255&A,W+=re,A/=256,b-=8);for(S=S<<b|A,I+=b;0<I;u[d+W]=255&S,W+=re,S/=256,I-=8);u[d+W-re]|=128*ie}},$a=Vr,u1=to;function Vr(u){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(u)?u:new Uint8Array(u||0),this.pos=0,this.type=0,this.length=this.buf.length}Vr.Varint=0,Vr.Fixed64=1,Vr.Bytes=2,Vr.Fixed32=5;var hS=4294967296,Pk=1/hS,Mk=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function ql(u){return u.type===Vr.Bytes?u.readVarint()+u.pos:u.pos+1}function tg(u,c,d){return d?4294967296*c+(u>>>0):4294967296*(c>>>0)+(u>>>0)}function Rk(u,c,d){var m=c<=16383?1:c<=2097151?2:c<=268435455?3:Math.floor(Math.log(c)/(7*Math.LN2));d.realloc(m);for(var b=d.pos-1;u<=b;b--)d.buf[b+m]=d.buf[b]}function M7(u,c){for(var d=0;d<u.length;d++)c.writeVarint(u[d])}function R7(u,c){for(var d=0;d<u.length;d++)c.writeSVarint(u[d])}function k7(u,c){for(var d=0;d<u.length;d++)c.writeFloat(u[d])}function O7(u,c){for(var d=0;d<u.length;d++)c.writeDouble(u[d])}function L7(u,c){for(var d=0;d<u.length;d++)c.writeBoolean(u[d])}function N7(u,c){for(var d=0;d<u.length;d++)c.writeFixed32(u[d])}function D7(u,c){for(var d=0;d<u.length;d++)c.writeSFixed32(u[d])}function F7(u,c){for(var d=0;d<u.length;d++)c.writeFixed64(u[d])}function B7(u,c){for(var d=0;d<u.length;d++)c.writeSFixed64(u[d])}function h1(u,c){return(u[c]|u[c+1]<<8|u[c+2]<<16)+16777216*u[c+3]}function ng(u,c,d){u[d]=c,u[d+1]=c>>>8,u[d+2]=c>>>16,u[d+3]=c>>>24}function kk(u,c){return(u[c]|u[c+1]<<8|u[c+2]<<16)+(u[c+3]<<24)}Vr.prototype={destroy:function(){this.buf=null},readFields:function(u,c,d){for(d=d||this.length;this.pos<d;){var m=this.readVarint(),b=m>>3,E=this.pos;this.type=7&m,u(b,c,this),this.pos===E&&this.skip(m)}return c},readMessage:function(u,c){return this.readFields(u,c,this.readVarint()+this.pos)},readFixed32:function(){var u=h1(this.buf,this.pos);return this.pos+=4,u},readSFixed32:function(){var u=kk(this.buf,this.pos);return this.pos+=4,u},readFixed64:function(){var u=h1(this.buf,this.pos)+h1(this.buf,this.pos+4)*hS;return this.pos+=8,u},readSFixed64:function(){var u=h1(this.buf,this.pos)+kk(this.buf,this.pos+4)*hS;return this.pos+=8,u},readFloat:function(){var u=u1.read(this.buf,this.pos,!0,23,4);return this.pos+=4,u},readDouble:function(){var u=u1.read(this.buf,this.pos,!0,52,8);return this.pos+=8,u},readVarint:function(S){var b=this.buf,m=b[this.pos++],E=127&m;if(m<128||(E|=(127&(m=b[this.pos++]))<<7,m<128)||(E|=(127&(m=b[this.pos++]))<<14,m<128)||(E|=(127&(m=b[this.pos++]))<<21,m<128))return E;var c,d,m=E|=(15&b[this.pos])<<28,b=S,E=this,S=E.buf;if(d=S[E.pos++],c=(112&d)>>4,d<128||(d=S[E.pos++],c|=(127&d)<<3,d<128)||(d=S[E.pos++],c|=(127&d)<<10,d<128)||(d=S[E.pos++],c|=(127&d)<<17,d<128)||(d=S[E.pos++],c|=(127&d)<<24,d<128)||(d=S[E.pos++],c|=(1&d)<<31,d<128))return tg(m,c,b);throw new Error("Expected varint not more than 10 bytes")},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var u=this.readVarint();return u%2==1?(u+1)/-2:u/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var u=this.readVarint()+this.pos,c=this.pos;if(12<=(this.pos=u)-c&&Mk)return d=this.buf,Mk.decode(d.subarray(c,u));for(var d,m,b,E,S=this.buf,A=u,I="",O=c;O<A;){var k=S[O],U=null,W=239<k?4:223<k?3:191<k?2:1;if(A<O+W)break;W===1?k<128&&(U=k):W===2?(192&(m=S[O+1]))==128&&(U=(31&k)<<6|63&m)<=127&&(U=null):W===3?(m=S[O+1],b=S[O+2],(192&m)==128&&(192&b)==128&&((U=(15&k)<<12|(63&m)<<6|63&b)<=2047||55296<=U&&U<=57343)&&(U=null)):W===4&&(m=S[O+1],b=S[O+2],E=S[O+3],(192&m)==128)&&(192&b)==128&&(192&E)==128&&((U=(15&k)<<18|(63&m)<<12|(63&b)<<6|63&E)<=65535||1114112<=U)&&(U=null),U===null?(U=65533,W=1):65535<U&&(U-=65536,I+=String.fromCharCode(U>>>10&1023|55296),U=56320|1023&U),I+=String.fromCharCode(U),O+=W}return I},readBytes:function(){var u=this.readVarint()+this.pos,c=this.buf.subarray(this.pos,u);return this.pos=u,c},readPackedVarint:function(u,c){if(this.type!==Vr.Bytes)return u.push(this.readVarint(c));var d=ql(this);for(u=u||[];this.pos<d;)u.push(this.readVarint(c));return u},readPackedSVarint:function(u){if(this.type!==Vr.Bytes)return u.push(this.readSVarint());var c=ql(this);for(u=u||[];this.pos<c;)u.push(this.readSVarint());return u},readPackedBoolean:function(u){if(this.type!==Vr.Bytes)return u.push(this.readBoolean());var c=ql(this);for(u=u||[];this.pos<c;)u.push(this.readBoolean());return u},readPackedFloat:function(u){if(this.type!==Vr.Bytes)return u.push(this.readFloat());var c=ql(this);for(u=u||[];this.pos<c;)u.push(this.readFloat());return u},readPackedDouble:function(u){if(this.type!==Vr.Bytes)return u.push(this.readDouble());var c=ql(this);for(u=u||[];this.pos<c;)u.push(this.readDouble());return u},readPackedFixed32:function(u){if(this.type!==Vr.Bytes)return u.push(this.readFixed32());var c=ql(this);for(u=u||[];this.pos<c;)u.push(this.readFixed32());return u},readPackedSFixed32:function(u){if(this.type!==Vr.Bytes)return u.push(this.readSFixed32());var c=ql(this);for(u=u||[];this.pos<c;)u.push(this.readSFixed32());return u},readPackedFixed64:function(u){if(this.type!==Vr.Bytes)return u.push(this.readFixed64());var c=ql(this);for(u=u||[];this.pos<c;)u.push(this.readFixed64());return u},readPackedSFixed64:function(u){if(this.type!==Vr.Bytes)return u.push(this.readSFixed64());var c=ql(this);for(u=u||[];this.pos<c;)u.push(this.readSFixed64());return u},skip:function(u){if(u&=7,u===Vr.Varint)for(;127<this.buf[this.pos++];);else if(u===Vr.Bytes)this.pos=this.readVarint()+this.pos;else if(u===Vr.Fixed32)this.pos+=4;else{if(u!==Vr.Fixed64)throw new Error("Unimplemented type: "+u);this.pos+=8}},writeTag:function(u,c){this.writeVarint(u<<3|c)},realloc:function(u){for(var c,d=this.length||16;d<this.pos+u;)d*=2;d!==this.length&&((c=new Uint8Array(d)).set(this.buf),this.buf=c,this.length=d)},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(u){this.realloc(4),ng(this.buf,u,this.pos),this.pos+=4},writeSFixed32:function(u){this.realloc(4),ng(this.buf,u,this.pos),this.pos+=4},writeFixed64:function(u){this.realloc(8),ng(this.buf,-1&u,this.pos),ng(this.buf,Math.floor(u*Pk),this.pos+4),this.pos+=8},writeSFixed64:function(u){this.realloc(8),ng(this.buf,-1&u,this.pos),ng(this.buf,Math.floor(u*Pk),this.pos+4),this.pos+=8},writeVarint:function(u){if(268435455<(u=+u||0)||u<0){var d=u,b=this;if(0<=d?(c=d%4294967296|0,m=d/4294967296|0):(m=~(-d/4294967296),4294967295^(c=~(-d%4294967296))?c=c+1|0:m=m+1|(c=0)),18446744073709552e3<=d||d<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");b.realloc(10);var d=c,c=b,d=(c.buf[c.pos++]=127&d|128,d>>>=7,c.buf[c.pos++]=127&d|128,d>>>=7,c.buf[c.pos++]=127&d|128,d>>>=7,c.buf[c.pos++]=127&d|128,d>>>=7,c.buf[c.pos]=127&d,m),m=b,b=(7&d)<<4;m.buf[m.pos++]|=b|((d>>>=3)?128:0),d&&(m.buf[m.pos++]=127&d|((d>>>=7)?128:0),d)&&(m.buf[m.pos++]=127&d|((d>>>=7)?128:0),d)&&(m.buf[m.pos++]=127&d|((d>>>=7)?128:0),d)&&(m.buf[m.pos++]=127&d|((d>>>=7)?128:0),d)&&(m.buf[m.pos++]=127&d)}else this.realloc(4),this.buf[this.pos++]=127&u|(127<u?128:0),u<=127||(this.buf[this.pos++]=127&(u>>>=7)|(127<u?128:0),u<=127)||(this.buf[this.pos++]=127&(u>>>=7)|(127<u?128:0),u<=127)||(this.buf[this.pos++]=u>>>7&127)},writeSVarint:function(u){this.writeVarint(u<0?2*-u-1:2*u)},writeBoolean:function(u){this.writeVarint(!!u)},writeString:function(d){d=String(d),this.realloc(4*d.length),this.pos++;var c=this.pos,d=(this.pos=function(m,b,E){for(var S,A,I=0;I<b.length;I++){if(55295<(S=b.charCodeAt(I))&&S<57344){if(!A){56319<S||I+1===b.length?(m[E++]=239,m[E++]=191,m[E++]=189):A=S;continue}if(S<56320){m[E++]=239,m[E++]=191,m[E++]=189,A=S;continue}S=A-55296<<10|S-56320|65536,A=null}else A&&(m[E++]=239,m[E++]=191,m[E++]=189,A=null);S<128?m[E++]=S:(S<2048?m[E++]=S>>6|192:(S<65536?m[E++]=S>>12|224:(m[E++]=S>>18|240,m[E++]=S>>12&63|128),m[E++]=S>>6&63|128),m[E++]=63&S|128)}return E}(this.buf,d,this.pos),this.pos-c);128<=d&&Rk(c,d,this),this.pos=c-1,this.writeVarint(d),this.pos+=d},writeFloat:function(u){this.realloc(4),u1.write(this.buf,u,this.pos,!0,23,4),this.pos+=4},writeDouble:function(u){this.realloc(8),u1.write(this.buf,u,this.pos,!0,52,8),this.pos+=8},writeBytes:function(u){var c=u.length;this.writeVarint(c),this.realloc(c);for(var d=0;d<c;d++)this.buf[this.pos++]=u[d]},writeRawMessage:function(m,c){this.pos++;var d=this.pos,m=(m(c,this),this.pos-d);128<=m&&Rk(d,m,this),this.pos=d-1,this.writeVarint(m),this.pos+=m},writeMessage:function(u,c,d){this.writeTag(u,Vr.Bytes),this.writeRawMessage(c,d)},writePackedVarint:function(u,c){c.length&&this.writeMessage(u,M7,c)},writePackedSVarint:function(u,c){c.length&&this.writeMessage(u,R7,c)},writePackedBoolean:function(u,c){c.length&&this.writeMessage(u,L7,c)},writePackedFloat:function(u,c){c.length&&this.writeMessage(u,k7,c)},writePackedDouble:function(u,c){c.length&&this.writeMessage(u,O7,c)},writePackedFixed32:function(u,c){c.length&&this.writeMessage(u,N7,c)},writePackedSFixed32:function(u,c){c.length&&this.writeMessage(u,D7,c)},writePackedFixed64:function(u,c){c.length&&this.writeMessage(u,F7,c)},writePackedSFixed64:function(u,c){c.length&&this.writeMessage(u,B7,c)},writeBytesField:function(u,c){this.writeTag(u,Vr.Bytes),this.writeBytes(c)},writeFixed32Field:function(u,c){this.writeTag(u,Vr.Fixed32),this.writeFixed32(c)},writeSFixed32Field:function(u,c){this.writeTag(u,Vr.Fixed32),this.writeSFixed32(c)},writeFixed64Field:function(u,c){this.writeTag(u,Vr.Fixed64),this.writeFixed64(c)},writeSFixed64Field:function(u,c){this.writeTag(u,Vr.Fixed64),this.writeSFixed64(c)},writeVarintField:function(u,c){this.writeTag(u,Vr.Varint),this.writeVarint(c)},writeSVarintField:function(u,c){this.writeTag(u,Vr.Varint),this.writeSVarint(c)},writeStringField:function(u,c){this.writeTag(u,Vr.Bytes),this.writeString(c)},writeFloatField:function(u,c){this.writeTag(u,Vr.Fixed32),this.writeFloat(c)},writeDoubleField:function(u,c){this.writeTag(u,Vr.Fixed64),this.writeDouble(c)},writeBooleanField:function(u,c){this.writeVarintField(u,!!c)}};var d1,dS=a($a);const fS=3;function U7(u,c,d){u===1&&d.readMessage(z7,c)}function z7(u,c,d){var m,b,E,S,A;u===3&&({id:u,bitmap:d,width:m,height:b,left:E,top:S,advance:A}=d.readMessage(j7,{}),c.push({id:u,bitmap:new a_({width:m+2*fS,height:b+2*fS},d),metrics:{width:m,height:b,left:E,top:S,advance:A}}))}function j7(u,c,d){u===1?c.id=d.readVarint():u===2?c.bitmap=d.readBytes():u===3?c.width=d.readVarint():u===4?c.height=d.readVarint():u===5?c.left=d.readSVarint():u===6?c.top=d.readSVarint():u===7&&(c.advance=d.readVarint())}const Ok=fS;function Lk(u){let c=0,d=0;for(const I of u)c+=I.w*I.h,d=Math.max(d,I.w);u.sort((I,O)=>O.h-I.h);var m=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(c/.95)),d),h:1/0}];let b=0,E=0;for(const I of u)for(let O=m.length-1;0<=O;O--){var S,A=m[O];if(!(I.w>A.w||I.h>A.h)){I.x=A.x,I.y=A.y,E=Math.max(E,I.y+I.h),b=Math.max(b,I.x+I.w),I.w===A.w&&I.h===A.h?(S=m.pop(),O<m.length&&(m[O]=S)):I.h===A.h?(A.x+=I.w,A.w-=I.w):(I.w!==A.w&&m.push({x:A.x+I.w,y:A.y,w:A.w-I.w,h:I.h}),A.y+=I.h,A.h-=I.h);break}}return{w:b,h:E,fill:c/(b*E)||0}}(Mr=d1=d1||{}).none="none",Mr.height="height",Mr.width="width";const Sa=1;class pS{constructor(c,{pixelRatio:d,version:m,stretchX:b,stretchY:E,content:S,contentMatch:A}){this.paddedRect=c,this.pixelRatio=d,this.stretchX=b,this.stretchY=E,this.content=S,this.version=m,this.contentMatch=A}get tl(){return[this.paddedRect.x+Sa,this.paddedRect.y+Sa]}get br(){return[this.paddedRect.x+this.paddedRect.w-Sa,this.paddedRect.y+this.paddedRect.h-Sa]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2*Sa)/this.pixelRatio,(this.paddedRect.h-2*Sa)/this.pixelRatio]}}class Nk{constructor(c,d){var m={},b={},E=(this.haveRenderCallbacks=[],[]);this.addImages(c,m,E),this.addImages(d,b,E);const{w:S,h:A}=Lk(E);var I=new ys({width:S||1,height:A||1});for(const re in c){var O=c[re],k=m[re].paddedRect;ys.copy(O.data,I,{x:0,y:0},{x:k.x+Sa,y:k.y+Sa},O.data)}for(const re in d){var U=d[re],W=b[re].paddedRect;const ie=W.x+Sa,fe=W.y+Sa,we=U.data.width,de=U.data.height;ys.copy(U.data,I,{x:0,y:0},{x:ie,y:fe},U.data),ys.copy(U.data,I,{x:0,y:de-1},{x:ie,y:fe-1},{width:we,height:1}),ys.copy(U.data,I,{x:0,y:0},{x:ie,y:fe+de},{width:we,height:1}),ys.copy(U.data,I,{x:we-1,y:0},{x:ie-1,y:fe},{width:1,height:de}),ys.copy(U.data,I,{x:0,y:0},{x:ie+we,y:fe},{width:1,height:de})}this.image=I,this.iconPositions=m,this.patternPositions=b}addImages(c,d,m){for(const S in c){var b=c[S],E={x:0,y:0,w:b.data.width+2*Sa,h:b.data.height+2*Sa};m.push(E),d[S]=new pS(E,b),b.hasRenderCallback&&this.haveRenderCallbacks.push(S)}}patchUpdatedImages(c,d){c.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const m in c.updatedImages)this.patchUpdatedImage(this.iconPositions[m],c.getImage(m),d),this.patchUpdatedImage(this.patternPositions[m],c.getImage(m),d)}patchUpdatedImage(c,d,m){var b;c&&d&&c.version!==d.version&&(c.version=d.version,[c,b]=c.tl,m.update(d.data,void 0,{x:c,y:b}))}}Vt("ImagePosition",pS),Vt("ImageAtlas",Nk),i.WritingMode=void 0,(to=i.WritingMode||(i.WritingMode={}))[to.none=0]="none",to[to.horizontal=1]="horizontal",to[to.vertical=2]="vertical",to[to.horizontalOnly=3]="horizontalOnly";const p_=-17;class g_{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(c,d){var m=new g_;return m.scale=c||1,m.fontStack=d,m}static forImage(c){var d=new g_;return d.imageName=c,d}}class rg{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(c,d){var m=new rg;for(let E=0;E<c.sections.length;E++){var b=c.sections[E];b.image?m.addImageSection(b):m.addTextSection(b,d)}return m}length(){return this.text.length}getSection(c){return this.sections[this.sectionIndex[c]]}getSectionIndex(c){return this.sectionIndex[c]}getCharCode(c){return this.text.charCodeAt(c)}verticalizePunctuation(){this.text=P7(this.text)}trim(){let c=0;for(let m=0;m<this.text.length&&p1[this.text.charCodeAt(m)];m++)c++;let d=this.text.length;for(let m=this.text.length-1;0<=m&&m>=c&&p1[this.text.charCodeAt(m)];m--)d--;this.text=this.text.substring(c,d),this.sectionIndex=this.sectionIndex.slice(c,d)}substring(c,d){var m=new rg;return m.text=this.text.substring(c,d),m.sectionIndex=this.sectionIndex.slice(c,d),m.sections=this.sections,m}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((c,d)=>Math.max(c,this.sections[d].scale),0)}addTextSection(c,d){this.text+=c.text,this.sections.push(g_.forText(c.scale,c.fontStack||d));var m=this.sections.length-1;for(let b=0;b<c.text.length;++b)this.sectionIndex.push(m)}addImageSection(m){var d,m=m.image?m.image.name:"";m.length===0?Ee("Can't add FormattedSection with an empty image."):(d=this.getNextImageSectionCharCode())?(this.text+=String.fromCharCode(d),this.sections.push(g_.forImage(m)),this.sectionIndex.push(this.sections.length-1)):Ee("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?63743<=this.imageSectionID?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function f1(Me,c,d,m,Ve,E,S,A,I,O,k,U,W,re,ie,fe){var we=rg.fromFeature(Me,Ve);U===i.WritingMode.vertical&&we.verticalizePunctuation();let de;var{processBidirectionalText:Me,processStyledBidirectionalText:Ve}=Hl;if(Me&&we.sections.length===1){de=[];for(const no of Me(we.toString(),gS(we,O,E,c,m,re,ie))){var $e=new rg;$e.text=no,$e.sections=we.sections;for(let Po=0;Po<no.length;Po++)$e.sectionIndex.push(0);de.push($e)}}else if(Ve){de=[];for(const no of Ve(we.text,we.sectionIndex,gS(we,O,E,c,m,re,ie))){var Ye=new rg;Ye.text=no[0],Ye.sectionIndex=no[1],Ye.sections=we.sections,de.push(Ye)}}else de=function(no,Po){var Ys=[],$l=no.text;let _r=0;for(const gr of Po)Ys.push(no.substring(_r,gr)),_r=gr;return _r<$l.length&&Ys.push(no.substring(_r,$l.length)),Ys}(we,gS(we,O,E,c,m,re,ie));Me=[],Ve={positionedLines:Me,text:we.toString(),top:k[1],bottom:k[1],left:k[0],right:k[0],writingMode:U,iconsInText:!1,verticalizable:!1};{var et=Ve,mt=c,Ut=d,Nt=m,ut=(E=de,S),kt=(re=A,ie=I,U),vt=O,dt=W,tt=fe;let no=0,Po=p_,Ys=0,$l=0;var Gt=ie==="right"?1:ie==="left"?0:.5;let _r=0;for(const Hi of E){Hi.trim();var zt=Hi.getMaxScale(),Wt=(zt-1)*eo,Sn={positionedGlyphs:[],lineOffset:0},qn=(et.positionedLines[_r]=Sn).positionedGlyphs;let Ca=0;if(Hi.length()){for(let Wr=0;Wr<Hi.length();Wr++){var An=Hi.getSection(Wr),pr=Hi.getSectionIndex(Wr),mn=Hi.getCharCode(Wr);let Gi=0,Mo=null,Ho=null,Wa=null,Ro=eo;var kn=!(kt===i.WritingMode.horizontal||!dt&&!Pd(mn)||dt&&(p1[mn]||function(Go){return Ft.Arabic(Go)||Ft["Arabic Supplement"](Go)||Ft["Arabic Extended-A"](Go)||Ft["Arabic Presentation Forms-A"](Go)||Ft["Arabic Presentation Forms-B"](Go)}(mn)));if(An.imageName){var sr=Nt[An.imageName];if(!sr)continue;Wa=An.imageName,et.iconsInText=et.iconsInText||!0,Ho=sr.paddedRect;var sr=sr.displaySize,Rr=(An.scale=An.scale*eo/tt,Mo={width:sr[0],height:sr[1],left:Sa,top:-Ok,advance:kn?sr[1]:sr[0]},eo-sr[1]*An.scale),Rr=(Gi=Wt+Rr,Ro=Mo.advance,kn?sr[0]*An.scale-eo*zt:sr[1]*An.scale-eo*zt);0<Rr&&Rr>Ca&&(Ca=Rr)}else{if(sr=Ut[An.fontStack],Rr=sr&&sr[mn],Rr&&Rr.rect)Ho=Rr.rect,Mo=Rr.metrics;else{var vs=mt[An.fontStack],vs=vs&&vs[mn];if(!vs)continue;Mo=vs.metrics}Gi=(zt-An.scale)*eo}kn?(et.verticalizable=!0,qn.push({glyph:mn,imageName:Wa,x:no,y:Po+Gi,vertical:kn,scale:An.scale,fontStack:An.fontStack,sectionIndex:pr,metrics:Mo,rect:Ho}),no+=Ro*An.scale+vt):(qn.push({glyph:mn,imageName:Wa,x:no,y:Po+Gi,vertical:kn,scale:An.scale,fontStack:An.fontStack,sectionIndex:pr,metrics:Mo,rect:Ho}),no+=Mo.advance*An.scale+vt)}qn.length!==0&&(ca=no-vt,Ys=Math.max(ca,Ys),function(Wr,Gi,Mo,Ho,Wa){if(Ho||Wa){var Ro=Wr[Mo],Ro=Ro.metrics.advance*Ro.scale,Go=(Wr[Mo].x+Ro)*Ho;for(let Ks=Gi;Ks<=Mo;Ks++)Wr[Ks].x-=Go,Wr[Ks].y+=Wa}}(qn,0,qn.length-1,Gt,Ca)),no=0;var ca=ut*zt+Ca;Sn.lineOffset=Math.max(Ca,Wt),Po+=ca,$l=Math.max(ca,$l)}else Po+=ut;++_r}var ie=Po-p_,{horizontalAlign:re,verticalAlign:k}=mS(re);{var cr=et.positionedLines,nr=Gt,yc=re,ch=k,$s=Ys,qc=$l,Vo=ut,Ws=ie,kS=E.length,b_=(nr-yc)*$s;let Hi=0;Hi=qc!==Vo?-Ws*ch-p_:(-ch*kS+.5)*Vo;for(const Ca of cr)for(const Wr of Ca.positionedGlyphs)Wr.x+=b_,Wr.y+=Hi}et.top+=-k*ie,et.bottom=et.top+ie,et.left+=-re*Ys,et.right=et.left+Ys}return!function(no){for(const Po of no)if(Po.positionedGlyphs.length!==0)return;return 1}(Me)&&Ve}const p1={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},V7={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function Dk(u,c,d,m,b,E){return c.imageName?(m=m[c.imageName])?m.displaySize[0]*c.scale*eo/E+b:0:(E=(m=d[c.fontStack])&&m[u])?E.metrics.advance*c.scale+b:0}function Fk(u,c,d,m){var b=Math.pow(u-c,2);return m?u<c?b/2:2*b:b+Math.abs(d)*d}function Bk(u,c,d,m,b,E){let S=null,A=Fk(c,d,b,E);for(const O of m){var I=Fk(c-O.x,d,b,E)+O.badness;I<=A&&(S=O,A=I)}return{index:u,x:c,priorBreak:S,badness:A}}function gS(u,c,d,m,b,E,S){if(E!=="point")return[];if(!u)return[];var A=[],I=function(ie,fe,we,de,Me,Ve){let $e=0;for(let et=0;et<ie.length();et++){var Ye=ie.getSection(et);$e+=Dk(ie.getCharCode(et),Ye,de,Me,fe,Ve)}return we=Math.max(1,Math.ceil($e/we)),$e/we}(u,c,d,m,b,S),O=0<=u.text.indexOf("");let k=0;for(let ie=0;ie<u.length();ie++){var U,W=u.getSection(ie),re=u.getCharCode(ie);p1[re]||(k+=Dk(re,W,m,b,c,S)),ie<u.length()-1&&(U=!((U=re)<11904||!Ft["Bopomofo Extended"](U)&&!(Ft.Bopomofo(U)||Ft["CJK Compatibility Forms"](U)||Ft["CJK Compatibility Ideographs"](U)||Ft["CJK Compatibility"](U)||Ft["CJK Radicals Supplement"](U)||Ft["CJK Strokes"](U)||Ft["CJK Symbols and Punctuation"](U)||Ft["CJK Unified Ideographs Extension A"](U)||Ft["CJK Unified Ideographs"](U)||Ft["Enclosed CJK Letters and Months"](U)||Ft["Halfwidth and Fullwidth Forms"](U)||Ft.Hiragana(U)||Ft["Ideographic Description Characters"](U)||Ft["Kangxi Radicals"](U)||Ft["Katakana Phonetic Extensions"](U)||Ft.Katakana(U)||Ft["Vertical Forms"](U)||Ft["Yi Radicals"](U)||Ft["Yi Syllables"](U))),V7[re]||U||W.imageName)&&A.push(Bk(ie+1,k,I,A,function(fe,we,de){let Me=0;return fe===10&&(Me-=1e4),de&&(Me+=150),fe!==40&&fe!==65288||(Me+=50),we!==41&&we!==65289||(Me+=50),Me}(re,u.getCharCode(ie+1),U&&O),!1))}return function ie(fe){return fe?ie(fe.priorBreak).concat(fe.index):[]}(Bk(u.length(),k,I,A,0,!0))}function mS(u){let c=.5,d=.5;switch(u){case"right":case"top-right":case"bottom-right":c=1;break;case"left":case"top-left":case"bottom-left":c=0}switch(u){case"bottom":case"bottom-right":case"bottom-left":d=1;break;case"top":case"top-right":case"top-left":d=0}return{horizontalAlign:c,verticalAlign:d}}function Uk(u){let c=u.left,d=u.top,m=u.right-c,b=u.bottom-d;var E=u.image.content[2]-u.image.content[0],S=u.image.content[3]-u.image.content[1];return S!=0&&m!==0&&b!==0&&(E=E/S,u.image.contentMatch===d1.height?m/b<E&&(S=b*E,c*=S/m,m=S):u.image.contentMatch===d1.width&&E!=0&&m/b>E&&(S=m/E,d*=S/S,b=S)),{x1:c,y1:d,x2:c+m,y2:d+b}}function zk(u,c,d,m,b,E){u=u.image;let S;u.content&&(A=u.content,I=u.pixelRatio||1,S=[A[0]/I,A[1]/I,u.displaySize[0]-A[2]/I,u.displaySize[1]-A[3]/I]);var A=c.left*E,I=c.right*E;let O,k,U,W;return k=d==="width"||d==="both"?(W=b[0]+A-m[3],b[0]+I+m[1]):(W=b[0]+(A+I-u.displaySize[0])/2)+u.displaySize[0],A=c.top*E,I=c.bottom*E,U=d==="height"||d==="both"?(O=b[1]+A-m[0],b[1]+I+m[2]):(O=b[1]+(A+I-u.displaySize[1])/2)+u.displaySize[1],{image:u,top:O,right:k,bottom:U,left:W,collisionPadding:S}}const m_=255,Gc=128,ih=m_*Gc;function jk(u,c){if(c=c.expression,c.kind==="constant")return{kind:"constant",layoutSize:c.evaluate(new Ur(u+1))};if(c.kind==="source")return{kind:"source"};{var{zoomStops:d,interpolationType:m}=c;let S=0;for(;S<d.length&&d[S]<=u;)S++;let A=S=Math.max(0,S-1);for(;A<d.length&&d[A]<u+1;)A++;A=Math.min(d.length-1,A);var b=d[S],E=d[A];return c.kind==="composite"?{kind:"composite",minZoom:b,maxZoom:E,interpolationType:m}:{kind:"camera",minZoom:b,maxZoom:E,minSize:c.evaluate(new Ur(b)),maxSize:c.evaluate(new Ur(E)),interpolationType:m}}}function yS(u,c,d){let m="never";return c=u.get(c),c?m=c:u.get(d)&&(m="always"),m}const H7=rh.VectorTileFeature.types,G7=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function g1(u,c,d,m,b,E,S,ie,I,O,k,U,W){var re=ie?Math.min(ih,Math.round(ie[0])):0,ie=ie?Math.min(ih,Math.round(ie[1])):0;u.emplaceBack(c,d,Math.round(32*m),Math.round(32*b),E,S,(re<<1)+(I?1:0),ie,16*O,16*k,256*U,256*W)}function _S(u,c,d){u.emplaceBack(c.x,c.y,d),u.emplaceBack(c.x,c.y,d),u.emplaceBack(c.x,c.y,d),u.emplaceBack(c.x,c.y,d)}function q7(u){for(const c of u.sections)if(function(d){for(const m of d)if(Yb(m.charCodeAt(0)))return 1}(c.text))return!0;return!1}class vS{constructor(c){this.layoutVertexArray=new i1,this.indexArray=new eh,this.programConfigurations=c,this.segments=new w,this.dynamicLayoutVertexArray=new Dd,this.opacityVertexArray=new ZT,this.hasVisibleVertices=!1,this.placedSymbolArray=new t_}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(c,d,m,b){!this.isEmpty()&&(m&&(this.layoutVertexBuffer=c.createVertexBuffer(this.layoutVertexArray,T7.members),this.indexBuffer=c.createIndexBuffer(this.indexArray,d),this.dynamicLayoutVertexBuffer=c.createVertexBuffer(this.dynamicLayoutVertexArray,S7.members,!0),this.opacityVertexBuffer=c.createVertexBuffer(this.opacityVertexArray,G7,!0),this.opacityVertexBuffer.itemSize=1),m||b)&&this.programConfigurations.upload(c)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}Vt("SymbolBuffers",vS);class bS{constructor(c,d,m){this.layoutVertexArray=new c,this.layoutAttributes=d,this.indexArray=new m,this.segments=new w,this.collisionVertexArray=new XT}upload(c){this.layoutVertexBuffer=c.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=c.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=c.createVertexBuffer(this.collisionVertexArray,C7.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}Vt("CollisionBuffers",bS);class ig{constructor(c){this.collisionBoxArray=c.collisionBoxArray,this.zoom=c.zoom,this.overscaling=c.overscaling,this.layers=c.layers,this.layerIds=this.layers.map(E=>E.id),this.index=c.index,this.pixelRatio=c.pixelRatio,this.sourceLayerIndex=c.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=zr([]),this.placementViewportMatrix=zr([]);var d=this.layers[0]._unevaluatedLayout._values,d=(this.textSizeData=jk(this.zoom,d["text-size"]),this.iconSizeData=jk(this.zoom,d["icon-size"]),this.layers[0].layout),b=d.get("symbol-sort-key"),m=d.get("symbol-z-order"),b=(this.canOverlap=yS(d,"text-overlap","text-allow-overlap")!=="never"||yS(d,"icon-overlap","icon-allow-overlap")!=="never"||d.get("text-ignore-placement")||d.get("icon-ignore-placement"),this.sortFeaturesByKey=m!=="viewport-y"&&!b.isConstant(),m==="viewport-y"||m==="auto"&&!this.sortFeaturesByKey);this.sortFeaturesByY=b&&this.canOverlap,d.get("symbol-placement")==="point"&&(this.writingModes=d.get("text-writing-mode").map(E=>i.WritingMode[E])),this.stateDependentLayerIds=this.layers.filter(E=>E.isStateDependent()).map(E=>E.id),this.sourceID=c.sourceID}createArrays(){this.text=new vS(new Qe(this.layers,this.zoom,c=>/^text/.test(c))),this.icon=new vS(new Qe(this.layers,this.zoom,c=>/^icon/.test(c))),this.glyphOffsetArray=new t1,this.lineVertexArray=new n1,this.symbolInstances=new e1,this.textAnchorOffsets=new r1}calculateGlyphDependencies(c,d,m,b,E){for(let A=0;A<c.length;A++){var S;d[c.charCodeAt(A)]=!0,(m||b)&&E&&(S=f_[c.charAt(A)])&&(d[S.charCodeAt(0)]=!0)}}populate(c,d,m){var b=this.layers[0],E=b.layout,S=E.get("text-font"),A=E.get("text-field"),I=E.get("icon-image"),O=(A.value.kind!=="constant"||A.value.value instanceof Zi&&!A.value.value.isEmpty()||0<A.value.value.toString().length)&&(S.value.kind!=="constant"||0<S.value.value.length),k=I.value.kind!=="constant"||!!I.value.value||0<Object.keys(I.parameters).length,U=E.get("symbol-sort-key");if(this.features=[],O||k){var W,re,ie,fe,we=d.iconDependencies,de=d.glyphDependencies,Me=d.availableImages,Ve=new Ur(this.zoom);for({feature:W,id:re,index:ie,sourceLayerIndex:fe}of c){var $e,Ye=b._featureFilter.needGeometry,et=Yt(W,Ye);if(b._featureFilter.filter(Ve,et,m)){Ye||(et.geometry=Dt(W));let kt;O&&(Ye=b.getValueAndResolveTokens("text-field",et,m,Me),Ye=Zi.factory(Ye),!($e=this.hasRTLText=this.hasRTLText||q7(Ye))||Hl.getRTLTextPluginStatus()==="unavailable"||$e&&Hl.isParsed())&&(kt=A7(Ye,b,et));let vt;if(k&&($e=b.getValueAndResolveTokens("icon-image",et,m,Me),vt=$e instanceof zo?$e:zo.fromString($e)),(kt||vt)&&(Ye=this.sortFeaturesByKey?U.evaluate(et,{},m):void 0,Ye={id:re,text:kt,icon:vt,index:ie,sourceLayerIndex:fe,geometry:et.geometry,properties:W.properties,type:H7[W.type],sortKey:Ye},this.features.push(Ye),vt&&(we[vt.name]=!0),kt)){var mt,Ut,Nt=S.evaluate(et,{},m).join(","),ut=E.get("text-rotation-alignment")!=="viewport"&&E.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&0<=this.writingModes.indexOf(i.WritingMode.vertical);for(const dt of kt.sections)dt.image?we[dt.image.name]=!0:(mt=Vl(kt.toString()),Ut=de[Ut=dt.fontStack||Nt]=de[Ut]||{},this.calculateGlyphDependencies(dt.text,Ut,ut,this.allowVerticalPlacement,mt))}}}E.get("symbol-placement")==="line"&&(this.features=I7(this.features)),this.sortFeaturesByKey&&this.features.sort((kt,vt)=>kt.sortKey-vt.sortKey)}}update(c,d,m){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(c,d,this.layers,m),this.icon.programConfigurations.updatePaintArrays(c,d,this.layers,m))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(c){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(c),this.iconCollisionBox.upload(c)),this.text.upload(c,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(c,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(c,d){var m=this.lineVertexArray.length;if(c.segment!==void 0){let S=c.dist(d[c.segment+1]),A=c.dist(d[c.segment]);var b={};for(let I=c.segment+1;I<d.length;I++)b[I]={x:d[I].x,y:d[I].y,tileUnitDistanceFromAnchor:S},I<d.length-1&&(S+=d[I+1].dist(d[I]));for(let I=c.segment||0;0<=I;I--)b[I]={x:d[I].x,y:d[I].y,tileUnitDistanceFromAnchor:A},0<I&&(A+=d[I-1].dist(d[I]));for(let I=0;I<d.length;I++){var E=b[I];this.lineVertexArray.emplaceBack(E.x,E.y,E.tileUnitDistanceFromAnchor)}}return{lineStartIndex:m,lineLength:this.lineVertexArray.length-m}}addSymbols(c,d,m,b,E,S,A,I,O,k,U,W){var re=c.indexArray,ie=c.layoutVertexArray,fe=c.segments.prepareSegment(4*d.length,ie,re,this.canOverlap?S.sortKey:void 0),we=this.glyphOffsetArray.length,de=fe.vertexLength,Me=this.allowVerticalPlacement&&A===i.WritingMode.vertical?Math.PI/2:0,Ve=S.text&&S.text.sections;for(let Sn=0;Sn<d.length;Sn++){var{tl:$e,tr:Ye,bl:et,br:mt,tex:Ut,pixelOffsetTL:Nt,pixelOffsetBR:ut,minFontScaleX:kt,minFontScaleY:vt,glyphOffset:dt,isSDF:tt,sectionIndex:Gt}=d[Sn],zt=fe.vertexLength,Wt=dt[1];g1(ie,I.x,I.y,$e.x,Wt+$e.y,Ut.x,Ut.y,m,tt,Nt.x,Nt.y,kt,vt),g1(ie,I.x,I.y,Ye.x,Wt+Ye.y,Ut.x+Ut.w,Ut.y,m,tt,ut.x,Nt.y,kt,vt),g1(ie,I.x,I.y,et.x,Wt+et.y,Ut.x,Ut.y+Ut.h,m,tt,Nt.x,ut.y,kt,vt),g1(ie,I.x,I.y,mt.x,Wt+mt.y,Ut.x+Ut.w,Ut.y+Ut.h,m,tt,ut.x,ut.y,kt,vt),_S(c.dynamicLayoutVertexArray,I,Me),re.emplaceBack(zt,zt+1,zt+2),re.emplaceBack(zt+1,zt+2,zt+3),fe.vertexLength+=4,fe.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(dt[0]),Sn!==d.length-1&&Gt===d[Sn+1].sectionIndex||c.programConfigurations.populatePaintArrays(ie.length,S,S.index,{},W,Ve&&Ve[Gt])}c.placedSymbolArray.emplaceBack(I.x,I.y,we,this.glyphOffsetArray.length-we,de,O,k,I.segment,m?m[0]:0,m?m[1]:0,b[0],b[1],A,0,!1,0,U)}_addCollisionDebugVertex(c,d,m,b,E,S){return d.emplaceBack(0,0),c.emplaceBack(m.x,m.y,b,E,Math.round(S.x),Math.round(S.y))}addCollisionDebugVertices(c,ie,m,b,E,S,re){var I=E.segments.prepareSegment(4,E.layoutVertexArray,E.indexArray),O=I.vertexLength,k=E.layoutVertexArray,U=E.collisionVertexArray,W=re.anchorX,re=re.anchorY,ie=(this._addCollisionDebugVertex(k,U,S,W,re,new p(c,ie)),this._addCollisionDebugVertex(k,U,S,W,re,new p(m,ie)),this._addCollisionDebugVertex(k,U,S,W,re,new p(m,b)),this._addCollisionDebugVertex(k,U,S,W,re,new p(c,b)),I.vertexLength+=4,E.indexArray);ie.emplaceBack(O,O+1),ie.emplaceBack(O+1,O+2),ie.emplaceBack(O+2,O+3),ie.emplaceBack(O+3,O),I.primitiveLength+=4}addDebugCollisionBoxes(c,d,m,b){for(let k=c;k<d;k++){var E=this.collisionBoxArray.get(k),S=E.x1,A=E.y1,I=E.x2,O=E.y2;this.addCollisionDebugVertices(S,A,I,O,b?this.textCollisionBox:this.iconCollisionBox,E.anchorPoint,m)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new bS(o1,Ik.members,Qp),this.iconCollisionBox=new bS(o1,Ik.members,Qp);for(let d=0;d<this.symbolInstances.length;d++){var c=this.symbolInstances.get(d);this.addDebugCollisionBoxes(c.textBoxStartIndex,c.textBoxEndIndex,c,!0),this.addDebugCollisionBoxes(c.verticalTextBoxStartIndex,c.verticalTextBoxEndIndex,c,!0),this.addDebugCollisionBoxes(c.iconBoxStartIndex,c.iconBoxEndIndex,c,!1),this.addDebugCollisionBoxes(c.verticalIconBoxStartIndex,c.verticalIconBoxEndIndex,c,!1)}}_deserializeCollisionBoxesForSymbol(c,d,m,b,E,S,A,I,O){var k={};for(let fe=d;fe<m;fe++){var U=c.get(fe);k.textBox={x1:U.x1,y1:U.y1,x2:U.x2,y2:U.y2,anchorPointX:U.anchorPointX,anchorPointY:U.anchorPointY},k.textFeatureIndex=U.featureIndex;break}for(let fe=b;fe<E;fe++){var W=c.get(fe);k.verticalTextBox={x1:W.x1,y1:W.y1,x2:W.x2,y2:W.y2,anchorPointX:W.anchorPointX,anchorPointY:W.anchorPointY},k.verticalTextFeatureIndex=W.featureIndex;break}for(let fe=S;fe<A;fe++){var re=c.get(fe);k.iconBox={x1:re.x1,y1:re.y1,x2:re.x2,y2:re.y2,anchorPointX:re.anchorPointX,anchorPointY:re.anchorPointY},k.iconFeatureIndex=re.featureIndex;break}for(let fe=I;fe<O;fe++){var ie=c.get(fe);k.verticalIconBox={x1:ie.x1,y1:ie.y1,x2:ie.x2,y2:ie.y2,anchorPointX:ie.anchorPointX,anchorPointY:ie.anchorPointY},k.verticalIconFeatureIndex=ie.featureIndex;break}return k}deserializeCollisionBoxes(c){this.collisionArrays=[];for(let m=0;m<this.symbolInstances.length;m++){var d=this.symbolInstances.get(m);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(c,d.textBoxStartIndex,d.textBoxEndIndex,d.verticalTextBoxStartIndex,d.verticalTextBoxEndIndex,d.iconBoxStartIndex,d.iconBoxEndIndex,d.verticalIconBoxStartIndex,d.verticalIconBoxEndIndex))}}hasTextData(){return 0<this.text.segments.get().length}hasIconData(){return 0<this.icon.segments.get().length}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&0<this.textCollisionBox.segments.get().length}hasIconCollisionBoxData(){return this.hasDebugData()&&0<this.iconCollisionBox.segments.get().length}addIndicesForPlacedSymbol(c,m){var m=c.placedSymbolArray.get(m),b=m.vertexStartIndex+4*m.numGlyphs;for(let E=m.vertexStartIndex;E<b;E+=4)c.indexArray.emplaceBack(E,E+1,E+2),c.indexArray.emplaceBack(E+1,E+2,E+3)}getSortedSymbolIndexes(c){if(this.sortedAngle===c&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;var d=Math.sin(c),m=Math.cos(c);const b=[],E=[];var S=[];for(let I=0;I<this.symbolInstances.length;++I){S.push(I);var A=this.symbolInstances.get(I);b.push(0|Math.round(d*A.anchorX+m*A.anchorY)),E.push(A.featureIndex)}return S.sort((I,O)=>b[I]-b[O]||E[O]-E[I]),S}addToSortKeyRanges(c,d){var m=this.sortKeyRanges[this.sortKeyRanges.length-1];m&&m.sortKey===d?m.symbolInstanceEnd=c+1:this.sortKeyRanges.push({sortKey:d,symbolInstanceStart:c,symbolInstanceEnd:c+1})}sortFeatures(c){if(this.sortFeaturesByY&&this.sortedAngle!==c&&!(1<this.text.segments.get().length||1<this.icon.segments.get().length)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(c),this.sortedAngle=c,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const m of this.symbolInstanceIndexes){var d=this.symbolInstances.get(m);this.featureSortOrder.push(d.featureIndex),[d.rightJustifiedTextSymbolIndex,d.centerJustifiedTextSymbolIndex,d.leftJustifiedTextSymbolIndex].forEach((b,E,S)=>{0<=b&&S.indexOf(b)===E&&this.addIndicesForPlacedSymbol(this.text,b)}),0<=d.verticalPlacedTextSymbolIndex&&this.addIndicesForPlacedSymbol(this.text,d.verticalPlacedTextSymbolIndex),0<=d.placedIconSymbolIndex&&this.addIndicesForPlacedSymbol(this.icon,d.placedIconSymbolIndex),0<=d.verticalPlacedIconSymbolIndex&&this.addIndicesForPlacedSymbol(this.icon,d.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}function $7(u,c){return c.replace(/{([^{}]+)}/g,(d,m)=>u&&m in u?String(u[m]):"")}Vt("SymbolBucket",ig,{omit:["layers","collisionBoxArray","features","compareText"]}),ig.MAX_GLYPHS=65535,ig.addDynamicAttributes=_S;let Vk,Hk;var wS={get paint(){return Hk=Hk||new jo({"icon-opacity":new wn(q.paint_symbol["icon-opacity"]),"icon-color":new wn(q.paint_symbol["icon-color"]),"icon-halo-color":new wn(q.paint_symbol["icon-halo-color"]),"icon-halo-width":new wn(q.paint_symbol["icon-halo-width"]),"icon-halo-blur":new wn(q.paint_symbol["icon-halo-blur"]),"icon-translate":new sn(q.paint_symbol["icon-translate"]),"icon-translate-anchor":new sn(q.paint_symbol["icon-translate-anchor"]),"text-opacity":new wn(q.paint_symbol["text-opacity"]),"text-color":new wn(q.paint_symbol["text-color"],{runtimeType:Rn,getOverride:u=>u.textColor,hasOverride:u=>!!u.textColor}),"text-halo-color":new wn(q.paint_symbol["text-halo-color"]),"text-halo-width":new wn(q.paint_symbol["text-halo-width"]),"text-halo-blur":new wn(q.paint_symbol["text-halo-blur"]),"text-translate":new sn(q.paint_symbol["text-translate"]),"text-translate-anchor":new sn(q.paint_symbol["text-translate-anchor"])})},get layout(){return Vk=Vk||new jo({"symbol-placement":new sn(q.layout_symbol["symbol-placement"]),"symbol-spacing":new sn(q.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new sn(q.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new wn(q.layout_symbol["symbol-sort-key"]),"symbol-z-order":new sn(q.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new sn(q.layout_symbol["icon-allow-overlap"]),"icon-overlap":new sn(q.layout_symbol["icon-overlap"]),"icon-ignore-placement":new sn(q.layout_symbol["icon-ignore-placement"]),"icon-optional":new sn(q.layout_symbol["icon-optional"]),"icon-rotation-alignment":new sn(q.layout_symbol["icon-rotation-alignment"]),"icon-size":new wn(q.layout_symbol["icon-size"]),"icon-text-fit":new sn(q.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new sn(q.layout_symbol["icon-text-fit-padding"]),"icon-image":new wn(q.layout_symbol["icon-image"]),"icon-rotate":new wn(q.layout_symbol["icon-rotate"]),"icon-padding":new wn(q.layout_symbol["icon-padding"]),"icon-keep-upright":new sn(q.layout_symbol["icon-keep-upright"]),"icon-offset":new wn(q.layout_symbol["icon-offset"]),"icon-anchor":new wn(q.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new sn(q.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new sn(q.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new sn(q.layout_symbol["text-rotation-alignment"]),"text-field":new wn(q.layout_symbol["text-field"]),"text-font":new wn(q.layout_symbol["text-font"]),"text-size":new wn(q.layout_symbol["text-size"]),"text-max-width":new wn(q.layout_symbol["text-max-width"]),"text-line-height":new sn(q.layout_symbol["text-line-height"]),"text-letter-spacing":new wn(q.layout_symbol["text-letter-spacing"]),"text-justify":new wn(q.layout_symbol["text-justify"]),"text-radial-offset":new wn(q.layout_symbol["text-radial-offset"]),"text-variable-anchor":new sn(q.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new wn(q.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new wn(q.layout_symbol["text-anchor"]),"text-max-angle":new sn(q.layout_symbol["text-max-angle"]),"text-writing-mode":new sn(q.layout_symbol["text-writing-mode"]),"text-rotate":new wn(q.layout_symbol["text-rotate"]),"text-padding":new sn(q.layout_symbol["text-padding"]),"text-keep-upright":new sn(q.layout_symbol["text-keep-upright"]),"text-transform":new wn(q.layout_symbol["text-transform"]),"text-offset":new wn(q.layout_symbol["text-offset"]),"text-allow-overlap":new sn(q.layout_symbol["text-allow-overlap"]),"text-overlap":new sn(q.layout_symbol["text-overlap"]),"text-ignore-placement":new sn(q.layout_symbol["text-ignore-placement"]),"text-optional":new sn(q.layout_symbol["text-optional"])})}};class Gk{constructor(c){if(c.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=c.property.overrides?c.property.overrides.runtimeType:dn,this.defaultValue=c}evaluate(c){if(c.formattedSection){var d=this.defaultValue.property.overrides;if(d&&d.hasOverride(c.formattedSection))return d.getOverride(c.formattedSection)}return c.feature&&c.featureState?this.defaultValue.evaluate(c.feature,c.featureState):this.defaultValue.property.specification.default}eachChild(c){this.defaultValue.isConstant()||c(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Vt("FormatSectionOverride",Gk,{omit:["defaultValue"]});class m1 extends qa{constructor(c){super(c,wS)}recalculate(c,d){if(super.recalculate(c,d),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout.get("symbol-placement")!=="point"?this.layout._values["icon-rotation-alignment"]="map":this.layout._values["icon-rotation-alignment"]="viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout.get("symbol-placement")!=="point"?this.layout._values["text-rotation-alignment"]="map":this.layout._values["text-rotation-alignment"]="viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point")if(c=this.layout.get("text-writing-mode"),c){var m=[];for(const b of c)m.indexOf(b)<0&&m.push(b);this.layout._values["text-writing-mode"]=m}else this.layout._values["text-writing-mode"]=["horizontal"];this._setPaintOverrides()}getValueAndResolveTokens(c,d,m,b){return m=this.layout.get(c).evaluate(d,{},m,b),b=this._unevaluatedLayout._values[c],b.isDataDriven()||Mp(b.value)||!m?m:$7(d.properties,m)}createBucket(c){return new ig(c)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const m of wS.paint.overridableProperties)if(m1.hasPaintOverride(this.layout,m)){var c=this.paint.get(m),d=new Gk(c),d=new My(d,c.property.specification);let b=null;b=c.value.kind==="constant"||c.value.kind==="source"?new hi("source",d):new kp("composite",d,c.value.zoomStops),this.paint._values[m]=new Ga(c.property,b,c.parameters)}}_handleOverridablePaintPropertyUpdate(c,d,m){return!(!this.layout||d.isDataDriven()||m.isDataDriven())&&m1.hasPaintOverride(this.layout,c)}static hasPaintOverride(c,d){c=c.get("text-field");const m=wS.paint.properties[d];let b=!1;const E=S=>{for(const A of S)if(m.overrides&&m.overrides.hasOverride(A))return void(b=!0)};if(c.value.kind==="constant"&&c.value.value instanceof Zi)E(c.value.value.sections);else if(c.value.kind==="source"){const S=A=>{var I;b||(A instanceof ba&&ri(A.value)===Qr?(I=A.value,E(I.sections)):A instanceof Ap?E(A.sections):A.eachChild(S))};d=c.value,d._styleExpression&&S(d._styleExpression.expression)}return b}}let qk;var W7={get paint(){return qk=qk||new jo({"background-color":new sn(q.paint_background["background-color"]),"background-pattern":new jp(q.paint_background["background-pattern"]),"background-opacity":new sn(q.paint_background["background-opacity"])})}};class Y7 extends qa{constructor(c){super(c,W7)}}let $k;var K7={get paint(){return $k=$k||new jo({"raster-opacity":new sn(q.paint_raster["raster-opacity"]),"raster-hue-rotate":new sn(q.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new sn(q.paint_raster["raster-brightness-min"]),"raster-brightness-max":new sn(q.paint_raster["raster-brightness-max"]),"raster-saturation":new sn(q.paint_raster["raster-saturation"]),"raster-contrast":new sn(q.paint_raster["raster-contrast"]),"raster-resampling":new sn(q.paint_raster["raster-resampling"]),"raster-fade-duration":new sn(q.paint_raster["raster-fade-duration"])})}};class Z7 extends qa{constructor(c){super(c,K7)}}class X7 extends qa{constructor(c){super(c,{}),this.onAdd=d=>{this.implementation.onAdd&&this.implementation.onAdd(d,d.painter.context.gl)},this.onRemove=d=>{this.implementation.onRemove&&this.implementation.onRemove(d,d.painter.context.gl)},this.implementation=c}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class Q7{constructor(c){this._methodToThrottle=c,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._methodToThrottle()},0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const xS=63710088e-1;class oh{constructor(c,d){if(isNaN(c)||isNaN(d))throw new Error(`Invalid LngLat object: (${c}, ${d})`);if(this.lng=+c,this.lat=+d,90<this.lat||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new oh(ce(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(c){var d=Math.PI/180,b=this.lat*d,m=c.lat*d,b=Math.sin(b)*Math.sin(m)+Math.cos(b)*Math.cos(m)*Math.cos((c.lng-this.lng)*d);return xS*Math.acos(Math.min(b,1))}static convert(c){if(c instanceof oh)return c;if(Array.isArray(c)&&(c.length===2||c.length===3))return new oh(Number(c[0]),Number(c[1]));if(Array.isArray(c)||typeof c!="object"||c===null)throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]");return new oh(Number("lng"in c?c.lng:c.lon),Number(c.lat))}}const Wk=2*Math.PI*xS;function Yk(u){return Wk*Math.cos(u*Math.PI/180)}function Kk(u){return(180+u)/360}function Zk(u){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+u*Math.PI/360)))/360}function Xk(u,c){return u/Yk(c)}function J7(u){return 360*u-180}function ES(u){return 360/Math.PI*Math.atan(Math.exp((180-360*u)*Math.PI/180))-90}function eH(u,c){return u*Yk(ES(c))}function tH(u){return 1/Math.cos(u*Math.PI/180)}class y1{constructor(c,d,m=0){this.x=+c,this.y=+d,this.z=+m}static fromLngLat(c,d=0){return c=oh.convert(c),new y1(Kk(c.lng),Zk(c.lat),Xk(d,c.lat))}toLngLat(){return new oh(J7(this.x),ES(this.y))}toAltitude(){return eH(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/Wk*tH(ES(this.y))}}function nH(b,c,d){var m=Qk(256*b,256*(c=Math.pow(2,d)-c-1),d),b=Qk(256*(b+1),256*(c+1),d);return m[0]+","+m[1]+","+b[0]+","+b[1]}function Qk(u,c,d){return d=2*Math.PI*6378137/256/Math.pow(2,d),[u*d-2*Math.PI*6378137/2,c*d-2*Math.PI*6378137/2]}class TS{constructor(c,d,m){if(c<0||25<c||m<0||m>=Math.pow(2,c)||d<0||d>=Math.pow(2,c))throw new Error(`x=${d}, y=${m}, z=${c} outside of bounds. 0<=x<${Math.pow(2,c)}, 0<=y<${Math.pow(2,c)} 0<=z<=25 `);this.z=c,this.x=d,this.y=m,this.key=y_(0,c,c,d,m)}equals(c){return this.z===c.z&&this.x===c.x&&this.y===c.y}url(c,d,m){var b=nH(this.x,this.y,this.z),E=rH(this.z,this.x,this.y);return c[(this.x+this.y)%c.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(m==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,1<d?"@2x":"").replace(/{quadkey}/g,E).replace(/{bbox-epsg-3857}/g,b)}isChildOf(c){var d=this.z-c.z;return 0<d&&c.x===this.x>>d&&c.y===this.y>>d}getTilePoint(c){var d=Math.pow(2,this.z);return new p((c.x*d-this.x)*ct,(c.y*d-this.y)*ct)}toString(){return`${this.z}/${this.x}/`+this.y}}class Jk{constructor(c,d){this.wrap=c,this.canonical=d,this.key=y_(c,d.z,d.z,d.x,d.y)}}class _s{constructor(c,d,m,b,E){if(c<m)throw new Error(`overscaledZ should be >= z; overscaledZ = ${c}; z = `+m);this.overscaledZ=c,this.wrap=d,this.canonical=new TS(m,+b,+E),this.key=y_(d,c,m,b,E)}clone(){return new _s(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(c){return this.overscaledZ===c.overscaledZ&&this.wrap===c.wrap&&this.canonical.equals(c.canonical)}scaledTo(c){if(c>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${c}; overscaledZ = `+this.overscaledZ);var d=this.canonical.z-c;return c>this.canonical.z?new _s(c,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new _s(c,this.wrap,c,this.canonical.x>>d,this.canonical.y>>d)}calculateScaledKey(c,d){if(c>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${c}; overscaledZ = `+this.overscaledZ);var m=this.canonical.z-c;return c>this.canonical.z?y_(this.wrap*+d,c,this.canonical.z,this.canonical.x,this.canonical.y):y_(this.wrap*+d,c,c,this.canonical.x>>m,this.canonical.y>>m)}isChildOf(c){var d;return c.wrap===this.wrap&&(d=this.canonical.z-c.canonical.z,c.overscaledZ===0||c.overscaledZ<this.overscaledZ&&c.canonical.x===this.canonical.x>>d&&c.canonical.y===this.canonical.y>>d)}children(c){var d,m;return this.overscaledZ>=c?[new _s(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)]:(c=this.canonical.z+1,d=2*this.canonical.x,m=2*this.canonical.y,[new _s(c,this.wrap,c,d,m),new _s(c,this.wrap,c,1+d,m),new _s(c,this.wrap,c,d,1+m),new _s(c,this.wrap,c,1+d,1+m)])}isLessThan(c){return this.wrap<c.wrap||!(this.wrap>c.wrap)&&(this.overscaledZ<c.overscaledZ||!(this.overscaledZ>c.overscaledZ)&&(this.canonical.x<c.canonical.x||!(this.canonical.x>c.canonical.x)&&this.canonical.y<c.canonical.y))}wrapped(){return new _s(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(c){return new _s(this.overscaledZ,c,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Jk(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/`+this.canonical.y}getTilePoint(c){return this.canonical.getTilePoint(new y1(c.x-this.wrap,c.y))}}function y_(u,c,d,m,b){var E=1<<d;return(E*E*(u=(u*=2)<0?-1*u-1:u)+E*b+m).toString(36)+d.toString(36)+c.toString(36)}function rH(u,c,d){let m="",b;for(let E=u;0<E;E--)b=1<<E-1,m+=(c&b?1:0)+(d&b?2:0);return m}Vt("CanonicalTileID",TS),Vt("OverscaledTileID",_s,{omit:["posMatrix"]});class eO{constructor(c,d,m,b=1,E=1,S=1,A=0){if(this.uid=c,d.height!==d.width)throw new RangeError("DEM tiles must be square");if(m&&!["mapbox","terrarium","custom"].includes(m))Ee(`"${m}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);else{this.stride=d.height;var I=this.dim=d.height-2;switch(this.data=new Uint32Array(d.data.buffer),m){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=b,this.greenFactor=E,this.blueFactor=S,this.baseShift=A;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let k=0;k<I;k++)this.data[this._idx(-1,k)]=this.data[this._idx(0,k)],this.data[this._idx(I,k)]=this.data[this._idx(I-1,k)],this.data[this._idx(k,-1)]=this.data[this._idx(k,0)],this.data[this._idx(k,I)]=this.data[this._idx(k,I-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(I,-1)]=this.data[this._idx(I-1,0)],this.data[this._idx(-1,I)]=this.data[this._idx(0,I-1)],this.data[this._idx(I,I)]=this.data[this._idx(I-1,I-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let k=0;k<I;k++)for(let U=0;U<I;U++){var O=this.get(k,U);O>this.max&&(this.max=O),O<this.min&&(this.min=O)}}}get(b,d){var m=new Uint8Array(this.data.buffer),b=4*this._idx(b,d);return this.unpack(m[b],m[1+b],m[2+b])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(c,d){if(c<-1||c>=this.dim+1||d<-1||d>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(d+1)*this.stride+(c+1)}unpack(c,d,m){return c*this.redFactor+d*this.greenFactor+m*this.blueFactor-this.baseShift}getPixels(){return new ys({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(c,d,m){if(this.dim!==c.dim)throw new Error("dem dimension mismatch");let b=d*this.dim,E=d*this.dim+this.dim,S=m*this.dim,A=m*this.dim+this.dim;switch(d){case-1:b=E-1;break;case 1:E=b+1}switch(m){case-1:S=A-1;break;case 1:A=S+1}var I=-d*this.dim,O=-m*this.dim;for(let k=S;k<A;k++)for(let U=b;U<E;U++)this.data[this._idx(U,k)]=c.data[this._idx(U+I,k+O)]}}Vt("DEMData",eO);class tO{constructor(c){this._stringToNumber={},this._numberToString=[];for(let m=0;m<c.length;m++){var d=c[m];this._stringToNumber[d]=m,this._numberToString[m]=d}}encode(c){return this._stringToNumber[c]}decode(c){if(c>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${c} can't be >= this._numberToString.length `+this._numberToString.length);return this._numberToString[c]}}class nO{constructor(c,d,m,b,E){this.type="Feature",(this._vectorTileFeature=c)._z=d,c._x=m,c._y=b,this.properties=c.properties,this.id=E}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(c){this._geometry=c}toJSON(){var c={geometry:this.geometry};for(const d in this)d!=="_geometry"&&d!=="_vectorTileFeature"&&(c[d]=this[d]);return c}}class rO{constructor(c,d){this.tileID=c,this.x=c.canonical.x,this.y=c.canonical.y,this.z=c.canonical.z,this.grid=new Id(ct,16,0),this.grid3D=new Id(ct,16,0),this.featureIndexArray=new Kp,this.promoteId=d}insert(c,d,m,b,E,S){var A=this.featureIndexArray.length,I=(this.featureIndexArray.emplaceBack(m,b,E),S?this.grid3D:this.grid);for(let W=0;W<d.length;W++){var O=d[W],k=[1/0,1/0,-1/0,-1/0];for(let re=0;re<O.length;re++){var U=O[re];k[0]=Math.min(k[0],U.x),k[1]=Math.min(k[1],U.y),k[2]=Math.max(k[2],U.x),k[3]=Math.max(k[3],U.y)}k[0]<ct&&k[1]<ct&&0<=k[2]&&0<=k[3]&&I.insert(A,k[0],k[1],k[2],k[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new rh.VectorTile(new dS(this.rawTileData)).layers,this.sourceLayerCoder=new tO(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(c,d,m,b){this.loadVTLayers();const E=c.params||{},S=ct/c.tileSize/c.scale,A=Lp(E.filter),I=c.queryGeometry,O=c.queryPadding*S;var U=oO(I),k=this.grid.query(U.minX-O,U.minY-O,U.maxX+O,U.maxY+O),U=oO(c.cameraQueryGeometry);for(const fe of this.grid3D.query(U.minX-O,U.minY-O,U.maxX+O,U.maxY+O,(we,de,Me,Ve)=>Ln(c.cameraQueryGeometry,we-O,de-O,Me+O,Ve+O)))k.push(fe);k.sort(iH);var W={};let re;for(let fe=0;fe<k.length;fe++){var ie=k[fe];if(ie!==re){re=ie,ie=this.featureIndexArray.get(ie);let we=null;this.loadMatchingFeature(W,ie.bucketIndex,ie.sourceLayerIndex,ie.featureIndex,A,E.layers,E.availableImages,d,m,b,(de,Me,Ve)=>(we=we||Dt(de),Me.queryIntersectsFeature(I,de,Ve,we,this.z,c.transform,S,c.pixelPosMatrix)))}}return W}loadMatchingFeature(c,d,m,b,E,S,A,I,O,k,U){var W=this.bucketLayerIDs[d];if(!S||je(S,W)){var d=this.sourceLayerCoder.decode(m),re=this.vtLayers[d].feature(b);if(E.needGeometry){if(m=Yt(re,!0),!E.filter(new Ur(this.tileID.overscaledZ),m,this.tileID.canonical))return}else if(!E.filter(new Ur(this.tileID.overscaledZ),re))return;var ie=this.getId(re,d);for(let $e=0;$e<W.length;$e++){var fe=W[$e];if(!(S&&S.indexOf(fe)<0)){var we=I[fe];if(we){let Ye={};ie&&k&&(Ye=k.getState(we.sourceLayer||"_geojsonTileLayer",ie));var de=_e({},O[fe]),we=(de.paint=iO(de.paint,we.paint,re,Ye,A),de.layout=iO(de.layout,we.layout,re,Ye,A),!U||U(re,we,Ye));if(we){var Me=new nO(re,this.z,this.x,this.y,ie);Me.layer=de;let mt=c[fe];(mt=mt===void 0?c[fe]=[]:mt).push({featureIndex:b,feature:Me,intersectionZ:we})}}}}}}lookupSymbolFeatures(c,d,m,b,E,S,A,I){var O={},k=(this.loadVTLayers(),Lp(E));for(const U of c)this.loadMatchingFeature(O,m,b,U,k,S,A,I,d);return O}hasLayer(c){for(const d of this.bucketLayerIDs)for(const m of d)if(c===m)return!0;return!1}getId(c,d){let m=c.id;return m=this.promoteId&&(d=typeof this.promoteId=="string"?this.promoteId:this.promoteId[d],typeof(m=c.properties[d])=="boolean")?Number(m):m}}function iO(u,c,d,m,b){return pe(u,(E,S)=>(S=c instanceof Md?c.get(S):null,S&&S.evaluate?S.evaluate(d,m,b):S))}function oO(u){let c=1/0,d=1/0,m=-1/0,b=-1/0;for(const E of u)c=Math.min(c,E.x),d=Math.min(d,E.y),m=Math.max(m,E.x),b=Math.max(b,E.y);return{minX:c,minY:d,maxX:m,maxY:b}}function iH(u,c){return c-u}function aO(u,c,d,m,b){var E=[];for(let A=0;A<u.length;A++){var S=u[A];let I;for(let O=0;O<S.length-1;O++){let k=S[O],U=S[O+1];k.x<c&&U.x<c||(k.x<c?k=new p(c,k.y+(U.y-k.y)*((c-k.x)/(U.x-k.x)))._round():U.x<c&&(U=new p(c,k.y+(U.y-k.y)*((c-k.x)/(U.x-k.x)))._round()),k.y<d&&U.y<d)||(k.y<d?k=new p(k.x+(U.x-k.x)*((d-k.y)/(U.y-k.y)),d)._round():U.y<d&&(U=new p(k.x+(U.x-k.x)*((d-k.y)/(U.y-k.y)),d)._round()),k.x>=m&&U.x>=m)||(k.x>=m?k=new p(m,k.y+(U.y-k.y)*((m-k.x)/(U.x-k.x)))._round():U.x>=m&&(U=new p(m,k.y+(U.y-k.y)*((m-k.x)/(U.x-k.x)))._round()),k.y>=b&&U.y>=b)||(k.y>=b?k=new p(k.x+(U.x-k.x)*((b-k.y)/(U.y-k.y)),b)._round():U.y>=b&&(U=new p(k.x+(U.x-k.x)*((b-k.y)/(U.y-k.y)),b)._round()),I&&k.equals(I[I.length-1])||(I=[k],E.push(I)),I.push(U))}}return E}Vt("FeatureIndex",rO,{omit:["rawTileData","sourceLayerCoder"]});class ah extends p{constructor(c,d,m,b){super(c,d),this.angle=m,b!==void 0&&(this.segment=b)}clone(){return new ah(this.x,this.y,this.angle,this.segment)}}function sO(u,c,d,m,b){if(c.segment!==void 0&&d!==0){let O=c,k=c.segment+1,U=0;for(;U>-d/2;){if(--k<0)return;U-=u[k].dist(O),O=u[k]}U+=u[k].dist(u[k+1]),k++;var E=[];let W=0;for(;U<d/2;){var S=u[k-1],A=u[k],I=u[k+1];if(!I)return;for(S=S.angleTo(A)-A.angleTo(I),S=Math.abs((S+3*Math.PI)%(2*Math.PI)-Math.PI),E.push({distance:U,angleDelta:S}),W+=S;U-E[0].distance>m;)W-=E.shift().angleDelta;if(W>b)return;k++,U+=A.dist(I)}}return 1}function cO(u){let c=0;for(let d=0;d<u.length-1;d++)c+=u[d].dist(u[d+1]);return c}function lO(u,c,d){return u?.6*c*d:0}function uO(u,c){return Math.max(u?u.right-u.left:0,c?c.right-c.left:0)}function oH(u,c,d,k,U,re,S,A,I){var O=lO(k,re,S),k=uO(k,U),U=k*S,W=u[0].x===0||u[0].x===I||u[0].y===0||u[0].y===I,re=(c-U<c/4&&(c=U+c/4),2*re);return function ie(fe,we,de,Me,Ve,$e,Ye,et,mt){const Ut=$e/2,Nt=cO(fe);let ut=0,kt=we-de,vt=[];for(let dt=0;dt<fe.length-1;dt++){const tt=fe[dt],Gt=fe[dt+1],zt=tt.dist(Gt),Wt=Gt.angleTo(tt);for(;kt+de<ut+zt;){const Sn=((kt+=de)-ut)/zt,qn=Ea.number(tt.x,Gt.x,Sn),An=Ea.number(tt.y,Gt.y,Sn);if(0<=qn&&qn<mt&&0<=An&&An<mt&&0<=kt-Ut&&kt+Ut<=Nt){const pr=new ah(qn,An,Wt,dt);pr._round(),Me&&!sO(fe,pr,$e,Me,Ve)||vt.push(pr)}}ut+=zt}return et||vt.length||Ye||(vt=ie(fe,ut/2,de,Me,Ve,$e,Ye,!0,mt)),vt}(u,W?c/2*A%c:(k/2+re)*S*A%c,c,O,d,U,W,!1,I)}Vt("Anchor",ah);const og=Sa;function hO(u,c,d,m){var b=[];const E=u.image,S=E.pixelRatio;var A=E.paddedRect.w-2*og,I=E.paddedRect.h-2*og;let O={x1:u.left,y1:u.top,x2:u.right,y2:u.bottom};var k=E.stretchX||[[0,A]],U=E.stretchY||[[0,I]],de=(mn,kn)=>mn+kn[1]-kn[0];const W=k.reduce(de,0),re=U.reduce(de,0);var ie,fe,we,de=A-W,Me=I-re;let Ve=0,$e=W,Ye=0,et=re,mt=0,Ut=de,Nt=0,ut=Me;E.content&&m&&(fe=(ie=E.content)[2]-ie[0],we=ie[3]-ie[1],E.contentMatch&&E.content&&(O=Uk(u)),Ve=_1(k,0,ie[0]),Ye=_1(U,0,ie[1]),$e=_1(k,ie[0],ie[2]),et=_1(U,ie[1],ie[3]),mt=ie[0]-Ve,Nt=ie[1]-Ye,Ut=fe-$e,ut=we-et);const kt=O.x1,vt=O.y1,dt=O.x2-kt,tt=O.y2-vt;var Gt=(Ws,kn,sr,Rr)=>{var nr=(Ws.stretch-Ve)/$e*dt+kt,ch=Ws.fixed-mt-Ut*Ws.stretch/W,ca=(kn.stretch-Ye)/et*tt+vt,Vo=kn.fixed-Nt-ut*kn.stretch/re,cr=(sr.stretch-Ve)/$e*dt+kt,$s=sr.fixed-mt-Ut*sr.stretch/W,yc=(Rr.stretch-Ye)/et*tt+vt,qc=Rr.fixed-Nt-ut*Rr.stretch/re,vs=new p(nr,ca),ca=new p(cr,ca),cr=new p(cr,yc),nr=new p(nr,yc),yc=new p(ch/S,Vo/S),ch=new p($s/S,qc/S),Vo=c*Math.PI/180,$s=(Vo&&($s=Math.sin(Vo),qc=Math.cos(Vo),vs._matMult(Vo=[qc,-$s,$s,qc]),ca._matMult(Vo),nr._matMult(Vo),cr._matMult(Vo)),Ws.stretch+Ws.fixed),qc=sr.stretch+sr.fixed,Vo=kn.stretch+kn.fixed,Ws=Rr.stretch+Rr.fixed;return{tl:vs,tr:ca,bl:nr,br:cr,tex:{x:E.paddedRect.x+og+$s,y:E.paddedRect.y+og+Vo,w:qc-$s,h:Ws-Vo},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:yc,pixelOffsetBR:ch,minFontScaleX:Ut/S/dt,minFontScaleY:ut/S/tt,isSDF:d}};if(m&&(E.stretchX||E.stretchY)){var zt=dO(k,de,W),Wt=dO(U,Me,re);for(let mn=0;mn<zt.length-1;mn++){var Sn=zt[mn],qn=zt[mn+1];for(let kn=0;kn<Wt.length-1;kn++){var An=Wt[kn],pr=Wt[kn+1];b.push(Gt(Sn,An,qn,pr))}}}else b.push(Gt({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:1+A},{fixed:0,stretch:1+I}));return b}function _1(u,c,d){let m=0;for(const b of u)m+=Math.max(c,Math.min(d,b[1]))-Math.max(c,Math.min(d,b[0]));return m}function dO(u,c,d){var m,b,E=[{fixed:-og,stretch:0}];for([m,b]of u){var S=E[E.length-1];E.push({fixed:m-S.stretch,stretch:S.stretch}),E.push({fixed:m-S.stretch,stretch:S.stretch+(b-m)})}return E.push({fixed:c+og,stretch:d}),E}function aH(u,c,d,m,b,E,S,A){var I=m.layout.get("text-rotate").evaluate(E,{})*Math.PI/180,O=[];for(const Ye of c.positionedLines)for(const et of Ye.positionedGlyphs)if(et.rect){var k=et.rect||{};let mt=Ok+1,Ut=!0,Nt=1,ut=0;var U,$e=(b||A)&&et.vertical,W=et.metrics.advance*et.scale/2,re=(A&&c.verticalizable&&(re=(et.scale-1)*eo,U=(eo-et.metrics.width*et.scale)/2,ut=Ye.lineOffset/2-(et.imageName?-U:re)),et.imageName&&(U=S[et.imageName],Ut=U.sdf,Nt=U.pixelRatio,mt=Sa/Nt),b?[et.x+W,et.y]:[0,0]);let kt=b?[0,0]:[et.x+W+d[0],et.y+d[1]-ut],vt=[0,0];$e&&(vt=kt,kt=[0,0]);var ie=et.metrics.isDoubleResolution?2:1,de=(et.metrics.left-mt)*et.scale-W+kt[0],we=(-et.metrics.top-mt)*et.scale+kt[1],Me=de+k.w/ie*et.scale/Nt,ie=we+k.h/ie*et.scale/Nt,fe=new p(de,we),we=new p(Me,we),de=new p(de,ie),Me=new p(Me,ie),Ve=($e&&(ie=new p(-W,W-p_),$e=-Math.PI/2,W=eo/2-W,Ve=et.imageName?W:0,W=new p(5-p_-W,-Ve),Ve=new p(...vt),fe._rotateAround($e,ie)._add(W)._add(Ve),we._rotateAround($e,ie)._add(W)._add(Ve),de._rotateAround($e,ie)._add(W)._add(Ve),Me._rotateAround($e,ie)._add(W)._add(Ve)),I&&($e=Math.sin(I),ie=Math.cos(I),fe._matMult(W=[ie,-$e,$e,ie]),we._matMult(W),de._matMult(W),Me._matMult(W)),new p(0,0)),$e=new p(0,0);O.push({tl:fe,tr:we,bl:de,br:Me,tex:k,writingMode:c.writingMode,glyphOffset:re,sectionIndex:et.sectionIndex,isSDF:Ut,pixelOffsetTL:Ve,pixelOffsetBR:$e,minFontScaleX:0,minFontScaleY:0})}return O}class v1{constructor(c,d,m,b,E,S,A,I,O,k){if(this.boxStartIndex=c.length,O){let W=S.top,re=S.bottom;var O=S.collisionPadding,O=(O&&(W-=O[1],re+=O[3]),re-W);0<O&&(O=Math.max(10,O),this.circleDiameter=O)}else{var U,O=(O=S.image)!=null&&O.contentMatch&&S.image.content?Uk(S):{x1:S.left,y1:S.top,x2:S.right,y2:S.bottom},I=(O.y1=O.y1*A-I[0],O.x2=O.x2*A+I[1],O.y2=O.y2*A+I[2],O.x1=O.x1*A-I[3],S.collisionPadding);I&&(O.x1-=I[0]*A,O.y1-=I[1]*A,O.x2+=I[2]*A,O.y2+=I[3]*A),k&&(S=new p(O.x1,O.y1),I=new p(O.x2,O.y1),A=new p(O.x1,O.y2),U=new p(O.x2,O.y2),k=k*Math.PI/180,S._rotate(k),I._rotate(k),A._rotate(k),U._rotate(k),O.x1=Math.min(S.x,I.x,A.x,U.x),O.x2=Math.max(S.x,I.x,A.x,U.x),O.y1=Math.min(S.y,I.y,A.y,U.y),O.y2=Math.max(S.y,I.y,A.y,U.y)),c.emplaceBack(d.x,d.y,O.x1,O.y1,O.x2,O.y2,m,b,E)}this.boxEndIndex=c.length}}class sH{constructor(c=[],d=cH){if(this.data=c,this.length=this.data.length,this.compare=d,0<this.length)for(let m=(this.length>>1)-1;0<=m;m--)this._down(m)}push(c){this.data.push(c),this.length++,this._up(this.length-1)}pop(){var c,d;if(this.length!==0)return c=this.data[0],d=this.data.pop(),this.length--,0<this.length&&(this.data[0]=d,this._down(0)),c}peek(){return this.data[0]}_up(c){for(var{data:d,compare:m}=this,b=d[c];0<c;){var E=c-1>>1,S=d[E];if(0<=m(b,S))break;d[c]=S,c=E}d[c]=b}_down(c){for(var{data:d,compare:m}=this,b=this.length>>1,E=d[c];c<b;){let A=1+(c<<1),I=d[A];var S=A+1;if(S<this.length&&m(d[S],I)<0&&(A=S,I=d[S]),0<=m(I,E))break;d[c]=I,c=A}d[c]=E}}function cH(u,c){return u<c?-1:c<u?1:0}function lH(u,c=1,d=!1){let m=1/0,b=1/0,E=-1/0,S=-1/0;var A=u[0];for(let de=0;de<A.length;de++){var I=A[de];(!de||I.x<m)&&(m=I.x),(!de||I.y<b)&&(b=I.y),(!de||I.x>E)&&(E=I.x),(!de||I.y>S)&&(S=I.y)}var O=E-m,k=S-b,U=Math.min(O,k);let W=U/2;var re=new sH([],uH);if(U===0)return new p(m,b);for(let de=m;de<E;de+=U)for(let Me=b;Me<S;Me+=U)re.push(new ag(de+W,Me+W,W,u));let ie=function(de){let Me=0,Ve=0,$e=0;var Ye=de[0];for(let Nt=0,ut=Ye.length,kt=ut-1;Nt<ut;kt=Nt++){var et=Ye[Nt],mt=Ye[kt],Ut=et.x*mt.y-mt.x*et.y;Ve+=(et.x+mt.x)*Ut,$e+=(et.y+mt.y)*Ut,Me+=3*Ut}return new ag(Ve/Me,$e/Me,0,de)}(u),fe=re.length;for(;re.length;){var we=re.pop();(we.d>ie.d||!ie.d)&&(ie=we,d)&&console.log("found best %d after %d probes",Math.round(1e4*we.d)/1e4,fe),we.max-ie.d<=c||(W=we.h/2,re.push(new ag(we.p.x-W,we.p.y-W,W,u)),re.push(new ag(we.p.x+W,we.p.y-W,W,u)),re.push(new ag(we.p.x-W,we.p.y+W,W,u)),re.push(new ag(we.p.x+W,we.p.y+W,W,u)),fe+=4)}return d&&(console.log("num probes: "+fe),console.log("best distance: "+ie.d)),ie.p}function uH(u,c){return c.max-u.max}function ag(u,c,d,m){this.p=new p(u,c),this.h=d,this.d=function(b,E){let S=!1,A=1/0;for(let U=0;U<E.length;U++){var I=E[U];for(let W=0,re=I.length,ie=re-1;W<re;ie=W++){var O=I[W],k=I[ie];O.y>b.y!=k.y>b.y&&b.x<(k.x-O.x)*(b.y-O.y)/(k.y-O.y)+O.x&&(S=!S),A=Math.min(A,Ir(b,O,k))}}return(S?1:-1)*Math.sqrt(A)}(this.p,m),this.max=this.d+this.h*Math.SQRT2}i.TextAnchorEnum=void 0,(Mr=i.TextAnchorEnum||(i.TextAnchorEnum={}))[Mr.center=1]="center",Mr[Mr.left=2]="left",Mr[Mr.right=3]="right",Mr[Mr.top=4]="top",Mr[Mr.bottom=5]="bottom",Mr[Mr["top-left"]=6]="top-left",Mr[Mr["top-right"]=7]="top-right",Mr[Mr["bottom-left"]=8]="bottom-left",Mr[Mr["bottom-right"]=9]="bottom-right";const sh=7,SS=Number.POSITIVE_INFINITY;function fO(u,c){if(c[1]!==SS){var d=u,m=c[0],b=c[1];let A=0,I=0;switch(m=Math.abs(m),b=Math.abs(b),d){case"top-right":case"top-left":case"top":I=b-sh;break;case"bottom-right":case"bottom-left":case"bottom":I=-b+sh}switch(d){case"top-right":case"bottom-right":case"right":A=-m;break;case"top-left":case"bottom-left":case"left":A=m}return[A,I]}{var d=u,E=c[0];let I=0,O=0;var S=(E=E<0?0:E)/Math.SQRT2;switch(d){case"top-right":case"top-left":O=S-sh;break;case"bottom-right":case"bottom-left":O=-S+sh;break;case"bottom":O=-E+sh;break;case"top":O=E-sh}switch(d){case"top-right":case"bottom-right":I=-S;break;case"top-left":case"bottom-left":I=S;break;case"left":I=E;break;case"right":I=-E}return[I,O]}}function pO(u,c,d){var m=u.layout,b=(b=m.get("text-variable-anchor-offset"))==null?void 0:b.evaluate(c,{},d);if(b){var E=b.values,S=[];for(let k=0;k<E.length;k+=2){var A=S[k]=E[k],I=E[k+1].map(U=>U*eo);A.startsWith("top")?I[1]-=sh:A.startsWith("bottom")&&(I[1]+=sh),S[k+1]=I}return new Uo(S)}if(b=m.get("text-variable-anchor"),b){let k;var u=u._unevaluatedLayout,O=(k=u.getValue("text-radial-offset")!==void 0?[m.get("text-radial-offset").evaluate(c,{},d)*eo,SS]:m.get("text-offset").evaluate(c,{},d).map(W=>W*eo),[]);for(const W of b)O.push(W,fO(W,k));return new Uo(O)}return null}function CS(u){switch(u){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function gO(u,c,d,m,b,E,S,A,I,O,k,U,W,re,ie){d=aH(0,d,A,b,E,S,m,u.allowVerticalPlacement),m=u.textSizeData;let fe=null;m.kind==="source"?(fe=[Gc*b.layout.get("text-size").evaluate(S,{})])[0]>ih&&Ee(`${u.layerIds[0]}: Value for "text-size" is >= ${m_}. Reduce your "text-size".`):m.kind==="composite"&&((fe=[Gc*re.compositeTextSizes[0].evaluate(S,{},ie),Gc*re.compositeTextSizes[1].evaluate(S,{},ie)])[0]>ih||fe[1]>ih)&&Ee(`${u.layerIds[0]}: Value for "text-size" is >= ${m_}. Reduce your "text-size".`),u.addSymbols(u.text,d,fe,A,E,S,O,c,I.lineStartIndex,I.lineLength,W,ie);for(const we of k)U[we]=u.text.placedSymbolArray.length-1;return 4*d.length}function mO(u){for(const c in u)return u[c];return null}const yO=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];function AS(u,c,d,m,b,E){var S;b-m<=d||(function A(I,O,k,U,W,re){for(;U<W;){if(600<W-U){const de=W-U+1,Me=k-U+1,Ve=Math.log(de),$e=.5*Math.exp(2*Ve/3),Ye=.5*Math.sqrt(Ve*$e*(de-$e)/de)*(Me-de/2<0?-1:1),et=Math.max(U,Math.floor(k-Me*$e/de+Ye)),mt=Math.min(W,Math.floor(k+(de-Me)*$e/de+Ye));A(I,O,k,et,mt,re)}const ie=O[2*k+re];let fe=U,we=W;for(__(I,O,U,k),O[2*W+re]>ie&&__(I,O,U,W);fe<we;){for(__(I,O,fe,we),fe++,we--;O[2*fe+re]<ie;)fe++;for(;O[2*we+re]>ie;)we--}O[2*U+re]===ie?__(I,O,U,we):(we++,__(I,O,we,W)),we<=k&&(U=we+1),k<=we&&(W=we-1)}}(u,c,S=m+b>>1,m,b,E),AS(u,c,d,m,S-1,1-E),AS(u,c,d,1+S,b,1-E))}function __(u,c,d,m){IS(u,d,m),IS(c,2*d,2*m),IS(c,2*d+1,2*m+1)}function IS(u,c,d){var m=u[c];u[c]=u[d],u[d]=m}function _O(u,c,d,m){return u-=d,d=c-m,u*u+d*d}i.PerformanceMarkers=void 0,(to=i.PerformanceMarkers||(i.PerformanceMarkers={})).create="create",to.load="load",to.fullLoad="fullLoad";let b1=null,v_=[];const PS=1e3/60,MS="loadTime",RS="fullLoadTime";Mr={mark(u){performance.mark(u)},frame(u){var c;b1!=null&&(c=u-b1,v_.push(c)),b1=u},clearMetrics(){b1=null,v_=[],performance.clearMeasures(MS),performance.clearMeasures(RS);for(const u in i.PerformanceMarkers)performance.clearMarks(i.PerformanceMarkers[u])},getPerformanceMetrics(){performance.measure(MS,i.PerformanceMarkers.create,i.PerformanceMarkers.load),performance.measure(RS,i.PerformanceMarkers.create,i.PerformanceMarkers.fullLoad);var u=performance.getEntriesByName(MS)[0].duration,c=performance.getEntriesByName(RS)[0].duration,d=v_.length,m=1/(v_.reduce((E,S)=>E+S,0)/d/1e3),b=v_.filter(E=>E>PS).reduce((E,S)=>E+(S-PS)/PS,0);return{loadTime:u,fullLoadTime:c,fps:m,percentDroppedFrames:b/(d+b)*100,totalFrames:d}}},i.AJAXError=Ot,i.Actor=class{constructor(u,c){this.target=u,this.mapId=c,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new Q7(()=>this.process()),this.subscription=wt(this.target,"message",d=>this.receive(d),!1),this.globalScope=Be(self)?u:window}registerMessageHandler(u,c){this.messageHandlers[u]=c}sendAsync(u,c){return new Promise((d,m)=>{const b=Math.round(1e18*Math.random()).toString(36).substring(0,10);this.resolveRejects[b]={resolve:d,reject:m},c&&c.signal.addEventListener("abort",()=>{delete this.resolveRejects[b];var E={id:b,type:"<cancel>",origin:location.origin,targetMapId:u.targetMapId,sourceMapId:this.mapId};this.target.postMessage(E)},{once:!0}),d=[],m=Object.assign(Object.assign({},u),{id:b,sourceMapId:this.mapId,origin:location.origin,data:gc(u.data,d)}),this.target.postMessage(m,{transfer:d})})}receive(d){var c,d=d.data,m=d.id;d.origin!=="file://"&&location.origin!=="file://"&&d.origin!==location.origin||d.targetMapId&&this.mapId!==d.targetMapId||(d.type==="<cancel>"?(delete this.tasks[m],c=this.abortControllers[m],delete this.abortControllers[m],c&&c.abort()):Be(self)||d.mustQueue?(this.tasks[m]=d,this.taskQueue.push(m),this.invoker.trigger()):this.processTask(m,d))}process(){var u,c;this.taskQueue.length!==0&&(u=this.taskQueue.shift(),c=this.tasks[u],delete this.tasks[u],0<this.taskQueue.length&&this.invoker.trigger(),c)&&this.processTask(u,c)}processTask(u,c){return o(this,void 0,void 0,function*(){if(c.type==="<response>")return d=this.resolveRejects[u],delete this.resolveRejects[u],d?void(c.error?d.reject(Yu(c.error)):d.resolve(Yu(c.data))):void 0;if(this.messageHandlers[c.type]){var d=Yu(c.data),m=new AbortController;this.abortControllers[u]=m;try{var b=yield this.messageHandlers[c.type](c.sourceMapId,d,m);this.completeTask(u,null,b)}catch(E){this.completeTask(u,E)}}else this.completeTask(u,new Error(`Could not find a registered handler for ${c.type}, map ID: ${this.mapId}, available handlers: `+Object.keys(this.messageHandlers).join(", ")))})}completeTask(b,c,d){var m=[],b=(delete this.abortControllers[b],{id:b,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:c?gc(c):null,data:gc(d,m)});this.target.postMessage(b,{transfer:m})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},i.AlphaImage=a_,i.CanonicalTileID=TS,i.CollisionBoxArray=Xb,i.CollisionCircleLayoutArray=class extends Ky{},i.Color=rr,i.DEMData=eO,i.DataConstantProperty=sn,i.DictionaryCoder=tO,i.EXTENT=ct,i.ErrorEvent=Q,i.EvaluationParameters=Ur,i.Event=F,i.Evented=ae,i.FeatureIndex=rO,i.FillBucket=aS,i.FillExtrusionBucket=cS,i.GLOBAL_DISPATCHER_ID=Mn,i.GeoJSONFeature=nO,i.ImageAtlas=Nk,i.ImagePosition=pS,i.KDBush=class qU{static from(c){if(!(c instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");var d,[m,b]=new Uint8Array(c,0,2);if(m!==219)throw new Error("Data does not appear to be in a KDBush format.");if((m=b>>4)!=1)throw new Error(`Got v${m} data when expected v1.`);if(m=yO[15&b])return[b]=new Uint16Array(c,2,1),[d]=new Uint32Array(c,4,1),new qU(d,b,m,c);throw new Error("Unrecognized array type.")}constructor(c,d=64,m=Float64Array,b){if(isNaN(c)||c<0)throw new Error(`Unpexpected numItems value: ${c}.`);this.numItems=+c,this.nodeSize=Math.min(Math.max(+d,2),65535),this.ArrayType=m,this.IndexArrayType=c<65536?Uint16Array:Uint32Array;var E=yO.indexOf(this.ArrayType),S=2*c*this.ArrayType.BYTES_PER_ELEMENT,A=c*this.IndexArrayType.BYTES_PER_ELEMENT,I=(8-A%8)%8;if(E<0)throw new Error(`Unexpected typed array class: ${m}.`);b&&b instanceof ArrayBuffer?(this.data=b,this.ids=new this.IndexArrayType(this.data,8,c),this.coords=new this.ArrayType(this.data,8+A+I,2*c),this._pos=2*c,this._finished=!0):(this.data=new ArrayBuffer(8+S+A+I),this.ids=new this.IndexArrayType(this.data,8,c),this.coords=new this.ArrayType(this.data,8+A+I,2*c),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+E]),new Uint16Array(this.data,2,1)[0]=d,new Uint32Array(this.data,4,1)[0]=c)}add(c,d){var m=this._pos>>1;return this.ids[m]=m,this.coords[this._pos++]=c,this.coords[this._pos++]=d,m}finish(){var c=this._pos>>1;if(c!==this.numItems)throw new Error(`Added ${c} items when expected ${this.numItems}.`);return AS(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(c,d,m,b){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");for(var{ids:E,coords:S,nodeSize:A}=this,I=[0,E.length-1,0],O=[];I.length;){var k=I.pop()||0,U=I.pop()||0,W=I.pop()||0;if(U-W<=A)for(let Me=W;Me<=U;Me++){var re=S[2*Me],ie=S[2*Me+1];c<=re&&re<=m&&d<=ie&&ie<=b&&O.push(E[Me])}else{var fe=W+U>>1,we=S[2*fe],de=S[2*fe+1];c<=we&&we<=m&&d<=de&&de<=b&&O.push(E[fe]),(k===0?c<=we:d<=de)&&(I.push(W),I.push(fe-1),I.push(1-k)),(k===0?we<=m:de<=b)&&(I.push(1+fe),I.push(U),I.push(1-k))}}return O}within(c,d,m){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");for(var{ids:b,coords:E,nodeSize:S}=this,A=[0,b.length-1,0],I=[],O=m*m;A.length;){var k=A.pop()||0,U=A.pop()||0,W=A.pop()||0;if(U-W<=S)for(let we=W;we<=U;we++)_O(E[2*we],E[2*we+1],c,d)<=O&&I.push(b[we]);else{var re=W+U>>1,ie=E[2*re],fe=E[2*re+1];_O(ie,fe,c,d)<=O&&I.push(b[re]),(k===0?c-m<=ie:d-m<=fe)&&(A.push(W),A.push(re-1),A.push(1-k)),(k===0?ie<=c+m:fe<=d+m)&&(A.push(1+re),A.push(U),A.push(1-k))}}return I}},i.LineBucket=lS,i.LineStripIndexArray=class extends zc{},i.LngLat=oh,i.MercatorCoordinate=y1,i.ONE_EM=eo,i.OverscaledTileID=_s,i.PerformanceUtils=Mr,i.Point=p,i.Pos3dArray=class extends Od{},i.PosArray=r_,i.Properties=jo,i.Protobuf=dS,i.QuadTriangleArray=class extends Nd{},i.RGBAImage=ys,i.RasterBoundsArray=class extends qy{},i.RequestPerformance=class{constructor(u){this._marks={start:[u.url,"start"].join("#"),end:[u.url,"end"].join("#"),measure:u.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let u=performance.getEntriesByName(this._marks.measure);return u.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),u=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),u}},i.SegmentVector=w,i.SymbolBucket=ig,i.Transitionable=Up,i.TriangleIndexArray=eh,i.Uniform1f=G,i.Uniform1i=class extends N{constructor(u,c){super(u,c),this.current=0}set(u){this.current!==u&&(this.current=u,this.gl.uniform1i(this.location,u))}},i.Uniform2f=class extends N{constructor(u,c){super(u,c),this.current=[0,0]}set(u){u[0]===this.current[0]&&u[1]===this.current[1]||(this.current=u,this.gl.uniform2f(this.location,u[0],u[1]))}},i.Uniform3f=class extends N{constructor(u,c){super(u,c),this.current=[0,0,0]}set(u){u[0]===this.current[0]&&u[1]===this.current[1]&&u[2]===this.current[2]||(this.current=u,this.gl.uniform3f(this.location,u[0],u[1],u[2]))}},i.Uniform4f=Z,i.UniformColor=j,i.UniformMatrix4f=class extends N{constructor(u,c){super(u,c),this.current=X}set(u){if(u[12]!==this.current[12]||u[0]!==this.current[0])this.current=u,this.gl.uniformMatrix4fv(this.location,!1,u);else for(let c=1;c<16;c++)if(u[c]!==this.current[c]){this.current=u,this.gl.uniformMatrix4fv(this.location,!1,u);break}}},i.UnwrappedTileID=Jk,i.ValidationError=Te,i.ZoomHistory=qb,i.__awaiter=o,i.add=function(u,c,d){return u[0]=c[0]+d[0],u[1]=c[1]+d[1],u[2]=c[2]+d[2],u},i.addDynamicAttributes=_S,i.addProtocol=function(u,c){Xt.REGISTERED_PROTOCOLS[u]=c},i.arrayBufferToImage=u=>new Promise((c,d)=>{const m=new Image;m.onload=()=>{c(m),URL.revokeObjectURL(m.src),m.onload=null,window.requestAnimationFrame(()=>{m.src=Re})},m.onerror=()=>d(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));var b=new Blob([new Uint8Array(u)],{type:"image/png"});m.src=u.byteLength?URL.createObjectURL(b):Re}),i.arrayBufferToImageBitmap=u=>o(void 0,void 0,void 0,function*(){if(u.byteLength===0)return createImageBitmap(new ImageData(1,1));var c=new Blob([new Uint8Array(u)],{type:"image/png"});try{return createImageBitmap(c)}catch(d){throw new Error(`Could not load image because of ${d.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}}),i.bezier=te,i.clamp=le,i.clipLine=aO,i.clone=function(u){var c=new pi(16);return c[0]=u[0],c[1]=u[1],c[2]=u[2],c[3]=u[3],c[4]=u[4],c[5]=u[5],c[6]=u[6],c[7]=u[7],c[8]=u[8],c[9]=u[9],c[10]=u[10],c[11]=u[11],c[12]=u[12],c[13]=u[13],c[14]=u[14],c[15]=u[15],c},i.clone$1=xe,i.clone$2=function(u){var c=new pi(3);return c[0]=u[0],c[1]=u[1],c[2]=u[2],c},i.collisionCircleLayout=fc,i.config=Xt,i.copy=function(u,c){return u[0]=c[0],u[1]=c[1],u[2]=c[2],u[3]=c[3],u[4]=c[4],u[5]=c[5],u[6]=c[6],u[7]=c[7],u[8]=c[8],u[9]=c[9],u[10]=c[10],u[11]=c[11],u[12]=c[12],u[13]=c[13],u[14]=c[14],u[15]=c[15],u},i.create=function(){var u=new pi(16);return pi!=Float32Array&&(u[1]=0,u[2]=0,u[3]=0,u[4]=0,u[6]=0,u[7]=0,u[8]=0,u[9]=0,u[11]=0,u[12]=0,u[13]=0,u[14]=0),u[0]=1,u[5]=1,u[10]=1,u[15]=1,u},i.create$1=js,i.create$2=function(){var u=new pi(4);return pi!=Float32Array&&(u[1]=0,u[2]=0),u[0]=1,u[3]=1,u},i.createAbortError=Gn,i.createExpression=Rp,i.createFilter=Lp,i.createLayout=Di,i.createStyleLayer=function(u){if(u.type==="custom")return new X7(u);switch(u.type){case"background":return new Y7(u);case"circle":return new Gs(u);case"fill":return new t7(u);case"fill-extrusion":return new p7(u);case"heatmap":return new $V(u);case"hillshade":return new YV(u);case"line":return new E7(u);case"raster":return new Z7(u);case"symbol":return new m1(u)}},i.cross=Vs,i.deepEqual=function u(c,d){if(Array.isArray(c)){if(!Array.isArray(d)||c.length!==d.length)return!1;for(let m=0;m<c.length;m++)if(!u(c[m],d[m]))return!1}else{if(typeof c!="object"||c===null||d===null)return c===d;if(typeof d!="object"||Object.keys(c).length!==Object.keys(d).length)return!1;for(const m in c)if(!u(c[m],d[m]))return!1}return!0},i.defaultEasing=g,i.degreesToRadians=function(u){return u*Math.PI/180},i.derefLayers=function(u){u=u.slice();var c=Object.create(null);for(let d=0;d<u.length;d++)c[u[d].id]=u[d];for(let d=0;d<u.length;d++)"ref"in u[d]&&(u[d]=function(m,b){const E={};for(const S in m)S!=="ref"&&(E[S]=m[S]);return Ae.forEach(S=>{S in b&&(E[S]=b[S])}),E}(u[d],c[u[d].ref]));return u},i.diffStyles=function(u,c){if(!u)return[{command:"setStyle",args:[c]}];let d=[];try{if(!Pe(u.version,c.version))return[{command:"setStyle",args:[c]}];Pe(u.center,c.center)||d.push({command:"setCenter",args:[c.center]}),Pe(u.zoom,c.zoom)||d.push({command:"setZoom",args:[c.zoom]}),Pe(u.bearing,c.bearing)||d.push({command:"setBearing",args:[c.bearing]}),Pe(u.pitch,c.pitch)||d.push({command:"setPitch",args:[c.pitch]}),Pe(u.sprite,c.sprite)||d.push({command:"setSprite",args:[c.sprite]}),Pe(u.glyphs,c.glyphs)||d.push({command:"setGlyphs",args:[c.glyphs]}),Pe(u.transition,c.transition)||d.push({command:"setTransition",args:[c.transition]}),Pe(u.light,c.light)||d.push({command:"setLight",args:[c.light]}),Pe(u.terrain,c.terrain)||d.push({command:"setTerrain",args:[c.terrain]}),Pe(u.sky,c.sky)||d.push({command:"setSky",args:[c.sky]});const fe={};var m=[];Bt(u.sources,c.sources,m,fe);const we=[];u.layers&&u.layers.forEach(de=>{"source"in de&&fe[de.source]?d.push({command:"removeLayer",args:[de.id]}):we.push(de)}),d=d.concat(m);{var b=we,E=c.layers,S=d;E=E||[];var A,I,O=(b=b||[]).map(an),k=E.map(an),U=b.reduce(Ie,{}),W=E.reduce(Ie,{}),re=O.slice(),ie=Object.create(null);let de,Me,Ve;for(let $e=0,Ye=0;$e<O.length;$e++)de=O[$e],Object.prototype.hasOwnProperty.call(W,de)?Ye++:(We(S,{command:"removeLayer",args:[de]}),re.splice(re.indexOf(de,Ye),1));for(let $e=0,Ye=0;$e<k.length;$e++)de=k[k.length-1-$e],re[re.length-1-$e]!==de&&(Object.prototype.hasOwnProperty.call(U,de)?(We(S,{command:"removeLayer",args:[de]}),re.splice(re.lastIndexOf(de,re.length-Ye),1)):Ye++,Me=re[re.length-$e],We(S,{command:"addLayer",args:[W[de],Me]}),re.splice(re.length-$e,0,de),ie[de]=!0);for(let $e=0;$e<k.length;$e++)if(A=U[de=k[$e]],I=W[de],!ie[de]&&!Pe(A,I))if(Pe(A.source,I.source)&&Pe(A["source-layer"],I["source-layer"])&&Pe(A.type,I.type)){for(Ve in Lt(A.layout,I.layout,S,de,null,"setLayoutProperty"),Lt(A.paint,I.paint,S,de,null,"setPaintProperty"),Pe(A.filter,I.filter)||We(S,{command:"setFilter",args:[de,I.filter]}),Pe(A.minzoom,I.minzoom)&&Pe(A.maxzoom,I.maxzoom)||We(S,{command:"setLayerZoomRange",args:[de,I.minzoom,I.maxzoom]}),A)Object.prototype.hasOwnProperty.call(A,Ve)&&Ve!=="layout"&&Ve!=="paint"&&Ve!=="filter"&&Ve!=="metadata"&&Ve!=="minzoom"&&Ve!=="maxzoom"&&(Ve.indexOf("paint.")===0?Lt(A[Ve],I[Ve],S,de,Ve.slice(6),"setPaintProperty"):Pe(A[Ve],I[Ve])||We(S,{command:"setLayerProperty",args:[de,Ve,I[Ve]]}));for(Ve in I)Object.prototype.hasOwnProperty.call(I,Ve)&&!Object.prototype.hasOwnProperty.call(A,Ve)&&Ve!=="layout"&&Ve!=="paint"&&Ve!=="filter"&&Ve!=="metadata"&&Ve!=="minzoom"&&Ve!=="maxzoom"&&(Ve.indexOf("paint.")===0?Lt(A[Ve],I[Ve],S,de,Ve.slice(6),"setPaintProperty"):Pe(A[Ve],I[Ve])||We(S,{command:"setLayerProperty",args:[de,Ve,I[Ve]]}))}else We(S,{command:"removeLayer",args:[de]}),We(S,{command:"addLayer",args:[I,Me=re[re.lastIndexOf(de)+1]]})}}catch(fe){console.warn("Unable to compute style diff:",fe),d=[{command:"setStyle",args:[c]}]}return d},i.dot=jc,i.dot$1=function(u,c){return u[0]*c[0]+u[1]*c[1]+u[2]*c[2]+u[3]*c[3]},i.earthRadius=xS,i.emitValidationErrors=Gb,i.emptyStyle=function(){var u={},c=q.$version;for(const m in q.$root){var d=q.$root[m];if(d.required){let b=null;(b=m==="version"?c:d.type==="array"?[]:{})!=null&&(u[m]=b)}}return u},i.equals=function(de,Wt){var d=de[0],m=de[1],b=de[2],E=de[3],S=de[4],A=de[5],I=de[6],O=de[7],k=de[8],U=de[9],W=de[10],re=de[11],ie=de[12],fe=de[13],we=de[14],de=de[15],Me=Wt[0],Ve=Wt[1],$e=Wt[2],Ye=Wt[3],et=Wt[4],mt=Wt[5],Ut=Wt[6],Nt=Wt[7],ut=Wt[8],kt=Wt[9],vt=Wt[10],dt=Wt[11],tt=Wt[12],Gt=Wt[13],zt=Wt[14],Wt=Wt[15];return Math.abs(d-Me)<=oi*Math.max(1,Math.abs(d),Math.abs(Me))&&Math.abs(m-Ve)<=oi*Math.max(1,Math.abs(m),Math.abs(Ve))&&Math.abs(b-$e)<=oi*Math.max(1,Math.abs(b),Math.abs($e))&&Math.abs(E-Ye)<=oi*Math.max(1,Math.abs(E),Math.abs(Ye))&&Math.abs(S-et)<=oi*Math.max(1,Math.abs(S),Math.abs(et))&&Math.abs(A-mt)<=oi*Math.max(1,Math.abs(A),Math.abs(mt))&&Math.abs(I-Ut)<=oi*Math.max(1,Math.abs(I),Math.abs(Ut))&&Math.abs(O-Nt)<=oi*Math.max(1,Math.abs(O),Math.abs(Nt))&&Math.abs(k-ut)<=oi*Math.max(1,Math.abs(k),Math.abs(ut))&&Math.abs(U-kt)<=oi*Math.max(1,Math.abs(U),Math.abs(kt))&&Math.abs(W-vt)<=oi*Math.max(1,Math.abs(W),Math.abs(vt))&&Math.abs(re-dt)<=oi*Math.max(1,Math.abs(re),Math.abs(dt))&&Math.abs(ie-tt)<=oi*Math.max(1,Math.abs(ie),Math.abs(tt))&&Math.abs(fe-Gt)<=oi*Math.max(1,Math.abs(fe),Math.abs(Gt))&&Math.abs(we-zt)<=oi*Math.max(1,Math.abs(we),Math.abs(zt))&&Math.abs(de-Wt)<=oi*Math.max(1,Math.abs(de),Math.abs(Wt))},i.evaluateSizeForFeature=function(u,{uSize:c,uSizeT:d},{lowerSize:m,upperSize:b}){return u.kind==="source"?m/Gc:u.kind==="composite"?Ea.number(m/Gc,b/Gc,d):c},i.evaluateSizeForZoom=function(u,c){let d=0,m=0;var b,E,S;return u.kind==="constant"?m=u.layoutSize:u.kind!=="source"&&({interpolationType:S,minZoom:b,maxZoom:E}=u,S=S?le(Ta.interpolationFactor(S,c,b,E),0,1):0,u.kind==="camera"?m=Ea.number(u.minSize,u.maxSize,S):d=S),{uSizeT:d,uSize:m}},i.exactEquals=function(u,c){return u[0]===c[0]&&u[1]===c[1]&&u[2]===c[2]&&u[3]===c[3]&&u[4]===c[4]&&u[5]===c[5]&&u[6]===c[6]&&u[7]===c[7]&&u[8]===c[8]&&u[9]===c[9]&&u[10]===c[10]&&u[11]===c[11]&&u[12]===c[12]&&u[13]===c[13]&&u[14]===c[14]&&u[15]===c[15]},i.extend=_e,i.filterObject=ue,i.findLineIntersection=function(u,E,d,A){var b=E.y-u.y,E=E.x-u.x,S=A.y-d.y,A=A.x-d.x,I=S*E-A*b;return I==0?null:(A=(A*(u.y-d.y)-S*(u.x-d.x))/I,new p(u.x+A*E,u.y+A*b))},i.fromRotation=function(u,m){var d=Math.sin(m),m=Math.cos(m);return u[0]=m,u[1]=d,u[2]=0,u[3]=-d,u[4]=m,u[5]=0,u[6]=0,u[7]=0,u[8]=1,u},i.fromScaling=function(u,c){return u[0]=c[0],u[1]=0,u[2]=0,u[3]=0,u[4]=0,u[5]=c[1],u[6]=0,u[7]=0,u[8]=0,u[9]=0,u[10]=c[2],u[11]=0,u[12]=0,u[13]=0,u[14]=0,u[15]=1,u},i.getAnchorAlignment=mS,i.getAnchorJustification=CS,i.getArrayBuffer=(u,c)=>It(_e(u,{type:"arrayBuffer"}),c),i.getDefaultExportFromCjs=a,i.getImageData=function(u,c,d,m,b){return o(this,void 0,void 0,function*(){if(D())try{return yield ht(u,c,d,m,b)}catch{}return S=c,A=d,I=m,O=b,k=(E=u).width,U=E.height,Rt&&hn||(Rt=new OffscreenCanvas(k,U),hn=Rt.getContext("2d",{willReadFrequently:!0})),Rt.width=k,Rt.height=U,hn.drawImage(E,0,0,k,U),E=hn.getImageData(S,A,I,O),hn.clearRect(0,0,k,U),E.data;var E,S,A,I,O,k,U})},i.getJSON=(u,c)=>It(_e(u,{type:"json"}),c),i.getOverlapMode=yS,i.getProtocol=ln,i.getReferrer=En,i.getVideo=u=>{const c=window.document.createElement("video");return c.muted=!0,new Promise(d=>{c.onloadstart=()=>{d(c)};for(const b of u){var m=window.document.createElement("source");he(b)||(c.crossOrigin="Anonymous"),m.src=b,c.appendChild(m)}})},i.groupByLayout=function(u,c){var d={};for(let E=0;E<u.length;E++){var m=c&&c[u[E].id]||Nb(u[E]);c&&(c[u[E].id]=m);let S=d[m];(S=S||(d[m]=[])).push(u[E])}var b=[];for(const E in d)b.push(d[E]);return b},i.identity=zr,i.interpolate=Ea,i.invert=function(u,de){var d=de[0],m=de[1],b=de[2],E=de[3],S=de[4],A=de[5],I=de[6],O=de[7],k=de[8],U=de[9],W=de[10],re=de[11],ie=de[12],fe=de[13],we=de[14],de=de[15],Me=d*A-m*S,Ve=d*I-b*S,$e=d*O-E*S,Ye=m*I-b*A,et=m*O-E*A,mt=b*O-E*I,Ut=k*fe-U*ie,Nt=k*we-W*ie,ut=k*de-re*ie,kt=U*we-W*fe,vt=U*de-re*fe,dt=W*de-re*we,tt=Me*dt-Ve*vt+$e*kt+Ye*ut-et*Nt+mt*Ut;return tt?(u[0]=(A*dt-I*vt+O*kt)*(tt=1/tt),u[1]=(b*vt-m*dt-E*kt)*tt,u[2]=(fe*mt-we*et+de*Ye)*tt,u[3]=(W*et-U*mt-re*Ye)*tt,u[4]=(I*ut-S*dt-O*Nt)*tt,u[5]=(d*dt-b*ut+E*Nt)*tt,u[6]=(we*$e-ie*mt-de*Ve)*tt,u[7]=(k*mt-W*$e+re*Ve)*tt,u[8]=(S*vt-A*ut+O*Ut)*tt,u[9]=(m*ut-d*vt-E*Ut)*tt,u[10]=(ie*et-fe*$e+de*Me)*tt,u[11]=(U*$e-k*et-re*Me)*tt,u[12]=(A*Nt-S*kt-I*Ut)*tt,u[13]=(d*kt-m*Nt+b*Ut)*tt,u[14]=(fe*Ve-ie*Ye-we*Me)*tt,u[15]=(k*Ye-U*Ve+W*Me)*tt,u):null},i.isAbortError=function(u){return u.message===Ge},i.isImageBitmap=at,i.isOffscreenCanvasDistorted=D,i.isSafari=function(u){var c;return Ze==null&&(c=u.navigator?u.navigator.userAgent:null,Ze=!!u.safari||!(!c||!(/\b(iPad|iPhone|iPod)\b/.test(c)||c.match("Safari")&&!c.match("Chrome")))),Ze},i.isWorker=Be,i.keysDifference=function(u,c){var d=[];for(const m in u)m in c||d.push(m);return d},i.makeRequest=It,i.mapObject=pe,i.mercatorXfromLng=Kk,i.mercatorYfromLat=Zk,i.mercatorZfromAltitude=Xk,i.mul=xd,i.mul$1=Vc,i.multiply=bo,i.nextPowerOfTwo=function(u){return u<=1?1:Math.pow(2,Math.ceil(Math.log(u)/Math.LN2))},i.normalize=Ji,i.offscreenCanvasSupported=M,i.ortho=$r,i.parseCacheControl=function(u){const c={};return u.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(d,m,b,E)=>(b=b||E,c[m]=!b||b.toLowerCase(),"")),c["max-age"]&&(u=parseInt(c["max-age"],10),isNaN(u)?delete c["max-age"]:c["max-age"]=u),c},i.parseGlyphPbf=function(u){return new dS(u).readFields(U7,[])},i.pbf=$a,i.performSymbolLayout=function(u){u.bucket.createArrays();var c,d,m=512*u.bucket.overscaling,b=(u.bucket.tilePixelRatio=ct/m,u.bucket.compareText={},u.bucket.iconsNeedLinear=!1,u.bucket.layers[0]),E=b.layout,S={layoutIconSize:(m=b._unevaluatedLayout._values)["icon-size"].possiblyEvaluate(new Ur(u.bucket.zoom+1),u.canonical),layoutTextSize:m["text-size"].possiblyEvaluate(new Ur(u.bucket.zoom+1),u.canonical),textMaxSize:m["text-size"].possiblyEvaluate(new Ur(18))};u.bucket.textSizeData.kind==="composite"&&({minZoom:c,maxZoom:d}=u.bucket.textSizeData,S.compositeTextSizes=[m["text-size"].possiblyEvaluate(new Ur(c),u.canonical),m["text-size"].possiblyEvaluate(new Ur(d),u.canonical)]),u.bucket.iconSizeData.kind==="composite"&&({minZoom:c,maxZoom:d}=u.bucket.iconSizeData,S.compositeIconSizes=[m["icon-size"].possiblyEvaluate(new Ur(c),u.canonical),m["icon-size"].possiblyEvaluate(new Ur(d),u.canonical)]);const A=E.get("text-line-height")*eo;var I=E.get("text-rotation-alignment")!=="viewport"&&E.get("symbol-placement")!=="point",O=E.get("text-keep-upright"),k=E.get("text-size");for(const de of u.bucket.features){const Me=E.get("text-font").evaluate(de,{},u.canonical).join(","),Ve=k.evaluate(de,{},u.canonical),$e=S.layoutTextSize.evaluate(de,{},u.canonical);var U=S.layoutIconSize.evaluate(de,{},u.canonical);const Ye={horizontal:{},vertical:void 0},et=de.text;let mt=[0,0];if(et){const ut=et.toString();var W=E.get("text-letter-spacing").evaluate(de,{},u.canonical)*eo;const kt=$b(ut)?W:0,vt=E.get("text-anchor").evaluate(de,{},u.canonical);var re=pO(b,de,u.canonical);re||(W=E.get("text-radial-offset").evaluate(de,{},u.canonical),mt=W?fO(vt,[W*eo,SS]):E.get("text-offset").evaluate(de,{},u.canonical).map(zt=>zt*eo));let dt=I?"center":E.get("text-justify").evaluate(de,{},u.canonical);const tt=E.get("symbol-placement"),Gt=tt==="point"?E.get("text-max-width").evaluate(de,{},u.canonical)*eo:0;if(W=()=>{u.bucket.allowVerticalPlacement&&Vl(ut)&&(Ye.vertical=f1(et,u.glyphMap,u.glyphPositions,u.imagePositions,Me,Gt,A,vt,"left",kt,mt,i.WritingMode.vertical,!0,tt,$e,Ve))},!I&&re){var ie,fe=new Set;if(dt==="auto")for(let Wt=0;Wt<re.values.length;Wt+=2)fe.add(CS(re.values[Wt]));else fe.add(dt);let zt=!1;for(const Wt of fe)Ye.horizontal[Wt]||(zt?Ye.horizontal[Wt]=Ye.horizontal[0]:(ie=f1(et,u.glyphMap,u.glyphPositions,u.imagePositions,Me,Gt,A,"center",Wt,kt,mt,i.WritingMode.horizontal,!1,tt,$e,Ve))&&(Ye.horizontal[Wt]=ie,zt=ie.positionedLines.length===1));W()}else{dt==="auto"&&(dt=CS(vt));var we=f1(et,u.glyphMap,u.glyphPositions,u.imagePositions,Me,Gt,A,vt,dt,kt,mt,i.WritingMode.horizontal,!1,tt,$e,Ve);we&&(Ye.horizontal[dt]=we),W(),Vl(ut)&&I&&O&&(Ye.vertical=f1(et,u.glyphMap,u.glyphPositions,u.imagePositions,Me,Gt,A,vt,dt,kt,mt,i.WritingMode.vertical,!1,tt,$e,Ve))}}let Ut,Nt=!1;de.icon&&de.icon.name&&(we=u.imageMap[de.icon.name])&&(Ut=function(ut,zt,Gt){var{horizontalAlign:Gt,verticalAlign:dt}=mS(Gt),tt=zt[0],zt=zt[1],Gt=(tt=tt-ut.displaySize[0]*Gt)+ut.displaySize[0],zt=zt-ut.displaySize[1]*dt;return{image:ut,top:zt,bottom:zt+ut.displaySize[1],left:tt,right:Gt}}(u.imagePositions[de.icon.name],E.get("icon-offset").evaluate(de,{},u.canonical),E.get("icon-anchor").evaluate(de,{},u.canonical)),Nt=!!we.sdf,u.bucket.sdfIcons===void 0?u.bucket.sdfIcons=Nt:u.bucket.sdfIcons!==Nt&&Ee("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),we.pixelRatio!==u.bucket.pixelRatio||E.get("icon-rotate").constantOr(1)!==0)&&(u.bucket.iconsNeedLinear=!0),W=mO(Ye.horizontal)||Ye.vertical,u.bucket.iconsInText=!!W&&W.iconsInText,(W||Ut)&&function(ut,kt,vt,dt,tt,Gt,zt,Wt,Sn,qn,An){let pr=Gt.textMaxSize.evaluate(kt,{});pr===void 0&&(pr=zt);const mn=ut.layers[0].layout,kn=mn.get("icon-offset").evaluate(kt,{},An),sr=mO(vt.horizontal),Rr=zt/24,vs=ut.tilePixelRatio*Rr,ca=ut.tilePixelRatio*pr/24,cr=ut.tilePixelRatio*Wt,nr=ut.tilePixelRatio*mn.get("symbol-spacing"),yc=mn.get("text-padding")*ut.tilePixelRatio,ch=function(_r,gr,mr,Ri=1){return _r=_r.get("icon-padding").evaluate(gr,{},mr),[(gr=_r&&_r.values)[0]*Ri,gr[1]*Ri,gr[2]*Ri,gr[3]*Ri]}(mn,kt,An,ut.tilePixelRatio),$s=mn.get("text-max-angle")/180*Math.PI,qc=mn.get("text-rotation-alignment")!=="viewport"&&mn.get("symbol-placement")!=="point",Vo=mn.get("icon-rotation-alignment")==="map"&&mn.get("symbol-placement")!=="point",Ws=mn.get("symbol-placement"),kS=nr/2,b_=mn.get("icon-text-fit");let no;dt&&b_!=="none"&&(ut.allowVerticalPlacement&&vt.vertical&&(no=zk(dt,vt.vertical,b_,mn.get("icon-text-fit-padding"),kn,Rr)),sr)&&(dt=zk(dt,sr,b_,mn.get("icon-text-fit-padding"),kn,Rr));var Po=(_r,gr)=>{if(!(gr.x<0||gr.x>=ct||gr.y<0||gr.y>=ct)){var mr=ut,Ri=gr;gr=_r;var Hi=vt;_r=dt;var Ca=tt,Wr=no,Gi=ut.layers[0],Mo=ut.collisionBoxArray,Ho=kt.index,Wa=kt.sourceLayerIndex,Ro=ut.index,Go=vs,Ks=[yc,yc,yc,yc],$c=qc,sg=Sn,Wc=cr,w1=ch,Yc=Vo,x1=kn,bs=kt,E1=Gt,Bd=qn,Wl=An,x_=zt,cg=mr.addToLineVertexArray(Ri,gr);let Ud,lg,ug,hg,bO=0,wO=0,xO=0,EO=0,OS=-1,LS=-1;var Yl={};let TO=y("");if(mr.allowVerticalPlacement&&Hi.vertical&&(gr=Gi.layout.get("text-rotate").evaluate(bs,{},Wl)+90,w_=Hi.vertical,ug=new v1(Mo,Ri,Ho,Wa,Ro,w_,Go,Ks,$c,gr),Wr)&&(hg=new v1(Mo,Ri,Ho,Wa,Ro,Wr,Wc,w1,$c,gr)),_r){var w_=Gi.layout.get("icon-rotate").evaluate(bs,{}),gr=Gi.layout.get("icon-text-fit")!=="none",T1=hO(_r,w_,Bd,gr),Wr=Wr?hO(Wr,w_,Bd,gr):void 0,Bd=(lg=new v1(Mo,Ri,Ho,Wa,Ro,_r,Wc,w1,!1,w_),bO=4*T1.length,mr.iconSizeData);let _c=null;Bd.kind==="source"?(_c=[Gc*Gi.layout.get("icon-size").evaluate(bs,{})])[0]>ih&&Ee(`${mr.layerIds[0]}: Value for "icon-size" is >= ${m_}. Reduce your "icon-size".`):Bd.kind==="composite"&&((_c=[Gc*E1.compositeIconSizes[0].evaluate(bs,{},Wl),Gc*E1.compositeIconSizes[1].evaluate(bs,{},Wl)])[0]>ih||_c[1]>ih)&&Ee(`${mr.layerIds[0]}: Value for "icon-size" is >= ${m_}. Reduce your "icon-size".`),mr.addSymbols(mr.icon,T1,_c,x1,Yc,bs,i.WritingMode.none,Ri,cg.lineStartIndex,cg.lineLength,-1,Wl),OS=mr.icon.placedSymbolArray.length-1,Wr&&(wO=4*Wr.length,mr.addSymbols(mr.icon,Wr,_c,x1,Yc,bs,i.WritingMode.vertical,Ri,cg.lineStartIndex,cg.lineLength,-1,Wl),LS=mr.icon.placedSymbolArray.length-1)}var vO=Object.keys(Hi.horizontal);for(const Zc of vO){var S1=Hi.horizontal[Zc],C1=(Ud||(TO=y(S1.text),C1=Gi.layout.get("text-rotate").evaluate(bs,{},Wl),Ud=new v1(Mo,Ri,Ho,Wa,Ro,S1,Go,Ks,$c,C1)),S1.positionedLines.length===1);if(xO+=gO(mr,Ri,S1,Ca,Gi,$c,bs,sg,cg,Hi.vertical?i.WritingMode.horizontal:i.WritingMode.horizontalOnly,C1?vO:[Zc],Yl,OS,E1,Wl),C1)break}Hi.vertical&&(EO+=gO(mr,Ri,Hi.vertical,Ca,Gi,$c,bs,sg,cg,i.WritingMode.vertical,["vertical"],Yl,LS,E1,Wl)),gr=Ud?Ud.boxStartIndex:mr.collisionBoxArray.length,_r=Ud?Ud.boxEndIndex:mr.collisionBoxArray.length,Wc=ug?ug.boxStartIndex:mr.collisionBoxArray.length,w1=ug?ug.boxEndIndex:mr.collisionBoxArray.length,Bd=lg?lg.boxStartIndex:mr.collisionBoxArray.length,T1=lg?lg.boxEndIndex:mr.collisionBoxArray.length,Wr=hg?hg.boxStartIndex:mr.collisionBoxArray.length,x1=hg?hg.boxEndIndex:mr.collisionBoxArray.length;let Kc=-1;Yc=(Zc,E_)=>Zc&&Zc.circleDiameter?Math.max(Zc.circleDiameter,E_):E_,Kc=Yc(Ud,Kc),Kc=Yc(ug,Kc),Kc=Yc(lg,Kc),Yc=-1<(Kc=Yc(hg,Kc))?1:0,Yc&&(Kc*=x_/eo),mr.glyphOffsetArray.length>=ig.MAX_GLYPHS&&Ee("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),bs.sortKey!==void 0&&mr.addToSortKeyRanges(mr.symbolInstances.length,bs.sortKey);var x_=pO(Gi,bs,Wl),[x_,hH]=function(Zc,E_){var dH=Zc.length,_c=E_==null?void 0:E_.values;if(0<(_c==null?void 0:_c.length))for(let A1=0;A1<_c.length;A1+=2){var fH=i.TextAnchorEnum[_c[A1]],SO=_c[A1+1];Zc.emplaceBack(fH,SO[0],SO[1])}return[dH,Zc.length]}(mr.textAnchorOffsets,x_);mr.symbolInstances.emplaceBack(Ri.x,Ri.y,0<=Yl.right?Yl.right:-1,0<=Yl.center?Yl.center:-1,0<=Yl.left?Yl.left:-1,Yl.vertical||-1,OS,LS,TO,gr,_r,Wc,w1,Bd,T1,Wr,x1,Ho,xO,EO,bO,wO,Yc,0,Go,Kc,x_,hH)}};if(Ws==="line")for(const _r of aO(kt.geometry,0,0,ct,ct))for(const gr of oH(_r,nr,$s,vt.vertical||sr,dt,24,ca,ut.overscaling,ct))sr&&function(mr,Ri,Hi,Ca){if(mr=mr.compareText,Ri in mr){var Wr=mr[Ri];for(let Gi=Wr.length-1;0<=Gi;Gi--)if(Ca.dist(Wr[Gi])<Hi)return 1}else mr[Ri]=[];return mr[Ri].push(Ca),0}(ut,sr.text,kS,gr)||Po(_r,gr);else if(Ws==="line-center")for(const _r of kt.geometry){var Ys;1<_r.length&&(Ys=function(gr,mr,Ri,Hi,Ca,Wr){var Gi=lO(Ri,Ca,Wr),Mo=uO(Ri,Hi)*Wr;let Ho=0;var Wa=cO(gr)/2;for(let Wc=0;Wc<gr.length-1;Wc++){var Ro,Go,Ks=gr[Wc],$c=gr[Wc+1],sg=Ks.dist($c);if(Ho+sg>Wa)return Ro=(Wa-Ho)/sg,Go=Ea.number(Ks.x,$c.x,Ro),Ro=Ea.number(Ks.y,$c.y,Ro),(Go=new ah(Go,Ro,$c.angleTo(Ks),Wc))._round(),!Gi||sO(gr,Go,Mo,Gi,mr)?Go:void 0;Ho+=sg}}(_r,$s,vt.vertical||sr,dt,24,ca))&&Po(_r,Ys)}else if(kt.type==="Polygon")for(const _r of rS(kt.geometry,0)){var $l=lH(_r,16);Po(_r[0],new ah($l.x,$l.y,0))}else if(kt.type==="LineString")for(const _r of kt.geometry)Po(_r,new ah(_r[0].x,_r[0].y,0));else if(kt.type==="Point")for(const _r of kt.geometry)for(const gr of _r)Po([gr],new ah(gr.x,gr.y,0))}(u.bucket,de,Ye,Ut,u.imageMap,S,$e,U,mt,Nt,u.canonical)}u.showCollisionBoxes&&u.bucket.generateCollisionDebugBuffers()},i.perspective=jr,i.pick=function(u,c){var d={};for(let b=0;b<c.length;b++){var m=c[b];m in u&&(d[m]=u[m])}return d},i.pointGeometry=l,i.polygonIntersectsPolygon=Kt,i.potpack=Lk,i.readImageUsingVideoFrame=ht,i.register=Vt,i.removeProtocol=function(u){delete Xt.REGISTERED_PROTOCOLS[u]},i.renderColorRamp=hk,i.renderStyleImage=function(u){var c=u.userImage;return!!(c&&c.render&&c.render())&&(u.data.replace(new Uint8Array(c.data.buffer)),!0)},i.rotate=function(u,S,I){var m=S[0],b=S[1],E=S[2],S=S[3],A=Math.sin(I),I=Math.cos(I);return u[0]=m*I+E*A,u[1]=b*I+S*A,u[2]=m*-A+E*I,u[3]=b*-A+S*I,u},i.rotateX=function(u,c,b){var m=Math.sin(b),b=Math.cos(b),E=c[4],S=c[5],A=c[6],I=c[7],O=c[8],k=c[9],U=c[10],W=c[11];return c!==u&&(u[0]=c[0],u[1]=c[1],u[2]=c[2],u[3]=c[3],u[12]=c[12],u[13]=c[13],u[14]=c[14],u[15]=c[15]),u[4]=E*b+O*m,u[5]=S*b+k*m,u[6]=A*b+U*m,u[7]=I*b+W*m,u[8]=O*b-E*m,u[9]=k*b-S*m,u[10]=U*b-A*m,u[11]=W*b-I*m,u},i.rotateZ=function(u,c,b){var m=Math.sin(b),b=Math.cos(b),E=c[0],S=c[1],A=c[2],I=c[3],O=c[4],k=c[5],U=c[6],W=c[7];return c!==u&&(u[8]=c[8],u[9]=c[9],u[10]=c[10],u[11]=c[11],u[12]=c[12],u[13]=c[13],u[14]=c[14],u[15]=c[15]),u[0]=E*b+O*m,u[1]=S*b+k*m,u[2]=A*b+U*m,u[3]=I*b+W*m,u[4]=O*b-E*m,u[5]=k*b-S*m,u[6]=U*b-A*m,u[7]=W*b-I*m,u},i.rtlWorkerPlugin=Hl,i.sameOrigin=he,i.scale=function(u,c,E){var m=E[0],b=E[1],E=E[2];return u[0]=c[0]*m,u[1]=c[1]*m,u[2]=c[2]*m,u[3]=c[3]*m,u[4]=c[4]*b,u[5]=c[5]*b,u[6]=c[6]*b,u[7]=c[7]*b,u[8]=c[8]*E,u[9]=c[9]*E,u[10]=c[10]*E,u[11]=c[11]*E,u[12]=c[12],u[13]=c[13],u[14]=c[14],u[15]=c[15],u},i.scale$1=function(u,c,d){return u[0]=c[0]*d,u[1]=c[1]*d,u[2]=c[2]*d,u},i.sphericalToCartesian=function([u,c,d]){return c=(c+=90)*(Math.PI/180),d*=Math.PI/180,{x:u*Math.cos(c)*Math.sin(d),y:u*Math.sin(c)*Math.sin(d),z:u*Math.cos(d)}},i.sqrLen=Mi,i.sub=Fi,i.toEvaluationFeature=Yt,i.transformMat3=function(u,E,d){var m=E[0],b=E[1],E=E[2];return u[0]=m*d[0]+b*d[3]+E*d[6],u[1]=m*d[1]+b*d[4]+E*d[7],u[2]=m*d[2]+b*d[5]+E*d[8],u},i.transformMat4=Hs,i.transformMat4$1=function(u,b,d){var m=b[0],b=b[1];return u[0]=d[0]*m+d[4]*b+d[12],u[1]=d[1]*m+d[5]*b+d[13],u},i.translate=function(u,c,de){var m,b,E,S,A,I,O,k,U,W,re,ie,fe=de[0],we=de[1],de=de[2];return c===u?(u[12]=c[0]*fe+c[4]*we+c[8]*de+c[12],u[13]=c[1]*fe+c[5]*we+c[9]*de+c[13],u[14]=c[2]*fe+c[6]*we+c[10]*de+c[14],u[15]=c[3]*fe+c[7]*we+c[11]*de+c[15]):(m=c[0],b=c[1],E=c[2],S=c[3],A=c[4],I=c[5],O=c[6],k=c[7],U=c[8],W=c[9],re=c[10],ie=c[11],u[0]=m,u[1]=b,u[2]=E,u[3]=S,u[4]=A,u[5]=I,u[6]=O,u[7]=k,u[8]=U,u[9]=W,u[10]=re,u[11]=ie,u[12]=m*fe+A*we+U*de+c[12],u[13]=b*fe+I*we+W*de+c[13],u[14]=E*fe+O*we+re*de+c[14],u[15]=S*fe+k*we+ie*de+c[15]),u},i.unicodeBlockLookup=Ft,i.uniqueId=function(){return J++},i.v8Spec=q,i.validateCustomStyleLayer=function(u){var c=[],d=u.id;return d===void 0&&c.push({message:`layers.${d}: missing required property "id"`}),u.render===void 0&&c.push({message:`layers.${d}: missing required method "render"`}),u.renderingMode&&u.renderingMode!=="2d"&&u.renderingMode!=="3d"&&c.push({message:`layers.${d}: property "renderingMode" must be either "2d" or "3d"`}),c},i.validateLight=wd,i.validateStyle=Ad,i.vectorTile=rh,i.warnOnce=Ee,i.wrap=ce}),r("worker",0,function(i){class o{constructor(V){this.keyCache={},V&&this.replace(V)}replace(V){this._layerConfigs={},this._layers={},this.update(V,[])}update(V,$){for(const Le of V){this._layerConfigs[Le.id]=Le;var K=this._layers[Le.id]=i.createStyleLayer(Le);K._featureFilter=i.createFilter(K.filter),this.keyCache[Le.id]&&delete this.keyCache[Le.id]}for(const Le of $)delete this.keyCache[Le],delete this._layerConfigs[Le],delete this._layers[Le];this.familiesBySource={};for(const Le of i.groupByLayout(Object.values(this._layerConfigs),this.keyCache)){var me=Le.map(Ce=>this._layers[Ce.id]),Oe=me[0];if(Oe.visibility!=="none"){var He=Oe.source||"";let Ce=this.familiesBySource[He];Ce=Ce||(this.familiesBySource[He]={}),He=Oe.sourceLayer||"_geojsonTileLayer";let De=Ce[He];(De=De||(Ce[He]=[])).push(me)}}}}class a{constructor(V){var $={},K=[];for(const en in V){var me=V[en],Oe=$[en]={};for(const yn in me){var He,Le=me[+yn];Le&&Le.bitmap.width!==0&&Le.bitmap.height!==0&&(He={x:0,y:0,w:Le.bitmap.width+2,h:Le.bitmap.height+2},K.push(He),Oe[yn]={rect:He,metrics:Le.metrics})}}var{w:Ce,h:De}=i.potpack(K),ot=new i.AlphaImage({width:Ce||1,height:De||1});for(const en in V){var st=V[en];for(const yn in st){var St,un=st[+yn];un&&un.bitmap.width!==0&&un.bitmap.height!==0&&(St=$[en][yn].rect,i.AlphaImage.copy(un.bitmap,ot,{x:0,y:0},{x:St.x+1,y:St.y+1},un.bitmap))}}this.image=ot,this.positions=$}}i.register("GlyphAtlas",a);class l{constructor(V){this.tileID=new i.OverscaledTileID(V.tileID.overscaledZ,V.tileID.wrap,V.tileID.canonical.z,V.tileID.canonical.x,V.tileID.canonical.y),this.uid=V.uid,this.zoom=V.zoom,this.pixelRatio=V.pixelRatio,this.tileSize=V.tileSize,this.source=V.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=V.showCollisionBoxes,this.collectResourceTiming=!!V.collectResourceTiming,this.returnDependencies=!!V.returnDependencies,this.promoteId=V.promoteId,this.inFlightDependencies=[]}parse(V,$,K,me){return i.__awaiter(this,void 0,void 0,function*(){this.status="parsing",this.data=V,this.collisionBoxArray=new i.CollisionBoxArray;var Oe=new i.DictionaryCoder(Object.keys(V.layers).sort()),He=new i.FeatureIndex(this.tileID,this.promoteId),Le=(He.bucketLayerIDs=[],{}),Ce={featureIndex:He,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:K},De=$.familiesBySource[this.source];for(const Ei in De){var ot=V.layers[Ei];if(ot){ot.version===1&&i.warnOnce(`Vector tile source "${this.source}" layer "${Ei}" does not use vector tile spec v2 and therefore may have some rendering errors.`);var st=Oe.encode(Ei),St=[];for(let co=0;co<ot.length;co++){var un=ot.feature(co),en=He.getId(un,Ei);St.push({feature:un,id:en,index:co,sourceLayerIndex:st})}for(const co of De[Ei]){var yn=co[0];yn.source!==this.source&&i.warnOnce(`layer.source = ${yn.source} does not equal this.source = `+this.source),yn.minzoom&&this.zoom<Math.floor(yn.minzoom)||yn.maxzoom&&this.zoom>=yn.maxzoom||yn.visibility!=="none"&&(h(co,this.zoom,K),(Le[yn.id]=yn.createBucket({index:He.bucketLayerIDs.length,layers:co,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:st,sourceID:this.source})).populate(St,Ce,this.tileID.canonical),He.bucketLayerIDs.push(co.map(zu=>zu.id)))}}}var Wn=i.mapObject(Ce.glyphDependencies,Ei=>Object.keys(Ei).map(Number));this.inFlightDependencies.forEach(Ei=>Ei==null?void 0:Ei.abort()),this.inFlightDependencies=[];let Kn=Promise.resolve({});Object.keys(Wn).length&&(On=new AbortController,this.inFlightDependencies.push(On),Kn=me.sendAsync({type:"GG",data:{stacks:Wn,source:this.source,tileID:this.tileID,type:"glyphs"}},On)),Wn=Object.keys(Ce.iconDependencies);let er=Promise.resolve({});Wn.length&&(On=new AbortController,this.inFlightDependencies.push(On),er=me.sendAsync({type:"GI",data:{icons:Wn,source:this.source,tileID:this.tileID,type:"icons"}},On));var On,Wn=Object.keys(Ce.patternDependencies);let Dn=Promise.resolve({});Wn.length&&(On=new AbortController,this.inFlightDependencies.push(On),Dn=me.sendAsync({type:"GI",data:{icons:Wn,source:this.source,tileID:this.tileID,type:"patterns"}},On));var[fn,pn,Wn]=yield Promise.all([Kn,er,Dn]),Nr=new a(fn),ni=new i.ImageAtlas(pn,Wn);for(const Ei in Le){var ji=Le[Ei];ji instanceof i.SymbolBucket?(h(ji.layers,this.zoom,K),i.performSymbolLayout({bucket:ji,glyphMap:fn,glyphPositions:Nr.positions,imageMap:pn,imagePositions:ni.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical})):ji.hasPattern&&(ji instanceof i.LineBucket||ji instanceof i.FillBucket||ji instanceof i.FillExtrusionBucket)&&(h(ji.layers,this.zoom,K),ji.addFeatures(Ce,this.tileID.canonical,ni.patternPositions))}return this.status="done",{buckets:Object.values(Le).filter(Ei=>!Ei.isEmpty()),featureIndex:He,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Nr.image,imageAtlas:ni,glyphMap:this.returnDependencies?fn:null,iconMap:this.returnDependencies?pn:null,glyphPositions:this.returnDependencies?Nr.positions:null}})}}function h(oe,V,$){var K=new i.EvaluationParameters(V);for(const me of oe)me.recalculate(K,$)}class p{constructor(V,$,K){this.actor=V,this.layerIndex=$,this.availableImages=K,this.fetching={},this.loading={},this.loaded={}}loadVectorTile(V,$){return i.__awaiter(this,void 0,void 0,function*(){var K=yield i.getArrayBuffer(V.request,$);try{return{vectorTile:new i.vectorTile.VectorTile(new i.Protobuf(K.data)),rawData:K.data,cacheControl:K.cacheControl,expires:K.expires}}catch(me){K=new Uint8Array(K.data),K=K[0]===31&&K[1]===139;let Oe=`Unable to parse the tile at ${V.request.url}, `;throw Oe+=K?"please make sure the data is not gzipped and that you have configured the relevant header in the server":"got error: "+me.messge,new Error(Oe)}})}loadTile(V){return i.__awaiter(this,void 0,void 0,function*(){var $=V.uid,K=!!(V&&V.request&&V.request.collectResourceTiming)&&new i.RequestPerformance(V.request),me=new l(V),Oe=(this.loading[$]=me,new AbortController);me.abort=Oe;try{var He=yield this.loadVectorTile(V,Oe);if(delete this.loading[$],!He)return null;var Le,Ce=He.rawData,De={},ot=(He.expires&&(De.expires=He.expires),He.cacheControl&&(De.cacheControl=He.cacheControl),{}),st=(K&&(Le=K.finish())&&(ot.resourceTiming=JSON.parse(JSON.stringify(Le))),me.vectorTile=He.vectorTile,me.parse(He.vectorTile,this.layerIndex,this.availableImages,this.actor));this.loaded[$]=me,this.fetching[$]={rawTileData:Ce,cacheControl:De,resourceTiming:ot};try{var St=yield st;return i.extend({rawTileData:Ce.slice(0)},St,De,ot)}finally{delete this.fetching[$]}}catch(un){throw delete this.loading[$],me.status="done",this.loaded[$]=me,un}})}reloadTile(V){return i.__awaiter(this,void 0,void 0,function*(){var $=V.uid;if(!this.loaded||!this.loaded[$])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");var K=this.loaded[$];if(K.showCollisionBoxes=V.showCollisionBoxes,K.status==="parsing"){var me,Oe,He,Le=yield K.parse(K.vectorTile,this.layerIndex,this.availableImages,this.actor);return this.fetching[$]?({rawTileData:me,cacheControl:Oe,resourceTiming:He}=this.fetching[$],delete this.fetching[$],i.extend({rawTileData:me.slice(0)},Le,Oe,He)):Le}if(K.status==="done"&&K.vectorTile)return K.parse(K.vectorTile,this.layerIndex,this.availableImages,this.actor)})}abortTile(V){return i.__awaiter(this,void 0,void 0,function*(){var $=this.loading,K=V.uid;$&&$[K]&&$[K].abort&&($[K].abort.abort(),delete $[K])})}removeTile(V){return i.__awaiter(this,void 0,void 0,function*(){this.loaded&&this.loaded[V.uid]&&delete this.loaded[V.uid]})}}class g{constructor(){this.loaded={}}loadTile(V){return i.__awaiter(this,void 0,void 0,function*(){var{uid:$,encoding:K,rawImageData:me,redFactor:Oe,greenFactor:He,blueFactor:Le,baseShift:Ce}=V,De=me.width+2,ot=me.height+2,De=i.isImageBitmap(me)?new i.RGBAImage({width:De,height:ot},yield i.getImageData(me,-1,-1,De,ot)):me,ot=new i.DEMData($,De,K,Oe,He,Le,Ce);return this.loaded=this.loaded||{},this.loaded[$]=ot})}removeTile(K){var $=this.loaded,K=K.uid;$&&$[K]&&delete $[K]}}function _(oe,V){if(oe.length!==0){x(oe[0],V);for(var $=1;$<oe.length;$++)x(oe[$],!V)}}function x(oe,V){for(var $=0,K=0,me=0,Oe=oe.length,He=Oe-1;me<Oe;He=me++){var Le=(oe[me][0]-oe[He][0])*(oe[He][1]+oe[me][1]),Ce=$+Le;K+=Math.abs($)>=Math.abs(Le)?$-Ce+Le:Le-Ce+$,$=Ce}0<=$+K!=!!V&&oe.reverse()}var C=i.getDefaultExportFromCjs(function oe(V,$){var K,me=V&&V.type;if(me==="FeatureCollection")for(K=0;K<V.features.length;K++)oe(V.features[K],$);else if(me==="GeometryCollection")for(K=0;K<V.geometries.length;K++)oe(V.geometries[K],$);else if(me==="Feature")oe(V.geometry,$);else if(me==="Polygon")_(V.coordinates,$);else if(me==="MultiPolygon")for(K=0;K<V.coordinates.length;K++)_(V.coordinates[K],$);return V});const M=i.vectorTile.VectorTileFeature.prototype.toGeoJSON;let L=class{constructor(oe){this._feature=oe,this.extent=i.EXTENT,this.type=oe.type,this.properties=oe.tags,"id"in oe&&!isNaN(oe.id)&&(this.id=parseInt(oe.id,10))}loadGeometry(){if(this._feature.type===1){var oe=[];for(const K of this._feature.geometry)oe.push([new i.Point(K[0],K[1])]);return oe}var V=[];for(const K of this._feature.geometry){var $=[];for(const me of K)$.push(new i.Point(me[0],me[1]));V.push($)}return V}toGeoJSON(oe,V,$){return M.call(this,oe,V,$)}},D=class{constructor(oe){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=i.EXTENT,this.length=oe.length,this._features=oe}feature(oe){return new L(this._features[oe])}};var z={exports:{}},te=i.pointGeometry,le=i.vectorTile.VectorTileFeature,ce=_e;function _e(oe,V){this.options=V||{},this.features=oe,this.length=oe.length}function J(oe,V){this.id=typeof oe.id=="number"?oe.id:void 0,this.type=oe.type,this.rawGeometry=oe.type===1?[oe.geometry]:oe.geometry,this.properties=oe.tags,this.extent=V||4096}_e.prototype.feature=function(oe){return new J(this.features[oe],this.options.extent)},J.prototype.loadGeometry=function(){var oe=this.rawGeometry;this.geometry=[];for(var V=0;V<oe.length;V++){for(var $=oe[V],K=[],me=0;me<$.length;me++)K.push(new te($[me][0],$[me][1]));this.geometry.push(K)}return this.geometry},J.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var oe=this.geometry,V=1/0,$=-1/0,K=1/0,me=-1/0,Oe=0;Oe<oe.length;Oe++)for(var He=oe[Oe],Le=0;Le<He.length;Le++)var Ce=He[Le],V=Math.min(V,Ce.x),$=Math.max($,Ce.x),K=Math.min(K,Ce.y),me=Math.max(me,Ce.y);return[V,K,$,me]},J.prototype.toGeoJSON=le.prototype.toGeoJSON;var pe=i.pbf,ue=ce;function xe(oe){var V,$=new pe,K=oe,me=$;for(V in K.layers)me.writeMessage(3,je,K.layers[V]);return $.finish()}function je(oe,V){V.writeVarintField(15,oe.version||1),V.writeStringField(1,oe.name||""),V.writeVarintField(5,oe.extent||4096);for(var $={keys:[],values:[],keycache:{},valuecache:{}},K=0;K<oe.length;K++)$.feature=oe.feature(K),V.writeMessage(2,ne,$);var me=$.keys;for(K=0;K<me.length;K++)V.writeStringField(3,me[K]);var Oe=$.values;for(K=0;K<Oe.length;K++)V.writeMessage(4,at,Oe[K])}function ne(oe,V){var $=oe.feature;$.id!==void 0&&V.writeVarintField(1,$.id),V.writeMessage(2,Ee,oe),V.writeVarintField(3,$.type),V.writeMessage(4,Ze,$)}function Ee(oe,V){var $,K=oe.feature,me=oe.keys,Oe=oe.values,He=oe.keycache,Le=oe.valuecache;for($ in K.properties){var Ce,De=K.properties[$],ot=He[$];De!==null&&(ot===void 0&&(me.push($),ot=me.length-1,He[$]=ot),V.writeVarint(ot),(Ce=Le[ot=(ot=typeof De)+":"+(De=ot!="string"&&ot!="boolean"&&ot!="number"?JSON.stringify(De):De)])===void 0&&(Oe.push(De),Ce=Oe.length-1,Le[ot]=Ce),V.writeVarint(Ce))}}function ke(oe,V){return(V<<3)+(7&oe)}function Be(oe){return oe<<1^oe>>31}function Ze(oe,V){for(var $=oe.loadGeometry(),K=oe.type,me=0,Oe=0,He=$.length,Le=0;Le<He;Le++){for(var Ce=$[Le],De=1,ot=(K===1&&(De=Ce.length),V.writeVarint(ke(1,De)),K===3?Ce.length-1:Ce.length),st=0;st<ot;st++){st===1&&K!==1&&V.writeVarint(ke(2,ot-1));var St=Ce[st].x-me,un=Ce[st].y-Oe;V.writeVarint(Be(St)),V.writeVarint(Be(un)),me+=St,Oe+=un}K===3&&V.writeVarint(15)}}function at(oe,V){var $=typeof oe;$=="string"?V.writeStringField(1,oe):$=="boolean"?V.writeBooleanField(7,oe):$=="number"&&(oe%1!=0?V.writeDoubleField(3,oe):oe<0?V.writeSVarintField(6,oe):V.writeVarintField(5,oe))}z.exports=xe,z.exports.fromVectorTileJs=xe,z.exports.fromGeojsonVt=function(oe,V){V=V||{};var $,K={};for($ in oe)K[$]=new ue(oe[$].features,V),K[$].name=$,K[$].version=V.version,K[$].extent=V.extent;return xe({layers:K})},z.exports.GeoJSONWrapper=ue;var Re,ht=i.getDefaultExportFromCjs(z.exports);const Rt={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:oe=>oe},hn=Math.fround||(Re=new Float32Array(1),oe=>(Re[0]=+oe,Re[0])),wt=3,Ge=5,Gn=6;class Xt{constructor(V){this.options=Object.assign(Object.create(Rt),V),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(V){var{log:$,minZoom:K,maxZoom:me}=this.options,Oe=($&&console.time("total time"),`prepare ${V.length} points`),He=($&&console.time(Oe),this.points=V,[]);for(let st=0;st<V.length;st++){var Le,Ce=V[st];Ce.geometry&&([Ce,Le]=Ce.geometry.coordinates,Ce=hn(Ot(Ce)),Le=hn(En(Le)),He.push(Ce,Le,1/0,st,-1,1),this.options.reduce)&&He.push(0)}let De=this.trees[me+1]=this._createTree(He);$&&console.timeEnd(Oe);for(let st=me;st>=K;st--){var ot=+Date.now();De=this.trees[st]=this._createTree(this._cluster(De,st)),$&&console.log("z%d: %d clusters in %dms",st,De.numItems,+Date.now()-ot)}return $&&console.timeEnd("total time"),this}getClusters(Le,$){let K=((Le[0]+180)%360+360)%360-180;var me=Math.max(-90,Math.min(90,Le[1]));let Oe=Le[2]===180?180:((Le[2]+180)%360+360)%360-180;var He=Math.max(-90,Math.min(90,Le[3]));if(360<=Le[2]-Le[0])K=-180,Oe=180;else if(K>Oe)return Le=this.getClusters([K,me,180,He],$),Ce=this.getClusters([-180,me,Oe,He],$),Le.concat(Ce);var Le=this.trees[this._limitZoom($)],Ce=Le.range(Ot(K),En(He),Ot(Oe),En(me)),De=Le.data,ot=[];for(const St of Ce){var st=this.stride*St;ot.push(1<De[st+Ge]?ln(De,st,this.clusterProps):this.points[De[st+wt]])}return ot}getChildren(V){var Le=this._getOriginId(V),Oe=this._getOriginZoom(V),$="No cluster with the specified id.",K=this.trees[Oe];if(!K)throw new Error($);var me=K.data;if(Le*this.stride>=me.length)throw new Error($);var Oe=this.options.radius/(this.options.extent*Math.pow(2,Oe-1)),He=me[Le*this.stride],Le=me[Le*this.stride+1],Ce=[];for(const ot of K.within(He,Le,Oe)){var De=ot*this.stride;me[4+De]===V&&Ce.push(1<me[De+Ge]?ln(me,De,this.clusterProps):this.points[me[De+wt]])}if(Ce.length===0)throw new Error($);return Ce}getLeaves(V,$,K){var me=[];return this._appendLeaves(me,V,$=$||10,K=K||0,0),me}getTile(Oe,$,K){var me=this.trees[this._limitZoom(Oe)],Oe=Math.pow(2,Oe),{extent:Le,radius:He}=this.options,He=He/Le,Le=(K-He)/Oe,Ce=(K+1+He)/Oe,De={features:[]};return this._addTileFeatures(me.range(($-He)/Oe,Le,($+1+He)/Oe,Ce),me.data,$,K,Oe,De),$===0&&this._addTileFeatures(me.range(1-He/Oe,Le,1,Ce),me.data,Oe,K,Oe,De),$===Oe-1&&this._addTileFeatures(me.range(0,Le,He/Oe,Ce),me.data,-1,K,Oe,De),De.features.length?De:null}getClusterExpansionZoom(V){let $=this._getOriginZoom(V)-1;for(;$<=this.options.maxZoom;){var K=this.getChildren(V);if($++,K.length!==1)break;V=K[0].properties.cluster_id}return $}_appendLeaves(V,$,K,me,Oe){for(const Le of this.getChildren($)){var He=Le.properties;if(He&&He.cluster?Oe+He.point_count<=me?Oe+=He.point_count:Oe=this._appendLeaves(V,He.cluster_id,K,me,Oe):Oe<me?Oe++:V.push(Le),V.length===K)break}return Oe}_createTree(V){var $=new i.KDBush(V.length/this.stride|0,this.options.nodeSize,Float32Array);for(let K=0;K<V.length;K+=this.stride)$.add(V[K],V[K+1]);return $.finish(),$.data=V,$}_addTileFeatures(V,$,K,me,Oe,He){for(const st of V){var Le,Ce=st*this.stride,De=1<$[Ce+Ge];let St,un,en;en=De?(St=Mn($,Ce,this.clusterProps),un=$[Ce],$[1+Ce]):(ot=this.points[$[Ce+wt]],[ot,Le]=(St=ot.properties,ot.geometry.coordinates),un=Ot(ot),En(Le));var ot={type:1,geometry:[[Math.round(this.options.extent*(un*Oe-K)),Math.round(this.options.extent*(en*Oe-me))]],tags:St};let yn;(yn=De||this.options.generateId?$[Ce+wt]:this.points[$[Ce+wt]].id)!==void 0&&(ot.id=yn),He.features.push(ot)}}_limitZoom(V){return Math.max(this.options.minZoom,Math.min(Math.floor(+V),this.options.maxZoom+1))}_cluster(V,$){var{radius:K,extent:me,reduce:Oe,minPoints:He}=this.options,Le=K/(me*Math.pow(2,$)),Ce=V.data,De=[],ot=this.stride;for(let fn=0;fn<Ce.length;fn+=ot)if(!(Ce[fn+2]<=$)){Ce[fn+2]=$;var st=Ce[fn],St=Ce[fn+1],un=V.within(Ce[fn],Ce[fn+1],Le),en=Ce[fn+Ge];let pn=en;for(const Wn of un){var yn=Wn*ot;Ce[2+yn]>$&&(pn+=Ce[yn+Ge])}if(pn>en&&pn>=He){let Wn=st*en,Nr=St*en,ni,ji=-1;var Kn=((fn/ot|0)<<5)+($+1)+this.points.length;for(const Ei of un){var er,On=Ei*ot;Ce[2+On]<=$||(Ce[2+On]=$,er=Ce[On+Ge],Wn+=Ce[On]*er,Nr+=Ce[1+On]*er,Ce[4+On]=Kn,Oe&&(ni||(ni=this._map(Ce,fn,!0),ji=this.clusterProps.length,this.clusterProps.push(ni)),Oe(ni,this._map(Ce,On))))}Ce[fn+4]=Kn,De.push(Wn/pn,Nr/pn,1/0,Kn,-1,pn),Oe&&De.push(ji)}else{for(let Wn=0;Wn<ot;Wn++)De.push(Ce[fn+Wn]);if(1<pn)for(const Wn of un){var Dn=Wn*ot;if(!(Ce[2+Dn]<=$)){Ce[2+Dn]=$;for(let Nr=0;Nr<ot;Nr++)De.push(Ce[Dn+Nr])}}}}return De}_getOriginId(V){return V-this.points.length>>5}_getOriginZoom(V){return(V-this.points.length)%32}_map(V,$,K){var me;return 1<V[$+Ge]?(me=this.clusterProps[V[$+Gn]],K?Object.assign({},me):me):(me=this.points[V[$+wt]].properties,V=this.options.map(me),K&&V===me?Object.assign({},V):V)}}function ln(oe,V,$){return{type:"Feature",id:oe[V+wt],properties:Mn(oe,V,$),geometry:{type:"Point",coordinates:[360*(oe[V]-.5),function(K){return K=(180-360*K)*Math.PI/180,360*Math.atan(Math.exp(K))/Math.PI-90}(oe[V+1])]}}}function Mn(oe,V,He){var K=oe[V+Ge],me=1e4<=K?Math.round(K/1e3)+"k":1e3<=K?Math.round(K/100)/10+"k":K,Oe=oe[V+Gn],He=Oe===-1?{}:Object.assign({},He[Oe]);return Object.assign(He,{cluster:!0,cluster_id:oe[V+wt],point_count:K,point_count_abbreviated:me})}function Ot(oe){return oe/360+.5}function En(oe){return oe=Math.sin(oe*Math.PI/180),oe=.5-.25*Math.log((1+oe)/(1-oe))/Math.PI,oe<0?0:1<oe?1:oe}function lt(oe,V,$,K){for(var me,Oe=K,He=$-V>>1,Le=$-V,Ce=oe[V],De=oe[V+1],ot=oe[$],st=oe[$+1],St=V+3;St<$;St+=3){var un=function(en,yn,Kn,er,On,Dn){var fn=On-Kn,pn=Dn-er;{var Wn;fn==0&&pn==0||(1<(Wn=((en-Kn)*fn+(yn-er)*pn)/(fn*fn+pn*pn))?(Kn=On,er=Dn):0<Wn&&(Kn+=fn*Wn,er+=pn*Wn))}return(fn=en-Kn)*fn+(pn=yn-er)*pn}(oe[St],oe[St+1],Ce,De,ot,st);Oe<un?(me=St,Oe=un):un===Oe&&(un=Math.abs(St-He))<Le&&(me=St,Le=un)}K<Oe&&(3<me-V&&lt(oe,V,me,K),oe[me+2]=Oe,3<$-me)&&lt(oe,me,$,K)}function It(me,Le,$,K){var me={id:me===void 0?null:me,type:Le,geometry:$,tags:K,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0},Oe=me,He=Oe.geometry,Le=Oe.type;if(Le==="Point"||Le==="MultiPoint"||Le==="LineString")he(Oe,He);else if(Le==="Polygon"||Le==="MultiLineString")for(var Ce=0;Ce<He.length;Ce++)he(Oe,He[Ce]);else if(Le==="MultiPolygon")for(Ce=0;Ce<He.length;Ce++)for(var De=0;De<He[Ce].length;De++)he(Oe,He[Ce][De]);return me}function he(oe,V){for(var $=0;$<V.length;$+=3)oe.minX=Math.min(oe.minX,V[$]),oe.minY=Math.min(oe.minY,V[$+1]),oe.maxX=Math.max(oe.maxX,V[$]),oe.maxY=Math.max(oe.maxY,V[$+1])}function B(oe,V,$,K){if(V.geometry){var me=V.geometry.coordinates,Oe=V.geometry.type,He=Math.pow($.tolerance/((1<<$.maxZoom)*$.extent),2),Le=[],Ce=V.id;if($.promoteId?Ce=V.properties[$.promoteId]:$.generateId&&(Ce=K||0),Oe==="Point")H(me,Le);else if(Oe==="MultiPoint")for(var De=0;De<me.length;De++)H(me[De],Le);else if(Oe==="LineString")F(me,Le,He,!1);else if(Oe==="MultiLineString"){if($.lineMetrics){for(De=0;De<me.length;De++)F(me[De],Le=[],He,!1),oe.push(It(Ce,"LineString",Le,V.properties));return}Q(me,Le,He,!1)}else if(Oe==="Polygon")Q(me,Le,He,!0);else{if(Oe!=="MultiPolygon"){if(Oe!=="GeometryCollection")throw new Error("Input data is not a valid GeoJSON object.");for(De=0;De<V.geometry.geometries.length;De++)B(oe,{id:Ce,geometry:V.geometry.geometries[De],properties:V.properties},$,K);return}for(De=0;De<me.length;De++){var ot=[];Q(me[De],ot,He,!0),Le.push(ot)}}oe.push(It(Ce,Oe,Le,V.properties))}}function H(oe,V){V.push(ae(oe[0])),V.push(q(oe[1])),V.push(0)}function F(oe,V,$,K){for(var me,Oe,He=0,Le=0;Le<oe.length;Le++){var Ce=ae(oe[Le][0]),De=q(oe[Le][1]);V.push(Ce),V.push(De),V.push(0),0<Le&&(He+=K?(me*De-Ce*Oe)/2:Math.sqrt(Math.pow(Ce-me,2)+Math.pow(De-Oe,2))),me=Ce,Oe=De}var ot=V.length-3;V[2]=1,lt(V,0,ot,$),V[2+ot]=1,V.size=Math.abs(He),V.start=0,V.end=V.size}function Q(oe,V,$,K){for(var me=0;me<oe.length;me++){var Oe=[];F(oe[me],Oe,$,K),V.push(Oe)}}function ae(oe){return oe/360+.5}function q(oe){return oe=Math.sin(oe*Math.PI/180),oe=.5-.25*Math.log((1+oe)/(1-oe))/Math.PI,oe<0?0:1<oe?1:oe}function Ae(oe,V,$,K,me,Oe,He,Le){if(K/=V,($/=V)<=Oe&&He<K)return oe;if(He<$||K<=Oe)return null;for(var Ce=[],De=0;De<oe.length;De++){var ot=oe[De],st=ot.geometry,St=ot.type,un=me===0?ot.minX:ot.minY,en=me===0?ot.maxX:ot.maxY;if($<=un&&en<K)Ce.push(ot);else if(!(en<$||K<=un)){var yn=[];if(St==="Point"||St==="MultiPoint"){Wn=pn=fn=Dn=On=er=Kn=void 0;for(var Kn=st,er=yn,On=$,Dn=K,fn=me,pn=0;pn<Kn.length;pn+=3){var Wn=Kn[pn+fn];On<=Wn&&Wn<=Dn&&(er.push(Kn[pn]),er.push(Kn[pn+1]),er.push(Kn[pn+2]))}}else if(St==="LineString")Pe(st,yn,$,K,me,!1,Le.lineMetrics);else if(St==="MultiLineString")rt(st,yn,$,K,me,!1);else if(St==="Polygon")rt(st,yn,$,K,me,!0);else if(St==="MultiPolygon")for(var Nr=0;Nr<st.length;Nr++){var ni=[];rt(st[Nr],ni,$,K,me,!0),ni.length&&yn.push(ni)}if(yn.length)if(Le.lineMetrics&&St==="LineString")for(Nr=0;Nr<yn.length;Nr++)Ce.push(It(ot.id,St,yn[Nr],ot.tags));else St!=="LineString"&&St!=="MultiLineString"||(yn.length===1?(St="LineString",yn=yn[0]):St="MultiLineString"),St!=="Point"&&St!=="MultiPoint"||(St=yn.length===3?"Point":"MultiPoint"),Ce.push(It(ot.id,St,yn,ot.tags))}}return Ce.length?Ce:null}function Pe(oe,V,$,K,me,Oe,He){for(var Le,Ce,De=We(oe),ot=me===0?Bt:Lt,st=oe.start,St=0;St<oe.length-3;St+=3){var Dn=oe[St],fn=oe[St+1],pn=oe[St+2],un=oe[St+3],en=oe[St+4],yn=me===0?Dn:fn,Kn=me===0?un:en,er=!1;He&&(Le=Math.sqrt(Math.pow(Dn-un,2)+Math.pow(fn-en,2))),yn<$?$<Kn&&(Ce=ot(De,Dn,fn,un,en,$),He)&&(De.start=st+Le*Ce):K<yn?Kn<K&&(Ce=ot(De,Dn,fn,un,en,K),He)&&(De.start=st+Le*Ce):Et(De,Dn,fn,pn),Kn<$&&$<=yn&&(Ce=ot(De,Dn,fn,un,en,$),er=!0),K<Kn&&yn<=K&&(Ce=ot(De,Dn,fn,un,en,K),er=!0),!Oe&&er&&(He&&(De.end=st+Le*Ce),V.push(De),De=We(oe)),He&&(st+=Le)}var On=oe.length-3,Dn=oe[On],fn=oe[1+On],pn=oe[2+On];$<=(yn=me===0?Dn:fn)&&yn<=K&&Et(De,Dn,fn,pn),On=De.length-3,Oe&&3<=On&&(De[On]!==De[0]||De[1+On]!==De[1])&&Et(De,De[0],De[1],De[2]),De.length&&V.push(De)}function We(oe){var V=[];return V.size=oe.size,V.start=oe.start,V.end=oe.end,V}function rt(oe,V,$,K,me,Oe){for(var He=0;He<oe.length;He++)Pe(oe[He],V,$,K,me,Oe,!1)}function Et(oe,V,$,K){oe.push(V),oe.push($),oe.push(K)}function Bt(oe,V,$,K,me,Oe){return K=(Oe-V)/(K-V),oe.push(Oe),oe.push($+(me-$)*K),oe.push(1),K}function Lt(oe,V,$,K,me,Oe){return me=(Oe-$)/(me-$),oe.push(V+(K-V)*me),oe.push(Oe),oe.push(1),me}function an(oe,V){for(var $=[],K=0;K<oe.length;K++){var me=oe[K],Oe=me.type;if(Oe==="Point"||Oe==="MultiPoint"||Oe==="LineString")He=Ie(me.geometry,V);else if(Oe==="MultiLineString"||Oe==="Polygon")for(var He=[],Le=0;Le<me.geometry.length;Le++)He.push(Ie(me.geometry[Le],V));else if(Oe==="MultiPolygon")for(He=[],Le=0;Le<me.geometry.length;Le++){for(var Ce=[],De=0;De<me.geometry[Le].length;De++)Ce.push(Ie(me.geometry[Le][De],V));He.push(Ce)}$.push(It(me.id,Oe,He,me.tags))}return $}function Ie(oe,V){var $=[];$.size=oe.size,oe.start!==void 0&&($.start=oe.start,$.end=oe.end);for(var K=0;K<oe.length;K+=3)$.push(oe[K]+V,oe[K+1],oe[K+2]);return $}function Te(oe,V){if(!oe.transformed){for(var $,K=1<<oe.z,me=oe.x,Oe=oe.y,He=0;He<oe.features.length;He++){var Le=oe.features[He],Ce=Le.geometry,De=Le.type;if(Le.geometry=[],De===1)for($=0;$<Ce.length;$+=2)Le.geometry.push(At(Ce[$],Ce[$+1],V,K,me,Oe));else for($=0;$<Ce.length;$++){for(var ot=[],st=0;st<Ce[$].length;st+=2)ot.push(At(Ce[$][st],Ce[$][st+1],V,K,me,Oe));Le.geometry.push(ot)}}oe.transformed=!0}return oe}function At(oe,V,$,K,me,Oe){return[Math.round($*(oe*K-me)),Math.round($*(V*K-Oe))]}function xt(oe,V,$,K,me){for(var Oe=V===me.maxZoom?0:me.tolerance/((1<<V)*me.extent),He={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:$,y:K,z:V,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},Le=0;Le<oe.length;Le++){He.numFeatures++,On=er=Kn=yn=en=un=St=st=Dn=ot=De=Ce=void 0;var Ce=He,De=oe[Le],ot=Oe,Dn=me,st=De.geometry,St=De.type,un=[];if(St==="Point"||St==="MultiPoint")for(var en=0;en<st.length;en+=3)un.push(st[en]),un.push(st[en+1]),Ce.numPoints++,Ce.numSimplified++;else if(St==="LineString")qt(un,st,Ce,ot,!1,!1);else if(St==="MultiLineString"||St==="Polygon")for(en=0;en<st.length;en++)qt(un,st[en],Ce,ot,St==="Polygon",en===0);else if(St==="MultiPolygon")for(var yn=0;yn<st.length;yn++){var Kn=st[yn];for(en=0;en<Kn.length;en++)qt(un,Kn[en],Ce,ot,!0,en===0)}if(un.length){var er=De.tags||null;if(St==="LineString"&&Dn.lineMetrics){for(var On in er={},De.tags)er[On]=De.tags[On];er.mapbox_clip_start=st.start/st.size,er.mapbox_clip_end=st.end/st.size}Dn={geometry:un,type:St==="Polygon"||St==="MultiPolygon"?3:St==="LineString"||St==="MultiLineString"?2:1,tags:er},De.id!==null&&(Dn.id=De.id),Ce.features.push(Dn)}var Dn=oe[Le].minX,fn=oe[Le].minY,pn=oe[Le].maxX,Wn=oe[Le].maxY;Dn<He.minX&&(He.minX=Dn),fn<He.minY&&(He.minY=fn),He.maxX<pn&&(He.maxX=pn),He.maxY<Wn&&(He.maxY=Wn)}return He}function qt(oe,V,$,K,me,Oe){var He=K*K;if(0<K&&V.size<(me?He:K))$.numPoints+=V.length/3;else{for(var Le=[],Ce=0;Ce<V.length;Ce+=3)(K===0||V[Ce+2]>He)&&($.numSimplified++,Le.push(V[Ce]),Le.push(V[Ce+1])),$.numPoints++;if(me){for(var De=Le,me=Oe,ot=0,st=0,St=De.length,un=St-2;st<St;un=st,st+=2)ot+=(De[st]-De[un])*(De[st+1]+De[un+1]);if(0<ot===me)for(st=0,St=De.length;st<St/2;st+=2){var en=De[st],yn=De[st+1];De[st]=De[St-2-st],De[st+1]=De[St-1-st],De[St-2-st]=en,De[St-1-st]=yn}}oe.push(Le)}}function dn(oe,V){return new Ke(oe,V)}function Ke(Ce,V){var $=(V=this.options=function(De,ot){for(var st in ot)De[st]=ot[st];return De}(Object.create(this.options),V)).debug;if($&&console.time("preprocess data"),V.maxZoom<0||24<V.maxZoom)throw new Error("maxZoom should be in the 0-24 range");if(V.promoteId&&V.generateId)throw new Error("promoteId and generateId cannot be used together.");var K,me,Oe,He,Le,Ce=function(De,ot){var st=[];if(De.type==="FeatureCollection")for(var St=0;St<De.features.length;St++)B(st,De.features[St],ot,St);else De.type==="Feature"?B(st,De,ot):B(st,{geometry:De},ot);return st}(Ce,V);this.tiles={},this.tileCoords=[],$&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",V.indexMaxZoom,V.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),K=Ce,me=(V=V).buffer/V.extent,He=Ae(Oe=K,1,-1-me,me,0,-1,2,V),Le=Ae(K,1,1-me,2+me,0,-1,2,V),(Ce=Oe=(He||Le)&&(Oe=Ae(K,1,-me,1+me,0,-1,2,V)||[],He&&(Oe=an(He,1).concat(Oe)),Le)?Oe.concat(an(Le,-1)):Oe).length&&this.splitTile(Ce,0,0,0),$&&(Ce.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function gt(oe,V,$){return 32*((1<<oe)*$+V)+oe}function Tt(oe,V){return V?oe.properties[V]:oe.id}function Rn(oe,V){if(oe==null)return 1;if(oe.type==="Feature")return Tt(oe,V)!=null;if(oe.type==="FeatureCollection"){var $=new Set;for(const me of oe.features){var K=Tt(me,V);if(K==null||$.has(K))return;$.add(K)}return 1}}function Xn(oe,V){var $=new Map;if(oe!=null)if(oe.type==="Feature")$.set(Tt(oe,V),oe);else for(const K of oe.features)$.set(Tt(K,V),K);return $}function nn(oe,V,$){if(V.removeAll&&oe.clear(),V.remove)for(const Ce of V.remove)oe.delete(Ce);if(V.add)for(const Ce of V.add){var K=Tt(Ce,$);K!=null&&oe.set(K,Ce)}if(V.update)for(const Ce of V.update){let De=oe.get(Ce.id);if(De!=null){var me=Ce.newGeometry||Ce.removeAllProperties,Oe=!Ce.removeAllProperties&&(0<((Oe=Ce.removeProperties)==null?void 0:Oe.length)||0<((Oe=Ce.addOrUpdateProperties)==null?void 0:Oe.length));if((me||Oe)&&(De=Object.assign({},De),oe.set(Ce.id,De),Oe)&&(De.properties=Object.assign({},De.properties)),Ce.newGeometry&&(De.geometry=Ce.newGeometry),Ce.removeAllProperties)De.properties={};else if(0<((me=Ce.removeProperties)==null?void 0:me.length))for(const ot of Ce.removeProperties)Object.prototype.hasOwnProperty.call(De.properties,ot)&&delete De.properties[ot];if(0<((me=Ce.addOrUpdateProperties)==null?void 0:me.length))for(var{key:He,value:Le}of Ce.addOrUpdateProperties)De.properties[He]=Le}}}Ke.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Ke.prototype.splitTile=function(oe,V,$,K,me,Oe,He){for(var Le=[oe,V,$,K],Ce=this.options,De=Ce.debug;Le.length;){K=Le.pop(),$=Le.pop(),V=Le.pop(),oe=Le.pop();var ot,st,St,un,en,yn,Kn,er,On,Dn=1<<V,fn=gt(V,$,K),pn=this.tiles[fn];if(pn||(1<De&&console.time("creation"),pn=this.tiles[fn]=xt(oe,V,$,K,Ce),this.tileCoords.push({z:V,x:$,y:K}),De&&(1<De&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",V,$,K,pn.numFeatures,pn.numPoints,pn.numSimplified),console.timeEnd("creation")),this.stats[fn="z"+V]=(this.stats[fn]||0)+1,this.total++)),pn.source=oe,me){if(V===Ce.maxZoom||V===me)continue;var fn=1<<me-V;if($!==Math.floor(Oe/fn)||K!==Math.floor(He/fn))continue}else if(V===Ce.indexMaxZoom||pn.numPoints<=Ce.indexMaxPoints)continue;pn.source=null,oe.length!==0&&(1<De&&console.time("clipping"),ot=.5-(fn=.5*Ce.buffer/Ce.extent),St=1+fn,Kn=un=en=yn=null,er=Ae(oe,Dn,$-fn,$+(st=.5+fn),0,pn.minX,pn.maxX,Ce),On=Ae(oe,Dn,$+ot,$+St,0,pn.minX,pn.maxX,Ce),oe=null,er&&(Kn=Ae(er,Dn,K-fn,K+st,1,pn.minY,pn.maxY,Ce),un=Ae(er,Dn,K+ot,K+St,1,pn.minY,pn.maxY,Ce),er=null),On&&(en=Ae(On,Dn,K-fn,K+st,1,pn.minY,pn.maxY,Ce),yn=Ae(On,Dn,K+ot,K+St,1,pn.minY,pn.maxY,Ce),On=null),1<De&&console.timeEnd("clipping"),Le.push(Kn||[],V+1,2*$,2*K),Le.push(un||[],V+1,2*$,2*K+1),Le.push(en||[],V+1,2*$+1,2*K),Le.push(yn||[],V+1,2*$+1,2*K+1))}},Ke.prototype.getTile=function(oe,V,$){var me=this.options,K=me.extent,me=me.debug;if(oe<0||24<oe)return null;var Oe=1<<oe,Oe=gt(oe,V=(V%Oe+Oe)%Oe,$);if(this.tiles[Oe])return Te(this.tiles[Oe],K);1<me&&console.log("drilling down to z%d-%d-%d",oe,V,$);for(var He,Le=oe,Ce=V,De=$;!He&&0<Le;)Le--,Ce=Math.floor(Ce/2),De=Math.floor(De/2),He=this.tiles[gt(Le,Ce,De)];return He&&He.source&&(1<me&&console.log("found parent tile z%d-%d-%d",Le,Ce,De),1<me&&console.time("drilling down"),this.splitTile(He.source,Le,Ce,De,oe,V,$),1<me&&console.timeEnd("drilling down"),this.tiles[Oe])?Te(this.tiles[Oe],K):null};class Lr extends p{constructor(){super(...arguments),this._dataUpdateable=new Map}loadVectorTile(V,$){return i.__awaiter(this,void 0,void 0,function*(){var K=V.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");if(K=this._geoJSONIndex.getTile(K.z,K.x,K.y),!K)return null;K=new D(K.features);let me=ht(K);return{vectorTile:K,rawData:(me=me.byteOffset===0&&me.byteLength===me.buffer.byteLength?me:new Uint8Array(me)).buffer}})}loadData(V){return i.__awaiter(this,void 0,void 0,function*(){($=this._pendingRequest)!=null&&$.abort();var $=!!(V&&V.request&&V.request.collectResourceTiming)&&new i.RequestPerformance(V.request);this._pendingRequest=new AbortController;try{let He=yield this.loadGeoJSON(V,this._pendingRequest);if(delete this._pendingRequest,typeof He!="object")throw new Error(`Input data given to '${V.source}' is not a valid GeoJSON object.`);if(C(He,!0),V.filter){const Le=i.createExpression(V.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Le.result==="error")throw new Error(Le.value.map(Ce=>Ce.key+": "+Ce.message).join(", "));var K=He.features.filter(Ce=>Le.value.evaluate({zoom:0},Ce));He={type:"FeatureCollection",features:K}}this._geoJSONIndex=V.cluster?new Xt(Qr(V)).load(He.features):dn(He,V.geojsonVtOptions),this.loaded={};var me,Oe={};return $&&(me=$.finish())&&(Oe.resourceTiming={},Oe.resourceTiming[V.source]=JSON.parse(JSON.stringify(me))),Oe}catch(He){if(delete this._pendingRequest,i.isAbortError(He))return{abandoned:!0};throw He}})}reloadTile(V){var $=this.loaded,K=V.uid;return $&&$[K]?super.reloadTile(V):this.loadTile(V)}loadGeoJSON(V,$){return i.__awaiter(this,void 0,void 0,function*(){var K,me=V.promoteId;if(V.request)return K=yield i.getJSON(V.request,$),this._dataUpdateable=Rn(K.data,me)?Xn(K.data,me):void 0,K.data;if(typeof V.data=="string")try{var Oe=JSON.parse(V.data);return this._dataUpdateable=Rn(Oe,me)?Xn(Oe,me):void 0,Oe}catch{throw new Error(`Input data given to '${V.source}' is not a valid GeoJSON object.`)}if(!V.dataDiff)throw new Error(`Input data given to '${V.source}' is not a valid GeoJSON object.`);if(this._dataUpdateable)return nn(this._dataUpdateable,V.dataDiff,me),{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())};throw new Error("Cannot update existing geojson data in "+V.source)})}removeSource(V){return i.__awaiter(this,void 0,void 0,function*(){this._pendingRequest&&this._pendingRequest.abort()})}getClusterExpansionZoom(V){return this._geoJSONIndex.getClusterExpansionZoom(V.clusterId)}getClusterChildren(V){return this._geoJSONIndex.getChildren(V.clusterId)}getClusterLeaves(V){return this._geoJSONIndex.getLeaves(V.clusterId,V.limit,V.offset)}}function Qr({superclusterOptions:oe,clusterProperties:V}){if(V&&oe){const me={},Oe={},He={accumulated:null,zoom:0},Le={properties:null},Ce=Object.keys(V);for(const De of Ce){var[K,$]=V[De],$=i.createExpression($),K=i.createExpression(typeof K=="string"?[K,["accumulated"],["get",De]]:K);me[De]=$.value,Oe[De]=K.value}oe.map=De=>{Le.properties=De;var ot={};for(const st of Ce)ot[st]=me[st].evaluate(He,Le);return ot},oe.reduce=(De,ot)=>{Le.properties=ot;for(const st of Ce)He.accumulated=De[st],De[st]=Oe[st].evaluate(He,Le)}}return oe}class Tr{constructor(V){this.self=V,this.actor=new i.Actor(V),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.self.registerWorkerSource=($,K)=>{if(this.externalWorkerSourceTypes[$])throw new Error(`Worker source with name "${$}" already registered.`);this.externalWorkerSourceTypes[$]=K},this.self.addProtocol=i.addProtocol,this.self.removeProtocol=i.removeProtocol,this.self.registerRTLTextPlugin=$=>{if(i.rtlWorkerPlugin.isParsed())throw new Error("RTL text plugin already registered.");i.rtlWorkerPlugin.setMethods($)},this.actor.registerMessageHandler("LDT",($,K)=>this._getDEMWorkerSource($,K.source).loadTile(K)),this.actor.registerMessageHandler("RDT",($,K)=>i.__awaiter(this,void 0,void 0,function*(){this._getDEMWorkerSource($,K.source).removeTile(K)})),this.actor.registerMessageHandler("GCEZ",($,K)=>i.__awaiter(this,void 0,void 0,function*(){return this._getWorkerSource($,K.type,K.source).getClusterExpansionZoom(K)})),this.actor.registerMessageHandler("GCC",($,K)=>i.__awaiter(this,void 0,void 0,function*(){return this._getWorkerSource($,K.type,K.source).getClusterChildren(K)})),this.actor.registerMessageHandler("GCL",($,K)=>i.__awaiter(this,void 0,void 0,function*(){return this._getWorkerSource($,K.type,K.source).getClusterLeaves(K)})),this.actor.registerMessageHandler("LD",($,K)=>this._getWorkerSource($,K.type,K.source).loadData(K)),this.actor.registerMessageHandler("LT",($,K)=>this._getWorkerSource($,K.type,K.source).loadTile(K)),this.actor.registerMessageHandler("RT",($,K)=>this._getWorkerSource($,K.type,K.source).reloadTile(K)),this.actor.registerMessageHandler("AT",($,K)=>this._getWorkerSource($,K.type,K.source).abortTile(K)),this.actor.registerMessageHandler("RMT",($,K)=>this._getWorkerSource($,K.type,K.source).removeTile(K)),this.actor.registerMessageHandler("RS",($,K)=>i.__awaiter(this,void 0,void 0,function*(){var me;this.workerSources[$]&&this.workerSources[$][K.type]&&this.workerSources[$][K.type][K.source]&&(me=this.workerSources[$][K.type][K.source],delete this.workerSources[$][K.type][K.source],me.removeSource!==void 0)&&me.removeSource(K)})),this.actor.registerMessageHandler("RM",$=>i.__awaiter(this,void 0,void 0,function*(){delete this.layerIndexes[$],delete this.availableImages[$],delete this.workerSources[$],delete this.demWorkerSources[$]})),this.actor.registerMessageHandler("SR",($,K)=>i.__awaiter(this,void 0,void 0,function*(){this.referrer=K})),this.actor.registerMessageHandler("SRPS",($,K)=>this._syncRTLPluginState($,K)),this.actor.registerMessageHandler("IS",($,K)=>i.__awaiter(this,void 0,void 0,function*(){this.self.importScripts(K)})),this.actor.registerMessageHandler("SI",($,K)=>this._setImages($,K)),this.actor.registerMessageHandler("UL",($,K)=>i.__awaiter(this,void 0,void 0,function*(){this._getLayerIndex($).update(K.layers,K.removedIds)})),this.actor.registerMessageHandler("SL",($,K)=>i.__awaiter(this,void 0,void 0,function*(){this._getLayerIndex($).replace(K)}))}_setImages(V,$){return i.__awaiter(this,void 0,void 0,function*(){this.availableImages[V]=$;for(const me in this.workerSources[V]){var K=this.workerSources[V][me];for(const Oe in K)K[Oe].availableImages=$}})}_syncRTLPluginState(V,$){return i.__awaiter(this,void 0,void 0,function*(){if(i.rtlWorkerPlugin.isParsed())return i.rtlWorkerPlugin.getState();if($.pluginStatus!=="loading")return i.rtlWorkerPlugin.setState($),$;var K=$.pluginURL,me=(this.self.importScripts(K),i.rtlWorkerPlugin.isParsed());if(me)return i.rtlWorkerPlugin.setState(me={pluginStatus:"loaded",pluginURL:K}),me;throw i.rtlWorkerPlugin.setState({pluginStatus:"error",pluginURL:""}),new Error("RTL Text Plugin failed to import scripts from "+K)})}_getAvailableImages(V){let $=this.availableImages[V];return $=$||[]}_getLayerIndex(V){let $=this.layerIndexes[V];return $=$||(this.layerIndexes[V]=new o)}_getWorkerSource(V,$,K){if(this.workerSources[V]||(this.workerSources[V]={}),this.workerSources[V][$]||(this.workerSources[V][$]={}),!this.workerSources[V][$][K]){var me={sendAsync:(Oe,He)=>(Oe.targetMapId=V,this.actor.sendAsync(Oe,He))};switch($){case"vector":this.workerSources[V][$][K]=new p(me,this._getLayerIndex(V),this._getAvailableImages(V));break;case"geojson":this.workerSources[V][$][K]=new Lr(me,this._getLayerIndex(V),this._getAvailableImages(V));break;default:this.workerSources[V][$][K]=new this.externalWorkerSourceTypes[$](me,this._getLayerIndex(V),this._getAvailableImages(V))}}return this.workerSources[V][$][K]}_getDEMWorkerSource(V,$){return this.demWorkerSources[V]||(this.demWorkerSources[V]={}),this.demWorkerSources[V][$]||(this.demWorkerSources[V][$]=new g),this.demWorkerSources[V][$]}}return i.isWorker(self)&&(self.worker=new Tr(self)),Tr}),r("index",0,function(i,o){var a,l="4.1.2",ir=typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date);let h,p;const g={now:ir,frameAsync(w){return new Promise((s,f)=>{const y=requestAnimationFrame(s);w.signal.addEventListener("abort",()=>{cancelAnimationFrame(y),f(o.createAbortError())})})},getImageData(w,s=0){return this.getImageCanvasContext(w).getImageData(-s,-s,w.width+2*s,w.height+2*s)},getImageCanvasContext(w){var s=window.document.createElement("canvas"),f=s.getContext("2d",{willReadFrequently:!0});if(f)return s.width=w.width,s.height=w.height,f.drawImage(w,0,0,w.width,w.height),f;throw new Error("failed to create canvas 2d context")},resolveURL(w){return(h=h||document.createElement("a")).href=w,h.href},hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(p=p??matchMedia("(prefers-reduced-motion: reduce)")).matches}};class _{static testProp(s){if(_.docStyle){for(let f=0;f<s.length;f++)if(s[f]in _.docStyle)return s[f]}return s[0]}static create(s,f,y){return s=window.document.createElement(s),f!==void 0&&(s.className=f),y&&y.appendChild(s),s}static createNS(s,f){return window.document.createElementNS(s,f)}static disableDrag(){_.docStyle&&_.selectProp&&(_.userSelect=_.docStyle[_.selectProp],_.docStyle[_.selectProp]="none")}static enableDrag(){_.docStyle&&_.selectProp&&(_.docStyle[_.selectProp]=_.userSelect)}static setTransform(s,f){s.style[_.transformProp]=f}static addEventListener(s,f,y,v={}){"passive"in v?s.addEventListener(f,y,v):s.addEventListener(f,y,v.capture)}static removeEventListener(s,f,y,v={}){"passive"in v?s.removeEventListener(f,y,v):s.removeEventListener(f,y,v.capture)}static suppressClickInternal(s){s.preventDefault(),s.stopPropagation(),window.removeEventListener("click",_.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",_.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",_.suppressClickInternal,!0)},0)}static getScale(s){var f=s.getBoundingClientRect();return{x:f.width/s.offsetWidth||1,y:f.height/s.offsetHeight||1,boundingClientRect:f}}static getPoint(s,f,y){var v=f.boundingClientRect;return new o.Point((y.clientX-v.left)/f.x-s.clientLeft,(y.clientY-v.top)/f.y-s.clientTop)}static mousePos(s,f){var y=_.getScale(s);return _.getPoint(s,y,f)}static touchPos(s,f){var y=[],v=_.getScale(s);for(let T=0;T<f.length;T++)y.push(_.getPoint(s,v,f[T]));return y}static mouseButton(s){return s.button}static remove(s){s.parentNode&&s.parentNode.removeChild(s)}}_.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,_.selectProp=_.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),_.transformProp=_.testProp(["transform","WebkitTransform"]);const x={supported:!1,testSupport:function(w){!M&&L&&(D?z(w):C=w)}};let C,M=!1,L,D=!1;function z(w){var s=w.createTexture();w.bindTexture(w.TEXTURE_2D,s);try{if(w.texImage2D(w.TEXTURE_2D,0,w.RGBA,w.RGBA,w.UNSIGNED_BYTE,L),w.isContextLost())return;x.supported=!0}catch{}w.deleteTexture(s),M=!0}typeof document<"u"&&((L=document.createElement("img")).onload=function(){C&&z(C),C=null,D=!0},L.onerror=function(){M=!0,C=null},L.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(w){let s,f,y,v;w.resetRequestQueue=()=>{s=[],f=0,y=0,v={}},w.addThrottleControl=G=>{var Z=y++;return v[Z]=G,Z},w.removeThrottleControl=G=>{delete v[G],R()},w.getImage=(G,Z,j=!0)=>new Promise((X,ge)=>{x.supported&&(G.headers||(G.headers={}),G.headers.accept="image/webp,*/*"),o.extend(G,{type:"image"});var ye={abortController:Z,requestParameters:G,supportImageRefresh:j,state:"queued",onError:be=>{ge(be)},onSuccess:be=>{X(be)}};s.push(ye),R()});const T=G=>typeof createImageBitmap=="function"?o.arrayBufferToImageBitmap(G):o.arrayBufferToImage(G),P=G=>o.__awaiter(this,void 0,void 0,function*(){G.state="running";var{requestParameters:Z,supportImageRefresh:ye,onError:j,onSuccess:X,abortController:ge}=G,ye=ye===!1&&!o.isWorker(self)&&!o.getProtocol(Z.url)&&(!Z.headers||Object.keys(Z.headers).reduce((ve,Fe)=>ve&&Fe==="accept",!0)),ye=(f++,ye?N(Z,ge):o.makeRequest(Z,ge));try{var be=yield ye;delete G.abortController,G.state="completed",be.data instanceof HTMLImageElement||o.isImageBitmap(be.data)?X(be):be.data&&X({data:yield T(be.data),cacheControl:be.cacheControl,expires:be.expires})}catch(ve){delete G.abortController,j(ve)}finally{f--,R()}}),R=()=>{var G=(()=>{for(const j of Object.keys(v))if(v[j]())return!0;return!1})()?o.config.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:o.config.MAX_PARALLEL_IMAGE_REQUESTS;for(let j=f;j<G&&0<s.length;j++){var Z=s.shift();Z.abortController.signal.aborted?j--:P(Z)}},N=(G,Z)=>new Promise((j,X)=>{const ge=new Image;var ye=G.url,be=G.credentials;be&&be==="include"?ge.crossOrigin="use-credentials":(be&&be==="same-origin"||!o.sameOrigin(ye))&&(ge.crossOrigin="anonymous"),Z.signal.addEventListener("abort",()=>{ge.src="",X(o.createAbortError())}),ge.fetchPriority="high",ge.onload=()=>{ge.onerror=ge.onload=null,j({data:ge})},ge.onerror=()=>{ge.onerror=ge.onload=null,Z.signal.aborted||X(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},ge.src=ye})}(a=a||{}),a.resetRequestQueue();class te{constructor(s){this._transformRequestFn=s}transformRequest(s,f){return this._transformRequestFn&&this._transformRequestFn(s,f)||{url:s}}normalizeSpriteURL(s,f,y){return s=ce(s),s.path+=""+f+y,_e(s)}setTransformRequest(s){this._transformRequestFn=s}}const le=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function ce(w){var s=w.match(le);if(s)return{protocol:s[1],authority:s[2],path:s[3]||"/",params:s[4]?s[4].split("&"):[]};throw new Error(`Unable to parse URL "${w}"`)}function _e(w){var s=w.params.length?"?"+w.params.join("&"):"";return w.protocol+"://"+w.authority+w.path+s}function J(w){var s=[];if(typeof w=="string")s.push({id:"default",url:w});else if(w&&0<w.length){var f,y,v=[];for({id:f,url:y}of w){var T=""+f+y;v.indexOf(T)===-1&&(v.push(T),s.push({id:f,url:y}))}}return s}function pe(w,s,f,y){return o.__awaiter(this,void 0,void 0,function*(){var v,T,P=J(w),R=1<f?"@2x":"",N={},G={};for({id:v,url:T}of P){var Z=s.transformRequest(s.normalizeSpriteURL(T,R,".json"),"SpriteJSON"),Z=(N[v]=o.getJSON(Z,y),s.transformRequest(s.normalizeSpriteURL(T,R,".png"),"SpriteImage"));G[v]=a.getImage(Z,y)}return yield Promise.all([...Object.values(N),...Object.values(G)]),function(j,X){return o.__awaiter(this,void 0,void 0,function*(){var ge={};for(const Dt in j){ge[Dt]={};var ye=g.getImageCanvasContext((yield X[Dt]).data),be=(yield j[Dt]).data;for(const Yt in be){var{width:ve,height:Fe,x:Ue,y:ze,sdf:Qe,pixelRatio:Je,stretchX:Xe,stretchY:ct,content:it,contentMatch:_t}=be[Yt];ge[Dt][Yt]={data:null,pixelRatio:Je,sdf:Qe,stretchX:Xe,stretchY:ct,content:it,spriteData:{width:ve,height:Fe,x:Ue,y:ze,context:ye},contentMatch:_t}}}return ge})}(N,G)})}class ue{constructor(s,f,y,v){this.context=s,this.format=y,this.texture=s.gl.createTexture(),this.update(f,v)}update(s,f,y){var{width:v,height:T}=s,P=!(this.size&&this.size[0]===v&&this.size[1]===T||y),R=this.context,N=R.gl;this.useMipmap=!!(f&&f.useMipmap),N.bindTexture(N.TEXTURE_2D,this.texture),R.pixelStoreUnpackFlipY.set(!1),R.pixelStoreUnpack.set(1),R.pixelStoreUnpackPremultiplyAlpha.set(this.format===N.RGBA&&(!f||f.premultiply!==!1)),P?(this.size=[v,T],s instanceof HTMLImageElement||s instanceof HTMLCanvasElement||s instanceof HTMLVideoElement||s instanceof ImageData||o.isImageBitmap(s)?N.texImage2D(N.TEXTURE_2D,0,this.format,this.format,N.UNSIGNED_BYTE,s):N.texImage2D(N.TEXTURE_2D,0,this.format,v,T,0,this.format,N.UNSIGNED_BYTE,s.data)):({x:R,y:f}=y||{x:0,y:0},s instanceof HTMLImageElement||s instanceof HTMLCanvasElement||s instanceof HTMLVideoElement||s instanceof ImageData||o.isImageBitmap(s)?N.texSubImage2D(N.TEXTURE_2D,0,R,f,N.RGBA,N.UNSIGNED_BYTE,s):N.texSubImage2D(N.TEXTURE_2D,0,R,f,v,T,N.RGBA,N.UNSIGNED_BYTE,s.data)),this.useMipmap&&this.isSizePowerOfTwo()&&N.generateMipmap(N.TEXTURE_2D)}bind(s,f,y){var v=this.context,v=v.gl;v.bindTexture(v.TEXTURE_2D,this.texture),y!==v.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(y=v.LINEAR),s!==this.filter&&(v.texParameteri(v.TEXTURE_2D,v.TEXTURE_MAG_FILTER,s),v.texParameteri(v.TEXTURE_2D,v.TEXTURE_MIN_FILTER,y||s),this.filter=s),f!==this.wrap&&(v.texParameteri(v.TEXTURE_2D,v.TEXTURE_WRAP_S,f),v.texParameteri(v.TEXTURE_2D,v.TEXTURE_WRAP_T,f),this.wrap=f)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){var s=this.context.gl;s.deleteTexture(this.texture),this.texture=null}}class xe extends o.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new o.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(s){if(this.loaded!==s&&(this.loaded=s)){for(var{ids:f,promiseResolve:y}of this.requestors)y(this._getImagesForIds(f));this.requestors=[]}}getImage(y){var f,y=this.images[y];return y&&!y.data&&y.spriteData&&(f=y.spriteData,y.data=new o.RGBAImage({width:f.width,height:f.height},f.context.getImageData(f.x,f.y,f.width,f.height).data),y.spriteData=null),y}addImage(s,f){if(this.images[s])throw new Error(`Image id ${s} already exist, use updateImage instead`);this._validate(s,f)&&(this.images[s]=f)}_validate(s,f){let y=!0;var v=f.data||f.spriteData;return this._validateStretch(f.stretchX,v&&v.width)||(this.fire(new o.ErrorEvent(new Error(`Image "${s}" has invalid "stretchX" value`))),y=!1),this._validateStretch(f.stretchY,v&&v.height)||(this.fire(new o.ErrorEvent(new Error(`Image "${s}" has invalid "stretchY" value`))),y=!1),this._validateContent(f.content,f)||(this.fire(new o.ErrorEvent(new Error(`Image "${s}" has invalid "content" value`))),y=!1),y}_validateStretch(s,f){if(s){let y=0;for(const v of s){if(v[0]<y||v[1]<v[0]||f<v[1])return!1;y=v[1]}}return!0}_validateContent(s,f){var y,v;return!s||s.length===4&&(y=(v=f.spriteData)&&v.width||f.data.width,v=v&&v.height||f.data.height,!(s[0]<0||y<s[0]||s[1]<0||v<s[1]||s[2]<0||y<s[2]||s[3]<0||v<s[3]||s[2]<s[0]||s[3]<s[1]))}updateImage(s,f,y=!0){var v=this.getImage(s);if(y&&(v.data.width!==f.data.width||v.data.height!==f.data.height))throw new Error(`size mismatch between old image (${v.data.width}x${v.data.height}) and new image (${f.data.width}x${f.data.height}).`);f.version=v.version+1,this.images[s]=f,this.updatedImages[s]=!0}removeImage(s){var f=this.images[s];delete this.images[s],delete this.patterns[s],f.userImage&&f.userImage.onRemove&&f.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(s){return new Promise((f,y)=>{let v=!0;if(!this.isLoaded())for(const T of s)this.images[T]||(v=!1);this.isLoaded()||v?f(this._getImagesForIds(s)):this.requestors.push({ids:s,promiseResolve:f})})}_getImagesForIds(s){var f={};for(const y of s){let v=this.getImage(y);v||(this.fire(new o.Event("styleimagemissing",{id:y})),v=this.getImage(y)),v?f[y]={data:v.data.clone(),pixelRatio:v.pixelRatio,sdf:v.sdf,version:v.version,stretchX:v.stretchX,stretchY:v.stretchY,content:v.content,contentMatch:v.contentMatch,hasRenderCallback:!!(v.userImage&&v.userImage.render)}:o.warnOnce(`Image "${y}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return f}getPixelSize(){var{width:s,height:f}=this.atlasImage;return{width:s,height:f}}getPattern(s){var f=this.patterns[s],y=this.getImage(s);return y?(f&&f.position.version===y.version?f:(f?f.position.version=y.version:(f={w:y.data.width+2,h:y.data.height+2,x:0,y:0},y=new o.ImagePosition(f,y),this.patterns[s]={bin:f,position:y}),this._updatePatternAtlas(),this.patterns[s])).position:null}bind(s){var f=s.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new ue(s,this.atlasImage,f.RGBA),this.atlasTexture.bind(f.LINEAR,f.CLAMP_TO_EDGE)}_updatePatternAtlas(){var s=[];for(const N in this.patterns)s.push(this.patterns[N].bin);const{w:f,h:y}=o.potpack(s);var v=this.atlasImage;v.resize({width:f||1,height:y||1});for(const N in this.patterns){var P=this.patterns[N].bin,T=P.x+1,P=P.y+1,R=this.getImage(N).data;const G=R.width,Z=R.height;o.RGBAImage.copy(R,v,{x:0,y:0},{x:T,y:P},{width:G,height:Z}),o.RGBAImage.copy(R,v,{x:0,y:Z-1},{x:T,y:P-1},{width:G,height:1}),o.RGBAImage.copy(R,v,{x:0,y:0},{x:T,y:P+Z},{width:G,height:1}),o.RGBAImage.copy(R,v,{x:G-1,y:0},{x:T-1,y:P},{width:1,height:Z}),o.RGBAImage.copy(R,v,{x:0,y:0},{x:T+G,y:P},{width:1,height:Z})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(s){for(const y of s){var f;this.callbackDispatchedThisFrame[y]||(this.callbackDispatchedThisFrame[y]=!0,(f=this.getImage(y))||o.warnOnce(`Image with ID: "${y}" was not found`),o.renderStyleImage(f)&&this.updateImage(y,f))}}}const je=1e20;function ne(w,s,f,y,v,T,P,R,N){for(let G=s;G<s+y;G++)Ee(w,f*T+G,T,v,P,R,N);for(let G=f;G<f+v;G++)Ee(w,G*T+s,1,y,P,R,N)}function Ee(w,s,f,y,v,T,P){P[T[0]=0]=-je,P[1]=je,v[0]=w[s];for(let j=1,X=0,ge=0;j<y;j++){v[j]=w[s+j*f];var R=j*j;do{var N=T[X];ge=(v[j]-v[N]+R-N*N)/(j-N)/2}while(ge<=P[X]&&-1<--X);T[++X]=j,P[X]=ge,P[X+1]=je}for(let j=0,X=0;j<y;j++){for(;P[X+1]<j;)X++;var G=T[X],Z=j-G;w[s+j*f]=v[G]+Z*Z}}class ke{constructor(s,f){this.requestManager=s,this.localIdeographFontFamily=f,this.entries={}}setURL(s){this.url=s}getGlyphs(s){return o.__awaiter(this,void 0,void 0,function*(){var f=[];for(const R in s)for(const N of s[R])f.push(this._getAndCacheGlyphsPromise(R,N));var y,v,T,P={};for({stack:y,id:v,glyph:T}of yield Promise.all(f))P[y]||(P[y]={}),P[y][v]=T&&{id:T.id,bitmap:T.bitmap.clone(),metrics:T.metrics};return P})}_getAndCacheGlyphsPromise(s,f){return o.__awaiter(this,void 0,void 0,function*(){let y=this.entries[s];var v=(y=y||(this.entries[s]={glyphs:{},requests:{},ranges:{}})).glyphs[f];if(v!==void 0)return{stack:s,id:f,glyph:v};if(v=this._tinySDF(y,s,f))return y.glyphs[f]=v,{stack:s,id:f,glyph:v};var T=Math.floor(f/256);if(65535<256*T)throw new Error("glyphs > 65535 not supported");if(y.ranges[T])return{stack:s,id:f,glyph:v};if(!this.url)throw new Error("glyphsUrl is not set");y.requests[T]||(v=ke.loadGlyphRange(s,T,this.url,this.requestManager),y.requests[T]=v);var P=yield y.requests[T];for(const R in P)this._doesCharSupportLocalGlyph(+R)||(y.glyphs[+R]=P[+R]);return y.ranges[T]=!0,{stack:s,id:f,glyph:P[f]||null}})}_doesCharSupportLocalGlyph(s){return!!this.localIdeographFontFamily&&(o.unicodeBlockLookup["CJK Unified Ideographs"](s)||o.unicodeBlockLookup["Hangul Syllables"](s)||o.unicodeBlockLookup.Hiragana(s)||o.unicodeBlockLookup.Katakana(s))}_tinySDF(s,f,y){var v=this.localIdeographFontFamily;if(v&&this._doesCharSupportLocalGlyph(y)){let T=s.tinySDF;if(!T){let P="400";/bold/i.test(f)?P="900":/medium/i.test(f)?P="500":/light/i.test(f)&&(P="200"),T=s.tinySDF=new ke.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:v,fontWeight:P})}return f=T.draw(String.fromCharCode(y)),{id:y,bitmap:new o.AlphaImage({width:f.width||60,height:f.height||60},f.data),metrics:{width:f.glyphWidth/2||24,height:f.glyphHeight/2||24,left:f.glyphLeft/2+.5||0,top:f.glyphTop/2-27.5||-8,advance:f.glyphAdvance/2||24,isDoubleResolution:!0}}}}}ke.loadGlyphRange=function(w,s,f,y){return o.__awaiter(this,void 0,void 0,function*(){var v=256*s,T=255+v,P=y.transformRequest(f.replace("{fontstack}",w).replace("{range}",v+"-"+T),"Glyphs"),P=yield o.getArrayBuffer(P,new AbortController);if(!P||!P.data)throw new Error(`Could not load glyph range. range: ${s}, ${v}-`+T);var R={};for(const N of o.parseGlyphPbf(P.data))R[N.id]=N;return R})},ke.TinySDF=class{constructor({fontSize:w=24,buffer:s=3,radius:f=8,cutoff:y=.25,fontFamily:v="sans-serif",fontWeight:T="normal",fontStyle:P="normal"}={}){this.buffer=s,this.cutoff=y,this.radius=f,y=this.size=w+4*s,f=this._createCanvas(y),s=this.ctx=f.getContext("2d",{willReadFrequently:!0}),s.font=P+` ${T} ${w}px `+v,s.textBaseline="alphabetic",s.textAlign="left",s.fillStyle="black",this.gridOuter=new Float64Array(y*y),this.gridInner=new Float64Array(y*y),this.f=new Float64Array(y),this.z=new Float64Array(y+1),this.v=new Uint16Array(y)}_createCanvas(w){var s=document.createElement("canvas");return s.width=s.height=w,s}draw(w){var{width:s,actualBoundingBoxAscent:y,actualBoundingBoxDescent:f,actualBoundingBoxLeft:Z,actualBoundingBoxRight:R}=this.ctx.measureText(w),y=Math.ceil(y),v=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(R-Z))),T=Math.min(this.size-this.buffer,y+Math.ceil(f)),P=v+2*this.buffer,R=T+2*this.buffer,N=Math.max(P*R,0),G=new Uint8ClampedArray(N),Z={data:G,width:P,height:R,glyphWidth:v,glyphHeight:T,glyphTop:y,glyphLeft:0,glyphAdvance:s};if(v!==0&&T!==0){var{ctx:f,buffer:j,gridInner:X,gridOuter:ge}=this,ye=(f.clearRect(j,j,v,T),f.fillText(w,j,j+y),f.getImageData(j,j,v,T));ge.fill(je,0,N),X.fill(0,0,N);for(let ze=0;ze<T;ze++)for(let Qe=0;Qe<v;Qe++){var be,ve=ye.data[4*(ze*v+Qe)+3]/255;ve!=0&&(be=(ze+j)*P+Qe+j,ve==1?(ge[be]=0,X[be]=je):(ge[be]=0<(ve=.5-ve)?ve*ve:0,X[be]=ve<0?ve*ve:0))}ne(ge,0,0,P,R,P,this.f,this.v,this.z),ne(X,j,j,v,T,P,this.f,this.v,this.z);for(let ze=0;ze<N;ze++){var Fe=Math.sqrt(ge[ze])-Math.sqrt(X[ze]);G[ze]=Math.round(255-255*(Fe/this.radius+this.cutoff))}}return Z}};class Be{constructor(){this.specification=o.v8Spec.light.position}possiblyEvaluate(s,f){return o.sphericalToCartesian(s.expression.evaluate(f))}interpolate(s,f,y){return{x:o.interpolate.number(s.x,f.x,y),y:o.interpolate.number(s.y,f.y,y),z:o.interpolate.number(s.z,f.z,y)}}}const Ze="-transition";let at;class Re extends o.Evented{constructor(s){super(),at=at||new o.Properties({anchor:new o.DataConstantProperty(o.v8Spec.light.anchor),position:new Be,color:new o.DataConstantProperty(o.v8Spec.light.color),intensity:new o.DataConstantProperty(o.v8Spec.light.intensity)}),this._transitionable=new o.Transitionable(at),this.setLight(s),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(s,f={}){if(!this._validate(o.validateLight,s,f))for(const v in s){var y=s[v];v.endsWith(Ze)?this._transitionable.setTransition(v.slice(0,-Ze.length),y):this._transitionable.setValue(v,y)}}updateTransitions(s){this._transitioning=this._transitionable.transitioned(s,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(s){this.properties=this._transitioning.possiblyEvaluate(s)}_validate(s,f,y){return(!y||y.validate!==!1)&&o.emitValidationErrors(this,s.call(o.validateStyle,{value:f,style:{glyphs:!0,sprite:!0},styleSpec:o.v8Spec}))}}class ht{constructor(s,f){this.width=s,this.height=f,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(s,f){var y=s.join(",")+String(f);return this.dashEntry[y]||(this.dashEntry[y]=this.addDash(s,f)),this.dashEntry[y]}getDashRanges(s,f,y){var v=[],T=s.length%2==1?-s[s.length-1]*y:0,P=s[0]*y;let R=!0,N=(v.push({left:T,right:P,isDash:R,zeroLength:s[0]===0}),s[0]);for(let Z=1;Z<s.length;Z++){R=!R;var G=s[Z],T=N*y,P=(N+=G)*y;v.push({left:T,right:P,isDash:R,zeroLength:G===0})}return v}addRoundDash(s,f,y){var v=f/2;for(let Z=-y;Z<=y;Z++){var T=this.nextRow+y+Z,P=this.width*T;let j=0,X=s[j];for(let ge=0;ge<this.width;ge++){1<ge/X.right&&(X=s[++j]);var R=Math.abs(ge-X.left),G=Math.abs(ge-X.right),R=Math.min(R,G);let ye;var N,G=Z/y*(1+v);ye=X.isDash?(N=v-Math.abs(G),Math.sqrt(R*R+N*N)):v-Math.sqrt(R*R+G*G),this.data[P+ge]=Math.max(0,Math.min(255,ye+128))}}}addRegularDash(s){for(let j=s.length-1;0<=j;--j){var f=s[j],y=s[j+1];f.zeroLength?s.splice(j,1):y&&y.isDash===f.isDash&&(y.left=f.left,s.splice(j,1))}var v=s[0],T=s[s.length-1],P=(v.isDash===T.isDash&&(v.left=T.left-this.width,T.right=v.right+this.width),this.width*this.nextRow);let R=0,N=s[R];for(let j=0;j<this.width;j++){1<j/N.right&&(N=s[++R]);var G=Math.abs(j-N.left),Z=Math.abs(j-N.right),G=Math.min(G,Z),Z=N.isDash?G:-G;this.data[P+j]=Math.max(0,Math.min(255,Z+128))}}addDash(s,f){var y,v,T=f?7:0,P=2*T+1;if(this.nextRow+P>this.height)return o.warnOnce("LineAtlas out of space"),null;let R=0;for(let N=0;N<s.length;N++)R+=s[N];return R!==0&&(y=this.width/R,v=this.getDashRanges(s,this.width,y),f?this.addRoundDash(v,y,T):this.addRegularDash(v)),f={y:(this.nextRow+T+.5)/this.height,height:2*T/this.height,width:R},this.nextRow+=P,this.dirty=!0,f}bind(s){s=s.gl,this.texture?(s.bindTexture(s.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,s.texSubImage2D(s.TEXTURE_2D,0,0,0,this.width,this.height,s.ALPHA,s.UNSIGNED_BYTE,this.data))):(this.texture=s.createTexture(),s.bindTexture(s.TEXTURE_2D,this.texture),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_S,s.REPEAT),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_T,s.REPEAT),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,s.LINEAR),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,s.LINEAR),s.texImage2D(s.TEXTURE_2D,0,s.ALPHA,this.width,this.height,0,s.ALPHA,s.UNSIGNED_BYTE,this.data))}}function Rt(){return new Worker(o.config.WORKER_URL)}const hn="maplibre_preloaded_worker_pool";class wt{constructor(){this.active={}}acquire(s){if(!this.workers)for(this.workers=[];this.workers.length<wt.workerCount;)this.workers.push(Rt());return this.active[s]=!0,this.workers.slice()}release(s){delete this.active[s],this.numActive()===0&&(this.workers.forEach(f=>{f.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[hn]}numActive(){return Object.keys(this.active).length}}ir=Math.floor(g.hardwareConcurrency/2),wt.workerCount=o.isSafari(globalThis)?Math.max(Math.min(ir,3),1):1;let Ge;function Gn(){return Ge=Ge||new wt}class Xt{constructor(s,f){this.workerPool=s,this.actors=[],this.currentActor=0,this.id=f;var y=this.workerPool.acquire(f);for(let T=0;T<y.length;T++){var v=y[T],v=new o.Actor(v,f);v.name="Worker "+T,this.actors.push(v)}if(!this.actors.length)throw new Error("No actors found")}broadcast(s,f){var y=[];for(const v of this.actors)y.push(v.sendAsync({type:s,data:f}));return Promise.all(y)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(s=!0){this.actors.forEach(f=>{f.remove()}),this.actors=[],s&&this.workerPool.release(this.id)}registerMessageHandler(s,f){for(const y of this.actors)y.registerMessageHandler(s,f)}}let ln;function Mn(){return ln||(ln=new Xt(Gn(),o.GLOBAL_DISPATCHER_ID)).registerMessageHandler("GR",(w,s,f)=>o.makeRequest(s,f)),ln}function Ot(w,s,f,j,v,T){var P,R,N,G=function(ye,be,ve){if(ye)for(const ze of ye){var Fe=be[ze];if(Fe&&Fe.source===ve&&Fe.type==="fill-extrusion")return!0}else for(const ze in be){var Ue=be[ze];if(Ue.source===ve&&Ue.type==="fill-extrusion")return!0}return!1}(v&&v.layers,s,w.id),Z=T.maxPitchScaleFactor(),j=w.tilesIn(j,Z,G),X=(j.sort(It),[]);for(const ye of j)X.push({wrappedTileID:ye.tileID.wrapped().key,queryResults:ye.tile.queryRenderedFeatures(s,f,w._state,ye.queryGeometry,ye.cameraQueryGeometry,ye.scale,v,T,Z,(P=w.transform,R=ye.tileID,N=void 0,N=o.create(),o.translate(N,N,[1,1,0]),o.scale(N,N,[.5*P.width,.5*P.height,1]),o.multiply(N,N,P.calculatePosMatrix(R.toUnwrapped()))))});var ge=function(ye){var be={},ve={};for(const ct of ye){var Fe=ct.queryResults,Ue=ct.wrappedTileID,ze=ve[Ue]=ve[Ue]||{};for(const it in Fe){var Qe=Fe[it],Je=ze[it]=ze[it]||{},Xe=be[it]=be[it]||[];for(const _t of Qe)Je[_t.featureIndex]||(Je[_t.featureIndex]=!0,Xe.push(_t))}}return be}(X);for(const ye in ge)ge[ye].forEach(ve=>{var ve=ve.feature,Fe=w.getFeatureState(ve.layer["source-layer"],ve.id);ve.source=ve.layer.source,ve.layer["source-layer"]&&(ve.sourceLayer=ve.layer["source-layer"]),ve.state=Fe});return ge}function En(w,s,f,y,v,T,P){var R={},N=T.queryRenderedSymbols(y),G=[];for(const ge of Object.keys(N).map(Number))G.push(P[ge]);G.sort(It);for(const ge of G){var Z=ge.featureIndex.lookupSymbolFeatures(N[ge.bucketInstanceId],s,ge.bucketIndex,ge.sourceLayerIndex,v.filter,v.layers,v.availableImages,w);for(const ye in Z){var j=R[ye]=R[ye]||[],X=Z[ye];X.sort((be,ve)=>{var Fe,Ue=ge.featureSortOrder;return Ue?(Fe=Ue.indexOf(be.featureIndex),Ue.indexOf(ve.featureIndex)-Fe):ve.featureIndex-be.featureIndex});for(const be of X)j.push(be)}}for(const ge in R)R[ge].forEach(be=>{var be=be.feature,ve=w[ge],ve=f[ve.source].getFeatureState(be.layer["source-layer"],be.id);be.source=be.layer.source,be.layer["source-layer"]&&(be.sourceLayer=be.layer["source-layer"]),be.state=ve});return R}function lt(w,s){var f=w.getRenderableIds().map(R=>w.getTileByID(R)),y=[],v={};for(let R=0;R<f.length;R++){var T=f[R],P=T.tileID.canonical.key;v[P]||(v[P]=!0,T.querySourceFeatures(y,s))}return y}function It(w,s){return w=w.tileID,s=s.tileID,w.overscaledZ-s.overscaledZ||w.canonical.y-s.canonical.y||w.wrap-s.wrap||w.canonical.x-s.canonical.x}function he(w,s,f){return o.__awaiter(this,void 0,void 0,function*(){let y=w;var v;return w.url?(v=yield o.getJSON(s.transformRequest(w.url,"Source"),f),y=v.data):yield g.frameAsync(f),y?(v=o.pick(o.extend(y,w),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]),"vector_layers"in y&&y.vector_layers&&(v.vectorLayerIds=y.vector_layers.map(T=>T.id)),v):null})}class B{constructor(s,f){s&&(f?this.setSouthWest(s).setNorthEast(f):Array.isArray(s)&&(s.length===4?this.setSouthWest([s[0],s[1]]).setNorthEast([s[2],s[3]]):this.setSouthWest(s[0]).setNorthEast(s[1])))}setNorthEast(s){return this._ne=s instanceof o.LngLat?new o.LngLat(s.lng,s.lat):o.LngLat.convert(s),this}setSouthWest(s){return this._sw=s instanceof o.LngLat?new o.LngLat(s.lng,s.lat):o.LngLat.convert(s),this}extend(s){var f,y=this._sw,v=this._ne;let T,P;if(s instanceof o.LngLat)T=s,P=s;else{if(!(s instanceof B))return Array.isArray(s)?s.length===4||s.every(Array.isArray)?(f=s,this.extend(B.convert(f))):this.extend(o.LngLat.convert(s)):s&&("lng"in s||"lon"in s)&&"lat"in s?this.extend(o.LngLat.convert(s)):this;if(T=s._sw,P=s._ne,!T||!P)return this}return y||v?(y.lng=Math.min(T.lng,y.lng),y.lat=Math.min(T.lat,y.lat),v.lng=Math.max(P.lng,v.lng),v.lat=Math.max(P.lat,v.lat)):(this._sw=new o.LngLat(T.lng,T.lat),this._ne=new o.LngLat(P.lng,P.lat)),this}getCenter(){return new o.LngLat((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new o.LngLat(this.getWest(),this.getNorth())}getSouthEast(){return new o.LngLat(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(f){var{lng:f,lat:y}=o.LngLat.convert(f),y=this._sw.lat<=y&&y<=this._ne.lat;let v=this._sw.lng<=f&&f<=this._ne.lng;return this._sw.lng>this._ne.lng&&(v=this._sw.lng>=f&&f>=this._ne.lng),y&&v}static convert(s){return s instanceof B?s:s&&new B(s)}static fromLngLat(s,y=0){var y=360*y/40075017,v=y/Math.cos(Math.PI/180*s.lat);return new B(new o.LngLat(s.lng-v,s.lat-y),new o.LngLat(s.lng+v,s.lat+y))}}class H{constructor(s,f,y){this.bounds=B.convert(this.validateBounds(s)),this.minzoom=f||0,this.maxzoom=y||24}validateBounds(s){return Array.isArray(s)&&s.length===4?[Math.max(-180,s[0]),Math.max(-90,s[1]),Math.min(180,s[2]),Math.min(90,s[3])]:[-180,-90,180,90]}contains(s){var f=Math.pow(2,s.z);const y=Math.floor(o.mercatorXfromLng(this.bounds.getWest())*f),v=Math.floor(o.mercatorYfromLat(this.bounds.getNorth())*f),T=Math.ceil(o.mercatorXfromLng(this.bounds.getEast())*f),P=Math.ceil(o.mercatorYfromLat(this.bounds.getSouth())*f);return s.x>=y&&s.x<T&&s.y>=v&&s.y<P}}class F extends o.Evented{constructor(s,f,y,v){if(super(),this.id=s,this.dispatcher=y,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,o.extend(this,o.pick(f,["url","scheme","tileSize","promoteId"])),this._options=o.extend({type:"vector"},f),this._collectResourceTiming=f.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(v)}load(){return o.__awaiter(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new o.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{var s=yield he(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),s&&(o.extend(this,s),s.bounds&&(this.tileBounds=new H(s.bounds,this.minzoom,this.maxzoom)),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"content"})))}catch(f){this._tileJSONRequest=null,this.fire(new o.ErrorEvent(f))}})}loaded(){return this._loaded}hasTile(s){return!this.tileBounds||this.tileBounds.contains(s.canonical)}onAdd(s){this.map=s,this.load()}setSourceProperty(s){this._tileJSONRequest&&this._tileJSONRequest.abort(),s(),this.load()}setTiles(s){return this.setSourceProperty(()=>{this._options.tiles=s}),this}setUrl(s){return this.setSourceProperty(()=>{this.url=s,this._options.url=s}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return o.extend({},this._options)}loadTile(s){return o.__awaiter(this,void 0,void 0,function*(){var f=s.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),f={request:this.map._requestManager.transformRequest(f,"Tile"),uid:s.uid,tileID:s.tileID,zoom:s.tileID.overscaledZ,tileSize:this.tileSize*s.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};f.request.collectResourceTiming=this._collectResourceTiming;let y="RT";if(s.actor&&s.state!=="expired"){if(s.state==="loading")return new Promise((T,P)=>{s.reloadPromise={resolve:T,reject:P}})}else s.actor=this.dispatcher.getActor(),y="LT";s.abortController=new AbortController;try{var v=yield s.actor.sendAsync({type:y,data:f},s.abortController);delete s.abortController,s.aborted||this._afterTileLoadWorkerResponse(s,v)}catch(T){if(delete s.abortController,!s.aborted){if(T&&T.status!==404)throw T;this._afterTileLoadWorkerResponse(s,null)}}})}_afterTileLoadWorkerResponse(s,f){f&&f.resourceTiming&&(s.resourceTiming=f.resourceTiming),f&&this.map._refreshExpiredTiles&&s.setExpiryData(f),s.loadVectorData(f,this.map.painter),s.reloadPromise&&(f=s.reloadPromise,s.reloadPromise=null,this.loadTile(s).then(f.resolve).catch(f.reject))}abortTile(s){return o.__awaiter(this,void 0,void 0,function*(){s.abortController&&(s.abortController.abort(),delete s.abortController),s.actor&&(yield s.actor.sendAsync({type:"AT",data:{uid:s.uid,type:this.type,source:this.id}}))})}unloadTile(s){return o.__awaiter(this,void 0,void 0,function*(){s.unloadVectorData(),s.actor&&(yield s.actor.sendAsync({type:"RMT",data:{uid:s.uid,type:this.type,source:this.id}}))})}hasTransition(){return!1}}class Q extends o.Evented{constructor(s,f,y,v){super(),this.id=s,this.dispatcher=y,this.setEventedParent(v),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=o.extend({type:"raster"},f),o.extend(this,o.pick(f,["url","scheme","tileSize"]))}load(){return o.__awaiter(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new o.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{var s=yield he(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,s&&(o.extend(this,s),s.bounds&&(this.tileBounds=new H(s.bounds,this.minzoom,this.maxzoom)),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"content"})))}catch(f){this._tileJSONRequest=null,this.fire(new o.ErrorEvent(f))}})}loaded(){return this._loaded}onAdd(s){this.map=s,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(s){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),s(),this.load()}setTiles(s){return this.setSourceProperty(()=>{this._options.tiles=s}),this}setUrl(s){return this.setSourceProperty(()=>{this.url=s,this._options.url=s}),this}serialize(){return o.extend({},this._options)}hasTile(s){return!this.tileBounds||this.tileBounds.contains(s.canonical)}loadTile(s){return o.__awaiter(this,void 0,void 0,function*(){var f=s.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);s.abortController=new AbortController;try{var y,v,T,P=yield a.getImage(this.map._requestManager.transformRequest(f,"Tile"),s.abortController,this.map._refreshExpiredTiles);delete s.abortController,s.aborted?s.state="unloaded":P&&P.data&&(this.map._refreshExpiredTiles&&P.cacheControl&&P.expires&&s.setExpiryData({cacheControl:P.cacheControl,expires:P.expires}),v=(y=this.map.painter.context).gl,T=P.data,s.texture=this.map.painter.getTileTexture(T.width),s.texture?s.texture.update(T,{useMipmap:!0}):(s.texture=new ue(y,T,v.RGBA,{useMipmap:!0}),s.texture.bind(v.LINEAR,v.CLAMP_TO_EDGE,v.LINEAR_MIPMAP_NEAREST),y.extTextureFilterAnisotropic&&v.texParameterf(v.TEXTURE_2D,y.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,y.extTextureFilterAnisotropicMax)),s.state="loaded")}catch(R){if(delete s.abortController,s.aborted)s.state="unloaded";else if(R)throw s.state="errored",R}})}abortTile(s){return o.__awaiter(this,void 0,void 0,function*(){s.abortController&&(s.abortController.abort(),delete s.abortController)})}unloadTile(s){return o.__awaiter(this,void 0,void 0,function*(){s.texture&&this.map.painter.saveTileTexture(s.texture)})}hasTransition(){return!1}}class ae extends Q{constructor(s,f,y,v){super(s,f,y,v),this.type="raster-dem",this.maxzoom=22,this._options=o.extend({type:"raster-dem"},f),this.encoding=f.encoding||"mapbox",this.redFactor=f.redFactor,this.greenFactor=f.greenFactor,this.blueFactor=f.blueFactor,this.baseShift=f.baseShift}loadTile(s){return o.__awaiter(this,void 0,void 0,function*(){var f=s.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),f=this.map._requestManager.transformRequest(f,"Tile");s.neighboringTiles=this._getNeighboringTiles(s.tileID),s.abortController=new AbortController;try{var y,v,T,P,R=yield a.getImage(f,s.abortController,this.map._refreshExpiredTiles);delete s.abortController,s.aborted?s.state="unloaded":R&&R.data&&(y=R.data,this.map._refreshExpiredTiles&&R.cacheControl&&R.expires&&s.setExpiryData({cacheControl:R.cacheControl,expires:R.expires}),v=o.isImageBitmap(y)&&o.offscreenCanvasSupported()?y:yield this.readImageNow(y),T={type:this.type,uid:s.uid,source:this.id,rawImageData:v,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift},s.actor&&s.state!=="expired"||(s.actor=this.dispatcher.getActor(),P=yield s.actor.sendAsync({type:"LDT",data:T}),s.dem=P,s.needsHillshadePrepare=!0,s.needsTerrainPrepare=!0,s.state="loaded"))}catch(N){if(delete s.abortController,s.aborted)s.state="unloaded";else if(N)throw s.state="errored",N}})}readImageNow(s){return o.__awaiter(this,void 0,void 0,function*(){if(typeof VideoFrame<"u"&&o.isOffscreenCanvasDistorted()){var f=s.width+2,y=s.height+2;try{return new o.RGBAImage({width:f,height:y},yield o.readImageUsingVideoFrame(s,-1,-1,f,y))}catch{}}return g.getImageData(s,1)})}_getNeighboringTiles(s){var f=s.canonical,y=Math.pow(2,f.z),v=(f.x-1+y)%y,T=f.x===0?s.wrap-1:s.wrap,P=(f.x+1+y)%y,R=f.x+1===y?s.wrap+1:s.wrap,N={};return N[new o.OverscaledTileID(s.overscaledZ,T,f.z,v,f.y).key]={backfilled:!1},N[new o.OverscaledTileID(s.overscaledZ,R,f.z,P,f.y).key]={backfilled:!1},0<f.y&&(N[new o.OverscaledTileID(s.overscaledZ,T,f.z,v,f.y-1).key]={backfilled:!1},N[new o.OverscaledTileID(s.overscaledZ,s.wrap,f.z,f.x,f.y-1).key]={backfilled:!1},N[new o.OverscaledTileID(s.overscaledZ,R,f.z,P,f.y-1).key]={backfilled:!1}),f.y+1<y&&(N[new o.OverscaledTileID(s.overscaledZ,T,f.z,v,f.y+1).key]={backfilled:!1},N[new o.OverscaledTileID(s.overscaledZ,s.wrap,f.z,f.x,f.y+1).key]={backfilled:!1},N[new o.OverscaledTileID(s.overscaledZ,R,f.z,P,f.y+1).key]={backfilled:!1}),N}unloadTile(s){return o.__awaiter(this,void 0,void 0,function*(){s.demTexture&&this.map.painter.saveTileTexture(s.demTexture),s.fbo&&(s.fbo.destroy(),delete s.fbo),s.dem&&delete s.dem,delete s.neighboringTiles,s.state="unloaded",s.actor&&(yield s.actor.sendAsync({type:"RDT",data:{type:this.type,uid:s.uid,source:this.id}}))})}}class q extends o.Evented{constructor(s,f,y,v){super(),this.id=s,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=y.getActor(),this.setEventedParent(v),this._data=f.data,this._options=o.extend({},f),this._collectResourceTiming=f.collectResourceTiming,f.maxzoom!==void 0&&(this.maxzoom=f.maxzoom),f.type&&(this.type=f.type),f.attribution&&(this.attribution=f.attribution),this.promoteId=f.promoteId,s=o.EXTENT/this.tileSize,this.workerOptions=o.extend({source:this.id,cluster:f.cluster||!1,geojsonVtOptions:{buffer:(f.buffer!==void 0?f.buffer:128)*s,tolerance:(f.tolerance!==void 0?f.tolerance:.375)*s,extent:o.EXTENT,maxZoom:this.maxzoom,lineMetrics:f.lineMetrics||!1,generateId:f.generateId||!1},superclusterOptions:{maxZoom:f.clusterMaxZoom!==void 0?f.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,f.clusterMinPoints||2),extent:o.EXTENT,radius:(f.clusterRadius||50)*s,log:!1,generateId:f.generateId||!1},clusterProperties:f.clusterProperties,filter:f.filter},f.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}load(){return o.__awaiter(this,void 0,void 0,function*(){yield this._updateWorkerData()})}onAdd(s){this.map=s,this.load()}setData(s){return this._data=s,this._updateWorkerData(),this}updateData(s){return this._updateWorkerData(s),this}setClusterOptions(s){return this.workerOptions.cluster=s.cluster,s&&(s.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=s.clusterRadius),s.clusterMaxZoom!==void 0)&&(this.workerOptions.superclusterOptions.maxZoom=s.clusterMaxZoom),this._updateWorkerData(),this}getClusterExpansionZoom(s){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:s,source:this.id}})}getClusterChildren(s){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:s,source:this.id}})}getClusterLeaves(s,f,y){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:s,limit:f,offset:y}})}_updateWorkerData(s){return o.__awaiter(this,void 0,void 0,function*(){var f=o.extend({type:this.type},this.workerOptions);s?f.dataDiff=s:typeof this._data=="string"?(f.request=this.map._requestManager.transformRequest(g.resolveURL(this._data),"Source"),f.request.collectResourceTiming=this._collectResourceTiming):f.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new o.Event("dataloading",{dataType:"source"}));try{var y=yield this.actor.sendAsync({type:"LD",data:f});if(this._pendingLoads--,this._removed||y.abandoned)this.fire(new o.Event("dataabort",{dataType:"source"}));else{let T=null;y.resourceTiming&&y.resourceTiming[this.id]&&(T=y.resourceTiming[this.id].slice(0));var v={dataType:"source"};this._collectResourceTiming&&T&&0<T.length&&o.extend(v,{resourceTiming:T}),this.fire(new o.Event("data",Object.assign(Object.assign({},v),{sourceDataType:"metadata"}))),this.fire(new o.Event("data",Object.assign(Object.assign({},v),{sourceDataType:"content"})))}}catch(T){this._pendingLoads--,this._removed?this.fire(new o.Event("dataabort",{dataType:"source"})):this.fire(new o.ErrorEvent(T))}})}loaded(){return this._pendingLoads===0}loadTile(s){return o.__awaiter(this,void 0,void 0,function*(){var f=s.actor?"RT":"LT",y=(s.actor=this.actor,{type:this.type,uid:s.uid,tileID:s.tileID,zoom:s.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId}),y=(s.abortController=new AbortController,yield this.actor.sendAsync({type:f,data:y},s.abortController));delete s.abortController,s.unloadVectorData(),s.aborted||s.loadVectorData(y,this.map.painter,f=="RT")})}abortTile(s){return o.__awaiter(this,void 0,void 0,function*(){s.abortController&&(s.abortController.abort(),delete s.abortController),s.aborted=!0})}unloadTile(s){return o.__awaiter(this,void 0,void 0,function*(){s.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:s.uid,type:this.type,source:this.id}})})}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return o.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}var Ae=o.createLayout([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class Pe extends o.Evented{constructor(s,f,y,v){super(),this.id=s,this.dispatcher=y,this.coordinates=f.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(v),this.options=f}load(s){return o.__awaiter(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new o.Event("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{var f=yield a.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,f&&f.data&&(this.image=f.data,s&&(this.coordinates=s),this._finishLoading())}catch(y){this._request=null,this.fire(new o.ErrorEvent(y))}})}loaded(){return this._loaded}updateImage(s){return s.url&&(this._request&&(this._request.abort(),this._request=null),this.options.url=s.url,this.load(s.coordinates).finally(()=>{this.texture=null})),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(s){this.map=s,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(s){return s=(this.coordinates=s).map(o.MercatorCoordinate.fromLngLat),this.tileID=We(s),this.minzoom=this.maxzoom=this.tileID.z,s=s.map(f=>this.tileID.getTilePoint(f)._round()),this._boundsArray=new o.RasterBoundsArray,this._boundsArray.emplaceBack(s[0].x,s[0].y,0,0),this._boundsArray.emplaceBack(s[1].x,s[1].y,o.EXTENT,0),this._boundsArray.emplaceBack(s[3].x,s[3].y,0,o.EXTENT),this._boundsArray.emplaceBack(s[2].x,s[2].y,o.EXTENT,o.EXTENT),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length!==0&&this.image){var s=this.map.painter.context,f=s.gl;this.boundsBuffer||(this.boundsBuffer=s.createVertexBuffer(this._boundsArray,Ae.members)),this.boundsSegments||(this.boundsSegments=o.SegmentVector.simpleSegment(0,0,4,2)),this.texture||(this.texture=new ue(s,this.image,f.RGBA),this.texture.bind(f.LINEAR,f.CLAMP_TO_EDGE));let v=!1;for(const T in this.tiles){var y=this.tiles[T];y.state!=="loaded"&&(y.state="loaded",y.texture=this.texture,v=!0)}v&&this.fire(new o.Event("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}}loadTile(s){return o.__awaiter(this,void 0,void 0,function*(){this.tileID&&this.tileID.equals(s.tileID.canonical)?(this.tiles[String(s.tileID.wrap)]=s).buckets={}:s.state="errored"})}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}function We(P){let s=1/0,f=1/0,y=-1/0,v=-1/0;for(const R of P)s=Math.min(s,R.x),f=Math.min(f,R.y),y=Math.max(y,R.x),v=Math.max(v,R.y);var P=y-s,T=v-f,P=Math.max(P,T),T=Math.max(0,Math.floor(-Math.log(P)/Math.LN2)),P=Math.pow(2,T);return new o.CanonicalTileID(T,Math.floor((s+y)/2*P),Math.floor((f+v)/2*P))}class rt extends Pe{constructor(s,f,y,v){super(s,f,y,v),this.roundZoom=!0,this.type="video",this.options=f}load(){return o.__awaiter(this,void 0,void 0,function*(){this._loaded=!1;var s=this.options;this.urls=[];for(const y of s.urls)this.urls.push(this.map._requestManager.transformRequest(y,"Source").url);try{var f=yield o.getVideo(this.urls);this._loaded=!0,f&&(this.video=f,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())}catch(y){this.fire(new o.ErrorEvent(y))}})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(s){var f;this.video&&(s<(f=this.video.seekable).start(0)||s>f.end(0)?this.fire(new o.ErrorEvent(new o.ValidationError("sources."+this.id,null,`Playback for this video can be set only between the ${f.start(0)} and ${f.end(0)}-second mark.`))):this.video.currentTime=s)}getVideo(){return this.video}onAdd(s){this.map||(this.map=s,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(!(Object.keys(this.tiles).length===0||this.video.readyState<2)){var s=this.map.painter.context,f=s.gl;this.boundsBuffer||(this.boundsBuffer=s.createVertexBuffer(this._boundsArray,Ae.members)),this.boundsSegments||(this.boundsSegments=o.SegmentVector.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(f.LINEAR,f.CLAMP_TO_EDGE),f.texSubImage2D(f.TEXTURE_2D,0,0,0,f.RGBA,f.UNSIGNED_BYTE,this.video)):(this.texture=new ue(s,this.video,f.RGBA),this.texture.bind(f.LINEAR,f.CLAMP_TO_EDGE));let v=!1;for(const T in this.tiles){var y=this.tiles[T];y.state!=="loaded"&&(y.state="loaded",y.texture=this.texture,v=!0)}v&&this.fire(new o.Event("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class Et extends Pe{constructor(s,f,y,v){super(s,f,y,v),f.coordinates?Array.isArray(f.coordinates)&&f.coordinates.length===4&&!f.coordinates.some(T=>!Array.isArray(T)||T.length!==2||T.some(P=>typeof P!="number"))||this.fire(new o.ErrorEvent(new o.ValidationError("sources."+s,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new o.ErrorEvent(new o.ValidationError("sources."+s,null,'missing required property "coordinates"'))),f.animate&&typeof f.animate!="boolean"&&this.fire(new o.ErrorEvent(new o.ValidationError("sources."+s,null,'optional "animate" property must be a boolean value'))),f.canvas?typeof f.canvas=="string"||f.canvas instanceof HTMLCanvasElement||this.fire(new o.ErrorEvent(new o.ValidationError("sources."+s,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new o.ErrorEvent(new o.ValidationError("sources."+s,null,'missing required property "canvas"'))),this.options=f,this.animate=f.animate===void 0||f.animate}load(){return o.__awaiter(this,void 0,void 0,function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new o.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())})}getCanvas(){return this.canvas}onAdd(s){this.map=s,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let s=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,s=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,s=!0),!this._hasInvalidDimensions()&&Object.keys(this.tiles).length!==0){var f=this.map.painter.context,y=f.gl;this.boundsBuffer||(this.boundsBuffer=f.createVertexBuffer(this._boundsArray,Ae.members)),this.boundsSegments||(this.boundsSegments=o.SegmentVector.simpleSegment(0,0,4,2)),this.texture?(s||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new ue(f,this.canvas,y.RGBA,{premultiply:!0});let T=!1;for(const P in this.tiles){var v=this.tiles[P];v.state!=="loaded"&&(v.state="loaded",v.texture=this.texture,T=!0)}T&&this.fire(new o.Event("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const s of[this.canvas.width,this.canvas.height])if(isNaN(s)||s<=0)return!0;return!1}}const Bt={},Lt=(w,s,f,y)=>{if(s=new(an(s.type))(w,s,f,y),s.id!==w)throw new Error(`Expected Source id to be ${w} instead of `+s.id);return s},an=w=>{switch(w){case"geojson":return q;case"image":return Pe;case"raster":return Q;case"raster-dem":return ae;case"vector":return F;case"video":return rt;case"canvas":return Et}return Bt[w]};function Ie(w,s){var f={};if(s)for(const y of w){const v=y.layerIds.map(T=>s.getLayer(T)).filter(Boolean);if(v.length!==0){y.layers=v,y.stateDependentLayerIds&&(y.stateDependentLayers=y.stateDependentLayerIds.map(T=>v.filter(P=>P.id===T)[0]));for(const T of v)f[T.id]=y}}return f}const Te="RTLPluginLoaded";class At extends o.Evented{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=Mn()}_syncState(s){return this.status=s,this.dispatcher.broadcast("SRPS",{pluginStatus:s,pluginURL:this.url}).catch(f=>{throw this.status="error",f})}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(s){return o.__awaiter(this,arguments,void 0,function*(f,y=!1){if(this.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(this.url=g.resolveURL(f),!this.url)throw new Error(`requested url ${f} is invalid`);if(this.status==="unavailable"){if(!y)return this._requestImport();this.status="deferred",this._syncState(this.status)}else if(this.status==="requested")return this._requestImport()})}_requestImport(){return o.__awaiter(this,void 0,void 0,function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new o.Event(Te))})}lazyLoad(){this.status==="unavailable"?this.status="requested":this.status==="deferred"&&this._requestImport()}}let xt=null;function qt(){return xt=xt||new At}class dn{constructor(s,f){this.timeAdded=0,this.fadeEndTime=0,this.tileID=s,this.uid=o.uniqueId(),this.uses=0,this.tileSize=f,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(s){s+=this.timeAdded,s<this.fadeEndTime||(this.fadeEndTime=s)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(s){this.demTexture&&s.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(s,f,y){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",s){s.featureIndex&&(this.latestFeatureIndex=s.featureIndex,s.rawTileData?(this.latestRawTileData=s.rawTileData,this.latestFeatureIndex.rawTileData=s.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=s.collisionBoxArray,this.buckets=Ie(s.buckets,f.style),this.hasSymbolBuckets=!1;for(const R in this.buckets){var v=this.buckets[R];if(v instanceof o.SymbolBucket){if(this.hasSymbolBuckets=!0,!y)break;v.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const R in this.buckets){var T=this.buckets[R];if(T instanceof o.SymbolBucket&&T.hasRTLText){this.hasRTLText=!0,qt().lazyLoad();break}}this.queryPadding=0;for(const R in this.buckets){var P=this.buckets[R];this.queryPadding=Math.max(this.queryPadding,f.style.getLayer(R).queryRadius(P))}s.imageAtlas&&(this.imageAtlas=s.imageAtlas),s.glyphAtlasImage&&(this.glyphAtlasImage=s.glyphAtlasImage)}else this.collisionBoxArray=new o.CollisionBoxArray}unloadVectorData(){for(const s in this.buckets)this.buckets[s].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(s){return this.buckets[s.id]}upload(s){for(const v in this.buckets){var f=this.buckets[v];f.uploadPending()&&f.upload(s)}var y=s.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new ue(s,this.imageAtlas.image,y.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new ue(s,this.glyphAtlasImage,y.ALPHA),this.glyphAtlasImage=null)}prepare(s){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(s,this.imageAtlasTexture)}queryRenderedFeatures(s,f,y,v,T,P,R,N,G,Z){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:v,cameraQueryGeometry:T,scale:P,tileSize:this.tileSize,pixelPosMatrix:Z,transform:N,params:R,queryPadding:this.queryPadding*G},s,f,y):{}}querySourceFeatures(s,f){var y=this.latestFeatureIndex;if(y&&y.rawTileData){var v=y.loadVTLayers(),T=f&&f.sourceLayer?f.sourceLayer:"",P=v._geojsonTileLayer||v[T];if(P){var R=o.createFilter(f&&f.filter),{z:N,x:G,y:Z}=this.tileID.canonical,j={z:N,x:G,y:Z};for(let ye=0;ye<P.length;ye++){var X=P.feature(ye);if(R.needGeometry){var ge=o.toEvaluationFeature(X,!0);if(!R.filter(new o.EvaluationParameters(this.tileID.overscaledZ),ge,this.tileID.canonical))continue}else if(!R.filter(new o.EvaluationParameters(this.tileID.overscaledZ),X))continue;ge=y.getId(X,T),X=new o.GeoJSONFeature(X,N,G,Z,ge),X.tile=j,s.push(X)}}}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(s){var f=this.expirationTime;if(s.cacheControl?(y=o.parseCacheControl(s.cacheControl))["max-age"]&&(this.expirationTime=Date.now()+1e3*y["max-age"]):s.expires&&(this.expirationTime=new Date(s.expires).getTime()),this.expirationTime){var y=Date.now();let v=!1;this.expirationTime>y?v=!1:f&&!(this.expirationTime<f)&&(s=this.expirationTime-f)?this.expirationTime=y+Math.max(s,3e4):v=!0,v?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(s,f){if(this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData&&Object.keys(s).length!==0){var y,v,T,P=this.latestFeatureIndex.loadVTLayers();for(const R in this.buckets)f.style.hasLayer(R)&&(v=P[T=(y=this.buckets[R]).layers[0].sourceLayer||"_geojsonTileLayer"],T=s[T],v)&&T&&Object.keys(T).length!==0&&(y.update(T,v,this.imageAtlas&&this.imageAtlas.patternPositions||{}),T=f&&f.style&&f.style.getLayer(R))&&(this.queryPadding=Math.max(this.queryPadding,T.queryRadius(y)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<g.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(s){this.symbolFadeHoldUntil=g.now()+s}setDependencies(s,f){var y={};for(const v of f)y[v]=!0;this.dependencies[s]=y}hasDependency(s,f){for(const v of s){var y=this.dependencies[v];if(y){for(const T of f)if(y[T])return!0}}return!1}}class Ke{constructor(s,f){this.max=s,this.onRemove=f,this.reset()}reset(){for(const s in this.data)for(const f of this.data[s])f.timeout&&clearTimeout(f.timeout),this.onRemove(f.value);return this.data={},this.order=[],this}add(s,f,y){var v=s.wrapped().key;this.data[v]===void 0&&(this.data[v]=[]);const T={value:f,timeout:void 0};return y!==void 0&&(T.timeout=setTimeout(()=>{this.remove(s,T)},y)),this.data[v].push(T),this.order.push(v),this.order.length>this.max&&(f=this._getAndRemoveByKey(this.order[0]))&&this.onRemove(f),this}has(s){return s.wrapped().key in this.data}getAndRemove(s){return this.has(s)?this._getAndRemoveByKey(s.wrapped().key):null}_getAndRemoveByKey(s){var f=this.data[s].shift();return f.timeout&&clearTimeout(f.timeout),this.data[s].length===0&&delete this.data[s],this.order.splice(this.order.indexOf(s),1),f.value}getByKey(s){return s=this.data[s],s?s[0].value:null}get(s){return this.has(s)?this.data[s.wrapped().key][0].value:null}remove(s,f){var y;return this.has(s)&&(s=s.wrapped().key,f=f===void 0?0:this.data[s].indexOf(f),y=this.data[s][f],this.data[s].splice(f,1),y.timeout&&clearTimeout(y.timeout),this.data[s].length===0&&delete this.data[s],this.onRemove(y.value),this.order.splice(this.order.indexOf(s),1)),this}setMaxSize(s){for(this.max=s;this.order.length>this.max;){var f=this._getAndRemoveByKey(this.order[0]);f&&this.onRemove(f)}return this}filter(s){var f=[];for(const y in this.data)for(const v of this.data[y])s(v.value)||f.push(v);for(const y of f)this.remove(y.value.tileID,y)}}class gt{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(s,f,y){var v=String(f);if(this.stateChanges[s]=this.stateChanges[s]||{},this.stateChanges[s][v]=this.stateChanges[s][v]||{},o.extend(this.stateChanges[s][v],y),this.deletedStates[s]===null){this.deletedStates[s]={};for(const T in this.state[s])T!==v&&(this.deletedStates[s][T]=null)}else if(this.deletedStates[s]&&this.deletedStates[s][v]===null){this.deletedStates[s][v]={};for(const T in this.state[s][v])y[T]||(this.deletedStates[s][v][T]=null)}else for(const T in y)this.deletedStates[s]&&this.deletedStates[s][v]&&this.deletedStates[s][v][T]===null&&delete this.deletedStates[s][v][T]}removeFeatureState(s,f,y){var v=this.deletedStates[s]===null;if(!v){var T=String(f);if(this.deletedStates[s]=this.deletedStates[s]||{},y&&f!==void 0)this.deletedStates[s][T]!==null&&(this.deletedStates[s][T]=this.deletedStates[s][T]||{},this.deletedStates[s][T][y]=null);else if(f!==void 0)if(this.stateChanges[s]&&this.stateChanges[s][T])for(y in this.deletedStates[s][T]={},this.stateChanges[s][T])this.deletedStates[s][T][y]=null;else this.deletedStates[s][T]=null;else this.deletedStates[s]=null}}getState(s,f){var y=String(f),v=this.state[s]||{},T=this.stateChanges[s]||{},P=o.extend({},v[y],T[y]);if(this.deletedStates[s]===null)return{};if(this.deletedStates[s]){if(v=this.deletedStates[s][f],v===null)return{};for(const R in v)delete P[R]}return P}initializeTileState(s,f){s.setFeatureState(this.state,f)}coalesceChanges(s,f){var y={};for(const P in this.stateChanges){this.state[P]=this.state[P]||{};var v={};for(const R in this.stateChanges[P])this.state[P][R]||(this.state[P][R]={}),o.extend(this.state[P][R],this.stateChanges[P][R]),v[R]=this.state[P][R];y[P]=v}for(const P in this.deletedStates){this.state[P]=this.state[P]||{};var T={};if(this.deletedStates[P]===null)for(const R in this.state[P])T[R]={},this.state[P][R]={};else for(const R in this.deletedStates[P]){if(this.deletedStates[P][R]===null)this.state[P][R]={};else for(const N of Object.keys(this.deletedStates[P][R]))delete this.state[P][R][N];T[R]=this.state[P][R]}y[P]=y[P]||{},o.extend(y[P],T)}if(this.stateChanges={},this.deletedStates={},Object.keys(y).length!==0)for(const P in s)s[P].setFeatureState(y,f)}}class Tt extends o.Evented{constructor(s,f,y){super(),this.id=s,this.dispatcher=y,this.on("data",v=>{v.dataType==="source"&&v.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&v.dataType==="source"&&v.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=Lt(s,f,y,this),this._tiles={},this._cache=new Ke(0,v=>this._unloadTile(v)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new gt,this._didEmitContent=!1,this._updated=!1}onAdd(s){this.map=s,this._maxTileCacheSize=s?s._maxTileCacheSize:null,this._maxTileCacheZoomLevels=s?s._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(s)}onRemove(s){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(s)}loaded(){if(!this._sourceErrored){if(!this._sourceLoaded||!this._source.loaded())return!1;if(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain){if(!this._updated)return!1;for(const f in this._tiles){var s=this._tiles[f];if(s.state!=="loaded"&&s.state!=="errored")return!1}}}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){var s;this._paused&&(s=this._shouldReloadOnResume,this._paused=!1,this._shouldReloadOnResume=!1,s&&this.reload(),this.transform)&&this.update(this.transform,this.terrain)}_loadTile(s,f,y){return o.__awaiter(this,void 0,void 0,function*(){try{yield this._source.loadTile(s),this._tileLoaded(s,f,y)}catch(v){s.state="errored",v.status!==404?this._source.fire(new o.ErrorEvent(v,{tile:s})):this.update(this.transform,this.terrain)}})}_unloadTile(s){this._source.unloadTile&&this._source.unloadTile(s)}_abortTile(s){this._source.abortTile&&this._source.abortTile(s),this._source.fire(new o.Event("dataabort",{tile:s,coord:s.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(s){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const y in this._tiles){var f=this._tiles[y];f.upload(s),f.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(s=>s.tileID).sort(Rn).map(s=>s.key)}getRenderableIds(s){var f=[];for(const y in this._tiles)this._isIdRenderable(y,s)&&f.push(this._tiles[y]);return s?f.sort((T,P)=>{var T=T.tileID,P=P.tileID,R=new o.Point(T.canonical.x,T.canonical.y)._rotate(this.transform.angle),N=new o.Point(P.canonical.x,P.canonical.y)._rotate(this.transform.angle);return T.overscaledZ-P.overscaledZ||N.y-R.y||N.x-R.x}).map(y=>y.tileID.key):f.map(y=>y.tileID).sort(Rn).map(y=>y.key)}hasRenderableParent(s){return s=this.findLoadedParent(s,0),!!s&&this._isIdRenderable(s.tileID.key)}_isIdRenderable(s,f){return this._tiles[s]&&this._tiles[s].hasData()&&!this._coveredTiles[s]&&(f||!this._tiles[s].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const s in this._tiles)this._tiles[s].state!=="errored"&&this._reloadTile(s,"reloading")}}_reloadTile(s,f){return o.__awaiter(this,void 0,void 0,function*(){var y=this._tiles[s];y&&(y.state!=="loading"&&(y.state=f),yield this._loadTile(y,s,f))})}_tileLoaded(s,f,y){s.timeAdded=g.now(),y==="expired"&&(s.refreshedUponExpiration=!0),this._setTileReloadTimer(f,s),this.getSource().type==="raster-dem"&&s.dem&&this._backfillDEM(s),this._state.initializeTileState(s,this.map?this.map.painter:null),s.aborted||this._source.fire(new o.Event("data",{dataType:"source",tile:s,coord:s.tileID}))}_backfillDEM(s){var f=this.getRenderableIds();for(let T=0;T<f.length;T++){var y=f[T];s.neighboringTiles&&s.neighboringTiles[y]&&(v(s,y=this.getTileByID(y)),v(y,s))}function v(T,P){T.needsHillshadePrepare=!0,T.needsTerrainPrepare=!0;let R=P.tileID.canonical.x-T.tileID.canonical.x;var N=P.tileID.canonical.y-T.tileID.canonical.y,G=Math.pow(2,T.tileID.canonical.z),Z=P.tileID.key;R===0&&N==0||1<Math.abs(N)||(1<Math.abs(R)&&(Math.abs(R+G)===1?R+=G:Math.abs(R-G)===1&&(R-=G)),P.dem&&T.dem&&(T.dem.backfillBorder(P.dem,R,N),T.neighboringTiles)&&T.neighboringTiles[Z]&&(T.neighboringTiles[Z].backfilled=!0))}}getTile(s){return this.getTileByID(s.key)}getTileByID(s){return this._tiles[s]}_retainLoadedChildren(s,f,y,v){for(const P in this._tiles){let R=this._tiles[P];if(!(v[P]||!R.hasData()||R.tileID.overscaledZ<=f||R.tileID.overscaledZ>y)){let N=R.tileID;for(;R&&R.tileID.overscaledZ>f+1;){var T=R.tileID.scaledTo(R.tileID.overscaledZ-1);(R=this._tiles[T.key])&&R.hasData()&&(N=T)}let G=N;for(;G.overscaledZ>f;)if(s[(G=G.scaledTo(G.overscaledZ-1)).key]){v[N.key]=N;break}}}}findLoadedParent(s,f){var y;if(s.key in this._loadedParentTiles)return(y=this._loadedParentTiles[s.key])&&y.tileID.overscaledZ>=f?y:null;for(let T=s.overscaledZ-1;T>=f;T--){var v=s.scaledTo(T),v=this._getLoadedTile(v);if(v)return v}}_getLoadedTile(s){var f=this._tiles[s.key];return f&&f.hasData()?f:this._cache.getByKey(s.wrapped().key)}updateCacheSize(v){var y=Math.ceil(v.width/this._source.tileSize)+1,v=Math.ceil(v.height/this._source.tileSize)+1,f=this._maxTileCacheZoomLevels===null?o.config.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels,y=Math.floor(y*v*f),v=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,y):y;this._cache.setMaxSize(v)}handleWrapJump(s){var f=this._prevLng===void 0?s:this._prevLng,y=Math.round((s-f)/360);if(this._prevLng=s,y){var v={};for(const R in this._tiles){var T=this._tiles[R];T.tileID=T.tileID.unwrapTo(T.tileID.wrap+y),v[T.tileID.key]=T}this._tiles=v;for(const R in this._timers)clearTimeout(this._timers[R]),delete this._timers[R];for(const R in this._tiles){var P=this._tiles[R];this._setTileReloadTimer(R,P)}}}update(s,f){if(this.transform=s,this.terrain=f,this._sourceLoaded&&!this._paused){this.updateCacheSize(s),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={};let ze;this.used||this.usedForTerrain?this._source.tileID?ze=s.getVisibleUnwrappedCoordinates(this._source.tileID).map(Je=>new o.OverscaledTileID(Je.canonical.z,Je.wrap,Je.canonical.z,Je.canonical.x,Je.canonical.y)):(ze=s.coveringTiles({tileSize:(this.usedForTerrain?this:this._source).tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:f}),this._source.hasTile&&(ze=ze.filter(Je=>this._source.hasTile(Je)))):ze=[];var s=s.coveringZoomLevel(this._source),y=Math.max(s-Tt.maxOverzooming,this._source.minzoom),v=Math.max(s+Tt.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){var T,P={};for(const Je of ze)Je.canonical.z>this._source.minzoom&&(P[(T=Je.scaledTo(Je.canonical.z-1)).key]=T,P[(T=Je.scaledTo(Math.max(this._source.minzoom,Math.min(Je.canonical.z,5)))).key]=T);ze=ze.concat(Object.values(P))}var R=ze.length===0&&!this._updated&&this._didEmitContent,N=(this._updated=!0,R&&this.fire(new o.Event("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id})),this._updateRetainedTiles(ze,s));if(Xn(this._source.type)){var G={},Z={},R=Object.keys(N),j=g.now();for(const Xe of R){var X=N[Xe],ge=this._tiles[Xe];!ge||ge.fadeEndTime!==0&&ge.fadeEndTime<=j||((ge=this.findLoadedParent(X,y))&&(this._addTile(ge.tileID),G[ge.tileID.key]=ge.tileID),Z[Xe]=X)}this._retainLoadedChildren(Z,s,v,N);for(const Xe in G)N[Xe]||(this._coveredTiles[Xe]=!0,N[Xe]=G[Xe]);if(f){var ye={},be={};for(const Xe of ze)this._tiles[Xe.key].hasData()?ye[Xe.key]=Xe:be[Xe.key]=Xe;for(const Xe in be){var ve=be[Xe].children(this._source.maxzoom);this._tiles[ve[0].key]&&this._tiles[ve[1].key]&&this._tiles[ve[2].key]&&this._tiles[ve[3].key]&&(ye[ve[0].key]=N[ve[0].key]=ve[0],ye[ve[1].key]=N[ve[1].key]=ve[1],ye[ve[2].key]=N[ve[2].key]=ve[2],ye[ve[3].key]=N[ve[3].key]=ve[3],delete be[Xe])}for(const Xe in be){var Fe=this.findLoadedParent(be[Xe],this._source.minzoom);if(Fe){ye[Fe.tileID.key]=N[Fe.tileID.key]=Fe.tileID;for(const ct in ye)ye[ct].isChildOf(Fe.tileID)&&delete ye[ct]}}for(const Xe in this._tiles)ye[Xe]||(this._coveredTiles[Xe]=!0)}}for(const Je in N)this._tiles[Je].clearFadeHold();for(const Je of o.keysDifference(this._tiles,N)){var Ue=this._tiles[Je];Ue.hasSymbolBuckets&&!Ue.holdingForFade()?Ue.setHoldDuration(this.map._fadeDuration):Ue.hasSymbolBuckets&&!Ue.symbolFadeFinished()||this._removeTile(Je)}this._updateLoadedParentTileCache()}}releaseSymbolFadeTiles(){for(const s in this._tiles)this._tiles[s].holdingForFade()&&this._removeTile(s)}_updateRetainedTiles(s,f){var y={},v={},T=Math.max(f-Tt.maxOverzooming,this._source.minzoom),P=Math.max(f+Tt.maxUnderzooming,this._source.minzoom),R={};for(const ge of s){var N=this._addTile(ge);y[ge.key]=ge,N.hasData()||f<this._source.maxzoom&&(R[ge.key]=ge)}this._retainLoadedChildren(R,f,P,y);for(const ge of s){let ye=this._tiles[ge.key];if(!ye.hasData()){if(f+1>this._source.maxzoom){var G=ge.children(this._source.maxzoom)[0],Z=this.getTile(G);if(Z&&Z.hasData()){y[G.key]=G;continue}}else if(Z=ge.children(this._source.maxzoom),y[Z[0].key]&&y[Z[1].key]&&y[Z[2].key]&&y[Z[3].key])continue;let be=ye.wasRequested();for(let ve=ge.overscaledZ-1;ve>=T;--ve){var j=ge.scaledTo(ve);if(v[j.key])break;if(v[j.key]=!0,ye=!(ye=this.getTile(j))&&be?this._addTile(j):ye){var X=ye.hasData();if((be||X)&&(y[j.key]=j),be=ye.wasRequested(),X)break}}}}return y}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const y in this._tiles){var s=[];let v,T=this._tiles[y].tileID;for(;0<T.overscaledZ;){if(T.key in this._loadedParentTiles){v=this._loadedParentTiles[T.key];break}s.push(T.key);var f=T.scaledTo(T.overscaledZ-1);if(v=this._getLoadedTile(f))break;T=f}for(const P of s)this._loadedParentTiles[P]=v}}_addTile(s){let f=this._tiles[s.key];var y;return f||((f=this._cache.getAndRemove(s))&&(this._setTileReloadTimer(s.key,f),f.tileID=s,this._state.initializeTileState(f,this.map?this.map.painter:null),this._cacheTimers[s.key])&&(clearTimeout(this._cacheTimers[s.key]),delete this._cacheTimers[s.key],this._setTileReloadTimer(s.key,f)),(y=f)||(f=new dn(s,this._source.tileSize*s.overscaleFactor()),this._loadTile(f,s.key,f.state)),f.uses++,this._tiles[s.key]=f,y)||this._source.fire(new o.Event("dataloading",{tile:f,coord:f.tileID,dataType:"source"})),f}_setTileReloadTimer(s,f){s in this._timers&&(clearTimeout(this._timers[s]),delete this._timers[s]),f=f.getExpiryTimeout(),f&&(this._timers[s]=setTimeout(()=>{this._reloadTile(s,"expired"),delete this._timers[s]},f))}_removeTile(s){var f=this._tiles[s];f&&(f.uses--,delete this._tiles[s],this._timers[s]&&(clearTimeout(this._timers[s]),delete this._timers[s]),0<f.uses||(f.hasData()&&f.state!=="reloading"?this._cache.add(f.tileID,f,f.getExpiryTimeout()):(f.aborted=!0,this._abortTile(f),this._unloadTile(f))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const s in this._tiles)this._removeTile(s);this._cache.reset()}tilesIn(s,f,y){var v=[];const T=this.transform;if(T){var y=y?T.getCameraQueryGeometry(s):s,P=s.map(Ue=>T.pointCoordinate(Ue,this.terrain)),R=y.map(Ue=>T.pointCoordinate(Ue,this.terrain)),N=this.getIds();let ye=1/0,be=1/0,ve=-1/0,Fe=-1/0;for(const Ue of R)ye=Math.min(ye,Ue.x),be=Math.min(be,Ue.y),ve=Math.max(ve,Ue.x),Fe=Math.max(Fe,Ue.y);for(let Ue=0;Ue<N.length;Ue++){var G=this._tiles[N[Ue]];if(!G.holdingForFade()){const ze=G.tileID;var Z=Math.pow(2,T.zoom-G.tileID.overscaledZ),j=f*G.queryPadding*o.EXTENT/G.tileSize/Z,X=[ze.getTilePoint(new o.MercatorCoordinate(ye,be)),ze.getTilePoint(new o.MercatorCoordinate(ve,Fe))];X[0].x-j<o.EXTENT&&X[0].y-j<o.EXTENT&&0<=X[1].x+j&&0<=X[1].y+j&&(X=P.map(Qe=>ze.getTilePoint(Qe)),j=R.map(Qe=>ze.getTilePoint(Qe)),v.push({tile:G,tileID:ze,queryGeometry:X,cameraQueryGeometry:j,scale:Z}))}}}return v}getVisibleCoordinates(s){s=this.getRenderableIds(s).map(f=>this._tiles[f].tileID);for(const f of s)f.posMatrix=this.transform.calculatePosMatrix(f.toUnwrapped());return s}hasTransition(){if(this._source.hasTransition())return!0;if(Xn(this._source.type)){var s=g.now();for(const f in this._tiles)if(this._tiles[f].fadeEndTime>=s)return!0}return!1}setFeatureState(s,f,y){this._state.updateState(s=s||"_geojsonTileLayer",f,y)}removeFeatureState(s,f,y){this._state.removeFeatureState(s=s||"_geojsonTileLayer",f,y)}getFeatureState(s,f){return this._state.getState(s=s||"_geojsonTileLayer",f)}setDependencies(s,f,y){s=this._tiles[s],s&&s.setDependencies(f,y)}reloadTilesForDependencies(s,f){for(const y in this._tiles)this._tiles[y].hasDependency(s,f)&&this._reloadTile(y,"reloading");this._cache.filter(y=>!y.hasDependency(s,f))}}function Rn(w,s){var f=Math.abs(2*w.wrap)-(w.wrap<0),y=Math.abs(2*s.wrap)-(s.wrap<0);return w.overscaledZ-s.overscaledZ||y-f||s.canonical.y-w.canonical.y||s.canonical.x-w.canonical.x}function Xn(w){return w==="raster"||w==="image"||w==="video"}Tt.maxOverzooming=10,Tt.maxUnderzooming=3;class nn{constructor(s,f){this.reset(s,f)}reset(s,f){this.points=s||[],this._distances=[0];for(let y=1;y<this.points.length;y++)this._distances[y]=this._distances[y-1]+this.points[y].dist(this.points[y-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(f||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(T){if(this.points.length===1)return this.points[0];T=o.clamp(T,0,1);let f=1,y=this._distances[f];for(var v=T*this.paddedLength+this.padding;y<v&&f<this._distances.length;)y=this._distances[++f];var T=f-1,R=this._distances[T],P=y-R,R=0<P?(v-R)/P:0;return this.points[T].mult(1-R).add(this.points[f].mult(R))}}function Lr(w,s){return w==="always"||w!=="never"&&s!=="never"}class Qr{constructor(s,f,y){var v=this.boxCells=[],T=this.circleCells=[];this.xCellCount=Math.ceil(s/y),this.yCellCount=Math.ceil(f/y);for(let P=0;P<this.xCellCount*this.yCellCount;P++)v.push([]),T.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=s,this.height=f,this.xScale=this.xCellCount/s,this.yScale=this.yCellCount/f,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(s,f,y,v,T){this._forEachCell(f,y,v,T,this._insertBoxCell,this.boxUid++),this.boxKeys.push(s),this.bboxes.push(f),this.bboxes.push(y),this.bboxes.push(v),this.bboxes.push(T)}insertCircle(s,f,y,v){this._forEachCell(f-v,y-v,f+v,y+v,this._insertCircleCell,this.circleUid++),this.circleKeys.push(s),this.circles.push(f),this.circles.push(y),this.circles.push(v)}_insertBoxCell(s,f,y,v,T,P){this.boxCells[T].push(P)}_insertCircleCell(s,f,y,v,T,P){this.circleCells[T].push(P)}_query(s,f,y,v,T,P,R){if(y<0||s>this.width||v<0||f>this.height)return[];var N=[];if(s<=0&&f<=0&&this.width<=y&&this.height<=v){if(T)return[{key:null,x1:s,y1:f,x2:y,y2:v}];for(let X=0;X<this.boxKeys.length;X++)N.push({key:this.boxKeys[X],x1:this.bboxes[4*X],y1:this.bboxes[4*X+1],x2:this.bboxes[4*X+2],y2:this.bboxes[4*X+3]});for(let X=0;X<this.circleKeys.length;X++){var G=this.circles[3*X],Z=this.circles[3*X+1],j=this.circles[3*X+2];N.push({key:this.circleKeys[X],x1:G-j,y1:Z-j,x2:G+j,y2:Z+j})}}else this._forEachCell(s,f,y,v,this._queryCell,N,{hitTest:T,overlapMode:P,seenUids:{box:{},circle:{}}},R);return N}query(s,f,y,v){return this._query(s,f,y,v,!1,null)}hitTest(s,f,y,v,T,P){return 0<this._query(s,f,y,v,!0,T,P).length}hitTestCircle(s,f,y,v,T){var P=s-y,R=s+y,N=f-y,G=f+y;return!(R<0||P>this.width||G<0||N>this.height)&&(this._forEachCell(P,N,R,G,this._queryCellCircle,P=[],{hitTest:!0,overlapMode:v,circle:{x:s,y:f,radius:y},seenUids:{box:{},circle:{}}},T),0<P.length)}_queryCell(s,f,y,v,T,P,X,N){var{seenUids:G,hitTest:Z,overlapMode:j}=X,X=this.boxCells[T];if(X!==null){var ge=this.bboxes;for(const Je of X)if(!G.box[Je]){G.box[Je]=!0;var ye=4*Je,be=this.boxKeys[Je];if(s<=ge[2+ye]&&f<=ge[3+ye]&&y>=ge[0+ye]&&v>=ge[1+ye]&&(!N||N(be))&&(!Z||!Lr(j,be.overlapMode))&&(P.push({key:be,x1:ge[ye],y1:ge[1+ye],x2:ge[2+ye],y2:ge[3+ye]}),Z))return!0}}if(X=this.circleCells[T],X!==null){var ve=this.circles;for(const Je of X)if(!G.circle[Je]){G.circle[Je]=!0;var Fe=3*Je,Ue=this.circleKeys[Je];if(this._circleAndRectCollide(ve[Fe],ve[1+Fe],ve[2+Fe],s,f,y,v)&&(!N||N(Ue))&&(!Z||!Lr(j,Ue.overlapMode))){var ze=ve[Fe],Qe=ve[1+Fe],Fe=ve[2+Fe];if(P.push({key:Ue,x1:ze-Fe,y1:Qe-Fe,x2:ze+Fe,y2:Qe+Fe}),Z)return!0}}}return!1}_queryCellCircle(s,f,y,v,T,P,X,N){var{circle:G,seenUids:Z,overlapMode:j}=X,X=this.boxCells[T];if(X!==null){var ge=this.bboxes;for(const ze of X)if(!Z.box[ze]){Z.box[ze]=!0;var ye=4*ze,be=this.boxKeys[ze];if(this._circleAndRectCollide(G.x,G.y,G.radius,ge[0+ye],ge[1+ye],ge[2+ye],ge[3+ye])&&(!N||N(be))&&!Lr(j,be.overlapMode))return P.push(!0),!0}}if(X=this.circleCells[T],X!==null){var ve=this.circles;for(const ze of X)if(!Z.circle[ze]){Z.circle[ze]=!0;var Fe=3*ze,Ue=this.circleKeys[ze];if(this._circlesCollide(ve[Fe],ve[1+Fe],ve[2+Fe],G.x,G.y,G.radius)&&(!N||N(Ue))&&!Lr(j,Ue.overlapMode))return P.push(!0),!0}}}_forEachCell(s,f,y,v,T,P,R,N){var G=this._convertToXCellCoord(s),Z=this._convertToYCellCoord(f),j=this._convertToXCellCoord(y),X=this._convertToYCellCoord(v);for(let ye=G;ye<=j;ye++)for(let be=Z;be<=X;be++){var ge=this.xCellCount*be+ye;if(T.call(this,s,f,y,v,ge,P,R,N))return}}_convertToXCellCoord(s){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(s*this.xScale)))}_convertToYCellCoord(s){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(s*this.yScale)))}_circlesCollide(s,f,y,v,T,P){return v-=s,s=T-f,T=y+P,v*v+s*s<T*T}_circleAndRectCollide(s,f,y,v,T,P,R){return P=(P-v)/2,s=Math.abs(s-(v+P)),!(P+y<s||(v=(R-T)/2)+y<(R=Math.abs(f-(T+v)))||!(s<=P||R<=v||(f=s-P)*f+(T=R-v)*T<=y*y))}}function Tr(w,s,f,y,v){var T=o.create();return s?(o.scale(T,T,[1/v,1/v,1]),f||o.rotateZ(T,T,y.angle)):o.multiply(T,y.labelPlaneMatrix,w),T}function oe(w,s,f,y,v){return s?(s=o.clone(w),o.scale(s,s,[v,v,1]),f||o.rotateZ(s,s,-y.angle),s):y.glCoordMatrix}function V(w,s,f){let y;return f?(y=[w.x,w.y,f(w.x,w.y),1],o.transformMat4(y,y,s)):St(y=[w.x,w.y,0,1],y,s),f=y[3],{point:new o.Point(y[0]/f,y[1]/f),signedDistanceFromCamera:f}}function $(w,s){return .5+w/s*.5}function K(w,ve,f,y,v,T,P,R,N,G,Z,j,X){var Fe=R.glyphStartIndex+R.numGlyphs,ge=R.lineStartIndex,ye=R.lineStartIndex+R.lineLength,be=ve.getoffsetX(R.glyphStartIndex),ve=ve.getoffsetX(Fe-1),Fe=De(w*be,f,y,v,T,P,R.segment,ge,ye,N,G,Z,j,X);return Fe&&(be=De(w*ve,f,y,v,T,P,R.segment,ge,ye,N,G,Z,j,X))?{first:Fe,last:be}:null}function me(w,s,f,y){if(w===o.WritingMode.horizontal){var v=Math.abs(f.y-s.y);if(Math.abs(f.x-s.x)*y<v)return{useVertical:!0}}return(w===o.WritingMode.vertical?s.y<f.y:s.x>f.x)?{needsFlipping:!0}:null}function Oe(w,s,f,y,v,T,P,R,N,G,Z,j,X,ge,ye,be){var ve=s/24,Fe=w.lineOffsetX*ve,Ue=w.lineOffsetY*ve;let ze;if(1<w.numGlyphs){var Qe=w.glyphStartIndex+w.numGlyphs,Je=w.lineStartIndex,Xe=w.lineStartIndex+w.lineLength,s=K(ve,R,Fe,Ue,f,Z,j,w,N,T,X,ye,be);if(!s)return{notEnoughRoom:!0};var ct=V(s.first.point,P,be).point,P=V(s.last.point,P,be).point;if(y&&!f&&(ct=me(w.writingMode,ct,P,ge),ct))return ct;ze=[s.first];for(let Dt=w.glyphStartIndex+1;Dt<Qe-1;Dt++)ze.push(De(ve*R.getoffsetX(Dt),Fe,Ue,f,Z,j,w.segment,Je,Xe,N,T,X,ye,be));ze.push(s.last)}else{if(y&&!f&&(P=V(j,v,be).point,ct=w.lineStartIndex+w.segment+1,s=new o.Point(N.getx(ct),N.gety(ct)),y=V(s,v,be),ct=0<y.signedDistanceFromCamera?y.point:He(j,s,P,1,v,be),y=me(w.writingMode,P,ct,ge),y))return y;if(s=De(ve*R.getoffsetX(w.glyphStartIndex),Fe,Ue,f,Z,j,w.segment,w.lineStartIndex,w.lineStartIndex+w.lineLength,N,T,X,ye,be),!s)return{notEnoughRoom:!0};ze=[s]}for(const it of ze)o.addDynamicAttributes(G,it.point,it.angle);return{}}function He(w,s,f,y,v,T){return w=V(w.add(w.sub(s)._unit()),v,T).point,s=f.sub(w),f.add(s._mult(y/s.mag()))}function Le(w,v){var f,y,{projectionCache:v,lineVertexArray:T,labelPlaneMatrix:P,tileAnchorPoint:R,distanceFromAnchor:N,getElevation:G,previousVertex:Z,direction:j,absOffsetX:X}=v;return v.projections[w]||(0<(y=V(f=new o.Point(T.getx(w),T.gety(w)),P,G)).signedDistanceFromCamera?(v.projections[w]=y.point,y.point):(v=w-j,He(N===0?R:new o.Point(T.getx(v),T.gety(v)),f,Z,X-N+1,P,G)))}function Ce(w,s,f){return w._unit()._perp()._mult(s*f)}function De(w,s,f,y,v,T,P,R,N,G,Z,j,X,ge){w=y?w-s:w+s;let ye=0<w?1:-1,be=0,ve=(y&&(ye*=-1,be=Math.PI),ye<0&&(be+=Math.PI),0<ye?R+P:R+P+1),Fe=v,Ue=v,ze,Qe,Je=0,Xe=0;var ct=Math.abs(w),it=[];let _t;for(;Je+Xe<=ct;){if((ve+=ye)<R||ve>=N)return null;Je+=Xe,Ue=Fe,Qe=ze;var Dt={projectionCache:j,lineVertexArray:G,labelPlaneMatrix:Z,tileAnchorPoint:T,distanceFromAnchor:Je,getElevation:ge,previousVertex:Ue,direction:ye,absOffsetX:ct};if(Fe=Le(ve,Dt),f===0)it.push(Ue),_t=Fe.sub(Ue);else{let _n;var Yt=Fe.sub(Ue);_n=Yt.mag()===0?Ce(Le(ve+ye,Dt).sub(Fe),f,ye):Ce(Yt,f,ye),Qe=Qe||Ue.add(_n),ze=function(vn,Kt,Ct,cn,Cn,$t,tr,Ir){var{projectionCache:Qn,direction:or}=Ir;if(!Qn.offsets[vn]){if(Kt=Ct.add(Kt),vn+or<cn||Cn<=vn+or)return Qn.offsets[vn]=Kt;cn=Le(vn+or,Ir),Cn=Ce(cn.sub(Ct),tr,or),Ir=Ct.add(Cn),tr=cn.add(Cn),Qn.offsets[vn]=o.findLineIntersection($t,Kt,Ir,tr)||Kt}return Qn.offsets[vn]}(ve,_n,Fe,R,N,Qe,f,Dt),it.push(Qe),_t=ze.sub(Qe)}Xe=_t.mag()}return s=(ct-Je)/Xe,y=_t._mult(s)._add(Qe||Ue),P=be+Math.atan2(Fe.y-Ue.y,Fe.x-Ue.x),it.push(y),{point:y,angle:X?P:0,path:it}}const ot=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function st(w,s){for(let y=0;y<w;y++){var f=s.length;s.resize(f+4),s.float32.set(ot,3*f)}}function St(w,v,f){var y=v[0],v=v[1];w[0]=f[0]*y+f[4]*v+f[12],w[1]=f[1]*y+f[5]*v+f[13],w[3]=f[3]*y+f[7]*v+f[15]}class un{constructor(s,f=new Qr(s.width+200,s.height+200,25),y=new Qr(s.width+200,s.height+200,25)){this.transform=s,this.grid=f,this.ignoredGrid=y,this.pitchfactor=Math.cos(s._pitch)*s.cameraToCenterDistance,this.screenRightBoundary=s.width+100,this.screenBottomBoundary=s.height+100,this.gridRightBoundary=s.width+200,this.gridBottomBoundary=s.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(X,f,G,R,T,N){var R=this.projectAndGetPerspectiveRatio(R,X.anchorPointX,X.anchorPointY,N),N=G*R.perspectiveRatio,G=X.x1*N+R.point.x,Z=X.y1*N+R.point.y,j=X.x2*N+R.point.x,X=X.y2*N+R.point.y;return!this.isInsideGrid(G,Z,j,X)||f!=="always"&&this.grid.hitTest(G,Z,j,X,f,T)||R.perspectiveRatio<this.perspectiveRatioCutoff?{box:[],offscreen:!1}:{box:[G,Z,j,X],offscreen:this.isOffscreen(G,Z,j,X)}}placeCollisionCircles(s,f,y,Qe,ze,Fe,R,N,G,Ue,j,X,ge,ye){var be=[],ve=new o.Point(f.anchorX,f.anchorY),Fe=V(ve,Fe,ye),Fe=$(this.transform.cameraToCenterDistance,Fe.signedDistanceFromCamera),Ue=(Ue?ze/Fe:ze*Fe)/o.ONE_EM,ze=V(ve,R,ye).point,Qe=K(Ue,Qe,f.lineOffsetX*Ue,f.lineOffsetY*Ue,!1,ze,ve,f,y,R,{projections:{},offsets:{}},!1,ye);let Je=!1,Xe=!1,ct=!0;if(Qe){var it=.5*X*Fe+ge,Ue=new o.Point(-100,-100),ze=new o.Point(this.screenRightBoundary,this.screenBottomBoundary),_t=new nn,Dt=Qe.first,Yt=Qe.last;let Ln=[];for(let ar=Dt.path.length-1;1<=ar;ar--)Ln.push(Dt.path[ar]);for(let ar=1;ar<Yt.path.length;ar++)Ln.push(Yt.path[ar]);var _n=2.5*it;N&&(ve=Ln.map(ar=>V(ar,N,ye)),Ln=ve.some(ar=>ar.signedDistanceFromCamera<=0)?[]:ve.map(ar=>ar.point));let Pr=[];if(0<Ln.length){var vn=Ln[0].clone(),Kt=Ln[0].clone();for(let ar=1;ar<Ln.length;ar++)vn.x=Math.min(vn.x,Ln[ar].x),vn.y=Math.min(vn.y,Ln[ar].y),Kt.x=Math.max(Kt.x,Ln[ar].x),Kt.y=Math.max(Kt.y,Ln[ar].y);Pr=vn.x>=Ue.x&&Kt.x<=ze.x&&vn.y>=Ue.y&&Kt.y<=ze.y?[Ln]:Kt.x<Ue.x||vn.x>ze.x||Kt.y<Ue.y||vn.y>ze.y?[]:o.clipLine([Ln],Ue.x,Ue.y,ze.x,ze.y)}for(const ar of Pr){_t.reset(ar,.25*it);let wr=0;wr=_t.length<=.5*it?1:Math.ceil(_t.paddedLength/_n)+1;for(let _o=0;_o<wr;_o++){var cn=_o/Math.max(wr-1,1),cn=_t.lerp(cn),Ct=cn.x+100,cn=cn.y+100,Cn=(be.push(Ct,cn,it,0),Ct-it),$t=cn-it,tr=Ct+it,Ir=cn+it;if(ct=ct&&this.isOffscreen(Cn,$t,tr,Ir),Xe=Xe||this.isInsideGrid(Cn,$t,tr,Ir),s!=="always"&&this.grid.hitTestCircle(Ct,cn,it,s,j)&&(Je=!0,!G))return{circles:[],offscreen:!1,collisionDetected:Je}}}}return{circles:!G&&Je||!Xe||Fe<this.perspectiveRatioCutoff?[]:be,offscreen:ct,collisionDetected:Je}}queryRenderedSymbols(s){if(s.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};var f=[];let y=1/0,v=1/0,T=-1/0,P=-1/0;for(const X of s){var R=new o.Point(X.x+100,X.y+100);y=Math.min(y,R.x),v=Math.min(v,R.y),T=Math.max(T,R.x),P=Math.max(P,R.y),f.push(R)}var N={},G={};for(const X of this.grid.query(y,v,T,P).concat(this.ignoredGrid.query(y,v,T,P))){var Z,j=X.key;N[j.bucketInstanceId]===void 0&&(N[j.bucketInstanceId]={}),N[j.bucketInstanceId][j.featureIndex]||(Z=[new o.Point(X.x1,X.y1),new o.Point(X.x2,X.y1),new o.Point(X.x2,X.y2),new o.Point(X.x1,X.y2)],o.polygonIntersectsPolygon(f,Z)&&(N[j.bucketInstanceId][j.featureIndex]=!0,G[j.bucketInstanceId]===void 0&&(G[j.bucketInstanceId]=[]),G[j.bucketInstanceId].push(j.featureIndex)))}return G}insertCollisionBox(s,f,y,v,T,P){(y?this.ignoredGrid:this.grid).insert({bucketInstanceId:v,featureIndex:T,collisionGroupID:P,overlapMode:f},s[0],s[1],s[2],s[3])}insertCollisionCircles(s,f,y,v,T,P){var R=y?this.ignoredGrid:this.grid,N={bucketInstanceId:v,featureIndex:T,collisionGroupID:P,overlapMode:f};for(let G=0;G<s.length;G+=4)R.insertCircle(N,s[G],s[G+1],s[G+2])}projectAndGetPerspectiveRatio(s,f,y,v){let T;return v?(T=[f,y,v(f,y),1],o.transformMat4(T,T,s)):St(T=[f,y,0,1],T,s),{point:new o.Point((T[0]/T[3]+1)/2*this.transform.width+100,(-T[1]/T[3]+1)/2*this.transform.height+100),perspectiveRatio:.5+this.transform.cameraToCenterDistance/T[3]*.5}}isOffscreen(s,f,y,v){return y<100||s>=this.screenRightBoundary||v<100||f>this.screenBottomBoundary}isInsideGrid(s,f,y,v){return 0<=y&&s<this.gridRightBoundary&&0<=v&&f<this.gridBottomBoundary}getViewportMatrix(){var s=o.identity([]);return o.translate(s,s,[-100,-100,0]),s}}function en(w,s,f){return s*(o.EXTENT/(w.tileSize*Math.pow(2,f-w.tileID.overscaledZ)))}class yn{constructor(s,f,y,v){this.opacity=s?Math.max(0,Math.min(1,s.opacity+(s.placed?f:-f))):v&&y?1:0,this.placed=y}isHidden(){return this.opacity===0&&!this.placed}}class Kn{constructor(s,f,y,v,T){this.text=new yn(s?s.text:null,f,y,T),this.icon=new yn(s?s.icon:null,f,v,T)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class er{constructor(s,f,y){this.text=s,this.icon=f,this.skipFade=y}}class On{constructor(){this.invProjMatrix=o.create(),this.viewportMatrix=o.create(),this.circles=[]}}class Dn{constructor(s,f,y,v,T){this.bucketInstanceId=s,this.featureIndex=f,this.sourceLayerIndex=y,this.bucketIndex=v,this.tileID=T}}class fn{constructor(s){this.crossSourceCollisions=s,this.maxGroupID=0,this.collisionGroups={}}get(s){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[s]){const f=++this.maxGroupID;this.collisionGroups[s]={ID:f,predicate:y=>y.collisionGroupID===f}}return this.collisionGroups[s]}}function pn(T,s,f,y,v){var{horizontalAlign:T,verticalAlign:P}=o.getAnchorAlignment(T);return new o.Point(-(T-.5)*s+y[0]*v,-(P-.5)*f+y[1]*v)}function Wn(P,X,f,y,v,T){var{x1:P,x2:R,y1:N,y2:G,anchorPointX:Z,anchorPointY:j}=P,X=new o.Point(X,f);return y&&X._rotate(v?T:-T),{x1:P+X.x,y1:N+X.y,x2:R+X.x,y2:G+X.y,anchorPointX:Z,anchorPointY:j}}class Nr{constructor(s,f,y,v,T){this.transform=s.clone(),this.terrain=f,this.collisionIndex=new un(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=y,this.retainedQueryData={},this.collisionGroups=new fn(v),this.collisionCircleArrays={},(this.prevPlacement=T)&&(T.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(s,f,y,v){var T=y.getBucket(f),P=y.latestFeatureIndex;if(T&&P&&f.id===T.layerIds[0]){var f=y.collisionBoxArray,R=T.layers[0].layout,N=Math.pow(2,this.transform.zoom-y.tileID.overscaledZ),G=y.tileSize/o.EXTENT,Z=this.transform.calculatePosMatrix(y.tileID.toUnwrapped()),j=R.get("text-pitch-alignment")==="map",X=R.get("text-rotation-alignment")==="map",ge=en(y,1,this.transform.zoom),ye=Tr(Z,j,X,this.transform,ge);let Qe=null;j&&(j=oe(Z,j,X,this.transform,ge),Qe=o.multiply([],this.transform.labelPlaneMatrix,j)),this.retainedQueryData[T.bucketInstanceId]=new Dn(T.bucketInstanceId,P,T.sourceLayerIndex,T.index,y.tileID);var be={bucket:T,layout:R,posMatrix:Z,textLabelPlaneMatrix:ye,labelToScreenMatrix:Qe,scale:N,textPixelRatio:G,holdingForFade:y.holdingForFade(),collisionBoxArray:f,partiallyEvaluatedTextSize:o.evaluateSizeForZoom(T.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(T.sourceID)};if(v)for(const Je of T.sortKeyRanges){var{sortKey:ve,symbolInstanceStart:Fe,symbolInstanceEnd:Ue}=Je;s.push({sortKey:ve,symbolInstanceStart:Fe,symbolInstanceEnd:Ue,parameters:be})}else s.push({symbolInstanceStart:0,symbolInstanceEnd:T.symbolInstances.length,parameters:be})}}attemptAnchorPlacement(Ue,Qe,y,v,T,P,R,N,G,Z,j,X,ge,ye,be,ve){var Fe=o.TextAnchorEnum[Ue.textAnchor],Ue=[Ue.textOffset0,Ue.textOffset1],ze=pn(Fe,y,v,Ue,T),Qe=this.collisionIndex.placeCollisionBox(Wn(Qe,ze.x,ze.y,P,R,this.transform.angle),j,N,G,Z.predicate,ve);if(!(be&&this.collisionIndex.placeCollisionBox(Wn(be,ze.x,ze.y,P,R,this.transform.angle),j,N,G,Z.predicate,ve).box.length===0)&&0<Qe.box.length){let Je;if(this.prevPlacement&&this.prevPlacement.variableOffsets[X.crossTileID]&&this.prevPlacement.placements[X.crossTileID]&&this.prevPlacement.placements[X.crossTileID].text&&(Je=this.prevPlacement.variableOffsets[X.crossTileID].anchor),X.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[X.crossTileID]={textOffset:Ue,width:y,height:v,anchor:Fe,textBoxScale:T,prevAnchor:Je},this.markUsedJustification(ge,Fe,X,ye),ge.allowVerticalPlacement&&(this.markUsedOrientation(ge,ye,X),this.placedOrientations[X.crossTileID]=ye),{shift:ze,placedGlyphBoxes:Qe}}}placeLayerBucketPart(s,f,y){const{bucket:v,layout:T,posMatrix:P,textLabelPlaneMatrix:R,labelToScreenMatrix:N,textPixelRatio:G,holdingForFade:Z,collisionBoxArray:j,partiallyEvaluatedTextSize:X,collisionGroup:ge}=s.parameters,ye=T.get("text-optional"),be=T.get("icon-optional"),ve=o.getOverlapMode(T,"text-overlap","text-allow-overlap"),Fe=ve==="always",Ue=o.getOverlapMode(T,"icon-overlap","icon-allow-overlap");var ze=Ue==="always";const Qe=T.get("text-rotation-alignment")==="map",Je=T.get("text-pitch-alignment")==="map",Xe=T.get("icon-text-fit")!=="none";var ct=T.get("symbol-z-order")==="viewport-y";const it=Fe&&(ze||!v.hasIconData()||be),_t=ze&&(Fe||!v.hasTextData()||ye),Dt=(!v.collisionArrays&&j&&v.deserializeCollisionBoxes(j),this.retainedQueryData[v.bucketInstanceId].tileID),Yt=this.terrain?(Ct,cn)=>this.terrain.getElevation(Dt,Ct,cn):null;var _n=(Ct,cn)=>{if(!f[Ct.crossTileID])if(Z)this.placements[Ct.crossTileID]=new er(!1,!1,!1);else{let or=!1,Ln=!1,Pr=!0,ar=null,wr={box:null,offscreen:null},_o={box:null,offscreen:null},Qi=null,gs=null,vo=0,oi=0,pi=0;cn.textFeatureIndex?vo=cn.textFeatureIndex:Ct.useRuntimeCollisionCircles&&(vo=Ct.featureIndex),cn.verticalTextFeatureIndex&&(oi=cn.verticalTextFeatureIndex);const js=cn.textBox;if(js){var Cn=jr=>{let $r=o.WritingMode.horizontal;return v.allowVerticalPlacement&&!jr&&this.prevPlacement&&(jr=this.prevPlacement.placedOrientations[Ct.crossTileID])&&(this.placedOrientations[Ct.crossTileID]=jr,$r=jr,this.markUsedOrientation(v,$r,Ct)),$r},$t=(jr,$r)=>{if(v.allowVerticalPlacement&&0<Ct.numVerticalGlyphVertices&&cn.verticalTextBox){for(const Io of v.writingModes)if(Io===o.WritingMode.vertical?(wr=$r(),_o=wr):wr=jr(),wr&&wr.box&&wr.box.length)break}else wr=jr()};const zr=Ct.textAnchorOffsetStartIndex,bo=Ct.textAnchorOffsetEndIndex;if(bo===zr){const jr=($r,Io)=>($r=this.collisionIndex.placeCollisionBox($r,ve,G,P,ge.predicate,Yt),$r&&$r.box&&$r.box.length&&(this.markUsedOrientation(v,Io,Ct),this.placedOrientations[Ct.crossTileID]=Io),$r);$t(()=>jr(js,o.WritingMode.horizontal),()=>{var $r=cn.verticalTextBox;return v.allowVerticalPlacement&&0<Ct.numVerticalGlyphVertices&&$r?jr($r,o.WritingMode.vertical):{box:null,offscreen:null}}),Cn(wr&&wr.box&&wr.box.length)}else{let jr=o.TextAnchorEnum[(tr=(tr=this.prevPlacement)==null?void 0:tr.variableOffsets[Ct.crossTileID])==null?void 0:tr.anchor];const $r=(ai,Ji,jc)=>{var Vs=ai.x2-ai.x1,Fi=ai.y2-ai.y1,Hs=Ct.textBoxScale,Vc=Xe&&Ue==="never"?Ji:null;let Zr={box:[],offscreen:!1},Mi=ve==="never"?1:2,Gs="never";jr&&Mi++;for(let th=0;th<Mi;th++){for(let Hc=zr;Hc<bo;Hc++){var qs=v.textAnchorOffsets.get(Hc);if((!jr||qs.textAnchor===jr)&&(qs=this.attemptAnchorPlacement(qs,ai,Vs,Fi,Hs,Qe,Je,G,P,ge,Gs,Ct,v,jc,Vc,Yt),qs&&(Zr=qs.placedGlyphBoxes)&&Zr.box&&Zr.box.length))return or=!0,ar=qs.shift,Zr}jr?jr=null:Gs=ve}return Zr};$t(()=>$r(js,cn.iconBox,o.WritingMode.horizontal),()=>{var ai=cn.verticalTextBox,Ji=wr&&wr.box&&wr.box.length;return v.allowVerticalPlacement&&!Ji&&0<Ct.numVerticalGlyphVertices&&ai?$r(ai,cn.verticalIconBox,o.WritingMode.vertical):{box:null,offscreen:null}}),wr&&(or=wr.box,Pr=wr.offscreen);var tr=Cn(wr&&wr.box);!or&&this.prevPlacement&&($t=this.prevPlacement.variableOffsets[Ct.crossTileID])&&(this.variableOffsets[Ct.crossTileID]=$t,this.markUsedJustification(v,$t.anchor,Ct,tr))}}Cn=wr,or=Cn&&Cn.box&&0<Cn.box.length,Pr=Cn&&Cn.offscreen,Ct.useRuntimeCollisionCircles&&($t=v.text.placedSymbolArray.get(Ct.centerJustifiedTextSymbolIndex),tr=o.evaluateSizeForFeature(v.textSizeData,X,$t),Qn=T.get("text-padding"),Ir=Ct.collisionCircleDiameter,(Qi=this.collisionIndex.placeCollisionCircles(ve,$t,v.lineVertexArray,v.glyphOffsetArray,tr,P,R,N,y,Je,ge.predicate,Ir,Qn,Yt)).circles.length&&Qi.collisionDetected&&!y&&o.warnOnce("Collisions detected, but collision boxes are not shown"),or=Fe||0<Qi.circles.length&&!Qi.collisionDetected,Pr=Pr&&Qi.offscreen),cn.iconFeatureIndex&&(pi=cn.iconFeatureIndex),cn.iconBox&&($t=zr=>(zr=Xe&&ar?Wn(zr,ar.x,ar.y,Qe,Je,this.transform.angle):zr,this.collisionIndex.placeCollisionBox(zr,Ue,G,P,ge.predicate,Yt)),Ln=0<(gs=_o&&_o.box&&_o.box.length&&cn.verticalIconBox?$t(cn.verticalIconBox):$t(cn.iconBox)).box.length,Pr=Pr&&gs.offscreen);var tr=ye||Ct.numHorizontalGlyphVertices===0&&Ct.numVerticalGlyphVertices===0,Ir=be||Ct.numIconVertices===0;if(tr||Ir?Ir?tr||(Ln=Ln&&or):or=Ln&&or:Ln=or=Ln&&or,or&&Cn&&Cn.box&&(_o&&_o.box&&oi?this.collisionIndex.insertCollisionBox(Cn.box,ve,T.get("text-ignore-placement"),v.bucketInstanceId,oi,ge.ID):this.collisionIndex.insertCollisionBox(Cn.box,ve,T.get("text-ignore-placement"),v.bucketInstanceId,vo,ge.ID)),Ln&&gs&&this.collisionIndex.insertCollisionBox(gs.box,Ue,T.get("icon-ignore-placement"),v.bucketInstanceId,pi,ge.ID),Qi&&(or&&this.collisionIndex.insertCollisionCircles(Qi.circles,ve,T.get("text-ignore-placement"),v.bucketInstanceId,vo,ge.ID),y)){var Qn=v.bucketInstanceId;let zr=this.collisionCircleArrays[Qn];zr===void 0&&(zr=this.collisionCircleArrays[Qn]=new On);for(let bo=0;bo<Qi.circles.length;bo+=4)zr.circles.push(Qi.circles[bo+0]),zr.circles.push(Qi.circles[bo+1]),zr.circles.push(Qi.circles[bo+2]),zr.circles.push(Qi.collisionDetected?1:0)}if(Ct.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(v.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[Ct.crossTileID]=new er(or||it,Ln||_t,Pr||v.justReloaded),f[Ct.crossTileID]=!0}};if(ct){if(s.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");var vn=v.getSortedSymbolIndexes(this.transform.angle);for(let Ct=vn.length-1;0<=Ct;--Ct){var Kt=vn[Ct];_n(v.symbolInstances.get(Kt),v.collisionArrays[Kt])}}else for(let Ct=s.symbolInstanceStart;Ct<s.symbolInstanceEnd;Ct++)_n(v.symbolInstances.get(Ct),v.collisionArrays[Ct]);y&&v.bucketInstanceId in this.collisionCircleArrays&&(ze=this.collisionCircleArrays[v.bucketInstanceId],o.invert(ze.invProjMatrix,P),ze.viewportMatrix=this.collisionIndex.getViewportMatrix()),v.justReloaded=!1}markUsedJustification(s,f,y,v){var T={left:y.leftJustifiedTextSymbolIndex,center:y.centerJustifiedTextSymbolIndex,right:y.rightJustifiedTextSymbolIndex};let P;P=v===o.WritingMode.vertical?y.verticalPlacedTextSymbolIndex:T[o.getAnchorJustification(f)];for(const R of[y.leftJustifiedTextSymbolIndex,y.centerJustifiedTextSymbolIndex,y.rightJustifiedTextSymbolIndex,y.verticalPlacedTextSymbolIndex])0<=R&&(0<=P&&R!==P?s.text.placedSymbolArray.get(R).crossTileID=0:s.text.placedSymbolArray.get(R).crossTileID=y.crossTileID)}markUsedOrientation(s,T,y){var v=T===o.WritingMode.horizontal||T===o.WritingMode.horizontalOnly?T:0,T=T===o.WritingMode.vertical?T:0;for(const P of[y.leftJustifiedTextSymbolIndex,y.centerJustifiedTextSymbolIndex,y.rightJustifiedTextSymbolIndex])s.text.placedSymbolArray.get(P).placedOrientation=v;y.verticalPlacedTextSymbolIndex&&(s.text.placedSymbolArray.get(y.verticalPlacedTextSymbolIndex).placedOrientation=T)}commit(s){this.commitTime=s,this.zoomAtLastRecencyCheck=this.transform.zoom;var f=this.prevPlacement;let y=!1;this.prevZoomAdjustment=f?f.zoomAdjustment(this.transform.zoom):0;var v=f?f.symbolFadeChange(s):1,T=f?f.opacities:{},P=f?f.variableOffsets:{},R=f?f.placedOrientations:{};for(const X in this.placements){var N=this.placements[X],G=T[X];y=G?(this.opacities[X]=new Kn(G,v,N.text,N.icon),y||N.text!==G.text.placed||N.icon!==G.icon.placed):(this.opacities[X]=new Kn(null,v,N.text,N.icon,N.skipFade),y||N.text||N.icon)}for(const X in T){var Z,j=T[X];this.opacities[X]||(Z=new Kn(j,v,!1,!1)).isHidden()||(this.opacities[X]=Z,y=y||j.text.placed||j.icon.placed)}for(const X in P)this.variableOffsets[X]||!this.opacities[X]||this.opacities[X].isHidden()||(this.variableOffsets[X]=P[X]);for(const X in R)this.placedOrientations[X]||!this.opacities[X]||this.opacities[X].isHidden()||(this.placedOrientations[X]=R[X]);if(f&&f.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");y?this.lastPlacementChangeTime=s:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=f?f.lastPlacementChangeTime:s)}updateLayerOpacities(s,f){var y={};for(const T of f){var v=T.getBucket(s);v&&T.latestFeatureIndex&&s.id===v.layerIds[0]&&this.updateBucketOpacities(v,y,T.collisionBoxArray)}}updateBucketOpacities(s,f,y){s.hasTextData()&&(s.text.opacityVertexArray.clear(),s.text.hasVisibleVertices=!1),s.hasIconData()&&(s.icon.opacityVertexArray.clear(),s.icon.hasVisibleVertices=!1),s.hasIconCollisionBoxData()&&s.iconCollisionBox.collisionVertexArray.clear(),s.hasTextCollisionBoxData()&&s.textCollisionBox.collisionVertexArray.clear();var v=s.layers[0],T=v.layout,P=new Kn(null,0,!1,!1,!0),R=T.get("text-allow-overlap"),N=T.get("icon-allow-overlap"),G=v._unevaluatedLayout.hasValue("text-variable-anchor")||v._unevaluatedLayout.hasValue("text-variable-anchor-offset"),Z=T.get("text-rotation-alignment")==="map",j=T.get("text-pitch-alignment")==="map",X=T.get("icon-text-fit")!=="none",ge=new Kn(null,0,R&&(N||!s.hasIconData()||T.get("icon-optional")),N&&(R||!s.hasTextData()||T.get("text-optional")),!0),ye=(!s.collisionArrays&&y&&(s.hasIconCollisionBoxData()||s.hasTextCollisionBoxData())&&s.deserializeCollisionBoxes(y),(it,_t,Dt)=>{for(let Yt=0;Yt<_t/4;Yt++)it.opacityVertexArray.emplaceBack(Dt);it.hasVisibleVertices=it.hasVisibleVertices||Dt!==Ao});for(let it=0;it<s.symbolInstances.length;it++){var be=s.symbolInstances.get(it),{numHorizontalGlyphVertices:ve,numVerticalGlyphVertices:Fe,crossTileID:Ue}=be,ze=f[Ue];let _t=this.opacities[Ue];ze?_t=P:_t||(_t=ge,this.opacities[Ue]=_t),f[Ue]=!0;var ze=0<be.numIconVertices,Qe=this.placedOrientations[be.crossTileID];const Dt=Qe===o.WritingMode.vertical;var Je=Qe===o.WritingMode.horizontal||Qe===o.WritingMode.horizontalOnly;if(0<ve||0<Fe){var ct=rr(_t.text),Xe=Dt?Ao:ct,ve=(ye(s.text,ve,Xe),Je?Ao:ct);ye(s.text,Fe,ve);const _n=_t.text.isHidden();[be.rightJustifiedTextSymbolIndex,be.centerJustifiedTextSymbolIndex,be.leftJustifiedTextSymbolIndex].forEach(vn=>{0<=vn&&(s.text.placedSymbolArray.get(vn).hidden=_n||Dt?1:0)}),0<=be.verticalPlacedTextSymbolIndex&&(s.text.placedSymbolArray.get(be.verticalPlacedTextSymbolIndex).hidden=_n||Je?1:0);var Xe=this.variableOffsets[be.crossTileID],ct=(Xe&&this.markUsedJustification(s,Xe.anchor,be,Qe),this.placedOrientations[be.crossTileID]);ct&&(this.markUsedJustification(s,"left",be,ct),this.markUsedOrientation(s,ct,be))}if(ze&&(Fe=rr(_t.icon),ve=!(X&&be.verticalPlacedIconSymbolIndex&&Dt),0<=be.placedIconSymbolIndex&&(Xe=ve?Fe:Ao,ye(s.icon,be.numIconVertices,Xe),s.icon.placedSymbolArray.get(be.placedIconSymbolIndex).hidden=_t.icon.isHidden()),0<=be.verticalPlacedIconSymbolIndex)&&(Qe=ve?Ao:Fe,ye(s.icon,be.numVerticalIconVertices,Qe),s.icon.placedSymbolArray.get(be.verticalPlacedIconSymbolIndex).hidden=_t.icon.isHidden()),(s.hasIconCollisionBoxData()||s.hasTextCollisionBoxData())&&(ct=s.collisionArrays[it],ct)){let Yt=new o.Point(0,0);if(ct.textBox||ct.verticalTextBox){let _n=!0;G&&((ze=this.variableOffsets[Ue])?(Yt=pn(ze.anchor,ze.width,ze.height,ze.textOffset,ze.textBoxScale),Z&&Yt._rotate(j?this.transform.angle:-this.transform.angle)):_n=!1),ct.textBox&&ni(s.textCollisionBox.collisionVertexArray,_t.text.placed,!_n||Dt,Yt.x,Yt.y),ct.verticalTextBox&&ni(s.textCollisionBox.collisionVertexArray,_t.text.placed,!_n||Je,Yt.x,Yt.y)}ve=!!(!Je&&ct.verticalIconBox),ct.iconBox&&ni(s.iconCollisionBox.collisionVertexArray,_t.icon.placed,ve,X?Yt.x:0,X?Yt.y:0),ct.verticalIconBox&&ni(s.iconCollisionBox.collisionVertexArray,_t.icon.placed,!ve,X?Yt.x:0,X?Yt.y:0)}}if(s.sortFeatures(this.transform.angle),this.retainedQueryData[s.bucketInstanceId]&&(this.retainedQueryData[s.bucketInstanceId].featureSortOrder=s.featureSortOrder),s.hasTextData()&&s.text.opacityVertexBuffer&&s.text.opacityVertexBuffer.updateData(s.text.opacityVertexArray),s.hasIconData()&&s.icon.opacityVertexBuffer&&s.icon.opacityVertexBuffer.updateData(s.icon.opacityVertexArray),s.hasIconCollisionBoxData()&&s.iconCollisionBox.collisionVertexBuffer&&s.iconCollisionBox.collisionVertexBuffer.updateData(s.iconCollisionBox.collisionVertexArray),s.hasTextCollisionBoxData()&&s.textCollisionBox.collisionVertexBuffer&&s.textCollisionBox.collisionVertexBuffer.updateData(s.textCollisionBox.collisionVertexArray),s.text.opacityVertexArray.length!==s.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${s.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${s.text.layoutVertexArray.length}) / 4`);if(s.icon.opacityVertexArray.length!==s.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${s.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${s.icon.layoutVertexArray.length}) / 4`);s.bucketInstanceId in this.collisionCircleArrays&&(v=this.collisionCircleArrays[s.bucketInstanceId],s.placementInvProjMatrix=v.invProjMatrix,s.placementViewportMatrix=v.viewportMatrix,s.collisionCircleArray=v.circles,delete this.collisionCircleArrays[s.bucketInstanceId])}symbolFadeChange(s){return this.fadeDuration===0?1:(s-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(s){return Math.max(0,(this.transform.zoom-s)/1.5)}hasTransitions(s){return this.stale||s-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(s,f){var y=this.zoomAtLastRecencyCheck===f?1-this.zoomAdjustment(f):1;return this.zoomAtLastRecencyCheck=f,this.commitTime+this.fadeDuration*y>s}setStale(){this.stale=!0}}function ni(w,s,f,y,v){w.emplaceBack(s?1:0,f?1:0,y||0,v||0),w.emplaceBack(s?1:0,f?1:0,y||0,v||0),w.emplaceBack(s?1:0,f?1:0,y||0,v||0),w.emplaceBack(s?1:0,f?1:0,y||0,v||0)}const ji=Math.pow(2,25),Ei=Math.pow(2,24),co=Math.pow(2,17),zu=Math.pow(2,16),Fc=Math.pow(2,9),Ll=Math.pow(2,8),oa=Math.pow(2,1);function rr(w){var s;return w.opacity!==0||w.placed?w.opacity===1&&w.placed?4294967295:(s=w.placed?1:0,(w=Math.floor(127*w.opacity))*ji+s*Ei+w*co+s*zu+w*Fc+s*Ll+w*oa+s):0}const Ao=0;class va{constructor(s){this._sortAcrossTiles=s.layout.get("symbol-z-order")!=="viewport-y"&&!s.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(s,f,y,v,T){for(var P=this._bucketParts;this._currentTileIndex<s.length;){var R=s[this._currentTileIndex];if(f.getBucketParts(P,v,R,this._sortAcrossTiles),this._currentTileIndex++,T())return!0}for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,P.sort((G,Z)=>G.sortKey-Z.sortKey));this._currentPartIndex<P.length;){var N=P[this._currentPartIndex];if(f.placeLayerBucketPart(N,this._seenCrossTileIDs,y),this._currentPartIndex++,T())return!0}return!1}}class Zi{constructor(s,f,y,v,T,P,R,N){this.placement=new Nr(s,f,P,R,N),this._currentPlacementIndex=y.length-1,this._forceFullPlacement=v,this._showCollisionBoxes=T,this._done=!1}isDone(){return this._done}continuePlacement(s,f,y){const v=g.now();for(var T=()=>!this._forceFullPlacement&&2<g.now()-v;0<=this._currentPlacementIndex;){var P=f[s[this._currentPlacementIndex]],R=this.placement.collisionIndex.transform.zoom;if(P.type==="symbol"&&(!P.minzoom||P.minzoom<=R)&&(!P.maxzoom||P.maxzoom>R)){if(this._inProgressLayer||(this._inProgressLayer=new va(P)),this._inProgressLayer.continuePlacement(y[P.source],this.placement,this._showCollisionBoxes,P,T))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(s){return this.placement.commit(s),this.placement}}const Gr=512/o.EXTENT/2;class hs{constructor(s,f,y){this.tileID=s,this.bucketInstanceId=y,this._symbolsByKey={};var v,T,P=new Map;for(let ye=0;ye<f.length;ye++){var R=f.get(ye),N=R.key,G=P.get(N);G?G.push(R):P.set(N,[R])}for([v,T]of P){var Z={positions:T.map(ye=>({x:Math.floor(ye.anchorX*Gr),y:Math.floor(ye.anchorY*Gr)})),crossTileIDs:T.map(ye=>ye.crossTileID)};if(128<Z.positions.length){var j,X,ge=new o.KDBush(Z.positions.length,16,Uint16Array);for({x:j,y:X}of Z.positions)ge.add(j,X);ge.finish(),delete Z.positions,Z.index=ge}this._symbolsByKey[v]=Z}}getScaledCoordinates(G,R){var{x:y,y:v,z:T}=this.tileID.canonical,{x:R,y:N,z:P}=R.canonical,P=P-T,T=Gr/Math.pow(2,P),P=(R*o.EXTENT+G.anchorX)*T,R=(N*o.EXTENT+G.anchorY)*T,N=y*o.EXTENT*Gr,G=v*o.EXTENT*Gr;return{x:Math.floor(P-N),y:Math.floor(R-G)}}findMatches(s,f,y){var v=this.tileID.canonical.z<f.canonical.z?1:Math.pow(2,this.tileID.canonical.z-f.canonical.z);for(let j=0;j<s.length;j++){var T=s.get(j);if(!T.crossTileID){var P=this._symbolsByKey[T.key];if(P){var R=this.getScaledCoordinates(T,f);if(P.index)for(const X of P.index.range(R.x-v,R.y-v,R.x+v,R.y+v).sort()){var N=P.crossTileIDs[X];if(!y[N]){y[N]=!0,T.crossTileID=N;break}}else if(P.positions)for(let X=0;X<P.positions.length;X++){var G=P.positions[X],Z=P.crossTileIDs[X];if(Math.abs(G.x-R.x)<=v&&Math.abs(G.y-R.y)<=v&&!y[Z]){y[Z]=!0,T.crossTileID=Z;break}}}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(({crossTileIDs:s})=>s)}}class Uo{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class zo{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(s){var f=Math.round((s-this.lng)/360);if(f!==0)for(const P in this.indexes){var y=this.indexes[P],v={};for(const R in y){var T=y[R];T.tileID=T.tileID.unwrapTo(T.tileID.wrap+f),v[T.tileID.key]=T}this.indexes[P]=v}this.lng=s}addBucket(s,f,y){if(this.indexes[s.overscaledZ]&&this.indexes[s.overscaledZ][s.key]){if(this.indexes[s.overscaledZ][s.key].bucketInstanceId===f.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(s.overscaledZ,this.indexes[s.overscaledZ][s.key])}for(let G=0;G<f.symbolInstances.length;G++)f.symbolInstances.get(G).crossTileID=0;this.usedCrossTileIDs[s.overscaledZ]||(this.usedCrossTileIDs[s.overscaledZ]={});var v=this.usedCrossTileIDs[s.overscaledZ];for(const G in this.indexes){var T=this.indexes[G];if(Number(G)>s.overscaledZ)for(const Z in T){var P=T[Z];P.tileID.isChildOf(s)&&P.findMatches(f.symbolInstances,s,v)}else{var R=T[s.scaledTo(Number(G)).key];R&&R.findMatches(f.symbolInstances,s,v)}}for(let G=0;G<f.symbolInstances.length;G++){var N=f.symbolInstances.get(G);N.crossTileID||(N.crossTileID=y.generate(),v[N.crossTileID]=!0)}return this.indexes[s.overscaledZ]===void 0&&(this.indexes[s.overscaledZ]={}),this.indexes[s.overscaledZ][s.key]=new hs(s,f.symbolInstances,f.bucketInstanceId),!0}removeBucketCrossTileIDs(s,f){for(const y of f.getCrossTileIDsLists())for(const v of y)delete this.usedCrossTileIDs[s][v]}removeStaleBuckets(s){let f=!1;for(const v in this.indexes){var y=this.indexes[v];for(const T in y)s[y[T].bucketInstanceId]||(this.removeBucketCrossTileIDs(v,y[T]),delete y[T],f=!0)}return f}}class Bc{constructor(){this.layerIndexes={},this.crossTileIDs=new Uo,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(s,f,y){let v=this.layerIndexes[s.id],T=!1;var P={};(v=v===void 0?this.layerIndexes[s.id]=new zo:v).handleWrapJump(y);for(const N of f){var R=N.getBucket(s);R&&s.id===R.layerIds[0]&&(R.bucketInstanceId||(R.bucketInstanceId=++this.maxBucketInstanceId),v.addBucket(N.tileID,R,this.crossTileIDs)&&(T=!0),P[R.bucketInstanceId]=!0)}return T=v.removeStaleBuckets(P)?!0:T}pruneUnusedLayers(s){const f={};s.forEach(y=>{f[y]=!0});for(const y in this.layerIndexes)f[y]||delete this.layerIndexes[y]}}const Xi=(w,s)=>o.emitValidationErrors(w,s&&s.filter(f=>f.identifier!=="source.canvas")),ri=o.emptyStyle();class ds extends o.Evented{constructor(s,f={}){super(),this._rtlPluginLoaded=()=>{for(const v in this.sourceCaches){var y=this.sourceCaches[v].getSource().type;y!=="vector"&&y!=="geojson"||this.sourceCaches[v].reload()}},this.map=s,this.dispatcher=new Xt(Gn(),s._getMapId()),this.dispatcher.registerMessageHandler("GG",(y,v)=>this.getGlyphs(y,v)),this.dispatcher.registerMessageHandler("GI",(y,v)=>this.getImages(y,v)),this.imageManager=new xe,this.imageManager.setEventedParent(this),this.glyphManager=new ke(s._requestManager,f.localIdeographFontFamily),this.lineAtlas=new ht(256,512),this.crossTileSymbolIndex=new Bc,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new o.ZoomHistory,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("SR",o.getReferrer()),qt().on(Te,this._rtlPluginLoaded),this.on("data",y=>{if(y.dataType==="source"&&y.sourceDataType==="metadata"&&(y=this.sourceCaches[y.sourceId],y)){var v=y.getSource();if(v&&v.vectorLayerIds)for(const P in this._layers){var T=this._layers[P];T.source===v.id&&this._validateLayer(T)}}})}loadURL(s,f={},y){this.fire(new o.Event("dataloading",{dataType:"style"})),f.validate=typeof f.validate!="boolean"||f.validate,s=this.map._requestManager.transformRequest(s,"Style"),this._loadStyleRequest=new AbortController,o.getJSON(s,this._loadStyleRequest).then(v=>{this._loadStyleRequest=null,this._load(v.data,f,y)}).catch(v=>{this._loadStyleRequest=null,v&&this.fire(new o.ErrorEvent(v))})}loadJSON(s,f={},y){this.fire(new o.Event("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,g.frameAsync(this._frameRequest).then(()=>{this._frameRequest=null,f.validate=f.validate!==!1,this._load(s,f,y)}).catch(()=>{})}loadEmpty(){this.fire(new o.Event("dataloading",{dataType:"style"})),this._load(ri,{validate:!1})}_load(s,f,y){var v=f.transformStyle?f.transformStyle(y,s):s;if(!f.validate||!Xi(this,o.validateStyle(v))){this._loaded=!0;for(const T in(this.stylesheet=v).sources)this.addSource(T,v.sources[T],{validate:!1});v.sprite?this._loadSprite(v.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(v.glyphs),this._createLayers(),this.light=new Re(this.stylesheet.light),this.map.setTerrain((y=this.stylesheet.terrain)!=null?y:null),this.fire(new o.Event("data",{dataType:"style"})),this.fire(new o.Event("style.load"))}}_createLayers(){var s=o.derefLayers(this.stylesheet.layers);this.dispatcher.broadcast("SL",s),this._order=s.map(y=>y.id),this._layers={},this._serializedLayers=null;for(const y of s){var f=o.createStyleLayer(y);f.setEventedParent(this,{layer:{id:y.id}}),this._layers[y.id]=f}}_loadSprite(s,f=!1,y=void 0){this.imageManager.setLoaded(!1),this._spriteRequest=new AbortController;let v;pe(s,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then(T=>{if(this._spriteRequest=null,T)for(const R in T){this._spritesImagesIds[R]=[];for(const N of this._spritesImagesIds[R]?this._spritesImagesIds[R].filter(G=>!(G in T)):[])this.imageManager.removeImage(N),this._changedImages[N]=!0;for(const N in T[R]){var P=R==="default"?N:R+":"+N;this._spritesImagesIds[R].push(P),P in this.imageManager.images?this.imageManager.updateImage(P,T[R][N],!1):this.imageManager.addImage(P,T[R][N]),f&&(this._changedImages[P]=!0)}}}).catch(T=>{this._spriteRequest=null,v=T,this.fire(new o.ErrorEvent(v))}).finally(()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),f&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new o.Event("data",{dataType:"style"})),y&&y(v)})}_unloadSprite(){for(const s of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(s),this._changedImages[s]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new o.Event("data",{dataType:"style"}))}_validateLayer(s){var f,y=this.sourceCaches[s.source];y&&(f=s.sourceLayer)&&((y=y.getSource()).type==="geojson"||y.vectorLayerIds&&y.vectorLayerIds.indexOf(f)===-1)&&this.fire(new o.ErrorEvent(new Error(`Source layer "${f}" does not exist on source "${y.id}" as specified by style layer "${s.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const s in this.sourceCaches)if(!this.sourceCaches[s].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(s){var f=this._serializedAllLayers();if(!s||s.length===0)return Object.values(f);var y=[];for(const v of s)f[v]&&y.push(f[v]);return y}_serializedAllLayers(){var s=this._serializedLayers;if(!s){s=this._serializedLayers={};for(const y of Object.keys(this._layers)){var f=this._layers[y];f.type!=="custom"&&(s[y]=f.serialize())}}return s}hasTransitions(){if(this.light&&this.light.hasTransition())return!0;for(const s in this.sourceCaches)if(this.sourceCaches[s].hasTransition())return!0;for(const s in this._layers)if(this._layers[s].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(s){if(this._loaded){var f=this._changed;if(this._changed){var y=Object.keys(this._updatedLayers),v=Object.keys(this._removedLayers);(y.length||v.length)&&this._updateWorkerLayers(y,v);for(const Z in this._updatedSources){var T=this._updatedSources[Z];if(T==="reload")this._reloadSource(Z);else{if(T!=="clear")throw new Error("Invalid action "+T);this._clearSource(Z)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const Z in this._updatedPaintProps)this._layers[Z].updateTransitions(s);this.light.updateTransitions(s),this._resetUpdates()}var P={};for(const Z in this.sourceCaches){var R=this.sourceCaches[Z];P[Z]=R.used,R.used=!1}for(const Z of this._order){var N=this._layers[Z];N.recalculate(s,this._availableImages),!N.isHidden(s.zoom)&&N.source&&(this.sourceCaches[N.source].used=!0)}for(const Z in P){var G=this.sourceCaches[Z];P[Z]!==G.used&&G.fire(new o.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:Z}))}this.light.recalculate(s),this.z=s.zoom,f&&this.fire(new o.Event("data",{dataType:"style"}))}}_updateTilesForChangedImages(){var s=Object.keys(this._changedImages);if(s.length){for(const f in this.sourceCaches)this.sourceCaches[f].reloadTilesForDependencies(["icons","patterns"],s);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const s in this.sourceCaches)this.sourceCaches[s].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(s,f){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(s),removedIds:f})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(s,v={}){this._checkLoaded();var y=this.serialize(),v=(s=v.transformStyle?v.transformStyle(y,s):s,(v=v.validate)==null||v);if(v&&Xi(this,o.validateStyle(s)))return!1;if((s=o.clone$1(s)).layers=o.derefLayers(s.layers),v=o.diffStyles(y,s),y=this._getOperationsToPerform(v),0<y.unimplemented.length)throw new Error(`Unimplemented: ${y.unimplemented.join(", ")}.`);if(y.operations.length===0)return!1;for(const T of y.operations)T();return this.stylesheet=s,!(this._serializedLayers=null)}_getOperationsToPerform(s){var f=[],y=[];for(const v of s)switch(v.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":continue;case"addLayer":f.push(()=>this.addLayer.apply(this,v.args));break;case"removeLayer":f.push(()=>this.removeLayer.apply(this,v.args));break;case"setPaintProperty":f.push(()=>this.setPaintProperty.apply(this,v.args));break;case"setLayoutProperty":f.push(()=>this.setLayoutProperty.apply(this,v.args));break;case"setFilter":f.push(()=>this.setFilter.apply(this,v.args));break;case"addSource":f.push(()=>this.addSource.apply(this,v.args));break;case"removeSource":f.push(()=>this.removeSource.apply(this,v.args));break;case"setLayerZoomRange":f.push(()=>this.setLayerZoomRange.apply(this,v.args));break;case"setLight":f.push(()=>this.setLight.apply(this,v.args));break;case"setGeoJSONSourceData":f.push(()=>this.setGeoJSONSourceData.apply(this,v.args));break;case"setGlyphs":f.push(()=>this.setGlyphs.apply(this,v.args));break;case"setSprite":f.push(()=>this.setSprite.apply(this,v.args));break;case"setTerrain":f.push(()=>this.map.setTerrain.apply(this,v.args));break;case"setTransition":f.push(()=>{});break;default:y.push(v.command)}return{operations:f,unimplemented:y}}addImage(s,f){if(this.getImage(s))return this.fire(new o.ErrorEvent(new Error(`An image named "${s}" already exists.`)));this.imageManager.addImage(s,f),this._afterImageUpdated(s)}updateImage(s,f){this.imageManager.updateImage(s,f)}getImage(s){return this.imageManager.getImage(s)}removeImage(s){if(!this.getImage(s))return this.fire(new o.ErrorEvent(new Error(`An image named "${s}" does not exist.`)));this.imageManager.removeImage(s),this._afterImageUpdated(s)}_afterImageUpdated(s){this._availableImages=this.imageManager.listImages(),this._changedImages[s]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new o.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(s,f,y={}){if(this._checkLoaded(),this.sourceCaches[s]!==void 0)throw new Error(`Source "${s}" already exists.`);if(!f.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(f).join(", ")}.`);var v=0<=["vector","raster","geojson","video","image"].indexOf(f.type);if(!v||!this._validate(o.validateStyle.source,"sources."+s,f,null,y)){this.map&&this.map._collectResourceTiming&&(f.collectResourceTiming=!0);const T=this.sourceCaches[s]=new Tt(s,f,this.dispatcher);T.style=this,T.setEventedParent(this,()=>({isSourceLoaded:T.loaded(),source:T.serialize(),sourceId:s})),T.onAdd(this.map),this._changed=!0}}removeSource(s){if(this._checkLoaded(),this.sourceCaches[s]===void 0)throw new Error("There is no source with this ID");for(const y in this._layers)if(this._layers[y].source===s)return this.fire(new o.ErrorEvent(new Error(`Source "${s}" cannot be removed while layer "${y}" is using it.`)));var f=this.sourceCaches[s];delete this.sourceCaches[s],delete this._updatedSources[s],f.fire(new o.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:s})),f.setEventedParent(null),f.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(s,f){if(this._checkLoaded(),this.sourceCaches[s]===void 0)throw new Error("There is no source with this ID="+s);if(s=this.sourceCaches[s].getSource(),s.type!=="geojson")throw new Error(`geojsonSource.type is ${s.type}, which is !== 'geojson`);s.setData(f),this._changed=!0}getSource(s){return this.sourceCaches[s]&&this.sourceCaches[s].getSource()}addLayer(s,f,y={}){this._checkLoaded();var v=s.id;if(this.getLayer(v))this.fire(new o.ErrorEvent(new Error(`Layer "${v}" already exists on this map.`)));else{let T;if(s.type==="custom"){if(Xi(this,o.validateCustomStyleLayer(s)))return;T=o.createStyleLayer(s)}else{if("source"in s&&typeof s.source=="object"&&(this.addSource(v,s.source),s=o.clone$1(s),s=o.extend(s,{source:v})),this._validate(o.validateStyle.layer,"layers."+v,s,{arrayIndex:-1},y))return;T=o.createStyleLayer(s),this._validateLayer(T),T.setEventedParent(this,{layer:{id:v}})}y=f?this._order.indexOf(f):this._order.length,f&&y===-1?this.fire(new o.ErrorEvent(new Error(`Cannot add layer "${v}" before non-existing layer "${f}".`))):(this._order.splice(y,0,v),this._layerOrderChanged=!0,this._layers[v]=T,this._removedLayers[v]&&T.source&&T.type!=="custom"&&(s=this._removedLayers[v],delete this._removedLayers[v],s.type!==T.type?this._updatedSources[T.source]="clear":(this._updatedSources[T.source]="reload",this.sourceCaches[T.source].pause())),this._updateLayer(T),T.onAdd&&T.onAdd(this.map))}}moveLayer(s,f){var y;this._checkLoaded(),this._changed=!0,this._layers[s]?s!==f&&(y=this._order.indexOf(s),this._order.splice(y,1),y=f?this._order.indexOf(f):this._order.length,f&&y===-1?this.fire(new o.ErrorEvent(new Error(`Cannot move layer "${s}" before non-existing layer "${f}".`))):(this._order.splice(y,0,s),this._layerOrderChanged=!0)):this.fire(new o.ErrorEvent(new Error(`The layer '${s}' does not exist in the map's style and cannot be moved.`)))}removeLayer(s){this._checkLoaded();var f,y=this._layers[s];y?(y.setEventedParent(null),f=this._order.indexOf(s),this._order.splice(f,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[s]=y,delete this._layers[s],this._serializedLayers&&delete this._serializedLayers[s],delete this._updatedLayers[s],delete this._updatedPaintProps[s],y.onRemove&&y.onRemove(this.map)):this.fire(new o.ErrorEvent(new Error(`Cannot remove non-existing layer "${s}".`)))}getLayer(s){return this._layers[s]}getLayersOrder(){return[...this._order]}hasLayer(s){return s in this._layers}setLayerZoomRange(s,f,y){this._checkLoaded();var v=this.getLayer(s);v?v.minzoom===f&&v.maxzoom===y||(f!=null&&(v.minzoom=f),y!=null&&(v.maxzoom=y),this._updateLayer(v)):this.fire(new o.ErrorEvent(new Error(`Cannot set the zoom range of non-existing layer "${s}".`)))}setFilter(s,f,y={}){this._checkLoaded();var v=this.getLayer(s);v?o.deepEqual(v.filter,f)||(f==null?(v.filter=void 0,this._updateLayer(v)):this._validate(o.validateStyle.filter,`layers.${v.id}.filter`,f,null,y)||(v.filter=o.clone$1(f),this._updateLayer(v))):this.fire(new o.ErrorEvent(new Error(`Cannot filter non-existing layer "${s}".`)))}getFilter(s){return o.clone$1(this.getLayer(s).filter)}setLayoutProperty(s,f,y,v={}){this._checkLoaded();var T=this.getLayer(s);T?o.deepEqual(T.getLayoutProperty(f),y)||(T.setLayoutProperty(f,y,v),this._updateLayer(T)):this.fire(new o.ErrorEvent(new Error(`Cannot style non-existing layer "${s}".`)))}getLayoutProperty(s,f){var y=this.getLayer(s);if(y)return y.getLayoutProperty(f);this.fire(new o.ErrorEvent(new Error(`Cannot get style of non-existing layer "${s}".`)))}setPaintProperty(s,f,y,v={}){this._checkLoaded();var T=this.getLayer(s);T?o.deepEqual(T.getPaintProperty(f),y)||(T.setPaintProperty(f,y,v)&&this._updateLayer(T),this._changed=!0,this._updatedPaintProps[s]=!0):this.fire(new o.ErrorEvent(new Error(`Cannot style non-existing layer "${s}".`)))}getPaintProperty(s,f){return this.getLayer(s).getPaintProperty(f)}setFeatureState(s,f){this._checkLoaded();var y=s.source,v=s.sourceLayer,T=this.sourceCaches[y];T===void 0?this.fire(new o.ErrorEvent(new Error(`The source '${y}' does not exist in the map's style.`))):(y=T.getSource().type)==="geojson"&&v?this.fire(new o.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):y!=="vector"||v?(s.id===void 0&&this.fire(new o.ErrorEvent(new Error("The feature id parameter must be provided."))),T.setFeatureState(v,s.id,f)):this.fire(new o.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(s,f){this._checkLoaded();var y,v=s.source,T=this.sourceCaches[v];T===void 0?this.fire(new o.ErrorEvent(new Error(`The source '${v}' does not exist in the map's style.`))):(y=(v=T.getSource().type)==="vector"?s.sourceLayer:void 0,v!=="vector"||y?f&&typeof s.id!="string"&&typeof s.id!="number"?this.fire(new o.ErrorEvent(new Error("A feature id is required to remove its specific state property."))):T.removeFeatureState(y,s.id,f):this.fire(new o.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types."))))}getFeatureState(s){this._checkLoaded();var f=s.source,y=s.sourceLayer,v=this.sourceCaches[f];if(v===void 0)this.fire(new o.ErrorEvent(new Error(`The source '${f}' does not exist in the map's style.`)));else{if(v.getSource().type!=="vector"||y)return s.id===void 0&&this.fire(new o.ErrorEvent(new Error("The feature id parameter must be provided."))),v.getFeatureState(y,s.id);this.fire(new o.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}}getTransition(){return o.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){var s,f,y,v;if(this._loaded)return s=o.mapObject(this.sourceCaches,T=>T.serialize()),f=this._serializeByIds(this._order),y=this.map.getTerrain()||void 0,v=this.stylesheet,o.filterObject({version:v.version,name:v.name,metadata:v.metadata,light:v.light,center:v.center,zoom:v.zoom,bearing:v.bearing,pitch:v.pitch,sprite:v.sprite,glyphs:v.glyphs,transition:v.transition,sources:s,layers:f,terrain:y},T=>T!==void 0)}_updateLayer(s){this._updatedLayers[s.id]=!0,s.source&&!this._updatedSources[s.source]&&this.sourceCaches[s.source].getSource().type!=="raster"&&(this._updatedSources[s.source]="reload",this.sourceCaches[s.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(s){var f=j=>this._layers[j].type==="fill-extrusion",y={},v=[];for(let j=this._order.length-1;0<=j;j--){var T=this._order[j];if(f(T)){y[T]=j;for(const X of s){var P=X[T];if(P)for(const ge of P)v.push(ge)}}}v.sort((j,X)=>X.intersectionZ-j.intersectionZ);var R=[];for(let j=this._order.length-1;0<=j;j--){var N=this._order[j];if(f(N))for(let X=v.length-1;0<=X;X--){var G=v[X].feature;if(y[G.layer.id]<j)break;R.push(G),v.pop()}else for(const X of s){var Z=X[N];if(Z)for(const ge of Z)R.push(ge.feature)}}return R}queryRenderedFeatures(s,f,y){f&&f.filter&&this._validate(o.validateStyle.filter,"queryRenderedFeatures.filter",f.filter,null,f);var v={};if(f&&f.layers){if(!Array.isArray(f.layers))return this.fire(new o.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const N of f.layers){var T=this._layers[N];if(!T)return this.fire(new o.ErrorEvent(new Error(`The layer '${N}' does not exist in the map's style and cannot be queried for features.`))),[];v[T.source]=!0}}var P=[],R=(f.availableImages=this._availableImages,this._serializedAllLayers());for(const N in this.sourceCaches)f.layers&&!v[N]||P.push(Ot(this.sourceCaches[N],this._layers,R,s,f,y));return this.placement&&P.push(En(this._layers,R,this.sourceCaches,s,f,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(P)}querySourceFeatures(s,f){return f&&f.filter&&this._validate(o.validateStyle.filter,"querySourceFeatures.filter",f.filter,null,f),s=this.sourceCaches[s],s?lt(s,f):[]}getLight(){return this.light.getLight()}setLight(s,f={}){this._checkLoaded();var y,v=this.light.getLight();let T=!1;for(const P in s)if(!o.deepEqual(s[P],v[P])){T=!0;break}T&&(y={now:g.now(),transition:o.extend({duration:300,delay:0},this.stylesheet.transition)},this.light.setLight(s,f),this.light.updateTransitions(y))}_validate(s,f,y,v,T={}){return(!T||T.validate!==!1)&&Xi(this,s.call(o.validateStyle,o.extend({key:f,style:this.serialize(),value:y,styleSpec:o.v8Spec},v)))}_remove(s=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),qt().off(Te,this._rtlPluginLoaded);for(const y in this._layers)this._layers[y].setEventedParent(null);for(const y in this.sourceCaches){var f=this.sourceCaches[y];f.setEventedParent(null),f.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),s&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(s)}_clearSource(s){this.sourceCaches[s].clearTiles()}_reloadSource(s){this.sourceCaches[s].resume(),this.sourceCaches[s].reload()}_updateSources(s){for(const f in this.sourceCaches)this.sourceCaches[f].update(s,this.map.terrain)}_generateCollisionBoxes(){for(const s in this.sourceCaches)this._reloadSource(s)}_updatePlacement(s,f,y,v,T=!1){let P=!1,R=!1;var N={};for(const j of this._order){var G=this._layers[j];if(G.type==="symbol"){if(!N[G.source]){const X=this.sourceCaches[G.source];N[G.source]=X.getRenderableIds(!0).map(ge=>X.getTileByID(ge)).sort((ge,ye)=>ye.tileID.overscaledZ-ge.tileID.overscaledZ||(ge.tileID.isLessThan(ye.tileID)?-1:1))}G=this.crossTileSymbolIndex.addLayer(G,N[G.source],s.center.lng),P=P||G}}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((T=T||this._layerOrderChanged||y===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(g.now(),s.zoom))&&(this.pauseablePlacement=new Zi(s,this.map.terrain,this._order,T,f,y,v,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,N),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(g.now()),R=!0),P&&this.pauseablePlacement.placement.setStale()),R||P)for(const j of this._order){var Z=this._layers[j];Z.type==="symbol"&&this.placement.updateLayerOpacities(Z,N[Z.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(g.now())}_releaseSymbolFadeTiles(){for(const s in this.sourceCaches)this.sourceCaches[s].releaseSymbolFadeTiles()}getImages(s,f){return o.__awaiter(this,void 0,void 0,function*(){var y=yield this.imageManager.getImages(f.icons),v=(this._updateTilesForChangedImages(),this.sourceCaches[f.source]);return v&&v.setDependencies(f.tileID.key,f.type,f.icons),y})}getGlyphs(s,f){return o.__awaiter(this,void 0,void 0,function*(){var y=yield this.glyphManager.getGlyphs(f.stacks),v=this.sourceCaches[f.source];return v&&v.setDependencies(f.tileID.key,f.type,[""]),y})}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(s,f={}){this._checkLoaded(),s&&this._validate(o.validateStyle.glyphs,"glyphs",s,null,f)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=s,this.glyphManager.entries={},this.glyphManager.setURL(s))}addSprite(s,f,y={},v){this._checkLoaded(),s=[{id:s,url:f}],f=[...J(this.stylesheet.sprite),...s],this._validate(o.validateStyle.sprite,"sprite",f,null,y)||(this.stylesheet.sprite=f,this._loadSprite(s,!0,v))}removeSprite(s){this._checkLoaded();var f=J(this.stylesheet.sprite);if(f.find(y=>y.id===s)){if(this._spritesImagesIds[s])for(const y of this._spritesImagesIds[s])this.imageManager.removeImage(y),this._changedImages[y]=!0;f.splice(f.findIndex(y=>y.id===s),1),this.stylesheet.sprite=0<f.length?f:void 0,delete this._spritesImagesIds[s],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new o.Event("data",{dataType:"style"}))}else this.fire(new o.ErrorEvent(new Error(`Sprite "${s}" doesn't exists on this map.`)))}getSprite(){return J(this.stylesheet.sprite)}setSprite(s,f={},y){this._checkLoaded(),s&&this._validate(o.validateStyle.sprite,"sprite",s,null,f)||((this.stylesheet.sprite=s)?this._loadSprite(s,!0,y):(this._unloadSprite(),y&&y(null)))}}var ba=o.createLayout([{name:"a_pos",type:"Int16",components:2}]),ir="attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;varying float v_depth;void main() {float extent=8192.0;float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/extent;gl_Position=u_matrix*vec4(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta,1.0);v_depth=gl_Position.z/gl_Position.w;}";const za={prelude:Un(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture2D(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture2D(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}`),background:Un(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:Un(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:Un(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float ele=get_elevation(circle_center);v_visibility=calculate_visibility(u_matrix*vec4(circle_center,ele,1.0));if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,ele,1);} else {gl_Position=u_matrix*vec4(circle_center,ele,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:Un("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Un(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),heatmapTexture:Un(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:Un("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,get_elevation(a_pos),1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:Un("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:Un("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,get_elevation(a_pos),1);}"),fill:Un(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),fillOutline:Un(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillOutlinePattern:Un(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillPattern:Un(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:Un(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:Un(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:Un(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Un(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:Un(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:Un(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:Un(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:Un(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:Un(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:Un(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),z,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:Un(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:Un(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:Un("uniform sampler2D u_texture;varying vec2 v_texture_pos;void main() {gl_FragColor=texture2D(u_texture,v_texture_pos);}",ir),terrainDepth:Un("varying float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {gl_FragColor=pack(v_depth);}",ir),terrainCoords:Un("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;varying vec2 v_texture_pos;void main() {vec4 rgba=texture2D(u_texture,v_texture_pos);gl_FragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}",ir)};function Un(w,s){var f=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,y=s.match(/attribute ([\w]+) ([\w]+)/g),v=w.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),T=s.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),T=T?T.concat(v):v;const P={};return{fragmentSource:w=w.replace(f,(R,N,G,Z,j)=>(P[j]=!0,N==="define"?`
#ifndef HAS_UNIFORM_u_${j}
varying ${G} ${Z} ${j};
#else
uniform ${G} ${Z} u_${j};
#endif
`:`
#ifdef HAS_UNIFORM_u_${j}
    ${G} ${Z} ${j} = u_${j};
#endif
`)),vertexSource:s=s.replace(f,(R,N,G,Z,j)=>{var X=Z==="float"?"vec2":"vec4",ge=j.match(/color/)?"color":X;return P[j]?N==="define"?`
#ifndef HAS_UNIFORM_u_${j}
uniform lowp float u_${j}_t;
attribute ${G} ${X} a_${j};
varying ${G} ${Z} ${j};
#else
uniform ${G} ${Z} u_${j};
#endif
`:ge=="vec4"?`
#ifndef HAS_UNIFORM_u_${j}
    ${j} = a_${j};
#else
    ${G} ${Z} ${j} = u_${j};
#endif
`:`
#ifndef HAS_UNIFORM_u_${j}
    ${j} = unpack_mix_${ge}(a_${j}, u_${j}_t);
#else
    ${G} ${Z} ${j} = u_${j};
#endif
`:N==="define"?`
#ifndef HAS_UNIFORM_u_${j}
uniform lowp float u_${j}_t;
attribute ${G} ${X} a_${j};
#else
uniform ${G} ${Z} u_${j};
#endif
`:ge=="vec4"?`
#ifndef HAS_UNIFORM_u_${j}
    ${G} ${Z} ${j} = a_${j};
#else
    ${G} ${Z} ${j} = u_${j};
#endif
`:`
#ifndef HAS_UNIFORM_u_${j}
    ${G} ${Z} ${j} = unpack_mix_${ge}(a_${j}, u_${j}_t);
#else
    ${G} ${Z} ${j} = u_${j};
#endif
`}),staticAttributes:y,staticUniforms:T}}class ja{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(s,f,y,v,T,P,R,N,G){this.context=s;let Z=this.boundPaintVertexBuffers.length!==v.length;for(let j=0;!Z&&j<v.length;j++)this.boundPaintVertexBuffers[j]!==v[j]&&(Z=!0);!this.vao||this.boundProgram!==f||this.boundLayoutVertexBuffer!==y||Z||this.boundIndexBuffer!==T||this.boundVertexOffset!==P||this.boundDynamicVertexBuffer!==R||this.boundDynamicVertexBuffer2!==N||this.boundDynamicVertexBuffer3!==G?this.freshBind(f,y,v,T,P,R,N,G):(s.bindVertexArray.set(this.vao),R&&R.bind(),T&&T.dynamicDraw&&T.bind(),N&&N.bind(),G&&G.bind())}freshBind(s,f,y,v,T,P,R,N){var G=s.numAttributes,Z=this.context,j=Z.gl;this.vao&&this.destroy(),this.vao=Z.createVertexArray(),Z.bindVertexArray.set(this.vao),this.boundProgram=s,this.boundLayoutVertexBuffer=f,this.boundPaintVertexBuffers=y,this.boundIndexBuffer=v,this.boundVertexOffset=T,this.boundDynamicVertexBuffer=P,this.boundDynamicVertexBuffer2=R,this.boundDynamicVertexBuffer3=N,f.enableAttributes(j,s);for(const X of y)X.enableAttributes(j,s);P&&P.enableAttributes(j,s),R&&R.enableAttributes(j,s),N&&N.enableAttributes(j,s),f.bind(),f.setVertexAttribPointers(j,s,T);for(const X of y)X.bind(),X.setVertexAttribPointers(j,s,T);P&&(P.bind(),P.setVertexAttribPointers(j,s,T)),v&&v.bind(),R&&(R.bind(),R.setVertexAttribPointers(j,s,T)),N&&(N.bind(),N.setVertexAttribPointers(j,s,T)),Z.currentNumAttributes=G}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}const Us=(w,s)=>({u_depth:new o.Uniform1i(w,s.u_depth),u_terrain:new o.Uniform1i(w,s.u_terrain),u_terrain_dim:new o.Uniform1f(w,s.u_terrain_dim),u_terrain_matrix:new o.UniformMatrix4f(w,s.u_terrain_matrix),u_terrain_unpack:new o.Uniform4f(w,s.u_terrain_unpack),u_terrain_exaggeration:new o.Uniform1f(w,s.u_terrain_exaggeration)});function ju(w){var s,f=[];for(let y=0;y<w.length;y++)w[y]!==null&&(s=w[y].split(" "),f.push(s.pop()));return f}class Vu{constructor(s,f,y,v,T,P){var R=s.gl,G=(this.program=R.createProgram(),ju(f.staticAttributes)),Z=y?y.getBinderAttributes():[],N=G.concat(Z),G=za.prelude.staticUniforms?ju(za.prelude.staticUniforms):[],Z=f.staticUniforms?ju(f.staticUniforms):[],j=y?y.getBinderUniforms():[],X=[];for(const ve of G.concat(Z).concat(j))X.indexOf(ve)<0&&X.push(ve);if(G=y?y.defines():[],T&&G.push("#define OVERDRAW_INSPECTOR;"),P&&G.push("#define TERRAIN3D;"),Z=G.concat(za.prelude.fragmentSource,f.fragmentSource).join(`
`),j=G.concat(za.prelude.vertexSource,f.vertexSource).join(`
`),T=R.createShader(R.FRAGMENT_SHADER),R.isContextLost())this.failedToCreate=!0;else{if(R.shaderSource(T,Z),R.compileShader(T),!R.getShaderParameter(T,R.COMPILE_STATUS))throw new Error("Could not compile fragment shader: "+R.getShaderInfoLog(T));if(R.attachShader(this.program,T),P=R.createShader(R.VERTEX_SHADER),R.isContextLost())this.failedToCreate=!0;else{if(R.shaderSource(P,j),R.compileShader(P),!R.getShaderParameter(P,R.COMPILE_STATUS))throw new Error("Could not compile vertex shader: "+R.getShaderInfoLog(P));R.attachShader(this.program,P),this.attributes={};var ge={};this.numAttributes=N.length;for(let ve=0;ve<this.numAttributes;ve++)N[ve]&&(R.bindAttribLocation(this.program,ve,N[ve]),this.attributes[N[ve]]=ve);if(R.linkProgram(this.program),!R.getProgramParameter(this.program,R.LINK_STATUS))throw new Error("Program failed to link: "+R.getProgramInfoLog(this.program));R.deleteShader(P),R.deleteShader(T);for(let ve=0;ve<X.length;ve++){var ye,be=X[ve];be&&!ge[be]&&(ye=R.getUniformLocation(this.program,be))&&(ge[be]=ye)}this.fixedUniforms=v(s,ge),this.terrainUniforms=Us(s,ge),this.binderUniforms=y?y.getUniforms(s,ge):[]}}}draw(s,f,y,v,T,P,R,N,G,Z,j,X,ge,ye,be,ve,Fe,Ue){var ze=s.gl;if(!this.failedToCreate){if(s.program.set(this.program),s.setDepthMode(y),s.setStencilMode(v),s.setColorMode(T),s.setCullFace(P),N){s.activeTexture.set(ze.TEXTURE2),ze.bindTexture(ze.TEXTURE_2D,N.depthTexture),s.activeTexture.set(ze.TEXTURE3),ze.bindTexture(ze.TEXTURE_2D,N.texture);for(const Xe in this.terrainUniforms)this.terrainUniforms[Xe].set(N[Xe])}for(const Xe in this.fixedUniforms)this.fixedUniforms[Xe].set(R[Xe]);be&&be.setUniforms(s,this.binderUniforms,ge,{zoom:ye});let Je=0;switch(f){case ze.LINES:Je=2;break;case ze.TRIANGLES:Je=3;break;case ze.LINE_STRIP:Je=1}for(const Xe of X.get()){var Qe=Xe.vaos||(Xe.vaos={});(Qe[G]||(Qe[G]=new ja)).bind(s,this,Z,be?be.getPaintVertexBuffers():[],j,Xe.vertexOffset,ve,Fe,Ue),ze.drawElements(f,Xe.primitiveLength*Je,ze.UNSIGNED_SHORT,Xe.primitiveOffset*Je*2)}}}}function Uc(w,T,f){var y=1/en(f,1,T.transform.tileZoom),v=Math.pow(2,f.tileID.overscaledZ),T=f.tileSize*Math.pow(2,T.transform.tileZoom)/v,v=T*(f.tileID.canonical.x+f.tileID.wrap*v),T=T*f.tileID.canonical.y;return{u_image:0,u_texsize:f.imageAtlasTexture.size,u_scale:[y,w.fromScale,w.toScale],u_fade:w.t,u_pixel_coord_upper:[v>>16,T>>16],u_pixel_coord_lower:[65535&v,65535&T]}}const Nl=(w,R,f,y)=>{var v=R.style.light,T=v.properties.get("position"),T=[T.x,T.y,T.z],P=o.create$1(),R=(v.properties.get("anchor")==="viewport"&&o.fromRotation(P,-R.transform.angle),o.transformMat3(T,T,P),v.properties.get("color"));return{u_matrix:w,u_lightpos:T,u_lightintensity:v.properties.get("intensity"),u_lightcolor:[R.r,R.g,R.b],u_vertical_gradient:+f,u_opacity:y}},zs=(w,s,f,y,v,T,P)=>o.extend(Nl(w,s,f,y),Uc(T,s,P),{u_height_factor:-Math.pow(2,v.overscaledZ)/P.tileSize/8}),ee=w=>({u_matrix:w}),se=(w,s,f,y)=>o.extend(ee(w),Uc(f,s,y)),Se=(w,s)=>({u_matrix:w,u_world:s}),qe=(w,s,f,y,v)=>o.extend(se(w,s,f,y),{u_world:v}),yt=(w,s,T)=>{var y=en(T,1,s.zoom),v=Math.pow(2,s.zoom-T.tileID.overscaledZ),T=T.tileID.overscaleFactor();return{u_matrix:w,u_camera_to_center_distance:s.cameraToCenterDistance,u_pixels_to_tile_units:y,u_extrude_scale:[s.pixelsToGLUnits[0]/(y*v),s.pixelsToGLUnits[1]/(y*v)],u_overscale_factor:T}},Qt=(w,s,f)=>({u_matrix:w,u_inv_matrix:s,u_camera_to_center_distance:f.cameraToCenterDistance,u_viewport_size:[f.width,f.height]}),Zn=(w,s,f=1)=>({u_matrix:w,u_color:s,u_overlay:0,u_overlay_scale:f}),Ti=w=>({u_matrix:w}),Vi=(T,s,f,y)=>{var v=o.create(),T=(o.ortho(v,0,T.width,T.height,0,0,1),T.context.gl);return{u_matrix:v,u_world:[T.drawingBufferWidth,T.drawingBufferHeight],u_image:f,u_color_ramp:y,u_opacity:s.paint.get("heatmap-opacity")}},lo=(w,s,f,y)=>{var v=f.paint.get("hillshade-shadow-color"),T=f.paint.get("hillshade-highlight-color"),P=f.paint.get("hillshade-accent-color");let R=f.paint.get("hillshade-illumination-direction")*(Math.PI/180);f.paint.get("hillshade-illumination-anchor")==="viewport"&&(R-=w.transform.angle);var N=!w.options.moving;return{u_matrix:y?y.posMatrix:w.transform.calculatePosMatrix(s.tileID.toUnwrapped(),N),u_image:0,u_latrange:(y=s.tileID,w=Math.pow(2,y.canonical.z),y=y.canonical.y,[new o.MercatorCoordinate(0,y/w).toLngLat().lat,new o.MercatorCoordinate(0,(y+1)/w).toLngLat().lat]),u_light:[f.paint.get("hillshade-exaggeration"),R],u_shadow:v,u_highlight:T,u_accent:P}},wa=(w,s)=>{var f=s.stride,y=o.create();return o.ortho(y,0,o.EXTENT,-o.EXTENT,0,0,1),o.translate(y,y,[0,-o.EXTENT,0]),{u_matrix:y,u_image:1,u_dimension:[f,f],u_zoom:w.overscaledZ,u_unpack:s.getUnpackVector()}},vp=(w,s,f,y)=>{var v=w.transform;return{u_matrix:Cb(w,s,f,y),u_ratio:1/en(s,1,v.zoom),u_device_pixel_ratio:w.pixelRatio,u_units_to_pixels:[1/v.pixelsToGLUnits[0],1/v.pixelsToGLUnits[1]]}};function Sb(w,s){return 1/en(w,1,s.tileZoom)}function Cb(w,s,f,y){return w.translatePosMatrix((y||s.tileID).posMatrix,s,f.paint.get("line-translate"),f.paint.get("line-translate-anchor"))}const Dl=(w,s,f,y,v)=>({u_matrix:w,u_tl_parent:s,u_scale_parent:f,u_buffer_scale:1,u_fade_t:y.mix,u_opacity:y.opacity*v.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:v.paint.get("raster-brightness-min"),u_brightness_high:v.paint.get("raster-brightness-max"),u_saturation_factor:0<(w=v.paint.get("raster-saturation"))?1-1/(1.001-w):-w,u_contrast_factor:0<(s=v.paint.get("raster-contrast"))?1/(1-s):1+s,u_spin_weights:(f=v.paint.get("raster-hue-rotate"),f*=Math.PI/180,y=Math.sin(f),[(2*(f=Math.cos(f))+1)/3,(-Math.sqrt(3)*y-f+1)/3,(Math.sqrt(3)*y-f+1)/3])}),_d=(w,s,f,y,v,T,P,R,N,G)=>{var Z=v.transform;return{u_is_size_zoom_constant:+(w==="constant"||w==="source"),u_is_size_feature_constant:+(w==="constant"||w==="camera"),u_size_t:s?s.uSizeT:0,u_size:s?s.uSize:0,u_camera_to_center_distance:Z.cameraToCenterDistance,u_pitch:Z.pitch/360*2*Math.PI,u_rotate_symbol:+f,u_aspect_ratio:Z.width/Z.height,u_fade_change:v.options.fadeDuration?v.symbolFadeChange:1,u_matrix:T,u_label_plane_matrix:P,u_coord_matrix:R,u_is_text:+N,u_pitch_with_map:+y,u_texsize:G,u_texture:0}},xa=(w,s,f,y,v,T,P,R,N,G,Z)=>{var j=v.transform;return o.extend(_d(w,s,f,y,v,T,P,R,N,G),{u_gamma_scale:y?Math.cos(j._pitch)*j.cameraToCenterDistance:1,u_device_pixel_ratio:v.pixelRatio,u_is_halo:+Z})},BT=(w,s,f,y,v,T,P,R,N,G)=>o.extend(xa(w,s,f,y,v,T,P,R,!0,N,!0),{u_texsize_icon:G,u_texture_icon:1}),bp=(w,s,f,y,v,T)=>o.extend(function(j,R,N,G){var Z=N.imageManager.getPattern(j.from.toString()),j=N.imageManager.getPattern(j.to.toString()),{width:X,height:ge}=N.imageManager.getPixelSize(),ye=Math.pow(2,G.tileID.overscaledZ),ye=(be=G.tileSize*Math.pow(2,N.transform.tileZoom)/ye)*(G.tileID.canonical.x+G.tileID.wrap*ye),be=be*G.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:Z.tl,u_pattern_br_a:Z.br,u_pattern_tl_b:j.tl,u_pattern_br_b:j.br,u_texsize:[X,ge],u_mix:R.t,u_pattern_size_a:Z.displaySize,u_pattern_size_b:j.displaySize,u_scale_a:R.fromScale,u_scale_b:R.toScale,u_tile_units_to_pixels:1/en(G,1,N.transform.tileZoom),u_pixel_coord_upper:[ye>>16,be>>16],u_pixel_coord_lower:[65535&ye,65535&be]}}(y,T,f,v),{u_matrix:w,u_opacity:s}),wp={fillExtrusion:(w,s)=>({u_matrix:new o.UniformMatrix4f(w,s.u_matrix),u_lightpos:new o.Uniform3f(w,s.u_lightpos),u_lightintensity:new o.Uniform1f(w,s.u_lightintensity),u_lightcolor:new o.Uniform3f(w,s.u_lightcolor),u_vertical_gradient:new o.Uniform1f(w,s.u_vertical_gradient),u_opacity:new o.Uniform1f(w,s.u_opacity)}),fillExtrusionPattern:(w,s)=>({u_matrix:new o.UniformMatrix4f(w,s.u_matrix),u_lightpos:new o.Uniform3f(w,s.u_lightpos),u_lightintensity:new o.Uniform1f(w,s.u_lightintensity),u_lightcolor:new o.Uniform3f(w,s.u_lightcolor),u_vertical_gradient:new o.Uniform1f(w,s.u_vertical_gradient),u_height_factor:new o.Uniform1f(w,s.u_height_factor),u_image:new o.Uniform1i(w,s.u_image),u_texsize:new o.Uniform2f(w,s.u_texsize),u_pixel_coord_upper:new o.Uniform2f(w,s.u_pixel_coord_upper),u_pixel_coord_lower:new o.Uniform2f(w,s.u_pixel_coord_lower),u_scale:new o.Uniform3f(w,s.u_scale),u_fade:new o.Uniform1f(w,s.u_fade),u_opacity:new o.Uniform1f(w,s.u_opacity)}),fill:(w,s)=>({u_matrix:new o.UniformMatrix4f(w,s.u_matrix)}),fillPattern:(w,s)=>({u_matrix:new o.UniformMatrix4f(w,s.u_matrix),u_image:new o.Uniform1i(w,s.u_image),u_texsize:new o.Uniform2f(w,s.u_texsize),u_pixel_coord_upper:new o.Uniform2f(w,s.u_pixel_coord_upper),u_pixel_coord_lower:new o.Uniform2f(w,s.u_pixel_coord_lower),u_scale:new o.Uniform3f(w,s.u_scale),u_fade:new o.Uniform1f(w,s.u_fade)}),fillOutline:(w,s)=>({u_matrix:new o.UniformMatrix4f(w,s.u_matrix),u_world:new o.Uniform2f(w,s.u_world)}),fillOutlinePattern:(w,s)=>({u_matrix:new o.UniformMatrix4f(w,s.u_matrix),u_world:new o.Uniform2f(w,s.u_world),u_image:new o.Uniform1i(w,s.u_image),u_texsize:new o.Uniform2f(w,s.u_texsize),u_pixel_coord_upper:new o.Uniform2f(w,s.u_pixel_coord_upper),u_pixel_coord_lower:new o.Uniform2f(w,s.u_pixel_coord_lower),u_scale:new o.Uniform3f(w,s.u_scale),u_fade:new o.Uniform1f(w,s.u_fade)}),circle:(w,s)=>({u_camera_to_center_distance:new o.Uniform1f(w,s.u_camera_to_center_distance),u_scale_with_map:new o.Uniform1i(w,s.u_scale_with_map),u_pitch_with_map:new o.Uniform1i(w,s.u_pitch_with_map),u_extrude_scale:new o.Uniform2f(w,s.u_extrude_scale),u_device_pixel_ratio:new o.Uniform1f(w,s.u_device_pixel_ratio),u_matrix:new o.UniformMatrix4f(w,s.u_matrix)}),collisionBox:(w,s)=>({u_matrix:new o.UniformMatrix4f(w,s.u_matrix),u_camera_to_center_distance:new o.Uniform1f(w,s.u_camera_to_center_distance),u_pixels_to_tile_units:new o.Uniform1f(w,s.u_pixels_to_tile_units),u_extrude_scale:new o.Uniform2f(w,s.u_extrude_scale),u_overscale_factor:new o.Uniform1f(w,s.u_overscale_factor)}),collisionCircle:(w,s)=>({u_matrix:new o.UniformMatrix4f(w,s.u_matrix),u_inv_matrix:new o.UniformMatrix4f(w,s.u_inv_matrix),u_camera_to_center_distance:new o.Uniform1f(w,s.u_camera_to_center_distance),u_viewport_size:new o.Uniform2f(w,s.u_viewport_size)}),debug:(w,s)=>({u_color:new o.UniformColor(w,s.u_color),u_matrix:new o.UniformMatrix4f(w,s.u_matrix),u_overlay:new o.Uniform1i(w,s.u_overlay),u_overlay_scale:new o.Uniform1f(w,s.u_overlay_scale)}),clippingMask:(w,s)=>({u_matrix:new o.UniformMatrix4f(w,s.u_matrix)}),heatmap:(w,s)=>({u_extrude_scale:new o.Uniform1f(w,s.u_extrude_scale),u_intensity:new o.Uniform1f(w,s.u_intensity),u_matrix:new o.UniformMatrix4f(w,s.u_matrix)}),heatmapTexture:(w,s)=>({u_matrix:new o.UniformMatrix4f(w,s.u_matrix),u_world:new o.Uniform2f(w,s.u_world),u_image:new o.Uniform1i(w,s.u_image),u_color_ramp:new o.Uniform1i(w,s.u_color_ramp),u_opacity:new o.Uniform1f(w,s.u_opacity)}),hillshade:(w,s)=>({u_matrix:new o.UniformMatrix4f(w,s.u_matrix),u_image:new o.Uniform1i(w,s.u_image),u_latrange:new o.Uniform2f(w,s.u_latrange),u_light:new o.Uniform2f(w,s.u_light),u_shadow:new o.UniformColor(w,s.u_shadow),u_highlight:new o.UniformColor(w,s.u_highlight),u_accent:new o.UniformColor(w,s.u_accent)}),hillshadePrepare:(w,s)=>({u_matrix:new o.UniformMatrix4f(w,s.u_matrix),u_image:new o.Uniform1i(w,s.u_image),u_dimension:new o.Uniform2f(w,s.u_dimension),u_zoom:new o.Uniform1f(w,s.u_zoom),u_unpack:new o.Uniform4f(w,s.u_unpack)}),line:(w,s)=>({u_matrix:new o.UniformMatrix4f(w,s.u_matrix),u_ratio:new o.Uniform1f(w,s.u_ratio),u_device_pixel_ratio:new o.Uniform1f(w,s.u_device_pixel_ratio),u_units_to_pixels:new o.Uniform2f(w,s.u_units_to_pixels)}),lineGradient:(w,s)=>({u_matrix:new o.UniformMatrix4f(w,s.u_matrix),u_ratio:new o.Uniform1f(w,s.u_ratio),u_device_pixel_ratio:new o.Uniform1f(w,s.u_device_pixel_ratio),u_units_to_pixels:new o.Uniform2f(w,s.u_units_to_pixels),u_image:new o.Uniform1i(w,s.u_image),u_image_height:new o.Uniform1f(w,s.u_image_height)}),linePattern:(w,s)=>({u_matrix:new o.UniformMatrix4f(w,s.u_matrix),u_texsize:new o.Uniform2f(w,s.u_texsize),u_ratio:new o.Uniform1f(w,s.u_ratio),u_device_pixel_ratio:new o.Uniform1f(w,s.u_device_pixel_ratio),u_image:new o.Uniform1i(w,s.u_image),u_units_to_pixels:new o.Uniform2f(w,s.u_units_to_pixels),u_scale:new o.Uniform3f(w,s.u_scale),u_fade:new o.Uniform1f(w,s.u_fade)}),lineSDF:(w,s)=>({u_matrix:new o.UniformMatrix4f(w,s.u_matrix),u_ratio:new o.Uniform1f(w,s.u_ratio),u_device_pixel_ratio:new o.Uniform1f(w,s.u_device_pixel_ratio),u_units_to_pixels:new o.Uniform2f(w,s.u_units_to_pixels),u_patternscale_a:new o.Uniform2f(w,s.u_patternscale_a),u_patternscale_b:new o.Uniform2f(w,s.u_patternscale_b),u_sdfgamma:new o.Uniform1f(w,s.u_sdfgamma),u_image:new o.Uniform1i(w,s.u_image),u_tex_y_a:new o.Uniform1f(w,s.u_tex_y_a),u_tex_y_b:new o.Uniform1f(w,s.u_tex_y_b),u_mix:new o.Uniform1f(w,s.u_mix)}),raster:(w,s)=>({u_matrix:new o.UniformMatrix4f(w,s.u_matrix),u_tl_parent:new o.Uniform2f(w,s.u_tl_parent),u_scale_parent:new o.Uniform1f(w,s.u_scale_parent),u_buffer_scale:new o.Uniform1f(w,s.u_buffer_scale),u_fade_t:new o.Uniform1f(w,s.u_fade_t),u_opacity:new o.Uniform1f(w,s.u_opacity),u_image0:new o.Uniform1i(w,s.u_image0),u_image1:new o.Uniform1i(w,s.u_image1),u_brightness_low:new o.Uniform1f(w,s.u_brightness_low),u_brightness_high:new o.Uniform1f(w,s.u_brightness_high),u_saturation_factor:new o.Uniform1f(w,s.u_saturation_factor),u_contrast_factor:new o.Uniform1f(w,s.u_contrast_factor),u_spin_weights:new o.Uniform3f(w,s.u_spin_weights)}),symbolIcon:(w,s)=>({u_is_size_zoom_constant:new o.Uniform1i(w,s.u_is_size_zoom_constant),u_is_size_feature_constant:new o.Uniform1i(w,s.u_is_size_feature_constant),u_size_t:new o.Uniform1f(w,s.u_size_t),u_size:new o.Uniform1f(w,s.u_size),u_camera_to_center_distance:new o.Uniform1f(w,s.u_camera_to_center_distance),u_pitch:new o.Uniform1f(w,s.u_pitch),u_rotate_symbol:new o.Uniform1i(w,s.u_rotate_symbol),u_aspect_ratio:new o.Uniform1f(w,s.u_aspect_ratio),u_fade_change:new o.Uniform1f(w,s.u_fade_change),u_matrix:new o.UniformMatrix4f(w,s.u_matrix),u_label_plane_matrix:new o.UniformMatrix4f(w,s.u_label_plane_matrix),u_coord_matrix:new o.UniformMatrix4f(w,s.u_coord_matrix),u_is_text:new o.Uniform1i(w,s.u_is_text),u_pitch_with_map:new o.Uniform1i(w,s.u_pitch_with_map),u_texsize:new o.Uniform2f(w,s.u_texsize),u_texture:new o.Uniform1i(w,s.u_texture)}),symbolSDF:(w,s)=>({u_is_size_zoom_constant:new o.Uniform1i(w,s.u_is_size_zoom_constant),u_is_size_feature_constant:new o.Uniform1i(w,s.u_is_size_feature_constant),u_size_t:new o.Uniform1f(w,s.u_size_t),u_size:new o.Uniform1f(w,s.u_size),u_camera_to_center_distance:new o.Uniform1f(w,s.u_camera_to_center_distance),u_pitch:new o.Uniform1f(w,s.u_pitch),u_rotate_symbol:new o.Uniform1i(w,s.u_rotate_symbol),u_aspect_ratio:new o.Uniform1f(w,s.u_aspect_ratio),u_fade_change:new o.Uniform1f(w,s.u_fade_change),u_matrix:new o.UniformMatrix4f(w,s.u_matrix),u_label_plane_matrix:new o.UniformMatrix4f(w,s.u_label_plane_matrix),u_coord_matrix:new o.UniformMatrix4f(w,s.u_coord_matrix),u_is_text:new o.Uniform1i(w,s.u_is_text),u_pitch_with_map:new o.Uniform1i(w,s.u_pitch_with_map),u_texsize:new o.Uniform2f(w,s.u_texsize),u_texture:new o.Uniform1i(w,s.u_texture),u_gamma_scale:new o.Uniform1f(w,s.u_gamma_scale),u_device_pixel_ratio:new o.Uniform1f(w,s.u_device_pixel_ratio),u_is_halo:new o.Uniform1i(w,s.u_is_halo)}),symbolTextAndIcon:(w,s)=>({u_is_size_zoom_constant:new o.Uniform1i(w,s.u_is_size_zoom_constant),u_is_size_feature_constant:new o.Uniform1i(w,s.u_is_size_feature_constant),u_size_t:new o.Uniform1f(w,s.u_size_t),u_size:new o.Uniform1f(w,s.u_size),u_camera_to_center_distance:new o.Uniform1f(w,s.u_camera_to_center_distance),u_pitch:new o.Uniform1f(w,s.u_pitch),u_rotate_symbol:new o.Uniform1i(w,s.u_rotate_symbol),u_aspect_ratio:new o.Uniform1f(w,s.u_aspect_ratio),u_fade_change:new o.Uniform1f(w,s.u_fade_change),u_matrix:new o.UniformMatrix4f(w,s.u_matrix),u_label_plane_matrix:new o.UniformMatrix4f(w,s.u_label_plane_matrix),u_coord_matrix:new o.UniformMatrix4f(w,s.u_coord_matrix),u_is_text:new o.Uniform1i(w,s.u_is_text),u_pitch_with_map:new o.Uniform1i(w,s.u_pitch_with_map),u_texsize:new o.Uniform2f(w,s.u_texsize),u_texsize_icon:new o.Uniform2f(w,s.u_texsize_icon),u_texture:new o.Uniform1i(w,s.u_texture),u_texture_icon:new o.Uniform1i(w,s.u_texture_icon),u_gamma_scale:new o.Uniform1f(w,s.u_gamma_scale),u_device_pixel_ratio:new o.Uniform1f(w,s.u_device_pixel_ratio),u_is_halo:new o.Uniform1i(w,s.u_is_halo)}),background:(w,s)=>({u_matrix:new o.UniformMatrix4f(w,s.u_matrix),u_opacity:new o.Uniform1f(w,s.u_opacity),u_color:new o.UniformColor(w,s.u_color)}),backgroundPattern:(w,s)=>({u_matrix:new o.UniformMatrix4f(w,s.u_matrix),u_opacity:new o.Uniform1f(w,s.u_opacity),u_image:new o.Uniform1i(w,s.u_image),u_pattern_tl_a:new o.Uniform2f(w,s.u_pattern_tl_a),u_pattern_br_a:new o.Uniform2f(w,s.u_pattern_br_a),u_pattern_tl_b:new o.Uniform2f(w,s.u_pattern_tl_b),u_pattern_br_b:new o.Uniform2f(w,s.u_pattern_br_b),u_texsize:new o.Uniform2f(w,s.u_texsize),u_mix:new o.Uniform1f(w,s.u_mix),u_pattern_size_a:new o.Uniform2f(w,s.u_pattern_size_a),u_pattern_size_b:new o.Uniform2f(w,s.u_pattern_size_b),u_scale_a:new o.Uniform1f(w,s.u_scale_a),u_scale_b:new o.Uniform1f(w,s.u_scale_b),u_pixel_coord_upper:new o.Uniform2f(w,s.u_pixel_coord_upper),u_pixel_coord_lower:new o.Uniform2f(w,s.u_pixel_coord_lower),u_tile_units_to_pixels:new o.Uniform1f(w,s.u_tile_units_to_pixels)}),terrain:(w,s)=>({u_matrix:new o.UniformMatrix4f(w,s.u_matrix),u_texture:new o.Uniform1i(w,s.u_texture),u_ele_delta:new o.Uniform1f(w,s.u_ele_delta)}),terrainDepth:(w,s)=>({u_matrix:new o.UniformMatrix4f(w,s.u_matrix),u_ele_delta:new o.Uniform1f(w,s.u_ele_delta)}),terrainCoords:(w,s)=>({u_matrix:new o.UniformMatrix4f(w,s.u_matrix),u_texture:new o.Uniform1i(w,s.u_texture),u_terrain_coords_id:new o.Uniform1f(w,s.u_terrain_coords_id),u_ele_delta:new o.Uniform1f(w,s.u_ele_delta)})};class vd{constructor(s,f,y){var v=(this.context=s).gl;this.buffer=v.createBuffer(),this.dynamicDraw=!!y,this.context.unbindVAO(),s.bindElementBuffer.set(this.buffer),v.bufferData(v.ELEMENT_ARRAY_BUFFER,f.arrayBuffer,this.dynamicDraw?v.DYNAMIC_DRAW:v.STATIC_DRAW),this.dynamicDraw||delete f.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(s){var f=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),f.bufferSubData(f.ELEMENT_ARRAY_BUFFER,0,s.arrayBuffer)}destroy(){var s=this.context.gl;this.buffer&&(s.deleteBuffer(this.buffer),delete this.buffer)}}const xp={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Ep{constructor(s,f,y,v){this.length=f.length,this.attributes=y,this.itemSize=f.bytesPerElement,this.dynamicDraw=v,y=(this.context=s).gl,this.buffer=y.createBuffer(),s.bindVertexBuffer.set(this.buffer),y.bufferData(y.ARRAY_BUFFER,f.arrayBuffer,this.dynamicDraw?y.DYNAMIC_DRAW:y.STATIC_DRAW),this.dynamicDraw||delete f.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(s){if(s.length!==this.length)throw new Error(`Length of new data is ${s.length}, which doesn't match current length of `+this.length);var f=this.context.gl;this.bind(),f.bufferSubData(f.ARRAY_BUFFER,0,s.arrayBuffer)}enableAttributes(s,f){for(let v=0;v<this.attributes.length;v++){var y=this.attributes[v],y=f.attributes[y.name];y!==void 0&&s.enableVertexAttribArray(y)}}setVertexAttribPointers(s,f,y){for(let P=0;P<this.attributes.length;P++){var v=this.attributes[P],T=f.attributes[v.name];T!==void 0&&s.vertexAttribPointer(T,v.components,s[xp[v.type]],!1,this.itemSize,v.offset+this.itemSize*(y||0))}}destroy(){var s=this.context.gl;this.buffer&&(s.deleteBuffer(this.buffer),delete this.buffer)}}const Fl=new WeakMap;function Tp(w){var s;return Fl.has(w)?Fl.get(w):(s=(s=w.getParameter(w.VERSION))==null?void 0:s.startsWith("WebGL 2.0"),Fl.set(w,s),s)}class br{constructor(s){this.gl=s.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(s){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class UT extends br{getDefault(){return o.Color.transparent}set(s){var f=this.current;s.r===f.r&&s.g===f.g&&s.b===f.b&&s.a===f.a&&!this.dirty||(this.gl.clearColor(s.r,s.g,s.b,s.a),this.current=s,this.dirty=!1)}}class Bl extends br{getDefault(){return 1}set(s){s===this.current&&!this.dirty||(this.gl.clearDepth(s),this.current=s,this.dirty=!1)}}class Sp extends br{getDefault(){return 0}set(s){s===this.current&&!this.dirty||(this.gl.clearStencil(s),this.current=s,this.dirty=!1)}}class Ea extends br{getDefault(){return[!0,!0,!0,!0]}set(s){var f=this.current;s[0]===f[0]&&s[1]===f[1]&&s[2]===f[2]&&s[3]===f[3]&&!this.dirty||(this.gl.colorMask(s[0],s[1],s[2],s[3]),this.current=s,this.dirty=!1)}}class Ta extends br{getDefault(){return!0}set(s){s===this.current&&!this.dirty||(this.gl.depthMask(s),this.current=s,this.dirty=!1)}}class Cy extends br{getDefault(){return 255}set(s){s===this.current&&!this.dirty||(this.gl.stencilMask(s),this.current=s,this.dirty=!1)}}class bd extends br{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(s){var f=this.current;s.func===f.func&&s.ref===f.ref&&s.mask===f.mask&&!this.dirty||(this.gl.stencilFunc(s.func,s.ref,s.mask),this.current=s,this.dirty=!1)}}class Cp extends br{getDefault(){var s=this.gl;return[s.KEEP,s.KEEP,s.KEEP]}set(s){var f=this.current;s[0]===f[0]&&s[1]===f[1]&&s[2]===f[2]&&!this.dirty||(this.gl.stencilOp(s[0],s[1],s[2]),this.current=s,this.dirty=!1)}}class Ab extends br{getDefault(){return!1}set(s){var f;s===this.current&&!this.dirty||(f=this.gl,s?f.enable(f.STENCIL_TEST):f.disable(f.STENCIL_TEST),this.current=s,this.dirty=!1)}}class Ib extends br{getDefault(){return[0,1]}set(s){var f=this.current;s[0]===f[0]&&s[1]===f[1]&&!this.dirty||(this.gl.depthRange(s[0],s[1]),this.current=s,this.dirty=!1)}}class Hu extends br{getDefault(){return!1}set(s){var f;s===this.current&&!this.dirty||(f=this.gl,s?f.enable(f.DEPTH_TEST):f.disable(f.DEPTH_TEST),this.current=s,this.dirty=!1)}}class wd extends br{getDefault(){return this.gl.LESS}set(s){s===this.current&&!this.dirty||(this.gl.depthFunc(s),this.current=s,this.dirty=!1)}}class xd extends br{getDefault(){return!1}set(s){var f;s===this.current&&!this.dirty||(f=this.gl,s?f.enable(f.BLEND):f.disable(f.BLEND),this.current=s,this.dirty=!1)}}class fc extends br{getDefault(){var s=this.gl;return[s.ONE,s.ZERO]}set(s){var f=this.current;s[0]===f[0]&&s[1]===f[1]&&!this.dirty||(this.gl.blendFunc(s[0],s[1]),this.current=s,this.dirty=!1)}}class Ap extends br{getDefault(){return o.Color.transparent}set(s){var f=this.current;s.r===f.r&&s.g===f.g&&s.b===f.b&&s.a===f.a&&!this.dirty||(this.gl.blendColor(s.r,s.g,s.b,s.a),this.current=s,this.dirty=!1)}}class Gu extends br{getDefault(){return this.gl.FUNC_ADD}set(s){s===this.current&&!this.dirty||(this.gl.blendEquation(s),this.current=s,this.dirty=!1)}}class Pb extends br{getDefault(){return!1}set(s){var f;s===this.current&&!this.dirty||(f=this.gl,s?f.enable(f.CULL_FACE):f.disable(f.CULL_FACE),this.current=s,this.dirty=!1)}}class Ay extends br{getDefault(){return this.gl.BACK}set(s){s===this.current&&!this.dirty||(this.gl.cullFace(s),this.current=s,this.dirty=!1)}}class Ul extends br{getDefault(){return this.gl.CCW}set(s){s===this.current&&!this.dirty||(this.gl.frontFace(s),this.current=s,this.dirty=!1)}}class Iy extends br{getDefault(){return null}set(s){s===this.current&&!this.dirty||(this.gl.useProgram(s),this.current=s,this.dirty=!1)}}class qu extends br{getDefault(){return this.gl.TEXTURE0}set(s){s===this.current&&!this.dirty||(this.gl.activeTexture(s),this.current=s,this.dirty=!1)}}class $u extends br{getDefault(){var s=this.gl;return[0,0,s.drawingBufferWidth,s.drawingBufferHeight]}set(s){var f=this.current;s[0]===f[0]&&s[1]===f[1]&&s[2]===f[2]&&s[3]===f[3]&&!this.dirty||(this.gl.viewport(s[0],s[1],s[2],s[3]),this.current=s,this.dirty=!1)}}class Mb extends br{getDefault(){return null}set(s){var f;s===this.current&&!this.dirty||((f=this.gl).bindFramebuffer(f.FRAMEBUFFER,s),this.current=s,this.dirty=!1)}}class Py extends br{getDefault(){return null}set(s){var f;s===this.current&&!this.dirty||((f=this.gl).bindRenderbuffer(f.RENDERBUFFER,s),this.current=s,this.dirty=!1)}}class yr extends br{getDefault(){return null}set(s){var f;s===this.current&&!this.dirty||((f=this.gl).bindTexture(f.TEXTURE_2D,s),this.current=s,this.dirty=!1)}}class Ip extends br{getDefault(){return null}set(s){var f;s===this.current&&!this.dirty||((f=this.gl).bindBuffer(f.ARRAY_BUFFER,s),this.current=s,this.dirty=!1)}}class zT extends br{getDefault(){return null}set(s){var f=this.gl;f.bindBuffer(f.ELEMENT_ARRAY_BUFFER,s),this.current=s,this.dirty=!1}}class Rb extends br{getDefault(){return null}set(s){var f;s===this.current&&!this.dirty||(Tp(f=this.gl)?f.bindVertexArray(s):(f=f.getExtension("OES_vertex_array_object"))!=null&&f.bindVertexArrayOES(s),this.current=s,this.dirty=!1)}}class Ed extends br{getDefault(){return 4}set(s){var f;s===this.current&&!this.dirty||((f=this.gl).pixelStorei(f.UNPACK_ALIGNMENT,s),this.current=s,this.dirty=!1)}}class jT extends br{getDefault(){return!1}set(s){var f;s===this.current&&!this.dirty||((f=this.gl).pixelStorei(f.UNPACK_PREMULTIPLY_ALPHA_WEBGL,s),this.current=s,this.dirty=!1)}}class VT extends br{getDefault(){return!1}set(s){var f;s===this.current&&!this.dirty||((f=this.gl).pixelStorei(f.UNPACK_FLIP_Y_WEBGL,s),this.current=s,this.dirty=!1)}}class Pp extends br{constructor(s,f){super(s),this.context=s,this.parent=f}getDefault(){return null}}class HT extends Pp{setDirty(){this.dirty=!0}set(s){var f;s===this.current&&!this.dirty||(this.context.bindFramebuffer.set(this.parent),(f=this.gl).framebufferTexture2D(f.FRAMEBUFFER,f.COLOR_ATTACHMENT0,f.TEXTURE_2D,s,0),this.current=s,this.dirty=!1)}}class My extends Pp{set(s){var f;s===this.current&&!this.dirty||(this.context.bindFramebuffer.set(this.parent),(f=this.gl).framebufferRenderbuffer(f.FRAMEBUFFER,f.DEPTH_ATTACHMENT,f.RENDERBUFFER,s),this.current=s,this.dirty=!1)}}class Mp extends Pp{set(s){var f;s===this.current&&!this.dirty||(this.context.bindFramebuffer.set(this.parent),(f=this.gl).framebufferRenderbuffer(f.FRAMEBUFFER,f.DEPTH_STENCIL_ATTACHMENT,f.RENDERBUFFER,s),this.current=s,this.dirty=!1)}}class Rp{constructor(s,f,y,v,T){if(this.context=s,this.width=f,this.height=y,f=s.gl,y=this.framebuffer=f.createFramebuffer(),this.colorAttachment=new HT(s,y),v)this.depthAttachment=new(T?Mp:My)(s,y);else if(T)throw new Error("Stencil cannot be set without depth");if(f.checkFramebufferStatus(f.FRAMEBUFFER)!==f.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer is not complete")}destroy(){var s=this.context.gl,f=this.colorAttachment.get();f&&s.deleteTexture(f),this.depthAttachment&&(f=this.depthAttachment.get())&&s.deleteRenderbuffer(f),s.deleteFramebuffer(this.framebuffer)}}class hi{constructor(s,f,y){this.blendFunction=s,this.blendColor=f,this.mask=y}}hi.Replace=[1,0],hi.disabled=new hi(hi.Replace,o.Color.transparent,[!1,!1,!1,!1]),hi.unblended=new hi(hi.Replace,o.Color.transparent,[!0,!0,!0,!0]),hi.alphaBlended=new hi([1,771],o.Color.transparent,[!0,!0,!0,!0]);class kp{constructor(s){var f,y;this.gl=s,this.clearColor=new UT(this),this.clearDepth=new Bl(this),this.clearStencil=new Sp(this),this.colorMask=new Ea(this),this.depthMask=new Ta(this),this.stencilMask=new Cy(this),this.stencilFunc=new bd(this),this.stencilOp=new Cp(this),this.stencilTest=new Ab(this),this.depthRange=new Ib(this),this.depthTest=new Hu(this),this.depthFunc=new wd(this),this.blend=new xd(this),this.blendFunc=new fc(this),this.blendColor=new Ap(this),this.blendEquation=new Gu(this),this.cullFace=new Pb(this),this.cullFaceSide=new Ay(this),this.frontFace=new Ul(this),this.program=new Iy(this),this.activeTexture=new qu(this),this.viewport=new $u(this),this.bindFramebuffer=new Mb(this),this.bindRenderbuffer=new Py(this),this.bindTexture=new yr(this),this.bindVertexBuffer=new Ip(this),this.bindElementBuffer=new zT(this),this.bindVertexArray=new Rb(this),this.pixelStoreUnpack=new Ed(this),this.pixelStoreUnpackPremultiplyAlpha=new jT(this),this.pixelStoreUnpackFlipY=new VT(this),this.extTextureFilterAnisotropic=s.getExtension("EXT_texture_filter_anisotropic")||s.getExtension("MOZ_EXT_texture_filter_anisotropic")||s.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=s.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=s.getParameter(s.MAX_TEXTURE_SIZE),Tp(s)?(this.HALF_FLOAT=s.HALF_FLOAT,f=s.getExtension("EXT_color_buffer_half_float"),this.RGBA16F=(y=s.RGBA16F)!=null?y:f==null?void 0:f.RGBA16F_EXT,this.RGB16F=(y=s.RGB16F)!=null?y:f==null?void 0:f.RGB16F_EXT,s.getExtension("EXT_color_buffer_float")):(s.getExtension("EXT_color_buffer_half_float"),s.getExtension("OES_texture_half_float_linear"),y=s.getExtension("OES_texture_half_float"),this.HALF_FLOAT=y==null?void 0:y.HALF_FLOAT_OES)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(s,f){return new vd(this,s,f)}createVertexBuffer(s,f,y){return new Ep(this,s,f,y)}createRenderbuffer(s,f,y){var v=this.gl,T=v.createRenderbuffer();return this.bindRenderbuffer.set(T),v.renderbufferStorage(v.RENDERBUFFER,s,f,y),this.bindRenderbuffer.set(null),T}createFramebuffer(s,f,y,v){return new Rp(this,s,f,y,v)}clear({color:s,depth:f,stencil:y}){var v=this.gl;let T=0;s&&(T|=v.COLOR_BUFFER_BIT,this.clearColor.set(s),this.colorMask.set([!0,!0,!0,!0])),f!==void 0&&(T|=v.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(f),this.depthMask.set(!0)),y!==void 0&&(T|=v.STENCIL_BUFFER_BIT,this.clearStencil.set(y),this.stencilMask.set(255)),v.clear(T)}setCullFace(s){s.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(s.mode),this.frontFace.set(s.frontFace))}setDepthMode(s){s.func!==this.gl.ALWAYS||s.mask?(this.depthTest.set(!0),this.depthFunc.set(s.func),this.depthMask.set(s.mask),this.depthRange.set(s.range)):this.depthTest.set(!1)}setStencilMode(s){s.test.func!==this.gl.ALWAYS||s.mask?(this.stencilTest.set(!0),this.stencilMask.set(s.mask),this.stencilOp.set([s.fail,s.depthFail,s.pass]),this.stencilFunc.set({func:s.test.func,ref:s.ref,mask:s.test.mask})):this.stencilTest.set(!1)}setColorMode(s){o.deepEqual(s.blendFunction,hi.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(s.blendFunction),this.blendColor.set(s.blendColor)),this.colorMask.set(s.mask)}createVertexArray(){var s;return Tp(this.gl)?this.gl.createVertexArray():(s=this.gl.getExtension("OES_vertex_array_object"))==null?void 0:s.createVertexArrayOES()}deleteVertexArray(s){var f;return Tp(this.gl)?this.gl.deleteVertexArray(s):(f=this.gl.getExtension("OES_vertex_array_object"))==null?void 0:f.deleteVertexArrayOES(s)}unbindVAO(){this.bindVertexArray.set(null)}}class ur{constructor(s,f,y){this.func=s,this.mask=f,this.range=y}}ur.ReadOnly=!1,ur.ReadWrite=!0,ur.disabled=new ur(519,ur.ReadOnly,[0,1]);class ii{constructor(s,f,y,v,T,P){this.test=s,this.ref=f,this.mask=y,this.fail=v,this.depthFail=T,this.pass=P}}ii.disabled=new ii({func:519,mask:0},0,0,7680,7680,7680);class qr{constructor(s,f,y){this.enable=s,this.mode=f,this.frontFace=y}}qr.disabled=new qr(!1,1029,2305),qr.backCCW=new qr(!0,1029,2305);let Op;function kb(w,s,f,y,v,T,P){var R=w.context,N=R.gl,G=w.useProgram("collisionBox"),Z=[];let j=0,X=0;for(let vn=0;vn<y.length;vn++){var ge=y[vn],ye=s.getTile(ge),be=ye.getBucket(f);if(be){let Kt=ge.posMatrix;v[0]===0&&v[1]===0||(Kt=w.translatePosMatrix(ge.posMatrix,ye,v,T));var ve,Fe,Ue=P?be.textCollisionBox:be.iconCollisionBox,ze=be.collisionCircleArray;0<ze.length&&(ve=o.create(),Fe=Kt,o.mul(ve,be.placementInvProjMatrix,w.transform.glCoordMatrix),o.mul(ve,ve,be.placementViewportMatrix),Z.push({circleArray:ze,circleOffset:X,transform:Fe,invTransform:ve,coord:ge}),j+=ze.length/4,X=j),Ue&&G.draw(R,N.LINES,ur.disabled,ii.disabled,w.colorModeForRenderPass(),qr.disabled,yt(Kt,w.transform,ye),w.style.map.terrain&&w.style.map.terrain.getTerrainData(ge),f.id,Ue.layoutVertexBuffer,Ue.indexBuffer,Ue.segments,null,w.transform.zoom,null,null,Ue.collisionVertexBuffer)}}if(P&&Z.length){var Qe=w.useProgram("collisionCircle"),Je=new o.CollisionCircleLayoutArray;Je.resize(4*j),Je._trim();let vn=0;for(const Kt of Z)for(let Ct=0;Ct<Kt.circleArray.length/4;Ct++){var _t=4*Ct,Xe=Kt.circleArray[0+_t],ct=Kt.circleArray[1+_t],it=Kt.circleArray[2+_t],_t=Kt.circleArray[3+_t];Je.emplace(vn++,Xe,ct,it,_t,0),Je.emplace(vn++,Xe,ct,it,_t,1),Je.emplace(vn++,Xe,ct,it,_t,2),Je.emplace(vn++,Xe,ct,it,_t,3)}(!Op||Op.length<2*j)&&(Op=function(Kt){var Ct=2*Kt,cn=new o.QuadTriangleArray;cn.resize(Ct),cn._trim();for(let $t=0;$t<Ct;$t++){var Cn=6*$t;cn.uint16[0+Cn]=4*$t+0,cn.uint16[1+Cn]=4*$t+1,cn.uint16[2+Cn]=4*$t+2,cn.uint16[3+Cn]=4*$t+2,cn.uint16[4+Cn]=4*$t+3,cn.uint16[5+Cn]=4*$t+0}return cn}(j));var Dt=R.createIndexBuffer(Op,!0),Yt=R.createVertexBuffer(Je,o.collisionCircleLayout.members,!0);for(const Kt of Z){var _n=Qt(Kt.transform,Kt.invTransform,w.transform);Qe.draw(R,N.TRIANGLES,ur.disabled,ii.disabled,w.colorModeForRenderPass(),qr.disabled,_n,w.style.map.terrain&&w.style.map.terrain.getTerrainData(Kt.coord),f.id,Yt,Dt,o.SegmentVector.simpleSegment(0,2*Kt.circleOffset,Kt.circleArray.length,Kt.circleArray.length/2),null,w.transform.zoom,null,null,null)}Yt.destroy(),Dt.destroy()}}const Ry=o.identity(new Float32Array(16));function GT(w,s,f,y,v){if(w.renderPass==="translucent"){var T=ii.disabled,P=w.colorModeForRenderPass();if(f._unevaluatedLayout.hasValue("text-variable-anchor")||f._unevaluatedLayout.hasValue("text-variable-anchor-offset")){var R=y,N=w,G=f,Z=s,j=f.layout.get("text-rotation-alignment"),X=f.layout.get("text-pitch-alignment"),ge=v,ye=N.transform,be=j==="map",ve=X==="map";for(const ct of R){var Fe,Ue,ze,Qe,Je=Z.getTile(ct),Xe=Je.getBucket(G);Xe&&Xe.text&&Xe.text.segments.get().length&&(Fe=Xe.textSizeData,Fe=o.evaluateSizeForZoom(Fe,ye.zoom),Ue=en(Je,1,N.transform.zoom),Ue=Tr(ct.posMatrix,ve,be,N.transform,Ue),ze=G.layout.get("icon-text-fit")!=="none"&&Xe.hasIconData(),Fe)&&(Je=Math.pow(2,ye.zoom-Je.tileID.overscaledZ),Qe=N.style.map.terrain?(it,_t)=>N.style.map.terrain.getElevation(ct,it,_t):null,function(it,_t,Dt,Yt,_n,vn,Kt,Ct,cn,Cn,$t){var tr=it.text.placedSymbolArray,Ir=it.text.dynamicLayoutVertexArray,Qn=it.icon.dynamicLayoutVertexArray,or={};Ir.clear();for(let jr=0;jr<tr.length;jr++){var Ln=tr.get(jr),Pr=it.allowVerticalPlacement&&!Ln.placedOrientation,Pr=Ln.hidden||!Ln.crossTileID||Pr?null:Yt[Ln.crossTileID];if(Pr){var ar=new o.Point(Ln.anchorX,Ln.anchorY),wr=V(ar,Dt?Kt:vn,$t),_o=$(_n.cameraToCenterDistance,wr.signedDistanceFromCamera);let $r=o.evaluateSizeForFeature(it.textSizeData,cn,Ln)*_o/o.ONE_EM;Dt&&($r*=it.tilePixelRatio/Ct);var{width:_o,height:Pr,anchor:vo,textOffset:Qi,textBoxScale:gs}=Pr,vo=function(Zr,Mi,jc,Vs,Fi,Hs){var{horizontalAlign:Zr,verticalAlign:Vc}=o.getAnchorAlignment(Zr),Zr=-(Zr-.5)*Mi,Mi=-(Vc-.5)*jc;return new o.Point((Zr/Fi+Vs[0])*Hs,(Mi/Fi+Vs[1])*Hs)}(vo,_o,Pr,Qi,gs,$r),oi=Dt?V(ar.add(vo),vn,$t).point:wr.point.add(_t?vo.rotate(-_n.angle):vo),pi=it.allowVerticalPlacement&&Ln.placedOrientation===o.WritingMode.vertical?Math.PI/2:0;for(let ai=0;ai<Ln.numGlyphs;ai++)o.addDynamicAttributes(Ir,oi,pi);Cn&&0<=Ln.associatedIconIndex&&(or[Ln.associatedIconIndex]={shiftedAnchor:oi,angle:pi})}else st(Ln.numGlyphs,Ir)}if(Cn){Qn.clear();var js=it.icon.placedSymbolArray;for(let jr=0;jr<js.length;jr++){var zr=js.get(jr);if(zr.hidden)st(zr.numGlyphs,Qn);else{var bo=or[jr];if(bo)for(let $r=0;$r<zr.numGlyphs;$r++)o.addDynamicAttributes(Qn,bo.shiftedAnchor,bo.angle);else st(zr.numGlyphs,Qn)}}it.icon.dynamicLayoutVertexBuffer.updateData(Qn)}it.text.dynamicLayoutVertexBuffer.updateData(Ir)}(Xe,be,ve,ge,ye,Ue,ct.posMatrix,Je,Fe,ze,Qe))}}f.paint.get("icon-opacity").constantOr(1)!==0&&Lp(w,s,f,y,!1,f.paint.get("icon-translate"),f.paint.get("icon-translate-anchor"),f.layout.get("icon-rotation-alignment"),f.layout.get("icon-pitch-alignment"),f.layout.get("icon-keep-upright"),T,P),f.paint.get("text-opacity").constantOr(1)!==0&&Lp(w,s,f,y,!0,f.paint.get("text-translate"),f.paint.get("text-translate-anchor"),f.layout.get("text-rotation-alignment"),f.layout.get("text-pitch-alignment"),f.layout.get("text-keep-upright"),T,P),s.map.showCollisionBoxes&&(kb(w,s,f,y,f.paint.get("text-translate"),f.paint.get("text-translate-anchor"),!0),kb(w,s,f,y,f.paint.get("icon-translate"),f.paint.get("icon-translate-anchor"),!1))}}function Lp(w,s,f,y,v,T,P,R,N,G,Z,j){var X=w.context,ge=X.gl,ye=w.transform,be=R==="map",ve=N==="map",Fe=R!=="viewport"&&f.layout.get("symbol-placement")!=="point",Ue=be&&!ve&&!Fe,ze=!f.layout.get("symbol-sort-key").isConstant();let Qe=!1;var Je=w.depthModeForSublayer(0,ur.ReadOnly),Xe=f._unevaluatedLayout.hasValue("text-variable-anchor")||f._unevaluatedLayout.hasValue("text-variable-anchor-offset"),ct=[];for(const Mi of y){var it=s.getTile(Mi),_t=it.getBucket(f);if(_t){var Dt=v?_t.text:_t.icon;if(Dt&&Dt.segments.get().length&&Dt.hasVisibleVertices){var Cn=Dt.programConfigurations.get(f.id),Yt=v||_t.sdfIcons,_n=v?_t.textSizeData:_t.iconSizeData,cn=ve||ye.pitch!==0,vn=w.useProgram((Kt=Yt,vn=v,_t.iconsInText&&vn?"symbolTextAndIcon":Kt?"symbolSDF":"symbolIcon"),Cn),Kt=o.evaluateSizeForZoom(_n,ye.zoom),Ct=w.style.map.terrain&&w.style.map.terrain.getTerrainData(Mi);let Gs,qs=[0,0],th,Hc,o_=null,a1;v?(th=it.glyphAtlasTexture,Hc=ge.LINEAR,Gs=it.glyphAtlasTexture.size,_t.iconsInText&&(qs=it.imageAtlasTexture.size,o_=it.imageAtlasTexture,Cn=_n.kind==="composite"||_n.kind==="camera",a1=cn||w.options.rotating||w.options.zooming||Cn?ge.LINEAR:ge.NEAREST)):(Cn=f.layout.get("icon-size").constantOr(0)!==1||_t.iconsNeedLinear,th=it.imageAtlasTexture,Hc=Yt||w.options.rotating||w.options.zooming||Cn||cn?ge.LINEAR:ge.NEAREST,Gs=it.imageAtlasTexture.size);var Cn=en(it,1,w.transform.zoom),cn=Tr(Mi.posMatrix,ve,be,w.transform,Cn),Cn=oe(Mi.posMatrix,ve,be,w.transform,Cn),$t=Xe&&_t.hasTextData(),$t=f.layout.get("icon-text-fit")!=="none"&&$t&&_t.hasIconData();if(Fe){var tr=w.style.map.terrain?(ms,nh)=>w.style.map.terrain.getElevation(Mi,ms,nh):null,Ir=f.layout.get("text-rotation-alignment")==="map";{Qn=void 0,or=void 0,Ln=void 0,Pr=void 0,ar=void 0,wr=void 0,_o=void 0,Qi=void 0,gs=void 0,vo=void 0,oi=void 0,pi=void 0,js=void 0,zr=void 0,bo=void 0,jr=void 0,$r=void 0,Fi=void 0,ai=void 0,Ji=void 0,Io=void 0,jc=void 0,Vs=void 0;var Qn=_t,or=Mi.posMatrix,Ln=w,Pr=v,ar=cn,wr=Cn,_o=ve,Qi=G,gs=Ir,vo=tr,oi=Pr?Qn.textSizeData:Qn.iconSizeData,pi=o.evaluateSizeForZoom(oi,Ln.transform.zoom),js=[256/Ln.width*2+1,256/Ln.height*2+1],zr=(Pr?Qn.text:Qn.icon).dynamicLayoutVertexArray,bo=(zr.clear(),Qn.lineVertexArray),jr=(Pr?Qn.text:Qn.icon).placedSymbolArray,$r=Ln.transform.width/Ln.transform.height;let ms=!1;for(let nh=0;nh<jr.length;nh++){var Io,ai,Ji,jc,Vs,Fi=jr.get(nh);if(Fi.hidden||Fi.writingMode===o.WritingMode.vertical&&!ms)st(Fi.numGlyphs,zr);else{ms=!1;let mc;vo?(mc=[Fi.anchorX,Fi.anchorY,vo(Fi.anchorX,Fi.anchorY),1],o.transformMat4(mc,mc,or)):St(mc=[Fi.anchorX,Fi.anchorY,0,1],mc,or),Ji=mc,ai=js,Io=void 0,Io=Ji[0]/Ji[3],Ji=Ji[1]/Ji[3],(!(Io>=-ai[0]&&Io<=ai[0]&&Ji>=-ai[1]&&Ji<=ai[1])||(Io=mc[3],Ji=$(Ln.transform.cameraToCenterDistance,Io),ai=o.evaluateSizeForFeature(oi,pi,Fi),Io=_o?ai/Ji:ai*Ji,Ji=V(ai=new o.Point(Fi.anchorX,Fi.anchorY),ar,vo).point,Vs=Oe(Fi,Io,!(jc={projections:{},offsets:{}}),Qi,or,ar,wr,Qn.glyphOffsetArray,bo,zr,Ji,ai,jc,$r,gs,vo),ms=Vs.useVertical,Vs.notEnoughRoom)||ms||Vs.needsFlipping&&Oe(Fi,Io,!0,Qi,or,ar,wr,Qn.glyphOffsetArray,bo,zr,Ji,ai,jc,$r,gs,vo).notEnoughRoom)&&st(Fi.numGlyphs,zr)}}(Pr?Qn.text:Qn.icon).dynamicLayoutVertexBuffer.updateData(zr)}}Ir=w.translatePosMatrix(Mi.posMatrix,it,T,P),tr=Fe||v&&Xe||$t?Ry:cn,Pr=w.translatePosMatrix(Cn,it,T,P,!0),$t=Yt&&f.paint.get(v?"text-halo-width":"icon-halo-width").constantOr(1)!==0;var Hs={program:vn,buffers:Dt,uniformValues:Yt?_t.iconsInText?BT(_n.kind,Kt,Ue,ve,w,Ir,tr,Pr,Gs,qs):xa(_n.kind,Kt,Ue,ve,w,Ir,tr,Pr,v,Gs,!0):_d(_n.kind,Kt,Ue,ve,w,Ir,tr,Pr,v,Gs),atlasTexture:th,atlasTextureIcon:o_,atlasInterpolation:Hc,atlasInterpolationIcon:a1,isSDF:Yt,hasHalo:$t};if(ze&&_t.canOverlap){Qe=!0;for(const ms of Dt.segments.get())ct.push({segments:new o.SegmentVector([ms]),sortKey:ms.sortKey,state:Hs,terrainData:Ct})}else ct.push({segments:Dt.segments,sortKey:0,state:Hs,terrainData:Ct})}}}Qe&&ct.sort((Mi,Gs)=>Mi.sortKey-Gs.sortKey);for(const Mi of ct){var Vc,Zr=Mi.state;X.activeTexture.set(ge.TEXTURE0),Zr.atlasTexture.bind(Zr.atlasInterpolation,ge.CLAMP_TO_EDGE),Zr.atlasTextureIcon&&(X.activeTexture.set(ge.TEXTURE1),Zr.atlasTextureIcon)&&Zr.atlasTextureIcon.bind(Zr.atlasInterpolationIcon,ge.CLAMP_TO_EDGE),Zr.isSDF&&(Vc=Zr.uniformValues,Zr.hasHalo&&(Vc.u_is_halo=1,Ob(Zr.buffers,Mi.segments,f,w,Zr.program,Je,Z,j,Vc,Mi.terrainData)),Vc.u_is_halo=0),Ob(Zr.buffers,Mi.segments,f,w,Zr.program,Je,Z,j,Zr.uniformValues,Mi.terrainData)}}function Ob(w,s,f,y,v,T,P,R,N,G){var Z=y.context,j=Z.gl;v.draw(Z,j.TRIANGLES,T,P,R,qr.disabled,N,G,f.id,w.layoutVertexBuffer,w.indexBuffer,s,f.paint,y.transform.zoom,w.programConfigurations.get(f.id),w.dynamicLayoutVertexBuffer,w.opacityVertexBuffer)}function Np(w,s,f,y){if(w.renderPass==="translucent"){var v=f.paint.get("circle-opacity"),T=f.paint.get("circle-stroke-width"),P=f.paint.get("circle-stroke-opacity"),R=!f.layout.get("circle-sort-key").isConstant();if(v.constantOr(1)!==0||T.constantOr(1)!==0&&P.constantOr(1)!==0){var N=w.context,G=N.gl,Z=w.depthModeForSublayer(0,ur.ReadOnly),j=ii.disabled,X=w.colorModeForRenderPass(),ge=[];for(let Kt=0;Kt<y.length;Kt++){var ye=y[Kt],be=s.getTile(ye),ve=be.getBucket(f);if(ve){var Fe=ve.programConfigurations.get(f.id),Ue=w.useProgram("circle",Fe),ze=ve.layoutVertexBuffer,Qe=ve.indexBuffer,Je=w.style.map.terrain&&w.style.map.terrain.getTerrainData(ye),Xe={programConfiguration:Fe,program:Ue,layoutVertexBuffer:ze,indexBuffer:Qe,uniformValues:((Ct,cn,Cn,$t)=>{var tr,Ir=Ct.transform;let Qn,or;return or=$t.paint.get("circle-pitch-alignment")==="map"?(tr=en(Cn,1,Ir.zoom),Qn=!0,[tr,tr]):(Qn=!1,Ir.pixelsToGLUnits),{u_camera_to_center_distance:Ir.cameraToCenterDistance,u_scale_with_map:+($t.paint.get("circle-pitch-scale")==="map"),u_matrix:Ct.translatePosMatrix(cn.posMatrix,Cn,$t.paint.get("circle-translate"),$t.paint.get("circle-translate-anchor")),u_pitch_with_map:+Qn,u_device_pixel_ratio:Ct.pixelRatio,u_extrude_scale:or}})(w,ye,be,f),terrainData:Je};if(R)for(const Ct of ve.segments.get())ge.push({segments:new o.SegmentVector([Ct]),sortKey:Ct.sortKey,state:Xe});else ge.push({segments:ve.segments,sortKey:0,state:Xe})}}R&&ge.sort((Kt,Ct)=>Kt.sortKey-Ct.sortKey);for(const Kt of ge){var{programConfiguration:ct,program:it,layoutVertexBuffer:_t,indexBuffer:Dt,uniformValues:Yt,terrainData:_n}=Kt.state,vn=Kt.segments;it.draw(N,G.TRIANGLES,Z,j,X,qr.disabled,Yt,_n,f.id,_t,Dt,vn,f.paint,w.transform.zoom,ct)}}}}function ky(w,s,f,y){if(f.paint.get("heatmap-opacity")!==0){if(w.renderPass==="offscreen"){var v=w.context,T=v.gl,P=ii.disabled,R=new hi([T.ONE,T.ONE],o.Color.transparent,[!0,!0,!0,!0]);{var N=v,G=w,Z=f,j=N.gl;N.activeTexture.set(j.TEXTURE1),N.viewport.set([0,0,G.width/4,G.height/4]);let ze=Z.heatmapFbo;ze?(j.bindTexture(j.TEXTURE_2D,ze.colorAttachment.get()),N.bindFramebuffer.set(ze.framebuffer)):(Ue=j.createTexture(),j.bindTexture(j.TEXTURE_2D,Ue),j.texParameteri(j.TEXTURE_2D,j.TEXTURE_WRAP_S,j.CLAMP_TO_EDGE),j.texParameteri(j.TEXTURE_2D,j.TEXTURE_WRAP_T,j.CLAMP_TO_EDGE),j.texParameteri(j.TEXTURE_2D,j.TEXTURE_MIN_FILTER,j.LINEAR),j.texParameteri(j.TEXTURE_2D,j.TEXTURE_MAG_FILTER,j.LINEAR),ze=Z.heatmapFbo=N.createFramebuffer(G.width/4,G.height/4,!1,!1),function(Dt,Je,Xe,ct){var it=Dt.gl,_t=(_t=Dt.HALF_FLOAT)!=null?_t:it.UNSIGNED_BYTE,Dt=(Dt=Dt.RGBA16F)!=null?Dt:it.RGBA;it.texImage2D(it.TEXTURE_2D,0,Dt,Je.width/4,Je.height/4,0,it.RGBA,_t,null),ct.colorAttachment.set(Xe)}(N,G,Ue,ze))}v.clear({color:o.Color.transparent});for(let ze=0;ze<y.length;ze++){var X,ge,ye,be,ve,Fe=y[ze];s.hasRenderableParent(Fe)||(ge=(X=s.getTile(Fe)).getBucket(f))&&(ye=ge.programConfigurations.get(f.id),be=w.useProgram("heatmap",ye),ve=w.transform.zoom,be.draw(v,T.TRIANGLES,ur.disabled,P,R,qr.disabled,(be=Fe.posMatrix,Fe=X,X=ve,ve=f.paint.get("heatmap-intensity"),{u_matrix:be,u_extrude_scale:en(Fe,1,X),u_intensity:ve}),null,f.id,ge.layoutVertexBuffer,ge.indexBuffer,ge.segments,f.paint,w.transform.zoom,ye))}v.viewport.set([0,0,w.width,w.height])}else if(w.renderPass==="translucent"){w.context.setColorMode(w.colorModeForRenderPass());var j=w,Z=f,N=j.context,G=N.gl,Ue=Z.heatmapFbo;if(Ue){N.activeTexture.set(G.TEXTURE0),G.bindTexture(G.TEXTURE_2D,Ue.colorAttachment.get()),N.activeTexture.set(G.TEXTURE1);let ct=Z.colorRampTexture;(ct=ct||(Z.colorRampTexture=new ue(N,Z.colorRamp,G.RGBA))).bind(G.LINEAR,G.CLAMP_TO_EDGE),j.useProgram("heatmapTexture").draw(N,G.TRIANGLES,ur.disabled,ii.disabled,j.colorModeForRenderPass(),qr.disabled,Vi(j,Z,0,1),null,Z.id,j.viewportBuffer,j.quadTriangleIndexBuffer,j.viewportSegments,Z.paint,j.transform.zoom)}}}}function Lb(w,s,f,y){if(w.renderPass==="translucent"){var v=f.paint.get("line-opacity"),T=f.paint.get("line-width");if(v.constantOr(1)!==0&&T.constantOr(1)!==0){var P,R,N,G,Z,j,X,ge,ye,be,ve=w.depthModeForSublayer(0,ur.ReadOnly),Fe=w.colorModeForRenderPass(),Ue=f.paint.get("line-dasharray"),ze=f.paint.get("line-pattern"),Qe=ze.constantOr(1),Je=f.paint.get("line-gradient"),Xe=f.getCrossfadeParameters(),ct=Qe?"linePattern":Ue?"lineSDF":Je?"lineGradient":"line",it=w.context,_t=it.gl;let Ir=!0;for(const Qn of y){var Dt=s.getTile(Qn);if(!Qe||Dt.patternsLoaded()){var Yt=Dt.getBucket(f);if(Yt){var _n,vn,Kt=Yt.programConfigurations.get(f.id),cn=w.context.program.get(),Ct=w.useProgram(ct,Kt),cn=Ir||Ct.program!==cn,Cn=w.style.map.terrain&&w.style.map.terrain.getTerrainData(Qn),$t=ze.constantOr(null),$t=($t&&Dt.imageAtlas&&(_n=(vn=Dt.imageAtlas).patternPositions[$t.to.toString()],vn=vn.patternPositions[$t.from.toString()],_n)&&vn&&Kt.setConstantPatternPositions(_n,vn),Cn?Qn:null),tr=Qe?(_n=Dt,vn=f,X=Xe,ge=$t,be=ye=void 0,ye=(j=w).transform,be=Sb(_n,ye),{u_matrix:Cb(j,_n,vn,ge),u_texsize:_n.imageAtlasTexture.size,u_ratio:1/en(_n,1,ye.zoom),u_device_pixel_ratio:j.pixelRatio,u_image:0,u_scale:[be,X.fromScale,X.toScale],u_fade:X.t,u_units_to_pixels:[1/ye.pixelsToGLUnits[0],1/ye.pixelsToGLUnits[1]]}):Ue?(ge=Dt,j=f,be=Ue,X=Xe,ye=$t,Z=G=tr=G=R=N=R=void 0,R=(P=w).transform,N=P.lineAtlas,R=Sb(ge,R),G=j.layout.get("line-cap")==="round",tr=N.getDash(be.from,G),be=N.getDash(be.to,G),G=tr.width*X.fromScale,Z=be.width*X.toScale,o.extend(vp(P,ge,j,ye),{u_patternscale_a:[R/G,-tr.height/2],u_patternscale_b:[R/Z,-be.height/2],u_sdfgamma:N.width/(256*Math.min(G,Z)*P.pixelRatio)/2,u_image:0,u_tex_y_a:tr.y,u_tex_y_b:be.y,u_mix:X.t})):Je?(R=w,N=Dt,G=f,Z=Yt.lineClipsArray.length,P=$t,o.extend(vp(R,N,G,P),{u_image:0,u_image_height:Z})):vp(w,Dt,f,$t);if(Qe)it.activeTexture.set(_t.TEXTURE0),Dt.imageAtlasTexture.bind(_t.LINEAR,_t.CLAMP_TO_EDGE),Kt.updatePaintBuffers(Xe);else if(Ue&&(cn||w.lineAtlas.dirty))it.activeTexture.set(_t.TEXTURE0),w.lineAtlas.bind(it);else if(Je){$t=Yt.gradients[f.id];let or=$t.texture;if(f.gradientVersion!==$t.version){let Ln=256;f.stepInterpolant&&(Dt=s.getSource().maxzoom,cn=Qn.canonical.z===Dt?Math.ceil(1<<w.transform.maxZoom-Qn.canonical.z):1,Dt=Yt.maxLineLength/o.EXTENT,Ln=o.clamp(o.nextPowerOfTwo(1024*Dt*cn),256,it.maxTextureSize)),$t.gradient=o.renderColorRamp({expression:f.gradientExpression(),evaluationKey:"lineProgress",resolution:Ln,image:$t.gradient||void 0,clips:Yt.lineClipsArray}),$t.texture?$t.texture.update($t.gradient):$t.texture=new ue(it,$t.gradient,_t.RGBA),$t.version=f.gradientVersion,or=$t.texture}it.activeTexture.set(_t.TEXTURE0),or.bind(f.stepInterpolant?_t.NEAREST:_t.LINEAR,_t.CLAMP_TO_EDGE)}Ct.draw(it,_t.TRIANGLES,ve,w.stencilModeForClipping(Qn),Fe,qr.disabled,tr,Cn,f.id,Yt.layoutVertexBuffer,Yt.indexBuffer,Yt.segments,f.paint,w.transform.zoom,Kt,Yt.layoutVertexBuffer2),Ir=!1}}}}}}function Oy(w,s,f,y,v){if(f&&y&&y.imageAtlas){y=y.imageAtlas.patternPositions;let T=y[f.to.toString()],P=y[f.from.toString()];!T&&P&&(T=P),!P&&T&&(P=T),T&&P||(f=v.getPaintProperty(s),T=y[f],P=y[f]),T&&P&&w.setConstantPatternPositions(T,P)}}function Dp(w,s,f,y){var v,T,P=f.paint.get("fill-color"),R=f.paint.get("fill-opacity");R.constantOr(1)!==0&&(v=w.colorModeForRenderPass(),T=f.paint.get("fill-pattern"),T=w.opaquePassEnabledForLayer()&&!T.constantOr(1)&&P.constantOr(o.Color.transparent).a===1&&R.constantOr(0)===1?"opaque":"translucent",w.renderPass===T&&(P=w.depthModeForSublayer(1,w.renderPass==="opaque"?ur.ReadWrite:ur.ReadOnly),Nb(w,s,f,y,P,v,!1)),w.renderPass==="translucent")&&f.paint.get("fill-antialias")&&(R=w.depthModeForSublayer(f.getPaintProperty("fill-outline-color")?2:0,ur.ReadOnly),Nb(w,s,f,y,R,v,!0))}function Nb(w,s,f,y,v,T,P){var R=w.context.gl,N="fill-pattern",G=f.paint.get(N),Z=G&&G.constantOr(1),j=f.getCrossfadeParameters();let X,ge,ye,be,ve;X=P?(ge=Z&&!f.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",R.LINES):(ge=Z?"fillPattern":"fill",R.TRIANGLES);var Fe=G.constantOr(null);for(const _t of y){var Ue,ze,Qe,Je,Xe,ct,it=s.getTile(_t);Z&&!it.patternsLoaded()||(Ue=it.getBucket(f))&&(ze=Ue.programConfigurations.get(f.id),Qe=w.useProgram(ge,ze),Je=w.style.map.terrain&&w.style.map.terrain.getTerrainData(_t),Z&&(w.context.activeTexture.set(R.TEXTURE0),it.imageAtlasTexture.bind(R.LINEAR,R.CLAMP_TO_EDGE),ze.updatePaintBuffers(j)),Oy(ze,N,Fe,it,f),Xe=((Je?_t:null)||_t).posMatrix,Xe=w.translatePosMatrix(Xe,it,f.paint.get("fill-translate"),f.paint.get("fill-translate-anchor")),ye=P?(be=Ue.indexBuffer2,ve=Ue.segments2,ct=[R.drawingBufferWidth,R.drawingBufferHeight],ge==="fillOutlinePattern"&&Z?qe(Xe,w,j,it,ct):Se(Xe,ct)):(be=Ue.indexBuffer,ve=Ue.segments,Z?se(Xe,w,j,it):ee(Xe)),Qe.draw(w.context,X,v,w.stencilModeForClipping(_t),T,qr.disabled,ye,Je,f.id,Ue.layoutVertexBuffer,be,ve,f.paint,w.transform.zoom,ze))}}function Db(w,s,f,y){var v,T=f.paint.get("fill-extrusion-opacity");T!==0&&w.renderPass==="translucent"&&(v=new ur(w.context.gl.LEQUAL,ur.ReadWrite,w.depthRangeFor3D),T!==1||f.paint.get("fill-extrusion-pattern").constantOr(1)?(di(w,s,f,y,v,ii.disabled,hi.disabled),di(w,s,f,y,v,w.stencilModeFor3D(),w.colorModeForRenderPass())):(T=w.colorModeForRenderPass(),di(w,s,f,y,v,ii.disabled,T)))}function di(w,s,f,y,v,T,P){var R=w.context,N=R.gl,G="fill-extrusion-pattern",Z=f.paint.get(G),j=Z.constantOr(1),X=f.getCrossfadeParameters(),ge=f.paint.get("fill-extrusion-opacity"),ye=Z.constantOr(null);for(const Xe of y){var be,ve,Fe,Ue,ze,Qe=s.getTile(Xe),Je=Qe.getBucket(f);Je&&(be=w.style.map.terrain&&w.style.map.terrain.getTerrainData(Xe),ve=Je.programConfigurations.get(f.id),Fe=w.useProgram(j?"fillExtrusionPattern":"fillExtrusion",ve),j&&(w.context.activeTexture.set(N.TEXTURE0),Qe.imageAtlasTexture.bind(N.LINEAR,N.CLAMP_TO_EDGE),ve.updatePaintBuffers(X)),Oy(ve,G,ye,Qe,f),Ue=w.translatePosMatrix(Xe.posMatrix,Qe,f.paint.get("fill-extrusion-translate"),f.paint.get("fill-extrusion-translate-anchor")),ze=f.paint.get("fill-extrusion-vertical-gradient"),Qe=j?zs(Ue,w,ze,ge,Xe,X,Qe):Nl(Ue,w,ze,ge),Fe.draw(R,R.gl.TRIANGLES,v,T,P,qr.backCCW,Qe,be,f.id,Je.layoutVertexBuffer,Je.indexBuffer,Je.segments,f.paint,w.transform.zoom,ve,w.style.map.terrain&&Je.centroidVertexBuffer))}}function zl(w,s,f,y){if(w.renderPass==="offscreen"||w.renderPass==="translucent"){var v=w.context,T=w.depthModeForSublayer(0,ur.ReadOnly),P=w.colorModeForRenderPass(),[R,y]=w.renderPass==="translucent"?w.stencilConfigForOverlap(y):[{},y];for(const Xe of y){var N=s.getTile(Xe);if(N.needsHillshadePrepare!==void 0&&N.needsHillshadePrepare&&w.renderPass==="offscreen"){Qe=ze=Ue=Fe=ve=be=ye=ge=X=j=Z=G=void 0;var G=w,Z=N,j=f,X=T,ge=ii.disabled,ye=P,be=G.context,ve=be.gl,Fe=Z.dem;if(Fe&&Fe.data){var Ue=Fe.dim,ze=Fe.stride,Qe=Fe.getPixels();be.activeTexture.set(ve.TEXTURE1),be.pixelStoreUnpackPremultiplyAlpha.set(!1),Z.demTexture=Z.demTexture||G.getTileTexture(ze),(Z.demTexture?((ze=Z.demTexture).update(Qe,{premultiply:!1}),ze):(Z.demTexture=new ue(be,Qe,ve.RGBA,{premultiply:!1}),Z.demTexture)).bind(ve.NEAREST,ve.CLAMP_TO_EDGE),be.activeTexture.set(ve.TEXTURE0);let ct=Z.fbo;ct||((ze=new ue(be,{width:Ue,height:Ue,data:null},ve.RGBA)).bind(ve.LINEAR,ve.CLAMP_TO_EDGE),(ct=Z.fbo=be.createFramebuffer(Ue,Ue,!0,!1)).colorAttachment.set(ze.texture)),be.bindFramebuffer.set(ct.framebuffer),be.viewport.set([0,0,Ue,Ue]),G.useProgram("hillshadePrepare").draw(be,ve.TRIANGLES,X,ge,ye,qr.disabled,wa(Z.tileID,Fe),null,j.id,G.rasterBoundsBuffer,G.quadTriangleIndexBuffer,G.rasterBoundsSegments),Z.needsHillshadePrepare=!1}}else w.renderPass==="translucent"&&(Qe=w,ze=Xe,Ue=N,be=f,ve=T,X=R[Xe.overscaledZ],ge=P,Z=G=j=Fe=ye=void 0,ye=Qe.context,Fe=ye.gl,j=Ue.fbo)&&(G=Qe.useProgram("hillshade"),Z=Qe.style.map.terrain&&Qe.style.map.terrain.getTerrainData(ze),ye.activeTexture.set(Fe.TEXTURE0),Fe.bindTexture(Fe.TEXTURE_2D,j.colorAttachment.get()),j=Z?ze:null,G.draw(ye,Fe.TRIANGLES,ve,X,ge,qr.disabled,lo(Qe,Ue,be,j),Z,be.id,Qe.rasterBoundsBuffer,Qe.quadTriangleIndexBuffer,Qe.rasterBoundsSegments))}v.viewport.set([0,0,w.width,w.height])}}function Va(w,s,f,y){if(w.renderPass==="translucent"&&f.paint.get("raster-opacity")!==0&&y.length){var v=w.context,T=v.gl,P=s.getSource(),R=w.useProgram("raster"),N=w.colorModeForRenderPass(),[G,y]=P instanceof Pe?[{},y]:w.stencilConfigForOverlap(y),Z=y[y.length-1].overscaledZ,j=!w.options.moving;for(const Ue of y){var X=w.depthModeForSublayer(Ue.overscaledZ-Z,f.paint.get("raster-opacity")===1?ur.ReadWrite:ur.ReadOnly,T.LESS),ve=s.getTile(Ue),ye=(ve.registerFadeDuration(f.paint.get("raster-fade-duration")),s.findLoadedParent(Ue,0)),ge=function(Je,Xe,ct,it,_t,Dt){it=it.paint.get("raster-fade-duration");{var Yt;return!Dt&&0<it?(Dt=g.now(),Yt=(Dt-Je.timeAdded)/it,Dt=Xe?(Dt-Xe.timeAdded)/it:-1,it=ct.getSource(),ct=_t.coveringZoomLevel({tileSize:it.tileSize,roundZoom:it.roundZoom}),_t=!Xe||Math.abs(Xe.tileID.overscaledZ-ct)>Math.abs(Je.tileID.overscaledZ-ct),it=_t&&Je.refreshedUponExpiration?1:o.clamp(_t?Yt:1-Dt,0,1),Je.refreshedUponExpiration&&1<=Yt&&(Je.refreshedUponExpiration=!1),Xe?{opacity:1,mix:1-it}:{opacity:it,mix:0}):{opacity:1,mix:0}}}(ve,ye,s,f,w.transform,w.style.map.terrain);let ze,Qe;var be=f.paint.get("raster-resampling")==="nearest"?T.NEAREST:T.LINEAR,ye=(v.activeTexture.set(T.TEXTURE0),ve.texture.bind(be,T.CLAMP_TO_EDGE,T.LINEAR_MIPMAP_NEAREST),v.activeTexture.set(T.TEXTURE1),ye?(ye.texture.bind(be,T.CLAMP_TO_EDGE,T.LINEAR_MIPMAP_NEAREST),ze=Math.pow(2,ye.tileID.overscaledZ-ve.tileID.overscaledZ),Qe=[ve.tileID.canonical.x*ze%1,ve.tileID.canonical.y*ze%1]):ve.texture.bind(be,T.CLAMP_TO_EDGE,T.LINEAR_MIPMAP_NEAREST),w.style.map.terrain&&w.style.map.terrain.getTerrainData(Ue)),ve=ye?Ue:null,be=ve?ve.posMatrix:w.transform.calculatePosMatrix(Ue.toUnwrapped(),j),ve=Dl(be,Qe||[0,0],ze||1,ge,f);P instanceof Pe?R.draw(v,T.TRIANGLES,X,ii.disabled,N,qr.disabled,ve,ye,f.id,P.boundsBuffer,w.quadTriangleIndexBuffer,P.boundsSegments):R.draw(v,T.TRIANGLES,X,G[Ue.overscaledZ],N,qr.disabled,ve,ye,f.id,w.rasterBoundsBuffer,w.quadTriangleIndexBuffer,w.rasterBoundsSegments)}}}function Ly(w,s,f,y){var v=f.paint.get("background-color"),T=f.paint.get("background-opacity");if(T!==0){var P=w.context,R=P.gl,N=w.transform,G=N.tileSize,Z=f.paint.get("background-pattern");if(!w.isPatternMissing(Z)){var j=!Z&&v.a===1&&T===1&&w.opaquePassEnabledForLayer()?"opaque":"translucent";if(w.renderPass===j){var X=ii.disabled,ge=w.depthModeForSublayer(0,j=="opaque"?ur.ReadWrite:ur.ReadOnly),ye=w.colorModeForRenderPass(),be=w.useProgram(Z?"backgroundPattern":"background"),j=y||N.coveringTiles({tileSize:G,terrain:w.style.map.terrain}),ve=(Z&&(P.activeTexture.set(R.TEXTURE0),w.imageManager.bind(w.context)),f.getCrossfadeParameters());for(const Qe of j){var Fe=y?Qe.posMatrix:w.transform.calculatePosMatrix(Qe.toUnwrapped()),Fe=Z?bp(Fe,T,w,Z,{tileID:Qe,tileSize:G},ve):{u_matrix:Fe,u_opacity:T,u_color:v},Ue=w.style.map.terrain&&w.style.map.terrain.getTerrainData(Qe);be.draw(P,R.TRIANGLES,ge,X,ye,qr.disabled,Fe,Ue,f.id,w.tileExtentBuffer,w.quadTriangleIndexBuffer,w.tileExtentSegments)}}}}}const Ny=new o.Color(1,0,0,1),Fb=new o.Color(0,1,0,1),Wu=new o.Color(0,0,1,1),Td=new o.Color(1,0,1,1),Dy=new o.Color(0,1,1,1);function Bb(w){var s,f,y=w.transform.padding,y=(Fy(w,w.transform.height-(y.top||0),3,Ny),Fy(w,y.bottom||0,3,Fb),By(w,y.left||0,3,Wu),By(w,w.transform.width-(y.right||0),3,Td),w.transform.centerPoint);s=w,f=y.x,w=w.transform.height-y.y,y=Dy,Sd(s,f-1,w-10,2,20,y),Sd(s,f-10,w-1,20,2,y)}function Fy(w,s,f,y){Sd(w,0,s+f/2,w.transform.width,f,y)}function By(w,s,f,y){Sd(w,s-f/2,0,f,w.transform.height,y)}function Sd(w,s,f,y,v,T){var P=w.context,R=P.gl;R.enable(R.SCISSOR_TEST),R.scissor(s*w.pixelRatio,f*w.pixelRatio,y*w.pixelRatio,v*w.pixelRatio),P.clear({color:T}),R.disable(R.SCISSOR_TEST)}function jl(w,s,f){for(let be=0;be<f.length;be++){y=void 0,ye=void 0,v=void 0,T=void 0,P=void 0,R=void 0,N=void 0,G=void 0,Z=void 0,j=void 0,X=void 0,ge=void 0;var y=w,ye=s,v=f[be],T=y.context,P=T.gl,R=v.posMatrix,N=y.useProgram("debug"),G=ur.disabled,Z=ii.disabled,j=y.colorModeForRenderPass(),X=y.style.map.terrain&&y.style.map.terrain.getTerrainData(v),ge=(T.activeTexture.set(P.TEXTURE0),ye.getTileByID(v.key).latestRawTileData),ge=ge&&ge.byteLength||0,ge=Math.floor(ge/1024),ye=ye.getTile(v).tileSize,ye=512/Math.min(ye,512)*(v.overscaledZ/y.transform.zoom)*.5;let ve=v.canonical.toString();v.overscaledZ!==v.canonical.z&&(ve+=" => "+v.overscaledZ),v=ve+` ${ge}kB`,function(Fe,Ue){Fe.initDebugOverlayCanvas();var ze=Fe.debugOverlayCanvas,Qe=Fe.context.gl,Je=Fe.debugOverlayCanvas.getContext("2d");Je.clearRect(0,0,ze.width,ze.height),Je.shadowColor="white",Je.shadowBlur=2,Je.lineWidth=1.5,Je.strokeStyle="white",Je.textBaseline="top",Je.font="bold 36px Open Sans, sans-serif",Je.fillText(Ue,5,5),Je.strokeText(Ue,5,5),Fe.debugOverlayTexture.update(ze),Fe.debugOverlayTexture.bind(Qe.LINEAR,Qe.CLAMP_TO_EDGE)}(y,v),N.draw(T,P.TRIANGLES,G,Z,hi.alphaBlended,qr.disabled,Zn(R,o.Color.transparent,ye),null,"$debug",y.debugBuffer,y.quadTriangleIndexBuffer,y.debugSegments),N.draw(T,P.LINE_STRIP,G,Z,j,qr.disabled,Zn(R,o.Color.red),X,"$debug",y.debugBuffer,y.tileBorderIndexBuffer,y.debugSegments)}}function Ub(w,s){let f=null;var v=Object.values(w._layers).flatMap(P=>P.source&&!P.isHidden(s)?[w.sourceCaches[P.source]]:[]),y=v.filter(P=>P.getSource().type==="vector"),v=v.filter(P=>P.getSource().type!=="vector");const T=P=>{(!f||f.getSource().maxzoom<P.getSource().maxzoom)&&(f=P)};return y.forEach(P=>T(P)),f||v.forEach(P=>T(P)),f}function zb(w,s,T){var y,v=w.context,T=T.implementation;w.renderPass==="offscreen"?(y=T.prerender)&&(w.setCustomLayerDefaults(),v.setColorMode(w.colorModeForRenderPass()),y.call(T,v.gl,w.transform.customLayerMatrix()),v.setDirty(),w.setBaseState()):w.renderPass==="translucent"&&(w.setCustomLayerDefaults(),v.setColorMode(w.colorModeForRenderPass()),v.setStencilMode(ii.disabled),y=T.renderingMode==="3d"?new ur(w.context.gl.LEQUAL,ur.ReadWrite,w.depthRangeFor3D):w.depthModeForSublayer(0,ur.ReadOnly),v.setDepthMode(y),T.render(v.gl,w.transform.customLayerMatrix()),v.setDirty(),w.setBaseState(),v.bindFramebuffer.set(null))}function jb(w,s){var f=w.context,y=f.gl,v=hi.unblended,T=new ur(y.LEQUAL,ur.ReadWrite,[0,1]),P=s.getTerrainMesh(),R=s.sourceCache.getRenderableTiles(),N=w.useProgram("terrainDepth");f.bindFramebuffer.set(s.getFramebuffer("depth").framebuffer),f.viewport.set([0,0,w.width/devicePixelRatio,w.height/devicePixelRatio]),f.clear({color:o.Color.transparent,depth:1});for(const j of R){var G=s.getTerrainData(j.tileID),Z={u_matrix:w.transform.calculatePosMatrix(j.tileID.toUnwrapped()),u_ele_delta:s.getMeshFrameDelta(w.transform.zoom)};N.draw(f,y.TRIANGLES,T,ii.disabled,v,qr.backCCW,Z,G,"terrain",P.vertexBuffer,P.indexBuffer,P.segments)}f.bindFramebuffer.set(null),f.viewport.set([0,0,w.width,w.height])}function Vb(w,s){var f=w.context,y=f.gl,v=hi.unblended,T=new ur(y.LEQUAL,ur.ReadWrite,[0,1]),P=s.getTerrainMesh(),R=s.getCoordsTexture(),N=s.sourceCache.getRenderableTiles(),G=w.useProgram("terrainCoords");f.bindFramebuffer.set(s.getFramebuffer("coords").framebuffer),f.viewport.set([0,0,w.width/devicePixelRatio,w.height/devicePixelRatio]),f.clear({color:o.Color.transparent,depth:1}),s.coordsIndex=[];for(const X of N){var Z=s.getTerrainData(X.tileID),j=(f.activeTexture.set(y.TEXTURE0),y.bindTexture(y.TEXTURE_2D,R.texture),w.transform.calculatePosMatrix(X.tileID.toUnwrapped())),j={u_matrix:j,u_terrain_coords_id:(255-s.coordsIndex.length)/255,u_texture:0,u_ele_delta:s.getMeshFrameDelta(w.transform.zoom)};G.draw(f,y.TRIANGLES,T,ii.disabled,v,qr.backCCW,j,Z,"terrain",P.vertexBuffer,P.indexBuffer,P.segments),s.coordsIndex.push(X.tileID.key)}f.bindFramebuffer.set(null),f.viewport.set([0,0,w.width,w.height])}function Uy(w,s,f){var y=w.context,v=y.gl,T=w.colorModeForRenderPass(),P=new ur(v.LEQUAL,ur.ReadWrite,w.depthRangeFor3D),R=w.useProgram("terrain"),N=s.getTerrainMesh();y.bindFramebuffer.set(null),y.viewport.set([0,0,w.width,w.height]);for(const j of f){var Z=w.renderToTexture.getTexture(j),G=s.getTerrainData(j.tileID),Z=(y.activeTexture.set(v.TEXTURE0),v.bindTexture(v.TEXTURE_2D,Z.texture),w.transform.calculatePosMatrix(j.tileID.toUnwrapped())),Z={u_matrix:Z,u_texture:0,u_ele_delta:s.getMeshFrameDelta(w.transform.zoom)};R.draw(y,v.TRIANGLES,P,ii.disabled,T,qr.backCCW,Z,G,"terrain",N.vertexBuffer,N.indexBuffer,N.segments)}}class Hb{constructor(s,f){this.context=new kp(s),this.transform=f,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:o.identity(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=Tt.maxUnderzooming+Tt.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Bc}resize(s,f,y){if(this.width=Math.floor(s*y),this.height=Math.floor(f*y),this.pixelRatio=y,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const v of this.style._order)this.style._layers[v].resize()}setup(){var f=this.context,s=new o.PosArray,s=(s.emplaceBack(0,0),s.emplaceBack(o.EXTENT,0),s.emplaceBack(0,o.EXTENT),s.emplaceBack(o.EXTENT,o.EXTENT),this.tileExtentBuffer=f.createVertexBuffer(s,ba.members),this.tileExtentSegments=o.SegmentVector.simpleSegment(0,0,4,2),new o.PosArray),s=(s.emplaceBack(0,0),s.emplaceBack(o.EXTENT,0),s.emplaceBack(0,o.EXTENT),s.emplaceBack(o.EXTENT,o.EXTENT),this.debugBuffer=f.createVertexBuffer(s,ba.members),this.debugSegments=o.SegmentVector.simpleSegment(0,0,4,5),new o.RasterBoundsArray),s=(s.emplaceBack(0,0,0,0),s.emplaceBack(o.EXTENT,0,o.EXTENT,0),s.emplaceBack(0,o.EXTENT,0,o.EXTENT),s.emplaceBack(o.EXTENT,o.EXTENT,o.EXTENT,o.EXTENT),this.rasterBoundsBuffer=f.createVertexBuffer(s,Ae.members),this.rasterBoundsSegments=o.SegmentVector.simpleSegment(0,0,4,2),new o.PosArray),s=(s.emplaceBack(0,0),s.emplaceBack(1,0),s.emplaceBack(0,1),s.emplaceBack(1,1),this.viewportBuffer=f.createVertexBuffer(s,ba.members),this.viewportSegments=o.SegmentVector.simpleSegment(0,0,4,2),new o.LineStripIndexArray),s=(s.emplaceBack(0),s.emplaceBack(1),s.emplaceBack(3),s.emplaceBack(2),s.emplaceBack(0),this.tileBorderIndexBuffer=f.createIndexBuffer(s),new o.TriangleIndexArray),f=(s.emplaceBack(0,1,2),s.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=f.createIndexBuffer(s),this.context.gl);this.stencilClearMode=new ii({func:f.ALWAYS,mask:0},0,255,f.ZERO,f.ZERO,f.ZERO)}clearStencil(){var s=this.context,f=s.gl,y=(this.nextStencilID=1,this.currentStencilSource=void 0,o.create());o.ortho(y,0,this.width,this.height,0,0,1),o.scale(y,y,[f.drawingBufferWidth,f.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(s,f.TRIANGLES,ur.disabled,this.stencilClearMode,hi.disabled,qr.disabled,Ti(y),null,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(s,f){if(this.currentStencilSource!==s.source&&s.isTileClipped()&&f&&f.length){this.currentStencilSource=s.source;var y=this.context,v=y.gl,T=(256<this.nextStencilID+f.length&&this.clearStencil(),y.setColorMode(hi.disabled),y.setDepthMode(ur.disabled),this.useProgram("clippingMask"));this._tileClippingMaskIDs={};for(const N of f){var P=this._tileClippingMaskIDs[N.key]=this.nextStencilID++,R=this.style.map.terrain&&this.style.map.terrain.getTerrainData(N);T.draw(y,v.TRIANGLES,ur.disabled,new ii({func:v.ALWAYS,mask:0},P,255,v.KEEP,v.KEEP,v.REPLACE),hi.disabled,qr.disabled,Ti(N.posMatrix),R,"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}}stencilModeFor3D(){this.currentStencilSource=void 0,256<this.nextStencilID+1&&this.clearStencil();var s=this.nextStencilID++,f=this.context.gl;return new ii({func:f.NOTEQUAL,mask:255},s,255,f.KEEP,f.KEEP,f.REPLACE)}stencilModeForClipping(s){var f=this.context.gl;return new ii({func:f.EQUAL,mask:255},this._tileClippingMaskIDs[s.key],0,f.KEEP,f.KEEP,f.REPLACE)}stencilConfigForOverlap(y){var f=this.context.gl,y=y.sort((R,N)=>N.overscaledZ-R.overscaledZ),v=y[y.length-1].overscaledZ,T=y[0].overscaledZ-v+1;if(1<T){this.currentStencilSource=void 0,256<this.nextStencilID+T&&this.clearStencil();var P={};for(let R=0;R<T;R++)P[R+v]=new ii({func:f.GEQUAL,mask:255},R+this.nextStencilID,255,f.KEEP,f.KEEP,f.REPLACE);return this.nextStencilID+=T,[P,y]}return[{[v]:ii.disabled},y]}colorModeForRenderPass(){var s=this.context.gl;return this._showOverdrawInspector?new hi([s.CONSTANT_COLOR,s.ONE],new o.Color(1/8,1/8,1/8,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?hi.unblended:hi.alphaBlended}depthModeForSublayer(s,f,y){return this.opaquePassEnabledForLayer()?(s=1-((1+this.currentLayer)*this.numSublayers+s)*this.depthEpsilon,new ur(y||this.context.gl.LEQUAL,f,[s,s])):ur.disabled}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(s,f){this.style=s,this.options=f,this.lineAtlas=s.lineAtlas,this.imageManager=s.imageManager,this.glyphManager=s.glyphManager,this.symbolFadeChange=s.placement.symbolFadeChange(g.now()),this.imageManager.beginFrame();var y=this.style._order,v=this.style.sourceCaches,T={},P={},R={};for(const Ue in v){var N=v[Ue];N.used&&N.prepare(this.context),T[Ue]=N.getVisibleCoordinates(),P[Ue]=T[Ue].slice().reverse(),R[Ue]=N.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let Ue=0;Ue<y.length;Ue++){var G=y[Ue];if(this.style._layers[G].is3D()){this.opaquePassCutoff=Ue;break}}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(const Ue of y){var Z,j=this.style._layers[Ue];j.hasOffscreenPass()&&!j.isHidden(this.transform.zoom)&&(Z=P[j.source],j.type==="custom"||Z.length)&&this.renderLayer(this,v[j.source],j,Z)}if(this.context.bindFramebuffer.set(null),this.context.clear({color:f.showOverdrawInspector?o.Color.black:o.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=f.showOverdrawInspector,this.depthRangeFor3D=[0,1-(s._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=y.length-1;0<=this.currentLayer;this.currentLayer--){var X=this.style._layers[y[this.currentLayer]],ge=v[X.source],ye=T[X.source];this._renderTileClippingMasks(X,ye),this.renderLayer(this,ge,X,ye)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<y.length;this.currentLayer++){var be,ve=this.style._layers[y[this.currentLayer]],Fe=v[ve.source];this.renderToTexture&&this.renderToTexture.renderLayer(ve)||(be=(ve.type==="symbol"?R:P)[ve.source],this._renderTileClippingMasks(ve,T[ve.source]),this.renderLayer(this,Fe,ve,be))}this.options.showTileBoundaries&&(f=Ub(this.style,this.transform.zoom))&&jl(this,f,f.getVisibleCoordinates()),this.options.showPadding&&Bb(this),this.context.setDefault()}maybeDrawDepthAndCoords(s){if(this.style&&this.style.map&&this.style.map.terrain){var f=this.terrainFacilitator.matrix,y=this.transform.projMatrix;let v=this.terrainFacilitator.dirty;(v=(v=v||(s?!o.exactEquals(f,y):!o.equals(f,y)))||0<this.style.map.terrain.sourceCache.tilesAfterTime(this.terrainFacilitator.renderTime).length)&&(o.copy(f,y),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,jb(this,this.style.map.terrain),Vb(this,this.style.map.terrain))}}renderLayer(s,f,y,v){if(!y.isHidden(this.transform.zoom)&&(y.type==="background"||y.type==="custom"||(v||[]).length))switch(this.id=y.id,y.type){case"symbol":GT(s,f,y,v,this.style.placement.variableOffsets);break;case"circle":Np(s,f,y,v);break;case"heatmap":ky(s,f,y,v);break;case"line":Lb(s,f,y,v);break;case"fill":Dp(s,f,y,v);break;case"fill-extrusion":Db(s,f,y,v);break;case"hillshade":zl(s,f,y,v);break;case"raster":Va(s,f,y,v);break;case"background":Ly(s,0,y,v);break;case"custom":zb(s,0,y)}}translatePosMatrix(s,f,y,v,T){var P;return y[0]||y[1]?((v=T?v==="map"?this.transform.angle:0:v==="viewport"?-this.transform.angle:0)&&(P=Math.sin(v),v=Math.cos(v),y=[y[0]*v-y[1]*P,y[0]*P+y[1]*v]),P=[T?y[0]:en(f,y[0],this.transform.zoom),T?y[1]:en(f,y[1],this.transform.zoom),0],v=new Float32Array(16),o.translate(v,s,P),v):s}saveTileTexture(s){var f=this._tileTextures[s.size[0]];f?f.push(s):this._tileTextures[s.size[0]]=[s]}getTileTexture(s){return s=this._tileTextures[s],s&&0<s.length?s.pop():null}isPatternMissing(s){var f;return!(!s||s.from&&s.to&&(f=this.imageManager.getPattern(s.from.toString()),s=this.imageManager.getPattern(s.to.toString()),f)&&s)}useProgram(s,f){this.cache=this.cache||{};var y=s+(f?f.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"")+(this.style.map.terrain?"/terrain":"");return this.cache[y]||(this.cache[y]=new Vu(this.context,za[s],f,wp[s],this._showOverdrawInspector,this.style.map.terrain)),this.cache[y]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){var s=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(s.FUNC_ADD)}initDebugOverlayCanvas(){var s;this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,s=this.context.gl,this.debugOverlayTexture=new ue(this.context,this.debugOverlayCanvas,s.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){var{drawingBufferWidth:s,drawingBufferHeight:f}=this.context.gl;return this.width!==s||this.height!==f}}class Fp{constructor(s,f){this.points=s,this.planes=f}static fromInvProjectionMatrix(s,f,y){const v=Math.pow(2,y),T=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(P=>{var R=1/(P=o.transformMat4([],P,s))[3]/f*v;return o.mul$1(P,P,[R,R,1/P[3],R])});return y=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(P=>{var R=o.sub([],T[P[0]],T[P[1]]),N=o.sub([],T[P[2]],T[P[1]]),R=o.normalize([],o.cross([],R,N)),N=-o.dot(R,T[P[1]]);return R.concat(N)}),new Fp(T,y)}}class pc{constructor(s,f){this.min=s,this.max=f,this.center=o.scale$1([],o.add([],this.min,this.max),.5)}quadrant(s){var f=[s%2==0,s<2],y=o.clone$2(this.min),v=o.clone$2(this.max);for(let T=0;T<f.length;T++)y[T]=(f[T]?this.min:this.center)[T],v[T]=(f[T]?this.center:this.max)[T];return v[2]=this.max[2],new pc(y,v)}distanceX(s){return Math.max(Math.min(this.max[0],s[0]),this.min[0])-s[0]}distanceY(s){return Math.max(Math.min(this.max[1],s[1]),this.min[1])-s[1]}intersects(s){var f=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let y=!0;for(let P=0;P<s.planes.length;P++){var v=s.planes[P];let R=0;for(let N=0;N<f.length;N++)0<=o.dot$1(v,f[N])&&R++;if(R===0)return 0;R!==f.length&&(y=!1)}if(y)return 2;for(let P=0;P<3;P++){let R=Number.MAX_VALUE,N=-Number.MAX_VALUE;for(let G=0;G<s.points.length;G++){var T=s.points[G][P]-this.min[P];R=Math.min(R,T),N=Math.max(N,T)}if(N<0||R>this.max[P]-this.min[P])return 0}return 1}}class Cd{constructor(s=0,f=0,y=0,v=0){if(isNaN(s)||s<0||isNaN(f)||f<0||isNaN(y)||y<0||isNaN(v)||v<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=s,this.bottom=f,this.left=y,this.right=v}interpolate(s,f,y){return f.top!=null&&s.top!=null&&(this.top=o.interpolate.number(s.top,f.top,y)),f.bottom!=null&&s.bottom!=null&&(this.bottom=o.interpolate.number(s.bottom,f.bottom,y)),f.left!=null&&s.left!=null&&(this.left=o.interpolate.number(s.left,f.left,y)),f.right!=null&&s.right!=null&&(this.right=o.interpolate.number(s.right,f.right,y)),this}getCenter(s,f){return s=o.clamp((this.left+s-this.right)/2,0,s),f=o.clamp((this.top+f-this.bottom)/2,0,f),new o.Point(s,f)}equals(s){return this.top===s.top&&this.bottom===s.bottom&&this.left===s.left&&this.right===s.right}clone(){return new Cd(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const aa=85.051129;class Ha{constructor(s,f,y,v,T){this.tileSize=512,this._renderWorldCopies=T===void 0||!!T,this._minZoom=s||0,this._maxZoom=f||22,this._minPitch=y??0,this._maxPitch=v??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new o.LngLat(0,0),this._elevation=0,this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new Cd,this._posMatrixCache={},this._alignedPosMatrixCache={},this.minElevationForCurrentTile=0}clone(){var s=new Ha(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return s.apply(this),s}apply(s){this.tileSize=s.tileSize,this.latRange=s.latRange,this.width=s.width,this.height=s.height,this._center=s._center,this._elevation=s._elevation,this.minElevationForCurrentTile=s.minElevationForCurrentTile,this.zoom=s.zoom,this.angle=s.angle,this._fov=s._fov,this._pitch=s._pitch,this._unmodified=s._unmodified,this._edgeInsets=s._edgeInsets.clone(),this._calcMatrices()}get minZoom(){return this._minZoom}set minZoom(s){this._minZoom!==s&&(this._minZoom=s,this.zoom=Math.max(this.zoom,s))}get maxZoom(){return this._maxZoom}set maxZoom(s){this._maxZoom!==s&&(this._maxZoom=s,this.zoom=Math.min(this.zoom,s))}get minPitch(){return this._minPitch}set minPitch(s){this._minPitch!==s&&(this._minPitch=s,this.pitch=Math.max(this.pitch,s))}get maxPitch(){return this._maxPitch}set maxPitch(s){this._maxPitch!==s&&(this._maxPitch=s,this.pitch=Math.min(this.pitch,s))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(s){s===void 0?s=!0:s===null&&(s=!1),this._renderWorldCopies=s}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new o.Point(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(s){s=-o.wrap(s,-180,180)*Math.PI/180,this.angle!==s&&(this._unmodified=!1,this.angle=s,this._calcMatrices(),this.rotationMatrix=o.create$2(),o.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(s){s=o.clamp(s,this.minPitch,this.maxPitch)/180*Math.PI,this._pitch!==s&&(this._unmodified=!1,this._pitch=s,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(s){s=Math.max(.01,Math.min(60,s)),this._fov!==s&&(this._unmodified=!1,this._fov=s/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(s){s=Math.min(Math.max(s,this.minZoom),this.maxZoom),this._zoom!==s&&(this._unmodified=!1,this._zoom=s,this.tileZoom=Math.max(0,Math.floor(s)),this.scale=this.zoomScale(s),this._constrain(),this._calcMatrices())}get center(){return this._center}set center(s){s.lat===this._center.lat&&s.lng===this._center.lng||(this._unmodified=!1,this._center=s,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}set elevation(s){s!==this._elevation&&(this._elevation=s,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(s){this._edgeInsets.equals(s)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,s,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(s){return this._edgeInsets.equals(s)}interpolatePadding(s,f,y){this._unmodified=!1,this._edgeInsets.interpolate(s,f,y),this._constrain(),this._calcMatrices()}coveringZoomLevel(s){return s=(s.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/s.tileSize)),Math.max(0,s)}getVisibleUnwrappedCoordinates(s){var f=[new o.UnwrappedTileID(0,s)];if(this._renderWorldCopies){var y=this.pointCoordinate(new o.Point(0,0)),v=this.pointCoordinate(new o.Point(this.width,0)),T=this.pointCoordinate(new o.Point(this.width,this.height)),P=this.pointCoordinate(new o.Point(0,this.height)),R=Math.floor(Math.min(y.x,v.x,T.x,P.x)),N=Math.floor(Math.max(y.x,v.x,T.x,P.x));for(let G=R-1;G<=N+1;G++)G!==0&&f.push(new o.UnwrappedTileID(G,s))}return f}coveringTiles(s){let f=this.coveringZoomLevel(s);var y=f;if(s.minzoom!==void 0&&f<s.minzoom)return[];s.maxzoom!==void 0&&f>s.maxzoom&&(f=s.maxzoom);var v=this.pointCoordinate(this.getCameraPoint()),T=o.MercatorCoordinate.fromLngLat(this.center);const P=Math.pow(2,f);var R=[P*v.x,P*v.y,0],N=[P*T.x,P*T.y,0],G=Fp.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,f);let Z=s.minzoom||0;!s.terrain&&this.pitch<=60&&this._edgeInsets.top<.1&&(Z=f);var j=s.terrain?2/Math.min(this.tileSize,s.tileSize)*this.tileSize:3,X=_n=>({aabb:new pc([_n*P,0,0],[(_n+1)*P,P,0]),zoom:0,x:0,y:0,wrap:_n,fullyVisible:!1}),ge=[],ye=[],be=f,ve=s.reparseOverscaled?y:f;if(this._renderWorldCopies)for(let _n=1;_n<=3;_n++)ge.push(X(-_n)),ge.push(X(_n));for(ge.push(X(0));0<ge.length;){var Fe=ge.pop(),Ue=Fe.x,ze=Fe.y;let _n=Fe.fullyVisible;if(!_n){var Qe=Fe.aabb.intersects(G);if(Qe===0)continue;_n=Qe===2}var Qe=s.terrain?R:N,Je=Fe.aabb.distanceX(Qe),Xe=Fe.aabb.distanceY(Qe),Je=Math.max(Math.abs(Je),Math.abs(Xe)),Xe=j+(1<<be-Fe.zoom)-2;if(Fe.zoom===be||Xe<Je&&Fe.zoom>=Z)Xe=be-Fe.zoom,Je=R[0]-.5-(Ue<<Xe),Xe=R[1]-.5-(ze<<Xe),ye.push({tileID:new o.OverscaledTileID(Fe.zoom===be?ve:Fe.zoom,Fe.wrap,Fe.zoom,Ue,ze),distanceSq:o.sqrLen([N[0]-.5-Ue,N[1]-.5-ze]),tileDistanceToCamera:Math.sqrt(Je*Je+Xe*Xe)});else for(let vn=0;vn<4;vn++){var ct,it,_t=(Ue<<1)+vn%2,Dt=(ze<<1)+(vn>>1),Yt=Fe.zoom+1;let Kt=Fe.aabb.quadrant(vn);s.terrain&&(it=new o.OverscaledTileID(Yt,Fe.wrap,Yt,_t,Dt),ct=(ct=(it=s.terrain.getMinMaxElevation(it)).minElevation)!=null?ct:this.elevation,it=(it=it.maxElevation)!=null?it:this.elevation,Kt=new pc([Kt.min[0],Kt.min[1],ct],[Kt.max[0],Kt.max[1],it])),ge.push({aabb:Kt,zoom:Yt,x:_t,y:Dt,wrap:Fe.wrap,fullyVisible:_n})}}return ye.sort((_n,vn)=>_n.distanceSq-vn.distanceSq).map(_n=>_n.tileID)}resize(s,f){this.width=s,this.height=f,this.pixelsToGLUnits=[2/s,-2/f],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(s){return Math.pow(2,s)}scaleZoom(s){return Math.log(s)/Math.LN2}project(s){var f=o.clamp(s.lat,-aa,aa);return new o.Point(o.mercatorXfromLng(s.lng)*this.worldSize,o.mercatorYfromLat(f)*this.worldSize)}unproject(s){return new o.MercatorCoordinate(s.x/this.worldSize,s.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}getCameraPosition(){return{lngLat:this.pointLocation(this.getCameraPoint()),altitude:Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter+this.elevation}}recalculateZoom(T){var f=this.elevation,y=Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter,v=this.pointLocation(this.centerPoint,T),T=T.getElevationForLngLatZoom(v,this.tileZoom);this.elevation-T&&(y=y+f-T,f=Math.cos(this._pitch)*this.cameraToCenterDistance/y/o.mercatorZfromAltitude(1,v.lat)/this.tileSize,y=this.scaleZoom(f),this._elevation=T,this._center=v,this.zoom=y)}setLocationAtPoint(T,y){var y=this.pointCoordinate(y),v=this.pointCoordinate(this.centerPoint),T=this.locationCoordinate(T),T=new o.MercatorCoordinate(T.x-(y.x-v.x),T.y-(y.y-v.y));this.center=this.coordinateLocation(T),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(s,f){return f?this.coordinatePoint(this.locationCoordinate(s),f.getElevationForLngLatZoom(s,this.tileZoom),this.pixelMatrix3D):this.coordinatePoint(this.locationCoordinate(s))}pointLocation(s,f){return this.coordinateLocation(this.pointCoordinate(s,f))}locationCoordinate(s){return o.MercatorCoordinate.fromLngLat(s)}coordinateLocation(s){return s&&s.toLngLat()}pointCoordinate(v,y){if(y&&(y=y.pointCoordinate(v),y!=null))return y;var y=[v.x,v.y,0,1],v=[v.x,v.y,1,1],T=(o.transformMat4(y,y,this.pixelMatrixInverse),o.transformMat4(v,v,this.pixelMatrixInverse),y[3]),P=v[3],R=y[1]/T,N=v[1]/P,G=y[2]/T,Z=v[2]/P,Z=G==Z?0:(0-G)/(Z-G);return new o.MercatorCoordinate(o.interpolate.number(y[0]/T,v[0]/P,Z)/this.worldSize,o.interpolate.number(R,N,Z)/this.worldSize)}coordinatePoint(s,f=0,y=this.pixelMatrix){return s=[s.x*this.worldSize,s.y*this.worldSize,f,1],o.transformMat4(s,s,y),new o.Point(s[0]/s[3],s[1]/s[3])}getBounds(){var s=Math.max(0,this.height/2-this.getHorizon());return new B().extend(this.pointLocation(new o.Point(0,s))).extend(this.pointLocation(new o.Point(this.width,s))).extend(this.pointLocation(new o.Point(this.width,this.height))).extend(this.pointLocation(new o.Point(0,this.height)))}getMaxBounds(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new B([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}getHorizon(){return Math.tan(Math.PI/2-this._pitch)*this.cameraToCenterDistance*.85}setMaxBounds(s){s?(this.lngRange=[s.getWest(),s.getEast()],this.latRange=[s.getSouth(),s.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-aa,aa])}calculatePosMatrix(s,f=!1){var y,v,T,P=s.key,R=f?this._alignedPosMatrixCache:this._posMatrixCache;return R[P]||(y=s.canonical,v=this.worldSize/this.zoomScale(y.z),s=y.x+Math.pow(2,y.z)*s.wrap,T=o.identity(new Float64Array(16)),o.translate(T,T,[s*v,y.y*v,0]),o.scale(T,T,[v/o.EXTENT,v/o.EXTENT,1]),o.multiply(T,f?this.alignedProjMatrix:this.projMatrix,T),R[P]=new Float32Array(T)),R[P]}customLayerMatrix(){return this.mercatorMatrix.slice()}getConstrained(ye,f){f=o.clamp(+f,this.minZoom,this.maxZoom),f={center:new o.LngLat(ye.lng,ye.lat),zoom:f};let y=this.lngRange;this._renderWorldCopies||y!==null||(y=[-(180-1e-10),180-1e-10]);var v=this.tileSize*this.zoomScale(f.zoom);let T=0,P=v,R=0,N=v,G=0,Z=0;var{x:j,y:X}=this.size,{x:ge,y:ye}=(this.latRange&&(ge=this.latRange,T=o.mercatorYfromLat(ge[1])*v,(P=o.mercatorYfromLat(ge[0])*v)-T<X)&&(G=X/(P-T)),y&&(R=o.wrap(o.mercatorXfromLng(y[0])*v,0,v),(N=o.wrap(o.mercatorXfromLng(y[1])*v,0,v))<R&&(N+=v),N-R<j)&&(Z=j/(N-R)),this.project.call({worldSize:v},ye));let be,ve;var Fe,Ue=Math.max(Z||0,G||0);if(Ue)Fe=new o.Point(Z?(N+R)/2:ge,G?(P+T)/2:ye),f.center=this.unproject.call({worldSize:v},Fe).wrap(),f.zoom+=this.scaleZoom(Ue);else{if(this.latRange&&(ye-(Fe=X/2)<T&&(ve=T+Fe),ye+Fe>P)&&(ve=P-Fe),y){Ue=(R+N)/2;let ze=ge;X=j/2,(ze=this._renderWorldCopies?o.wrap(ge,Ue-v/2,Ue+v/2):ze)-X<R&&(be=R+X),ze+X>N&&(be=N-X)}be===void 0&&ve===void 0||(Fe=new o.Point(be??ge,ve??ye),f.center=this.unproject.call({worldSize:v},Fe).wrap())}return f}_constrain(){var s,f,y;this.center&&this.width&&this.height&&!this._constraining&&(this._constraining=!0,s=this._unmodified,{center:f,zoom:y}=this.getConstrained(this.center,this.zoom),this.center=f,this.zoom=y,this._unmodified=s,this._constraining=!1)}_calcMatrices(){if(this.height){var v=this._fov/2,T=this.centerOffset,P=this.point.x,R=this.point.y;this.cameraToCenterDistance=.5/Math.tan(v)*this.height,this._pixelPerMeter=o.mercatorZfromAltitude(1,this.center.lat)*this.worldSize;let N=o.identity(new Float64Array(16));o.scale(N,N,[this.width/2,-this.height/2,1]),o.translate(N,N,[1,-1,0]),this.labelPlaneMatrix=N,N=o.identity(new Float64Array(16)),o.scale(N,N,[1,-1,1]),o.translate(N,N,[-1,-1,0]),o.scale(N,N,[2/this.width,2/this.height,1]),this.glCoordMatrix=N;var v=this.cameraToCenterDistance+this._elevation*this._pixelPerMeter/Math.cos(this._pitch),f=Math.min(this.elevation,this.minElevationForCurrentTile),y=v-f*this._pixelPerMeter/Math.cos(this._pitch),f=f<0?y:v,y=Math.PI/2+this._pitch,v=this._fov*(.5+T.y/this.height),v=Math.sin(v)*f/Math.sin(o.clamp(Math.PI-y-v,.01,Math.PI-.01)),s=this.getHorizon(),s=2*Math.atan(s/this.cameraToCenterDistance)*(.5+T.y/(2*s)),y=Math.sin(s)*f/Math.sin(o.clamp(Math.PI-y-s,.01,Math.PI-.01)),s=Math.min(v,y),v=1.01*(Math.cos(Math.PI/2-this._pitch)*s+f),y=this.height/50,s=(N=new Float64Array(16),o.perspective(N,this._fov,this.width/this.height,y,v),N[8]=2*-T.x/this.width,N[9]=2*T.y/this.height,o.scale(N,N,[1,-1,1]),o.translate(N,N,[0,0,-this.cameraToCenterDistance]),o.rotateX(N,N,this._pitch),o.rotateZ(N,N,this.angle),o.translate(N,N,[-P,-R,0]),this.mercatorMatrix=o.scale([],N,[this.worldSize,this.worldSize,this.worldSize]),o.scale(N,N,[1,1,this._pixelPerMeter]),this.pixelMatrix=o.multiply(new Float64Array(16),this.labelPlaneMatrix,N),o.translate(N,N,[0,0,-this.elevation]),this.projMatrix=N,this.invProjMatrix=o.invert([],N),this.pixelMatrix3D=o.multiply(new Float64Array(16),this.labelPlaneMatrix,N),this.width%2/2),f=this.height%2/2,y=Math.cos(this.angle),v=Math.sin(this.angle),T=P-Math.round(P)+y*s+v*f,P=R-Math.round(R)+y*f+v*s,R=new Float64Array(N);if(o.translate(R,R,[.5<T?T-1:T,.5<P?P-1:P,0]),this.alignedProjMatrix=R,!(N=o.invert(new Float64Array(16),this.pixelMatrix)))throw new Error("failed to invert matrix");this.pixelMatrixInverse=N,this._posMatrixCache={},this._alignedPosMatrixCache={}}}maxPitchScaleFactor(){var s;return this.pixelMatrixInverse?(s=[(s=this.pointCoordinate(new o.Point(0,0))).x*this.worldSize,s.y*this.worldSize,0,1],o.transformMat4(s,s,this.pixelMatrix)[3]/this.cameraToCenterDistance):1}getCameraPoint(){var s=this._pitch,s=Math.tan(s)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new o.Point(0,s))}getCameraQueryGeometry(s){var f=this.getCameraPoint();if(s.length===1)return[s[0],f];{let y=f.x,v=f.y,T=f.x,P=f.y;for(const R of s)y=Math.min(y,R.x),v=Math.min(v,R.y),T=Math.max(T,R.x),P=Math.max(P,R.y);return[new o.Point(y,v),new o.Point(T,v),new o.Point(T,P),new o.Point(y,P),new o.Point(y,v)]}}lngLatToCameraDepth(s,f){return s=this.locationCoordinate(s),s=[s.x*this.worldSize,s.y*this.worldSize,f,1],o.transformMat4(s,s,this.projMatrix),s[2]/s[3]}}function zy(w,s){let f=!1,y=null,v,T;const P=()=>{y=null,f&&(w.apply(v,T),y=setTimeout(P,s),f=!1)};return(...R)=>(f=!0,v=this,T=R,y||P(),y)}class fs{constructor(s){this._getCurrentHash=()=>{var f=window.location.hash.replace("#","");if(this._hashName){let y;return f.split("&").map(v=>v.split("=")).forEach(v=>{v[0]===this._hashName&&(y=v)}),(y&&y[1]||"").split("/")}return f.split("/")},this._onHashChange=()=>{var f,y=this._getCurrentHash();return 3<=y.length&&!y.some(v=>isNaN(v))&&(f=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(y[3]||0):this._map.getBearing(),this._map.jumpTo({center:[+y[2],+y[1]],zoom:+y[0],bearing:f,pitch:+(y[4]||0)}),!0)},this._updateHashUnthrottled=()=>{var f=window.location.href.replace(/(#.+)?$/,this.getHashString());try{window.history.replaceState(window.history.state,null,f)}catch{}},this._updateHash=zy(this._updateHashUnthrottled,300),this._hashName=s&&encodeURIComponent(s)}addTo(s){return this._map=s,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this}getHashString(s){var v=this._map.getCenter(),f=Math.round(100*this._map.getZoom())/100,T=Math.ceil((f*Math.LN2+Math.log(512/360/.5))/Math.LN10),T=Math.pow(10,T),y=Math.round(v.lng*T)/T,v=Math.round(v.lat*T)/T,T=this._map.getBearing(),P=this._map.getPitch();let R="";if(R+=s?`/${y}/${v}/`+f:f+`/${v}/`+y,(T||P)&&(R+="/"+Math.round(10*T)/10),P&&(R+="/"+Math.round(P)),this._hashName){const N=this._hashName;let G=!1;return s=window.location.hash.slice(1).split("&").map(Z=>{var j=Z.split("=")[0];return j===N?(G=!0,j+"="+R):Z}).filter(Z=>Z),G||s.push(N+"="+R),"#"+s.join("&")}return"#"+R}}ir={linearity:.3,easing:o.bezier(0,0,.3,1)};const Ad=o.extend({deceleration:2500,maxSpeed:1400},ir),qT=o.extend({deceleration:20,maxSpeed:1400},ir),$T=o.extend({deceleration:1e3,maxSpeed:360},ir),Gb=o.extend({deceleration:1e3,maxSpeed:90},ir);class Id{constructor(s){this._map=s,this.clear()}clear(){this._inertiaBuffer=[]}record(s){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:g.now(),settings:s})}_drainInertiaBuffer(){for(var s=this._inertiaBuffer,f=g.now();0<s.length&&160<f-s[0].time;)s.shift()}_onMoveEnd(s){if(this._drainInertiaBuffer(),!(this._inertiaBuffer.length<2)){var f,y={zoom:0,bearing:0,pitch:0,pan:new o.Point(0,0),pinchAround:void 0,around:void 0};for({settings:f}of this._inertiaBuffer)y.zoom+=f.zoomDelta||0,y.bearing+=f.bearingDelta||0,y.pitch+=f.pitchDelta||0,f.panDelta&&y.pan._add(f.panDelta),f.around&&(y.around=f.around),f.pinchAround&&(y.pinchAround=f.pinchAround);var v=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,T={};return y.pan.mag()&&(s=Vt(y.pan.mag(),v,o.extend({},Ad,s||{})),T.offset=y.pan.mult(s.amount/y.pan.mag()),T.center=this._map.transform.center,ps(T,s)),y.zoom&&(s=Vt(y.zoom,v,qT),T.zoom=this._map.transform.zoom+s.amount,ps(T,s)),y.bearing&&(s=Vt(y.bearing,v,$T),T.bearing=this._map.transform.bearing+o.clamp(s.amount,-179,179),ps(T,s)),y.pitch&&(s=Vt(y.pitch,v,Gb),T.pitch=this._map.transform.pitch+s.amount,ps(T,s)),(T.zoom||T.bearing)&&(T.around=(v=y.pinchAround===void 0?y.around:y.pinchAround)?this._map.unproject(v):this._map.getCenter()),this.clear(),o.extend(T,{noMoveStart:!0})}}}function ps(w,s){(!w.duration||w.duration<s.duration)&&(w.duration=s.duration,w.easing=s.easing)}function Vt(P,R,f){var{maxSpeed:y,linearity:v,deceleration:T}=f,P=o.clamp(P*v/(R/1e3),-y,y),R=Math.abs(P)/(T*v);return{easing:f.easing,duration:1e3*R,amount:P*(R/2)}}class sa extends o.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(s,f,y,v={}){var T=_.mousePos(f.getCanvas(),y),P=f.unproject(T);super(s,o.extend({point:T,lngLat:P,originalEvent:y},v)),this._defaultPrevented=!1,this.target=f}}class gc extends o.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(s,f,y){var v=s==="touchend"?y.changedTouches:y.touches,v=_.touchPos(f.getCanvasContainer(),v),T=v.map(R=>f.unproject(R)),P=v.reduce((R,N,G,Z)=>R.add(N.div(Z.length)),new o.Point(0,0));super(s,{points:v,point:P,lngLats:T,lngLat:f.unproject(P),originalEvent:y}),this._defaultPrevented=!1}}class Yu extends o.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(s,f,y){super(s,{originalEvent:y}),this._defaultPrevented=!1}}class qb{constructor(s,f){this._map=s,this._clickTolerance=f.clickTolerance}reset(){delete this._mousedownPos}wheel(s){return this._firePreventable(new Yu(s.type,this._map,s))}mousedown(s,f){return this._mousedownPos=f,this._firePreventable(new sa(s.type,this._map,s))}mouseup(s){this._map.fire(new sa(s.type,this._map,s))}click(s,f){this._mousedownPos&&this._mousedownPos.dist(f)>=this._clickTolerance||this._map.fire(new sa(s.type,this._map,s))}dblclick(s){return this._firePreventable(new sa(s.type,this._map,s))}mouseover(s){this._map.fire(new sa(s.type,this._map,s))}mouseout(s){this._map.fire(new sa(s.type,this._map,s))}touchstart(s){return this._firePreventable(new gc(s.type,this._map,s))}touchmove(s){this._map.fire(new gc(s.type,this._map,s))}touchend(s){this._map.fire(new gc(s.type,this._map,s))}touchcancel(s){this._map.fire(new gc(s.type,this._map,s))}_firePreventable(s){if(this._map.fire(s),s.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Ft{constructor(s){this._map=s}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(s){this._map.fire(new sa(s.type,this._map,s))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new sa("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(s){this._delayContextMenu?this._contextMenuEvent=s:this._ignoreContextMenu||this._map.fire(new sa(s.type,this._map,s)),this._map.listens("contextmenu")&&s.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Vl{constructor(s){this._map=s}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(s){return this.transform.pointLocation(o.Point.convert(s),this._map.terrain)}}class $b{constructor(s,f){this._map=s,this._tr=new Vl(s),this._el=s.getCanvasContainer(),this._container=s.getContainer(),this._clickTolerance=f.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(s,f){this.isEnabled()&&s.shiftKey&&s.button===0&&(_.disableDrag(),this._startPos=this._lastPos=f,this._active=!0)}mousemoveWindow(s,f){var y,v,T;!this._active||this._lastPos.equals(f=f)||!this._box&&f.dist(this._startPos)<this._clickTolerance||(T=this._startPos,this._lastPos=f,this._box||(this._box=_.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",s)),s=Math.min(T.x,f.x),y=Math.max(T.x,f.x),v=Math.min(T.y,f.y),T=Math.max(T.y,f.y),_.setTransform(this._box,`translate(${s}px,${v}px)`),this._box.style.width=y-s+"px",this._box.style.height=T-v+"px")}mouseupWindow(s,f){if(this._active&&s.button===0){const y=this._startPos,v=f;if(this.reset(),_.suppressClick(),y.x!==v.x||y.y!==v.y)return this._map.fire(new o.Event("boxzoomend",{originalEvent:s})),{cameraAnimation:T=>T.fitScreenCoordinates(y,v,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",s)}}keydown(s){this._active&&s.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",s))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(_.remove(this._box),this._box=null),_.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(s,f){return this._map.fire(new o.Event(s,{originalEvent:f}))}}function Pd(w,s){if(w.length!==s.length)throw new Error(`The number of touches and points are not equal - touches ${w.length}, points `+s.length);var f={};for(let y=0;y<w.length;y++)f[w[y].identifier]=s[y];return f}function Wb(w){var s=new o.Point(0,0);for(const f of w)s._add(f);return s.div(w.length)}class Yb{constructor(s){this.reset(),this.numTouches=s.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(s,f,y){(this.centroid||y.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=s.timeStamp),y.length===this.numTouches&&(this.centroid=Wb(f),this.touches=Pd(y,f)))}touchmove(s,f,y){if(!this.aborted&&this.centroid){var v=Pd(y,f);for(const R in this.touches){var T=this.touches[R],P=v[R];(!P||30<P.dist(T))&&(this.aborted=!0)}}}touchend(s,f,y){if((!this.centroid||500<s.timeStamp-this.startTime)&&(this.aborted=!0),y.length===0&&(s=!this.aborted&&this.centroid,this.reset(),s))return s}}class jy{constructor(s){this.singleTap=new Yb(s),this.numTaps=s.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(s,f,y){this.singleTap.touchstart(s,f,y)}touchmove(s,f,y){this.singleTap.touchmove(s,f,y)}touchend(s,f,y){if(f=this.singleTap.touchend(s,f,y),f){var y=s.timeStamp-this.lastTime<500,v=!this.lastTap||this.lastTap.dist(f)<30;if(y&&v||this.reset(),this.count++,this.lastTime=s.timeStamp,this.lastTap=f,this.count===this.numTaps)return this.reset(),f}}}class Hl{constructor(s){this._tr=new Vl(s),this._zoomIn=new jy({numTouches:1,numTaps:2}),this._zoomOut=new jy({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(s,f,y){this._zoomIn.touchstart(s,f,y),this._zoomOut.touchstart(s,f,y)}touchmove(s,f,y){this._zoomIn.touchmove(s,f,y),this._zoomOut.touchmove(s,f,y)}touchend(s,f,y){const v=this._zoomIn.touchend(s,f,y),T=this._zoomOut.touchend(s,f,y),P=this._tr;return v?(this._active=!0,s.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:R=>R.easeTo({duration:300,zoom:P.zoom+1,around:P.unproject(v)},{originalEvent:s})}):T?(this._active=!0,s.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:R=>R.easeTo({duration:300,zoom:P.zoom-1,around:P.unproject(T)},{originalEvent:s})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ur{constructor(s){this._enabled=!!s.enable,this._moveStateManager=s.moveStateManager,this._clickTolerance=s.clickTolerance||1,this._moveFunction=s.move,this._activateOnStart=!!s.activateOnStart,s.assignEvents(this),this.reset()}reset(s){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(s)}_move(...s){if(s=this._moveFunction(...s),s.bearingDelta||s.pitchDelta||s.around||s.panDelta)return this._active=!0,s}dragStart(s,f){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(s)&&(this._moveStateManager.startMove(s),this._lastPoint=f.length?f[0]:f,this._activateOnStart)&&this._lastPoint&&(this._active=!0)}dragMove(s,f){if(this.isEnabled()){var y=this._lastPoint;if(y)if(s.preventDefault(),this._moveStateManager.isValidMoveEvent(s)){if(f=f.length?f[0]:f,this._moved||!(f.dist(y)<this._clickTolerance))return this._moved=!0,this._lastPoint=f,this._move(y,f)}else this.reset(s)}}dragEnd(s){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(s)&&(this._moved&&_.suppressClick(),this.reset(s))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const Bp={0:1,2:2};function Vy(w,s){return s=Bp[s],w.buttons===void 0||(w.buttons&s)!==s}class Up{constructor(s){this._correctEvent=s.checkCorrectEvent}startMove(s){s=_.mouseButton(s),this._eventButton=s}endMove(s){delete this._eventButton}isValidStartEvent(s){return this._correctEvent(s)}isValidMoveEvent(s){return!Vy(s,this._eventButton)}isValidEndEvent(s){return _.mouseButton(s)===this._eventButton}}class Hy{constructor(){this._firstTouch=void 0}_isOneFingerTouch(s){return s.targetTouches.length===1}_isSameTouchEvent(s){return s.targetTouches[0].identifier===this._firstTouch}startMove(s){s=s.targetTouches[0].identifier,this._firstTouch=s}endMove(s){delete this._firstTouch}isValidStartEvent(s){return this._isOneFingerTouch(s)}isValidMoveEvent(s){return this._isOneFingerTouch(s)&&this._isSameTouchEvent(s)}isValidEndEvent(s){return this._isOneFingerTouch(s)&&this._isSameTouchEvent(s)}}const zp=w=>{w.mousedown=w.dragStart,w.mousemoveWindow=w.dragMove,w.mouseup=w.dragEnd,w.contextmenu=function(s){s.preventDefault()}},WT=({enable:w,clickTolerance:s})=>{var f=new Up({checkCorrectEvent:y=>_.mouseButton(y)===0&&!y.ctrlKey});return new Ur({clickTolerance:s,move:(y,v)=>({around:v,panDelta:v.sub(y)}),activateOnStart:!0,moveStateManager:f,enable:w,assignEvents:zp})},Ga=({enable:w,clickTolerance:s,bearingDegreesPerPixelMoved:f=.8})=>{var y=new Up({checkCorrectEvent:v=>_.mouseButton(v)===0&&v.ctrlKey||_.mouseButton(v)===2});return new Ur({clickTolerance:s,move:(v,T)=>({bearingDelta:(T.x-v.x)*f}),moveStateManager:y,enable:w,assignEvents:zp})},Md=({enable:w,clickTolerance:s,pitchDegreesPerPixelMoved:f=-.5})=>{var y=new Up({checkCorrectEvent:v=>_.mouseButton(v)===0&&v.ctrlKey||_.mouseButton(v)===2});return new Ur({clickTolerance:s,move:(v,T)=>({pitchDelta:(T.y-v.y)*f}),moveStateManager:y,enable:w,assignEvents:zp})};class sn{constructor(s,f){this._clickTolerance=s.clickTolerance||1,this._map=f,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new o.Point(0,0)}minTouchs(){return this._map.cooperativeGestures.isEnabled()?2:1}touchstart(s,f,y){return this._calculateTransform(s,f,y)}touchmove(s,f,y){if(this._active&&!(y.length<this.minTouchs()))return s.preventDefault(),this._calculateTransform(s,f,y)}touchend(s,f,y){this._calculateTransform(s,f,y),this._active&&y.length<this.minTouchs()&&this.reset()}touchcancel(){this.reset()}_calculateTransform(s,f,y){0<y.length&&(this._active=!0);var v=Pd(y,f),T=new o.Point(0,0),P=new o.Point(0,0);let R=0;for(const Z in v){var N=v[Z],G=this._touches[Z];G&&(T._add(N),P._add(N.sub(G)),R++,v[Z]=N)}if(this._touches=v,!(R<this.minTouchs())&&P.mag()&&(y=P.div(R),this._sum._add(y),!(this._sum.mag()<this._clickTolerance)))return{around:T.div(R),panDelta:y}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class wn{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(s,f,y){this._firstTwoTouches||y.length<2||(this._firstTwoTouches=[y[0].identifier,y[1].identifier],this._start([f[0],f[1]]))}touchmove(s,f,y){if(this._firstTwoTouches){s.preventDefault();var[T,v]=this._firstTwoTouches,T=Gl(y,f,T),y=Gl(y,f,v);if(T&&y)return f=this._aroundCenter?null:T.add(y).div(2),this._move([T,y],f,s)}}touchend(s,f,y){var v,T;this._firstTwoTouches&&([T,v]=this._firstTwoTouches,T=Gl(y,f,T),y=Gl(y,f,v),T&&y||(this._active&&_.suppressClick(),this.reset()))}touchcancel(){this.reset()}enable(s){this._enabled=!0,this._aroundCenter=!!s&&s.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function Gl(w,s,f){for(let y=0;y<w.length;y++)if(w[y].identifier===f)return s[y]}function jp(w,s){return Math.log(w/s)/Math.LN2}class Vp extends wn{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(s){this._startDistance=this._distance=s[0].dist(s[1])}_move(s,f){var y=this._distance;if(this._distance=s[0].dist(s[1]),this._active||!(Math.abs(jp(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:jp(this._distance,y),pinchAround:f}}}function jo(w,s){return 180*w.angleWith(s)/Math.PI}class Rd extends wn{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(s){this._startVector=this._vector=s[0].sub(s[1]),this._minDiameter=s[0].dist(s[1])}_move(s,f,y){var v=this._vector;if(this._vector=s[0].sub(s[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:jo(this._vector,v),pinchAround:f}}_isBelowThreshold(y){this._minDiameter=Math.min(this._minDiameter,y.mag());var f=25/(Math.PI*this._minDiameter)*360,y=jo(y,this._startVector);return Math.abs(y)<f}}function qa(w){return Math.abs(w.y)>Math.abs(w.x)}class Kb extends wn{constructor(s){super(),this._currentTouchCount=0,this._map=s}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(s,f,y){super.touchstart(s,f,y),this._currentTouchCount=y.length}_start(s){qa((this._lastPoints=s)[0].sub(s[1]))&&(this._valid=!1)}_move(s,f,y){if(!(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)){var v=s[0].sub(this._lastPoints[0]),T=s[1].sub(this._lastPoints[1]);if(this._valid=this.gestureBeginsVertically(v,T,y.timeStamp),this._valid)return this._lastPoints=s,this._active=!0,{pitchDelta:-.5*((v.y+T.y)/2)}}}gestureBeginsVertically(s,f,y){var v,T;return this._valid!==void 0?this._valid:(T=2<=s.mag(),v=2<=f.mag(),T||v?T&&v?(T=0<s.y==0<f.y,qa(s)&&qa(f)&&T):(this._firstMove===void 0&&(this._firstMove=y),y-this._firstMove<100&&void 0):void 0)}}const kd={panStep:100,bearingStep:15,pitchStep:10};class fi{constructor(s){this._tr=new Vl(s),s=kd,this._panStep=s.panStep,this._bearingStep=s.bearingStep,this._pitchStep=s.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(s){if(!(s.altKey||s.ctrlKey||s.metaKey)){let f=0,y=0,v=0,T=0,P=0;switch(s.keyCode){case 61:case 107:case 171:case 187:f=1;break;case 189:case 109:case 173:f=-1;break;case 37:s.shiftKey?y=-1:(s.preventDefault(),T=-1);break;case 39:s.shiftKey?y=1:(s.preventDefault(),T=1);break;case 38:s.shiftKey?v=1:(s.preventDefault(),P=-1);break;case 40:s.shiftKey?v=-1:(s.preventDefault(),P=1);break;default:return}return this._rotationDisabled&&(y=0,v=0),{cameraAnimation:R=>{var N=this._tr;R.easeTo({duration:300,easeId:"keyboardHandler",easing:Di,zoom:f?Math.round(N.zoom)+f*(s.shiftKey?2:1):N.zoom,bearing:N.bearing+y*this._bearingStep,pitch:N.pitch+v*this._pitchStep,offset:[-T*this._panStep,-P*this._panStep],center:N.center},{originalEvent:s})}}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Di(w){return w*(2-w)}const Gy=4.000244140625;class Ku{constructor(s,f){this._onTimeout=y=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(y)},this._map=s,this._tr=new Vl(s),this._triggerRenderFrame=f,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=1/450}setZoomRate(s){this._defaultZoomRate=s}setWheelZoomRate(s){this._wheelZoomRate=s}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(s){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!s&&s.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}wheel(s){if(this.isEnabled()&&(!this._map.cooperativeGestures.isEnabled()||s[this._map.cooperativeGestures._bypassKey])){let v=s.deltaMode===WheelEvent.DOM_DELTA_LINE?40*s.deltaY:s.deltaY;var f=g.now(),y=f-(this._lastWheelEventTime||0);this._lastWheelEventTime=f,v!==0&&v%Gy==0?this._type="wheel":v!==0&&Math.abs(v)<4?this._type="trackpad":400<y?(this._type=null,this._lastValue=v,this._timeout=setTimeout(this._onTimeout,40,s)):this._type||(this._type=Math.abs(y*v)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,v+=this._lastValue)),s.shiftKey&&v&&(v/=4),this._type&&(this._lastWheelEvent=s,this._delta-=v,this._active||this._start(s)),s.preventDefault()}}_start(s){var f;this._delta&&(this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout),s=_.mousePos(this._map.getCanvas(),s),f=this._tr,s.y>f.transform.height/2-f.transform.getHorizon()?this._around=o.LngLat.convert(this._aroundCenter?f.center:f.unproject(s)):this._around=o.LngLat.convert(f.center),this._aroundPoint=f.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._triggerRenderFrame()))}renderFrame(){if(this._frameId&&(this._frameId=null,this.isActive())){var s=this._tr.transform;if(this._delta!==0){var y=this._type==="wheel"&&Math.abs(this._delta)>Gy?this._wheelZoomRate:this._defaultZoomRate;let G=2/(1+Math.exp(-Math.abs(this._delta*y)));this._delta<0&&G!==0&&(G=1/G),y=typeof this._targetZoom=="number"?s.zoomScale(this._targetZoom):s.scale,this._targetZoom=Math.min(s.maxZoom,Math.max(s.minZoom,s.scaleZoom(y*G))),this._type==="wheel"&&(this._startZoom=s.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}var f,y=typeof this._targetZoom=="number"?this._targetZoom:s.zoom,v=this._startZoom,T=this._easing;let P=!1,R;return this._type==="wheel"&&v&&T?(f=T(T=Math.min((g.now()-this._lastWheelEventTime)/200,1)),R=o.interpolate.number(v,y,f),T<1?this._frameId||(this._frameId=!0):P=!0):(R=y,P=!0),this._active=!0,P&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!P,zoomDelta:R-s.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}}_smoothOutEasing(s){let f=o.defaultEasing;var y,v;return this._prevEase&&(v=this._prevEase,y=(g.now()-v.start)/v.duration,v=v.easing(.01+y)-v.easing(y),y=.27/Math.sqrt(v*v+1e-4)*.01,v=Math.sqrt(.0729-y*y),f=o.bezier(y,v,.25,1)),this._prevEase={start:g.now(),duration:s,easing:f},f}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class Od{constructor(s,f){this._clickZoom=s,this._tapZoom=f}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class qy{constructor(s){this._tr=new Vl(s),this.reset()}reset(){this._active=!1}dblclick(s,f){return s.preventDefault(),{cameraAnimation:y=>{y.easeTo({duration:300,zoom:this._tr.zoom+(s.shiftKey?-1:1),around:this._tr.unproject(f)},{originalEvent:s})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class $y{constructor(){this._tap=new jy({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(s,f,y){var v,T,P;this._swipePoint||(this._tapTime?(v=f[0],T=s.timeStamp-this._tapTime<500,P=this._tapPoint.dist(v)<30,T&&P?0<y.length&&(this._swipePoint=v,this._swipeTouch=y[0].identifier):this.reset()):this._tap.touchstart(s,f,y))}touchmove(s,f,y){if(this._tapTime){if(this._swipePoint){var v,T;if(y[0].identifier===this._swipeTouch)return T=(v=f[0]).y-this._swipePoint.y,this._swipePoint=v,s.preventDefault(),this._active=!0,{zoomDelta:T/128}}}else this._tap.touchmove(s,f,y)}touchend(s,f,y){this._tapTime?this._swipePoint&&y.length===0&&this.reset():(f=this._tap.touchend(s,f,y))&&(this._tapTime=s.timeStamp,this._tapPoint=f)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Hp{constructor(s,f,y){this._el=s,this._mousePan=f,this._touchPan=y}enable(s){this._inertiaOptions=s||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Zu{constructor(s,f,y){this._pitchWithRotate=s.pitchWithRotate,this._mouseRotate=f,this._mousePitch=y}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Gp{constructor(s,f,y,v){this._el=s,this._touchZoom=f,this._touchRotate=y,this._tapDragZoom=v,this._rotationDisabled=!1,this._enabled=!0}enable(s){this._touchZoom.enable(s),this._rotationDisabled||this._touchRotate.enable(s),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class qp{constructor(s,f){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=s,this._options=f,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(!this._container){var s=this._map.getCanvasContainer();s.classList.add("maplibregl-cooperative-gestures"),this._container=_.create("div","maplibregl-cooperative-gesture-screen",s);let y=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(y=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));var s=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),f=document.createElement("div"),f=(f.className="maplibregl-desktop-message",f.textContent=y,this._container.appendChild(f),document.createElement("div"));f.className="maplibregl-mobile-message",f.textContent=s,this._container.appendChild(f),this._container.setAttribute("aria-hidden","true")}}_destoryUI(){this._container&&(_.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destoryUI()}isEnabled(){return this._enabled}touchmove(s){this._onCooperativeGesture(s.touches.length===1)}wheel(s){this._map.scrollZoom.isEnabled()&&this._onCooperativeGesture(!s[this._bypassKey])}_onCooperativeGesture(s){this._enabled&&s&&(this._container.classList.add("maplibregl-show"),setTimeout(()=>{this._container.classList.remove("maplibregl-show")},100))}}const Xu=w=>w.zoom||w.drag||w.pitch||w.rotate;class Wy extends o.Event{}function Ld(w){return w.panDelta&&w.panDelta.mag()||w.zoomDelta||w.bearingDelta||w.pitchDelta}class Yy{constructor(P,f){this.handleWindowEvent=R=>{this.handleEvent(R,R.type+"Window")},this.handleEvent=(R,N)=>{if(R.type==="blur")this.stop(!0);else{this._updatingCamera=!0;var G,Z,j,X=R.type==="renderFrame"?void 0:R,ge={needsRenderFrame:!1},ye={},be={},ve=R.touches,Fe=ve?this._getMapTouches(ve):void 0,Ue=Fe?_.touchPos(this._map.getCanvas(),Fe):_.mousePos(this._map.getCanvas(),R);for({handlerName:G,handler:Z,allowed:j}of this._handlers)if(Z.isEnabled()){let Qe;this._blockedByActive(be,j,G)?Z.reset():Z[N||R.type]&&(Qe=Z[N||R.type](R,Ue,Fe),this.mergeHandlerResult(ge,ye,Qe,G,X),Qe)&&Qe.needsRenderFrame&&this._triggerRenderFrame(),(Qe||Z.isActive())&&(be[G]=Z)}var ze={};for(const Qe in this._previousActiveHandlers)be[Qe]||(ze[Qe]=X);this._previousActiveHandlers=be,(Object.keys(ze).length||Ld(ge))&&(this._changes.push([ge,ye,ze]),this._triggerRenderFrame()),(Object.keys(be).length||Ld(ge))&&this._map._stop(!0),this._updatingCamera=!1,ve=ge.cameraAnimation,ve&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],ve(this._map))}},this._map=P,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Id(P),this._bearingSnap=f.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(f);var y,v,T,P=this._el;this._listeners=[[P,"touchstart",{passive:!0}],[P,"touchmove",{passive:!1}],[P,"touchend",void 0],[P,"touchcancel",void 0],[P,"mousedown",void 0],[P,"mousemove",void 0],[P,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[P,"mouseover",void 0],[P,"mouseout",void 0],[P,"dblclick",void 0],[P,"click",void 0],[P,"keydown",{capture:!1}],[P,"keyup",void 0],[P,"wheel",{passive:!1}],[P,"contextmenu",void 0],[window,"blur",void 0]];for([y,v,T]of this._listeners)_.addEventListener(y,v,y===document?this.handleWindowEvent:this.handleEvent,T)}destroy(){for(var[s,f,y]of this._listeners)_.removeEventListener(s,f,s===document?this.handleWindowEvent:this.handleEvent,y)}_addDefaultHandlers(s){var f=this._map,T=f.getCanvasContainer(),P=(this._add("mapEvent",new qb(f,s)),f.boxZoom=new $b(f,s)),P=(this._add("boxZoom",P),s.interactive&&s.boxZoom&&P.enable(),f.cooperativeGestures=new qp(f,s.cooperativeGestures)),P=(this._add("cooperativeGestures",P),s.cooperativeGestures&&P.enable(),new Hl(f)),y=new qy(f),P=(f.doubleClickZoom=new Od(y,P),this._add("tapZoom",P),this._add("clickZoom",y),s.interactive&&s.doubleClickZoom&&f.doubleClickZoom.enable(),new $y),y=(this._add("tapDragZoom",P),f.touchPitch=new Kb(f)),y=(this._add("touchPitch",y),s.interactive&&s.touchPitch&&f.touchPitch.enable(s.touchPitch),Ga(s)),v=Md(s),y=(f.dragRotate=new Zu(s,y,v),this._add("mouseRotate",y,["mousePitch"]),this._add("mousePitch",v,["mouseRotate"]),s.interactive&&s.dragRotate&&f.dragRotate.enable(),WT(s)),v=new sn(s,f),y=(f.dragPan=new Hp(T,y,v),this._add("mousePan",y),this._add("touchPan",v,["touchZoom","touchRotate"]),s.interactive&&s.dragPan&&f.dragPan.enable(s.dragPan),new Rd),v=new Vp,T=(f.touchZoomRotate=new Gp(T,v,y,P),this._add("touchRotate",y,["touchPan","touchZoom"]),this._add("touchZoom",v,["touchPan","touchRotate"]),s.interactive&&s.touchZoomRotate&&f.touchZoomRotate.enable(s.touchZoomRotate),f.scrollZoom=new Ku(f,()=>this._triggerRenderFrame())),P=(this._add("scrollZoom",T,["mousePan"]),s.interactive&&s.scrollZoom&&f.scrollZoom.enable(s.scrollZoom),f.keyboard=new fi(f));this._add("keyboard",P),s.interactive&&s.keyboard&&f.keyboard.enable(),this._add("blockableMapEvent",new Ft(f))}_add(s,f,y){this._handlers.push({handlerName:s,handler:f,allowed:y}),this._handlersById[s]=f}stop(s){if(!this._updatingCamera){for(var{handler:f}of this._handlers)f.reset();this._inertia.clear(),this._fireEvents({},{},s),this._changes=[]}}isActive(){for(var{handler:s}of this._handlers)if(s.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Xu(this._eventsInProgress)||this.isZooming()}_blockedByActive(s,f,y){for(const v in s)if(v!==y&&(!f||f.indexOf(v)<0))return!0;return!1}_getMapTouches(s){var f=[];for(const v of s){var y=v.target;this._el.contains(y)&&f.push(v)}return f}mergeHandlerResult(s,f,y,v,T){y&&(o.extend(s,y),s={handlerName:v,originalEvent:y.originalEvent||T},y.zoomDelta!==void 0&&(f.zoom=s),y.panDelta!==void 0&&(f.drag=s),y.pitchDelta!==void 0&&(f.pitch=s),y.bearingDelta!==void 0)&&(f.rotate=s)}_applyChanges(){var s,f,y,v={},T={},P={};for([s,f,y]of this._changes)s.panDelta&&(v.panDelta=(v.panDelta||new o.Point(0,0))._add(s.panDelta)),s.zoomDelta&&(v.zoomDelta=(v.zoomDelta||0)+s.zoomDelta),s.bearingDelta&&(v.bearingDelta=(v.bearingDelta||0)+s.bearingDelta),s.pitchDelta&&(v.pitchDelta=(v.pitchDelta||0)+s.pitchDelta),s.around!==void 0&&(v.around=s.around),s.pinchAround!==void 0&&(v.pinchAround=s.pinchAround),s.noInertia&&(v.noInertia=s.noInertia),o.extend(T,f),o.extend(P,y);this._updateMapTransform(v,T,P),this._changes=[]}_updateMapTransform(s,f,y){const v=this._map,T=v._getTransformForUpdate();var P=v.terrain;if(!(Ld(s)||P&&this._terrainMovement))return this._fireEvents(f,y,!0);let{panDelta:R,zoomDelta:N,bearingDelta:G,pitchDelta:Z,around:j,pinchAround:X}=s;X!==void 0&&(j=X),v._stop(!0),j=j||v.transform.centerPoint;var ge=T.pointLocation(R?j.sub(R):j);G&&(T.bearing+=G),Z&&(T.pitch+=Z),N&&(T.zoom+=N),P?this._terrainMovement||!f.drag&&!f.zoom?f.drag&&this._terrainMovement?T.center=T.pointLocation(T.centerPoint.sub(R)):T.setLocationAtPoint(ge,j):(this._terrainMovement=!0,this._map._elevationFreeze=!0,T.setLocationAtPoint(ge,j),this._map.once("moveend",()=>{this._map._elevationFreeze=!1,this._terrainMovement=!1,T.recalculateZoom(v.terrain)})):T.setLocationAtPoint(ge,j),v._applyUpdatedTransform(T),this._map._update(),s.noInertia||this._inertia.record(s),this._fireEvents(f,y,!0)}_fireEvents(s,f,y){var v=Xu(this._eventsInProgress),T=Xu(s),P={};for(const ye in s){var R=s[ye].originalEvent;this._eventsInProgress[ye]||(P[ye+"start"]=R),this._eventsInProgress[ye]=s[ye]}!v&&T&&this._fireEvent("movestart",T.originalEvent);for(const ye in P)this._fireEvent(ye,P[ye]);T&&this._fireEvent("move",T.originalEvent);for(const ye in s){var N=s[ye].originalEvent;this._fireEvent(ye,N)}var G={};let Z;for(const ye in this._eventsInProgress){var{handlerName:j,originalEvent:X}=this._eventsInProgress[ye];this._handlersById[j].isActive()||(delete this._eventsInProgress[ye],Z=f[j]||X,G[ye+"end"]=Z)}for(const ye in G)this._fireEvent(ye,G[ye]);var ge=Xu(this._eventsInProgress);y&&(v||T)&&!ge&&(this._updatingCamera=!0,y=ye=>ye!==0&&-this._bearingSnap<ye&&ye<this._bearingSnap,!(v=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions))||!v.essential&&g.prefersReducedMotion?(this._map.fire(new o.Event("moveend",{originalEvent:Z})),y(this._map.getBearing())&&this._map.resetNorth()):(y(v.bearing||this._map.getBearing())&&(v.bearing=0),v.freezeElevation=!0,this._map.easeTo(v,{originalEvent:Z})),this._updatingCamera=!1)}_fireEvent(s,f){this._map.fire(new o.Event(s,f?{originalEvent:f}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(s=>{delete this._frameId,this.handleEvent(new Wy("renderFrame",{timeStamp:s})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class Ky extends o.Evented{constructor(s,f){super(),this._renderFrameCallback=()=>{var y=Math.min((g.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(y)),y<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=s,this._bearingSnap=f.bearingSnap,this.on("moveend",()=>{delete this._requestedCameraState})}getCenter(){return new o.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(s,f){return this.jumpTo({center:s},f)}panBy(s,f,y){return s=o.Point.convert(s).mult(-1),this.panTo(this.transform.center,o.extend({offset:s},f),y)}panTo(s,f,y){return this.easeTo(o.extend({center:s},f),y)}getZoom(){return this.transform.zoom}setZoom(s,f){return this.jumpTo({zoom:s},f),this}zoomTo(s,f,y){return this.easeTo(o.extend({zoom:s},f),y)}zoomIn(s,f){return this.zoomTo(this.getZoom()+1,s,f),this}zoomOut(s,f){return this.zoomTo(this.getZoom()-1,s,f),this}getBearing(){return this.transform.bearing}setBearing(s,f){return this.jumpTo({bearing:s},f),this}getPadding(){return this.transform.padding}setPadding(s,f){return this.jumpTo({padding:s},f),this}rotateTo(s,f,y){return this.easeTo(o.extend({bearing:s},f),y)}resetNorth(s,f){return this.rotateTo(0,o.extend({duration:1e3},s),f),this}resetNorthPitch(s,f){return this.easeTo(o.extend({bearing:0,pitch:0,duration:1e3},s),f),this}snapToNorth(s,f){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(s,f):this}getPitch(){return this.transform.pitch}setPitch(s,f){return this.jumpTo({pitch:s},f),this}cameraForBounds(s,f){s=B.convert(s);var y=f&&f.bearing||0;return this._cameraForBoxAndBearing(s.getNorthWest(),s.getSouthEast(),y,f)}_cameraForBoxAndBearing(X,R,y,v){var P={top:0,bottom:0,right:0,left:0},T=(typeof(v=o.extend({padding:P,offset:[0,0],maxZoom:this.transform.maxZoom},v)).padding=="number"&&(T=v.padding,v.padding={top:T,bottom:T,right:T,left:T}),v.padding=o.extend(P,v.padding),this.transform),P=T.padding,X=new B(X,R),R=T.project(X.getNorthWest()),j=T.project(X.getNorthEast()),N=T.project(X.getSouthEast()),X=T.project(X.getSouthWest()),G=o.degreesToRadians(-y),Z=R.rotate(G),j=j.rotate(G),ge=N.rotate(G),X=X.rotate(G),G=new o.Point(Math.max(Z.x,j.x,X.x,ge.x),Math.max(Z.y,j.y,X.y,ge.y)),Z=new o.Point(Math.min(Z.x,j.x,X.x,ge.x),Math.min(Z.y,j.y,X.y,ge.y)),j=G.sub(Z),X=(T.width-(P.left+P.right+v.padding.left+v.padding.right))/j.x,ge=(T.height-(P.top+P.bottom+v.padding.top+v.padding.bottom))/j.y;if(!(ge<0||X<0))return G=Math.min(T.scaleZoom(T.scale*Math.min(X,ge)),v.maxZoom),Z=o.Point.convert(v.offset),P=(v.padding.left-v.padding.right)/2,j=(v.padding.top-v.padding.bottom)/2,X=new o.Point(P,j).rotate(o.degreesToRadians(y)),ge=Z.add(X).mult(T.scale/T.zoomScale(G)),{center:T.unproject(R.add(N).div(2).sub(ge)),zoom:G,bearing:y};o.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}fitBounds(s,f,y){return this._fitInternal(this.cameraForBounds(s,f),f,y)}fitScreenCoordinates(s,f,y,v,T){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(o.Point.convert(s)),this.transform.pointLocation(o.Point.convert(f)),y,v),v,T)}_fitInternal(s,f,y){return s?(delete(f=o.extend(s,f)).padding,f.linear?this.easeTo(f,y):this.flyTo(f,y)):this}jumpTo(s,f){this.stop();var y=this._getTransformForUpdate();let v=!1,T=!1,P=!1;return"zoom"in s&&y.zoom!==+s.zoom&&(v=!0,y.zoom=+s.zoom),s.center!==void 0&&(y.center=o.LngLat.convert(s.center)),"bearing"in s&&y.bearing!==+s.bearing&&(T=!0,y.bearing=+s.bearing),"pitch"in s&&y.pitch!==+s.pitch&&(P=!0,y.pitch=+s.pitch),s.padding==null||y.isPaddingEqual(s.padding)||(y.padding=s.padding),this._applyUpdatedTransform(y),this.fire(new o.Event("movestart",f)).fire(new o.Event("move",f)),v&&this.fire(new o.Event("zoomstart",f)).fire(new o.Event("zoom",f)).fire(new o.Event("zoomend",f)),T&&this.fire(new o.Event("rotatestart",f)).fire(new o.Event("rotate",f)).fire(new o.Event("rotateend",f)),P&&this.fire(new o.Event("pitchstart",f)).fire(new o.Event("pitch",f)).fire(new o.Event("pitchend",f)),this.fire(new o.Event("moveend",f))}calculateCameraOptionsFromTo(P,T,Z,j=0){var P=o.MercatorCoordinate.fromLngLat(P,T),T=o.MercatorCoordinate.fromLngLat(Z,j),Z=T.x-P.x,j=T.y-P.y,P=T.z-P.z,R=Math.hypot(Z,j,P);if(R===0)throw new Error("Can't calculate camera options with same From and To");var N=Math.hypot(Z,j),G=this.transform.scaleZoom(this.transform.cameraToCenterDistance/R/this.transform.tileSize),Z=180*Math.atan2(Z,-j)/Math.PI,j=180*Math.acos(N/R)/Math.PI,j=P<0?90-j:90+j;return{center:T.toLngLat(),zoom:G,pitch:j,bearing:Z}}easeTo(s,f){this._stop(!1,s.easeId),((s=o.extend({offset:[0,0],duration:500,easing:o.defaultEasing},s)).animate===!1||!s.essential&&g.prefersReducedMotion)&&(s.duration=0);const y=this._getTransformForUpdate(),v=this.getZoom(),T=this.getBearing(),P=this.getPitch(),R=this.getPadding(),N="bearing"in s?this._normalizeBearing(s.bearing,T):T,G="pitch"in s?+s.pitch:P,Z=("padding"in s?s:y).padding,j=o.Point.convert(s.offset);let X=y.centerPoint.add(j);var ge=y.pointLocation(X);const{center:ye,zoom:be}=y.getConstrained(o.LngLat.convert(s.center||ge),(Je=s.zoom)!=null?Je:v),ve=(this._normalizeCenter(ye),y.project(ge)),Fe=y.project(ye).sub(ve),Ue=y.zoomScale(be-v);let ze,Qe;s.around&&(ze=o.LngLat.convert(s.around),Qe=y.locationPoint(ze));var Je={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||be!==v,this._rotating=this._rotating||T!==N,this._pitching=this._pitching||G!==P,this._padding=!y.isPaddingEqual(Z),this._easeId=s.easeId,this._prepareEase(f,s.noMoveStart,Je),this.terrain&&this._prepareElevation(ye),this._ease(Xe=>{var ct,it;this._zooming&&(y.zoom=o.interpolate.number(v,be,Xe)),this._rotating&&(y.bearing=o.interpolate.number(T,N,Xe)),this._pitching&&(y.pitch=o.interpolate.number(P,G,Xe)),this._padding&&(y.interpolatePadding(R,Z,Xe),X=y.centerPoint.add(j)),this.terrain&&!s.freezeElevation&&this._updateElevation(Xe),ze?y.setLocationAtPoint(ze,Qe):(ct=y.zoomScale(y.zoom-v),it=be>v?Math.min(2,Ue):Math.max(.5,Ue),it=Math.pow(it,1-Xe),Xe=y.unproject(ve.add(Fe.mult(Xe*it)).mult(ct)),y.setLocationAtPoint(y.renderWorldCopies?Xe.wrap():Xe,X)),this._applyUpdatedTransform(y),this._fireMoveEvents(f)},Xe=>{this.terrain&&this._finalizeElevation(),this._afterEase(f,Xe)},s),this}_prepareEase(s,f,y={}){this._moving=!0,f||y.moving||this.fire(new o.Event("movestart",s)),this._zooming&&!y.zooming&&this.fire(new o.Event("zoomstart",s)),this._rotating&&!y.rotating&&this.fire(new o.Event("rotatestart",s)),this._pitching&&!y.pitching&&this.fire(new o.Event("pitchstart",s))}_prepareElevation(s){this._elevationCenter=s,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(s,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(s){this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);var f,y,v=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);s<1&&v!==this._elevationTarget&&(y=(v-((f=this._elevationTarget-this._elevationStart)*s+this._elevationStart))/(1-s),this._elevationStart+=s*(f-y),this._elevationTarget=v),this.transform.elevation=o.interpolate.number(this._elevationStart,this._elevationTarget,s)}_finalizeElevation(){this._elevationFreeze=!1,this.transform.recalculateZoom(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_applyUpdatedTransform(s){var f,y,v,T,P;this.transformCameraUpdate&&(s=s.clone(),{center:f,zoom:y,pitch:v,bearing:T,elevation:P}=this.transformCameraUpdate(s),f&&(s.center=f),y!==void 0&&(s.zoom=y),v!==void 0&&(s.pitch=v),T!==void 0&&(s.bearing=T),P!==void 0&&(s.elevation=P),this.transform.apply(s))}_fireMoveEvents(s){this.fire(new o.Event("move",s)),this._zooming&&this.fire(new o.Event("zoom",s)),this._rotating&&this.fire(new o.Event("rotate",s)),this._pitching&&this.fire(new o.Event("pitch",s))}_afterEase(s,f){var y,v;this._easeId&&f&&this._easeId===f||(delete this._easeId,this.fire(new o.Event("freezeElevation",{freeze:!1})),f=this._zooming,y=this._rotating,v=this._pitching,this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,f&&this.fire(new o.Event("zoomend",s)),y&&this.fire(new o.Event("rotateend",s)),v&&this.fire(new o.Event("pitchend",s)),this.fire(new o.Event("moveend",s)))}flyTo(s,f){if(!s.essential&&g.prefersReducedMotion)return ge=o.pick(s,["center","zoom","bearing","pitch","around"]),this.jumpTo(ge,f);this.stop(),s=o.extend({offset:[0,0],speed:1.2,curve:1.42,easing:o.defaultEasing},s);const y=this._getTransformForUpdate(),v=this.getZoom(),T=this.getBearing(),P=this.getPitch(),R=this.getPadding(),N="bearing"in s?this._normalizeBearing(s.bearing,T):T,G="pitch"in s?+s.pitch:P,Z=("padding"in s?s:y).padding,j=o.Point.convert(s.offset);let X=y.centerPoint.add(j);var ge=y.pointLocation(X);const{center:ye,zoom:be}=y.getConstrained(o.LngLat.convert(s.center||ge),(ve=s.zoom)!=null?ve:v);this._normalizeCenter(ye);var ve=y.zoomScale(be-v);const Fe=y.project(ge),Ue=y.project(ye).sub(Fe);let ze=s.curve;const Qe=Math.max(y.width,y.height),Je=Qe/ve,Xe=Ue.mag(),ct=("minZoom"in s&&(ge=o.clamp(Math.min(s.minZoom,v,be),y.minZoom,y.maxZoom),ve=Qe/y.zoomScale(ge-v),ze=Math.sqrt(ve/Xe*2)),ze*ze);function it(Ct){return Ct=(Je*Je-Qe*Qe+(Ct?-1:1)*ct*ct*Xe*Xe)/(2*(Ct?Je:Qe)*ct*Xe),Math.log(Math.sqrt(Ct*Ct+1)-Ct)}function _t(Ct){return(Math.exp(Ct)-Math.exp(-Ct))/2}function Dt(Ct){return(Math.exp(Ct)+Math.exp(-Ct))/2}const Yt=it(!1);let _n=function(Ct){return Dt(Yt)/Dt(Yt+ze*Ct)},vn=function(Ct){return Qe*((Dt(Yt)*(_t(Ct=Yt+ze*Ct)/Dt(Ct))-_t(Yt))/ct)/Xe},Kt=(it(!0)-Yt)/ze;if(Math.abs(Xe)<1e-6||!isFinite(Kt)){if(Math.abs(Qe-Je)<1e-6)return this.easeTo(s,f);const Ct=Je<Qe?-1:1;Kt=Math.abs(Math.log(Je/Qe))/ze,vn=function(){return 0},_n=function(cn){return Math.exp(Ct*ze*cn)}}return"duration"in s?s.duration=+s.duration:(ge="screenSpeed"in s?+s.screenSpeed/ze:+s.speed,s.duration=1e3*Kt/ge),s.maxDuration&&s.duration>s.maxDuration&&(s.duration=0),this._zooming=!0,this._rotating=T!==N,this._pitching=G!==P,this._padding=!y.isPaddingEqual(Z),this._prepareEase(f,!1),this.terrain&&this._prepareElevation(ye),this._ease($t=>{var cn=$t*Kt,Cn=1/_n(cn),$t=(y.zoom=$t===1?be:v+y.scaleZoom(Cn),this._rotating&&(y.bearing=o.interpolate.number(T,N,$t)),this._pitching&&(y.pitch=o.interpolate.number(P,G,$t)),this._padding&&(y.interpolatePadding(R,Z,$t),X=y.centerPoint.add(j)),this.terrain&&!s.freezeElevation&&this._updateElevation($t),$t===1?ye:y.unproject(Fe.add(Ue.mult(vn(cn))).mult(Cn)));y.setLocationAtPoint(y.renderWorldCopies?$t.wrap():$t,X),this._applyUpdatedTransform(y),this._fireMoveEvents(f)},()=>{this.terrain&&this._finalizeElevation(),this._afterEase(f)},s),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(s,f){var y;return this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd&&(y=this._onEaseEnd,delete this._onEaseEnd,y.call(this,f)),s||(y=this.handlers)&&y.stop(!1),this}_ease(s,f,y){y.animate===!1||y.duration===0?(s(1),f()):(this._easeStart=g.now(),this._easeOptions=y,this._onEaseFrame=s,this._onEaseEnd=f,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(s,f){s=o.wrap(s,-180,180);var y=Math.abs(s-f);return Math.abs(s-360-f)<y&&(s-=360),Math.abs(s+360-f)<y&&(s+=360),s}_normalizeCenter(s){var f=this.transform;f.renderWorldCopies&&!f.lngRange&&(f=s.lng-f.center.lng,s.lng+=180<f?-360:f<-180?360:0)}queryTerrainElevation(s){return this.terrain?this.terrain.getElevationForLngLatZoom(o.LngLat.convert(s),this.transform.tileZoom)-this.transform.elevation:null}}const $p={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class Nd{constructor(s=$p){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=f=>{!f||f.sourceDataType!=="metadata"&&f.sourceDataType!=="visibility"&&f.dataType!=="style"&&f.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=s}getDefaultPosition(){return"bottom-right"}onAdd(s){return this._map=s,this._compact=this.options.compact,this._container=_.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=_.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=_.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){_.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(s,f){f=this._map._getUIString("AttributionControl."+f),s.title=f,s.setAttribute("aria-label",f)}_updateAttributions(){if(this._map.style){let v=[];this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?v=v.concat(this.options.customAttribution.map(T=>typeof T!="string"?"":T)):typeof this.options.customAttribution=="string"&&v.push(this.options.customAttribution)),this._map.style.stylesheet&&(y=this._map.style.stylesheet,this.styleOwner=y.owner,this.styleId=y.id);var s=this._map.style.sourceCaches;for(const T in s){var f=s[T];(f.used||f.usedForTerrain)&&(f=f.getSource()).attribution&&v.indexOf(f.attribution)<0&&v.push(f.attribution)}(v=v.filter(T=>String(T).trim())).sort((T,P)=>T.length-P.length);var y=(v=v.filter((T,P)=>{for(let R=P+1;R<v.length;R++)if(0<=v[R].indexOf(T))return!1;return!0})).join(" | ");y!==this._attribHTML&&(this._attribHTML=y,v.length?(this._innerContainer.innerHTML=y,this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}}class Wp{constructor(s={}){this._updateCompact=()=>{var f=this._container.children;f.length&&(f=f[0],this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&f.classList.add("maplibregl-compact"):f.classList.remove("maplibregl-compact"))},this.options=s}getDefaultPosition(){return"bottom-left"}onAdd(s){return this._map=s,this._compact=this.options&&this.options.compact,this._container=_.create("div","maplibregl-ctrl"),s=_.create("a","maplibregl-ctrl-logo"),s.target="_blank",s.rel="noopener nofollow",s.href="https://maplibre.org/",s.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),s.setAttribute("rel","noopener nofollow"),this._container.appendChild(s),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){_.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class Zy{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(s){var f=++this._id;return this._queue.push({callback:s,id:f,cancelled:!1}),f}remove(s){var f=this._currentlyRunning;for(const y of f?this._queue.concat(f):this._queue)if(y.id===s)return void(y.cancelled=!0)}run(s=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");var f=this._currentlyRunning=this._queue;this._queue=[];for(const y of f)if(!y.cancelled&&(y.callback(s),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var Yp=o.createLayout([{name:"a_pos3d",type:"Int16",components:3}]);class Xy extends o.Evented{constructor(s){super(),this.sourceCache=s,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.deltaZoom=1,s.usedForTerrain=!0,s.tileSize=this.tileSize*2**this.deltaZoom}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(s,f){this.sourceCache.update(s,f),this._renderableTilesKeys=[];var y={};for(const v of s.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:f}))y[v.key]=!0,this._renderableTilesKeys.push(v.key),this._tiles[v.key]||(v.posMatrix=new Float64Array(16),o.ortho(v.posMatrix,0,o.EXTENT,0,o.EXTENT,0,1),this._tiles[v.key]=new dn(v,this.tileSize));for(const v in this._tiles)y[v]||delete this._tiles[v]}freeRtt(s){for(const y in this._tiles){var f=this._tiles[y];(!s||f.tileID.equals(s)||f.tileID.isChildOf(s)||s.isChildOf(f.tileID))&&(f.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(s=>this.getTileByID(s))}getTileByID(s){return this._tiles[s]}getTerrainCoords(s){var f={};for(const G of this._renderableTilesKeys){var y,v,T,P,R,N=this._tiles[G].tileID;N.canonical.equals(s.canonical)?((y=s.clone()).posMatrix=new Float64Array(16),o.ortho(y.posMatrix,0,o.EXTENT,0,o.EXTENT,0,1),f[G]=y):N.canonical.isChildOf(s.canonical)?((y=s.clone()).posMatrix=new Float64Array(16),P=N.canonical.z-s.canonical.z,v=N.canonical.x-(N.canonical.x>>P<<P),T=N.canonical.y-(N.canonical.y>>P<<P),P=o.EXTENT>>P,o.ortho(y.posMatrix,0,P,0,P,0,1),o.translate(y.posMatrix,y.posMatrix,[-v*P,-T*P,0]),f[G]=y):s.canonical.isChildOf(N.canonical)&&((v=s.clone()).posMatrix=new Float64Array(16),T=s.canonical.z-N.canonical.z,P=s.canonical.x-(s.canonical.x>>T<<T),N=s.canonical.y-(s.canonical.y>>T<<T),R=o.EXTENT>>T,o.ortho(v.posMatrix,0,o.EXTENT,0,o.EXTENT,0,1),o.translate(v.posMatrix,v.posMatrix,[P*R,N*R,0]),o.scale(v.posMatrix,v.posMatrix,[1/2**T,1/2**T,0]),f[G]=v)}return f}getSourceTile(s,f){var y=this.sourceCache._source;let v=s.overscaledZ-this.deltaZoom;if((v=v>y.maxzoom?y.maxzoom:v)<y.minzoom)return null;this._sourceTileCache[s.key]||(this._sourceTileCache[s.key]=s.scaledTo(v).key);let T=this.sourceCache.getTileByID(this._sourceTileCache[s.key]);if((!T||!T.dem)&&f)for(;v>=y.minzoom&&(!T||!T.dem);)T=this.sourceCache.getTileByID(s.scaledTo(v--).key);return T}tilesAfterTime(s=Date.now()){return Object.values(this._tiles).filter(f=>f.timeAdded>=s)}}class Qy{constructor(s,f,y){this.painter=s,this.sourceCache=new Xy(f),this.options=y,this.exaggeration=typeof y.exaggeration=="number"?y.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(s,f,y,v=o.EXTENT){var T;return 0<=f&&f<v&&0<=y&&y<v&&(T=(T=(s=this.getTerrainData(s)).tile)==null?void 0:T.dem)?(y=[(f=o.transformMat4$1([],[f/v*o.EXTENT,y/v*o.EXTENT],s.u_terrain_matrix))[0]*T.dim,f[1]*T.dim],v=Math.floor(y[0]),s=Math.floor(y[1]),f=y[0]-v,y=y[1]-s,T.get(v,s)*(1-f)*(1-y)+T.get(v+1,s)*f*(1-y)+T.get(v,s+1)*(1-f)*y+T.get(v+1,s+1)*f*y):0}getElevationForLngLatZoom(y,v){var{tileID:y,mercatorX:v,mercatorY:T}=this._getOverscaledTileIDFromLngLatZoom(y,v);return this.getElevation(y,v%o.EXTENT,T%o.EXTENT,o.EXTENT)}getElevation(s,f,y,v=o.EXTENT){return this.getDEMElevation(s,f,y,v)*this.exaggeration}getTerrainData(s){this._emptyDemTexture||(y=this.painter.context,f=new o.RGBAImage({width:1,height:1},new Uint8Array(4)),this._emptyDepthTexture=new ue(y,f,y.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new ue(y,new o.RGBAImage({width:1,height:1}),y.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(y.gl.NEAREST,y.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=o.identity([]));var f=this.sourceCache.getSourceTile(s,!0),y=(f&&f.dem&&(!f.demTexture||f.needsTerrainPrepare)&&(y=this.painter.context,f.demTexture=this.painter.getTileTexture(f.dem.stride),f.demTexture?f.demTexture.update(f.dem.getPixels(),{premultiply:!1}):f.demTexture=new ue(y,f.dem.getPixels(),y.gl.RGBA,{premultiply:!1}),f.demTexture.bind(y.gl.NEAREST,y.gl.CLAMP_TO_EDGE),f.needsTerrainPrepare=!1),f&&f+f.tileID.key+s.key);if(y&&!this._demMatrixCache[y]){var v=this.sourceCache.sourceCache._source.maxzoom;let R=s.canonical.z-f.tileID.canonical.z;s.overscaledZ>s.canonical.z&&(s.canonical.z>=v?R=s.canonical.z-v:o.warnOnce("cannot calculate elevation if elevation maxzoom > source.maxzoom"));var v=s.canonical.x-(s.canonical.x>>R<<R),T=s.canonical.y-(s.canonical.y>>R<<R),P=o.fromScaling(new Float64Array(16),[1/(o.EXTENT<<R),1/(o.EXTENT<<R),0]);o.translate(P,P,[v*o.EXTENT,T*o.EXTENT,0]),this._demMatrixCache[s.key]={matrix:P,coord:s}}return{u_depth:2,u_terrain:3,u_terrain_dim:f&&f.dem&&f.dem.dim||1,u_terrain_matrix:y?this._demMatrixCache[s.key].matrix:this._emptyDemMatrix,u_terrain_unpack:f&&f.dem&&f.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(f&&f.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:f}}getFramebuffer(s){var f=this.painter,y=f.width/devicePixelRatio,v=f.height/devicePixelRatio;return!this._fbo||this._fbo.width===y&&this._fbo.height===v||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new ue(f.context,{width:y,height:v,data:null},f.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(f.context.gl.NEAREST,f.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new ue(f.context,{width:y,height:v,data:null},f.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(f.context.gl.NEAREST,f.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=f.context.createFramebuffer(y,v,!0,!1),this._fbo.depthAttachment.set(f.context.createRenderbuffer(f.context.gl.DEPTH_COMPONENT16,y,v))),this._fbo.colorAttachment.set((s==="coords"?this._fboCoordsTexture:this._fboDepthTexture).texture),this._fbo}getCoordsTexture(){var s=this.painter.context;if(this._coordsTexture)return this._coordsTexture;var f=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let v=0,T=0;v<this._coordsTextureSize;v++)for(let P=0;P<this._coordsTextureSize;P++,T+=4)f[T+0]=255&P,f[T+1]=255&v,f[T+2]=P>>8<<4|v>>8,f[T+3]=0;var y=new o.RGBAImage({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(f.buffer)),y=new ue(s,y,s.gl.RGBA,{premultiply:!1});return y.bind(s.gl.NEAREST,s.gl.CLAMP_TO_EDGE),this._coordsTexture=y}pointCoordinate(P){this.painter.maybeDrawDepthAndCoords(!0);var f=new Uint8Array(4),y=this.painter.context,R=y.gl,v=Math.round(P.x*this.painter.pixelRatio/devicePixelRatio),P=Math.round(P.y*this.painter.pixelRatio/devicePixelRatio),T=Math.round(this.painter.height/devicePixelRatio),v=(y.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),R.readPixels(v,T-P-1,1,1,R.RGBA,R.UNSIGNED_BYTE,f),y.bindFramebuffer.set(null),f[0]+(f[2]>>4<<8)),T=f[1]+((15&f[2])<<8),P=this.coordsIndex[255-f[3]],R=P&&this.sourceCache.getTileByID(P);return R?(y=this._coordsTextureSize,f=(1<<R.tileID.canonical.z)*y,new o.MercatorCoordinate((R.tileID.canonical.x*y+v)/f+R.tileID.wrap,(R.tileID.canonical.y*y+T)/f,this.getElevation(R.tileID,v,T,y))):null}depthAtPoint(T){var f=new Uint8Array(4),y=this.painter.context,v=y.gl,T=(y.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),v.readPixels(T.x,this.painter.height/devicePixelRatio-T.y-1,1,1,v.RGBA,v.UNSIGNED_BYTE,f),y.bindFramebuffer.set(null),(f[0]/16777216+f[1]/65536+f[2]/256+f[3])/256);return T}getTerrainMesh(){if(!this._mesh){var s=this.painter.context,f=new o.Pos3dArray,y=new o.TriangleIndexArray,v=this.meshSize,T=o.EXTENT/v,P=v*v;for(let j=0;j<=v;j++)for(let X=0;X<=v;X++)f.emplaceBack(X*T,j*T,0);for(let j=0;j<P;j+=v+1)for(let X=0;X<v;X++)y.emplaceBack(X+j,v+X+j+1,v+X+j+2),y.emplaceBack(X+j,v+X+j+2,X+j+1);var R=f.length,N=R+2*(v+1);for(const j of[0,1])for(let X=0;X<=v;X++)for(const ge of[0,1])f.emplaceBack(X*T,j*o.EXTENT,ge);for(let j=0;j<2*v;j+=2)y.emplaceBack(N+j,N+j+1,N+j+3),y.emplaceBack(N+j,N+j+3,N+j+2),y.emplaceBack(R+j,R+j+3,R+j+1),y.emplaceBack(R+j,R+j+2,R+j+3);var G=f.length,Z=G+2*(v+1);for(const j of[0,1])for(let X=0;X<=v;X++)for(const ge of[0,1])f.emplaceBack(j*o.EXTENT,X*T,ge);for(let j=0;j<2*v;j+=2)y.emplaceBack(G+j,G+j+1,G+j+3),y.emplaceBack(G+j,G+j+3,G+j+2),y.emplaceBack(Z+j,Z+j+3,Z+j+1),y.emplaceBack(Z+j,Z+j+2,Z+j+3);this._mesh={indexBuffer:s.createIndexBuffer(y),vertexBuffer:s.createVertexBuffer(f,Yp.members),segments:o.SegmentVector.simpleSegment(0,0,f.length,y.length)}}return this._mesh}getMeshFrameDelta(s){return 2*Math.PI*o.earthRadius/Math.pow(2,s)/5}getMinTileElevationForLngLatZoom(s,f){return s=this._getOverscaledTileIDFromLngLatZoom(s,f).tileID,(f=this.getMinMaxElevation(s).minElevation)!=null?f:0}getMinMaxElevation(f){var f=this.getTerrainData(f).tile,y={minElevation:null,maxElevation:null};return f&&f.dem&&(y.minElevation=f.dem.min*this.exaggeration,y.maxElevation=f.dem.max*this.exaggeration),y}_getOverscaledTileIDFromLngLatZoom(v,f){var v=o.MercatorCoordinate.fromLngLat(v.wrap()),T=(1<<f)*o.EXTENT,y=v.x*T,v=v.y*T,T=Math.floor(y/o.EXTENT),P=Math.floor(v/o.EXTENT);return{tileID:new o.OverscaledTileID(f,0,f,T,P),mercatorX:y,mercatorY:v}}}class Jy{constructor(s,f,y){this._context=s,this._size=f,this._tileSize=y,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const s of this._objects)s.texture.destroy(),s.fbo.destroy()}_createObject(s){var f=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),y=new ue(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return y.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),f.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),f.colorAttachment.set(y.texture),{id:s,fbo:f,texture:y,stamp:-1,inUse:!1}}getObjectForId(s){return this._objects[s]}useObject(s){s.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(f=>s.id!==f),this._recentlyUsed.push(s.id)}stampObject(s){s.stamp=++this._stamp}getOrCreateFreeObject(){for(const f of this._recentlyUsed)if(!this._objects[f].inUse)return this._objects[f];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");var s=this._createObject(this._objects.length);return this._objects.push(s),s}freeObject(s){s.inUse=!1}freeAllObjects(){for(const s of this._objects)this.freeObject(s)}isFull(){return!(this._objects.length<this._size)&&this._objects.some(s=>!s.inUse)===!1}}const zc={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0};class e_{constructor(s,f){this.painter=s,this.terrain=f,this.pool=new Jy(s.context,30,f.sourceCache.tileSize*f.qualityFactor)}destruct(){this.pool.destruct()}getTexture(s){return this.pool.getObjectForId(s.rtt[this._stacks.length-1].id).texture}prepareForRender(s,f){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=s._order.filter(R=>!s._layers[R].isHidden(f)),this._coordsDescendingInv={};for(const R in s.sourceCaches){this._coordsDescendingInv[R]={};for(const N of s.sourceCaches[R].getVisibleCoordinates()){var y=this.terrain.sourceCache.getTerrainCoords(N);for(const G in y)this._coordsDescendingInv[R][G]||(this._coordsDescendingInv[R][G]=[]),this._coordsDescendingInv[R][G].push(y[G])}}this._coordsDescendingInvStr={};for(const R of s._order){var v=s._layers[R],T=v.source;if(zc[v.type]&&!this._coordsDescendingInvStr[T]){this._coordsDescendingInvStr[T]={};for(const N in this._coordsDescendingInv[T])this._coordsDescendingInvStr[T][N]=this._coordsDescendingInv[T][N].map(G=>G.key).sort().join()}}for(const R of this._renderableTiles)for(const N in this._coordsDescendingInvStr){var P=this._coordsDescendingInvStr[N][R.tileID.key];P&&P!==R.rttCoords[N]&&(R.rtt=[])}}renderLayer(s){if(!s.isHidden(this.painter.transform.zoom)){var f=s.type,y=this.painter,v=this._renderableLayerIds[this._renderableLayerIds.length-1]===s.id;if(zc[f]&&(this._prevType&&zc[this._prevType]||this._stacks.push([]),this._prevType=f,this._stacks[this._stacks.length-1].push(s.id),!v))return!0;if(zc[this._prevType]||zc[f]&&v){this._prevType=f;var T=this._stacks.length-1,P=this._stacks[T]||[];for(const Z of this._renderableTiles){if(this.pool.isFull()&&(Uy(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(Z),Z.rtt[T]){var R=this.pool.getObjectForId(Z.rtt[T].id);if(R.stamp===Z.rtt[T].stamp){this.pool.useObject(R);continue}}var N=this.pool.getOrCreateFreeObject();this.pool.useObject(N),this.pool.stampObject(N),Z.rtt[T]={id:N.id,stamp:N.stamp},y.context.bindFramebuffer.set(N.fbo.framebuffer),y.context.clear({color:o.Color.transparent,stencil:0}),y.currentStencilSource=void 0;for(let j=0;j<P.length;j++){const X=y.style._layers[P[j]];var G=X.source?this._coordsDescendingInv[X.source][Z.tileID.key]:[Z.tileID];y.context.viewport.set([0,0,N.fbo.width,N.fbo.height]),y._renderTileClippingMasks(X,G),y.renderLayer(y,y.style.sourceCaches[X.source],X,G),X.source&&(Z.rttCoords[X.source]=this._coordsDescendingInvStr[X.source][Z.tileID.key])}}return Uy(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects(),zc[f]}}return!1}}const Zb={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use  + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},Xb=l,Qb={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:$p,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:o.config.MAX_TILE_CACHE_ZOOM_LEVELS,localIdeographFontFamily:"sans-serif",transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,validateStyle:!0,maxCanvasSize:[4096,4096]};ir=class extends Ky{constructor(w){if(o.PerformanceUtils.mark(o.PerformanceMarkers.create),(w=o.extend({},Qb,w)).minZoom!=null&&w.maxZoom!=null&&w.minZoom>w.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(w.minPitch!=null&&w.maxPitch!=null&&w.minPitch>w.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(w.minPitch!=null&&w.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(w.maxPitch!=null&&85<w.maxPitch)throw new Error("maxPitch must be less than or equal to 85");if(super(new Ha(w.minZoom,w.maxZoom,w.minPitch,w.maxPitch,w.renderWorldCopies),{bearingSnap:w.bearingSnap}),this._contextLost=f=>{f.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.fire(new o.Event("webglcontextlost",{originalEvent:f}))},this._contextRestored=f=>{this._setupPainter(),this.resize(),this._update(),this.fire(new o.Event("webglcontextrestored",{originalEvent:f}))},this._onMapScroll=f=>{if(f.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=w.interactive,this._maxTileCacheSize=w.maxTileCacheSize,this._maxTileCacheZoomLevels=w.maxTileCacheZoomLevels,this._failIfMajorPerformanceCaveat=w.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=w.preserveDrawingBuffer,this._antialias=w.antialias,this._trackResize=w.trackResize,this._bearingSnap=w.bearingSnap,this._refreshExpiredTiles=w.refreshExpiredTiles,this._fadeDuration=w.fadeDuration,this._crossSourceCollisions=w.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=w.collectResourceTiming,this._renderTaskQueue=new Zy,this._controls=[],this._mapId=o.uniqueId(),this._locale=o.extend({},Zb,w.locale),this._clickTolerance=w.clickTolerance,this._overridePixelRatio=w.pixelRatio,this._maxCanvasSize=w.maxCanvasSize,this.transformCameraUpdate=w.transformCameraUpdate,this._imageQueueHandle=a.addThrottleControl(()=>this.isMoving()),this._requestManager=new te(w.transformRequest),typeof w.container=="string"){if(this._container=document.getElementById(w.container),!this._container)throw new Error(`Container '${w.container}' not found.`)}else{if(!(w.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=w.container}if(w.maxBounds&&this.setMaxBounds(w.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this.on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}),this.once("idle",()=>{this._idleTriggered=!0}),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let f=!1;const y=zy(v=>{this._trackResize&&!this._removed&&this.resize(v)._update()},50);this._resizeObserver=new ResizeObserver(v=>{f?y(v):f=!0}),this._resizeObserver.observe(this._container)}this.handlers=new Yy(this,w);var s=typeof w.hash=="string"&&w.hash||void 0;this._hash=w.hash&&new fs(s).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:w.center,zoom:w.zoom,bearing:w.bearing,pitch:w.pitch}),w.bounds&&(this.resize(),this.fitBounds(w.bounds,o.extend({},w.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=w.localIdeographFontFamily,this._validateStyle=w.validateStyle,w.style&&this.setStyle(w.style,{localIdeographFontFamily:w.localIdeographFontFamily}),w.attributionControl&&this.addControl(new Nd(typeof w.attributionControl=="boolean"?void 0:w.attributionControl)),w.maplibreLogo&&this.addControl(new Wp,w.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",f=>{this._update(f.dataType==="style"),this.fire(new o.Event(f.dataType+"data",f))}),this.on("dataloading",f=>{this.fire(new o.Event(f.dataType+"dataloading",f))}),this.on("dataabort",f=>{this.fire(new o.Event("sourcedataabort",f))})}_getMapId(){return this._mapId}addControl(w,s){var f;return s===void 0&&(s=w.getDefaultPosition?w.getDefaultPosition():"top-right"),w&&w.onAdd?(f=w.onAdd(this),this._controls.push(w),w=this._controlPositions[s],s.indexOf("bottom")!==-1?w.insertBefore(f,w.firstChild):w.appendChild(f),this):this.fire(new o.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")))}removeControl(w){var s;return w&&w.onRemove?(-1<(s=this._controls.indexOf(w))&&this._controls.splice(s,1),w.onRemove(this),this):this.fire(new o.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")))}hasControl(w){return-1<this._controls.indexOf(w)}calculateCameraOptionsFromTo(w,s,f,y){return y==null&&this.terrain&&(y=this.terrain.getElevationForLngLatZoom(f,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(w,s,f,y)}resize(w){var f=this._containerDimensions(),s=f[0],f=f[1];const y=this._getClampedPixelRatio(s,f);if(this._resizeCanvas(s,f,y),this.painter.resize(s,f,y),this.painter.overLimit()){var v=this.painter.context.gl;this._maxCanvasSize=[v.drawingBufferWidth,v.drawingBufferHeight];const T=this._getClampedPixelRatio(s,f);this._resizeCanvas(s,f,T),this.painter.resize(s,f,T)}return this.transform.resize(s,f),(v=this._requestedCameraState)!=null&&v.resize(s,f),v=!this._moving,v&&(this.stop(),this.fire(new o.Event("movestart",w)).fire(new o.Event("move",w))),this.fire(new o.Event("resize",w)),v&&this.fire(new o.Event("moveend",w)),this}_getClampedPixelRatio(T,P){var{0:f,1:y}=this._maxCanvasSize,v=this.getPixelRatio(),T=T*v,P=P*v;return Math.min(f<T?f/T:1,y<P?y/P:1)*v}getPixelRatio(){var w;return(w=this._overridePixelRatio)!=null?w:devicePixelRatio}setPixelRatio(w){this._overridePixelRatio=w,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(w){return this.transform.setMaxBounds(B.convert(w)),this._update()}setMinZoom(w){if(-2<=(w=w??-2)&&w<=this.transform.maxZoom)return this.transform.minZoom=w,this._update(),this.getZoom()<w&&this.setZoom(w),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(w){if((w=w??22)>=this.transform.minZoom)return this.transform.maxZoom=w,this._update(),this.getZoom()>w&&this.setZoom(w),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(w){if((w=w??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(0<=w&&w<=this.transform.maxPitch)return this.transform.minPitch=w,this._update(),this.getPitch()<w&&this.setPitch(w),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(w){if(85<(w=w??60))throw new Error("maxPitch must be less than or equal to 85");if(w>=this.transform.minPitch)return this.transform.maxPitch=w,this._update(),this.getPitch()>w&&this.setPitch(w),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(w){return this.transform.renderWorldCopies=w,this._update()}project(w){return this.transform.locationPoint(o.LngLat.convert(w),this.style&&this.terrain)}unproject(w){return this.transform.pointLocation(o.Point.convert(w),this.terrain)}isMoving(){var w;return this._moving||((w=this.handlers)==null?void 0:w.isMoving())}isZooming(){var w;return this._zooming||((w=this.handlers)==null?void 0:w.isZooming())}isRotating(){var w;return this._rotating||((w=this.handlers)==null?void 0:w.isRotating())}_createDelegatedListener(w,s,f){if(w==="mouseenter"||w==="mouseover"){let y=!1;return{layer:s,listener:f,delegates:{mousemove:v=>{var T=this.getLayer(s)?this.queryRenderedFeatures(v.point,{layers:[s]}):[];T.length?y||(y=!0,f.call(this,new sa(w,this,v.originalEvent,{features:T}))):y=!1},mouseout:()=>{y=!1}}}}if(w!=="mouseleave"&&w!=="mouseout")return{layer:s,listener:f,delegates:{[w]:y=>{var v=this.getLayer(s)?this.queryRenderedFeatures(y.point,{layers:[s]}):[];v.length&&(y.features=v,f.call(this,y),delete y.features)}}};{let y=!1;return{layer:s,listener:f,delegates:{mousemove:v=>{(this.getLayer(s)?this.queryRenderedFeatures(v.point,{layers:[s]}):[]).length?y=!0:y&&(y=!1,f.call(this,new sa(w,this,v.originalEvent)))},mouseout:v=>{y&&(y=!1,f.call(this,new sa(w,this,v.originalEvent)))}}}}}on(w,s,f){if(f===void 0)return super.on(w,s);var y=this._createDelegatedListener(w,s,f);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[w]=this._delegatedListeners[w]||[],this._delegatedListeners[w].push(y);for(const v in y.delegates)this.on(v,y.delegates[v]);return this}once(w,s,f){if(f===void 0)return super.once(w,s);var y=this._createDelegatedListener(w,s,f);for(const v in y.delegates)this.once(v,y.delegates[v]);return this}off(w,s,f){return f===void 0?super.off(w,s):(this._delegatedListeners&&this._delegatedListeners[w]&&(y=>{var v=y[w];for(let P=0;P<v.length;P++){var T=v[P];if(T.layer===s&&T.listener===f){for(const R in T.delegates)this.off(R,T.delegates[R]);return v.splice(P,1),this}}})(this._delegatedListeners),this)}queryRenderedFeatures(w,s){if(!this.style)return[];let f;var y=w instanceof o.Point||Array.isArray(w),v=y?w:[[0,0],[this.transform.width,this.transform.height]];return s=s||(y?{}:w)||{},f=v instanceof o.Point||typeof v[0]=="number"?[o.Point.convert(v)]:(y=o.Point.convert(v[0]),w=o.Point.convert(v[1]),[y,new o.Point(w.x,y.y),w,new o.Point(y.x,w.y),y]),this.style.queryRenderedFeatures(f,s,this.transform)}querySourceFeatures(w,s){return this.style.querySourceFeatures(w,s)}setStyle(w,s){return(s=o.extend({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},s)).diff!==!1&&s.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&w?(this._diffStyle(w,s),this):(this._localIdeographFontFamily=s.localIdeographFontFamily,this._updateStyle(w,s))}setTransformRequest(w){return this._requestManager.setTransformRequest(w),this}_getUIString(w){var s=this._locale[w];if(s==null)throw new Error(`Missing UI string '${w}'`);return s}_updateStyle(w,s){var f;if(!s.transformStyle||!this.style||this.style._loaded)return f=this.style&&s.transformStyle?this.style.serialize():void 0,this.style&&(this.style.setEventedParent(null),this.style._remove(!w)),w?(this.style=new ds(this,s||{}),this.style.setEventedParent(this,{style:this.style}),typeof w=="string"?this.style.loadURL(w,s,f):this.style.loadJSON(w,s,f)):delete this.style,this;this.style.once("style.load",()=>this._updateStyle(w,s))}_lazyInitEmptyStyle(){this.style||(this.style=new ds(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(w,s){var f;typeof w=="string"?(f=this._requestManager.transformRequest(w,"Style"),o.getJSON(f,new AbortController).then(y=>{this._updateDiff(y.data,s)}).catch(y=>{y&&this.fire(new o.ErrorEvent(y))})):typeof w=="object"&&this._updateDiff(w,s)}_updateDiff(w,s){try{this.style.setState(w,s)&&this._update(!0)}catch(f){o.warnOnce(`Unable to perform style diff: ${f.message||f.error||f}.  Rebuilding the style from scratch.`),this._updateStyle(w,s)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():o.warnOnce("There is no style added to the map.")}addSource(w,s){return this._lazyInitEmptyStyle(),this.style.addSource(w,s),this._update(!0)}isSourceLoaded(w){var s=this.style&&this.style.sourceCaches[w];if(s!==void 0)return s.loaded();this.fire(new o.ErrorEvent(new Error(`There is no source with ID '${w}'`)))}setTerrain(w){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),w){var s=this.style.sourceCaches[w.source];if(!s)throw new Error("cannot load terrain, because there exists no source with ID: "+w.source);this.terrain===null&&s.reload();for(const y in this.style._layers){var f=this.style._layers[y];f.type==="hillshade"&&f.source===w.source&&o.warnOnce("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new Qy(this.painter,s,w),this.painter.renderToTexture=new e_(this.painter,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._terrainDataCallback=y=>{y.dataType==="style"?this.terrain.sourceCache.freeRtt():y.dataType==="source"&&y.tile&&(y.sourceId!==w.source||this._elevationFreeze||(this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.terrain.sourceCache.freeRtt(y.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.minElevationForCurrentTile=0,this.transform.elevation=0;return this.fire(new o.Event("terrain",{terrain:w})),this}getTerrain(){var w;return(w=(w=this.terrain)==null?void 0:w.options)!=null?w:null}areTilesLoaded(){var w=this.style&&this.style.sourceCaches;for(const y in w){var s=w[y]._tiles;for(const v in s){var f=s[v];if(f.state!=="loaded"&&f.state!=="errored")return!1}}return!0}removeSource(w){return this.style.removeSource(w),this._update(!0)}getSource(w){return this.style.getSource(w)}addImage(w,s,R={}){var y,v,T,P,{pixelRatio:R=1,sdf:N=!1,stretchX:G,stretchY:Z,content:j,contentMatch:X}=R;if(this._lazyInitEmptyStyle(),!(s instanceof HTMLImageElement||o.isImageBitmap(s)))return s.width===void 0||s.height===void 0?this.fire(new o.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`"))):({width:y,height:v,data:T}=s,P=s,this.style.addImage(w,{data:new o.RGBAImage({width:y,height:v},new Uint8Array(T)),pixelRatio:R,stretchX:G,stretchY:Z,content:j,contentMatch:X,sdf:N,version:0,userImage:P}),P.onAdd&&P.onAdd(this,w),this);({width:y,height:v,data:T}=g.getImageData(s)),this.style.addImage(w,{data:new o.RGBAImage({width:y,height:v},T),pixelRatio:R,stretchX:G,stretchY:Z,content:j,contentMatch:X,sdf:N,version:0})}updateImage(w,s){var f,y,v,T=this.style.getImage(w);return T?({width:v,height:f,data:y}=s instanceof HTMLImageElement||o.isImageBitmap(s)?g.getImageData(s):s,v===void 0||f===void 0?this.fire(new o.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`"))):v!==T.data.width||f!==T.data.height?this.fire(new o.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image"))):(v=!(s instanceof HTMLImageElement||o.isImageBitmap(s)),T.data.replace(y,v),this.style.updateImage(w,T),this)):this.fire(new o.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")))}getImage(w){return this.style.getImage(w)}hasImage(w){return w?!!this.style.getImage(w):(this.fire(new o.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(w){this.style.removeImage(w)}loadImage(w){return a.getImage(this._requestManager.transformRequest(w,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(w,s){return this._lazyInitEmptyStyle(),this.style.addLayer(w,s),this._update(!0)}moveLayer(w,s){return this.style.moveLayer(w,s),this._update(!0)}removeLayer(w){return this.style.removeLayer(w),this._update(!0)}getLayer(w){return this.style.getLayer(w)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(w,s,f){return this.style.setLayerZoomRange(w,s,f),this._update(!0)}setFilter(w,s,f={}){return this.style.setFilter(w,s,f),this._update(!0)}getFilter(w){return this.style.getFilter(w)}setPaintProperty(w,s,f,y={}){return this.style.setPaintProperty(w,s,f,y),this._update(!0)}getPaintProperty(w,s){return this.style.getPaintProperty(w,s)}setLayoutProperty(w,s,f,y={}){return this.style.setLayoutProperty(w,s,f,y),this._update(!0)}getLayoutProperty(w,s){return this.style.getLayoutProperty(w,s)}setGlyphs(w,s={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(w,s),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(w,s,f={}){return this._lazyInitEmptyStyle(),this.style.addSprite(w,s,f,y=>{y||this._update(!0)}),this}removeSprite(w){return this._lazyInitEmptyStyle(),this.style.removeSprite(w),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(w,s={}){return this._lazyInitEmptyStyle(),this.style.setSprite(w,s,f=>{f||this._update(!0)}),this}setLight(w,s={}){return this._lazyInitEmptyStyle(),this.style.setLight(w,s),this._update(!0)}getLight(){return this.style.getLight()}setFeatureState(w,s){return this.style.setFeatureState(w,s),this._update()}removeFeatureState(w,s){return this.style.removeFeatureState(w,s),this._update()}getFeatureState(w){return this.style.getFeatureState(w)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let w=0,s=0;return this._container&&(w=this._container.clientWidth||400,s=this._container.clientHeight||300),[w,s]}_setupContainer(){var w=this._container,s=(w.classList.add("maplibregl-map"),this._canvasContainer=_.create("div","maplibregl-canvas-container",w)),s=(this._interactive&&s.classList.add("maplibregl-interactive"),this._canvas=_.create("canvas","maplibregl-canvas",s),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region"),this._containerDimensions()),f=this._getClampedPixelRatio(s[0],s[1]);this._resizeCanvas(s[0],s[1],f);const y=this._controlContainer=_.create("div","maplibregl-control-container",w),v=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(T=>{v[T]=_.create("div",`maplibregl-ctrl-${T} `,y)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(w,s,f){this._canvas.width=Math.floor(f*w),this._canvas.height=Math.floor(f*s),this._canvas.style.width=w+"px",this._canvas.style.height=s+"px"}_setupPainter(){const w={alpha:!0,stencil:!0,depth:!0,failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1};let s=null;this._canvas.addEventListener("webglcontextcreationerror",v=>{s={requestedAttributes:w},v&&(s.statusMessage=v.statusMessage,s.type=v.type)},{once:!0});var f,y=this._canvas.getContext("webgl2",w)||this._canvas.getContext("webgl",w);if(!y)throw f="Failed to initialize WebGL",s?(s.message=f,new Error(JSON.stringify(s))):new Error(f);this.painter=new Hb(y,this.transform),x.testSupport(y)}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(w){return this.style&&this.style._loaded&&(this._styleDirty=this._styleDirty||w,this._sourcesDirty=!0,this.triggerRepaint()),this}_requestRenderFrame(w){return this._update(),this._renderTaskQueue.add(w)}_cancelRenderFrame(w){this._renderTaskQueue.remove(w)}_render(w){var s=this._idleTriggered?this._fadeDuration:0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(w),!this._removed){let y=!1;this.style&&this._styleDirty&&(this._styleDirty=!1,w=this.transform.zoom,f=g.now(),this.style.zoomHistory.update(w,f),(f=(w=new o.EvaluationParameters(w,{now:f,fadeDuration:s,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()})).crossFadingFactor())===1&&f===this._crossFadingFactor||(y=!0,this._crossFadingFactor=f),this.style.update(w)),this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._elevationFreeze||(this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.minElevationForCurrentTile=0,this.transform.elevation=0),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,s,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:s,showPadding:this.showPadding}),this.fire(new o.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,o.PerformanceUtils.mark(o.PerformanceMarkers.load),this.fire(new o.Event("load"))),this.style&&(this.style.hasTransitions()||y)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();var f=this._sourcesDirty||this._styleDirty||this._placementDirty;return f||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new o.Event("idle")),!this._loaded||this._fullyLoaded||f||(this._fullyLoaded=!0,o.PerformanceUtils.mark(o.PerformanceMarkers.fullLoad)),this}}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){this._hash&&this._hash.remove();for(const s of this._controls)s.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),a.removeThrottleControl(this._imageQueueHandle),(w=this._resizeObserver)!=null&&w.disconnect();var w=this.painter.context.gl.getExtension("WEBGL_lose_context");w&&w.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),_.remove(this._canvasContainer),_.remove(this._controlContainer),this._container.classList.remove("maplibregl-map"),o.PerformanceUtils.clearMetrics(),this._removed=!0,this.fire(new o.Event("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,g.frameAsync(this._frameRequest).then(w=>{o.PerformanceUtils.frame(w),this._frameRequest=null,this._render(w)}).catch(()=>{}))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(w){this._showTileBoundaries!==w&&(this._showTileBoundaries=w,this._update())}get showPadding(){return!!this._showPadding}set showPadding(w){this._showPadding!==w&&(this._showPadding=w,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(w){this._showCollisionBoxes!==w&&((this._showCollisionBoxes=w)?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(w){this._showOverdrawInspector!==w&&(this._showOverdrawInspector=w,this._update())}get repaint(){return!!this._repaint}set repaint(w){this._repaint!==w&&(this._repaint=w,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(w){this._vertices=w,this._update()}get version(){return Xb}getCameraTargetElevation(){return this.transform.elevation}};const t_=w=>{w.touchstart=w.dragStart,w.touchmoveWindow=w.dragMove,w.touchend=w.dragEnd},Jb=({enable:w,clickTolerance:s,bearingDegreesPerPixelMoved:f=.8})=>{var y=new Hy;return new Ur({clickTolerance:s,move:(v,T)=>({bearingDelta:(T.x-v.x)*f}),moveStateManager:y,enable:w,assignEvents:t_})},e1=({enable:w,clickTolerance:s,pitchDegreesPerPixelMoved:f=-.5})=>{var y=new Hy;return new Ur({clickTolerance:s,move:(v,T)=>({pitchDelta:(T.y-v.y)*f}),moveStateManager:y,enable:w,assignEvents:t_})},t1={showCompass:!0,showZoom:!0,visualizePitch:!1};class n1{constructor(s,f,y=!1){this.mousedown=P=>{this.startMouse(o.extend({},P,{ctrlKey:!0,preventDefault:()=>P.preventDefault()}),_.mousePos(this.element,P)),_.addEventListener(window,"mousemove",this.mousemove),_.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=P=>{this.moveMouse(P,_.mousePos(this.element,P))},this.mouseup=P=>{this.mouseRotate.dragEnd(P),this.mousePitch&&this.mousePitch.dragEnd(P),this.offTemp()},this.touchstart=P=>{P.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=_.touchPos(this.element,P.targetTouches)[0],this.startTouch(P,this._startPos),_.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),_.addEventListener(window,"touchend",this.touchend))},this.touchmove=P=>{P.targetTouches.length!==1?this.reset():(this._lastPos=_.touchPos(this.element,P.targetTouches)[0],this.moveTouch(P,this._lastPos))},this.touchend=P=>{P.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),this.touchRotate.reset(),this.touchPitch&&this.touchPitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10;var v=s.dragRotate._mouseRotate.getClickTolerance(),T=s.dragRotate._mousePitch.getClickTolerance();this.element=f,this.mouseRotate=Ga({clickTolerance:v,enable:!0}),this.touchRotate=Jb({clickTolerance:v,enable:!0}),this.map=s,y&&(this.mousePitch=Md({clickTolerance:T,enable:!0}),this.touchPitch=e1({clickTolerance:T,enable:!0})),_.addEventListener(f,"mousedown",this.mousedown),_.addEventListener(f,"touchstart",this.touchstart,{passive:!1}),_.addEventListener(f,"touchcancel",this.reset)}startMouse(s,f){this.mouseRotate.dragStart(s,f),this.mousePitch&&this.mousePitch.dragStart(s,f),_.disableDrag()}startTouch(s,f){this.touchRotate.dragStart(s,f),this.touchPitch&&this.touchPitch.dragStart(s,f),_.disableDrag()}moveMouse(s,f){var y=this.map,v=(this.mouseRotate.dragMove(s,f)||{}).bearingDelta;v&&y.setBearing(y.getBearing()+v),this.mousePitch&&(v=(this.mousePitch.dragMove(s,f)||{}).pitchDelta,v)&&y.setPitch(y.getPitch()+v)}moveTouch(s,f){var y=this.map,v=(this.touchRotate.dragMove(s,f)||{}).bearingDelta;v&&y.setBearing(y.getBearing()+v),this.touchPitch&&(v=(this.touchPitch.dragMove(s,f)||{}).pitchDelta,v)&&y.setPitch(y.getPitch()+v)}off(){var s=this.element;_.removeEventListener(s,"mousedown",this.mousedown),_.removeEventListener(s,"touchstart",this.touchstart,{passive:!1}),_.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),_.removeEventListener(window,"touchend",this.touchend),_.removeEventListener(s,"touchcancel",this.reset),this.offTemp()}offTemp(){_.enableDrag(),_.removeEventListener(window,"mousemove",this.mousemove),_.removeEventListener(window,"mouseup",this.mouseup),_.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),_.removeEventListener(window,"touchend",this.touchend)}}let Qu;function r1(){return o.__awaiter(this,arguments,void 0,function*(w=!1){if(Qu===void 0||w){if(window.navigator.permissions===void 0)return Qu=!!window.navigator.geolocation;try{var s=yield window.navigator.permissions.query({name:"geolocation"});Qu=s.state!=="denied"}catch{Qu=!!window.navigator.geolocation}}return Qu})}function n_(w,s,f){var y,v,T,P=new o.LngLat(w.lng,w.lat);for(w=new o.LngLat(w.lng,w.lat),s&&(y=new o.LngLat(w.lng-360,w.lat),v=new o.LngLat(w.lng+360,w.lat),T=f.locationPoint(w).distSqr(s),f.locationPoint(y).distSqr(s)<T?w=y:f.locationPoint(v).distSqr(s)<T&&(w=v));180<Math.abs(w.lng-f.center.lng);){var R=f.locationPoint(w);if(0<=R.x&&0<=R.y&&R.x<=f.width&&R.y<=f.height)break;w.lng>f.center.lng?w.lng-=360:w.lng+=360}return w.lng!==P.lng&&f.locationPoint(w).y>f.height/2-f.getHorizon()?w:P}const Kp={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function r_(w,s,f){var y=w.classList;for(const v in Kp)y.remove(`maplibregl-${f}-anchor-`+v);y.add(`maplibregl-${f}-anchor-`+s)}class i_ extends o.Evented{constructor(s){if(super(),this._onKeyPress=ye=>{var ge=ye.code,ye=ye.charCode||ye.keyCode;ge!=="Space"&&ge!=="Enter"&&ye!==32&&ye!==13||this.togglePopup()},this._onMapClick=ge=>{var ge=ge.originalEvent.target,ye=this._element;this._popup&&(ge===ye||ye.contains(ge))&&this.togglePopup()},this._update=X=>{if(this._map){var ge=this._map.loaded()&&!this._map.isMoving();(X==null?void 0:X.type)!=="terrain"&&((X==null?void 0:X.type)!=="render"||ge)||this._map.once("render",this._update),this._map.transform.renderWorldCopies?this._lngLat=n_(this._lngLat,this._flatPos,this._map.transform):this._lngLat=(ge=this._lngLat)==null?void 0:ge.wrap(),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationPoint(this._lngLat)._add(this._offset));let ye="",be=(this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?ye=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(ye=`rotateZ(${this._rotation-this._map.getBearing()}deg)`),"");this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?be="rotateX(0deg)":this._pitchAlignment==="map"&&(be=`rotateX(${this._map.getPitch()}deg)`),X&&X.type!=="moveend"||(this._pos=this._pos.round()),_.setTransform(this._element,`${Kp[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${be} `+ye),g.frameAsync(new AbortController).then(()=>{this._updateOpacity(X&&X.type==="moveend")}).catch(()=>{})}},this._onMove=X=>{var ge;this._isDragging||(ge=this._clickTolerance||this._map._clickTolerance,this._isDragging=X.point.dist(this._pointerdownPos)>=ge),this._isDragging&&(this._pos=X.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new o.Event("dragstart"))),this.fire(new o.Event("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new o.Event("dragend")),this._state="inactive"},this._addDragHandler=X=>{this._element.contains(X.originalEvent.target)&&(X.preventDefault(),this._positionDelta=X.point.sub(this._pos).add(this._offset),this._pointerdownPos=X.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=s&&s.anchor||"center",this._color=s&&s.color||"#3FB1CE",this._scale=s&&s.scale||1,this._draggable=s&&s.draggable||!1,this._clickTolerance=s&&s.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=s&&s.rotation||0,this._rotationAlignment=s&&s.rotationAlignment||"auto",this._pitchAlignment=s&&s.pitchAlignment&&s.pitchAlignment!=="auto"?s.pitchAlignment:this._rotationAlignment,this.setOpacity(),this.setOpacity(s==null?void 0:s.opacity,s==null?void 0:s.opacityWhenCovered),s&&s.element)this._element=s.element,this._offset=o.Point.convert(s&&s.offset||[0,0]);else{this._defaultMarker=!0,this._element=_.create("div"),this._element.setAttribute("aria-label","Map marker");var f=_.createNS("http://www.w3.org/2000/svg","svg"),y=(f.setAttributeNS(null,"display","block"),f.setAttributeNS(null,"height","41px"),f.setAttributeNS(null,"width","27px"),f.setAttributeNS(null,"viewBox","0 0 27 41"),_.createNS("http://www.w3.org/2000/svg","g")),y=(y.setAttributeNS(null,"stroke","none"),y.setAttributeNS(null,"stroke-width","1"),y.setAttributeNS(null,"fill","none"),y.setAttributeNS(null,"fill-rule","evenodd"),_.createNS("http://www.w3.org/2000/svg","g")),v=(y.setAttributeNS(null,"fill-rule","nonzero"),_.createNS("http://www.w3.org/2000/svg","g")),P=(v.setAttributeNS(null,"transform","translate(3.0, 29.0)"),v.setAttributeNS(null,"fill","#000000"),[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}]);for(const X of P){var T=_.createNS("http://www.w3.org/2000/svg","ellipse");T.setAttributeNS(null,"opacity","0.04"),T.setAttributeNS(null,"cx","10.5"),T.setAttributeNS(null,"cy","5.80029008"),T.setAttributeNS(null,"rx",X.rx),T.setAttributeNS(null,"ry",X.ry),v.appendChild(T)}var P=_.createNS("http://www.w3.org/2000/svg","g"),R=(P.setAttributeNS(null,"fill",this._color),_.createNS("http://www.w3.org/2000/svg","path")),R=(R.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),P.appendChild(R),_.createNS("http://www.w3.org/2000/svg","g")),N=(R.setAttributeNS(null,"opacity","0.25"),R.setAttributeNS(null,"fill","#000000"),_.createNS("http://www.w3.org/2000/svg","path")),N=(N.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),R.appendChild(N),_.createNS("http://www.w3.org/2000/svg","g")),G=(N.setAttributeNS(null,"transform","translate(6.0, 7.0)"),N.setAttributeNS(null,"fill","#FFFFFF"),_.createNS("http://www.w3.org/2000/svg","g")),Z=(G.setAttributeNS(null,"transform","translate(8.0, 8.0)"),_.createNS("http://www.w3.org/2000/svg","circle")),j=(Z.setAttributeNS(null,"fill","#000000"),Z.setAttributeNS(null,"opacity","0.25"),Z.setAttributeNS(null,"cx","5.5"),Z.setAttributeNS(null,"cy","5.5"),Z.setAttributeNS(null,"r","5.4999962"),_.createNS("http://www.w3.org/2000/svg","circle"));j.setAttributeNS(null,"fill","#FFFFFF"),j.setAttributeNS(null,"cx","5.5"),j.setAttributeNS(null,"cy","5.5"),j.setAttributeNS(null,"r","5.4999962"),G.appendChild(Z),G.appendChild(j),y.appendChild(v),y.appendChild(P),y.appendChild(R),y.appendChild(N),y.appendChild(G),f.appendChild(y),f.setAttributeNS(null,"height",41*this._scale+"px"),f.setAttributeNS(null,"width",27*this._scale+"px"),this._element.appendChild(f),this._offset=o.Point.convert(s&&s.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",X=>{X.preventDefault()}),this._element.addEventListener("mousedown",X=>{X.preventDefault()}),r_(this._element,this._anchor,"marker"),s&&s.className)for(const X of s.className.split(" "))this._element.classList.add(X);this._popup=null}addTo(s){return this.remove(),(this._map=s).getCanvasContainer().appendChild(this._element),s.on("move",this._update),s.on("moveend",this._update),s.on("terrain",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),_.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(s){return this._lngLat=o.LngLat.convert(s),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(s){var f;return this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),s&&("offset"in s.options||(f=Math.abs(13.5)/Math.SQRT2,s.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[f,-1*(24.6+f)],"bottom-right":[-f,-1*(24.6+f)],left:[13.5,-24.6],right:[-13.5,-24.6]}:this._offset),this._popup=s,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)),this}getPopup(){return this._popup}togglePopup(){var s=this._popup;return this._element.style.opacity!==this._opacityWhenCovered&&s&&(s.isOpen()?s.remove():(s.setLngLat(this._lngLat),s.addTo(this._map))),this}_updateOpacity(s=!1){if((y=this._map)!=null&&y.terrain){if(s)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout(()=>{this._opacityTimeout=null},100)}var f,y=this._map,s=y.terrain.depthAtPoint(this._pos),v=y.terrain.getElevationForLngLatZoom(this._lngLat,y.transform.tileZoom);y.transform.lngLatToCameraDepth(this._lngLat,v)-s<.006?this._element.style.opacity=this._opacity:(s=-this._offset.y/y.transform._pixelPerMeter,s=Math.sin(y.getPitch()*Math.PI/180)*s,f=y.terrain.depthAtPoint(new o.Point(this._pos.x,this._pos.y-this._offset.y)),y=.006<y.transform.lngLatToCameraDepth(this._lngLat,v+s)-f,(v=this._popup)!=null&&v.isOpen()&&y&&this._popup.remove(),this._element.style.opacity=y?this._opacityWhenCovered:this._opacity)}else this._element.style.opacity!==this._opacity&&(this._element.style.opacity=this._opacity)}getOffset(){return this._offset}setOffset(s){return this._offset=o.Point.convert(s),this._update(),this}addClassName(s){this._element.classList.add(s)}removeClassName(s){this._element.classList.remove(s)}toggleClassName(s){return this._element.classList.toggle(s)}setDraggable(s){return this._draggable=!!s,this._map&&(s?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(s){return this._rotation=s||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(s){return this._rotationAlignment=s||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(s){return this._pitchAlignment=s&&s!=="auto"?s:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(s,f){return s===void 0&&f===void 0&&(this._opacity="1",this._opacityWhenCovered="0.2"),s!==void 0&&(this._opacity=s),f!==void 0&&(this._opacityWhenCovered=f),this._map&&this._updateOpacity(!0),this}}const YT={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let Zp=0,Xp=!1;class KT extends o.Evented{constructor(s){super(),this._onSuccess=f=>{if(this._map){if(this._isOutOfMapMaxBounds(f))this._setErrorState(),this.fire(new o.Event("outofmaxbounds",f)),this._updateMarker();else{if(this.options.trackUserLocation)switch(this._lastKnownPosition=f,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error("Unexpected watchState "+this._watchState)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(f),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(f),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new o.Event("geolocate",f))}this._finish()}},this._updateCamera=y=>{var T=new o.LngLat(y.coords.longitude,y.coords.latitude),y=y.coords.accuracy,v=this._map.getBearing(),v=o.extend({bearing:v},this.options.fitBoundsOptions),T=B.fromLngLat(T,y);this._map.fitBounds(T,v,{geolocateSource:!0})},this._updateMarker=f=>{var y;f?(y=new o.LngLat(f.coords.longitude,f.coords.latitude),this._accuracyCircleMarker.setLngLat(y).addTo(this._map),this._userLocationDotMarker.setLngLat(y).addTo(this._map),this._accuracy=f.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()):(this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove())},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=f=>{if(this._map){if(this.options.trackUserLocation)if(f.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;var y=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=y,this._geolocateButton.setAttribute("aria-label",y),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(f.code===3&&Xp)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new o.Event("error",f)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=f=>{this._map&&(this._container.addEventListener("contextmenu",y=>y.preventDefault()),this._geolocateButton=_.create("button","maplibregl-ctrl-geolocate",this._container),_.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),!(this._geolocateButton.type="button")===f?(o.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled."),f=this._map._getUIString("GeolocateControl.LocationNotAvailable"),this._geolocateButton.disabled=!0,this._geolocateButton.title=f,this._geolocateButton.setAttribute("aria-label",f)):(f=this._map._getUIString("GeolocateControl.FindMyLocation"),this._geolocateButton.title=f,this._geolocateButton.setAttribute("aria-label",f)),this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=_.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new i_({element:this._dotElement}),this._circleElement=_.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new i_({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",()=>this.trigger()),this._setup=!0,this.options.trackUserLocation)&&this._map.on("movestart",y=>{var v=y.originalEvent&&y.originalEvent.type==="resize";y.geolocateSource||this._watchState!=="ACTIVE_LOCK"||v||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new o.Event("trackuserlocationend")))})},this.options=o.extend({},YT,s)}onAdd(s){return this._map=s,this._container=_.create("div","maplibregl-ctrl maplibregl-ctrl-group"),r1().then(f=>this._setupUI(f)),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),_.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,Zp=0,Xp=!1}_isOutOfMapMaxBounds(y){var f=this._map.getMaxBounds(),y=y.coords;return f&&(y.longitude<f.getWest()||y.longitude>f.getEast()||y.latitude<f.getSouth()||y.latitude>f.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error("Unexpected watchState "+this._watchState)}}_updateCircleRadius(){var s=this._map.getBounds(),f=s.getSouthEast(),s=s.getNorthEast(),f=f.distanceTo(s),s=this._map._container.clientHeight,f=Math.ceil(this._accuracy/(f/s)*2);this._circleElement.style.width=f+"px",this._circleElement.style.height=f+"px"}trigger(){if(!this._setup)return o.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new o.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":Zp--,Xp=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new o.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new o.Event("trackuserlocationstart"));break;default:throw new Error("Unexpected watchState "+this._watchState)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error("Unexpected watchState "+this._watchState)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),Zp++;let s;Xp=1<Zp?(s={maximumAge:6e5,timeout:0},!0):(s=this.options.positionOptions,!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,s)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}}const Ju={maxWidth:100,unit:"metric"};function i1(w,s,f){var y=f&&f.maxWidth||100,v=w._container.clientHeight/2,T=w.unproject([0,v]),v=w.unproject([y,v]),T=T.distanceTo(v);f&&f.unit==="imperial"?5280<(v=3.2808*T)?Dd(s,y,v/5280,w._getUIString("ScaleControl.Miles")):Dd(s,y,v,w._getUIString("ScaleControl.Feet")):f&&f.unit==="nautical"?Dd(s,y,T/1852,w._getUIString("ScaleControl.NauticalMiles")):1e3<=T?Dd(s,y,T/1e3,w._getUIString("ScaleControl.Kilometers")):Dd(s,y,T,w._getUIString("ScaleControl.Meters"))}function Dd(w,s,f,y){var v=function(T){var P=Math.pow(10,(""+Math.floor(T)).length-1);return T/=P,T=10<=T?10:5<=T?5:3<=T?3:2<=T?2:1<=T?1:function(R){var N=Math.pow(10,Math.ceil(-Math.log(R)/Math.LN10));return Math.round(R*N)/N}(T),P*T}(f);w.style.width=s*(v/f)+"px",w.innerHTML=v+"&nbsp;"+y}class ZT extends o.Evented{constructor(s={}){super(),this._onFullscreenChange=()=>{var f;let y=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;(f=y==null?void 0:y.shadowRoot)!=null&&f.fullscreenElement;)y=y.shadowRoot.fullscreenElement;y===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,s&&s.container&&(s.container instanceof HTMLElement?this._container=s.container:o.warnOnce("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(s){return this._map=s,this._container||(this._container=this._map.getContainer()),this._controlContainer=_.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){_.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){var s=this._fullscreenButton=_.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);_.create("span","maplibregl-ctrl-icon",s).setAttribute("aria-hidden","true"),s.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){var s=this._getTitle();this._fullscreenButton.setAttribute("aria-label",s),this._fullscreenButton.title=s}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new o.Event("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new o.Event("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}}const o1={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1},XT=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");class eh extends o.Evented{constructor(s){super(),this.remove=()=>(this._content&&_.remove(this._content),this._container&&(_.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new o.Event("close"))),this),this._onMouseUp=f=>{this._update(f.point)},this._onMouseMove=f=>{this._update(f.point)},this._onDrag=f=>{this._update(f.point)},this._update=f=>{var y=this._lngLat||this._trackPointer;if(this._map&&y&&this._content){if(!this._container){if(this._container=_.create("div","maplibregl-popup",this._map.getContainer()),this._tip=_.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const P of this.options.className.split(" "))this._container.classList.add(P);this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer?this._lngLat=n_(this._lngLat,this._flatPos,this._map.transform):this._lngLat=(y=this._lngLat)==null?void 0:y.wrap(),!this._trackPointer||f){y=this._flatPos=this._pos=this._trackPointer&&f?f:this._map.project(this._lngLat),this._map.terrain&&(this._flatPos=this._trackPointer&&f?f:this._map.transform.locationPoint(this._lngLat));let P=this.options.anchor;if(f=Qp(this.options.offset),!P){var v=this._container.offsetWidth,T=this._container.offsetHeight;let N;N=y.y+f.bottom.y<T?["top"]:y.y>this._map.transform.height-T?["bottom"]:[],y.x<v/2?N.push("left"):y.x>this._map.transform.width-v/2&&N.push("right"),P=N.length===0?"bottom":N.join("-")}let R=y.add(f[P]);this.options.subpixelPositioning||(R=R.round()),_.setTransform(this._container,`${Kp[P]} translate(${R.x}px,${R.y}px)`),r_(this._container,P,"popup")}}},this._onClose=()=>{this.remove()},this.options=o.extend(Object.create(o1),s)}addTo(s){return this._map&&this.remove(),this._map=s,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new o.Event("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(s){return this._lngLat=o.LngLat.convert(s),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(s){return this.setDOMContent(document.createTextNode(s))}setHTML(s){var f,y=document.createDocumentFragment(),v=document.createElement("body");for(v.innerHTML=s;f=v.firstChild;)y.appendChild(f);return this.setDOMContent(y)}getMaxWidth(){var s;return(s=this._container)==null?void 0:s.style.maxWidth}setMaxWidth(s){return this.options.maxWidth=s,this._update(),this}setDOMContent(s){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=_.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(s),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(s){this._container&&this._container.classList.add(s)}removeClassName(s){this._container&&this._container.classList.remove(s)}setOffset(s){return this.options.offset=s,this._update(),this}toggleClassName(s){if(this._container)return this._container.classList.toggle(s)}setSubpixelPositioning(s){this.options.subpixelPositioning=s}_createCloseButton(){this.options.closeButton&&(this._closeButton=_.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){var s;this.options.focusAfterOpen&&this._container&&(s=this._container.querySelector(XT))&&s.focus()}}function Qp(w){var s;return w?typeof w=="number"?(s=Math.round(Math.abs(w)/Math.SQRT2),{center:new o.Point(0,0),top:new o.Point(0,w),"top-left":new o.Point(s,s),"top-right":new o.Point(-s,s),bottom:new o.Point(0,-w),"bottom-left":new o.Point(s,-s),"bottom-right":new o.Point(-s,-s),left:new o.Point(w,0),right:new o.Point(-w,0)}):w instanceof o.Point||Array.isArray(w)?{center:s=o.Point.convert(w),top:s,"top-left":s,"top-right":s,bottom:s,"bottom-left":s,"bottom-right":s,left:s,right:s}:{center:o.Point.convert(w.center||[0,0]),top:o.Point.convert(w.top||[0,0]),"top-left":o.Point.convert(w["top-left"]||[0,0]),"top-right":o.Point.convert(w["top-right"]||[0,0]),bottom:o.Point.convert(w.bottom||[0,0]),"bottom-left":o.Point.convert(w["bottom-left"]||[0,0]),"bottom-right":o.Point.convert(w["bottom-right"]||[0,0]),left:o.Point.convert(w.left||[0,0]),right:o.Point.convert(w.right||[0,0])}:Qp(new o.Point(0,0))}const QT=l;i.AJAXError=o.AJAXError,i.Evented=o.Evented,i.LngLat=o.LngLat,i.MercatorCoordinate=o.MercatorCoordinate,i.Point=o.Point,i.addProtocol=o.addProtocol,i.config=o.config,i.removeProtocol=o.removeProtocol,i.AttributionControl=Nd,i.BoxZoomHandler=$b,i.CanvasSource=Et,i.CooperativeGesturesHandler=qp,i.DoubleClickZoomHandler=Od,i.DragPanHandler=Hp,i.DragRotateHandler=Zu,i.EdgeInsets=Cd,i.FullscreenControl=ZT,i.GeoJSONSource=q,i.GeolocateControl=KT,i.Hash=fs,i.ImageSource=Pe,i.KeyboardHandler=fi,i.LngLatBounds=B,i.LogoControl=Wp,i.Map=ir,i.MapMouseEvent=sa,i.MapTouchEvent=gc,i.MapWheelEvent=Yu,i.Marker=i_,i.NavigationControl=class{constructor(w){this._updateZoomButtons=()=>{var f=this._map.getZoom(),s=f===this._map.getMaxZoom(),f=f===this._map.getMinZoom();this._zoomInButton.disabled=s,this._zoomOutButton.disabled=f,this._zoomInButton.setAttribute("aria-disabled",s.toString()),this._zoomOutButton.setAttribute("aria-disabled",f.toString())},this._rotateCompassArrow=()=>{var s=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=s},this._setButtonTitle=(s,f)=>{f=this._map._getUIString("NavigationControl."+f),s.title=f,s.setAttribute("aria-label",f)},this.options=o.extend({},t1,w),this._container=_.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",s=>s.preventDefault()),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",s=>this._map.zoomIn({},{originalEvent:s})),_.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",s=>this._map.zoomOut({},{originalEvent:s})),_.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",s=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:s}):this._map.resetNorth({},{originalEvent:s})}),this._compassIcon=_.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(w){return this._map=w,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new n1(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){_.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(w,s){return w=_.create("button",w,this._container),w.type="button",w.addEventListener("click",s),w}},i.Popup=eh,i.RasterDEMTileSource=ae,i.RasterTileSource=Q,i.ScaleControl=class{constructor(w){this._onMove=()=>{i1(this._map,this._container,this.options)},this.setUnit=s=>{this.options.unit=s,i1(this._map,this._container,this.options)},this.options=o.extend({},Ju,w)}getDefaultPosition(){return"bottom-left"}onAdd(w){return this._map=w,this._container=_.create("div","maplibregl-ctrl maplibregl-ctrl-scale",w.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){_.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},i.ScrollZoomHandler=Ku,i.Style=ds,i.TerrainControl=class{constructor(w){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=w}onAdd(w){return this._map=w,this._container=_.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=_.create("button","maplibregl-ctrl-terrain",this._container),_.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){_.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},i.TwoFingersTouchPitchHandler=Kb,i.TwoFingersTouchRotateHandler=Rd,i.TwoFingersTouchZoomHandler=Vp,i.TwoFingersTouchZoomRotateHandler=Gp,i.VectorTileSource=F,i.VideoSource=rt,i.addSourceType=(w,s)=>o.__awaiter(void 0,void 0,void 0,function*(){if(an(w))throw new Error(`A source type called "${w}" already exists.`);var f,y;f=w,y=s,Bt[f]=y}),i.clearPrewarmedResources=function(){var w=Ge;w&&(w.isPreloaded()&&w.numActive()===1?(w.release(hn),Ge=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},i.getMaxParallelImageRequests=function(){return o.config.MAX_PARALLEL_IMAGE_REQUESTS},i.getRTLTextPluginStatus=function(){return qt().getRTLTextPluginStatus()},i.getVersion=function(){return QT},i.getWorkerCount=function(){return wt.workerCount},i.getWorkerUrl=function(){return o.config.WORKER_URL},i.importScriptInWorkers=function(w){return Mn().broadcast("IS",w)},i.prewarm=function(){Gn().acquire(hn)},i.setMaxParallelImageRequests=function(w){o.config.MAX_PARALLEL_IMAGE_REQUESTS=w},i.setRTLTextPlugin=function(w,s){return qt().setRTLTextPlugin(w,s)},i.setWorkerCount=function(w){wt.workerCount=w},i.setWorkerUrl=function(w){o.config.WORKER_URL=w}}),e},ID.exports=n()}(),ID.exports),as=dd(qoe);function $oe(n){throw new Error('Could not dynamically require "'+n+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var li,PD={exports:{}},Woe={},Yoe=Object.freeze({__proto__:null,default:Woe}),Koe=Goe(Yoe),Zoe=(function(n){for(var e,t,r=0,i=[],o=0;o<256;o++)i[o]=(o+256).toString(16).substr(1);function a(){h=16,(!e||l.BUFFER_SIZE<r+h)&&(r=0,e=l.randomBytes(l.BUFFER_SIZE));var h=e.slice(r,r+=h);return h[6]=15&h[6]|64,h[8]=63&h[8]|128,h}function l(){var h=a();return i[h[0]]+i[h[1]]+i[h[2]]+i[h[3]]+"-"+i[h[4]]+i[h[5]]+"-"+i[h[6]]+i[h[7]]+"-"+i[h[8]]+i[h[9]]+"-"+i[h[10]]+i[h[11]]+i[h[12]]+i[h[13]]+i[h[14]]+i[h[15]]}l.BUFFER_SIZE=4096,l.bin=a,l.clearBuffer=function(){e=null,r=0},l.test=function(h){return typeof h=="string"&&/^[0-9a-f]{8}-[0-9a-f]{4}-4[0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(h)},typeof crypto<"u"?t=crypto:typeof window<"u"&&window.msCrypto!==void 0&&(t=window.msCrypto),typeof $oe=="function"?(t=t||Koe,n.exports=l):typeof window<"u"&&(window.uuid=l),l.randomBytes=function(){if(t){if(t.randomBytes)return t.randomBytes;if(t.getRandomValues)return typeof Uint8Array.prototype.slice!="function"?function(h){return h=new Uint8Array(h),t.getRandomValues(h),Array.from(h)}:function(h){return h=new Uint8Array(h),t.getRandomValues(h),h}}return function(h){for(var p=[],g=0;g<h;g++)p.push(Math.floor(256*Math.random()));return p}}()}(PD),PD.exports),qf=dd(Zoe),Rc={domain:"atlas.microsoft.com",staticAssetsDomain:"atlas.microsoft.com",stylePath:"styling",styleDefinitionsVersion:"2023-01-01",appInsightsKey:"e96cb745-c6f5-409c-a775-c4313e468c1d",aadInstance:"https://login.microsoftonline.com/"},Nn={apiVersionQueryParameter:"api-version",authorizationHeaderName:"Authorization",authorizationTokenPrefix:"Bearer ",jwtSasPrefix:"jwt-sas ",domainPlaceHolder:"{{azMapsDomain}}",legacyDomainPlaceHolder:"{azMapsDomain}",viewPlaceHolder:"{{azMapsView}}",viewParameter:"view",languagePlaceHolder:"{{azMapsLanguage}}",stylePathHolder:"{{azMapsStylingPath}}",styleResourcePlaceholder:"{{azMapsStylePath}}",stylePath:"styling",styleResourcePath:"styles",styleApiVersion:"2.0",mapAgentHeaderName:"Map-Agent",msClientIdHeaderName:"x-ms-client-id",msOriginHeaderName:"Ms-Am-Request-Origin",msOriginHeaderValue:"MapControl",aadResourceId:"https://atlas.microsoft.com/.default",sessionIdHeaderName:"Session-Id"},Xoe=window&&window.__values||function(n){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&n[e],r=0;if(t)return t.call(n);if(n&&typeof n.length=="number")return{next:function(){return{value:(n=n&&r>=n.length?void 0:n)&&n[r++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},wi=function(){function n(){}return n.prototype.merge=function(){for(var e,t,r,i=[],o=0;o<arguments.length;o++)i[o]=arguments[o];try{for(var a=Xoe(i),l=a.next();!l.done;l=a.next()){var h=l.value;if(h)for(var p in h)h.hasOwnProperty(p)&&this.hasOwnProperty(p)&&(h[p]!==void 0&&h[p]!=null?this[p]instanceof n?this[p].merge(h[p]):this[p]=h[p]:(r=r||new(Object.getPrototypeOf(this)).constructor,this[p]=r[p]))}}catch(g){e={error:g}}finally{try{l&&!l.done&&(t=a.return)&&t.call(a)}finally{if(e)throw e.error}}return this},n}(),Qoe=window&&window.__extends||function(){var n=function(e,t){return(n=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(r,i){r.__proto__=i}:function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])}))(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),Joe=window&&window.__read||function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var r,i,o=t.call(n),a=[];try{for(;(e===void 0||0<e--)&&!(r=o.next()).done;)a.push(r.value)}catch(l){i={error:l}}finally{try{r&&!r.done&&(t=o.return)&&t.call(o)}finally{if(i)throw i.error}}return a},eae=function(n){function e(){var t=n!==null&&n.apply(this,arguments)||this;return t.domain=void 0,t.headers={},t.path="",t.protocol="https",t.queryParams={},t.subdomain="",t}return Qoe(e,n),e}(wi),vl=function(){function n(e){this.options=new eae().merge(e)}return n.prototype.get=function(){return fetch(this.toString(),{method:"GET",mode:"cors",headers:new Headers(this.options.headers)}).then(function(e){if(e.ok)return e.json();throw new Error("HTTP ".concat(e.status,": ").concat(e.statusText))})},n.prototype.toString=function(){var e=Object.entries(this.options.queryParams).map(function(a){var a=Joe(a,2),o=a[0],a=a[1];return"".concat(o,"=").concat(a)}).join("&"),t=[],r=this.options.path||"";return n.protoRegEx.test(r)?t.push(r):(this.options.domain&&(n.protoRegEx.test(this.options.domain)||(t.push("".concat(this.options.protocol,"://")),t.push(this.options.subdomain?"".concat(this.options.subdomain,"."):"")),t.push(this.options.domain)),t.push(this.options.path?"/".concat(r):"")),t.push(e?"?".concat(e):""),t.join("")},n.protoRegEx=new RegExp(/^(((file|http|https):\/\/)|blob:)/i),n}(),MD=function(){function n(){}return n.parse=function(e){var t=(e=e.toLowerCase()).lastIndexOf("-");return t!==-1?{code:e,language:e.substring(0,t),region:e.substring(t+1)}:{code:e,language:e}},n}(),ph={localizationsPath:"locs/mapcontrol/2019-3-12",sensitiveUserRegions:["il","kr","pk","in","cn","ar","bh","eg","jo","sa","kw","om","qa","ma","ae"],locales:{defaultLanguage:{defaultRegion:{code:"NGT",strings:"en/resource.json"},latn:{code:"NGT-Latn",strings:"en/resource.json"}},ar:{defaultRegion:{code:"ar",strings:"ar-sa/resource.json"}},bg:{defaultRegion:{code:"bg-BG",strings:"bg-bg/resource.json"}},cs:{defaultRegion:{code:"cs-CZ",strings:"cs-cz/resource.json"}},da:{defaultRegion:{code:"da-DK",strings:"da-dk/resource.json"}},de:{defaultRegion:{code:"de-DE",strings:"de-de/resource.json"}},el:{defaultRegion:{code:"el-GR",strings:"el-gr/resource.json"}},en:{defaultRegion:{code:"en",strings:"en/resource.json"},us:{code:"en-US",strings:"en/resource.json"},au:{code:"en-AU",strings:"en/resource.json"},gb:{code:"en-GB",strings:"en/resource.json"},nz:{code:"en-NZ",strings:"en/resource.json"}},es:{defaultRegion:{code:"es-ES",strings:"es-es/resource.json"},mx:{code:"es-MX",strings:"es-mx/resource.json"}},fi:{defaultRegion:{code:"fi-FI",strings:"fi-fi/resource.json"}},fr:{defaultRegion:{code:"fr-FR",strings:"fr-fr/resource.json"}},hu:{defaultRegion:{code:"hu-HU",strings:"hu-hu/resource.json"}},id:{defaultRegion:{code:"id-ID",strings:"id-id/resource.json"}},it:{defaultRegion:{code:"it-IT",strings:"it-it/resource.json"}},ko:{defaultRegion:{code:"ko-KR",strings:"ko-kr/resource.json"}},lt:{defaultRegion:{code:"lt-LT",strings:"lt-lt/resource.json"}},ms:{defaultRegion:{code:"ms-MY",strings:"ms-my/resource.json"}},nb:{defaultRegion:{code:"nb-NO",strings:"nb-no/resource.json"}},nl:{defaultRegion:{code:"nl-NL",strings:"nl-nl/resource.json"}},pl:{defaultRegion:{code:"pl-PL",strings:"pl-pl/resource.json"}},pt:{defaultRegion:{code:"pt-PT",strings:"pt-pt/resource.json"},br:{code:"pt-BR",strings:"pt-br/resource.json"}},ru:{defaultRegion:{code:"ru-RU",strings:"ru-ru/resource.json"}},sk:{defaultRegion:{code:"sk-SK",strings:"sk-sk/resource.json"}},sl:{defaultRegion:{code:"sl-SL",strings:"sl-sl/resource.json"}},sv:{defaultRegion:{code:"sv-SE",strings:"sv-se/resource.json"}},th:{defaultRegion:{code:"th-TH",strings:"th-th/resource.json"}},tr:{defaultRegion:{code:"tr-TR",strings:"tr-tr/resource.json"}},zh:{defaultRegion:{code:"zh",strings:"en/resource.json"}},"zh-hans":{defaultRegion:{code:"zh-Hans",strings:"zh-cn/resource.json"},cn:{code:"zh-Hans-CN",strings:"zh-cn/resource.json"}},"zh-hant":{defaultRegion:{code:"zh-Hant",strings:"en/resource.json"},tw:{code:"zh-Hant-TW",strings:"zh-tw/resource.json"}}}},RD=function(){this.Unknown="Unknown",this.Accident="Accident",this.Fog="Fog",this.Danger="Danger",this.Rain="Rain",this.Ice="Ice",this.Jam="Jam",this.LaneClosed="Lane Closed",this.RoadClosed="Road Closed",this.RoadWorks="Road Works",this.Wind="Wind",this.Flood="Flood",this.Detour="Detour"},Lx=function(){function n(){}return n.getCode=function(e){var t=MD.parse(e);return ph.sensitiveUserRegions.indexOf(t.region)===-1?this.getLocaleData(t).code:e},n.getStrings=function(e){return e=this.getLocaleData(e),ph.locales.defaultLanguage.defaultRegion.code===e.code?new Promise(function(t){t(new RD)}):new vl({domain:Rc.staticAssetsDomain,path:"".concat(ph.localizationsPath,"/").concat(e.strings)}).get().then(function(t){return t},function(){return new RD})},n.getLocaleData=function(e){if(typeof e=="string"&&(e=MD.parse(e)),ph.locales[e.code])return ph.locales[e.code].defaultRegion;var t;if(ph.locales[e.language])t=ph.locales[e.language];else{if(e.language.indexOf("-")!==-1)return this.getLocaleData(e.language);t=ph.locales.defaultLanguage}return e.region&&t[e.region]?t[e.region]:t.defaultRegion},n}(),tae=function(){function n(){}return n.getEdgeOrIEVersion=function(){var e=window.navigator.userAgent,t=e.indexOf("MSIE ");return 0<t?parseInt(e.substring(t+5,e.indexOf(".",t)),10):0<e.indexOf("Trident/")?(t=e.indexOf("rv:"),parseInt(e.substring(t+3,e.indexOf(".",t)),10)):0<(t=e.indexOf("Edge/"))?parseInt(e.substring(t+5,e.indexOf(".",t)),10):-1},n.isEdgeOrIE=function(){return this.getEdgeOrIEVersion()!==-1},n.isIE=function(){var e=this.getEdgeOrIEVersion();return e!==-1&&e<=11},n}(),kh="3.4.0",lT=function(){function n(){}return n.getFullVersion=function(){return kh},n.getEndpointVersion=function(){var e=kh.indexOf(".");return(e=kh.indexOf(".",e+1))===-1?kh:kh.substring(0,e)},n}(),nae=window&&window.__extends||function(){var n=function(e,t){return(n=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(r,i){r.__proto__=i}:function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])}))(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),rae=window&&window.__read||function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var r,i,o=t.call(n),a=[];try{for(;(e===void 0||0<e--)&&!(r=o.next()).done;)a.push(r.value)}catch(l){i={error:l}}finally{try{r&&!r.done&&(t=o.return)&&t.call(o)}finally{if(i)throw i.error}}return a},iae=window&&window.__spreadArray||function(n,e,t){if(t||arguments.length===2)for(var r,i=0,o=e.length;i<o;i++)!r&&i in e||((r=r||Array.prototype.slice.call(e,0,i))[i]=e[i]);return n.concat(r||Array.prototype.slice.call(e))},$U=(function(n){n.subscriptionKey="subscriptionKey",n.aad="aad",n.anonymous="anonymous",n.sas="sas"}(li=li||{}),function(n){function e(){var t=n!==null&&n.apply(this,arguments)||this;return t.authType=void 0,t.subscriptionKey=void 0,t.clientId=void 0,t.aadAppId=void 0,t.aadTenant=void 0,t.aadInstance=void 0,t.getToken=void 0,t.sasToken=void 0,t.authContext=void 0,t}return nae(e,n),e.prototype.setSubscriptionKey=function(t){this.authType=li.subscriptionKey,this.subscriptionKey=t},e.prototype.setAadProperties=function(t,r,i,o,a){this.authType=li.aad,this.authContext=a||this.authContext,this.aadInstance=o||this.aadInstance,this.clientId=t,this.aadAppId=r,this.aadTenant=i},e.prototype.setTokenCallbackFunction=function(t){this.authType=li.anonymous,this.getToken=t},e.prototype.setSasCallbackFunction=function(t){this.authType=li.sas,this.getToken=t},e.prototype.merge=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var i=n.prototype.merge.apply(this,iae([],rae(t),!1));return i.authType===li.subscriptionKey?i.authContext=i.aadAppId=i.getToken=void 0:i.authType===li.aad?i.subscriptionKey=i.getToken=void 0:i.authType===li.anonymous?i.subscriptionKey=i.authContext=i.aadAppId=void 0:i.authType===li.sas&&(i.authContext=i.subscriptionKey=i.aadAppId=void 0),i},e}(wi)),aI=GM;function GM(n){return!oae(n)}function oae(n){return aae()?sae()?cae()?lae()?uae()?hae()?dae()?fae()?pae()?gae(n&&n.failIfMajorPerformanceCaveat)?_ae()?void 0:"insufficient ECMAScript 6 support":"insufficient WebGL support":"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support":"not a browser"}function aae(){return typeof window<"u"&&typeof document<"u"}function sae(){return Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray}function cae(){return Function.prototype&&Function.prototype.bind}function lae(){return Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions}function uae(){return"JSON"in window&&"parse"in JSON&&"stringify"in JSON}function hae(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var n,e,t=new Blob([""],{type:"text/javascript"}),t=URL.createObjectURL(t);try{e=new Worker(t),n=!0}catch{n=!1}return e&&e.terminate(),URL.revokeObjectURL(t),n}function dae(){return"Uint8ClampedArray"in window}function fae(){return ArrayBuffer.isView}function pae(){var n=document.createElement("canvas"),e=(n.width=n.height=1,n.getContext("2d"));return!!e&&(e=e.getImageData(0,0,1,1))&&e.width===n.width}var uT,kC={};function gae(n){return kC[n]===void 0&&(kC[n]=yae(n)),kC[n]}function mae(n){var e=document.createElement("canvas"),t=Object.create(GM.webGLContextAttributes);return t.failIfMajorPerformanceCaveat=n,e.getContext("webgl",t)||e.getContext("experimental-webgl",t)}function yae(t){var e,t=mae(t);if(!t)return!1;try{e=t.createShader(t.VERTEX_SHADER)}catch{return!1}return!(!e||t.isContextLost())&&(t.shaderSource(e,"void main() {}"),t.compileShader(e),t.getShaderParameter(e,t.COMPILE_STATUS)===!0)}function _ae(){return!document.documentMode}GM.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};var WU="NGT",YU=qf(),KU=Rc.domain,vae=Rc.staticAssetsDomain,ZU=Rc.stylePath,XU=Rc.styleDefinitionsVersion,QU=Nn.styleApiVersion,ey=new $U,qM=!1,JU=!1,e8=!1,t8=!1,n8=!1,r8=!1,i8=!1,o8=!1,$M=!1;function a8(){return Object.assign({},ey)}function s8(){return vae}function Nx(){return KU}function c8(){return ZU}function l8(){return XU}function u8(){return QU}function h8(){return as.getWorkerCount()}function d8(){return as.getMaxParallelImageRequests()}function f8(){return WU}function p8(){return YU}function g8(){return ey.authType===li.subscriptionKey?ey.subscriptionKey:void 0}function bae(){return uT}function m8(){return uT}function wae(){return lT.getFullVersion()}function xae(n){var e=!tae.isIE();return e=e&&aI({failIfMajorPerformanceCaveat:n})&&document.createElement("canvas").getContext("webgl2")!==null}function y8(n){ey=new $U().merge(ey,n),$M=!0}function _8(n){KU=n,JU=!0}function v8(n){ZU=n,e8=!0}function Eae(n){XU=n,t8=!0}function Tae(n){QU=n}function b8(n){0<n&&(as.setWorkerCount(n),n8=!0)}function w8(n){0<n&&(as.setMaxParallelImageRequests(n),r8=!0)}function x8(n){WU=Lx.getCode(n),i8=!0}function E8(n){YU=n,o8=!0}function T8(n){ey.setSubscriptionKey(n),$M=!0}function S8(n){uT=n,qM=!0}function Sae(n){uT=n,qM=!0}function Cae(n,e,t){!t&&M0[n.toLowerCase()]||(M0[n.toLowerCase()]=e)}function C8(n,e){if(e=Math.abs(e||1),typeof n=="string"&&M0[n.toLowerCase()]){for(var t=M0[n.toLowerCase()],r=/calc\(([0-9.]+)[px]*\s*\*\s*\{scale\}\)/gi,i=t,o=r.exec(t);o;)i=i.replace(o[0],parseFloat(o[1])*e+""),o=r.exec(t);return i=i.replace("{scale}",e+"")}throw new Error("Invalid templateName.")}function Aae(){return Object.keys(M0)}function Iae(){as.prewarm()}function Pae(){as.clearPrewarmedResources()}function Mae(n,e){as.addProtocol(n,e)}function Rae(n){as.removeProtocol(n)}function sI(){return $M}function A8(){return JU}function I8(){return e8}function kae(){return t8}function P8(){return n8}function M8(){return r8}function R8(){return i8}function k8(){return o8}function O8(){return qM}function Oae(){return Rc.domain}function Lae(){return Nx()}function kD(){var n=new vl({domain:Rc.staticAssetsDomain,path:"sdk/javascript/mapcontrol/".concat(lT.getEndpointVersion(),"/mapbox-gl-rtl-text.min.js")});as.setRTLTextPlugin(n.toString(),!0).catch(function(e){e&&console.warn(e)})}var Fa,Jo,M0={marker:'<svg xmlns="http://www.w3.org/2000/svg" width="calc(27 * {scale})" height="calc(39 * {scale})" viewBox="-1 -1 26 38"><path d="M12.25.25a12.254 12.254 0 0 0-12 12.494c0 6.444 6.488 12.109 11.059 22.564.549 1.256 1.333 1.256 1.882 0C17.762 24.853 24.25 19.186 24.25 12.744A12.254 12.254 0 0 0 12.25.25Z" style="fill:{color};stroke:{secondaryColor};stroke-width:1"/><text x="12.5" y="17.5" style="font-size:14px;fill:#fff;text-anchor:middle">{text}</text></svg>',"marker-thick":'<svg xmlns="http://www.w3.org/2000/svg" width="calc(28 * {scale})" height="calc(39 * {scale})" viewBox="-1 -1 27 38"><path d="M12.25.25a12.254 12.254 0 0 0-12 12.494c0 6.444 6.488 12.109 11.059 22.564.549 1.256 1.333 1.256 1.882 0C17.762 24.853 24.25 19.186 24.25 12.744A12.254 12.254 0 0 0 12.25.25Z" style="fill:{color};stroke:{secondaryColor};stroke-width:2"/><text x="12.5" y="18.5" style="font-size:14px;fill:#fff;text-anchor:middle">{text}</text></svg>',"marker-circle":'<svg xmlns="http://www.w3.org/2000/svg" width="calc(28 * {scale})" height="calc(39 * {scale})" viewBox="-1 -1 27 38"><path d="M12.25.25a12.254 12.254 0 0 0-12 12.494c0 6.444 6.488 12.109 11.059 22.564.549 1.256 1.333 1.256 1.882 0C17.762 24.853 24.25 19.186 24.25 12.744A12.254 12.254 0 0 0 12.25.25Z" style="fill:{color};stroke:{secondaryColor};stroke-width:1"/><circle cx="12.5" cy="12.5" r="9" fill="{secondaryColor}"/><text x="12" y="17.5" style="font-size:14px;fill:#000;text-anchor:middle">{text}</text></svg>',pin:'<svg xmlns="http://www.w3.org/2000/svg" width="calc(24 * {scale})" height="calc(28 * {scale})" viewBox="0 0 24 28"><path d="m11.988 16.615a5.15 5.15 0 0 1-2.268-.525 4.909 4.909 0 0 1-2.805-4.442 5.019 5.019 0 0 1 5.072-4.936h.012a5.03 5.03 0 0 1 5.085 4.961 4.907 4.907 0 0 1-.549 2.224 5.114 5.114 0 0 1-4.548 2.718zm0-8.06a3.173 3.173 0 0 0-3.226 3.099 3.081 3.081 0 0 0 1.77 2.782 3.299 3.299 0 0 0 4.365-1.386 3.049 3.049 0 0 0 .342-1.381 3.184 3.184 0 0 0-3.239-3.114h-.012z" fill="{secondaryColor}"/><path d="m11.999.922a10.908 10.908 0 0 0-11.076 10.732 10.639 10.639 0 0 0 4.418 8.598l6.658 6.464 6.658-6.463a10.537 10.537 0 0 0 2.198-15.041 11.182 11.182 0 0 0-8.856-4.289zm1.873 14.341a4.221 4.221 0 0 1-5.589-1.789 3.945 3.945 0 0 1-.445-1.8 4.164 4.164 0 0 1 8.323-.037 4.028 4.028 0 0 1-2.289 3.626Z" fill="{color}"/><path d="m11.999 28-7.256-7.044a11.611 11.611 0 0 1-4.743-9.303 11.844 11.844 0 0 1 11.988-11.652.102 .102 0 0 1 .02 0 12.164 12.164 0 0 1 9.577 4.647 11.357 11.357 0 0 1 2.299 8.614 11.521 11.521 0 0 1-4.63 7.695zm-.01-26.157a9.997 9.997 0 0 0-10.143 9.812 9.769 9.769 0 0 0 4.04 7.853l.099.083 6.014 5.838 6.113-5.922a9.7 9.7 0 0 0 3.945-6.505 9.533 9.533 0 0 0-1.933-7.229 10.305 10.305 0 0 0-8.116-3.931h-.021zm.021 14.772a5.11 5.11 0 0 1-4.547-2.718 4.868 4.868 0 0 1 .932-5.743 5.118 5.118 0 0 1 3.58-1.46h.024a5.031 5.031 0 0 1 5.084 4.938 4.92 4.92 0 0 1-2.805 4.457h0a5.152 5.152 0 0 1-2.269.525zm-.011-8.079h-.015a3.277 3.277 0 0 0-2.295.933 3.029 3.029 0 0 0-.587 3.58 3.297 3.297 0 0 0 4.364 1.386h0a3.092 3.092 0 0 0 1.772-2.795 3.185 3.185 0 0 0-3.239-3.105z" fill="{secondaryColor}"/><text x="12" y="17" style="font-size:14px;fill:#000;text-anchor:middle">{text}</text></svg>',"pin-round":'<svg xmlns="http://www.w3.org/2000/svg" width="calc(25 * {scale})" height="calc(25 * {scale})" viewBox="0 0 25 25"><g transform="translate(0 1)"><circle cx="12.25" cy="11.5833" r="11" fill="{color}"/><path d="m12.25 23.583a12 12 0 1 1 12-12 12 12 0 0 1-12 12zm0-22a10 10 0 1 0 10 10 10 10 0 0 0-10-10z" fill="{secondaryColor}"/><circle cx="12.25" cy="11.5833" r="4.2386" fill="{secondaryColor}"/></g><text x="12.5" y="17" style="font-size:14px;fill:#000;text-anchor:middle">{text}</text></svg>',"marker-flat":'<svg xmlns="http://www.w3.org/2000/svg" width="calc(27 * {scale})" height="calc(42.8 * {scale})"  viewBox="0 0 1600 2570"><g fill="{color}"><path d="M691 2419c-409-575-641-1086-683-1504-10-106-10-136 5-224 31-188 105-330 241-458 129-124 270-190 453-214 69-9 113-10 182-1 373 46 655 326 703 698 40 308-120 801-424 1309-134 224-348 535-369 535-4 0-53-63-108-141z"/></g><g fill="rgba(0,0,0,0.15)" style="transform:scale(-1,1);transform-origin:center"><path d="M691 2419c-407-571-639-1083-682-1498-14-139-3-249 37-371 69-208 254-402 459-481 68-27 217-59 271-59h24v160 180 940 635c0 349-2 635-5 635-2 0-49-63-104-141z"/></g><circle cx="800" cy="800" r="600" fill="{secondaryColor}"/><text x="800" y="1100" style="font-size:800px;fill:#000;text-anchor:middle">{text}</text></svg>',"marker-arrow":'<svg xmlns="http://www.w3.org/2000/svg" width="calc(25.47 * {scale})" height="calc(35.18 * {scale})" viewBox="0 0 4330 5980"><g fill="{color}"><path d="m2080 5969c-49-20-93-63-115-113-25-55-1928-5486-1953-5573-40-138 67-282 210-283 36 0 246 73 987 345 518 190 947 345 955 345 8 0 438-155 955-345 615-226 954-345 979-345 87 0 165 47 204 123 46 91 107-95-957 2942-537 1535-986 2805-997 2823-11 18-43 46-72 62-41 24-62 30-111 29-33 0-71-5-85-10z"/></g><g fill="{secondaryColor}"><path d="m2200 1600c-36 10-83 2-484-84-243-53-451-94-461-91-11 4-22 18-25 31-5 19 114 371 436 1292 244 697 448 1273 454 1281 19 24 50 30 71 12z"/><path d="m2200 1600c-36 10-83 2-484-84-243-53-451-94-461-91-11 4-22 18-25 31-5 19 114 371 436 1292 244 697 448 1273 454 1281 19 24 50 30 71 12z" style="transform:scale(-1,1);transform-origin:center"/></g><g fill="rgba(0,0,0,0.2)" ><path d="m2165 685c8 0 438-155 955-345 615-226 954-345 979-345 87 0 165 47 204 123 46 91 107-95-957 2942-537 1535-986 2805-997 2823-11 18-43 46-72 62-41 24-62 30-111 29z"/></g><text x="2165" y="3300" style="font-size:2500px;fill:#fff;text-anchor:middle">{text}</text></svg>',"marker-ball-pin":'<svg xmlns="http://www.w3.org/2000/svg" width="calc(15.67 * {scale})" height="calc(33.33 * {scale})" viewBox="0 0 235 452"><g transform="translate(-135 10)"><path fill="{secondaryColor}" d="m256 442 0 0c-13 0-18-11-18-24l-6-323c0-13 11-24 24-24h0c13 0 24 11 24 24l-6 323c0 13-5 24-18 24z"/><circle style="fill:{color};stroke-width:10;stroke:{secondaryColor}" cx="256" cy="112" r="111"/><ellipse transform="matrix(0.834 0.5518 -0.5518 0.834 65.7916 -97.18)" fill="rgba(255,255,255,0.3)" cx="194.399" cy="60.749" rx="19.076" ry="32.428"/></g><text x="117.5" y="160" style="font-size:160px;fill:#fff;text-anchor:middle">{text}</text></svg>',"marker-square":'<svg xmlns="http://www.w3.org/2000/svg" width="calc(26.67 * {scale})" height="calc(32.27 * {scale})" viewBox="0 0 2000 2420"><g transform="translate(100 100)" style="stroke:{secondaryColor};stroke-width:100;fill:{color}"><path d="M845 2152c-22-37-58-95-80-129-22-35-62-99-90-143l-50-80-312 0-313 0 0-900 0-900 900 0 900 0 0 900 0 900-313 0-313 0-34 58c-19 31-38 59-42 60-5 2-8 8-8 12 0 9-69 123-88 145-5 6-11 15-13 21-16 39-77 123-89 124-8 0-33-31-55-68z"/></g><text x="1000" y="1300" style="font-size:1000px;fill:#fff;text-anchor:middle">{text}</text></svg>',"marker-square-cluster":'<svg xmlns="http://www.w3.org/2000/svg" width="calc(33.33 * {scale})" height="calc(38.8 * {scale})" viewBox="0 0 2500 2910"><g transform="translate(100 100)" style="stroke:{secondaryColor};stroke-width:100;fill:{color}"><path d="m866 2652c-17-31-37-68-46-82-9-14-32-54-51-90-19-36-50-92-70-125l-36-60-332-3-331-2 0-905 0-905 660 0 660 0 0-38c0-71 50-196 102-258 71-85 189-164 244-164 12 0 26-4 29-10 8-13 222-13 230 0 3 6 17 10 30 10 25 0 117 45 154 76 130 107 191 232 191 392 0 155-63 284-190 386-36 29-129 76-150 76-11 0-22 5-25 10-3 6-31 10-61 10l-54 0 0 660 0 660-332 2-332 3-29 50c-17 28-48 84-70 125-22 41-47 86-56 100-9 14-30 51-46 83-17 32-36 57-45 57-8 0-28-25-44-58z"/></g><text x="1650" y="900" style="font-size:1000px;fill:#fff">+</text><text x="1000" y="1800" style="font-size:1000px;fill:#fff;text-anchor:middle">{text}</text></svg>',"marker-square-rounded":'<svg xmlns="http://www.w3.org/2000/svg" width="calc(26.8 * {scale})" height="calc(32.27 * {scale})" viewBox="0 0 2010 2410"><g transform="translate(100 100)" style="stroke:{secondaryColor};stroke-width:100;fill:{color}"><path d="M856 2155c-20-30-36-59-36-65 0-5-4-10-10-10-5 0-10-5-10-11 0-5-18-37-40-69-22-32-40-64-40-69 0-6-4-11-10-11-5 0-10-5-10-10 0-6-15-33-32-60l-33-50-127 0c-74 0-129-4-133-10-3-5-17-10-30-10-25 0-116-45-155-76-87-69-142-151-178-265-15-46-17-1075-2-1084 5-3 10-17 10-30 0-13 5-27 10-30 6-3 10-13 10-22 0-22 83-135 122-168 57-46 62-50 112-75l50-25 585 0 586 0 63 34c84 46 169 133 212 218l35 68 0 565 0 565-28 59c-32 69-100 157-139 180-15 9-33 22-40 29-23 22-99 57-123 57-13 0-27 5-30 10-4 6-60 10-135 10l-128 0-128 205c-84 136-133 205-144 205-10 0-33-24-54-55z"/></g><text x="1000" y="1300" style="font-size:1000px;fill:#fff;text-anchor:middle">{text}</text></svg>',"marker-square-rounded-cluster":'<svg xmlns="http://www.w3.org/2000/svg" width="calc(33.33 * {scale})" height="calc(32.13 * {scale})" viewBox="0 0 2500 2900"><g transform="translate(100 100)" style="stroke:{secondaryColor};stroke-width:100;fill:{color}"><path d="m874 2669c-9-18-26-49-37-68-11-20-30-55-43-78-13-24-36-64-51-90-14-27-38-69-52-95l-26-48-142 0c-84 0-144-4-148-10-3-5-17-10-30-10-25 0-118-46-154-76-91-76-136-142-175-254-13-38-16-119-16-554 0-358 3-520 12-545 40-125 106-219 195-278 127-84 116-83 646-83l467 0 0-42c0-46 11-87 45-163 54-121 169-220 306-264 46-14 232-14 278 0 165 53 284 175 340 350 19 61 14 204-10 273-32 91-94 178-169 240-38 31-130 76-155 76-13 0-27 5-30 10-3 6-28 10-56 10l-49 0 0 462c0 446-1 464-21 522-32 91-94 178-169 240-38 31-130 76-155 76-13 0-27 5-30 10-4 6-65 10-149 10-138 0-143 1-154 23-12 23-62 114-112 202-16 28-44 79-63 115-42 77-67 88-93 39z"/></g><text x="1650" y="900" style="font-size:1000px;fill:#fff">+</text><text x="1000" y="1800" style="font-size:1000px;fill:#fff;text-anchor:middle">{text}</text></svg>',flag:'<svg xmlns="http://www.w3.org/2000/svg" width="calc(23.5 * {scale})" height="calc(40 * {scale})" viewBox="34 28 198 308"><path style="stroke:{secondaryColor};stroke-width:15;stroke-linecap:round;" d="M42 327l0 -291"/><path style="fill:{color};stroke:{secondaryColor};stroke-width:10;stroke-linejoin:round;" d="M49 50c70 30 104 28 178 2-21 42-21 74 0 116-72 25-101 25-178 0l0-118z"/><text x="130" y="165" style="font-size:100px;fill:#fff;text-anchor:middle">{text}</text></svg>',"flag-triangle":'<svg xmlns="http://www.w3.org/2000/svg" width="calc(27 * {scale})" height="calc(35.33 * {scale})" viewBox="0 0 40.5 53"><g transform="translate(-31 -20)"><path fill="{secondaryColor}" d="M34.7,73.3V48.4l34.6-10.1c0.7-0.2,1.2-0.8,1.2-1.5s-0.4-1.4-1-1.7L33.7,20.5c-0.5-0.2-1.1-0.2-1.6,0.2 c-0.5,0.3-0.7,0.8-0.7,1.4v51.2H34.7z"/><polygon points="34.7,24.5 66,36.5 34.7,45 34.7,10" fill="{color}"/></g><text x="11" y="21" style="font-size:14px;fill:#fff;text-anchor:middle">{text}</text></svg>',"rounded-square":'<svg xmlns="http://www.w3.org/2000/svg" width="calc(34 * {scale})" height="calc(34 * {scale})" viewBox="0 0 34 34"><g transform="translate(2 2)"><rect x="0" y="0" rx="8" ry="8" width="30" height="30" style="stroke:{secondaryColor};stroke-width:2;fill:{color}"/></g><text x="17" y="22" style="font-size:14px;fill:#fff;text-anchor:middle">{text}</text></svg>',"rounded-square-thick":'<svg xmlns="http://www.w3.org/2000/svg" width="calc(38 * {scale})" height="calc(38 * {scale})" viewBox="0 0 38 38"><g transform="translate(4 4)"><rect x="0" y="0" rx="8" ry="8" width="30" height="30" style="stroke:{secondaryColor};stroke-width:4;fill:{color}"/></g><text x="19" y="24" style="font-size:14px;fill:#fff;text-anchor:middle">{text}</text></svg>',triangle:'<svg xmlns="http://www.w3.org/2000/svg" width="calc(36 * {scale})" height="calc(36 * {scale})" viewBox="0 0 36 36"><g transform="translate(2 2)"><polygon points="16,0 32,32 0,32 16,0" style="stroke:{secondaryColor};stroke-width:2;fill:{color}"/></g><text x="17.5" y="30" style="font-size:12px;fill:#fff;text-anchor:middle">{text}</text></svg>',"triangle-thick":'<svg xmlns="http://www.w3.org/2000/svg" width="calc(40 * {scale})" height="calc(40 * {scale})" viewBox="0 0 40 40"><g transform="translate(4 4)"><polygon points="16,0 32,32 0,32 16,0" style="stroke:{secondaryColor};stroke-width:4;fill:{color}"/></g><text x="19.5" y="32" style="font-size:12px;fill:#fff;text-anchor:middle">{text}</text></svg>',hexagon:'<svg xmlns="http://www.w3.org/2000/svg" width="calc(35 * {scale})" height="calc(40 * {scale})" viewBox="0 0 35 40"><g transform="translate(2 2)"><path d="M31 9 15.5 0 0 9 0 27 15.5 36 31 27 31 9Z" style="stroke:{secondaryColor};stroke-width:2;fill:{color}"/></g><text x="17.5" y="25" style="font-size:14px;fill:#fff;text-anchor:middle">{text}</text></svg>',"hexagon-thick":'<svg xmlns="http://www.w3.org/2000/svg" width="calc(39 * {scale})" height="calc(44 * {scale})" viewBox="0 0 39 44"><g transform="translate(4 4)"><path d="M31 9 15.5 0 0 9 0 27 15.5 36 31 27 31 9Z" style="stroke:{secondaryColor};stroke-width:4;fill:{color}"/></g><text x="19.5" y="27" style="font-size:14px;fill:#fff;text-anchor:middle">{text}</text></svg>',"hexagon-rounded":'<svg xmlns="http://www.w3.org/2000/svg" width="calc(40 * {scale})" height="calc(40 * {scale})" viewBox="0 0 1100 1100"><g transform="translate(50 50)"><path style="stroke:{secondaryColor};stroke-width:50;fill:{color}" d="M881 210 561 25c-33-19-88-19-121 0L119 210c-33 19-61 67-61 105v370c0 39 27 86 61 105l321 185c33 19 88 19 122 0l321-185c33-19 61-67 61-105V315C942 276 915 229 881 210z"/></g><text x="550" y="700" style="font-size:400px;fill:#fff;text-anchor:middle">{text}</text></svg>',"hexagon-rounded-thick":'<svg xmlns="http://www.w3.org/2000/svg" width="calc(40 * {scale})" height="calc(40 * {scale})" viewBox="0 0 1200 1200"><g transform="translate(100 100)"><path style="stroke:{secondaryColor};stroke-width:100;fill:{color}" d="M881 210 561 25c-33-19-88-19-121 0L119 210c-33 19-61 67-61 105v370c0 39 27 86 61 105l321 185c33 19 88 19 122 0l321-185c33-19 61-67 61-105V315C942 276 915 229 881 210z"/></g><text x="600" y="750" style="font-size:400px;fill:#fff;text-anchor:middle">{text}</text></svg>',"triangle-arrow-up":'<svg xmlns="http://www.w3.org/2000/svg" width="calc(28 * {scale})" height="calc(28 * {scale})" viewBox="0 0 28 28"><g transform="translate(2 2)"><polygon points="12,0 0,24 12,17 24,24" stroke-width="2" stroke="{secondaryColor}" fill="{color}"/></g><text x="14" y="17" style="font-size:8px;fill:#fff;text-anchor:middle">{text}</text></svg>',"triangle-arrow-left":'<svg xmlns="http://www.w3.org/2000/svg" width="calc(28 * {scale})" height="calc(28 * {scale})" viewBox="0 0 28 28"><g transform="translate(2 2)"><polygon points="24,12 0,0 7,12 0,24" stroke-width="2" stroke="{secondaryColor}" fill="{color}"/></g><text x="14" y="16.5" style="font-size:8px;fill:#fff;text-anchor:middle">{text}</text></svg>',"arrow-up":'<svg xmlns="http://www.w3.org/2000/svg" width="calc(12.16 * {scale})" height="calc(30.1 * {scale})" viewBox="0 0 902 364"><g fill="{color}" transform="matrix(0,2.4,-2.4,0,897,-930)"><polygon points="902,222 233,222 233,364 0,182 233,0 233,141 902,141 902,222"/></g><text x="450" y="700" style="font-size:900px;fill:#000;text-anchor:middle">{text}</text></svg>',"arrow-up-thin":'<svg xmlns="http://www.w3.org/2000/svg" width="calc(16 * {scale})" height="calc(33.33 * {scale})" viewBox="0 0 12 25"><g transform="translate(-136.91823 -751.91998)"><path fill="{color}" d="m148.271 760.71c-1.641-.547-3.186-1.47-4.633-2.769l0 18.07-1.675 0 0-18.07c-1.447 1.299-2.986 2.222-4.616 2.769l0-1.231c2.325-1.596 4.006-3.812 5.043-6.65l.838 0c1.037 2.838 2.718 5.055 5.043 6.65l0 1.231z"/></g><text x="6" y="20" style="font-size:10px;fill:#000;text-anchor:middle">{text}</text></svg>',car:'<svg xmlns="http://www.w3.org/2000/svg" width="calc(21.93 * {scale})" height="calc(40.9 * {scale})" viewBox="0 0 6580 12270"><g transform="translate(0 12270) rotate(-90)"><path fill="{secondaryColor}" d="M7045 6566c-42-13-105-44-105-51 0-2 23-105 50-228 28-123 50-230 50-236 0-8-241-11-907-11-855 0-1145 6-1513 30-85 6-189 13-230 15-41 3-133 10-205 15-286 21-430 32-705 50-953 63-1459 18-2335-205-304-77-746-209-799-238-131-72-221-408-285-1062-34-345-42-532-48-1130-16-1557 108-2532 336-2649 32-17 469-149 676-205 409-110 819-191 1205-238 116-14 224-18 540-18 395 1 494 5 1140 50 1124 79 1224 82 2496 78l641-3-53-237c-29-131-52-238-51-239 1-1 31-14 66-29 56-23 76-26 142-23 67 3 83 7 120 33 23 17 50 41 61 55 10 14 51 117 91 230l73 205 674 3 675 2 90-39c98-43 198-72 315-93 122-21 829-18 990 5 321 45 626 143 849 270 293 168 516 378 704 662 266 402 416 893 467 1527 15 174 8 882-9 998-6 41-18 127-27 190-69 502-253 969-523 1325-79 105-262 284-381 374-189 142-355 229-574 300-336 110-526 139-952 148-457 9-685-23-887-124l-47-24-678-6-678-6-64 179c-79 224-92 253-121 284-67 70-177 97-274 66zm-2752-5073c-23-2-64-2-90 0-26 2-7 3 42 3 50 0 71-1 48-3zm395 0c-21-2-55-2-75 0-21 2-4 4 37 4 41 0 58-2 38-4z"/><path fill="{color}" d="M7043 6498c-13-6-23-19-23-28 0-9 23-117 50-240 28-123 50-230 50-237 0-22-2126-13-2465 10-132 10-400 28-595 42-661 47-824 55-1160 62-435 7-656-8-1040-73-415-70-865-183-1447-365-168-53-272-556-325-1569-16-319-16-1311 0-1630 45-872 129-1366 257-1518 22-26 51-39 172-77 557-177 1122-310 1563-369 271-36 351-40 690-40 361 1 463 6 1165 54 1122 78 1288 83 2337 79 460-2 840-7 843-11 4-4-17-117-47-252l-55-245 39-16c76-30 180-8 224 47 10 13 54 124 98 246l79 222 709 0 709 0 47-24c74-37 219-83 322-101 122-22 606-32 802-16 374 29 658 102 933 238 124 62 271 155 361 230l61 51 6 100c19 278 103 497 247 643 88 89 173 136 278 152l70 11 41 131c116 369 159 673 168 1170 10 584-38 984-167 1397l-40 126-70 12c-193 33-348 175-441 405-56 139-89 302-89 445 0 43-3 47-58 91-290 235-644 384-1068 450-191 29-796 39-974 16-135-18-263-54-368-102l-75-35-701 0-701 0-79 223c-82 232-102 267-163 293-38 16-138 17-170 2zm-2023-820c332-15 1155-12 1835 6 308 8 563 12 566 8 4-4 10-21 13-38 7-30 6-31-92-77-518-244-1197-396-2112-474-295-25-1282-25-1579 0-231 20-473 46-479 51-6 7 49 110 93 171 160 226 416 335 855 365 142 10 539 5 900-12zm3304-263c525-111 899-887 934-1935 19-557-37-1023-172-1435-186-563-521-900-896-899-81 0-158 14-525 92-426 91-431 92-540 146-195 96-287 207-306 368-12 104-11 2985 1 3078 22 170 135 291 365 389 49 21 191 55 480 115 226 47 419 87 430 89 45 10 164 6 229-8zm-5570-485c112-43 197-156 216-291 12-83 13-2623 1-2706-23-158-125-273-270-304-44-9-100-1-542 75-272 47-514 91-539 98-266 68-487 424-594 958-56 280-70 548-40 800 56 484 207 878 414 1081 115 114 122 116 702 218 277 49 524 90 550 90 26 1 72-8 102-19zm2111-3440c1023-44 1884-213 2462-486l113-53-7-33c-3-18-8-35-10-37-2-3-236 1-521 7-993 24-1271 26-1708 11-541-18-1128-18-1249-1-377 56-588 181-734 437-32 55-41 79-32 84 12 8 246 32 491 51 356 28 815 36 1195 20z"/></g><text x="3250" y="8250" style="font-size:3000px;fill:#fff;text-anchor:middle">{text}</text></svg>',checker:'<svg xmlns="http://www.w3.org/2000/svg" width="calc(16 * {scale})" height="calc(16 * {scale})" viewBox="0 0 16 16"><pattern id="p" x="0" y="0" width="16" height="16" patternUnits="userSpaceOnUse"><rect fill="{color}" x="0" width="8" height="8" y="0"/><rect fill="{color}" x="8" width="8" height="8" y="8"/></pattern><rect x="0" y="0" width="16" height="16" fill="{secondaryColor}"/><rect x="0" y="0" width="16" height="16" fill="url(#p)"/></svg>',"checker-rotated":'<svg xmlns="http://www.w3.org/2000/svg" width="calc(16 * {scale})" height="calc(16 * {scale})" viewBox="0 0 60 60"><rect width="60" height="60" fill="{secondaryColor}"/><rect width="42.42" height="42.42" transform="translate(30 0) rotate(45)" fill="{color}"/></svg>',"zig-zag":'<svg xmlns="http://www.w3.org/2000/svg" width="calc(15 * {scale})" height="calc(15 * {scale})" viewBox="0 0 120 120"><rect x="0" y="0" width="120" height="120" fill="{secondaryColor}"/><polygon fill="{color}" points="120 120 60 120 90 90 120 60 120 0 120 0 60 60 0 0 0 60 30 90 60 120 120 120"/></svg>',"zig-zag-vertical":'<svg xmlns="http://www.w3.org/2000/svg" width="calc(15 * {scale})" height="calc(15 * {scale})" viewBox="0 0 120 120"><rect x="0" y="0" width="120" height="120" fill="{secondaryColor}"/><polygon fill="{color}" points="120 0 120 60 90 30 60 0 0 0 0 0 60 60 0 120 60 120 90 90 120 60 120 0"/></svg>',"circles-spaced":'<svg xmlns="http://www.w3.org/2000/svg" width="calc(20 * {scale})" height="calc(20 * {scale})" viewBox="0 0 20 20"><defs><pattern id="p" x="0" y="0" width="20" height="20" patternUnits="userSpaceOnUse"><circle cx="10" cy="10" r="2" stroke="none" fill="{color}"/></pattern></defs><rect x="0" y="0" width="20" height="20" fill="{secondaryColor}"/><rect x="0" y="0" width="100" height="100" fill="url(#p)"/></svg>',circles:'<svg xmlns="http://www.w3.org/2000/svg" width="calc(7 * {scale})" height="calc(7 * {scale})" viewBox="0 0 20 20"><defs><pattern id="p" x="0" y="0" width="20" height="20" patternUnits="userSpaceOnUse"><circle cx="10" cy="10" r="6" stroke="none" fill="{color}"/></pattern></defs><rect x="0" y="0" width="20" height="20" fill="{secondaryColor}"/><rect x="0" y="0" width="100" height="100" fill="url(#p)"/></svg>',"diagonal-lines-up":'<svg xmlns="http://www.w3.org/2000/svg" width="calc(18 * {scale})" height="calc(18 * {scale})" viewBox="0 0 6 6"><rect x="0" y="0" width="6" height="6" fill="{secondaryColor}"/><g fill="{color}"><path d="M5 0h1L0 6V5zM6 5v1H5z"/></g></svg>',"diagonal-lines-down":'<svg xmlns="http://www.w3.org/2000/svg" width="calc(18 * {scale})" height="calc(18 * {scale})" viewBox="0 0 6 6"><rect x="0" y="0" width="6" height="6" fill="{secondaryColor}"/><g transform="rotate(90 3 3)" fill="{color}"><path d="M5 0h1L0 6V5zM6 5v1H5z"/></g></svg>',"diagonal-stripes-up":'<svg xmlns="http://www.w3.org/2000/svg" width="calc(20 * {scale})" height="calc(20 * {scale})" viewBox="0 0 40 40"><rect x="0" y="0" width="40" height="40" fill="{secondaryColor}"/><g fill="{color}"><path d="M0 40L40 0H20L0 20M40 40V20L20 40"/></g></svg>',"diagonal-stripes-down":'<svg xmlns="http://www.w3.org/2000/svg" width="calc(20 * {scale})" height="calc(20 * {scale})" viewBox="0 0 40 40"><rect x="0" y="0" width="40" height="40" fill="{secondaryColor}"/><g transform="rotate(90 20 20)" fill="{color}"><path d="M0 40L40 0H20L0 20M40 40V20L20 40"/></g></svg>',"grid-lines":'<svg xmlns="http://www.w3.org/2000/svg" width="calc(14 * {scale})" height="calc(14 * {scale})" viewBox="0 0 6 6"><rect x="0" y="0" width="6" height="6" fill="{secondaryColor}"/><g transform="rotate(45 3 3)" fill="{color}"><path d="M5 0h1L0 6V5zM6 5v1H5z"/></g><g fill="{color}" transform="rotate(-45 3 3)"><path d="M5 0h1L0 6V5zM6 5v1H5z"/></g></svg>',"rotated-grid-lines":'<svg xmlns="http://www.w3.org/2000/svg" width="calc(18 * {scale})" height="calc(18 * {scale})" viewBox="0 0 6 6"><rect x="0" y="0" width="6" height="6" fill="{secondaryColor}"/><g transform="rotate(90 3 3)" fill="{color}"><path d="M5 0h1L0 6V5zM6 5v1H5z"/></g><g fill="{color}"><path d="M5 0h1L0 6V5zM6 5v1H5z"/></g></svg>',"rotated-grid-stripes":'<svg xmlns="http://www.w3.org/2000/svg" width="calc(20 * {scale})" height="calc(20 * {scale})" viewBox="0 0 40 40"><rect x="0" y="0" width="40" height="40" fill="{secondaryColor}"/><g transform="rotate(90 20 20)" fill="{color}"><path d="M0 40L40 0H20L0 20M40 40V20L20 40"/></g><g fill="{color}"><path d="M0 40L40 0H20L0 20M40 40V20L20 40"/></g></svg>',"x-fill":'<svg xmlns="http://www.w3.org/2000/svg" width="calc(40 * {scale})" height="calc(40 * {scale})" viewBox="0 0 40 40"><rect x="0" y="0" width="45.3" height="45.3" fill="{secondaryColor}"/><g fill="{color}"><path d="M0 38.59l2.83-2.83 1.41 1.41L1.41 40H0v-1.41zM0 1.4l2.83 2.83 1.41-1.41L1.41 0H0v1.41zM38.59 40l-2.83-2.83 1.41-1.41L40 38.59V40h-1.41zM40 1.41l-2.83 2.83-1.41-1.41L38.59 0H40v1.41zM20 18.6l2.83-2.83 1.41 1.41L21.41 20l2.83 2.83-1.41 1.41L20 21.41l-2.83 2.83-1.41-1.41L18.59 20l-2.83-2.83 1.41-1.41L20 18.59z"/></g></svg>',dots:'<svg xmlns="http://www.w3.org/2000/svg" width="calc(13 * {scale})" height="calc(13 * {scale})" viewBox="0 0 20 20"><rect x="0" y="0" width="20" height="20" fill="{secondaryColor}"/><g fill="{color}"><circle cx="3" cy="3" r="3"/><circle cx="13" cy="13" r="3"/></g></svg>'},OC=4,ea=function(n){var e=document.createElement("span");return e.innerText=n,e.classList.add("tooltiptext"),navigator.userAgent.indexOf("Edg")!=-1?e.classList.add("edge"):navigator.userAgent.indexOf("Chrome")!=-1?e.classList.add("chrome"):navigator.userAgent.indexOf("Safari")!=-1?e.classList.add("safari"):navigator.userAgent.indexOf("Firefox")!=-1&&e.classList.add("firefox"),navigator.userAgent.indexOf("Windows")!=-1?e.classList.add("win"):navigator.userAgent.indexOf("Macintosh")!=-1&&e.classList.add("mac"),e},Li=function(n,e,t){t===void 0&&(t=!1);function r(i){var o=e.getBoundingClientRect(),l=n.getBoundingClientRect(),a=o.x+l.width>window.innerWidth?window.innerWidth-l.width:o.x,l=o.y+o.height+l.height+OC>window.innerHeight?o.y-l.height-OC:o.y+o.height+OC;t&&e.parentElement&&(o=e.parentElement?e.parentElement.getBoundingClientRect():null,n.style.position="absolute",a-=o.x,l-=o.y),n.style.transform="translate(".concat(a,"px, ").concat(l,"px)"),n.style.display="block"}e.addEventListener("mouseover",r),e.addEventListener("focusin",r),e.addEventListener("keydown",function(i){i.key!=="Escape"&&i.key!=="Esc"||n.style.display!=="block"||(i.stopPropagation(),n.style.display="none")})},Nae=window&&window.__extends||function(){var n=function(e,t){return(n=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(r,i){r.__proto__=i}:function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])}))(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),Dae=(function(n){n.TopLeft="top-left",n.TopRight="top-right",n.BottomLeft="bottom-left",n.BottomRight="bottom-right",n.NonFixed="non-fixed"}(Fa=Fa||{}),function(n){function e(){var t=n!==null&&n.apply(this,arguments)||this;return t.position=Fa.NonFixed,t}return Nae(e,n),e}(wi)),Fae=function(){function n(e){var t;e&&(t=void 0,3<=(t=typeof e=="string"?this.getRBGA(e):e).length)&&(this.r=t[0],this.g=t[1],this.b=t[2],3<t.length)&&(this.a=t[3])}return n.prototype.getLuminosity=function(){for(var e=[this.r,this.g,this.b],t=[],r=0;r<e.length;r++){var i=e[r]/255;t[r]=i<=.03928?i/12.92:Math.pow((.055+i)/1.055,2.4)}return .2126*t[0]+.7152*t[1]+.0722*t[2]},n.prototype.getRBGA=function(r){var t=document.createElement("canvas").getContext("2d"),r=(t.globalAlpha=1,t.fillStyle=r,t.fillRect(0,0,1,1),t.getImageData(0,0,1,1).data);return[r[0],r[1],r[2],r[3]]},n}(),Ls=(function(n){n.light="light",n.dark="dark",n.auto="auto"}(Jo=Jo||{}),Map),Du=function(){function n(){this.listeners=new Ls}return n.prototype._addEventListener=function(e,t,r){this.listeners.has(e)||this.listeners.set(e,new Ls),this.listeners.get(e).set(t,r)},n.prototype._removeEventListener=function(e,t){this.listeners.has(e)&&this.listeners.get(e).delete(t)},n.prototype._invokeEvent=function(e,t){var r=this;this.listeners.has(e)&&this.listeners.get(e).forEach(function(i,o){i&&r._removeEventListener(e,o);try{o(t)}catch(a){console.error(a)}})},n}(),Bae=Object.freeze({__proto__:null,EventEmitter:Du}),Uae=window&&window.__extends||function(){var n=function(e,t){return(n=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(r,i){r.__proto__=i}:function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])}))(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),sc=function(n){function e(){var t=n!==null&&n.apply(this,arguments)||this;return t._onStyleChange=function(){t._map.getStyle().style.toLowerCase().startsWith("blank")?t._observer||(t._onBackgroundChange(),t._observer=new MutationObserver(t._onBackgroundChange),t._observer.observe(t._map.getMapContainer(),{attributes:!0,attributeFilter:["style"]})):(t._observer&&(t._observer.disconnect(),delete t._observer),t._map.styles.getThemeAsync(t._map.getStyle()).then(function(r){t._setTheme(r)}))},t._onBackgroundChange=function(){var r=new Fae(t._map.getMapContainer().style.backgroundColor).getLuminosity(),r=isNaN(r)||.5<r?Jo.light:Jo.dark;t._setTheme(r)},t}return Uae(e,n),e.prototype.onRemove=function(){this._container&&(this._container.remove(),delete this._container),this._map&&(this._map.events.remove("stylechanged",this._onStyleChange),delete this._map),this._observer&&(this._observer.disconnect(),delete this._observer),delete this._theme},e.prototype.buildContainer=function(t,r,i,o){return this._map=t,this._container=document.createElement(o||"div"),this._container.classList.add("azure-maps-control-container"),typeof i=="string"&&this._container.setAttribute("aria-label",i),r.toLowerCase()===Jo.auto?this._map&&this._map.events.add("stylechanged",this._onStyleChange):this._container.classList.add(r),this._container},e.prototype._setTheme=function(t){this._theme!==t&&(this._container.classList.remove(this._theme),this._container.classList.add(t),this._theme=t)},e.activateClickDelay=100,e}(Du),zae=window&&window.__extends||function(){var n=function(e,t){return(n=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(r,i){r.__proto__=i}:function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])}))(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),jae=function(n){function e(){var t=n!==null&&n.apply(this,arguments)||this;return t.rotationDegreesDelta=15,t.style=Jo.light,t.inverted=!1,t}return zae(e,n),e}(wi),Vae=window&&window.__extends||function(){var n=function(e,t){return(n=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(r,i){r.__proto__=i}:function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])}))(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),L8=function(n){function e(t){var r=n.call(this)||this;return r.hasMouse=!1,r.hasFocus=!1,r.options=new jae().merge(t),r}return Vae(e,n),e.prototype.onAdd=function(t,r){function i(g){g?(a.classList.add("in-use"),h.setAttribute("aria-hidden","false"),h.classList.remove("hidden-accessible-element")):(a.classList.remove("in-use"),h.setAttribute("aria-hidden","true"),h.classList.add("hidden-accessible-element"))}var o=this,a=this.buildContainer(t,this.options.style,"Rotation Control"),l=this.constructRotationButton(t),h=this.constructRotationGrid(t,r),p=ea("Reset to Default Rotation");return a.addEventListener("mouseover",function(g){o.lastActiveTime=o.lastActiveTime||g.timeStamp,o.hasMouse=!0,i(!0)}),a.addEventListener("focusin",function(g){o.lastActiveTime=o.lastActiveTime||g.timeStamp,o.hasFocus=!0,i(!0)}),a.addEventListener("mouseleave",function(){o.hasMouse=!1,o.hasFocus||(delete o.lastActiveTime,i(!1))}),a.addEventListener("focusout",function(g){g.relatedTarget instanceof Node&&a.contains(g.relatedTarget)||(o.hasFocus=!1,o.hasMouse)||(delete o.lastActiveTime,i(!1))}),h.addEventListener("keydown",function(g){g.key!=="Escape"&&g.key!=="Esc"||(g.stopPropagation(),l.focus(),i(!1))}),l.addEventListener("keydown",function(g){g.key!=="Escape"&&g.key!=="Esc"||a==null||!a.classList.contains("in-use")||(p==null?void 0:p.style.display)!=="none"||(g.stopPropagation(),i(!1))}),r&&e.InvertOrderPositions.includes(r.position)?(a.appendChild(h),a.appendChild(l),a.appendChild(p),Li(p,l)):(a.appendChild(l),a.appendChild(p),Li(p,l),a.appendChild(h)),a},e.prototype.constructRotationGrid=function(a,r){var i=document.createElement("div"),o=(i.classList.add("sub-container"),i.classList.add("hidden-accessible-element"),i.setAttribute("aria-hidden","true"),this.constructRightRotationButton(a)),a=this.constructLeftRotationButton(a),l=ea("Rotate Left"),h=ea("Rotate Right");return r&&e.InvertOrderPositions.includes(r.position)?(i.appendChild(o),i.appendChild(h),Li(h,o),i.appendChild(a),i.appendChild(l),Li(l,a)):(i.appendChild(a),i.appendChild(l),Li(l,a),i.appendChild(o),i.appendChild(h),Li(h,o)),i},e.prototype.constructRotationButton=function(t){var r=this,i=document.createElement("button"),o=(i.classList.add("azure-maps-control-button"),i.classList.add("rotation"),i.setAttribute("aria-label","Reset to Default Rotation"),i.setAttribute("alt","Reset to Default Rotation"),i.setAttribute("type","button"),document.createElement("div"));return i.appendChild(o),i.addEventListener("click",function(a){a.timeStamp-r.lastActiveTime>sc.activateClickDelay&&t.setCamera({bearing:e.DefaultRotation},!0)}),t.events.add("rotate",function(a){o.style.transform="rotate(".concat(-a.map.getCamera().bearing,"deg)")}),i},e.prototype.constructRightRotationButton=function(t){var r=this,i=document.createElement("button");return i.classList.add("azure-maps-control-button"),i.classList.add("rotation-right"),i.setAttribute("aria-label","Rotate Right"),i.setAttribute("alt","Rotate Right"),i.setAttribute("type","button"),i.addEventListener("click",function(){t.setCamera({bearing:t.getCamera().bearing-(r.options.inverted?-1:1)*r.options.rotationDegreesDelta,duration:e.RotationDuration,type:"ease"},!0)}),i},e.prototype.constructLeftRotationButton=function(t){var r=this,i=document.createElement("button");return i.classList.add("azure-maps-control-button"),i.classList.add("rotation-left"),i.setAttribute("aria-label","Rotate Left"),i.setAttribute("alt","Rotate Left"),i.setAttribute("type","button"),i.addEventListener("click",function(){t.setCamera({bearing:t.getCamera().bearing+(r.options.inverted?-1:1)*r.options.rotationDegreesDelta,duration:e.RotationDuration,type:"ease"},!0)}),i},e.DefaultRotation=0,e.RotationDuration=100,e.InvertOrderPositions=[Fa.BottomRight,Fa.TopRight],e}(sc),Hae=window&&window.__extends||function(){var n=function(e,t){return(n=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(r,i){r.__proto__=i}:function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])}))(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),Gae=function(n){function e(){var t=n!==null&&n.apply(this,arguments)||this;return t.pitchDegreesDelta=10,t.style=Jo.light,t.inverted=!1,t}return Hae(e,n),e}(wi),qae=window&&window.__extends||function(){var n=function(e,t){return(n=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(r,i){r.__proto__=i}:function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])}))(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),$ae=function(n){function e(t){var r=n.call(this)||this;return r.container=null,r.map=null,r.pitchButton=null,r.pitchIncrementButton=null,r.pitchDecrementButton=null,r.hasMouse=!1,r.hasFocus=!1,r.pitchChanged=function(i){return r.updatePitchButtonsState()},r.updatePitchButtonsState=function(){var i=r.map.getCamera().pitch<=0,o=60<=r.map.getCamera().pitch;r.hasFocus&&r.pitchButton&&(i||o)&&r.pitchButton.focus(),r.options.inverted?(r.pitchIncrementButton&&r.pitchIncrementButton.disabled!=i&&(r.pitchIncrementButton.disabled=i),r.pitchDecrementButton&&r.pitchDecrementButton.disabled!=o&&(r.pitchDecrementButton.disabled=o)):(r.pitchIncrementButton&&r.pitchIncrementButton.disabled!=o&&(r.pitchIncrementButton.disabled=o),r.pitchDecrementButton&&r.pitchDecrementButton.disabled!=i&&(r.pitchDecrementButton.disabled=i))},r.options=new Gae().merge(t),r}return qae(e,n),e.prototype.onAdd=function(t,r){function i(g){g?(a.classList.add("in-use"),h.setAttribute("aria-hidden","false"),h.classList.remove("hidden-accessible-element")):(a.classList.remove("in-use"),h.setAttribute("aria-hidden","true"),h.classList.add("hidden-accessible-element"))}var o=this,a=this.buildContainer(t,this.options.style,"Pitch Control"),l=this.constructPitchButton(t),h=this.constructPitchGrid(t,r),p=ea("Reset to Default Pitch");return a.addEventListener("mouseover",function(g){o.lastActiveTime=o.lastActiveTime||g.timeStamp,o.hasMouse=!0,i(!0)}),a.addEventListener("focusin",function(g){o.lastActiveTime=o.lastActiveTime||g.timeStamp,o.hasFocus=!0,i(!0)}),a.addEventListener("mouseleave",function(){o.hasMouse=!1,o.hasFocus||(delete o.lastActiveTime,i(!1))}),a.addEventListener("focusout",function(g){g.relatedTarget instanceof Node&&a.contains(g.relatedTarget)||(o.hasFocus=!1,o.hasMouse)||(delete o.lastActiveTime,i(!1))}),h.addEventListener("keydown",function(g){g.key!=="Escape"&&g.key!=="Esc"||(g.stopPropagation(),l.focus(),i(!1))}),l.addEventListener("keydown",function(g){g.key!=="Escape"&&g.key!=="Esc"||a==null||!a.classList.contains("in-use")||(p==null?void 0:p.style.display)!=="none"||(g.stopPropagation(),i(!1))}),r&&e.INVERT_ORDER_POSITIONS.includes(r.position)?(a.appendChild(h),a.appendChild(l),a.appendChild(p),Li(p,a)):(a.appendChild(l),a.appendChild(p),Li(p,a),a.appendChild(h)),this.map=t,this.container=a,this.pitchButton=l,t.events.add("pitch",this.pitchChanged),this.updatePitchButtonsState(),a},e.prototype.onRemove=function(){this.container&&(this.container.remove(),this.container=null,this.pitchButton=null,this.pitchIncrementButton=null,this.pitchDecrementButton=null),this.map&&(this.map.events.remove("pitch",this.pitchChanged),this.map=null)},e.prototype.constructPitchGrid=function(o,r){var i=document.createElement("div"),o=(i.classList.add("sub-container"),i.classList.add("hidden-accessible-element"),i.setAttribute("aria-hidden","true"),this.pitchIncrementButton=this.constructPitchIncrementButton(o),this.pitchDecrementButton=this.constructPitchDecrementButton(o),ea("Increase Pitch")),a=ea("Decrease Pitch");return r&&e.INVERT_ORDER_POSITIONS.includes(r.position)?(i.appendChild(this.pitchDecrementButton),i.appendChild(a),Li(a,this.pitchDecrementButton),i.appendChild(this.pitchIncrementButton),i.appendChild(o),Li(o,this.pitchIncrementButton)):(i.appendChild(this.pitchIncrementButton),i.appendChild(o),Li(o,this.pitchIncrementButton),i.appendChild(this.pitchDecrementButton),i.appendChild(a),Li(a,this.pitchDecrementButton)),i},e.prototype.constructPitchButton=function(t){var r=this,i=document.createElement("button");return i.classList.add("azure-maps-control-button"),i.classList.add("pitch"),i.setAttribute("aria-label","Reset to Default Pitch"),i.setAttribute("alt","Reset to Default Pitch"),i.setAttribute("type","button"),i.addEventListener("click",function(){event.timeStamp-r.lastActiveTime>sc.activateClickDelay&&t.setCamera({pitch:e.DEFAULT_PITCH},!0)}),i},e.prototype.constructPitchDecrementButton=function(t){var r=this,i=document.createElement("button");return i.classList.add("azure-maps-control-button"),i.classList.add("pitch-down"),i.setAttribute("aria-label","Decrease Pitch"),i.setAttribute("alt","Decrease Pitch"),i.setAttribute("type","button"),i.addEventListener("click",function(){t.setCamera({pitch:t.getCamera().pitch-(r.options.inverted?-1:1)*r.options.pitchDegreesDelta,duration:e.PITCH_DURATION_MS,type:"ease"},!0)}),i},e.prototype.constructPitchIncrementButton=function(t){var r=this,i=document.createElement("button");return i.classList.add("azure-maps-control-button"),i.classList.add("pitch-up"),i.setAttribute("aria-label","Increase Pitch"),i.setAttribute("alt","Increase Pitch"),i.setAttribute("type","button"),i.addEventListener("click",function(){t.setCamera({pitch:t.getCamera().pitch+(r.options.inverted?-1:1)*r.options.pitchDegreesDelta,duration:e.PITCH_DURATION_MS,type:"ease"},!0)}),i},e.PITCH_DURATION_MS=100,e.DEFAULT_PITCH=0,e.INVERT_ORDER_POSITIONS=[Fa.BottomRight,Fa.TopRight],e}(sc),Wae=window&&window.__extends||function(){var n=function(e,t){return(n=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(r,i){r.__proto__=i}:function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])}))(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),Yae=function(n){function e(t){var r=n.call(this)||this;return r.map=null,r.control=new as.ScaleControl({maxWidth:t==null?void 0:t.maxWidth,unit:t==null?void 0:t.unit}),r}return Wae(e,n),e.prototype.onAdd=function(t,r){this.map=t,(i=(i=this.map)==null?void 0:i._getMap())!=null&&i.addControl(this.control);var i=this.buildContainer(t,Jo.auto,"Scale Bar");return i.appendChild((t=this.control)==null?void 0:t._container),i},e.prototype.onRemove=function(){var t;n.prototype.onRemove.call(this),(t=(t=this.map)==null?void 0:t._getMap())!=null&&t.removeControl(this.control),this.map=null},e.prototype.setUnit=function(t){var r;(r=this.control)!=null&&r.setUnit(t)},e}(sc);function Kae(){this.__data__=[],this.size=0}var Zae=Kae;function Xae(n,e){return n===e||n!=n&&e!=e}var lb=Xae,Qae=lb;function Jae(n,e){for(var t=n.length;t--;)if(Qae(n[t][0],e))return t;return-1}var hT=Jae,ese=hT,tse=Array.prototype,nse=tse.splice;function rse(t){var e=this.__data__,t=ese(e,t);return!(t<0||(t==e.length-1?e.pop():nse.call(e,t,1),--this.size,0))}var ise=hT;function ose(t){var e=this.__data__,t=ise(e,t);return t<0?void 0:e[t][1]}var ase=hT;function sse(n){return-1<ase(this.__data__,n)}var cse=hT;function lse(n,e){var t=this.__data__,r=cse(t,n);return r<0?(++this.size,t.push([n,e])):t[r][1]=e,this}var use=Zae,hse=rse,dse=ose,fse=sse,pse=lse;function Bg(n){var e=-1,t=n==null?0:n.length;for(this.clear();++e<t;){var r=n[e];this.set(r[0],r[1])}}Bg.prototype.clear=use,Bg.prototype.delete=hse,Bg.prototype.get=dse,Bg.prototype.has=fse,Bg.prototype.set=pse;var dT=Bg,gse=dT;function mse(){this.__data__=new gse,this.size=0}var yse=mse;function _se(t){var e=this.__data__,t=e.delete(t);return this.size=e.size,t}var vse=_se;function bse(n){return this.__data__.get(n)}var wse=bse;function xse(n){return this.__data__.has(n)}var Ese=xse,Tse=typeof H1=="object"&&H1&&H1.Object===Object&&H1,N8=Tse,Sse=N8,Cse=typeof self=="object"&&self&&self.Object===Object&&self,Ase=Sse||Cse||Function("return this")(),Ml=Ase,Ise=Ml.Symbol,$f=Ise,OD=$f,D8=Object.prototype,Pse=D8.hasOwnProperty,Mse=D8.toString,D_=OD?OD.toStringTag:void 0;function Rse(n){var e=Pse.call(n,D_),t=n[D_];try{var r=!(n[D_]=void 0)}catch{}var i=Mse.call(n);return r&&(e?n[D_]=t:delete n[D_]),i}var kse=Rse,Ose=Object.prototype,Lse=Ose.toString;function Nse(n){return Lse.call(n)}var Dse=kse,Fse=Nse,Bse="[object Null]",Use="[object Undefined]",LD=$f?$f.toStringTag:void 0;function zse(n){return n==null?n===void 0?Use:Bse:(LD&&LD in Object(n)?Dse:Fse)(n)}var ub=zse;function jse(n){var e=typeof n;return n!=null&&(e=="object"||e=="function")}var fd=jse,Vse=ub,Hse=fd,Gse="[object AsyncFunction]",qse="[object Function]",$se="[object GeneratorFunction]",Wse="[object Proxy]";function Yse(n){return!!Hse(n)&&((n=Vse(n))==qse||n==$se||n==Gse||n==Wse)}var WM=Yse,Kse=Ml["__core-js_shared__"],LC=Kse,ND=function(){var n=/[^.]+$/.exec(LC&&LC.keys&&LC.keys.IE_PROTO||"");return n?"Symbol(src)_1."+n:""}();function Zse(n){return!!ND&&ND in n}var Xse=Zse,Qse=Function.prototype,Jse=Qse.toString;function ece(n){if(n!=null){try{return Jse.call(n)}catch{}try{return n+""}catch{}}return""}var F8=ece,tce=WM,nce=Xse,rce=fd,ice=F8,oce=/[\\^$.*+?()[\]{}|]/g,ace=/^\[object .+?Constructor\]$/,sce=Function.prototype,cce=Object.prototype,lce=sce.toString,uce=cce.hasOwnProperty,hce=RegExp("^"+lce.call(uce).replace(oce,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function dce(n){return!(!rce(n)||nce(n))&&(tce(n)?hce:ace).test(ice(n))}function fce(n,e){return n==null?void 0:n[e]}var pce=dce,gce=fce;function mce(n,e){return n=gce(n,e),pce(n)?n:void 0}var cp=mce,yce=cp(Ml,"Map"),YM=yce,_ce=cp(Object,"create"),fT=_ce,DD=fT;function vce(){this.__data__=DD?DD(null):{},this.size=0}var bce=vce;function wce(n){return n=this.has(n)&&delete this.__data__[n],this.size-=n?1:0,n}var xce=wce,Ece=fT,Tce="__lodash_hash_undefined__",Sce=Object.prototype,Cce=Sce.hasOwnProperty;function Ace(n){var e,t=this.__data__;return Ece?(e=t[n])===Tce?void 0:e:Cce.call(t,n)?t[n]:void 0}var Ice=Ace,Pce=fT,Mce=Object.prototype,Rce=Mce.hasOwnProperty;function kce(n){var e=this.__data__;return Pce?e[n]!==void 0:Rce.call(e,n)}var Oce=fT,Lce="__lodash_hash_undefined__";function Nce(n,e){var t=this.__data__;return this.size+=this.has(n)?0:1,t[n]=Oce&&e===void 0?Lce:e,this}var Dce=bce,Fce=xce,Bce=Ice,Uce=kce,zce=Nce;function Ug(n){var e=-1,t=n==null?0:n.length;for(this.clear();++e<t;){var r=n[e];this.set(r[0],r[1])}}Ug.prototype.clear=Dce,Ug.prototype.delete=Fce,Ug.prototype.get=Bce,Ug.prototype.has=Uce,Ug.prototype.set=zce;var FD=Ug,jce=dT,Vce=YM;function Hce(){this.size=0,this.__data__={hash:new FD,map:new(Vce||jce),string:new FD}}function Gce(n){var e=typeof n;return e=="string"||e=="number"||e=="symbol"||e=="boolean"?n!=="__proto__":n===null}var qce=Gce;function pT(n,e){return n=n.__data__,qce(e)?n[typeof e=="string"?"string":"hash"]:n.map}var $ce=pT;function Wce(n){return n=$ce(this,n).delete(n),this.size-=n?1:0,n}var Yce=pT;function Kce(n){return Yce(this,n).get(n)}var Zce=pT;function Xce(n){return Zce(this,n).has(n)}var Qce=pT;function Jce(n,e){var t=Qce(this,n),r=t.size;return t.set(n,e),this.size+=t.size==r?0:1,this}var ele=Hce,tle=Wce,nle=Kce,rle=Xce,ile=Jce;function zg(n){var e=-1,t=n==null?0:n.length;for(this.clear();++e<t;){var r=n[e];this.set(r[0],r[1])}}zg.prototype.clear=ele,zg.prototype.delete=tle,zg.prototype.get=nle,zg.prototype.has=rle,zg.prototype.set=ile;var B8=zg,ole=dT,ale=YM,sle=B8,cle=200;function lle(n,e){var t=this.__data__;if(t instanceof ole){var r=t.__data__;if(!ale||r.length<cle-1)return r.push([n,e]),this.size=++t.size,this;t=this.__data__=new sle(r)}return t.set(n,e),this.size=t.size,this}var ule=dT,hle=yse,dle=vse,fle=wse,ple=Ese,gle=lle;function jg(n){n=this.__data__=new ule(n),this.size=n.size}jg.prototype.clear=hle,jg.prototype.delete=dle,jg.prototype.get=fle,jg.prototype.has=ple,jg.prototype.set=gle;var KM=jg;function mle(n,e){for(var t=-1,r=n==null?0:n.length;++t<r&&e(n[t],t,n)!==!1;);return n}var yle=mle,_le=cp,vle=function(){try{var n=_le(Object,"defineProperty");return n({},"",{}),n}catch{}}(),U8=vle,BD=U8;function ble(n,e,t){e=="__proto__"&&BD?BD(n,e,{configurable:!0,enumerable:!0,value:t,writable:!0}):n[e]=t}var ZM=ble,wle=ZM,xle=lb,Ele=Object.prototype,Tle=Ele.hasOwnProperty;function Sle(n,e,t){var r=n[e];Tle.call(n,e)&&xle(r,t)&&(t!==void 0||e in n)||wle(n,e,t)}var z8=Sle,Cle=z8,Ale=ZM;function Ile(n,e,t,r){for(var i=!t,o=(t=t||{},-1),a=e.length;++o<a;){var l=e[o],h=r?r(t[l],n[l],l,t,n):void 0;h===void 0&&(h=n[l]),(i?Ale:Cle)(t,l,h)}return t}var hb=Ile;function Ple(n,e){for(var t=-1,r=Array(n);++t<n;)r[t]=e(t);return r}var Mle=Ple;function Rle(n){return n!=null&&typeof n=="object"}var Fu=Rle,kle=ub,Ole=Fu,Lle="[object Arguments]";function Nle(n){return Ole(n)&&kle(n)==Lle}var UD=Nle,Dle=Fu,j8=Object.prototype,Fle=j8.hasOwnProperty,Ble=j8.propertyIsEnumerable,Ule=UD(function(){return arguments}())?UD:function(n){return Dle(n)&&Fle.call(n,"callee")&&!Ble.call(n,"callee")},V8=Ule,zle=Array.isArray,db=zle,G1={exports:{}};function jle(){return!1}var Vle=jle,gT=(G1.exports,function(n,r){var r=r&&!r.nodeType&&r,t=r&&n&&!n.nodeType&&n,t=t&&t.exports===r?Ml.Buffer:void 0,r=t?t.isBuffer:void 0;n.exports=r||Vle}(G1,G1.exports),G1.exports),Hle=9007199254740991,Gle=/^(?:0|[1-9]\d*)$/;function qle(n,e){var t=typeof n;return!!(e=e??Hle)&&(t=="number"||t!="symbol"&&Gle.test(n))&&-1<n&&n%1==0&&n<e}var H8=qle,$le=9007199254740991;function Wle(n){return typeof n=="number"&&-1<n&&n%1==0&&n<=$le}var G8=Wle,Yle=ub,Kle=G8,Zle=Fu,Xle="[object Arguments]",Qle="[object Array]",Jle="[object Boolean]",eue="[object Date]",tue="[object Error]",nue="[object Function]",rue="[object Map]",iue="[object Number]",oue="[object Object]",aue="[object RegExp]",sue="[object Set]",cue="[object String]",lue="[object WeakMap]",uue="[object ArrayBuffer]",hue="[object DataView]",due="[object Float32Array]",fue="[object Float64Array]",pue="[object Int8Array]",gue="[object Int16Array]",mue="[object Int32Array]",yue="[object Uint8Array]",_ue="[object Uint8ClampedArray]",vue="[object Uint16Array]",bue="[object Uint32Array]",Ci={};function wue(n){return Zle(n)&&Kle(n.length)&&!!Ci[Yle(n)]}Ci[due]=Ci[fue]=Ci[pue]=Ci[gue]=Ci[mue]=Ci[yue]=Ci[_ue]=Ci[vue]=Ci[bue]=!0,Ci[Xle]=Ci[Qle]=Ci[uue]=Ci[Jle]=Ci[hue]=Ci[eue]=Ci[tue]=Ci[nue]=Ci[rue]=Ci[iue]=Ci[oue]=Ci[aue]=Ci[sue]=Ci[cue]=Ci[lue]=!1;var xue=wue;function Eue(n){return function(e){return n(e)}}var XM=Eue,q1={exports:{}},ty=(q1.exports,function(n,i){var i=i&&!i.nodeType&&i,t=i&&n&&!n.nodeType&&n,r=t&&t.exports===i&&N8.process,i=function(){try{var o=t&&t.require&&t.require("util").types;return o||r&&r.binding&&r.binding("util")}catch{}}();n.exports=i}(q1,q1.exports),q1.exports),Tue=xue,Sue=XM,zD=ty&&ty.isTypedArray,Cue=zD?Sue(zD):Tue,QM=Cue,Aue=Mle,Iue=V8,Pue=db,Mue=gT,Rue=H8,kue=QM,Oue=Object.prototype,Lue=Oue.hasOwnProperty;function Nue(n,e){var t,r=Pue(n),i=!r&&Iue(n),o=!r&&!i&&Mue(n),a=!r&&!i&&!o&&kue(n),l=r||i||o||a,h=l?Aue(n.length,String):[],p=h.length;for(t in n)!e&&!Lue.call(n,t)||l&&(t=="length"||o&&(t=="offset"||t=="parent")||a&&(t=="buffer"||t=="byteLength"||t=="byteOffset")||Rue(t,p))||h.push(t);return h}var q8=Nue,Due=Object.prototype;function Fue(n){var e=n&&n.constructor;return n===(typeof e=="function"&&e.prototype||Due)}var JM=Fue;function Bue(n,e){return function(t){return n(e(t))}}var $8=Bue,Uue=$8(Object.keys,Object),zue=JM,jue=Uue,Vue=Object.prototype,Hue=Vue.hasOwnProperty;function Gue(n){if(!zue(n))return jue(n);var e,t=[];for(e in Object(n))Hue.call(n,e)&&e!="constructor"&&t.push(e);return t}var que=WM,$ue=G8;function Wue(n){return n!=null&&$ue(n.length)&&!que(n)}var mT=Wue,Yue=q8,Kue=Gue,Zue=mT;function Xue(n){return(Zue(n)?Yue:Kue)(n)}var eR=Xue,Que=hb,Jue=eR;function ehe(n,e){return n&&Que(e,Jue(e),n)}var the=ehe;function nhe(n){var e=[];if(n!=null)for(var t in Object(n))e.push(t);return e}var rhe=fd,ihe=JM,ohe=nhe,ahe=Object.prototype,she=ahe.hasOwnProperty;function che(n){if(!rhe(n))return ohe(n);var e,t=ihe(n),r=[];for(e in n)(e!="constructor"||!t&&she.call(n,e))&&r.push(e);return r}var lhe=q8,uhe=che,hhe=mT;function dhe(n){return hhe(n)?lhe(n,!0):uhe(n)}var fb=dhe,fhe=hb,phe=fb;function ghe(n,e){return n&&fhe(e,phe(e),n)}var mhe=ghe,$1={exports:{}},W8=($1.exports,function(n,t){var t=t&&!t.nodeType&&t,r=t&&n&&!n.nodeType&&n,r=r&&r.exports===t?Ml.Buffer:void 0,i=r?r.allocUnsafe:void 0;n.exports=function(o,a){return a?o.slice():(a=o.length,a=i?i(a):new o.constructor(a),o.copy(a),a)}}($1,$1.exports),$1.exports);function yhe(n,e){var t=-1,r=n.length;for(e=e||Array(r);++t<r;)e[t]=n[t];return e}var Y8=yhe;function _he(n,e){for(var t=-1,r=n==null?0:n.length,i=0,o=[];++t<r;){var a=n[t];e(a,t,n)&&(o[i++]=a)}return o}function vhe(){return[]}var K8=vhe,bhe=_he,whe=K8,xhe=Object.prototype,Ehe=xhe.propertyIsEnumerable,jD=Object.getOwnPropertySymbols,The=jD?function(n){return n==null?[]:(n=Object(n),bhe(jD(n),function(e){return Ehe.call(n,e)}))}:whe,tR=The,She=hb,Che=tR;function Ahe(n,e){return She(n,Che(n),e)}var Ihe=Ahe;function Phe(n,e){for(var t=-1,r=e.length,i=n.length;++t<r;)n[i+t]=e[t];return n}var Z8=Phe,Mhe=$8(Object.getPrototypeOf,Object),nR=Mhe,Rhe=Z8,khe=nR,Ohe=tR,Lhe=K8,Nhe=Object.getOwnPropertySymbols,X8=Nhe?function(n){for(var e=[];n;)Rhe(e,Ohe(n)),n=khe(n);return e}:Lhe,Dhe=hb,Fhe=X8;function Bhe(n,e){return Dhe(n,Fhe(n),e)}var Uhe=Bhe,zhe=Z8,jhe=db;function Q8(n,e,t){return e=e(n),jhe(n)?e:zhe(e,t(n))}var Vhe=Q8,Hhe=tR,Ghe=eR;function qhe(n){return Vhe(n,Ghe,Hhe)}var J8=qhe,$he=Q8,Whe=X8,Yhe=fb;function Khe(n){return $he(n,Yhe,Whe)}var Zhe=Khe,Xhe=cp(Ml,"DataView"),Qhe=Xhe,Jhe=cp(Ml,"Promise"),ede=Jhe,tde=cp(Ml,"Set"),nde=tde,rde=cp(Ml,"WeakMap"),cI=Qhe,lI=YM,uI=ede,hI=nde,dI=rde,ez=ub,my=F8,VD="[object Map]",ide="[object Object]",HD="[object Promise]",GD="[object Set]",qD="[object WeakMap]",$D="[object DataView]",ode=my(cI),ade=my(lI),sde=my(uI),cde=my(hI),lde=my(dI),Hd=ez,yT=Hd=cI&&Hd(new cI(new ArrayBuffer(1)))!=$D||lI&&Hd(new lI)!=VD||uI&&Hd(uI.resolve())!=HD||hI&&Hd(new hI)!=GD||dI&&Hd(new dI)!=qD?function(t){var e=ez(t),t=e==ide?t.constructor:void 0,t=t?my(t):"";if(t)switch(t){case ode:return $D;case ade:return VD;case sde:return HD;case cde:return GD;case lde:return qD}return e}:Hd,ude=Object.prototype,hde=ude.hasOwnProperty;function dde(n){var e=n.length,t=new n.constructor(e);return e&&typeof n[0]=="string"&&hde.call(n,"index")&&(t.index=n.index,t.input=n.input),t}var fde=dde,pde=Ml.Uint8Array,tz=pde,WD=tz;function gde(n){var e=new n.constructor(n.byteLength);return new WD(e).set(new WD(n)),e}var rR=gde,mde=rR;function yde(n,e){return e=e?mde(n.buffer):n.buffer,new n.constructor(e,n.byteOffset,n.byteLength)}var _de=yde,vde=/\w*$/;function bde(n){var e=new n.constructor(n.source,vde.exec(n));return e.lastIndex=n.lastIndex,e}var wde=bde,YD=$f?$f.prototype:void 0,KD=YD?YD.valueOf:void 0;function xde(n){return KD?Object(KD.call(n)):{}}var Ede=rR;function Tde(n,e){return e=e?Ede(n.buffer):n.buffer,new n.constructor(e,n.byteOffset,n.length)}var nz=Tde,Sde=rR,Cde=_de,Ade=wde,Ide=xde,Pde=nz,Mde="[object Boolean]",Rde="[object Date]",kde="[object Map]",Ode="[object Number]",Lde="[object RegExp]",Nde="[object Set]",Dde="[object String]",Fde="[object Symbol]",Bde="[object ArrayBuffer]",Ude="[object DataView]",zde="[object Float32Array]",jde="[object Float64Array]",Vde="[object Int8Array]",Hde="[object Int16Array]",Gde="[object Int32Array]",qde="[object Uint8Array]",$de="[object Uint8ClampedArray]",Wde="[object Uint16Array]",Yde="[object Uint32Array]";function Kde(n,e,t){var r=n.constructor;switch(e){case Bde:return Sde(n);case Mde:case Rde:return new r(+n);case Ude:return Cde(n,t);case zde:case jde:case Vde:case Hde:case Gde:case qde:case $de:case Wde:case Yde:return Pde(n,t);case kde:return new r;case Ode:case Dde:return new r(n);case Lde:return Ade(n);case Nde:return new r;case Fde:return Ide(n)}}var Zde=Kde,Xde=fd,ZD=Object.create,Qde=function(){function n(){}return function(e){return Xde(e)?ZD?ZD(e):(n.prototype=e,e=new n,n.prototype=void 0,e):{}}}(),Jde=Qde,efe=nR,tfe=JM;function nfe(n){return typeof n.constructor!="function"||tfe(n)?{}:Jde(efe(n))}var rz=nfe,rfe=yT,ife=Fu,ofe="[object Map]";function afe(n){return ife(n)&&rfe(n)==ofe}var sfe=afe,cfe=XM,XD=ty&&ty.isMap,lfe=XD?cfe(XD):sfe,ufe=lfe,hfe=yT,dfe=Fu,ffe="[object Set]";function pfe(n){return dfe(n)&&hfe(n)==ffe}var gfe=pfe,mfe=XM,QD=ty&&ty.isSet,yfe=QD?mfe(QD):gfe,_fe=KM,vfe=yle,bfe=z8,wfe=the,xfe=mhe,Efe=W8,Tfe=Y8,Sfe=Ihe,Cfe=Uhe,Afe=J8,Ife=Zhe,Pfe=yT,Mfe=fde,Rfe=Zde,kfe=rz,Ofe=db,Lfe=gT,Nfe=ufe,Dfe=fd,Ffe=yfe,Bfe=eR,Ufe=fb,zfe=1,jfe=2,Vfe=4,iz="[object Arguments]",Hfe="[object Array]",Gfe="[object Boolean]",qfe="[object Date]",$fe="[object Error]",oz="[object Function]",Wfe="[object GeneratorFunction]",Yfe="[object Map]",Kfe="[object Number]",az="[object Object]",Zfe="[object RegExp]",Xfe="[object Set]",Qfe="[object String]",Jfe="[object Symbol]",epe="[object WeakMap]",tpe="[object ArrayBuffer]",npe="[object DataView]",rpe="[object Float32Array]",ipe="[object Float64Array]",ope="[object Int8Array]",ape="[object Int16Array]",spe="[object Int32Array]",cpe="[object Uint8Array]",lpe="[object Uint8ClampedArray]",upe="[object Uint16Array]",hpe="[object Uint32Array]",mi={};function Nw(n,e,t,r,i,o){var a,l=e&zfe,h=e&jfe,p=e&Vfe;if((a=t?i?t(n,r,i,o):t(n):a)===void 0){if(!Dfe(n))return n;if(r=Ofe(n),r){if(a=Mfe(n),!l)return Tfe(n,a)}else{var g=Pfe(n),_=g==oz||g==Wfe;if(Lfe(n))return Efe(n,l);if(g==az||g==iz||_&&!i){if(a=h||_?{}:kfe(n),!l)return h?Cfe(n,xfe(a,n)):Sfe(n,wfe(a,n))}else{if(!mi[g])return i?n:{};a=Rfe(n,g,l)}}if(_=(o=o||new _fe).get(n),_)return _;o.set(n,a),Ffe(n)?n.forEach(function(C){a.add(Nw(C,e,t,C,n,o))}):Nfe(n)&&n.forEach(function(C,M){a.set(M,Nw(C,e,t,M,n,o))});var x=r?void 0:(p?h?Ife:Afe:h?Ufe:Bfe)(n);vfe(x||n,function(C,M){x&&(C=n[M=C]),bfe(a,M,Nw(C,e,t,M,n,o))})}return a}mi[iz]=mi[Hfe]=mi[tpe]=mi[npe]=mi[Gfe]=mi[qfe]=mi[rpe]=mi[ipe]=mi[ope]=mi[ape]=mi[spe]=mi[Yfe]=mi[Kfe]=mi[az]=mi[Zfe]=mi[Xfe]=mi[Qfe]=mi[Jfe]=mi[cpe]=mi[lpe]=mi[upe]=mi[hpe]=!0,mi[$fe]=mi[oz]=mi[epe]=!1;var sz=Nw,dpe=sz,fpe=1,ppe=4;function gpe(n){return dpe(n,fpe|ppe)}var ao=dd(gpe),mpe=ZM,ype=lb;function _pe(n,e,t){(t===void 0||ype(n[e],t))&&(t!==void 0||e in n)||mpe(n,e,t)}var cz=_pe;function vpe(n){return function(e,t,r){for(var i=-1,o=Object(e),a=r(e),l=a.length;l--;){var h=a[n?l:++i];if(t(o[h],h,o)===!1)break}return e}}var bpe=vpe(),wpe=bpe,xpe=mT,Epe=Fu;function Tpe(n){return Epe(n)&&xpe(n)}var Spe=Tpe,Cpe=ub,Ape=nR,Ipe=Fu,Ppe="[object Object]",Mpe=Function.prototype,Rpe=Object.prototype,lz=Mpe.toString,kpe=Rpe.hasOwnProperty,Ope=lz.call(Object);function Lpe(n){return!(!Ipe(n)||Cpe(n)!=Ppe)&&((n=Ape(n))===null||typeof(n=kpe.call(n,"constructor")&&n.constructor)=="function"&&n instanceof n&&lz.call(n)==Ope)}var uz=Lpe;function hz(n,e){if((e!=="constructor"||typeof n[e]!="function")&&e!="__proto__")return n[e]}var Npe=hb,Dpe=fb;function Fpe(n){return Npe(n,Dpe(n))}var Bpe=cz,Upe=W8,zpe=nz,jpe=Y8,Vpe=rz,JD=V8,e3=db,Hpe=Spe,Gpe=gT,qpe=WM,$pe=fd,Wpe=uz,Ype=QM,t3=hz,Kpe=Fpe;function Zpe(n,e,t,r,i,o,a){var l,h,p,g=t3(n,t),_=t3(e,t),x=a.get(_);x||((e=(x=o?o(g,_,t+"",n,e,a):void 0)===void 0)&&(h=!(l=e3(_))&&Gpe(_),p=!l&&!h&&Ype(_),x=_,l||h||p?x=e3(g)?g:Hpe(g)?jpe(g):h?Upe(_,!(e=!1)):p?zpe(_,!(e=!1)):[]:Wpe(_)||JD(_)?JD(x=g)?x=Kpe(g):$pe(g)&&!qpe(g)||(x=Vpe(_)):e=!1),e&&(a.set(_,x),i(x,_,r,o,a),a.delete(_))),Bpe(n,t,x)}var Xpe=KM,Qpe=cz,Jpe=wpe,ege=Zpe,tge=fd,nge=fb,rge=hz;function dz(n,e,t,r,i){n!==e&&Jpe(e,function(o,a){var l;i=i||new Xpe,tge(o)?ege(n,e,a,t,dz,r,i):(l=r?r(rge(n,a),o,a+"",n,e,i):void 0,Qpe(n,a,l=l===void 0?o:l))},nge)}var ige=dz;function oge(n){return n}var fz=oge;function age(n,e,t){switch(t.length){case 0:return n.call(e);case 1:return n.call(e,t[0]);case 2:return n.call(e,t[0],t[1]);case 3:return n.call(e,t[0],t[1],t[2])}return n.apply(e,t)}var sge=age,n3=Math.max;function cge(n,e,t){return e=n3(e===void 0?n.length-1:e,0),function(){for(var r=arguments,i=-1,o=n3(r.length-e,0),a=Array(o);++i<o;)a[i]=r[e+i];for(var i=-1,l=Array(e+1);++i<e;)l[i]=r[i];return l[e]=t(a),sge(n,this,l)}}var lge=cge;function uge(n){return function(){return n}}var hge=uge,r3=U8,dge=r3?function(n,e){return r3(n,"toString",{configurable:!0,enumerable:!1,value:hge(e),writable:!0})}:fz,fge=dge,pge=800,gge=16,mge=Date.now;function yge(n){var e=0,t=0;return function(){var r=mge(),i=gge-(r-t);if(t=r,0<i){if(++e>=pge)return arguments[0]}else e=0;return n.apply(void 0,arguments)}}var _ge=yge(fge),vge=fz,bge=lge,wge=_ge;function xge(n,e){return wge(bge(n,e,vge),n+"")}var Ege=lb,Tge=mT,Sge=H8,Cge=fd;function Age(n,e,t){var r;return!!Cge(t)&&!!((r=typeof e)=="number"?Tge(t)&&Sge(e,t.length):r=="string"&&e in t)&&Ege(t[e],n)}var Ige=xge,Pge=Age;function Mge(n){return Ige(function(e,t){var r=-1,i=t.length,a=1<i?t[i-1]:void 0,o=2<i?t[2]:void 0,a=3<n.length&&typeof a=="function"?(i--,a):void 0;for(o&&Pge(t[0],t[1],o)&&(a=i<3?void 0:a,i=1),e=Object(e);++r<i;){var l=t[r];l&&n(e,l,r,a)}return e})}var Rge=ige,kge=Mge(function(n,e,t){Rge(n,e,t)}),pz=dd(kge),Oge=window&&window.__extends||function(){var n=function(e,t){return(n=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(r,i){r.__proto__=i}:function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])}))(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),Lge=function(n){function e(){var t=n!==null&&n.apply(this,arguments)||this;return t.layout="icons",t.mapStyles=["road","grayscale_light","grayscale_dark","night","road_shaded_relief"],t.style=Jo.light,t.autoSelectionMode=!0,t}return Oge(e,n),e}(wi),Nge=window&&window.__extends||function(){var n=function(e,t){return(n=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(r,i){r.__proto__=i}:function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])}))(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),Dge=window&&window.__awaiter||function(n,e,t,r){return new(t=t||Promise)(function(i,o){function a(p){try{h(r.next(p))}catch(g){o(g)}}function l(p){try{h(r.throw(p))}catch(g){o(g)}}function h(p){var g;p.done?i(p.value):((g=p.value)instanceof t?g:new t(function(_){_(g)})).then(a,l)}h((r=r.apply(n,e||[])).next())})},Fge=window&&window.__generator||function(n,e){var t,r,i,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]},a={next:l(0),throw:l(1),return:l(2)};return typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function l(h){return function(p){var g=[h,p];if(t)throw new TypeError("Generator is already executing.");for(;o=a&&g[a=0]?0:o;)try{if(t=1,r&&(i=2&g[0]?r.return:g[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,g[1])).done)return i;switch(r=0,(g=i?[2&g[0],i.value]:g)[0]){case 0:case 1:i=g;break;case 4:return o.label++,{value:g[1],done:!1};case 5:o.label++,r=g[1],g=[0];continue;case 7:g=o.ops.pop(),o.trys.pop();continue;default:if(!(i=0<(i=o.trys).length&&i[i.length-1])&&(g[0]===6||g[0]===2)){o=0;continue}if(g[0]===3&&(!i||g[1]>i[0]&&g[1]<i[3]))o.label=g[1];else if(g[0]===6&&o.label<i[1])o.label=i[1],i=g;else{if(!(i&&o.label<i[2])){i[2]&&o.ops.pop(),o.trys.pop();continue}o.label=i[2],o.ops.push(g)}}g=e.call(n,o)}catch(_){g=[6,_],r=0}finally{t=i=0}if(5&g[0])throw g[1];return{value:g[0]?g[1]:void 0,done:!0}}}},NC=window&&window.__read||function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var r,i,o=t.call(n),a=[];try{for(;(e===void 0||0<e--)&&!(r=o.next()).done;)a.push(r.value)}catch(l){i={error:l}}finally{try{r&&!r.done&&(t=o.return)&&t.call(o)}finally{if(i)throw i.error}}return a},Bge=function(n){function e(t){var r=n.call(this)||this;return r.styleOpsGrid=null,r.hasMouse=!1,r.hasFocus=!1,r.styleButtons=new Ls,r.styleIcons=new Ls,r.thumbnailCache={assumedConfiguration:void 0,response:new Ls,blob:new Ls},r.onStyleChange=function(){var i;r.options.autoSelectionMode&&(i=r.map.getStyle().style,r.setSelectedStyle(i))},r.onMapConfigurationChange=function(i){!r.styleOpsGrid||0<r.styleOpsGrid.children.length&&r.thumbnailCache.assumedConfiguration===i||(r.thumbnailCache.assumedConfiguration=i,Array.from(r.styleOpsGrid.children).forEach(function(o){return o.remove()}),r.styleButtons.clear(),r.populateOpsGridFromDefinitions(i))},r.mapToFriendlyStyleName=function(i,o){return o=o.configurations.find(function(a){return a.name===i}),(o==null?void 0:o.displayName)||i},r.options=new Lge().merge(ao(t)),r}return Nge(e,n),e.prototype.onAdd=function(p,r){function i(g){g?(a.classList.add(e.Css.inUse),l.setAttribute("aria-hidden","false"),l.classList.remove("hidden-accessible-element")):(a.classList.remove(e.Css.inUse),l.setAttribute("aria-hidden","true"),l.classList.add("hidden-accessible-element"))}var o=this,a=(this.map=p,this.buildContainer(p,this.options.style,"Map Style Control")),l=this.buildStyleOpsGrid(),h=(this.styleOpsGrid=l,this.buildCurrStyleBtn()),p=ea("Select Style");return l.classList.add(r&&r.position||"top-right"),a.addEventListener("mouseover",function(){o.hasMouse=!0,i(!0)}),a.addEventListener("focusin",function(){o.hasFocus=!0,i(!0)}),a.addEventListener("mouseleave",function(){o.hasMouse=!1,o.hasFocus||i(!1)}),a.addEventListener("focusout",function(g){g.target===h&&Array.from(l.children).forEach(function(_){return _.removeAttribute("tabIndex")}),g.relatedTarget instanceof Node&&a.contains(g.relatedTarget)||(o.hasFocus=!1,o.hasMouse)||i(!1)}),l.addEventListener("keydown",function(g){g.keyCode===27&&(g.stopPropagation(),h.focus(),Array.from(l.children).forEach(function(_){return _.setAttribute("tabIndex","-1")}),a.classList.contains(e.Css.inUse))&&i(!1)}),h.addEventListener("click",function(g){a.classList.contains(e.Css.inUse)?i(!1):(i(!0),l.firstElementChild&&l.firstElementChild.focus())}),r&&e.InvertOrderPositions.includes(r.position)?(a.appendChild(l),a.appendChild(h),a.appendChild(p),Li(p,h)):(a.appendChild(h),a.appendChild(p),Li(p,h),a.appendChild(l)),a},e.prototype.onRemove=function(){n.prototype.onRemove.call(this),this.styleOpsGrid=null,this.styleButtons.clear(),this.thumbnailCache.response.clear(),this.thumbnailCache.blob.clear(),this.thumbnailCache.assumedConfiguration=void 0,this.map.events.remove("stylechanged",this.onStyleChange),this.map.events.remove("mapconfigurationchanged",this.onMapConfigurationChange)},e.prototype.setSelectedStyle=function(t){var r,i,o=this;this.styleIcons.has(t)&&(r=this.currStyleImage,i=this.styleIcons.get(t),r.src!==i&&(r.src=i),Object.entries(this.styleButtons).forEach(function(l){var l=NC(l,2),h=l[0];return l[1].setAttribute("aria-current",h===t?"true":"false")}),this.map.styles.definitions().then(function(a){a=o.mapToFriendlyStyleName(t,a),r.alt!==a&&(r.alt=a),r.parentElement.lastChild instanceof Text&&(r.parentElement.lastChild.textContent=a)}))},e.prototype.disableStyle=function(t){t=this.styleButtons[t],t&&t.setAttribute("disabled","true")},e.prototype.enableStyle=function(t){t=this.styleButtons[t],t&&t.removeAttribute("disabled")},e.prototype.buildSelectStyleBtn=function(t,p,i){var o=this,a=document.createElement("button"),l=this.mapToFriendlyStyleName(t,p),h=(a.setAttribute("aria-label",l),a.setAttribute("type","button"),new Image),p=(i.then(function(g){var _;return o.thumbnailCache.blob.has(g.url)?o.thumbnailCache.blob.get(g.url):(_=g.clone().blob(),o.thumbnailCache.blob.set(g.url,_),_)}).then(function(g){g=URL.createObjectURL(g),h.src=g,t===o.map.getStyle().style&&(o.currStyleImage.src=g,o.currStyleImage.alt=l,o.currStyleImage.parentElement.lastChild.nodeType==Node.TEXT_NODE?o.currStyleImage.parentElement.lastChild.textContent=l:o.currStyleImage.parentElement.appendChild(document.createTextNode(l))),o.styleIcons.set(t,g)}),h.setAttribute("aria-hidden","true"),a.appendChild(h),this.options.layout==="icons"?a.classList.add(e.Css.button):(a.classList.add(e.Css.listButton),a.classList.add(e.Css.expanded),a.appendChild(document.createTextNode(l))),a.addEventListener("click",function(){o.hasMouse=!1,o.hasFocus=!1;var g=o.styleButtons[t];g&&!g.hasAttribute("disabled")&&(o._invokeEvent("styleselected",t),o.options.autoSelectionMode&&o.map.setStyle({style:t}),Object.entries(o.styleButtons).forEach(function(x){var x=NC(x,2),C=x[0];return x[1].setAttribute("aria-current",C===t?"true":"false")}))}),document.createElement("div"));return p.classList.add("selected-icon"),a.appendChild(p),a},e.prototype.buildCurrStyleBtn=function(){var t=document.createElement("button"),r=(this.options.layout=="icons"?t.classList.add(e.Css.button):t.classList.add(e.Css.listButton),t.classList.add(e.Css.currentStyle),t.setAttribute("aria-label","Select Style"),t.setAttribute("tabindex","-1"),this.currStyleImage=new Image,t.appendChild(this.currStyleImage),document.createElement("div"));return r.classList.add("icon"),t.appendChild(r),t},e.prototype.buildStyleOpsGrid=function(){var t=this,r=document.createElement("div");return r.classList.add(e.Css.styleOptions),this.options.layout==="icons"?r.classList.add(this.options.layout):r.classList.add(e.Css.dropdown),r.setAttribute("aria-label","Style Options"),r.classList.add("hidden-accessible-element"),r.setAttribute("aria-hidden","true"),this.map.styles.definitions().then(function(i){return Dge(t,void 0,void 0,function(){return Fge(this,function(o){return this.onMapConfigurationChange(i),this.map.events.add("stylechanged",this.onStyleChange),[2]})})}),this.map.events.add("mapconfigurationchanged",this.onMapConfigurationChange),r},e.prototype.populateOpsGridFromDefinitions=function(t){var r,i,o=this;this.styleOpsGrid&&(r=t.configurations,(r=Array.isArray(this.options.mapStyles)?r.filter(function(a){return o.options.mapStyles.includes(a.name.split("_indoor")[0])}):r).forEach(function(a){var l,h={url:a.thumbnail},p=(a.thumbnail&&o.map.styles._transformStyleRequest(a.thumbnail,h),o.map.getServiceOptions()),p=(p.transformRequest&&pz(h,p.transformRequest(h.url,"Thumbnail")),o.thumbnailCache.response.has(h.url)?l=Promise.resolve(o.thumbnailCache.response.get(h.url)):(l=fetch(h.url,{headers:h.headers}),o.thumbnailCache.response.set(h.url,l)),o.buildSelectStyleBtn(a.name,t,l));o.styleOpsGrid.appendChild(p),o.styleButtons[a.name]=p,o.options.layout==="icons"&&(h=ea(o.mapToFriendlyStyleName(a.name,t)),o.styleOpsGrid.appendChild(h),Li(h,p))}),i=this.map.getStyle().style,Object.entries(this.styleButtons).forEach(function(l){var l=NC(l,2),h=l[0];return l[1].setAttribute("aria-current",h===i?"true":"false")}))},e.InvertOrderPositions=[Fa.TopRight,Fa.BottomRight],e.Css={button:"azure-maps-control-button",listButton:"azure-maps-control-list-button",expanded:"expanded",currentStyle:"curr-style",inUse:"in-use",styleOptions:"style-options",dropdown:"azure-maps-control-dropdown"},e}(sc),Uge=window&&window.__extends||function(){var n=function(e,t){return(n=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(r,i){r.__proto__=i}:function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])}))(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),Dx=function(n){function e(){var t=n!==null&&n.apply(this,arguments)||this;return t.flow="none",t.incidents=!1,t}return Uge(e,n),e}(wi),zge=window&&window.__extends||function(){var n=function(e,t){return(n=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(r,i){r.__proto__=i}:function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])}))(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),jge=function(n){function e(){var t=n!==null&&n.apply(this,arguments)||this;return t.isActive=!1,t.style=Jo.light,t}return zge(e,n),e}(Dx),Vge=window&&window.__extends||function(){var n=function(e,t){return(n=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(r,i){r.__proto__=i}:function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])}))(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),gz=function(n){function e(t){var r,i=this;return(i=n.call(this)||this).hasMouse=!1,i.hasFocus=!1,i.options=new Dx().merge({flow:"relative",incidents:!0}),i.style=Jo.light,i.container=null,i.trafficButton=null,i.map=null,t&&(i.initIsActive=(r=t.isActive)!=null&&r,i.options.flow=t.flow||"relative",i.options.incidents=(r=t.incidents)==null||r,i.style=t.style||Jo.light),i}return Vge(e,n),Object.defineProperty(e.prototype,"isActive",{get:function(){var t;return!!this.map&&((t=this.map.getTraffic()).flow!=="none"||t.incidents)},set:function(t){this.map&&this.map.setTraffic({flow:t?this.options.flow:"none",incidents:!!t&&this.options.incidents})},enumerable:!1,configurable:!0}),e.prototype.onAdd=function(r){(this.map=r).getTraffic(),this.initIsActive!==void 0&&(this.isActive=this.initIsActive),this.container=this.buildContainer(r,this.style,"Traffic Control"),this.container.style.flexDirection="column";var r=this.constructTrafficButton(r),i=(this.container.appendChild(r),ea("Toggle Traffic Display"));return this.container.appendChild(i),Li(i,r),this.container},e.prototype.onRemove=function(){n.prototype.onRemove.call(this),this.map=null},e.prototype.getOptions=function(){return new jge().merge({isActive:this.isActive,flow:this.options.flow,incidents:this.options.incidents,style:this.style})},e.prototype.updateButtonState=function(){this.trafficButton&&(this.isActive?(this.container.classList.add("in-use"),this.trafficButton.setAttribute("aria-description","Traffic is displayed")):(this.container.classList.remove("in-use"),this.trafficButton.removeAttribute("aria-description")),this.trafficButton.setAttribute("aria-pressed",this.isActive?"true":"false"))},e.prototype.constructTrafficButton=function(t){var r=this,i=document.createElement("button");return i.classList.add("azure-maps-control-button"),i.classList.add("traffic"),i.setAttribute("aria-label","Toggle Traffic Display"),i.setAttribute("alt","Toggle Traffic Display"),i.setAttribute("type","button"),this.trafficButton=i,this.updateButtonState(),i.addEventListener("click",function(){r.isActive=!r.isActive}),i},e}(sc),Hge=window&&window.__extends||function(){var n=function(e,t){return(n=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(r,i){r.__proto__=i}:function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])}))(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),i3=window&&window.__values||function(n){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&n[e],r=0;if(t)return t.call(n);if(n&&typeof n.length=="number")return{next:function(){return{value:(n=n&&r>=n.length?void 0:n)&&n[r++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},Gge=function(n){function e(){var t=n.call(this)||this;return t.table=["Fast",["green","yellow","red","dark-red"],"Slow"],t.map=null,t.syncHiddenState=null,t}return Hge(e,n),e.prototype.onAdd=function(i){this.map=i;var r=this.buildContainer(i,Jo.auto,"Traffic Legend"),i=this.buildTrafficLegendDiv(i);return r.setAttribute("role","definition"),r.appendChild(i),r},e.prototype.onRemove=function(){n.prototype.onRemove.call(this),this.syncHiddenState&&(this.map.events.remove("styledata",this.syncHiddenState),this.syncHiddenState=null),this.map=null},e.prototype.buildTrafficLegendDiv=function(t){var r,i,o,a,l=document.createElement("div"),h=(l.classList.add("traffic-legend","hidden"),l.setAttribute("alt","Traffic Legend"),document.createElement("table")),p=document.createElement("tr"),g=document.createElement("td"),_=(g.setAttribute("alt","Traffic"),g.appendChild(document.createTextNode("Traffic")),ea("Traffic")),x=(g.classList.add("traffic-legend-title"),g.colSpan=6,p.appendChild(g),p.appendChild(_),Li(_,g),h.appendChild(p),document.createElement("tr"));try{for(var C=i3(this.table),M=C.next();!M.done;M=C.next()){var L=M.value,D=document.createElement("td");if(L==="Fast"||L==="Slow")D.setAttribute("alt",L),D.appendChild(document.createTextNode(L)),D.classList.add("traffic-legend-text");else{D.classList.add("traffic-legend-colors"),D.setAttribute("aria-label","Traffic Legend"),D.setAttribute("role","img");try{o=void 0;for(var z=i3(L),te=z.next();!te.done;te=z.next()){var le=te.value,ce=document.createElement("div");ce.classList.add(le),D.appendChild(ce)}}catch(J){o={error:J}}finally{try{te&&!te.done&&(a=z.return)&&a.call(z)}finally{if(o)throw o.error}}}x.appendChild(D);var _e=ea(L instanceof Array?"Traffic Legend":L);x.appendChild(_e),Li(_e,D)}}catch(J){r={error:J}}finally{try{M&&!M.done&&(i=C.return)&&i.call(C)}finally{if(r)throw r.error}}return h.appendChild(x),l.appendChild(h),this.syncHiddenState=function(J){J.dataType==="style"&&((J=t.getTraffic()).flow&&J.flow!=="none"?l.classList.remove("hidden"):l.classList.add("hidden"))},this.syncHiddenState({dataType:"style"}),t.events.add("styledata",this.syncHiddenState),l},e}(sc),qge="__lodash_hash_undefined__";function $ge(n){return this.__data__.set(n,qge),this}function Wge(n){return this.__data__.has(n)}var Yge=B8,Kge=$ge,Zge=Wge;function Dw(n){var e=-1,t=n==null?0:n.length;for(this.__data__=new Yge;++e<t;)this.add(n[e])}Dw.prototype.add=Dw.prototype.push=Kge,Dw.prototype.has=Zge;function Xge(n,e){for(var t=-1,r=n==null?0:n.length;++t<r;)if(e(n[t],t,n))return!0;return!1}function Qge(n,e){return n.has(e)}var Jge=Dw,eme=Xge,tme=Qge,nme=1,rme=2;function ime(n,e,t,r,i,o){var a=t&nme,l=n.length,h=e.length;if(l!=h&&!(a&&l<h))return!1;var h=o.get(n),p=o.get(e);if(h&&p)return h==e&&p==n;var g=-1,_=!0,x=t&rme?new Jge:void 0;for(o.set(n,e),o.set(e,n);++g<l;){var C,M=n[g],L=e[g];if((C=r?a?r(L,M,g,e,n,o):r(M,L,g,n,e,o):C)!==void 0){if(C)continue;_=!1;break}if(x){if(!eme(e,function(D,z){if(!tme(x,z)&&(M===D||i(M,D,t,r,o)))return x.push(z)})){_=!1;break}}else if(M!==L&&!i(M,L,t,r,o)){_=!1;break}}return o.delete(n),o.delete(e),_}var mz=ime;function ome(n){var e=-1,t=Array(n.size);return n.forEach(function(r,i){t[++e]=[i,r]}),t}function ame(n){var e=-1,t=Array(n.size);return n.forEach(function(r){t[++e]=r}),t}var o3=tz,sme=lb,cme=mz,lme=ome,ume=ame,hme=1,dme=2,fme="[object Boolean]",pme="[object Date]",gme="[object Error]",mme="[object Map]",yme="[object Number]",_me="[object RegExp]",vme="[object Set]",bme="[object String]",wme="[object Symbol]",xme="[object ArrayBuffer]",Eme="[object DataView]",a3=$f?$f.prototype:void 0,DC=a3?a3.valueOf:void 0;function Tme(n,e,t,r,i,o,a){switch(t){case Eme:if(n.byteLength!=e.byteLength||n.byteOffset!=e.byteOffset)return!1;n=n.buffer,e=e.buffer;case xme:return!!(n.byteLength==e.byteLength&&o(new o3(n),new o3(e)));case fme:case pme:case yme:return sme(+n,+e);case gme:return n.name==e.name&&n.message==e.message;case _me:case bme:return n==e+"";case mme:var l=lme;case vme:if(l=l||ume,n.size!=e.size&&!(r&hme))return!1;var h=a.get(n);return h?h==e:(r|=dme,a.set(n,e),h=cme(l(n),l(e),r,i,o,a),a.delete(n),h);case wme:if(DC)return DC.call(n)==DC.call(e)}return!1}var Sme=Tme,s3=J8,Cme=1,Ame=Object.prototype,Ime=Ame.hasOwnProperty;function Pme(n,e,t,r,i,o){var a=t&Cme,l=s3(n),h=l.length;if(h!=s3(e).length&&!a)return!1;for(var p=h;p--;){var g=l[p];if(!(a?g in e:Ime.call(e,g)))return!1}var _=o.get(n),x=o.get(e);if(_&&x)return _==e&&x==n;for(var C=!0,M=(o.set(n,e),o.set(e,n),a);++p<h;){var L,D=n[g=l[p]],z=e[g];if(!((L=r?a?r(z,D,g,e,n,o):r(D,z,g,n,e,o):L)===void 0?D===z||i(D,z,t,r,o):L)){C=!1;break}M=M||g=="constructor"}return C&&!M&&(_=n.constructor)!=(x=e.constructor)&&"constructor"in n&&"constructor"in e&&!(typeof _=="function"&&_ instanceof _&&typeof x=="function"&&x instanceof x)&&(C=!1),o.delete(n),o.delete(e),C}var FC=KM,Mme=mz,Rme=Sme,kme=Pme,c3=yT,l3=db,u3=gT,Ome=QM,Lme=1,h3="[object Arguments]",d3="[object Array]",W1="[object Object]",Nme=Object.prototype,f3=Nme.hasOwnProperty;function Dme(n,e,t,r,i,o){var a=l3(n),g=l3(e),l=a?d3:c3(n),g=g?d3:c3(e),h=(l=l==h3?W1:l)==W1,p=(g=g==h3?W1:g)==W1,g=l==g;if(g&&u3(n)){if(!u3(e))return!1;h=!(a=!0)}return g&&!h?(o=o||new FC,a||Ome(n)?Mme(n,e,t,r,i,o):Rme(n,e,l,t,r,i,o)):!(t&Lme)&&(a=h&&f3.call(n,"__wrapped__"),l=p&&f3.call(e,"__wrapped__"),a||l)?i(a?n.value():n,l?e.value():e,t,r,o=o||new FC):g&&(o=o||new FC,kme(n,e,t,r,i,o))}var Fme=Dme,p3=Fu;function yz(n,e,t,r,i){return n===e||(n==null||e==null||!p3(n)&&!p3(e)?n!=n&&e!=e:Fme(n,e,t,r,yz,i))}var Bme=yz;function Ume(n,e){return Bme(n,e)}var yi,Cr,ti,ei,Sr,Ba=dd(Ume),Pc=function(){function n(e,t,r,i){this.type="Feature",this.type=n.TYPE,this.properties=t||{},this.id=r,this.geometry=e,this.bbox=i}return n.TYPE="Feature",n}(),zme=window&&window.__extends||function(){var n=function(e,t){return(n=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(r,i){r.__proto__=i}:function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])}))(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),ta=function(n){function e(t,r){return n.call(this,t,r)||this}return zme(e,n),e.fromData=function(t){var r=NaN,i=NaN,o=new Set(["y"]),a=new Set(["x"]);return Object.keys(t).forEach(function(l){var h=l.toLowerCase();isNaN(r)&&o.has(h)&&typeof t[l]=="number"?r=t[l]:isNaN(i)&&a.has(h)&&typeof t[l]=="number"&&(i=t[l])}),isNaN(r)||isNaN(i)?null:new e(r,i)},e.getX=function(t){return 0<t.length?t[0]:NaN},e.getY=function(t){return 1<t.length?t[1]:NaN},e.getDestination=function(t,r,i){return new e(e.getX(t)+i*Math.cos((r+270)*Math.PI/180),e.getY(t)+i*Math.sin((r+270)*Math.PI/180))},e.getDistance=function(o,r){var i=e.getX(o)-e.getX(r),o=e.getY(o)-e.getY(r);return Math.sqrt(i*i+o*o)},e.getHeading=function(o,r){var i=e.getX(r)-e.getX(o),o=e.getY(o)-e.getY(r);return 180*(2.5*Math.PI-Math.atan2(o,i))/Math.PI%360},e}(Array),Mc=function(){function n(e){this.type="Point",this.type=n.TYPE,this.coordinates=e}return n.TYPE="Point",n}(),R0=window&&window.__read||function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var r,i,o=t.call(n),a=[];try{for(;(e===void 0||0<e--)&&!(r=o.next()).done;)a.push(r.value)}catch(l){i={error:l}}finally{try{r&&!r.done&&(t=o.return)&&t.call(o)}finally{if(i)throw i.error}}return a},jme=window&&window.__values||function(n){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&n[e],r=0;if(t)return t.call(n);if(n&&typeof n.length=="number")return{next:function(){return{value:(n=n&&r>=n.length?void 0:n)&&n[r++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},Fx=6378137,Vme=Math.PI/180,_z=180/Math.PI,g3=[1,10,100,1e3,1e4,1e5,1e6,1e7,1e8,1e9],k0=85.0511;function Zo(n){return n*Vme}function O0(n){return n*_z}function iR(n,e,t){return Math.min(Math.max(n,e),t)}function vz(i,e){var r=Zo(e[1]-i[1]),t=Zo(e[0]-i[0]),r=Math.pow(Math.sin(r/2),2)+Math.cos(Zo(i[1]))*Math.cos(Zo(e[1]))*Math.pow(Math.sin(t/2),2),i=2*Math.atan2(Math.sqrt(r),Math.sqrt(1-r));return Math.round(Fx*i*100)/100}function fI(n){if(n)switch(n.toLowerCase()){case"feet":case"foot":case"ft":return Cr.feet;case"kilometers":case"kilometer":case"kilometres":case"kilometre":case"km":case"kms":return Cr.kilometers;case"miles":case"mile":case"mi":return Cr.miles;case"nauticalmiles":case"nauticalmile":case"nms":case"nm":return Cr.nauticalMiles;case"yards":case"yard":case"yds":case"yrd":case"yrds":return Cr.yards;default:return Cr.meters}return Cr.meters}function m3(n){if(n)switch(n.toLowerCase()){case"milespersecondsquared":case"milepersecondsquared":case"mi/s^2":case"mi/s2":return Sr.milesPerSecondSquared;case"kilometerspersecondsquared":case"kilometrespersecondsquared":case"kilometerpersecondsquared":case"kilometrepersecondsquared":case"km/s^2":case"km/s2":return Sr.kilometersPerSecondSquared;case"knotspersecond":case"knotpersecond":case"knts/s":case"kn/s":case"kt/s":return Sr.knotsPerSecond;case"standardgravity":case"g":return Sr.standardGravity;case"feetpersecondsquared":case"footpersecondsquared":case"ft/s^2":case"ft/s2":return Sr.feetPerSecondSquared;case"yardspersecondsquared":case"yardpersecondsquared":case"yds/s^2":case"yds/s2":case"yd/s^2":case"yd/s2":return Sr.yardsPerSecondSquared;case"milesperhoursecond":case"mileperhoursecond":case"milesperhourseconds":case"mileperhourseconds":case"mi/h/s":return Sr.milesPerHourSecond;case"kilometersperhoursecond":case"kilometrespersoursecond":case"kilometerperhoursecond":case"kilometrepersoursecond":case"kilometersperhourssecond":case"kilometrespersourssecond":case"kilometerperhourssecond":case"kilometrepersourssecond":case"kmhs":case"km/h/s":return Sr.kilometersPerHourSecond;default:return Sr.metersPerSecondSquared}return Sr.metersPerSecondSquared}function y3(n){if(n)switch(n){case"acres":case"ac":return yi.acres;case"hectares":case"ha":return yi.hectares;case"squareFeet":case"ft^2":case"ft2":return yi.squareFeet;case"squareYards":case"squareYard":case"yds^2":case"yds2":case"yd^2":case"yd2":return yi.squareYards;case"squareKilometers":case"squareKilometres":case"squareKilometer":case"squareKilometre":case"km^2":case"km2":return yi.squareKilometers;case"squareMiles":case"squareMile":case"mi^2":case"mi2":return yi.squareMiles;default:return yi.squareMeters}return yi.squareMeters}function _3(n){if(n)switch(n.toLowerCase()){case"feetpersecond":case"footsecond":case"ftps":case"ft/s":return ei.feetPerSecond;case"milesperhour":case"mileperhour":case"mph":case"mi/hr":case"mi/h":return ei.milesPerHour;case"knots":case"knot":case"knts":case"knt":case"kn":case"kt":return ei.knots;case"mach":case"m":return ei.mach;case"kilometersperhour":case"kilometresperhour":case"kmperhour":case"kmph":case"km/hr":case"km/h":return ei.kilometersPerHour;default:return ei.metersPerSecond}return ei.metersPerSecond}function v3(n){if(n)switch(n.toLowerCase()){case"milliseconds":case"ms":return ti.ms;case"minutes":case"minute":case"mins":case"min":return ti.minutes;case"hours":case"hour":case"hr":case"h":return ti.hours;case"days":case"day":case"d":return ti.days;default:return ti.seconds}return ti.seconds}function b3(n){var e=0;if(n&&0<n.length)for(var e=Math.abs(w3(n[0])),t=1,r=n.length;t<r;t++)e-=Math.abs(w3(n[t]));return e}function w3(n){var e=0;if(3<=n.length){for(var t=void 0,r=void 0,i=0,o=n.length;i<o;i++)e+=(Zo(n[i===o-2?(t=o-2,r=o-1,0):i===o-1?(t=o-1,r=0,1):(r=(t=i)+1,i+2)][0])-Zo(n[t][0]))*Math.sin(Zo(n[r][1]));e=e*Fx*Fx/2}return e}function x3(n,e,t){return(n[0]-t[0])*(e[1]-t[1])-(n[1]-t[1])*(e[0]-t[0])}function Hme(n,e,t){if(2<=t.length){for(var r,i,o,a=1/0,l=null,h=pb(t,22),p=0,g=h.length-1;p<g;p++)i=Gme(e,h[p],h[p+1]),(r=ta.getDistance(e,i))<a&&(a=r,l=i);if(l)return o=cR([l],22)[0],new Pc(new Mc(o),{distance:ss(n,o)})}else if(t.length===1)return new Pc(new Mc(t[0]),{distance:ss(n,t[0])});return null}function Gme(n,e,t){var r,i;return e[0]===t[0]&&e[1]===t[1]||(i=n[0]-e[0],n=n[1]-e[1],(n=((r=t[0]-e[0])*i+(i=t[1]-e[1])*n)/(r*r+i*i))<0)?e:1<n?t:[e[0]+r*n,e[1]+i*n]}function ns(n,e){var t;return!isNaN(n)&&typeof e=="number"&&0<=e&&(t=void 0,t=e<g3.length?g3[e]:Math.pow(10,e),n=Math.round(n*t)/t),n}function qme(i){var e=$i(lr.getWest(i)),t=$i(lr.getEast(i)),r=ho(lr.getNorth(i)),o=ho(lr.getSouth(i)),i=lr.getCenter(i),o=[[e,r],[e,o],[i[0],o],[t,o],[t,r],[i[0],r],[e,r]];return new vT([o])}function Tu(n,e,t,r){switch(fI(e)){case Cr.meters:n/=1e3;break;case Cr.feet:n/=3280.8399;break;case Cr.miles:n/=.62137119;break;case Cr.yards:n/=1093.6133;break;case Cr.nauticalMiles:n/=.5399568;break;case Cr.kilometers:}switch(fI(t)){case Cr.meters:n*=1e3;break;case Cr.feet:n*=3280.8399;break;case Cr.miles:n*=.62137119;break;case Cr.yards:n*=1093.6133;break;case Cr.nauticalMiles:n*=.5399568;break;case Cr.kilometers:}return typeof r=="number"&&0<=r&&(e=Math.pow(10,r),n=Math.round(n*e)/e),n}function $me(n,e,t,r){if(!n||n.length<=2)return h;typeof e!="number"&&(e=.5),(typeof t!="number"||t<=0)&&(t=15);var i,o,a,l=n.length,h=n.slice(0),p=(r?(Xo.areEqual(h[0],h[l-1])&&(h.pop(),l--),h.unshift(n[l-1]),h.push(n[0]),h.push(n[1]),l++):(h.unshift(n[0]),h.push(n[l-1])),[]);p.push([1,0,0,0]);for(var g=1;g<t-1;g++)p.push([2*(a=(i=g/t)*(o=i*i))-3*o+1,-2*a+3*o,a-2*o+i,a-o]);p.push([0,1,0,0]);for(var _,x,C,M,L,D,z=[],g=1;g<l;g++)for(_=e*(h[g+1][0]-h[g-1][0]),x=e*(h[g+1][1]-h[g-1][1]),C=e*(h[g+2][0]-h[g][0]),M=e*(h[g+2][1]-h[g][1]),i=0;i<t;i++)D=(L=p[i])[0]*h[g][0]+L[1]*h[g+1][0]+L[2]*_+L[3]*C,L=iR(L[0]*h[g][1]+L[1]*h[g+1][1]+L[2]*x+L[3]*M,-85,85),z.push([D,L]);return z}function yy(l,h,o,a){a=a||"meters",l=Ua(l);var a=oR(a),i=Zo(l[1]),l=Zo(l[0]),h=Zo(h),o=o/a,a=Math.asin(Math.sin(i)*Math.cos(o)+Math.cos(i)*Math.sin(o)*Math.cos(h)),l=l+Math.atan2(Math.sin(h)*Math.sin(o)*Math.cos(i),Math.cos(o)-Math.sin(i)*Math.sin(a)),h=iR(ho(O0(a)),-85,85);return[$i(O0(l)),h]}function ss(n,e,t){return n=vz(n=Ua(n),e=Ua(e)),t==="meters"?n:Tu(n,"meters",t||"meters")}function oR(n){return n=fI(n),Tu(Fx,Cr.meters,n)}function bz(n,e,t){for(var r=[],i=Zo(n[1]),o=Zo(n[0]),a=Zo(e[1]),l=Zo(e[0]),h=2*Math.asin(Math.sqrt(Math.pow(Math.sin((i-a)/2),2)+Math.cos(i)*Math.cos(a)*Math.pow(Math.sin((o-l)/2),2))),p=0;p<=t;p++){var x=p/t,C=Math.sin((1-x)*h)/Math.sin(h),x=Math.sin(x*h)/Math.sin(h),g=C*Math.cos(i)*Math.cos(o)+x*Math.cos(a)*Math.cos(l),_=C*Math.cos(i)*Math.sin(o)+x*Math.cos(a)*Math.sin(l),C=C*Math.sin(i)+x*Math.sin(a),x=Math.atan2(C,Math.sqrt(Math.pow(g,2)+Math.pow(_,2))),C=Math.atan2(_,g),x=iR(O0(x),-85,85),C=O0(C);r.push([C,x])}return r}function aR(n){return(Array.isArray(n)?n:n.coordinates).reduce(function(e,t){var r=0<e.length?e[e.length-1]:null;return r&&180<Math.abs(t[0]-r[0])?(r=r[0]<0?t[0]-360:t[0]+360,e.push([r,t[1]])):e.push(t),e},[])}function wz(n){for(var e,t,r,i,o,a=Array.isArray(n)?n:n.coordinates,l=[],h=[],p=0;p<a.length;p++)l.push(a[p]),p+1>=a.length||(e=(t=R0(a[p],2))[0],t=t[1],i=(o=R0(a[p+1],2))[0],o=o[1],180<Math.abs(i-e)&&(r=0<e?180:-180,i=Math.abs((0<e?i+360:i-360)-e),o=t+(o-t)*(Math.abs(r-e)/i),l.push([r,o]),h.push(l),l=[[-r,o]]));return h.push(l),h}function Wme(n,e){(!e||e<=0)&&(e=15),Array.isArray(n)?t=n:n.type&&n.type==="LineString"&&(t=n.coordinates);for(var t,r=t.length-1,i=[],o=0;o<r;o++)i=i.concat(bz(t[o],t[o+1],e));return aR(i)}function Yme(n,e){(!e||e<=0)&&(e=15),Array.isArray(n)?t=n:n.type&&n.type==="LineString"&&(t=n.coordinates);for(var t,r=t.length-1,i=[],o=[],a=0;a<r;a++)for(var l,h,p,g,_,x=bz(t[a],t[a+1],e),C=0;C<x.length;C++)i.push(x[C]),C+1>=x.length||(l=(h=R0(x[C],2))[0],h=h[1],g=(_=R0(x[C+1],2))[0],_=_[1],180<Math.abs(g-l)&&(p=0<l?180:-180,g=Math.abs((0<l?g+360:g-360)-l),_=h+(_-h)*(Math.abs(p-l)/g),i.push([p,_]),o.push(i),i=[[-p,_]]));return o.push(i),o}function Yh(n,e){var t,r;return n=Ua(n),e=Ua(e),n&&2<=n.length&&e&&2<=e.length?(r=Zo(n[1]),t=Zo(e[1]),e=Zo(e[0]-n[0]),n=Math.sin(e)*Math.cos(t),r=Math.cos(r)*Math.sin(t)-Math.sin(r)*Math.cos(t)*Math.cos(e),(O0(Math.atan2(n,r))+360)%360):NaN}function sR(n,e){var t,r=0;Array.isArray(n)?t=n:n.type&&n.type==="LineString"&&(t=n.coordinates);for(var i=0,o=t.length-1;i<o;i++)r+=vz(t[i],t[i+1]);return Tu(r,"meters",e||"meters")}function xz(n,e,t){t=t||"meters";var r,i=0;if(Array.isArray(n)?r=n:n.type&&n.type==="LineString"&&(r=n.coordinates),2<=r.length){for(var o,a,l=r.length,h=1;h<l;h++){if(e<=i+(a=ss(r[h-1],r[h],t)))return o=Yh(r[h-1],r[h]),yy(r[h-1],o,e-i,t);i+=a}return i<=e?r[l-1]:r[0]}return null}function Ez(n,e,t,r,i){r=r||"meters",i=i||0,n=Ua(n);for(var o=[],a=360/t,l=0;l<=t;l++)o.push(yy(n,(l*a+i)%360,e,r));return o}function Tz(n,e,t,r,i){return aR(Ez(n,e,t,r,i))}function Kme(n,e,t,r,i){return wz(Ez(n,e,t,r,i))}function pI(n,e,t){t=t===void 0?.5:t;var r=ss(n=Ua(n),e=Ua(e),"kilometers");return yy(n,Yh(n,e),r*t,"kilometers")}function ho(n){return 90<n?180<(n=(n+90)%360)?90-(n-180):n-90:n<-90?(n=(n-90)%360)<-180?-90-(n+180):n+90:n}function $i(n){return 180<n?(n+180)%360-180:n<-180?(n-180)%360+180:n}function Sz(n,e,t){if(t===0)return Object.assign({},n);e=Ua(e);for(var r,i,o=[],a=0,l=n.length;a<l;a++)r=ss(e,n[a]),i=Yh(e,n[a]),o.push(yy(e,i+t,r));return o}function Zme(t,i){t=Ua(t),i=Ua(i);var t=R0(pb([t,i],21),2),i=t[0],t=t[1],r=t[0]-i[0],i=i[1]-t[1];return(2.5*Math.PI-Math.atan2(i,r))*_z%360}function cR(n,e){for(var t,r,i=512*Math.pow(2,e),o=[],a=0,l=n.length;a<l;a++)t=n[a][0]/i-.5,r=.5-n[a][1]/i,o.push([360*t,90-360*Math.atan(Math.exp(2*-r*Math.PI))/Math.PI]);return o}function pb(n,e){for(var t,r,i=512*Math.pow(2,e),o=[],a=0,l=n.length;a<l;a++)r=Math.sin(n[a][1]*Math.PI/180),t=(n[a][0]+180)/360,r=.5-Math.log((1+r)/(1-r))/(4*Math.PI),o.push([Math.round(t*i),Math.round(r*i)]);return o}function _T(n,e,t,r){switch(m3(e)){case Sr.kilometersPerHourSecond:n/=3.6;break;case Sr.milesPerHourSecond:n/=2.236936292054;break;case Sr.knotsPerSecond:n/=1.943844492441;break;case Sr.standardGravity:n/=.1019716212978;break;case Sr.kilometersPerSecondSquared:n/=.001;break;case Sr.milesPerSecondSquared:n/=.000621371192;break;case Sr.feetPerSecondSquared:n/=3.280839895012;break;case Sr.yardsPerSecondSquared:n/=1.093613298338;break;case Sr.metersPerSecondSquared:}switch(m3(t)){case Sr.kilometersPerHourSecond:n*=3.6;break;case Sr.milesPerHourSecond:n*=2.236936292054;break;case Sr.knotsPerSecond:n*=1.943844492441;break;case Sr.standardGravity:n*=.1019716212978;break;case Sr.kilometersPerSecondSquared:n*=.001;break;case Sr.milesPerSecondSquared:n*=.000621371192;break;case Sr.feetPerSecondSquared:n*=3.280839895012;break;case Sr.yardsPerSecondSquared:n*=1.093613298338;break;case Sr.metersPerSecondSquared:}return ns(n,r)}function Cz(n,e,t,r){switch(y3(e)){case yi.acres:n*=4046.8564224;break;case yi.hectares:n*=1e4;break;case yi.squareFeet:n*=.09290304;break;case yi.squareKilometers:n*=1e6;break;case yi.squareMiles:n*=259e4;break;case yi.squareYards:n*=.83612736;break;case yi.squareMeters:}switch(y3(t)){case yi.acres:n/=4046.8564224;break;case yi.hectares:n/=1e4;break;case yi.squareFeet:n/=.09290304;break;case yi.squareKilometers:n/=1e6;break;case yi.squareMiles:n/=259e4;break;case yi.squareYards:n/=.83612736;break;case yi.squareMeters:}return ns(n,r)}function Wf(n,e,t,r){switch(_3(e)){case ei.feetPerSecond:n*=1.09728;break;case ei.milesPerHour:n*=1.6093;break;case ei.knots:n*=1.852;break;case ei.metersPerSecond:n*=3.6;break;case ei.mach:n*=1234.8;break;case ei.kilometersPerHour:}switch(_3(t)){case ei.feetPerSecond:n/=1.09728;break;case ei.milesPerHour:n/=1.6093;break;case ei.knots:n/=1.852;break;case ei.metersPerSecond:n/=3.6;break;case ei.mach:n/=1234.8;break;case ei.kilometersPerHour:}return ns(n,r)}function _y(n,e,t,r){switch(v3(e)){case ti.ms:n/=1e3;break;case ti.hours:n*=3600;break;case ti.minutes:n*=60;break;case ti.days:n*=86400;break;case ti.seconds:}switch(v3(t)){case ti.ms:n*=1e3;break;case ti.hours:n/=3600;break;case ti.minutes:n/=60;break;case ti.days:n/=86400;break;case ti.seconds:}return ns(n,r)}function Az(n,e,t,r,i,o,a,l){return e=Tu(e,i,Cr.meters),i=_y(t,o,ti.seconds),_T(2*(e-Wf(n,r,ei.metersPerSecond)*i)/(i*i),Sr.metersPerSecondSquared,a,l)}function Iz(n,e,t,r,i,o,a){return n=Wf(n,r,ei.metersPerSecond),_T((Wf(e,r,ei.metersPerSecond)-n)/_y(t,i,ti.seconds),Sr.metersPerSecondSquared,o,a)}function Xme(n,e,t,r,i,o,a){if(typeof t=="string"&&n.type==="Feature"&&n.geometry.type==="Point"&&e.type==="Feature"&&e.geometry.type==="Point"&&(t=lR(n.properties[t],e.properties[t],ti.seconds),!isNaN(t))){var l=0;if(r&&typeof r=="string"){var h=n.properties[r],r=e.properties[r];if(typeof h=="number"&&(l=h,typeof r=="number"))return Iz(h,r,t,i,ti.seconds,o,a)}return Az(l,ss(n.geometry.coordinates,e.geometry.coordinates,Cr.meters),t,i,Cr.meters,ti.seconds,o,a)}return NaN}function Pz(n,e,t){if(n){var r=0;switch((n=n instanceof Ii?n.toJson():n).type){case"Feature":var i=n;if(i.geometry)return Pz(i.geometry,e,t);break;case"Polygon":i=n,i.coordinates&&(r=b3(i.coordinates));break;case"MultiPolygon":var o=n;if(o.coordinates)for(var a=0,l=o.coordinates.length;a<l;a++)r+=b3(o.coordinates[a])}return Cz(r,yi.squareMeters,e,t)}return 0}function Qme(n,e,t,r,i,o){return n=Ua(n),e=Ua(e),n&&e?(t=_y(t,r,ti.seconds),Wf(ss(n,e,Cr.meters)/t,ei.metersPerSecond,i,o)):0}function Jme(n,e,t,r,i){return typeof t=="string"&&n.type==="Feature"&&n.geometry.type==="Point"&&e.type==="Feature"&&e.geometry.type==="Point"&&(t=lR(n.properties[t],e.properties[t],ti.seconds),!isNaN(t))?Wf(ss(n.geometry.coordinates,e.geometry.coordinates,Cr.meters)/t,ei.metersPerSecond,r,i):NaN}function lR(n,e,t,r){return n=gI(n),e=gI(e),n!=null&&e!=null?_y(e.getTime()-n.getTime(),ti.ms,t,r):NaN}function eye(n,e,t,r,i,o,a,l){return e=_y(e,i,ti.seconds),i=(t=Wf(t,o,ei.metersPerSecond))*e,typeof r=="number"&&(i+=.5*_T(r,a,Sr.metersPerSecondSquared)*e*e),Tu(i,Cr.meters,n,l)}function gI(n){if(Object.prototype.toString.call(n)==="[object Date]")return n;if(typeof n=="string"){var e=Date.parse(n);if(!isNaN(e))return new Date(e);if(0<=n.indexOf("Date("))return e=(e=0)<(n=n.replace("/Date(","").replace(")/","")).indexOf("+")?parseInt(n.substr(0,n.indexOf("+")),10):0<n.indexOf("-")?parseInt(n.substr(0,n.indexOf("-")),10):parseInt(n,10),new Date(e)}else if(typeof n=="number")return new Date(n);return null}function tye(n){var e,t,r=cf(n).map(function(g){return[$i(g[0]),ho(g[1])]}),i=(r.sort(function(g,_){return g[0]===_[0]?g[1]-_[1]:g[0]-_[0]}),[]);try{for(var o=jme(r),a=o.next();!a.done;a=o.next()){for(var l=a.value;2<=i.length&&x3(i[i.length-2],i[i.length-1],l)<=0;)i.pop();i.push(l)}}catch(g){e={error:g}}finally{try{a&&!a.done&&(t=o.return)&&t.call(o)}finally{if(e)throw e.error}}for(var h=[],p=r.length-1;0<=p;p--){for(;2<=h.length&&x3(h[h.length-2],h[h.length-1],r[p])<=0;)h.pop();h.push(r[p])}return new vT([i.concat(h)])}function cf(n){var e=[],t=null,r=null;if(Array.isArray(n)&&0<n.length)if(Array.isArray(n[0])&&typeof n[0][0]=="number")e=n;else for(var i=n.length,o=0;o<i;o++)e=e.concat(cf(n[o]));else if(n.type)switch(n.type){case"Point":e=[n.coordinates];break;case"LineString":e=n.coordinates;break;case"Polygon":t=n.coordinates;break;case"MultiPoint":e=n.coordinates;break;case"MultiLineString":t=n.coordinates;break;case"MultiPolygon":r=n.coordinates;break;case"Feature":var a=n,e=Ii._isCircle(a)?Ii._getCirclePositions(a):cf(a.geometry);break;case"FeatureCollection":e=cf(n.features);break;case"GeometryCollection":e=cf(n.geometries)}else if(n instanceof Ii)return cf(n.toJson());if(t)for(i=t.length,o=0;o<i;o++)e=e.concat(t[o]);else if(r)for(var l=r.length,o=0;o<l;o++)for(var h=r[o].length,p=0;p<h;p++)e=e.concat(r[o][p]);return e}function Ua(n){if(Array.isArray(n)&&typeof n[0]=="number")return n;if(n.type){if(n.type==="Point")return n.coordinates;if(n.type==="Feature"&&n.geometry.type==="Point")return n.geometry.coordinates}else if(n instanceof Ii&&n.getType()==="Point")return n.getCoordinates();return null}function nye(n,e){if(e<2)return[];for(var t=[],r=sR(n,Cr.meters)/(e-1),i=0;i<e;i++){var o=xz(n,r*i,Cr.meters);o!=null&&t.push(o)}return t}function Mz(n,e,t){t=t||"meters";var r,i=0;if(Array.isArray(n)?r=n:n.type&&n.type==="LineString"&&(r=n.coordinates),2<=r.length){for(var o,a,l,h=r.length,p=1;p<h;p++){if(e<=i+(l=ss(r[p-1],r[p],t)))return o=Yh(r[p-1],r[p]),a=yy(r[p-1],o,e-i,t),new Pc(new Mc(a),{heading:o});i+=l}return i<=e?new Pc(new Mc(r[h-1]),{heading:Yh(r[h-2],r[h-1])}):new Pc(new Mc(r[0]),{heading:Yh(r[0],r[1])})}return null}function rye(n,e){if(e<=0)return[];for(var t=[],r=sR(n,Cr.meters)/(e-1),i=0;i<e;i++){var o=Mz(n,r*i,Cr.meters);o!=null&&t.push(o)}return t}function Bx(n,e,t,r){var i=Ua(n),o=pb([i],22)[0],a=null,l=1/0;switch((e=e instanceof Ii?e.toJson():e).type){case"Feature":return Bx(n,e.geometry,t);case"Point":C=[[e.coordinates]];break;case"MultiPoint":for(var h,p=e.coordinates,g=0,_=p.length;g<_;g++)(h=ss(i,p[g]))<l&&(l=h,a=new Pc(new Mc(p[g]),{distance:h}));break;case"LineString":C=[e.coordinates];break;case"Polygon":case"MultiLineString":C=e.coordinates;break;case"MultiPolygon":var x=e.coordinates;if(0<x.length)for(var C=x[0],g=1,_=x.length;g<_;g++)C=C.concat(x[g])}if(C)for(var M,g=0,_=C.length;g<_;g++)(M=Hme(i,o,C[g]))&&M.properties.distance<l&&(l=M.properties.distance,a=M);return a&&(a.properties.distance=Tu(a.properties.distance,"meters",t,r)),a}(function(n){n.squareMeters="squareMeters",n.acres="acres",n.hectares="hectares",n.squareFeet="squareFeet",n.squareKilometers="squareKilometers",n.squareMiles="squareMiles",n.squareYards="squareYards"})(yi=yi||{}),function(n){n.meters="meters",n.kilometers="kilometers",n.feet="feet",n.miles="miles",n.nauticalMiles="nauticalMiles",n.yards="yards"}(Cr=Cr||{}),function(n){n.seconds="seconds",n.hours="hours",n.ms="ms",n.minutes="minutes",n.days="days"}(ti=ti||{}),function(n){n.metersPerSecond="metersPerSecond",n.kilometersPerHour="kilometersPerHour",n.feetPerSecond="feetPerSecond",n.milesPerHour="milesPerHour",n.knots="knots",n.mach="mach"}(ei=ei||{}),function(n){n.milesPerSecondSquared="milesPerSecondSquared",n.kilometersPerSecondSquared="kilometersPerSecondSquared",n.knotsPerSecond="knotsPerSecond",n.standardGravity="standardGravity",n.feetPerSecondSquared="feetPerSecondSquared",n.yardsPerSecondSquared="yardsPerSecondSquared",n.milesPerHourSecond="milesPerHourSecond",n.kilometersPerHourSecond="kilometersPerHourSecond",n.metersPerSecondSquared="metersPerSecondSquared"}(Sr=Sr||{});var iye=window&&window.__extends||function(){var n=function(e,t){return(n=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(r,i){r.__proto__=i}:function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])}))(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),Xo=function(n){function e(t,r,i){return i?n.call(this,t,r,i)||this:n.call(this,t,r)||this}return iye(e,n),e.fromPosition=function(t){return t.length===2?new e(t[0],t[1]):2<t.length?new e(t[0],t[1],t[2]):null},e.areEqual=function(t,r,i){var o,a;return i===void 0&&(i=6),!!(t&&2<=t.length&&r&&2<=r.length)&&(i=Math.pow(10,i),a=ho(t[1]),o=ho(r[1]),t=$i(t[0]),r=$i(r[0]),Math.round((a-o)*i)/i==0)&&((a=Math.round((t-r)*i)/i)==0||a==360)},e.fromLatLng=function(t,r,i){var o,a,l,h,p,g,_=[];return typeof t=="number"?(typeof r=="number"&&_.push(r),_.push(t),typeof i=="number"&&_.push(i)):Array.isArray(t)?2<=t.length&&typeof t[0]=="number"&&typeof t[1]=="number"&&(3<=t.length&&typeof t[2]=="number"?_.push(t[1],t[0],t[2]):_.push(t[1],t[0])):typeof t=="object"&&(o=["lat","latitude","y"],a=["lng","longitude","lon","x"],l=["elv","elevation","alt","altitude","z"],g=p=h=NaN,Object.keys(t).forEach(function(x,C,M){var L=x.toLowerCase();isNaN(h)&&0<=o.indexOf(L)&&typeof t[x]=="number"?h=t[x]:isNaN(p)&&0<=a.indexOf(L)&&typeof t[x]=="number"?p=t[x]:isNaN(g)&&0<=l.indexOf(L)&&typeof t[x]=="number"&&(g=t[x])}),isNaN(h)||isNaN(p)||(_.push(p,h),isNaN(g))||_.push(g)),2<=_.length?_:null},e.fromLatLngs=function(t){var r=[];if(Array.isArray(t))for(var i=0,o=t.length;i<o;i++){var a=e.fromLatLng(t[i]);a&&r.push(a)}return r},e._getDimensions=function(t){for(var r=0;Array.isArray(t);)t=t[0],r++;return typeof t=="number"&&r--,r},e}(Array),vT=function(){function n(e,t){this.type="Polygon",this.type=n.TYPE,Xo._getDimensions(e)===1?this.coordinates=[e]:this.coordinates=e,this.bbox=t}return n.TYPE="Polygon",n}(),oye=window&&window.__extends||function(){var n=function(e,t){return(n=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(r,i){r.__proto__=i}:function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])}))(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),E3=window&&window.__values||function(n){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&n[e],r=0;if(t)return t.call(n);if(n&&typeof n.length=="number")return{next:function(){return{value:(n=n&&r>=n.length?void 0:n)&&n[r++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},Ii=function(n){function e(t,r,i){var o,a,l=n.call(this)||this;return t.type==="Feature"?(a=ao((o=t).geometry),i=o.properties?ao(o.properties):{},r=o.id==null||o.id===""?qf():o.id):(a=ao(t),r=r==null||r===""?qf():r,i=i?ao(i):{}),i[e._shapeIdPropName]=r,l.data=new Pc(a,i,r),l._handleCircle(),l}return oye(e,n),e.prototype.addProperty=function(t,r){Ba(this.data.properties[t],r)||(this.data.properties[t]=ao(r),t!=="subType"&&t!=="radius"||this._handleCircle(),this.dataSource&&this.dataSource._updateSource(),this._invokeEvent("shapechanged",this))},e.prototype.getBounds=function(){var t,r,i,o,a,l=this.getCoordinates(),h=this.getType();if(h==="Point")a=this.circlePolygon?(p=this.circlePolygon.geometry.coordinates,lr.fromPositions(p[0])):new lr(p=l,p);else if(h==="MultiPoint"||h==="LineString"){var p=l;a=lr.fromPositions(p)}else if(h==="Polygon")p=l,a=lr.fromPositions(p[0]);else if(h==="MultiLineString"){p=l;try{for(var g=E3(p),_=g.next();!_.done;_=g.next()){var x=_.value;a=lr.merge(a,lr.fromPositions(x))}}catch(D){t={error:D}}finally{try{_&&!_.done&&(r=g.return)&&r.call(g)}finally{if(t)throw t.error}}}else if(h==="MultiPolygon"){p=l;try{for(var C=E3(p),M=C.next();!M.done;M=C.next()){var L=M.value;a=lr.merge(a,lr.fromPositions(L[0]))}}catch(D){i={error:D}}finally{try{M&&!M.done&&(o=C.return)&&o.call(C)}finally{if(i)throw i.error}}}return a},e.prototype.getCoordinates=function(){return ao(this.data.geometry.coordinates)},e.prototype.getCircleCoordinates=function(){return this.circlePolygon?ao(this.circlePolygon.geometry.coordinates[0]):null},e.prototype.getId=function(){return this.data.id},e.prototype.getProperties=function(){return ao(this.data.properties)},e.prototype.getType=function(){return this.data.geometry.type},e.prototype.isCircle=function(){return e._isCircle(this.data)},e.prototype.isRectangle=function(){return e._isRectangle(this.data)},e.prototype.setCoordinates=function(t){t=this.getType()==="Polygon"&&Xo._getDimensions(t)===1?[t]:t,Ba(this.data.geometry.coordinates,t)||(this.data.geometry.coordinates=ao(t),this._handleCircle(),this.dataSource&&this.dataSource._updateSource(),this._invokeEvent("shapechanged",this))},e.prototype.setProperties=function(t){t[e._shapeIdPropName]=this.data.id,Ba(this.data.properties,t)||(this.data.properties=ao(t),this._handleCircle(),this.dataSource&&this.dataSource._updateSource(),this._invokeEvent("shapechanged",this))},e.prototype.toJson=function(){return JSON.parse(JSON.stringify(this.data))},e.prototype._toJson=function(){return this.circlePolygon||this.data},e.prototype._setDataSource=function(t){t===void 0||t==null?delete this.dataSource:this.dataSource=t},e.prototype._handleCircle=function(){var t;this.isCircle()?(t=e._getCirclePositions(this.data),this.circlePolygon=new Pc(new vT([t]),this.data.properties,this.data.id),this.data.properties.subType="Circle"):delete this.circlePolygon},e._isCircle=function(t){return t&&t.geometry&&t.geometry.type==="Point"&&t.geometry.coordinates&&t.properties&&typeof t.properties.subType=="string"&&t.properties.subType.toLowerCase()==="circle"&&typeof t.properties.radius=="number"},e._isRectangle=function(t){if(t.geometry.type==="Polygon"&&t.geometry.coordinates&&typeof t.properties.subType=="string"&&t.properties.subType.toLowerCase()==="rectangle"&&(t=t.geometry.coordinates,t.length===1)){if(t=t[0],t.length===5)return t[0][0]===t[4][0]&&t[0][1]===t[4][1];if(t.length===4)return!0}return!1},e._getCirclePositions=function(t){return Tz(t.geometry.coordinates,t.properties.radius,72,"meters")},e._shapeIdPropName="_azureMapsShapeId",e}(Du),aye=window&&window.__extends||function(){var n=function(e,t){return(n=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(r,i){r.__proto__=i}:function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])}))(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),sye=window&&window.__values||function(n){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&n[e],r=0;if(t)return t.call(n);if(n&&typeof n.length=="number")return{next:function(){return{value:(n=n&&r>=n.length?void 0:n)&&n[r++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},lr=function(n){function e(t,r){var i,o=this;return t&&r?o=(i=t)[2]&&r[2]?n.call(this,i[0],i[1],i[2]||0,r[0],r[1],r[2]||0)||this:n.call(this,i[0],i[1],r[0],r[1])||this:t&&(i=t)&&(i.length===4?o=n.call(this,i[0],i[1],i[2],i[3])||this:6<=i.length&&(o=n.call(this,i[0],i[1],i[2],i[3],i[4],i[5])||this)),o}return aye(e,n),e.fromBoundingBox=function(a){var r=e.getWest(a),i=e.getSouth(a),o=e.getEast(a),a=e.getNorth(a);return new e([r,i,o,a])},e.fromDimensions=function(l,r,h){var o=l[0],l=l[1],a=Math.min(Math.max(l+h/2,-85.5),85.5),l=Math.min(Math.max(l-h/2,-85.5),85.5),h=$i(o+r/2);return new e([$i(o-r/2),l,h,a])},e.fromEdges=function(t,r,i,o){return new e([t,r,i,o])},e.containsPosition=function(l,a){var o=e.getCenter(l),i=Math.abs(o[1]-a[1]),o=Math.abs(o[0]-a[0]),a=(180<o&&(o=360-o),e.getHeight(l)),l=e.getWidth(l);return i<=a/2+1e-8&&o<=l/2+1e-8},e.containsBoundingBox=function(t,r){var i=t&&t.length===4,o=r&&r.length===4;return!(!i||!o)&&e.getWest(t)<e.getWest(r)&&e.getWest(r)<e.getEast(t)&&e.getWest(t)<e.getEast(r)&&e.getEast(r)<e.getEast(t)&&e.getSouth(t)<e.getSouth(r)&&e.getSouth(r)<e.getNorth(t)&&e.getSouth(t)<e.getNorth(r)&&e.getNorth(r)<e.getNorth(t)},e.crossesAntimeridian=function(t){return $i(e.getEast(t))-$i(e.getWest(t))<0||e.isBoundingBoxWithSixOrMoreElementsLargerThanGlobe(t)||e.isBoundingBoxWithLessThanSixElementsLargerThanGlobe(t)},e.getCenter=function(o){var i=$i(e.getEast(o)),r=$i(e.getWest(o)),r=(i<r&&(i+=360),$i((r+i)/2)),i=ho(e.getSouth(o)),o=ho(e.getNorth(o));return[r,ho((i+o)/2)]},e.getHeight=function(t){return t=ho(e.getNorth(t))-ho(e.getSouth(t)),isNaN(t)?0:t},e.getWidth=function(t){return t=$i(e.getEast(t))-$i(e.getWest(t)),isNaN(t)?0:t<0?t+360:t},e.getSouthWest=function(i){var r=this.getSouth(i),i=this.getWest(i);return isNaN(r)||isNaN(i)?null:[i,r]},e.getNorthEast=function(i){var r=this.getNorth(i),i=this.getEast(i);return isNaN(r)||isNaN(i)?null:[i,r]},e.getNorthWest=function(i){var r=this.getNorth(i),i=this.getWest(i);return isNaN(r)||isNaN(i)?null:[i,r]},e.getSouthEast=function(i){var r=this.getSouth(i),i=this.getEast(i);return isNaN(r)||isNaN(i)?null:[i,r]},e.getSouth=function(t){return t&&4<=t.length?Number(t[1]):NaN},e.getWest=function(t){return t&&4<=t.length?Number(t[0]):NaN},e.getNorth=function(t){if(t){if(t.length===4)return Number(t[3]);if(t.length===6)return Number(t[4])}return NaN},e.getEast=function(t){if(t){if(t.length===4)return Number(t[2]);if(t.length===6)return Number(t[3])}return NaN},e.intersect=function(l,p){var o=e.getCenter(l),a=e.getCenter(p),i=Math.abs(o[1]-a[1]),o=Math.abs(o[0]-a[0]),a=(180<o&&(o=360-o),e.getHeight(l)),l=e.getWidth(l),h=e.getHeight(p),p=e.getWidth(p);return i<=a/2+h/2&&o<=l/2+p/2},e.merge=function(t,r){var i=t&&t.length===4,o=r&&r.length===4;if(i&&!o)return t;if(o&&!i)return r;if(!i&&!o)return null;for(var i=Math.max(ho(e.getNorth(t)),ho(e.getNorth(r))),o=Math.min(ho(e.getSouth(t)),ho(e.getSouth(r))),a=[t,r],l=[],h=0,h=0;h<a.length;h++){var p=a[h],g=$i(e.getWest(p)),_=$i(e.getEast(p));e.crossesAntimeridian(p)?(l.push([g,180]),l.push([-180,_])):l.push([g,_])}l.sort(function(le,ce){return le[0]===ce[0]?le[1]-ce[1]:le[0]-ce[0]});var x=[],C=l[0];for(h=1;h<l.length;){var M=l[h];C[1]>=M[0]?C[1]=Math.max(C[1],M[1]):(x.push(C),C=M),h++}x.push(C);var L=x.length,D=x[0][0]+360-x[L-1][1],z=[x[L-1][1],x[0][0]];for(h=1;h<L;h++){var te=x[h][0]-x[h-1][1];D<te&&(D=te,z=[x[h-1][1],x[h][0]])}return new e([z[1],o],[z[0],i])},e.fromPositions=function(t){for(var r,i,o=NaN,a=NaN,l=NaN,h=NaN,p=t.length,g=new Array(p),_=0;p--;)(i=t[p])&&2<=i.length&&(r=ho(i[1]),o=isNaN(o)?r:Math.max(o,r),a=isNaN(a)?r:Math.min(a,r),g[_++]=$i(i[0]));if(_){g.length=_,g.sort(function(L,D){return L-D});for(var x=g[0]+360-g[_-1],C=0,p=1;p<_;p++){var M=g[p]-g[p-1];x<M&&(x=M,C=p)}l=g[C],h=g[(C||_)-1]}return isNaN(l)||isNaN(a)||isNaN(h)||isNaN(o)?null:new e([l,a,h,o])},e.fromLatLngs=function(t){return e.fromPositions(Xo.fromLatLngs(t))},e.fromData=function(t){var r,i,o=null;if(Array.isArray(t)&&0<t.length){try{for(var a=sye(t),l=a.next();!l.done;l=a.next()){var h,p=l.value;(h=e.fromData(p))!=null&&(o=o===null?h:e.merge(o,h))}}catch(te){r={error:te}}finally{try{l&&!l.done&&(i=a.return)&&i.call(a)}finally{if(r)throw r.error}}return o}if(t instanceof Ii)return t.getBounds();if(t&&t.type){var g=t;if(g.bbox&&g.bbox.length===4)return g.bbox;switch(g.type){case"FeatureCollection":return e.fromData(g.features);case"Feature":return Ii._isCircle(g)?e.fromPositions(Ii._getCirclePositions(g)):e.fromData(g.geometry);case"GeometryCollection":return e.fromData(g.geometries);case"Point":var _=g.coordinates;if(_&&2<=_.length)return[_[0],_[1],_[0],_[1]];break;case"LineString":case"MultiPoint":return e.fromPositions(g.coordinates);case"Polygon":case"MultiLineString":var x=g.coordinates;if(x&&0<x.length){for(var C=0,M=x.length;C<M;C++)(h=e.fromPositions(x[C]))!=null&&(o=o===null?h:e.merge(o,h));if(o!=null)return o}break;case"MultiPolygon":var L=g.coordinates;if(L&&0<L.length){for(C=0,M=L.length;C<M;C++)for(var D=0,z=L[C].length;D<z;D++)(h=e.fromPositions(L[C][D]))!=null&&(o=o===null?h:e.merge(o,h));return o}}}return null},e.splitOnAntimeridian=function(t){var r,i,o,a,l,h,p=[];return e.isBoundingBoxWithSixOrMoreElementsLargerThanGlobe(t)?[[-180,t[1],t[2],180,t[4],t[5]]]:e.isBoundingBoxWithLessThanSixElementsLargerThanGlobe(t)?[[-180,t[1],180,t[3]]]:(e.crossesAntimeridian(t)?(h=r=void 0,i=$i(e.getWest(t)),o=$i(e.getEast(t)),a=ho(e.getNorth(t)),l=ho(e.getSouth(t)),h=6<=t.length?(r=[i,l,t[2],180,a,t[5]],[-180,l,t[2],o,a,t[5]]):(r=[i,l,180,a],[-180,l,o,a]),p.push(r,h)):p.push(t),p)},e.isBoundingBoxWithSixOrMoreElementsLargerThanGlobe=function(t){return 6<=t.length&&360<t[3]-t[0]},e.isBoundingBoxWithLessThanSixElementsLargerThanGlobe=function(t){return t.length<6&&360<t[2]-t[0]},e}(Array),yf=function(){function n(e,t){this.type="FeatureCollection",this.type=n.TYPE,this.features=e,this.bbox=t}return n.TYPE="FeatureCollection",n}(),cye=function(){function n(e){this.type="GeometryCollection",this.type=n.TYPE,this.geometries=e}return n.TYPE="GeometryCollection",n}(),lye=function(){function n(e,t){this.type="LineString",this.type=n.TYPE,this.coordinates=e,this.bbox=t}return n.TYPE="LineString",n}(),uye=function(){function n(e,t){this.type="MultiLineString",this.type=n.TYPE,this.coordinates=e,this.bbox=t}return n.TYPE="MultiLineString",n}(),hye=function(){function n(e,t){this.type="MultiPoint",this.type=n.TYPE,this.coordinates=e,this.bbox=t}return n.TYPE="MultiPoint",n}(),dye=function(){function n(e,t){this.type="MultiPolygon",this.type=n.TYPE,this.coordinates=e,this.bbox=t}return n.TYPE="MultiPolygon",n}(),fye=window&&window.__extends||function(){var n=function(e,t){return(n=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(r,i){r.__proto__=i}:function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])}))(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),pye=function(n){function e(t,r,i){return n.call(this,t,r,i||0)||this}return fye(e,n),e.fromPosition=function(t){return 2<=t.length?new e((180+t[0])/360,e._latToMercatorY(t[1]),3<=t.length?e._altitudeToMercatorZ(t[2],t[1]):0):[0,0,0]},e.fromPositions=function(t){for(var r=[],i=0,o=t.length;i<o;i++)r.push(this.fromPosition(t[i]));return r},e.toFloat32Array=function(t){for(var r=new Float32Array(3*t.length),i=0,o=t.length;i<o;i++){var a=3*i,l=t[i];r[a]=(180+l[0])/360,r[1+a]=e._latToMercatorY(l[1]),r[2+a]=3<=l.length?e._altitudeToMercatorZ(l[2],l[1]):0}return r},e.toPosition=function(t){var r;return 2<=t.length?(r=360/Math.PI*Math.atan(Math.exp((180-360*t[1])*Math.PI/180))-90,new Xo(360*t[0]-180,r,3<=t.length?e._mercatorZToAltitude(t[2],t[1]):0)):[0,0,0]},e.toPositions=function(t){for(var r=[],i=0,o=t.length;i<o;i++)r.push(this.toPosition(t[i]));return r},e.mercatorScale=function(t){return 1/Math.cos(t*Math.PI/180)},e.meterInMercatorUnits=function(t){return 1/e.earthCircumference*e.mercatorScale(e._latToMercatorY(t))},e._circumferenceAtLatitude=function(t){return e.earthCircumference*Math.cos(t*Math.PI/180)},e._altitudeToMercatorZ=function(t,r){return t/e._circumferenceAtLatitude(r)},e._mercatorZToAltitude=function(t,r){return t*e._circumferenceAtLatitude(e._latToMercatorY(r))},e._latToMercatorY=function(t){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t*Math.PI/360)))/360},e.earthCircumference=2*Math.PI*oR(),e}(Array),gye=Object.freeze({__proto__:null,BoundingBox:lr,Feature:Pc,FeatureCollection:yf,GeometryCollection:cye,LineString:lye,MercatorPoint:pye,MultiLineString:uye,MultiPoint:hye,MultiPolygon:dye,Point:Mc,Polygon:vT,Position:Xo});function mI(n,e){return n*n+e*e}function mye(n,e){return mI(n[0]-e[0],n[1]-e[1])}function yye(n,o,t){var r,i=o[0],o=o[1],a=t[0]-i,l=t[1]-o;return a==0&&l==0||(1<(r=((n[0]-i)*a+(n[1]-o)*l)/mI(a,l))?(i=t[0],o=t[1]):0<r&&(i+=a*r,o+=l*r)),mI(n[0]-i,n[1]-o)}function _ye(n,e){for(var t,r=n[0],i=[r],o=1,a=n.length;o<a;o++)mye(t=n[o],r)>e&&(i.push(t),r=t);return r!==t&&i.push(t),i}function yI(n,e,t,r,i){for(var o,a=r,l=e+1;l<t;l++){var h=yye(n[l],n[e],n[t]);a<h&&(o=l,a=h)}r<a&&(1<o-e&&yI(n,e,o,r,i),i.push(n[o]),1<t-o)&&yI(n,o,t,r,i)}function vye(n,e){var t=n.length-1,r=[n[0]];return yI(n,0,t,e,r),r.push(n[t]),r}function bye(n,e,t){return e===void 0&&(e=1),t===void 0&&(t=!1),n.length<=2||(e=e*e,n=vye(n=t?n:_ye(n,e),e)),n}var wye=bye;function xye(n,e){return wye(n,e,!0)}var Eye=window&&window.__values||function(n){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&n[e],r=0;if(t)return t.call(n);if(n&&typeof n.length=="number")return{next:function(){return{value:(n=n&&r>=n.length?void 0:n)&&n[r++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},Fw=function(){function n(e,t){this.M=n._calculateAffineTransform(e,t),this.inverseM=n._calculateAffineTransform(t,e)}return n.prototype.toTarget=function(e,t){return this.transformArray(e,this.M,t)},n.prototype.toSource=function(e,t){return this.transformArray(e,this.inverseM,t)},n.prototype.transformArray=function(e,t,r){var i,o;if(e&&Array.isArray(e)&&Array.isArray(e[0])){var a=[];try{for(var l=Eye(e),h=l.next();!h.done;h=l.next()){var p=h.value;a.push(this.transform(p,t,r))}}catch(g){i={error:g}}finally{try{h&&!h.done&&(o=l.return)&&o.call(l)}finally{if(i)throw i.error}}return a}return null},n.prototype.transform=function(o,t,r){var i=o[0]*t[0][3]+o[1]*t[1][3]+t[2][3],o=o[0]*t[0][4]+o[1]*t[1][4]+t[2][4];return typeof r=="number"&&0<=r?[ns(i,r),ns(o,r)]:[ns(i,6),ns(o,6)]},n._calculateAffineTransform=function(e,t){if(e.length!==t.length||e.length<1)throw new Error("Error: source and target arrays must have the same length.");var r=Math.min(e[0].length,t[0].length),i=r+1;if(e.length<r)throw new Error("Erorr: At least "+r+" reference points required.");for(var o=[],a=[],l=0;l<i;l++){a[l]=[];for(var h=0;h<i;h++){h<r&&(o[h]=0);for(var p=a[l][h]=0;p<e.length;p++)h<r&&(o[h]+=l<r?e[p][l]*t[p][h]:t[p][h]),a[l][h]+=r<=l&&r<=h?1:r<=l?e[p][h]:r<=h?e[p][l]:e[p][l]*e[p][h]}a[l]=a[l].concat(o)}if(this._gaussJordanElimination(a))return a;throw new Error("Error: Singular matrix. Points are likely coplanar.")},n._gaussJordanElimination=function(e){for(var t,r=e.length,i=2*r-1,o=0;o<r;o++){for(var a=o,l=o+1;l<r;l++)Math.abs(e[l][o])>Math.abs(e[a][o])&&(a=l);if(t=e[a],e[a]=e[o],e[o]=t,Math.abs(e[o][o])<=1e-12)return!1;for(var h=o+1;h<r;h++)for(var p=e[h][o]/e[o][o],g=o;g<i;g++)e[h][g]-=e[o][g]*p}for(o=r-1;-1<o;o--){for(p=e[o][o],l=0;l<o;l++)for(var _=i-1;o-1<_;_--)e[l][_]-=e[o][_]*e[l][o]/p;e[o][o]/=p;for(var x=r;x<i;x++)e[o][x]/=p}return!0},n}(),Tye=Object.freeze({__proto__:null,get AccelerationUnits(){return Sr},AffineTransform:Fw,get AreaUnits(){return yi},get DistanceUnits(){return Cr},get SpeedUnits(){return ei},get TimeUnits(){return ti},WEBMERCATOR_MAXLAT:k0,_precision:ns,boundingBoxToPolygon:qme,convertAcceleration:_T,convertArea:Cz,convertDistance:Tu,convertSpeed:Wf,convertTimespan:_y,getAcceleration:Az,getAccelerationFromFeatures:Xme,getAccelerationFromSpeeds:Iz,getArea:Pz,getCardinalSpline:$me,getClosestPointOnGeometry:Bx,getConvexHull:tye,getDestination:yy,getDistanceTo:ss,getEarthRadius:oR,getGeodesicPath:Wme,getGeodesicPaths:Yme,getHeading:Yh,getLengthOfPath:sR,getPathDenormalizedAtAntimerian:aR,getPathSplitByAntimeridian:wz,getPixelHeading:Zme,getPointWithHeadingAlongPath:Mz,getPointsWithHeadingsAlongPath:rye,getPosition:Ua,getPositionAlongPath:xz,getPositions:cf,getPositionsAlongPath:nye,getRegularPolygonPath:Tz,getRegularPolygonPaths:Kme,getSpeed:Qme,getSpeedFromFeatures:Jme,getTimespan:lR,getTravelDistance:eye,interpolate:pI,mercatorPixelsToPositions:cR,mercatorPositionsToPixels:pb,normalizeLatitude:ho,normalizeLongitude:$i,parseTimestamp:gI,rotatePositions:Sz,simplify:xye}),Sye=window&&window.__extends||function(){var n=function(e,t){return(n=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(r,i){r.__proto__=i}:function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])}))(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),Cye=function(n){function e(){var t=n!==null&&n.apply(this,arguments)||this;return t.zoomDelta=1,t.style=Jo.light,t}return Sye(e,n),e}(wi),Aye=window&&window.__extends||function(){var n=function(e,t){return(n=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(r,i){r.__proto__=i}:function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])}))(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),Iye=function(n){function e(t){var r=n.call(this)||this;return r.container=null,r.zoomInButton=null,r.zoomOutButton=null,r.zoomChanged=function(i){return r.updateZoomButtonsState()},r.minZoomChanged=function(i){return r.updateZoomButtonsState()},r.maxZoomChanged=function(i){return r.updateZoomButtonsState()},r.options=new Cye().merge(t),r}return Aye(e,n),e.prototype.onAdd=function(t){this.container=this.buildContainer(t,this.options.style,"Zoom Control"),this.container.style.flexDirection="column",this.zoomInButton=this.constructZoomInButton(t),this.zoomOutButton=this.constructZoomOutButton(t);var r=ea("Zoom In"),i=ea("Zoom Out");return this.container.appendChild(this.zoomInButton),this.container.appendChild(r),this.container.appendChild(this.zoomOutButton),this.container.appendChild(i),Li(r,this.zoomInButton),Li(i,this.zoomOutButton),t.events.add("zoom",this.zoomChanged),t.events.add("minzoomchanged",this.minZoomChanged),t.events.add("maxzoomchanged",this.maxZoomChanged),this.map=t,this.container},e.prototype.onRemove=function(){n.prototype.onRemove.call(this),this.map&&(this.map.events.remove("zoom",this.zoomChanged),this.map.events.remove("minzoomchanged",this.minZoomChanged),this.map.events.remove("maxzoomchanged",this.maxZoomChanged),this.map=null),this.container&&(this.container.remove(),this.container=null,this.zoomInButton=null,this.zoomOutButton=null)},e.prototype.updateZoomButtonsState=function(){var t=this.map.getCamera().zoom>=this.map._getMap().getMaxZoom(),r=lr.getSouth(this.map.getCamera().bounds)<=-k0&&lr.getNorth(this.map.getCamera().bounds)>=k0,r=this.map.getCamera().zoom<=this.map._getMap().getMinZoom()||r;this.zoomInButton&&this.zoomInButton.disabled!=t&&(this.zoomInButton.disabled=t,this.zoomInButton.setAttribute("aria-label",t?"Zoom In disabled":"Zoom In")),this.zoomOutButton&&this.zoomOutButton.disabled!=r&&(this.zoomOutButton.disabled=r,this.zoomOutButton.setAttribute("aria-label",t?"Zoom Out disabled":"Zoom Out"))},e.prototype.constructZoomInButton=function(t){var r=this,i=document.createElement("button");return i.classList.add("azure-maps-control-button"),i.classList.add("zoom-in"),i.setAttribute("aria-label","Zoom In"),i.setAttribute("alt","Zoom In"),i.setAttribute("type","button"),i.addEventListener("click",function(){var o;t.setCamera({maxBounds:(o=t._getMap().getMaxBounds())==null?void 0:o.toArray().flat(),zoom:t.getCamera().zoom+r.options.zoomDelta,duration:e.ZOOM_DURATION_MS,type:"ease"},!0)}),i},e.prototype.constructZoomOutButton=function(t){var r=this,i=document.createElement("button");return i.classList.add("azure-maps-control-button"),i.classList.add("zoom-out"),i.setAttribute("aria-label","Zoom Out"),i.setAttribute("alt","Zoom Out"),i.setAttribute("type","button"),i.addEventListener("click",function(){var o;t.setCamera({maxBounds:(o=t._getMap().getMaxBounds())==null?void 0:o.toArray().flat(),zoom:t.getCamera().zoom-r.options.zoomDelta,duration:e.ZOOM_DURATION_MS,type:"ease"},!0)}),i},e.ZOOM_DURATION_MS=200,e}(sc),Pye=Object.freeze({__proto__:null,CompassControl:L8,ControlBase:sc,PitchControl:$ae,ScaleControl:Yae,StyleControl:Bge,TrafficControl:gz,TrafficLegendControl:Gge,ZoomControl:Iye}),Mye=sz,Rye=1,kye=4;function Oye(n,e){return Mye(n,Rye|kye,e=typeof e=="function"?e:void 0)}var Ar=dd(Oye),Lye=function(){function n(e){var t=this;this.attach=function(r){t.map!==r&&(t.map&&t.detachFromCurrentMap(),t.map=r,t.map.indicators._getCollectionDiv().appendChild(t.element),t.map.indicators.add(t))},this.remove=function(){t.detachFromCurrentMap(),t.element.remove()},this.getElement=function(){return t.element},this.detachFromCurrentMap=function(){t.map&&(t.map.indicators.remove(t),delete t.map)},this.element=document.createElement("div"),this.element.setAttribute("tabindex","0"),this.element.setAttribute("role","option"),e!=null&&e.setSize&&this.element.setAttribute("aria-setsize",e.setSize.toString()),e!=null&&e.positionInSet&&this.element.setAttribute("aria-posinset",e.positionInSet.toString()),this.element.setAttribute("aria-label","data point"),this.element.classList.add(n.Css.hidden)}return n.Css={hidden:"hidden-accessible-element"},n}(),Nye=window&&window.__extends||function(){var n=function(e,t){return(n=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(r,i){r.__proto__=i}:function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])}))(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),T3=function(n){function e(){var t=n!==null&&n.apply(this,arguments)||this;return t.buffer=128,t.maxZoom=18,t.cluster=!1,t.clusterRadius=50,t.clusterMaxZoom=void 0,t.clusterProperties=void 0,t.lineMetrics=!1,t.tolerance=.375,t.clusterMinPoints=2,t.generateId=!1,t.promoteId=void 0,t.filter=void 0,t}return Nye(e,n),e}(wi),Dye=window&&window.__extends||function(){var n=function(e,t){return(n=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(r,i){r.__proto__=i}:function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])}))(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),bi=function(n){function e(t){var r=n.call(this)||this;return r.id=t||qf(),r}return Dye(e,n),e.prototype.getId=function(){return this.id},e.prototype._setMap=function(t,r){var i;r===void 0&&(r=!0),t==null||t===void 0?(i=this.map,delete this.map,r&&(this._invokeEvent("sourceremoved",this),i)&&i.events.invoke("sourceremoved",this)):(this.map=t,r&&(this._invokeEvent("sourceadded",this),this.map.events.invoke("sourceadded",this)))},e}(Du),Fye=window&&window.__extends||function(){var n=function(e,t){return(n=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(r,i){r.__proto__=i}:function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])}))(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),Y1=window&&window.__values||function(n){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&n[e],r=0;if(t)return t.call(n);if(n&&typeof n.length=="number")return{next:function(){return{value:(n=n&&r>=n.length?void 0:n)&&n[r++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},Ps=function(n){function e(t,r){return t=n.call(this,t)||this,t.requestId=void 0,t.options=new T3().merge(ao(r)),t.shapes=[],t.shapesMap=new Ls,t}return Fye(e,n),e.prototype.add=function(t,r){this._addNoUpdate(t,r),this._updateSource()},e.prototype.clear=function(){this._clearNoUpdate(),this._updateSource()},e.prototype.dispose=function(){this.options=null,this.shapes=null,this.shapesMap=null,this.map=null},e.prototype.getClusterExpansionZoom=function(t){var r=this;return new Promise(function(i,o){var a;r.map?(a=r.map._getMap().getSource(r.getId()))&&a.type==="geojson"&&a.getClusterExpansionZoom(t).then(function(l){typeof l=="number"&&i(l)}).catch(function(l){l&&o(l)}):o("The DataSource hasn't been added to a map.")})},e.prototype.getClusterChildren=function(t){var r=this;return new Promise(function(i,o){var a;r.map?(a=r.map._getMap().getSource(r.getId()))&&a.type==="geojson"&&a.getClusterChildren(t).then(function(l){l&&i(r.map.sources._mapFeaturesToShapes(l,!1,r))}).catch(function(l){l&&o(l)}):o("The DataSource hasn't been added to a map.")})},e.prototype.getClusterLeaves=function(t,r,i){var o=this;return new Promise(function(a,l){var h;o.map?(h=o.map._getMap().getSource(o.getId()))&&h.type==="geojson"&&h.getClusterLeaves(t,r,i).then(function(p){p&&a(o.map.sources._mapFeaturesToShapes(p,!1,o))}).catch(function(p){p&&l(p)}):l("The DataSource hasn't been added to a map.")})},e.prototype.getOptions=function(){return ao(this.options)},e.prototype.getShapes=function(){return Array.from(this.shapes)},e.prototype.importDataFromUrl=function(t){var r=this;return fetch(t,{method:"GET",mode:"cors"}).then(function(i){if(i.ok)return i.json();throw new Error("HTTP ".concat(i.status,": ").concat(i.statusText))}).then(function(i){r.add(i)})},e.prototype.getShapeById=function(t){return this.shapes[this.shapesMap.get(t)]||null},e.prototype.remove=function(o){var r,i,o=Array.isArray(o)?o:[o];try{for(var a=Y1(o),l=a.next();!l.done;l=a.next()){var h=l.value;typeof h=="number"?this._removeByIndex(h):this._removeById(h)}}catch(p){r={error:p}}finally{try{l&&!l.done&&(i=a.return)&&i.call(a)}finally{if(r)throw r.error}}this._updateSource()},e.prototype.removeById=function(o){var r,i,o=Array.isArray(o)?o:[o];try{for(var a=Y1(o),l=a.next();!l.done;l=a.next()){var h=l.value;this._removeById(h)}}catch(p){r={error:p}}finally{try{l&&!l.done&&(i=a.return)&&i.call(a)}finally{if(r)throw r.error}}this._updateSource()},e.prototype.setOptions=function(t){t=new T3().merge(this.options,ao(t)),Ba(this.options,t)||(this._invokeEvent("datasourceupdated",this),this.options=t,this.map&&this.map._rebuildStyle())},e.prototype.setShapes=function(t){this._clearNoUpdate(),this.add(t)},e.prototype.toJson=function(){return new yf(this.shapes.map(function(t){return t.toJson()}))},e.prototype._toJson=function(){return new yf(this.shapes.map(function(t){return t._toJson()}))},e.prototype._buildSource=function(){var t={type:"geojson",data:this._toJson(),maxzoom:this.options.maxZoom,cluster:this.options.cluster,clusterRadius:this.options.clusterRadius,tolerance:this.options.tolerance,lineMetrics:this.options.lineMetrics,clusterProperties:this.options.clusterProperties,buffer:this.options.buffer,clusterMinPoints:this.options.clusterMinPoints,generateId:this.options.generateId,promoteId:this.options.promoteId,filter:this.options.filter};return typeof this.options.clusterMaxZoom=="number"&&(t.clusterMaxZoom=this.options.clusterMaxZoom),t},e.prototype._isDeepEqual=function(t){var r;return this.constructor===t.constructor&&(r=this._buildSource(),t=t._buildSource(),r.type===t.type)&&r.maxzoom===t.maxzoom&&r.cluster===t.cluster&&r.clusterRadius===t.clusterRadius&&r.tolerance===t.tolerance&&r.lineMetrics===t.lineMetrics&&JSON.stringify(r.clusterProperties)===JSON.stringify(t.clusterProperties)&&r.buffer===t.buffer&&r.clusterMinPoints===t.clusterMinPoints&&r.generateId===t.generateId&&r.promoteId===t.promoteId&&r.filter===t.filter},e.prototype._addNoUpdate=function(t,r){var i;t instanceof Ii?(this._addToSources(t,r),i=[t]):Array.isArray(t)?(i=t.map(function(o){return o instanceof Ii?o:new Ii(o)}),this._addToSources(i,r)):t.type==="FeatureCollection"?(i=t.features.map(function(o){return new Ii(o)}),this._addToSources(i,r)):t.type==="GeometryCollection"?(i=t.geometries.map(function(o){return new Ii(o)}),this._addToSources(i,r)):(t=new Ii(t),this._addToSources(t,r),i=[t]),this._invokeEvent("dataadded",i)},e.prototype._clearNoUpdate=function(){var t=this.shapes;this.shapes=[],this.shapesMap=new Ls,t&&0<t.length&&this._invokeEvent("dataremoved",t)},e.prototype._updateSource=function(){var t=this;this.requestId===void 0&&(this.requestId=requestAnimationFrame(function(){t._updateMboxSource(),t.requestId=void 0}))},e.prototype._addToSources=function(t,r){var i,o,a,l;if(t=Array.isArray(t)?t:[t],typeof r!="number")try{for(var h=Y1(t),p=h.next();!p.done;p=h.next()){var g=p.value;this.shapes.push(g),this.shapesMap.set(g.getId(),this.shapes.length-1)}}catch(M){i={error:M}}finally{try{p&&!p.done&&(o=h.return)&&o.call(h)}finally{if(i)throw i.error}}else for(var _=t.length-1;0<=_;_--)this.shapes.splice(r,0,t[_]),this._updateShapesMap(r);try{for(var x=Y1(t),C=x.next();!C.done;C=x.next())(g=C.value)._setDataSource(this)}catch(M){a={error:M}}finally{try{C&&!C.done&&(l=x.return)&&l.call(x)}finally{if(a)throw a.error}}},e.prototype._removeById=function(r){var r=r instanceof Ii?r.getId():typeof r=="string"||typeof r=="number"?r:r.id,i=this.shapes[this.shapesMap.get(r)];i&&(i._setDataSource(null),this.shapes.splice(this.shapesMap.get(r),1),this._updateShapesMap(this.shapesMap.get(r)),this.shapesMap.delete(r),this._invokeEvent("dataremoved",[i]))},e.prototype._removeByIndex=function(t){var r;if(t>=this.shapes.length)throw new Error("The specified remove index '".concat(t,"' ")+"is greater than the maximum possible index '".concat(this.shapes.length-1,"'"));r=this.shapes[t],this.shapesMap.delete(r.getId()),r._setDataSource(null),this.shapes.splice(t,1),this._updateShapesMap(t),this._invokeEvent("dataremoved",[r])},e.prototype._updateShapesMap=function(t){for(var r=t;r<this.shapes.length;r++)this.shapesMap.set(this.shapes[r].getId(),r)},e.prototype._updateMboxSource=function(){var t;this.map&&this.map._getMap()&&(t=this.map._getMap().getSource(this.getId()))&&t.type==="geojson"&&t.setData(this._toJson())},e}(bi),Bye=window&&window.__extends||function(){var n=function(e,t){return(n=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(r,i){r.__proto__=i}:function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])}))(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),Rz=function(n){function e(){var t=n!==null&&n.apply(this,arguments)||this;return t.bounds=void 0,t.minZoom=0,t.maxZoom=22,t.isTMS=!1,t.tiles=void 0,t.url=void 0,t}return Bye(e,n),e}(wi),Uye=window&&window.__extends||function(){var n=function(e,t){return(n=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(r,i){r.__proto__=i}:function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])}))(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),kz=function(n){function e(t,r){return t=n.call(this,t)||this,t.options=new Rz().merge(ao(r)),t}return Uye(e,n),e.prototype.getOptions=function(){return ao(this.options)},e.prototype.getShape=function(t,r){return this.map._getMap().querySourceFeatures(this.getId(),{sourceLayer:t,filter:r})},e.prototype._buildSource=function(){var t={type:"vector"};return this.options.bounds&&(t.bounds=this.options.bounds),this.options.tiles?(t.tiles=this.options.tiles,t.minzoom=this.options.minZoom,t.maxzoom=this.options.maxZoom):this.options.url&&(t.url=this.options.url),this.options.isTMS&&(t.scheme="tms"),t},e.prototype._isDeepEqual=function(t){var r,i;return this.constructor===t.constructor&&(r=this._buildSource(),i=t._buildSource(),r.type===i.type)&&r.url===i.url&&(r.tiles===void 0&&i.tiles===void 0||r.tiles&&i.tiles&&r.tiles.length===i.tiles.length&&r.tiles.every(function(o,a){return o===i.tiles[a]}))&&r.minzoom===i.minzoom&&r.maxzoom===i.maxzoom&&r.bounds===i.bounds&&r.attribution===i.attribution&&r.promoteId===i.promoteId&&r.scheme===i.scheme},e}(bi),zye=window&&window.__extends||function(){var n=function(e,t){return(n=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(r,i){r.__proto__=i}:function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])}))(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),Oz=function(n){function e(t,r,i){return t=n.call(this,t)||this,t.source=r,t}return zye(e,n),e.prototype._isDeepEqual=function(t){var r;return this.constructor===t.constructor&&(r=this.source,t=t.source,r.type===t.type)&&r.canvas===t.canvas&&JSON.stringify(r.coordinates)===JSON.stringify(t.coordinates)&&r.animate===t.animate},e.prototype._buildSource=function(){return this.source},e}(bi),jye=window&&window.__extends||function(){var n=function(e,t){return(n=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(r,i){r.__proto__=i}:function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])}))(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),Lz=function(n){function e(t,r,i){return t=n.call(this,t)||this,t.source=r,t}return jye(e,n),e.prototype._isDeepEqual=function(t){var r;return this.constructor===t.constructor&&(r=this.source,t=t.source,r.type===t.type)},e.prototype._buildSource=function(){return this.source},e}(bi),Vye=window&&window.__extends||function(){var n=function(e,t){return(n=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(r,i){r.__proto__=i}:function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])}))(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),uR=function(n){function e(t,r,i){return t=n.call(this,t)||this,t.source=r,t}return Vye(e,n),e.prototype._isDeepEqual=function(t){var r;return this.constructor===t.constructor&&(r=this.source,t=t.source,r.type===t.type)&&JSON.stringify(r.coordinates)===JSON.stringify(t.coordinates)&&r.url===t.url},e.prototype._buildSource=function(){return this.source},e}(bi),Hye=window&&window.__extends||function(){var n=function(e,t){return(n=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(r,i){r.__proto__=i}:function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])}))(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),Nz=function(n){function e(t,r,i){return t=n.call(this,t)||this,t.source=r,t}return Hye(e,n),e.prototype._isDeepEqual=function(t){var r;return this.constructor===t.constructor&&(r=this.source,t=t.source,r.type===t.type)&&JSON.stringify(r.coordinates)===JSON.stringify(t.coordinates)&&r.urls===t.urls},e.prototype._buildSource=function(){return this.source},e}(bi),Gye=window&&window.__extends||function(){var n=function(e,t){return(n=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(r,i){r.__proto__=i}:function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])}))(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),qye=function(n){function e(){var t=n!==null&&n.apply(this,arguments)||this;return t.tileSize=512,t}return Gye(e,n),e}(Rz),$ye=window&&window.__extends||function(){var n=function(e,t){return(n=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(r,i){r.__proto__=i}:function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])}))(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),Wye=function(n){function e(){var t=n!==null&&n.apply(this,arguments)||this;return t.encoding=void 0,t}return $ye(e,n),e}(qye),Yye=window&&window.__extends||function(){var n=function(e,t){return(n=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(r,i){r.__proto__=i}:function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])}))(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),Dz=window&&window.__assign||function(){return(Dz=Object.assign||function(n){for(var e,t=1,r=arguments.length;t<r;t++)for(var i in e=arguments[t])Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i]);return n}).apply(this,arguments)},Kye=function(n){function e(t,r){return t=n.call(this,t)||this,t.options=new Wye().merge(ao(r)),t}return Yye(e,n),e.prototype.getOptions=function(){return ao(this.options)},e.prototype._buildSource=function(){return Dz({type:"raster-dem",bounds:this.options.bounds,minzoom:this.options.minZoom,maxzoom:this.options.maxZoom,tileSize:this.options.tileSize,encoding:this.options.encoding},this.options.tiles?{tiles:this.options.tiles}:{url:this.options.url})},e.prototype._isDeepEqual=function(t){return this.constructor===t.constructor&&(t=t.getOptions(),this.options.url===t.url)&&this.options.tiles===t.tiles&&this.options.bounds===t.bounds&&this.options.minZoom===t.minZoom&&this.options.maxZoom===t.maxZoom&&this.options.tileSize===t.tileSize&&this.options.encoding===t.encoding},e}(bi),Zye=Object.freeze({__proto__:null,CanvasSource:Oz,DataSource:Ps,ElevationTileSource:Kye,ImageSource:uR,Source:bi,UnknownSource:Lz,VectorTileSource:kz,VideoSource:Nz}),Xye=window&&window.__extends||function(){var n=function(e,t){return(n=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(r,i){r.__proto__=i}:function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])}))(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),Ai=function(n){function e(t){var r=n.call(this)||this;return r.id=t||qf(),r}return Xye(e,n),e.prototype.getId=function(){return this.id},e.prototype.getMap=function(){return this.map||null},e.prototype.onAdd=function(t){this.map=t,this._invokeEvent("layeradded",this),this.map.events.invoke("layeradded",this)},e.prototype.onRemove=function(){var t=this.map;delete this.map,this._invokeEvent("layerremoved",this),t&&t.events.invoke("layerremoved",this)},e._isMBoxEvent=function(t){return!this.LayerEvents.hasOwnProperty(t)},e.prototype._updateBaseProperties=function(t,r){this._updateFilter(t.filter,r.filter),this._updateZoomRange(t.minZoom,r.minZoom,t.maxZoom,r.maxZoom),this._updateLayoutProperty("visibility",t.visible,r.visible,t.visible?"visible":"none")},e.prototype._updateFilter=function(t,r){Ba(t,r)||this.map._getMap().setFilter(this.id,t)},e.prototype._updatePaintProperty=function(t,r,i,o){Ba(r,i)||this.map._getMap().setPaintProperty(this.id,t,o||r)},e.prototype._updateLayoutProperty=function(t,r,i,o){Ba(r,i)||this.map._getMap().setLayoutProperty(this.id,t,o||r)},e.prototype._updateZoomRange=function(t,r,i,o){t===r&&o===i||this.map._getMap().setLayerZoomRange(this.id,t,i)},e.LayerEvents={layeradded:void 0,layerremoved:void 0,focusin:void 0,focusout:void 0},e}(Du),Qye=window&&window.__extends||function(){var n=function(e,t){return(n=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(r,i){r.__proto__=i}:function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])}))(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),pd=function(n){function e(){var t=n!==null&&n.apply(this,arguments)||this;return t.filter=void 0,t.minZoom=0,t.maxZoom=24,t.visible=!0,t}return Qye(e,n),e._cloneCustomizer=function(t){if(t instanceof bi)return t},e}(wi),Jye=window&&window.__extends||function(){var n=function(e,t){return(n=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(r,i){r.__proto__=i}:function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])}))(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),F_=function(n){function e(){var t=n!==null&&n.apply(this,arguments)||this;return t.source=void 0,t.sourceLayer=void 0,t.color="#1A73AA",t.blur=0,t.opacity=1,t.strokeColor="#FFFFFF",t.strokeOpacity=1,t.strokeWidth=2,t.pitchAlignment="viewport",t.radius=8,t.createIndicators=!1,t.accessibilityIdKey=void 0,t}return Jye(e,n),e}(pd),e_e=window&&window.__extends||function(){var n=function(e,t){return(n=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(r,i){r.__proto__=i}:function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])}))(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),t_e=window&&window.__awaiter||function(n,e,t,r){return new(t=t||Promise)(function(i,o){function a(p){try{h(r.next(p))}catch(g){o(g)}}function l(p){try{h(r.throw(p))}catch(g){o(g)}}function h(p){var g;p.done?i(p.value):((g=p.value)instanceof t?g:new t(function(_){_(g)})).then(a,l)}h((r=r.apply(n,e||[])).next())})},n_e=window&&window.__generator||function(n,e){var t,r,i,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]},a={next:l(0),throw:l(1),return:l(2)};return typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function l(h){return function(p){var g=[h,p];if(t)throw new TypeError("Generator is already executing.");for(;o=a&&g[a=0]?0:o;)try{if(t=1,r&&(i=2&g[0]?r.return:g[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,g[1])).done)return i;switch(r=0,(g=i?[2&g[0],i.value]:g)[0]){case 0:case 1:i=g;break;case 4:return o.label++,{value:g[1],done:!1};case 5:o.label++,r=g[1],g=[0];continue;case 7:g=o.ops.pop(),o.trys.pop();continue;default:if(!(i=0<(i=o.trys).length&&i[i.length-1])&&(g[0]===6||g[0]===2)){o=0;continue}if(g[0]===3&&(!i||g[1]>i[0]&&g[1]<i[3]))o.label=g[1];else if(g[0]===6&&o.label<i[1])o.label=i[1],i=g;else{if(!(i&&o.label<i[2])){i[2]&&o.ops.pop(),o.trys.pop();continue}o.label=i[2],o.ops.push(g)}}g=e.call(n,o)}catch(_){g=[6,_],r=0}finally{t=i=0}if(5&g[0])throw g[1];return{value:g[0]?g[1]:void 0,done:!0}}}},S3=window&&window.__read||function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var r,i,o=t.call(n),a=[];try{for(;(e===void 0||0<e--)&&!(r=o.next()).done;)a.push(r.value)}catch(l){i={error:l}}finally{try{r&&!r.done&&(t=o.return)&&t.call(o)}finally{if(i)throw i.error}}return a},C3=window&&window.__spreadArray||function(n,e,t){if(t||arguments.length===2)for(var r,i=0,o=e.length;i<o;i++)!r&&i in e||((r=r||Array.prototype.slice.call(e,0,i))[i]=e[i]);return n.concat(r||Array.prototype.slice.call(e))},_I=function(n){function e(t,r,i){var o=n.call(this,r)||this;return o.accessibleIndicator=[],o._setAccessibleIndicator=function(){return t_e(o,void 0,void 0,function(){var a,l,h,p,g,_,x=this;return n_e(this,function(C){return this.accessibleIndicator.forEach(function(M){return M.remove()}),this.accessibleIndicator=[],a=this.map.layers.getRenderedShapes(this.map.getCamera().bounds,this),l=this.options.accessibilityIdKey||(this._getDataSource()?Ii._shapeIdPropName:void 0),h=function(M,L){var D=M[L],z=D instanceof Ii?D.toJson():D,te=new Lye({positionInSet:L+1,setSize:M.length}),le=te.getElement(),ce=S3(x.map.positionsToPixels([x.getFirstCoordinate(z.geometry.coordinates)]),1)[0];return le.addEventListener("focusin",function(_e){x.accessibleIndicator.filter(function(J){return J!==te}).forEach(function(J){return J.remove()}),0<=L-1&&p(te,h(M,L-1)),L+1<M.length&&_(h(M,L+1)),2<=L&&L==M.length-1&&g(h(M,0)),L==0&&2<=M.length&&_(h(M,M.length-1)),l!==void 0&&x.map._getMap().setPaintProperty(x.id,"circle-stroke-color",["case",["==",["get",l],z.properties[l]],"#000000",x.options.strokeColor]),_e={target:le,type:"focusin",map:x.map,shape:D,originalEvent:_e,pixel:ce},x._invokeEvent("focusin",_e)}),le.addEventListener("focusout",function(_e){l!==void 0&&x.map._getMap().setPaintProperty(x.id,"circle-stroke-color",["case",["==",["get",l],z.properties[l]],x.options.strokeColor,x.options.strokeColor]),_e={target:le,type:"focusout",map:x.map,shape:D,originalEvent:_e,pixel:ce},x._invokeEvent("focusout",_e)}),x.accessibleIndicator.push(te),te},p=function(M,L){L.attach(x.map),L=L.getElement(),M=M.getElement(),M.parentElement.insertBefore(L,M)},g=function(L){L.attach(x.map);var L=L.getElement(),D=L.parentElement;D.insertBefore(L,D.firstElementChild)},_=function(M){M.attach(x.map)},0<a.length&&_(h(a,0)),1<a.length&&_(h(a,a.length-1)),[2]})})},o.options=new F_().merge(Ar(i,F_._cloneCustomizer)),o.options.source=t||o.options.source,o}return e_e(e,n),e.prototype.getOptions=function(){return Ar(this.options,F_._cloneCustomizer)},e.prototype.getSource=function(){return this.options.source},e.prototype.setOptions=function(t){if(t=new F_().merge(this.options,Ar(t,F_._cloneCustomizer)),this.map){if(t.source!==this.options.source||t.sourceLayer!==this.options.sourceLayer)return this.options=t,void this.map.layers.add(this);this._updateBaseProperties(t,this.options),this._updatePaintProperty("circle-blur",t.blur,this.options.blur),this._updatePaintProperty("circle-color",t.color,this.options.color),this._updatePaintProperty("circle-opacity",t.opacity,this.options.opacity),this._updatePaintProperty("circle-radius",t.radius,this.options.radius),this._updatePaintProperty("circle-stroke-color",t.strokeColor,this.options.strokeColor),this._updatePaintProperty("circle-stroke-opacity",t.strokeOpacity,this.options.strokeOpacity),this._updatePaintProperty("circle-stroke-width",t.strokeWidth,this.options.strokeWidth),this._updatePaintProperty("circle-pitch-alignment",t.pitchAlignment,this.options.pitchAlignment)}this.options=t},e.prototype.onAdd=function(t){var r,i,o=this;n.prototype.onAdd.call(this,t),this.options.createIndicators&&(t.events.addOnce("idle",this._setAccessibleIndicator),t.events.add("moveend",this._setAccessibleIndicator),(r=this._getDataSource())?t.events.add("dataadded",r,function(){t.events.addOnce("idle",o._setAccessibleIndicator)}):(i=typeof this.options.source=="string"?this.options.source:this.options.source.getId(),t.events.add("sourcedata",function(a){((a=a.source)==null?void 0:a.getId())===i&&t._getMap().isSourceLoaded(i)&&(a=o._getSourceDataEventCacheKey())!==o.sourceDataEventCacheKey&&(o._setAccessibleIndicator(),o.sourceDataEventCacheKey=a)})))},e.prototype.onRemove=function(){var t;this.options.createIndicators&&(this.map.events.remove("idle",this._setAccessibleIndicator),this.map.events.remove("moveend",this._setAccessibleIndicator),(t=this._getDataSource())?this.map.events.remove("dataadded",t,this._setAccessibleIndicator):this.map.events.remove("sourcedata",this._setAccessibleIndicator)),n.prototype.onRemove.call(this)},e.prototype._getSourceDataEventCacheKey=function(){var t;if(this.map)return t=this.map.getServiceOptions().mapConfiguration,C3(C3([],S3(this.map.getCamera().bounds),!1),[this.map.getCamera().zoom,this.map.getCamera().pitch,this.map.getStyle().style,t instanceof Object?t.id:t],!1).join(",")},e.prototype._getDataSource=function(){var t=typeof this.options.source=="string"?this.map.sources.getById(this.options.source):this.options.source;if(t instanceof Ps)return t},e.prototype._buildLayers=function(){var t={id:this.id,type:"circle",source:this.options.source instanceof bi?this.options.source.getId():this.options.source,layout:{visibility:this.options.visible?"visible":"none"},paint:{"circle-color":this.options.color,"circle-blur":this.options.blur,"circle-opacity":this.options.opacity,"circle-stroke-color":this.options.strokeColor,"circle-stroke-opacity":this.options.strokeOpacity,"circle-stroke-width":this.options.strokeWidth,"circle-pitch-alignment":this.options.pitchAlignment,"circle-radius":this.options.radius},minzoom:this.options.minZoom,maxzoom:this.options.maxZoom};return this.options.filter&&(t.filter=this.options.filter),this.options.sourceLayer&&(t["source-layer"]=this.options.sourceLayer),[t]},e.prototype._getLayerIds=function(){return[this.id]},e.prototype._getSourceIds=function(){var t=new Set;return this.options.source instanceof bi?t.add(this.options.source.getId()):t.add(this.options.source),t},e.prototype.getFirstCoordinate=function(t){return Array.isArray(t[0])?this.getFirstCoordinate(t[0]):t},e}(Ai),r_e=window&&window.__extends||function(){var n=function(e,t){return(n=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(r,i){r.__proto__=i}:function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])}))(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),B_=function(n){function e(){var t=n!==null&&n.apply(this,arguments)||this;return t.source=void 0,t.sourceLayer=void 0,t.color=["interpolate",["linear"],["heatmap-density"],0,"rgba(0,0, 255,0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],t.intensity=1,t.opacity=1,t.radius=30,t.weight=1,t}return r_e(e,n),e._cloneCustomizer=function(t){if(t instanceof bi)return t},e}(pd),i_e=window&&window.__extends||function(){var n=function(e,t){return(n=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(r,i){r.__proto__=i}:function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])}))(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),o_e=function(n){function e(t,r,i){return r=n.call(this,r)||this,r.options=new B_().merge(Ar(i,B_._cloneCustomizer)),r.options.source=t||r.options.source,r}return i_e(e,n),e.prototype.getOptions=function(){return Ar(this.options,B_._cloneCustomizer)},e.prototype.getSource=function(){return this.options.source},e.prototype.setOptions=function(t){if(t=new B_().merge(this.options,Ar(t,B_._cloneCustomizer)),this.map){if(t.source!==this.options.source||t.sourceLayer!==this.options.sourceLayer)return this.options=t,void this.map.layers.add(this);this._updateBaseProperties(t,this.options),this._updatePaintProperty("heatmap-color",t.color,this.options.color),this._updatePaintProperty("heatmap-intensity",t.intensity,this.options.intensity),this._updatePaintProperty("heatmap-opacity",t.opacity,this.options.opacity),this._updatePaintProperty("heatmap-radius",t.radius,this.options.radius),this._updatePaintProperty("heatmap-weight",t.weight,this.options.weight)}this.options=t},e.prototype._buildLayers=function(){var t={id:this.id,type:"heatmap",source:this.options.source instanceof bi?this.options.source.getId():this.options.source,layout:{visibility:this.options.visible?"visible":"none"},paint:{"heatmap-color":this.options.color,"heatmap-intensity":this.options.intensity,"heatmap-opacity":this.options.opacity,"heatmap-radius":this.options.radius,"heatmap-weight":this.options.weight},minzoom:this.options.minZoom,maxzoom:this.options.maxZoom};return this.options.filter&&(t.filter=this.options.filter),this.options.sourceLayer&&(t["source-layer"]=this.options.sourceLayer),[t]},e.prototype._getLayerIds=function(){return[this.id]},e.prototype._getSourceIds=function(){var t=new Set;return this.options.source instanceof bi?t.add(this.options.source.getId()):t.add(this.options.source),t},e}(Ai),a_e=window&&window.__extends||function(){var n=function(e,t){return(n=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(r,i){r.__proto__=i}:function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])}))(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),Fz=function(n){function e(){var t=n!==null&&n.apply(this,arguments)||this;return t.contrast=0,t.fadeDuration=300,t.hueRotation=0,t.maxBrightness=1,t.minBrightness=0,t.opacity=1,t.saturation=0,t}return a_e(e,n),e}(pd),s_e=window&&window.__extends||function(){var n=function(e,t){return(n=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(r,i){r.__proto__=i}:function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])}))(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),U_=function(n){function e(){var t=n!==null&&n.apply(this,arguments)||this;return t.url=void 0,t.coordinates=void 0,t}return s_e(e,n),e._cloneCustomizer=function(t){if(t instanceof bi)return t},e}(Fz),c_e=window&&window.__extends||function(){var n=function(e,t){return(n=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(r,i){r.__proto__=i}:function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])}))(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),qv=function(n){function e(){return n!==null&&n.apply(this,arguments)||this}return c_e(e,n),e.prototype._getSourceIds=function(){var t=new Set;return t.add(this._getSourceId()),t},e.prototype.onAdd=function(t){n.prototype.onAdd.call(this,t)},e}(Ai),l_e=window&&window.__extends||function(){var n=function(e,t){return(n=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(r,i){r.__proto__=i}:function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])}))(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),u_e=function(n){function e(t,r){return r=n.call(this,r)||this,r.isLoading=!1,r.options=new U_().merge(Ar(t,U_._cloneCustomizer)),r.img=new Image,r.reloadImage(),r}return l_e(e,n),e.prototype.getOptions=function(){return Ar(this.options,U_._cloneCustomizer)},e.prototype.setOptions=function(a){var r,i=new U_().merge(this.options,Ar(a,U_._cloneCustomizer)),o=typeof a.url=="string"&&a.url!==this.getOptions().url,a=a.coordinates!==void 0&&a.coordinates!==this.getOptions().coordinates;this.map&&(this._updateBaseProperties(i,this.options),this._updatePaintProperty("raster-contrast",i.contrast,this.options.contrast),this._updatePaintProperty("raster-fade-duration",i.fadeDuration,this.options.fadeDuration),this._updatePaintProperty("raster-hue-rotate",i.hueRotation,this.options.hueRotation),this._updatePaintProperty("raster-brightness-max",i.maxBrightness,this.options.maxBrightness),this._updatePaintProperty("raster-opacity",i.opacity,this.options.opacity),this._updatePaintProperty("raster-saturation",i.saturation,this.options.saturation),r=this.map._getMap().getSource(this._getSourceId()))&&r.updateImage(i),this.options=i,o?this.reloadImage():a&&this.updateTransform()},e.prototype.getPositions=function(t){return this.transform.then(function(r){return r.toTarget(t)})},e.prototype.getPixels=function(t){return this.transform.then(function(r){return r.toSource(t)})},e.getCoordinatesFromRefPoints=function(t,r,i,o){return new Fw(i,o).toTarget([[0,0],[t,0],[t,r],[0,r]])},e.getCoordinatesFromEdges=function(t,r,i,o,a){return typeof a!="number"&&(a=0),r=[Math.min(o,i),r,Math.max(o,i),t],o=lr.getCenter(r),Sz([lr.getNorthWest(r),lr.getNorthEast(r),lr.getSouthEast(r),lr.getSouthWest(r)],o,a)},e.prototype._buildLayers=function(){var t={id:this.id,type:"raster",source:this._getSourceId(),layout:{visibility:this.options.visible?"visible":"none"},paint:{"raster-opacity":this.options.opacity,"raster-hue-rotate":this.options.hueRotation,"raster-brightness-min":this.options.minBrightness,"raster-brightness-max":this.options.maxBrightness,"raster-saturation":this.options.saturation,"raster-contrast":this.options.contrast,"raster-fade-duration":this.options.fadeDuration},minzoom:this.options.minZoom,maxzoom:this.options.maxZoom};return this.options.filter&&(t.filter=this.options.filter),[t]},e.prototype._getLayerIds=function(){return[this.id]},e.prototype._buildSource=function(){return{type:"image",url:this.options.url,coordinates:this.options.coordinates}},e.prototype._getSourceId=function(){return"".concat(this.getId(),"-ImageSource")},e.prototype.reloadImage=function(){var t=this;this.options.url&&(this.transform=new Promise(function(r,i){t.img.onload=function(){var o=[[0,0],[t.img.width,0],[t.img.width,t.img.height],[0,t.img.height]];r(new Fw(o,t.options.coordinates)),t.isLoading=!1},t.img.onerror=t.img.onabort=function(){i("Failed to load image")},t.isLoading=!0,t.img.src=t.options.url}))},e.prototype.updateTransform=function(){var t;this.isLoading||(t=[[0,0],[this.img.width,0],[this.img.width,this.img.height],[0,this.img.height]],this.transform=Promise.resolve(new Fw(t,this.options.coordinates)))},e.prototype._getSourceWrapper=function(){var t=this._getSourceId(),r=this._buildSource();return new uR(t,r)},e}(qv),h_e=window&&window.__extends||function(){var n=function(e,t){return(n=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(r,i){r.__proto__=i}:function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])}))(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),z_=function(n){function e(){var t=n!==null&&n.apply(this,arguments)||this;return t.source=void 0,t.sourceLayer=void 0,t.lineCap="round",t.lineJoin="round",t.blur=0,t.strokeColor="#1E90FF",t.strokeDashArray=void 0,t.strokeGradient=void 0,t.offset=0,t.strokeOpacity=1,t.translate=new ta(0,0),t.translateAnchor="map",t.strokeWidth=2,t}return h_e(e,n),e}(pd),d_e=window&&window.__extends||function(){var n=function(e,t){return(n=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(r,i){r.__proto__=i}:function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])}))(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),xh=window&&window.__assign||function(){return(xh=Object.assign||function(n){for(var e,t=1,r=arguments.length;t<r;t++)for(var i in e=arguments[t])Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i]);return n}).apply(this,arguments)},vI=function(n){function e(t,r,i){return r=n.call(this,r)||this,r.options=new z_().merge(Ar(i,z_._cloneCustomizer)),r.options.source=t||r.options.source,r}return d_e(e,n),e.prototype.getOptions=function(){return Ar(this.options,z_._cloneCustomizer)},e.prototype.getSource=function(){return this.options.source},e.prototype.setOptions=function(t){if(t=new z_().merge(this.options,Ar(t,z_._cloneCustomizer)),this.map){if(t.source!==this.options.source||t.sourceLayer!==this.options.sourceLayer)return this.options=t,void this.map.layers.add(this);this._updateBaseProperties(t,this.options),this._updatePaintProperty("line-blur",t.blur,this.options.blur),this._updateLayoutProperty("line-cap",t.lineCap,this.options.lineCap),this._updateLayoutProperty("line-join",t.lineJoin,this.options.lineJoin),this._updatePaintProperty("line-offset",t.offset,this.options.offset),this._updatePaintProperty("line-color",t.strokeColor,this.options.strokeColor),this._updatePaintProperty("line-dasharray",t.strokeDashArray,this.options.strokeDashArray),this._updatePaintProperty("line-gradient",t.strokeGradient,this.options.strokeGradient),this._updatePaintProperty("line-opacity",t.strokeOpacity,this.options.strokeOpacity),this._updatePaintProperty("line-width",t.strokeWidth,this.options.strokeWidth),this._updatePaintProperty("line-translate",t.translate,this.options.translate),this._updatePaintProperty("line-translate-anchor",t.translateAnchor,this.options.translateAnchor)}this.options=t},e.prototype._buildLayers=function(){return[xh(xh(xh(xh({id:this.id,type:"line"},this.options.sourceLayer&&{"source-layer":this.options.sourceLayer}),{source:this.options.source instanceof bi?this.options.source.getId():this.options.source,layout:{visibility:this.options.visible?"visible":"none","line-cap":this.options.lineCap,"line-join":this.options.lineJoin},paint:xh(xh(xh({"line-blur":this.options.blur,"line-color":this.options.strokeColor},this.options.strokeDashArray?{"line-dasharray":this.options.strokeDashArray}:{}),this.options.strokeGradient?{"line-gradient":this.options.strokeGradient}:{}),{"line-offset":this.options.offset,"line-opacity":this.options.strokeOpacity,"line-translate":this.options.translate,"line-translate-anchor":this.options.translateAnchor,"line-width":this.options.strokeWidth})}),this.options.filter&&{filter:this.options.filter}),{minzoom:this.options.minZoom,maxzoom:this.options.maxZoom})]},e.prototype._getLayerIds=function(){return[this.id]},e.prototype._getSourceIds=function(){var t=new Set;return this.options.source instanceof bi?t.add(this.options.source.getId()):t.add(this.options.source),t},e}(Ai),f_e=window&&window.__extends||function(){var n=function(e,t){return(n=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(r,i){r.__proto__=i}:function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])}))(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),j_=function(n){function e(){var t=n!==null&&n.apply(this,arguments)||this;return t.source=void 0,t.sourceLayer=void 0,t.base=0,t.fillColor="#1E90FF",t.height=0,t.fillOpacity=1,t.fillPattern=void 0,t.translate=new ta(0,0),t.translateAnchor="map",t.verticalGradient=!0,t}return f_e(e,n),e}(pd),p_e=window&&window.__extends||function(){var n=function(e,t){return(n=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(r,i){r.__proto__=i}:function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])}))(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),nf=window&&window.__assign||function(){return(nf=Object.assign||function(n){for(var e,t=1,r=arguments.length;t<r;t++)for(var i in e=arguments[t])Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i]);return n}).apply(this,arguments)},g_e=function(n){function e(t,r,i){return r=n.call(this,r)||this,r.options=new j_().merge(Ar(i,j_._cloneCustomizer)),r.options.source=t||r.options.source,r}return p_e(e,n),e.prototype.getOptions=function(){return Ar(this.options,j_._cloneCustomizer)},e.prototype.getSource=function(){return this.options.source},e.prototype.setOptions=function(t){if(t=new j_().merge(this.options,Ar(t,j_._cloneCustomizer)),this.map){if(t.source!==this.options.source||t.sourceLayer!==this.options.sourceLayer)return this.options=t,void this.map.layers.add(this);this._updateBaseProperties(t,this.options),this._updatePaintProperty("fill-extrusion-base",t.base,this.options.base),this._updatePaintProperty("fill-extrusion-color",t.fillColor,this.options.fillColor),this._updatePaintProperty("fill-extrusion-height",t.height,this.options.height),this._updatePaintProperty("fill-extrusion-opacity",t.fillOpacity,this.options.fillOpacity),this._updatePaintProperty("fill-extrusion-pattern",t.fillPattern,this.options.fillPattern),this._updatePaintProperty("fill-extrusion-translate",t.translate,this.options.translate),this._updatePaintProperty("fill-extrusion-translate-anchor",t.translateAnchor,this.options.translateAnchor),this._updatePaintProperty("fill-extrusion-vertical-gradient",t.verticalGradient,this.options.verticalGradient)}this.options=t},e.prototype._buildLayers=function(){return[nf(nf(nf(nf({id:this.id,type:"fill-extrusion"},this.options.sourceLayer&&{"source-layer":this.options.sourceLayer}),{source:this.options.source instanceof bi?this.options.source.getId():this.options.source,layout:{visibility:this.options.visible?"visible":"none"},paint:nf(nf({"fill-extrusion-base":this.options.base,"fill-extrusion-height":this.options.height,"fill-extrusion-opacity":this.options.fillOpacity},this.options.fillPattern?{"fill-extrusion-pattern":this.options.fillPattern}:{"fill-extrusion-color":this.options.fillColor}),{"fill-extrusion-translate":this.options.translate,"fill-extrusion-translate-anchor":this.options.translateAnchor,"fill-extrusion-vertical-gradient":this.options.verticalGradient})}),this.options.filter&&{filter:this.options.filter}),{minzoom:this.options.minZoom,maxzoom:this.options.maxZoom})]},e.prototype._getLayerIds=function(){return[this.id]},e.prototype._getSourceIds=function(){var t=new Set;return this.options.source instanceof bi?t.add(this.options.source.getId()):t.add(this.options.source),t},e}(Ai),m_e=window&&window.__extends||function(){var n=function(e,t){return(n=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(r,i){r.__proto__=i}:function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])}))(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),V_=function(n){function e(){var t=n!==null&&n.apply(this,arguments)||this;return t.source=void 0,t.sourceLayer=void 0,t.fillColor="#1E90FF",t.fillOpacity=.5,t.fillPattern=void 0,t.fillAntialias=!0,t}return m_e(e,n),e}(pd),y_e=window&&window.__extends||function(){var n=function(e,t){return(n=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(r,i){r.__proto__=i}:function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])}))(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),bI=function(n){function e(t,r,i){return r=n.call(this,r)||this,r.options=new V_().merge(Ar(i,V_._cloneCustomizer)),r.options.source=t||r.options.source,r}return y_e(e,n),e.prototype.getOptions=function(){return Ar(this.options,V_._cloneCustomizer)},e.prototype.getSource=function(){return this.options.source},e.prototype.setOptions=function(t){if(t=new V_().merge(this.options,Ar(t,V_._cloneCustomizer)),this.map){if(t.source!==this.options.source||t.sourceLayer!==this.options.sourceLayer)return this.options=t,void this.map.layers.add(this);this._updateBaseProperties(t,this.options),this._updatePaintProperty("fill-color",t.fillColor,this.options.fillColor),this._updatePaintProperty("fill-opacity",t.fillOpacity,this.options.fillOpacity),this._updatePaintProperty("fill-pattern",t.fillPattern,this.options.fillPattern),this._updatePaintProperty("fill-antialias",t.fillAntialias,this.options.fillAntialias)}this.options=t},e.prototype._buildLayers=function(){var t={id:this.id,type:"fill",source:this.options.source instanceof bi?this.options.source.getId():this.options.source,layout:{visibility:this.options.visible?"visible":"none"},paint:{"fill-opacity":this.options.fillOpacity,"fill-antialias":this.options.fillAntialias},minzoom:this.options.minZoom,maxzoom:this.options.maxZoom};return this.options.filter&&(t.filter=this.options.filter),this.options.sourceLayer&&(t["source-layer"]=this.options.sourceLayer),this.options.fillPattern?t.paint["fill-pattern"]=this.options.fillPattern:t.paint["fill-color"]=this.options.fillColor,[t]},e.prototype._getLayerIds=function(){return[this.id]},e.prototype._getSourceIds=function(){var t=new Set;return this.options.source instanceof bi?t.add(this.options.source.getId()):t.add(this.options.source),t},e}(Ai),__e=window&&window.__extends||function(){var n=function(e,t){return(n=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(r,i){r.__proto__=i}:function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])}))(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),v_e=function(n){function e(){var t=n!==null&&n.apply(this,arguments)||this;return t.allowOverlap=!1,t.anchor="bottom",t.ignorePlacement=!1,t.image="marker-blue",t.offset=new ta(0,0),t.optional=!1,t.padding=2,t.pitchAlignment="auto",t.rotation=0,t.rotationAlignment="auto",t.size=1,t.opacity=1,t}return __e(e,n),e}(wi),b_e=window&&window.__extends||function(){var n=function(e,t){return(n=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(r,i){r.__proto__=i}:function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])}))(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),w_e=function(n){function e(){var t=n!==null&&n.apply(this,arguments)||this;return t.allowOverlap=!1,t.anchor="center",t.textField=void 0,t.font=["StandardFont-Regular"],t.ignorePlacement=!1,t.justify="center",t.offset=new ta(0,0),t.optional=!1,t.padding=2,t.pitchAlignment="auto",t.radialOffset=void 0,t.rotation=0,t.rotationAlignment="auto",t.variableAnchor=void 0,t.size=16,t.color="#000000",t.haloBlur=0,t.haloColor="rgba(0,0,0,0)",t.haloWidth=0,t.opacity=1,t}return b_e(e,n),e}(wi),x_e=window&&window.__extends||function(){var n=function(e,t){return(n=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(r,i){r.__proto__=i}:function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])}))(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),H_=function(n){function e(){var t=n!==null&&n.apply(this,arguments)||this;return t.source=void 0,t.sourceLayer=void 0,t.iconOptions=new v_e,t.textOptions=new w_e,t.placement="point",t.sortKey=void 0,t.zOrder="auto",t.lineSpacing=250,t}return x_e(e,n),e}(pd),E_e=window&&window.__extends||function(){var n=function(e,t){return(n=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(r,i){r.__proto__=i}:function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])}))(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),rf=window&&window.__assign||function(){return(rf=Object.assign||function(n){for(var e,t=1,r=arguments.length;t<r;t++)for(var i in e=arguments[t])Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i]);return n}).apply(this,arguments)},Ux=function(n){function e(t,r,i){return r=n.call(this,r)||this,r.options=new H_().merge(Ar(i,H_._cloneCustomizer)),r.options.source=t||r.options.source,r}return E_e(e,n),e.prototype.getOptions=function(){return Ar(this.options,H_._cloneCustomizer)},e.prototype.getSource=function(){return this.options.source},e.prototype.setOptions=function(t){if(t=new H_().merge(this.options,Ar(t,H_._cloneCustomizer)),this.map){if(t.source!==this.options.source||t.sourceLayer!==this.options.sourceLayer)return this.options=t,void this.map.layers.add(this);var r=this.options,i=t.iconOptions,o=r.iconOptions,a=t.textOptions,l=r.textOptions;this._updateBaseProperties(t,r),this._updateLayoutProperty("symbol-spacing",t.lineSpacing,r.lineSpacing),this._updateLayoutProperty("symbol-placement",t.placement,r.placement),this._updateLayoutProperty("symbol-sort-key",t.sortKey,r.sortKey),this._updateLayoutProperty("symbol-z-order",t.zOrder,r.zOrder),this._updateLayoutProperty("icon-allow-overlap",i.allowOverlap,o.allowOverlap),this._updateLayoutProperty("icon-anchor",i.anchor,o.anchor),this._updateLayoutProperty("icon-ignore-placement",i.ignorePlacement,o.ignorePlacement),this._updateLayoutProperty("icon-image",i.image,o.image),this._updateLayoutProperty("icon-offset",i.offset,o.offset),this._updatePaintProperty("icon-opacity",i.opacity,o.opacity),this._updateLayoutProperty("icon-optional",i.optional,o.optional),this._updateLayoutProperty("icon-padding",i.padding,o.padding),this._updateLayoutProperty("icon-pitch-alignment",i.pitchAlignment,o.pitchAlignment),this._updateLayoutProperty("icon-rotate",i.rotation,o.rotation),this._updateLayoutProperty("icon-rotation-alignment",i.rotationAlignment,o.rotationAlignment),this._updateLayoutProperty("icon-size",i.size,o.size),this._updateLayoutProperty("text-allow-overlap",a.allowOverlap,l.allowOverlap),this._updateLayoutProperty("text-anchor",a.anchor,l.anchor),this._updatePaintProperty("text-color",a.color,l.color),this._updateLayoutProperty("text-font",a.font,l.font),this._updateLayoutProperty("text-ignore-placement",a.ignorePlacement,l.ignorePlacement),this._updateLayoutProperty("text-justify",a.justify,l.justify),this._updatePaintProperty("text-halo-blur",a.haloBlur,l.haloBlur),this._updatePaintProperty("text-halo-color",a.haloColor,l.haloColor),this._updatePaintProperty("text-halo-width",a.haloWidth,l.haloWidth),this._updateLayoutProperty("text-offset",a.offset,l.offset),this._updatePaintProperty("text-opacity",a.opacity,l.opacity),this._updateLayoutProperty("text-optional",a.optional,l.optional),this._updateLayoutProperty("text-padding",a.padding,l.padding),this._updateLayoutProperty("text-pitch-alignment",a.pitchAlignment,l.pitchAlignment),this._updateLayoutProperty("text-radial-offset",a.radialOffset,l.radialOffset),this._updateLayoutProperty("text-rotate",a.rotation,l.rotation),this._updateLayoutProperty("text-rotation-alignment",a.rotationAlignment,l.rotationAlignment),this._updateLayoutProperty("text-size",a.size,l.size),this._updateLayoutProperty("text-variable-anchor",a.variableAnchor,l.variableAnchor),this._updateLayoutProperty("text-field",a.textField,l.textField)}this.options=t},e.prototype._buildLayers=function(){var t=rf(rf(rf(rf({id:this.id,type:"symbol"},this.options.sourceLayer&&{"source-layer":this.options.sourceLayer}),{source:this.options.source instanceof bi?this.options.source.getId():this.options.source,layout:rf(rf({visibility:this.options.visible?"visible":"none","symbol-placement":this.options.placement,"symbol-spacing":this.options.lineSpacing,"symbol-z-order":this.options.zOrder,"text-allow-overlap":this.options.textOptions.allowOverlap,"text-anchor":this.options.textOptions.anchor},this.options.textOptions.textField&&{"text-field":this.options.textOptions.textField}),{"text-font":this.options.textOptions.font,"text-ignore-placement":this.options.textOptions.ignorePlacement,"text-justify":this.options.textOptions.justify,"text-offset":this.options.textOptions.offset,"text-optional":this.options.textOptions.optional,"text-padding":this.options.textOptions.padding,"text-pitch-alignment":this.options.textOptions.pitchAlignment,"text-rotate":this.options.textOptions.rotation,"text-rotation-alignment":this.options.textOptions.rotationAlignment,"text-size":this.options.textOptions.size,"icon-allow-overlap":this.options.iconOptions.allowOverlap,"icon-anchor":this.options.iconOptions.anchor,"icon-ignore-placement":this.options.iconOptions.ignorePlacement,"icon-image":this.options.iconOptions.image,"icon-offset":this.options.iconOptions.offset,"icon-optional":this.options.iconOptions.optional,"icon-padding":this.options.iconOptions.padding,"icon-pitch-alignment":this.options.iconOptions.pitchAlignment,"icon-rotate":this.options.iconOptions.rotation,"icon-rotation-alignment":this.options.iconOptions.rotationAlignment,"icon-size":this.options.iconOptions.size}),paint:{"text-color":this.options.textOptions.color,"text-halo-blur":this.options.textOptions.haloBlur,"text-halo-color":this.options.textOptions.haloColor,"text-halo-width":this.options.textOptions.haloWidth,"text-opacity":this.options.textOptions.opacity,"icon-opacity":this.options.iconOptions.opacity}}),this.options.filter&&{filter:this.options.filter}),{minzoom:this.options.minZoom,maxzoom:this.options.maxZoom});return this.options.sortKey!==void 0&&(t.layout["symbol-sort-key"]=this.options.sortKey),this.options.textOptions.radialOffset!==void 0&&(t.layout["text-radial-offset"]=this.options.textOptions.radialOffset),this.options.textOptions.variableAnchor!==void 0&&(t.layout["text-variable-anchor"]=this.options.textOptions.variableAnchor),[t]},e.prototype._getLayerIds=function(){return[this.id]},e.prototype._getSourceIds=function(){var t=new Set;return this.options.source instanceof bi?t.add(this.options.source.getId()):t.add(this.options.source),t},e}(Ai),T_e=window&&window.__extends||function(){var n=function(e,t){return(n=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(r,i){r.__proto__=i}:function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])}))(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),Sv=window&&window.__assign||function(){return(Sv=Object.assign||function(n){for(var e,t=1,r=arguments.length;t<r;t++)for(var i in e=arguments[t])Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i]);return n}).apply(this,arguments)},Bz=function(n){function e(t,r,i){return t=n.call(this,t)||this,t.source=t._modifySource(r,i),t}return T_e(e,n),e.prototype._buildSource=function(){return this.source},e.prototype._isDeepEqual=function(t){var r,i,o,a;return this.constructor===t.constructor&&(a=this.source,r=t.source,t=a.type===r.type&&a.url===r.url&&(a.tiles===void 0&&r.tiles===void 0||a.tiles&&r.tiles&&a.tiles.length===r.tiles.length&&a.tiles.every(function(l,h){return l===r.tiles[h]}))&&a.minzoom===r.minzoom&&a.maxzoom===r.maxzoom&&a.bounds===r.bounds&&a.attribution===r.attribution,i=a.type!=="raster"||a.type==="raster"&&a.type===r.type&&a.tileSize===r.tileSize&&a.scheme===r.scheme,o=a.type!=="raster-dem"||a.type==="raster-dem"&&a.type===r.type&&a.tileSize===r.tileSize&&a.encoding===r.encoding,a=a.type!=="vector"||a.type==="vector"&&a.type===r.type&&a.promoteId===r.promoteId&&a.scheme===r.scheme,t)&&i&&o&&a},e.prototype._modifySource=function(t,r){if(t.type!=="raster"&&t.type!=="raster-dem"&&t.type!=="vector"||!t.tiles){if(t.type!=="raster"&&t.type!=="raster-dem"&&t.type!=="vector"||!t.url)throw new Error("Source definition must define a TileJSON 'url' or a 'tiles' array.");t.url=typeof t.url=="string"?t.url:new vl({domain:Nn.domainPlaceHolder,path:t.url.path,queryParams:Sv(Sv({},r),t.url.queryParams)}).toString()}else{var i=t.tiles.map(function(o){return typeof o=="string"?o:new vl({domain:Nn.domainPlaceHolder,path:o.path,queryParams:Sv(Sv({},r),o.queryParams)}).toString()});t.tiles=i}return t},e}(bi),S_e=window&&window.__extends||function(){var n=function(e,t){return(n=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(r,i){r.__proto__=i}:function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])}))(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),G_=function(n){function e(){var t=n!==null&&n.apply(this,arguments)||this;return t.bounds=[-180,-85.0511,180,85.0511],t.minSourceZoom=0,t.maxSourceZoom=22,t.tileSize=512,t.isTMS=!1,t.subdomains=void 0,t.tileUrl=void 0,t}return S_e(e,n),e}(Fz),C_e=window&&window.__extends||function(){var n=function(e,t){return(n=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(r,i){r.__proto__=i}:function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])}))(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),Bw=window&&window.__assign||function(){return(Bw=Object.assign||function(n){for(var e,t=1,r=arguments.length;t<r;t++)for(var i in e=arguments[t])Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i]);return n}).apply(this,arguments)},A_e=window&&window.__values||function(n){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&n[e],r=0;if(t)return t.call(n);if(n&&typeof n.length=="number")return{next:function(){return{value:(n=n&&r>=n.length?void 0:n)&&n[r++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},zx=function(n){function e(t,r){return r=n.call(this,r)||this,t&&r.setOptions(t),r}return C_e(e,n),e.prototype.getOptions=function(){return Ar(this.options,G_._cloneCustomizer)},e.prototype.setOptions=function(t){if(t=new G_().merge(this.options,Ar(t,G_._cloneCustomizer)),this.map){if(!Ba(t.bounds,this.options.bounds)||t.isTMS!==this.options.isTMS||t.maxSourceZoom!==this.options.maxSourceZoom||t.minSourceZoom!==this.options.minSourceZoom||!Ba(t.subdomains,this.options.subdomains)||t.tileSize!==this.options.tileSize||t.tileUrl!==this.options.tileUrl)return this.options=t,void this.map.layers.add(this);this._updateBaseProperties(t,this.options),this._updatePaintProperty("raster-contrast",t.contrast,this.options.contrast),this._updatePaintProperty("raster-fade-duration",t.fadeDuration,this.options.fadeDuration),this._updatePaintProperty("raster-hue-rotate",t.hueRotation,this.options.hueRotation),this._updatePaintProperty("raster-brightness-max",t.maxBrightness,this.options.maxBrightness),this._updatePaintProperty("raster-opacity",t.opacity,this.options.opacity),this._updatePaintProperty("raster-saturation",t.saturation,this.options.saturation)}this.options=t},e.prototype._setOptionsNoUpdate=function(t){this.options=new G_().merge(this.options,Ar(t,G_._cloneCustomizer))},e.prototype._buildLayers=function(){return[Bw(Bw({id:this.id,type:"raster",source:this._getSourceId(),layout:{visibility:this.options.visible?"visible":"none"},paint:{"raster-contrast":this.options.contrast,"raster-fade-duration":this.options.fadeDuration,"raster-hue-rotate":this.options.hueRotation,"raster-brightness-max":this.options.maxBrightness,"raster-brightness-min":this.options.minBrightness,"raster-opacity":this.options.opacity,"raster-saturation":this.options.saturation}},this.options.filter&&{filter:this.options.filter}),{minzoom:this.options.minZoom,maxzoom:this.options.maxZoom})]},e.prototype._getLayerIds=function(){return[this.id]},e.prototype._buildSource=function(){var t,r;if(this.options.tileUrl){if(this.options.tileUrl.indexOf("{")===-1)return{type:"raster",url:this.options.tileUrl};if(this.options.tileUrl.indexOf("{subdomain}")!==-1){if(!(this.options.subdomains&&0<this.options.subdomains.length))throw new Error("The {subdomain} placeholder was included in the tileUrl but no subdomains were specified");var i=[];try{for(var o=A_e(this.options.subdomains),a=o.next();!a.done;a=o.next()){var l=a.value;i.push(this.options.tileUrl.replace(/{subdomain}/g,l))}}catch(h){t={error:h}}finally{try{a&&!a.done&&(r=o.return)&&r.call(o)}finally{if(t)throw t.error}}r=i}else r=[this.options.tileUrl]}return Bw({type:"raster",bounds:this.options.bounds,maxzoom:this.options.maxSourceZoom,minzoom:this.options.minSourceZoom,scheme:this.options.isTMS?"tms":"xyz",tileSize:this.options.tileSize},r&&{tiles:r})},e.prototype._getSourceId=function(){return"".concat(this.getId(),"-RasterSource")},e.prototype._getSourceWrapper=function(){var t=this._getSourceId(),r=this._buildSource();return new Bz(t,{name:t,tiles:r.tiles,type:r.type,url:r.url})},e}(qv),I_e=window&&window.__extends||function(){var n=function(e,t){return(n=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(r,i){r.__proto__=i}:function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])}))(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),q_=function(n){function e(){var t=n!==null&&n.apply(this,arguments)||this;return t.renderer=void 0,t}return I_e(e,n),e}(pd),P_e=window&&window.__extends||function(){var n=function(e,t){return(n=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(r,i){r.__proto__=i}:function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])}))(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),Uz=function(n){function e(t,r){var i=n.call(this,t)||this;return i._onStyleChange=function(){var o,a;i.map._getMap().getLayer(i.id)||(o=i.map,a=(a=i.map.layers._getUserLayers().find(function(l){return l.layer.getId()==i.id}))==null?void 0:a.before,o.layers.remove(i),o.layers.add(i,a))},i.options=new q_().merge(Ar(r,q_._cloneCustomizer)),i.source=new Ps,i}return P_e(e,n),e.prototype.getOptions=function(){return Ar(this.options,q_._cloneCustomizer)},e.prototype.setOptions=function(t){t=new q_().merge(this.options,Ar(t,q_._cloneCustomizer)),this.map&&this.map.triggerRepaint(),this.options=t},e.prototype.onAdd=function(t){var r,i;n.prototype.onAdd.call(this,t),this.map.events.add("stylechanged",this._onStyleChange),this.options.renderer&&this.glContext&&(i=(r=this.options.renderer).onAdd)!=null&&i.call(r,t,this.glContext)},e.prototype.onRemove=function(){var t,r;this.options.renderer&&this.glContext&&(r=(t=this.options.renderer).onRemove)!=null&&r.call(t,this.map,this.glContext),this.map.events.remove("stylechanged",this._onStyleChange),this.glContext=null,n.prototype.onRemove.call(this)},e.prototype._buildLayers=function(){var t=this;if(this.options.renderer)return[{id:this.id,type:"custom",renderingMode:this.options.renderer.renderingMode,onAdd:function(r,i){t.glContext=i},onRemove:function(r,i){},prerender:function(r,i){var o,a;t._shouldRender()&&(a=(o=t.options.renderer).prerender)!=null&&a.call(o,r,i)},render:function(r,i){t._shouldRender()&&t.options.renderer.render(r,i)}}];throw new Error("Cannot build the WebGL layer because renderer was not set.")},e.prototype._getLayerIds=function(){return[this.id]},e.prototype._getSourceIds=function(){return new Set().add(this.source.getId())},e.prototype._shouldRender=function(){var t;return!!this.map&&(t=this.map.getCamera().zoom,this.options.visible)&&this.options.minZoom<=t&&this.options.maxZoom>t},e}(Ai),M_e=Object.freeze({__proto__:null,BubbleLayer:_I,HeatMapLayer:o_e,ImageLayer:u_e,Layer:Ai,LineLayer:vI,PolygonExtrusionLayer:g_e,PolygonLayer:bI,SymbolLayer:Ux,TileLayer:zx,WebGLLayer:Uz}),bT=function(){function n(){}return n.convertHtmlString=function(e){var t;return typeof e=="string"?((t=document.createElement("div")).innerHTML=e,t):e},n.parseWithFilter=function(e,t,r,i){var o=this;if(t===void 0&&(t=function(h){return!0}),r===void 0&&(r=function(h){return h}),i===void 0&&(i=function(){return document.createElement("div")}),typeof e=="string"){var l=new DOMParser().parseFromString(e,"text/html").body;if(l.children.length==0)return r(l.innerHTML);var a,l=l.children.length==1&&l.childNodes.length==1?l.children[0]:(a=i(),Array.from(l.childNodes).map(function(h){return a.append(h)}),a)}else l=e;return Array.from(l.children).forEach(function(h){return o.parseWithFilter(h,t,r)}),t(l)?r(l):(l.parentNode&&l.parentNode.removeChild(l),null)},n}(),R_e=Fu,k_e=uz;function O_e(n){return R_e(n)&&n.nodeType===1&&!k_e(n)}var zz=dd(O_e),L_e=window&&window.__extends||function(){var n=function(e,t){return(n=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(r,i){r.__proto__=i}:function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])}))(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),$_=function(n){function e(){var t=n!==null&&n.apply(this,arguments)||this;return t.anchor="none",t.draggable=!1,t.closeButton=!0,t.content=document.createElement("span"),t.fillColor="#FFFFFF",t.pixelOffset=new ta(0,0),t.position=new Xo(0,0),t.showPointer=!0,t}return L_e(e,n),e._cloneCustomizer=function(t){if(zz(t))return t},e}(wi),N_e=window&&window.__extends||function(){var n=function(e,t){return(n=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(r,i){r.__proto__=i}:function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])}))(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),K1=window&&window.__read||function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var r,i,o=t.call(n),a=[];try{for(;(e===void 0||0<e--)&&!(r=o.next()).done;)a.push(r.value)}catch(l){i={error:l}}finally{try{r&&!r.done&&(t=o.return)&&t.call(o)}finally{if(i)throw i.error}}return a},wT=function(n){function e(t){var r=n.call(this)||this;return r.attach=function(i){r.map!==i&&(r.map&&r.remove(),r.map=i,r.marker=r._createMarker(r.options),r.marker.addTo(r.map._getMap()),r.map.popups._getCollectionDiv().appendChild(r.containerDiv),r.map.popups.add(r))},r.open=function(i){if(!i&&!r.map)throw new Error("Must specify a map to open on or attach to a map in advance");r.attach(i||r.map),r.containerDiv.classList.remove(e.Css.hidden),r.map.events.add("move",r._onMove),r._onMove(),r._invokeEvent("open",{target:r,type:"open"})},r.close=function(){r.map&&r.map.events.remove("move",r._onMove),r.containerDiv.classList.add(e.Css.hidden),r._invokeEvent("close",{target:r,type:"close"})},r.remove=function(){r.map&&(r.marker.remove(),r.containerDiv.classList.remove(r.autoAnchor||r.options.anchor),r.map.events.remove("move",r._onMove),r.map.popups.remove(r),delete r.map,delete r.marker,delete r.autoAnchor)},r.isOpen=function(){return r.map&&!r.containerDiv.classList.contains(e.Css.hidden)},r._onMove=function(){var i=r._getAutoAnchor(r.map,r.options);i!==r.autoAnchor&&(r._replaceMarker(r.map,r.options,i),r.map.events.add("move",r._onMove))},r._onDown=function(i){r.map.popups._addDraggedPopup(r);var o=K1(r.map.positionsToPixels([r.options.position]),1)[0];i.type==="mousedown"?r.dragOffset=[o[0]-i.clientX,o[1]-i.clientY]:i.type==="touchstart"&&(r.dragOffset=[o[0]-i.touches[0].clientX,o[1]-i.touches[0].clientY])},r._onDragStart=function(i){i.preventDefault()},r.options=new $_().merge(Ar(t,$_._cloneCustomizer)),r.containerDiv=r._createContainerDiv(r.options),r.contentDiv=r._createContentDiv(r.options),r.containerDiv.appendChild(r.contentDiv),r.options.showPointer&&(r.arrowDiv=r._createArrowDiv(),r.containerDiv.appendChild(r.arrowDiv)),r.options.closeButton&&(r.closeBtn=r._createCloseButton(),r.contentDiv.appendChild(r.closeBtn),t=ea("close"),r.contentDiv.appendChild(t),Li(t,r.closeBtn,!0)),r}return N_e(e,n),e.prototype.setPopupOptions=function(t){this.setOptions(t)},e.prototype.setOptions=function(i){var r,i=new $_().merge(this.options,Ar(i,$_._cloneCustomizer));i.content!==this.options.content?(this.htmlContent.remove(),this.htmlContent=this._createHtmlContent(i),this.contentDiv.prepend(this.htmlContent)):i.draggable!==this.options.draggable&&this._setDraggable(this.htmlContent,i.draggable),i.closeButton&&!this.closeBtn?(this.closeBtn=this._createCloseButton(),this.contentDiv.appendChild(this.closeBtn),r=ea("close"),this.contentDiv.appendChild(r),Li(r,this.closeBtn,!0)):!i.closeButton&&this.closeBtn&&(this.contentDiv.removeChild(this.closeBtn),delete this.closeBtn),i.showPointer&&!this.arrowDiv?(this.arrowDiv=this._createArrowDiv(),this.containerDiv.appendChild(this.arrowDiv)):!i.showPointer&&this.arrowDiv&&(this.containerDiv.removeChild(this.arrowDiv),delete this.arrowDiv),i.fillColor!==this.options.fillColor&&(this.containerDiv.style.borderColor=i.fillColor,this.contentDiv.style.backgroundColor=i.fillColor),this.marker&&(i.anchor!==this.options.anchor?this.options.anchor==="none"?(this.autoAnchor!==i.anchor&&this._replaceMarker(this.map,i),this.map.events.remove("move",this._onMove),delete this.autoAnchor):(this._replaceMarker(this.map,i),i.anchor==="none"&&this.map.events.add("move",this._onMove)):(Ba(i.position,this.options.position)||this.marker.setLngLat(i.position),Ba(i.pixelOffset,this.options.pixelOffset)||this.marker.setOffset(i.pixelOffset))),this.options=i},e.prototype.getPopupOptions=function(){return this.getOptions()},e.prototype.getOptions=function(){return Ar(this.options,$_._cloneCustomizer)},e.prototype.getPopupContainer=function(){return this.containerDiv},e.prototype._dragToPixel=function(t){this.dragging||(this.dragging=!0,this.contentDiv.style.pointerEvents="none",this._invokeEvent("dragstart",{type:"dragstart",target:this})),t=[t[0]+this.dragOffset[0],t[1]+this.dragOffset[1]],t=K1(this.map.pixelsToPositions([t]),1)[0],this.options.position=t,this.marker.setLngLat(this.options.position),this._invokeEvent("drag",{type:"drag",target:this})},e.prototype._onUp=function(){this.dragging&&(this.contentDiv.style.pointerEvents="",this._invokeEvent("dragend",{type:"dragend",target:this}),this.options.anchor==="none")&&this._onMove(),delete this.dragOffset,delete this.dragging},e.prototype._createContainerDiv=function(t){var r=this,i=document.createElement("div"),o=(i.classList.add(e.Css.container),i.classList.add(e.Css.hidden),i.style.borderColor=t.fillColor,i.setAttribute("role","dialog"),i.setAttribute("aria-label","Map Information Window"),!1);return i.addEventListener("keydown",function(a){a.key!=="Tab"&&a.key!=="Escape"&&a.key!=="Esc"||(o=!0)}),i.addEventListener("keyup",function(a){a.key!=="Tab"&&a.key!=="Escape"&&a.key!=="Esc"||(o=!1)}),i.addEventListener("focusin",function(a){r.map&&!r.isOpen()&&(r.open(r.map),a.target instanceof HTMLElement)&&a.target.focus()}),i.addEventListener("focusout",function(a){o&&a.relatedTarget instanceof Node&&!i.contains(a.relatedTarget)&&(o=!1,r.isOpen())&&r.close()}),i},e.prototype._createContentDiv=function(t){var r=document.createElement("div");return r.classList.add(e.Css.content),r.style.backgroundColor=t.fillColor,r.setAttribute("tabindex","0"),this.htmlContent=this._createHtmlContent(t),r.appendChild(this.htmlContent),r},e.prototype._createArrowDiv=function(){var t=document.createElement("div");return t.classList.add(e.Css.arrow),t},e.prototype._createCloseButton=function(){var t=document.createElement("button");return t.addEventListener("click",this.close),t.classList.add(e.Css.close),t.setAttribute("aria-label","close"),t.setAttribute("tabindex","0"),t.innerHTML="&times;",t},e.prototype._createHtmlContent=function(t){var r=bT.convertHtmlString(t.content);return t.draggable&&this._setDraggable(r,t.draggable),r},e.prototype._createMarker=function(t,o){var i=this.marker?this.marker.getLngLat():t.position,o=(t.anchor==="none"?(this.autoAnchor=o||"bottom",this.containerDiv.classList.add(this.autoAnchor),new as.Marker({anchor:this.autoAnchor,element:this.containerDiv,offset:t.pixelOffset})):(this.containerDiv.classList.add(t.anchor),new as.Marker({anchor:t.anchor,element:this.containerDiv,offset:t.pixelOffset}))).setLngLat(i);return o},e.prototype._getAutoAnchor=function(t,r){var i,o,a=this.containerDiv.offsetWidth,l=this.containerDiv.offsetHeight,h=[];return(o=this.marker?(i=(o=t._getMap().project(this.marker.getLngLat())).x,o.y):(o=K1(t.positionsToPixels([r.position]),1),i=(r=K1(o[0],2))[0],r[1]))<l?h.push("top"):o>t.getCanvas().offsetHeight-l&&h.push("bottom"),i<a/2?h.push("left"):i>t.getCanvas().offsetWidth-a/2&&h.push("right"),0<h.length?h.join("-"):"bottom"},e.prototype._replaceMarker=function(t,r,i){var o=this.containerDiv.nextElementSibling;this.marker.remove(),this.containerDiv.classList.remove(this.autoAnchor||this.options.anchor),this.marker=this._createMarker(r,i),this.marker.addTo(t._getMap()),t.popups._getCollectionDiv().insertBefore(this.containerDiv,o||null)},e.prototype._setDraggable=function(t,r){r?(t.addEventListener("mousedown",this._onDown),t.addEventListener("touchstart",this._onDown),t.addEventListener("dragstart",this._onDragStart)):(t.removeEventListener("mousedown",this._onDown),t.removeEventListener("touchstart",this._onDown),t.removeEventListener("dragstart",this._onDragStart))},e.Css={arrow:"popup-arrow",close:"popup-close",container:"popup-container",content:"popup-content-container",hidden:"hidden-accessible-element"},e}(Du),D_e=window&&window.__extends||function(){var n=function(e,t){return(n=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(r,i){r.__proto__=i}:function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])}))(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),W_=function(n){function e(){var t=n!==null&&n.apply(this,arguments)||this;return t.anchor="bottom",t.color="#1A73AA",t.draggable=!1,t.htmlContent='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24.5 36.5" id="marker_'.concat(qf(),'" width="24.5" height="36.5" display="block"><path d="M12.25.25a12.2543,12.2543,0,0,0-12,12.4937c0,6.4436,6.4879,12.1093,11.059,22.5641.5493,1.2563,1.3327,1.2563,1.882,0C17.7621,24.8529,24.25,19.1857,24.25,12.7437A12.2543,12.2543,0,0,0,12.25.25Z"   fill="{color}" stroke="{secondaryColor}" stroke-width="0.5"/><text style="font-family: Arial, Helvetica, sans-serif; font-size: 14px; fill: white;" text-anchor="middle" x="12" y="18">{text}</text></svg>'),t.pixelOffset=new ta(0,0),t.position=new Xo(0,0),t.popup=void 0,t.secondaryColor="white",t.text=void 0,t.visible=!0,t}return D_e(e,n),e._cloneCustomizer=function(t){if(t instanceof wT||zz(t))return t},e}(wi),F_e=window&&window.__extends||function(){var n=function(e,t){return(n=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(r,i){r.__proto__=i}:function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])}))(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),hR=function(n){function e(t){var r=n.call(this)||this;return r._onDrag=function(){var i=r.marker.getLngLat().wrap();r.options.position=new Xo(i.lng,i.lat),r._invokeEvent("drag",{type:"drag",target:r})},r._onDragStart=function(){r._invokeEvent("dragstart",{type:"dragstart",target:r})},r._onDragEnd=function(){r._invokeEvent("dragend",{type:"dragend",target:r})},r._bubbleElementEvent=function(i){r._invokeEvent(i.type,{type:i.type,target:r})},r._onEleDragStart=function(i){i.preventDefault()},r.options=new W_().merge(Ar(t,W_._cloneCustomizer)),r._buildMarker(r.options),r}return F_e(e,n),e.prototype.getOptions=function(){return Ar(this.options,W_._cloneCustomizer)},e.prototype.getElement=function(){return this.marker.getElement()},e.prototype.setOptions=function(t){t=new W_().merge(this.options,Ar(t,W_._cloneCustomizer)),Ba(t.htmlContent,this.options.htmlContent)&&t.anchor===this.options.anchor?(typeof t.htmlContent!="string"||t.color===this.options.color&&t.text===this.options.text&&t.secondaryColor===this.options.secondaryColor||(this.element.innerHTML=this._getSubbedHtmlString(t)||""),t.draggable!==this.options.draggable&&(this._setDraggable(t.draggable),this.marker.setDraggable(t.draggable)),Ba(t.pixelOffset,this.options.pixelOffset)||this.marker.setOffset(t.pixelOffset),Ba(t.position,this.options.position)||this.marker.setLngLat(t.position),t.visible!==this.options.visible&&(t.visible?this.element.classList.remove(e.hiddenClass):this.element.classList.add(e.hiddenClass))):(this.marker.remove(),this._buildMarker(t),this.map&&(this.marker.addTo(this.map._getMap()),this._getCollectionContainer().appendChild(this.element))),this.options=t},e.prototype.togglePopup=function(){if(this.options.popup)if(this.options.popup.isOpen())this.options.popup.close();else{if(!this.map)throw new Error("The marker must be added to a map before calling togglePopup().");this.options.popup.setOptions({position:this.options.position}),this.options.popup.open(this.map)}},e.prototype._addToMap=function(t,r){this.map&&this.map!==t&&this._removeFromMap(),r&&(this.options.position=ao(r),this.marker.setLngLat(this.options.position)),this.map!==t&&(this.map=t,this.marker.addTo(t._getMap()),this._getCollectionContainer().appendChild(this.element))},e.prototype._removeFromMap=function(){this.map&&(this.marker.remove(),delete this.map)},e.prototype._getId=function(){if(this.element)return(typeof this.options.htmlContent=="string"?this.element.firstChild:this.element).id},e.prototype._buildMarker=function(t){var r;typeof t.htmlContent=="string"?(r=this._getSubbedHtmlString(t)||"",this.element=bT.convertHtmlString(r)):this.element=t.htmlContent,this.element.classList.add(e.containerClass),t.draggable&&this._setDraggable(!0),t.visible||this.element.classList.add(e.hiddenClass),this.marker=new as.Marker({element:this.element,offset:t.pixelOffset,draggable:t.draggable,anchor:t.anchor}).setLngLat(t.position),this.marker.on("drag",this._onDrag),this.marker.on("dragstart",this._onDragStart),this.marker.on("dragend",this._onDragEnd),this.element.addEventListener("click",this._bubbleElementEvent),this.element.addEventListener("dblclick",this._bubbleElementEvent),this.element.addEventListener("contextmenu",this._bubbleElementEvent),this.element.addEventListener("keydown",this._bubbleElementEvent),this.element.addEventListener("keypress",this._bubbleElementEvent),this.element.addEventListener("keyup",this._bubbleElementEvent),this.element.addEventListener("mousedown",this._bubbleElementEvent),this.element.addEventListener("mouseenter",this._bubbleElementEvent),this.element.addEventListener("mouseleave",this._bubbleElementEvent),this.element.addEventListener("mousemove",this._bubbleElementEvent),this.element.addEventListener("mouseout",this._bubbleElementEvent),this.element.addEventListener("mouseover",this._bubbleElementEvent),this.element.addEventListener("mouseup",this._bubbleElementEvent)},e.prototype._getSubbedHtmlString=function(t){return typeof t.htmlContent=="string"?t.htmlContent.replace(/{color}/gi,t.color||"").replace(/{secondaryColor}/gi,t.secondaryColor||"").replace(/{text}/gi,t.text||""):null},e.prototype._getCollectionContainer=function(){var t=this.map.getCanvasContainer().querySelector(".".concat(e.collectionContainerClass));return t||((t=document.createElement("div")).classList.add(e.collectionContainerClass),this.map.getCanvasContainer().appendChild(t)),t},e.prototype._setDraggable=function(t){t?this.element.addEventListener("dragstart",this._onEleDragStart):this.element.removeEventListener("dragstart",this._onEleDragStart)},e.collectionContainerClass="marker-collection-container",e.hiddenClass="hidden-accessible-element",e.containerClass="marker-container",e}(Du),B_e=function(){function n(){}return n.getHighContrastMode=function(){return matchMedia("(-ms-high-contrast: white-on-black)").matches?"dark":matchMedia("(-ms-high-contrast: black-on-white)").matches?"light":matchMedia("(-ms-high-contrast: active)").matches?"dark":matchMedia("(inverted-colors: inverted)").matches?"invert":null},n}();function Bu(n,e){return n||e}function ls(n,e){return n[e]}var BC,ts=void 0,La=null,dR="",xT="function",gb="object",hu="prototype",wI="__proto__",_f="undefined",jx="constructor",fR="Symbol",U_e="_polyfill",Em="length",Vx="name",na="call",ET="toString",Nc=Bu(Object),pR=ls(Nc,hu),jz=Bu(String),lp=ls(jz,hu),z_e=Bu(Math),Vz=Bu(Array),TT=ls(Vz,hu),Su=ls(TT,"slice");function Do(n,e){try{return{v:n.apply(this,e)}}catch(t){return{e:t}}}function j_e(n,e){return n=Do(n),n.e?e:n.v}function ST(n){return function(e){return typeof e===n}}function Hz(n){var e="[object "+n+"]";return function(t){return!(!t||V_e(t)!==e)}}function V_e(n){return pR[ET].call(n)}function Pi(n){return typeof n===_f||n===_f}function bt(n){return n===La||Pi(n)}function H_e(n){return n===La||!Gz(n)}function Gz(n){return!!n||n!==ts}function G_e(n){return BC=BC||["string","number","boolean",_f,"symbol","bigint"],n!==gb&&BC.indexOf(n)!==-1}var Pn=ST("string"),$n=ST(xT);function cs(n){return!(!n&&bt(n)||!n||typeof n!==gb)}var dr=ls(Vz,"isArray"),q_e=Hz("Date"),mb=ST("number"),qz=ST("boolean"),gR=Hz("Error");function Yf(n){return!!(n&&n.then&&$n(n.then))}function Hx(n){return!(!n||j_e(function(){return!(n&&0+n)},!n))}var mR=ls(Nc,"getOwnPropertyDescriptor");function cc(n,e){return!!n&&pR.hasOwnProperty[na](n,e)}var Kh=Bu(ls(Nc,"hasOwn"),$_e);function $_e(n,e){return cc(n,e)||!!mR(n,e)}function fr(n,e,t){if(n&&cs(n)){for(var r in n)if(Kh(n,r)&&e[na](t||n,r,n[r])===-1)break}}var Z1={e:"enumerable",c:"configurable",v:"value",w:"writable",g:"get",s:"set"};function W_e(n){var e,t={};return t[Z1.c]=!0,t[Z1.e]=!0,n.l&&(t.get=function(){return n.l.v},e=mR(n.l,"v"))&&e.set&&(t.set=function(r){n.l.v=r}),fr(n,function(r,i){t[Z1[r]]=Pi(i)?t[Z1[r]]:i}),t}var Cu=ls(Nc,"defineProperty");function Or(n,e,t){return Cu(n,e,W_e(t))}function $z(n,e,t,r,i){var o={};return fr(n,function(a,l){Gx(o,a,e?l:a,i),Gx(o,l,t?l:a,i)}),r?r(o):o}function Gx(n,e,t,r){Cu(n,e,{value:t,enumerable:!0,writable:!!r})}var rs=Bu(jz),Y_e="[object Error]";function rn(n,e){var t=dR,r=pR[ET][na](n);r===Y_e&&(n={stack:rs(n.stack),message:rs(n.message),name:rs(n.name)});try{t=(t=JSON.stringify(n,La,e?typeof e=="number"?e:4:ts))&&t.replace(/"(\w+)"\s*:\s{0,1}/g,"$1: ")||rs(n)}catch(i){t=" - "+rn(i,e)}return r+": "+t}function As(n){throw new Error(n)}function Dc(n){throw new TypeError(n)}var Wz=ls(Nc,"freeze");function K_e(n){return n}function Z_e(n){return n[wI]||La}var xI=ls(Nc,"assign"),du=ls(Nc,"keys");function vy(n){return Wz&&fr(n,function(e,t){(dr(t)||cs(t))&&vy(t)}),Au(n)}var Au=Bu(Wz,K_e),EI=Bu(ls(Nc,"getPrototypeOf"),Z_e);function X_e(n){return $z(n,1,0,Au)}function Q_e(n){return $z(n,0,0,Au)}function J_e(n){var e={};return fr(n,function(t,r){Gx(e,t,r[1]),Gx(e,r[0],r[1])}),Au(e)}function eve(n){return J_e(n)}var UC,Yz=Q_e({asyncIterator:0,hasInstance:1,isConcatSpreadable:2,iterator:3,match:4,matchAll:5,replace:6,search:7,species:8,split:9,toPrimitive:10,toStringTag:11,unscopables:12}),A3="__tsUtils$gblCfg";function Kz(){var n;return n=(n=(n=(n=typeof globalThis!==_f?globalThis:n)||typeof self===_f?n:self)||typeof window===_f?n:window)||typeof global===_f?n:global}function Zz(){var n;return UC||(n=Do(Kz).v||{},UC=n[A3]=n[A3]||{}),UC}function Rl(n,e,t){var r=e&&e[n];return function(i){var o,a=i&&i[n]||r;if(a||t)return o=arguments,(a||t).apply(i,a?Su[na](o,1):o);Dc('"'+rs(n)+'" not defined for '+rn(i))}}function tve(n){return function(e){return e[n]}}var nve=ls(z_e,"max"),I3=Rl("slice",lp),kl=Rl("substring",lp),Oh=Rl("substr",lp,rve);function rve(n,e,t){return bt(n)&&Dc("Invalid "+rn(n)),t<0?dR:((e=e||0)<0&&(e=nve(e+n[Em],0)),Pi(t)?I3(n,e):I3(n,e,e+t))}function yR(n,e){return kl(n,0,e)}var zC,X1,go,P3="_urid";function ive(){var n;return zC||(n=Zz(),zC=n.gblSym=n.gblSym||{k:{},s:{}}),zC}function _R(n){var e={description:rs(n),toString:function(){return fR+"("+n+")"}};return e[U_e]=!0,e}function ove(n){var e,t,r=ive();return Kh(r.k,n)||(e=_R(n),t=du(r.s).length,e[P3]=function(){return t+"_"+e[ET]()},r.k[n]=e,r.s[e[P3]()]=rs(n)),r.k[n]}function ave(t){X1=X1||{};var e,t=Yz[t];return e=t?X1[t]=X1[t]||_R(fR+"."+t):e}function gd(){go=Zz()}function sve(n){var e={};return go||gd(),e.b=go.lzy,Cu(e,"v",{configurable:!0,get:function(){var t=n();return go.lzy||Cu(e,"v",{value:t}),e.b=go.lzy,t}}),e}function dc(n){return Cu({toJSON:function(){return n}},"v",{value:n})}var $v,Xz="window";function by(n,e){var t;return function(){return go||gd(),(t=t&&!go.lzy?t:dc(Do(n,e).v)).v}}function oc(n){return go||gd(),($v=$v&&n!==!1&&!go.lzy?$v:dc(Do(Kz).v||La)).v}function zi(n,e){return e=$v&&e!==!1?$v.v:oc(e),e&&e[n]?e[n]:n===Xz?os():La}function Qz(){return!!ma()}var ma=by(zi,["document"]);function CT(){return!!os()}var os=by(zi,[Xz]);function cve(){return!!Ol()}var Ol=by(zi,["navigator"]);function lve(){return!!Jz()}var yb,M3,jC,Jz=by(zi,["history"]),uve=by(function(){return!!Do(function(){return process&&(process.versions||{}).node}).v}),ej=by(function(){return!!Do(function(){return self&&self instanceof WorkerGlobalScope}).v});function AT(){return yb=dc(Do(zi,[fR]).v)}function hve(n){var e=(go.lzy?0:yb)||AT();return e.v?e.v[n]:ts}function dve(){return!!fve()}function fve(){return go||gd(),((go.lzy?0:yb)||AT()).v}function vR(n,e){var t=Yz[n],r=(go||gd(),(go.lzy?0:yb)||AT());return r.v?r.v[t||n]:e?ts:ave(n)}function Y_(n,e){go||gd();var t=(go.lzy?0:yb)||AT();return t.v?t.v(n):e?La:_R(n)}function bR(n){return go||gd(),((M3=(go.lzy?0:M3)||dc(Do(hve,["for"]).v)).v||ove)(n)}function TI(n){return!!n&&$n(n.next)}function tj(n){return!H_e(n)&&$n(n[vR(3)])}function wR(n,e,t){if(n&&(TI(n)||(n=n[(jC=jC||dc(vR(3))).v]?n[jC.v]():null),TI(n))){var r=ts,i=ts;try{for(var o=0;!(i=n.next()).done&&e[na](t||n,i.value,o,n)!==-1;)o++}catch(a){r={e:a},n.throw&&(i=La,n.throw(r))}finally{try{i&&!i.done&&n.return&&n.return(i)}finally{if(r)throw r.e}}}}function nm(n,e,t){return n.apply(e,t)}function rm(n,e){return!Pi(e)&&n&&(dr(e)?nm(n.push,n,e):TI(e)||tj(e)?wR(e,function(t){n.push(t)}):n.push(e)),n}function on(n,e,t){if(n)for(var r=n[Em]>>>0,i=0;i<r&&!(i in n&&e[na](t||n,n[i],i,n)===-1);i++);}var _a=Rl("indexOf",TT),Wv=Rl("map",TT);function IT(n,e,t){return(n&&n.slice||Su).apply(n,Su[na](arguments,1))}var R3,k3,pve=Rl("reduce",TT),sd=Bu(ls(Nc,"create"),gve);function gve(n){var e;return n?((e=typeof n)!==gb&&e!==xT&&Dc("Prototype must be an Object or function: "+rn(n)),t[hu]=n,new t):{};function t(){}}function nj(n,e){return(Nc.setPrototypeOf||function(t,r){var i;(R3=R3||dc(((i={})[wI]=[],i instanceof Array))).v?t[wI]=r:fr(r,function(o,a){return t[o]=a})})(n,e)}function mve(n,e,t){function r(){this[jx]=e,Do(Or,[this,Vx,{v:n,c:!0,e:!1}])}return Do(Or,[e,Vx,{v:n,c:!0,e:!1}]),(e=nj(e,t))[hu]=t===La?sd(t):(r[hu]=t[hu],new r),e}function O3(n,e){e&&(n[Vx]=e)}function rj(n,e,t){var r=t||Error,i=r[hu][Vx],o=Error.captureStackTrace;return mve(n,function(){var a=arguments;try{Do(O3,[r,n]);var l,h=nm(r,this,Su[na](a))||this;return h!==this&&(l=EI(this))!==EI(h)&&nj(h,l),o&&o(h,this[jx]),e&&e(h,a),h}finally{Do(O3,[r,i])}},r)}function yve(n){throw new(k3=k3||rj("UnsupportedError"))(n)}function Cl(){return(Date.now||_ve)()}function _ve(){return new Date().getTime()}function vve(n){return function(e){return bt(e)&&Dc("strTrim called ["+rn(e)+"]"),e=e&&e.replace?e.replace(n,dR):e}}var VC,HC,L3,bve=vve(/^\s+|(?=\s)\s+$/g),mo=Rl("trim",lp,bve);function Na(n){if(!n||typeof n!==gb)return!1;var e=!1;if(n!==(L3=L3||!CT()||os())){HC||(VC=Function[hu][ET],HC=VC[na](Nc));try{var t=EI(n);e=(e=!t)||(t=cc(t,jx)?t[jx]:t)&&typeof t===xT&&VC[na](t)===HC}catch{}}return e}function wve(n){return n.value&&oj(n),!0}var N3=[Sve,oj,Ave,Cve];function xve(n,e,t,r){var i;return on(n,function(o){if(o.k===e)return i=o,-1}),i||(i={k:e,v:e},n.push(i),r(i)),i.v}function xR(n,e,t,o){var i=t.handler,o=t.path?o?t.path.concat(o):t.path:[],a={handler:t.handler,src:t.src,path:o},l=typeof e,h=!1,p=!1,g=(e&&l===gb?h=Na(e):p=e===La||G_e(l),{type:l,isPrim:p,isPlain:h,value:e,result:e,path:o,origin:t.src,copy:function(_,x){return xR(n,_,x?a:t,x)},copyTo:function(_,x){return ij(n,_,x,a)}});return g.isPrim?i&&i[na](t,g)?g.result:e:xve(n,e,o,function(_){Or(g,"result",{g:function(){return _.v},s:function(M){_.v=M}});for(var x=0,C=i;!(C||(x<N3.length?N3[x++]:wve))[na](t,g);)C=La})}function ij(n,e,t,r){if(!bt(t))for(var i in t)e[i]=xR(n,t[i],r,i);return e}function Eve(n,e,t){return ij([],n,e,{handler:t,src:e,path:[]})}function Tve(n,e){return xR([],n,{handler:e,src:n})}function Sve(n){var e,t=n.value;return!!dr(t)&&((e=n.result=[]).length=t.length,n.copyTo(e,t),!0)}function Cve(n){var e=n.value;return!!q_e(e)&&(n.result=new Date(e.getTime()),!0)}function Ave(n){return n.type===xT}function oj(n){var e,t=n.value;return!(!t||!n.isPlain||(e=n.result={},n.copyTo(e,t),0))}function aj(n,e){return on(e,function(t){Eve(n,t)}),n}function D3(n,e,t,r,i,o,a){return aj(Tve(n)||{},Su[na](arguments))}function Ive(n,e,t,r,i,o,a){return aj(n||{},Su[na](arguments))}var GC,Pve=tve(Em);function Iu(){return go||gd(),(GC=GC&&!go.lzy?GC:dc(Do(zi,["performance"]).v)).v}var sj=Rl("split",lp);function cj(n,e,t){var r;n&&e&&(r=(e=sj(e,".")).pop(),on(e,function(i){bt(n[i])&&(n[i]={}),n=n[i]}),n[r]=t)}var lj=Rl("endsWith",lp,Mve);function Mve(n,e,t){return Pn(n)||Dc("'"+rn(n)+"' is not a string"),e=Pn(e)?e:rs(e),t=!Pi(t)&&t<n[Em]?t:n[Em],kl(n,t-e[Em],t)===e}var is=Rl("indexOf",lp),qC="ref",$C="unref",WC="hasRef",Rve="enabled";function kve(n,e,t){var r,i=!0,o=n?e(La):La;function a(){return i=!1,o&&o[$C]&&o[$C](),r}function l(){o&&t(o),o=La}function h(){return o=e(o),i||a(),r}return(r={cancel:l,refresh:h})[WC]=function(){return o&&o[WC]?o[WC]():i},r[qC]=function(){return i=!0,o&&o[qC]&&o[qC](),r},r[$C]=a,{h:r=Cu(r,Rve,{get:function(){return!!o},set:function(p){!p&&o&&l(),p&&!o&&h()}}),dn:function(){o=La}}}function uj(n,e,t){var r=dr(e),i=r?e.length:0,o=(0<i?e[0]:r?ts:e)||setTimeout,a=(1<i?e[1]:ts)||clearTimeout,l=t[0],h=(t[0]=function(){h.dn(),nm(l,ts,Su[na](arguments))},kve(n,function(p){if(p){if(p.refresh)return p.refresh(),p;nm(a,ts,[p])}return nm(o,ts,t)},function(p){nm(a,ts,[p])}));return h.h}function lc(n,e){return uj(!0,ts,Su[na](arguments))}function Ove(n,e){return uj(!1,ts,Su[na](arguments))}var YC,hj=X_e,Lve=eve,Ph=hj({NONE:0,PENDING:3,INACTIVE:1,ACTIVE:2}),ny="toLowerCase",qx="blkVal",jn="length",$x="rdOnly",Wx="notify",Yx="warnToConsole",_b="throwInternal",wy="setDf",Af="watch",oo="logger",Kf="apply",Hr="push",xy="splice",dj="hdlr",im="cancel",vb="initialize",Lh="identifier",Kx="removeNotificationListener",Zx="addNotificationListener",hl="isInitialized",F3="instrumentationKey",KC="INACTIVE",Yv="value",Q1="getNotifyMgr",L0="getPlugin",fu="name",K_="iKey",Tm="time",ka="processNext",fj="getProcessTelContext",B3="pollInternalLogs",om="enabled",U3="stopPollingInternalLogs",cd="unload",J1="onComplete",Xx="version",pj="loggingLevelConsole",Zf="createNew",iu="teardown",Qx="messageId",If="message",ry="isAsync",Zh="diagLog",Jx="_doTeardown",N0="update",bl="getNext",D0="setNextPlugin",gj="protocol",SI="userAgent",iy="split",ZC="nodeType",Pf="replace",mj="logInternalMessage",pu="type",ER="handler",Cv="status",z3="getResponseHeader",j3="getAllResponseHeaders",CI="isChildEvt",Vg="data",Sm="getCtx",tl="setCtx",AI="complete",V3="itemsReceived",Z_="urlString",H3="sendPOST",XC="headers",bg="timeout",G3="setRequestHeader",II="traceId",PI="spanId",MI="traceFlags";function Nve(n,e){YC=YC||rj("AggregationError",function(r,i){1<i[jn]&&(r.errors=i[1])});var t=n||"One or more errors occurred.";throw on(e,function(r,i){t+=`
`.concat(i," > ").concat(rn(r))}),new YC(t,e||[])}var QC,yj="function",_j="object",TR="undefined",wl="prototype",SR=Object,Dve=SR[wl],vj=((oc()||{}).Symbol,(oc()||{}).Reflect,"hasOwnProperty"),Fve=function(n){for(var e,t=1,r=arguments.length;t<r;t++)for(var i in e=arguments[t])Dve[vj].call(e,i)&&(n[i]=e[i]);return n},Da=xI||Fve,bj=function(n,e){return(bj=SR.setPrototypeOf||({__proto__:[]}instanceof Array?function(t,r){t.__proto__=r}:function(t,r){for(var i in r)r[vj](i)&&(t[i]=r[i])}))(n,e)};function Uu(n,e){function t(){this.constructor=n}typeof e!==yj&&e!==null&&Dc("Class extends value "+String(e)+" is not a constructor or null"),bj(n,e),n[wl]=e===null?sd(e):(t[wl]=e[wl],new t)}function q3(n,e){for(var t=0,r=e.length,i=n.length;t<r;t++,i++)n[i]=e[t];return n}var eE="constructor",Pu="prototype",tE="function",nE="_dynInstFuncs",RI="_isDynProxy",Cm="_dynClass",Bve="_dynCls$",kI="_dynInstChk",F0=kI,wj="_dfOpts",$3="_unknown_",CR="__proto__",ew="_dyn"+CR,W3="__dynProto$Gbl",JC="_dynInstProto",Uw="useBaseInst",OI="setInstFuncs",AR=Object,B0=AR.getPrototypeOf,Y3=AR.getOwnPropertyNames,K3=oc(),LI=K3[W3]||(K3[W3]={o:((QC={})[OI]=!0,QC[Uw]=!0,QC),n:1e3});function zw(n){return n&&(n===AR[Pu]||n===Array[Pu])}function IR(n){return zw(n)||n===Function[Pu]}function Xf(n){if(n){if(B0)return B0(n);var e=n[CR]||n[Pu]||(n[eE]?n[eE][Pu]:null),t=n[ew]||e;cc(n,ew)||(delete n[JC],t=n[ew]=n[JC]||n[ew],n[JC]=e)}return t}function rE(n,e){var t=[];if(Y3)t=Y3(n);else for(var r in n)typeof r=="string"&&cc(n,r)&&t.push(r);if(t&&0<t.length)for(var i=0;i<t.length;i++)e(t[i])}function PR(n,e,t){return e!==eE&&typeof n[e]===tE&&(t||cc(n,e))&&e!==CR&&e!==Pu}function iE(n){Dc("DynamicProto: "+n)}function Uve(n){var e=sd(null);return rE(n,function(t){!e[t]&&PR(n,t,!1)&&(e[t]=n[t])}),e}function MR(n,e){for(var t=n.length-1;0<=t;t--)if(n[t]===e)return!0;return!1}function zve(n,e,t,r){function i(h,p,g){var _,x=p[g];return x[RI]&&r&&(_=h[nE]||{})[F0]!==!1&&(x=(_[p[Cm]]||{})[g]||x),function(){return x.apply(h,arguments)}}for(var o=sd(null),a=(rE(t,function(h){o[h]=i(e,t,h)}),Xf(n)),l=[];a&&!IR(a)&&!MR(l,a);)rE(a,function(h){!o[h]&&PR(a,h,!B0)&&(o[h]=i(e,a,h))}),l.push(a),a=Xf(a);return o}function jve(n,e,t,r){var i=null;if(n&&cc(t,Cm)){var o=n[nE]||sd(null);if((i=(o[t[Cm]]||sd(null))[e])||iE("Missing ["+e+"] "+tE),!i[kI]&&o[F0]!==!1){for(var a=!cc(n,e),l=Xf(n),h=[];a&&l&&!IR(l)&&!MR(h,l);){var p=l[e];if(p){a=p===r;break}h.push(l),l=Xf(l)}try{a&&(n[e]=i),i[kI]=1}catch{o[F0]=!1}}}return i}function Vve(n,e,t){var r=e[n];return typeof(r=r===t?Xf(e)[n]:r)!==tE&&iE("["+n+"] is not a "+tE),r}function Hve(n,e,t,r,i){var o,a;zw(n)||zw(o=t[nE]=t[nE]||sd(null))||(a=o[e]=o[e]||sd(null),o[F0]!==!1&&(o[F0]=!!i),zw(a))||rE(t,function(l){function h(){return(jve(this,g,p,h)||Vve(g,p,h)).apply(this,arguments)}var p,g;PR(t,l,!1)&&t[l]!==r[l]&&(a[l]=t[l],delete t[l],cc(n,l)&&(!n[l]||n[l][RI])||(n[l]=(p=n,g=l,h[RI]=1,h)))})}function Gve(n,e){if(B0){for(var t=[],r=Xf(e);r&&!IR(r)&&!MR(t,r);){if(r===n)return!0;t.push(r),r=Xf(r)}return!1}return!0}function eA(n,e){return cc(n,Pu)?n.name||e||$3:((n||{})[eE]||{}).name||e||$3}function xi(a,e,p,r){cc(a,Pu)||iE("theClass is an invalid class definition.");var i=a[Pu],o=(Gve(i,e)||iE("["+eA(a)+"] not in hierarchy of ["+eA(e)+"]"),null),a=(cc(i,Cm)?o=i[Cm]:(o=Bve+eA(a,"_")+"$"+LI.n,LI.n++,i[Cm]=o),xi[wj]),l=!!a[Uw],h=(l&&r&&r[Uw]!==void 0&&(l=!!r[Uw]),Uve(e)),p=(p(e,zve(i,e,h,l)),!!B0&&!!a[OI]);Hve(i,o,e,h,(p=p&&r?!!r[OI]:p)!==!1)}xi[wj]=LI.o;var oE="Promise",RR="rejected";function Mu(n,e){return xj(n,function(t){return e?e({status:"fulfilled",rejected:!1,value:t}):t},function(t){return e?e({status:RR,rejected:!0,reason:t}):t})}function xj(n,e,t,r){var i=n;try{if(Yf(n))(e||t)&&(i=n.then(e,t));else try{e&&(i=e(n))}catch(o){if(!t)throw o;i=t(o)}}finally{r&&qve(i,r)}return i}function qve(n,e){var t=n;return e&&(Yf(n)?t=n.finally?n.finally(e):n.then(function(r){return e(),r},function(r){throw e(),r}):e()),t}var tA,Ej=["pending","resolving","resolved",RR],Z3="dispatchEvent";function $ve(n){var e;return!!(e=n&&n.createEvent?n.createEvent("Event"):e)&&e.initEvent}function Wve(n,e,t,r){var i=ma(),i=(tA=tA||dc(!!Do($ve,[i]).v)).v?i.createEvent("Event"):r?new Event(e):{};t&&t(i),tA.v&&i.initEvent(e,!1,!0),i&&n[Z3]?n[Z3](i):(r=n["on"+e])?r(i):(t=zi("console"))&&(t.error||t.log)(e,rn(i))}var nA,X3,Q3,J3,Tj="unhandledRejection",Yve=Tj.toLowerCase(),Kve=10;function e4(n){return $n(n)?n.toString():rn(n)}function Zve(n,e,t){var r,i,o=IT(arguments,3),a=0,l=!1,h=[],p=!1,g=null;function _(z,te){return p=!0,g&&g.cancel(),g=null,n(function(le,ce){h.push(function(){try{var _e=a===2?z:te,J=Pi(_e)?r:$n(_e)?_e(r):_e;Yf(J)?J.then(le,ce):(!_e&&a===3?ce:le)(J)}catch(pe){ce(pe)}}),l&&C()},o)}function x(){return Ej[a]}function C(){var z;0<h.length&&(z=h.slice(),h=[],p=!0,g&&g.cancel(),g=null,e(z))}function M(z,te){return function(le){a===te&&(z===2&&Yf(le)?(a=1,le.then(M(2,1),M(3,1))):(a=z,l=!0,r=le,C(),p||z!==3||(g=g||lc(L,Kve))))}}function L(){var z;p||(p=!0,uve()?process.emit(Tj,r,i):(z=os()||oc(),nA=nA||dc(Do(zi,[oE+"RejectionEvent"]).v),Wve(z,Yve,function(te){return Or(te,"promise",{g:function(){return i}}),te.reason=r,te},!!nA.v)))}Cu(i={then:_,catch:function(z){return _(void 0,z)},finally:function(z){var te=z,le=z;return $n(z)&&(te=function(ce){return z&&z(),ce},le=function(ce){throw z&&z(),ce}),_(te,le)}},"state",{get:x}),dve()&&(i[vR(11)]="IPromise"),i.toString=function(){return"IPromise "+x()+(l?" - "+e4(r):"")},$n(t)||Dc(oE+": executor is not a function - "+e4(t));var D=M(3,0);try{t.call(i,M(2,0),D)}catch(z){D(z)}return i}function Xve(n){return function(e){var t=IT(arguments,1);return n(function(r,i){try{var o=[],a=1;wR(e,function(l,h){l&&(a++,xj(l,function(p){o[h]=p,--a==0&&r(o)},i))}),--a===0&&r(o)}catch(l){i(l)}},t)}}function Qve(n){return dc(function(e){var t=IT(arguments,1);return n(function(r,i){var o=[],a=1;function l(h,p){a++,Mu(h,function(g){g.rejected?o[p]={status:RR,reason:g.reason}:o[p]={status:"fulfilled",value:g.value},--a==0&&r(o)})}try{dr(e)?on(e,l):tj(e)?wR(e,l):Dc("Input is not an iterable"),--a===0&&r(o)}catch(h){i(h)}},t)})}function Jve(n){on(n,function(e){try{e()}catch{}})}function e0e(n){var e=mb(n)?n:0;return function(t){lc(function(){Jve(t)},e)}}function Kv(n,e){return Zve(Kv,e0e(e),n,e)}function t0e(n,e){var t=(X3=X3||dc(Do(zi,[oE]).v||null)).v;if(!t)return Kv(n);$n(n)||Dc(oE+": executor is not a function - "+rn(n));var r=0;return t=new t(function(i,o){n(function(a){r=2,i(a)},function(a){r=3,o(a)})}),Cu(t,"state",{get:function(){return Ej[r]}}),t}function Ru(n,e){return(Q3=Q3||dc(t0e)).v.call(this,n,e)}var n0e=Xve(Ru);function r0e(n,e){return(J3=J3||Qve(Ru)).v(n,e)}var al=void 0,Er="",lf="channels",To="core",NI="createPerfMgr",DI="disabled",Am="extensionConfig",Hg="extensions",Al="processTelemetry",aE="priority",jw="eventsSent",Zv="eventsDiscarded",Vw="eventsSendRequest",vf="perfEvent",rA="offlineEventsStored",iA="offlineBatchSent",oA="offlineBatchDrop",sE="getPerfMgr",FI="domain",aA="path",i0e="Not dynamic - ",o0e="getPrototypeOf",a0e=/-([a-z])/g,s0e=/([^\w\d_$])/g,c0e=/^(\d+[\w\d_$])/,l0e=Object[o0e];function Mf(n){return!bt(n)}function cE(n){return n=n&&Pn(n)?(n=(n=n[Pf](a0e,function(e,t){return t.toUpperCase()}))[Pf](s0e,"_"))[Pf](c0e,function(e,t){return"_"+t}):n}function da(n,e){return!(!n||!e)&&is(n,e)!==-1}function oy(n){return n&&n.toISOString()||""}function Dr(n){return gR(n)?n[fu]:Er}function si(n,e,t,r,i){var o=t;return!n||(o=n[e])===t||i&&!i(o)||r&&!r(t)||(n[e]=o=t),o}function Ia(n,e,t){var r;return n?!(r=n[e])&&bt(r)&&(r=Pi(t)?{}:t,n[e]=r):r=Pi(t)?{}:t,r}function Sj(n,e){var t=null,r=null;return $n(n)?t=n:r=n,function(){var i=arguments;if(r=t?t():r)return r[e][Kf](r,i)}}function u0e(n,e,t){if(n&&e&&cs(n)&&cs(e))for(var r in e)(function(i){var o;Pn(i)&&(o=e[i],$n(o)?t&&!t(i,!0,e,n)||(n[i]=Sj(e,i)):t&&!t(i,!1,e,n)||(Kh(n,i)&&delete n[i],Or(n,i,{g:function(){return e[i]},s:function(a){e[i]=a}})))})(r);return n}function lE(n,e,t,r,i){n&&e&&t&&(i===!1&&!Pi(n[e])||(n[e]=Sj(t,r)))}function Av(n,e,t,r){return n&&e&&cs(n)&&dr(t)&&on(t,function(i){Pn(i)&&lE(n,i,e,i,r)}),n}function h0e(n){return function(){var e=this;n&&fr(n,function(t,r){e[t]=r})}}function Cj(n){return n=n&&xI?SR(xI({},n)):n}function Aj(n,e,t,r,i,o){var a=arguments,l=a[0]||{},h=a[jn],p=!1,g=1;for(0<h&&qz(l)&&(p=l,l=a[g]||{},g++),cs(l)||(l={});g<h;g++){var _,x,C,M,L=a[g],D=dr(L),z=cs(L);for(_ in L)(D&&_ in L||z&&Kh(L,_))&&(x=L[_],C=void 0,p&&x&&((C=dr(x))||Na(x))&&(M=l[_],C?dr(M)||(M=[]):Na(M)||(M={}),x=Aj(p,M,x)),x!==void 0)&&(l[_]=x)}return l}function sA(n,r){var t=!1,r=r&&r.featureOptIn&&r.featureOptIn[n];return t=n&&r?(n=r.mode)==3||n==1:t}function uE(n){try{return n.responseText}catch{}return null}function Ij(n,e){return n?"XDomainRequest,Response:"+uE(n)||"":e}function hE(n,e){return n?"XMLHttpRequest,Status:"+n[Cv]+",Response:"+uE(n)||n.response||"":e}function t4(n,e){return e&&(mb(e)?n=[e].concat(n):dr(e)&&(n=e.concat(n))),n}var d0e="Microsoft_ApplicationInsights_BypassAjaxInstrumentation",n4="withCredentials",f0e="timeout";function p0e(n,e,t,r,i,o){function a(h,p,g){try{h[p]=g}catch{}}r===void 0&&(r=!1),i===void 0&&(i=!1);var l=new XMLHttpRequest;return r&&a(l,d0e,r),t&&a(l,n4,t),l.open(n,e,!i),t&&a(l,n4,t),!i&&o&&a(l,f0e,o),l}function g0e(n){var e={};return Pn(n)&&on(mo(n)[iy](/[\r\n]+/),function(t){var r,i;t&&((i=t.indexOf(": "))!==-1?(r=mo(t.substring(0,i))[ny](),i=mo(t.substring(i+1)),e[r]=i):e[mo(t)]=1)}),e}function cA(n,e,t){return!n[t]&&e&&e[z3]&&(e=e[z3](t))&&(n[t]=mo(e)),n}var m0e="kill-duration",y0e="kill-duration-seconds",_0e="time-delta-millis";function lA(n,e){var t={};return n[j3]?t=g0e(n[j3]()):e&&(t=cA(t,n,_0e),t=cA(t,n,m0e),t=cA(t,n,y0e)),t}var v0e="documentMode",b0e="location",w0e="console",Pj="JSON",x0e="crypto",E0e="msCrypto",T0e="ReactNative",BI="msie",UI="trident/",Mj="XMLHttpRequest",uA=null,r4=null,S0e=!1,X_=null,hA=null;function Rj(n,e){var t,r=!1;if(n){try{(r=e in n)||(t=n[wl])&&(r=e in t)}catch{}if(!r)try{r=!Pi(new n()[e])}catch{}}return r}function dl(n){return n&&S0e&&(n=zi("__mockLocation"),n)?n:typeof location===_j&&location?location:zi(b0e)}function C0e(){return typeof console!==TR?console:zi(w0e)}function bb(){return!!(typeof JSON===_j&&JSON||zi(Pj)!==null)}function kc(){return bb()?JSON||zi(Pj):null}function A0e(){return zi(x0e)}function I0e(){return zi(E0e)}function P0e(){var n=Ol();return!(!n||!n.product)&&n.product===T0e}function zI(){var n=Ol();return!n||n[SI]===r4&&uA!==null||(n=((r4=n[SI])||Er)[ny](),uA=da(n,BI)||da(n,UI)),uA}function kj(n){var e=((n=(n=n===void 0?null:n)?n:(e=Ol()||{})?(e.userAgent||Er)[ny]():Er)||Er)[ny]();return da(e,BI)?(n=ma()||{},Math.max(parseInt(e[iy](BI)[1]),n[v0e]||0)):da(e,UI)&&(n=parseInt(e[iy](UI)[1]),n)?n+4:null}function Iv(n){return hA=hA!==null&&n!==!1?hA:cve()&&!!Ol().sendBeacon}function kR(n){var e=!1;try{var e=!!zi("fetch"),t=zi("Request");e&&n&&t&&(e=Rj(t,"keepalive"))}catch{}return e}function M0e(){return X_=X_===null&&(X_=typeof XDomainRequest!==TR)&&PT()?X_&&!Rj(zi(Mj),"withCredentials"):X_}function PT(){var n=!1;try{n=!!zi(Mj)}catch{}return n}function R0e(n,e){return!!(n&&n.dispatchEvent&&e)&&(n.dispatchEvent(e),!0)}function k0e(n,i){var t,r=null,i={detail:i||null};return $n(CustomEvent)?r=new CustomEvent(n,i):(t=ma())&&t.createEvent&&(r=t.createEvent("CustomEvent")).initCustomEvent(n,!0,!0,i),r}function O0e(n,e,t){var r=oc();if(r&&r.CustomEvent)try{return R0e(r,k0e(n,{cfg:e||null,customDetails:t||null}))}catch{}return!1}var Oj=4294967296,Xh=4294967295,Lj=123456789,Nj=987654321,Dj=!1,Hw=Lj,Gw=Nj;function L0e(n){n<0&&(n>>>=0),Hw=Lj+n&Xh,Gw=Nj-n&Xh,Dj=!0}function N0e(){try{var n=2147483647&Cl();L0e((Math.random()*Oj^n)+n)}catch{}}function D0e(n){return 0<n?Math.floor(U0()/Xh*(n+1))>>>0:0}function U0(n){var e=0,t=A0e()||I0e();return(e=t&&t.getRandomValues?t.getRandomValues(new Uint32Array(1))[0]&Xh:e)===0&&zI()&&(Dj||N0e(),e=F0e()&Xh),e===0&&(e=Math.floor(Oj*Math.random()|0)),n||(e>>>=0),e}function F0e(n){var e=((Gw=36969*(65535&Gw)+(Gw>>16)&Xh)<<16)+(65535&(Hw=18e3*(65535&Hw)+(Hw>>16)&Xh))>>>0&Xh|0;return n||(e>>>=0),e}function OR(n){n===void 0&&(n=22);for(var e=U0()>>>0,t=0,r=Er;r[jn]<n;)t++,r+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(63&e),e>>>=6,t===5&&(e=(U0()<<2&4294967295|3&e)>>>0,t=0);return r}var Fj="3.3.0",B0e="."+OR(6),U0e=0;function Bj(n){return n[ZC]===1||n[ZC]===9||!+n[ZC]}function z0e(n,e){var t=e[n.id];if(!t){t={};try{Bj(e)&&Or(e,n.id,{e:!1,v:t})}catch{}}return t}function uc(n,e){return cE(n+U0e+++((e=e===void 0?!1:e)?"."+Fj:Er)+B0e)}function Uj(n){var e={id:uc("_aiData-"+(n||Er)+"."+Fj),accept:function(t){return Bj(t)},get:function(t,r,i,o){var a=t[e.id];return a?a[cE(r)]:(o&&((a=z0e(e,t))[cE(r)]=i),i)},kill:function(t,r){if(t&&t[r])try{delete t[r]}catch{}}};return e}function qw(n){return n&&cs(n)&&(n.isVal||n.fb||Kh(n,"v")||Kh(n,"mrg")||Kh(n,"ref")||n.set)}function zj(n,e,t){var r,i=t.dfVal||Gz;if(e&&t.fb){var o=t.fb;dr(o)||(o=[o]);for(var a=0;a<o[jn];a++){var l=o[a],h=e[l];if(i(h)?r=h:n&&(i(h=n.cfg[l])&&(r=h),n.set(n.cfg,rs(l),h)),i(r))break}}return r=!i(r)&&i(t.v)?t.v:r}function jI(n,e,t){var r,i=t;return(i=t&&qw(t)?zj(n,e,t):i)&&(qw(i)&&(i=jI(n,e,i)),dr(i)?(r=[])[jn]=i[jn]:Na(i)&&(r={}),r)&&(fr(i,function(o,a){a&&qw(a)&&(a=jI(n,e,a)),r[o]=a}),i=r),i}function LR(n,e,t,_){var i,o,a,l,h,p,g=_,g=qw(g)?(i=g.isVal,o=g.set,h=g[$x],x=g[qx],a=g.mrg,!(l=g.ref)&&Pi(l)&&(l=!!a),zj(n,e,g)):_,_=(x&&n[qx](e,t),!0),x=e[t];!x&&bt(x)||(p=x,_=!1,i&&p!==g&&!i(p)&&(p=g,_=!0),o&&(_=(p=o(p,g,e))===g)),_?p=g&&jI(n,e,g):(Na(p)||dr(g))&&a&&g&&(Na(g)||dr(g))&&fr(g,function(C,M){LR(n,p,C,M)}),n.set(e,t,p),l&&n.ref(e,t),h&&n[$x](e,t)}var ld=bR("[[ai_dynCfg_1]]"),jj=bR("[[ai_blkDynCfg_1]]"),j0e=bR("[[ai_frcDynCfg_1]]");function Vj(n){var e;return n&&(dr(n)?(e=[])[jn]=n[jn]:Na(n)&&(e={}),e)?(fr(n,function(t,r){e[t]=Vj(r)}),e):n}function V0e(n){if(n){var e=n[ld]||n;if(e.cfg&&(e.cfg===n||e.cfg[ld]===e))return e}return null}function H0e(n){if(n&&(Na(n)||dr(n)))try{n[jj]=!0}catch{}return n}function dA(n,e,t){var r=!1;return r=!t||n[e.blkVal]||(r=t[j0e])||t[jj]?r:Na(t)||dr(t)}function Hj(n){Dc("InvalidAccess:"+n)}var G0e=["push","pop","shift","unshift","splice"],z0=function(n,e,t,r){n&&n[_b](3,108,"".concat(t," [").concat(e,"] failed - ")+rn(r))};function q0e(n,e,t){dr(e)&&on(G0e,function(r){var i=e[r];e[r]=function(){for(var o=[],a=0;a<arguments.length;a++)o[a]=arguments[a];var l=i[Kf](this,o);return fE(n,e,t,"Patching"),l}})}function dE(n,e){return n=mR(n,e),n&&n.get}function $0e(n,e,t,r){var i={n:t,h:[],trk:function(h){h&&h.fn&&(_a(i.h,h)===-1&&i.h[Hr](h),n.trk(h,i))},clr:function(h){h=_a(i.h,h),h!==-1&&i.h[xy](h,1)}},o=!0,a=!1;function l(){o&&(a=a||dA(l,n,r),r&&!r[ld]&&a&&(r=fE(n,r,t,"Converting")),o=!1);var h=n.act;return h&&i.trk(h),r}l[n.prop]={chng:function(){n.add(i)}},Or(e,i.n,{g:l,s:function(h){if(r!==h){l[n.ro]&&!n.upd&&Hj("["+t+"] is read-only:"+rn(e)),o&&(a=a||dA(l,n,r),o=!1);var p,g=a&&l[n.rf];if(a)if(g){fr(r,function(_){r[_]=h?h[_]:al});try{fr(h,function(_,x){MT(n,r,_,x)}),h=r}catch(_){z0((n.hdlr||{})[oo],t,"Assigning",_),a=!1}}else r&&r[ld]&&fr(r,function(x){var x=dE(r,x);x&&(x=x[n.prop])&&x.chng()});h!==r&&(p=h&&dA(l,n,h),!g&&p&&(h=fE(n,h,t,"Converting")),r=h,a=p),n.add(i)}}})}function MT(n,e,t,r){var i;return e&&((i=dE(e,t))&&i[n.prop]?e[t]=r:$0e(n,e,t,r)),e}function fA(n,e,t,r){if(e){var i=dE(e,t),o=i&&!!i[n.prop],a=r&&r[0],l=r&&r[1],r=r&&r[2];if(!o){if(r)try{H0e(e)}catch(p){z0((n.hdlr||{})[oo],t,"Blocking",p)}try{MT(n,e,t,e[t]),i=dE(e,t)}catch(p){z0((n.hdlr||{})[oo],t,"State",p)}}a&&(i[n.rf]=a),l&&(i[n.ro]=l),r&&(i[n.blkVal]=!0)}return e}function fE(n,e,t,r){try{fr(e,function(i,o){MT(n,e,i,o)}),e[ld]||(Cu(e,ld,{get:function(){return n[dj]}}),q0e(n,e,t))}catch(i){z0((n.hdlr||{})[oo],t,r,i)}return e}var Q_="[[ai_",J_="]]";function W0e(n){var e,t=Y_(Q_+"get"+n.uid+J_),r=Y_(Q_+"ro"+n.uid+J_),i=Y_(Q_+"rf"+n.uid+J_),o=Y_(Q_+"blkVal"+n.uid+J_),a=Y_(Q_+"dtl"+n.uid+J_),l=null,h=null;function p(_,x){var C=e.act;try{(e.act=_)&&_[a]&&(on(_[a],function(L){L.clr(_)}),_[a]=[]),x({cfg:n.cfg,set:n.set.bind(n),setDf:n[wy].bind(n),ref:n.ref.bind(n),rdOnly:n[$x].bind(n)})}catch(L){var M=n[oo];throw M&&M[_b](1,107,rn(L)),L}finally{e.act=C||null}}function g(){if(l){var _=l,x=(l=null,h&&h[im](),h=null,[]);if(on(_,function(C){if(C&&(C[a]&&(on(C[a],function(M){M.clr(C)}),C[a]=null),C.fn))try{p(C,C.fn)}catch(M){x[Hr](M)}}),l)try{g()}catch(C){x[Hr](C)}0<x[jn]&&Nve("Watcher error(s): ",x)}}return(t={prop:t,ro:r,rf:i})[qx]=o,t[dj]=n,t.add=function(_){if(_&&0<_.h[jn]){l=l||[],h=h||lc(function(){h=null,g()},0);for(var x=0;x<_.h[jn];x++){var C=_.h[x];C&&_a(l,C)===-1&&l[Hr](C)}}},t[Wx]=g,t.use=p,t.trk=function(_,x){_&&(_=_[a]=_[a]||[],_a(_,x)===-1)&&_[Hr](x)},e=t}function Y0e(n,e){var t={fn:e,rm:function(){t.fn=null,e=n=null}};return Or(t,"toJSON",{v:function(){return"WatcherHandler"+(t.fn?"":"[X]")}}),n.use(t,e),t}function K0e(n,e,t){var r,i,o=V0e(e);return o||(o=uc("dyncfg",!0),(e={uid:null,cfg:t=e&&t!==!1?e:Vj(e)})[oo]=n,e[Wx]=function(){r[Wx]()},e.set=function(a,l,h){try{a=MT(r,a,l,h)}catch(p){z0(n,l,"Setting value",p)}return a[l]},e[wy]=function(a,l){return l&&fr(l,function(h,p){LR(i,a,h,p)}),a},e[Af]=function(a){return Y0e(r,a)},e.ref=function(a,l){return fA(r,a,l,((a={})[0]=!0,a))[l]},e[$x]=function(a,l){return fA(r,a,l,((a={})[1]=!0,a))[l]},e[qx]=function(a,l){return fA(r,a,l,((a={})[2]=!0,a))[l]},e._block=function(a,l){r.use(null,function(h){var p=r.upd;try{Pi(l)||(r.upd=l),a(h)}finally{r.upd=p}})},Or(i=e,"uid",{c:!1,e:!1,w:!1,v:o}),fE(r=W0e(i),t,"config","Creating"),i)}function Z0e(n,e){n?(n[Yx](e),n[_b](2,108,e)):Hj(e)}function hc(n,e,t,r){return t=K0e(t,n||{},r),e&&t[wy](t.cfg,e),t}function so(n,e,t){var r=n[ld]||n;return(!r.cfg||r.cfg!==n&&r.cfg[ld]!==r?(Z0e(t,i0e+rn(n)),hc(n,null,t)):r)[Af](e)}function am(n,e){if(n&&n[cd])return n[cd](e)}function Gj(n,e,t){var r;return t||(r=Ru(function(i){t=i})),n&&0<Pve(n)?Mu(am(n[0],e),function(){Gj(IT(n,1),e,t)}):t(),r}var X0e=500,i4="Microsoft_ApplicationInsights_BypassAjaxInstrumentation";function Q0e(n,e,t){return!n&&bt(n)?e:qz(n)?n:rs(n)[ny]()==="true"}function rl(n){return{mrg:!0,v:n}}function o4(n,e){return{set:n,v:e}}function pE(n,e,t){return{fb:t,isVal:n,v:e}}function fo(n,e){return{fb:e,set:Q0e,v:!!n}}function J0e(n){return{isVal:Pn,v:rs(n||Er)}}var tw,ev,pA=[jw,Zv,Vw,vf],gE=null;function ebe(n,e){return function(){var t=arguments,r=qj(e);r&&(r=r.listener)&&r[n]&&r[n][Kf](r,t)}}function tbe(){var n=zi("Microsoft");return gE=n?n.ApplicationInsights:gE}function qj(n){var e=gE;return(e=e||n.disableDbgExt===!0?e:gE||tbe())?e.ChromeDbgExt:null}function nbe(n){if(!tw){tw={};for(var e=0;e<pA[jn];e++)tw[pA[e]]=ebe(pA[e],n)}return tw}var $j="warnToConsole",rbe="AI (Internal): ",ibe="AI: ",obe="AITR_",abe={loggingLevelConsole:0,loggingLevelTelemetry:1,maxMessageLimit:25,enableDebug:!1},sbe=((ev={})[0]=null,ev[1]="errorToConsole",ev[2]=$j,ev[3]="debugToConsole",ev);function a4(n){return n?'"'+n[Pf](/\"/g,Er)+'"':Er}function gA(n,e){var t,r=C0e();r&&(t="log",r[n]&&(t=n),$n(r[t]))&&r[t](e)}var j0=function(){function n(e,t,r,i){r===void 0&&(r=!1),this[Qx]=e,this[If]=(r?ibe:rbe)+e,r=Er,bb()&&(r=kc().stringify(i)),e=(t?" message:"+a4(t):Er)+(i?" props:"+a4(r):Er),this[If]+=e}return n.dataType="MessageData",n}();function up(n,e){return(n||{})[oo]||new mE(e)}var s4,wg,mE=function(){function n(e){this.identifier="DiagnosticLogger",this.queue=[];var t,r,i,o,a,l=0,h={};xi(n,this,function(p){function g(x,C){var M,L;i<=l||(L=!0,M=obe+C[Qx],h[M]?L=!1:h[M]=!0,L&&(x<=r&&(p.queue[Hr](C),l++,_(x===1?"error":"warn",C)),l===i)&&(L=new j0(23,M="Internal events throttle limit per PageView reached for this app.",!1),p.queue[Hr](L),x===1?p.errorToConsole(M):p[Yx](M)))}function _(x,C){var M=qj(e||{});M&&M[Zh]&&M[Zh](x,C)}a=so(hc(e||{},abe,p).cfg,function(x){x=x.cfg,t=x[pj],r=x.loggingLevelTelemetry,i=x.maxMessageLimit,o=x.enableDebug}),p.consoleLoggingLevel=function(){return t},p[_b]=function(x,C,M,L,D){if(C=new j0(C,M,D=D===void 0?!1:D,L),o)throw rn(C);M=sbe[x]||$j,Pi(C[If])?_("throw"+(x===1?"Critical":"Warning"),C):(D?(L=+C[Qx],!h[L]&&x<=t&&(p[M](C[If]),h[L]=!0)):x<=t&&p[M](C[If]),g(x,C))},p.debugToConsole=function(x){gA("debug",x),_("warning",x)},p[Yx]=function(x){gA("warn",x),_("warning",x)},p.errorToConsole=function(x){gA("error",x),_("error",x)},p.resetInternalMessageCount=function(){l=0,h={}},p[mj]=g,p[cd]=function(x){a&&a.rm(),a=null}})}return n.__ieDyn=1,n}();function NR(n){return n||new mE}function jt(n,e,t,r,i,o){o===void 0&&(o=!1),NR(n)[_b](e,t,r,i,o)}function Rf(n,e){NR(n)[Yx](e)}function cbe(n,e,t){NR(n)[mj](e,t)}var xl,c4="toGMTString",l4="toUTCString",DR="cookie",mA="expires",u4="isCookieUseDisabled",VI="disableCookiesUsage",Vh="_ckMgr",nw=null,yA=null,h4=null,d4={},yE={},lbe=((s4={cookieCfg:rl(((wg={})[FI]={fb:"cookieDomain",dfVal:Mf},wg.path={fb:"cookiePath",dfVal:Mf},wg.enabled=al,wg.ignoreCookies=al,wg.blockedCookies=al,wg)),cookieDomain:al,cookiePath:al})[VI]=al,s4);function FR(){xl=xl||sve(function(){return ma()})}function ube(n,e){var t=Xv[Vh]||yE[Vh];return t||(t=Xv[Vh]=Xv(n,e),yE[Vh]=t),t}function rw(n){return!n||n.isEnabled()}function Wj(n,e){return!!(e&&n&&dr(n.ignoreCookies))&&_a(n.ignoreCookies,e)!==-1}function hbe(n,e){return!!(e&&n&&dr(n.blockedCookies)&&_a(n.blockedCookies,e)!==-1)||Wj(n,e)}function f4(n,r){var t,r=r[om];return bt(r)&&(t=void 0,Pi(n[u4])||(t=!n[u4]),r=t=Pi(n[VI])?t:!n[VI]),r}function BR(n,e){var t,r;return n?r=n.getCookieMgr():e&&(r=(t=e.cookieCfg)&&t[Vh]?t[Vh]:Xv(e)),r=r||ube(e,(n||{})[oo])}function Xv(n,e){n=hc(n||yE,null,e).cfg,a=so(n,function(x){x[wy](x.cfg,lbe),r=x.ref(x.cfg,"cookieCfg"),i=r[aA]||"/",o=r[FI],l=f4(n,r)!==!1,h=r.getCookie||dbe,p=r.setCookie||y4,g=r.delCookie||y4},e),(t={isEnabled:function(){var x=f4(n,r)!==!1&&l&&p4(e),C=yE[Vh];return x=x&&C&&_!==C?rw(C):x},setEnabled:function(x){l=x!==!1,r[om]=x},set:function(x,C,M,L,D){var z,te,le,ce=!1;return rw(_)&&!hbe(r,x)&&(z={},te=mo(C||Er),(le=is(te,";"))!==-1&&(te=mo(yR(C,le)),z=Yj(kl(C,le+1))),si(z,FI,L||o,Hx,Pi),bt(M)||(C=zI(),Pi(z[mA])&&0<(le=Cl()+1e3*M)&&((L=new Date).setTime(le),si(z,mA,g4(L,C?c4:l4)||g4(L,C?c4:l4)||Er,Hx)),C)||si(z,"max-age",Er+M,null,Pi),(le=dl())&&le[gj]==="https:"&&(si(z,"secure",null,null,Pi),yA=yA===null?!fbe((Ol()||{})[SI]):yA)&&si(z,"SameSite","None",null,Pi),si(z,aA,D||i,null,Pi),p(x,m4(te,z)),ce=!0),ce},get:function(x){var C=Er;return C=rw(_)&&!Wj(r,x)?h(x):C},del:function(x,C){var M=!1;return M=rw(_)?_.purge(x,C):M},purge:function(x,C){var M,L=!1;return p4(e)&&((M={})[aA]=C||"/",M[mA]="Thu, 01 Jan 1970 00:00:01 GMT",C=M,zI()||(C["max-age"]="0"),g(x,m4(Er,C)),L=!0),L}})[cd]=function(x){a&&a.rm(),a=null};var t,r,i,o,a,l,h,p,g,_=t;return _[Vh]=_}function p4(n){if(nw===null){nw=!1,xl||FR();try{var e=xl.v||{};nw=e[DR]!==void 0}catch(t){jt(n,2,68,"Cannot access document.cookie - "+Dr(t),{exception:rn(t)})}}return nw}function Yj(n){var e={};return n&&n[jn]&&on(mo(n)[iy](";"),function(t){var r;(t=mo(t||Er))&&((r=is(t,"="))===-1?e[t]=null:e[mo(yR(t,r))]=mo(kl(t,r+1)))}),e}function g4(n,e){return $n(n[e])?n[e]():null}function m4(n,e){var t=n||Er;return fr(e,function(r,i){t+="; "+r+(bt(i)?Er:"="+i)}),t}function dbe(n){var e,t=Er;return xl||FR(),xl.v&&(e=xl.v[DR]||Er,h4!==e&&(d4=Yj(e),h4=e),t=mo(d4[n]||Er)),t}function y4(n,e){xl||FR(),xl.v&&(xl.v[DR]=n+"="+e)}function fbe(n){return!(!Pn(n)||!da(n,"CPU iPhone OS 12")&&!da(n,"iPad; CPU OS 12")&&!(da(n,"Macintosh; Intel Mac OS X 10_14")&&da(n,"Version/")&&da(n,"Safari"))&&(!da(n,"Macintosh; Intel Mac OS X 10_14")||!lj(n,"AppleWebKit/605.1.15 (KHTML, like Gecko)"))&&!da(n,"Chrome/5")&&!da(n,"Chrome/6")&&(!da(n,"UnrealEngine")||da(n,"Chrome"))&&!da(n,"UCBrowser/12")&&!da(n,"UCBrowser/11"))}var pbe={perfEvtsSendAll:!1};function gbe(n){n.h=null;var e=n.cb;n.cb=[],on(e,function(t){Do(t.fn,[t.arg])})}function gh(n,e,t,r){on(n,function(i){i&&i[e]&&(t?(t.cb[Hr]({fn:r,arg:i}),t.h=t.h||lc(gbe,0,t)):Do(r,[i]))})}var mbe=function(){function n(e){this.listeners=[];var t,r=[],i={h:null,cb:[]},o=hc(e,pbe)[Af](function(a){t=!!a.cfg.perfEvtsSendAll});xi(n,this,function(a){Or(a,"listeners",{g:function(){return r}}),a[Zx]=function(l){r[Hr](l)},a[Kx]=function(l){for(var h=_a(r,l);-1<h;)r[xy](h,1),h=_a(r,l)},a[jw]=function(l){gh(r,jw,i,function(h){h[jw](l)})},a[Zv]=function(l,h){gh(r,Zv,i,function(p){p[Zv](l,h)})},a[Vw]=function(l,h){gh(r,Vw,h?i:null,function(p){p[Vw](l,h)})},a[vf]=function(l){!l||!t&&l[CI]()||gh(r,vf,null,function(h){l[ry]?lc(function(){return h[vf](l)},0):h[vf](l)})},a[rA]=function(l){l&&l[jn]&&gh(r,rA,i,function(h){h[rA](l)})},a[iA]=function(l){l&&l[Vg]&&gh(r,iA,i,function(h){h[iA](l)})},a[oA]=function(l,h){var p;0<l&&(p=h||0,gh(r,oA,i,function(g){g[oA](l,p)}))},a[cd]=function(l){function h(){o&&o.rm(),o=null,r=[],i.h&&i.h[im](),i.h=null,i.cb=[]}var p;if(gh(r,"unload",null,function(g){g=g[cd](l),g&&(p=p||[])[Hr](g)}),p)return Ru(function(g){return Mu(n0e(p),function(){h(),g()})});h()}})}return n.__ieDyn=1,n}(),Im="ctx",HI="ParentContextKey",Qv="ChildrenContextKey",ybe=null,$w=function(){function n(e,t,r){var i,o=this;o.start=Cl(),o[fu]=e,o[ry]=r,o[CI]=function(){return!1},$n(t)&&Or(o,"payload",{g:function(){return!i&&$n(t)&&(i=t(),t=null),i}}),o[Sm]=function(a){return a?(a===n[HI]||a===n[Qv]?o:o[Im]||{})[a]:null},o[tl]=function(a,l){a&&(a===n[HI]?(o[a]||(o[CI]=function(){return!0}),o[a]=l):a===n[Qv]?o[a]=l:(o[Im]=o[Im]||{})[a]=l)},o[AI]=function(){var a=0,l=o[Sm](n[Qv]);if(dr(l))for(var h=0;h<l[jn];h++){var p=l[h];p&&(a+=p[Tm])}o[Tm]=Cl()-o.start,o.exTime=o[Tm]-a,o[AI]=function(){}}}return n.ParentContextKey="parent",n.ChildrenContextKey="childEvts",n}(),_be=function(){function n(e){this.ctx={},xi(n,this,function(t){t.create=function(r,i,o){return new $w(r,i,o)},t.fire=function(r){r&&(r[AI](),e)&&$n(e[vf])&&e[vf](r)},t[tl]=function(r,i){r&&((t[Im]=t[Im]||{})[r]=i)},t[Sm]=function(r){return(t[Im]||{})[r]}})}return n.__ieDyn=1,n}(),_A="CoreUtils.doPerf";function _E(n,e,t,r,i){if(n&&(n=n[sE]?n[sE]():n)){var o,a=void 0,l=n[Sm](_A);try{if(a=n.create(e(),r,i))return l&&a[tl]&&(a[tl]($w[HI],l),l[Sm])&&l[tl]&&((o=l[Sm]($w[Qv]))||(o=[],l[tl]($w[Qv],o)),o[Hr](a)),n[tl](_A,a),t(a)}catch(h){a&&a[tl]&&a[tl]("exception",h)}finally{a&&n.fire(a),n[tl](_A,l)}}return t()}function vbe(){return ybe}function Hh(){for(var n,e=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"],t=Er,r=0;r<4;r++)t+=e[15&(n=U0())]+e[n>>4&15]+e[n>>8&15]+e[n>>12&15]+e[n>>16&15]+e[n>>20&15]+e[n>>24&15]+e[n>>28&15];var i=e[8+(3&U0())|0];return Oh(t,0,8)+Oh(t,9,4)+"4"+Oh(t,13,3)+i+Oh(t,16,3)+Oh(t,19,12)}var GI="00",bbe="ff",Kj="00000000000000000000000000000000",Zj="0000000000000000";function wb(n,e,t){return!(!n||n[jn]!==e||n===t||!n.match(/^[\da-f]*$/i))}function _4(n,e,t){return wb(n,e)?n:t}function wbe(n){for(var e=(n=isNaN(n)||n<0||255<n?1:n).toString(16);e[jn]<2;)e="0"+e;return e}function v4(n,e,t,r){var i={};return i[Xx]=wb(r,2,bbe)?r:GI,i[II]=UR(n)?n:Hh(),i[PI]=zR(e)?e:yR(Hh(),16),i.traceFlags=0<=t&&t<=255?t:1,i}function UR(n){return wb(n,32,Kj)}function zR(n){return wb(n,16,Zj)}function b4(n){var e,t;return n?(wb(e=wbe(n[MI]),2)||(e="01"),t=n[Xx]||GI,"".concat((t=t!=="00"&&t!=="ff"?GI:t).toLowerCase(),"-").concat(_4(n.traceId,32,Kj).toLowerCase(),"-").concat(_4(n.spanId,16,Zj).toLowerCase(),"-").concat(e.toLowerCase())):""}var xbe=Uj("plugin");function kf(n){return xbe.get(n,"state",{},!0)}function w4(n,e){for(var t=[],r=null,i=n[bl]();i;){var o,a,l=i[L0]();l&&(r&&r[D0]&&l[Al]&&r[D0](l),a=!!(o=kf(l))[hl],(a=l[hl]?l[hl]():a)||t[Hr](l),r=l,i=i[bl]())}on(t,function(h){var p=n[To]();h[vb](n.getCfg(),p,e,n[bl]()),o=kf(h),h[To]||o[To]||(o[To]=p),o[hl]=!0,delete o[iu]})}function vA(n){return n.sort(function(e,t){var r,i=0;return t?(r=t[Al],e[Al]?i=r?e[aE]-t[aE]:1:r&&(i=-1)):i=e?1:-1,i})}function Ebe(n){var e={};return{getName:function(){return e[fu]},setName:function(t){n&&n.setName(t),e[fu]=t},getTraceId:function(){return e[II]},setTraceId:function(t){n&&n.setTraceId(t),UR(t)&&(e[II]=t)},getSpanId:function(){return e[PI]},setSpanId:function(t){n&&n.setSpanId(t),zR(t)&&(e[PI]=t)},getTraceFlags:function(){return e[MI]},setTraceFlags:function(t){n&&n.setTraceFlags(t),e[MI]=t}}}var x4,Tbe="TelemetryPluginChain",E4="_hasRun",T4="_getTelCtx",S4=0;function Sbe(n,e,t){for(;n;){if(n[L0]()===t)return n;n=n[bl]()}return Qf([t],e.config||{},e)}function jR(n,e,t,r){var i=null,o=[],a=(e=e||hc({},null,t[oo]),r!==null&&(i=r?Sbe(n,t,r):n),{_next:function(){var h=i;{var p;i=h?h[bl]():null,h||(p=o)&&0<p[jn]&&(on(p,function(g){try{g.func.call(g.self,g.args)}catch(_){jt(t[oo],2,73,"Unexpected Exception during onComplete - "+rn(_))}}),o=[])}return h},ctx:{core:function(){return t},diagLog:function(){return up(t,e.cfg)},getCfg:function(){return e.cfg},getExtCfg:function(h,p){var g=l(h,!0);return p&&fr(p,function(_,x){var C;!bt(g[_])||!(C=e.cfg[_])&&bt(C)||(g[_]=C),LR(e,g,_,x)}),e[wy](g,p)},getConfig:function(x,p,g){g===void 0&&(g=!1);var _,x=l(x,!1),C=e.cfg;return!x||!x[p]&&bt(x[p])?!C[p]&&bt(C[p])||(_=C[p]):_=x[p],_||!bt(_)?_:g},hasNext:function(){return!!i},getNext:function(){return i},setNext:function(h){i=h},iterate:function(h){for(;p=a._next();){var p=p[L0]();p&&h(p)}},onComplete:function(h,p){for(var g=[],_=2;_<arguments.length;_++)g[_-2]=arguments[_];h&&o[Hr]({func:h,self:Pi(p)?a.ctx:p,args:g})}}});function l(h,p){var g,_=null,x=e.cfg;return x&&h&&(g=x[Am],x[Am]=g=!g&&p?{}:g,g=e.ref(x,Am))&&(_=g[h],g[h]=_=!_&&p?{}:_,_=e.ref(g,h)),_}return a}function Oc(n,e,t,r){var i=hc(e),o=jR(n,i,t,r),a=o.ctx;return a[ka]=function(l){var h=o._next();return h&&h[Al](l,a),!h},a[Zf]=function(l,h){return Oc((l=dr(l=l===void 0?null:l)?Qf(l,i.cfg,t,h):l)||a[bl](),i.cfg,t,h)},a}function vE(n,e,t){var r=hc(e.config),i=jR(n,r,e,t),o=i.ctx;return o[ka]=function(a){var l=i._next();return l&&l[cd](o,a),!l},o[Zf]=function(a,l){return vE((a=dr(a=a===void 0?null:a)?Qf(a,r.cfg,e,l):a)||o[bl](),e,l)},o}function VR(n,e,t){var r=hc(e.config),i=jR(n,r,e,t).ctx;return i[ka]=function(o){return i.iterate(function(a){$n(a[N0])&&a[N0](i,o)})},i[Zf]=function(o,a){return VR((o=dr(o=o===void 0?null:o)?Qf(o,r.cfg,e,a):o)||i[bl](),e,a)},i}function Qf(n,e,t,r){var i,o=null,a=!r;return dr(n)&&0<n[jn]&&(i=null,on(n,function(l){(a=a||r!==l?a:!0)&&l&&$n(l[Al])&&(l=Cbe(l,e,t),o=o||l,i&&i._setNext(l),i=l)})),r&&!o?Qf([r],e,t):o}function Cbe(n,e,t){var r=null,i=$n(n[Al]),o=$n(n[D0]),a=n?n[Lh]+"-"+n[aE]+"-"+S4++:"Unknown-0-"+S4++,l={getPlugin:function(){return n},getNext:function(){return r},processTelemetry:function(p,g){h(g=g||function(){var _;return n&&$n(n[T4])&&(_=n[T4]()),_=_||Oc(l,e,t),_}(),function(_){var x;return!(!n||!i||(x=kf(n))[iu]||x[DI]||(o&&n[D0](r),n[Al](p,_),0))},"processTelemetry",function(){return{item:p}},!p.sync)||g[ka](p)},unload:function(p,g){h(p,function(){var _,x,C=!1;return n&&(_=kf(n),x=n[To]||_[To],!n||x&&x!==p.core()||_[iu]||(_[To]=null,_[iu]=!0,_[hl]=!1,n[iu]&&n[iu](p,g)===!0&&(C=!0))),C},"unload",function(){},g[ry])||p[ka](g)},update:function(p,g){h(p,function(){var _,x,C=!1;return n&&(_=kf(n),x=n[To]||_[To],!n||x&&x!==p.core()||_[iu]||n[N0]&&n[N0](p,g)===!0&&(C=!0)),C},"update",function(){},!1)||p[ka](g)},_id:a,_setNext:function(p){r=p}};function h(p,g,_,x,C){var M=!1,L=n?n[Lh]:Tbe,D=(D=p[E4])||(p[E4]={});return p.setNext(r),n&&_E(p[To](),function(){return L+":"+_},function(){D[a]=!0;try{var z=r?r._id:Er;z&&(D[z]=!1),M=g(p)}catch(te){z=!r||D[r._id],z&&(M=!0),r&&z||jt(p[Zh](),1,73,"Plugin ["+L+"] failed during "+_+" - "+rn(te)+", run flags: "+rn(D))}},x,C),M}return Au(l)}function Xj(){var n=[];return{add:function(e){e&&n[Hr](e)},run:function(e,t){on(n,function(r){try{r(e,t)}catch(i){jt(e[Zh](),2,73,"Unexpected error calling unload handler - "+rn(i))}}),n=[]}}}function Qj(){var n=[];return{run:function(e){var t=n;n=[],on(t,function(r){try{(r.rm||r.remove).call(r)}catch(i){jt(e,2,73,"Unloading:"+rn(i))}})},add:function(e){e&&rm(n,e)}}}var mh="getPlugin",Abe=((x4={})[Am]={isVal:Mf,v:{}},x4),Ey=function(){function n(){var e,t,r,i,o,a=this;function l(x){var _,x=x=x===void 0?null:x;return x||(_=t||Oc(null,{},a[To]),x=r&&r[mh]?_[Zf](null,r[mh]):_[Zf](null,r)),x}function h(g,_,x){hc(g,Abe,up(_)),!x&&_&&(x=_[fj]()[bl]());var C=r;r&&r[mh]&&(C=r[mh]()),a[To]=_,t=Oc(x,g,_,C)}function p(){e=!1,a[To]=null,r=t=null,o=Qj(),i=Xj()}p(),xi(n,a,function(g){g[vb]=function(_,x,C,M){h(_,x,M),e=!0},g[iu]=function(_,x){var C,M,L,D,z=g[To];if(z&&(!_||z===_[To]()))return M=!1,L=_||vE(null,z,r&&r[mh]?r[mh]():r),D=x||((_={reason:0})[ry]=!1,_),g[Jx]&&g[Jx](L,D,te)===!0?C=!0:te(),C;function te(){M||(M=!0,i.run(L,x),o.run(L[Zh]()),C===!0&&L[ka](D),p())}},g[N0]=function(_,x){var C,M,L,D=g[To];if(D&&(!_||D===_[To]()))return M=!1,L=_||VR(null,D,r&&r[mh]?r[mh]():r),g._doUpdate&&g._doUpdate(L,x||{reason:0},z)===!0?C=!0:z(),C;function z(){M||(M=!0,h(L.getCfg(),L.core(),L[bl]()))}},lE(g,"_addUnloadCb",function(){return i},"add"),lE(g,"_addHook",function(){return o},"add"),Or(g,"_unloadHooks",{g:function(){return o}})}),a[Zh]=function(g){return l(g)[Zh]()},a[hl]=function(){return e},a.setInitialized=function(g){e=g},a[D0]=function(g){r=g},a[ka]=function(g,_){_?_[ka](g):r&&$n(r[Al])&&r[Al](g,null)},a._getTelCtx=l}return n.__ieDyn=1,n}();function Ibe(n,e,t){var r={id:e,fn:t};return rm(n,r),{remove:function(){on(n,function(i,o){if(i.id===r.id)return n[xy](o,1),-1})}}}function Pbe(n,e,t){for(var r=!1,i=n[jn],o=0;o<i;++o){var a=n[o];if(a)try{if(a.fn[Kf](null,[e])===!1){r=!0;break}}catch(l){jt(t,2,64,"Telemetry initializer failed: "+Dr(l),{exception:rn(l)},!0)}}return!r}var Gd,Mbe=function(n){function e(){var t,r,i=n.call(this)||this;function o(){t=0,r=[]}return i.identifier="TelemetryInitializerPlugin",i.priority=199,o(),xi(e,i,function(a,l){a.addTelemetryInitializer=function(h){return Ibe(r,t++,h)},a[Al]=function(h,p){Pbe(r,h,(p||a)[Zh]())&&a[ka](h,p)},a[Jx]=function(){o()}}),i}return Uu(e,n),e.__ieDyn=1,e}(Ey),Jj="Plugins must provide initialize method",Rbe="_notificationManager",C4="SDK is still unloading...",kbe="SDK is not initialized",Obe=100,Lbe=5e4,bA=vy(((Gd={cookieCfg:{}})[Hg]={rdOnly:!0,ref:!0,v:[]},Gd[lf]={rdOnly:!0,ref:!0,v:[]},Gd[Am]={ref:!0,v:{}},Gd[NI]=al,Gd.loggingLevelConsole=0,Gd.diagnosticLogInterval=al,Gd));function Nbe(n,e){return new _be(e)}function Dbe(n,e,t){var r=[],i=[],o={};return on(t,function(a){(bt(a)||bt(a[vb]))&&As(Jj);var l=a[aE],h=a[Lh];a&&l&&(bt(o[l])?o[l]=h:Rf(n,"Two extensions have same priority #"+l+" - "+o[l]+", "+h)),(!l||l<e?r:i)[Hr](a)}),(t={})[To]=r,t[lf]=i,t}function A4(n,e){var t=!1;return on(e,function(r){if(r===n)return t=!0,-1}),t}function qI(n,e,t,r){t&&fr(t,function(i,o){r&&Na(o)&&Na(e[i])&&qI(n,e[i],o,r),r&&Na(o)&&Na(e[i])?qI(n,e[i],o,r):n.set(e,i,o)})}function I4(n,e){var t=null,r=-1;return on(n,function(i,o){if(i.w===e)return t=i,r=o,-1}),{i:r,l:t}}function Fbe(n,e){var t=I4(n,e).l;return t||n[Hr](t={w:e,rm:function(){var r=I4(n,e);r.i!==-1&&n[xy](r.i,1)}}),t}function Bbe(n,e,t){on(e,function(r){var i=so(n,r.w,t);delete r.w,r.rm=function(){i.rm()}})}function Ube(n,e,t,r){return e.add(n[Af](function(i){var o=i.cfg.disableDbgExt;o===!0&&r&&(t[Kx](r),r=null),t&&!r&&o!==!0&&(r=nbe(i.cfg),t[Zx](r))})),r}function zbe(n){return Or({rm:function(){n.rm()}},"toJSON",{v:function(){return"aicore::onCfgChange<"+JSON.stringify(n)+">"}})}var jbe=function(){function n(){var e,t,r,i,o,a,l,h,p,g,_,x,C,M,L,D,z,te,le,ce,_e,J,pe,ue,xe,je,ne,Ee,ke,Be,Ze,at;xi(n,this,function(Re){function ht(){ke=!0,bt(_e)?(je=Ph[KC],jt(r,1,112,"ikey can't be resolved from promises")):je=Ph.ACTIVE,Rt()}function Rt(){t&&(Re.releaseQueue(),Re[B3]())}function hn(F){return Be&&Be[om]||at||(F||r&&0<r.queue[jn])&&(Ze||(Ze=!0,H(e[Af](function(ae){var ae=ae.cfg.diagnosticLogInterval,q=(ae&&0<ae||(ae=1e4),!1);Be&&(q=Be[om],Be[im]()),(Be=Ove(En,ae)).unref(),Be[om]=q}))),Be[om]=!0),Be}function wt(){function F(ae){ae&&on(ae,function(q){var Ae;q[Lh]&&q[Xx]&&!Q[q.identifier]&&(Ae=q[Lh]+"="+q[Xx],ue[Hr](Ae),Q[q.identifier]=q)})}var Q={};ue=[],F(x),_&&on(_,function(ae){F(ae)}),F(g)}function Ge(){t=!1,(e=hc({},bA,Re[oo])).cfg[pj]=1,Or(Re,"config",{g:function(){return e.cfg},s:function(Q){Re.updateCfg(Q,!1)}}),Or(Re,"pluginVersionStringArr",{g:function(){return ue||wt(),ue}}),Or(Re,"pluginVersionString",{g:function(){return xe||(ue||wt(),xe=ue.join(";")),xe||Er}}),Or(Re,"logger",{g:function(){return r||(r=new mE(e.cfg),e[oo]=r),r},s:function(Q){e[oo]=Q,r!==Q&&(am(r,!1),r=Q)}}),Re[oo]=new mE(e.cfg),pe=[];var F=Re.config[Hg]||[];F.splice(0,F[jn]),rm(F,pe),M=new Mbe,am(o,!(i=[])),l=a=o=null,am(h,!1),C=!(g=[]),D=uc("AIBaseCore",!(L=x=_=p=h=null)),z=Xj(),_e=ce=null,te=Qj(),je=0,Ee=ne=Be=ue=xe=null,ke=Ze=at=!(J=[])}function Gn(){var F=Oc(Mn(),e.cfg,Re);return F[J1](hn),F}function Xt(F){var Q=Dbe(Re[oo],X0e,g),Q=(ue=xe=p=null,x=vA(rm(x=(_||[])[0]||[],Q[lf])),rm(vA(Q[To]),x)),ae=(pe=Au(Q),Re.config[Hg]||[]),ae=(ae.splice(0,ae[jn]),rm(ae,pe),Gn());x&&0<x[jn]&&w4(ae[Zf](x),Q),w4(ae,Q),F&&It(F)}function ln(F){var Q=null,ae=null,q=[];return on(pe,function(Ae){if(Ae[Lh]===F&&Ae!==M)return ae=Ae,-1;Ae.getChannel&&q[Hr](Ae)}),!ae&&0<q[jn]&&on(q,function(Ae){if(!(ae=Ae.getChannel(F)))return-1}),Q=ae?{plugin:ae,setEnabled:function(Ae){kf(ae)[DI]=!Ae},isEnabled:function(){var Ae=kf(ae);return!Ae[iu]&&!Ae[DI]},remove:function(Ae,Pe){var We,rt=[ae];(We={reason:1})[ry]=Ae=Ae===void 0?!0:Ae,Ot(rt,We,function(Et){Et&&Xt({reason:32,removed:rt}),Pe&&Pe(Et)})}}:Q}function Mn(){var F;return p||(F=(pe||[]).slice(),_a(F,M)===-1&&F[Hr](M),p=Qf(vA(F),e.cfg,Re)),p}function Ot(F,Q,ae){var q;F&&0<F[jn]?((q=vE(Qf(F,e.cfg,Re),Re))[J1](function(){var Ae=!1,Pe=[],We=(on(g,function(rt,Et){A4(rt,F)?Ae=!0:Pe[Hr](rt)}),g=Pe,ue=xe=null,[]);_&&(on(_,function(rt,Et){var Bt=[];on(rt,function(Lt){A4(Lt,F)?Ae=!0:Bt[Hr](Lt)}),We[Hr](Bt)}),_=We),ae&&ae(Ae),hn()}),q[ka](Q)):ae(!1)}function En(){var F;r&&r.queue&&(F=r.queue.slice(0),r.queue[jn]=0,on(F,function(q){(ae={})[fu]=L||"InternalMessageId: "+q[Qx],ae[K_]=_e,ae[Tm]=oy(new Date),ae.baseType=j0.dataType,ae.baseData={message:q[If]};var ae,q=ae;Re.track(q)}))}function lt(F,Q,ae,q){var Ae=1,Pe=!1,We=null;function rt(){Ae--,Pe&&Ae===0&&(We&&We[im](),We=null,Q&&Q(Pe),Q=null)}return q=q||5e3,x&&0<x[jn]&&Gn()[Zf](x).iterate(function(Et){var Bt;Et.flush&&(Ae++,Bt=!1,Et.flush(F,function(){Bt=!0,rt()},ae)||Bt||(F&&We==null?We=lc(function(){We=null,rt()},q):rt()))}),Pe=!0,rt(),!0}function It(F){var Q=VR(Mn(),Re);Q[J1](hn),Re._updateHook&&Re._updateHook(Q,F)===!0||Q[ka](F)}function he(F){var Q=Re[oo];Q?(jt(Q,2,73,F),hn()):As(F)}function B(F){var Q=Re[Q1]();Q&&Q[Zv]([F],2)}function H(F){te.add(F)}Ge(),Re._getDbgPlgTargets=function(){return[pe,i]},Re[hl]=function(){return t},Re.activeStatus=function(){return je},Re._setPendingStatus=function(){je=3},Re[vb]=function(F,Q,ae,Pe){C&&As(C4),Re[hl]()&&As("Core cannot be initialized more than once"),e=hc(F,bA,ae||Re[oo],!1),F=e.cfg,H(e[Af](function(We){var rt,Et,Bt,Lt,an=We.cfg;je!==3&&(Ee=an.initInMemoMaxSize||Obe,Et=an[F3],Bt=an.endpointUrl,bt(Et)?(_e=null,je=Ph[KC],rt="Please provide instrumentation key",t?(jt(r,1,100,rt),Rt()):As(rt)):(rt=[],_e=Yf(Et)?(rt[Hr](Et),null):Et,ne=Yf(Bt)?(rt[Hr](Bt),null):Bt,rt[jn]?(ke=!1,je=3,Et=Mf(an.initTimeOut)?an.initTimeOut:Lbe,Bt=r0e(rt),lc(function(){ke||ht()},Et),Mu(Bt,function(Ie){try{var Te,At,xt;ke||(Ie.rejected||((Te=Ie[Yv])&&Te[jn]&&(At=Te[0],_e=At&&At[Yv],1<Te[jn])&&(xt=Te[1],ne=xt&&xt[Yv]),_e&&(F[F3]=_e,F.endpointUrl=ne)),ht())}catch{ke||ht()}})):ht(),fr(Lt=We.ref(We.cfg,Am),function(Ie){We.ref(Lt,Ie)})))})),le=Ube(e,te,(o=Pe)&&Re[Q1](),le),H(e[Af](function(We){var rt;We.cfg.enablePerfMgr?(rt=We.cfg[NI],Ae!==rt&&(Ia(We.cfg,NI,rt=rt||Nbe),Ae=rt,l=null),a||l||!$n(rt)||(l=rt(Re,Re[Q1]()))):Ae=l=null})),Re[oo]=ae;var Ae,Pe=F[Hg];(g=[])[Hr].apply(g,q3(q3([],Q,!1),Pe)),_=F[lf],Xt(null),x&&x[jn]!==0||As("No "+lf+" available"),_&&1<_[jn]&&((ae=Re[L0]("TeeChannelController"))&&ae.plugin||jt(r,1,28,"TeeChannel required")),Bbe(F,J,r),t=!(J=null),je===Ph.ACTIVE&&Rt()},Re.getChannels=function(){var F=[];return x&&on(x,function(Q){F[Hr](Q)}),Au(F)},Re.track=function(F){_E(Re[sE](),function(){return"AppInsightsCore:track"},function(){F===null&&(B(F),As("Invalid telemetry item")),!F[fu]&&bt(F[fu])&&(B(F),As("telemetry name required")),F[K_]=F[K_]||_e,F[Tm]=F[Tm]||oy(new Date),F.ver=F.ver||"4.0",!C&&Re[hl]()&&je===Ph.ACTIVE?Gn()[ka](F):je!==Ph[KC]&&i[jn]<=Ee&&i[Hr](F)},function(){return{item:F}},!F.sync)},Re[fj]=Gn,Re[Q1]=function(){return o||(o=new mbe(e.cfg),Re[Rbe]=o),o},Re[Zx]=function(F){Re.getNotifyMgr()[Zx](F)},Re[Kx]=function(F){o&&o[Kx](F)},Re.getCookieMgr=function(){return h=h||Xv(e.cfg,Re[oo])},Re.setCookieMgr=function(F){h!==F&&(am(h,!1),h=F)},Re[sE]=function(){return a||l||vbe()},Re.setPerfMgr=function(F){a=F},Re.eventCnt=function(){return i[jn]},Re.releaseQueue=function(){var F;t&&0<i[jn]&&(F=i,i=[],je===2?on(F,function(Q){Q[K_]=Q[K_]||_e,Gn()[ka](Q)}):jt(r,2,20,"core init status is not active"))},Re[B3]=function(F){return L=F||null,at=!1,Be&&Be[im](),hn(!0)},Re[U3]=function(){at=!0,Be&&Be[im](),En()},Av(Re,function(){return M},["addTelemetryInitializer"]),Re[cd]=function(F,Q,ae){F===void 0&&(F=!0),t||As(kbe),C&&As(C4),(q={reason:50})[ry]=F,q.flushComplete=!1;var q,Ae,Pe=q,We=(F&&!Q&&(Ae=Ru(function(rt){Q=rt})),vE(Mn(),Re));return We[J1](function(){te.run(Re[oo]),Gj([h,o,r],F,function(){Ge(),Q&&Q(Pe)})},Re),En(),lt(F,function(rt){Pe.flushComplete=rt,C=!0,z.run(We,Pe),Re[U3](),We[ka](Pe)},6,ae),Ae},Re[L0]=ln,Re.addPlugin=function(F,Q,ae,q){var Ae,Pe,We;function rt(){g[Hr](F),Pe.added=[F],Xt(Pe),q&&q(!0)}F?(Ae=ln(F[Lh]))&&!Q?(q&&q(!1),he("Plugin ["+F[Lh]+"] is already loaded!")):(Pe={reason:16},Ae?Ot(We=[Ae.plugin],{reason:2,isAsync:!!ae},function(Et){Et?(Pe.removed=We,Pe.reason|=32,rt()):q&&q(!1)}):rt()):(q&&q(!1),he(Jj))},Re.updateCfg=function(F,Q){var ae,q;Q===void 0&&(Q=!0),Re[hl]()&&(ae={reason:1,cfg:e.cfg,oldCfg:D3({},e.cfg),newConfig:D3({},F),merge:Q},F=ae.newConfig,q=e.cfg,F[Hg]=q[Hg],F[lf]=q[lf]),e._block(function(Ae){var Pe=Ae.cfg;qI(Ae,Pe,F,Q),Q||fr(Pe,function(We){Kh(F,We)||Ae.set(Pe,We,al)}),Ae[wy](Pe,bA)},!0),e[Wx](),ae&&It(ae)},Re.evtNamespace=function(){return D},Re.flush=lt,Re.getTraceCtx=function(F){return ce=ce||Ebe()},Re.setTraceCtx=function(F){ce=F||null},Re.addUnloadHook=H,lE(Re,"addUnloadCb",function(){return z},"add"),Re.onCfgChange=function(F){return F=t?so(e.cfg,F,Re[oo]):Fbe(J,F),zbe(F)},Re.getWParam=function(){return Qz()||e.cfg.enableWParam?0:-1}})}return n.__ieDyn=1,n}();function wA(n,e){try{if(n&&n!==""){var t=kc().parse(n);if(t&&t[V3]&&t[V3]>=t.itemsAccepted&&t.itemsReceived-t.itemsAccepted===t.errors[jn])return t}}catch(r){jt(e,1,43,"Cannot parse the response. "+(r[fu]||rn(r)),{response:n})}return null}var el="",Vbe="NoResponseBody",P4="&"+Vbe+"=true",xA="POST",Hbe=function(){function n(){var e,t,r,i,o,a,l,h,p,g,_,x,C,M=0;xi(n,this,function(L,D){var z=!0;function te(ne,Ee){jt(r,2,26,"Failed to send telemetry.",{message:ne}),ce(Ee,400,{})}function le(ne){te("No endpoint url is provided for the batch",ne)}function ce(ne,Ee,ke,Be){try{ne&&ne(Ee,ke,Be)}catch{}}function _e(ne,Ee){var ke,Be=Ol();return(ke=ne[Z_])?(ke=ne[Z_]+(x?P4:el),ne=ne[Vg],ne=i?ne:new Blob([ne],{type:"text/plain;charset=UTF-8"}),Be.sendBeacon(ke,ne)):(le(Ee),!0)}function J(ne,Ee,ke){var Be,Ze=ne[Vg];try{Ze&&(_e(ne,Ee)?ce(Ee,200,{},el):(Be=o&&o.beaconOnRetry)&&$n(Be)?Be(ne,Ee,_e):(l&&l[H3](ne,Ee,!0),jt(r,2,40,". Failed to send telemetry with Beacon API, retried with normal sender.")))}catch(at){i&&Rf(r,"Failed to send telemetry using sendBeacon API. Ex:"+rn(at)),ce(Ee,i?0:400,{},el)}}function pe(ne,Ee,ke){var Be,Ze,at,Re,ht=ne[XC]||{},Rt=(!ke&&e&&(Be=Ru(function(wt,Ge){Ze=wt,at=Ge})),i&&ke&&ne.disableXhrSync&&(ke=!1),ne[Z_]);if(Rt)return Re=p0e(xA,Rt,z,!0,ke,ne[bg]),i||Re[G3]("Content-type","application/json"),on(du(ht),function(wt){Re[G3](wt,ht[wt])}),Re.onreadystatechange=function(){i||(hn(Re),Re.readyState===4&&Ze&&Ze(!0))},Re.onload=function(){i&&hn(Re)},Re.onerror=function(wt){ce(Ee,i?Re[Cv]:400,lA(Re,i),i?el:hE(Re)),at&&at(wt)},Re.ontimeout=function(){ce(Ee,i?Re[Cv]:500,lA(Re,i),i?el:hE(Re)),Ze&&Ze(!1)},Re.send(ne[Vg]),Be;function hn(wt){var Ge=o&&o.xhrOnComplete;Ge&&$n(Ge)?Ge(wt,Ee,ne):(Ge=uE(wt),ce(Ee,wt[Cv],lA(wt,i),Ge))}le(Ee),Ze&&Ze(!1)}function ue(ne,Ee,ke){var Be,Ze,at,Re=ne[Z_],wt=ne[Vg],ht=i?wt:new Blob([wt],{type:"application/json"}),Rt=new Headers,hn=wt[jn],wt=!1,Ge=!1,Gn=ne[XC]||{},Xt=((ht={method:xA,body:ht})[i4]=!0,ne.headers&&0<du(ne.headers)[jn]&&(on(du(Gn),function(Ot){Rt.append(Ot,Gn[Ot])}),ht[XC]=Rt),z&&i&&(ht.credentials="include"),ke&&(ht.keepalive=!0,M+=hn,i?ne._sendReason===2&&(wt=!0,x)&&(Re+=P4):wt=!0),new Request(Re,ht));try{Xt[i4]=!0}catch{}if(!ke&&e&&(Be=Ru(function(Ot,En){Ze=Ot,at=En})),Re){try{Mu(fetch(i?Re:Xt,i?ht:null),function(Ot){if(ke&&(M-=hn,hn=0),!Ge)if(Ge=!0,Ot.rejected)ln(Ot.reason&&Ot.reason[If]),at&&at(Ot.reason);else{var En=Ot[Yv];try{i||En.ok?i&&!En.body?(Mn(En,null,el),Ze&&Ze(!0)):Mu(En.text(),function(lt){Mn(En,ne,lt[Yv]),Ze&&Ze(!0)}):(ln(En.statusText),Ze&&Ze(!1))}catch(lt){ln(rn(lt)),at&&at(lt)}}})}catch(Ot){Ge||(ln(rn(Ot)),at&&at(Ot))}return wt&&!Ge&&(Ge=!0,ce(Ee,200,{}),Ze)&&Ze(!0),i&&!Ge&&0<ne[bg]&&C&&C.set(function(){Ge||(Ge=!0,ce(Ee,500,{}),Ze&&Ze(!0))},ne[bg]),Be}function ln(Ot){ce(Ee,i?0:400,{},i?el:Ot)}function Mn(Ot,En,lt){var It=Ot[Cv],he=o.fetchOnComplete;he&&$n(he)?he(Ot,Ee,lt||el,En):ce(Ee,It,{},lt||el)}le(Ee),Ze&&Ze(!1)}function xe(ne,Ee,ke){var at=os(),Be=new XDomainRequest,Ze=ne[Vg],at=(Be.onload=function(){var ht=uE(Be),Rt=o&&o.xdrOnComplete;Rt&&$n(Rt)?Rt(Be,Ee,ne):ce(Ee,200,{},ht)},Be.onerror=function(){ce(Ee,400,{},i?el:Ij(Be))},Be.ontimeout=function(){ce(Ee,500,{})},Be.onprogress=function(){},at&&at.location&&at.location[gj]||""),Re=ne[Z_];Re?i||Re.lastIndexOf(at,0)===0?(at=i?Re:Re[Pf](/^(https?:)/,""),Be.open(xA,at),ne[bg]&&(Be[bg]=ne[bg]),Be.send(Ze),i&&ke?C&&C.set(function(){Be.send(Ze)},0):Be.send(Ze)):(jt(r,2,40,". "+(Re="Cannot send XDomain request. The endpoint URL protocol doesn't match the hosting page protocol.")),te(Re,Ee)):le(Ee)}function je(){M=0,x=_=g=p=h=e=t=!1,C=l=a=o=i=r=null}je(),L[vb]=function(ne,Ee){r=Ee,t&&jt(r,1,28,"Sender is already initialized"),L.SetConfig(ne),t=!0},L._getDbgPlgTargets=function(){return[t,i,a,e]},L.SetConfig=function(ne){try{var Ee;return o=ne.senderOnCompleteCallBack||{},a=!!ne.disableCredentials,i=!!ne.isOneDs,e=!!ne.enableSendPromise,h=!!ne.disableXhr,p=!!ne.disableBeacon,g=!!ne.disableBeaconSync,C=ne.timeWrapper,x=!!ne.addNoResponse,_=!!ne.disableFetchKeepAlive,l={sendPOST:pe},i||(z=!1),a&&(Ee=dl())&&Ee.protocol&&Ee.protocol[ny]()==="file:"&&(z=!1),!0}catch{}return!1},L.getSyncFetchPayload=function(){return M},L.getSenderInst=function(ne,Ee){if(ne&&ne[jn]){for(var ke=ne,Be=Ee,Ze=0,at=null,Re=0;at==null&&Re<ke[jn];)Ze=ke[Re],h||Ze!==1?Ze!==2||!kR(Be)||Be&&_?Ze!==3||!Iv()||(Be?g:p)||(at=J):at=ue:M0e()?at=xe:PT()&&(at=pe),Re++;return at?((ne={_transport:Ze,_isSync:Be})[H3]=at,ne):null}return null},L.getFallbackInst=function(){return l},L[Jx]=function(ne,Ee){je()}})}return n.__ieDyn=1,n}(),e9="on",M4="attachEvent",R4="addEventListener",k4="detachEvent",O4="removeEventListener",$I="events",WI="visibilitychange",RT="pagehide",t9="unload",n9="beforeunload",r9=uc("aiEvtPageHide"),Gbe=(uc("aiEvtPageShow"),/\.[\.]+/g),qbe=/[\.]+$/,$be=1,bE=Uj("events"),Wbe=/^([^.]*)(?:\.(.+)|)/;function L4(n){return n&&n[Pf]?n[Pf](/^[\s\.]+|(?=[\s\.])[\.\s]+$/g,Er):n}function HR(i,r){r&&(t=Er,dr(r)?(t=Er,on(r,function(o){(o=L4(o))&&(o[0]!=="."&&(o="."+o),t+=o)})):t=L4(r),t)&&(t[0]!=="."&&(t="."+t),i=(i||Er)+t);var t,r=Wbe.exec(i||Er)||[],i={};return i[pu]=r[1],i.ns=(r[2]||Er).replace(Gbe,".").replace(qbe,Er)[iy](".").sort().join("."),i}function i9(n,e,t){return n=bE.get(n,$I,{},t=t===void 0?!0:t),n[e]||(n[e]=[])}function o9(n,e,t,r){n&&e&&e[pu]&&(n[O4]?n[O4](e[pu],t,r):n[k4]&&n[k4](e9+e[pu],t))}function Ybe(n,e,t,r){var i=!1;return n&&e&&e[pu]&&t&&(n[R4]?(n[R4](e[pu],t,r),i=!0):n[M4]&&(n[M4](e9+e[pu],t),i=!0)),i}function N4(n,e,t,r){for(var i=e[jn];i--;){var o=e[i];!o||t.ns&&t.ns!==o.evtName.ns||r&&!r(o)||(o9(n,o.evtName,o[ER],o.capture),e[xy](i,1))}}function Kbe(n,e,t){var r;e[pu]?N4(n,i9(n,e[pu]),e,t):(fr(r=bE.get(n,$I,{}),function(i,o){N4(n,o,e,t)}),du(r)[jn]===0&&bE.kill(n,$I))}function md(n,e){var t=e?HR("xx",t=dr(e)?[n].concat(e):[n,e]).ns[iy]("."):n;return t}function gu(n,e,t,r,i){i===void 0&&(i=!1);var o,a=!1;if(n)try{var l,h=HR(e,r);(a=Ybe(n,h,t,i))&&bE.accept(n)&&((o={guid:$be++,evtName:h})[ER]=t,o.capture=i,l=o,i9(n,h.type)[Hr](l))}catch{}return a}function Pm(n,e,t,r,i){if(i===void 0&&(i=!1),n)try{var o=HR(e,r),a=!1;Kbe(n,o,function(l){return!((!o.ns||t)&&l[ER]!==t)&&(a=!0)}),a||o9(n,o,t,i)}catch{}}function Zbe(n,e,t){var r=!1,i=os(),i=(i&&(r=gu(i,n,e,t),r=gu(i.body,n,e,t)||r),ma());return r=i&&gu(i,n,e,t)||r}function Xbe(n,e,t){var r=os(),r=(r&&(Pm(r,n,e,t),Pm(r.body,n,e,t)),ma());r&&Pm(r,n,e,t)}function wE(n,e,t,r){var i=!1;return e&&n&&0<n[jn]&&on(n,function(o){!o||t&&_a(t,o)!==-1||(i=Zbe(o,e,r)||i)}),i}function Qbe(n,e,t,r){var i=!1;return i=e&&n&&dr(n)&&!(i=wE(n,e,t,r))&&t&&0<t[jn]?wE(n,e,null,r):i}function YI(n,e,t){n&&dr(n)&&on(n,function(r){r&&Xbe(r,e,t)})}function Jbe(n,e,t){return Qbe([n9,t9,RT],n,e,t)}function e1e(n,e){YI([n9,t9,RT],n,e)}function KI(n,e,t){var r=md(r9,t),i=wE([RT],n,e,r);return i=!(i=e&&_a(e,WI)!==-1?i:wE([WI],function(o){var a=ma();n&&a&&a.visibilityState==="hidden"&&n(o)},e,r)||i)&&e?KI(n,null,t):i}function t1e(n,e){e=md(r9,e),YI([RT],n,e),YI([WI],null,e)}var D4="_aiHooks",F4=["req","rsp","hkErr","fnErr"];function GR(n,e){if(n)for(var t=0;t<n[jn]&&!e(n[t],t);t++);}function EA(n,e,t,r,i){0<=i&&i<=2&&GR(n,function(l,a){var l=l.cbks,h=l[F4[i]];if(h){e.ctx=function(){return r[a]=r[a]||{}};try{h[Kf](e.inst,t)}catch(g){h=e.err;try{var p=l[F4[2]];p&&(e.err=g,p[Kf](e.inst,t))}catch{}finally{e.err=h}}}})}function n1e(n){return function(){var e=arguments,t=n.h,r=((i={})[fu]=n.n,i.inst=this,i.ctx=null,i.set=function(h,p){(e=a([],e))[h]=p,o=a([r],e)},i),i=[],o=a([r],e);function a(h,p){return GR(p,function(g){h[Hr](g)}),h}r.evt=zi("event"),EA(t,r,o,i,0);var l=n.f;if(l)try{r.rslt=l[Kf](this,e)}catch(h){throw r.err=h,EA(t,r,o,i,3),h}return EA(t,r,o,i,1),r.rslt}}function qR(n,e,t,r){var i=null;return n&&(cc(n,e)?i=n:t&&(i=qR(l0e(n),e,r,!1))),i}function r1e(n,e,t){return n?ZI(n[wl],e,t,!1):null}function a9(o,e,t,r){var i=t&&t[D4],o=(i||((t=n1e(i={i:0,n:e,f:t,h:[]}))[D4]=i,o[e]=t),{id:i.i,cbks:r,rm:function(){var a=this.id;GR(i.h,function(l,h){if(l.id===a)return i.h[xy](h,1),1})}});return i.i++,i.h[Hr](o),o}function ZI(n,e,t,r,i){return r===void 0&&(r=!0),n&&e&&t&&(n=qR(n,e,r,i),n&&(r=n[e],typeof r===yj))?a9(n,e,r,t):null}function iw(n,e,t,r,i){return n&&e&&t&&(r=qR(n,e,r,i)||n,r)?a9(r,e,r[e],t):null}var ow="Microsoft_ApplicationInsights_BypassAjaxInstrumentation",s9="sampleRate",TA="ProcessLegacy",B4="http.method",$R="https://dc.services.visualstudio.com",Mm="/v2/track",Il="not_specified",SA="iKey",Jr=Lve({requestContextHeader:[0,"Request-Context"],requestContextTargetKey:[1,"appId"],requestContextAppIdFormat:[2,"appId=cid-v1:"],requestIdHeader:[3,"Request-Id"],traceParentHeader:[4,"traceparent"],traceStateHeader:[5,"tracestate"],sdkContextHeader:[6,"Sdk-Context"],sdkContextHeaderAppIdRequest:[7,"appId"],requestContextHeaderLowerCase:[8,"request-context"]}),ay="split",Jn="length",V0="toLowerCase",qd="ingestionendpoint",sy="toString",kT="push",WR="removeItem",Lc="name",Gh="message",Gg="count",CA="preTriggerDate",AA="disabled",IA="interval",U4="daysOfMonth",PA="date",MA="getUTCDate",xE="stringify",RA="pathname",z4="correlationHeaderExcludePatterns",xg="exceptions",vc="parsedStack",fl="properties",mu="measurements",Rm="sizeInBytes",Jl="typeName",Pv="severityLevel",kA="problemGroup",OA="isManual",c9="CreateFromInterface",sm="assembly",uf="fileName",Ww="hasFullStack",aw="level",Eg="method",tv="line",EE="duration",j4="receivedResponse";function l9(n,e,t){var r=e[Jn],i=i1e(n,e);if(i[Jn]!==r){for(var o=0,a=i;t[a]!==void 0;)o++,a=kl(i,0,147)+s1e(o);i=a}return i}function i1e(n,e){var t;return e&&150<(e=mo(rs(e)))[Jn]&&(t=kl(e,0,150),jt(n,2,57,"name is too long.  It has been truncated to 150 characters.",{name:e},!0)),t||e}function yo(n,e,t){var r;return t===void 0&&(t=1024),e&&(t=t||1024,(e=mo(rs(e)))[Jn]>t)&&(r=kl(e,0,t),jt(n,2,61,"string value is too long. It has been truncated to "+t+" characters.",{value:e},!0)),r||e}function OT(n,e){return h9(n,e,2048,66)}function u9(n,e){var t;return e&&32768<e[Jn]&&(t=kl(e,0,32768),jt(n,2,56,"message is too long, it has been truncated to 32768 characters.",{message:e},!0)),t||e}function o1e(n,e){var t,r;return e&&32768<(r=""+e)[Jn]&&(t=kl(r,0,32768),jt(n,2,52,"exception is too long, it has been truncated to 32768 characters.",{exception:e},!0)),t||e}function hp(n,e){var t;return e&&(t={},fr(e,function(r,i){if(cs(i)&&bb())try{i=kc()[xE](i)}catch(o){jt(n,2,49,"custom property is not valid",{exception:o},!0)}i=yo(n,i,8192),r=l9(n,r,t),t[r]=i}),e=t),e}function dp(n,e){var t;return e&&(t={},fr(e,function(r,i){r=l9(n,r,t),t[r]=i}),e=t),e}function a1e(n,e){return e&&h9(n,e,128,69)[sy]()}function h9(n,e,t,r){var i;return e&&(e=mo(rs(e)))[Jn]>t&&(i=kl(e,0,t),jt(n,2,r,"input is too long, it has been truncated to "+t+" characters.",{data:e},!0)),i||e}function s1e(n){return n="00"+n,Oh(n,n[Jn]-3)}var V4=ma()||{},H4=0,c1e=[null,null,null,null,null];function YR(n){var e=H4,t=c1e,r=t[e];return V4.createElement?t[e]||(r=t[e]=V4.createElement("a")):r={host:h1e(n,!0)},r.href=n,++e>=t[Jn]&&(e=0),H4=e,r}function l1e(t){var e,t=YR(t);return e=t?t.href:e}function u1e(n,e){return n?n.toUpperCase()+" "+e:e}function h1e(n,e){return n=d9(n,e)||"",n&&(e=n.match(/(www\d{0,5}\.)?([^\/:]{1,256})(:\d{1,20})?/i),e!=null&&3<e[Jn]&&Pn(e[2])&&0<e[2][Jn])?e[2]+(e[3]||""):n}function d9(n,e){var t=null;return n&&(n=n.match(/(\w{1,150}):\/\/([^\/:]{1,256})(:\d{1,20})?/i))!=null&&2<n[Jn]&&Pn(n[2])&&0<n[2][Jn]&&(t=n[2]||"",e)&&2<n[Jn]&&(e=(n[1]||"")[V0](),n=n[3]||"",t+=n=e==="http"&&n===":80"||e==="https"&&n===":443"?"":n),t}var d1e=[$R+Mm,"https://breeze.aimon.applicationinsights.io"+Mm,"https://dc-int.services.visualstudio.com"+Mm],f1e="cid-v1:";function XI(n){return _a(d1e,n[V0]())!==-1}function G4(n,e,a){if(!e||n&&n.disableCorrelationHeaders)return!1;if(n&&n[z4]){for(var r=0;r<n.correlationHeaderExcludePatterns[Jn];r++)if(n[z4][r].test(e))return!1}var i=YR(e).host[V0]();if(!i||is(i,":443")===-1&&is(i,":80")===-1||(i=(d9(e,!0)||"")[V0]()),(!n||!n.enableCorsCorrelation)&&i&&i!==a)return!1;var o,a=n&&n.correlationHeaderDomains;if(a&&(on(a,function(h){h=new RegExp(h.toLowerCase().replace(/\\/g,"\\\\").replace(/\./g,"\\.").replace(/\*/g,".*")),o=o||h.test(i)}),!o))return!1;var l=n&&n.correlationHeaderExcludedDomains;if(!l||l[Jn]===0)return!0;for(r=0;r<l[Jn];r++)if(new RegExp(l[r].toLowerCase().replace(/\\/g,"\\\\").replace(/\./g,"\\.").replace(/\*/g,".*")).test(i))return!1;return i&&0<i[Jn]}function q4(n){if(n&&(n=p1e(n,Jr[1]),n&&n!==f1e))return n}function p1e(n,e){if(n)for(var t=n[ay](","),r=0;r<t[Jn];++r){var i=t[r][ay]("=");if(i[Jn]===2&&i[0]===e)return i[1]}}function g1e(n,e,t,r){var i,o,a,l=r,h=r;return l=e&&0<e[Jn]?(a=(i=YR(e)).host,l||(i[RA]!=null?((o=i.pathname[Jn]===0?"/":i[RA]).charAt(0)!=="/"&&(o="/"+o),h=i[RA],yo(n,t?t+" "+o:o)):yo(n,e))):a=r,{target:a,name:l,data:h}}function sw(){var n=Iu();return n&&n.now&&n.timing&&(n=n.now()+n.timing.navigationStart,0<n)?n:Cl()}function Xa(n,e){var t=null;return t=n===0||e===0||bt(n)||bt(e)?t:e-n}function KR(n,e){var t=n||{};return{getName:function(){return t[Lc]},setName:function(r){e&&e.setName(r),t[Lc]=r},getTraceId:function(){return t.traceID},setTraceId:function(r){e&&e.setTraceId(r),UR(r)&&(t.traceID=r)},getSpanId:function(){return t.parentID},setSpanId:function(r){e&&e.setSpanId(r),zR(r)&&(t.parentID=r)},getTraceFlags:function(){return t.traceFlags},setTraceFlags:function(r){e&&e.setTraceFlags(r),t.traceFlags=r}}}var xb=hj({LocalStorage:0,SessionStorage:1}),Qh=void 0,Jh=void 0,f9="";function ZR(){return NT()?LT(xb.LocalStorage):null}function LT(n){try{if(bt(oc()))return null;var e=new Date()[sy](),t=zi(n===xb.LocalStorage?"localStorage":"sessionStorage"),r=f9+e,i=(t.setItem(r,e),t.getItem(r)!==e);if(t[WR](r),!i)return t}catch{}return null}function XR(){return H0()?LT(xb.SessionStorage):null}function m1e(){Jh=Qh=!1}function QR(n){f9=n||""}function y1e(){Qh=NT(!0),Jh=H0(!0)}function NT(n){return Qh=!n&&Qh!==void 0?Qh:!!LT(xb.LocalStorage)}function p9(n,e){var t=ZR();if(t!==null)try{return t.getItem(e)}catch(r){Qh=!1,jt(n,2,1,"Browser failed read of local storage. "+Dr(r),{exception:rn(r)})}return null}function g9(n,e,t){var r=ZR();if(r!==null)try{return r.setItem(e,t),!0}catch(i){Qh=!1,jt(n,2,3,"Browser failed write to local storage. "+Dr(i),{exception:rn(i)})}return!1}function _1e(n,e){var t=ZR();if(t!==null)try{return t[WR](e),!0}catch(r){Qh=!1,jt(n,2,5,"Browser failed removal of local storage item. "+Dr(r),{exception:rn(r)})}return!1}function H0(n){return Jh=!n&&Jh!==void 0?Jh:!!LT(xb.SessionStorage)}function QI(n,e){var t=XR();if(t!==null)try{return t.getItem(e)}catch(r){Jh=!1,jt(n,2,2,"Browser failed read of session storage. "+Dr(r),{exception:rn(r)})}return null}function m9(n,e,t){var r=XR();if(r!==null)try{return r.setItem(e,t),!0}catch(i){Jh=!1,jt(n,2,4,"Browser failed write to session storage. "+Dr(i),{exception:rn(i)})}return!1}function y9(n,e){var t=XR();if(t!==null)try{return t[WR](e),!0}catch(r){Jh=!1,jt(n,2,6,"Browser failed removal of session storage item. "+Dr(r),{exception:rn(r)})}return!1}var v1e="appInsightsThrottle",b1e=function(n,e){var t,r,i,o,a,l,h,p=this,g=!1,_=!1;function x(pe,ue,xe,je){if(g){if(!function(Rt){try{var hn=C(Rt);return D0e(1e6)<=hn.limit.samplingRate}catch{}return!1}(pe))return;var ne=C(pe),Ee=ce(pe),ke=L(ne,t,Ee),Be=!1,Ze=0,at=_e(pe);try{ke&&!at?(Ze=Math.min(ne.limit.maxSendNumber,Ee[Gg]+1),Be=!(Ee[Gg]=0),a[pe]=!0,Ee[CA]=new Date):(a[pe]=ke,Ee[Gg]+=1);var Re=D(pe);te(r,Re,Ee);for(var ht=0;ht<Ze;ht++)jt(r,xe||1,pe,ue)}catch{}return{isThrottled:Be,throttleNum:Ze}}return je&&J(pe)[kT]({msgID:pe,message:ue,severity:xe}),null}function C(pe){return i[pe]||i[109]}function M(pe,ue){var xe,je;try{var ne=ue||{},Ee={},ke=(Ee[AA]=!!ne[AA],ne[IA]||{}),Be=(_=(ke===null?void 0:ke.daysOfMonth)&&0<(ke===null?void 0:ke.daysOfMonth[Jn]),Ee[IA]=function(Ze){var at=(Ze=Ze||{})==null?void 0:Ze.monthInterval,Re=Ze==null?void 0:Ze.dayInterval;return bt(at)&&bt(Re)&&(Ze.monthInterval=3,_||(Ze[U4]=[28],_=!0)),Ze={monthInterval:Ze==null?void 0:Ze.monthInterval,dayInterval:Ze==null?void 0:Ze.dayInterval,daysOfMonth:Ze==null?void 0:Ze.daysOfMonth}}(ke),{samplingRate:((xe=ne.limit)==null?void 0:xe.samplingRate)||100,maxSendNumber:((je=ne.limit)==null?void 0:je.maxSendNumber)||1});Ee.limit=Be,i[pe]=Ee}catch{}}function L(pe,ue,xe){var je,ne;return!(!pe||pe[AA]||!ue||!Mf(xe))&&(ue=z(),xe=xe[PA],je=1,(pe=pe[IA])!=null&&pe.monthInterval&&(ne=12*(ue.getUTCFullYear()-xe.getUTCFullYear())+ue.getUTCMonth()-xe.getUTCMonth(),je=le(pe.monthInterval,0,ne)),ne=1,_?ne=_a(pe[U4],ue[MA]()):pe!=null&&pe.dayInterval&&(ue=Math.floor((ue.getTime()-xe.getTime())/864e5),ne=le(pe.dayInterval,0,ue)),0<=je)&&0<=ne}function D(pe,ue){return ue=Mf(ue)?ue:"",pe?v1e+ue+"-"+pe:null}function z(pe){try{if(!pe)return new Date;var ue=new Date(pe);if(!isNaN(ue.getDate()))return ue}catch{}return null}function te(pe,ue,xe){try{return g9(pe,ue,mo(JSON[xE](xe)))}catch{}}function le(pe,ue,xe){return pe<=0?1:ue<=xe&&(xe-ue)%pe==0?Math.floor((xe-ue)/pe)+1:-1}function ce(pe){try{var ue,xe=o[pe];return xe||(ue=D(pe,l),xe=function(je,ne,Ee){try{var ke,Be={date:z(),count:0};return je?{date:z((ke=JSON.parse(je))[PA])||Be[PA],count:ke[Gg]||Be[Gg],preTriggerDate:ke.preTriggerDate?z(ke[CA]):void 0}:(te(ne,Ee,Be),Be)}catch{}return null}(p9(r,ue),r,ue),o[pe]=xe),o[pe]}catch{}return null}function _e(pe){var ue,xe=a[pe];return bt(xe)&&(xe=!1,(ue=ce(pe))&&(xe=function(je){try{var ne;if(je)return ne=new Date,je.getUTCFullYear()===ne.getUTCFullYear()&&je.getUTCMonth()===ne.getUTCMonth()&&je[MA]()===ne[MA]()}catch{}return!1}(ue[CA])),a[pe]=xe),a[pe]}function J(pe){return bt((h=h||{})[pe])&&(h[pe]=[]),h[pe]}r=up(n),a={},o={},h={},i={},M(109),l=Mf(e)?e:"",n.addUnloadHook(so(n.config,function(pe){pe=pe.cfg,t=NT(),fr(pe.throttleMgrCfg||{},function(ue,xe){M(parseInt(ue),xe)})})),p._getDbgPlgTargets=function(){return[h]},p.getConfig=function(){return i},p.canThrottle=function(pe){var ue=ce(pe);return L(C(pe),t,ue)},p.isTriggered=_e,p.isReady=function(){return g},p.flush=function(pe){try{var ue,xe=J(pe);if(xe&&0<xe[Jn])return ue=xe.slice(0),h[pe]=[],on(ue,function(je){x(je.msgID,je[Gh],je.severity,!1)}),!0}catch{}return!1},p.flushAll=function(){try{var pe;if(h)return pe=!0,fr(h,function(ue){ue=p.flush(parseInt(ue)),pe=pe&&ue}),pe}catch{}return!1},p.onReadyState=function(pe,ue){return ue===void 0&&(ue=!0),(g=!!bt(pe)||pe)&&ue?p.flushAll():null},p.sendMessage=function(pe,ue,xe){return x(pe,ue,xe,!0)}},w1e=";",x1e="=";function $4(n){var e;return n?(n=n[ay](w1e),n=pve(n,function(t,o){var i,o=o[ay](x1e);return o[Jn]===2&&(i=o[0][V0](),o=o[1],t[i]=o),t},{}),0<du(n)[Jn]&&(n.endpointsuffix&&(e=n.location?n.location+".":"",n[qd]=n[qd]||"https://"+e+"dc."+n.endpointsuffix),n[qd]=n[qd]||$R,lj(n[qd],"/"))&&(n[qd]=n[qd].slice(0,-1)),n):{}}var E1e=function(n,e,t){var r=this;this.ver=1,this.sampleRate=100,this.tags={},this[Lc]=yo(n,t)||Il,this.data=e,this.time=oy(new Date),this.aiDataContract={time:1,iKey:1,name:1,sampleRate:function(){return r.sampleRate===100?4:1},tags:1,data:1}},Nh=function(){function n(e,t,r,i){this.aiDataContract={ver:1,name:1,properties:0,measurements:0},this.ver=2,this[Lc]=yo(e,t)||Il,this[fl]=hp(e,r),this[mu]=dp(e,i)}return n.envelopeType="Microsoft.ApplicationInsights.{0}.Event",n.dataType="EventData",n}(),T1e="<no_method>",km="error",Qa="stack",JI="stackDetails",W4="errorSrc",eP="message",_9="description";function tP(n,e){var t=n;return t&&!Pn(t)&&(JSON&&JSON[xE]?(t=JSON[xE](n),!e||t&&t!=="{}"||(t=$n(n[sy])?n[sy]():""+n)):t=n+" - (Missing JSON.stringify)"),t||""}function v9(n,e){var t=n;return n&&((t=t&&!Pn(t)&&(n[eP]||n[_9])||t)&&!Pn(t)&&(t=tP(t,!0)),n.filename)&&(t=t+" @"+(n.filename||"")+":"+(n.lineno||"?")+":"+(n.colno||"?")),(t=e&&e!=="String"&&e!=="Object"&&e!=="Error"&&is(t||"",e)===-1?e+": "+t:t)||""}function S1e(n){try{if(cs(n))return"hasFullStack"in n&&"typeName"in n}catch{}return!1}function C1e(n){try{if(cs(n))return"ver"in n&&"exceptions"in n&&"properties"in n}catch{}return!1}function Y4(n){return n&&n.src&&Pn(n.src)&&n.obj&&dr(n.obj)}function $d(e){var e=e||"",t=(e=Pn(e)?e:Pn(e[Qa])?e[Qa]:""+e)[ay](`
`);return{src:e,obj:t}}function A1e(n){for(var e=[],t=n[ay](`
`),r=0;r<t[Jn];r++){var i=t[r];t[r+1]&&(i+="@"+t[r+1],r++),e[kT](i)}return{src:n,obj:e}}function b9(n){var e,t=null;if(n)try{n[Qa]?t=$d(n[Qa]):n[km]&&n[km][Qa]?t=$d(n[km][Qa]):n.exception&&n.exception[Qa]?t=$d(n.exception[Qa]):Y4(n)?t=n:Y4(n[JI])?t=n[JI]:os()&&os().opera&&n[eP]?t=A1e(n[Gh]):n.reason&&n.reason[Qa]?t=$d(n.reason[Qa]):Pn(n)?t=$d(n):(e=n[eP]||n[_9]||"",Pn(n[W4])&&(e&&(e+=`
`),e+=" from "+n[W4]),e&&(t=$d(e)))}catch(r){t=$d(r)}return t||{src:"",obj:null}}function I1e(n){var e="";return n&&(n.obj?on(n.obj,function(t){e+=t+`
`}):e=n.src||""),e}function P1e(n){if(n=n.obj,n&&0<n[Jn]){var e=[],t=0,r=0;if(on(n,function(g){var g=g[sy]();nP.regex.test(g)&&(g=new nP(g,t++),r+=g[Rm],e[kT](g))}),32768<r)for(var i=0,o=e[Jn]-1,a=0,l=i,h=o;i<o;){if(32768<(a+=e[i][Rm]+e[o][Rm])){e.splice(l,h-l+1);break}l=i,h=o,i++,o--}}return e}function TE(n){var e="";if(n&&!(e=n.typeName||n[Lc]||""))try{var t=/function (.{1,200})\(/.exec(n.constructor[sy]()),e=t&&1<t[Jn]?t[1]:""}catch{}return e}function LA(n){if(n)try{var e,t;if(!Pn(n))return e=TE(n),(t=tP(n,!1))&&t!=="{}"||(n[km]&&(e=TE(n=n[km])),t=tP(n,!0)),is(t,e)!==0&&e!=="String"?e+":"+t:t}catch{}return""+(n||"")}var Js=function(){function n(e,t,r,i,o,a){this.aiDataContract={ver:1,exceptions:1,severityLevel:0,properties:0,measurements:0};var l=this;l.ver=2,C1e(t)?(l[xg]=t[xg]||[],l[fl]=t[fl],l[mu]=t[mu],t[Pv]&&(l[Pv]=t[Pv]),t.id&&(l.id=t.id,t[fl].id=t.id),t[kA]&&(l[kA]=t[kA]),bt(t[OA])||(l[OA]=t[OA])):(r=r||{},a&&(r.id=a),l[xg]=[new K4(e,t,r)],l[fl]=hp(e,r),l[mu]=dp(e,i),o&&(l[Pv]=o),a&&(l.id=a))}return n.CreateAutoException=function(e,t,r,i,o,a,l,h){var p=TE(o||a||e),g={};return g[Gh]=v9(e,p),g.url=t,g.lineNumber=r,g.columnNumber=i,g.error=LA(o||a||e),g.evt=LA(a||e),g[Jl]=p,g.stackDetails=b9(l||o||a),g.errorSrc=h,g},n.CreateFromInterface=function(e,t,r,i){var o=t[xg]&&Wv(t[xg],function(a){return K4[c9](e,a)});return new n(e,Da(Da({},t),{exceptions:o}),r,i)},n.prototype.toInterface=function(){var l=this.exceptions,e=this.properties,t=this.measurements,r=this.severityLevel,i=this.problemGroup,o=this.id,a=this.isManual,l=l instanceof Array&&Wv(l,function(p){return p.toInterface()})||void 0,h={ver:"4.0"};return h[xg]=l,h.severityLevel=r,h.properties=e,h.measurements=t,h.problemGroup=i,h.id=o,h.isManual=a,h},n.CreateSimpleException=function(e,t,r,i,o,a){var l;return{exceptions:[((l={})[Ww]=!0,l.message=e,l.stack=o,l.typeName=t,l)]}},n.envelopeType="Microsoft.ApplicationInsights.{0}.Exception",n.dataType="ExceptionData",n.formatError=LA,n}(),K4=function(){function n(e,t,r){this.aiDataContract={id:0,outerId:0,typeName:1,message:1,hasFullStack:0,stack:0,parsedStack:2};var i,o,a=this;S1e(t)?(a[Jl]=t[Jl],a[Gh]=t[Gh],a[Qa]=t[Qa],a[vc]=t[vc]||[],a[Ww]=t[Ww]):(o=(i=t)&&i.evt,gR(i)||(i=i[km]||o||i),a[Jl]=yo(e,TE(i))||Il,a[Gh]=u9(e,v9(t||i,a[Jl]))||Il,o=t[JI]||b9(t),a[vc]=P1e(o),dr(a[vc])&&Wv(a[vc],function(l){l[sm]=yo(e,l[sm]),l[uf]=yo(e,l[uf])}),a[Qa]=o1e(e,I1e(o)),a.hasFullStack=dr(a.parsedStack)&&0<a.parsedStack[Jn],r&&(r[Jl]=r[Jl]||a[Jl]))}return n.prototype.toInterface=function(){var e,t=this[vc]instanceof Array&&Wv(this[vc],function(r){return r.toInterface()});return(e={id:this.id,outerId:this.outerId,typeName:this[Jl],message:this[Gh],hasFullStack:this[Ww],stack:this[Qa]})[vc]=t||void 0,e},n.CreateFromInterface=function(e,t){var r=t[vc]instanceof Array&&Wv(t[vc],function(i){return nP[c9](i)})||t[vc];return new n(e,Da(Da({},t),{parsedStack:r}))},n}(),nP=function(){function n(e,t){this.aiDataContract={level:1,method:1,assembly:0,fileName:0,line:0};var r,i=this;i[Rm]=0,typeof e=="string"?(r=e,i[aw]=t,i[Eg]=T1e,i[sm]=mo(r),i[uf]="",i[tv]=0,(t=r.match(n.regex))&&5<=t[Jn]&&(i[Eg]=mo(t[2])||i[Eg],i[uf]=mo(t[4]),i[tv]=parseInt(t[5])||0)):(i[aw]=e[aw],i[Eg]=e[Eg],i[sm]=e[sm],i[uf]=e[uf],i[tv]=e[tv],i[Rm]=0),i.sizeInBytes+=i.method[Jn],i.sizeInBytes+=i.fileName[Jn],i.sizeInBytes+=i.assembly[Jn],i[Rm]+=n.baseSize,i.sizeInBytes+=i.level.toString()[Jn],i.sizeInBytes+=i.line.toString()[Jn]}return n.CreateFromInterface=function(e){return new n(e,null)},n.prototype.toInterface=function(){return{level:this[aw],method:this[Eg],assembly:this[sm],fileName:this[uf],line:this[tv]}},n.regex=/^([\s]+at)?[\s]{0,50}([^\@\()]+?)[\s]{0,50}(\@|\()([^\(\n]+):([0-9]+):([0-9]+)(\)?)$/,n.baseSize=58,n}(),M1e=function(){this.aiDataContract={name:1,kind:0,value:1,count:0,min:0,max:0,stdDev:0},this.kind=0},Of=function(){function n(e,t,r,i,o,a,l,h,p){this.aiDataContract={ver:1,metrics:1,properties:0},this.ver=2;var g=new M1e;g[Gg]=0<i?i:void 0,g.max=isNaN(a)||a===null?void 0:a,g.min=isNaN(o)||o===null?void 0:o,g[Lc]=yo(e,t)||Il,g.value=r,g.stdDev=isNaN(l)||l===null?void 0:l,this.metrics=[g],this[fl]=hp(e,h),this[mu]=dp(e,p)}return n.envelopeType="Microsoft.ApplicationInsights.{0}.Metric",n.dataType="MetricData",n}(),nv="";function Dh(o){(isNaN(o)||o<0)&&(o=0),o=Math.round(o);var e=nv+o%1e3,t=nv+Math.floor(o/1e3)%60,r=nv+Math.floor(o/6e4)%60,i=nv+Math.floor(o/36e5)%24,o=Math.floor(o/864e5);return(0<o?o+".":nv)+(i[Jn]<2?"0"+i:i)+":"+(r[Jn]<2?"0"+r:r)+":"+(t[Jn]<2?"0"+t:t)+"."+(e[Jn]===1?"00"+e:e[Jn]===2?"0"+e:e)}function R1e(n,e,t,r,i){return!i&&Pn(n)&&(n==="Script error."||n==="Script error")}var ed=function(){function n(e,t,r,i,o,a,l){this.aiDataContract={ver:1,name:0,url:0,duration:0,properties:0,measurements:0,id:0},this.ver=2,this.id=a1e(e,l),this.url=OT(e,r),this[Lc]=yo(e,t)||Il,isNaN(i)||(this[EE]=Dh(i)),this[fl]=hp(e,o),this[mu]=dp(e,a)}return n.envelopeType="Microsoft.ApplicationInsights.{0}.Pageview",n.dataType="PageviewData",n}(),Lf=function(){function n(e,M,r,i,o,a,l,h,p,g,_,x){p===void 0&&(p="Ajax"),this.aiDataContract={id:1,ver:1,name:0,resultCode:0,duration:0,success:0,data:0,target:0,type:0,properties:0,measurements:0,kind:0,value:0,count:0,min:0,max:0,stdDev:0,dependencyKind:0,dependencySource:0,commandName:0,dependencyTypeName:0};var C=this,M=(C.ver=2,C.id=M,C[EE]=Dh(o),C.success=a,C.resultCode=l+"",C.type=yo(e,p),g1e(e,r,h,i));C.data=OT(e,i)||M.data,C.target=yo(e,M.target),g&&(C.target="".concat(C.target," | ").concat(g)),C[Lc]=yo(e,M[Lc]),C[fl]=hp(e,_),C[mu]=dp(e,x)}return n.envelopeType="Microsoft.ApplicationInsights.{0}.RemoteDependency",n.dataType="RemoteDependencyData",n}(),Om=function(){function n(e,t,r,i,o){this.aiDataContract={ver:1,message:1,severityLevel:0,properties:0},this.ver=2,this[Gh]=u9(e,t=t||Il),this[fl]=hp(e,i),this[mu]=dp(e,o),r&&(this[Pv]=r)}return n.envelopeType="Microsoft.ApplicationInsights.{0}.Message",n.dataType="MessageData",n}(),Lm=function(){function n(e,t,r,i,o,a,l){this.aiDataContract={ver:1,name:0,url:0,duration:0,perfTotal:0,networkConnect:0,sentRequest:0,receivedResponse:0,domProcessing:0,properties:0,measurements:0};var h=this;h.ver=2,h.url=OT(e,r),h[Lc]=yo(e,t)||Il,h[fl]=hp(e,o),h[mu]=dp(e,a),l&&(h.domProcessing=l.domProcessing,h[EE]=l[EE],h.networkConnect=l.networkConnect,h.perfTotal=l.perfTotal,h[j4]=l[j4],h.sentRequest=l.sentRequest)}return n.envelopeType="Microsoft.ApplicationInsights.{0}.PageviewPerformance",n.dataType="PageviewPerformanceData",n}(),fp=function(n,e){this.aiDataContract={baseType:1,baseData:1},this.baseType=n,this.baseData=e};function yd(n){var e="ai."+n+".";return function(t){return e+t}}var rv=yd("application"),wo=yd("device"),cw=yd("location"),Tg=yd("operation"),NA=yd("session"),yh=yd("user"),Wd=yd("cloud"),iv=yd("internal"),w9=function(n){function e(){return n.call(this)||this}return Uu(e,n),e}(h0e({applicationVersion:rv("ver"),applicationBuild:rv("build"),applicationTypeId:rv("typeId"),applicationId:rv("applicationId"),applicationLayer:rv("layer"),deviceId:wo("id"),deviceIp:wo("ip"),deviceLanguage:wo("language"),deviceLocale:wo("locale"),deviceModel:wo("model"),deviceFriendlyName:wo("friendlyName"),deviceNetwork:wo("network"),deviceNetworkName:wo("networkName"),deviceOEMName:wo("oemName"),deviceOS:wo("os"),deviceOSVersion:wo("osVersion"),deviceRoleInstance:wo("roleInstance"),deviceRoleName:wo("roleName"),deviceScreenResolution:wo("screenResolution"),deviceType:wo("type"),deviceMachineName:wo("machineName"),deviceVMName:wo("vmName"),deviceBrowser:wo("browser"),deviceBrowserVersion:wo("browserVersion"),locationIp:cw("ip"),locationCountry:cw("country"),locationProvince:cw("province"),locationCity:cw("city"),operationId:Tg("id"),operationName:Tg("name"),operationParentId:Tg("parentId"),operationRootId:Tg("rootId"),operationSyntheticSource:Tg("syntheticSource"),operationCorrelationVector:Tg("correlationVector"),sessionId:NA("id"),sessionIsFirst:NA("isFirst"),sessionIsNew:NA("isNew"),userAccountAcquisitionDate:yh("accountAcquisitionDate"),userAccountId:yh("accountId"),userAgent:yh("userAgent"),userId:yh("id"),userStoreRegion:yh("storeRegion"),userAuthUserId:yh("authUserId"),userAnonymousUserAcquisitionDate:yh("anonUserAcquisitionDate"),userAuthenticatedUserAcquisitionDate:yh("authUserAcquisitionDate"),cloudName:Wd("name"),cloudRole:Wd("role"),cloudRoleVer:Wd("roleVer"),cloudRoleInstance:Wd("roleInstance"),cloudEnvironment:Wd("environment"),cloudLocation:Wd("location"),cloudDeploymentUnit:Wd("deploymentUnit"),internalNodeName:iv("nodeName"),internalSdkVersion:iv("sdkVersion"),internalAgentVersion:iv("agentVersion"),internalSnippet:iv("snippet"),internalSdkSrc:iv("sdkSrc")}));function Eh(n,e,t,l,i,o){t=yo(l,t)||Il,(bt(n)||bt(e)||bt(t))&&As("Input doesn't contain all required fields");var a,l="",h=(n[SA]&&(l=n[SA],delete n[SA]),(a={})[Lc]=t,a.time=oy(new Date),a.iKey=l,a.ext=o||{},a.tags=[],a.data={},a.baseType=e,a.baseData=n,a);return bt(i)||fr(i,function(p,g){h.data[p]=g}),h}var Ss={UserExt:"user",DeviceExt:"device",TraceExt:"trace",WebExt:"web",AppExt:"app",OSExt:"os",SessionExt:"ses",SDKExt:"sdk"},ci=new w9;function ov(n){var e,t=null;return $n(Event)?t=new Event(n):(e=ma())&&e.createEvent&&(t=e.createEvent("Event")).initEvent(n,!0,!0),t}function Z4(n,e){Pm(n,null,null,e)}function k1e(n){var e,t=ma(),r=Ol(),i=!1,o=[],a=1,l=(!r||bt(r.onLine)||r.onLine||(a=2),0),h=_(),p=md(uc("OfflineListener"),n);try{g(os())&&(i=!0),t&&(e=t.body||t).ononline&&g(e)&&(i=!0)}catch{i=!1}function g(L){var D=!1;return L&&(D=gu(L,"online",C,p))&&gu(L,"offline",M,p),D}function _(){return l!==2&&a!==2}function x(){var L=_();h!==L&&(h=L,on(o,function(D){var z={isOnline:h,rState:a,uState:l};try{D(z)}catch{}}))}function C(){a=1,x()}function M(){a=2,x()}return{isOnline:function(){return h},isListening:function(){return i},unload:function(){var L=os();L&&i&&(Z4(L,p),t&&!Pi((L=t.body||t).ononline)&&Z4(L,p),i=!1)},addListener:function(L){return o[kT](L),{rm:function(){var D=o.indexOf(L);if(-1<D)return o.splice(D,1)}}},setOnlineState:function(L){l=L,x()}}}var DT="AppInsightsPropertiesPlugin",x9="AppInsightsChannelPlugin",E9="ApplicationInsightsAnalytics",SE="toString",rP="isStorageUseDisabled",Sg="_addHook",$o="core",_h="dataType",Yd="envelopeType",Es="diagLog",Kd="track",Yw="trackPageView",iP="trackPreviousPageVisit",hf="sendPageViewInternal",cy="startTime",oP="properties",il="duration",aP="sendPageViewPerformanceInternal",JR="populatePageViewPerformanceEvent",Mv="href",X4="sendExceptionInternal",DA="exception",av="error",FA="_onerror",BA="errorSrc",UA="lineNumber",zA="columnNumber",Q4="message",jA="CreateAutoException",lw="addTelemetryInitializer",O1e="overridePageViewDuration",T9="autoTrackPageVisitTime",S9="isBrowserLinkTrackingEnabled",G0="length",C9="enableAutoRouteTracking",A9="enableUnhandledPromiseRejectionTracking",sP="autoUnhandledPromiseInstrumented",cP="getEntriesByType",I9="isPerformanceTimingSupported",P9="getPerformanceTiming",CE="navigationStart",lP="shouldCollectDuration",M9="isPerformanceTimingDataReady",Rv="responseStart",L1e="requestStart",Kw="loadEventEnd",uP="responseEnd",Zw="connectEnd",R9="pageVisitStartTime",N1e=function(){function n(e,t,r,i){xi(n,this,function(o){var a,l=null,h=[],p=!1,g=!1;function _(C){r&&r.flush(C,function(){})}function x(C){h.push(C),function M(){l=l||lc(function(){l=null;var L=h.slice(0),D=!1;h=[],on(L,function(z){z()?D=!0:h.push(z)}),0<h[G0]&&M(),D&&_(!0)},100)}()}r&&(a=r.logger),o[Yw]=function(C,M){var L,D,z,te,le,ce,_e=C.name,J=(!bt(_e)&&typeof _e=="string"||(D=ma(),_e=C.name=D&&D.title||""),C.uri);!bt(J)&&typeof J=="string"||(D=dl(),J=C.uri=D&&D[Mv]||""),g||((L=(D=Iu())&&D[cP]&&D[cP]("navigation"))&&L[0]&&!Pi(D.timeOrigin)?(L=L[0].loadEventStart,C[cy]=new Date(D.timeOrigin+L)):(D=(M||C[oP]||{})[il]||0,C[cy]=new Date(new Date().getTime()-D)),g=!0),i[I9]()?(z=!1,le=i[P9]()[CE],0<le&&(te=Xa(le,+new Date),i[lP](te)||(te=void 0)),bt(M)||bt(M[il])||(ce=M[il]),!t&&isNaN(ce)||(isNaN(ce)&&((M=M||{})[il]=te),e[hf](C,M),_(!0),z=!0),M=M||{},x(function(){var pe,ue=!1;try{i[M9]()?(ue=!0,pe={name:_e,uri:J},i[JR](pe),pe.isValid||z?(z||(M[il]=pe.durationMs,e[hf](C,M)),p||(e[aP](pe,M),p=!0)):(M[il]=te,e[hf](C,M))):0<le&&6e4<Xa(le,+new Date)&&(ue=!0,z||(M[il]=6e4,e[hf](C,M)))}catch(xe){jt(a,1,38,"trackPageView failed on page load calculation: "+Dr(xe),{exception:rn(xe)})}return ue})):(e[hf](C,M),_(!0),ej()||jt(a,2,25,"trackPageView: navigation timing API used for calculation of page duration is not supported in this browser. This page view will be collected without duration and timing info."))},o.teardown=function(C,M){var L;l&&(l.cancel(),l=null,L=h.slice(0),h=[],on(L,function(D){D()}))}})}return n.__ieDyn=1,n}(),D1e=36e5,J4=["googlebot","adsbot-google","apis-google","mediapartners-google"];function k9(){var n=Iu();return n&&!!n.timing}function F1e(){var n=Iu();return n&&n.getEntriesByType&&0<n.getEntriesByType("navigation")[G0]}function B1e(){var n=Iu(),n=n?n.timing:0;return n&&0<n.domainLookupStart&&0<n[CE]&&0<n[Rv]&&0<n[L1e]&&0<n[Kw]&&0<n[uP]&&0<n[Zw]&&0<n.domLoading}function eF(){return k9()?Iu().timing:null}function U1e(){return F1e()?Iu()[cP]("navigation")[0]:null}function z1e(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var t=(Ol()||{}).userAgent,r=!1;if(t)for(var i=0;i<J4[G0];i++)r=r||is(t.toLowerCase(),J4[i])!==-1;if(r)return!1;for(i=0;i<n[G0];i++)if(n[i]<0||D1e<=n[i])return!1;return!0}var Ts,j1e=function(){function n(e){var t=up(e);xi(n,this,function(r){r[JR]=function(i){i.isValid=!1;var o=U1e(),a=eF(),l=0,h=0,p=0,g=0,_=0;(o||a)&&(_=o?(l=o[il],h=o[cy]===0?o[Zw]:Xa(o[cy],o[Zw]),p=Xa(o.requestStart,o[Rv]),g=Xa(o[Rv],o[uP]),Xa(o.responseEnd,o[Kw])):(l=Xa(a[CE],a[Kw]),h=Xa(a[CE],a[Zw]),p=Xa(a.requestStart,a[Rv]),g=Xa(a[Rv],a[uP]),Xa(a.responseEnd,a[Kw])),l===0?jt(t,2,10,"error calculating page view performance.",{total:l,network:h,request:p,response:g,dom:_}):r[lP](l,h,p,g,_)?l<Math.floor(h)+Math.floor(p)+Math.floor(g)+Math.floor(_)?jt(t,2,8,"client performance math error.",{total:l,network:h,request:p,response:g,dom:_}):(i.durationMs=l,i.perfTotal=i[il]=Dh(l),i.networkConnect=Dh(h),i.sentRequest=Dh(p),i.receivedResponse=Dh(g),i.domProcessing=Dh(_),i.isValid=!0):jt(t,2,45,"Invalid page load duration value. Browser perf data won't be sent.",{total:l,network:h,request:p,response:g,dom:_}))},r[P9]=eF,r[I9]=k9,r[M9]=B1e,r[lP]=z1e})}return n.__ieDyn=1,n}(),V1e=function(){function n(e,t){var r="prevPageVisitData";xi(n,this,function(i){i[iP]=function(o,a){try{var l=function(h,p){var g=null;try{var _;g=function(){var x=null;try{var C,M;H0()&&(C=Cl(),M=QI(e,r))&&bb()&&((x=kc().parse(M)).pageVisitTime=C-x[R9],y9(e,r))}catch(L){Rf(e,"Stop page visit timer failed: "+rn(L)),x=null}return x}(),H0()&&(QI(e,r)!=null&&As("Cannot call startPageVisit consecutively without first calling stopPageVisit"),_=kc().stringify(new H1e(h,p)),m9(e,r,_))}catch(x){Rf(e,"Call to restart failed: "+rn(x)),g=null}return g}(o,a);l&&t(l.pageName,l.pageUrl,l.pageVisitTime)}catch(h){Rf(e,"Auto track page visit time failed, metric will not be collected: "+rn(h))}},Or(i,"_logger",{g:function(){return e}}),Or(i,"pageVisitTimeTrackingHandler",{g:function(){return t}})})}return n.__ieDyn=1,n}(),H1e=function(n,e){this[R9]=Cl(),this.pageName=n,this.pageUrl=e},tF=function(n,e){var t=this,r={};t.start=function(i){r[i]!==void 0&&jt(n,2,62,"start was called more than once for this event without calling stop.",{name:i,key:i},!0),r[i]=+new Date},t.stop=function(i,o,a,l){var h=r[i];isNaN(h)?jt(n,2,63,"stop was called without a corresponding start.",{name:i,key:i},!0):(h=Xa(h,+new Date),t.action(i,o,h,a,l)),delete r[i],r[i]=void 0}},G1e="event";function sv(n,e){n&&n.dispatchEvent&&e&&n.dispatchEvent(e)}function q1e(n){var e;return n&&n.reason?(e=n.reason,!Pn(e)&&$n(e[SE])?e[SE]():rn(e)):n||""}var nF=6e4,$1e=vy(((Ts={sessionRenewalMs:o4(rF,18e5),sessionExpirationMs:o4(rF,864e5),disableExceptionTracking:fo()})[T9]=fo(),Ts[O1e]=fo(),Ts[A9]=fo(),Ts[sP]=!1,Ts.samplingPercentage=pE(W1e,100),Ts[rP]=fo(),Ts[S9]=fo(),Ts[C9]=fo(),Ts.namePrefix=J0e(),Ts.enableDebug=fo(),Ts.disableFlushOnBeforeUnload=fo(),Ts.disableFlushOnUnload=fo(!1,"disableFlushOnBeforeUnload"),Ts));function rF(n,e){return+(n=(n=n||e)<nF?nF:n)}function W1e(n){return!isNaN(n)&&0<n&&n<=100}function Y1e(n){Pi(n[rP])||(n[rP]?m1e:y1e)()}var K1e=function(n){function e(){var t,r,i,o,a,l,h,p,g,_,x,C,M,L,D,z,te,le,ce,_e=n.call(this)||this;return _e.identifier=E9,_e.priority=180,_e.autoRoutePVDelay=500,xi(e,_e,function(J,pe){var ue=pe[Sg];function xe(ne,Ee,ke,Be,Ze){J[Es]().throwInternal(ne,Ee,ke,Be,Ze)}function je(){l=a=o=i=r=t=null;var ne=dl(!(z=L=M=C=x=_=g=p=h=!1));te=ne&&ne[Mv]||"",D=ce=le=null,Or(J,"config",{g:function(){return D}})}je(),J.getCookieMgr=function(){return BR(J[$o])},J.processTelemetry=function(ne,Ee){J.processNext(ne,Ee)},J.trackEvent=function(ne,Ee){try{var ke=Eh(ne,Nh[_h],Nh[Yd],J[Es](),Ee);J[$o][Kd](ke)}catch(Be){xe(2,39,"trackTrace failed, trace will not be collected: "+Dr(Be),{exception:rn(Be)})}},J.startTrackEvent=function(ne){try{t.start(ne)}catch(Ee){xe(1,29,"startTrackEvent failed, event will not be collected: "+Dr(Ee),{exception:rn(Ee)})}},J.stopTrackEvent=function(ne,Ee,ke){try{t.stop(ne,void 0,Ee,ke)}catch(Be){xe(1,30,"stopTrackEvent failed, event will not be collected: "+Dr(Be),{exception:rn(Be)})}},J.trackTrace=function(ne,Ee){try{var ke=Eh(ne,Om[_h],Om[Yd],J[Es](),Ee);J[$o][Kd](ke)}catch(Be){xe(2,39,"trackTrace failed, trace will not be collected: "+Dr(Be),{exception:rn(Be)})}},J.trackMetric=function(ne,Ee){try{var ke=Eh(ne,Of[_h],Of[Yd],J[Es](),Ee);J[$o][Kd](ke)}catch(Be){xe(1,36,"trackMetric failed, metric will not be collected: "+Dr(Be),{exception:rn(Be)})}},J[Yw]=function(ne,Ee){try{var ke=ne||{};i[Yw](ke,Da(Da(Da({},ke.properties),ke.measurements),Ee)),z&&a[iP](ke.name,ke.uri)}catch(Be){xe(1,37,"trackPageView failed, page view will not be collected: "+Dr(Be),{exception:rn(Be)})}},J[hf]=function(ne,Ee,ke){var Be=ma(),Be=(Be&&(ne.refUri=ne.refUri===void 0?Be.referrer:ne.refUri),bt(ne[cy])&&(Be=(Ee||ne[oP]||{})[il]||0,ne[cy]=new Date(new Date().getTime()-Be)),Eh(ne,ed[_h],ed[Yd],J[Es](),Ee,ke));J[$o][Kd](Be)},J[aP]=function(ne,Ee,ke){ne=Eh(ne,Lm[_h],Lm[Yd],J[Es](),Ee,ke),J[$o][Kd](ne)},J.trackPageViewPerformance=function(ne,Ee){ne=ne||{};try{o[JR](ne),J[aP](ne,Ee)}catch(ke){xe(1,37,"trackPageViewPerformance failed, page view will not be collected: "+Dr(ke),{exception:rn(ke)})}},J.startTrackPage=function(ne){try{var Ee;typeof ne!="string"&&(ne=(Ee=ma())&&Ee.title||""),r.start(ne)}catch(ke){xe(1,31,"startTrackPage failed, page view may not be collected: "+Dr(ke),{exception:rn(ke)})}},J.stopTrackPage=function(ne,Ee,ke,Be){try{var Ze,at;typeof ne!="string"&&(ne=(Ze=ma())&&Ze.title||""),typeof Ee!="string"&&(Ee=(at=dl())&&at[Mv]||""),r.stop(ne,Ee,ke,Be),z&&a[iP](ne,Ee)}catch(Re){xe(1,32,"stopTrackPage failed, page view will not be collected: "+Dr(Re),{exception:rn(Re)})}},J[X4]=function(ne,Ee,ke){var Be=ne&&(ne[DA]||ne[av])||gR(ne)&&ne||{name:ne&&typeof ne,message:ne||Il};ne=ne||{},Be=Eh(new Js(J[Es](),Be,ne[oP]||Ee,ne.measurements,ne.severityLevel,ne.id).toInterface(),Js[_h],Js[Yd],J[Es](),Ee,ke),J[$o][Kd](Be)},J.trackException=function(ne,Ee){ne&&!ne[DA]&&ne[av]&&(ne[DA]=ne[av]);try{J[X4](ne,Ee)}catch(ke){xe(1,35,"trackException failed, exception will not be collected: "+Dr(ke),{exception:rn(ke)})}},J[FA]=function(ne){var Ee=ne&&ne[av],ke=ne&&ne.evt;try{ke||(Rt=os())&&(ke=Rt[G1e]);var Be,Ze,at=ne&&ne.url||(ma()||{}).URL,Re=ne[BA]||"window.onerror@"+at+":"+(ne[UA]||0)+":"+(ne[zA]||0),ht={errorSrc:Re,url:at,lineNumber:ne[UA]||0,columnNumber:ne[zA]||0,message:ne[Q4]};R1e(ne.message,ne.url,ne.lineNumber,ne.columnNumber,ne[av])?(Be=Js[jA]("Script error: The browser's same-origin policy prevents us from getting the details of this exception. Consider using the 'crossorigin' attribute.",at,ne[UA]||0,ne[zA]||0,Ee,ke,null,Re),Ze=ht,Be=Eh(Be,Js[_h],Js[Yd],J[Es](),Ze),J[$o][Kd](Be)):(ne[BA]||(ne[BA]=Re),J.trackException({exception:ne,severityLevel:3},ht))}catch(hn){var Rt=Ee?Ee.name+", "+Ee[Q4]:"null";xe(1,11,"_onError threw exception while logging error, error will not be collected: "+Dr(hn),{exception:rn(hn),errorString:Rt})}},J[lw]=function(ne){if(J[$o])return J[$o][lw](ne);(l=l||[]).push(ne)},J.initialize=function(ne,Ee,ke,Be){if(!J.isInitialized()){bt(Ee)&&As("Error initializing"),pe.initialize(ne,Ee,ke,Be);try{var Ze,at;ce=md(uc(J.identifier),Ee.evtNamespace&&Ee.evtNamespace()),l&&(on(l,function(Xt){Ee[lw](Xt)}),l=null),wt=ne,Ge=J.identifier,Gn=J[$o],J[Sg](so(wt,function(){var Xt,ln=Oc(null,wt,Gn);D=ln.getExtCfg(Ge,$1e),z=D[T9],wt.storagePrefix&&QR(wt.storagePrefix),Y1e(D),h=D[S9],!p&&h&&(Xt=["/browserLinkSignalR/","/__browserLink/"],J[Sg](J[lw](function(Mn){if(h&&Mn.baseType===Lf[_h]){var Ot=Mn.baseData;if(Ot){for(var En=0;En<Xt[G0];En++)if(Ot.target&&0<=is(Ot.target,Xt[En]))return!1}}return!0})),p=!0)})),o=new j1e(J[$o]),i=new N1e(J,D.overridePageViewDuration,J[$o],o),a=new V1e(J[Es](),function(Xt,ln,Mn){var Ot=Xt;Ot={PageName:Xt,PageUrl:ln},J.trackMetric({name:"PageVisitTime",average:Mn,max:Mn,min:Mn,sampleCount:1},Ot)}),(t=new tF(J[Es](),"trackEvent")).action=function(Xt,ln,Mn,Ot,En){En=En||{},(Ot=Ot||{}).duration=Mn[SE](),J.trackEvent({name:Xt,properties:Ot,measurements:En})},(r=new tF(J[Es](),"trackPageView")).action=function(Xt,ln,Mn,Ot,En){(Ot=bt(Ot)?{}:Ot).duration=Mn[SE](),J[hf]({name:Xt,uri:ln,properties:Ot,measurements:En},Ot)},CT()&&(Rt=os(),hn=dl(!0),J[Sg](so(D,function(){(x=D.disableExceptionTracking)||C||D.autoExceptionInstrumented||(ue(iw(Rt,"onerror",{ns:ce,rsp:function(Xt,ln,Mn,Ot,En,lt){x||Xt.rslt===!0||J[FA](Js[jA](ln,Mn,Ot,En,lt,Xt.evt))}},!1)),C=!0)})),Ze=Rt,at=hn,J[Sg](so(D,function(){M=D[A9]===!0,C=C||D[sP],M&&!L&&(ue(iw(Ze,"onunhandledrejection",{ns:ce,rsp:function(Xt,ln){M&&Xt.rslt!==!0&&J[FA](Js[jA](q1e(ln),at?at[Mv]:"",0,0,ln,Xt.evt))}},!1)),D[sP]=L=!0)})),Re=os(),ht=dl(!0),J[Sg](so(D,function(){var Xt,ln,Mn,Ot;g=D[C9]===!0,Re&&g&&!_&&lve()&&(ln=Jz(),$n(ln.pushState))&&$n(ln.replaceState)&&typeof Event!==TR&&(Xt=Re,ln=ln,Mn=ht,_||(Ot=D.namePrefix||"",ue(iw(ln,"pushState",{ns:ce,rsp:function(){g&&(sv(Xt,ov(Ot+"pushState")),sv(Xt,ov(Ot+"locationchange")))}},!0)),ue(iw(ln,"replaceState",{ns:ce,rsp:function(){g&&(sv(Xt,ov(Ot+"replaceState")),sv(Xt,ov(Ot+"locationchange")))}},!0)),gu(Xt,Ot+"popstate",function(){g&&sv(Xt,ov(Ot+"locationchange"))},ce),gu(Xt,Ot+"locationchange",function(){le=(le&&(te=le),Mn&&Mn[Mv]||"");{var En,lt;g&&((En=function(){var It=null;J[$o]&&J[$o].getTraceCtx&&(It=J[$o].getTraceCtx(!1));{var he;It||(he=J[$o].getPlugin(DT))&&(he=he.plugin.context)&&(It=KR(he.telemetryTrace))}return It}())&&(En.setTraceId(Hh()),lt="_unknown_",Mn&&Mn.pathname&&(lt=Mn.pathname+(Mn.hash||"")),En.setName(yo(J[Es](),lt))),lc((function(It){J[Yw]({refUri:It,properties:{duration:0}})}).bind(J,te),J.autoRoutePVDelay))}},ce),_=!0))})))}catch(Xt){throw J.setInitialized(!1),Xt}var Re,ht,Rt,hn,wt,Ge,Gn}},J._doTeardown=function(ne,Ee){i&&i.teardown(ne,Ee),Pm(window,null,null,ce),je()},Or(J,"_pageViewManager",{g:function(){return i}}),Or(J,"_pageViewPerformanceManager",{g:function(){return o}}),Or(J,"_pageVisitTimeManager",{g:function(){return a}}),Or(J,"_evtNamespace",{g:function(){return"."+ce}})}),_e}return Uu(e,n),e.Version="3.3.0",e}(Ey),Xw="featureOptIn",O9="onCfgChangeReceive",L9="nonOverrideConfigs",N9="scheduleFetchTimeout";function D9(n,e,t,r){try{var i=r<t,o=(i&&(n=null),t==0?Ive({},n):n);return o&&e&&!i&&fr(o,function(a){var l=e[a];l&&(cs(o[a])&&cs(l)?o[a]=D9(o[a],l,++t,r):delete o[a])}),o}catch{}return n}var uw,Nm="featureOptIn.",F9=".mode",B9=".onCfg",U9=".offCfg";function Z1e(n,e,t){var r,i,o,a,l,h,p,g,_,x;return e&&e.enabled?(r=(e=(e[Xw]||{})[n]||{mode:1}).mode,i=e.onCfg,e=e.offCfg,o=(t=(t||{})[n]||{mode:2}).mode,a=t.onCfg,l=t.offCfg,t=!!t.blockCdnCfg,h=Nm+n+B9,p=Nm+n+U9,g=o,_=a,x=l,t||(r===4||r===5?(g=r==4?3:2,_=i||a,x=e||l):r===2||o===2?(g=2,_=a||i,x=l||e):r===3?(g=3,_=a||i,x=l||e):r===1&&o===1&&(g=1)),(t={})[Nm+n+F9]=g,t[h]=_,t[p]=x,t):null}function X1e(n,e){try{var t,r;return n&&n.enabled?n[Xw]?(t=n[Xw],r=n.config||{},fr(t,function(i){var o=Z1e(i,n,e.config[Xw]);bt(o)||(fr(o,function(a,l){cj(r,a,l)}),Q1e(i,o,r))}),r):n.config:null}catch{}return null}function Q1e(a,o,t){var r=o[Nm+a+F9],i=o[Nm+a+B9],o=o[Nm+a+U9],a=r===2?o:r===3?i:null;a&&fr(a,function(l,h){cj(t,l,h)})}var J1e="ai_cfgsync",iF="GET",ewe=18e5,Cg=void 0,twe={instrumentationKey:!0,connectionString:!0,endpointUrl:!0},nwe=vy(((uw={syncMode:1,blkCdnCfg:Cg,customEvtName:Cg,cfgUrl:Cg,overrideSyncFn:Cg,overrideFetchFn:Cg})[O9]=Cg,uw[N9]=ewe,uw[L9]=twe,uw)),rwe=function(n){function e(){var t,r,i,o,a,l,h,p,g,_,x,C,M,L,D,z,te=n.call(this)||this,le=(te.priority=198,!(te.identifier="AppInsightsCfgSyncPlugin"));return xi(e,te,function(ce,_e){function J(){C=z=D=g=x=_=l=M=p=h=a=o=i=r=null}function pe(ht,Rt){if(ht){if(r=ht,Rt&&!le)return xe();if(h&&!le)return ce.core.updateCfg(ht),!0}return!1}function ue(){try{var ht=oc();ht&&Pm(ht,null,null,o)}catch{}}function xe(ht){try{return z&&$n(z)?z(r,ht):O0e(i,r,ht)}catch{}return!1}function je(ht){try{if(ue(),ht&&(i=ht,h)){var Rt=oc();if(Rt)try{gu(Rt,i,function(wt){var wt=wt&&wt.detail;C&&wt?C(wt):(wt=(wt=wt&&wt.cfg)&&Na(wt)&&Ze(wt))&&pe(wt)},o,!0)}catch{}}return!0}catch{}return!1}function ne(ht,Rt,hn){var wt=oc(),wt=wt&&wt.fetch||null;if(ht&&wt&&$n(wt))try{var Ge=new Request(ht,{method:iF});Mu(fetch(Ge),function(Gn){var Xt=Gn.value;Gn.rejected?Be(Rt,400):Xt.ok?Mu(Xt.text(),function(ln){Be(Rt,Xt.status,ln.value,hn)}):Be(Rt,Xt.status,null,hn)})}catch{}}function Ee(ht,Rt,hn){try{var wt=new XMLHttpRequest;wt.open(iF,ht),wt.onreadystatechange=function(){wt.readyState===XMLHttpRequest.DONE&&Be(Rt,wt.status,wt.responseText,hn)},wt.onerror=function(){Be(Rt,400)},wt.ontimeout=function(){Be(Rt,400)},wt.send()}catch{}}function ke(ht,Rt,hn){try{var wt,Ge,Gn;200<=ht&&ht<400&&Rt?(x=0,(wt=kc())&&(Gn=(Ge=X1e(wt.parse(Rt),ce.core))&&Na(Ge)&&Ze(Ge))&&pe(Gn,hn)):x++,x<3&&at()}catch{}}function Be(ht,Rt,hn,wt){try{ht(Rt,hn,wt)}catch{}}function Ze(ht){var Rt=null;try{ht&&(Rt=D9(ht,M,0,5))}catch{}return Rt}function at(){!l&&_&&(l=lc(function(){l=null,L(a,ke,p)},_)).unref()}function Re(){l&&l.cancel(),l=null,x=0}J(),ce.initialize=function(ht,Rt,hn,wt){var Ge,Gn,Xt;_e.initialize(ht,Rt,hn,wt),o=md(uc(ce.identifier),Rt.evtNamespace&&Rt.evtNamespace()),Ge=ht,Gn=ce.identifier,Xt=ce.core,ce._addHook(so(Ge,function(){var ln=Oc(null,Ge,Xt),ln=(t=ln.getExtCfg(Gn,nwe),g),ln=(g=!!t.blkCdnCfg,bt(ln)||ln===g||(!g&&a?L&&L(a,ke,p):Re()),bt(h)&&(h=t.syncMode===2),bt(p)&&(p=t.syncMode===1),t.customEvtName||J1e);i!==ln&&(h?je(ln):(ue(),i=ln)),(a=bt(a)?t.cfgUrl:a)||(r=Ge,p&&xe())})),z=t.overrideSyncFn,D=t.overrideFetchFn,C=t[O9],M=t[L9],_=t[N9],L=function(){var ln=D;return bt(ln)&&(kR()?ln=ne:PT()&&(ln=Ee)),ln}(),x=0,a&&!g&&L&&L(a,ke,p)},ce.getCfg=function(){return r},ce.pause=function(){le=!0,Re()},ce.resume=function(){le=!1,at()},ce.setCfg=function(ht){return pe(ht)},ce.sync=xe,ce.updateEventListenerName=je,ce._doTeardown=function(ht,Rt){ue(),Re(),J()},ce._getDbgPlgTargets=function(){return[p,h,i,g,M]},ce.processTelemetry=function(ht,Rt){ce.processNext(ht,Rt)}}),te}return Uu(e,n),e.__ieDyn=1,e}(Ey),of="duration",Ko="tags",VA="deviceType",Oa="data",ku="name",q0="traceID",hr="length",$0="stringify",pp="measurements",El="dataType",gp="envelopeType",af="toString",kv="_get",Nf="enqueue",Df="count",z9="eventsLimitInMem",td="push",AE="item",hP="emitLineDelimitedJson",Dm="clear",ek="createNew",IE="markAsSent",Jv="clearSent",tk="bufferOverride",HA="BUFFER_KEY",vh="SENT_BUFFER_KEY",qg="concat",cv="MAX_BUFFER_SIZE",lv="triggerSend",ua="diagLog",GA="initialize",uv="_sender",dP="customHeaders",j9="maxBatchSizeInBytes",fP="onunloadDisableBeacon",pP="isBeaconApiDisabled",V9="alwaysUseXhrOverride",gP="disableXhr",H9="enableSessionStorageBuffer",bh="_buffer",G9="onunloadDisableFetch",q9="disableSendBeaconSplit",$9="instrumentationKey",oF="enableSendPromise",hw="getSenderInst",aF="unloadTransports",W9="convertUndefined",Y9="maxBatchInterval",Qw="serialize",Ag="_onError",qA="_onPartialSuccess",dw="_onSuccess",$A="itemsReceived",WA="itemsAccepted",YA="oriPayload",KA="baseType",PE="sampleRate",sF="eventsSendRequest",K9="getSamplingScore",iwe="getHashCodeScore",ZA="baseType",Ni="baseData",Lo="properties",cF="true";function io(n,e,t){return si(n,e,t,Hx)}function owe(n,e,t){for(var r=t[Ko]=t[Ko]||{},i=e.ext=e.ext||{},o=e[Ko]=e[Ko]||[],a=i.user,a=(a&&(io(r,ci.userAuthUserId,a.authId),io(r,ci.userId,a.id||a.localId)),i.app),a=(a&&io(r,ci.sessionId,a.sesId),i.device),a=(a&&(io(r,ci.deviceId,a.id||a.localId),io(r,ci[VA],a.deviceClass),io(r,ci.deviceIp,a.ip),io(r,ci.deviceModel,a.model),io(r,ci[VA],a[VA])),e.ext.web),e=(a&&(io(r,ci.deviceLanguage,a.browserLang),io(r,ci.deviceBrowserVersion,a.browserVer),io(r,ci.deviceBrowser,a.browser),io(e=(e=(e=t[Oa]=t[Oa]||{})[Ni]=e[Ni]||{})[Lo]=e[Lo]||{},"domain",a.domain),io(e,"isManual",a.isManual?cF:null),io(e,"screenRes",a.screenRes),io(e,"userConsent",a.userConsent?cF:null)),i.os),a=(e&&(io(r,ci.deviceOS,e[ku]),io(r,ci.deviceOSVersion,e.osVer)),i.trace),l=(a&&(io(r,ci.operationParentId,a.parentID),io(r,ci.operationName,yo(n,a[ku])),io(r,ci.operationId,a[q0])),{}),h=o[hr]-1;0<=h;h--)fr(o[h],function(g,_){l[g]=_}),o.splice(h,1);fr(o,function(p,g){l[p]=g}),e=Da(Da({},r),l),e[ci.internalSdkVersion]||(e[ci.internalSdkVersion]=yo(n,"javascript:".concat(awe.Version),64)),t[Ko]=Cj(e)}function ud(n,e,t){bt(n)||fr(n,function(r,i){mb(i)?t[r]=i:Pn(i)?e[r]=i:bb()&&(e[r]=kc()[$0](i))})}function mp(n,e){bt(n)||fr(n,function(t,r){n[t]=r||e})}function yp(n,e,t,r){return r=new E1e(n,r,e),io(r,"sampleRate",t[s9]),(t[Ni]||{}).startTime&&(r.time=oy(t[Ni].startTime)),r.iKey=t.iKey,e=t.iKey.replace(/-/g,""),r[ku]=r[ku].replace("{0}",e),owe(n,t,r),t[Ko]=t[Ko]||[],Cj(r)}function _p(n,e){bt(e[Ni])&&jt(n,1,46,"telemetryItem.baseData cannot be null.")}var awe={Version:"3.3.0"};function swe(n,e,a){_p(n,e);var r,i=e[Ni][pp]||{},o=e[Ni][Lo]||{},a=(ud(e[Oa],o,i),bt(a)||mp(o,a),e[Ni]);return bt(a)?(Rf(n,"Invalid input for dependency data"),null):(r=a[Lo]&&a[Lo][B4]?a[Lo][B4]:"GET",r=new Lf(n,a.id,a.target,a[ku],a[of],a.success,a.responseCode,r,a.type,a.correlationContext,o,i),a=new fp(Lf[El],r),yp(n,Lf[gp],e,a))}function Z9(n,e,i){_p(n,e);var o={},r={},i=(e[ZA]!==Nh[El]&&(o.baseTypeSource=e[ZA]),e[ZA]===Nh[El]?(o=e[Ni][Lo]||{},r=e[Ni][pp]||{}):e[Ni]&&ud(e[Ni],o,r),ud(e[Oa],o,r),bt(i)||mp(o,i),e[Ni][ku]),i=new Nh(n,i,o,r),o=new fp(Nh[El],i);return yp(n,Nh[gp],e,o)}function cwe(n,e,i){_p(n,e);var r=e[Ni][pp]||{},o=e[Ni][Lo]||{},i=(ud(e[Oa],o,r),bt(i)||mp(o,i),e[Ni]),i=Js.CreateFromInterface(n,i,o,r),o=new fp(Js[El],i);return yp(n,Js[gp],e,o)}function lwe(n,e,o){_p(n,e);var a=e[Ni],r=a[Lo]||{},i=a[pp]||{},o=(ud(e[Oa],r,i),bt(o)||mp(r,o),new Of(n,a[ku],a.average,a.sampleCount,a.min,a.max,a.stdDev,r,i)),a=new fp(Of[El],o);return yp(n,Of[gp],e,a)}function uwe(n,e,g){_p(n,e);var r,p=e[Ni],p=(bt(p)||bt(p[Lo])||bt(p[Lo][of])?bt(e[Oa])||bt(e[Oa][of])||(r=e[Oa][of],delete e[Oa][of]):(r=p[Lo][of],delete p[Lo][of]),e[Ni]),i=(((e.ext||{}).trace||{})[q0]&&(i=e.ext.trace[q0]),p.id||i),o=p[ku],a=p.uri,l=p[Lo]||{},h=p[pp]||{},p=(bt(p.refUri)||(l.refUri=p.refUri),bt(p.pageType)||(l.pageType=p.pageType),bt(p.isLoggedIn)||(l.isLoggedIn=p.isLoggedIn[af]()),bt(p[Lo])||fr(p[Lo],function(_,x){l[_]=x}),ud(e[Oa],l,h),bt(g)||mp(l,g),new ed(n,o,a,r,l,h,i)),g=new fp(ed[El],p);return yp(n,ed[gp],e,g)}function hwe(n,e,l){_p(n,e);var r=e[Ni],h=r[ku],i=r.uri||r.url,o=r[Lo]||{},a=r[pp]||{},l=(ud(e[Oa],o,a),bt(l)||mp(o,l),new Lm(n,h,i,void 0,o,a,r)),h=new fp(Lm[El],l);return yp(n,Lm[gp],e,h)}function dwe(n,e,a){_p(n,e);var l=e[Ni].message,r=e[Ni].severityLevel,i=e[Ni][Lo]||{},o=e[Ni][pp]||{},a=(ud(e[Oa],i,o),bt(a)||mp(i,a),new Om(n,l,r,i,o)),l=new fp(Om[El],a);return yp(n,Om[gp],e,l)}var ki,Th,X9=function(){function n(e,t){var r=[],i=!1,o=t.maxRetryCnt;this[kv]=function(){return r},this._set=function(a){return r=a},xi(n,this,function(a){a[Nf]=function(l){a[Df]()>=t[z9]?i||(jt(e,2,105,"Maximum in-memory buffer size reached: "+a[Df](),!0),i=!0):(l.cnt=l.cnt||0,!bt(o)&&l.cnt>o||r[td](l))},a[Df]=function(){return r[hr]},a.size=function(){for(var l=r[hr],h=0;h<r[hr];h++)l+=r[h].item[hr];return t[hP]||(l+=2),l},a[Dm]=function(){i=!(r=[])},a.getItems=function(){return r.slice(0)},a.batchPayloads=function(l){var h;return l&&0<l[hr]?(h=[],on(l,function(p){h[td](p[AE])}),t[hP]?h.join(`
`):"["+h.join(",")+"]"):null},a[ek]=function(l,h,p){var g=r.slice(0),_=new(p?Q9:nk)(l=l||e,h=h||{});return on(g,function(x){_[Nf](x)}),_}})}return n.__ieDyn=1,n}(),nk=function(n){function e(t,r){return t=n.call(this,t,r)||this,xi(e,t,function(i,o){i[IE]=function(a){o[Dm]()},i[Jv]=function(a){}}),t}return Uu(e,n),e.__ieDyn=1,e}(X9),fwe=["AI_buffer","AI_sentBuffer"],Q9=function(n){function e(r,i){var o=n.call(this,r,i)||this,a=!1,l=i==null?void 0:i.namePrefix,h=i[tk]||{getItem:QI,setItem:m9},p=h.getItem,g=h.setItem,_=i.maxRetryCnt;return xi(e,o,function(x,C){var M=te(e[HA]),L=te(e[vh]),D=function(){var J=[];try{return on(fwe,function(pe){var ue=_e(pe);J=J[qg](ue),l&&(ue=_e(l+"_"+pe),J=J[qg](ue))}),J}catch(pe){jt(r,2,41,"Transfer events from previous buffers: "+Dr(pe)+". previous Buffer items can not be removed",{exception:rn(pe)})}return[]}(),L=L[qg](D),D=x._set(M[qg](L));function z(J,pe){var ue=[],xe=[];return on(J,function(je){xe[td](je[AE])}),on(pe,function(je){$n(je)||_a(xe,je[AE])!==-1||ue[td](je)}),ue}function te(J){return le(l?l+"_"+J:J)}function le(J){try{var pe=p(r,J);if(pe){var ue=kc().parse(pe);if((ue=Pn(ue)?kc().parse(ue):ue)&&dr(ue))return ue}}catch(xe){jt(r,1,42," storage key: "+J+", "+Dr(xe),{exception:rn(xe)})}return[]}function ce(J,pe){try{var J=l?l+"_"+J:J,ue=JSON[$0](pe);g(r,J,ue)}catch(xe){g(r,J,JSON[$0]([])),jt(r,2,41," storage key: "+J+", "+Dr(xe)+". Buffer cleared",{exception:rn(xe)})}}function _e(J){try{var pe=le(J),ue=[];return on(pe,function(xe){ue[td]({item:xe,cnt:0})}),y9(r,J),ue}catch{}return[]}D[hr]>e[cv]&&(D[hr]=e[cv]),ce(e[vh],[]),ce(e[HA],D),x[Nf]=function(J){x[Df]()>=e[cv]?a||(jt(r,2,67,"Maximum buffer size reached: "+x[Df](),!0),a=!0):(J.cnt=J.cnt||0,!bt(_)&&J.cnt>_||(C[Nf](J),ce(e.BUFFER_KEY,x[kv]())))},x[Dm]=function(){C[Dm](),ce(e.BUFFER_KEY,x[kv]()),ce(e[vh],[]),a=!1},x[IE]=function(J){ce(e[HA],x._set(z(J,x[kv]())));var pe=te(e[vh]);pe instanceof Array&&J instanceof Array&&((pe=pe[qg](J))[hr]>e[cv]&&(jt(r,1,67,"Sent buffer reached its maximum size: "+pe[hr],!0),pe[hr]=e[cv]),ce(e[vh],pe))},x[Jv]=function(J){J=z(J,te(e[vh])),ce(e[vh],J)},x[ek]=function(J,pe,ue){ue=!!ue;var xe=x[kv]().slice(0),je=te(e[vh]).slice(0),ne=(J=J||r,pe=pe||{},x[Dm](),new(ue?e:nk)(J,pe));return on(xe,function(Ee){ne[Nf](Ee)}),ue&&ne[IE](je),ne}}),o}var t;return Uu(e,n),(t=e).VERSION="_1",e.BUFFER_KEY="AI_buffer"+t.VERSION,e.SENT_BUFFER_KEY="AI_sentBuffer"+t.VERSION,e.MAX_BUFFER_SIZE=2e3,e}(X9),pwe=function(){function n(e){xi(n,this,function(t){function r(a,l){var h="__aiCircularRefCheck",p={};if(a)if(a[h])jt(e,2,50,"Circular reference detected while serializing object",{name:l},!0);else if(a.aiDataContract)a[h]=!0,fr(a.aiDataContract,function(g,M){var x=$n(M)?1&M():1&M,C=$n(M)?4&M():4&M,M=2&M,L=a[g]!==void 0,D=cs(a[g])&&a[g]!==null;!x||L||M?C||(x=void 0)!==(x=D?(M?i:r)(a[g],g):a[g])&&(p[g]=x):jt(e,1,24,"Missing required field specification. The field is required but not present on source",{field:g,name:l})}),delete a[h];else if(l==="measurements")p=o(a,"number",l);else if(l==="properties")p=o(a,"string",l);else if(l==="tags")p=o(a,"string",l);else if(dr(a))p=i(a,l);else{jt(e,2,49,"Attempting to serialize an object which does not implement ISerializable",{name:l},!0);try{kc()[$0](a),p=a}catch(g){jt(e,1,48,g&&$n(g[af])?g[af]():"Error serializing object",null,!0)}}else jt(e,1,48,"cannot serialize object because it is null or undefined",{name:l},!0);return p}function i(a,l){if(a)if(dr(a))for(var h=[],p=0;p<a[hr];p++){var g=r(a[p],l+"["+p+"]");h[td](g)}else jt(e,1,54,`This field was specified as an array in the contract but the item is not an array.\r
`,{name:l},!0);return h}function o(a,l,h){var p;return a&&(p={},fr(a,function(g,_){l==="string"?_===void 0?p[g]="undefined":_===null?p[g]="null":_[af]?p[g]=_[af]():p[g]="invalid field: toString() is not defined.":l==="number"?_===void 0?p[g]="undefined":_===null?p[g]="null":(_=parseFloat(_),p[g]=_):(p[g]="invalid field: "+h+" is of unknown type.",jt(e,1,p[g],null,!0))})),p}t[Qw]=function(a){a=r(a,"root");try{return kc()[$0](a)}catch(l){jt(e,1,48,l&&$n(l[af])?l[af]():"Error serializing object",null,!0)}}})}return n.__ieDyn=1,n}(),gwe=8,mwe=function(){function n(){}return n.prototype.getHashCodeScore=function(e){return 100*(this.getHashCode(e)/n.INT_MAX_VALUE)},n.prototype.getHashCode=function(e){if(e==="")return 0;for(;e[hr]<gwe;)e=e[qg](e);for(var t=5381,r=0;r<e[hr];++r)t=(t<<5)+t+e.charCodeAt(r),t&=t;return Math.abs(t)},n.INT_MAX_VALUE=2147483647,n}(),ywe=function(){var n=new mwe,e=new w9;this[K9]=function(t){return t[Ko]&&t[Ko][e.userId]?n.getHashCodeScore(t[Ko][e.userId]):t.ext&&t.ext.user&&t.ext.user.id?n[iwe](t.ext.user.id):t[Ko]&&t[Ko][e.operationId]?n.getHashCodeScore(t[Ko][e.operationId]):t.ext&&t.ext.telemetryTrace&&t.ext.telemetryTrace[q0]?n.getHashCodeScore(t.ext.telemetryTrace[q0]):100*Math.random()}},_we=function(){function n(e,t){this.INT_MAX_VALUE=2147483647,t=t||up(null),(100<e||e<0)&&(t.throwInternal(2,58,"Sampling rate is out of range (0..100). Sampling will be disabled, you may be sending too much data which may affect your AI service level.",{samplingRate:e},!0),e=100),this[PE]=e,this.samplingScoreGenerator=new ywe}return n.prototype.isSampledIn=function(e){var t=this[PE];return t==null||100<=t||e.baseType===Of[El]||this.samplingScoreGenerator[K9](e)<t},n}(),tu=void 0,lF="",vwe=65e3;function uF(n){try{return n.responseText}catch{}return null}function bwe(n){return n&&n.sendPOST}var hF=vy(((ki={endpointUrl:pE(Hx,$R+Mm)})[hP]=fo(),ki[Y9]=15e3,ki[j9]=102400,ki.disableTelemetry=fo(),ki[H9]=fo(!0),ki.isRetryDisabled=fo(),ki[pP]=fo(!0),ki[q9]=fo(!0),ki[gP]=fo(),ki[G9]=fo(),ki[fP]=fo(),ki[$9]=tu,ki.namePrefix=tu,ki.samplingPercentage=pE(wwe,100),ki[dP]=tu,ki[W9]=tu,ki[z9]=1e4,ki[tk]=!1,ki.httpXHROverride={isVal:bwe,v:tu},ki[V9]=fo(),ki.transports=tu,ki.retryCodes=tu,ki.maxRetryCnt={isVal:mb,v:10},ki));function wwe(n){return!isNaN(n)&&0<n&&n<=100}(Th={})[Nh.dataType]=Z9,Th[Om.dataType]=dwe,Th[ed.dataType]=uwe,Th[Lm.dataType]=hwe,Th[Js.dataType]=cwe,Th[Of.dataType]=lwe,Th[Lf.dataType]=swe;var xwe=Th,Ewe=function(n){function e(){var t,r,i,o,a,l,h,p,g,_,x,C,M,L,D,z,te,le,ce,_e,J,pe,ue,xe,je,ne,Ee,ke,Be,Ze,at,Re,ht,Rt,hn=n.call(this)||this,wt=(hn.priority=1001,hn.identifier=x9,0);return xi(e,hn,function(Ge,Gn){function Xt(Ie,Te){var At=uF(Ie);!Ie||At+""!="200"&&At!==""?(At=wA(At))&&At[$A]&&At[$A]>At[WA]&&!J?Ge[qA](Te,At):Ge[Ag](Te,Ij(Ie)):(t=0,Ge[dw](Te,0))}function ln(Ie,Te,At){Ie.readyState===4&&ae(Ie.status,Te,Ie.responseURL,At,hE(Ie),uF(Ie)||Ie.response)}function Mn(Ie){try{var Te;if(Ie)return(Te=Ie[YA])&&Te[hr]?Te:null}catch{}return null}function Ot(Ie,Te){return!(le||(Ie?Ie.baseData&&!Ie[KA]?(Te&&jt(Te,1,70,"Cannot send telemetry without baseData and baseType"),1):(Ie[KA]||(Ie[KA]="EventData"),Ge[uv]?Ge._sample.isSampledIn(Ie)?(Ie[s9]=Ge._sample[PE],0):(Te&&jt(Te,2,33,"Telemetry item was sampled out and not sent",{SampleRate:Ge._sample[PE]}),1):(Te&&jt(Te,1,28,"Sender was not initialized"),1)):(Te&&jt(Te,1,7,"Cannot send empty telemetry"),1)))}function En(Ie,Te){var At=Ie.iKey||ce,xt=e.constructEnvelope(Ie,At,Te,_e);if(xt){var qt=!1;if(Ie[Ko]&&Ie[Ko][TA]&&(on(Ie[Ko][TA],function(dn){try{dn&&dn(xt)===!1&&(qt=!0,Rf(Te,"Telemetry processor check returns false"))}catch(Ke){jt(Te,1,64,"One of telemetry initializers failed, telemetry item will not be sent: "+Dr(Ke),{exception:rn(Ke)},!0)}}),delete Ie[Ko][TA]),!qt)return xt}else jt(Te,1,47,"Unable to create an AppInsights envelope")}function lt(Ie){var Te=lF,At=Ge[ua]();try{var xt=Ot(Ie,At),qt=null;(qt=xt?En(Ie,At):qt)&&(Te=a[Qw](qt))}catch{}return Te}function It(Ie){var Te=lF;return Te=Ie&&Ie[hr]?"["+Ie.join(",")+"]":Te}function he(Ie){var Te=F(),At={urlString:x};return At[Oa]=Ie,At.headers=Te,At}function B(Ke,Te,At,xt){xt===void 0&&(xt=!0);function qt(gt,Tt,Rn){var Xn;Xn=Te,Rn=Rn,gt===200&&Xn?Ge._onSuccess(Xn,Xn[hr]):Rn&&Ge[Ag](Xn,Rn)}var dn=H(Te),Ke=Ke&&Ke.sendPOST;return Ke&&dn?(xt&&Ge._buffer[IE](Te),Ke(dn,qt,!At)):null}function H(Ie){var Te,At,xt;return dr(Ie)&&0<Ie[hr]?(At=Ge[bh].batchPayloads(Ie),xt=F(),(Te={})[Oa]=At,Te.urlString=x,Te.headers=xt,Te.disableXhrSync=ke,Te.disableFetchKeepAlive=!Be,Te[YA]=Ie,Te):null}function F(){try{var Ie=h||{};return XI(x)&&(Ie[Jr[6]]=Jr[7]),Ie}catch{}return null}function Q(Ie){Ie=Ie?Ie[hr]:0,Ge[bh].size()+Ie>M&&(g&&!g.isOnline()||Ge[lv](!0,null,10))}function ae(Ie,Te,At,xt,qt,dn){var Ke=null;Ge._appId||(Ke=wA(dn))&&Ke.appId&&(Ge._appId=Ke.appId),(Ie<200||300<=Ie)&&Ie!==0?(Ie!==301&&Ie!==307&&Ie!==308||q(At))&&!J&&Lt(Ie)?(rt(Te),jt(Ge[ua](),2,40,". Response code "+Ie+". Will retry to send "+Te[hr]+" items.")):Ge[Ag](Te,qt):g&&!g.isOnline()?J||(rt(Te,10),jt(Ge[ua](),2,40,". Offline - Response Code: ".concat(Ie,". Offline status: ").concat(!g.isOnline(),". Will retry to send ").concat(Te.length," items."))):(q(At),Ie===206?(Ke=Ke||wA(dn))&&!J?Ge[qA](Te,Ke):Ge[Ag](Te,qt):(t=0,Ge[dw](Te,xt)))}function q(Ie){return!(10<=l||bt(Ie)||Ie===""||Ie===x)&&(x=Ie,++l,1)}function Ae(Ie,Te){if(!p)return B(ht&&ht[hw]([3],!0),Ie,Te);p(Ie,!1)}function Pe(Ie){try{if(Ie&&Ie[hr])return Pn(Ie[0])}catch{}}function We(Ie,Te){var At=null;if(dr(Ie)){for(var xt=Ie[hr],qt=0;qt<Ie[hr];qt++)xt+=Ie[qt].item[hr];return ht.getSyncFetchPayload()+xt<=vwe?At=2:Iv()?At=3:(At=1,jt(Ge[ua](),2,40,". Failed to send telemetry with Beacon API, retried with xhrSender.")),B(ht&&ht[hw]([At],!0),Ie,Te)}return null}function rt(Ie,Te){if(Te===void 0&&(Te=1),Ie&&Ie[hr]!==0){var At=Ge[bh];At[Jv](Ie),t++;for(var xt,qt=0,dn=Ie;qt<dn.length;qt++){var Ke=dn[qt];Ke.cnt=Ke.cnt||0,Ke.cnt++,At[Nf](Ke)}Ie=Te,Ie=t<=1?10:(xt=(Math.pow(2,t)-1)/2,xt=Math.floor(Math.random()*xt*10)+1,xt*=Ie,Math.max(Math.min(xt,3600),10)),xt=Cl()+1e3*Ie,r=xt,Et()}}function Et(){var Ie;o||i||(Ie=r?Math.max(0,r-Cl()):0,Ie=Math.max(pe,Ie),o=lc(function(){o=null,Ge[lv](!0,null,1)},Ie))}function Bt(){o&&o.cancel(),r=o=null}function Lt(Ie){return bt(Rt)?Ie===401||Ie===408||Ie===429||Ie===500||Ie===502||Ie===503||Ie===504:Rt[hr]&&-1<Rt.indexOf(Ie)}function an(){Ge[uv]=null,Ge[bh]=null,Ge._appId=null,Ge._sample=null,M=wt=l=t=0,je=_e=tu,Re=Be=ke=J=le=L=i=!(h={}),ht=at=Ze=ue=ce=te=C=x=_=p=a=o=r=g=null,Or(Ge,"_senderConfig",{g:function(){return Aj({},hF)}})}an(),Ge.pause=function(){Bt(),i=!0},Ge.resume=function(){i&&(i=!1,r=null,Q(),Et())},Ge.flush=function(Ie,Te,At){if(Ie===void 0&&(Ie=!0),!i){Bt();try{return Ge[lv](Ie,null,At||1)}catch(xt){jt(Ge[ua](),1,22,"flush failed, telemetry will not be collected: "+Dr(xt),{exception:rn(xt)})}}},Ge.onunloadFlush=function(){if(!i)if(L||Ee)try{return Ge[lv](!0,Ae,2)}catch(Ie){jt(Ge[ua](),1,20,"failed to flush with beacon sender on page unload, telemetry will not be collected: "+Dr(Ie),{exception:rn(Ie)})}else Ge.flush(!1)},Ge.addHeader=function(Ie,Te){h[Ie]=Te},Ge[GA]=function(Ie,Te,At,xt){Ge.isInitialized()&&jt(Ge[ua](),1,28,"Sender is already initialized"),Gn[GA](Ie,Te,At,xt);var qt=Ge.identifier,dn=(a=new pwe(Te.logger),t=0,r=null,Ge[uv]=null,l=0,Ge[ua]());_=md(uc("Sender"),Te.evtNamespace&&Te.evtNamespace()),g=k1e(_),Ge._addHook(so(Ie,function(Ke){Ke=Ke.cfg,Ke.storagePrefix&&QR(Ke.storagePrefix);var gt=Oc(null,Ke,Te).getExtCfg(qt,hF),Tr=(Or(Ge,"_senderConfig",{g:function(){return gt}}),Te.activeStatus()===Ph.PENDING?Ge.pause():Te.activeStatus()===Ph.ACTIVE&&Ge.resume(),C!==gt.endpointUrl&&(x=C=gt.endpointUrl),te&&te!==gt[dP]&&on(te,function(oe){delete h[oe.header]}),M=gt[j9],L=(gt[fP]===!1||gt[pP]===!1)&&Iv(),D=gt[fP]===!1&&Iv(),z=gt[pP]===!1&&Iv(),Ee=gt[V9],ke=!!gt[gP],Rt=gt.retryCodes,gt[tk]),nn=!!gt[H9]&&(!!Tr||H0()),Xn=gt.namePrefix,Rn=nn!==ue||nn&&je!==Xn||nn&&xe!==Tr;if(Ge[bh]){if(Rn)try{Ge._buffer=Ge._buffer[ek](dn,gt,nn)}catch(oe){jt(Ge[ua](),1,12,"failed to transfer telemetry to different buffer storage, telemetry will be lost: "+Dr(oe),{exception:rn(oe)})}Q()}else Ge[bh]=new(nn?Q9:nk)(dn,gt);je=Xn,ue=nn,xe=Tr,Be=!gt[G9]&&kR(!0),Re=!!gt[q9],Ge._sample=new _we(gt.samplingPercentage,dn),function(oe,V){return V=V.disableInstrumentationKeyValidation,!bt(V)&&V?1:new RegExp("^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$").test(oe)}(ce=gt[$9],Ke)||jt(dn,1,100,"Invalid Instrumentation key "+ce),te=gt[dP],Pn(x)&&!XI(x)&&te&&0<te[hr]?on(te,function(oe){hn.addHeader(oe.header,oe.value)}):te=null,ne=gt[oF];var Tt,Rn=function(){var oe;try{var V={xdrOnComplete:function($,K,me){if(me=Mn(me),me)return Xt($,me)},fetchOnComplete:function($,K,me,Oe){if(Oe=Mn(Oe),Oe)return ae($.status,Oe,$.url,Oe[hr],$.statusText,me||"")},xhrOnComplete:function($,K,me){if(me=Mn(me),me)return ln($,me,me[hr])},beaconOnRetry:function($,K,me){var Oe=K,He=me,Le=$&&$[YA];if(Re)at&&at(Le,!0),jt(Ge[ua](),2,40,". Failed to send telemetry with Beacon API, retried with normal sender.");else{for(var Ce=[],De=0;De<Le[hr];De++){var ot=Le[De],st=[ot],St=H(st);He(St,Oe)?Ge._onSuccess(st,st[hr]):Ce[td](ot)}0<Ce[hr]&&(at&&at(Ce,!0),jt(Ge[ua](),2,40,". Failed to send telemetry with Beacon API, retried with normal sender."))}}};return(oe={})[oF]=ne,oe.isOneDs=!1,oe.disableCredentials=!1,oe[gP]=ke,oe.disableBeacon=!z,oe.disableBeaconSync=!D,oe.senderOnCompleteCallBack=V,oe}catch{}return null}(),Xn=(ht?ht.SetConfig(Rn):(ht=new Hbe)[GA](Rn,dn),gt.httpXHROverride),nn=t4([3,1,2],gt.transports),Lr=ht&&ht[hw](nn,!1),Qr=ht&&ht.getFallbackInst(),Tr=(Ze=function(oe,V){return B(Qr,oe,V)},at=function(oe,V){return B(Qr,oe,V,!1)},Lr=Ee?Xn:Lr||Xn||Qr,Ge[uv]=function(oe,V){return B(Lr,oe,V)},Be&&(p=We),t4([3,1],gt[aF]));Be||(Tr=Tr.filter(function(oe){return oe!==2})),Tt=ht&&ht[hw](Tr,!0),Tt=!Ee&&Tt||Xn,p=(p=(Ee||gt[aF]||!p)&&Tt?function(oe,V){return B(Tt,oe,V)}:p)||Ze,le=gt.disableTelemetry,_e=gt[W9]||tu,J=gt.isRetryDisabled,pe=gt[Y9]}))},Ge.processTelemetry=function(Ie,Te){var At,xt=(Te=Ge._getTelCtx(Te))[ua]();try{if(!Ot(Ie,xt))return;var qt=En(Ie,xt);if(!qt)return;var dn=a[Qw](qt),Ke=Ge[bh],gt=(Q(dn),(At={})[AE]=dn,At.cnt=0,At);Ke[Nf](gt),Et()}catch(Tt){jt(xt,2,12,"Failed adding telemetry to the sender's buffer, some telemetry will be lost: "+Dr(Tt),{exception:rn(Tt)})}Ge.processNext(Ie,Te)},Ge.isCompletelyIdle=function(){return!i&&wt===0&&Ge._buffer[Df]()===0},Ge._xhrReadyStateChange=function(Ie,Te,At){if(!Pe(Te))return ln(Ie,Te,At)},Ge[lv]=function(Ie,Te,At){var xt;if(Ie===void 0&&(Ie=!0),!i)try{var qt=Ge[bh];if(le)qt[Dm]();else if(0<qt[Df]()){var dn=qt.getItems(),Ke=At||0,gt=Ie,Tt=function(){var Rn="getNotifyMgr";return Ge.core[Rn]?Ge.core[Rn]():Ge.core._notificationManager}();if(Tt&&Tt[sF])try{Tt[sF](Ke,gt)}catch(Rn){jt(Ge[ua](),1,74,"send request notification failed: "+Dr(Rn),{exception:rn(Rn)})}xt=Te?Te.call(Ge,dn,Ie):Ge[uv](dn,Ie)}Bt()}catch(Rn){qt=kj(),(!qt||9<qt)&&jt(Ge[ua](),1,40,"Telemetry transmission failed, some telemetry will be lost: "+Dr(Rn),{exception:rn(Rn)})}return xt},Ge.getOfflineSupport=function(){var Ie={getUrl:function(){return x},createPayload:he};return Ie[Qw]=lt,Ie.batch=It,Ie.shouldProcess=function(Te){return!!Ot(Te)},Ie},Ge._doTeardown=function(Ie,Te){Ge.onunloadFlush(),am(g,!1),an()},Ge[Ag]=function(Ie,Te,At){if(!Pe(Ie))return Ie=Ie,Te=Te,jt(Ge[ua](),2,26,"Failed to send telemetry.",{message:Te}),void(Ge._buffer&&Ge._buffer[Jv](Ie))},Ge[qA]=function(Ie,Te){if(!Pe(Ie)){for(var At=Ie,Ie=Te,xt=[],qt=[],Te=Ie.errors.reverse(),dn=0,Ke=Te;dn<Ke.length;dn++){var gt=Ke[dn],Tt=At.splice(gt.index,1)[0];(Lt(gt.statusCode)?qt:xt)[td](Tt)}0<At[hr]&&Ge[dw](At,Ie[WA]),0<xt[hr]&&Ge[Ag](xt,hE(null,["partial success",Ie[WA],"of",Ie.itemsReceived].join(" "))),0<qt[hr]&&(rt(qt),jt(Ge[ua](),2,40,"Partial success. Delivered: "+At[hr]+", Failed: "+xt[hr]+". Will retry to send "+qt[hr]+" our of "+Ie[$A]+" items"))}},Ge[dw]=function(Ie,Te){Pe(Ie)||(Ie=Ie,Ge._buffer&&Ge._buffer[Jv](Ie))},Ge._xdrOnLoad=function(Ie,Te){if(!Pe(Te))return Xt(Ie,Te)}}),hn}return Uu(e,n),e.constructEnvelope=function(t,r,i,o){return t=r===t.iKey||bt(r)?t:Da(Da({},t),{iKey:r}),(xwe[t.baseType]||Z9)(i,t,o)},e}(Ey),dF="duration",Ff="properties",Sc="requestUrl",Ov="inst",bf="length",su="traceID",qh="spanID",tc="traceFlags",e0="context",Fm="aborted",Jw="traceId",ex="spanId",fw="_addHook",bc="core",XA="includeCorrelationHeaders",mP="getAbsoluteUrl",Zd="headers",Qs="requestHeaders",QA="setRequestHeader",fF="trackDependencyDataInternal",wf="startTime",Ig="toLowerCase",yP="enableRequestHeaderTracking",J9="enableAjaxErrorStatusText",eV="enableAjaxPerfTracking",tV="maxAjaxCallsPerView",nV="excludeRequestFromAutoTrackingPatterns",rV="addRequestContext",_P="disableAjaxTracking",iV="ajaxPerfLookupDelay",oV="disableFetchTracking",aV="enableResponseHeaderTracking",xc="status",df="statusText",cm="headerMap",vP="openDone",bP="sendDone",xf="requestSentTime",wP="abortDone",xP="getTraceId",EP="getTraceFlags",Fh="method",TP="errorStatusText",sV="stateChangeAttached",pF="responseText",Lv="responseFinishedTime",SP="CreateTrackItem",cV="response",gF="getAllResponseHeaders",CP="getPartAProps",ME="perfMark",$g="name",AP="perfTiming",t0="exception",mF="ajaxDiagnosticsMessage",IP="correlationContext",JA="ajaxTotalDuration",yF="eventTraceCtx";function lV(o,i,t){var r=0,i=o[i],o=o[t];return r=i&&o?Xa(i,o):r}function Xd(n,e,a,r,i){var o=0,a=lV(a,r,i);return o=a?Sh(n,e,Dh(a)):o}function Sh(n,e,t){var r=0;return n&&e&&t&&((n.ajaxPerf=n.ajaxPerf||{})[e]=t,r=1),r}function Twe(n,e){var t,r=n[AP],i=e[Ff]||{},o=0,_="Start",a="domainLookup",l="connect",h="request",p="response",g=l+"End",_=h+_,x=p+"End",C="transferSize",M="encodedBodySize",L="decodedBodySize",D="serverTiming";r?(o=(o=(o=(o=(o=(o=(o|=Xd(i,"End",r,"redirectStart","End"))|Xd(i,a,r,"domainLookupStart","domainLookupEnd"))|Xd(i,l,r,"connectStart",g))|Xd(i,h,r,_,"requestEnd"))|Xd(i,p,r,"responseStart",x))|Xd(i,"networkConnect",r,"startTime",g))|Xd(i,"sentRequest",r,_,x),a=(a=r[dF])||lV(r,"startTime",x)||0,o=(o|=Sh(i,dF,a))|Sh(i,"perfTotal",a),(l=r[D])&&(t={},on(l,function(z,le){var le=cE(z.name||""+le),ce=t[le]||{};fr(z,function(_e,J){!(_e!=="name"&&Pn(J)||mb(J))||!(J=ce[_e]?ce[_e]+";"+J:J)&&Pn(J)||(ce[_e]=J)}),t[le]=ce}),o|=Sh(i,D,t)),o=(o=(o|=Sh(i,C,r[C]))|Sh(i,M,r[M]))|Sh(i,L,r[L])):n[ME]&&(o|=Sh(i,"missing",n.perfAttempts)),o&&(e[Ff]=i)}var ro,Swe=function(){this[vP]=!1,this.setRequestHeaderDone=!1,this[bP]=!1,this[wP]=!1,this[sV]=!1},_F=function(){function n(e,t,r,i){var o=this,a=r;o[ME]=null,o.completed=!1,o.requestHeadersSize=null,o[Qs]=null,o.responseReceivingDuration=null,o.callbackDuration=null,o[JA]=null,o[Fm]=0,o.pageUrl=null,o[Sc]=null,o.requestSize=0,o[Fh]=null,o[xc]=null,o[xf]=null,o.responseStartedTime=null,o[Lv]=null,o.callbackFinishedTime=null,o.endTime=null,o.xhrMonitoringState=new Swe,o.clientFailure=0,o[su]=e,o[qh]=t,o[tc]=i==null?void 0:i.getTraceFlags(),o[yF]=i?((r={})[Jw]=i[xP](),r[ex]=i.getSpanId(),r[tc]=i[EP](),r):null,xi(n,o,function(l){l.getAbsoluteUrl=function(){return l[Sc]?l1e(l[Sc]):null},l.getPathName=function(){return l[Sc]?OT(a,u1e(l[Fh],l[Sc])):null},l[SP]=function(h,p,g){var _;return l.ajaxTotalDuration=Math.round(1e3*Xa(l.requestSentTime,l.responseFinishedTime))/1e3,l[JA]<0?null:((_={id:"|"+l[su]+"."+l[qh],target:l[mP]()})[$g]=l.getPathName(),_.type=h,_[wf]=null,_.duration=l[JA],_.success=200<=+l[xc]&&+l[xc]<400,_.responseCode=+l[xc],_[Ff]={HttpMethod:l[Fh]},_=(h=_)[Ff],l[Fm]&&(_[Fm]=!0),l[xf]&&(h[wf]=new Date,h[wf].setTime(l[xf])),Twe(l,h),p&&0<du(l.requestHeaders)[bf]&&(_[Qs]=l[Qs]),g&&(p=g())&&((g=p[IP])&&(h.correlationContext=g),p[cm]&&0<du(p.headerMap)[bf]&&(_.responseHeaders=p[cm]),l[TP])&&(400<=l[xc]?((g=p.type)!==""&&g!=="text"||(_.responseText=p.responseText?p[df]+" - "+p.responseText:p[df]),g==="json"&&(_.responseText=p.response?p[df]+" - "+JSON.stringify(p[cV]):p[df])):l[xc]===0&&(_.responseText=p[df]||"")),h)},l[CP]=function(){var h,p=null,g=l[yF];return g&&(g[Jw]||g[ex])&&(h=(p={})[Ss.TraceExt]=((h={})[su]=g[Jw],h.parentID=g[ex],h),bt(g[tc])||(h[tc]=g[tc])),p}})}return n.__ieDyn=1,n}(),n0="diagLog",nd="_ajaxData",ff="fetch",hv="Failed to monitor XMLHttpRequest",uV=", monitoring data for this ajax call ",Pg=uV+"may be incorrect.",vF=uV+"won't be sent.",bF="Failed to get Request-Context correlation header as it may be not included in the response or not accessible.",wF="Failed to add custom defined request context as configured call back may missing a null check.",xF="Failed to calculate the duration of the ",Cwe=0;function Awe(){var n=oc();return!n||bt(n.Request)||bt(n.Request[wl])||bt(n[ff])?null:n[ff]}function Iwe(n,e){var t,r=!1,i=(PT()&&(r=!(bt(i=XMLHttpRequest[wl])||bt(i.open)||bt(i.send)||bt(i.abort))),kj());if(r=i&&i<9?!1:r)try{var o=new XMLHttpRequest,a={xh:[],i:((t={})[e]={},t)},l=(o[nd]=a,XMLHttpRequest[wl].open);XMLHttpRequest[wl].open=l}catch(h){r=!1,r0(n,15,"Failed to enable XMLHttpRequest monitoring, extension is not supported",((i={})[t0]=rn(h),i))}return r}var Wg=function(n,e){return n&&e&&n[nd]?(n[nd].i||{})[e]:null},Pwe=function(n,e,t){n&&(n=(n[nd]||{}).xh)&&n.push({n:e,v:t})},e2=function(n,e){var t=!1;return n&&(n=(n[nd]||{}).xh)&&on(n,function(r){if(r.n===e)return t=!0,-1}),t};function tx(n,e){var t="";try{var r=Wg(n,e);r&&r[Sc]&&(t+="(url: '"+r[Sc]+"')")}catch{}return t}function r0(n,e,t,r,i){jt(n[n0](),1,e,t,r,i)}function Zl(n,e,t,r,i){jt(n[n0](),2,e,t,r,i)}function dv(n,e,t){return function(r){var i;r0(n,e,t,((i={ajaxDiagnosticsMessage:tx(r[Ov],n._ajaxDataId)})[t0]=rn(r.err),i))}}function Mg(n,e){return n&&e?is(n,e):-1}function EF(n,e,t){var r={id:e,fn:t};return n.push(r),{remove:function(){on(n,function(i,o){if(i.id===r.id)return n.splice(o,1),-1})}}}function hV(n,e,t,r){var i=!0;return on(e,function(o,a){try{o.fn.call(null,t)===!1&&(i=!1)}catch(l){jt(n&&n.logger,1,64,"Dependency "+r+" [#"+a+"] failed: "+Dr(l),{exception:rn(l)},!0)}}),i}function Mwe(n,e,t,r,i,o){var a;0<n[bf]&&((a={})[bc]=e,a.xhr=r,a.input=i,a.init=o,a.traceId=t[su],a.spanId=t[qh],a.traceFlags=t[tc],a.context=t[e0]||{},a.aborted=!!t[Fm],hV(e,n,r=a,"listener"),t[su]=r[Jw],t[qh]=r[ex],t[tc]=r[tc],t[e0]=r[e0])}var pw="*.blob.core.",Rwe=Au([pw+"windows.net",pw+"chinacloudapi.cn",pw+"cloudapi.de",pw+"usgovcloudapi.net"]),kwe=[/https:\/\/[^\/]*(\.pipe\.aria|aria\.pipe|events\.data|collector\.azure)\.[^\/]+\/(OneCollector\/1|Collector\/3)\.0/i],Owe=Au(((ro={})[tV]=500,ro[_P]=!1,ro[oV]=!1,ro[nV]=void 0,ro.disableCorrelationHeaders=!1,ro.distributedTracingMode=1,ro.correlationHeaderExcludedDomains=Rwe,ro.correlationHeaderDomains=void 0,ro.correlationHeaderExcludePatterns=void 0,ro.appId=void 0,ro.enableCorsCorrelation=!1,ro[yP]=!1,ro[aV]=!1,ro[J9]=!1,ro[eV]=!1,ro.maxAjaxPerfLookupAttempts=3,ro[iV]=25,ro.ignoreHeaders=["Authorization","X-API-Key","WWW-Authenticate"],ro[rV]=void 0,ro.addIntEndpoints=!0,ro)),Lwe=function(n){function e(){var t,r,i,o,a,l,h,p,g,_,x,C,M,L,D,z,te,le,ce,_e,J,pe,ue,xe,je,ne,Ee,ke,Be,Ze,at=n.call(this)||this;return at.identifier=e.identifier,at.priority=120,xi(e,at,function(Re,ht){var Rt=ht[fw];function hn(){var he=dl();Ze=r=t=!1,i=he&&he.host&&he.host[Ig](),L=C=_=g=l=a=!1,te=z=!(D={}),_e=ce=le=x=p=o=null,pe=M=h=0,ue=[],xe=[],J=uc("ajaxData"),Re._ajaxDataId=J,ke=Ee=ne=1,Be=je=null}function wt(he){var B=!0;return(he||je)&&on(je,function(H){if(H[Ig]()===he[Ig]())return B=!1,-1}),B}function Ge(he,B,H){Rt(r1e(he,B,H))}function Gn(he,B,H){var F,Q,ae=!1,q=((Pn(B)?B:(B||{}).url||"")||"")[Ig]();return on(le,function(Ae){var Pe=Ae;Pn(Ae)&&(Pe=new RegExp(Ae)),ae=ae||Pe.test(q)}),ae||(F=Mg(q,"?"),Q=Mg(q,"#"),(F=F===-1||Q!==-1&&Q<F?Q:F)!==-1&&(q=q.substring(0,F)),bt(he)?bt(B)||(ae=typeof B=="object"&&B[ow]===!0||!!H&&H[ow]===!0):ae=he[ow]===!0||q[ow]===!0,(ae=!ae&&q&&XI(q)?!0:ae)?D[q]||(D[q]=1):D[q]&&(ae=!0)),ae}function Xt(he,B,H){var F=!0,Q=r;return bt(he)||(F=H===!0||!bt(B)),Q&&F}function ln(){var he=null;return he=!(he=Re[bc]&&Re[bc].getTraceCtx?Re[bc].getTraceCtx(!1):he)&&p&&p.telemetryTrace?KR(p.telemetryTrace):he}function Mn(he,B){var H;B[Sc]&&x&&C&&(H=Iu())&&$n(H.mark)&&(he=x+he+"#"+ ++Cwe,H.mark(he),H=H.getEntriesByName(he))&&H[bf]===1&&(B[ME]=H[0])}function Ot(he,B,H,F){var Q=B[ME],ae=Iu(),q=ne,Ae=Ee,Pe=B[Sc],We=0;(function rt(){try{if(ae&&Q){We++;for(var Et=null,Bt=ae.getEntries(),Lt=Bt[bf]-1;0<=Lt;Lt--){var an=Bt[Lt];if(an){if(an.entryType==="resource")an.initiatorType!==he||Mg(an[$g],Pe)===-1&&Mg(Pe,an[$g])===-1||(Et=an);else if(an.entryType==="mark"&&an[$g]===Q[$g]){B[AP]=Et;break}if(an[wf]<Q[wf]-1e3)break}}}!Q||B[AP]||q<=We||B.async===!1?(Q&&$n(ae.clearMarks)&&ae.clearMarks(Q[$g]),B.perfAttempts=We,H()):lc(rt,Ae)}catch(Ie){F(Ie)}})()}function En(he){var B="";try{bt(he)||(B+="(url: '".concat(typeof he=="string"?he:he.url,"')"))}catch(H){r0(Re,15,"Failed to grab failed fetch diagnostics message",{exception:rn(H)})}return B}function lt(he,B,H,F,Q,ae){function q(Ae,Pe,We){We=We||{},We.fetchDiagnosticsMessage=En(H),Pe&&(We.exception=rn(Pe)),Zl(Re,Ae,xF+"fetch call"+vF,We)}Q&&(Q[Lv]=sw(),Q[xc]=B,Ot(ff,Q,function(){var Ae,Pe=Q[SP]("Fetch",a,ae);try{ce&&(Ae=ce({status:B,request:H,response:F}))}catch{Zl(Re,104,wF)}Pe?(Ae!==void 0&&(Pe[Ff]=Da(Da({},Pe.properties),Ae)),Ae=Q[CP](),It(xe,Re[bc],Q,Pe,null,Ae)):q(14,null,{requestSentTime:Q[xf],responseFinishedTime:Q[Lv]})},function(Ae){q(18,Ae,null)}))}function It(he,B,H,F,Q,ae){var q,Ae=!0;0<he[bf]&&((q={item:F})[Ff]=Q,q.sysProperties=ae,q.context=H?H[e0]:null,q.aborted=!!H&&!!H[Fm],Ae=hV(B,he,q,"initializer")),Ae&&Re[fF](F,Q,ae)}hn(),Re.initialize=function(he,B,H,F){var Q,ae;!Re.isInitialized()&&(ht.initialize(he,B,H,F),_e=md(uc("ajax"),B&&B.evtNamespace&&B.evtNamespace()),Re[fw](so(he,function(q){q=Oc(null,q.cfg,Re[bc]),o=q.getExtCfg(e.identifier,Owe),ke=o.distributedTracingMode,a=o[yP],l=o[J9],C=o[eV],M=o[tV],le=[].concat(o[nV]||[],o.addIntEndpoints!==!1?kwe:[]),ce=o[rV],_=ke===0||ke===1,g=ke===1||ke===2,C&&(x=J),z=!!o[_P],ne=o.maxAjaxPerfLookupAttempts,Ee=o[iV],je=o.ignoreHeaders,Be=o.appId})),Iwe(Re,J)&&Re[fw](so(o,function(){z=!!o[_P],a=o[yP],z||r||(Ge(XMLHttpRequest,"open",{ns:_e,req:function(q,Ae,Pe,We){var rt,Et,Bt,Lt,an,Ie,Te;z||(q=q[Ov],rt=Wg(q,J),!Gn(q,Pe)&&Xt(q,rt,!0)&&(rt&&rt.xhrMonitoringState[vP]||(Lt=q,Ae=Ae,Pe=Pe,We=We,an=ln(),Ie=an&&an[xP]()||Hh(),Te=Oh(Hh(),0,16),Lt=(Lt=Lt[nd]=Lt[nd]||{xh:[],i:{}}).i=Lt.i||{},(Ie=Lt[J]=Lt[J]||new _F(Ie,Te,Re[n0](),(Lt=Re.core)==null?void 0:Lt.getTraceCtx()))[tc]=an&&an[EP](),Ie[Fh]=Ae,Ie[Sc]=Pe,Ie.xhrMonitoringState[vP]=!0,Ie[Qs]={},Ie.async=We,Ie[TP]=l,rt=Ie),Et=q,(Bt=rt).xhrMonitoringState[sV]=gu(Et,"readystatechange",function(){var At,xt,qt;try{Et&&Et.readyState===4&&Xt(Et,Bt)&&((qt=Wg(xt=Et,J))[Lv]=sw(),qt[xc]=xt[xc],Ot("xmlhttprequest",qt,function(){try{var gt,Tt=qt[SP]("Ajax",a,function(){(Qr={statusText:xt[df]})[cm]=null,Qr[IP]=function(Tr){try{var oe=Tr[gF]();if(oe!==null&&Mg(oe[Ig](),Jr[8])!==-1)return q4(Tr.getResponseHeader(Jr[0]))}catch(V){Zl(Re,18,bF,((oe={})[mF]=tx(Tr,J),oe[t0]=rn(V),oe))}}(xt),Qr.type=xt.responseType,Qr[pF]=function(Tr){try{var oe=Tr.responseType;if(oe===""||oe==="text")return Tr[pF]}catch{}return null}(xt),Qr.response=xt[cV];var nn,Lr,Qr;return L&&(nn=xt[gF]())&&(nn=mo(nn).split(/[\r\n]+/),Lr={},on(nn,function(V){var V=V.split(": "),oe=V.shift(),V=V.join(": ");wt(oe)&&(Lr[oe]=V)}),Qr[cm]=Lr),Qr}),Rn=void 0;try{ce&&(Rn=ce({status:xt[xc],xhr:xt}))}catch{Zl(Re,104,wF)}Tt?(Rn!==void 0&&(Tt[Ff]=Da(Da({},Tt.properties),Rn)),gt=qt[CP](),It(xe,Re[bc],qt,Tt,null,gt)):Ke(null,{requestSentTime:qt[xf],responseFinishedTime:qt[Lv]})}finally{try{var Xn=(xt[nd]||{i:{}}).i||{};Xn[J]&&(Xn[J]=null)}catch{}}},function(gt){Ke(gt,null)}))}catch(gt){var dn=rn(gt);dn&&Mg(dn[Ig](),"c00c023f")!==-1||r0(Re,16,hv+" 'readystatechange' event handler"+Pg,((At={})[mF]=tx(Et,J),At[t0]=dn,At))}function Ke(gt,Tt){Tt=Tt||{},Tt.ajaxDiagnosticsMessage=tx(xt,J),gt&&(Tt.exception=rn(gt)),Zl(Re,14,xF+"ajax call"+vF,Tt)}},_e)))},hkErr:dv(Re,15,hv+".open"+Pg)}),Ge(XMLHttpRequest,"send",{ns:_e,req:function(q,Ae){var Pe;z||Xt(q=q[Ov],Pe=Wg(q,J))&&!Pe.xhrMonitoringState[bP]&&(Mn("xhr",Pe),Pe[xf]=sw(),Re[XA](Pe,void 0,void 0,q),Pe.xhrMonitoringState[bP]=!0)},hkErr:dv(Re,17,hv+Pg)}),Ge(XMLHttpRequest,"abort",{ns:_e,req:function(q){z||Xt(q=q[Ov],q=Wg(q,J))&&!q.xhrMonitoringState[wP]&&(q[Fm]=1,q.xhrMonitoringState[wP]=!0)},hkErr:dv(Re,13,hv+".abort"+Pg)}),Ge(XMLHttpRequest,"setRequestHeader",{ns:_e,req:function(q,Ae,Pe){var We;z||(q=q[Ov],(We=Wg(q,J))&&Xt(q,We)&&(Pwe(q,Ae,Pe),a)&&wt(Ae)&&We&&(We[Qs][Ae]=Pe))},hkErr:dv(Re,71,hv+".setRequestHeader"+Pg)}),r=!0)})),(H=Awe())&&(Q=oc(),ae=H.polyfill,Re[fw](so(o,function(){te=!!o[oV],L=o[aV],te||t?ae&&!Ze&&(Rt(ZI(Q,ff,{ns:_e,req:function(q,Ae,Pe){Gn(null,Ae,Pe)}})),Ze=!0):(Rt(ZI(Q,ff,{ns:_e,req:function(q,Ae,Pe){var We,rt;te||!t||Gn(null,Ae,Pe)||ae&&r||(We=q.ctx(),rt=function(Et,Bt){var Lt=ln(),an=Lt&&Lt[xP]()||Hh(),Ie=Oh(Hh(),0,16),Ie=new _F(an,Ie,Re[n0](),(an=Re.core)==null?void 0:an.getTraceCtx());Ie[tc]=Lt&&Lt[EP](),Ie[xf]=sw(),Ie[TP]=l,an=Et instanceof Request?(Et||{}).url||"":Et,an===""&&(Lt=dl())&&Lt.href&&(an=sj(Lt.href,"#")[0]),Ie[Sc]=an,Lt="GET",Bt&&Bt[Fh]?Lt=Bt[Fh]:Et&&Et instanceof Request&&(Lt=Et[Fh]),Ie[Fh]=Lt;var Te={};return a&&new Headers((Bt?Bt[Zd]:0)||Et instanceof Request&&Et[Zd]||{}).forEach(function(At,xt){wt(xt)&&(Te[xt]=At)}),Ie[Qs]=Te,Mn(ff,Ie),Ie}(Ae,Pe),(Ae=Re[XA](rt,Ae,Pe))!==Pe&&q.set(1,Ae),We.data=rt)},rsp:function(q,Ae){var Pe;te||(Pe=q.ctx().data)&&(q.rslt=q.rslt.then(function(We){return lt(0,(We||{})[xc],Ae,We,Pe,function(){(Et={statusText:(We||{})[df]})[cm]=null,Et[IP]=function(Bt){if(Bt&&Bt[Zd])try{return q4(Bt[Zd].get(Jr[0]))}catch(Lt){Zl(Re,18,bF,((Bt={fetchDiagnosticsMessage:En(Bt)})[t0]=rn(Lt),Bt))}}(We);var rt,Et;return L&&We&&(rt={},We.headers.forEach(function(Bt,Lt){wt(Lt)&&(rt[Lt]=Bt)}),Et[cm]=rt),Et}),We}).catch(function(We){throw lt(0,0,Ae,null,Pe,null,We.message||rn(We)),We}))},hkErr:dv(Re,15,"Failed to monitor Window.fetch"+Pg)},!0,ej())),t=!0)})),ae)&&(Q[ff].polyfill=ae),F=Re[bc].getPlugin(DT))&&(p=F.plugin[e0])},Re._doTeardown=function(){hn()},Re.trackDependencyData=function(he,B){It(xe,Re[bc],null,he,B)},Re[XA]=function(he,B,H,F){var Q,ae,q,Ae,Pe=Re._currentWindowHost||i;return Mwe(ue,Re[bc],he,F,B,H),B||B===""?(G4(o,he[mP](),Pe)&&(H=H||{},B=new Headers(H[Zd]||B instanceof Request&&B[Zd]||{}),_&&(Q="|"+he[su]+"."+he[qh],B.set(Jr[3],Q),a)&&(he[Qs][Jr[3]]=Q),(ae=Be||p&&p.appId())&&(B.set(Jr[0],Jr[2]+ae),a)&&(he[Qs][Jr[0]]=Jr[2]+ae),g&&(bt(q=he[tc])&&(q=1),Ae=b4(v4(he[su],he[qh],q)),B.set(Jr[4],Ae),a)&&(he[Qs][Jr[4]]=Ae),H[Zd]=B),H):F?(G4(o,he[mP](),Pe)&&(_&&(e2(F,Jr[3])?Zl(Re,71,"Unable to set ["+Jr[3]+"] as it has already been set by another instance"):(Q="|"+he[su]+"."+he[qh],F[QA](Jr[3],Q),a&&(he[Qs][Jr[3]]=Q))),(ae=Be||p&&p.appId())&&(e2(F,Jr[0])?Zl(Re,71,"Unable to set ["+Jr[0]+"] as it has already been set by another instance"):(F[QA](Jr[0],Jr[2]+ae),a&&(he[Qs][Jr[0]]=Jr[2]+ae))),g)&&(bt(q=he[tc])&&(q=1),e2(F,Jr[4])?Zl(Re,71,"Unable to set ["+Jr[4]+"] as it has already been set by another instance"):(Ae=b4(v4(he[su],he[qh],q)),F[QA](Jr[4],Ae),a&&(he[Qs][Jr[4]]=Ae))),F):void 0},Re[fF]=function(he,B,H){M===-1||h<M?(ke!==2&&ke!==1||typeof he.id!="string"||he.id[he.id[bf]-1]==="."||(he.id+="."),bt(he[wf])&&(he[wf]=new Date),he=Eh(he,Lf.dataType,Lf.envelopeType,Re[n0](),B,H),Re[bc].track(he)):h===M&&r0(Re,55,"Maximum ajax per page view limit reached, ajax monitoring is paused until the next trackPageView(). In order to increase the limit set the maxAjaxCallsPerView configuration parameter.",!0),++h},Re.addDependencyListener=function(he){return EF(ue,pe++,he)},Re.addDependencyInitializer=function(he){return EF(xe,pe++,he)}}),at}return Uu(e,n),e.prototype.processTelemetry=function(t,r){this.processNext(t,r)},e.prototype.addDependencyInitializer=function(t){return null},e.identifier="AjaxDependencyPlugin",e}(Ey),Nwe=function(){},Dwe=function(){this.id="browser",this.deviceClass="Browser"},Fwe="3.3.0",Bwe=function(n,e){var t=this,r=so(n,function(){var i=n.sdkExtension;t.sdkVersion=(i?i+"_":"")+"javascript:"+Fwe});e&&e.add(r)},Uwe=function(){},RE="sessionManager",kE="update",nx="isUserCookieSet",OE="isNewUser",t2="getTraceCtx",PP="telemetryTrace",dV="applySessionContext",fV="applyApplicationContext",pV="applyDeviceContext",gV="applyOperationContext",mV="applyUserContext",yV="applyOperatingSystemContxt",_V="applyLocationContext",vV="applyInternalContext",pf="accountId",rx="getSessionId",rk="namePrefix",zwe="sessionCookiePostfix",bV="userCookiePostfix",LE="idLength",ik="getNewId",NE="length",Yg="automaticSession",Kg="authenticatedId",fv="acquisitionDate",gw="renewalDate",i0="join",pv="cookieSeparator",n2="authUserCookieName",jwe="ai_session",Vwe=864e5,Hwe=18e5,Gwe=6e4,wV=function(){},qwe=function(){function n(e,t,r){var i,o,a,l,h=up(t),p=BR(t);xi(n,this,function(g){var _=so(e=e||{},function(M){a=e.sessionExpirationMs||Vwe,l=e.sessionRenewalMs||Hwe;var L=e.sessionCookiePostfix||e[rk]||"";i=jwe+L});function x(M,L){var D=!1,z=", session will be reset",te=L.split("|");if(2<=te[NE])try{var le=+te[1]||0,ce=+te[2]||0;isNaN(le)||le<=0?jt(h,2,27,"AI session acquisition date is 0"+z):isNaN(ce)||ce<=0?jt(h,2,27,"AI session renewal date is 0"+z):te[0]&&(M.id=te[0],M[fv]=le,M[gw]=ce,D=!0)}catch(_e){jt(h,1,9,"Error parsing ai_session value ["+(L||"")+"]"+z+" - "+Dr(_e),{exception:rn(_e)})}return D}function C(z,L){var te=z[fv],D=(z[gw]=L,l),le=te+a-L,z=[z.id,te,L],te=0,te=le<D?le/1e3:D/1e3,le=e.cookieDomain||null;p.set(i,z[i0]("|"),0<a?te:null,le),o=L}r&&r.add(_),g[Yg]=new wV,g[kE]=function(){var M,L,D=Cl(),z=!1,te=g[Yg];!(z=te.id?z:!function(le){var ce=!1,_e=p.get(i);return(_e&&$n(_e.split)||(_e=p9(h,i)))&&(ce=x(le,_e)),ce||le.id}(te))&&0<a&&(M=D-te[fv],L=D-te[gw],z=(z=(z=M<0||L<0)||a<M)||l<L),z?(M=D,L=e[ik]||OR,g.automaticSession.id=L(e[LE]||22),g[Yg][fv]=M,C(g[Yg],M),NT()||jt(h,2,0,"Browser does not support local storage. Session durations will be inaccurate.")):(!o||Gwe<D-o)&&C(te,D)},g.backup=function(){var M,L,D=g[Yg];M=D.id,L=D[fv],D=D[gw],g9(h,i,[M,L,D][i0]("|"))}})}return n.__ieDyn=1,n}(),$we=function(n,e,t,r){this.traceID=n||Hh(),this.parentID=e,n=dl(),!t&&n&&n.pathname&&(t=n.pathname),this.name=yo(r,t)};function TF(n){return!(typeof n!="string"||!n||n.match(/,|;|=| |\|/))}var Wwe=function(){function n(e,t,r){this.isNewUser=!1,this.isUserCookieSet=!1;var i,o=up(t),a=BR(t);xi(n,this,function(l){Or(l,"config",{g:function(){return e}});var h=so(e,function(){var x=e[bV]||"",x=(i=n.userCookieName+x,a.get(i)),x=(x&&(l[OE]=!1,0<(x=x.split(n[pv]))[NE])&&(l.id=x[0],l[nx]=!!l.id),l.id||(l.id=p(),_(g(l.id)[i0](n[pv])),x=(e[rk]||"")+"ai_session",_1e(o,x)),l[pf]=e[pf]||void 0,a.get(n[n2]));x&&((x=(x=decodeURI(x)).split(n[pv]))[0]&&(l[Kg]=x[0]),1<x[NE])&&x[1]&&(l[pf]=x[1])});function p(){var x=e||{};return(x[ik]||OR)(x[LE]?e[LE]:22)}function g(x){var C=oy(new Date);return l.accountAcquisitionDate=C,l[OE]=!0,[x,C]}function _(x){l[nx]=a.set(i,x,31536e3)}r&&r.add(h),l.setAuthenticatedUserContext=function(x,C,M){M===void 0&&(M=!1),!TF(x)||C&&!TF(C)?jt(o,2,60,"Setting auth user context failed. User auth/account id should be of type string, and not contain commas, semi-colons, equal signs, spaces, or vertical-bars.",!0):(l[Kg]=x,x=l[Kg],C&&(l[pf]=C,x=[l[Kg],l.accountId][i0](n[pv])),M&&a.set(n[n2],encodeURI(x)))},l.clearAuthenticatedUserContext=function(){l[Kg]=null,l[pf]=null,a.del(n[n2])},l[kE]=function(x){l.id===x&&l[nx]||_(g(x||p())[i0](n[pv]))}})}return n.cookieSeparator="|",n.userCookieName="ai_user",n.authUserCookieName="ai_authUser",n}(),mw="ext",yw="tags";function Rg(n,e){n&&n[e]&&du(n[e])[NE]===0&&delete n[e]}function SF(){return null}var Aa,r2,Xl,_w,gv,CF,vw,Ywe=function(){function n(e,t,r,i){var o=this,a=e.logger;xi(n,this,function(l){var h,p,g;l.appId=SF,l[rx]=SF,l.application=new Nwe,l.internal=new Bwe(t,i),CT()&&(l[RE]=new qwe(t,e,i),l.device=new Dwe,l.location=new Uwe,l.user=new Wwe(t,e,i),p=h=void 0,r&&(h=r.getTraceId(),p=r.getSpanId(),g=r.getName()),l[PP]=new $we(h,p,g,a),l.session=new wV),l[rx]=function(){var _=l.session;return _&&Pn(_.id)||(_=(l[RE]||{})[Yg])&&Pn(_.id)?_.id:null},l[dV]=function(_,x){si(Ia(_.ext,Ss.AppExt),"sesId",l[rx](),Pn)},l[yV]=function(_,x){si(_.ext,Ss.OSExt,l.os)},l[fV]=function(_,x){var C=l.application;C&&(si(_=Ia(_,yw),ci.applicationVersion,C.ver,Pn),si(_,ci.applicationBuild,C.build,Pn))},l[pV]=function(_,x){var C=l.device;C&&(si(_=Ia(Ia(_,mw),Ss.DeviceExt),"localId",C.id,Pn),si(_,"ip",C.ip,Pn),si(_,"model",C.model,Pn),si(_,"deviceClass",C.deviceClass,Pn))},l[vV]=function(_,x){var C,M=l.internal;M&&(si(C=Ia(_,yw),ci.internalAgentVersion,M.agentVersion,Pn),si(C,ci.internalSdkVersion,yo(a,M.sdkVersion,64),Pn),_.baseType!==j0.dataType&&_.baseType!==ed.dataType||(si(C,ci.internalSnippet,M.snippetVer,Pn),si(C,ci.internalSdkSrc,M.sdkSrc,Pn)))},l[_V]=function(_,x){var C=o.location;C&&si(Ia(_,yw,[]),ci.locationIp,C.ip,Pn)},l[gV]=function(_,x){var C=l[PP];C&&(si(_=Ia(Ia(_,mw),Ss.TraceExt,{traceID:void 0,parentID:void 0}),"traceID",C.traceID,Pn,bt),si(_,"name",C.name,Pn,bt),si(_,"parentID",C.parentID,Pn,bt))},l.applyWebContext=function(_,x){var C=o.web;C&&si(Ia(_,mw),Ss.WebExt,C)},l[mV]=function(_,x){var C=l.user;C&&(si(Ia(_,yw,[]),ci.userAccountId,C[pf],Pn),si(_=Ia(Ia(_,mw),Ss.UserExt),"id",C.id,Pn),si(_,"authId",C[Kg],Pn))},l.cleanUp=function(_,x){_=_.ext,_&&(Rg(_,Ss.DeviceExt),Rg(_,Ss.UserExt),Rg(_,Ss.WebExt),Rg(_,Ss.OSExt),Rg(_,Ss.AppExt),Rg(_,Ss.TraceExt))}})}return n.__ieDyn=1,n}(),kg=null,Kwe=vy(((Aa={})[pf]=kg,Aa.sessionRenewalMs=18e5,Aa.samplingPercentage=100,Aa.sessionExpirationMs=864e5,Aa.cookieDomain=kg,Aa.sdkExtension=kg,Aa.isBrowserLinkTrackingEnabled=!1,Aa.appId=kg,Aa[rx]=kg,Aa[rk]=r2,Aa[zwe]=r2,Aa[bV]=r2,Aa[LE]=22,Aa[ik]=kg,Aa)),Zwe=function(n){function e(){var t,r,i,o,a,l=n.call(this)||this;return l.priority=110,l.identifier=DT,xi(e,l,function(h,p){function g(){a=!(o=i=r=t=null)}g(),Or(h,"context",{g:function(){return o}}),h.initialize=function(_,x,C,M){var L,D,z;p.initialize(_,x,C,M),L=_,D=h.identifier,z=h.core,h._addHook(so(L,function(){var te=Oc(null,L,z);L.storagePrefix&&QR(L.storagePrefix),a=L.disableUserInitMessage!==!1,t=te.getExtCfg(D,Kwe),h._extConfig=t})),i=z[t2](!1),o=new Ywe(z,t,i,h._unloadHooks),r=KR(h.context[PP],i),z.setTraceCtx(r),h.context.appId=function(){var te=z.getPlugin(x9);return te?te.plugin._appId:null}},h.processTelemetry=function(_,x){var C,M,L,D;bt(_)||(x=h._getTelCtx(x),_.name===ed.envelopeType&&x.diagLog().resetInternalMessageCount(),(L=o||{}).session&&typeof o.session.id!="string"&&L[RE]&&L[RE][kE](),(C=L.user)&&!C[nx]&&C[kE](L.user.id),L=x,Ia(M=_,"tags",[]),Ia(M,"ext",{}),(D=h.context)[dV](M,L),D[fV](M,L),D[pV](M,L),D[gV](M,L),D[mV](M,L),D[yV](M,L),D.applyWebContext(M,L),D[_V](M,L),D[vV](M,L),D.cleanUp(M,L),C&&C[OE]&&(C[OE]=!1,a||(D=new j0(72,(Ol()||{}).userAgent||""),cbe(x.diagLog(),1,D))),h.processNext(_,x))},h._doTeardown=function(_,x){_=(_||{}).core(),_&&_[t2]&&_[t2](!1)===r&&_.setTraceCtx(i),g()}}),l}return Uu(e,n),e.__ieDyn=1,e}(Ey),Xwe=Zwe,xV="AuthenticatedUserContext",Ty="track",MP="snippet",Qwe="getCookieMgr",Jwe="startTrackPage",exe="stopTrackPage",i2="flush",txe="startTrackEvent",nxe="stopTrackEvent",rxe="addTelemetryInitializer",AF="pollInternalLogs",o2="getPlugin",a2="evtNamespace",ixe=Ty+"Event",oxe=Ty+"Trace",axe=Ty+"Metric",sxe=Ty+"PageView",cxe=Ty+"Exception",lxe=Ty+"DependencyData",uxe="set"+xV,hxe="clear"+xV,dxe="https://js.monitor.azure.com/scripts/b/ai.config.1.cfg.json",s2="version",Qd="queue",ix="connectionString",Nv="instrumentationKey",IF="instrumentationkey",ox="userOverrideEndpointUrl",ax="endpointUrl",PF="ingestionendpoint",mv="onunloadFlush",Zs="context",MF="addHousekeepingBeforeUnload",c2="sendMessage",fxe="updateSnippetDefinitions",RF=[MP,"dependencies","properties","_snippetVersion","appInsightsNew","getSKUDefaults"],EV="iKeyUsage",TV="CdnUsage",SV="SdkLoaderVer",bw=void 0,pxe={samplingRate:100,maxSendNumber:1},gxe={monthInterval:3,daysOfMonth:[28]},ww={disabled:!0,limit:rl(pxe),interval:rl(gxe)},mxe=((Xl={})[ix]=bw,Xl[ax]=bw,Xl[Nv]=bw,Xl[ox]=bw,Xl.diagnosticLogInterval=pE(yxe,1e4),Xl.featureOptIn=((_w={})[EV]={mode:3},_w[TV]={mode:2},_w[SV]={mode:2},_w),Xl.throttleMgrCfg=rl(((gv={})[109]=rl(ww),gv[106]=rl(ww),gv[111]=rl(ww),gv[110]=rl(ww),gv)),Xl.extensionConfig=rl(((CF={}).AppInsightsCfgSyncPlugin=rl({cfgUrl:dxe,syncMode:2}),CF)),Xl);function yxe(n){return n&&0<n}var _xe=function(){function n(e){var t,r,i,o,a,l,h,p,g,_,x,C,M,L,D=this;xi(n,this,function(z){le(),Or(z,"config",{g:function(){return p}}),on(["pluginVersionStringArr","pluginVersionString"],function(J){Or(z,J,{g:function(){return h?h[J]:null}})}),o=""+(e.sv||e[s2]||""),e[Qd]=e[Qd]||[],e[s2]=e[s2]||2;var te=hc(e.config||{},mxe);function le(){a=uc("AISKU"),x=o=i=r=t=l=null,L=M=C=!1,_=new rwe}function ce(){l&&(e1e(null,l),t1e(null,l))}function _e(J){h.addUnloadHook(J)}p=te.cfg,g=new K1e,Or(z,"appInsights",{g:function(){return g}}),r=new Xwe,t=new Lwe,i=new Ewe,h=new jbe,Or(z,"core",{g:function(){return h}}),_e(so(te,function(){var J,pe,ue=p[ix];function xe(){return Kv(function(je,ne){Mu(ue,function(Ee){var ke=Ee&&Ee.value,Be=null;!Ee.rejected&&ke&&(Be=$4(p[ix]=ke)),je(Be)})})}Yf(ue)&&(J=Kv(function(je,ne){xe().then(function(Ee){var ke=p[Nv],ke=Ee&&Ee[IF]||ke;je(ke)}).catch(function(Ee){je(null)})}),bt(pe=p[ox])&&(pe=Kv(function(je,ne){xe().then(function(Be){var ke=p[ax],Be=Be&&Be[PF];je(Be?Be+Mm:ke)}).catch(function(Ee){je(null)})})),p[Nv]=J,p[ax]=pe),Pn(ue)&&(pe=(J=$4(ue))[PF],p.endpointUrl=p[ox]||pe+Mm,p[Nv]=J[IF]||p[Nv]),p.endpointUrl=p[ox]||p[ax]})),z[MP]=e,z[i2]=function(J,pe){var ue;return _E(h,function(){return"AISKU.flush"},function(){J&&!pe&&(ue=Ru(function(ne){pe=ne}));function xe(){--je===0&&pe()}var je=1;on(h.getChannels(),function(ne){ne&&(je++,ne[i2](J,xe))}),xe()},null,J=J===void 0?!0:J),ue},z[mv]=function(J){J===void 0&&(J=!0),on(h.getChannels(),function(pe){pe[mv]?pe[mv]():pe[i2](J)})},z.loadAppInsights=function(J,pe,ue){return(J=J===void 0?!1:J)&&yve("Legacy Mode is no longer supported"),_E(z.core,function(){return"AISKU.loadAppInsights"},function(){h.initialize(p,[i,r,t,g,_],pe,ue),Or(z,"context",{g:function(){return r[Zs]}}),x=x||new b1e(h);var xe,je=vxe();je&&z[Zs]&&(z[Zs].internal.sdkSrc=je),(xe=z[MP])&&(je="",bt(o)||(je+=o),z[Zs]&&z[Zs].internal&&(z[Zs].internal.snippetVer=je||"-"),fr(z,function(ne,Ee){Pn(ne)&&!$n(Ee)&&ne&&ne[0]!=="_"&&_a(RF,ne)===-1&&xe[ne]!==Ee&&(xe[ne]=Ee)})),z.emptyQueue(),z[AF](),z[MF](z),_e(so(te,function(){var ne=!1;p.throttleMgrCfg[109]&&(ne=!p.throttleMgrCfg[109].disabled),!x.isReady()&&p.extensionConfig&&p.extensionConfig[_.identifier]&&ne&&x.onReadyState(!0),C||p[ix]||!sA(EV,p)||(x[c2](106,"See Instrumentation key support at aka.ms/IkeyMigrate"),C=!0),!M&&z[Zs].internal.sdkSrc&&z[Zs].internal.sdkSrc.indexOf("az416426")!=-1&&sA(TV,p)&&(x[c2](110,"See Cdn support notice at aka.ms/JsActiveCdn"),M=!0),!L&&parseInt(o)<6&&sA(SV,p)&&(x[c2](111,"An updated Sdk Loader is available, see aka.ms/SnippetVer"),L=!0)}))}),z},z[fxe]=function(J){u0e(J,z,function(pe){return pe&&_a(RF,pe)===-1})},z.emptyQueue=function(){try{if(dr(z.snippet[Qd])){for(var J=z.snippet[Qd].length,pe=0;pe<J;pe++)(0,z.snippet[Qd][pe])();z.snippet[Qd]=void 0,delete z.snippet[Qd]}}catch(ue){ue&&$n(ue.toString)&&ue.toString()}},z[MF]=function(J){var pe,ue;(CT()||Qz())&&(ue=!(pe=function(){var xe;J[mv](!1),$n(z.core[o2])&&(xe=D.core[o2](DT))&&(xe=xe.plugin)&&xe[Zs]&&xe[Zs]._sessionManager&&xe[Zs]._sessionManager.backup()}),l=l||md(a,h[a2]&&h[a2]()),_e(so(p,function(ne){var ne=ne.cfg,je=J.appInsights,je=Oc(null,ne,je.core).getExtCfg(je.identifier||E9),ne=(ce(),ne.disablePageUnloadEvents);je.disableFlushOnBeforeUnload||(Jbe(pe,ne,l)&&(ue=!0),ue=!!KI(pe,ne,l)||ue)||P0e()||jt(h.logger,1,19,"Could not add handler for beforeunload and pagehide"),ue||je.disableFlushOnUnload||KI(pe,ne,l)})))},z.getSender=function(){return i},z.unload=function(J,pe,ue){var xe,je=!1;return J&&!pe&&(xe=Ru(function(ne){pe=ne})),z[mv](J),ce(),h.unload&&h.unload(J,function(ne){je||(je=!0,le(),pe&&pe(ne))},ue),xe},Av(z,g,[Qwe,ixe,sxe,"trackPageViewPerformance",cxe,"_onerror",oxe,axe,Jwe,exe,txe,nxe]),Av(z,function(){return t},[lxe,"addDependencyListener","addDependencyInitializer"]),Av(z,h,[rxe,AF,"stopPollingInternalLogs",o2,"addPlugin",a2,"addUnloadCb","getTraceCtx","updateCfg","onCfgChange"]),Av(z,function(){var J=r[Zs];return J?J.user:null},[uxe,hxe])})}return n.prototype.addDependencyInitializer=function(e){return null},n}();function vxe(){if(!vw){var n=null;try{var e=(document||{}).currentScript;e&&(n=e.src)}catch{}if(n){try{var t,r=n.toLowerCase();r&&(t="",on(["://js.monitor.azure.com/","://az416426.vo.msecnd.net/"],function(i,o){if(is(r,i)!==-1)return t="cdn"+(o+1),is(r,"/scripts/")===-1&&(is(r,"/next/")!==-1?t+="-next":is(r,"/beta/")!==-1&&(t+="-beta")),vw=t+"",-1}))}catch{}vw=n}}return vw}var Og,bxe=function(){function n(e){this.options=e,!this.options.disableTelemetry&&Rc.appInsightsKey&&(this.appInsights=new _xe({config:{instrumentationKey:Rc.appInsightsKey,disableExceptionTracking:!0,disableAjaxTracking:!0,isCookieUseDisabled:!0,maxBatchInterval:5e3}}),this.appInsights.loadAppInsights(),this.appInsights.addTelemetryInitializer(function(t){t.tags[ci.applicationVersion]=lT.getFullVersion()}))}return n.prototype.trackEvent=function(e,t){!this.options.disableTelemetry&&this.appInsights&&this.appInsights.trackEvent(e,t)},n.prototype.setAuthenticatedUserContext=function(e,t){!this.options.disableTelemetry&&this.appInsights&&this.appInsights.setAuthenticatedUserContext(e,t)},n.prototype.trackException=function(e){!this.options.disableTelemetry&&this.appInsights&&this.appInsights.trackException(e)},n.prototype.flush=function(e){!this.options.disableTelemetry&&this.appInsights&&this.appInsights.flush(e)},n}(),wxe=window&&window.__extends||function(){var n=function(e,t){return(n=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(r,i){r.__proto__=i}:function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])}))(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),kF=function(n){function e(){var t=n!==null&&n.apply(this,arguments)||this;return t.copyrightMessage=void 0,t.copyrightContent=void 0,t.customAttribution=void 0,t.showFeedbackLink=!0,t.showLogo=!0,t}return wxe(e,n),e}(wi),xxe=window&&window.__extends||function(){var n=function(e,t){return(n=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(r,i){r.__proto__=i}:function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])}))(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),Exe=function(n){function e(t){var r=n.call(this)||this;return r.textAttribution=function(i){return[r.options.copyrightMessage,r.options.customAttribution].filter(function(o){return o}).join("")},r.updateFeedbackLink=function(){var i,o;r.feedbackAnchor&&r.map&&(i=(o=r.map.getCamera()).center,o=o.zoom,r.feedbackAnchor.href="".concat(e.feedbackLink,"&cp=").concat(i[1],"~").concat(i[0],"&lvl=").concat(o+1))},r.options=new kF().merge(t),r}return xxe(e,n),e.prototype.onAdd=function(t){return this.map=t,this.container=this.buildContainer(t,Jo.auto),this.container.className="map-copyright without-bg",this.copyrightDiv=this.buildCopyrightDiv(),this.copyrightDiv.className="azure-map-copyright",this.container.appendChild(this.copyrightDiv),this.options.showFeedbackLink&&this.addRemoveFeedbackDiv(!0),this.container},e.prototype.onRemove=function(){n.prototype.onRemove.call(this),delete this.container},e.prototype.setOptions=function(o){var r,i=this,o=new kF().merge(this.options,o);o.copyrightMessage===this.options.copyrightMessage&&o.customAttribution===this.options.customAttribution||(this.copyrightDiv.innerText=this.textAttribution(o)),o.copyrightContent!==this.options.copyrightContent&&(this.options.copyrightContent&&(r=Array.from(this.copyrightDiv.children).find(function(a){return a===i.options.copyrightContent}),this.copyrightDiv.removeChild(r)),0<this.copyrightDiv.childNodes.length?this.copyrightDiv.insertBefore(o.copyrightContent,this.copyrightDiv.childNodes[0]):this.copyrightDiv.appendChild(o.copyrightContent),this.options.copyrightContent=o.copyrightContent),!o.showFeedbackLink&&this.feedbackAnchor?this.addRemoveFeedbackDiv(!1):o.showFeedbackLink&&!this.feedbackAnchor&&this.addRemoveFeedbackDiv(!0),this.options=o},e.prototype.getDefaultAttributions=function(){var t=new Date().getFullYear(),r=["".concat(t," TomTom")];return this.options.showLogo||r.push("".concat(t," Microsoft")),r},e.prototype.buildCopyrightDiv=function(){var t=document.createElement("div");return t.innerText=this.textAttribution(this.options)||"",t},e.prototype.buildFeedbackLink=function(){var t=document.createElement("a");return t.setAttribute("alt","Provide Map Data Feedback"),t.setAttribute("aria-label","Provide Map Data Feedback"),t.innerText="Feedback",t.href=e.feedbackLink,t.target="_blank",t.rel="noopener",t.className="azure-map-feedback-text",t},e.prototype.addRemoveFeedbackDiv=function(t){t?(this.feedbackAnchor=this.buildFeedbackLink(),this.feedbackTooltip=ea("Provide Map Data Feedback"),this.container.appendChild(this.feedbackAnchor),this.container.appendChild(this.feedbackTooltip),Li(this.feedbackTooltip,this.feedbackAnchor),(t=(t=this.map)==null?void 0:t.events)!=null&&t.add("moveend",this.updateFeedbackLink)):(this.feedbackAnchor.remove(),this.feedbackTooltip.remove(),delete this.feedbackTooltip,delete this.feedbackAnchor,(t=(t=this.map)==null?void 0:t.events)!=null&&t.remove("moveend",this.updateFeedbackLink))},e.feedbackLink="https://aka.ms/azuremaps-feedback?feedbackep=UrlAzureMapsWebSdk",e}(sc),Txe=window&&window.__extends||function(){var n=function(e,t){return(n=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(r,i){r.__proto__=i}:function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])}))(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),OF=function(n){function e(){var t=n!==null&&n.apply(this,arguments)||this;return t.showLogo=!0,t}return Txe(e,n),e}(wi),Sxe=window&&window.__extends||function(){var n=function(e,t){return(n=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(r,i){r.__proto__=i}:function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])}))(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),Cxe=function(n){function e(t){var r=n.call(this)||this;return r.map=null,r._onResize=function(){var i=((i=(i=r.map)==null?void 0:i.getMapContainer())==null?void 0:i.clientWidth)||0;r._setVisiblity(r.options.showLogo&&e.CONTAINER_MIN_WIDTH<=i)},r.options=new OF().merge(t),r}return Sxe(e,n),e.prototype.onAdd=function(t){return this.map=t,this.container=this.buildContainer(t,Jo.auto),this.container.className="map-logo-control",(t=this.map)!=null&&t.events.add("resize",this._onResize),this._addRemoveLogo(this.options.showLogo),this.container},e.prototype.onRemove=function(){var t;n.prototype.onRemove.call(this),(t=this.map)!=null&&t.events.remove("resize",this._onResize),this.map=null,delete this.container},e.prototype.setOptions=function(t){t=new OF().merge(this.options,t),!t.showLogo&&this.logoAnchor?this._addRemoveLogo(!1):t.showLogo&&!this.logoAnchor&&this._addRemoveLogo(!0),this.options=t},e.prototype._addRemoveLogo=function(t){t?(this.logoAnchor=document.createElement("a"),this.logoAnchor.className="azure-map-logo",this.logoAnchor.href="https://aka.ms/azuremaps",this.logoAnchor.setAttribute("aria-label","Visit azure.microsoft.com"),this.logoAnchor.setAttribute("target","_blank"),this.container.appendChild(this.logoAnchor),this.logoTooltip=ea("Visit azure.microsoft.com"),this.container.appendChild(this.logoTooltip),Li(this.logoTooltip,this.logoAnchor),this._setVisiblity(!0)):((t=this.logoAnchor)!=null&&t.remove(),(t=this.logoTooltip)!=null&&t.remove(),delete this.logoAnchor,this._setVisiblity(!1))},e.prototype._setVisiblity=function(t){this.container&&(this.container.style.display=t?"flex":"none")},e.CONTAINER_MIN_WIDTH=480,e}(sc),Axe=function(){function n(){}return n.throwOnError=function(o,t){function r(a){throw i.off("error",r),a.error}var i=o instanceof HV?o._getMap():o,o=(i.on("error",r),t());return i.off("error",r),o},n.tryCatch=function(e,t,r,i){try{return this.throwOnError(e,t)}catch(o){return r(o)}finally{typeof i=="function"&&i()}},n.tryFinally=function(e,t,r){try{return this.throwOnError(e,t)}finally{r()}},n}(),CV=window&&window.__assign||function(){return(CV=Object.assign||function(n){for(var e,t=1,r=arguments.length;t<r;t++)for(var i in e=arguments[t])Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i]);return n}).apply(this,arguments)},Ixe=function(){function n(e){this.map=e}return n.prototype.request=function(r){var t,r={domain:this.map.getServiceOptions().domain,path:"reverseGeocode",queryParams:CV({"api-version":"2023-06-01",coordinates:"".concat($i(r.position[0]),",").concat(ho(r.position[1]))},r.style.view&&{view:r.style.view}),headers:{"Accept-Language":r.style.language}};return new vl(((t=this.map.authentication)==null?void 0:t.signRequest(r))||r).get()},n}(),Pxe=function(){function n(){this._labelCache={},this._labelIdx={},this._preloadedCache=new Set}return n.prototype.cache=function(e,t,r,i){i="".concat(e,"_").concat(r[0],"_").concat(r[1],"_").concat(i),this._labelIdx[t.labelType]||(this._labelIdx[t.labelType]=[],this._labelCache[t.labelType]=[]),this._labelIdx[t.labelType].indexOf(i)===-1&&(this._labelCache[t.labelType].push({name:e,radius:t.radius,minZoom:t.minZoom,maxZoom:t.maxZoom||24,position:r}),this._labelIdx[t.labelType].push(i))},n.prototype.getNearestLabel=function(e,t,r){var i=null,o=this._labelCache[e];if(o)for(var a,l=1/0,h=0,p=o.length;h<p;h++)r>=o[h].minZoom&&r<=o[h].maxZoom&&(a=ss(o[h].position,t))<=o[h].radius&&a<=l&&(l=a,i=o[h]);return i},n.prototype._preloadCache=function(e){if(!this._preloadedCache.has(e)){this._preloadedCache.add(e);var t={source:[],labelType:"water",minZoom:0,radius:395e4,polygonSources:[]},r=e,i=r.indexOf("-");switch(r=i!==-1?r.substr(0,i):r){case"fr":this.cache("Ocan Pacifique",t,[-170,32],e),this.cache("Ocan Pacifique",t,[-138,-27],e),this.cache("Ocan Atlantique",t,[-40,32],e),this.cache("Ocan Atlantique",t,[-17,-29],e);break;case"es":this.cache("Ocan Pacifique",t,[-170,32],e),this.cache("Ocan Pacifique",t,[-138,-27],e),this.cache("Ocano Atlntico",t,[-40,32],e),this.cache("Ocano Atlntico",t,[-17,-29],e);break;case"pt":this.cache("Oceano Pacfico",t,[-170,32],e),this.cache("Oceano Pacfico",t,[-138,-27],e),this.cache("Oceano Atlntico",t,[-40,32],e),this.cache("Oceano Atlntico",t,[-17,-29],e);break;case"ja":this.cache("",t,[-170,32],e),this.cache("",t,[-138,-27],e);break;case"en":this.cache("Pacific Ocean",t,[-170,32],e),this.cache("Pacific Ocean",t,[-138,-27],e),this.cache("Atlantic Ocean",t,[-40,32],e),this.cache("Atlantic Ocean",t,[-17,-29],e),this.cache("Indian Ocean",t,[77,-26],e)}}},n}(),yv=window&&window.__awaiter||function(n,e,t,r){return new(t=t||Promise)(function(i,o){function a(p){try{h(r.next(p))}catch(g){o(g)}}function l(p){try{h(r.throw(p))}catch(g){o(g)}}function h(p){var g;p.done?i(p.value):((g=p.value)instanceof t?g:new t(function(_){_(g)})).then(a,l)}h((r=r.apply(n,e||[])).next())})},_v=window&&window.__generator||function(n,e){var t,r,i,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]},a={next:l(0),throw:l(1),return:l(2)};return typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function l(h){return function(p){var g=[h,p];if(t)throw new TypeError("Generator is already executing.");for(;o=a&&g[a=0]?0:o;)try{if(t=1,r&&(i=2&g[0]?r.return:g[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,g[1])).done)return i;switch(r=0,(g=i?[2&g[0],i.value]:g)[0]){case 0:case 1:i=g;break;case 4:return o.label++,{value:g[1],done:!1};case 5:o.label++,r=g[1],g=[0];continue;case 7:g=o.ops.pop(),o.trys.pop();continue;default:if(!(i=0<(i=o.trys).length&&i[i.length-1])&&(g[0]===6||g[0]===2)){o=0;continue}if(g[0]===3&&(!i||g[1]>i[0]&&g[1]<i[3]))o.label=g[1];else if(g[0]===6&&o.label<i[1])o.label=i[1],i=g;else{if(!(i&&o.label<i[2])){i[2]&&o.ops.pop(),o.trys.pop();continue}o.label=i[2],o.ops.push(g)}}g=e.call(n,o)}catch(_){g=[6,_],r=0}finally{t=i=0}if(5&g[0])throw g[1];return{value:g[0]?g[1]:void 0,done:!0}}}},LF=window&&window.__read||function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var r,i,o=t.call(n),a=[];try{for(;(e===void 0||0<e--)&&!(r=o.next()).done;)a.push(r.value)}catch(l){i={error:l}}finally{try{r&&!r.done&&(t=o.return)&&t.call(o)}finally{if(i)throw i.error}}return a},Mxe=window&&window.__spreadArray||function(n,e,t){if(t||arguments.length===2)for(var r,i=0,o=e.length;i<o;i++)!r&&i in e||((r=r||Array.prototype.slice.call(e,0,i))[i]=e[i]);return n.concat(r||Array.prototype.slice.call(e))},Rxe=function(){function n(e,t){var r=this;this._disposed=!1,this._lastHeadingTime=0,this._actionQueue=[],this._pointerUpdateDelay=3e3,this._camUpdateDelay=1e3,this._headUpdateLimit=1e3,this._controlEventDelay=500,this._moveThreshold=25,this._headingThreshold=5,this._pitchThreshold=5,this._roadPixelRadius=120,this._minRoadDistance=25,this._minIntersectionPixelDistance=50,this._labelConfig=[{source:["Ocean label","Ocean name"],labelType:"water",minZoom:0,radius:395e4,polygonSources:["Ocean","Ocean or sea"]},{source:["Sea label"],labelType:"water",minZoom:3,radius:1e6,polygonSources:["Sea","Ocean or sea"]},{source:["Country name"],labelType:"country",minZoom:0,maxZoom:5,radius:3e5},{source:["State name","State name short"],labelType:"state",minZoom:4,maxZoom:7,radius:3e5},{source:["Capital city","Large city"],labelType:"city",minZoom:8,radius:4e4},{source:["Medium city"],labelType:"city",minZoom:8,radius:3e4},{source:["Small city"],labelType:"city",minZoom:8,radius:2e4},{source:["Island label"],labelType:"city",minZoom:8,radius:1e4},{source:["Town"],labelType:"city",minZoom:10,radius:1e4},{source:["Village"],labelType:"neighbourhood",minZoom:12,radius:6e3},{source:["Amusement area label"],labelType:"poi",minZoom:14,radius:2e3,polygonSources:["Amusement park"]},{source:["Hospital label"],labelType:"poi",minZoom:14,radius:1e3,polygonSources:["Hospital"]},{source:["Shopping centre label"],labelType:"poi",minZoom:14,radius:1e3,polygonSources:["Shopping"]},{source:["Stadium label"],labelType:"poi",minZoom:14,radius:1e3,polygonSources:["Stadium"]},{source:["University/School label"],labelType:"poi",minZoom:14,radius:1e3,polygonSources:["University"]},{source:["Zoo label"],labelType:"poi",minZoom:14,radius:1e3,polygonSources:["Zoo"]},{source:["Airport Label","Airport name","Airport POI"],labelType:"majorPoi",minZoom:11,radius:3e3,polygonSources:["Airport","Runway"]},{source:["National park label"],labelType:"majorPoi",minZoom:7,radius:15e3,polygonSources:["National or state park","National park","Forest"]},{source:["Reservation label"],labelType:"majorPoi",minZoom:7,radius:15e3,polygonSources:["Reservation"]}],this._labelCache=new Set(["city","state","country","water","majorPoi"]),this._roadLayers=new Set(["Connecting road","Connecting road tunnel","International road","International road tunnel","Local road","Local road tunnel","Major local road","Major local road tunnel","Major road","Major road tunnel","Minor local road","Minor local road tunnel","Motorway","Motorway tunnel","Secondary road","Secondary road tunnel","Toll connecting road","Toll connecting road tunnel","Toll international road","Toll international road tunnel","Toll local road","Toll local road tunnel","Toll major local road","Toll major local road tunnel","Toll major road","Toll major road tunnel","Toll minor local road","Toll minor local road tunnel","Toll motorway","Toll motorway tunnel","Toll secondary road","Toll secondary road tunnel"]),this._returnDetailedDescriptions=!1,this._shortcutListener=function(i){return yv(r,void 0,void 0,function(){var o,a,l;return _v(this,function(h){switch(h.label){case 0:return i.altKey&&i.ctrlKey&&i.keyCode===68?(this._returnDetailedDescriptions=!this._returnDetailedDescriptions,l=this._map.getCamera(),a=this._map.getStyle(),o=a.language.toLowerCase(),a=a.style.toLowerCase(),[4,this._getLocDesc(l,o,a)]):[3,2];case 1:l=h.sent(),this._descCallback(l),h.label=2;case 2:return[2]}})})},this._onRotate=function(){r._rotateTimeout||(Date.now()-r._lastHeadingTime>=r._headUpdateLimit?r._rotateTimeout=setTimeout(r._updateHeading,L8.RotationDuration+25):r._rotateTimeout=setTimeout(r._updateHeading,r._headUpdateLimit-(Date.now()-r._lastHeadingTime)))},this._onMove=function(){r._moveTimeout&&(clearTimeout(r._moveTimeout),delete r._moveTimeout),r._controlTimeout&&(clearTimeout(r._controlTimeout),delete r._controlTimeout)},this._onMoveEnd=function(i){i.fromControl?r._controlTimeout=setTimeout(r._updateCam,r._controlEventDelay):r._updateCam()},this._onStyleData=function(){setTimeout(r._updateStyle)},this._onPointerDown=function(i){r._lastPointerPos=r._getEventPos(i),r._pointerTimeout=setTimeout(function(){return yv(r,void 0,void 0,function(){var o,a,l;return _v(this,function(h){switch(h.label){case 0:return a=this._map.getStyle(),o=a.language.toLowerCase(),a=a.style.toLowerCase(),(l=this._map.getCamera()).center=this._map.pixelsToPositions([this._lastPointerPos])[0],[4,this._getLocDesc(l,o,a)];case 1:return l=h.sent(),this._descCallback(l),this._onPointerUp(),[2]}})})},r._pointerUpdateDelay),r._map.getCanvas().addEventListener("mousemove",r._onPointerMove),r._map.getCanvas().addEventListener("touchmove",r._onPointerMove),r._map.getCanvas().addEventListener("mouseup",r._onPointerUp),r._map.getCanvas().addEventListener("touchend",r._onPointerUp)},this._onPointerMove=function(a){var a=r._getEventPos(a),o=r._lastPointerPos[0]-a[0],a=r._lastPointerPos[1]-a[1];Math.sqrt(o*o+a*a)>r._moveThreshold&&r._onPointerUp()},this._onPointerUp=function(){clearTimeout(r._pointerTimeout),delete r._pointerTimeout,r._map.getCanvas().removeEventListener("mousemove",r._onPointerMove),r._map.getCanvas().removeEventListener("touchmove",r._onPointerMove),r._map.getCanvas().removeEventListener("mouseup",r._onPointerUp),r._map.getCanvas().removeEventListener("touchend",r._onPointerUp)},this._updateHeading=function(){var i,o=r._map.getCamera();r._lastHead&&!r._checkHeadingThreshold(o.bearing,r._lastHead)||(i=r._getHeadingDesc(o),r._lastHead=o.bearing,r._descCallback("<p>Map heading ".concat(i,".</p>")),r._lastHeadingTime=Date.now()),delete r._rotateTimeout},this._updateStyle=function(){return yv(r,void 0,void 0,function(){var i,o,a,l;return _v(this,function(h){switch(h.label){case 0:return i=this._map.getCamera(),a=this._map.getStyle(),o=a.language.toLowerCase(),a=a.style.toLowerCase(),this._lastLang===o?[3,2]:(n._labelCache._preloadCache(o),[4,this._getLocDesc(i,o,a)]);case 1:return l=h.sent(),[3,4];case 2:return this._lastStyle===a||this._lastStyle!=="blank"?[3,4]:[4,this._getLocDesc(i,o,a)];case 3:l=h.sent(),h.label=4;case 4:return this._lastLang=o,this._lastStyle=a,l&&this._descCallback(l),[2]}})})},this._updateCam=function(i){i===void 0&&(i=!1);var o,a,l,h=r._map.getCamera();(!r._lastCam||0<r._actionQueue.length||r._checkThresholds(h,r._lastCam))&&(l=r._map.getStyle(),o=l.language.toLowerCase(),a=l.style.toLowerCase(),(l=r._getActionDesc(h))&&r._actionQueue.push(l),r._lastCam=h,r._moveTimeout&&(clearTimeout(r._moveTimeout),delete r._moveTimeout),r._moveTimeout=setTimeout(function(){return yv(r,void 0,void 0,function(){var p;return _v(this,function(g){switch(g.label){case 0:return clearTimeout(this._rotateTimeout),delete this._rotateTimeout,[4,this._getLocDesc(h,o,a)];case 1:return p=g.sent(),0<this._actionQueue.length?(this._descCallback("<p>Map ".concat(this._actionQueue.join(", then "),".</p>").concat(p)),this._actionQueue=[]):this._descCallback(p),[2]}})})},i?0:r._camUpdateDelay))},this._map=e,this._restFallback=e.getServiceOptions().enableAccessibilityLocationFallback,this._descCallback=t,this._reverseSearch=new Ixe(e),n._labelCache||(n._labelCache=new Pxe),this._lastLang=this._map.getStyle().language.toLowerCase(),n._labelCache._preloadCache(this._lastLang),this._map.events.addOnce("idle",function(){var i;r._disposed||(r._updateCam(!0),r._baseVectorTileSourceId=n._baseVectorTileSourceIds.find(function(o){return r._map.sources.getById(o)}),r._baseVectorTileSourceId==="bing-mvt"&&(r._labelConfig=n._labelConfigBing,r._roadLayers=n._roadLayersBing),r._polygonStyleLayer=r._labelConfig.reduce(function(o,a){return a.polygonSources&&o.push.apply(o,Mxe([],LF(a.polygonSources),!1)),o},[]),(i=r._map._getMap()).on("move",r._onMove),i.on("moveend",r._onMoveEnd),i.on("styledata",r._onStyleData),i.on("rotate",r._onRotate),(i=r._map.getCanvas()).addEventListener("mousedown",r._onPointerDown),i.addEventListener("touchstart",r._onPointerDown))}),this._map.getMapContainer().addEventListener("keydown",this._shortcutListener)}return n.prototype.dispose=function(){this._disposed=!0;var e=this._map._getMap(),e=(e.off("move",this._onMove),e.off("moveend",this._onMoveEnd),e.off("styledata",this._onStyleData),e.off("rotate",this._onRotate),this._map.getCanvas());e.removeEventListener("mousedown",this._onPointerDown),e.removeEventListener("touchstart",this._onPointerDown),this._map.getMapContainer().removeEventListener("keydown",this._shortcutListener)},n.prototype._getEventPos=function(e){var t,r;return"touches"in e?(t=e.touches[0],r=e.target.getBoundingClientRect(),[t.pageX-r.left,t.pageY-r.top]):[e.offsetX,e.offsetY]},n.prototype._checkThresholds=function(e,t){return this._checkZoomThreshold(e.zoom,t.zoom)||this._checkPitchThreshold(e.pitch,t.pitch)||this._checkLocThreshold(e.center,t.center)||this._checkHeadingThreshold(e.bearing,t.bearing)},n.prototype._checkZoomThreshold=function(e,t){return this._round(e)!==this._round(t)},n.prototype._checkPitchThreshold=function(e,t){return Math.abs(e-t)>=this._pitchThreshold},n.prototype._checkLocThreshold=function(e,t){return e=(t=LF(this._map.positionsToPixels([t,e]),2))[0],t=t[1],ta.getDistance(e,t)>=this._moveThreshold},n.prototype._checkHeadingThreshold=function(e,t){return e<0&&(e+=360),t<0&&(t+=360),e=Math.abs(e-t),(e=180<e?360-e:e)>=this._headingThreshold},n.prototype._getLocDesc=function(e,t,r){return yv(this,void 0,void 0,function(){var i,o,a,l,h,p,g,_,x,C=this;return _v(this,function(M){switch(M.label){case 0:return r==="blank"?[3,3]:this._map._getMap().loaded()?[3,2]:[4,new Promise(function(L){return C._map._getMap().once("idle",L)})];case 1:M.sent(),M.label=2;case 2:for(i={},o=this._map.positionsToPixels([e.center])[0],Axe.tryCatch(this._map,function(){var L=C._map._getMap();a=L.queryRenderedFeatures(o,{layers:C._polygonStyleLayer.filter(function(D){return L.getLayer(D)}),filter:["==",["geometry-type"],"Polygon"]})},function(){}),l=null,a&&0<a.length&&(l=a[0]),h=null,p=0,g=this._labelConfig.length;p<g;p++)_=this._labelConfig[p],e.zoom>=_.minZoom?_.polygonSources?l&&_.polygonSources.indexOf(l.layer["source-layer"])!==-1?(h=_.labelType,this._getClosestLabel(_,e,t,i,!1)):this._getClosestLabel(_,e,t,i,!0):this._getClosestLabel(_,e,t,i,!1):this._getClosestLabel(_,e,t,i,!0);return 8<=e.zoom&&this._processRoads(i,e,t),this._labelCache.forEach(function(L){!i[L]&&(x=null,x=L!=="water"&&L!=="majorPoi"||L===h?n._labelCache.getNearestLabel(L,e.center,e.zoom):x)&&(i[L]=x.name)}),[2,this._processLocInfo(e,h,i,!0,this._restFallback)];case 3:return[2,this._processLocInfo(e,null,null,!1,!1)]}})})},n.prototype._getHeadingDesc=function(e){var t=e.bearing;switch(t<0&&(t+=360),t=this._round(t,this._headingThreshold)){case 0:case 360:return"north";case 45:return"north east";case 90:return"east";case 135:return"south east";case 180:return"south";case 225:return"south west";case 270:return"west";case 315:return"north west";default:return"".concat(t," degrees")}},n.prototype._getClosestLabel=function(e,t,r,i,o){for(var a=e.radius,l=0,h=e.source.length;l<h;l++){var p={sourceLayer:e.source[l],filter:["has","name"]},g=this._map._getMap().querySourceFeatures(this._baseVectorTileSourceId,p),_=null,x=1/0,C=this._labelCache.has(e.labelType);if(!o||C)for(var M=0,L=g.length;M<L;M++){var D,z=g[M].geometry.type==="Point"?g[M]:Bx(t.center,g[M].geometry);o||(D=g[M].geometry.type==="Point"?ss(t.center,z.geometry.coordinates):z.properties.distance)<x&&(x=D,_=g[M]),C&&n._labelCache.cache(g[M].properties.name,e,z.geometry.coordinates,r)}o||(p=e.labelType+"Dis",_&&x<=a&&(typeof i[p]!="number"||x<=i[p])&&(i[e.labelType]=_.properties.name,i[p]=x))}},n.prototype._processRoads=function(e,t,r,i){var o=this._map._getMap().queryRenderedFeatures(i,{filter:["==",["geometry-type"],"LineString"]});if(o){for(var a,l=void 0,h=void 0,p=void 0,g=void 0,_=0,x=o.length;_<x;_++)this._roadLayers.has(o[_].layer["source-layer"])&&o[_].properties.name&&o[_].properties.name!==""&&(a=Bx(t.center,o[_]),!p||a.properties.distance<p.properties.distance)&&(l&&o[_].properties.name===l.properties.name?p=a:l&&o[_].properties.name===l.properties.name?(!g||a.properties.distance<g.properties.distance)&&(g=a,h=o[_]):(g=p,h=l,p=a,l=o[_]));l&&(!e.country&&l.properties.country_code&&(e.country=l.properties.country_code,e.countryDis=0,n._labelCache.cache(e.country,{source:[],labelType:"country",radius:5e3,minZoom:0},p.geometry.coordinates,r)),!e.state&&l.properties.country_subdivision&&(e.state=l.properties.country_subdivision,e.stateDis=0,n._labelCache.cache(e.state,{source:[],labelType:"state",radius:5e3,minZoom:4},p.geometry.coordinates,r)),15<=t.zoom)&&(i=this._map.positionsToPixels([t.center,p.geometry.coordinates]),(ta.getDistance(i[0],i[1])<this._roadPixelRadius||p.properties.distance<this._minRoadDistance)&&(e.road=l.properties.name),h)&&(r=this._map.positionsToPixels([g.geometry.coordinates]),ta.getDistance(i[0],r[0])<this._minIntersectionPixelDistance||g.properties.distance<this._minRoadDistance)&&(e.secondRoad=h.properties.name,e.secondRoadDis=g.properties.distance)}},n.prototype._getActionDesc=function(e){var t,r,i;return this._lastCam&&(t=[],this._checkLocThreshold(e.center,this._lastCam.center)&&(i=["panned"],(r=Math.round(Yh(this._lastCam.center,e.center)))===0||r===360?i.push("north"):r<90?i.push("north east"):r===90?i.push("east"):r<180?i.push("south east"):r===180?i.push("south"):r<270?i.push("south west"):r===270?i.push("west"):r<360&&i.push("north west"),r=ss(this._lastCam.center,e.center,Cr.meters),i.push(1e3<r?"".concat(ns(r/1e3,2)," kilometers"):"".concat(ns(r,2)," meters")),t.push(i.join(" "))),this._checkZoomThreshold(e.zoom,this._lastCam.zoom)&&((i=["zoomed"]).push(this._lastCam.zoom<e.zoom?"in":"out"),1<=(r=Math.abs(this._lastCam.zoom-e.zoom))&&(r=Math.ceil(r),i.push("".concat(r,1<r?" levels":" level"))),this._getCanonicalZoom(this._lastCam.zoom)!==this._getCanonicalZoom(e.zoom)&&i.push("to ".concat(this._getCanonicalZoom(e.zoom)," level")),e.zoom>=e.maxZoom&&i.push("Zoom In button disabled, maximum zoom level reached"),r=lr.getSouth(e.bounds)<=-k0&&lr.getNorth(e.bounds)>=k0,(e.zoom<=e.minZoom||r)&&i.push("Zoom Out button disabled, minimum zoom level reached"),t.push(i.join(" "))),this._checkPitchThreshold(e.pitch,this._lastCam.pitch)&&(r=this._round(e.pitch,this._pitchThreshold),t.push("pitched to ".concat(r," degrees")),e.pitch!==60&&e.pitch!==0||(i=e.pitch===60?"maximum":"minimum",t.push("reached ".concat(i," of ").concat(e.pitch," degrees")))),this._checkHeadingThreshold(this._lastCam.bearing,e.bearing)&&t.push("rotated to ".concat(this._getHeadingDesc(e))),t.join(" and "))||null},n.prototype._getCanonicalZoom=function(e){return(e=this._round(e))<2?"world":e<5?"country":e<11?"state province":e<15?"city":"street"},n.prototype._processLocInfo=function(e,t,r,i,o){var a=this;return new Promise(function(l,h){var p=[];if(i){var g=[];if(r&&(t&&(t==="water"&&r.water?g.push(r.water):t==="majorPoi"&&r.majorPoi&&g.push(r.majorPoi)),g.length===0)&&(r.majorPoi&&8<=e.zoom?g.push(r.majorPoi):(r.poi&&14<=e.zoom?g.push(r.poi):r.road&&15<=e.zoom&&(r.secondRoad?g.push(r.road+" & "+r.secondRoad):g.push(r.road)),r.neighbourhood&&12<=e.zoom&&g.push(r.neighbourhood),r.city&&6<=e.zoom&&g.push(r.city)),r.state&&4<=e.zoom&&g.push(r.state),g.length===0?r.water?g.push(r.water):r.country&&g.push(r.country):g.length===1&&r.state&&4<=e.zoom&&r.country&&g.push(r.country)),0<g.length)p.push("<p>Location: ",g.join(", "),".</p>");else if(o&&t!=="water")return void a._reverseGeocodeDescription(e).then(function(_){l(_)},function(){h("<p>Location: unknown</p>")})}a._returnDetailedDescriptions&&(p.push("<p>Zoom: ",ns(e.zoom,2),".</p>"),p.push("<p>Latitude: ",ns(e.center[1],5),".</p>"),p.push("<p>Longitude: ",ns(e.center[0],5),".</p>")),l(p.join(""))})},n.prototype._reverseGeocodeDescription=function(e){var t=this;return new Promise(function(r){var i=t._map.getStyle();t._reverseSearch.request({position:e.center,style:i}).then(function(o){var a,l={};o&&o.features&&0<o.features.length&&(a=(a=o.features[0])==null?void 0:a.properties)!=null&&a.address&&((a=o.features[0].properties.address).countryRegion&&(l.country=a.countryRegion.name,n._labelCache.cache(l.country,{source:[],labelType:"country",radius:5e3,minZoom:0},e.center,i.language)),a.adminDistricts&&(l.state=(o=a.adminDistricts[0])==null?void 0:o.shortName,n._labelCache.cache(l.state,{source:[],labelType:"state",radius:5e3,minZoom:4},e.center,i.language)),a.locality&&(l.city=a.locality,n._labelCache.cache(l.city,{source:[],labelType:"city",radius:1e3,minZoom:10},e.center,i.language)),a.addressLine)&&(l.road=a.addressLine),t._processLocInfo(e,null,l,!0,!1).then(function(h){r(h)})},function(o){t._processLocInfo(e,null,null,!0,!1).then(function(a){r(a)})}).catch(function(o){t._processLocInfo(e,null,null,!0,!1).then(function(a){r(a)})})})},n.prototype._round=function(e,t){return t===void 0&&(t=1),Math.round(e/t)*t},n._baseVectorTileSourceIds=["microsoft.base","vectorTiles","bing-mvt"],n._labelConfigBing=[{source:["water_feature"],labelType:"water",minZoom:0,radius:395e4,polygonSources:["generic_water_fill"]},{source:["water_feature"],labelType:"water",minZoom:3,radius:1e6,polygonSources:["generic_water_fill"]},{source:["country_region"],labelType:"country",minZoom:0,maxZoom:5,radius:3e5},{source:["admin_division1"],labelType:"state",minZoom:4,maxZoom:7,radius:3e5},{source:["populated_place"],labelType:"city",minZoom:8,radius:4e4},{source:["neighborhood"],labelType:"neighbourhood",minZoom:12,radius:6e3},{source:["amusement_park"],labelType:"poi",minZoom:14,radius:2e3,polygonSources:["amusement_park_fill"]},{source:["hospital"],labelType:"poi",minZoom:14,radius:1e3,polygonSources:["hospital_fill"]},{source:["shopping_center"],labelType:"poi",minZoom:14,radius:1e3,polygonSources:["shopping_center_fill"]},{source:["stadium"],labelType:"poi",minZoom:14,radius:1e3,polygonSources:["stadium_fill"]},{source:["higher_education_facility","school"],labelType:"poi",minZoom:14,radius:1e3,polygonSources:["higher_education_facility_fill","school_fill"]},{source:["zoo"],labelType:"poi",minZoom:14,radius:1e3,polygonSources:["zoo_fill"]},{source:["airport","airport_terminal"],labelType:"majorPoi",minZoom:11,radius:3e3,polygonSources:["airport_terminal_fill","airport_fill-merged7","airport_runway_fill"]},{source:["reserve"],labelType:"majorPoi",minZoom:7,radius:15e3,polygonSources:["generic_reserve_fill","land_cover_forest_fill"]}],n._roadLayersBing=new Set(["road"]),n}(),kxe=function(n){var e=this;this.addToMap=function(){e.mapViewDesc==null&&(e.initializeMapLiveStateInfo(),e.initializeMapStyleInfo(),e.createMapKeyBindingInfo(),e.map.getMapContainer().setAttribute("role","application"),e.map.getMapContainer().setAttribute("aria-label","Map Application"),e.map.getCanvasContainer().setAttribute("aria-live","polite"),e.map.getCanvasContainer().setAttribute("aria-describedby","atlas-map-state atlas-map-style"),e.map.getCanvas().setAttribute("aria-label","Interactive Map"),e.map.getCanvas().setAttribute("aria-describedby","atlas-map-shortcuts"),e.map.getCanvas().setAttribute("alt","Interactive Map"))},this.removeFromMap=function(){e.mapViewDesc!=null&&e.mapViewDesc.dispose(),delete e.mapViewDesc,e.atlasMapKeyBindings!=null&&e.map.getCanvasContainer().removeChild(e.atlasMapKeyBindings),delete e.atlasMapKeyBindings,e.atlasMapLiveStateInfo!=null&&e.map.getCanvasContainer().removeChild(e.atlasMapLiveStateInfo),delete e.atlasMapLiveStateInfo,e.atlasMapStyleInfo!=null&&e.map.getCanvasContainer().removeChild(e.atlasMapStyleInfo),delete e.atlasMapStyleInfo,e.map.getMapContainer().removeAttribute("role"),e.map.getMapContainer().removeAttribute("aria-label"),e.map.getCanvasContainer().removeAttribute("aria-live"),e.map.getCanvasContainer().removeAttribute("aria-describedby"),e.map.getCanvas().removeAttribute("aria-label"),e.map.getCanvas().removeAttribute("aria-describedby"),e.map.getCanvas().removeAttribute("alt"),e.map.events.remove("stylechanged",e.updateMapStyle)},this.createMapKeyBindingInfo=function(){e.atlasMapKeyBindings=document.createElement("div"),e.atlasMapKeyBindings.setAttribute("tabindex","-1"),e.atlasMapKeyBindings.setAttribute("aria-hidden","true"),e.atlasMapKeyBindings.id="atlas-map-shortcuts",e.atlasMapKeyBindings.classList.add("hidden-accessible-element"),e.atlasMapKeyBindings.innerHTML=["Map shortcuts:","Zoom out: hyphen.","Zoom in: plus.","Pan right 100 pixels: right arrow.","Pan left 100 pixels: left arrow.","Pan up 100 pixels: up arrow.","Pan down 100 pixels: down arrow.","Rotate 15 degrees clockwise: shift + right arrow.","Rotate 15 degrees counter clockwise: shift + left arrow.","Increase pitch 10 degrees: shift + up arrow.","Decrease pitch 10 degrees: shift + down arrow.","Jump focus to the map: Escape."].join(`
`),e.map.getCanvasContainer().appendChild(e.atlasMapKeyBindings);var t=[189,187,38,37,39,40],r=e.map._getMap()._canvas;r!=null&&r.addEventListener("keyup",function(i){t.find(function(o){return i.keyCode===o})&&(e.atlasMapKeyBindings.innerHTML="")})},this.initializeMapLiveStateInfo=function(){e.mapViewDesc=new Rxe(e.map,e.updateMapState),e.atlasMapLiveStateInfo=document.createElement("div"),e.atlasMapLiveStateInfo.setAttribute("tabindex","-1"),e.atlasMapLiveStateInfo.setAttribute("aria-hidden","true"),e.atlasMapLiveStateInfo.id="atlas-map-state",e.atlasMapLiveStateInfo.classList.add("hidden-accessible-element"),e.map.getCanvasContainer().appendChild(e.atlasMapLiveStateInfo)},this.initializeMapStyleInfo=function(){e.atlasMapStyleInfo=document.createElement("div"),e.atlasMapStyleInfo.setAttribute("tabindex","-1"),e.atlasMapStyleInfo.setAttribute("aria-hidden","true"),e.atlasMapStyleInfo.id="atlas-map-style",e.atlasMapStyleInfo.classList.add("hidden-accessible-element"),e.map.events.add("stylechanged",e.updateMapStyle),e.map.getCanvasContainer().appendChild(e.atlasMapStyleInfo)},this.updateMapStyle=function(){e.atlasMapStyleInfo.innerHTML="<p>Map style: ".concat(e.map.getStyle().style,".</p>")},this.updateMapState=function(t){e.atlasMapLiveStateInfo.innerHTML=t},this.map=n},Oxe=function(n){var e=this;this.listenerEnabled=!1,this.lastFlowMode="none",this.addToMap=function(){if(!e.map._isReady())throw new Error("Traffic flow could not be added to the map because the map is not ready. Please use a ready event listener to guarantee the map is ready before enabling traffic flow.");e.listenerEnabled||(e.map.events.add("styledata",e.addToMap),e.listenerEnabled=!0);var t,r=e.map.getTraffic();r.flow!=="none"&&(t=e.map.layers.getLayerById("traffic_".concat(r.flow)))&&(e.lastFlowMode=r.flow,t._updateLayoutProperty("visibility","visible","none"))},this.removeFromMap=function(){var t;e.map.getTraffic(),e.lastFlowMode!="none"&&((t=e.map.layers.getLayerById("traffic_".concat(e.lastFlowMode)))&&t._updateLayoutProperty("visibility","none","visible"),e.lastFlowMode="none"),e.listenerEnabled&&(e.map.events.remove("styledata",e.addToMap),e.listenerEnabled=!1)},this.map=n},Lxe=window&&window.__extends||function(){var n=function(e,t){return(n=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(r,i){r.__proto__=i}:function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])}))(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),NF=function(n){function e(t,r,i){var a=(a=(a=(a=(a=(a=(a=(a=(a=(a=(a=(a=(a=(a=t.icon_category_12)!=null?a:t.icon_category_11)!=null?a:t.icon_category_10)!=null?a:t.icon_category_9)!=null?a:t.icon_category_8)!=null?a:t.icon_category_7)!=null?a:t.icon_category_6)!=null?a:t.icon_category_5)!=null?a:t.icon_category_4)!=null?a:t.icon_category_3)!=null?a:t.icon_category_2)!=null?a:t.icon_category_1)!=null?a:t.icon_category_0)!=null?a:t.icon_category,o=(o=(o=(o=(o=(o=(o=(o=(o=(o=(o=(o=(o=(o=t.description_12)!=null?o:t.description_11)!=null?o:t.description_10)!=null?o:t.description_9)!=null?o:t.description_8)!=null?o:t.description_7)!=null?o:t.description_6)!=null?o:t.description_5)!=null?o:t.description_4)!=null?o:t.description_3)!=null?o:t.description_2)!=null?o:t.description_1)!=null?o:t.description_0)!=null?o:t.description,a={icon:"".concat(e.getSeverityColorName(t.magnitude),"-").concat(e.getIncidentTypeIconName(a)),incidentType:e.getIncidentTypeName(a,i),description:o,delay:t.delay,color:e.getSeverityColorHexCode(t.magnitude),id:t.id};return n.call(this,r,a)||this}return Lxe(e,n),e.getIncidentTypeName=function(t,r){switch(t){case 0:return r.Unknown;case 1:return r.Accident;case 2:return r.Fog;case 3:return r.Danger;case 4:return r.Rain;case 5:return r.Ice;case 6:return r.Jam;case 7:return r.LaneClosed;case 8:return r.RoadClosed;case 9:return r.RoadWorks;case 10:return r.Wind;case 11:return r.Flood;case 12:return r.Detour;default:return r.Unknown}},e.getIncidentTypeIconName=function(t){switch(t){case 0:return"unknown";case 1:return"accident";case 2:return"fog";case 3:return"danger";case 4:return"rain";case 5:return"ice";case 6:return"jam";case 7:return"lane-closed";case 8:return"road-closed";case 9:return"road-work";case 10:return"wind";case 11:return"flood";case 12:return"detour";default:return"unknown"}},e.getSeverityColorName=function(t){switch(t){case 0:return"grey";case 1:return"yellow";case 2:return"orange";case 3:return"red";default:return"grey"}},e.getSeverityColorHexCode=function(t){switch(t){case 0:return"#B5B6B7";case 1:return"#F4C951";case 2:return"#F4873F";case 3:return"#F04F4E";default:return"#B5B6B7"}},e}(Pc),DF=(function(n){n.DELAY="delay",n.LENGTH="length",n.FROM="from",n.TO="to"}(Og=Og||{}),function(){function n(){}return n.build=function(e,t){t===void 0&&(t="en-US");var r,o=document.createElement("div"),a=(o.classList.add("incident-popup-title"),o.classList.add("font-segoeui-b"),o.innerText=e.properties.incidentType,o.setAttribute("aria-label","Incident Type ".concat(e.properties.incidentType)),document.createElement("div")),i=(a.classList.add("incident-popup-subtitle"),a.classList.add("font-segoeui-b"),a.setAttribute("aria-label","Incident Description ".concat(e.properties.description)),a.innerText=e.properties.description,document.createElement("div")),o=(i.classList.add("incident-popup-header"),i.style.backgroundColor=e.properties.color,i.appendChild(o),i.appendChild(a),document.createElement("div")),a=(o.classList.add("incident-popup-body"),e.properties.delay&&(a="".concat(Math.floor(e.properties.delay/60)," min"),a=this.createInfoSection(a,Og.DELAY),o.appendChild(a)),e.properties.length&&(a=new Intl.NumberFormat([t,"en-US"],{maximumFractionDigits:2}),r=void 0,r=t==="en-US"?(t=Tu(e.properties.length,"meters","miles"),"".concat(a.format(t)," miles")):(t=Tu(e.properties.length,"meters","kilometers"),"".concat(a.format(t)," km")),a=this.createInfoSection(r,Og.LENGTH),o.appendChild(a)),e.properties.from&&(t=this.createInfoSection(e.properties.from,Og.FROM),o.appendChild(t)),e.properties.to&&(r=this.createInfoSection(e.properties.to,Og.TO),o.appendChild(r)),document.createElement("div"));return a.classList.add("incident-popup-content"),a.appendChild(i),a.appendChild(o),new wT({content:a,position:e.geometry.coordinates})},n.createInfoSection=function(e,t){var r=document.createElement("div"),i=(r.classList.add("incident-popup-info"),document.createElement("div")),o=(i.classList.add("icon"),i.classList.add(t),document.createElement("span"));return o.classList.add("message"),o.classList.add("font-segoeui"),o.setAttribute("aria-label","Incident ".concat(t," ").concat(e)),o.innerText=e,r.appendChild(i),r.appendChild(o),r},n}()),Nxe=window&&window.__awaiter||function(n,e,t,r){return new(t=t||Promise)(function(i,o){function a(p){try{h(r.next(p))}catch(g){o(g)}}function l(p){try{h(r.throw(p))}catch(g){o(g)}}function h(p){var g;p.done?i(p.value):((g=p.value)instanceof t?g:new t(function(_){_(g)})).then(a,l)}h((r=r.apply(n,e||[])).next())})},Dxe=window&&window.__generator||function(n,e){var t,r,i,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]},a={next:l(0),throw:l(1),return:l(2)};return typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function l(h){return function(p){var g=[h,p];if(t)throw new TypeError("Generator is already executing.");for(;o=a&&g[a=0]?0:o;)try{if(t=1,r&&(i=2&g[0]?r.return:g[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,g[1])).done)return i;switch(r=0,(g=i?[2&g[0],i.value]:g)[0]){case 0:case 1:i=g;break;case 4:return o.label++,{value:g[1],done:!1};case 5:o.label++,r=g[1],g=[0];continue;case 7:g=o.ops.pop(),o.trys.pop();continue;default:if(!(i=0<(i=o.trys).length&&i[i.length-1])&&(g[0]===6||g[0]===2)){o=0;continue}if(g[0]===3&&(!i||g[1]>i[0]&&g[1]<i[3]))o.label=g[1];else if(g[0]===6&&o.label<i[1])o.label=i[1],i=g;else{if(!(i&&o.label<i[2])){i[2]&&o.ops.pop(),o.trys.pop();continue}o.label=i[2],o.ops.push(g)}}g=e.call(n,o)}catch(_){g=[6,_],r=0}finally{t=i=0}if(5&g[0])throw g[1];return{value:g[0]?g[1]:void 0,done:!0}}}},Fxe=function(){function n(r){var t=this,r=(this.incidentLayerName="incidents",this.incidentSourceName="mapcontrol_traffic_incident",this.addToMap=function(){t.map.sources.getById(t.incidentSourceName)||t.map.sources.add(t.vectorTileSource),t.map.layers.getLayerById(t.incidentLayerName)||t.map.layers.add(t.incidentLayer,"labels"),t.clickPopup=new wT({position:[0,0],pixelOffset:[0,-18]}),t.map.addEventListener("mouseover",t.incidentLayerName,t.cursorToPointer),t.map.addEventListener("mouseleave",t.incidentLayerName,t.cursorToDefault),t.map.addEventListener("click",t.incidentLayerName,t.openIncidentPopup),t.map.events.addOnce("idle",t.setAccessiblePopups),t.map.events.add("moveend",t.setAccessiblePopups)},this.accessiblePopups=[],this.setAccessiblePopups=function(){return Nxe(t,void 0,void 0,function(){var i,o,a,l,h,p,g=this;return Dxe(this,function(_){switch(_.label){case 0:return this.accessiblePopups.forEach(function(x){return x.remove()}),this.accessiblePopups=[],i=this.map.layers.getRenderedShapes(this.map.getCamera().bounds,this.incidentLayer),[4,this.map._getLocalizedStrings()];case 1:return o=_.sent(),a=function(x,C){var M=x[C],D=M.geometry.coordinates,D=new Mc(new Xo(D[0],D[1])),M=new NF(M.properties,D,o),L=DF.build(M,g.incidentLanguage),D=L.getPopupContainer();return D.addEventListener("focusin",function(z){g.clickPopup.remove(),g.accessiblePopups.filter(function(te){return te!==L}).forEach(function(te){return te.remove()}),0<=C-1&&l(L,a(x,C-1)),C+1<x.length&&p(a(x,C+1)),2<=C&&C==x.length-1&&h(a(x,0)),C==0&&2<=x.length&&p(a(x,x.length-1))}),C==x.length-1&&D.addEventListener("focusout",function(z){z.relatedTarget===null&&L.close()}),g.accessiblePopups.push(L),L},l=function(x,C){C.open(g.map),C.close(),C=C.getPopupContainer(),x=x.getPopupContainer(),x.parentElement.insertBefore(C,x)},h=function(C){C.open(g.map),C.close();var C=C.getPopupContainer(),M=C.parentElement;M.insertBefore(C,M.firstElementChild)},p=function(x){x.open(g.map),x.close()},0<i.length&&p(a(i,0)),1<i.length&&p(a(i,i.length-1)),[2]}})})},this.removeFromMap=function(){var i;t.map.removeEventListener("mouseover",t.incidentLayerName,t.cursorToPointer),t.map.removeEventListener("mouseleave",t.incidentLayerName,t.cursorToDefault),t.map.removeEventListener("click",t.incidentLayerName,t.openIncidentPopup),t.map.events.remove("idle",t.setAccessiblePopups),t.map.events.remove("moveend",t.setAccessiblePopups),t.accessiblePopups.forEach(function(o){return o.remove()}),t.accessiblePopups=[],(i=t.clickPopup)!=null&&i.remove(),t.map.layers.getLayerById(t.incidentLayerName)!=null&&t.map.layers.remove(t.incidentLayerName),t.map.sources.getById(t.incidentSourceName)!=null&&t.map.sources.remove(t.incidentSourceName)},this.cursorToPointer=function(i){t.map.getCanvas().style.cursor="pointer"},this.cursorToDefault=function(i){t.map.getCanvas().style.cursor=""},this.openIncidentPopup=function(i){t.clickPopup.remove(),t.accessiblePopups.forEach(function(l){return l.close()});var o=i.position,a=i.features[0];t.map._getLocalizedStrings().then(function(l){var h=new Mc(new Xo(o[0],o[1])),h=new NF(a.properties,h,l);t.clickPopup=DF.build(h,t.incidentLanguage),t.clickPopup.open(t.map),t.clickPopup.getPopupContainer().addEventListener("focusout",function(p){p.relatedTarget===null&&t.clickPopup.close()})})},this.map=r,this.vectorTileSource=new kz(this.incidentSourceName,{maxZoom:22,tiles:["https://".concat(Nn.domainPlaceHolder,"/traffic/incident/tile/pbf?api-version=1.0&zoom={z}&x={x}&y={y}")]}),this.getIncidentIconImageExpression());this.incidentLayer=new Ux(this.incidentSourceName,this.incidentLayerName,{sourceLayer:"Traffic incident POI",iconOptions:{ignorePlacement:!0,allowOverlap:!0,image:r,size:.75}})}return n.prototype.getIncidentIconImageExpression=function(){return["concat",["let","magnitude",["get","magnitude"],["case",["==",["var","magnitude"],0],"grey",["==",["var","magnitude"],1],"yellow",["==",["var","magnitude"],2],"orange",["==",["var","magnitude"],3],"red",["==",["var","magnitude"],4],"grey","grey"]],"-",["let","category",["coalesce",["get","icon_category_12"],["get","icon_category_11"],["get","icon_category_10"],["get","icon_category_9"],["get","icon_category_8"],["get","icon_category_7"],["get","icon_category_6"],["get","icon_category_5"],["get","icon_category_4"],["get","icon_category_3"],["get","icon_category_2"],["get","icon_category_0"],["get","icon_category"],0],["case",["==",["var","category"],0],"unknown",["==",["var","category"],1],"accident",["==",["var","category"],2],"fog",["==",["var","category"],3],"danger",["==",["var","category"],4],"rain",["==",["var","category"],5],"ice",["==",["var","category"],6],"jam",["==",["var","category"],7],"lane-closed",["==",["var","category"],8],"road-closed",["==",["var","category"],9],"road-work",["==",["var","category"],10],"wind",["==",["var","category"],11],"flood",["==",["var","category"],12],"detour","unknown"]]]},n}(),Bxe=window&&window.__extends||function(){var n=function(e,t){return(n=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(r,i){r.__proto__=i}:function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])}))(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),FF=function(n){function e(){var t=n!==null&&n.apply(this,arguments)||this;return t.interactive=!0,t.scrollZoomInteraction=!0,t.boxZoomInteraction=!0,t.dragRotateInteraction=!0,t.dragPanInteraction=!0,t.keyboardInteraction=!0,t.dblClickZoomInteraction=!0,t.touchInteraction=!0,t.touchRotate=!0,t.wheelZoomRate=1/450,t}return Bxe(e,n),e}(wi),Uxe=function(){function n(e){var t=this;this._onKeyDown=function(r){r.keyCode===27&&t.map.getCanvas().focus()},this.map=e}return n.prototype.enable=function(){this.map.getMapContainer().addEventListener("keydown",this._onKeyDown)},n.prototype.disable=function(){this.map.getMapContainer().removeEventListener("keydown",this._onKeyDown)},n}(),zxe=function(){function n(e){var t=this;this._onGestureStart=function(r){t.hasTouch||(r.preventDefault(),t.initZoom=t.map.getCamera().zoom)},this._onGestureChange=function(r){t.hasTouch||(r.preventDefault(),t.map.setCamera({zoom:t.initZoom+r.scale-1}))},this._onTouchStart=function(r){t.hasTouch=!0},this._onTouchEnd=function(r){r.touches.length===0&&(t.hasTouch=!1)},this.map=e}return n.prototype.enable=function(){this.map.getCanvasContainer().addEventListener("gesturestart",this._onGestureStart),this.map.getCanvasContainer().addEventListener("gesturechange",this._onGestureChange),this.map.getCanvasContainer().addEventListener("touchstart",this._onTouchStart),this.map.getCanvasContainer().addEventListener("touchend",this._onTouchEnd)},n.prototype.disable=function(){this.map.getCanvasContainer().removeEventListener("gesturestart",this._onGestureStart),this.map.getCanvasContainer().removeEventListener("gesturechange",this._onGestureChange),this.map.getCanvasContainer().removeEventListener("touchstart",this._onTouchStart),this.map.getCanvasContainer().removeEventListener("touchend",this._onTouchEnd)},n}(),jxe=function(){function n(e,t){this.added=!1,this.map=e,this.focusShortcut=new Uxe(e),this.pinchZoom=new zxe(e),this.options=new FF().merge(t)}return n.prototype.addToMap=function(){this.added||(this.added=!0,this._setInteractions(this.options))},n.prototype.removeFromMap=function(){this.added&&(this.added=!1,this._setInteractions({interactive:!1}))},n.prototype.setOptions=function(e){this.options=new FF().merge(this.options,e),this.added&&this._setInteractions(this.options)},n.prototype.getOptions=function(){return Object.assign({},this.options)},n.prototype._setInteractions=function(e){var t;e.interactive?(e.boxZoomInteraction?this.map._getMap().boxZoom.enable():this.map._getMap().boxZoom.disable(),e.dblClickZoomInteraction?this.map._getMap().doubleClickZoom.enable():this.map._getMap().doubleClickZoom.disable(),e.dragPanInteraction?this.map._getMap().dragPan.enable():this.map._getMap().dragPan.disable(),e.dragRotateInteraction?this.map._getMap().dragRotate.enable():this.map._getMap().dragRotate.disable(),e.keyboardInteraction?(this.map._getMap().keyboard.enable(),this.focusShortcut.enable()):(this.map._getMap().keyboard.disable(),this.focusShortcut.disable()),e.scrollZoomInteraction?(this.map._getMap().scrollZoom.enable(),this.map._getMap().scrollZoom.setWheelZoomRate(e.wheelZoomRate)):this.map._getMap().scrollZoom.disable(),t=this.map._getMap().touchZoomRotate,e.touchInteraction?(t.enable(),e.touchRotate?t.enableRotation():t.disableRotation()):t.disable(),this.pinchZoom.enable()):(this.map._getMap().boxZoom.disable(),this.map._getMap().doubleClickZoom.disable(),this.map._getMap().dragPan.disable(),this.map._getMap().dragRotate.disable(),this.map._getMap().keyboard.disable(),this.focusShortcut.disable(),this.map._getMap().scrollZoom.disable(),this.map._getMap().touchZoomRotate.disable(),this.pinchZoom.disable())},n}();function AV(n,e,t){var r={type:"Feature"};return(t=t===void 0?{}:t).id!==0&&!t.id||(r.id=t.id),t.bbox&&(r.bbox=t.bbox),r.properties=e||{},r.geometry=n,r}function Vxe(n,e,t){t===void 0&&(t={});for(var r=0,i=n;r<i.length;r++){var o=i[r];if(o.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var a=0;a<o[o.length-1].length;a++)if(o[o.length-1][a]!==o[0][a])throw new Error("First and last Position are not equivalent.")}return AV({type:"Polygon",coordinates:n},e,t)}function Hxe(n,e,t){return AV({type:"MultiPolygon",coordinates:n},e,t=t===void 0?{}:t)}function BF(n){return n.type==="Feature"?n.geometry:n}var UF={exports:{}},Gxe=(UF.exports=function(){function n(he,B){if(!(he instanceof B))throw new TypeError("Cannot call a class as a function")}function e(he,B){for(var H=0;H<B.length;H++){var F=B[H];F.enumerable=F.enumerable||!1,F.configurable=!0,"value"in F&&(F.writable=!0),Object.defineProperty(he,F.key,F)}}function t(he,B,H){return B&&e(he.prototype,B),H&&e(he,H),he}var r=function(){function he(B,H){this.next=null,this.key=B,this.data=H,this.left=null,this.right=null}return he}();function i(he,B){return he>B?1:he<B?-1:0}function o(he,B,H){for(var F=new r(null,null),Q=F,ae=F;;){var q=H(he,B.key);if(q<0){if(B.left===null)break;if(H(he,B.left.key)<0){var Ae=B.left;if(B.left=Ae.right,Ae.right=B,B=Ae,B.left===null)break}ae.left=B,ae=B,B=B.left}else if(q>0){if(B.right===null)break;if(H(he,B.right.key)>0){var Ae=B.right;if(B.right=Ae.left,Ae.left=B,B=Ae,B.right===null)break}Q.right=B,Q=B,B=B.right}else break}return Q.right=B.left,ae.left=B.right,B.left=F.right,B.right=F.left,B}function a(he,B,H,F){var Q=new r(he,B);if(H===null)return Q.left=Q.right=null,Q;H=o(he,H,F);var ae=F(he,H.key);return ae<0?(Q.left=H.left,Q.right=H,H.left=null):ae>=0&&(Q.right=H.right,Q.left=H,H.right=null),Q}function l(he,B,H){var F=null,Q=null;if(B){B=o(he,B,H);var ae=H(B.key,he);ae===0?(F=B.left,Q=B.right):ae<0?(Q=B.right,B.right=null,F=B):(F=B.left,B.left=null,Q=B)}return{left:F,right:Q}}function h(he,B,H){return B===null?he:(he===null||(B=o(he.key,B,H),B.left=he),B)}function p(he,B,H,F,Q){if(he){F(""+B+(H?" ":" ")+Q(he)+`
`);var ae=B+(H?"    ":"   ");he.left&&p(he.left,ae,!1,F,Q),he.right&&p(he.right,ae,!0,F,Q)}}var g=function(){function he(B){B===void 0&&(B=i),this._root=null,this._size=0,this._comparator=B}return he.prototype.insert=function(B,H){return this._size++,this._root=a(B,H,this._root,this._comparator)},he.prototype.add=function(B,H){var F=new r(B,H);this._root===null&&(F.left=F.right=null,this._size++,this._root=F);var Q=this._comparator,ae=o(B,this._root,Q),q=Q(B,ae.key);return q===0?this._root=ae:(q<0?(F.left=ae.left,F.right=ae,ae.left=null):q>0&&(F.right=ae.right,F.left=ae,ae.right=null),this._size++,this._root=F),this._root},he.prototype.remove=function(B){this._root=this._remove(B,this._root,this._comparator)},he.prototype._remove=function(B,H,F){var Q;if(H===null)return null;H=o(B,H,F);var ae=F(B,H.key);return ae===0?(H.left===null?Q=H.right:(Q=o(B,H.left,F),Q.right=H.right),this._size--,Q):H},he.prototype.pop=function(){var B=this._root;if(B){for(;B.left;)B=B.left;return this._root=o(B.key,this._root,this._comparator),this._root=this._remove(B.key,this._root,this._comparator),{key:B.key,data:B.data}}return null},he.prototype.findStatic=function(B){for(var H=this._root,F=this._comparator;H;){var Q=F(B,H.key);if(Q===0)return H;Q<0?H=H.left:H=H.right}return null},he.prototype.find=function(B){return this._root&&(this._root=o(B,this._root,this._comparator),this._comparator(B,this._root.key)!==0)?null:this._root},he.prototype.contains=function(B){for(var H=this._root,F=this._comparator;H;){var Q=F(B,H.key);if(Q===0)return!0;Q<0?H=H.left:H=H.right}return!1},he.prototype.forEach=function(B,H){for(var F=this._root,Q=[],ae=!1;!ae;)F!==null?(Q.push(F),F=F.left):Q.length!==0?(F=Q.pop(),B.call(H,F),F=F.right):ae=!0;return this},he.prototype.range=function(B,H,F,Q){for(var ae=[],q=this._comparator,Ae=this._root,Pe;ae.length!==0||Ae;)if(Ae)ae.push(Ae),Ae=Ae.left;else{if(Ae=ae.pop(),Pe=q(Ae.key,H),Pe>0)break;if(q(Ae.key,B)>=0&&F.call(Q,Ae))return this;Ae=Ae.right}return this},he.prototype.keys=function(){var B=[];return this.forEach(function(H){var F=H.key;return B.push(F)}),B},he.prototype.values=function(){var B=[];return this.forEach(function(H){var F=H.data;return B.push(F)}),B},he.prototype.min=function(){return this._root?this.minNode(this._root).key:null},he.prototype.max=function(){return this._root?this.maxNode(this._root).key:null},he.prototype.minNode=function(B){if(B===void 0&&(B=this._root),B)for(;B.left;)B=B.left;return B},he.prototype.maxNode=function(B){if(B===void 0&&(B=this._root),B)for(;B.right;)B=B.right;return B},he.prototype.at=function(B){for(var H=this._root,F=!1,Q=0,ae=[];!F;)if(H)ae.push(H),H=H.left;else if(ae.length>0){if(H=ae.pop(),Q===B)return H;Q++,H=H.right}else F=!0;return null},he.prototype.next=function(B){var H=this._root,F=null;if(B.right){for(F=B.right;F.left;)F=F.left;return F}for(var Q=this._comparator;H;){var ae=Q(B.key,H.key);if(ae===0)break;ae<0?(F=H,H=H.left):H=H.right}return F},he.prototype.prev=function(B){var H=this._root,F=null;if(B.left!==null){for(F=B.left;F.right;)F=F.right;return F}for(var Q=this._comparator;H;){var ae=Q(B.key,H.key);if(ae===0)break;ae<0?H=H.left:(F=H,H=H.right)}return F},he.prototype.clear=function(){return this._root=null,this._size=0,this},he.prototype.toList=function(){return C(this._root)},he.prototype.load=function(B,H,F){H===void 0&&(H=[]),F===void 0&&(F=!1);var Q=B.length,ae=this._comparator;if(F&&D(B,H,0,Q-1,ae),this._root===null)this._root=_(B,H,0,Q),this._size=Q;else{var q=L(this.toList(),x(B,H),ae);Q=this._size+Q,this._root=M({head:q},0,Q)}return this},he.prototype.isEmpty=function(){return this._root===null},Object.defineProperty(he.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),Object.defineProperty(he.prototype,"root",{get:function(){return this._root},enumerable:!0,configurable:!0}),he.prototype.toString=function(B){B===void 0&&(B=function(Q){return String(Q.key)});var H=[];return p(this._root,"",!0,function(F){return H.push(F)},B),H.join("")},he.prototype.update=function(B,H,F){var Q=this._comparator,ae=l(B,this._root,Q),q=ae.left,Ae=ae.right;Q(B,H)<0?Ae=a(H,F,Ae,Q):q=a(H,F,q,Q),this._root=h(q,Ae,Q)},he.prototype.split=function(B){return l(B,this._root,this._comparator)},he}();function _(he,B,H,F){var Q=F-H;if(Q>0){var ae=H+Math.floor(Q/2),q=he[ae],Ae=B[ae],Pe=new r(q,Ae);return Pe.left=_(he,B,H,ae),Pe.right=_(he,B,ae+1,F),Pe}return null}function x(he,B){for(var H=new r(null,null),F=H,Q=0;Q<he.length;Q++)F=F.next=new r(he[Q],B[Q]);return F.next=null,H.next}function C(he){for(var B=he,H=[],F=!1,Q=new r(null,null),ae=Q;!F;)B?(H.push(B),B=B.left):H.length>0?(B=ae=ae.next=H.pop(),B=B.right):F=!0;return ae.next=null,Q.next}function M(he,B,H){var F=H-B;if(F>0){var Q=B+Math.floor(F/2),ae=M(he,B,Q),q=he.head;return q.left=ae,he.head=he.head.next,q.right=M(he,Q+1,H),q}return null}function L(he,B,H){for(var F=new r(null,null),Q=F,ae=he,q=B;ae!==null&&q!==null;)H(ae.key,q.key)<0?(Q.next=ae,ae=ae.next):(Q.next=q,q=q.next),Q=Q.next;return ae!==null?Q.next=ae:q!==null&&(Q.next=q),F.next}function D(he,B,H,F,Q){if(!(H>=F)){for(var ae=he[H+F>>1],q=H-1,Ae=F+1;;){do q++;while(Q(he[q],ae)<0);do Ae--;while(Q(he[Ae],ae)>0);if(q>=Ae)break;var Pe=he[q];he[q]=he[Ae],he[Ae]=Pe,Pe=B[q],B[q]=B[Ae],B[Ae]=Pe}D(he,B,H,Ae,Q),D(he,B,Ae+1,F,Q)}}var z=function(B,H){return B.ll.x<=H.x&&H.x<=B.ur.x&&B.ll.y<=H.y&&H.y<=B.ur.y},te=function(B,H){if(H.ur.x<B.ll.x||B.ur.x<H.ll.x||H.ur.y<B.ll.y||B.ur.y<H.ll.y)return null;var F=B.ll.x<H.ll.x?H.ll.x:B.ll.x,Q=B.ur.x<H.ur.x?B.ur.x:H.ur.x,ae=B.ll.y<H.ll.y?H.ll.y:B.ll.y,q=B.ur.y<H.ur.y?B.ur.y:H.ur.y;return{ll:{x:F,y:ae},ur:{x:Q,y:q}}},le=Number.EPSILON;le===void 0&&(le=Math.pow(2,-52));var ce=le*le,_e=function(B,H){if(-le<B&&B<le&&-le<H&&H<le)return 0;var F=B-H;return F*F<ce*B*H?0:B<H?-1:1},J=function(){function he(){n(this,he),this.reset()}return t(he,[{key:"reset",value:function(){this.xRounder=new pe,this.yRounder=new pe}},{key:"round",value:function(H,F){return{x:this.xRounder.round(H),y:this.yRounder.round(F)}}}]),he}(),pe=function(){function he(){n(this,he),this.tree=new g,this.round(0)}return t(he,[{key:"round",value:function(H){var F=this.tree.add(H),Q=this.tree.prev(F);if(Q!==null&&_e(F.key,Q.key)===0)return this.tree.remove(H),Q.key;var ae=this.tree.next(F);return ae!==null&&_e(F.key,ae.key)===0?(this.tree.remove(H),ae.key):H}}]),he}(),ue=new J,xe=function(B,H){return B.x*H.y-B.y*H.x},je=function(B,H){return B.x*H.x+B.y*H.y},ne=function(B,H,F){var Q={x:H.x-B.x,y:H.y-B.y},ae={x:F.x-B.x,y:F.y-B.y},q=xe(Q,ae);return _e(q,0)},Ee=function(B){return Math.sqrt(je(B,B))},ke=function(B,H,F){var Q={x:H.x-B.x,y:H.y-B.y},ae={x:F.x-B.x,y:F.y-B.y};return xe(ae,Q)/Ee(ae)/Ee(Q)},Be=function(B,H,F){var Q={x:H.x-B.x,y:H.y-B.y},ae={x:F.x-B.x,y:F.y-B.y};return je(ae,Q)/Ee(ae)/Ee(Q)},Ze=function(B,H,F){return H.y===0?null:{x:B.x+H.x/H.y*(F-B.y),y:F}},at=function(B,H,F){return H.x===0?null:{x:F,y:B.y+H.y/H.x*(F-B.x)}},Re=function(B,H,F,Q){if(H.x===0)return at(F,Q,B.x);if(Q.x===0)return at(B,H,F.x);if(H.y===0)return Ze(F,Q,B.y);if(Q.y===0)return Ze(B,H,F.y);var ae=xe(H,Q);if(ae==0)return null;var q={x:F.x-B.x,y:F.y-B.y},Ae=xe(q,H)/ae,Pe=xe(q,Q)/ae,We=B.x+Pe*H.x,rt=F.x+Ae*Q.x,Et=B.y+Pe*H.y,Bt=F.y+Ae*Q.y,Lt=(We+rt)/2,an=(Et+Bt)/2;return{x:Lt,y:an}},ht=function(){t(he,null,[{key:"compare",value:function(H,F){var Q=he.comparePoints(H.point,F.point);return Q!==0?Q:(H.point!==F.point&&H.link(F),H.isLeft!==F.isLeft?H.isLeft?1:-1:hn.compare(H.segment,F.segment))}},{key:"comparePoints",value:function(H,F){return H.x<F.x?-1:H.x>F.x?1:H.y<F.y?-1:H.y>F.y?1:0}}]);function he(B,H){n(this,he),B.events===void 0?B.events=[this]:B.events.push(this),this.point=B,this.isLeft=H}return t(he,[{key:"link",value:function(H){if(H.point===this.point)throw new Error("Tried to link already linked events");for(var F=H.point.events,Q=0,ae=F.length;Q<ae;Q++){var q=F[Q];this.point.events.push(q),q.point=this.point}this.checkForConsuming()}},{key:"checkForConsuming",value:function(){for(var H=this.point.events.length,F=0;F<H;F++){var Q=this.point.events[F];if(Q.segment.consumedBy===void 0)for(var ae=F+1;ae<H;ae++){var q=this.point.events[ae];q.consumedBy===void 0&&Q.otherSE.point.events===q.otherSE.point.events&&Q.segment.consume(q.segment)}}}},{key:"getAvailableLinkedEvents",value:function(){for(var H=[],F=0,Q=this.point.events.length;F<Q;F++){var ae=this.point.events[F];ae!==this&&!ae.segment.ringOut&&ae.segment.isInResult()&&H.push(ae)}return H}},{key:"getLeftmostComparator",value:function(H){var F=this,Q=new Map,ae=function(Ae){var Pe=Ae.otherSE;Q.set(Ae,{sine:ke(F.point,H.point,Pe.point),cosine:Be(F.point,H.point,Pe.point)})};return function(q,Ae){Q.has(q)||ae(q),Q.has(Ae)||ae(Ae);var Pe=Q.get(q),We=Pe.sine,rt=Pe.cosine,Et=Q.get(Ae),Bt=Et.sine,Lt=Et.cosine;return We>=0&&Bt>=0?rt<Lt?1:rt>Lt?-1:0:We<0&&Bt<0?rt<Lt?-1:rt>Lt?1:0:Bt<We?-1:Bt>We?1:0}}}]),he}(),Rt=0,hn=function(){t(he,null,[{key:"compare",value:function(H,F){var Q=H.leftSE.point.x,ae=F.leftSE.point.x,q=H.rightSE.point.x,Ae=F.rightSE.point.x;if(Ae<Q)return 1;if(q<ae)return-1;var Pe=H.leftSE.point.y,We=F.leftSE.point.y,rt=H.rightSE.point.y,Et=F.rightSE.point.y;if(Q<ae){if(We<Pe&&We<rt)return 1;if(We>Pe&&We>rt)return-1;var Bt=H.comparePoint(F.leftSE.point);if(Bt<0)return 1;if(Bt>0)return-1;var Lt=F.comparePoint(H.rightSE.point);return Lt!==0?Lt:-1}if(Q>ae){if(Pe<We&&Pe<Et)return-1;if(Pe>We&&Pe>Et)return 1;var an=F.comparePoint(H.leftSE.point);if(an!==0)return an;var Ie=H.comparePoint(F.rightSE.point);return Ie<0?1:Ie>0?-1:1}if(Pe<We)return-1;if(Pe>We)return 1;if(q<Ae){var Te=F.comparePoint(H.rightSE.point);if(Te!==0)return Te}if(q>Ae){var At=H.comparePoint(F.rightSE.point);if(At<0)return 1;if(At>0)return-1}if(q!==Ae){var xt=rt-Pe,qt=q-Q,dn=Et-We,Ke=Ae-ae;if(xt>qt&&dn<Ke)return 1;if(xt<qt&&dn>Ke)return-1}return q>Ae?1:q<Ae||rt<Et?-1:rt>Et?1:H.id<F.id?-1:H.id>F.id?1:0}}]);function he(B,H,F,Q){n(this,he),this.id=++Rt,this.leftSE=B,B.segment=this,B.otherSE=H,this.rightSE=H,H.segment=this,H.otherSE=B,this.rings=F,this.windings=Q}return t(he,[{key:"replaceRightSE",value:function(H){this.rightSE=H,this.rightSE.segment=this,this.rightSE.otherSE=this.leftSE,this.leftSE.otherSE=this.rightSE}},{key:"bbox",value:function(){var H=this.leftSE.point.y,F=this.rightSE.point.y;return{ll:{x:this.leftSE.point.x,y:H<F?H:F},ur:{x:this.rightSE.point.x,y:H>F?H:F}}}},{key:"vector",value:function(){return{x:this.rightSE.point.x-this.leftSE.point.x,y:this.rightSE.point.y-this.leftSE.point.y}}},{key:"isAnEndpoint",value:function(H){return H.x===this.leftSE.point.x&&H.y===this.leftSE.point.y||H.x===this.rightSE.point.x&&H.y===this.rightSE.point.y}},{key:"comparePoint",value:function(H){if(this.isAnEndpoint(H))return 0;var F=this.leftSE.point,Q=this.rightSE.point,ae=this.vector();if(F.x===Q.x)return H.x===F.x?0:H.x<F.x?1:-1;var q=(H.y-F.y)/ae.y,Ae=F.x+q*ae.x;if(H.x===Ae)return 0;var Pe=(H.x-F.x)/ae.x,We=F.y+Pe*ae.y;return H.y===We?0:H.y<We?-1:1}},{key:"getIntersection",value:function(H){var F=this.bbox(),Q=H.bbox(),ae=te(F,Q);if(ae===null)return null;var q=this.leftSE.point,Ae=this.rightSE.point,Pe=H.leftSE.point,We=H.rightSE.point,rt=z(F,Pe)&&this.comparePoint(Pe)===0,Et=z(Q,q)&&H.comparePoint(q)===0,Bt=z(F,We)&&this.comparePoint(We)===0,Lt=z(Q,Ae)&&H.comparePoint(Ae)===0;if(Et&&rt)return Lt&&!Bt?Ae:!Lt&&Bt?We:null;if(Et)return Bt&&q.x===We.x&&q.y===We.y?null:q;if(rt)return Lt&&Ae.x===Pe.x&&Ae.y===Pe.y?null:Pe;if(Lt&&Bt)return null;if(Lt)return Ae;if(Bt)return We;var an=Re(q,this.vector(),Pe,H.vector());return an===null||!z(ae,an)?null:ue.round(an.x,an.y)}},{key:"split",value:function(H){var F=[],Q=H.events!==void 0,ae=new ht(H,!0),q=new ht(H,!1),Ae=this.rightSE;this.replaceRightSE(q),F.push(q),F.push(ae);var Pe=new he(ae,Ae,this.rings.slice(),this.windings.slice());return ht.comparePoints(Pe.leftSE.point,Pe.rightSE.point)>0&&Pe.swapEvents(),ht.comparePoints(this.leftSE.point,this.rightSE.point)>0&&this.swapEvents(),Q&&(ae.checkForConsuming(),q.checkForConsuming()),F}},{key:"swapEvents",value:function(){var H=this.rightSE;this.rightSE=this.leftSE,this.leftSE=H,this.leftSE.isLeft=!0,this.rightSE.isLeft=!1;for(var F=0,Q=this.windings.length;F<Q;F++)this.windings[F]*=-1}},{key:"consume",value:function(H){for(var F=this,Q=H;F.consumedBy;)F=F.consumedBy;for(;Q.consumedBy;)Q=Q.consumedBy;var ae=he.compare(F,Q);if(ae!==0){if(ae>0){var q=F;F=Q,Q=q}if(F.prev===Q){var Ae=F;F=Q,Q=Ae}for(var Pe=0,We=Q.rings.length;Pe<We;Pe++){var rt=Q.rings[Pe],Et=Q.windings[Pe],Bt=F.rings.indexOf(rt);Bt===-1?(F.rings.push(rt),F.windings.push(Et)):F.windings[Bt]+=Et}Q.rings=null,Q.windings=null,Q.consumedBy=F,Q.leftSE.consumedBy=F.leftSE,Q.rightSE.consumedBy=F.rightSE}}},{key:"prevInResult",value:function(){return this._prevInResult!==void 0?this._prevInResult:(this.prev?this.prev.isInResult()?this._prevInResult=this.prev:this._prevInResult=this.prev.prevInResult():this._prevInResult=null,this._prevInResult)}},{key:"beforeState",value:function(){if(this._beforeState!==void 0)return this._beforeState;if(!this.prev)this._beforeState={rings:[],windings:[],multiPolys:[]};else{var H=this.prev.consumedBy||this.prev;this._beforeState=H.afterState()}return this._beforeState}},{key:"afterState",value:function(){if(this._afterState!==void 0)return this._afterState;var H=this.beforeState();this._afterState={rings:H.rings.slice(0),windings:H.windings.slice(0),multiPolys:[]};for(var F=this._afterState.rings,Q=this._afterState.windings,ae=this._afterState.multiPolys,q=0,Ae=this.rings.length;q<Ae;q++){var Pe=this.rings[q],We=this.windings[q],rt=F.indexOf(Pe);rt===-1?(F.push(Pe),Q.push(We)):Q[rt]+=We}for(var Et=[],Bt=[],Lt=0,an=F.length;Lt<an;Lt++)if(Q[Lt]!==0){var Ie=F[Lt],Te=Ie.poly;if(Bt.indexOf(Te)===-1)if(Ie.isExterior)Et.push(Te);else{Bt.indexOf(Te)===-1&&Bt.push(Te);var At=Et.indexOf(Ie.poly);At!==-1&&Et.splice(At,1)}}for(var xt=0,qt=Et.length;xt<qt;xt++){var dn=Et[xt].multiPoly;ae.indexOf(dn)===-1&&ae.push(dn)}return this._afterState}},{key:"isInResult",value:function(){if(this.consumedBy)return!1;if(this._isInResult!==void 0)return this._isInResult;var H=this.beforeState().multiPolys,F=this.afterState().multiPolys;switch(It.type){case"union":{var Q=H.length===0,ae=F.length===0;this._isInResult=Q!==ae;break}case"intersection":{var q,Ae;H.length<F.length?(q=H.length,Ae=F.length):(q=F.length,Ae=H.length),this._isInResult=Ae===It.numMultiPolys&&q<Ae;break}case"xor":{var Pe=Math.abs(H.length-F.length);this._isInResult=Pe%2===1;break}case"difference":{var We=function(Et){return Et.length===1&&Et[0].isSubject};this._isInResult=We(H)!==We(F);break}default:throw new Error("Unrecognized operation type found ".concat(It.type))}return this._isInResult}}],[{key:"fromRing",value:function(H,F,Q){var ae,q,Ae,Pe=ht.comparePoints(H,F);if(Pe<0)ae=H,q=F,Ae=1;else if(Pe>0)ae=F,q=H,Ae=-1;else throw new Error("Tried to create degenerate segment at [".concat(H.x,", ").concat(H.y,"]"));var We=new ht(ae,!0),rt=new ht(q,!1);return new he(We,rt,[Q],[Ae])}}]),he}(),wt=function(){function he(B,H,F){if(n(this,he),!Array.isArray(B)||B.length===0)throw new Error("Input geometry is not a valid Polygon or MultiPolygon");if(this.poly=H,this.isExterior=F,this.segments=[],typeof B[0][0]!="number"||typeof B[0][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var Q=ue.round(B[0][0],B[0][1]);this.bbox={ll:{x:Q.x,y:Q.y},ur:{x:Q.x,y:Q.y}};for(var ae=Q,q=1,Ae=B.length;q<Ae;q++){if(typeof B[q][0]!="number"||typeof B[q][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var Pe=ue.round(B[q][0],B[q][1]);Pe.x===ae.x&&Pe.y===ae.y||(this.segments.push(hn.fromRing(ae,Pe,this)),Pe.x<this.bbox.ll.x&&(this.bbox.ll.x=Pe.x),Pe.y<this.bbox.ll.y&&(this.bbox.ll.y=Pe.y),Pe.x>this.bbox.ur.x&&(this.bbox.ur.x=Pe.x),Pe.y>this.bbox.ur.y&&(this.bbox.ur.y=Pe.y),ae=Pe)}(Q.x!==ae.x||Q.y!==ae.y)&&this.segments.push(hn.fromRing(ae,Q,this))}return t(he,[{key:"getSweepEvents",value:function(){for(var H=[],F=0,Q=this.segments.length;F<Q;F++){var ae=this.segments[F];H.push(ae.leftSE),H.push(ae.rightSE)}return H}}]),he}(),Ge=function(){function he(B,H){if(n(this,he),!Array.isArray(B))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");this.exteriorRing=new wt(B[0],this,!0),this.bbox={ll:{x:this.exteriorRing.bbox.ll.x,y:this.exteriorRing.bbox.ll.y},ur:{x:this.exteriorRing.bbox.ur.x,y:this.exteriorRing.bbox.ur.y}},this.interiorRings=[];for(var F=1,Q=B.length;F<Q;F++){var ae=new wt(B[F],this,!1);ae.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=ae.bbox.ll.x),ae.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=ae.bbox.ll.y),ae.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=ae.bbox.ur.x),ae.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=ae.bbox.ur.y),this.interiorRings.push(ae)}this.multiPoly=H}return t(he,[{key:"getSweepEvents",value:function(){for(var H=this.exteriorRing.getSweepEvents(),F=0,Q=this.interiorRings.length;F<Q;F++)for(var ae=this.interiorRings[F].getSweepEvents(),q=0,Ae=ae.length;q<Ae;q++)H.push(ae[q]);return H}}]),he}(),Gn=function(){function he(B,H){if(n(this,he),!Array.isArray(B))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");try{typeof B[0][0][0]=="number"&&(B=[B])}catch{}this.polys=[],this.bbox={ll:{x:Number.POSITIVE_INFINITY,y:Number.POSITIVE_INFINITY},ur:{x:Number.NEGATIVE_INFINITY,y:Number.NEGATIVE_INFINITY}};for(var F=0,Q=B.length;F<Q;F++){var ae=new Ge(B[F],this);ae.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=ae.bbox.ll.x),ae.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=ae.bbox.ll.y),ae.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=ae.bbox.ur.x),ae.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=ae.bbox.ur.y),this.polys.push(ae)}this.isSubject=H}return t(he,[{key:"getSweepEvents",value:function(){for(var H=[],F=0,Q=this.polys.length;F<Q;F++)for(var ae=this.polys[F].getSweepEvents(),q=0,Ae=ae.length;q<Ae;q++)H.push(ae[q]);return H}}]),he}(),Xt=function(){t(he,null,[{key:"factory",value:function(H){for(var F=[],Q=0,ae=H.length;Q<ae;Q++){var q=H[Q];if(!(!q.isInResult()||q.ringOut)){for(var Ae=null,Pe=q.leftSE,We=q.rightSE,rt=[Pe],Et=Pe.point,Bt=[];Ae=Pe,Pe=We,rt.push(Pe),Pe.point!==Et;)for(;;){var Lt=Pe.getAvailableLinkedEvents();if(Lt.length===0){var an=rt[0].point,Ie=rt[rt.length-1].point;throw new Error("Unable to complete output ring starting at [".concat(an.x,",")+" ".concat(an.y,"]. Last matching segment found ends at")+" [".concat(Ie.x,", ").concat(Ie.y,"]."))}if(Lt.length===1){We=Lt[0].otherSE;break}for(var Te=null,At=0,xt=Bt.length;At<xt;At++)if(Bt[At].point===Pe.point){Te=At;break}if(Te!==null){var qt=Bt.splice(Te)[0],dn=rt.splice(qt.index);dn.unshift(dn[0].otherSE),F.push(new he(dn.reverse()));continue}Bt.push({index:rt.length,point:Pe.point});var Ke=Pe.getLeftmostComparator(Ae);We=Lt.sort(Ke)[0].otherSE;break}F.push(new he(rt))}}return F}}]);function he(B){n(this,he),this.events=B;for(var H=0,F=B.length;H<F;H++)B[H].segment.ringOut=this;this.poly=null}return t(he,[{key:"getGeom",value:function(){for(var H=this.events[0].point,F=[H],Q=1,ae=this.events.length-1;Q<ae;Q++){var q=this.events[Q].point,Ae=this.events[Q+1].point;ne(q,H,Ae)!==0&&(F.push(q),H=q)}if(F.length===1)return null;var Pe=F[0],We=F[1];ne(Pe,H,We)===0&&F.shift(),F.push(F[0]);for(var rt=this.isExteriorRing()?1:-1,Et=this.isExteriorRing()?0:F.length-1,Bt=this.isExteriorRing()?F.length:-1,Lt=[],an=Et;an!=Bt;an+=rt)Lt.push([F[an].x,F[an].y]);return Lt}},{key:"isExteriorRing",value:function(){if(this._isExteriorRing===void 0){var H=this.enclosingRing();this._isExteriorRing=H?!H.isExteriorRing():!0}return this._isExteriorRing}},{key:"enclosingRing",value:function(){return this._enclosingRing===void 0&&(this._enclosingRing=this._calcEnclosingRing()),this._enclosingRing}},{key:"_calcEnclosingRing",value:function(){for(var H=this.events[0],F=1,Q=this.events.length;F<Q;F++){var ae=this.events[F];ht.compare(H,ae)>0&&(H=ae)}for(var q=H.segment.prevInResult(),Ae=q?q.prevInResult():null;;){if(!q)return null;if(!Ae)return q.ringOut;if(Ae.ringOut!==q.ringOut)return Ae.ringOut.enclosingRing()!==q.ringOut?q.ringOut:q.ringOut.enclosingRing();q=Ae.prevInResult(),Ae=q?q.prevInResult():null}}}]),he}(),ln=function(){function he(B){n(this,he),this.exteriorRing=B,B.poly=this,this.interiorRings=[]}return t(he,[{key:"addInterior",value:function(H){this.interiorRings.push(H),H.poly=this}},{key:"getGeom",value:function(){var H=[this.exteriorRing.getGeom()];if(H[0]===null)return null;for(var F=0,Q=this.interiorRings.length;F<Q;F++){var ae=this.interiorRings[F].getGeom();ae!==null&&H.push(ae)}return H}}]),he}(),Mn=function(){function he(B){n(this,he),this.rings=B,this.polys=this._composePolys(B)}return t(he,[{key:"getGeom",value:function(){for(var H=[],F=0,Q=this.polys.length;F<Q;F++){var ae=this.polys[F].getGeom();ae!==null&&H.push(ae)}return H}},{key:"_composePolys",value:function(H){for(var F=[],Q=0,ae=H.length;Q<ae;Q++){var q=H[Q];if(!q.poly)if(q.isExteriorRing())F.push(new ln(q));else{var Ae=q.enclosingRing();Ae.poly||F.push(new ln(Ae)),Ae.poly.addInterior(q)}}return F}}]),he}(),Ot=function(){function he(B){var H=arguments.length>1&&arguments[1]!==void 0?arguments[1]:hn.compare;n(this,he),this.queue=B,this.tree=new g(H),this.segments=[]}return t(he,[{key:"process",value:function(H){var F=H.segment,Q=[];if(H.consumedBy)return H.isLeft?this.queue.remove(H.otherSE):this.tree.remove(F),Q;var ae=H.isLeft?this.tree.insert(F):this.tree.find(F);if(!ae)throw new Error("Unable to find segment #".concat(F.id," ")+"[".concat(F.leftSE.point.x,", ").concat(F.leftSE.point.y,"] -> ")+"[".concat(F.rightSE.point.x,", ").concat(F.rightSE.point.y,"] ")+"in SweepLine tree. Please submit a bug report.");for(var q=ae,Ae=ae,Pe=void 0,We=void 0;Pe===void 0;)q=this.tree.prev(q),q===null?Pe=null:q.key.consumedBy===void 0&&(Pe=q.key);for(;We===void 0;)Ae=this.tree.next(Ae),Ae===null?We=null:Ae.key.consumedBy===void 0&&(We=Ae.key);if(H.isLeft){var rt=null;if(Pe){var Et=Pe.getIntersection(F);if(Et!==null&&(F.isAnEndpoint(Et)||(rt=Et),!Pe.isAnEndpoint(Et)))for(var Bt=this._splitSafely(Pe,Et),Lt=0,an=Bt.length;Lt<an;Lt++)Q.push(Bt[Lt])}var Ie=null;if(We){var Te=We.getIntersection(F);if(Te!==null&&(F.isAnEndpoint(Te)||(Ie=Te),!We.isAnEndpoint(Te)))for(var At=this._splitSafely(We,Te),xt=0,qt=At.length;xt<qt;xt++)Q.push(At[xt])}if(rt!==null||Ie!==null){var dn=null;if(rt===null)dn=Ie;else if(Ie===null)dn=rt;else{var Ke=ht.comparePoints(rt,Ie);dn=Ke<=0?rt:Ie}this.queue.remove(F.rightSE),Q.push(F.rightSE);for(var gt=F.split(dn),Tt=0,Rn=gt.length;Tt<Rn;Tt++)Q.push(gt[Tt])}Q.length>0?(this.tree.remove(F),Q.push(H)):(this.segments.push(F),F.prev=Pe)}else{if(Pe&&We){var Xn=Pe.getIntersection(We);if(Xn!==null){if(!Pe.isAnEndpoint(Xn))for(var nn=this._splitSafely(Pe,Xn),Lr=0,Qr=nn.length;Lr<Qr;Lr++)Q.push(nn[Lr]);if(!We.isAnEndpoint(Xn))for(var Tr=this._splitSafely(We,Xn),oe=0,V=Tr.length;oe<V;oe++)Q.push(Tr[oe])}}this.tree.remove(F)}return Q}},{key:"_splitSafely",value:function(H,F){this.tree.remove(H);var Q=H.rightSE;this.queue.remove(Q);var ae=H.split(F);return ae.push(Q),H.consumedBy===void 0&&this.tree.insert(H),ae}}]),he}(),En=typeof process<"u"&&{}.POLYGON_CLIPPING_MAX_QUEUE_SIZE||1e6,lt=typeof process<"u"&&{}.POLYGON_CLIPPING_MAX_SWEEPLINE_SEGMENTS||1e6,It=new(function(){function he(){n(this,he)}return t(he,[{key:"run",value:function(H,F,Q){It.type=H,ue.reset();for(var ae=[new Gn(F,!0)],q=0,Ae=Q.length;q<Ae;q++)ae.push(new Gn(Q[q],!1));if(It.numMultiPolys=ae.length,It.type==="difference")for(var Pe=ae[0],We=1;We<ae.length;)te(ae[We].bbox,Pe.bbox)!==null?We++:ae.splice(We,1);if(It.type==="intersection"){for(var rt=0,Et=ae.length;rt<Et;rt++)for(var Bt=ae[rt],Lt=rt+1,an=ae.length;Lt<an;Lt++)if(te(Bt.bbox,ae[Lt].bbox)===null)return[]}for(var Ie=new g(ht.compare),Te=0,At=ae.length;Te<At;Te++)for(var xt=ae[Te].getSweepEvents(),qt=0,dn=xt.length;qt<dn;qt++)if(Ie.insert(xt[qt]),Ie.size>En)throw new Error("Infinite loop when putting segment endpoints in a priority queue (queue size too big). Please file a bug report.");for(var Ke=new Ot(Ie),gt=Ie.size,Tt=Ie.pop();Tt;){var Rn=Tt.key;if(Ie.size===gt){var Xn=Rn.segment;throw new Error("Unable to pop() ".concat(Rn.isLeft?"left":"right"," SweepEvent ")+"[".concat(Rn.point.x,", ").concat(Rn.point.y,"] from segment #").concat(Xn.id," ")+"[".concat(Xn.leftSE.point.x,", ").concat(Xn.leftSE.point.y,"] -> ")+"[".concat(Xn.rightSE.point.x,", ").concat(Xn.rightSE.point.y,"] from queue. ")+"Please file a bug report.")}if(Ie.size>En)throw new Error("Infinite loop when passing sweep line over endpoints (queue size too big). Please file a bug report.");if(Ke.segments.length>lt)throw new Error("Infinite loop when passing sweep line over endpoints (too many sweep line segments). Please file a bug report.");for(var nn=Ke.process(Rn),Lr=0,Qr=nn.length;Lr<Qr;Lr++){var Tr=nn[Lr];Tr.consumedBy===void 0&&Ie.insert(Tr)}gt=Ie.size,Tt=Ie.pop()}ue.reset();var oe=Xt.factory(Ke.segments),V=new Mn(oe);return V.getGeom()}}]),he}());return{union:function(B){for(var H=arguments.length,F=new Array(H>1?H-1:0),Q=1;Q<H;Q++)F[Q-1]=arguments[Q];return It.run("union",B,F)},intersection:function(B){for(var H=arguments.length,F=new Array(H>1?H-1:0),Q=1;Q<H;Q++)F[Q-1]=arguments[Q];return It.run("intersection",B,F)},xor:function(B){for(var H=arguments.length,F=new Array(H>1?H-1:0),Q=1;Q<H;Q++)F[Q-1]=arguments[Q];return It.run("xor",B,F)},difference:function(B){for(var H=arguments.length,F=new Array(H>1?H-1:0),Q=1;Q<H;Q++)F[Q-1]=arguments[Q];return It.run("difference",B,F)}}}(),UF.exports),qxe=dd(Gxe);function $xe(n,e,t){return t===void 0&&(t={}),n=BF(n),e=BF(e),n=qxe.intersection(n.coordinates,e.coordinates),n.length===0?null:n.length===1?Vxe(n[0],t.properties):Hxe(n,t.properties)}var Wxe=function(n){return function(e,t,r){var i=r.value,o=new Map;return r.value=function(){var a=this,l=arguments;!o.get(a)&&(i.apply(a,l),o.set(a,!0),setTimeout(function(){return o.delete(a)},n))},r}},Yxe=window&&window.__decorate||function(n,e,t,r){var i,o=arguments.length,a=o<3?e:r===null?r=Object.getOwnPropertyDescriptor(e,t):r;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(n,e,t,r);else for(var l=n.length-1;0<=l;l--)(i=n[l])&&(a=(o<3?i(a):3<o?i(e,t,a):i(e,t))||a);return 3<o&&a&&Object.defineProperty(e,t,a),a},RP=window&&window.__read||function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var r,i,o=t.call(n),a=[];try{for(;(e===void 0||0<e--)&&!(r=o.next()).done;)a.push(r.value)}catch(l){i={error:l}}finally{try{r&&!r.done&&(t=o.return)&&t.call(o)}finally{if(i)throw i.error}}return a},kP=window&&window.__spreadArray||function(n,e,t){if(t||arguments.length===2)for(var r,i=0,o=e.length;i<o;i++)!r&&i in e||((r=r||Array.prototype.slice.call(e,0,i))[i]=e[i]);return n.concat(r||Array.prototype.slice.call(e))},Kxe=["DIV","SPAN","A"],OP=["data-azure-maps-attribution-minzoom","data-azure-maps-attribution-maxzoom","data-azure-maps-attribution-geometry","data-azure-maps-attribution-tileset","data-azure-maps-attribution-order","data-azure-maps-attribution-dynamic"],Zxe=kP(["href"],RP(OP),!1),zF=function(){function n(e,t){var r=this;this.lastFetchState={bounds:null,zoom:null},this.getElement=function(){return r.element},this.element=e,this.attributionChangeCallback=t}return n.prototype.equals=function(e){return this.stringRepresentation===e.stringRepresentation},Object.defineProperty(n.prototype,"stringRepresentation",{get:function(){return[this.minZoom!==void 0?"minzoom=".concat(this.minZoom):"",this.maxZoom!==void 0?"maxzoom=".concat(this.maxZoom):"",this.geometry!==void 0?this.element.attributes.getNamedItem("data-azure-maps-attribution-geometry").value:"",this.tilesetId!==void 0?"tilesetId=".concat(this.tilesetId):"",this.dynamic?"dynamic":""].filter(function(e){return 0<e.length}).join(";")},enumerable:!1,configurable:!0}),n.applicable=function(e){return Array.from(e.attributes).map(function(t){return OP.includes(t.name)}).reduce(function(t,r){return t||r},!1)},Object.defineProperty(n.prototype,"minZoom",{get:function(){var e=this.element.attributes.getNamedItem("data-azure-maps-attribution-minzoom");return e&&!isNaN(e.value)?parseInt(e.value):void 0},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"maxZoom",{get:function(){var e=this.element.attributes.getNamedItem("data-azure-maps-attribution-maxzoom");return e&&!isNaN(e.value)?parseInt(e.value):void 0},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"geometry",{get:function(){var e=this.element.attributes.getNamedItem("data-azure-maps-attribution-geometry");if(e&&e.value)try{return JSON.parse(e.value)}catch{}},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"tilesetId",{get:function(){var e=this.element.attributes.getNamedItem("data-azure-maps-attribution-tileset");return e&&e.value?e.value:void 0},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"order",{get:function(){var e=this.element.attributes.getNamedItem("data-azure-maps-attribution-order");return e&&!isNaN(e.value)?parseInt(e.value):void 0},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"dynamic",{get:function(){return this.element.attributes.getNamedItem("data-azure-maps-attribution-dynamic")!==null},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"hidesElement",{get:function(){return this.element.style.display=="none"},enumerable:!1,configurable:!0}),n.prototype.forceHide=function(){this.element.style.display="none"},n.prototype.satisfied=function(e){var t=!this.minZoom||!e.zoom||e.zoom>=this.minZoom,r=!this.maxZoom||!e.zoom||e.zoom<=this.maxZoom,i=!0;return this.geometry&&e.bounds&&(i=$xe({type:"Feature",geometry:this.geometry,properties:{}},{type:"Feature",geometry:{type:"Polygon",coordinates:[[lr.getNorthWest(e.bounds),lr.getNorthEast(e.bounds),lr.getSouthEast(e.bounds),lr.getSouthWest(e.bounds),lr.getNorthWest(e.bounds)]]},properties:{}})!==null),t&&r&&i},n.prototype.apply=function(e,l){var r=this,i=(l===void 0&&(l=null),this.satisfied(e.getCamera())),o=this.dynamic&&this.tilesetId,a=this.hidesElement,l=l&&["dragend","zoomend","pitchend"].includes(l.type);return i||a?i&&(a||o)&&(i&&a&&this.element.style.removeProperty("display"),o)&&(l?e.events.addOnce("idle",function(h){return r.fetchAndApplyDynamicAttribution(e)}):this.fetchAndApplyDynamicAttribution(e)):this.element.style.display="none",i===a},n.prototype.fetchAndApplyDynamicAttribution=function(e){var t,r,i,o=this,a=e.getCamera();this.lastFetchState&&lr.containsBoundingBox(this.lastFetchState.bounds,a.bounds)&&Math.floor(this.lastFetchState.zoom)==Math.floor(a.zoom)||(t=pI(a.center,lr.getSouthWest(a.bounds),n.viewportBufferExpansionRatio),i=((r=pI(a.center,lr.getNorthEast(a.bounds),n.viewportBufferExpansionRatio))[0]<t[0]?[[t[0],t[1],180,r[1]],[-180,t[1],r[0],r[1]]]:[[t[0],t[1],r[0],r[1]]]).map(function(h){var h=new URLSearchParams({"api-version":"2.1",tilesetId:o.tilesetId,zoom:a.zoom!==void 0?"".concat(Math.floor(a.zoom)):void 0,bounds:h.join(",")}),g="".concat("https://{{azMapsDomain}}","/map/attribution"),p={url:g,headers:{}},g=(e._substituteDomainLanguageViewAndSignInRequest(g,p),"".concat(p.url).concat(p.url.includes("?")?"&":"?").concat(h.toString()));return e._sendRequest(g,"Attribution",p.headers).then(function(_){return _.json()})}),Promise.all(i).then(function(l){o.applyAttributionResponse(l),o.lastFetchState={bounds:new lr([t[0],t[1],r[0],r[1]]),zoom:a.zoom}}).catch(function(l){return console.error(l)}))},n.prototype.applyAttributionResponse=function(a){var t,r,i,o=this,a=a.map(function(l){return l.copyrights||[]}).reduce(function(l,h){return kP(kP([],RP(l),!1),RP(h),!1)},[]);a.length!=0&&((a=bT.parseWithFilter(a.join(""),function(l){return!0},function(l){return l},function(){return o.element.innerHTML="",o.element}))===null?console.warn("Dynamic attribution is empty after filtering"):(t=typeof a=="string"?((t=document.createElement("span")).innerHTML=a,t):a,i=t===this.element?(r=document.createElement("span"),Array.from(this.element.childNodes).forEach(function(l){return r.appendChild(l)}),r):t,Array.from(this.element.attributes).filter(function(l){return OP.includes(l.name)}).forEach(function(l){return i.attributes.setNamedItem(l.cloneNode())}),i.style.display=this.element.style.display,a=this.element.parentElement,this.element.remove(),a.append(i),this.element=i,this.attributionChangeCallback(this)))},n.viewportBufferExpansionRatio=2,Yxe([Wxe(1e3)],n.prototype,"fetchAndApplyDynamicAttribution",null),n}(),wh=window&&window.__read||function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var r,i,o=t.call(n),a=[];try{for(;(e===void 0||0<e--)&&!(r=o.next()).done;)a.push(r.value)}catch(l){i={error:l}}finally{try{r&&!r.done&&(t=o.return)&&t.call(o)}finally{if(i)throw i.error}}return a},Lg=window&&window.__spreadArray||function(n,e,t){if(t||arguments.length===2)for(var r,i=0,o=e.length;i<o;i++)!r&&i in e||((r=r||Array.prototype.slice.call(e,0,i))[i]=e[i]);return n.concat(r||Array.prototype.slice.call(e))},Xxe=[/all rights reserved/gi],Qxe=function(){function n(e,t,r){var i,o=this;this.rules=[],this.virtualContext=((i=document.createElement("span")).className="azure-map-copyright-context",i),this.renderContext=this.virtualContext.cloneNode(!1),this.addAttributionFromSource=function(a){},this.removeAttributionFromSource=function(a){},this.getMapStyleVisibleSources=function(){var a=o.map._getMap(),l=a.getStyle();return Object.entries(l.sources).filter(function(h){var p=wh(h,1)[0];return l.layers.filter(function(g){return g&&g.source==p}).reduce(function(g,_){return!(_.layout&&_.layout.visibility==="none"||_.paint&&_.paint["icon-opacity"]===0&&_.paint["text-opacity"]===0)||g},!1)}).map(function(h){return h=wh(h,1)[0],a.getSource(h)})},this.loadAttributionOnceSourcesLoaded=function(){var a=o.getMapStyleVisibleSources();Promise.all(a.map(function(l){return new Promise(function(h,p){var g;"tiles"in l||(l==null?void 0:l.type)==="geojson"?h(l):((g=l).on("data",function _(x){x.sourceDataType=="metadata"&&(g.off("data",_),h(l))}),g.on("error",function _(x){g.off("error",_),p(x)}))}).then(function(h){return{status:"fulfilled",value:h}}).catch(function(h){return{status:"rejected",reason:h}})})).then(function(l){o.reloadAttribution()})},this.reloadAttribution=function(){var h=o.getMapStyleVisibleSources(),a=new Set,l={},h=h.filter(function(C){return"attribution"in C&&C.attribution&&"tiles"in C&&C.tiles instanceof Array&&0<C.tiles.length}).map(function(C){return bT.parseWithFilter((C=C.attribution)!=null?C:"",function(M){return Kxe.includes(M.tagName)&&Array.from(M.attributes).map(function(L){return Zxe.includes(L.name)}).reduce(function(L,D){return L&&D},!0)},function(M){var L,D=null;return M instanceof HTMLElement&&zF.applicable(M)&&(D=new zF(M,function(){return o.renderAttribution()}),a.add(D),D.order!==void 0)&&(M.style.order="".concat(D.order)),D&&M instanceof HTMLElement&&(!((L=D.stringRepresentation)in l)||D.order!==void 0&&l[L].order!==void 0&&D.order<l[L].order||D.order!==void 0&&l[L].order===void 0)&&(l[L]=D),M},function(){return document.createElement("span")})}),p=new Set(Object.values(l)),_=new Set(Lg([],wh(a),!1).filter(function(C){return!p.has(C)})),g=new Set(Lg([],wh(_),!1).map(function(C){return C.getElement()})),_=(Lg([],wh(g),!1).filter(function(C){return C.parentElement!==null}).forEach(function(C){return C.parentElement.removeChild(C)}),o.rules=Object.values(l),h.filter(function(C){return typeof C=="string"||!g.has(C)}).map(function(C){return typeof C=="string"?new Text(C):C})),x=document.createElement("span");0<_.length?_.forEach(function(C){return x.appendChild(C)}):o.getDefaultAttribution().forEach(function(C){return x.appendChild(C)}),o.virtualContext=x,o.copyrightControl.setOptions({copyrightContent:o.renderContext}),o.applyRules(),o.renderAttribution()},this.applyRules=function(a){a===void 0&&(a=null),o.rules.reduce(function(l,h){return h=h.apply(o.map,a),l||h},!1)&&o.renderAttribution()},this.renderAttribution=function(){var a=function(p){return Array.from(p.style.display!="none"?p.children:[]).map(function(g){return a(g)}).reduce(function(g,_){return Lg(Lg([],wh(g),!1),wh(_),!1)},Array.from(p.style.display!="none"?p.childNodes:[]).filter(function(g){return g.nodeType==g.TEXT_NODE}))},l=o.virtualContext.cloneNode(!0),h=a(l);h.forEach(function(p){return p.textContent=Lg([],wh(Xxe),!1).reduce(function(g,_){return g.replace(_,"").trim()},p.textContent)}),h.reduce(function(p,g){return p.has(g.textContent)?(g.textContent="",g.parentElement&&g.parentElement.removeChild(g)):p.add(g.textContent),p},new Set),o.renderContext.innerHTML="",Array.from(l.childNodes).forEach(function(p){return o.renderContext.appendChild(p)})},this.map=e,this.copyrightControl=t,this.options=r}return n.prototype.addToMap=function(){this.map.events.add("stylechanged",this.loadAttributionOnceSourcesLoaded),this.map.events.add("dragend",this.applyRules),this.map.events.add("zoomend",this.applyRules),this.map.events.add("pitchend",this.applyRules)},n.prototype.removeFromMap=function(){this.map.events.remove("stylechanged",this.loadAttributionOnceSourcesLoaded),this.map.events.remove("dragend",this.applyRules),this.map.events.remove("zoomend",this.applyRules),this.map.events.remove("pitchend",this.applyRules)},n.prototype.getDefaultAttribution=function(){return this.copyrightControl.getDefaultAttributions().map(function(e){return e=e,(t=document.createElement("a")).textContent=e,t;var t})},n}(),IV=function(n,e){return(IV=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(t,r){t.__proto__=r}:function(t,r){for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(t[i]=r[i])}))(n,e)};function ia(n,e){function t(){this.constructor=n}IV(n,e),n.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}var bn=function(){return(bn=Object.assign||function(n){for(var e,t=1,r=arguments.length;t<r;t++)for(var i in e=arguments[t])Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i]);return n}).apply(this,arguments)};function jF(n,e){var t={};for(i in n)Object.prototype.hasOwnProperty.call(n,i)&&e.indexOf(i)<0&&(t[i]=n[i]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(n);r<i.length;r++)e.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(n,i[r])&&(t[i[r]]=n[i[r]]);return t}function ft(n,e,t,r){return new(t=t||Promise)(function(i,o){function a(p){try{h(r.next(p))}catch(g){o(g)}}function l(p){try{h(r.throw(p))}catch(g){o(g)}}function h(p){var g;p.done?i(p.value):((g=p.value)instanceof t?g:new t(function(_){_(g)})).then(a,l)}h((r=r.apply(n,e||[])).next())})}function pt(n,e){var t,r,i,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]},a={next:l(0),throw:l(1),return:l(2)};return typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function l(h){return function(p){var g=[h,p];if(t)throw new TypeError("Generator is already executing.");for(;o;)try{if(t=1,r&&(i=2&g[0]?r.return:g[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,g[1])).done)return i;switch(r=0,(g=i?[2&g[0],i.value]:g)[0]){case 0:case 1:i=g;break;case 4:return o.label++,{value:g[1],done:!1};case 5:o.label++,r=g[1],g=[0];continue;case 7:g=o.ops.pop(),o.trys.pop();continue;default:if(!(i=0<(i=o.trys).length&&i[i.length-1])&&(g[0]===6||g[0]===2)){o=0;continue}if(g[0]===3&&(!i||g[1]>i[0]&&g[1]<i[3]))o.label=g[1];else if(g[0]===6&&o.label<i[1])o.label=i[1],i=g;else{if(!(i&&o.label<i[2])){i[2]&&o.ops.pop(),o.trys.pop();continue}o.label=i[2],o.ops.push(g)}}g=e.call(n,o)}catch(_){g=[6,_],r=0}finally{t=i=0}if(5&g[0])throw g[1];return{value:g[0]?g[1]:void 0,done:!0}}}}function Jxe(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var r,i,o=t.call(n),a=[];try{for(;(e===void 0||0<e--)&&!(r=o.next()).done;)a.push(r.value)}catch(l){i={error:l}}finally{try{r&&!r.done&&(t=o.return)&&t.call(o)}finally{if(i)throw i.error}}return a}function ok(){for(var n=[],e=0;e<arguments.length;e++)n=n.concat(Jxe(arguments[e]));return n}var PV=function(n,e){return(PV=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(t,r){t.__proto__=r}:function(t,r){for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(t[i]=r[i])}))(n,e)};function us(n,e){function t(){this.constructor=n}PV(n,e),n.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}var Yr=function(){return(Yr=Object.assign||function(n){for(var e,t=1,r=arguments.length;t<r;t++)for(var i in e=arguments[t])Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i]);return n}).apply(this,arguments)};function Vn(n,e,t,r){return new(t=t||Promise)(function(i,o){function a(p){try{h(r.next(p))}catch(g){o(g)}}function l(p){try{h(r.throw(p))}catch(g){o(g)}}function h(p){var g;p.done?i(p.value):((g=p.value)instanceof t?g:new t(function(_){_(g)})).then(a,l)}h((r=r.apply(n,e||[])).next())})}function Hn(n,e){var t,r,i,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]},a={next:l(0),throw:l(1),return:l(2)};return typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function l(h){return function(p){var g=[h,p];if(t)throw new TypeError("Generator is already executing.");for(;o;)try{if(t=1,r&&(i=2&g[0]?r.return:g[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,g[1])).done)return i;switch(r=0,(g=i?[2&g[0],i.value]:g)[0]){case 0:case 1:i=g;break;case 4:return o.label++,{value:g[1],done:!1};case 5:o.label++,r=g[1],g=[0];continue;case 7:g=o.ops.pop(),o.trys.pop();continue;default:if(!(i=0<(i=o.trys).length&&i[i.length-1])&&(g[0]===6||g[0]===2)){o=0;continue}if(g[0]===3&&(!i||g[1]>i[0]&&g[1]<i[3]))o.label=g[1];else if(g[0]===6&&o.label<i[1])o.label=i[1],i=g;else{if(!(i&&o.label<i[2])){i[2]&&o.ops.pop(),o.trys.pop();continue}o.label=i[2],o.ops.push(g)}}g=e.call(n,o)}catch(_){g=[6,_],r=0}finally{t=i=0}if(5&g[0])throw g[1];return{value:g[0]?g[1]:void 0,done:!0}}}}function FT(){for(var n=0,e=0,t=arguments.length;e<t;e++)n+=arguments[e].length;for(var r=Array(n),i=0,e=0;e<t;e++)for(var o=arguments[e],a=0,l=o.length;a<l;a++,i++)r[i]=o[a];return r}var Fs,Eo,Bf,Yn,lm,o0,DE,FE,nu,So,In,cu,Xs,Kr,BE,um,Mh,a0,Bh,LP,Oo,W0,Pa,Ne={LIBRARY_NAME:"MSAL.JS",SKU:"msal.js.common",CACHE_PREFIX:"msal",DEFAULT_AUTHORITY:"https://login.microsoftonline.com/common/",DEFAULT_AUTHORITY_HOST:"login.microsoftonline.com",DEFAULT_COMMON_TENANT:"common",ADFS:"adfs",DSTS:"dstsv2",AAD_INSTANCE_DISCOVERY_ENDPT:"https://login.microsoftonline.com/common/discovery/instance?api-version=1.1&authorization_endpoint=",CIAM_AUTH_URL:".ciamlogin.com",AAD_TENANT_DOMAIN_SUFFIX:".onmicrosoft.com",RESOURCE_DELIM:"|",NO_ACCOUNT:"NO_ACCOUNT",CLAIMS:"claims",CONSUMER_UTID:"9188040d-6c67-4c5b-b112-36a304b66dad",OPENID_SCOPE:"openid",PROFILE_SCOPE:"profile",OFFLINE_ACCESS_SCOPE:"offline_access",EMAIL_SCOPE:"email",CODE_RESPONSE_TYPE:"code",CODE_GRANT_TYPE:"authorization_code",RT_GRANT_TYPE:"refresh_token",FRAGMENT_RESPONSE_MODE:"fragment",S256_CODE_CHALLENGE_METHOD:"S256",URL_FORM_CONTENT_TYPE:"application/x-www-form-urlencoded;charset=utf-8",AUTHORIZATION_PENDING:"authorization_pending",NOT_DEFINED:"not_defined",EMPTY_STRING:"",NOT_APPLICABLE:"N/A",FORWARD_SLASH:"/",IMDS_ENDPOINT:"http://169.254.169.254/metadata/instance/compute/location",IMDS_VERSION:"2020-06-01",IMDS_TIMEOUT:2e3,AZURE_REGION_AUTO_DISCOVER_FLAG:"TryAutoDetect",REGIONAL_AUTH_PUBLIC_CLOUD_SUFFIX:"login.microsoft.com",REGIONAL_AUTH_NON_MSI_QUERY_STRING:"allowestsrnonmsi=true",KNOWN_PUBLIC_CLOUDS:["login.microsoftonline.com","login.windows.net","login.microsoft.com","sts.windows.net"],TOKEN_RESPONSE_TYPE:"token",ID_TOKEN_RESPONSE_TYPE:"id_token",SHR_NONCE_VALIDITY:240,INVALID_INSTANCE:"invalid_instance"},Eb=[Ne.OPENID_SCOPE,Ne.PROFILE_SCOPE,Ne.OFFLINE_ACCESS_SCOPE],VF=FT(Eb,[Ne.EMAIL_SCOPE]),ya=(function(n){n.CONTENT_TYPE="Content-Type",n.RETRY_AFTER="Retry-After",n.CCS_HEADER="X-AnchorMailbox",n.WWWAuthenticate="WWW-Authenticate",n.AuthenticationInfo="Authentication-Info",n.X_MS_REQUEST_ID="x-ms-request-id",n.X_MS_HTTP_VERSION="x-ms-httpver"}(Fs=Fs||{}),function(n){n.ID_TOKEN="idtoken",n.CLIENT_INFO="client.info",n.ADAL_ID_TOKEN="adal.idtoken",n.ERROR="error",n.ERROR_DESC="error.description",n.ACTIVE_ACCOUNT="active-account",n.ACTIVE_ACCOUNT_FILTERS="active-account-filters"}(Eo=Eo||{}),function(n){n.COMMON="common",n.ORGANIZATIONS="organizations",n.CONSUMERS="consumers"}(Bf=Bf||{}),function(n){n.CLIENT_ID="client_id",n.REDIRECT_URI="redirect_uri",n.RESPONSE_TYPE="response_type",n.RESPONSE_MODE="response_mode",n.GRANT_TYPE="grant_type",n.CLAIMS="claims",n.SCOPE="scope",n.ERROR="error",n.ERROR_DESCRIPTION="error_description",n.ACCESS_TOKEN="access_token",n.ID_TOKEN="id_token",n.REFRESH_TOKEN="refresh_token",n.EXPIRES_IN="expires_in",n.STATE="state",n.NONCE="nonce",n.PROMPT="prompt",n.SESSION_STATE="session_state",n.CLIENT_INFO="client_info",n.CODE="code",n.CODE_CHALLENGE="code_challenge",n.CODE_CHALLENGE_METHOD="code_challenge_method",n.CODE_VERIFIER="code_verifier",n.CLIENT_REQUEST_ID="client-request-id",n.X_CLIENT_SKU="x-client-SKU",n.X_CLIENT_VER="x-client-VER",n.X_CLIENT_OS="x-client-OS",n.X_CLIENT_CPU="x-client-CPU",n.X_CLIENT_CURR_TELEM="x-client-current-telemetry",n.X_CLIENT_LAST_TELEM="x-client-last-telemetry",n.X_MS_LIB_CAPABILITY="x-ms-lib-capability",n.X_APP_NAME="x-app-name",n.X_APP_VER="x-app-ver",n.POST_LOGOUT_URI="post_logout_redirect_uri",n.ID_TOKEN_HINT="id_token_hint",n.DEVICE_CODE="device_code",n.CLIENT_SECRET="client_secret",n.CLIENT_ASSERTION="client_assertion",n.CLIENT_ASSERTION_TYPE="client_assertion_type",n.TOKEN_TYPE="token_type",n.REQ_CNF="req_cnf",n.OBO_ASSERTION="assertion",n.REQUESTED_TOKEN_USE="requested_token_use",n.ON_BEHALF_OF="on_behalf_of",n.FOCI="foci",n.CCS_HEADER="X-AnchorMailbox",n.RETURN_SPA_CODE="return_spa_code",n.NATIVE_BROKER="nativebroker",n.LOGOUT_HINT="logout_hint"}(Yn=Yn||{}),function(n){n.ACCESS_TOKEN="access_token",n.XMS_CC="xms_cc"}(lm=lm||{}),{LOGIN:"login",SELECT_ACCOUNT:"select_account",CONSENT:"consent",NONE:"none",CREATE:"create",NO_SESSION:"no_session"}),HF=(function(n){n.ACCOUNT="account",n.SID="sid",n.LOGIN_HINT="login_hint",n.ID_TOKEN="id_token",n.DOMAIN_HINT="domain_hint",n.ORGANIZATIONS="organizations",n.CONSUMERS="consumers",n.ACCOUNT_ID="accountIdentifier",n.HOMEACCOUNT_ID="homeAccountIdentifier"}(o0=o0||{}),{PLAIN:"plain",S256:"S256"}),NP=(function(n){n.QUERY="query",n.FRAGMENT="fragment",n.FORM_POST="form_post"}(DE=DE||{}),function(n){n.IMPLICIT_GRANT="implicit",n.AUTHORIZATION_CODE_GRANT="authorization_code",n.CLIENT_CREDENTIALS_GRANT="client_credentials",n.RESOURCE_OWNER_PASSWORD_GRANT="password",n.REFRESH_TOKEN_GRANT="refresh_token",n.DEVICE_CODE_GRANT="device_code",n.JWT_BEARER="urn:ietf:params:oauth:grant-type:jwt-bearer"}(FE=FE||{}),function(n){n.MSSTS_ACCOUNT_TYPE="MSSTS",n.ADFS_ACCOUNT_TYPE="ADFS",n.MSAV1_ACCOUNT_TYPE="MSA",n.GENERIC_ACCOUNT_TYPE="Generic"}(nu=nu||{}),function(n){n.CACHE_KEY_SEPARATOR="-",n.CLIENT_INFO_SEPARATOR="."}(So=So||{}),function(n){n.ID_TOKEN="IdToken",n.ACCESS_TOKEN="AccessToken",n.ACCESS_TOKEN_WITH_AUTH_SCHEME="AccessToken_With_AuthScheme",n.REFRESH_TOKEN="RefreshToken"}(In=In||{}),function(n){n[n.ADFS=1001]="ADFS",n[n.MSA=1002]="MSA",n[n.MSSTS=1003]="MSSTS",n[n.GENERIC=1004]="GENERIC",n[n.ACCESS_TOKEN=2001]="ACCESS_TOKEN",n[n.REFRESH_TOKEN=2002]="REFRESH_TOKEN",n[n.ID_TOKEN=2003]="ID_TOKEN",n[n.APP_METADATA=3001]="APP_METADATA",n[n.UNDEFINED=9999]="UNDEFINED"}(cu=cu||{}),"appmetadata"),eEe="client_info",s0="1",c0={CACHE_KEY:"authority-metadata",REFRESH_TIME_SECONDS:86400},Wo=(function(n){n.CONFIG="config",n.CACHE="cache",n.NETWORK="network",n.HARDCODED_VALUES="hardcoded_values"}(Xs=Xs||{}),{SCHEMA_VERSION:5,MAX_CUR_HEADER_BYTES:80,MAX_LAST_HEADER_BYTES:330,MAX_CACHED_ERRORS:50,CACHE_KEY:"server-telemetry",CATEGORY_SEPARATOR:"|",VALUE_SEPARATOR:",",OVERFLOW_TRUE:"1",OVERFLOW_FALSE:"0",UNKNOWN_ERROR:"unknown_error"}),l0=(function(n){n.BEARER="Bearer",n.POP="pop",n.SSH="ssh-cert"}(Kr=Kr||{}),{DEFAULT_THROTTLE_TIME_SECONDS:60,DEFAULT_MAX_THROTTLE_TIME_SECONDS:3600,THROTTLING_PREFIX:"throttling",X_MS_LIB_CAPABILITY_VALUE:"retry-after, h429"}),GF={INVALID_GRANT_ERROR:"invalid_grant",CLIENT_MISMATCH_ERROR:"client_mismatch"},xw=(function(n){n.username="username",n.password="password"}(BE=BE||{}),function(n){n[n.httpSuccess=200]="httpSuccess",n[n.httpBadRequest=400]="httpBadRequest"}(um=um||{}),function(n){n.FAILED_AUTO_DETECTION="1",n.INTERNAL_CACHE="2",n.ENVIRONMENT_VARIABLE="3",n.IMDS="4"}(Mh=Mh||{}),function(n){n.CONFIGURED_MATCHES_DETECTED="1",n.CONFIGURED_NO_AUTO_DETECTION="2",n.CONFIGURED_NOT_DETECTED="3",n.AUTO_DETECTION_REQUESTED_SUCCESSFUL="4",n.AUTO_DETECTION_REQUESTED_FAILED="5"}(a0=a0||{}),function(n){n.NO_CACHE_HIT="0",n.FORCE_REFRESH="1",n.NO_CACHED_ACCESS_TOKEN="2",n.CACHED_ACCESS_TOKEN_EXPIRED="3",n.REFRESH_CACHED_ACCESS_TOKEN="4",n.CLAIMS_REQUESTED_CACHE_SKIPPED="5"}(Bh=Bh||{}),function(n){n.Jwt="JWT",n.Jwk="JWK",n.Pop="pop"}(LP=LP||{}),{unexpectedError:{code:"unexpected_error",desc:"Unexpected error in authentication."},postRequestFailed:{code:"post_request_failed",desc:"Post request failed from the network, could be a 4xx/5xx or a network unavailability. Please check the exact error code for details."}}),xn=function(n){function e(t,r,i){var o=this,o=n.call(this,r?t+": "+r:t)||this;return Object.setPrototypeOf(o,e.prototype),o.errorCode=t||Ne.EMPTY_STRING,o.errorMessage=r||Ne.EMPTY_STRING,o.subError=i||Ne.EMPTY_STRING,o.name="AuthError",o}return us(e,n),e.prototype.setCorrelationId=function(t){this.correlationId=t},e.createUnexpectedError=function(t){return new e(xw.unexpectedError.code,xw.unexpectedError.desc+": "+t)},e.createPostRequestFailed=function(t){return new e(xw.postRequestFailed.code,xw.postRequestFailed.desc+": "+t)},e}(Error),UE={createNewGuid:function(){throw xn.createUnexpectedError("Crypto interface - createNewGuid() has not been implemented")},base64Decode:function(){throw xn.createUnexpectedError("Crypto interface - base64Decode() has not been implemented")},base64Encode:function(){throw xn.createUnexpectedError("Crypto interface - base64Encode() has not been implemented")},generatePkceCodes:function(){return Vn(this,void 0,void 0,function(){return Hn(this,function(n){throw xn.createUnexpectedError("Crypto interface - generatePkceCodes() has not been implemented")})})},getPublicKeyThumbprint:function(){return Vn(this,void 0,void 0,function(){return Hn(this,function(n){throw xn.createUnexpectedError("Crypto interface - getPublicKeyThumbprint() has not been implemented")})})},removeTokenBindingKey:function(){return Vn(this,void 0,void 0,function(){return Hn(this,function(n){throw xn.createUnexpectedError("Crypto interface - removeTokenBindingKey() has not been implemented")})})},clearKeystore:function(){return Vn(this,void 0,void 0,function(){return Hn(this,function(n){throw xn.createUnexpectedError("Crypto interface - clearKeystore() has not been implemented")})})},signJwt:function(){return Vn(this,void 0,void 0,function(){return Hn(this,function(n){throw xn.createUnexpectedError("Crypto interface - signJwt() has not been implemented")})})},hashString:function(){return Vn(this,void 0,void 0,function(){return Hn(this,function(n){throw xn.createUnexpectedError("Crypto interface - hashString() has not been implemented")})})}},Mt={clientInfoDecodingError:{code:"client_info_decoding_error",desc:"The client info could not be parsed/decoded correctly. Please review the trace to determine the root cause."},clientInfoEmptyError:{code:"client_info_empty_error",desc:"The client info was empty. Please review the trace to determine the root cause."},tokenParsingError:{code:"token_parsing_error",desc:"Token cannot be parsed. Please review stack trace to determine root cause."},nullOrEmptyToken:{code:"null_or_empty_token",desc:"The token is null or empty. Please review the trace to determine the root cause."},endpointResolutionError:{code:"endpoints_resolution_error",desc:"Error: could not resolve endpoints. Please check network and try again."},networkError:{code:"network_error",desc:"Network request failed. Please check network trace to determine root cause."},unableToGetOpenidConfigError:{code:"openid_config_error",desc:"Could not retrieve endpoints. Check your authority and verify the .well-known/openid-configuration endpoint returns the required endpoints."},hashNotDeserialized:{code:"hash_not_deserialized",desc:"The hash parameters could not be deserialized. Please review the trace to determine the root cause."},blankGuidGenerated:{code:"blank_guid_generated",desc:"The guid generated was blank. Please review the trace to determine the root cause."},invalidStateError:{code:"invalid_state",desc:"State was not the expected format. Please check the logs to determine whether the request was sent using ProtocolUtils.setRequestState()."},stateMismatchError:{code:"state_mismatch",desc:"State mismatch error. Please check your network. Continued requests may cause cache overflow."},stateNotFoundError:{code:"state_not_found",desc:"State not found"},nonceMismatchError:{code:"nonce_mismatch",desc:"Nonce mismatch error. This may be caused by a race condition in concurrent requests."},nonceNotFoundError:{code:"nonce_not_found",desc:"nonce not found"},authTimeNotFoundError:{code:"auth_time_not_found",desc:"Max Age was requested and the ID token is missing the auth_time variable. auth_time is an optional claim and is not enabled by default - it must be enabled. See https://aka.ms/msaljs/optional-claims for more information."},maxAgeTranspiredError:{code:"max_age_transpired",desc:"Max Age is set to 0, or too much time has elapsed since the last end-user authentication."},noTokensFoundError:{code:"no_tokens_found",desc:"No tokens were found for the given scopes, and no authorization code was passed to acquireToken. You must retrieve an authorization code before making a call to acquireToken()."},multipleMatchingTokens:{code:"multiple_matching_tokens",desc:"The cache contains multiple tokens satisfying the requirements. Call AcquireToken again providing more requirements such as authority or account."},multipleMatchingAccounts:{code:"multiple_matching_accounts",desc:"The cache contains multiple accounts satisfying the given parameters. Please pass more info to obtain the correct account"},multipleMatchingAppMetadata:{code:"multiple_matching_appMetadata",desc:"The cache contains multiple appMetadata satisfying the given parameters. Please pass more info to obtain the correct appMetadata"},tokenRequestCannotBeMade:{code:"request_cannot_be_made",desc:"Token request cannot be made without authorization code or refresh token."},appendEmptyScopeError:{code:"cannot_append_empty_scope",desc:"Cannot append null or empty scope to ScopeSet. Please check the stack trace for more info."},removeEmptyScopeError:{code:"cannot_remove_empty_scope",desc:"Cannot remove null or empty scope from ScopeSet. Please check the stack trace for more info."},appendScopeSetError:{code:"cannot_append_scopeset",desc:"Cannot append ScopeSet due to error."},emptyInputScopeSetError:{code:"empty_input_scopeset",desc:"Empty input ScopeSet cannot be processed."},DeviceCodePollingCancelled:{code:"device_code_polling_cancelled",desc:"Caller has cancelled token endpoint polling during device code flow by setting DeviceCodeRequest.cancel = true."},DeviceCodeExpired:{code:"device_code_expired",desc:"Device code is expired."},DeviceCodeUnknownError:{code:"device_code_unknown_error",desc:"Device code stopped polling for unknown reasons."},NoAccountInSilentRequest:{code:"no_account_in_silent_request",desc:"Please pass an account object, silent flow is not supported without account information"},invalidCacheRecord:{code:"invalid_cache_record",desc:"Cache record object was null or undefined."},invalidCacheEnvironment:{code:"invalid_cache_environment",desc:"Invalid environment when attempting to create cache entry"},noAccountFound:{code:"no_account_found",desc:"No account found in cache for given key."},CachePluginError:{code:"no cache plugin set on CacheManager",desc:"ICachePlugin needs to be set before using readFromStorage or writeFromStorage"},noCryptoObj:{code:"no_crypto_object",desc:"No crypto object detected. This is required for the following operation: "},invalidCacheType:{code:"invalid_cache_type",desc:"Invalid cache type"},unexpectedAccountType:{code:"unexpected_account_type",desc:"Unexpected account type."},unexpectedCredentialType:{code:"unexpected_credential_type",desc:"Unexpected credential type."},invalidAssertion:{code:"invalid_assertion",desc:"Client assertion must meet requirements described in https://tools.ietf.org/html/rfc7515"},invalidClientCredential:{code:"invalid_client_credential",desc:"Client credential (secret, certificate, or assertion) must not be empty when creating a confidential client. An application should at most have one credential"},tokenRefreshRequired:{code:"token_refresh_required",desc:"Cannot return token from cache because it must be refreshed. This may be due to one of the following reasons: forceRefresh parameter is set to true, claims have been requested, there is no cached access token or it is expired."},userTimeoutReached:{code:"user_timeout_reached",desc:"User defined timeout for device code polling reached"},tokenClaimsRequired:{code:"token_claims_cnf_required_for_signedjwt",desc:"Cannot generate a POP jwt if the token_claims are not populated"},noAuthorizationCodeFromServer:{code:"authorization_code_missing_from_server_response",desc:"Server response does not contain an authorization code to proceed"},noAzureRegionDetected:{code:"no_azure_region_detected",desc:"No azure region was detected and no fallback was made available"},accessTokenEntityNullError:{code:"access_token_entity_null",desc:"Access token entity is null, please check logs and cache to ensure a valid access token is present."},bindingKeyNotRemovedError:{code:"binding_key_not_removed",desc:"Could not remove the credential's binding key from storage."},logoutNotSupported:{code:"end_session_endpoint_not_supported",desc:"Provided authority does not support logout."},keyIdMissing:{code:"key_id_missing",desc:"A keyId value is missing from the requested bound token's cache record and is required to match the token to it's stored binding key."},noNetworkConnectivity:{code:"no_network_connectivity",desc:"No network connectivity. Check your internet connection."},userCanceledError:{code:"user_canceled",desc:"User canceled the flow."}},tn=function(n){function e(t,r){return t=n.call(this,t,r)||this,t.name="ClientAuthError",Object.setPrototypeOf(t,e.prototype),t}return us(e,n),e.createClientInfoDecodingError=function(t){return new e(Mt.clientInfoDecodingError.code,Mt.clientInfoDecodingError.desc+" Failed with error: "+t)},e.createClientInfoEmptyError=function(){return new e(Mt.clientInfoEmptyError.code,""+Mt.clientInfoEmptyError.desc)},e.createTokenParsingError=function(t){return new e(Mt.tokenParsingError.code,Mt.tokenParsingError.desc+" Failed with error: "+t)},e.createTokenNullOrEmptyError=function(t){return new e(Mt.nullOrEmptyToken.code,Mt.nullOrEmptyToken.desc+" Raw Token Value: "+t)},e.createEndpointDiscoveryIncompleteError=function(t){return new e(Mt.endpointResolutionError.code,Mt.endpointResolutionError.desc+" Detail: "+t)},e.createNetworkError=function(t,r){return new e(Mt.networkError.code,Mt.networkError.desc+" | Fetch client threw: "+r+" | Attempted to reach: "+t.split("?")[0])},e.createUnableToGetOpenidConfigError=function(t){return new e(Mt.unableToGetOpenidConfigError.code,Mt.unableToGetOpenidConfigError.desc+" Attempted to retrieve endpoints from: "+t)},e.createHashNotDeserializedError=function(t){return new e(Mt.hashNotDeserialized.code,Mt.hashNotDeserialized.desc+" Given Object: "+t)},e.createInvalidStateError=function(t,r){return new e(Mt.invalidStateError.code,Mt.invalidStateError.desc+" Invalid State: "+t+", Root Err: "+r)},e.createStateMismatchError=function(){return new e(Mt.stateMismatchError.code,Mt.stateMismatchError.desc)},e.createStateNotFoundError=function(t){return new e(Mt.stateNotFoundError.code,Mt.stateNotFoundError.desc+":  "+t)},e.createNonceMismatchError=function(){return new e(Mt.nonceMismatchError.code,Mt.nonceMismatchError.desc)},e.createAuthTimeNotFoundError=function(){return new e(Mt.authTimeNotFoundError.code,Mt.authTimeNotFoundError.desc)},e.createMaxAgeTranspiredError=function(){return new e(Mt.maxAgeTranspiredError.code,Mt.maxAgeTranspiredError.desc)},e.createNonceNotFoundError=function(t){return new e(Mt.nonceNotFoundError.code,Mt.nonceNotFoundError.desc+":  "+t)},e.createMultipleMatchingTokensInCacheError=function(){return new e(Mt.multipleMatchingTokens.code,Mt.multipleMatchingTokens.desc+".")},e.createMultipleMatchingAccountsInCacheError=function(){return new e(Mt.multipleMatchingAccounts.code,Mt.multipleMatchingAccounts.desc)},e.createMultipleMatchingAppMetadataInCacheError=function(){return new e(Mt.multipleMatchingAppMetadata.code,Mt.multipleMatchingAppMetadata.desc)},e.createTokenRequestCannotBeMadeError=function(){return new e(Mt.tokenRequestCannotBeMade.code,Mt.tokenRequestCannotBeMade.desc)},e.createAppendEmptyScopeToSetError=function(t){return new e(Mt.appendEmptyScopeError.code,Mt.appendEmptyScopeError.desc+" Given Scope: "+t)},e.createRemoveEmptyScopeFromSetError=function(t){return new e(Mt.removeEmptyScopeError.code,Mt.removeEmptyScopeError.desc+" Given Scope: "+t)},e.createAppendScopeSetError=function(t){return new e(Mt.appendScopeSetError.code,Mt.appendScopeSetError.desc+" Detail Error: "+t)},e.createEmptyInputScopeSetError=function(){return new e(Mt.emptyInputScopeSetError.code,""+Mt.emptyInputScopeSetError.desc)},e.createDeviceCodeCancelledError=function(){return new e(Mt.DeviceCodePollingCancelled.code,""+Mt.DeviceCodePollingCancelled.desc)},e.createDeviceCodeExpiredError=function(){return new e(Mt.DeviceCodeExpired.code,""+Mt.DeviceCodeExpired.desc)},e.createDeviceCodeUnknownError=function(){return new e(Mt.DeviceCodeUnknownError.code,""+Mt.DeviceCodeUnknownError.desc)},e.createNoAccountInSilentRequestError=function(){return new e(Mt.NoAccountInSilentRequest.code,""+Mt.NoAccountInSilentRequest.desc)},e.createNullOrUndefinedCacheRecord=function(){return new e(Mt.invalidCacheRecord.code,Mt.invalidCacheRecord.desc)},e.createInvalidCacheEnvironmentError=function(){return new e(Mt.invalidCacheEnvironment.code,Mt.invalidCacheEnvironment.desc)},e.createNoAccountFoundError=function(){return new e(Mt.noAccountFound.code,Mt.noAccountFound.desc)},e.createCachePluginError=function(){return new e(Mt.CachePluginError.code,""+Mt.CachePluginError.desc)},e.createNoCryptoObjectError=function(t){return new e(Mt.noCryptoObj.code,""+Mt.noCryptoObj.desc+t)},e.createInvalidCacheTypeError=function(){return new e(Mt.invalidCacheType.code,""+Mt.invalidCacheType.desc)},e.createUnexpectedAccountTypeError=function(){return new e(Mt.unexpectedAccountType.code,""+Mt.unexpectedAccountType.desc)},e.createUnexpectedCredentialTypeError=function(){return new e(Mt.unexpectedCredentialType.code,""+Mt.unexpectedCredentialType.desc)},e.createInvalidAssertionError=function(){return new e(Mt.invalidAssertion.code,""+Mt.invalidAssertion.desc)},e.createInvalidCredentialError=function(){return new e(Mt.invalidClientCredential.code,""+Mt.invalidClientCredential.desc)},e.createRefreshRequiredError=function(){return new e(Mt.tokenRefreshRequired.code,Mt.tokenRefreshRequired.desc)},e.createUserTimeoutReachedError=function(){return new e(Mt.userTimeoutReached.code,Mt.userTimeoutReached.desc)},e.createTokenClaimsRequiredError=function(){return new e(Mt.tokenClaimsRequired.code,Mt.tokenClaimsRequired.desc)},e.createNoAuthCodeInServerResponseError=function(){return new e(Mt.noAuthorizationCodeFromServer.code,Mt.noAuthorizationCodeFromServer.desc)},e.createBindingKeyNotRemovedError=function(){return new e(Mt.bindingKeyNotRemovedError.code,Mt.bindingKeyNotRemovedError.desc)},e.createLogoutNotSupportedError=function(){return new e(Mt.logoutNotSupported.code,Mt.logoutNotSupported.desc)},e.createKeyIdMissingError=function(){return new e(Mt.keyIdMissing.code,Mt.keyIdMissing.desc)},e.createNoNetworkConnectivityError=function(){return new e(Mt.noNetworkConnectivity.code,Mt.noNetworkConnectivity.desc)},e.createUserCanceledError=function(){return new e(Mt.userCanceledError.code,Mt.userCanceledError.desc)},e}(xn),Zt=function(){function n(){}return n.decodeAuthToken=function(e){if(n.isEmpty(e))throw tn.createTokenNullOrEmptyError(e);var t=/^([^\.\s]*)\.([^\.\s]+)\.([^\.\s]*)$/.exec(e);if(!t||t.length<4)throw tn.createTokenParsingError("Given token is malformed: "+JSON.stringify(e));return{header:t[1],JWSPayload:t[2],JWSSig:t[3]}},n.isEmpty=function(e){return e===void 0||!e||e.length===0},n.isEmptyObj=function(e){if(e&&!n.isEmpty(e))try{var t=JSON.parse(e);return Object.keys(t).length===0}catch{}return!0},n.startsWith=function(e,t){return e.indexOf(t)===0},n.endsWith=function(e,t){return e.length>=t.length&&e.lastIndexOf(t)===e.length-t.length},n.queryStringToObject=function(i){function t(o){return decodeURIComponent(o.replace(/\+/g," "))}var r={},i=i.split("&");return i.forEach(function(o){var a;o.trim()&&(a=(o=o.split(/=(.+)/g,2))[0],o=o[1],a)&&o&&(r[t(a)]=t(o))}),r},n.trimArrayEntries=function(e){return e.map(function(t){return t.trim()})},n.removeEmptyStringsFromArray=function(e){return e.filter(function(t){return!n.isEmpty(t)})},n.jsonParseHelper=function(e){try{return JSON.parse(e)}catch{return null}},n.matchPattern=function(e,t){return new RegExp(e.replace(/\\/g,"\\\\").replace(/\*/g,"[^ ]*").replace(/\?/g,"\\?")).test(t)},n}(),ak=(function(n){n[n.Error=0]="Error",n[n.Warning=1]="Warning",n[n.Info=2]="Info",n[n.Verbose=3]="Verbose",n[n.Trace=4]="Trace"}(Oo=Oo||{}),function(){function n(e,t,r){this.level=Oo.Info,e=e||n.createDefaultLoggerOptions(),this.localCallback=e.loggerCallback||function(){},this.piiLoggingEnabled=e.piiLoggingEnabled||!1,this.level=typeof e.logLevel=="number"?e.logLevel:Oo.Info,this.correlationId=e.correlationId||Ne.EMPTY_STRING,this.packageName=t||Ne.EMPTY_STRING,this.packageVersion=r||Ne.EMPTY_STRING}return n.createDefaultLoggerOptions=function(){return{loggerCallback:function(){},piiLoggingEnabled:!1,logLevel:Oo.Info}},n.prototype.clone=function(e,t,r){return new n({loggerCallback:this.localCallback,piiLoggingEnabled:this.piiLoggingEnabled,logLevel:this.level,correlationId:r||this.correlationId},e,t)},n.prototype.logMessage=function(e,t){var r;t.logLevel>this.level||!this.piiLoggingEnabled&&t.containsPii||(r=new Date().toUTCString(),r=(Zt.isEmpty(t.correlationId)?Zt.isEmpty(this.correlationId)?"["+r+"]":"["+r+"] : ["+this.correlationId+"]":"["+r+"] : ["+t.correlationId+"]")+" : "+this.packageName+"@"+this.packageVersion+" : "+Oo[t.logLevel]+" - "+e,this.executeCallback(t.logLevel,r,t.containsPii||!1))},n.prototype.executeCallback=function(e,t,r){this.localCallback&&this.localCallback(e,t,r)},n.prototype.error=function(e,t){this.logMessage(e,{logLevel:Oo.Error,containsPii:!1,correlationId:t||Ne.EMPTY_STRING})},n.prototype.errorPii=function(e,t){this.logMessage(e,{logLevel:Oo.Error,containsPii:!0,correlationId:t||Ne.EMPTY_STRING})},n.prototype.warning=function(e,t){this.logMessage(e,{logLevel:Oo.Warning,containsPii:!1,correlationId:t||Ne.EMPTY_STRING})},n.prototype.warningPii=function(e,t){this.logMessage(e,{logLevel:Oo.Warning,containsPii:!0,correlationId:t||Ne.EMPTY_STRING})},n.prototype.info=function(e,t){this.logMessage(e,{logLevel:Oo.Info,containsPii:!1,correlationId:t||Ne.EMPTY_STRING})},n.prototype.infoPii=function(e,t){this.logMessage(e,{logLevel:Oo.Info,containsPii:!0,correlationId:t||Ne.EMPTY_STRING})},n.prototype.verbose=function(e,t){this.logMessage(e,{logLevel:Oo.Verbose,containsPii:!1,correlationId:t||Ne.EMPTY_STRING})},n.prototype.verbosePii=function(e,t){this.logMessage(e,{logLevel:Oo.Verbose,containsPii:!0,correlationId:t||Ne.EMPTY_STRING})},n.prototype.trace=function(e,t){this.logMessage(e,{logLevel:Oo.Trace,containsPii:!1,correlationId:t||Ne.EMPTY_STRING})},n.prototype.tracePii=function(e,t){this.logMessage(e,{logLevel:Oo.Trace,containsPii:!0,correlationId:t||Ne.EMPTY_STRING})},n.prototype.isPiiLoggingEnabled=function(){return this.piiLoggingEnabled||!1},n}()),MV="@azure/msal-common",sk="13.3.1",zn=(function(n){n[n.None=0]="None",n.AzurePublic="https://login.microsoftonline.com",n.AzurePpe="https://login.windows-ppe.net",n.AzureChina="https://login.chinacloudapi.cn",n.AzureGermany="https://login.microsoftonline.de",n.AzureUsGovernment="https://login.microsoftonline.us"}(W0=W0||{}),{redirectUriNotSet:{code:"redirect_uri_empty",desc:"A redirect URI is required for all calls, and none has been set."},postLogoutUriNotSet:{code:"post_logout_uri_empty",desc:"A post logout redirect has not been set."},claimsRequestParsingError:{code:"claims_request_parsing_error",desc:"Could not parse the given claims request object."},authorityUriInsecure:{code:"authority_uri_insecure",desc:"Authority URIs must use https.  Please see here for valid authority configuration options: https://docs.microsoft.com/en-us/azure/active-directory/develop/msal-js-initializing-client-applications#configuration-options"},urlParseError:{code:"url_parse_error",desc:"URL could not be parsed into appropriate segments."},urlEmptyError:{code:"empty_url_error",desc:"URL was empty or null."},emptyScopesError:{code:"empty_input_scopes_error",desc:"Scopes cannot be passed as null, undefined or empty array because they are required to obtain an access token."},nonArrayScopesError:{code:"nonarray_input_scopes_error",desc:"Scopes cannot be passed as non-array."},clientIdSingleScopeError:{code:"clientid_input_scopes_error",desc:"Client ID can only be provided as a single scope."},invalidPrompt:{code:"invalid_prompt_value",desc:"Supported prompt values are 'login', 'select_account', 'consent', 'create', 'none' and 'no_session'.  Please see here for valid configuration options: https://azuread.github.io/microsoft-authentication-library-for-js/ref/modules/_azure_msal_common.html#commonauthorizationurlrequest"},invalidClaimsRequest:{code:"invalid_claims",desc:"Given claims parameter must be a stringified JSON object."},tokenRequestEmptyError:{code:"token_request_empty",desc:"Token request was empty and not found in cache."},logoutRequestEmptyError:{code:"logout_request_empty",desc:"The logout request was null or undefined."},invalidCodeChallengeMethod:{code:"invalid_code_challenge_method",desc:'code_challenge_method passed is invalid. Valid values are "plain" and "S256".'},invalidCodeChallengeParams:{code:"pkce_params_missing",desc:"Both params: code_challenge and code_challenge_method are to be passed if to be sent in the request"},invalidCloudDiscoveryMetadata:{code:"invalid_cloud_discovery_metadata",desc:"Invalid cloudDiscoveryMetadata provided. Must be a stringified JSON object containing tenant_discovery_endpoint and metadata fields"},invalidAuthorityMetadata:{code:"invalid_authority_metadata",desc:"Invalid authorityMetadata provided. Must by a stringified JSON object containing authorization_endpoint, token_endpoint, issuer fields."},untrustedAuthority:{code:"untrusted_authority",desc:"The provided authority is not a trusted authority. Please include this authority in the knownAuthorities config parameter."},invalidAzureCloudInstance:{code:"invalid_azure_cloud_instance",desc:"Invalid AzureCloudInstance provided. Please refer MSAL JS docs: aks.ms/msaljs/azure_cloud_instance for valid values"},missingSshJwk:{code:"missing_ssh_jwk",desc:"Missing sshJwk in SSH certificate request. A stringified JSON Web Key is required when using the SSH authentication scheme."},missingSshKid:{code:"missing_ssh_kid",desc:"Missing sshKid in SSH certificate request. A string that uniquely identifies the public SSH key is required when using the SSH authentication scheme."},missingNonceAuthenticationHeader:{code:"missing_nonce_authentication_header",desc:"Unable to find an authentication header containing server nonce. Either the Authentication-Info or WWW-Authenticate headers must be present in order to obtain a server nonce."},invalidAuthenticationHeader:{code:"invalid_authentication_header",desc:"Invalid authentication header provided"},authorityMismatch:{code:"authority_mismatch",desc:"Authority mismatch error. Authority provided in login request or PublicClientApplication config does not match the environment of the provided account. Please use a matching account or make an interactive request to login to this authority."}}),vi=function(n){function e(t,r){return t=n.call(this,t,r)||this,t.name="ClientConfigurationError",Object.setPrototypeOf(t,e.prototype),t}return us(e,n),e.createRedirectUriEmptyError=function(){return new e(zn.redirectUriNotSet.code,zn.redirectUriNotSet.desc)},e.createPostLogoutRedirectUriEmptyError=function(){return new e(zn.postLogoutUriNotSet.code,zn.postLogoutUriNotSet.desc)},e.createClaimsRequestParsingError=function(t){return new e(zn.claimsRequestParsingError.code,zn.claimsRequestParsingError.desc+" Given value: "+t)},e.createInsecureAuthorityUriError=function(t){return new e(zn.authorityUriInsecure.code,zn.authorityUriInsecure.desc+" Given URI: "+t)},e.createUrlParseError=function(t){return new e(zn.urlParseError.code,zn.urlParseError.desc+" Given Error: "+t)},e.createUrlEmptyError=function(){return new e(zn.urlEmptyError.code,zn.urlEmptyError.desc)},e.createEmptyScopesArrayError=function(){return new e(zn.emptyScopesError.code,""+zn.emptyScopesError.desc)},e.createClientIdSingleScopeError=function(t){return new e(zn.clientIdSingleScopeError.code,zn.clientIdSingleScopeError.desc+" Given Scopes: "+t)},e.createInvalidPromptError=function(t){return new e(zn.invalidPrompt.code,zn.invalidPrompt.desc+" Given value: "+t)},e.createInvalidClaimsRequestError=function(){return new e(zn.invalidClaimsRequest.code,zn.invalidClaimsRequest.desc)},e.createEmptyLogoutRequestError=function(){return new e(zn.logoutRequestEmptyError.code,zn.logoutRequestEmptyError.desc)},e.createEmptyTokenRequestError=function(){return new e(zn.tokenRequestEmptyError.code,zn.tokenRequestEmptyError.desc)},e.createInvalidCodeChallengeMethodError=function(){return new e(zn.invalidCodeChallengeMethod.code,zn.invalidCodeChallengeMethod.desc)},e.createInvalidCodeChallengeParamsError=function(){return new e(zn.invalidCodeChallengeParams.code,zn.invalidCodeChallengeParams.desc)},e.createInvalidCloudDiscoveryMetadataError=function(){return new e(zn.invalidCloudDiscoveryMetadata.code,zn.invalidCloudDiscoveryMetadata.desc)},e.createInvalidAuthorityMetadataError=function(){return new e(zn.invalidAuthorityMetadata.code,zn.invalidAuthorityMetadata.desc)},e.createUntrustedAuthorityError=function(){return new e(zn.untrustedAuthority.code,zn.untrustedAuthority.desc)},e.createInvalidAzureCloudInstanceError=function(){return new e(zn.invalidAzureCloudInstance.code,zn.invalidAzureCloudInstance.desc)},e.createMissingSshJwkError=function(){return new e(zn.missingSshJwk.code,zn.missingSshJwk.desc)},e.createMissingSshKidError=function(){return new e(zn.missingSshKid.code,zn.missingSshKid.desc)},e.createMissingNonceAuthenticationHeadersError=function(){return new e(zn.missingNonceAuthenticationHeader.code,zn.missingNonceAuthenticationHeader.desc)},e.createInvalidAuthenticationHeaderError=function(t,r){return new e(zn.invalidAuthenticationHeader.code,zn.invalidAuthenticationHeader.desc+". Invalid header: "+t+". Details: "+r)},e.createAuthorityMismatchError=function(){return new e(zn.authorityMismatch.code,zn.authorityMismatch.desc)},e}(tn),pa=function(){function n(r){var t=this,r=r?Zt.trimArrayEntries(FT(r)):[],r=r?Zt.removeEmptyStringsFromArray(r):[];this.validateInputScopes(r),this.scopes=new Set,r.forEach(function(i){return t.scopes.add(i)})}return n.fromString=function(e){return new n((e||Ne.EMPTY_STRING).split(" "))},n.createSearchScopes=function(e){return e=new n(e),e.containsOnlyOIDCScopes()?e.removeScope(Ne.OFFLINE_ACCESS_SCOPE):e.removeOIDCScopes(),e},n.prototype.validateInputScopes=function(e){if(!e||e.length<1)throw vi.createEmptyScopesArrayError()},n.prototype.containsScope=function(e){var t=new n(this.printScopesLowerCase().split(" "));return!Zt.isEmpty(e)&&t.scopes.has(e.toLowerCase())},n.prototype.containsScopeSet=function(e){var t=this;return!(!e||e.scopes.size<=0)&&this.scopes.size>=e.scopes.size&&e.asArray().every(function(r){return t.containsScope(r)})},n.prototype.containsOnlyOIDCScopes=function(){var e=this,t=0;return VF.forEach(function(r){e.containsScope(r)&&(t+=1)}),this.scopes.size===t},n.prototype.appendScope=function(e){Zt.isEmpty(e)||this.scopes.add(e.trim())},n.prototype.appendScopes=function(e){var t=this;try{e.forEach(function(r){return t.appendScope(r)})}catch(r){throw tn.createAppendScopeSetError(r)}},n.prototype.removeScope=function(e){if(Zt.isEmpty(e))throw tn.createRemoveEmptyScopeFromSetError(e);this.scopes.delete(e.trim())},n.prototype.removeOIDCScopes=function(){var e=this;VF.forEach(function(t){e.scopes.delete(t)})},n.prototype.unionScopeSets=function(e){var t;if(e)return t=new Set,e.scopes.forEach(function(r){return t.add(r.toLowerCase())}),this.scopes.forEach(function(r){return t.add(r.toLowerCase())}),t;throw tn.createEmptyInputScopeSetError()},n.prototype.intersectingScopeSets=function(r){if(!r)throw tn.createEmptyInputScopeSetError();r.containsOnlyOIDCScopes()||r.removeOIDCScopes();var t=this.unionScopeSets(r),r=r.getScopeCount(),i=this.getScopeCount();return t.size<i+r},n.prototype.getScopeCount=function(){return this.scopes.size},n.prototype.asArray=function(){var e=[];return this.scopes.forEach(function(t){return e.push(t)}),e},n.prototype.printScopes=function(){return this.scopes?this.asArray().join(" "):Ne.EMPTY_STRING},n.prototype.printScopesLowerCase=function(){return this.printScopes().toLowerCase()},n}();function zE(n,e){if(Zt.isEmpty(n))throw tn.createClientInfoEmptyError();try{var t=e.base64Decode(n);return JSON.parse(t)}catch(r){throw tn.createClientInfoDecodingError(r.message)}}function hm(n){if(Zt.isEmpty(n))throw tn.createClientInfoDecodingError("Home account ID was empty.");return n=n.split(So.CLIENT_INFO_SEPARATOR,2),{uid:n[0],utid:n.length<2?Ne.EMPTY_STRING:n[1]}}(function(n){n[n.Default=0]="Default",n[n.Adfs=1]="Adfs",n[n.Dsts=2]="Dsts",n[n.Ciam=3]="Ciam"})(Pa=Pa||{});var Qo=function(){function n(){}return n.prototype.generateAccountId=function(){return[this.homeAccountId,this.environment].join(So.CACHE_KEY_SEPARATOR).toLowerCase()},n.prototype.generateAccountKey=function(){return n.generateAccountCacheKey({homeAccountId:this.homeAccountId,environment:this.environment,tenantId:this.realm,username:this.username,localAccountId:this.localAccountId})},n.prototype.generateType=function(){switch(this.authorityType){case nu.ADFS_ACCOUNT_TYPE:return cu.ADFS;case nu.MSAV1_ACCOUNT_TYPE:return cu.MSA;case nu.MSSTS_ACCOUNT_TYPE:return cu.MSSTS;case nu.GENERIC_ACCOUNT_TYPE:return cu.GENERIC;default:throw tn.createUnexpectedAccountTypeError()}},n.prototype.getAccountInfo=function(){return{homeAccountId:this.homeAccountId,environment:this.environment,tenantId:this.realm,username:this.username,localAccountId:this.localAccountId,name:this.name,idTokenClaims:this.idTokenClaims,nativeAccountId:this.nativeAccountId}},n.generateAccountCacheKey=function(e){return[e.homeAccountId,e.environment||Ne.EMPTY_STRING,e.tenantId||Ne.EMPTY_STRING].join(So.CACHE_KEY_SEPARATOR).toLowerCase()},n.createAccount=function(g,t,r,i,o,a,l,h){var p=new n,g=(p.authorityType=nu.MSSTS_ACCOUNT_TYPE,p.clientInfo=g,p.homeAccountId=t,p.nativeAccountId=h,l||i&&i.getPreferredCache());if(g)return p.environment=g,p.realm=((t=r==null?void 0:r.claims)==null?void 0:t.tid)||Ne.EMPTY_STRING,r&&(p.idTokenClaims=r.claims,p.localAccountId=((h=r==null?void 0:r.claims)==null?void 0:h.oid)||((l=r==null?void 0:r.claims)==null?void 0:l.sub)||Ne.EMPTY_STRING,g=(i=r==null?void 0:r.claims)==null?void 0:i.preferred_username,h=(t=r==null?void 0:r.claims)!=null&&t.emails?r.claims.emails[0]:null,p.username=g||h||Ne.EMPTY_STRING,p.name=(l=r==null?void 0:r.claims)==null?void 0:l.name),p.cloudGraphHostName=o,p.msGraphHost=a,p;throw tn.createInvalidCacheEnvironmentError()},n.createGenericAccount=function(h,t,r,i,o,a){var l=new n,h=(l.authorityType=r&&r.authorityType===Pa.Adfs?nu.ADFS_ACCOUNT_TYPE:nu.GENERIC_ACCOUNT_TYPE,l.homeAccountId=h,l.realm=Ne.EMPTY_STRING,a||r&&r.getPreferredCache());if(h)return t&&(l.localAccountId=((a=t==null?void 0:t.claims)==null?void 0:a.oid)||((r=t==null?void 0:t.claims)==null?void 0:r.sub)||Ne.EMPTY_STRING,l.username=((a=t==null?void 0:t.claims)==null?void 0:a.upn)||Ne.EMPTY_STRING,l.name=((r=t==null?void 0:t.claims)==null?void 0:r.name)||Ne.EMPTY_STRING,l.idTokenClaims=t==null?void 0:t.claims),l.environment=h,l.cloudGraphHostName=i,l.msGraphHost=o,l;throw tn.createInvalidCacheEnvironmentError()},n.generateHomeAccountId=function(e,t,r,i,o){var a=(a=o==null?void 0:o.claims)!=null&&a.sub?o.claims.sub:Ne.EMPTY_STRING;if(t!==Pa.Adfs&&t!==Pa.Dsts){if(e)try{var l=zE(e,i);if(!Zt.isEmpty(l.uid)&&!Zt.isEmpty(l.utid))return""+l.uid+So.CLIENT_INFO_SEPARATOR+l.utid}catch{}r.verbose("No client info in response")}return a},n.isAccountEntity=function(e){return!!e&&e.hasOwnProperty("homeAccountId")&&e.hasOwnProperty("environment")&&e.hasOwnProperty("realm")&&e.hasOwnProperty("localAccountId")&&e.hasOwnProperty("username")&&e.hasOwnProperty("authorityType")},n.accountInfoIsEqual=function(e,t,r){var i,o;return!(!e||!t)&&(o=!0,r&&(r=e.idTokenClaims||{},i=t.idTokenClaims||{},o=r.iat===i.iat&&r.nonce===i.nonce),e.homeAccountId===t.homeAccountId)&&e.localAccountId===t.localAccountId&&e.username===t.username&&e.tenantId===t.tenantId&&e.environment===t.environment&&e.nativeAccountId===t.nativeAccountId&&o},n}(),Pl=function(){function n(e,t){if(Zt.isEmpty(e))throw tn.createTokenNullOrEmptyError(e);this.rawToken=e,this.claims=n.extractTokenClaims(e,t)}return n.extractTokenClaims=function(e,t){e=Zt.decodeAuthToken(e);try{var r=e.JWSPayload,i=t.base64Decode(r);return JSON.parse(i)}catch(o){throw tn.createTokenParsingError(o)}},n.checkMaxAge=function(e,t){if(t===0||Date.now()-3e5>e+t)throw tn.createMaxAgeTranspiredError()},n}(),Ka=function(){function n(e,t,r){this.clientId=e,this.cryptoImpl=t,this.commonLogger=r.clone(MV,sk)}return n.prototype.getAllAccounts=function(){var e=this,t=this.getAccountKeys();return t.length<1||(t=t.reduce(function(r,i){return i=e.getAccount(i),i&&r.push(i),r},[])).length<1?[]:t.map(function(r){return e.getAccountInfoFromEntity(r)})},n.prototype.getAccountInfoFilteredBy=function(e){return e=this.getAccountsFilteredBy(e),0<e.length?this.getAccountInfoFromEntity(e[0]):null},n.prototype.getAccountInfoFromEntity=function(t){var t=t.getAccountInfo(),r=this.getIdToken(t);return r&&(t.idToken=r.secret,t.idTokenClaims=new Pl(r.secret,this.cryptoImpl).claims),t},n.prototype.saveCacheRecord=function(e){return Vn(this,void 0,void 0,function(){return Hn(this,function(t){switch(t.label){case 0:if(e)return e.account&&this.setAccount(e.account),e.idToken&&this.setIdTokenCredential(e.idToken),e.accessToken?[4,this.saveAccessToken(e.accessToken)]:[3,2];throw tn.createNullOrUndefinedCacheRecord();case 1:t.sent(),t.label=2;case 2:return e.refreshToken&&this.setRefreshTokenCredential(e.refreshToken),e.appMetadata&&this.setAppMetadata(e.appMetadata),[2]}})})},n.prototype.saveAccessToken=function(e){return Vn(this,void 0,void 0,function(){var t,r,i,o,a=this;return Hn(this,function(l){switch(l.label){case 0:return t={clientId:e.clientId,credentialType:e.credentialType,environment:e.environment,homeAccountId:e.homeAccountId,realm:e.realm,tokenType:e.tokenType,requestedClaimsHash:e.requestedClaimsHash},r=this.getTokenKeys(),i=pa.fromString(e.target),o=[],r.accessToken.forEach(function(h){var p;a.accessTokenKeyMatchesFilter(h,t,!1)&&(p=a.getAccessTokenCredential(h))&&a.credentialMatchesFilter(p,t)&&pa.fromString(p.target).intersectingScopeSets(i)&&o.push(a.removeAccessToken(h))}),[4,Promise.all(o)];case 1:return l.sent(),this.setAccessTokenCredential(e),[2]}})})},n.prototype.getAccountsFilteredBy=function(e){var t=this,r=this.getAccountKeys(),i=[];return r.forEach(function(o){!t.isAccountKey(o,e.homeAccountId,e.realm)||!(o=t.getAccount(o))||e.homeAccountId&&!t.matchHomeAccountId(o,e.homeAccountId)||e.localAccountId&&!t.matchLocalAccountId(o,e.localAccountId)||e.username&&!t.matchUsername(o,e.username)||e.environment&&!t.matchEnvironment(o,e.environment)||e.realm&&!t.matchRealm(o,e.realm)||e.nativeAccountId&&!t.matchNativeAccountId(o,e.nativeAccountId)||i.push(o)}),i},n.prototype.isAccountKey=function(e,t,r){return!(e.split(So.CACHE_KEY_SEPARATOR).length<3||t&&!e.toLowerCase().includes(t.toLowerCase())||r&&!e.toLowerCase().includes(r.toLowerCase()))},n.prototype.isCredentialKey=function(e){if(e.split(So.CACHE_KEY_SEPARATOR).length<6||(e=e.toLowerCase(),e.indexOf(In.ID_TOKEN.toLowerCase())===-1&&e.indexOf(In.ACCESS_TOKEN.toLowerCase())===-1&&e.indexOf(In.ACCESS_TOKEN_WITH_AUTH_SCHEME.toLowerCase())===-1&&e.indexOf(In.REFRESH_TOKEN.toLowerCase())===-1))return!1;if(-1<e.indexOf(In.REFRESH_TOKEN.toLowerCase())){var t=""+In.REFRESH_TOKEN+So.CACHE_KEY_SEPARATOR+this.clientId+So.CACHE_KEY_SEPARATOR,r=""+In.REFRESH_TOKEN+So.CACHE_KEY_SEPARATOR+s0+So.CACHE_KEY_SEPARATOR;if(e.indexOf(t.toLowerCase())===-1&&e.indexOf(r.toLowerCase())===-1)return!1}else if(e.indexOf(this.clientId.toLowerCase())===-1)return!1;return!0},n.prototype.credentialMatchesFilter=function(e,t){return!(t.clientId&&!this.matchClientId(e,t.clientId)||t.userAssertionHash&&!this.matchUserAssertionHash(e,t.userAssertionHash)||typeof t.homeAccountId=="string"&&!this.matchHomeAccountId(e,t.homeAccountId)||t.environment&&!this.matchEnvironment(e,t.environment)||t.realm&&!this.matchRealm(e,t.realm)||t.credentialType&&!this.matchCredentialType(e,t.credentialType)||t.familyId&&!this.matchFamilyId(e,t.familyId)||t.target&&!this.matchTarget(e,t.target)||(t.requestedClaimsHash||e.requestedClaimsHash)&&e.requestedClaimsHash!==t.requestedClaimsHash||e.credentialType===In.ACCESS_TOKEN_WITH_AUTH_SCHEME&&(t.tokenType&&!this.matchTokenType(e,t.tokenType)||t.tokenType===Kr.SSH&&t.keyId&&!this.matchKeyId(e,t.keyId)))},n.prototype.getAppMetadataFilteredBy=function(e){return this.getAppMetadataFilteredByInternal(e.environment,e.clientId)},n.prototype.getAppMetadataFilteredByInternal=function(e,t){var r=this,i=this.getKeys(),o={};return i.forEach(function(a){var l;!r.isAppMetadata(a)||!(l=r.getAppMetadata(a))||e&&!r.matchEnvironment(l,e)||t&&!r.matchClientId(l,t)||(o[a]=l)}),o},n.prototype.getAuthorityMetadataByAlias=function(e){var t=this,r=this.getAuthorityMetadataKeys(),i=null;return r.forEach(function(o){t.isAuthorityMetadata(o)&&o.indexOf(t.clientId)!==-1&&(o=t.getAuthorityMetadata(o))&&o.aliases.indexOf(e)!==-1&&(i=o)}),i},n.prototype.removeAllAccounts=function(){return Vn(this,void 0,void 0,function(){var e,t,r=this;return Hn(this,function(i){switch(i.label){case 0:return e=this.getAccountKeys(),t=[],e.forEach(function(o){t.push(r.removeAccount(o))}),[4,Promise.all(t)];case 1:return i.sent(),[2]}})})},n.prototype.removeAccount=function(e){return Vn(this,void 0,void 0,function(){var t;return Hn(this,function(r){switch(r.label){case 0:if(t=this.getAccount(e))return[4,this.removeAccountContext(t)];throw tn.createNoAccountFoundError();case 1:return r.sent(),this.removeItem(e),[2]}})})},n.prototype.removeAccountContext=function(e){return Vn(this,void 0,void 0,function(){var t,r,i,o=this;return Hn(this,function(a){switch(a.label){case 0:return t=this.getTokenKeys(),r=e.generateAccountId(),i=[],t.idToken.forEach(function(l){l.indexOf(r)===0&&o.removeIdToken(l)}),t.accessToken.forEach(function(l){l.indexOf(r)===0&&i.push(o.removeAccessToken(l))}),t.refreshToken.forEach(function(l){l.indexOf(r)===0&&o.removeRefreshToken(l)}),[4,Promise.all(i)];case 1:return a.sent(),[2]}})})},n.prototype.removeAccessToken=function(e){return Vn(this,void 0,void 0,function(){var t;return Hn(this,function(r){switch(r.label){case 0:if(!(t=this.getAccessTokenCredential(e)))return[2];if(t.credentialType.toLowerCase()!==In.ACCESS_TOKEN_WITH_AUTH_SCHEME.toLowerCase())return[3,4];if(t.tokenType!==Kr.POP)return[3,4];if(!(t=t.keyId))return[3,4];r.label=1;case 1:return r.trys.push([1,3,,4]),[4,this.cryptoImpl.removeTokenBindingKey(t)];case 2:return r.sent(),[3,4];case 3:throw r.sent(),tn.createBindingKeyNotRemovedError();case 4:return[2,this.removeItem(e)]}})})},n.prototype.removeAppMetadata=function(){var e=this;return this.getKeys().forEach(function(t){e.isAppMetadata(t)&&e.removeItem(t)}),!0},n.prototype.readCacheRecord=function(l,a,r){var h=this.getTokenKeys(),i=this.readAccountFromCache(l),o=this.getIdToken(l,h),a=this.getAccessToken(l,a,h),l=this.getRefreshToken(l,!1,h),h=this.readAppMetadataFromCache(r);return i&&o&&(i.idTokenClaims=new Pl(o.secret,this.cryptoImpl).claims),{account:i,idToken:o,accessToken:a,refreshToken:l,appMetadata:h}},n.prototype.readAccountFromCache=function(e){return e=Qo.generateAccountCacheKey(e),this.getAccount(e)},n.prototype.getIdToken=function(i,o){var r=this,i=(this.commonLogger.trace("CacheManager - getIdToken called"),{homeAccountId:i.homeAccountId,environment:i.environment,credentialType:In.ID_TOKEN,clientId:this.clientId,realm:i.tenantId}),i=this.getIdTokensByFilter(i,o),o=i.length;return o<1?(this.commonLogger.info("CacheManager:getIdToken - No token found"),null):1<o?(this.commonLogger.info("CacheManager:getIdToken - Multiple id tokens found, clearing them"),i.forEach(function(a){r.removeIdToken(a.generateCredentialKey())}),null):(this.commonLogger.info("CacheManager:getIdToken - Returning id token"),i[0])},n.prototype.getIdTokensByFilter=function(e,i){var r=this,i=i&&i.idToken||this.getTokenKeys().idToken,o=[];return i.forEach(function(a){r.idTokenKeyMatchesFilter(a,Yr({clientId:r.clientId},e))&&(a=r.getIdTokenCredential(a))&&r.credentialMatchesFilter(a,e)&&o.push(a)}),o},n.prototype.idTokenKeyMatchesFilter=function(e,t){return e=e.toLowerCase(),!(t.clientId&&e.indexOf(t.clientId.toLowerCase())===-1||t.homeAccountId&&e.indexOf(t.homeAccountId.toLowerCase())===-1)},n.prototype.removeIdToken=function(e){this.removeItem(e)},n.prototype.removeRefreshToken=function(e){this.removeItem(e)},n.prototype.getAccessToken=function(g,t,r){var i=this,o=(this.commonLogger.trace("CacheManager - getAccessToken called"),pa.createSearchScopes(t.scopes)),a=t.authenticationScheme||Kr.BEARER,h=a&&a.toLowerCase()!==Kr.BEARER.toLowerCase()?In.ACCESS_TOKEN_WITH_AUTH_SCHEME:In.ACCESS_TOKEN,l={homeAccountId:g.homeAccountId,environment:g.environment,credentialType:h,clientId:this.clientId,realm:g.tenantId,target:o,tokenType:a,keyId:t.sshKid,requestedClaimsHash:t.requestedClaimsHash},h=r&&r.accessToken||this.getTokenKeys().accessToken,p=[],g=(h.forEach(function(_){i.accessTokenKeyMatchesFilter(_,l,!0)&&(_=i.getAccessTokenCredential(_))&&i.credentialMatchesFilter(_,l)&&p.push(_)}),p.length);return g<1?(this.commonLogger.info("CacheManager:getAccessToken - No token found"),null):1<g?(this.commonLogger.info("CacheManager:getAccessToken - Multiple access tokens found, clearing them"),p.forEach(function(_){i.removeAccessToken(_.generateCredentialKey())}),null):(this.commonLogger.info("CacheManager:getAccessToken - Returning access token"),p[0])},n.prototype.accessTokenKeyMatchesFilter=function(e,t,r){var i=e.toLowerCase();if(t.clientId&&i.indexOf(t.clientId.toLowerCase())===-1||t.homeAccountId&&i.indexOf(t.homeAccountId.toLowerCase())===-1||t.realm&&i.indexOf(t.realm.toLowerCase())===-1||t.requestedClaimsHash&&i.indexOf(t.requestedClaimsHash.toLowerCase())===-1)return!1;if(t.target)for(var o=t.target.asArray(),a=0;a<o.length;a++){if(r&&!i.includes(o[a].toLowerCase()))return!1;if(!r&&i.includes(o[a].toLowerCase()))return!0}return!0},n.prototype.getAccessTokensByFilter=function(e){var t=this,r=this.getTokenKeys(),i=[];return r.accessToken.forEach(function(o){t.accessTokenKeyMatchesFilter(o,e,!0)&&(o=t.getAccessTokenCredential(o))&&t.credentialMatchesFilter(o,e)&&i.push(o)}),i},n.prototype.getRefreshToken=function(l,o,r){var i=this,o=(this.commonLogger.trace("CacheManager - getRefreshToken called"),o?s0:void 0),a={homeAccountId:l.homeAccountId,environment:l.environment,credentialType:In.REFRESH_TOKEN,clientId:this.clientId,familyId:o},l=r&&r.refreshToken||this.getTokenKeys().refreshToken,h=[];return l.forEach(function(p){i.refreshTokenKeyMatchesFilter(p,a)&&(p=i.getRefreshTokenCredential(p))&&i.credentialMatchesFilter(p,a)&&h.push(p)}),h.length<1?(this.commonLogger.info("CacheManager:getRefreshToken - No refresh token found."),null):(this.commonLogger.info("CacheManager:getRefreshToken - returning refresh token"),h[0])},n.prototype.refreshTokenKeyMatchesFilter=function(e,t){return e=e.toLowerCase(),!(t.familyId&&e.indexOf(t.familyId.toLowerCase())===-1||!t.familyId&&t.clientId&&e.indexOf(t.clientId.toLowerCase())===-1||t.homeAccountId&&e.indexOf(t.homeAccountId.toLowerCase())===-1)},n.prototype.readAppMetadataFromCache=function(r){var r={environment:r,clientId:this.clientId},t=this.getAppMetadataFilteredBy(r),r=Object.keys(t).map(function(o){return t[o]}),i=r.length;if(i<1)return null;if(1<i)throw tn.createMultipleMatchingAppMetadataInCacheError();return r[0]},n.prototype.isAppMetadataFOCI=function(e){return e=this.readAppMetadataFromCache(e),!(!e||e.familyId!==s0)},n.prototype.matchHomeAccountId=function(e,t){return!(typeof e.homeAccountId!="string"||t!==e.homeAccountId)},n.prototype.matchLocalAccountId=function(e,t){return!(typeof e.localAccountId!="string"||t!==e.localAccountId)},n.prototype.matchUsername=function(e,t){return!(typeof e.username!="string"||t.toLowerCase()!==e.username.toLowerCase())},n.prototype.matchUserAssertionHash=function(e,t){return!(!e.userAssertionHash||t!==e.userAssertionHash)},n.prototype.matchEnvironment=function(e,t){return t=this.getAuthorityMetadataByAlias(t),!!(t&&-1<t.aliases.indexOf(e.environment))},n.prototype.matchCredentialType=function(e,t){return e.credentialType&&t.toLowerCase()===e.credentialType.toLowerCase()},n.prototype.matchClientId=function(e,t){return!(!e.clientId||t!==e.clientId)},n.prototype.matchFamilyId=function(e,t){return!(!e.familyId||t!==e.familyId)},n.prototype.matchRealm=function(e,t){return!(!e.realm||t!==e.realm)},n.prototype.matchNativeAccountId=function(e,t){return!(!e.nativeAccountId||t!==e.nativeAccountId)},n.prototype.matchTarget=function(e,t){return!(e.credentialType!==In.ACCESS_TOKEN&&e.credentialType!==In.ACCESS_TOKEN_WITH_AUTH_SCHEME||!e.target)&&pa.fromString(e.target).containsScopeSet(t)},n.prototype.matchTokenType=function(e,t){return!(!e.tokenType||e.tokenType!==t)},n.prototype.matchKeyId=function(e,t){return!(!e.keyId||e.keyId!==t)},n.prototype.isAppMetadata=function(e){return e.indexOf(NP)!==-1},n.prototype.isAuthorityMetadata=function(e){return e.indexOf(c0.CACHE_KEY)!==-1},n.prototype.generateAuthorityMetadataCacheKey=function(e){return c0.CACHE_KEY+"-"+this.clientId+"-"+e},n.toObject=function(e,t){for(var r in t)e[r]=t[r];return e},n}(),tEe=function(n){function e(){return n!==null&&n.apply(this,arguments)||this}return us(e,n),e.prototype.setAccount=function(){throw xn.createUnexpectedError("Storage interface - setAccount() has not been implemented for the cacheStorage interface.")},e.prototype.getAccount=function(){throw xn.createUnexpectedError("Storage interface - getAccount() has not been implemented for the cacheStorage interface.")},e.prototype.setIdTokenCredential=function(){throw xn.createUnexpectedError("Storage interface - setIdTokenCredential() has not been implemented for the cacheStorage interface.")},e.prototype.getIdTokenCredential=function(){throw xn.createUnexpectedError("Storage interface - getIdTokenCredential() has not been implemented for the cacheStorage interface.")},e.prototype.setAccessTokenCredential=function(){throw xn.createUnexpectedError("Storage interface - setAccessTokenCredential() has not been implemented for the cacheStorage interface.")},e.prototype.getAccessTokenCredential=function(){throw xn.createUnexpectedError("Storage interface - getAccessTokenCredential() has not been implemented for the cacheStorage interface.")},e.prototype.setRefreshTokenCredential=function(){throw xn.createUnexpectedError("Storage interface - setRefreshTokenCredential() has not been implemented for the cacheStorage interface.")},e.prototype.getRefreshTokenCredential=function(){throw xn.createUnexpectedError("Storage interface - getRefreshTokenCredential() has not been implemented for the cacheStorage interface.")},e.prototype.setAppMetadata=function(){throw xn.createUnexpectedError("Storage interface - setAppMetadata() has not been implemented for the cacheStorage interface.")},e.prototype.getAppMetadata=function(){throw xn.createUnexpectedError("Storage interface - getAppMetadata() has not been implemented for the cacheStorage interface.")},e.prototype.setServerTelemetry=function(){throw xn.createUnexpectedError("Storage interface - setServerTelemetry() has not been implemented for the cacheStorage interface.")},e.prototype.getServerTelemetry=function(){throw xn.createUnexpectedError("Storage interface - getServerTelemetry() has not been implemented for the cacheStorage interface.")},e.prototype.setAuthorityMetadata=function(){throw xn.createUnexpectedError("Storage interface - setAuthorityMetadata() has not been implemented for the cacheStorage interface.")},e.prototype.getAuthorityMetadata=function(){throw xn.createUnexpectedError("Storage interface - getAuthorityMetadata() has not been implemented for the cacheStorage interface.")},e.prototype.getAuthorityMetadataKeys=function(){throw xn.createUnexpectedError("Storage interface - getAuthorityMetadataKeys() has not been implemented for the cacheStorage interface.")},e.prototype.setThrottlingCache=function(){throw xn.createUnexpectedError("Storage interface - setThrottlingCache() has not been implemented for the cacheStorage interface.")},e.prototype.getThrottlingCache=function(){throw xn.createUnexpectedError("Storage interface - getThrottlingCache() has not been implemented for the cacheStorage interface.")},e.prototype.removeItem=function(){throw xn.createUnexpectedError("Storage interface - removeItem() has not been implemented for the cacheStorage interface.")},e.prototype.containsKey=function(){throw xn.createUnexpectedError("Storage interface - containsKey() has not been implemented for the cacheStorage interface.")},e.prototype.getKeys=function(){throw xn.createUnexpectedError("Storage interface - getKeys() has not been implemented for the cacheStorage interface.")},e.prototype.getAccountKeys=function(){throw xn.createUnexpectedError("Storage interface - getAccountKeys() has not been implemented for the cacheStorage interface.")},e.prototype.getTokenKeys=function(){throw xn.createUnexpectedError("Storage interface - getTokenKeys() has not been implemented for the cacheStorage interface.")},e.prototype.clear=function(){return Vn(this,void 0,void 0,function(){return Hn(this,function(t){throw xn.createUnexpectedError("Storage interface - clear() has not been implemented for the cacheStorage interface.")})})},e.prototype.updateCredentialCacheKey=function(){throw xn.createUnexpectedError("Storage interface - updateCredentialCacheKey() has not been implemented for the cacheStorage interface.")},e}(Ka),nEe=300,RV={tokenRenewalOffsetSeconds:nEe,preventCorsPreflight:!1},rEe={loggerCallback:function(){},piiLoggingEnabled:!1,logLevel:Oo.Info,correlationId:Ne.EMPTY_STRING},iEe={claimsBasedCachingEnabled:!0},oEe={sendGetRequestAsync:function(){return Vn(this,void 0,void 0,function(){return Hn(this,function(n){throw xn.createUnexpectedError("Network interface - sendGetRequestAsync() has not been implemented")})})},sendPostRequestAsync:function(){return Vn(this,void 0,void 0,function(){return Hn(this,function(n){throw xn.createUnexpectedError("Network interface - sendPostRequestAsync() has not been implemented")})})}},aEe={sku:Ne.SKU,version:sk,cpu:Ne.EMPTY_STRING,os:Ne.EMPTY_STRING},sEe={clientSecret:Ne.EMPTY_STRING,clientAssertion:void 0},cEe={azureCloudInstance:W0.None,tenant:""+Ne.DEFAULT_COMMON_TENANT},lEe={application:{appName:"",appVersion:""}};function uEe(x){var e=x.authOptions,t=x.systemOptions,C=x.loggerOptions,r=x.cacheOptions,i=x.storageInterface,o=x.networkInterface,a=x.cryptoInterface,l=x.clientCredentials,h=x.libraryInfo,p=x.telemetry,g=x.serverTelemetryManager,_=x.persistencePlugin,x=x.serializableCache,C=Yr(Yr({},rEe),C);return{authOptions:hEe(e),systemOptions:Yr(Yr({},RV),t),loggerOptions:C,cacheOptions:Yr(Yr({},iEe),r),storageInterface:i||new tEe(e.clientId,UE,new ak(C)),networkInterface:o||oEe,cryptoInterface:a||UE,clientCredentials:l||sEe,libraryInfo:Yr(Yr({},aEe),h),telemetry:Yr(Yr({},lEe),p),serverTelemetryManager:g||null,persistencePlugin:_||null,serializableCache:x||null}}function hEe(n){return Yr({clientCapabilities:[],azureCloudOptions:cEe,skipAuthorityMetadataCache:!1},n)}var Ns,nt,jE,l2,Jf=function(n){function e(t,r,i){return t=n.call(this,t,r,i)||this,t.name="ServerError",Object.setPrototypeOf(t,e.prototype),t}return us(e,n),e}(xn),VE=function(){function n(){}return n.generateThrottlingStorageKey=function(e){return l0.THROTTLING_PREFIX+"."+JSON.stringify(e)},n.preProcess=function(e,i){var r,i=n.generateThrottlingStorageKey(i),o=e.getThrottlingCache(i);if(o){if(!(o.throttleTime<Date.now()))throw new Jf(((r=o.errorCodes)==null?void 0:r.join(" "))||Ne.EMPTY_STRING,o.errorMessage,o.subError);e.removeItem(i)}},n.postProcess=function(e,t,r){(n.checkResponseStatus(r)||n.checkResponseForRetryAfter(r))&&(r={throttleTime:n.calculateThrottleTime(parseInt(r.headers[Fs.RETRY_AFTER])),error:r.body.error,errorCodes:r.body.error_codes,errorMessage:r.body.error_description,subError:r.body.suberror},e.setThrottlingCache(n.generateThrottlingStorageKey(t),r))},n.checkResponseStatus=function(e){return e.status===429||500<=e.status&&e.status<600},n.checkResponseForRetryAfter=function(e){return!!e.headers&&e.headers.hasOwnProperty(Fs.RETRY_AFTER)&&(e.status<200||300<=e.status)},n.calculateThrottleTime=function(t){var t=t<=0?0:t,r=Date.now()/1e3;return Math.floor(1e3*Math.min(r+(t||l0.DEFAULT_THROTTLE_TIME_SECONDS),r+l0.DEFAULT_MAX_THROTTLE_TIME_SECONDS))},n.removeThrottle=function(e,t,r,i){t={clientId:t,authority:r.authority,scopes:r.scopes,homeAccountIdentifier:i,claims:r.claims,authenticationScheme:r.authenticationScheme,resourceRequestMethod:r.resourceRequestMethod,resourceRequestUri:r.resourceRequestUri,shrClaims:r.shrClaims,sshKid:r.sshKid},i=this.generateThrottlingStorageKey(t),e.removeItem(i)},n}(),dEe=function(){function n(e,t){this.networkClient=e,this.cacheManager=t}return n.prototype.sendPostRequest=function(e,t,r){return Vn(this,void 0,void 0,function(){var i,o;return Hn(this,function(a){switch(a.label){case 0:VE.preProcess(this.cacheManager,e),a.label=1;case 1:return a.trys.push([1,3,,4]),[4,this.networkClient.sendPostRequestAsync(t,r)];case 2:return i=a.sent(),[3,4];case 3:throw(o=a.sent())instanceof xn?o:tn.createNetworkError(t,o);case 4:return VE.postProcess(this.cacheManager,e,i),[2,i]}})})},n}(),sf=(function(n){n.HOME_ACCOUNT_ID="home_account_id",n.UPN="UPN"}(Ns=Ns||{}),function(){function n(){}return n.validateRedirectUri=function(e){if(Zt.isEmpty(e))throw vi.createRedirectUriEmptyError()},n.validatePrompt=function(e){var t,r=[];for(t in ya)r.push(ya[t]);if(r.indexOf(e)<0)throw vi.createInvalidPromptError(e)},n.validateClaims=function(e){try{JSON.parse(e)}catch{throw vi.createInvalidClaimsRequestError()}},n.validateCodeChallengeParams=function(e,t){if(Zt.isEmpty(e)||Zt.isEmpty(t))throw vi.createInvalidCodeChallengeParamsError();this.validateCodeChallengeMethod(t)},n.validateCodeChallengeMethod=function(e){if([HF.PLAIN,HF.S256].indexOf(e)<0)throw vi.createInvalidCodeChallengeMethodError()},n.sanitizeEQParams=function(e,t){return e?(t.forEach(function(r,i){e[i]&&delete e[i]}),Object.fromEntries(Object.entries(e).filter(function(r){return r[1]!==""}))):{}},n}()),u0=function(){function n(){this.parameters=new Map}return n.prototype.addResponseTypeCode=function(){this.parameters.set(Yn.RESPONSE_TYPE,encodeURIComponent(Ne.CODE_RESPONSE_TYPE))},n.prototype.addResponseTypeForTokenAndIdToken=function(){this.parameters.set(Yn.RESPONSE_TYPE,encodeURIComponent(Ne.TOKEN_RESPONSE_TYPE+" "+Ne.ID_TOKEN_RESPONSE_TYPE))},n.prototype.addResponseMode=function(e){this.parameters.set(Yn.RESPONSE_MODE,encodeURIComponent(e||DE.QUERY))},n.prototype.addNativeBroker=function(){this.parameters.set(Yn.NATIVE_BROKER,encodeURIComponent("1"))},n.prototype.addScopes=function(e,t){t=(t=t===void 0?!0:t)?FT(e||[],Eb):e||[],e=new pa(t),this.parameters.set(Yn.SCOPE,encodeURIComponent(e.printScopes()))},n.prototype.addClientId=function(e){this.parameters.set(Yn.CLIENT_ID,encodeURIComponent(e))},n.prototype.addRedirectUri=function(e){sf.validateRedirectUri(e),this.parameters.set(Yn.REDIRECT_URI,encodeURIComponent(e))},n.prototype.addPostLogoutRedirectUri=function(e){sf.validateRedirectUri(e),this.parameters.set(Yn.POST_LOGOUT_URI,encodeURIComponent(e))},n.prototype.addIdTokenHint=function(e){this.parameters.set(Yn.ID_TOKEN_HINT,encodeURIComponent(e))},n.prototype.addDomainHint=function(e){this.parameters.set(o0.DOMAIN_HINT,encodeURIComponent(e))},n.prototype.addLoginHint=function(e){this.parameters.set(o0.LOGIN_HINT,encodeURIComponent(e))},n.prototype.addCcsUpn=function(e){this.parameters.set(Fs.CCS_HEADER,encodeURIComponent("UPN:"+e))},n.prototype.addCcsOid=function(e){this.parameters.set(Fs.CCS_HEADER,encodeURIComponent("Oid:"+e.uid+"@"+e.utid))},n.prototype.addSid=function(e){this.parameters.set(o0.SID,encodeURIComponent(e))},n.prototype.addClaims=function(e,t){e=this.addClientCapabilitiesToClaims(e,t),sf.validateClaims(e),this.parameters.set(Yn.CLAIMS,encodeURIComponent(e))},n.prototype.addCorrelationId=function(e){this.parameters.set(Yn.CLIENT_REQUEST_ID,encodeURIComponent(e))},n.prototype.addLibraryInfo=function(e){this.parameters.set(Yn.X_CLIENT_SKU,e.sku),this.parameters.set(Yn.X_CLIENT_VER,e.version),e.os&&this.parameters.set(Yn.X_CLIENT_OS,e.os),e.cpu&&this.parameters.set(Yn.X_CLIENT_CPU,e.cpu)},n.prototype.addApplicationTelemetry=function(e){e!=null&&e.appName&&this.parameters.set(Yn.X_APP_NAME,e.appName),e!=null&&e.appVersion&&this.parameters.set(Yn.X_APP_VER,e.appVersion)},n.prototype.addPrompt=function(e){sf.validatePrompt(e),this.parameters.set(""+Yn.PROMPT,encodeURIComponent(e))},n.prototype.addState=function(e){Zt.isEmpty(e)||this.parameters.set(Yn.STATE,encodeURIComponent(e))},n.prototype.addNonce=function(e){this.parameters.set(Yn.NONCE,encodeURIComponent(e))},n.prototype.addCodeChallengeParams=function(e,t){if(sf.validateCodeChallengeParams(e,t),!e||!t)throw vi.createInvalidCodeChallengeParamsError();this.parameters.set(Yn.CODE_CHALLENGE,encodeURIComponent(e)),this.parameters.set(Yn.CODE_CHALLENGE_METHOD,encodeURIComponent(t))},n.prototype.addAuthorizationCode=function(e){this.parameters.set(Yn.CODE,encodeURIComponent(e))},n.prototype.addDeviceCode=function(e){this.parameters.set(Yn.DEVICE_CODE,encodeURIComponent(e))},n.prototype.addRefreshToken=function(e){this.parameters.set(Yn.REFRESH_TOKEN,encodeURIComponent(e))},n.prototype.addCodeVerifier=function(e){this.parameters.set(Yn.CODE_VERIFIER,encodeURIComponent(e))},n.prototype.addClientSecret=function(e){this.parameters.set(Yn.CLIENT_SECRET,encodeURIComponent(e))},n.prototype.addClientAssertion=function(e){Zt.isEmpty(e)||this.parameters.set(Yn.CLIENT_ASSERTION,encodeURIComponent(e))},n.prototype.addClientAssertionType=function(e){Zt.isEmpty(e)||this.parameters.set(Yn.CLIENT_ASSERTION_TYPE,encodeURIComponent(e))},n.prototype.addOboAssertion=function(e){this.parameters.set(Yn.OBO_ASSERTION,encodeURIComponent(e))},n.prototype.addRequestTokenUse=function(e){this.parameters.set(Yn.REQUESTED_TOKEN_USE,encodeURIComponent(e))},n.prototype.addGrantType=function(e){this.parameters.set(Yn.GRANT_TYPE,encodeURIComponent(e))},n.prototype.addClientInfo=function(){this.parameters.set(eEe,"1")},n.prototype.addExtraQueryParameters=function(e){var t=this,r=sf.sanitizeEQParams(e,this.parameters);Object.keys(r).forEach(function(i){t.parameters.set(i,e[i])})},n.prototype.addClientCapabilitiesToClaims=function(e,t){var r;if(e)try{r=JSON.parse(e)}catch{throw vi.createInvalidClaimsRequestError()}else r={};return t&&0<t.length&&(r.hasOwnProperty(lm.ACCESS_TOKEN)||(r[lm.ACCESS_TOKEN]={}),r[lm.ACCESS_TOKEN][lm.XMS_CC]={values:t}),JSON.stringify(r)},n.prototype.addUsername=function(e){this.parameters.set(BE.username,encodeURIComponent(e))},n.prototype.addPassword=function(e){this.parameters.set(BE.password,encodeURIComponent(e))},n.prototype.addPopToken=function(e){Zt.isEmpty(e)||(this.parameters.set(Yn.TOKEN_TYPE,Kr.POP),this.parameters.set(Yn.REQ_CNF,encodeURIComponent(e)))},n.prototype.addSshJwk=function(e){Zt.isEmpty(e)||(this.parameters.set(Yn.TOKEN_TYPE,Kr.SSH),this.parameters.set(Yn.REQ_CNF,encodeURIComponent(e)))},n.prototype.addServerTelemetry=function(e){this.parameters.set(Yn.X_CLIENT_CURR_TELEM,e.generateCurrentRequestHeaderValue()),this.parameters.set(Yn.X_CLIENT_LAST_TELEM,e.generateLastRequestHeaderValue())},n.prototype.addThrottling=function(){this.parameters.set(Yn.X_MS_LIB_CAPABILITY,l0.X_MS_LIB_CAPABILITY_VALUE)},n.prototype.addLogoutHint=function(e){this.parameters.set(Yn.LOGOUT_HINT,encodeURIComponent(e))},n.prototype.createQueryString=function(){var e=new Array;return this.parameters.forEach(function(t,r){e.push(r+"="+t)}),e.join("&")},n}(),ck=function(){function n(e,t){this.config=uEe(e),this.logger=new ak(this.config.loggerOptions,MV,sk),this.cryptoUtils=this.config.cryptoInterface,this.cacheManager=this.config.storageInterface,this.networkClient=this.config.networkInterface,this.networkManager=new dEe(this.networkClient,this.cacheManager),this.serverTelemetryManager=this.config.serverTelemetryManager,this.authority=this.config.authOptions.authority,this.performanceClient=t}return n.prototype.createTokenRequestHeaders=function(e){var t={};if(t[Fs.CONTENT_TYPE]=Ne.URL_FORM_CONTENT_TYPE,!this.config.systemOptions.preventCorsPreflight&&e)switch(e.type){case Ns.HOME_ACCOUNT_ID:try{var r=hm(e.credential);t[Fs.CCS_HEADER]="Oid:"+r.uid+"@"+r.utid}catch(i){this.logger.verbose("Could not parse home account ID for CCS Header: "+i)}break;case Ns.UPN:t[Fs.CCS_HEADER]="UPN: "+e.credential}return t},n.prototype.executePostToTokenEndpoint=function(e,t,r,i){return Vn(this,void 0,void 0,function(){var o;return Hn(this,function(a){switch(a.label){case 0:return[4,this.networkManager.sendPostRequest(i,e,{body:t,headers:r})];case 1:return o=a.sent(),this.config.serverTelemetryManager&&o.status<500&&o.status!==429&&this.config.serverTelemetryManager.clearTelemetryCache(),[2,o]}})})},n.prototype.updateAuthority=function(e){if(!e.discoveryComplete())throw tn.createEndpointDiscoveryIncompleteError("Updated authority has not completed endpoint discovery.");this.authority=e},n.prototype.createTokenQueryParameters=function(e){var t=new u0;return e.tokenQueryParameters&&t.addExtraQueryParameters(e.tokenQueryParameters),t.createQueryString()},n}(),lk=function(){function n(){}return n.prototype.generateAccountId=function(){return n.generateAccountIdForCacheKey(this.homeAccountId,this.environment)},n.prototype.generateCredentialId=function(){return n.generateCredentialIdForCacheKey(this.credentialType,this.clientId,this.realm,this.familyId)},n.prototype.generateTarget=function(){return n.generateTargetForCacheKey(this.target)},n.prototype.generateCredentialKey=function(){return n.generateCredentialCacheKey(this.homeAccountId,this.environment,this.credentialType,this.clientId,this.realm,this.target,this.familyId,this.tokenType,this.requestedClaimsHash)},n.prototype.generateType=function(){switch(this.credentialType){case In.ID_TOKEN:return cu.ID_TOKEN;case In.ACCESS_TOKEN:case In.ACCESS_TOKEN_WITH_AUTH_SCHEME:return cu.ACCESS_TOKEN;case In.REFRESH_TOKEN:return cu.REFRESH_TOKEN;default:throw tn.createUnexpectedCredentialTypeError()}},n.generateCredentialCacheKey=function(e,t,r,i,o,a,l,h,p){return[this.generateAccountIdForCacheKey(e,t),this.generateCredentialIdForCacheKey(r,i,o,l),this.generateTargetForCacheKey(a),this.generateClaimsHashForCacheKey(p),this.generateSchemeForCacheKey(h)].join(So.CACHE_KEY_SEPARATOR).toLowerCase()},n.generateAccountIdForCacheKey=function(e,t){return[e,t].join(So.CACHE_KEY_SEPARATOR).toLowerCase()},n.generateCredentialIdForCacheKey=function(e,t,r,i){return[e,e===In.REFRESH_TOKEN&&i||t,r||Ne.EMPTY_STRING].join(So.CACHE_KEY_SEPARATOR).toLowerCase()},n.generateTargetForCacheKey=function(e){return(e||Ne.EMPTY_STRING).toLowerCase()},n.generateClaimsHashForCacheKey=function(e){return(e||Ne.EMPTY_STRING).toLowerCase()},n.generateSchemeForCacheKey=function(e){return e&&e.toLowerCase()!==Kr.BEARER.toLowerCase()?e.toLowerCase():Ne.EMPTY_STRING},n}(),Ef=function(n){function e(){return n!==null&&n.apply(this,arguments)||this}return us(e,n),e.createIdTokenEntity=function(t,r,i,o,a){var l=new e;return l.credentialType=In.ID_TOKEN,l.homeAccountId=t,l.environment=r,l.clientId=o,l.secret=i,l.realm=a,l},e.isIdTokenEntity=function(t){return!!t&&t.hasOwnProperty("homeAccountId")&&t.hasOwnProperty("environment")&&t.hasOwnProperty("credentialType")&&t.hasOwnProperty("realm")&&t.hasOwnProperty("clientId")&&t.hasOwnProperty("secret")&&t.credentialType===In.ID_TOKEN},e}(lk),ac=function(){function n(){}return n.nowSeconds=function(){return Math.round(new Date().getTime()/1e3)},n.isTokenExpired=function(e,t){return(Number(e)||0)<n.nowSeconds()+t},n.wasClockTurnedBack=function(e){return Number(e)>n.nowSeconds()},n.delay=function(e,t){return new Promise(function(r){return setTimeout(function(){return r(t)},e)})},n}(),Tf=function(n){function e(){return n!==null&&n.apply(this,arguments)||this}return us(e,n),e.createAccessTokenEntity=function(le,r,i,o,a,l,h,p,g,_,x,C,M,L,D){var z,te=new e,le=(te.homeAccountId=le,te.credentialType=In.ACCESS_TOKEN,te.secret=i,ac.nowSeconds());if(te.cachedAt=le.toString(),te.expiresOn=h.toString(),te.extendedExpiresOn=p.toString(),_&&(te.refreshOn=_.toString()),te.environment=r,te.clientId=o,te.realm=a,te.target=l,te.userAssertionHash=C,te.tokenType=Zt.isEmpty(x)?Kr.BEARER:x,L&&(te.requestedClaims=L,te.requestedClaimsHash=D),((le=te.tokenType)==null?void 0:le.toLowerCase())!==Kr.BEARER.toLowerCase())switch(te.credentialType=In.ACCESS_TOKEN_WITH_AUTH_SCHEME,te.tokenType){case Kr.POP:var ce=Pl.extractTokenClaims(i,g);if((z=ce==null?void 0:ce.cnf)==null||!z.kid)throw tn.createTokenClaimsRequiredError();te.keyId=ce.cnf.kid;break;case Kr.SSH:te.keyId=M}return te},e.isAccessTokenEntity=function(t){return!!t&&t.hasOwnProperty("homeAccountId")&&t.hasOwnProperty("environment")&&t.hasOwnProperty("credentialType")&&t.hasOwnProperty("realm")&&t.hasOwnProperty("clientId")&&t.hasOwnProperty("secret")&&t.hasOwnProperty("target")&&(t.credentialType===In.ACCESS_TOKEN||t.credentialType===In.ACCESS_TOKEN_WITH_AUTH_SCHEME)},e}(lk),dm=function(n){function e(){return n!==null&&n.apply(this,arguments)||this}return us(e,n),e.createRefreshTokenEntity=function(t,r,i,o,a,l){var h=new e;return h.clientId=o,h.credentialType=In.REFRESH_TOKEN,h.environment=r,h.homeAccountId=t,h.secret=i,h.userAssertionHash=l,a&&(h.familyId=a),h},e.isRefreshTokenEntity=function(t){return!!t&&t.hasOwnProperty("homeAccountId")&&t.hasOwnProperty("environment")&&t.hasOwnProperty("credentialType")&&t.hasOwnProperty("clientId")&&t.hasOwnProperty("secret")&&t.credentialType===In.REFRESH_TOKEN},e}(lk),qF=["interaction_required","consent_required","login_required"],fEe=["message_only","additional_action","basic_action","user_password_expired","consent_required"],fm={noTokensFoundError:{code:"no_tokens_found",desc:"No refresh token found in the cache. Please sign-in."},native_account_unavailable:{code:"native_account_unavailable",desc:"The requested account is not available in the native broker. It may have been deleted or logged out. Please sign-in again using an interactive API."}},rc=function(n){function e(t,r,i,o,a,l,h){return t=n.call(this,t,r,i)||this,Object.setPrototypeOf(t,e.prototype),t.timestamp=o||Ne.EMPTY_STRING,t.traceId=a||Ne.EMPTY_STRING,t.correlationId=l||Ne.EMPTY_STRING,t.claims=h||Ne.EMPTY_STRING,t.name="InteractionRequiredAuthError",t}return us(e,n),e.isInteractionRequiredError=function(o,r,a){var o=!!o&&-1<qF.indexOf(o),a=!!a&&-1<fEe.indexOf(a),l=!!r&&qF.some(function(h){return-1<r.indexOf(h)});return o||l||a},e.createNoTokensFoundError=function(){return new e(fm.noTokensFoundError.code,fm.noTokensFoundError.desc)},e.createNativeAccountUnavailableError=function(){return new e(fm.native_account_unavailable.code,fm.native_account_unavailable.desc)},e}(xn),HE=function(n,e,t,r,i){this.account=n||null,this.idToken=e||null,this.accessToken=t||null,this.refreshToken=r||null,this.appMetadata=i||null},yu=function(){function n(){}return n.setRequestState=function(e,t,r){return e=n.generateLibraryState(e,r),Zt.isEmpty(t)?e:""+e+Ne.RESOURCE_DELIM+t},n.generateLibraryState=function(e,t){var r;if(e)return r={id:e.createNewGuid()},t&&(r.meta=t),t=JSON.stringify(r),e.base64Encode(t);throw tn.createNoCryptoObjectError("generateLibraryState")},n.parseRequestState=function(e,t){if(!e)throw tn.createNoCryptoObjectError("parseRequestState");if(Zt.isEmpty(t))throw tn.createInvalidStateError(t,"Null, undefined or empty state");try{var r=t.split(Ne.RESOURCE_DELIM),i=r[0],o=1<r.length?r.slice(1).join(Ne.RESOURCE_DELIM):Ne.EMPTY_STRING,a=e.base64Decode(i),l=JSON.parse(a);return{userRequestState:Zt.isEmpty(o)?Ne.EMPTY_STRING:o,libraryState:l}}catch(h){throw tn.createInvalidStateError(t,h)}},n}(),xr=function(){function n(e){if(this._urlString=e,Zt.isEmpty(this._urlString))throw vi.createUrlEmptyError();Zt.isEmpty(this.getHash())&&(this._urlString=n.canonicalizeUri(e))}return Object.defineProperty(n.prototype,"urlString",{get:function(){return this._urlString},enumerable:!1,configurable:!0}),n.canonicalizeUri=function(e){var t;return e&&(t=e.toLowerCase(),Zt.endsWith(t,"?")?t=t.slice(0,-1):Zt.endsWith(t,"?/")&&(t=t.slice(0,-2)),Zt.endsWith(t,"/")||(t+="/"),t)},n.prototype.validateAsUri=function(){var e;try{e=this.getUrlComponents()}catch(t){throw vi.createUrlParseError(t)}if(!e.HostNameAndPort||!e.PathSegments)throw vi.createUrlParseError("Given url string: "+this.urlString);if(!e.Protocol||e.Protocol.toLowerCase()!=="https:")throw vi.createInsecureAuthorityUriError(this.urlString)},n.appendQueryString=function(e,t){return Zt.isEmpty(t)?e:e.indexOf("?")<0?e+"?"+t:e+"&"+t},n.removeHashFromUrl=function(e){return n.canonicalizeUri(e.split("#")[0])},n.prototype.replaceTenantPath=function(e){var t=this.getUrlComponents(),r=t.PathSegments;return!e||r.length===0||r[0]!==Bf.COMMON&&r[0]!==Bf.ORGANIZATIONS||(r[0]=e),n.constructAuthorityUriFromObject(t)},n.prototype.getHash=function(){return n.parseHash(this.urlString)},n.prototype.getUrlComponents=function(){var e,t=RegExp("^(([^:/?#]+):)?(//([^/?#]*))?([^?#]*)(\\?([^#]*))?(#(.*))?"),t=this.urlString.match(t);if(t)return e=(e=(t={Protocol:t[1],HostNameAndPort:t[4],AbsolutePath:t[5],QueryString:t[7]}).AbsolutePath.split("/")).filter(function(r){return r&&0<r.length}),t.PathSegments=e,!Zt.isEmpty(t.QueryString)&&t.QueryString.endsWith("/")&&(t.QueryString=t.QueryString.substring(0,t.QueryString.length-1)),t;throw vi.createUrlParseError("Given url string: "+this.urlString)},n.getDomainFromUrl=function(e){var t=RegExp("^([^:/?#]+://)?([^/?#]*)"),t=e.match(t);if(t)return t[2];throw vi.createUrlParseError("Given url string: "+e)},n.getAbsoluteUrl=function(e,t){return e[0]===Ne.FORWARD_SLASH?(t=new n(t).getUrlComponents()).Protocol+"//"+t.HostNameAndPort+e:e},n.parseHash=function(e){var t=e.indexOf("#"),r=e.indexOf("#/");return-1<r?e.substring(r+2):-1<t?e.substring(t+1):Ne.EMPTY_STRING},n.parseQueryString=function(e){var t=e.indexOf("?"),r=e.indexOf("/?");return-1<r?e.substring(r+2):-1<t?e.substring(t+1):Ne.EMPTY_STRING},n.constructAuthorityUriFromObject=function(e){return new n(e.Protocol+"//"+e.HostNameAndPort+"/"+e.PathSegments.join("/"))},n.getDeserializedHash=function(r){if(Zt.isEmpty(r))return{};var t=n.parseHash(r),r=Zt.queryStringToObject(Zt.isEmpty(t)?r:t);if(r)return r;throw tn.createHashNotDeserializedError(JSON.stringify(r))},n.getDeserializedQueryString=function(r){if(Zt.isEmpty(r))return{};var t=n.parseQueryString(r),r=Zt.queryStringToObject(Zt.isEmpty(t)?r:t);if(r)return r;throw tn.createHashNotDeserializedError(JSON.stringify(r))},n.hashContainsKnownProperties=function(e){return!(Zt.isEmpty(e)||e.indexOf("=")<0||!((e=n.getDeserializedHash(e)).code||e.error_description||e.error||e.state))},n}(),pEe=(function(n){n.AcquireTokenByCode="acquireTokenByCode",n.AcquireTokenByRefreshToken="acquireTokenByRefreshToken",n.AcquireTokenSilent="acquireTokenSilent",n.AcquireTokenSilentAsync="acquireTokenSilentAsync",n.AcquireTokenPopup="acquireTokenPopup",n.CryptoOptsGetPublicKeyThumbprint="cryptoOptsGetPublicKeyThumbprint",n.CryptoOptsSignJwt="cryptoOptsSignJwt",n.SilentCacheClientAcquireToken="silentCacheClientAcquireToken",n.SilentIframeClientAcquireToken="silentIframeClientAcquireToken",n.SilentRefreshClientAcquireToken="silentRefreshClientAcquireToken",n.SsoSilent="ssoSilent",n.StandardInteractionClientGetDiscoveredAuthority="standardInteractionClientGetDiscoveredAuthority",n.FetchAccountIdWithNativeBroker="fetchAccountIdWithNativeBroker",n.NativeInteractionClientAcquireToken="nativeInteractionClientAcquireToken",n.BaseClientCreateTokenRequestHeaders="baseClientCreateTokenRequestHeaders",n.BrokerHandhshake="brokerHandshake",n.AcquireTokenByRefreshTokenInBroker="acquireTokenByRefreshTokenInBroker",n.AcquireTokenByBroker="acquireTokenByBroker",n.RefreshTokenClientExecuteTokenRequest="refreshTokenClientExecuteTokenRequest",n.RefreshTokenClientAcquireToken="refreshTokenClientAcquireToken",n.RefreshTokenClientAcquireTokenWithCachedRefreshToken="refreshTokenClientAcquireTokenWithCachedRefreshToken",n.RefreshTokenClientAcquireTokenByRefreshToken="refreshTokenClientAcquireTokenByRefreshToken",n.RefreshTokenClientCreateTokenRequestBody="refreshTokenClientCreateTokenRequestBody",n.AcquireTokenFromCache="acquireTokenFromCache",n.AcquireTokenBySilentIframe="acquireTokenBySilentIframe",n.InitializeBaseRequest="initializeBaseRequest",n.InitializeSilentRequest="initializeSilentRequest",n.InitializeClientApplication="initializeClientApplication",n.SilentIframeClientTokenHelper="silentIframeClientTokenHelper",n.SilentHandlerInitiateAuthRequest="silentHandlerInitiateAuthRequest",n.SilentHandlerMonitorIframeForHash="silentHandlerMonitorIframeForHash",n.SilentHandlerLoadFrame="silentHandlerLoadFrame",n.StandardInteractionClientCreateAuthCodeClient="standardInteractionClientCreateAuthCodeClient",n.StandardInteractionClientGetClientConfiguration="standardInteractionClientGetClientConfiguration",n.StandardInteractionClientInitializeAuthorizationRequest="standardInteractionClientInitializeAuthorizationRequest",n.StandardInteractionClientInitializeAuthorizationCodeRequest="standardInteractionClientInitializeAuthorizationCodeRequest",n.GetAuthCodeUrl="getAuthCodeUrl",n.HandleCodeResponseFromServer="handleCodeResponseFromServer",n.HandleCodeResponseFromHash="handleCodeResponseFromHash",n.UpdateTokenEndpointAuthority="updateTokenEndpointAuthority",n.AuthClientAcquireToken="authClientAcquireToken",n.AuthClientExecuteTokenRequest="authClientExecuteTokenRequest",n.AuthClientCreateTokenRequestBody="authClientCreateTokenRequestBody",n.AuthClientCreateQueryString="authClientCreateQueryString",n.PopTokenGenerateCnf="popTokenGenerateCnf",n.PopTokenGenerateKid="popTokenGenerateKid",n.HandleServerTokenResponse="handleServerTokenResponse",n.AuthorityFactoryCreateDiscoveredInstance="authorityFactoryCreateDiscoveredInstance",n.AuthorityResolveEndpointsAsync="authorityResolveEndpointsAsync",n.AuthorityGetCloudDiscoveryMetadataFromNetwork="authorityGetCloudDiscoveryMetadataFromNetwork",n.AuthorityUpdateCloudDiscoveryMetadata="authorityUpdateCloudDiscoveryMetadata",n.AuthorityGetEndpointMetadataFromNetwork="authorityGetEndpointMetadataFromNetwork",n.AuthorityUpdateEndpointMetadata="authorityUpdateEndpointMetadata",n.AuthorityUpdateMetadataWithRegionalInformation="authorityUpdateMetadataWithRegionalInformation",n.RegionDiscoveryDetectRegion="regionDiscoveryDetectRegion",n.RegionDiscoveryGetRegionFromIMDS="regionDiscoveryGetRegionFromIMDS",n.RegionDiscoveryGetCurrentVersion="regionDiscoveryGetCurrentVersion",n.AcquireTokenByCodeAsync="acquireTokenByCodeAsync",n.GetEndpointMetadataFromNetwork="getEndpointMetadataFromNetwork",n.GetCloudDiscoveryMetadataFromNetworkMeasurement="getCloudDiscoveryMetadataFromNetworkMeasurement",n.HandleRedirectPromiseMeasurement="handleRedirectPromiseMeasurement",n.UpdateCloudDiscoveryMetadataMeasurement="updateCloudDiscoveryMetadataMeasurement",n.UsernamePasswordClientAcquireToken="usernamePasswordClientAcquireToken",n.NativeMessageHandlerHandshake="nativeMessageHandlerHandshake",n.ClearTokensAndKeysWithClaims="clearTokensAndKeysWithClaims"}(nt=nt||{}),function(n){n[n.NotStarted=0]="NotStarted",n[n.InProgress=1]="InProgress",n[n.Completed=2]="Completed"}(jE=jE||{}),new Set(["accessTokenSize","durationMs","idTokenSize","matsSilentStatus","matsHttpStatus","refreshTokenSize","queuedTimeMs","startTimeMs","status"])),ly=(function(n){n.SW="sw",n.UHW="uhw"}(l2=l2||{}),function(){function n(e,t){this.cryptoUtils=e,this.performanceClient=t}return n.prototype.generateCnf=function(e){var t;return Vn(this,void 0,void 0,function(){var r,i;return Hn(this,function(o){switch(o.label){case 0:return(t=this.performanceClient)!=null&&t.addQueueMeasurement(nt.PopTokenGenerateCnf,e.correlationId),(t=this.performanceClient)!=null&&t.setPreQueueTime(nt.PopTokenGenerateKid,e.correlationId),[4,this.generateKid(e)];case 1:return i=o.sent(),r=this.cryptoUtils.base64Encode(JSON.stringify(i)),i={kid:i.kid,reqCnfString:r},[4,this.cryptoUtils.hashString(r)];case 2:return[2,(i.reqCnfHash=o.sent(),i)]}})})},n.prototype.generateKid=function(e){var t;return Vn(this,void 0,void 0,function(){return Hn(this,function(r){switch(r.label){case 0:return(t=this.performanceClient)!=null&&t.addQueueMeasurement(nt.PopTokenGenerateKid,e.correlationId),[4,this.cryptoUtils.getPublicKeyThumbprint(e)];case 1:return[2,{kid:r.sent(),xms_ksl:l2.SW}]}})})},n.prototype.signPopToken=function(e,t,r){return Vn(this,void 0,void 0,function(){return Hn(this,function(i){return[2,this.signPayload(e,t,r)]})})},n.prototype.signPayload=function(e,t,r,i){return Vn(this,void 0,void 0,function(){var o,a,l,h;return Hn(this,function(p){switch(p.label){case 0:return o=r.resourceRequestMethod,h=r.resourceRequestUri,a=r.shrClaims,l=r.shrNonce,h=h?new xr(h):void 0,h=h==null?void 0:h.getUrlComponents(),[4,this.cryptoUtils.signJwt(Yr({at:e,ts:ac.nowSeconds(),m:o==null?void 0:o.toUpperCase(),u:h==null?void 0:h.HostNameAndPort,nonce:l||this.cryptoUtils.createNewGuid(),p:h==null?void 0:h.AbsolutePath,q:h!=null&&h.QueryString?[[],h.QueryString]:void 0,client_claims:a||void 0},i),t,r.correlationId)];case 1:return[2,p.sent()]}})})},n}()),DP=function(){function n(){}return n.prototype.generateAppMetadataKey=function(){return n.generateAppMetadataCacheKey(this.environment,this.clientId)},n.generateAppMetadataCacheKey=function(e,t){return[NP,e,t].join(So.CACHE_KEY_SEPARATOR).toLowerCase()},n.createAppMetadataEntity=function(e,t,r){var i=new n;return i.clientId=e,i.environment=t,r&&(i.familyId=r),i},n.isAppMetadataEntity=function(e,t){return!!t&&e.indexOf(NP)===0&&t.hasOwnProperty("clientId")&&t.hasOwnProperty("environment")},n}(),gEe=function(){function n(e,t){this.cache=e,this.hasChanged=t}return Object.defineProperty(n.prototype,"cacheHasChanged",{get:function(){return this.hasChanged},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"tokenCache",{get:function(){return this.cache},enumerable:!1,configurable:!0}),n}(),GE=function(){function n(e,t,r,i,o,a,l){this.clientId=e,this.cacheStorage=t,this.cryptoObj=r,this.logger=i,this.serializableCache=o,this.persistencePlugin=a,this.performanceClient=l}return n.prototype.validateServerAuthorizationCodeResponse=function(e,t,r){if(!e.state||!t)throw e.state?tn.createStateNotFoundError("Cached State"):tn.createStateNotFoundError("Server State");if(decodeURIComponent(e.state)!==decodeURIComponent(t))throw tn.createStateMismatchError();if(e.error||e.error_description||e.suberror)throw rc.isInteractionRequiredError(e.error,e.error_description,e.suberror)?new rc(e.error||Ne.EMPTY_STRING,e.error_description,e.suberror,e.timestamp||Ne.EMPTY_STRING,e.trace_id||Ne.EMPTY_STRING,e.correlation_id||Ne.EMPTY_STRING,e.claims||Ne.EMPTY_STRING):new Jf(e.error||Ne.EMPTY_STRING,e.error_description,e.suberror);e.client_info&&zE(e.client_info,r)},n.prototype.validateTokenResponse=function(e){if(e.error||e.error_description||e.suberror){if(rc.isInteractionRequiredError(e.error,e.error_description,e.suberror))throw new rc(e.error,e.error_description,e.suberror,e.timestamp||Ne.EMPTY_STRING,e.trace_id||Ne.EMPTY_STRING,e.correlation_id||Ne.EMPTY_STRING,e.claims||Ne.EMPTY_STRING);var t=e.error_codes+" - ["+e.timestamp+"]: "+e.error_description+" - Correlation ID: "+e.correlation_id+" - Trace ID: "+e.trace_id;throw new Jf(e.error,t,e.suberror)}},n.prototype.handleServerTokenResponse=function(e,t,r,i,o,a,l,h,p){var g;return Vn(this,void 0,void 0,function(){var _,x,C,M,L;return Hn(this,function(D){switch(D.label){case 0:if((g=this.performanceClient)!=null&&g.addQueueMeasurement(nt.HandleServerTokenResponse,e.correlation_id),e.id_token){if(_=new Pl(e.id_token||Ne.EMPTY_STRING,this.cryptoObj),o&&!Zt.isEmpty(o.nonce)&&_.claims.nonce!==o.nonce)throw tn.createNonceMismatchError();if(i.maxAge||i.maxAge===0){if(!(C=_.claims.auth_time))throw tn.createAuthTimeNotFoundError();Pl.checkMaxAge(C,i.maxAge)}}this.homeAccountIdentifier=Qo.generateHomeAccountId(e.client_info||Ne.EMPTY_STRING,t.authorityType,this.logger,this.cryptoObj,_),o&&o.state&&(x=yu.parseRequestState(this.cryptoObj,o.state)),e.key_id=e.key_id||i.sshKid||void 0,C=this.generateCacheRecord(e,t,r,i,_,a,o),D.label=1;case 1:return D.trys.push([1,,5,8]),this.persistencePlugin&&this.serializableCache?(this.logger.verbose("Persistence enabled, calling beforeCacheAccess"),M=new gEe(this.serializableCache,!0),[4,this.persistencePlugin.beforeCacheAccess(M)]):[3,3];case 2:D.sent(),D.label=3;case 3:return!l||h||!C.account||(L=C.account.generateAccountKey(),this.cacheStorage.getAccount(L))?[4,this.cacheStorage.saveCacheRecord(C)]:(this.logger.warning("Account used to refresh tokens not in persistence, refreshed tokens will not be stored in the cache"),[2,n.generateAuthenticationResult(this.cryptoObj,t,C,!1,i,_,x,void 0,p)]);case 4:return D.sent(),[3,8];case 5:return this.persistencePlugin&&this.serializableCache&&M?(this.logger.verbose("Persistence enabled, calling afterCacheAccess"),[4,this.persistencePlugin.afterCacheAccess(M)]):[3,7];case 6:D.sent(),D.label=7;case 7:return[7];case 8:return[2,n.generateAuthenticationResult(this.cryptoObj,t,C,!1,i,_,x,e,p)]}})})},n.prototype.generateCacheRecord=function(e,t,r,i,D,a,M){var h,p,g=t.getPreferredCache();if(Zt.isEmpty(g))throw tn.createInvalidCacheEnvironmentError();!Zt.isEmpty(e.id_token)&&D&&(h=Ef.createIdTokenEntity(this.homeAccountIdentifier,g,e.id_token||Ne.EMPTY_STRING,this.clientId,D.claims.tid||Ne.EMPTY_STRING),p=this.generateAccountEntity(e,D,t,M));var _,x,C,M=null,L=(Zt.isEmpty(e.access_token)||(_=e.scope?pa.fromString(e.scope):new pa(i.scopes||[]),C=(x=r+((typeof e.expires_in=="string"?parseInt(e.expires_in,10):e.expires_in)||0))+((typeof e.ext_expires_in=="string"?parseInt(e.ext_expires_in,10):e.ext_expires_in)||0),r=(L=(typeof e.refresh_in=="string"?parseInt(e.refresh_in,10):e.refresh_in)||void 0)&&0<L?r+L:void 0,M=Tf.createAccessTokenEntity(this.homeAccountIdentifier,g,e.access_token||Ne.EMPTY_STRING,this.clientId,D?D.claims.tid||Ne.EMPTY_STRING:t.tenant,_.printScopes(),x,C,this.cryptoObj,r,e.token_type,a,e.key_id,i.claims,i.requestedClaimsHash)),null),D=(Zt.isEmpty(e.refresh_token)||(L=dm.createRefreshTokenEntity(this.homeAccountIdentifier,g,e.refresh_token||Ne.EMPTY_STRING,this.clientId,e.foci,a)),null);return Zt.isEmpty(e.foci)||(D=DP.createAppMetadataEntity(this.clientId,g,e.foci)),new HE(p,h,M,L,D)},n.prototype.generateAccountEntity=function(e,t,r,l){var o=r.authorityType,a=l?l.cloud_graph_host_name:Ne.EMPTY_STRING,l=l?l.msgraph_host:Ne.EMPTY_STRING;if(o===Pa.Adfs)return this.logger.verbose("Authority type is ADFS, creating ADFS account"),Qo.createGenericAccount(this.homeAccountIdentifier,t,r,a,l);if(Zt.isEmpty(e.client_info)&&r.protocolMode==="AAD")throw tn.createClientInfoEmptyError();return e.client_info?Qo.createAccount(e.client_info,this.homeAccountIdentifier,t,r,a,l):Qo.createGenericAccount(this.homeAccountIdentifier,t,r,a,l)},n.generateAuthenticationResult=function(e,t,r,i,o,a,l,h,p){var g;return Vn(this,void 0,void 0,function(){var _,x,C,M,L,D,z,te;return Hn(this,function(le){switch(le.label){case 0:if(_=Ne.EMPTY_STRING,x=[],C=null,L=Ne.EMPTY_STRING,!r.accessToken)return[3,4];if(r.accessToken.tokenType!==Kr.POP)return[3,2];if(z=new ly(e),D=r.accessToken,te=D.secret,D=D.keyId)return[4,z.signPopToken(te,D,o)];throw tn.createKeyIdMissingError();case 1:return _=le.sent(),[3,3];case 2:_=r.accessToken.secret,le.label=3;case 3:x=pa.fromString(r.accessToken.target).asArray(),C=new Date(1e3*Number(r.accessToken.expiresOn)),M=new Date(1e3*Number(r.accessToken.extendedExpiresOn)),le.label=4;case 4:return r.appMetadata&&(L=r.appMetadata.familyId===s0?s0:Ne.EMPTY_STRING),z=(a==null?void 0:a.claims.oid)||(a==null?void 0:a.claims.sub)||Ne.EMPTY_STRING,te=(a==null?void 0:a.claims.tid)||Ne.EMPTY_STRING,h!=null&&h.spa_accountid&&r.account&&(r.account.nativeAccountId=h==null?void 0:h.spa_accountid),[2,{authority:t.canonicalAuthority,uniqueId:z,tenantId:te,scopes:x,account:r.account?r.account.getAccountInfo():null,idToken:a?a.rawToken:Ne.EMPTY_STRING,idTokenClaims:a?a.claims:{},accessToken:_,fromCache:i,expiresOn:C,correlationId:o.correlationId,requestId:p||Ne.EMPTY_STRING,extExpiresOn:M,familyId:L,tokenType:((g=r.accessToken)==null?void 0:g.tokenType)||Ne.EMPTY_STRING,state:l?l.userRequestState:Ne.EMPTY_STRING,cloudGraphHostName:((g=r.account)==null?void 0:g.cloudGraphHostName)||Ne.EMPTY_STRING,msGraphHost:((g=r.account)==null?void 0:g.msGraphHost)||Ne.EMPTY_STRING,code:h==null?void 0:h.spa_code,fromNativeBroker:!1}]}})})},n}(),kV=function(n){function e(t,r){return t=n.call(this,t,r)||this,t.includeRedirectUri=!0,t}return us(e,n),e.prototype.getAuthCodeUrl=function(t){var r;return Vn(this,void 0,void 0,function(){var i;return Hn(this,function(o){switch(o.label){case 0:return(r=this.performanceClient)!=null&&r.addQueueMeasurement(nt.GetAuthCodeUrl,t.correlationId),(r=this.performanceClient)!=null&&r.setPreQueueTime(nt.AuthClientCreateQueryString,t.correlationId),[4,this.createAuthCodeUrlQueryString(t)];case 1:return i=o.sent(),[2,xr.appendQueryString(this.authority.authorizationEndpoint,i)]}})})},e.prototype.acquireToken=function(t,r){var i,o;return Vn(this,void 0,void 0,function(){var a,l,h,p,g,_=this;return Hn(this,function(x){switch(x.label){case 0:if(t&&t.code)return(i=this.performanceClient)!=null&&i.addQueueMeasurement(nt.AuthClientAcquireToken,t.correlationId),a=(i=this.performanceClient)==null?void 0:i.startMeasurement("AuthCodeClientAcquireToken",t.correlationId),this.logger.info("in acquireToken call in auth-code client"),l=ac.nowSeconds(),(i=this.performanceClient)!=null&&i.setPreQueueTime(nt.AuthClientExecuteTokenRequest,t.correlationId),[4,this.executeTokenRequest(this.authority,t)];throw tn.createTokenRequestCannotBeMadeError();case 1:return h=x.sent(),p=(i=h.headers)==null?void 0:i[Fs.X_MS_REQUEST_ID],(g=(o=h.headers)==null?void 0:o[Fs.X_MS_HTTP_VERSION])&&a!=null&&a.addStaticFields({httpVerAuthority:g}),(g=new GE(this.config.authOptions.clientId,this.cacheManager,this.cryptoUtils,this.logger,this.config.serializableCache,this.config.persistencePlugin,this.performanceClient)).validateTokenResponse(h.body),(o=this.performanceClient)!=null&&o.setPreQueueTime(nt.HandleServerTokenResponse,t.correlationId),[2,g.handleServerTokenResponse(h.body,this.authority,l,t,r,void 0,void 0,void 0,p).then(function(C){return a!=null&&a.endMeasurement({success:!0}),C}).catch(function(C){throw _.logger.verbose("Error in fetching token in ACC",t.correlationId),a!=null&&a.endMeasurement({errorCode:C.errorCode,subErrorCode:C.subError,success:!1}),C})]}})})},e.prototype.handleFragmentResponse=function(o,r){var i=new GE(this.config.authOptions.clientId,this.cacheManager,this.cryptoUtils,this.logger,null,null),o=new xr(o),o=xr.getDeserializedHash(o.getHash());if(i.validateServerAuthorizationCodeResponse(o,r,this.cryptoUtils),o.code)return Yr(Yr({},o),{code:o.code});throw tn.createNoAuthCodeInServerResponseError()},e.prototype.getLogoutUri=function(t){if(t)return t=this.createLogoutUrlQueryString(t),xr.appendQueryString(this.authority.endSessionEndpoint,t);throw vi.createEmptyLogoutRequestError()},e.prototype.executeTokenRequest=function(t,r){var i;return Vn(this,void 0,void 0,function(){var o,a,l,h,p;return Hn(this,function(g){switch(g.label){case 0:return(i=this.performanceClient)!=null&&i.addQueueMeasurement(nt.AuthClientExecuteTokenRequest,r.correlationId),(i=this.performanceClient)!=null&&i.setPreQueueTime(nt.AuthClientCreateTokenRequestBody,r.correlationId),o=this.createTokenQueryParameters(r),o=xr.appendQueryString(t.tokenEndpoint,o),[4,this.createTokenRequestBody(r)];case 1:if(a=g.sent(),h=void 0,r.clientInfo)try{l=zE(r.clientInfo,this.cryptoUtils),h={credential:""+l.uid+So.CLIENT_INFO_SEPARATOR+l.utid,type:Ns.HOME_ACCOUNT_ID}}catch(_){this.logger.verbose("Could not parse client info for CCS Header: "+_)}return h=this.createTokenRequestHeaders(h||r.ccsCredential),p={clientId:this.config.authOptions.clientId,authority:t.canonicalAuthority,scopes:r.scopes,claims:r.claims,authenticationScheme:r.authenticationScheme,resourceRequestMethod:r.resourceRequestMethod,resourceRequestUri:r.resourceRequestUri,shrClaims:r.shrClaims,sshKid:r.sshKid},[2,this.executePostToTokenEndpoint(o,a,h,p)]}})})},e.prototype.createTokenRequestBody=function(t){var r;return Vn(this,void 0,void 0,function(){var i,o,a,l,h,p;return Hn(this,function(g){switch(g.label){case 0:return(r=this.performanceClient)!=null&&r.addQueueMeasurement(nt.AuthClientCreateTokenRequestBody,t.correlationId),(i=new u0).addClientId(this.config.authOptions.clientId),this.includeRedirectUri?i.addRedirectUri(t.redirectUri):sf.validateRedirectUri(t.redirectUri),i.addScopes(t.scopes),i.addAuthorizationCode(t.code),i.addLibraryInfo(this.config.libraryInfo),i.addApplicationTelemetry(this.config.telemetry.application),i.addThrottling(),this.serverTelemetryManager&&i.addServerTelemetry(this.serverTelemetryManager),t.codeVerifier&&i.addCodeVerifier(t.codeVerifier),this.config.clientCredentials.clientSecret&&i.addClientSecret(this.config.clientCredentials.clientSecret),this.config.clientCredentials.clientAssertion&&(o=this.config.clientCredentials.clientAssertion,i.addClientAssertion(o.assertion),i.addClientAssertionType(o.assertionType)),i.addGrantType(FE.AUTHORIZATION_CODE_GRANT),i.addClientInfo(),t.authenticationScheme!==Kr.POP?[3,2]:(o=new ly(this.cryptoUtils,this.performanceClient),(r=this.performanceClient)!=null&&r.setPreQueueTime(nt.PopTokenGenerateCnf,t.correlationId),[4,o.generateCnf(t)]);case 1:return a=g.sent(),i.addPopToken(a.reqCnfString),[3,3];case 2:if(t.authenticationScheme===Kr.SSH){if(!t.sshJwk)throw vi.createMissingSshJwkError();i.addSshJwk(t.sshJwk)}g.label=3;case 3:if(a=t.correlationId||this.config.cryptoInterface.createNewGuid(),i.addCorrelationId(a),(!Zt.isEmptyObj(t.claims)||this.config.authOptions.clientCapabilities&&0<this.config.authOptions.clientCapabilities.length)&&i.addClaims(t.claims,this.config.authOptions.clientCapabilities),l=void 0,t.clientInfo)try{h=zE(t.clientInfo,this.cryptoUtils),l={credential:""+h.uid+So.CLIENT_INFO_SEPARATOR+h.utid,type:Ns.HOME_ACCOUNT_ID}}catch(_){this.logger.verbose("Could not parse client info for CCS Header: "+_)}else l=t.ccsCredential;if(this.config.systemOptions.preventCorsPreflight&&l)switch(l.type){case Ns.HOME_ACCOUNT_ID:try{h=hm(l.credential),i.addCcsOid(h)}catch(_){this.logger.verbose("Could not parse home account ID for CCS Header: "+_)}break;case Ns.UPN:i.addCcsUpn(l.credential)}return t.tokenBodyParameters&&i.addExtraQueryParameters(t.tokenBodyParameters),!t.enableSpaAuthorizationCode||t.tokenBodyParameters&&t.tokenBodyParameters[Yn.RETURN_SPA_CODE]||i.addExtraQueryParameters(((p={})[Yn.RETURN_SPA_CODE]="1",p)),[2,i.createQueryString()]}})})},e.prototype.createAuthCodeUrlQueryString=function(t){var r;return Vn(this,void 0,void 0,function(){var i,o,a,l;return Hn(this,function(h){switch(h.label){case 0:if((r=this.performanceClient)!=null&&r.addQueueMeasurement(nt.AuthClientCreateQueryString,t.correlationId),(i=new u0).addClientId(this.config.authOptions.clientId),o=FT(t.scopes||[],t.extraScopesToConsent||[]),i.addScopes(o),i.addRedirectUri(t.redirectUri),o=t.correlationId||this.config.cryptoInterface.createNewGuid(),i.addCorrelationId(o),i.addResponseMode(t.responseMode),i.addResponseTypeCode(),i.addLibraryInfo(this.config.libraryInfo),i.addApplicationTelemetry(this.config.telemetry.application),i.addClientInfo(),t.codeChallenge&&t.codeChallengeMethod&&i.addCodeChallengeParams(t.codeChallenge,t.codeChallengeMethod),t.prompt&&i.addPrompt(t.prompt),t.domainHint&&i.addDomainHint(t.domainHint),t.prompt!==ya.SELECT_ACCOUNT)if(t.sid&&t.prompt===ya.NONE)this.logger.verbose("createAuthCodeUrlQueryString: Prompt is none, adding sid from request"),i.addSid(t.sid);else if(t.account){if(o=this.extractAccountSid(t.account),l=this.extractLoginHint(t.account)){this.logger.verbose("createAuthCodeUrlQueryString: login_hint claim present on account"),i.addLoginHint(l);try{a=hm(t.account.homeAccountId),i.addCcsOid(a)}catch{this.logger.verbose("createAuthCodeUrlQueryString: Could not parse home account ID for CCS Header")}}else if(o&&t.prompt===ya.NONE){this.logger.verbose("createAuthCodeUrlQueryString: Prompt is none, adding sid from account"),i.addSid(o);try{a=hm(t.account.homeAccountId),i.addCcsOid(a)}catch{this.logger.verbose("createAuthCodeUrlQueryString: Could not parse home account ID for CCS Header")}}else if(t.loginHint)this.logger.verbose("createAuthCodeUrlQueryString: Adding login_hint from request"),i.addLoginHint(t.loginHint),i.addCcsUpn(t.loginHint);else if(t.account.username){this.logger.verbose("createAuthCodeUrlQueryString: Adding login_hint from account"),i.addLoginHint(t.account.username);try{a=hm(t.account.homeAccountId),i.addCcsOid(a)}catch{this.logger.verbose("createAuthCodeUrlQueryString: Could not parse home account ID for CCS Header")}}}else t.loginHint&&(this.logger.verbose("createAuthCodeUrlQueryString: No account, adding login_hint from request"),i.addLoginHint(t.loginHint),i.addCcsUpn(t.loginHint));else this.logger.verbose("createAuthCodeUrlQueryString: Prompt is select_account, ignoring account hints");return t.nonce&&i.addNonce(t.nonce),t.state&&i.addState(t.state),(!Zt.isEmpty(t.claims)||this.config.authOptions.clientCapabilities&&0<this.config.authOptions.clientCapabilities.length)&&i.addClaims(t.claims,this.config.authOptions.clientCapabilities),t.extraQueryParameters&&i.addExtraQueryParameters(t.extraQueryParameters),t.nativeBroker?(i.addNativeBroker(),t.authenticationScheme!==Kr.POP?[3,2]:[4,new ly(this.cryptoUtils).generateCnf(t)]):[3,2];case 1:l=h.sent(),i.addPopToken(l.reqCnfString),h.label=2;case 2:return[2,i.createQueryString()]}})})},e.prototype.createLogoutUrlQueryString=function(t){var r=new u0;return t.postLogoutRedirectUri&&r.addPostLogoutRedirectUri(t.postLogoutRedirectUri),t.correlationId&&r.addCorrelationId(t.correlationId),t.idTokenHint&&r.addIdTokenHint(t.idTokenHint),t.state&&r.addState(t.state),t.logoutHint&&r.addLogoutHint(t.logoutHint),t.extraQueryParameters&&r.addExtraQueryParameters(t.extraQueryParameters),r.createQueryString()},e.prototype.extractAccountSid=function(t){return((t=t.idTokenClaims)==null?void 0:t.sid)||null},e.prototype.extractLoginHint=function(t){return((t=t.idTokenClaims)==null?void 0:t.login_hint)||null},e}(ck),OV=function(n){function e(t,r){return n.call(this,t,r)||this}return us(e,n),e.prototype.acquireToken=function(t){var r,i,o;return Vn(this,void 0,void 0,function(){var a,l,h,p,g,_=this;return Hn(this,function(x){switch(x.label){case 0:return(r=this.performanceClient)!=null&&r.addQueueMeasurement(nt.RefreshTokenClientAcquireToken,t.correlationId),a=(r=this.performanceClient)==null?void 0:r.startMeasurement(nt.RefreshTokenClientAcquireToken,t.correlationId),this.logger.verbose("RefreshTokenClientAcquireToken called",t.correlationId),l=ac.nowSeconds(),(r=this.performanceClient)!=null&&r.setPreQueueTime(nt.RefreshTokenClientExecuteTokenRequest,t.correlationId),[4,this.executeTokenRequest(t,this.authority)];case 1:return h=x.sent(),p=(r=h.headers)==null?void 0:r[Fs.X_MS_HTTP_VERSION],a!=null&&a.addStaticFields({refreshTokenSize:((i=h.body.refresh_token)==null?void 0:i.length)||0}),p&&a!=null&&a.addStaticFields({httpVerToken:p}),p=(i=h.headers)==null?void 0:i[Fs.X_MS_REQUEST_ID],(g=new GE(this.config.authOptions.clientId,this.cacheManager,this.cryptoUtils,this.logger,this.config.serializableCache,this.config.persistencePlugin)).validateTokenResponse(h.body),(o=this.performanceClient)!=null&&o.setPreQueueTime(nt.HandleServerTokenResponse,t.correlationId),[2,g.handleServerTokenResponse(h.body,this.authority,l,t,void 0,void 0,!0,t.forceCache,p).then(function(C){return a!=null&&a.endMeasurement({success:!0}),C}).catch(function(C){throw _.logger.verbose("Error in fetching refresh token",t.correlationId),a!=null&&a.endMeasurement({errorCode:C.errorCode,subErrorCode:C.subError,success:!1}),C})]}})})},e.prototype.acquireTokenByRefreshToken=function(t){var r,i;return Vn(this,void 0,void 0,function(){var o,a;return Hn(this,function(l){if(!t)throw vi.createEmptyTokenRequestError();if((i=this.performanceClient)!=null&&i.addQueueMeasurement(nt.RefreshTokenClientAcquireTokenByRefreshToken,t.correlationId),!t.account)throw tn.createNoAccountInSilentRequestError();if(this.cacheManager.isAppMetadataFOCI(t.account.environment))try{return(r=this.performanceClient)!=null&&r.setPreQueueTime(nt.RefreshTokenClientAcquireTokenWithCachedRefreshToken,t.correlationId),[2,this.acquireTokenWithCachedRefreshToken(t,!0)]}catch(h){if(o=h instanceof rc&&h.errorCode===fm.noTokensFoundError.code,a=h instanceof Jf&&h.errorCode===GF.INVALID_GRANT_ERROR&&h.subError===GF.CLIENT_MISMATCH_ERROR,o||a)return(i=this.performanceClient)!=null&&i.setPreQueueTime(nt.RefreshTokenClientAcquireTokenWithCachedRefreshToken,t.correlationId),[2,this.acquireTokenWithCachedRefreshToken(t,!1)];throw h}return(i=this.performanceClient)!=null&&i.setPreQueueTime(nt.RefreshTokenClientAcquireTokenWithCachedRefreshToken,t.correlationId),[2,this.acquireTokenWithCachedRefreshToken(t,!1)]})})},e.prototype.acquireTokenWithCachedRefreshToken=function(t,r){var i;return Vn(this,void 0,void 0,function(){var o,a;return Hn(this,function(l){if((i=this.performanceClient)!=null&&i.addQueueMeasurement(nt.RefreshTokenClientAcquireTokenWithCachedRefreshToken,t.correlationId),o=(i=this.performanceClient)==null?void 0:i.startMeasurement(nt.RefreshTokenClientAcquireTokenWithCachedRefreshToken,t.correlationId),this.logger.verbose("RefreshTokenClientAcquireTokenWithCachedRefreshToken called",t.correlationId),a=this.cacheManager.getRefreshToken(t.account,r))return o!=null&&o.endMeasurement({success:!0}),a=Yr(Yr({},t),{refreshToken:a.secret,authenticationScheme:t.authenticationScheme||Kr.BEARER,ccsCredential:{credential:t.account.homeAccountId,type:Ns.HOME_ACCOUNT_ID}}),(i=this.performanceClient)!=null&&i.setPreQueueTime(nt.RefreshTokenClientAcquireToken,t.correlationId),[2,this.acquireToken(a)];throw o!=null&&o.discardMeasurement(),rc.createNoTokensFoundError()})})},e.prototype.executeTokenRequest=function(t,r){var i;return Vn(this,void 0,void 0,function(){var o,a,l,h,p;return Hn(this,function(g){switch(g.label){case 0:return(i=this.performanceClient)!=null&&i.addQueueMeasurement(nt.RefreshTokenClientExecuteTokenRequest,t.correlationId),o=(i=this.performanceClient)==null?void 0:i.startMeasurement(nt.RefreshTokenClientExecuteTokenRequest,t.correlationId),(i=this.performanceClient)!=null&&i.setPreQueueTime(nt.RefreshTokenClientCreateTokenRequestBody,t.correlationId),a=this.createTokenQueryParameters(t),a=xr.appendQueryString(r.tokenEndpoint,a),[4,this.createTokenRequestBody(t)];case 1:return l=g.sent(),h=this.createTokenRequestHeaders(t.ccsCredential),p={clientId:this.config.authOptions.clientId,authority:r.canonicalAuthority,scopes:t.scopes,claims:t.claims,authenticationScheme:t.authenticationScheme,resourceRequestMethod:t.resourceRequestMethod,resourceRequestUri:t.resourceRequestUri,shrClaims:t.shrClaims,sshKid:t.sshKid},[2,this.executePostToTokenEndpoint(a,l,h,p).then(function(_){return o!=null&&o.endMeasurement({success:!0}),_}).catch(function(_){throw o!=null&&o.endMeasurement({success:!1}),_})]}})})},e.prototype.createTokenRequestBody=function(t){var r;return Vn(this,void 0,void 0,function(){var i,o,a,l;return Hn(this,function(h){switch(h.label){case 0:return(r=this.performanceClient)!=null&&r.addQueueMeasurement(nt.RefreshTokenClientCreateTokenRequestBody,t.correlationId),a=t.correlationId,i=(r=this.performanceClient)==null?void 0:r.startMeasurement(nt.BaseClientCreateTokenRequestHeaders,a),(o=new u0).addClientId(this.config.authOptions.clientId),o.addScopes(t.scopes),o.addGrantType(FE.REFRESH_TOKEN_GRANT),o.addClientInfo(),o.addLibraryInfo(this.config.libraryInfo),o.addApplicationTelemetry(this.config.telemetry.application),o.addThrottling(),this.serverTelemetryManager&&o.addServerTelemetry(this.serverTelemetryManager),o.addCorrelationId(a),o.addRefreshToken(t.refreshToken),this.config.clientCredentials.clientSecret&&o.addClientSecret(this.config.clientCredentials.clientSecret),this.config.clientCredentials.clientAssertion&&(a=this.config.clientCredentials.clientAssertion,o.addClientAssertion(a.assertion),o.addClientAssertionType(a.assertionType)),t.authenticationScheme!==Kr.POP?[3,2]:(a=new ly(this.cryptoUtils,this.performanceClient),(r=this.performanceClient)!=null&&r.setPreQueueTime(nt.PopTokenGenerateCnf,t.correlationId),[4,a.generateCnf(t)]);case 1:return a=h.sent(),o.addPopToken(a.reqCnfString),[3,3];case 2:if(t.authenticationScheme===Kr.SSH){if(!t.sshJwk)throw i!=null&&i.endMeasurement({success:!1}),vi.createMissingSshJwkError();o.addSshJwk(t.sshJwk)}h.label=3;case 3:if((!Zt.isEmptyObj(t.claims)||this.config.authOptions.clientCapabilities&&0<this.config.authOptions.clientCapabilities.length)&&o.addClaims(t.claims,this.config.authOptions.clientCapabilities),this.config.systemOptions.preventCorsPreflight&&t.ccsCredential)switch(t.ccsCredential.type){case Ns.HOME_ACCOUNT_ID:try{l=hm(t.ccsCredential.credential),o.addCcsOid(l)}catch(p){this.logger.verbose("Could not parse home account ID for CCS Header: "+p)}break;case Ns.UPN:o.addCcsUpn(t.ccsCredential.credential)}return i!=null&&i.endMeasurement({success:!0}),[2,o.createQueryString()]}})})},e}(ck),mEe=function(n){function e(t,r){return n.call(this,t,r)||this}return us(e,n),e.prototype.acquireToken=function(t){return Vn(this,void 0,void 0,function(){var r;return Hn(this,function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),[4,this.acquireCachedToken(t)];case 1:return[2,i.sent()];case 2:if((r=i.sent())instanceof tn&&r.errorCode===Mt.tokenRefreshRequired.code)return[2,new OV(this.config,this.performanceClient).acquireTokenByRefreshToken(t)];throw r;case 3:return[2]}})})},e.prototype.acquireCachedToken=function(t){var r,i,o;return Vn(this,void 0,void 0,function(){var a;return Hn(this,function(l){switch(l.label){case 0:if(!t)throw vi.createEmptyTokenRequestError();if(t.forceRefresh)throw(r=this.serverTelemetryManager)!=null&&r.setCacheOutcome(Bh.FORCE_REFRESH),this.logger.info("SilentFlowClient:acquireCachedToken - Skipping cache because forceRefresh is true."),tn.createRefreshRequiredError();if(!this.config.cacheOptions.claimsBasedCachingEnabled&&!Zt.isEmptyObj(t.claims))throw(r=this.serverTelemetryManager)!=null&&r.setCacheOutcome(Bh.CLAIMS_REQUESTED_CACHE_SKIPPED),this.logger.info("SilentFlowClient:acquireCachedToken - Skipping cache because claims-based caching is disabled and claims were requested."),tn.createRefreshRequiredError();if(!t.account)throw tn.createNoAccountInSilentRequestError();if(a=t.authority||this.authority.getPreferredCache(),!(a=this.cacheManager.readCacheRecord(t.account,t,a)).accessToken)throw(i=this.serverTelemetryManager)!=null&&i.setCacheOutcome(Bh.NO_CACHED_ACCESS_TOKEN),this.logger.info("SilentFlowClient:acquireCachedToken - No access token found in cache for the given properties."),tn.createRefreshRequiredError();if(ac.wasClockTurnedBack(a.accessToken.cachedAt)||ac.isTokenExpired(a.accessToken.expiresOn,this.config.systemOptions.tokenRenewalOffsetSeconds))throw(i=this.serverTelemetryManager)!=null&&i.setCacheOutcome(Bh.CACHED_ACCESS_TOKEN_EXPIRED),this.logger.info("SilentFlowClient:acquireCachedToken - Cached access token is expired or will expire within "+this.config.systemOptions.tokenRenewalOffsetSeconds+" seconds."),tn.createRefreshRequiredError();if(a.accessToken.refreshOn&&ac.isTokenExpired(a.accessToken.refreshOn,0))throw(o=this.serverTelemetryManager)!=null&&o.setCacheOutcome(Bh.REFRESH_CACHED_ACCESS_TOKEN),this.logger.info("SilentFlowClient:acquireCachedToken - Cached access token's refreshOn property has been exceeded'."),tn.createRefreshRequiredError();return this.config.serverTelemetryManager&&this.config.serverTelemetryManager.incrementCacheHits(),[4,this.generateResultFromCacheRecord(a,t)];case 1:return[2,l.sent()]}})})},e.prototype.generateResultFromCacheRecord=function(t,r){return Vn(this,void 0,void 0,function(){var i,o;return Hn(this,function(a){switch(a.label){case 0:if(t.idToken&&(i=new Pl(t.idToken.secret,this.config.cryptoInterface)),r.maxAge||r.maxAge===0){if(!(o=i==null?void 0:i.claims.auth_time))throw tn.createAuthTimeNotFoundError();Pl.checkMaxAge(o,r.maxAge)}return[4,GE.generateAuthenticationResult(this.cryptoUtils,this.authority,t,!0,r,i)];case 1:return[2,a.sent()]}})})},e}(ck);function yEe(n){return n.hasOwnProperty("authorization_endpoint")&&n.hasOwnProperty("token_endpoint")&&n.hasOwnProperty("issuer")&&n.hasOwnProperty("jwks_uri")}var Y0,LV={endpointMetadata:{"https://login.microsoftonline.com/common/":{token_endpoint:"https://login.microsoftonline.com/common/oauth2/v2.0/token",token_endpoint_auth_methods_supported:["client_secret_post","private_key_jwt","client_secret_basic"],jwks_uri:"https://login.microsoftonline.com/common/discovery/v2.0/keys",response_modes_supported:["query","fragment","form_post"],subject_types_supported:["pairwise"],id_token_signing_alg_values_supported:["RS256"],response_types_supported:["code","id_token","code id_token","id_token token"],scopes_supported:["openid","profile","email","offline_access"],issuer:"https://login.microsoftonline.com/{tenantid}/v2.0",request_uri_parameter_supported:!1,userinfo_endpoint:"https://graph.microsoft.com/oidc/userinfo",authorization_endpoint:"https://login.microsoftonline.com/common/oauth2/v2.0/authorize",device_authorization_endpoint:"https://login.microsoftonline.com/common/oauth2/v2.0/devicecode",http_logout_supported:!0,frontchannel_logout_supported:!0,end_session_endpoint:"https://login.microsoftonline.com/common/oauth2/v2.0/logout",claims_supported:["sub","iss","cloud_instance_name","cloud_instance_host_name","cloud_graph_host_name","msgraph_host","aud","exp","iat","auth_time","acr","nonce","preferred_username","name","tid","ver","at_hash","c_hash","email"],kerberos_endpoint:"https://login.microsoftonline.com/common/kerberos",tenant_region_scope:null,cloud_instance_name:"microsoftonline.com",cloud_graph_host_name:"graph.windows.net",msgraph_host:"graph.microsoft.com",rbac_url:"https://pas.windows.net"},"https://login.chinacloudapi.cn/common/":{token_endpoint:"https://login.chinacloudapi.cn/common/oauth2/v2.0/token",token_endpoint_auth_methods_supported:["client_secret_post","private_key_jwt","client_secret_basic"],jwks_uri:"https://login.chinacloudapi.cn/common/discovery/v2.0/keys",response_modes_supported:["query","fragment","form_post"],subject_types_supported:["pairwise"],id_token_signing_alg_values_supported:["RS256"],response_types_supported:["code","id_token","code id_token","id_token token"],scopes_supported:["openid","profile","email","offline_access"],issuer:"https://login.partner.microsoftonline.cn/{tenantid}/v2.0",request_uri_parameter_supported:!1,userinfo_endpoint:"https://microsoftgraph.chinacloudapi.cn/oidc/userinfo",authorization_endpoint:"https://login.chinacloudapi.cn/common/oauth2/v2.0/authorize",device_authorization_endpoint:"https://login.chinacloudapi.cn/common/oauth2/v2.0/devicecode",http_logout_supported:!0,frontchannel_logout_supported:!0,end_session_endpoint:"https://login.chinacloudapi.cn/common/oauth2/v2.0/logout",claims_supported:["sub","iss","cloud_instance_name","cloud_instance_host_name","cloud_graph_host_name","msgraph_host","aud","exp","iat","auth_time","acr","nonce","preferred_username","name","tid","ver","at_hash","c_hash","email"],kerberos_endpoint:"https://login.chinacloudapi.cn/common/kerberos",tenant_region_scope:null,cloud_instance_name:"partner.microsoftonline.cn",cloud_graph_host_name:"graph.chinacloudapi.cn",msgraph_host:"microsoftgraph.chinacloudapi.cn",rbac_url:"https://pas.chinacloudapi.cn"},"https://login.microsoftonline.us/common/":{token_endpoint:"https://login.microsoftonline.us/common/oauth2/v2.0/token",token_endpoint_auth_methods_supported:["client_secret_post","private_key_jwt","client_secret_basic"],jwks_uri:"https://login.microsoftonline.us/common/discovery/v2.0/keys",response_modes_supported:["query","fragment","form_post"],subject_types_supported:["pairwise"],id_token_signing_alg_values_supported:["RS256"],response_types_supported:["code","id_token","code id_token","id_token token"],scopes_supported:["openid","profile","email","offline_access"],issuer:"https://login.microsoftonline.us/{tenantid}/v2.0",request_uri_parameter_supported:!1,userinfo_endpoint:"https://graph.microsoft.com/oidc/userinfo",authorization_endpoint:"https://login.microsoftonline.us/common/oauth2/v2.0/authorize",device_authorization_endpoint:"https://login.microsoftonline.us/common/oauth2/v2.0/devicecode",http_logout_supported:!0,frontchannel_logout_supported:!0,end_session_endpoint:"https://login.microsoftonline.us/common/oauth2/v2.0/logout",claims_supported:["sub","iss","cloud_instance_name","cloud_instance_host_name","cloud_graph_host_name","msgraph_host","aud","exp","iat","auth_time","acr","nonce","preferred_username","name","tid","ver","at_hash","c_hash","email"],kerberos_endpoint:"https://login.microsoftonline.us/common/kerberos",tenant_region_scope:null,cloud_instance_name:"microsoftonline.us",cloud_graph_host_name:"graph.windows.net",msgraph_host:"graph.microsoft.com",rbac_url:"https://pasff.usgovcloudapi.net"},"https://login.microsoftonline.com/consumers/":{token_endpoint:"https://login.microsoftonline.com/consumers/oauth2/v2.0/token",token_endpoint_auth_methods_supported:["client_secret_post","private_key_jwt","client_secret_basic"],jwks_uri:"https://login.microsoftonline.com/consumers/discovery/v2.0/keys",response_modes_supported:["query","fragment","form_post"],subject_types_supported:["pairwise"],id_token_signing_alg_values_supported:["RS256"],response_types_supported:["code","id_token","code id_token","id_token token"],scopes_supported:["openid","profile","email","offline_access"],issuer:"https://login.microsoftonline.com/9188040d-6c67-4c5b-b112-36a304b66dad/v2.0",request_uri_parameter_supported:!1,userinfo_endpoint:"https://graph.microsoft.com/oidc/userinfo",authorization_endpoint:"https://login.microsoftonline.com/consumers/oauth2/v2.0/authorize",device_authorization_endpoint:"https://login.microsoftonline.com/consumers/oauth2/v2.0/devicecode",http_logout_supported:!0,frontchannel_logout_supported:!0,end_session_endpoint:"https://login.microsoftonline.com/consumers/oauth2/v2.0/logout",claims_supported:["sub","iss","cloud_instance_name","cloud_instance_host_name","cloud_graph_host_name","msgraph_host","aud","exp","iat","auth_time","acr","nonce","preferred_username","name","tid","ver","at_hash","c_hash","email"],kerberos_endpoint:"https://login.microsoftonline.com/consumers/kerberos",tenant_region_scope:null,cloud_instance_name:"microsoftonline.com",cloud_graph_host_name:"graph.windows.net",msgraph_host:"graph.microsoft.com",rbac_url:"https://pas.windows.net"},"https://login.chinacloudapi.cn/consumers/":{token_endpoint:"https://login.chinacloudapi.cn/consumers/oauth2/v2.0/token",token_endpoint_auth_methods_supported:["client_secret_post","private_key_jwt","client_secret_basic"],jwks_uri:"https://login.chinacloudapi.cn/consumers/discovery/v2.0/keys",response_modes_supported:["query","fragment","form_post"],subject_types_supported:["pairwise"],id_token_signing_alg_values_supported:["RS256"],response_types_supported:["code","id_token","code id_token","id_token token"],scopes_supported:["openid","profile","email","offline_access"],issuer:"https://login.partner.microsoftonline.cn/9188040d-6c67-4c5b-b112-36a304b66dad/v2.0",request_uri_parameter_supported:!1,userinfo_endpoint:"https://microsoftgraph.chinacloudapi.cn/oidc/userinfo",authorization_endpoint:"https://login.chinacloudapi.cn/consumers/oauth2/v2.0/authorize",device_authorization_endpoint:"https://login.chinacloudapi.cn/consumers/oauth2/v2.0/devicecode",http_logout_supported:!0,frontchannel_logout_supported:!0,end_session_endpoint:"https://login.chinacloudapi.cn/consumers/oauth2/v2.0/logout",claims_supported:["sub","iss","cloud_instance_name","cloud_instance_host_name","cloud_graph_host_name","msgraph_host","aud","exp","iat","auth_time","acr","nonce","preferred_username","name","tid","ver","at_hash","c_hash","email"],kerberos_endpoint:"https://login.chinacloudapi.cn/consumers/kerberos",tenant_region_scope:null,cloud_instance_name:"partner.microsoftonline.cn",cloud_graph_host_name:"graph.chinacloudapi.cn",msgraph_host:"microsoftgraph.chinacloudapi.cn",rbac_url:"https://pas.chinacloudapi.cn"},"https://login.microsoftonline.us/consumers/":{token_endpoint:"https://login.microsoftonline.us/consumers/oauth2/v2.0/token",token_endpoint_auth_methods_supported:["client_secret_post","private_key_jwt","client_secret_basic"],jwks_uri:"https://login.microsoftonline.us/consumers/discovery/v2.0/keys",response_modes_supported:["query","fragment","form_post"],subject_types_supported:["pairwise"],id_token_signing_alg_values_supported:["RS256"],response_types_supported:["code","id_token","code id_token","id_token token"],scopes_supported:["openid","profile","email","offline_access"],issuer:"https://login.microsoftonline.us/9188040d-6c67-4c5b-b112-36a304b66dad/v2.0",request_uri_parameter_supported:!1,userinfo_endpoint:"https://graph.microsoft.com/oidc/userinfo",authorization_endpoint:"https://login.microsoftonline.us/consumers/oauth2/v2.0/authorize",device_authorization_endpoint:"https://login.microsoftonline.us/consumers/oauth2/v2.0/devicecode",http_logout_supported:!0,frontchannel_logout_supported:!0,end_session_endpoint:"https://login.microsoftonline.us/consumers/oauth2/v2.0/logout",claims_supported:["sub","iss","cloud_instance_name","cloud_instance_host_name","cloud_graph_host_name","msgraph_host","aud","exp","iat","auth_time","acr","nonce","preferred_username","name","tid","ver","at_hash","c_hash","email"],kerberos_endpoint:"https://login.microsoftonline.us/consumers/kerberos",tenant_region_scope:null,cloud_instance_name:"microsoftonline.us",cloud_graph_host_name:"graph.windows.net",msgraph_host:"graph.microsoft.com",rbac_url:"https://pasff.usgovcloudapi.net"},"https://login.microsoftonline.com/organizations/":{token_endpoint:"https://login.microsoftonline.com/organizations/oauth2/v2.0/token",token_endpoint_auth_methods_supported:["client_secret_post","private_key_jwt","client_secret_basic"],jwks_uri:"https://login.microsoftonline.com/organizations/discovery/v2.0/keys",response_modes_supported:["query","fragment","form_post"],subject_types_supported:["pairwise"],id_token_signing_alg_values_supported:["RS256"],response_types_supported:["code","id_token","code id_token","id_token token"],scopes_supported:["openid","profile","email","offline_access"],issuer:"https://login.microsoftonline.com/{tenantid}/v2.0",request_uri_parameter_supported:!1,userinfo_endpoint:"https://graph.microsoft.com/oidc/userinfo",authorization_endpoint:"https://login.microsoftonline.com/organizations/oauth2/v2.0/authorize",device_authorization_endpoint:"https://login.microsoftonline.com/organizations/oauth2/v2.0/devicecode",http_logout_supported:!0,frontchannel_logout_supported:!0,end_session_endpoint:"https://login.microsoftonline.com/organizations/oauth2/v2.0/logout",claims_supported:["sub","iss","cloud_instance_name","cloud_instance_host_name","cloud_graph_host_name","msgraph_host","aud","exp","iat","auth_time","acr","nonce","preferred_username","name","tid","ver","at_hash","c_hash","email"],kerberos_endpoint:"https://login.microsoftonline.com/organizations/kerberos",tenant_region_scope:null,cloud_instance_name:"microsoftonline.com",cloud_graph_host_name:"graph.windows.net",msgraph_host:"graph.microsoft.com",rbac_url:"https://pas.windows.net"},"https://login.chinacloudapi.cn/organizations/":{token_endpoint:"https://login.chinacloudapi.cn/organizations/oauth2/v2.0/token",token_endpoint_auth_methods_supported:["client_secret_post","private_key_jwt","client_secret_basic"],jwks_uri:"https://login.chinacloudapi.cn/organizations/discovery/v2.0/keys",response_modes_supported:["query","fragment","form_post"],subject_types_supported:["pairwise"],id_token_signing_alg_values_supported:["RS256"],response_types_supported:["code","id_token","code id_token","id_token token"],scopes_supported:["openid","profile","email","offline_access"],issuer:"https://login.partner.microsoftonline.cn/{tenantid}/v2.0",request_uri_parameter_supported:!1,userinfo_endpoint:"https://microsoftgraph.chinacloudapi.cn/oidc/userinfo",authorization_endpoint:"https://login.chinacloudapi.cn/organizations/oauth2/v2.0/authorize",device_authorization_endpoint:"https://login.chinacloudapi.cn/organizations/oauth2/v2.0/devicecode",http_logout_supported:!0,frontchannel_logout_supported:!0,end_session_endpoint:"https://login.chinacloudapi.cn/organizations/oauth2/v2.0/logout",claims_supported:["sub","iss","cloud_instance_name","cloud_instance_host_name","cloud_graph_host_name","msgraph_host","aud","exp","iat","auth_time","acr","nonce","preferred_username","name","tid","ver","at_hash","c_hash","email"],kerberos_endpoint:"https://login.chinacloudapi.cn/organizations/kerberos",tenant_region_scope:null,cloud_instance_name:"partner.microsoftonline.cn",cloud_graph_host_name:"graph.chinacloudapi.cn",msgraph_host:"microsoftgraph.chinacloudapi.cn",rbac_url:"https://pas.chinacloudapi.cn"},"https://login.microsoftonline.us/organizations/":{token_endpoint:"https://login.microsoftonline.us/organizations/oauth2/v2.0/token",token_endpoint_auth_methods_supported:["client_secret_post","private_key_jwt","client_secret_basic"],jwks_uri:"https://login.microsoftonline.us/organizations/discovery/v2.0/keys",response_modes_supported:["query","fragment","form_post"],subject_types_supported:["pairwise"],id_token_signing_alg_values_supported:["RS256"],response_types_supported:["code","id_token","code id_token","id_token token"],scopes_supported:["openid","profile","email","offline_access"],issuer:"https://login.microsoftonline.us/{tenantid}/v2.0",request_uri_parameter_supported:!1,userinfo_endpoint:"https://graph.microsoft.com/oidc/userinfo",authorization_endpoint:"https://login.microsoftonline.us/organizations/oauth2/v2.0/authorize",device_authorization_endpoint:"https://login.microsoftonline.us/organizations/oauth2/v2.0/devicecode",http_logout_supported:!0,frontchannel_logout_supported:!0,end_session_endpoint:"https://login.microsoftonline.us/organizations/oauth2/v2.0/logout",claims_supported:["sub","iss","cloud_instance_name","cloud_instance_host_name","cloud_graph_host_name","msgraph_host","aud","exp","iat","auth_time","acr","nonce","preferred_username","name","tid","ver","at_hash","c_hash","email"],kerberos_endpoint:"https://login.microsoftonline.us/organizations/kerberos",tenant_region_scope:null,cloud_instance_name:"microsoftonline.us",cloud_graph_host_name:"graph.windows.net",msgraph_host:"graph.microsoft.com",rbac_url:"https://pasff.usgovcloudapi.net"}},instanceDiscoveryMetadata:{"https://login.microsoftonline.com/common/":{tenant_discovery_endpoint:"https://login.microsoftonline.com/common/v2.0/.well-known/openid-configuration","api-version":"1.1",metadata:[{preferred_network:"login.microsoftonline.com",preferred_cache:"login.windows.net",aliases:["login.microsoftonline.com","login.windows.net","login.microsoft.com","sts.windows.net"]},{preferred_network:"login.partner.microsoftonline.cn",preferred_cache:"login.partner.microsoftonline.cn",aliases:["login.partner.microsoftonline.cn","login.chinacloudapi.cn"]},{preferred_network:"login.microsoftonline.de",preferred_cache:"login.microsoftonline.de",aliases:["login.microsoftonline.de"]},{preferred_network:"login.microsoftonline.us",preferred_cache:"login.microsoftonline.us",aliases:["login.microsoftonline.us","login.usgovcloudapi.net"]},{preferred_network:"login-us.microsoftonline.com",preferred_cache:"login-us.microsoftonline.com",aliases:["login-us.microsoftonline.com"]}]},"https://login.chinacloudapi.cn/common/":{tenant_discovery_endpoint:"https://login.chinacloudapi.cn/common/v2.0/.well-known/openid-configuration","api-version":"1.1",metadata:[{preferred_network:"login.microsoftonline.com",preferred_cache:"login.windows.net",aliases:["login.microsoftonline.com","login.windows.net","login.microsoft.com","sts.windows.net"]},{preferred_network:"login.partner.microsoftonline.cn",preferred_cache:"login.partner.microsoftonline.cn",aliases:["login.partner.microsoftonline.cn","login.chinacloudapi.cn"]},{preferred_network:"login.microsoftonline.de",preferred_cache:"login.microsoftonline.de",aliases:["login.microsoftonline.de"]},{preferred_network:"login.microsoftonline.us",preferred_cache:"login.microsoftonline.us",aliases:["login.microsoftonline.us","login.usgovcloudapi.net"]},{preferred_network:"login-us.microsoftonline.com",preferred_cache:"login-us.microsoftonline.com",aliases:["login-us.microsoftonline.com"]}]},"https://login.microsoftonline.us/common/":{tenant_discovery_endpoint:"https://login.microsoftonline.us/common/v2.0/.well-known/openid-configuration","api-version":"1.1",metadata:[{preferred_network:"login.microsoftonline.com",preferred_cache:"login.windows.net",aliases:["login.microsoftonline.com","login.windows.net","login.microsoft.com","sts.windows.net"]},{preferred_network:"login.partner.microsoftonline.cn",preferred_cache:"login.partner.microsoftonline.cn",aliases:["login.partner.microsoftonline.cn","login.chinacloudapi.cn"]},{preferred_network:"login.microsoftonline.de",preferred_cache:"login.microsoftonline.de",aliases:["login.microsoftonline.de"]},{preferred_network:"login.microsoftonline.us",preferred_cache:"login.microsoftonline.us",aliases:["login.microsoftonline.us","login.usgovcloudapi.net"]},{preferred_network:"login-us.microsoftonline.com",preferred_cache:"login-us.microsoftonline.com",aliases:["login-us.microsoftonline.com"]}]},"https://login.microsoftonline.com/consumers/":{tenant_discovery_endpoint:"https://login.microsoftonline.com/consumers/v2.0/.well-known/openid-configuration","api-version":"1.1",metadata:[{preferred_network:"login.microsoftonline.com",preferred_cache:"login.windows.net",aliases:["login.microsoftonline.com","login.windows.net","login.microsoft.com","sts.windows.net"]},{preferred_network:"login.partner.microsoftonline.cn",preferred_cache:"login.partner.microsoftonline.cn",aliases:["login.partner.microsoftonline.cn","login.chinacloudapi.cn"]},{preferred_network:"login.microsoftonline.de",preferred_cache:"login.microsoftonline.de",aliases:["login.microsoftonline.de"]},{preferred_network:"login.microsoftonline.us",preferred_cache:"login.microsoftonline.us",aliases:["login.microsoftonline.us","login.usgovcloudapi.net"]},{preferred_network:"login-us.microsoftonline.com",preferred_cache:"login-us.microsoftonline.com",aliases:["login-us.microsoftonline.com"]}]},"https://login.chinacloudapi.cn/consumers/":{tenant_discovery_endpoint:"https://login.chinacloudapi.cn/consumers/v2.0/.well-known/openid-configuration","api-version":"1.1",metadata:[{preferred_network:"login.microsoftonline.com",preferred_cache:"login.windows.net",aliases:["login.microsoftonline.com","login.windows.net","login.microsoft.com","sts.windows.net"]},{preferred_network:"login.partner.microsoftonline.cn",preferred_cache:"login.partner.microsoftonline.cn",aliases:["login.partner.microsoftonline.cn","login.chinacloudapi.cn"]},{preferred_network:"login.microsoftonline.de",preferred_cache:"login.microsoftonline.de",aliases:["login.microsoftonline.de"]},{preferred_network:"login.microsoftonline.us",preferred_cache:"login.microsoftonline.us",aliases:["login.microsoftonline.us","login.usgovcloudapi.net"]},{preferred_network:"login-us.microsoftonline.com",preferred_cache:"login-us.microsoftonline.com",aliases:["login-us.microsoftonline.com"]}]},"https://login.microsoftonline.us/consumers/":{tenant_discovery_endpoint:"https://login.microsoftonline.us/consumers/v2.0/.well-known/openid-configuration","api-version":"1.1",metadata:[{preferred_network:"login.microsoftonline.com",preferred_cache:"login.windows.net",aliases:["login.microsoftonline.com","login.windows.net","login.microsoft.com","sts.windows.net"]},{preferred_network:"login.partner.microsoftonline.cn",preferred_cache:"login.partner.microsoftonline.cn",aliases:["login.partner.microsoftonline.cn","login.chinacloudapi.cn"]},{preferred_network:"login.microsoftonline.de",preferred_cache:"login.microsoftonline.de",aliases:["login.microsoftonline.de"]},{preferred_network:"login.microsoftonline.us",preferred_cache:"login.microsoftonline.us",aliases:["login.microsoftonline.us","login.usgovcloudapi.net"]},{preferred_network:"login-us.microsoftonline.com",preferred_cache:"login-us.microsoftonline.com",aliases:["login-us.microsoftonline.com"]}]},"https://login.microsoftonline.com/organizations/":{tenant_discovery_endpoint:"https://login.microsoftonline.com/organizations/v2.0/.well-known/openid-configuration","api-version":"1.1",metadata:[{preferred_network:"login.microsoftonline.com",preferred_cache:"login.windows.net",aliases:["login.microsoftonline.com","login.windows.net","login.microsoft.com","sts.windows.net"]},{preferred_network:"login.partner.microsoftonline.cn",preferred_cache:"login.partner.microsoftonline.cn",aliases:["login.partner.microsoftonline.cn","login.chinacloudapi.cn"]},{preferred_network:"login.microsoftonline.de",preferred_cache:"login.microsoftonline.de",aliases:["login.microsoftonline.de"]},{preferred_network:"login.microsoftonline.us",preferred_cache:"login.microsoftonline.us",aliases:["login.microsoftonline.us","login.usgovcloudapi.net"]},{preferred_network:"login-us.microsoftonline.com",preferred_cache:"login-us.microsoftonline.com",aliases:["login-us.microsoftonline.com"]}]},"https://login.chinacloudapi.cn/organizations/":{tenant_discovery_endpoint:"https://login.chinacloudapi.cn/organizations/v2.0/.well-known/openid-configuration","api-version":"1.1",metadata:[{preferred_network:"login.microsoftonline.com",preferred_cache:"login.windows.net",aliases:["login.microsoftonline.com","login.windows.net","login.microsoft.com","sts.windows.net"]},{preferred_network:"login.partner.microsoftonline.cn",preferred_cache:"login.partner.microsoftonline.cn",aliases:["login.partner.microsoftonline.cn","login.chinacloudapi.cn"]},{preferred_network:"login.microsoftonline.de",preferred_cache:"login.microsoftonline.de",aliases:["login.microsoftonline.de"]},{preferred_network:"login.microsoftonline.us",preferred_cache:"login.microsoftonline.us",aliases:["login.microsoftonline.us","login.usgovcloudapi.net"]},{preferred_network:"login-us.microsoftonline.com",preferred_cache:"login-us.microsoftonline.com",aliases:["login-us.microsoftonline.com"]}]},"https://login.microsoftonline.us/organizations/":{tenant_discovery_endpoint:"https://login.microsoftonline.us/organizations/v2.0/.well-known/openid-configuration","api-version":"1.1",metadata:[{preferred_network:"login.microsoftonline.com",preferred_cache:"login.windows.net",aliases:["login.microsoftonline.com","login.windows.net","login.microsoft.com","sts.windows.net"]},{preferred_network:"login.partner.microsoftonline.cn",preferred_cache:"login.partner.microsoftonline.cn",aliases:["login.partner.microsoftonline.cn","login.chinacloudapi.cn"]},{preferred_network:"login.microsoftonline.de",preferred_cache:"login.microsoftonline.de",aliases:["login.microsoftonline.de"]},{preferred_network:"login.microsoftonline.us",preferred_cache:"login.microsoftonline.us",aliases:["login.microsoftonline.us","login.usgovcloudapi.net"]},{preferred_network:"login-us.microsoftonline.com",preferred_cache:"login-us.microsoftonline.com",aliases:["login-us.microsoftonline.com"]}]}}},$F=LV.endpointMetadata,WF=LV.instanceDiscoveryMetadata,FP=(function(n){n.AAD="AAD",n.OIDC="OIDC"}(Y0=Y0||{}),function(){function n(){this.expiresAt=ac.nowSeconds()+c0.REFRESH_TIME_SECONDS}return n.prototype.updateCloudDiscoveryMetadata=function(e,t){this.aliases=e.aliases,this.preferred_cache=e.preferred_cache,this.preferred_network=e.preferred_network,this.aliasesFromNetwork=t},n.prototype.updateEndpointMetadata=function(e,t){this.authorization_endpoint=e.authorization_endpoint,this.token_endpoint=e.token_endpoint,this.end_session_endpoint=e.end_session_endpoint,this.issuer=e.issuer,this.endpointsFromNetwork=t,this.jwks_uri=e.jwks_uri},n.prototype.updateCanonicalAuthority=function(e){this.canonical_authority=e},n.prototype.resetExpiresAt=function(){this.expiresAt=ac.nowSeconds()+c0.REFRESH_TIME_SECONDS},n.prototype.isExpired=function(){return this.expiresAt<=ac.nowSeconds()},n.isAuthorityMetadataEntity=function(e,t){return!!t&&e.indexOf(c0.CACHE_KEY)===0&&t.hasOwnProperty("aliases")&&t.hasOwnProperty("preferred_cache")&&t.hasOwnProperty("preferred_network")&&t.hasOwnProperty("canonical_authority")&&t.hasOwnProperty("authorization_endpoint")&&t.hasOwnProperty("token_endpoint")&&t.hasOwnProperty("issuer")&&t.hasOwnProperty("aliasesFromNetwork")&&t.hasOwnProperty("endpointsFromNetwork")&&t.hasOwnProperty("expiresAt")&&t.hasOwnProperty("jwks_uri")},n}());function _Ee(n){return n.hasOwnProperty("tenant_discovery_endpoint")&&n.hasOwnProperty("metadata")}function vEe(n){return n.hasOwnProperty("error")&&n.hasOwnProperty("error_description")}var lu,po,sl,kr,nl,pm,_i,gn,YF,KF,Ja,Bn,Rh,bEe=function(){function n(e,t,r){this.networkInterface=e,this.performanceClient=t,this.correlationId=r}return n.prototype.detectRegion=function(e,t){var r,i;return Vn(this,void 0,void 0,function(){var o,a,l,h;return Hn(this,function(p){switch(p.label){case 0:if((r=this.performanceClient)!=null&&r.addQueueMeasurement(nt.RegionDiscoveryDetectRegion,this.correlationId),o=e)return[3,8];a=n.IMDS_OPTIONS,p.label=1;case 1:return p.trys.push([1,6,,7]),(r=this.performanceClient)!=null&&r.setPreQueueTime(nt.RegionDiscoveryGetRegionFromIMDS,this.correlationId),[4,this.getRegionFromIMDS(Ne.IMDS_VERSION,a)];case 2:return(l=p.sent()).status===um.httpSuccess&&(o=l.body,t.region_source=Mh.IMDS),l.status!==um.httpBadRequest?[3,5]:((i=this.performanceClient)!=null&&i.setPreQueueTime(nt.RegionDiscoveryGetCurrentVersion,this.correlationId),[4,this.getCurrentVersion(a)]);case 3:return(l=p.sent())?((i=this.performanceClient)!=null&&i.setPreQueueTime(nt.RegionDiscoveryGetRegionFromIMDS,this.correlationId),[4,this.getRegionFromIMDS(l,a)]):(t.region_source=Mh.FAILED_AUTO_DETECTION,[2,null]);case 4:(h=p.sent()).status===um.httpSuccess&&(o=h.body,t.region_source=Mh.IMDS),p.label=5;case 5:return[3,7];case 6:return p.sent(),t.region_source=Mh.FAILED_AUTO_DETECTION,[2,null];case 7:return[3,9];case 8:t.region_source=Mh.ENVIRONMENT_VARIABLE,p.label=9;case 9:return o||(t.region_source=Mh.FAILED_AUTO_DETECTION),[2,o||null]}})})},n.prototype.getRegionFromIMDS=function(e,t){var r;return Vn(this,void 0,void 0,function(){return Hn(this,function(i){return(r=this.performanceClient)!=null&&r.addQueueMeasurement(nt.RegionDiscoveryGetRegionFromIMDS,this.correlationId),[2,this.networkInterface.sendGetRequestAsync(Ne.IMDS_ENDPOINT+"?api-version="+e+"&format=text",t,Ne.IMDS_TIMEOUT)]})})},n.prototype.getCurrentVersion=function(e){var t;return Vn(this,void 0,void 0,function(){var r;return Hn(this,function(i){switch(i.label){case 0:(t=this.performanceClient)!=null&&t.addQueueMeasurement(nt.RegionDiscoveryGetCurrentVersion,this.correlationId),i.label=1;case 1:return i.trys.push([1,3,,4]),[4,this.networkInterface.sendGetRequestAsync(Ne.IMDS_ENDPOINT+"?format=json",e)];case 2:return(r=i.sent()).status===um.httpBadRequest&&r.body&&r.body["newest-versions"]&&0<r.body["newest-versions"].length?[2,r.body["newest-versions"][0]]:[2,null];case 3:return i.sent(),[2,null];case 4:return[2]}})})},n.IMDS_OPTIONS={headers:{Metadata:"true"}},n}(),K0=function(){function n(e,t,r,i,o,a,l){this.canonicalAuthority=e,this._canonicalAuthority.validateAsUri(),this.networkInterface=t,this.cacheManager=r,this.authorityOptions=i,this.regionDiscoveryMetadata={region_used:void 0,region_source:void 0,region_outcome:void 0},this.logger=o,this.performanceClient=a,this.correlationId=l,this.regionDiscovery=new bEe(t,this.performanceClient,this.correlationId)}return n.prototype.getAuthorityType=function(e){if(e.HostNameAndPort.endsWith(Ne.CIAM_AUTH_URL))return Pa.Ciam;if(e=e.PathSegments,e.length)switch(e[0].toLowerCase()){case Ne.ADFS:return Pa.Adfs;case Ne.DSTS:return Pa.Dsts}return Pa.Default},Object.defineProperty(n.prototype,"authorityType",{get:function(){return this.getAuthorityType(this.canonicalAuthorityUrlComponents)},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"protocolMode",{get:function(){return this.authorityOptions.protocolMode},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"options",{get:function(){return this.authorityOptions},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"canonicalAuthority",{get:function(){return this._canonicalAuthority.urlString},set:function(e){this._canonicalAuthority=new xr(e),this._canonicalAuthority.validateAsUri(),this._canonicalAuthorityUrlComponents=null},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"canonicalAuthorityUrlComponents",{get:function(){return this._canonicalAuthorityUrlComponents||(this._canonicalAuthorityUrlComponents=this._canonicalAuthority.getUrlComponents()),this._canonicalAuthorityUrlComponents},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"hostnameAndPort",{get:function(){return this.canonicalAuthorityUrlComponents.HostNameAndPort.toLowerCase()},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"tenant",{get:function(){return this.canonicalAuthorityUrlComponents.PathSegments[0]},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"authorizationEndpoint",{get:function(){if(this.discoveryComplete())return this.replacePath(this.metadata.authorization_endpoint);throw tn.createEndpointDiscoveryIncompleteError("Discovery incomplete.")},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"tokenEndpoint",{get:function(){if(this.discoveryComplete())return this.replacePath(this.metadata.token_endpoint);throw tn.createEndpointDiscoveryIncompleteError("Discovery incomplete.")},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"deviceCodeEndpoint",{get:function(){if(this.discoveryComplete())return this.replacePath(this.metadata.token_endpoint.replace("/token","/devicecode"));throw tn.createEndpointDiscoveryIncompleteError("Discovery incomplete.")},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"endSessionEndpoint",{get:function(){if(this.discoveryComplete()){if(this.metadata.end_session_endpoint)return this.replacePath(this.metadata.end_session_endpoint);throw tn.createLogoutNotSupportedError()}throw tn.createEndpointDiscoveryIncompleteError("Discovery incomplete.")},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"selfSignedJwtAudience",{get:function(){if(this.discoveryComplete())return this.replacePath(this.metadata.issuer);throw tn.createEndpointDiscoveryIncompleteError("Discovery incomplete.")},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"jwksUri",{get:function(){if(this.discoveryComplete())return this.replacePath(this.metadata.jwks_uri);throw tn.createEndpointDiscoveryIncompleteError("Discovery incomplete.")},enumerable:!1,configurable:!0}),n.prototype.canReplaceTenant=function(e){return e.PathSegments.length===1&&!n.reservedTenantDomains.has(e.PathSegments[0])&&this.getAuthorityType(e)===Pa.Default&&this.protocolMode===Y0.AAD},n.prototype.replaceTenant=function(e){return e.replace(/{tenant}|{tenantid}/g,this.tenant)},n.prototype.replacePath=function(e){var t=this,r=e,i=new xr(this.metadata.canonical_authority).getUrlComponents(),o=i.PathSegments;return this.canonicalAuthorityUrlComponents.PathSegments.forEach(function(a,l){var h=o[l];l===0&&t.canReplaceTenant(i)&&h!==(l=new xr(t.metadata.authorization_endpoint).getUrlComponents().PathSegments[0])&&(t.logger.verbose("Replacing tenant domain name "+h+" with id "+l),h=l),a!==h&&(r=r.replace("/"+h+"/","/"+a+"/"))}),this.replaceTenant(r)},Object.defineProperty(n.prototype,"defaultOpenIdConfigurationEndpoint",{get:function(){return this.authorityType===Pa.Adfs||this.authorityType===Pa.Dsts||this.protocolMode===Y0.OIDC?this.canonicalAuthority+".well-known/openid-configuration":this.canonicalAuthority+"v2.0/.well-known/openid-configuration"},enumerable:!1,configurable:!0}),n.prototype.discoveryComplete=function(){return!!this.metadata},n.prototype.resolveEndpointsAsync=function(){var e;return Vn(this,void 0,void 0,function(){var t,r,i;return Hn(this,function(o){switch(o.label){case 0:return(e=this.performanceClient)!=null&&e.addQueueMeasurement(nt.AuthorityResolveEndpointsAsync,this.correlationId),(t=this.cacheManager.getAuthorityMetadataByAlias(this.hostnameAndPort))||(t=new FP).updateCanonicalAuthority(this.canonicalAuthority),(e=this.performanceClient)!=null&&e.setPreQueueTime(nt.AuthorityUpdateCloudDiscoveryMetadata,this.correlationId),[4,this.updateCloudDiscoveryMetadata(t)];case 1:return r=o.sent(),this.canonicalAuthority=this.canonicalAuthority.replace(this.hostnameAndPort,t.preferred_network),(e=this.performanceClient)!=null&&e.setPreQueueTime(nt.AuthorityUpdateEndpointMetadata,this.correlationId),[4,this.updateEndpointMetadata(t)];case 2:return i=o.sent(),r!==Xs.CACHE&&i!==Xs.CACHE&&(t.resetExpiresAt(),t.updateCanonicalAuthority(this.canonicalAuthority)),i=this.cacheManager.generateAuthorityMetadataCacheKey(t.preferred_cache),this.cacheManager.setAuthorityMetadata(i,t),this.metadata=t,[2]}})})},n.prototype.updateEndpointMetadata=function(e){var t,r,i;return Vn(this,void 0,void 0,function(){var o,a;return Hn(this,function(l){switch(l.label){case 0:return(t=this.performanceClient)!=null&&t.addQueueMeasurement(nt.AuthorityUpdateEndpointMetadata,this.correlationId),(o=this.getEndpointMetadataFromConfig())?(e.updateEndpointMetadata(o,!1),[2,Xs.CONFIG]):this.isAuthoritySameType(e)&&e.endpointsFromNetwork&&!e.isExpired()?[2,Xs.CACHE]:((t=this.performanceClient)!=null&&t.setPreQueueTime(nt.AuthorityGetEndpointMetadataFromNetwork,this.correlationId),[4,this.getEndpointMetadataFromNetwork()]);case 1:return(o=l.sent())?(t=this.authorityOptions.azureRegionConfiguration)!=null&&t.azureRegion?((r=this.performanceClient)!=null&&r.setPreQueueTime(nt.AuthorityUpdateMetadataWithRegionalInformation,this.correlationId),[4,this.updateMetadataWithRegionalInformation(o)]):[3,3]:[3,4];case 2:o=l.sent(),l.label=3;case 3:return e.updateEndpointMetadata(o,!0),[2,Xs.NETWORK];case 4:return!(a=this.getEndpointMetadataFromHardcodedValues())||this.authorityOptions.skipAuthorityMetadataCache?[3,7]:(r=this.authorityOptions.azureRegionConfiguration)!=null&&r.azureRegion?((i=this.performanceClient)!=null&&i.setPreQueueTime(nt.AuthorityUpdateMetadataWithRegionalInformation,this.correlationId),[4,this.updateMetadataWithRegionalInformation(a)]):[3,6];case 5:a=l.sent(),l.label=6;case 6:return e.updateEndpointMetadata(a,!1),[2,Xs.HARDCODED_VALUES];case 7:throw tn.createUnableToGetOpenidConfigError(this.defaultOpenIdConfigurationEndpoint)}})})},n.prototype.isAuthoritySameType=function(e){return new xr(e.canonical_authority).getUrlComponents().PathSegments.length===this.canonicalAuthorityUrlComponents.PathSegments.length},n.prototype.getEndpointMetadataFromConfig=function(){if(this.authorityOptions.authorityMetadata)try{return JSON.parse(this.authorityOptions.authorityMetadata)}catch{throw vi.createInvalidAuthorityMetadataError()}return null},n.prototype.getEndpointMetadataFromNetwork=function(){var e;return Vn(this,void 0,void 0,function(){var t,r;return Hn(this,function(i){switch(i.label){case 0:(e=this.performanceClient)!=null&&e.addQueueMeasurement(nt.AuthorityGetEndpointMetadataFromNetwork,this.correlationId),t={},i.label=1;case 1:return i.trys.push([1,3,,4]),[4,this.networkInterface.sendGetRequestAsync(this.defaultOpenIdConfigurationEndpoint,t)];case 2:return[2,yEe((r=i.sent()).body)?r.body:null];case 3:return i.sent(),[2,null];case 4:return[2]}})})},n.prototype.getEndpointMetadataFromHardcodedValues=function(){return this.canonicalAuthority in $F?$F[this.canonicalAuthority]:null},n.prototype.updateMetadataWithRegionalInformation=function(e){var t;return Vn(this,void 0,void 0,function(){var r;return Hn(this,function(i){switch(i.label){case 0:return(t=this.performanceClient)!=null&&t.addQueueMeasurement(nt.AuthorityUpdateMetadataWithRegionalInformation,this.correlationId),(r=(t=this.authorityOptions.azureRegionConfiguration)==null?void 0:t.azureRegion)?r!==Ne.AZURE_REGION_AUTO_DISCOVER_FLAG?(this.regionDiscoveryMetadata.region_outcome=a0.CONFIGURED_NO_AUTO_DETECTION,this.regionDiscoveryMetadata.region_used=r,[2,n.replaceWithRegionalInformation(e,r)]):((t=this.performanceClient)!=null&&t.setPreQueueTime(nt.RegionDiscoveryDetectRegion,this.correlationId),[4,this.regionDiscovery.detectRegion((t=this.authorityOptions.azureRegionConfiguration)==null?void 0:t.environmentRegion,this.regionDiscoveryMetadata)]):[3,2];case 1:if(r=i.sent())return this.regionDiscoveryMetadata.region_outcome=a0.AUTO_DETECTION_REQUESTED_SUCCESSFUL,this.regionDiscoveryMetadata.region_used=r,[2,n.replaceWithRegionalInformation(e,r)];this.regionDiscoveryMetadata.region_outcome=a0.AUTO_DETECTION_REQUESTED_FAILED,i.label=2;case 2:return[2,e]}})})},n.prototype.updateCloudDiscoveryMetadata=function(e){var t;return Vn(this,void 0,void 0,function(){var r,i;return Hn(this,function(o){switch(o.label){case 0:return(t=this.performanceClient)!=null&&t.addQueueMeasurement(nt.AuthorityUpdateCloudDiscoveryMetadata,this.correlationId),this.logger.verbose("Attempting to get cloud discovery metadata in the config"),this.logger.verbosePii("Known Authorities: "+(this.authorityOptions.knownAuthorities||Ne.NOT_APPLICABLE)),this.logger.verbosePii("Authority Metadata: "+(this.authorityOptions.authorityMetadata||Ne.NOT_APPLICABLE)),this.logger.verbosePii("Canonical Authority: "+(e.canonical_authority||Ne.NOT_APPLICABLE)),(r=this.getCloudDiscoveryMetadataFromConfig())?(this.logger.verbose("Found cloud discovery metadata in the config."),e.updateCloudDiscoveryMetadata(r,!1),[2,Xs.CONFIG]):(this.logger.verbose("Did not find cloud discovery metadata in the config... Attempting to get cloud discovery metadata from the cache."),i=e.isExpired(),this.isAuthoritySameType(e)&&e.aliasesFromNetwork&&!i?(this.logger.verbose("Found metadata in the cache."),[2,Xs.CACHE]):(i&&this.logger.verbose("The metadata entity is expired."),this.logger.verbose("Did not find cloud discovery metadata in the cache... Attempting to get cloud discovery metadata from the network."),(t=this.performanceClient)!=null&&t.setPreQueueTime(nt.AuthorityGetCloudDiscoveryMetadataFromNetwork,this.correlationId),[4,this.getCloudDiscoveryMetadataFromNetwork()]));case 1:if(r=o.sent())return this.logger.verbose("cloud discovery metadata was successfully returned from getCloudDiscoveryMetadataFromNetwork()"),e.updateCloudDiscoveryMetadata(r,!0),[2,Xs.NETWORK];if(this.logger.verbose("Did not find cloud discovery metadata from the network... Attempting to get cloud discovery metadata from hardcoded values."),(i=this.getCloudDiscoveryMetadataFromHarcodedValues())&&!this.options.skipAuthorityMetadataCache)return this.logger.verbose("Found cloud discovery metadata from hardcoded values."),e.updateCloudDiscoveryMetadata(i,!1),[2,Xs.HARDCODED_VALUES];throw this.logger.error("Did not find cloud discovery metadata from hardcoded values... Metadata could not be obtained from config, cache, network or hardcoded values. Throwing Untrusted Authority Error."),vi.createUntrustedAuthorityError()}})})},n.prototype.getCloudDiscoveryMetadataFromConfig=function(){if(this.authorityType===Pa.Ciam)return this.logger.verbose("CIAM authorities do not support cloud discovery metadata, generate the aliases from authority host."),n.createCloudDiscoveryMetadataFromHost(this.hostnameAndPort);if(this.authorityOptions.cloudDiscoveryMetadata){this.logger.verbose("The cloud discovery metadata has been provided as a network response, in the config.");try{this.logger.verbose("Attempting to parse the cloud discovery metadata.");var e=JSON.parse(this.authorityOptions.cloudDiscoveryMetadata),t=n.getCloudDiscoveryMetadataFromNetworkResponse(e.metadata,this.hostnameAndPort);if(this.logger.verbose("Parsed the cloud discovery metadata."),t)return this.logger.verbose("There is returnable metadata attached to the parsed cloud discovery metadata."),t;this.logger.verbose("There is no metadata attached to the parsed cloud discovery metadata.")}catch{throw this.logger.verbose("Unable to parse the cloud discovery metadata. Throwing Invalid Cloud Discovery Metadata Error."),vi.createInvalidCloudDiscoveryMetadataError()}}return this.isInKnownAuthorities()?(this.logger.verbose("The host is included in knownAuthorities. Creating new cloud discovery metadata from the host."),n.createCloudDiscoveryMetadataFromHost(this.hostnameAndPort)):null},n.prototype.getCloudDiscoveryMetadataFromNetwork=function(){var e;return Vn(this,void 0,void 0,function(){var t,r,i,o,a,l;return Hn(this,function(h){switch(h.label){case 0:(e=this.performanceClient)!=null&&e.addQueueMeasurement(nt.AuthorityGetCloudDiscoveryMetadataFromNetwork,this.correlationId),t=""+Ne.AAD_INSTANCE_DISCOVERY_ENDPT+this.canonicalAuthority+"oauth2/v2.0/authorize",r={},i=null,h.label=1;case 1:return h.trys.push([1,3,,4]),[4,this.networkInterface.sendGetRequestAsync(t,r)];case 2:if(l=h.sent(),a=o=void 0,_Ee(l.body))o=l.body,a=o.metadata,this.logger.verbosePii("tenant_discovery_endpoint is: "+o.tenant_discovery_endpoint);else{if(!vEe(l.body))return this.logger.error("AAD did not return a CloudInstanceDiscoveryResponse or CloudInstanceDiscoveryErrorResponse"),[2,null];if(this.logger.warning("A CloudInstanceDiscoveryErrorResponse was returned. The cloud instance discovery network request's status code is: "+l.status),(o=l.body).error===Ne.INVALID_INSTANCE)return this.logger.error("The CloudInstanceDiscoveryErrorResponse error is invalid_instance."),[2,null];this.logger.warning("The CloudInstanceDiscoveryErrorResponse error is "+o.error),this.logger.warning("The CloudInstanceDiscoveryErrorResponse error description is "+o.error_description),this.logger.warning("Setting the value of the CloudInstanceDiscoveryMetadata (returned from the network) to []"),a=[]}return this.logger.verbose("Attempting to find a match between the developer's authority and the CloudInstanceDiscoveryMetadata returned from the network request."),i=n.getCloudDiscoveryMetadataFromNetworkResponse(a,this.hostnameAndPort),[3,4];case 3:return(l=h.sent())instanceof xn?this.logger.error(`There was a network error while attempting to get the cloud discovery instance metadata.
Error: `+l.errorCode+`
Error Description: `+l.errorMessage):this.logger.error(`A non-MSALJS error was thrown while attempting to get the cloud instance discovery metadata.
Error: `+l.name+`
Error Description: `+l.message),[2,null];case 4:return i||(this.logger.warning("The developer's authority was not found within the CloudInstanceDiscoveryMetadata returned from the network request."),this.logger.verbose("Creating custom Authority for custom domain scenario."),i=n.createCloudDiscoveryMetadataFromHost(this.hostnameAndPort)),[2,i]}})})},n.prototype.getCloudDiscoveryMetadataFromHarcodedValues=function(){return this.canonicalAuthority in WF?WF[this.canonicalAuthority]:null},n.prototype.isInKnownAuthorities=function(){var e=this;return 0<this.authorityOptions.knownAuthorities.filter(function(t){return xr.getDomainFromUrl(t).toLowerCase()===e.hostnameAndPort}).length},n.generateAuthority=function(e,t){var r;return t&&t.azureCloudInstance!==W0.None&&(r=t.tenant||Ne.DEFAULT_COMMON_TENANT,r=t.azureCloudInstance+"/"+r+"/"),r||e},n.createCloudDiscoveryMetadataFromHost=function(e){return{preferred_network:e,preferred_cache:e,aliases:[e]}},n.getCloudDiscoveryMetadataFromNetworkResponse=function(e,t){for(var r=0;r<e.length;r++){var i=e[r];if(-1<i.aliases.indexOf(t))return i}return null},n.prototype.getPreferredCache=function(){if(this.discoveryComplete())return this.metadata.preferred_cache;throw tn.createEndpointDiscoveryIncompleteError("Discovery incomplete.")},n.prototype.isAlias=function(e){return-1<this.metadata.aliases.indexOf(e)},n.isPublicCloudAuthority=function(e){return 0<=Ne.KNOWN_PUBLIC_CLOUDS.indexOf(e)},n.buildRegionalAuthorityString=function(i,t,r){var i=new xr(i),a=(i.validateAsUri(),i.getUrlComponents()),o=t+"."+a.HostNameAndPort,a=(this.isPublicCloudAuthority(a.HostNameAndPort)&&(o=t+"."+Ne.REGIONAL_AUTH_PUBLIC_CLOUD_SUFFIX),xr.constructAuthorityUriFromObject(Yr(Yr({},i.getUrlComponents()),{HostNameAndPort:o})).urlString);return r?a+"?"+r:a},n.replaceWithRegionalInformation=function(e,t){return e.authorization_endpoint=n.buildRegionalAuthorityString(e.authorization_endpoint,t),e.token_endpoint=n.buildRegionalAuthorityString(e.token_endpoint,t,Ne.REGIONAL_AUTH_NON_MSI_QUERY_STRING),e.end_session_endpoint&&(e.end_session_endpoint=n.buildRegionalAuthorityString(e.end_session_endpoint,t)),e},n.transformCIAMAuthority=function(r){var t=r.endsWith(Ne.FORWARD_SLASH)?r:""+r+Ne.FORWARD_SLASH,r=new xr(r).getUrlComponents();return t=r.PathSegments.length===0&&r.HostNameAndPort.endsWith(Ne.CIAM_AUTH_URL)?""+t+r.HostNameAndPort.split(".")[0]+Ne.AAD_TENANT_DOMAIN_SUFFIX:t},n.reservedTenantDomains=new Set(["{tenant}","{tenantid}",Bf.COMMON,Bf.CONSUMERS,Bf.ORGANIZATIONS]),n}(),qE=function(){function n(){}return n.createDiscoveredInstance=function(e,t,r,i,o,a,l){return Vn(this,void 0,void 0,function(){var h,p;return Hn(this,function(g){switch(g.label){case 0:a!=null&&a.addQueueMeasurement(nt.AuthorityFactoryCreateDiscoveredInstance,l),h=K0.transformCIAMAuthority(e),h=n.createInstance(h,t,r,i,o,a,l),g.label=1;case 1:return g.trys.push([1,3,,4]),a!=null&&a.setPreQueueTime(nt.AuthorityResolveEndpointsAsync,l),[4,h.resolveEndpointsAsync()];case 2:return g.sent(),[2,h];case 3:throw p=g.sent(),tn.createEndpointDiscoveryIncompleteError(p);case 4:return[2]}})})},n.createInstance=function(e,t,r,i,o,a,l){if(Zt.isEmpty(e))throw vi.createUrlEmptyError();return new K0(e,t,r,i,o,a,l)},n}(),$E=function(){function n(){this.failedRequests=[],this.errors=[],this.cacheHits=0}return n.isServerTelemetryEntity=function(r,t){var r=r.indexOf(Wo.CACHE_KEY)===0,i=!0;return t&&(i=t.hasOwnProperty("failedRequests")&&t.hasOwnProperty("errors")&&t.hasOwnProperty("cacheHits")),r&&i},n}(),ZF=function(){function n(){}return n.isThrottlingEntity=function(i,t){var r=!1,i=(i&&(r=i.indexOf(l0.THROTTLING_PREFIX)===0),!0);return t&&(i=t.hasOwnProperty("throttleTime")),r&&i},n}(),wEe={sendGetRequestAsync:function(){return Promise.reject(xn.createUnexpectedError("Network interface - sendGetRequestAsync() has not been implemented for the Network interface."))},sendPostRequestAsync:function(){return Promise.reject(xn.createUnexpectedError("Network interface - sendPostRequestAsync() has not been implemented for the Network interface."))}},Ew={missingKidError:{code:"missing_kid_error",desc:"The JOSE Header for the requested JWT, JWS or JWK object requires a keyId to be configured as the 'kid' header claim. No 'kid' value was provided."},missingAlgError:{code:"missing_alg_error",desc:"The JOSE Header for the requested JWT, JWS or JWK object requires an algorithm to be specified as the 'alg' header claim. No 'alg' value was provided."}},XF=function(n){function e(t,r){return t=n.call(this,t,r)||this,t.name="JoseHeaderError",Object.setPrototypeOf(t,e.prototype),t}return us(e,n),e.createMissingKidError=function(){return new e(Ew.missingKidError.code,Ew.missingKidError.desc)},e.createMissingAlgError=function(){return new e(Ew.missingAlgError.code,Ew.missingAlgError.desc)},e}(xn),xEe=function(){function n(e){this.typ=e.typ,this.alg=e.alg,this.kid=e.kid}return n.getShrHeaderString=function(e){if(!e.kid)throw XF.createMissingKidError();if(e.alg)return e=new n({typ:e.typ||LP.Pop,kid:e.kid,alg:e.alg}),JSON.stringify(e);throw XF.createMissingAlgError()},n}(),EEe=function(){function n(e,t){this.cacheOutcome=Bh.NO_CACHE_HIT,this.cacheManager=t,this.apiId=e.apiId,this.correlationId=e.correlationId,this.wrapperSKU=e.wrapperSKU||Ne.EMPTY_STRING,this.wrapperVer=e.wrapperVer||Ne.EMPTY_STRING,this.telemetryCacheKey=Wo.CACHE_KEY+So.CACHE_KEY_SEPARATOR+e.clientId}return n.prototype.generateCurrentRequestHeaderValue=function(){var t=""+this.apiId+Wo.VALUE_SEPARATOR+this.cacheOutcome,e=[this.wrapperSKU,this.wrapperVer].join(Wo.VALUE_SEPARATOR),t=[t,this.getRegionDiscoveryFields()].join(Wo.VALUE_SEPARATOR);return[Wo.SCHEMA_VERSION,t,e].join(Wo.CATEGORY_SEPARATOR)},n.prototype.generateLastRequestHeaderValue=function(){var e=this.getLastRequests(),o=n.maxErrorsToSend(e),t=e.failedRequests.slice(0,2*o).join(Wo.VALUE_SEPARATOR),r=e.errors.slice(0,o).join(Wo.VALUE_SEPARATOR),i=e.errors.length,o=[i,o<i?Wo.OVERFLOW_TRUE:Wo.OVERFLOW_FALSE].join(Wo.VALUE_SEPARATOR);return[Wo.SCHEMA_VERSION,e.cacheHits,t,r,o].join(Wo.CATEGORY_SEPARATOR)},n.prototype.cacheFailedRequest=function(e){var t=this.getLastRequests();t.errors.length>=Wo.MAX_CACHED_ERRORS&&(t.failedRequests.shift(),t.failedRequests.shift(),t.errors.shift()),t.failedRequests.push(this.apiId,this.correlationId),Zt.isEmpty(e.subError)?Zt.isEmpty(e.errorCode)?e&&e.toString()?t.errors.push(e.toString()):t.errors.push(Wo.UNKNOWN_ERROR):t.errors.push(e.errorCode):t.errors.push(e.subError),this.cacheManager.setServerTelemetry(this.telemetryCacheKey,t)},n.prototype.incrementCacheHits=function(){var e=this.getLastRequests();return e.cacheHits+=1,this.cacheManager.setServerTelemetry(this.telemetryCacheKey,e),e.cacheHits},n.prototype.getLastRequests=function(){var e=new $E;return this.cacheManager.getServerTelemetry(this.telemetryCacheKey)||e},n.prototype.clearTelemetryCache=function(){var e,t=this.getLastRequests(),r=n.maxErrorsToSend(t);r===t.errors.length?this.cacheManager.removeItem(this.telemetryCacheKey):((e=new $E).failedRequests=t.failedRequests.slice(2*r),e.errors=t.errors.slice(r),this.cacheManager.setServerTelemetry(this.telemetryCacheKey,e))},n.maxErrorsToSend=function(e){for(var t=0,r=0,i=e.errors.length,o=0;o<i;o++){var a=e.failedRequests[2*o]||Ne.EMPTY_STRING,l=e.failedRequests[2*o+1]||Ne.EMPTY_STRING,h=e.errors[o]||Ne.EMPTY_STRING;if(!((r+=a.toString().length+l.toString().length+h.length+3)<Wo.MAX_LAST_HEADER_BYTES))break;t+=1}return t},n.prototype.getRegionDiscoveryFields=function(){var e=[];return e.push(this.regionUsed||Ne.EMPTY_STRING),e.push(this.regionSource||Ne.EMPTY_STRING),e.push(this.regionOutcome||Ne.EMPTY_STRING),e.join(",")},n.prototype.updateRegionDiscoveryMetadata=function(e){this.regionUsed=e.region_used,this.regionSource=e.region_source,this.regionOutcome=e.region_outcome},n.prototype.setCacheOutcome=function(e){this.cacheOutcome=e},n}(),NV=function(){function n(e,t,r,i,o,a){this.authority=t,this.libraryName=i,this.libraryVersion=o,this.applicationTelemetry=a,this.clientId=e,this.logger=r,this.callbacks=new Map,this.eventsByCorrelationId=new Map,this.queueMeasurements=new Map,this.preQueueTimeByCorrelationId=new Map}return n.prototype.startPerformanceMeasurement=function(e,t){return{}},n.prototype.startPerformanceMeasuremeant=function(e,t){return{}},n.prototype.getIntFields=function(){return pEe},n.prototype.getPreQueueTime=function(e,t){var r=this.preQueueTimeByCorrelationId.get(t);if(r){if(r.name===e)return r.time;this.logger.trace("PerformanceClient.getPreQueueTime: no pre-queue time found for "+e+", unable to add queue measurement")}else this.logger.trace("PerformanceClient.getPreQueueTime: no pre-queue times found for correlationId: "+t+", unable to add queue measurement")},n.prototype.calculateQueuedTime=function(e,t){return e<1?(this.logger.trace("PerformanceClient: preQueueTime should be a positive integer and not "+e),0):t<1?(this.logger.trace("PerformanceClient: currentTime should be a positive integer and not "+t),0):t<e?(this.logger.trace("PerformanceClient: currentTime is less than preQueueTime, check how time is being retrieved"),0):t-e},n.prototype.addQueueMeasurement=function(e,t,r,i){if(t){if(r===0)this.logger.trace("PerformanceClient.addQueueMeasurement: queue time provided for "+e+" is "+r);else if(!r)return void this.logger.trace("PerformanceClient.addQueueMeasurement: no queue time provided for "+e);r={eventName:e,queueTime:r,manuallyCompleted:i},i=this.queueMeasurements.get(t),i?(i.push(r),this.queueMeasurements.set(t,i)):(this.logger.trace("PerformanceClient.addQueueMeasurement: adding correlationId "+t+" to queue measurements"),this.queueMeasurements.set(t,[r])),this.preQueueTimeByCorrelationId.delete(t)}else this.logger.trace("PerformanceClient.addQueueMeasurement: correlationId not provided for "+e+", cannot add queue measurement")},n.prototype.startMeasurement=function(e,t){var r=this,i=t||this.generateId(),o=(t||this.logger.info("PerformanceClient: No correlation id provided for "+e+", generating",i),this.logger.trace("PerformanceClient: Performance measurement started for "+e,i),this.startPerformanceMeasuremeant(e,i)),a=(o.startMeasurement(),{eventId:this.generateId(),status:jE.InProgress,authority:this.authority,libraryName:this.libraryName,libraryVersion:this.libraryVersion,clientId:this.clientId,name:e,startTimeMs:Date.now(),correlationId:i,appName:(t=this.applicationTelemetry)==null?void 0:t.appName,appVersion:(e=this.applicationTelemetry)==null?void 0:e.appVersion});return this.cacheEventByCorrelationId(a),{endMeasurement:function(l){return r.endMeasurement(Yr(Yr({},a),l),o)},discardMeasurement:function(){return r.discardMeasurements(a.correlationId)},addStaticFields:function(l){return r.addStaticFields(l,a.correlationId)},increment:function(l){return r.increment(l,a.correlationId)},measurement:o,event:a}},n.prototype.endMeasurement=function(e,t){var r,i,o,a,l,h=this,p=this.eventsByCorrelationId.get(e.correlationId);return p?(i={totalQueueTime:0,totalQueueCount:0,manuallyCompletedCount:0},(r=e.eventId===p.eventId)?(i=this.getQueueInfo(e.correlationId),this.discardCache(p.correlationId)):(o=p.incompleteSubMeasurements)!=null&&o.delete(e.eventId),t!=null&&t.endMeasurement(),(o=t==null?void 0:t.flushMeasurement())?(this.logger.trace("PerformanceClient: Performance measurement ended for "+e.name+": "+o+" ms",e.correlationId),r?(a=Yr(Yr({},p),e),l=0,(t=a.incompleteSubMeasurements)!=null&&t.forEach(function(g){h.logger.trace("PerformanceClient: Incomplete submeasurement "+g.name+" found for "+e.name,a.correlationId),l++}),a.incompleteSubMeasurements=void 0,a=Yr(Yr({},a),{durationMs:Math.round(o),queuedTimeMs:i.totalQueueTime,queuedCount:i.totalQueueCount,queuedManuallyCompletedCount:i.manuallyCompletedCount,status:jE.Completed,incompleteSubsCount:l}),this.truncateIntegralFields(a,this.getIntFields()),this.emitEvents([a],e.correlationId),a):(p[e.name+"DurationMs"]=Math.floor(o),Yr({},p))):(this.logger.trace("PerformanceClient: Performance measurement not taken",p.correlationId),null)):(this.logger.trace("PerformanceClient: Measurement not found for "+e.eventId,e.correlationId),null)},n.prototype.addStaticFields=function(e,t){this.logger.trace("PerformanceClient: Updating static fields");var r=this.eventsByCorrelationId.get(t);r?this.eventsByCorrelationId.set(t,Yr(Yr({},r),e)):this.logger.trace("PerformanceClient: Event not found for",t)},n.prototype.increment=function(e,t){this.logger.trace("PerformanceClient: Updating counters");var r=this.eventsByCorrelationId.get(t);if(r)for(var i in e)r.hasOwnProperty(i)||(r[i]=0),r[i]+=e[i];else this.logger.trace("PerformanceClient: Event not found for",t)},n.prototype.cacheEventByCorrelationId=function(e){var t=this.eventsByCorrelationId.get(e.correlationId);t?(this.logger.trace("PerformanceClient: Performance measurement for "+e.name+" added/updated",e.correlationId),t.incompleteSubMeasurements=t.incompleteSubMeasurements||new Map,t.incompleteSubMeasurements.set(e.eventId,{name:e.name,startTimeMs:e.startTimeMs})):(this.logger.trace("PerformanceClient: Performance measurement for "+e.name+" started",e.correlationId),this.eventsByCorrelationId.set(e.correlationId,Yr({},e)))},n.prototype.getQueueInfo=function(e){var t=this.queueMeasurements.get(e),r=(t||this.logger.trace("PerformanceClient: no queue measurements found for for correlationId: "+e),0),i=0,o=0;return t!=null&&t.forEach(function(a){r+=a.queueTime,i++,o+=a.manuallyCompleted?1:0}),{totalQueueTime:r,totalQueueCount:i,manuallyCompletedCount:o}},n.prototype.discardMeasurements=function(e){this.logger.trace("PerformanceClient: Performance measurements discarded",e),this.eventsByCorrelationId.delete(e)},n.prototype.discardCache=function(e){this.discardMeasurements(e),this.logger.trace("PerformanceClient: QueueMeasurements discarded",e),this.queueMeasurements.delete(e),this.logger.trace("PerformanceClient: Pre-queue times discarded",e),this.preQueueTimeByCorrelationId.delete(e)},n.prototype.addPerformanceCallback=function(e){var t=this.generateId();return this.callbacks.set(t,e),this.logger.verbose("PerformanceClient: Performance callback registered with id: "+t),t},n.prototype.removePerformanceCallback=function(e){var t=this.callbacks.delete(e);return t?this.logger.verbose("PerformanceClient: Performance callback "+e+" removed."):this.logger.verbose("PerformanceClient: Performance callback "+e+" not removed."),t},n.prototype.emitEvents=function(e,t){var r=this;this.logger.verbose("PerformanceClient: Emitting performance events",t),this.callbacks.forEach(function(i,o){r.logger.trace("PerformanceClient: Emitting event to callback "+o,t),i.apply(null,[e])})},n.prototype.truncateIntegralFields=function(e,t){t.forEach(function(r){r in e&&typeof e[r]=="number"&&(e[r]=Math.floor(e[r]))})},n}(),QF=function(){function n(){}return n.prototype.startMeasurement=function(){},n.prototype.endMeasurement=function(){},n.prototype.flushMeasurement=function(){return null},n}(),TEe=function(n){function e(){return n!==null&&n.apply(this,arguments)||this}return us(e,n),e.prototype.generateId=function(){return"callback-id"},e.prototype.startPerformanceMeasuremeant=function(){return new QF},e.prototype.startPerformanceMeasurement=function(){return new QF},e.prototype.calculateQueuedTime=function(t,r){return 0},e.prototype.addQueueMeasurement=function(t,r,i){},e.prototype.setPreQueueTime=function(t,r){},e}(NV),Pt={pkceNotGenerated:{code:"pkce_not_created",desc:"The PKCE code challenge and verifier could not be generated."},cryptoDoesNotExist:{code:"crypto_nonexistent",desc:"The crypto object or function is not available."},httpMethodNotImplementedError:{code:"http_method_not_implemented",desc:"The HTTP method given has not been implemented in this library."},emptyNavigateUriError:{code:"empty_navigate_uri",desc:"Navigation URI is empty. Please check stack trace for more info."},hashEmptyError:{code:"hash_empty_error",desc:"Hash value cannot be processed because it is empty. Please verify that your redirectUri is not clearing the hash. For more visit: aka.ms/msaljs/browser-errors."},hashDoesNotContainStateError:{code:"no_state_in_hash",desc:"Hash does not contain state. Please verify that the request originated from msal."},hashDoesNotContainKnownPropertiesError:{code:"hash_does_not_contain_known_properties",desc:"Hash does not contain known properites. Please verify that your redirectUri is not changing the hash. For more visit: aka.ms/msaljs/browser-errors."},unableToParseStateError:{code:"unable_to_parse_state",desc:"Unable to parse state. Please verify that the request originated from msal."},stateInteractionTypeMismatchError:{code:"state_interaction_type_mismatch",desc:"Hash contains state but the interaction type does not match the caller."},interactionInProgress:{code:"interaction_in_progress",desc:"Interaction is currently in progress. Please ensure that this interaction has been completed before calling an interactive API.  For more visit: aka.ms/msaljs/browser-errors."},popupWindowError:{code:"popup_window_error",desc:"Error opening popup window. This can happen if you are using IE or if popups are blocked in the browser."},emptyWindowError:{code:"empty_window_error",desc:"window.open returned null or undefined window object."},userCancelledError:{code:"user_cancelled",desc:"User cancelled the flow."},monitorPopupTimeoutError:{code:"monitor_window_timeout",desc:"Token acquisition in popup failed due to timeout. For more visit: aka.ms/msaljs/browser-errors."},monitorIframeTimeoutError:{code:"monitor_window_timeout",desc:"Token acquisition in iframe failed due to timeout. For more visit: aka.ms/msaljs/browser-errors."},redirectInIframeError:{code:"redirect_in_iframe",desc:"Redirects are not supported for iframed or brokered applications. Please ensure you are using MSAL.js in a top frame of the window if using the redirect APIs, or use the popup APIs."},blockTokenRequestsInHiddenIframeError:{code:"block_iframe_reload",desc:"Request was blocked inside an iframe because MSAL detected an authentication response. For more visit: aka.ms/msaljs/browser-errors"},blockAcquireTokenInPopupsError:{code:"block_nested_popups",desc:"Request was blocked inside a popup because MSAL detected it was running in a popup."},iframeClosedPrematurelyError:{code:"iframe_closed_prematurely",desc:"The iframe being monitored was closed prematurely."},silentLogoutUnsupportedError:{code:"silent_logout_unsupported",desc:"Silent logout not supported. Please call logoutRedirect or logoutPopup instead."},noAccountError:{code:"no_account_error",desc:"No account object provided to acquireTokenSilent and no active account has been set. Please call setActiveAccount or provide an account on the request."},silentPromptValueError:{code:"silent_prompt_value_error",desc:"The value given for the prompt value is not valid for silent requests - must be set to 'none' or 'no_session'."},noTokenRequestCacheError:{code:"no_token_request_cache_error",desc:"No token request found in cache."},unableToParseTokenRequestCacheError:{code:"unable_to_parse_token_request_cache_error",desc:"The cached token request could not be parsed."},noCachedAuthorityError:{code:"no_cached_authority_error",desc:"No cached authority found."},authRequestNotSet:{code:"auth_request_not_set_error",desc:"Auth Request not set. Please ensure initiateAuthRequest was called from the InteractionHandler"},invalidCacheType:{code:"invalid_cache_type",desc:"Invalid cache type"},notInBrowserEnvironment:{code:"non_browser_environment",desc:"Login and token requests are not supported in non-browser environments."},databaseNotOpen:{code:"database_not_open",desc:"Database is not open!"},noNetworkConnectivity:{code:"no_network_connectivity",desc:"No network connectivity. Check your internet connection."},postRequestFailed:{code:"post_request_failed",desc:"Network request failed: If the browser threw a CORS error, check that the redirectUri is registered in the Azure App Portal as type 'SPA'"},getRequestFailed:{code:"get_request_failed",desc:"Network request failed. Please check the network trace to determine root cause."},failedToParseNetworkResponse:{code:"failed_to_parse_response",desc:"Failed to parse network response. Check network trace."},unableToLoadTokenError:{code:"unable_to_load_token",desc:"Error loading token to cache."},signingKeyNotFoundInStorage:{code:"crypto_key_not_found",desc:"Cryptographic Key or Keypair not found in browser storage."},authCodeRequired:{code:"auth_code_required",desc:"An authorization code must be provided (as the `code` property on the request) to this flow."},authCodeOrNativeAccountRequired:{code:"auth_code_or_nativeAccountId_required",desc:"An authorization code or nativeAccountId must be provided to this flow."},spaCodeAndNativeAccountPresent:{code:"spa_code_and_nativeAccountId_present",desc:"Request cannot contain both spa code and native account id."},databaseUnavailable:{code:"database_unavailable",desc:"IndexedDB, which is required for persistent cryptographic key storage, is unavailable. This may be caused by browser privacy features which block persistent storage in third-party contexts."},unableToAcquireTokenFromNativePlatform:{code:"unable_to_acquire_token_from_native_platform",desc:"Unable to acquire token from native platform. For a list of possible reasons visit aka.ms/msaljs/browser-errors."},nativeHandshakeTimeout:{code:"native_handshake_timeout",desc:"Timed out while attempting to establish connection to browser extension"},nativeExtensionNotInstalled:{code:"native_extension_not_installed",desc:"Native extension is not installed. If you think this is a mistake call the initialize function."},nativeConnectionNotEstablished:{code:"native_connection_not_established",desc:"Connection to native platform has not been established. Please install a compatible browser extension and run initialize(). For more please visit aka.ms/msaljs/browser-errors."},nativeBrokerCalledBeforeInitialize:{code:"native_broker_called_before_initialize",desc:"You must call and await the initialize function before attempting to call any other MSAL API when native brokering is enabled. For more please visit aka.ms/msaljs/browser-errors."},nativePromptNotSupported:{code:"native_prompt_not_supported",desc:"The provided prompt is not supported by the native platform. This request should be routed to the web based flow."}},Ht=function(n){function e(t,r){return t=n.call(this,t,r)||this,Object.setPrototypeOf(t,e.prototype),t.name="BrowserAuthError",t}return ia(e,n),e.createPkceNotGeneratedError=function(t){return new e(Pt.pkceNotGenerated.code,Pt.pkceNotGenerated.desc+" Detail:"+t)},e.createCryptoNotAvailableError=function(t){return new e(Pt.cryptoDoesNotExist.code,Pt.cryptoDoesNotExist.desc+" Detail:"+t)},e.createHttpMethodNotImplementedError=function(t){return new e(Pt.httpMethodNotImplementedError.code,Pt.httpMethodNotImplementedError.desc+" Given Method: "+t)},e.createEmptyNavigationUriError=function(){return new e(Pt.emptyNavigateUriError.code,Pt.emptyNavigateUriError.desc)},e.createEmptyHashError=function(t){return new e(Pt.hashEmptyError.code,Pt.hashEmptyError.desc+" Given Url: "+t)},e.createHashDoesNotContainStateError=function(){return new e(Pt.hashDoesNotContainStateError.code,Pt.hashDoesNotContainStateError.desc)},e.createHashDoesNotContainKnownPropertiesError=function(){return new e(Pt.hashDoesNotContainKnownPropertiesError.code,Pt.hashDoesNotContainKnownPropertiesError.desc)},e.createUnableToParseStateError=function(){return new e(Pt.unableToParseStateError.code,Pt.unableToParseStateError.desc)},e.createStateInteractionTypeMismatchError=function(){return new e(Pt.stateInteractionTypeMismatchError.code,Pt.stateInteractionTypeMismatchError.desc)},e.createInteractionInProgressError=function(){return new e(Pt.interactionInProgress.code,Pt.interactionInProgress.desc)},e.createPopupWindowError=function(t){var r=Pt.popupWindowError.desc,r=Zt.isEmpty(t)?r:r+" Details: "+t;return new e(Pt.popupWindowError.code,r)},e.createEmptyWindowCreatedError=function(){return new e(Pt.emptyWindowError.code,Pt.emptyWindowError.desc)},e.createUserCancelledError=function(){return new e(Pt.userCancelledError.code,Pt.userCancelledError.desc)},e.createMonitorPopupTimeoutError=function(){return new e(Pt.monitorPopupTimeoutError.code,Pt.monitorPopupTimeoutError.desc)},e.createMonitorIframeTimeoutError=function(){return new e(Pt.monitorIframeTimeoutError.code,Pt.monitorIframeTimeoutError.desc)},e.createRedirectInIframeError=function(t){return new e(Pt.redirectInIframeError.code,Pt.redirectInIframeError.desc+" (window.parent !== window) => "+t)},e.createBlockReloadInHiddenIframeError=function(){return new e(Pt.blockTokenRequestsInHiddenIframeError.code,Pt.blockTokenRequestsInHiddenIframeError.desc)},e.createBlockAcquireTokenInPopupsError=function(){return new e(Pt.blockAcquireTokenInPopupsError.code,Pt.blockAcquireTokenInPopupsError.desc)},e.createIframeClosedPrematurelyError=function(){return new e(Pt.iframeClosedPrematurelyError.code,Pt.iframeClosedPrematurelyError.desc)},e.createSilentLogoutUnsupportedError=function(){return new e(Pt.silentLogoutUnsupportedError.code,Pt.silentLogoutUnsupportedError.desc)},e.createNoAccountError=function(){return new e(Pt.noAccountError.code,Pt.noAccountError.desc)},e.createSilentPromptValueError=function(t){return new e(Pt.silentPromptValueError.code,Pt.silentPromptValueError.desc+" Given value: "+t)},e.createUnableToParseTokenRequestCacheError=function(){return new e(Pt.unableToParseTokenRequestCacheError.code,Pt.unableToParseTokenRequestCacheError.desc)},e.createNoTokenRequestCacheError=function(){return new e(Pt.noTokenRequestCacheError.code,Pt.noTokenRequestCacheError.desc)},e.createAuthRequestNotSetError=function(){return new e(Pt.authRequestNotSet.code,Pt.authRequestNotSet.desc)},e.createNoCachedAuthorityError=function(){return new e(Pt.noCachedAuthorityError.code,Pt.noCachedAuthorityError.desc)},e.createInvalidCacheTypeError=function(){return new e(Pt.invalidCacheType.code,""+Pt.invalidCacheType.desc)},e.createNonBrowserEnvironmentError=function(){return new e(Pt.notInBrowserEnvironment.code,Pt.notInBrowserEnvironment.desc)},e.createDatabaseNotOpenError=function(){return new e(Pt.databaseNotOpen.code,Pt.databaseNotOpen.desc)},e.createNoNetworkConnectivityError=function(){return new e(Pt.noNetworkConnectivity.code,Pt.noNetworkConnectivity.desc)},e.createPostRequestFailedError=function(t,r){return new e(Pt.postRequestFailed.code,Pt.postRequestFailed.desc+" | Network client threw: "+t+" | Attempted to reach: "+r.split("?")[0])},e.createGetRequestFailedError=function(t,r){return new e(Pt.getRequestFailed.code,Pt.getRequestFailed.desc+" | Network client threw: "+t+" | Attempted to reach: "+r.split("?")[0])},e.createFailedToParseNetworkResponseError=function(t){return new e(Pt.failedToParseNetworkResponse.code,Pt.failedToParseNetworkResponse.desc+" | Attempted to reach: "+t.split("?")[0])},e.createUnableToLoadTokenError=function(t){return new e(Pt.unableToLoadTokenError.code,Pt.unableToLoadTokenError.desc+" | "+t)},e.createSigningKeyNotFoundInStorageError=function(t){return new e(Pt.signingKeyNotFoundInStorage.code,Pt.signingKeyNotFoundInStorage.desc+" | No match found for KeyId: "+t)},e.createAuthCodeRequiredError=function(){return new e(Pt.authCodeRequired.code,Pt.authCodeRequired.desc)},e.createAuthCodeOrNativeAccountIdRequiredError=function(){return new e(Pt.authCodeOrNativeAccountRequired.code,Pt.authCodeOrNativeAccountRequired.desc)},e.createSpaCodeAndNativeAccountIdPresentError=function(){return new e(Pt.spaCodeAndNativeAccountPresent.code,Pt.spaCodeAndNativeAccountPresent.desc)},e.createDatabaseUnavailableError=function(){return new e(Pt.databaseUnavailable.code,Pt.databaseUnavailable.desc)},e.createUnableToAcquireTokenFromNativePlatformError=function(){return new e(Pt.unableToAcquireTokenFromNativePlatform.code,Pt.unableToAcquireTokenFromNativePlatform.desc)},e.createNativeHandshakeTimeoutError=function(){return new e(Pt.nativeHandshakeTimeout.code,Pt.nativeHandshakeTimeout.desc)},e.createNativeExtensionNotInstalledError=function(){return new e(Pt.nativeExtensionNotInstalled.code,Pt.nativeExtensionNotInstalled.desc)},e.createNativeConnectionNotEstablishedError=function(){return new e(Pt.nativeConnectionNotEstablished.code,Pt.nativeConnectionNotEstablished.desc)},e.createNativeBrokerCalledBeforeInitialize=function(){return new e(Pt.nativeBrokerCalledBeforeInitialize.code,Pt.nativeBrokerCalledBeforeInitialize.desc)},e.createNativePromptParameterNotSupportedError=function(){return new e(Pt.nativePromptNotSupported.code,Pt.nativePromptNotSupported.desc)},e}(xn),Ec={INTERACTION_IN_PROGRESS_VALUE:"interaction_in_progress",INVALID_GRANT_ERROR:"invalid_grant",POPUP_WIDTH:483,POPUP_HEIGHT:600,POPUP_NAME_PREFIX:"msal",DEFAULT_POLL_INTERVAL_MS:30,MSAL_SKU:"msal.js.browser"},Dv={CHANNEL_ID:"53ee284d-920a-4b59-9d30-a60315b26836",PREFERRED_EXTENSION_ID:"ppnbnpeolgkicgegkbkbjmhlideopiji",MATS_TELEMETRY:"MATS"},JF=(function(n){n.HandshakeRequest="Handshake",n.HandshakeResponse="HandshakeResponse",n.GetToken="GetToken",n.Response="Response"}(lu=lu||{}),function(n){n.LocalStorage="localStorage",n.SessionStorage="sessionStorage",n.MemoryStorage="memoryStorage"}(po=po||{}),function(n){n.GET="GET",n.POST="POST"}(sl=sl||{}),function(n){n.AUTHORITY="authority",n.ACQUIRE_TOKEN_ACCOUNT="acquireToken.account",n.SESSION_STATE="session.state",n.REQUEST_STATE="request.state",n.NONCE_IDTOKEN="nonce.id_token",n.ORIGIN_URI="request.origin",n.RENEW_STATUS="token.renew.status",n.URL_HASH="urlHash",n.REQUEST_PARAMS="request.params",n.SCOPES="scopes",n.INTERACTION_STATUS_KEY="interaction.status",n.CCS_CREDENTIAL="ccs.credential",n.CORRELATION_ID="request.correlationId",n.NATIVE_REQUEST="request.native",n.REDIRECT_CONTEXT="request.redirect.context"}(kr=kr||{}),function(n){n.ACCOUNT_KEYS="msal.account.keys",n.TOKEN_KEYS="msal.token.keys"}(nl=nl||{}),function(n){n.WRAPPER_SKU="wrapper.sku",n.WRAPPER_VER="wrapper.version"}(pm=pm||{}),function(n){n[n.acquireTokenRedirect=861]="acquireTokenRedirect",n[n.acquireTokenPopup=862]="acquireTokenPopup",n[n.ssoSilent=863]="ssoSilent",n[n.acquireTokenSilent_authCode=864]="acquireTokenSilent_authCode",n[n.handleRedirectPromise=865]="handleRedirectPromise",n[n.acquireTokenByCode=866]="acquireTokenByCode",n[n.acquireTokenSilent_silentFlow=61]="acquireTokenSilent_silentFlow",n[n.logout=961]="logout",n[n.logoutPopup=962]="logoutPopup"}(_i=_i||{}),function(n){n.Redirect="redirect",n.Popup="popup",n.Silent="silent",n.None="none"}(gn=gn||{}),function(n){n.Startup="startup",n.Login="login",n.Logout="logout",n.AcquireToken="acquireToken",n.SsoSilent="ssoSilent",n.HandleRedirect="handleRedirect",n.None="none"}(YF=YF||{}),{scopes:Eb}),uy="jwk",BP=(function(n){n.React="@azure/msal-react",n.Angular="@azure/msal-angular"}(KF=KF||{}),"msal.db"),SEe=1,CEe=BP+".keys",Ya=(function(n){n[n.Default=0]="Default",n[n.AccessToken=1]="AccessToken",n[n.AccessTokenAndRefreshToken=2]="AccessTokenAndRefreshToken",n[n.RefreshToken=3]="RefreshToken",n[n.RefreshTokenAndNetwork=4]="RefreshTokenAndNetwork",n[n.Skip=5]="Skip"}(Ja=Ja||{}),{redirectUriNotSet:{code:"redirect_uri_empty",desc:"A redirect URI is required for all calls, and none has been set."},postLogoutUriNotSet:{code:"post_logout_uri_empty",desc:"A post logout redirect has not been set."},storageNotSupportedError:{code:"storage_not_supported",desc:"Given storage configuration option was not supported."},noRedirectCallbacksSet:{code:"no_redirect_callbacks",desc:"No redirect callbacks have been set. Please call setRedirectCallbacks() with the appropriate function arguments before continuing. More information is available here: https://github.com/AzureAD/microsoft-authentication-library-for-js/wiki/MSAL-basics."},invalidCallbackObject:{code:"invalid_callback_object",desc:"The object passed for the callback was invalid. More information is available here: https://github.com/AzureAD/microsoft-authentication-library-for-js/wiki/MSAL-basics."},stubPcaInstanceCalled:{code:"stubbed_public_client_application_called",desc:"Stub instance of Public Client Application was called. If using msal-react, please ensure context is not used without a provider. For more visit: aka.ms/msaljs/browser-errors"},inMemRedirectUnavailable:{code:"in_mem_redirect_unavailable",desc:"Redirect cannot be supported. In-memory storage was selected and storeAuthStateInCookie=false, which would cause the library to be unable to handle the incoming hash. If you would like to use the redirect API, please use session/localStorage or set storeAuthStateInCookie=true."},entropyNotProvided:{code:"entropy_not_provided",desc:"The available browser crypto interface requires entropy set via system.cryptoOptions.entropy configuration option."}}),WE=function(n){function e(t,r){return t=n.call(this,t,r)||this,t.name="BrowserConfigurationAuthError",Object.setPrototypeOf(t,e.prototype),t}return ia(e,n),e.createRedirectUriEmptyError=function(){return new e(Ya.redirectUriNotSet.code,Ya.redirectUriNotSet.desc)},e.createPostLogoutRedirectUriEmptyError=function(){return new e(Ya.postLogoutUriNotSet.code,Ya.postLogoutUriNotSet.desc)},e.createStorageNotSupportedError=function(t){return new e(Ya.storageNotSupportedError.code,Ya.storageNotSupportedError.desc+" Given Location: "+t)},e.createRedirectCallbacksNotSetError=function(){return new e(Ya.noRedirectCallbacksSet.code,Ya.noRedirectCallbacksSet.desc)},e.createStubPcaInstanceCalledError=function(){return new e(Ya.stubPcaInstanceCalled.code,Ya.stubPcaInstanceCalled.desc)},e.createInMemoryRedirectUnavailableError=function(){return new e(Ya.inMemRedirectUnavailable.code,Ya.inMemRedirectUnavailable.desc)},e.createEntropyNotProvided=function(){return new e(Ya.entropyNotProvided.code,Ya.entropyNotProvided.desc)},e}(xn),e5=function(){function n(e){this.validateWindowStorage(e),this.windowStorage=window[e]}return n.prototype.validateWindowStorage=function(e){if(e!==po.LocalStorage&&e!==po.SessionStorage||!window[e])throw WE.createStorageNotSupportedError(e)},n.prototype.getItem=function(e){return this.windowStorage.getItem(e)},n.prototype.setItem=function(e,t){this.windowStorage.setItem(e,t)},n.prototype.removeItem=function(e){this.windowStorage.removeItem(e)},n.prototype.getKeys=function(){return Object.keys(this.windowStorage)},n.prototype.containsKey=function(e){return this.windowStorage.hasOwnProperty(e)},n}(),UP=function(){function n(){this.cache=new Map}return n.prototype.getItem=function(e){return this.cache.get(e)||null},n.prototype.setItem=function(e,t){this.cache.set(e,t)},n.prototype.removeItem=function(e){this.cache.delete(e)},n.prototype.getKeys=function(){var e=[];return this.cache.forEach(function(t,r){e.push(r)}),e},n.prototype.containsKey=function(e){return this.cache.has(e)},n.prototype.clear=function(){this.cache.clear()},n}(),DV=function(){function n(){}return n.extractBrowserRequestState=function(e,t){if(Zt.isEmpty(t))return null;try{return yu.parseRequestState(e,t).libraryState.meta}catch(r){throw tn.createInvalidStateError(t,r)}},n.parseServerResponseFromHash=function(e){return e?(e=new xr(e),xr.getDeserializedHash(e.getHash())):{}},n}(),zP=function(n){function e(t,r,i,o){return t=n.call(this,t,i,o)||this,t.COOKIE_LIFE_MULTIPLIER=864e5,t.cacheConfig=r,t.logger=o,t.internalStorage=new UP,t.browserStorage=t.setupBrowserStorage(t.cacheConfig.cacheLocation),t.temporaryCacheStorage=t.setupTemporaryCacheStorage(t.cacheConfig.temporaryCacheLocation,t.cacheConfig.cacheLocation),r.cacheMigrationEnabled&&(t.migrateCacheEntries(),t.createKeyMaps()),t}return ia(e,n),e.prototype.setupBrowserStorage=function(t){switch(t){case po.LocalStorage:case po.SessionStorage:try{return new e5(t)}catch(r){this.logger.verbose(r);break}}return this.cacheConfig.cacheLocation=po.MemoryStorage,new UP},e.prototype.setupTemporaryCacheStorage=function(t,r){switch(r){case po.LocalStorage:case po.SessionStorage:try{return new e5(t||po.SessionStorage)}catch(i){return this.logger.verbose(i),this.internalStorage}case po.MemoryStorage:default:return this.internalStorage}},e.prototype.migrateCacheEntries=function(){var t=this,r=Ne.CACHE_PREFIX+"."+Eo.ID_TOKEN,i=Ne.CACHE_PREFIX+"."+Eo.CLIENT_INFO,o=Ne.CACHE_PREFIX+"."+Eo.ERROR,a=Ne.CACHE_PREFIX+"."+Eo.ERROR_DESC,l=[this.browserStorage.getItem(r),this.browserStorage.getItem(i),this.browserStorage.getItem(o),this.browserStorage.getItem(a)];[Eo.ID_TOKEN,Eo.CLIENT_INFO,Eo.ERROR,Eo.ERROR_DESC].forEach(function(h,p){return t.migrateCacheEntry(h,l[p])})},e.prototype.migrateCacheEntry=function(t,r){r&&this.setTemporaryCache(t,r,!0)},e.prototype.createKeyMaps=function(){var t=this,r=(this.logger.trace("BrowserCacheManager - createKeyMaps called."),this.getItem(nl.ACCOUNT_KEYS)),i=this.getItem(nl.TOKEN_KEYS+"."+this.clientId);r&&i?this.logger.verbose("BrowserCacheManager:createKeyMaps - account and token key maps already exist, skipping migration."):this.browserStorage.getKeys().forEach(function(o){var a;if(t.isCredentialKey(o)&&(a=t.getItem(o))){var l,h,p=t.validateAndParseJson(a);if(p&&p.hasOwnProperty("credentialType"))switch(p.credentialType){case In.ID_TOKEN:if(Ef.isIdTokenEntity(p))return t.logger.trace("BrowserCacheManager:createKeyMaps - idToken found, saving key to token key map"),t.logger.tracePii("BrowserCacheManager:createKeyMaps - idToken with key: "+o+" found, saving key to token key map"),h=Ka.toObject(new Ef,p),h=t.updateCredentialCacheKey(o,h),void t.addTokenKey(h,In.ID_TOKEN);t.logger.trace("BrowserCacheManager:createKeyMaps - key found matching idToken schema with value containing idToken credentialType field but value failed IdTokenEntity validation, skipping."),t.logger.tracePii("BrowserCacheManager:createKeyMaps - failed idToken validation on key: "+o);break;case In.ACCESS_TOKEN:case In.ACCESS_TOKEN_WITH_AUTH_SCHEME:if(Tf.isAccessTokenEntity(p))return t.logger.trace("BrowserCacheManager:createKeyMaps - accessToken found, saving key to token key map"),t.logger.tracePii("BrowserCacheManager:createKeyMaps - accessToken with key: "+o+" found, saving key to token key map"),l=Ka.toObject(new Tf,p),h=t.updateCredentialCacheKey(o,l),void t.addTokenKey(h,In.ACCESS_TOKEN);t.logger.trace("BrowserCacheManager:createKeyMaps - key found matching accessToken schema with value containing accessToken credentialType field but value failed AccessTokenEntity validation, skipping."),t.logger.tracePii("BrowserCacheManager:createKeyMaps - failed accessToken validation on key: "+o);break;case In.REFRESH_TOKEN:if(dm.isRefreshTokenEntity(p))return t.logger.trace("BrowserCacheManager:createKeyMaps - refreshToken found, saving key to token key map"),t.logger.tracePii("BrowserCacheManager:createKeyMaps - refreshToken with key: "+o+" found, saving key to token key map"),l=Ka.toObject(new dm,p),h=t.updateCredentialCacheKey(o,l),void t.addTokenKey(h,In.REFRESH_TOKEN);t.logger.trace("BrowserCacheManager:createKeyMaps - key found matching refreshToken schema with value containing refreshToken credentialType field but value failed RefreshTokenEntity validation, skipping."),t.logger.tracePii("BrowserCacheManager:createKeyMaps - failed refreshToken validation on key: "+o)}}t.isAccountKey(o)&&(a=t.getItem(o))&&(a=t.validateAndParseJson(a))&&Qo.isAccountEntity(a)&&(t.logger.trace("BrowserCacheManager:createKeyMaps - account found, saving key to account key map"),t.logger.tracePii("BrowserCacheManager:createKeyMaps - account with key: "+o+" found, saving key to account key map"),t.addAccountKeyToMap(o))})},e.prototype.validateAndParseJson=function(t){try{var r=JSON.parse(t);return r&&typeof r=="object"?r:null}catch{return null}},e.prototype.getItem=function(t){return this.browserStorage.getItem(t)},e.prototype.setItem=function(t,r){this.browserStorage.setItem(t,r)},e.prototype.getAccount=function(t){this.logger.trace("BrowserCacheManager.getAccount called");var r=this.getItem(t);return(r=r&&this.validateAndParseJson(r))&&Qo.isAccountEntity(r)?Ka.toObject(new Qo,r):(this.removeAccountKeyFromMap(t),null)},e.prototype.setAccount=function(t){this.logger.trace("BrowserCacheManager.setAccount called");var r=t.generateAccountKey();this.setItem(r,JSON.stringify(t)),this.addAccountKeyToMap(r)},e.prototype.getAccountKeys=function(){this.logger.trace("BrowserCacheManager.getAccountKeys called");var t=this.getItem(nl.ACCOUNT_KEYS);return t?JSON.parse(t):(this.logger.verbose("BrowserCacheManager.getAccountKeys - No account keys found"),[])},e.prototype.addAccountKeyToMap=function(t){this.logger.trace("BrowserCacheManager.addAccountKeyToMap called"),this.logger.tracePii("BrowserCacheManager.addAccountKeyToMap called with key: "+t);var r=this.getAccountKeys();r.indexOf(t)===-1?(r.push(t),this.setItem(nl.ACCOUNT_KEYS,JSON.stringify(r)),this.logger.verbose("BrowserCacheManager.addAccountKeyToMap account key added")):this.logger.verbose("BrowserCacheManager.addAccountKeyToMap account key already exists in map")},e.prototype.removeAccountKeyFromMap=function(i){this.logger.trace("BrowserCacheManager.removeAccountKeyFromMap called"),this.logger.tracePii("BrowserCacheManager.removeAccountKeyFromMap called with key: "+i);var r=this.getAccountKeys(),i=r.indexOf(i);-1<i?(r.splice(i,1),this.setItem(nl.ACCOUNT_KEYS,JSON.stringify(r)),this.logger.trace("BrowserCacheManager.removeAccountKeyFromMap account key removed")):this.logger.trace("BrowserCacheManager.removeAccountKeyFromMap key not found in existing map")},e.prototype.removeAccount=function(t){return ft(this,void 0,void 0,function(){return pt(this,function(r){return n.prototype.removeAccount.call(this,t),this.removeAccountKeyFromMap(t),[2]})})},e.prototype.removeIdToken=function(t){n.prototype.removeIdToken.call(this,t),this.removeTokenKey(t,In.ID_TOKEN)},e.prototype.removeAccessToken=function(t){return ft(this,void 0,void 0,function(){return pt(this,function(r){return n.prototype.removeAccessToken.call(this,t),this.removeTokenKey(t,In.ACCESS_TOKEN),[2]})})},e.prototype.removeRefreshToken=function(t){n.prototype.removeRefreshToken.call(this,t),this.removeTokenKey(t,In.REFRESH_TOKEN)},e.prototype.getTokenKeys=function(){this.logger.trace("BrowserCacheManager.getTokenKeys called");var t=this.getItem(nl.TOKEN_KEYS+"."+this.clientId);if(t){if(t=this.validateAndParseJson(t),t&&t.hasOwnProperty("idToken")&&t.hasOwnProperty("accessToken")&&t.hasOwnProperty("refreshToken"))return t;this.logger.error("BrowserCacheManager.getTokenKeys - Token keys found but in an unknown format. Returning empty key map.")}else this.logger.verbose("BrowserCacheManager.getTokenKeys - No token keys found");return{idToken:[],accessToken:[],refreshToken:[]}},e.prototype.addTokenKey=function(t,r){this.logger.trace("BrowserCacheManager addTokenKey called");var i=this.getTokenKeys();switch(r){case In.ID_TOKEN:i.idToken.indexOf(t)===-1&&(this.logger.info("BrowserCacheManager: addTokenKey - idToken added to map"),i.idToken.push(t));break;case In.ACCESS_TOKEN:i.accessToken.indexOf(t)===-1&&(this.logger.info("BrowserCacheManager: addTokenKey - accessToken added to map"),i.accessToken.push(t));break;case In.REFRESH_TOKEN:i.refreshToken.indexOf(t)===-1&&(this.logger.info("BrowserCacheManager: addTokenKey - refreshToken added to map"),i.refreshToken.push(t));break;default:this.logger.error("BrowserCacheManager:addTokenKey - CredentialType provided invalid. CredentialType: "+r),tn.createUnexpectedCredentialTypeError()}this.setItem(nl.TOKEN_KEYS+"."+this.clientId,JSON.stringify(i))},e.prototype.removeTokenKey=function(t,r){this.logger.trace("BrowserCacheManager removeTokenKey called");var i=this.getTokenKeys();switch(r){case In.ID_TOKEN:this.logger.infoPii("BrowserCacheManager: removeTokenKey - attempting to remove idToken with key: "+t+" from map");var o=i.idToken.indexOf(t);-1<o?(this.logger.info("BrowserCacheManager: removeTokenKey - idToken removed from map"),i.idToken.splice(o,1)):this.logger.info("BrowserCacheManager: removeTokenKey - idToken does not exist in map. Either it was previously removed or it was never added.");break;case In.ACCESS_TOKEN:this.logger.infoPii("BrowserCacheManager: removeTokenKey - attempting to remove accessToken with key: "+t+" from map"),o=i.accessToken.indexOf(t),-1<o?(this.logger.info("BrowserCacheManager: removeTokenKey - accessToken removed from map"),i.accessToken.splice(o,1)):this.logger.info("BrowserCacheManager: removeTokenKey - accessToken does not exist in map. Either it was previously removed or it was never added.");break;case In.REFRESH_TOKEN:this.logger.infoPii("BrowserCacheManager: removeTokenKey - attempting to remove refreshToken with key: "+t+" from map"),o=i.refreshToken.indexOf(t),-1<o?(this.logger.info("BrowserCacheManager: removeTokenKey - refreshToken removed from map"),i.refreshToken.splice(o,1)):this.logger.info("BrowserCacheManager: removeTokenKey - refreshToken does not exist in map. Either it was previously removed or it was never added.");break;default:this.logger.error("BrowserCacheManager:removeTokenKey - CredentialType provided invalid. CredentialType: "+r),tn.createUnexpectedCredentialTypeError()}this.setItem(nl.TOKEN_KEYS+"."+this.clientId,JSON.stringify(i))},e.prototype.getIdTokenCredential=function(t){var r=this.getItem(t);return(r=r&&this.validateAndParseJson(r))&&Ef.isIdTokenEntity(r)?(this.logger.trace("BrowserCacheManager.getIdTokenCredential: cache hit"),Ka.toObject(new Ef,r)):(this.logger.trace("BrowserCacheManager.getIdTokenCredential: called, no cache hit"),this.removeTokenKey(t,In.ID_TOKEN),null)},e.prototype.setIdTokenCredential=function(t){this.logger.trace("BrowserCacheManager.setIdTokenCredential called");var r=t.generateCredentialKey();this.setItem(r,JSON.stringify(t)),this.addTokenKey(r,In.ID_TOKEN)},e.prototype.getAccessTokenCredential=function(t){var r=this.getItem(t);return(r=r&&this.validateAndParseJson(r))&&Tf.isAccessTokenEntity(r)?(this.logger.trace("BrowserCacheManager.getAccessTokenCredential: cache hit"),Ka.toObject(new Tf,r)):(this.logger.trace("BrowserCacheManager.getAccessTokenCredential: called, no cache hit"),this.removeTokenKey(t,In.ACCESS_TOKEN),null)},e.prototype.setAccessTokenCredential=function(t){this.logger.trace("BrowserCacheManager.setAccessTokenCredential called");var r=t.generateCredentialKey();this.setItem(r,JSON.stringify(t)),this.addTokenKey(r,In.ACCESS_TOKEN)},e.prototype.getRefreshTokenCredential=function(t){var r=this.getItem(t);return(r=r&&this.validateAndParseJson(r))&&dm.isRefreshTokenEntity(r)?(this.logger.trace("BrowserCacheManager.getRefreshTokenCredential: cache hit"),Ka.toObject(new dm,r)):(this.logger.trace("BrowserCacheManager.getRefreshTokenCredential: called, no cache hit"),this.removeTokenKey(t,In.REFRESH_TOKEN),null)},e.prototype.setRefreshTokenCredential=function(t){this.logger.trace("BrowserCacheManager.setRefreshTokenCredential called");var r=t.generateCredentialKey();this.setItem(r,JSON.stringify(t)),this.addTokenKey(r,In.REFRESH_TOKEN)},e.prototype.getAppMetadata=function(t){var r=this.getItem(t);return(r=r&&this.validateAndParseJson(r))&&DP.isAppMetadataEntity(t,r)?(this.logger.trace("BrowserCacheManager.getAppMetadata: cache hit"),Ka.toObject(new DP,r)):(this.logger.trace("BrowserCacheManager.getAppMetadata: called, no cache hit"),null)},e.prototype.setAppMetadata=function(t){this.logger.trace("BrowserCacheManager.setAppMetadata called");var r=t.generateAppMetadataKey();this.setItem(r,JSON.stringify(t))},e.prototype.getServerTelemetry=function(t){var r=this.getItem(t);return(r=r&&this.validateAndParseJson(r))&&$E.isServerTelemetryEntity(t,r)?(this.logger.trace("BrowserCacheManager.getServerTelemetry: cache hit"),Ka.toObject(new $E,r)):(this.logger.trace("BrowserCacheManager.getServerTelemetry: called, no cache hit"),null)},e.prototype.setServerTelemetry=function(t,r){this.logger.trace("BrowserCacheManager.setServerTelemetry called"),this.setItem(t,JSON.stringify(r))},e.prototype.getAuthorityMetadata=function(t){var r=this.internalStorage.getItem(t);return r?(r=this.validateAndParseJson(r))&&FP.isAuthorityMetadataEntity(t,r)?(this.logger.trace("BrowserCacheManager.getAuthorityMetadata: cache hit"),Ka.toObject(new FP,r)):null:(this.logger.trace("BrowserCacheManager.getAuthorityMetadata: called, no cache hit"),null)},e.prototype.getAuthorityMetadataKeys=function(){var t=this;return this.internalStorage.getKeys().filter(function(r){return t.isAuthorityMetadata(r)})},e.prototype.setWrapperMetadata=function(t,r){this.internalStorage.setItem(pm.WRAPPER_SKU,t),this.internalStorage.setItem(pm.WRAPPER_VER,r)},e.prototype.getWrapperMetadata=function(){return[this.internalStorage.getItem(pm.WRAPPER_SKU)||Ne.EMPTY_STRING,this.internalStorage.getItem(pm.WRAPPER_VER)||Ne.EMPTY_STRING]},e.prototype.setAuthorityMetadata=function(t,r){this.logger.trace("BrowserCacheManager.setAuthorityMetadata called"),this.internalStorage.setItem(t,JSON.stringify(r))},e.prototype.getActiveAccount=function(){var t=this.generateCacheKey(Eo.ACTIVE_ACCOUNT_FILTERS),t=this.getItem(t);return t?(t=this.validateAndParseJson(t))?(this.logger.trace("BrowserCacheManager.getActiveAccount: Active account filters schema found"),this.getAccountInfoByFilter({homeAccountId:t.homeAccountId,localAccountId:t.localAccountId})[0]||null):(this.logger.trace("BrowserCacheManager.getActiveAccount: No active account found"),null):(this.logger.trace("BrowserCacheManager.getActiveAccount: No active account filters cache schema found, looking for legacy schema"),t=this.generateCacheKey(Eo.ACTIVE_ACCOUNT),(t=this.getItem(t))?(t=this.getAccountInfoByFilter({localAccountId:t})[0]||null)?(this.logger.trace("BrowserCacheManager.getActiveAccount: Legacy active account cache schema found"),this.logger.trace("BrowserCacheManager.getActiveAccount: Adding active account filters cache schema"),this.setActiveAccount(t),t):null:(this.logger.trace("BrowserCacheManager.getActiveAccount: No active account found"),null))},e.prototype.setActiveAccount=function(t){var r,i=this.generateCacheKey(Eo.ACTIVE_ACCOUNT_FILTERS),o=this.generateCacheKey(Eo.ACTIVE_ACCOUNT);t?(this.logger.verbose("setActiveAccount: Active account set"),r={homeAccountId:t.homeAccountId,localAccountId:t.localAccountId},this.browserStorage.setItem(i,JSON.stringify(r)),this.browserStorage.setItem(o,t.localAccountId)):(this.logger.verbose("setActiveAccount: No account passed, active account not set"),this.browserStorage.removeItem(i),this.browserStorage.removeItem(o))},e.prototype.getAccountInfoByFilter=function(t){var r=this.getAllAccounts();return this.logger.trace("BrowserCacheManager.getAccountInfoByFilter: total "+r.length+" accounts found"),r.filter(function(i){return!(t.username&&t.username.toLowerCase()!==i.username.toLowerCase()||t.homeAccountId&&t.homeAccountId!==i.homeAccountId||t.localAccountId&&t.localAccountId!==i.localAccountId||t.tenantId&&t.tenantId!==i.tenantId||t.environment&&t.environment!==i.environment)})},e.prototype.getAccountInfoByHints=function(t,r){var i=this.getAllAccounts().filter(function(o){var a;return r?(a=o.idTokenClaims&&o.idTokenClaims.sid,r===a):!!t&&t===o.username});if(i.length===1)return i[0];if(1<i.length)throw tn.createMultipleMatchingAccountsInCacheError();return null},e.prototype.getThrottlingCache=function(t){var r=this.getItem(t);return(r=r&&this.validateAndParseJson(r))&&ZF.isThrottlingEntity(t,r)?(this.logger.trace("BrowserCacheManager.getThrottlingCache: cache hit"),Ka.toObject(new ZF,r)):(this.logger.trace("BrowserCacheManager.getThrottlingCache: called, no cache hit"),null)},e.prototype.setThrottlingCache=function(t,r){this.logger.trace("BrowserCacheManager.setThrottlingCache called"),this.setItem(t,JSON.stringify(r))},e.prototype.getTemporaryCache=function(t,r){return r=r?this.generateCacheKey(t):t,this.cacheConfig.storeAuthStateInCookie&&(t=this.getItemCookie(r),t)?(this.logger.trace("BrowserCacheManager.getTemporaryCache: storeAuthStateInCookies set to true, retrieving from cookies"),t):(t=this.temporaryCacheStorage.getItem(r),t?(this.logger.trace("BrowserCacheManager.getTemporaryCache: Temporary cache item returned"),t):this.cacheConfig.cacheLocation===po.LocalStorage&&(t=this.browserStorage.getItem(r),t)?(this.logger.trace("BrowserCacheManager.getTemporaryCache: Temporary cache item found in local storage"),t):(this.logger.trace("BrowserCacheManager.getTemporaryCache: No cache item found in local storage"),null))},e.prototype.setTemporaryCache=function(t,r,i){i=i?this.generateCacheKey(t):t,this.temporaryCacheStorage.setItem(i,r),this.cacheConfig.storeAuthStateInCookie&&(this.logger.trace("BrowserCacheManager.setTemporaryCache: storeAuthStateInCookie set to true, setting item cookie"),this.setItemCookie(i,r))},e.prototype.removeItem=function(t){this.browserStorage.removeItem(t),this.temporaryCacheStorage.removeItem(t),this.cacheConfig.storeAuthStateInCookie&&(this.logger.trace("BrowserCacheManager.removeItem: storeAuthStateInCookie is true, clearing item cookie"),this.clearItemCookie(t))},e.prototype.containsKey=function(t){return this.browserStorage.containsKey(t)||this.temporaryCacheStorage.containsKey(t)},e.prototype.getKeys=function(){return ok(this.browserStorage.getKeys(),this.temporaryCacheStorage.getKeys())},e.prototype.clear=function(){return ft(this,void 0,void 0,function(){var t=this;return pt(this,function(r){switch(r.label){case 0:return[4,this.removeAllAccounts()];case 1:return r.sent(),this.removeAppMetadata(),this.getKeys().forEach(function(i){!t.browserStorage.containsKey(i)&&!t.temporaryCacheStorage.containsKey(i)||i.indexOf(Ne.CACHE_PREFIX)===-1&&i.indexOf(t.clientId)===-1||t.removeItem(i)}),this.internalStorage.clear(),[2]}})})},e.prototype.clearTokensAndKeysWithClaims=function(){return ft(this,void 0,void 0,function(){var t,r,i=this;return pt(this,function(o){switch(o.label){case 0:return this.logger.trace("BrowserCacheManager.clearTokensAndKeysWithClaims called"),t=this.getTokenKeys(),r=[],t.accessToken.forEach(function(a){var l=i.getAccessTokenCredential(a);l!=null&&l.requestedClaimsHash&&a.includes(l.requestedClaimsHash.toLowerCase())&&r.push(i.removeAccessToken(a))}),[4,Promise.all(r)];case 1:return o.sent(),0<r.length&&this.logger.warning(r.length+" access tokens with claims in the cache keys have been removed from the cache."),[2]}})})},e.prototype.setItemCookie=function(t,r,i){t=encodeURIComponent(t)+"="+encodeURIComponent(r)+";path=/;SameSite=Lax;",i&&(t+="expires="+this.getCookieExpirationTime(i)+";"),this.cacheConfig.secureCookies&&(t+="Secure;"),document.cookie=t},e.prototype.getItemCookie=function(t){for(var r=encodeURIComponent(t)+"=",i=document.cookie.split(";"),o=0;o<i.length;o++){for(var a=i[o];a.charAt(0)===" ";)a=a.substring(1);if(a.indexOf(r)===0)return decodeURIComponent(a.substring(r.length,a.length))}return Ne.EMPTY_STRING},e.prototype.clearMsalCookies=function(){var t=this,r=Ne.CACHE_PREFIX+"."+this.clientId;document.cookie.split(";").forEach(function(i){for(;i.charAt(0)===" ";)i=i.substring(1);var o;i.indexOf(r)===0&&(o=i.split("=")[0],t.clearItemCookie(o))})},e.prototype.clearItemCookie=function(t){this.setItemCookie(t,Ne.EMPTY_STRING,-1)},e.prototype.getCookieExpirationTime=function(t){var r=new Date;return new Date(r.getTime()+t*this.COOKIE_LIFE_MULTIPLIER).toUTCString()},e.prototype.getCache=function(){return this.browserStorage},e.prototype.setCache=function(){},e.prototype.generateCacheKey=function(t){return this.validateAndParseJson(t)?JSON.stringify(t):Zt.startsWith(t,Ne.CACHE_PREFIX)||Zt.startsWith(t,Eo.ADAL_ID_TOKEN)?t:Ne.CACHE_PREFIX+"."+this.clientId+"."+t},e.prototype.generateAuthorityKey=function(t){return t=yu.parseRequestState(this.cryptoImpl,t).libraryState.id,this.generateCacheKey(kr.AUTHORITY+"."+t)},e.prototype.generateNonceKey=function(t){return t=yu.parseRequestState(this.cryptoImpl,t).libraryState.id,this.generateCacheKey(kr.NONCE_IDTOKEN+"."+t)},e.prototype.generateStateKey=function(t){return t=yu.parseRequestState(this.cryptoImpl,t).libraryState.id,this.generateCacheKey(kr.REQUEST_STATE+"."+t)},e.prototype.getCachedAuthority=function(r){var r=this.generateStateKey(r),r=this.getTemporaryCache(r);return r?(r=this.generateAuthorityKey(r),this.getTemporaryCache(r)):null},e.prototype.updateCacheEntries=function(t,r,i,o,a){this.logger.trace("BrowserCacheManager.updateCacheEntries called");var l,h=this.generateStateKey(t),h=(this.setTemporaryCache(h,t,!1),this.generateNonceKey(t)),h=(this.setTemporaryCache(h,r,!1),this.generateAuthorityKey(t));this.setTemporaryCache(h,i,!1),a?(l={credential:a.homeAccountId,type:Ns.HOME_ACCOUNT_ID},this.setTemporaryCache(kr.CCS_CREDENTIAL,JSON.stringify(l),!0)):Zt.isEmpty(o)||(l={credential:o,type:Ns.UPN},this.setTemporaryCache(kr.CCS_CREDENTIAL,JSON.stringify(l),!0))},e.prototype.resetRequestCache=function(t){var r=this;this.logger.trace("BrowserCacheManager.resetRequestCache called"),Zt.isEmpty(t)||this.getKeys().forEach(function(i){i.indexOf(t)!==-1&&r.removeItem(i)}),t&&(this.removeItem(this.generateStateKey(t)),this.removeItem(this.generateNonceKey(t)),this.removeItem(this.generateAuthorityKey(t))),this.removeItem(this.generateCacheKey(kr.REQUEST_PARAMS)),this.removeItem(this.generateCacheKey(kr.ORIGIN_URI)),this.removeItem(this.generateCacheKey(kr.URL_HASH)),this.removeItem(this.generateCacheKey(kr.CORRELATION_ID)),this.removeItem(this.generateCacheKey(kr.CCS_CREDENTIAL)),this.removeItem(this.generateCacheKey(kr.NATIVE_REQUEST)),this.setInteractionInProgress(!1)},e.prototype.cleanRequestByState=function(t){this.logger.trace("BrowserCacheManager.cleanRequestByState called"),t&&(t=this.generateStateKey(t),t=this.temporaryCacheStorage.getItem(t),this.logger.infoPii("BrowserCacheManager.cleanRequestByState: Removing temporary cache items for state: "+t),this.resetRequestCache(t||Ne.EMPTY_STRING)),this.clearMsalCookies()},e.prototype.cleanRequestByInteractionType=function(t){var r=this;this.logger.trace("BrowserCacheManager.cleanRequestByInteractionType called"),this.getKeys().forEach(function(i){var o;i.indexOf(kr.REQUEST_STATE)!==-1&&(i=r.temporaryCacheStorage.getItem(i))&&(o=DV.extractBrowserRequestState(r.cryptoImpl,i))&&o.interactionType===t&&(r.logger.infoPii("BrowserCacheManager.cleanRequestByInteractionType: Removing temporary cache items for state: "+i),r.resetRequestCache(i))}),this.clearMsalCookies(),this.setInteractionInProgress(!1)},e.prototype.cacheCodeRequest=function(t,r){this.logger.trace("BrowserCacheManager.cacheCodeRequest called"),r=r.base64Encode(JSON.stringify(t)),this.setTemporaryCache(kr.REQUEST_PARAMS,r,!0)},e.prototype.getCachedRequest=function(t,r){this.logger.trace("BrowserCacheManager.getCachedRequest called");var i=this.getTemporaryCache(kr.REQUEST_PARAMS,!0);if(!i)throw Ht.createNoTokenRequestCacheError();if(r=this.validateAndParseJson(r.base64Decode(i)),!r)throw Ht.createUnableToParseTokenRequestCacheError();if(this.removeItem(this.generateCacheKey(kr.REQUEST_PARAMS)),Zt.isEmpty(r.authority)){if(i=this.generateAuthorityKey(t),t=this.getTemporaryCache(i),!t)throw Ht.createNoCachedAuthorityError();r.authority=t}return r},e.prototype.getCachedNativeRequest=function(){this.logger.trace("BrowserCacheManager.getCachedNativeRequest called");var t=this.getTemporaryCache(kr.NATIVE_REQUEST,!0);return t?this.validateAndParseJson(t)||(this.logger.error("BrowserCacheManager.getCachedNativeRequest: Unable to parse native request"),null):(this.logger.trace("BrowserCacheManager.getCachedNativeRequest: No cached native request found"),null)},e.prototype.isInteractionInProgress=function(t){var r=this.getInteractionInProgress();return t?r===this.clientId:!!r},e.prototype.getInteractionInProgress=function(){var t=Ne.CACHE_PREFIX+"."+kr.INTERACTION_STATUS_KEY;return this.getTemporaryCache(t,!1)},e.prototype.setInteractionInProgress=function(t){var r=Ne.CACHE_PREFIX+"."+kr.INTERACTION_STATUS_KEY;if(t){if(this.getInteractionInProgress())throw Ht.createInteractionInProgressError();this.setTemporaryCache(r,this.clientId,!1)}else this.getInteractionInProgress()===this.clientId&&this.removeItem(r)},e.prototype.getLegacyLoginHint=function(){var t=this.getTemporaryCache(Eo.ADAL_ID_TOKEN),r=(t&&(this.browserStorage.removeItem(Eo.ADAL_ID_TOKEN),this.logger.verbose("Cached ADAL id token retrieved.")),this.getTemporaryCache(Eo.ID_TOKEN,!0)),r=(r&&(this.removeItem(this.generateCacheKey(Eo.ID_TOKEN)),this.logger.verbose("Cached MSAL.js v1 id token retrieved")),r||t);if(r){if(t=new Pl(r,this.cryptoImpl),t.claims&&t.claims.preferred_username)return this.logger.verbose("No SSO params used and ADAL/MSAL v1 token retrieved, setting ADAL/MSAL v1 preferred_username as loginHint"),t.claims.preferred_username;if(t.claims&&t.claims.upn)return this.logger.verbose("No SSO params used and ADAL/MSAL v1 token retrieved, setting ADAL/MSAL v1 upn as loginHint"),t.claims.upn;this.logger.verbose("No SSO params used and ADAL/MSAL v1 token retrieved, however, no account hint claim found. Enable preferred_username or upn id token claim to get SSO.")}return null},e.prototype.updateCredentialCacheKey=function(t,r){var i=r.generateCredentialKey();if(t!==i){var o=this.getItem(t);if(o)return this.removeItem(t),this.setItem(i,o),this.logger.verbose("Updated an outdated "+r.credentialType+" cache key"),i;this.logger.error("Attempted to update an outdated "+r.credentialType+" cache key but no item matching the outdated key was found in storage")}return t},e.prototype.getRedirectRequestContext=function(){return this.getTemporaryCache(kr.REDIRECT_CONTEXT,!0)},e.prototype.setRedirectRequestContext=function(t){this.setTemporaryCache(kr.REDIRECT_CONTEXT,t,!0)},e}(Ka),AEe=function(n,e){var t={cacheLocation:po.MemoryStorage,temporaryCacheLocation:po.MemoryStorage,storeAuthStateInCookie:!1,secureCookies:!1,cacheMigrationEnabled:!1,claimsBasedCachingEnabled:!0};return new zP(n,t,UE,e)},u2="@azure/msal-browser",h0="2.38.3",IEe=function(){function n(){}return n.prototype.sendGetRequestAsync=function(e,t){return ft(this,void 0,void 0,function(){var r,i,o;return pt(this,function(a){switch(a.label){case 0:return a.trys.push([0,2,,3]),[4,fetch(e,{method:sl.GET,headers:this.getFetchHeaders(t)})];case 1:return r=a.sent(),[3,3];case 2:throw i=a.sent(),window.navigator.onLine?Ht.createGetRequestFailedError(i,e):Ht.createNoNetworkConnectivityError();case 3:return a.trys.push([3,5,,6]),o={headers:this.getHeaderDict(r.headers)},[4,r.json()];case 4:return[2,(o.body=a.sent(),o.status=r.status,o)];case 5:throw a.sent(),Ht.createFailedToParseNetworkResponseError(e);case 6:return[2]}})})},n.prototype.sendPostRequestAsync=function(e,t){return ft(this,void 0,void 0,function(){var r,i,o,a;return pt(this,function(l){switch(l.label){case 0:r=t&&t.body||Ne.EMPTY_STRING,l.label=1;case 1:return l.trys.push([1,3,,4]),[4,fetch(e,{method:sl.POST,headers:this.getFetchHeaders(t),body:r})];case 2:return i=l.sent(),[3,4];case 3:throw o=l.sent(),window.navigator.onLine?Ht.createPostRequestFailedError(o,e):Ht.createNoNetworkConnectivityError();case 4:return l.trys.push([4,6,,7]),a={headers:this.getHeaderDict(i.headers)},[4,i.json()];case 5:return[2,(a.body=l.sent(),a.status=i.status,a)];case 6:throw l.sent(),Ht.createFailedToParseNetworkResponseError(e);case 7:return[2]}})})},n.prototype.getFetchHeaders=function(e){var t,r=new Headers;return e&&e.headers&&(t=e.headers,Object.keys(t).forEach(function(i){r.append(i,t[i])})),r},n.prototype.getHeaderDict=function(e){var t={};return e.forEach(function(r,i){t[i]=r}),t},n}(),PEe=function(){function n(){}return n.prototype.sendGetRequestAsync=function(e,t){return ft(this,void 0,void 0,function(){return pt(this,function(r){return[2,this.sendRequestAsync(e,sl.GET,t)]})})},n.prototype.sendPostRequestAsync=function(e,t){return ft(this,void 0,void 0,function(){return pt(this,function(r){return[2,this.sendRequestAsync(e,sl.POST,t)]})})},n.prototype.sendRequestAsync=function(e,t,r){var i=this;return new Promise(function(o,a){var l=new XMLHttpRequest;if(l.open(t,e,!0),i.setXhrHeaders(l,r),l.onload=function(){(l.status<200||300<=l.status)&&(t===sl.POST?a(Ht.createPostRequestFailedError("Failed with status "+l.status,e)):a(Ht.createGetRequestFailedError("Failed with status "+l.status,e)));try{var h=JSON.parse(l.responseText),p={headers:i.getHeaderDict(l),body:h,status:l.status};o(p)}catch{a(Ht.createFailedToParseNetworkResponseError(e))}},l.onerror=function(){window.navigator.onLine?t===sl.POST?a(Ht.createPostRequestFailedError("Failed with status "+l.status,e)):a(Ht.createGetRequestFailedError("Failed with status "+l.status,e)):a(Ht.createNoNetworkConnectivityError())},t===sl.POST&&r&&r.body)l.send(r.body);else{if(t!==sl.GET)throw Ht.createHttpMethodNotImplementedError(t);l.send()}})},n.prototype.setXhrHeaders=function(e,t){var r;t&&t.headers&&(r=t.headers,Object.keys(r).forEach(function(i){e.setRequestHeader(i,r[i])}))},n.prototype.getHeaderDict=function(t){var t=t.getAllResponseHeaders().trim().split(/[\r\n]+/),r={};return t.forEach(function(a){var a=a.split(": "),o=a.shift(),a=a.join(": ");o&&a&&(r[o]=a)}),r},n}(),Yi=function(){function n(){}return n.clearHash=function(e){e.location.hash=Ne.EMPTY_STRING,typeof e.history.replaceState=="function"&&e.history.replaceState(null,Ne.EMPTY_STRING,""+e.location.origin+e.location.pathname+e.location.search)},n.replaceHash=function(e){e=e.split("#"),e.shift(),window.location.hash=0<e.length?e.join("#"):Ne.EMPTY_STRING},n.isInIframe=function(){return window.parent!==window},n.isInPopup=function(){return typeof window<"u"&&!!window.opener&&window.opener!==window&&typeof window.name=="string"&&window.name.indexOf(Ec.POPUP_NAME_PREFIX+".")===0},n.getCurrentUri=function(){return window.location.href.split("?")[0].split("#")[0]},n.getHomepage=function(){var e=new xr(window.location.href).getUrlComponents();return e.Protocol+"//"+e.HostNameAndPort+"/"},n.getBrowserNetworkClient=function(){return new(window.fetch&&window.Headers?IEe:PEe)},n.blockReloadInHiddenIframes=function(){if(xr.hashContainsKnownProperties(window.location.hash)&&n.isInIframe())throw Ht.createBlockReloadInHiddenIframeError()},n.blockRedirectInIframe=function(e,t){var r=n.isInIframe();if(e===gn.Redirect&&r&&!t)throw Ht.createRedirectInIframeError(r)},n.blockAcquireTokenInPopups=function(){if(n.isInPopup())throw Ht.createBlockAcquireTokenInPopupsError()},n.blockNonBrowserEnvironment=function(e){if(!e)throw Ht.createNonBrowserEnvironmentError()},n.blockNativeBrokerCalledBeforeInitialized=function(e,t){if(e&&!t)throw Ht.createNativeBrokerCalledBeforeInitialize()},n.detectIEOrEdge=function(){var r=window.navigator.userAgent,e=r.indexOf("MSIE "),t=r.indexOf("Trident/"),r=r.indexOf("Edge/");return 0<e||0<t||0<r},n}(),FV=function(){function n(e,t,r,i,o,a,l,h,p){this.config=e,this.browserStorage=t,this.browserCrypto=r,this.networkClient=this.config.system.networkClient,this.eventHandler=o,this.navigationClient=a,this.nativeMessageHandler=h,this.correlationId=p||this.browserCrypto.createNewGuid(),this.logger=i.clone(Ec.MSAL_SKU,h0,this.correlationId),this.performanceClient=l}return n.prototype.clearCacheOnLogout=function(e){return ft(this,void 0,void 0,function(){return pt(this,function(t){switch(t.label){case 0:if(!e)return[3,5];Qo.accountInfoIsEqual(e,this.browserStorage.getActiveAccount(),!1)&&(this.logger.verbose("Setting active account to null"),this.browserStorage.setActiveAccount(null)),t.label=1;case 1:return t.trys.push([1,3,,4]),[4,this.browserStorage.removeAccount(Qo.generateAccountCacheKey(e))];case 2:return t.sent(),this.logger.verbose("Cleared cache items belonging to the account provided in the logout request."),[3,4];case 3:return t.sent(),this.logger.error("Account provided in logout request was not found. Local cache unchanged."),[3,4];case 4:return[3,9];case 5:return t.trys.push([5,8,,9]),this.logger.verbose("No account provided in logout request, clearing all cache items.",this.correlationId),[4,this.browserStorage.clear()];case 6:return t.sent(),[4,this.browserCrypto.clearKeystore()];case 7:return t.sent(),[3,9];case 8:return t.sent(),this.logger.error("Attempted to clear all MSAL cache items and failed. Local cache unchanged."),[3,9];case 9:return[2]}})})},n.prototype.initializeBaseRequest=function(e,t){return ft(this,void 0,void 0,function(){var r,i,o;return pt(this,function(a){switch(a.label){case 0:return this.performanceClient.addQueueMeasurement(nt.InitializeBaseRequest,e.correlationId),this.logger.verbose("Initializing BaseAuthRequest"),r=e.authority||this.config.auth.authority,t?[4,this.validateRequestAuthority(r,t)]:[3,2];case 1:a.sent(),a.label=2;case 2:if(i=ok(e&&e.scopes||[]),(i=bn(bn({},e),{correlationId:this.correlationId,authority:r,scopes:i})).authenticationScheme){if(i.authenticationScheme===Kr.SSH){if(!e.sshJwk)throw vi.createMissingSshJwkError();if(!e.sshKid)throw vi.createMissingSshKidError()}this.logger.verbose('Authentication Scheme set to "'+i.authenticationScheme+'" as configured in Auth request')}else i.authenticationScheme=Kr.BEARER,this.logger.verbose(`Authentication Scheme wasn't explicitly set in request, defaulting to "Bearer" request`);return this.config.cache.claimsBasedCachingEnabled&&e.claims&&!Zt.isEmptyObj(e.claims)?(o=i,[4,this.browserCrypto.hashString(e.claims)]):[3,4];case 3:o.requestedClaimsHash=a.sent(),a.label=4;case 4:return[2,i]}})})},n.prototype.getRedirectUri=function(e){return this.logger.verbose("getRedirectUri called"),e=e||this.config.auth.redirectUri||Yi.getCurrentUri(),xr.getAbsoluteUrl(e,Yi.getCurrentUri())},n.prototype.validateRequestAuthority=function(e,t){return ft(this,void 0,void 0,function(){return pt(this,function(r){switch(r.label){case 0:return[4,this.getDiscoveredAuthority(e)];case 1:if(r.sent().isAlias(t.environment))return[2];throw vi.createAuthorityMismatchError()}})})},n.prototype.initializeServerTelemetryManager=function(e,t){return this.logger.verbose("initializeServerTelemetryManager called"),e={clientId:this.config.auth.clientId,correlationId:this.correlationId,apiId:e,forceRefresh:t||!1,wrapperSKU:this.browserStorage.getWrapperMetadata()[0],wrapperVer:this.browserStorage.getWrapperMetadata()[1]},new EEe(e,this.browserStorage)},n.prototype.getDiscoveredAuthority=function(e){return ft(this,void 0,void 0,function(){var t;return pt(this,function(r){switch(r.label){case 0:return this.logger.verbose("getDiscoveredAuthority called"),t={protocolMode:this.config.auth.protocolMode,knownAuthorities:this.config.auth.knownAuthorities,cloudDiscoveryMetadata:this.config.auth.cloudDiscoveryMetadata,authorityMetadata:this.config.auth.authorityMetadata},e?(this.logger.verbose("Creating discovered authority with request authority"),[4,qE.createDiscoveredInstance(e,this.config.system.networkClient,this.browserStorage,t,this.logger)]):[3,2];case 1:return[2,r.sent()];case 2:return this.logger.verbose("Creating discovered authority with configured authority"),[4,qE.createDiscoveredInstance(this.config.auth.authority,this.config.system.networkClient,this.browserStorage,t,this.logger)];case 3:return[2,r.sent()]}})})},n}(),Sy=function(n){function e(){return n!==null&&n.apply(this,arguments)||this}return ia(e,n),e.prototype.initializeAuthorizationCodeRequest=function(t){return ft(this,void 0,void 0,function(){var r,i;return pt(this,function(o){switch(o.label){case 0:return this.performanceClient.addQueueMeasurement(nt.StandardInteractionClientInitializeAuthorizationCodeRequest,t.correlationId),this.logger.verbose("initializeAuthorizationRequest called",t.correlationId),[4,this.browserCrypto.generatePkceCodes()];case 1:return r=o.sent(),i=bn(bn({},t),{redirectUri:t.redirectUri,code:Ne.EMPTY_STRING,codeVerifier:r.verifier}),t.codeChallenge=r.challenge,t.codeChallengeMethod=Ne.S256_CODE_CHALLENGE_METHOD,[2,i]}})})},e.prototype.initializeLogoutRequest=function(t){this.logger.verbose("initializeLogoutRequest called",t==null?void 0:t.correlationId);var r,i=bn({correlationId:this.correlationId||this.browserCrypto.createNewGuid()},t);return t?t.logoutHint?this.logger.verbose("logoutHint has already been set in logoutRequest"):t.account?(r=this.getLogoutHintFromIdTokenClaims(t.account))&&(this.logger.verbose("Setting logoutHint to login_hint ID Token Claim value for the account provided"),i.logoutHint=r):this.logger.verbose("logoutHint was not set and account was not passed into logout request, logoutHint will not be set"):this.logger.verbose("logoutHint will not be set since no logout request was configured"),t&&t.postLogoutRedirectUri===null?this.logger.verbose("postLogoutRedirectUri passed as null, not setting post logout redirect uri",i.correlationId):t&&t.postLogoutRedirectUri?(this.logger.verbose("Setting postLogoutRedirectUri to uri set on logout request",i.correlationId),i.postLogoutRedirectUri=xr.getAbsoluteUrl(t.postLogoutRedirectUri,Yi.getCurrentUri())):this.config.auth.postLogoutRedirectUri===null?this.logger.verbose("postLogoutRedirectUri configured as null and no uri set on request, not passing post logout redirect",i.correlationId):this.config.auth.postLogoutRedirectUri?(this.logger.verbose("Setting postLogoutRedirectUri to configured uri",i.correlationId),i.postLogoutRedirectUri=xr.getAbsoluteUrl(this.config.auth.postLogoutRedirectUri,Yi.getCurrentUri())):(this.logger.verbose("Setting postLogoutRedirectUri to current page",i.correlationId),i.postLogoutRedirectUri=xr.getAbsoluteUrl(Yi.getCurrentUri(),Yi.getCurrentUri())),i},e.prototype.getLogoutHintFromIdTokenClaims=function(t){if(t=t.idTokenClaims,t){if(t.login_hint)return t.login_hint;this.logger.verbose("The ID Token Claims tied to the provided account do not contain a login_hint claim, logoutHint will not be added to logout request")}else this.logger.verbose("The provided account does not contain ID Token Claims, logoutHint will not be added to logout request");return null},e.prototype.createAuthCodeClient=function(t,r,i){return ft(this,void 0,void 0,function(){var o;return pt(this,function(a){switch(a.label){case 0:return this.performanceClient.addQueueMeasurement(nt.StandardInteractionClientCreateAuthCodeClient,this.correlationId),this.performanceClient.setPreQueueTime(nt.StandardInteractionClientGetClientConfiguration,this.correlationId),[4,this.getClientConfiguration(t,r,i)];case 1:return o=a.sent(),[2,new kV(o,this.performanceClient)]}})})},e.prototype.getClientConfiguration=function(t,r,i){return ft(this,void 0,void 0,function(){var o,a;return pt(this,function(l){switch(l.label){case 0:return this.performanceClient.addQueueMeasurement(nt.StandardInteractionClientGetClientConfiguration,this.correlationId),this.logger.verbose("getClientConfiguration called",this.correlationId),this.performanceClient.setPreQueueTime(nt.StandardInteractionClientGetDiscoveredAuthority,this.correlationId),[4,this.getDiscoveredAuthority(r,i)];case 1:return o=l.sent(),a=this.config.system.loggerOptions,[2,{authOptions:{clientId:this.config.auth.clientId,authority:o,clientCapabilities:this.config.auth.clientCapabilities},systemOptions:{tokenRenewalOffsetSeconds:this.config.system.tokenRenewalOffsetSeconds,preventCorsPreflight:!0},loggerOptions:{loggerCallback:a.loggerCallback,piiLoggingEnabled:a.piiLoggingEnabled,logLevel:a.logLevel,correlationId:this.correlationId},cacheOptions:{claimsBasedCachingEnabled:this.config.cache.claimsBasedCachingEnabled},cryptoInterface:this.browserCrypto,networkInterface:this.networkClient,storageInterface:this.browserStorage,serverTelemetryManager:t,libraryInfo:{sku:Ec.MSAL_SKU,version:h0,cpu:Ne.EMPTY_STRING,os:Ne.EMPTY_STRING},telemetry:this.config.telemetry}]}})})},e.prototype.validateAndExtractStateFromHash=function(t,r,i){if(this.logger.verbose("validateAndExtractStateFromHash called",i),!t.state)throw Ht.createHashDoesNotContainStateError();var o=DV.extractBrowserRequestState(this.browserCrypto,t.state);if(!o)throw Ht.createUnableToParseStateError();if(o.interactionType!==r)throw Ht.createStateInteractionTypeMismatchError();return this.logger.verbose("Returning state from hash",i),t.state},e.prototype.getDiscoveredAuthority=function(t,r){var i;return ft(this,void 0,void 0,function(){var o,a,l;return pt(this,function(h){switch(h.label){case 0:return this.performanceClient.addQueueMeasurement(nt.StandardInteractionClientGetDiscoveredAuthority,this.correlationId),this.logger.verbose("getDiscoveredAuthority called",this.correlationId),o=(i=this.performanceClient)==null?void 0:i.startMeasurement(nt.StandardInteractionClientGetDiscoveredAuthority,this.correlationId),a={protocolMode:this.config.auth.protocolMode,knownAuthorities:this.config.auth.knownAuthorities,cloudDiscoveryMetadata:this.config.auth.cloudDiscoveryMetadata,authorityMetadata:this.config.auth.authorityMetadata,skipAuthorityMetadataCache:this.config.auth.skipAuthorityMetadataCache},l=t||this.config.auth.authority,l=K0.generateAuthority(l,r||this.config.auth.azureCloudOptions),this.logger.verbose("Creating discovered authority with configured authority",this.correlationId),this.performanceClient.setPreQueueTime(nt.AuthorityFactoryCreateDiscoveredInstance,this.correlationId),[4,qE.createDiscoveredInstance(l,this.config.system.networkClient,this.browserStorage,a,this.logger,this.performanceClient,this.correlationId).then(function(p){return o.endMeasurement({success:!0}),p}).catch(function(p){throw o.endMeasurement({errorCode:p.errorCode,subErrorCode:p.subError,success:!1}),p})];case 1:return[2,h.sent()]}})})},e.prototype.initializeAuthorizationRequest=function(t,r){return ft(this,void 0,void 0,function(){var i,o,a,l,h;return pt(this,function(p){switch(p.label){case 0:return this.performanceClient.addQueueMeasurement(nt.StandardInteractionClientInitializeAuthorizationRequest,this.correlationId),this.logger.verbose("initializeAuthorizationRequest called",this.correlationId),i=this.getRedirectUri(t.redirectUri),o={interactionType:r},o=yu.setRequestState(this.browserCrypto,t&&t.state||Ne.EMPTY_STRING,o),this.performanceClient.setPreQueueTime(nt.InitializeBaseRequest,this.correlationId),l=[{}],[4,this.initializeBaseRequest(t)];case 1:return a=bn.apply(void 0,[bn.apply(void 0,l.concat([p.sent()])),{redirectUri:i,state:o,nonce:t.nonce||this.browserCrypto.createNewGuid(),responseMode:DE.FRAGMENT}]),(h=t.account||this.browserStorage.getActiveAccount())&&(this.logger.verbose("Setting validated request account",this.correlationId),this.logger.verbosePii("Setting validated request account: "+h.homeAccountId,this.correlationId),a.account=h),Zt.isEmpty(a.loginHint)&&!h&&(h=this.browserStorage.getLegacyLoginHint())&&(a.loginHint=h),[2,a]}})})},e}(FV),uk=function(){function n(e,t,r,i,o){this.authModule=e,this.browserStorage=t,this.authCodeRequest=r,this.logger=i,this.performanceClient=o}return n.prototype.handleCodeResponseFromHash=function(e,t,r,i){return ft(this,void 0,void 0,function(){var o,a;return pt(this,function(l){if(this.performanceClient.addQueueMeasurement(nt.HandleCodeResponseFromHash,this.authCodeRequest.correlationId),this.logger.verbose("InteractionHandler.handleCodeResponse called"),Zt.isEmpty(e))throw Ht.createEmptyHashError(e);if(o=this.browserStorage.generateStateKey(t),!(o=this.browserStorage.getTemporaryCache(o)))throw tn.createStateNotFoundError("Cached State");try{a=this.authModule.handleFragmentResponse(e,o)}catch(h){throw h instanceof Jf&&h.subError===Pt.userCancelledError.code?Ht.createUserCancelledError():h}return this.performanceClient.setPreQueueTime(nt.HandleCodeResponseFromServer,this.authCodeRequest.correlationId),[2,this.handleCodeResponseFromServer(a,t,r,i)]})})},n.prototype.handleCodeResponseFromServer=function(e,t,r,i,o){return o===void 0&&(o=!0),ft(this,void 0,void 0,function(){var a,l,h;return pt(this,function(p){switch(p.label){case 0:if(this.performanceClient.addQueueMeasurement(nt.HandleCodeResponseFromServer,this.authCodeRequest.correlationId),this.logger.trace("InteractionHandler.handleCodeResponseFromServer called"),a=this.browserStorage.generateStateKey(t),a=this.browserStorage.getTemporaryCache(a))return l=this.browserStorage.generateNonceKey(a),l=this.browserStorage.getTemporaryCache(l),this.authCodeRequest.code=e.code,e.cloud_instance_host_name?(this.performanceClient.setPreQueueTime(nt.UpdateTokenEndpointAuthority,this.authCodeRequest.correlationId),[4,this.updateTokenEndpointAuthority(e.cloud_instance_host_name,r,i)]):[3,2];throw tn.createStateNotFoundError("Cached State");case 1:p.sent(),p.label=2;case 2:return o&&(e.nonce=l||void 0),e.state=a,e.client_info?this.authCodeRequest.clientInfo=e.client_info:(h=this.checkCcsCredentials())&&(this.authCodeRequest.ccsCredential=h),this.performanceClient.setPreQueueTime(nt.AuthClientAcquireToken,this.authCodeRequest.correlationId),[4,this.authModule.acquireToken(this.authCodeRequest,e)];case 3:return h=p.sent(),this.browserStorage.cleanRequestByState(t),[2,h]}})})},n.prototype.updateTokenEndpointAuthority=function(e,t,r){return ft(this,void 0,void 0,function(){var i;return pt(this,function(o){switch(o.label){case 0:return this.performanceClient.addQueueMeasurement(nt.UpdateTokenEndpointAuthority,this.authCodeRequest.correlationId),i="https://"+e+"/"+t.tenant+"/",[4,qE.createDiscoveredInstance(i,r,this.browserStorage,t.options,this.logger,this.performanceClient,this.authCodeRequest.correlationId)];case 1:return i=o.sent(),this.authModule.updateAuthority(i),[2]}})})},n.prototype.checkCcsCredentials=function(){var e=this.browserStorage.getTemporaryCache(kr.CCS_CREDENTIAL,!0);if(e)try{return JSON.parse(e)}catch{this.authModule.logger.error("Cache credential could not be parsed"),this.authModule.logger.errorPii("Cache credential could not be parsed: "+e)}return null},n}(),t5=function(n){function e(t,r,i,o,a,l){return t=n.call(this,t,r,i,o,l)||this,t.browserCrypto=a,t}return ia(e,n),e.prototype.initiateAuthRequest=function(t,r){return ft(this,void 0,void 0,function(){var i;return pt(this,function(o){switch(o.label){case 0:return this.logger.verbose("RedirectHandler.initiateAuthRequest called"),Zt.isEmpty(t)?[3,7]:(r.redirectStartPage&&(this.logger.verbose("RedirectHandler.initiateAuthRequest: redirectStartPage set, caching start page"),this.browserStorage.setTemporaryCache(kr.ORIGIN_URI,r.redirectStartPage,!0)),this.browserStorage.setTemporaryCache(kr.CORRELATION_ID,this.authCodeRequest.correlationId,!0),this.browserStorage.cacheCodeRequest(this.authCodeRequest,this.browserCrypto),this.logger.infoPii("RedirectHandler.initiateAuthRequest: Navigate to: "+t),i={apiId:_i.acquireTokenRedirect,timeout:r.redirectTimeout,noHistory:!1},typeof r.onRedirectNavigate!="function"?[3,4]:(this.logger.verbose("RedirectHandler.initiateAuthRequest: Invoking onRedirectNavigate callback"),r.onRedirectNavigate(t)===!1?[3,2]:(this.logger.verbose("RedirectHandler.initiateAuthRequest: onRedirectNavigate did not return false, navigating"),[4,r.navigationClient.navigateExternal(t,i)])));case 1:return o.sent(),[2];case 2:return this.logger.verbose("RedirectHandler.initiateAuthRequest: onRedirectNavigate returned false, stopping navigation"),[2];case 3:return[3,6];case 4:return this.logger.verbose("RedirectHandler.initiateAuthRequest: Navigating window to navigate url"),[4,r.navigationClient.navigateExternal(t,i)];case 5:return o.sent(),[2];case 6:return[3,8];case 7:throw this.logger.info("RedirectHandler.initiateAuthRequest: Navigate url is empty"),Ht.createEmptyNavigationUriError();case 8:return[2]}})})},e.prototype.handleCodeResponseFromHash=function(t,r,i,o){return ft(this,void 0,void 0,function(){var a,l,h,p;return pt(this,function(g){switch(g.label){case 0:if(this.logger.verbose("RedirectHandler.handleCodeResponse called"),Zt.isEmpty(t))throw Ht.createEmptyHashError(t);if(this.browserStorage.setInteractionInProgress(!1),a=this.browserStorage.generateStateKey(r),!(a=this.browserStorage.getTemporaryCache(a)))throw tn.createStateNotFoundError("Cached State");try{l=this.authModule.handleFragmentResponse(t,a)}catch(_){throw _ instanceof Jf&&_.subError===Pt.userCancelledError.code?Ht.createUserCancelledError():_}return h=this.browserStorage.generateNonceKey(a),h=this.browserStorage.getTemporaryCache(h),this.authCodeRequest.code=l.code,l.cloud_instance_host_name?[4,this.updateTokenEndpointAuthority(l.cloud_instance_host_name,i,o)]:[3,2];case 1:g.sent(),g.label=2;case 2:return l.nonce=h||void 0,l.state=a,l.client_info?this.authCodeRequest.clientInfo=l.client_info:(p=this.checkCcsCredentials())&&(this.authCodeRequest.ccsCredential=p),[4,this.authModule.acquireToken(this.authCodeRequest,l)];case 3:return p=g.sent(),this.browserStorage.cleanRequestByState(r),[2,p]}})})},e}(uk),vv=(function(n){n.INITIALIZE_START="msal:initializeStart",n.INITIALIZE_END="msal:initializeEnd",n.ACCOUNT_ADDED="msal:accountAdded",n.ACCOUNT_REMOVED="msal:accountRemoved",n.LOGIN_START="msal:loginStart",n.LOGIN_SUCCESS="msal:loginSuccess",n.LOGIN_FAILURE="msal:loginFailure",n.ACQUIRE_TOKEN_START="msal:acquireTokenStart",n.ACQUIRE_TOKEN_SUCCESS="msal:acquireTokenSuccess",n.ACQUIRE_TOKEN_FAILURE="msal:acquireTokenFailure",n.ACQUIRE_TOKEN_NETWORK_START="msal:acquireTokenFromNetworkStart",n.SSO_SILENT_START="msal:ssoSilentStart",n.SSO_SILENT_SUCCESS="msal:ssoSilentSuccess",n.SSO_SILENT_FAILURE="msal:ssoSilentFailure",n.ACQUIRE_TOKEN_BY_CODE_START="msal:acquireTokenByCodeStart",n.ACQUIRE_TOKEN_BY_CODE_SUCCESS="msal:acquireTokenByCodeSuccess",n.ACQUIRE_TOKEN_BY_CODE_FAILURE="msal:acquireTokenByCodeFailure",n.HANDLE_REDIRECT_START="msal:handleRedirectStart",n.HANDLE_REDIRECT_END="msal:handleRedirectEnd",n.POPUP_OPENED="msal:popupOpened",n.LOGOUT_START="msal:logoutStart",n.LOGOUT_SUCCESS="msal:logoutSuccess",n.LOGOUT_FAILURE="msal:logoutFailure",n.LOGOUT_END="msal:logoutEnd",n.RESTORE_FROM_BFCACHE="msal:restoreFromBFCache"}(Bn=Bn||{}),function(n){n.USER_INTERACTION_REQUIRED="USER_INTERACTION_REQUIRED",n.USER_CANCEL="USER_CANCEL",n.NO_NETWORK="NO_NETWORK",n.TRANSIENT_ERROR="TRANSIENT_ERROR",n.PERSISTENT_ERROR="PERSISTENT_ERROR",n.DISABLED="DISABLED",n.ACCOUNT_UNAVAILABLE="ACCOUNT_UNAVAILABLE"}(Rh=Rh||{}),{extensionError:{code:"ContentError"},userSwitch:{code:"user_switch",desc:"User attempted to switch accounts in the native broker, which is not allowed. All new accounts must sign-in through the standard web flow first, please try again."},tokensNotFoundInCache:{code:"tokens_not_found_in_internal_memory_cache",desc:"Tokens not cached in MSAL JS internal memory, please make the WAM request"}}),pl=function(n){function e(t,r,i){return t=n.call(this,t,r)||this,Object.setPrototypeOf(t,e.prototype),t.name="NativeAuthError",t.ext=i,t}return ia(e,n),e.prototype.isFatal=function(){return!(!this.ext||!this.ext.status||this.ext.status!==Rh.PERSISTENT_ERROR&&this.ext.status!==Rh.DISABLED)||this.errorCode===vv.extensionError.code},e.createError=function(t,r,i){if(i&&i.status)switch(i.status){case Rh.ACCOUNT_UNAVAILABLE:return rc.createNativeAccountUnavailableError();case Rh.USER_INTERACTION_REQUIRED:return new rc(t,r);case Rh.USER_CANCEL:return Ht.createUserCancelledError();case Rh.NO_NETWORK:return Ht.createNoNetworkConnectivityError()}return new e(t,r,i)},e.createUserSwitchError=function(){return new e(vv.userSwitch.code,vv.userSwitch.desc)},e.createTokensNotFoundInCacheError=function(){return new e(vv.tokensNotFoundInCache.code,vv.tokensNotFoundInCache.desc)},e}(xn),BV=function(n){function e(){return n!==null&&n.apply(this,arguments)||this}return ia(e,n),e.prototype.acquireToken=function(t){return ft(this,void 0,void 0,function(){var r,i,o,a;return pt(this,function(l){switch(l.label){case 0:return r=this.performanceClient.startMeasurement(nt.SilentCacheClientAcquireToken,t.correlationId),o=this.initializeServerTelemetryManager(_i.acquireTokenSilent_silentFlow),[4,this.createSilentFlowClient(o,t.authority,t.azureCloudOptions)];case 1:i=l.sent(),this.logger.verbose("Silent auth client created"),l.label=2;case 2:return l.trys.push([2,4,,5]),[4,i.acquireCachedToken(t)];case 3:return o=l.sent(),r.endMeasurement({success:!0,fromCache:!0}),[2,o];case 4:throw(a=l.sent())instanceof Ht&&a.errorCode===Pt.signingKeyNotFoundInStorage.code&&this.logger.verbose("Signing keypair for bound access token not found. Refreshing bound access token and generating a new crypto keypair."),r.endMeasurement({errorCode:a instanceof xn&&a.errorCode||void 0,subErrorCode:a instanceof xn&&a.subError||void 0,success:!1}),a;case 5:return[2]}})})},e.prototype.logout=function(){return Promise.reject(Ht.createSilentLogoutUnsupportedError())},e.prototype.createSilentFlowClient=function(t,r,i){return ft(this,void 0,void 0,function(){var o;return pt(this,function(a){switch(a.label){case 0:return this.performanceClient.setPreQueueTime(nt.StandardInteractionClientGetClientConfiguration,this.correlationId),[4,this.getClientConfiguration(t,r,i)];case 1:return o=a.sent(),[2,new mEe(o,this.performanceClient)]}})})},e.prototype.initializeSilentRequest=function(t,r){return ft(this,void 0,void 0,function(){var i;return pt(this,function(o){switch(o.label){case 0:return this.performanceClient.addQueueMeasurement(nt.InitializeSilentRequest,this.correlationId),this.performanceClient.setPreQueueTime(nt.InitializeBaseRequest,this.correlationId),i=[bn({},t)],[4,this.initializeBaseRequest(t,r)];case 1:return[2,bn.apply(void 0,[bn.apply(void 0,i.concat([o.sent()])),{account:r,forceRefresh:t.forceRefresh||!1}])]}})})},e}(Sy),Bm=function(n){function e(t,r,i,o,a,l,h,p,g,_,x,C){return r=n.call(this,t,r,i,o,a,l,p,g,C)||this,r.apiId=h,r.accountId=_,r.nativeMessageHandler=g,r.nativeStorageManager=x,r.silentCacheClient=new BV(t,r.nativeStorageManager,i,o,a,l,p,g,C),r}return ia(e,n),e.prototype.acquireToken=function(t){return ft(this,void 0,void 0,function(){var r,i,o,a,l;return pt(this,function(h){switch(h.label){case 0:return this.logger.trace("NativeInteractionClient - acquireToken called."),r=this.performanceClient.startMeasurement(nt.NativeInteractionClientAcquireToken,t.correlationId),i=ac.nowSeconds(),[4,this.initializeNativeRequest(t)];case 1:o=h.sent(),h.label=2;case 2:return h.trys.push([2,4,,5]),[4,this.acquireTokensFromCache(this.accountId,o)];case 3:return a=h.sent(),r.endMeasurement({success:!0,isNativeBroker:!1,fromCache:!0}),[2,a];case 4:return h.sent(),this.logger.info("MSAL internal Cache does not contain tokens, proceed to make a native call"),[3,5];case 5:return a={method:lu.GetToken,request:o},[4,this.nativeMessageHandler.sendMessage(a)];case 6:return l=h.sent(),l=this.validateNativeResponse(l),[2,this.handleNativeResponse(l,o,i).then(function(p){return r.endMeasurement({success:!0,isNativeBroker:!0,requestId:p.requestId}),p}).catch(function(p){throw r.endMeasurement({success:!1,errorCode:p.errorCode,subErrorCode:p.subError,isNativeBroker:!0}),p})]}})})},e.prototype.createSilentCacheRequest=function(t,r){return{authority:t.authority,correlationId:this.correlationId,scopes:pa.fromString(t.scope).asArray(),account:r,forceRefresh:!1}},e.prototype.acquireTokensFromCache=function(t,r){return ft(this,void 0,void 0,function(){var i,o;return pt(this,function(a){switch(a.label){case 0:if(!t)throw this.logger.warning("NativeInteractionClient:acquireTokensFromCache - No nativeAccountId provided"),tn.createNoAccountFoundError();if(!(i=this.browserStorage.getAccountInfoFilteredBy({nativeAccountId:t})))throw tn.createNoAccountFoundError();a.label=1;case 1:return a.trys.push([1,3,,4]),o=this.createSilentCacheRequest(r,i),[4,this.silentCacheClient.acquireToken(o)];case 2:return[2,a.sent()];case 3:throw a.sent();case 4:return[2]}})})},e.prototype.acquireTokenRedirect=function(t){return ft(this,void 0,void 0,function(){var r,i,o,a,l;return pt(this,function(h){switch(h.label){case 0:return this.logger.trace("NativeInteractionClient - acquireTokenRedirect called."),[4,this.initializeNativeRequest(t)];case 1:r=h.sent(),i={method:lu.GetToken,request:r},h.label=2;case 2:return h.trys.push([2,4,,5]),[4,this.nativeMessageHandler.sendMessage(i)];case 3:return o=h.sent(),this.validateNativeResponse(o),[3,5];case 4:if((o=h.sent())instanceof pl&&o.isFatal())throw o;return[3,5];case 5:return this.browserStorage.setTemporaryCache(kr.NATIVE_REQUEST,JSON.stringify(r),!0),a={apiId:_i.acquireTokenRedirect,timeout:this.config.system.redirectNavigationTimeout,noHistory:!1},l=this.config.auth.navigateToLoginRequestUrl?window.location.href:this.getRedirectUri(t.redirectUri),[4,this.navigationClient.navigateExternal(l,a)];case 6:return h.sent(),[2]}})})},e.prototype.handleRedirectPromise=function(){return ft(this,void 0,void 0,function(){var t,r,i,o;return pt(this,function(a){switch(a.label){case 0:if(this.logger.trace("NativeInteractionClient - handleRedirectPromise called."),!this.browserStorage.isInteractionInProgress(!0))return this.logger.info("handleRedirectPromise called but there is no interaction in progress, returning null."),[2,null];if(!(t=this.browserStorage.getCachedNativeRequest()))return this.logger.verbose("NativeInteractionClient - handleRedirectPromise called but there is no cached request, returning null."),[2,null];r=t.prompt,t=jF(t,["prompt"]),r&&this.logger.verbose("NativeInteractionClient - handleRedirectPromise called and prompt was included in the original request, removing prompt from cached request to prevent second interaction with native broker window."),this.browserStorage.removeItem(this.browserStorage.generateCacheKey(kr.NATIVE_REQUEST)),r={method:lu.GetToken,request:t},i=ac.nowSeconds(),a.label=1;case 1:return a.trys.push([1,3,,4]),this.logger.verbose("NativeInteractionClient - handleRedirectPromise sending message to native broker."),[4,this.nativeMessageHandler.sendMessage(r)];case 2:return o=a.sent(),this.validateNativeResponse(o),o=this.handleNativeResponse(o,t,i),this.browserStorage.setInteractionInProgress(!1),[2,o];case 3:throw o=a.sent(),this.browserStorage.setInteractionInProgress(!1),o;case 4:return[2]}})})},e.prototype.logout=function(){return this.logger.trace("NativeInteractionClient - logout called."),Promise.reject("Logout not implemented yet")},e.prototype.handleNativeResponse=function(t,r,i){return ft(this,void 0,void 0,function(){var o,a,l,h;return pt(this,function(p){switch(p.label){case 0:if(this.logger.trace("NativeInteractionClient - handleNativeResponse called."),t.account.id!==r.accountId)throw pl.createUserSwitchError();return[4,this.getDiscoveredAuthority(r.authority)];case 1:return h=p.sent(),l=h.getPreferredCache(),o=this.createIdTokenObj(t),a=this.createHomeAccountIdentifier(t,o),l=this.createAccountEntity(t,a,o,l),[4,this.generateAuthenticationResult(t,r,o,l,h.canonicalAuthority,i)];case 2:return h=p.sent(),this.cacheAccount(l),this.cacheNativeTokens(t,r,a,l,o,h.accessToken,h.tenantId,i),[2,h]}})})},e.prototype.createIdTokenObj=function(t){return new Pl(t.id_token||Ne.EMPTY_STRING,this.browserCrypto)},e.prototype.createHomeAccountIdentifier=function(t,r){return Qo.generateHomeAccountId(t.client_info||Ne.EMPTY_STRING,Pa.Default,this.logger,this.browserCrypto,r)},e.prototype.createAccountEntity=function(t,r,i,o){return Qo.createAccount(t.client_info,r,i,void 0,void 0,void 0,o,t.account.id)},e.prototype.generateScopes=function(t,r){return t.scope?pa.fromString(t.scope):pa.fromString(r.scope)},e.prototype.generatePopAccessToken=function(t,r){return ft(this,void 0,void 0,function(){var i,o;return pt(this,function(a){switch(a.label){case 0:if(r.tokenType!==Kr.POP)return[3,2];if(t.shr)return this.logger.trace("handleNativeServerResponse: SHR is enabled in native layer"),[2,t.shr];if(i=new ly(this.browserCrypto),o={resourceRequestMethod:r.resourceRequestMethod,resourceRequestUri:r.resourceRequestUri,shrClaims:r.shrClaims,shrNonce:r.shrNonce},r.keyId)return[4,i.signPopToken(t.access_token,r.keyId,o)];throw tn.createKeyIdMissingError();case 1:return[2,a.sent()];case 2:return[2,t.access_token]}})})},e.prototype.generateAuthenticationResult=function(t,r,i,o,a,l){return ft(this,void 0,void 0,function(){var h,p,g,_,x,C;return pt(this,function(M){switch(M.label){case 0:return h=this.addTelemetryFromNativeResponse(t),p=t.scope?pa.fromString(t.scope):pa.fromString(r.scope),_=t.account.properties||{},g=_.UID||i.claims.oid||i.claims.sub||Ne.EMPTY_STRING,_=_.TenantId||i.claims.tid||Ne.EMPTY_STRING,[4,this.generatePopAccessToken(t,r)];case 1:return x=M.sent(),C=r.tokenType===Kr.POP?Kr.POP:Kr.BEARER,[2,{authority:a,uniqueId:g,tenantId:_,scopes:p.asArray(),account:o.getAccountInfo(),idToken:t.id_token,idTokenClaims:i.claims,accessToken:x,fromCache:!!h&&this.isResponseFromCache(h),expiresOn:new Date(1e3*Number(l+t.expires_in)),tokenType:C,correlationId:this.correlationId,state:t.state,fromNativeBroker:!0}]}})})},e.prototype.cacheAccount=function(t){var r=this;this.browserStorage.setAccount(t),this.browserStorage.removeAccountContext(t).catch(function(i){r.logger.error("Error occurred while removing account context from browser storage. "+i)})},e.prototype.cacheNativeTokens=function(x,r,C,o,a,M,h,_){var g=Ef.createIdTokenEntity(C,r.authority,x.id_token||Ne.EMPTY_STRING,r.clientId,a.claims.tid||Ne.EMPTY_STRING),_=_+(r.tokenType===Kr.POP?Ne.SHR_NONCE_VALIDITY:(typeof x.expires_in=="string"?parseInt(x.expires_in,10):x.expires_in)||0),x=this.generateScopes(x,r),C=Tf.createAccessTokenEntity(C,r.authority,M,r.clientId,a?a.claims.tid||Ne.EMPTY_STRING:h,x.printScopes(),_,0,this.browserCrypto),M=new HE(o,g,C);this.nativeStorageManager.saveCacheRecord(M)},e.prototype.addTelemetryFromNativeResponse=function(t){return t=this.getMATSFromResponse(t),t?(this.performanceClient.addStaticFields({extensionId:this.nativeMessageHandler.getExtensionId(),extensionVersion:this.nativeMessageHandler.getExtensionVersion(),matsBrokerVersion:t.broker_version,matsAccountJoinOnStart:t.account_join_on_start,matsAccountJoinOnEnd:t.account_join_on_end,matsDeviceJoin:t.device_join,matsPromptBehavior:t.prompt_behavior,matsApiErrorCode:t.api_error_code,matsUiVisible:t.ui_visible,matsSilentCode:t.silent_code,matsSilentBiSubCode:t.silent_bi_sub_code,matsSilentMessage:t.silent_message,matsSilentStatus:t.silent_status,matsHttpStatus:t.http_status,matsHttpEventCount:t.http_event_count},this.correlationId),t):null},e.prototype.validateNativeResponse=function(t){if(t.hasOwnProperty("access_token")&&t.hasOwnProperty("id_token")&&t.hasOwnProperty("client_info")&&t.hasOwnProperty("account")&&t.hasOwnProperty("scope")&&t.hasOwnProperty("expires_in"))return t;throw pl.createUnexpectedError("Response missing expected properties.")},e.prototype.getMATSFromResponse=function(t){if(t.properties.MATS)try{return JSON.parse(t.properties.MATS)}catch{this.logger.error("NativeInteractionClient - Error parsing MATS telemetry, returning null instead")}return null},e.prototype.isResponseFromCache=function(t){return t.is_cached===void 0?(this.logger.verbose("NativeInteractionClient - MATS telemetry does not contain field indicating if response was served from cache. Returning false."),!1):!!t.is_cached},e.prototype.initializeNativeRequest=function(t){return ft(this,void 0,void 0,function(){var r,i,o,a,l,h=this;return pt(this,function(p){switch(p.label){case 0:return this.logger.trace("NativeInteractionClient - initializeNativeRequest called"),r=t.authority||this.config.auth.authority,t.account?[4,this.validateRequestAuthority(r,t.account)]:[3,2];case 1:p.sent(),p.label=2;case 2:return(a=new xr(r)).validateAsUri(),l=t.scopes,o=jF(t,["scopes"]),(l=new pa(l||[])).appendScopes(Eb),i=function(){switch(h.apiId){case _i.ssoSilent:case _i.acquireTokenSilent_silentFlow:return h.logger.trace("initializeNativeRequest: silent request sets prompt to none"),ya.NONE}if(t.prompt)switch(t.prompt){case ya.NONE:case ya.CONSENT:case ya.LOGIN:return h.logger.trace("initializeNativeRequest: prompt is compatible with native flow"),t.prompt;default:throw h.logger.trace("initializeNativeRequest: prompt = "+t.prompt+" is not compatible with native flow"),Ht.createNativePromptParameterNotSupportedError()}else h.logger.trace("initializeNativeRequest: prompt was not provided")},o=bn(bn({},o),{accountId:this.accountId,clientId:this.config.auth.clientId,authority:a.urlString,scope:l.printScopes(),redirectUri:this.getRedirectUri(t.redirectUri),prompt:i(),correlationId:this.correlationId,tokenType:t.authenticationScheme,windowTitleSubstring:document.title,extraParameters:bn(bn(bn({},t.extraQueryParameters),t.tokenQueryParameters),{telemetry:Dv.MATS_TELEMETRY}),extendedExpiryToken:!1}),t.authenticationScheme!==Kr.POP?[3,4]:(a={resourceRequestUri:t.resourceRequestUri,resourceRequestMethod:t.resourceRequestMethod,shrClaims:t.shrClaims,shrNonce:t.shrNonce},[4,new ly(this.browserCrypto).generateCnf(a)]);case 3:l=p.sent(),o.reqCnf=l.reqCnfString,o.keyId=l.kid,p.label=4;case 4:return[2,o]}})})},e}(FV),Uf=function(){function n(e,t,r,i){this.logger=e,this.handshakeTimeoutMs=t,this.extensionId=i,this.resolvers=new Map,this.handshakeResolvers=new Map,this.responseId=0,this.messageChannel=new MessageChannel,this.windowListener=this.onWindowMessage.bind(this),this.performanceClient=r,this.handshakeEvent=r.startMeasurement(nt.NativeMessageHandlerHandshake)}return n.prototype.sendMessage=function(e){return ft(this,void 0,void 0,function(){var t,r=this;return pt(this,function(i){return this.logger.trace("NativeMessageHandler - sendMessage called."),t={channel:Dv.CHANNEL_ID,extensionId:this.extensionId,responseId:this.responseId++,body:e},this.logger.trace("NativeMessageHandler - Sending request to browser extension"),this.logger.tracePii("NativeMessageHandler - Sending request to browser extension: "+JSON.stringify(t)),this.messageChannel.port1.postMessage(t),[2,new Promise(function(o,a){r.resolvers.set(t.responseId,{resolve:o,reject:a})})]})})},n.createProvider=function(e,t,r){return ft(this,void 0,void 0,function(){var i,o;return pt(this,function(a){switch(a.label){case 0:e.trace("NativeMessageHandler - createProvider called."),a.label=1;case 1:return a.trys.push([1,3,,5]),[4,(i=new n(e,t,r,Dv.PREFERRED_EXTENSION_ID)).sendHandshakeRequest()];case 2:return a.sent(),[2,i];case 3:return a.sent(),[4,(o=new n(e,t,r)).sendHandshakeRequest()];case 4:return a.sent(),[2,o];case 5:return[2]}})})},n.prototype.sendHandshakeRequest=function(){return ft(this,void 0,void 0,function(){var e,t=this;return pt(this,function(r){return this.logger.trace("NativeMessageHandler - sendHandshakeRequest called."),window.addEventListener("message",this.windowListener,!1),e={channel:Dv.CHANNEL_ID,extensionId:this.extensionId,responseId:this.responseId++,body:{method:lu.HandshakeRequest}},this.handshakeEvent.addStaticFields({extensionId:this.extensionId,extensionHandshakeTimeoutMs:this.handshakeTimeoutMs}),this.messageChannel.port1.onmessage=function(i){t.onChannelMessage(i)},window.postMessage(e,window.origin,[this.messageChannel.port2]),[2,new Promise(function(i,o){t.handshakeResolvers.set(e.responseId,{resolve:i,reject:o}),t.timeoutId=window.setTimeout(function(){window.removeEventListener("message",t.windowListener,!1),t.messageChannel.port1.close(),t.messageChannel.port2.close(),t.handshakeEvent.endMeasurement({extensionHandshakeTimedOut:!0,success:!1}),o(Ht.createNativeHandshakeTimeoutError()),t.handshakeResolvers.delete(e.responseId)},t.handshakeTimeoutMs)})]})})},n.prototype.onWindowMessage=function(e){this.logger.trace("NativeMessageHandler - onWindowMessage called"),e.source!==window||!(e=e.data).channel||e.channel!==Dv.CHANNEL_ID||e.extensionId&&e.extensionId!==this.extensionId||e.body.method===lu.HandshakeRequest&&(this.logger.verbose(e.extensionId?"Extension with id: "+e.extensionId+" not installed":"No extension installed"),clearTimeout(this.timeoutId),this.messageChannel.port1.close(),this.messageChannel.port2.close(),window.removeEventListener("message",this.windowListener,!1),e=this.handshakeResolvers.get(e.responseId))&&(this.handshakeEvent.endMeasurement({success:!1,extensionInstalled:!1}),e.reject(Ht.createNativeExtensionNotInstalledError()))},n.prototype.onChannelMessage=function(e){this.logger.trace("NativeMessageHandler - onChannelMessage called.");var t=e.data,r=this.resolvers.get(t.responseId),i=this.handshakeResolvers.get(t.responseId);try{var o=t.body.method;if(o===lu.Response){if(r){var a=t.body.response;if(this.logger.trace("NativeMessageHandler - Received response from browser extension"),this.logger.tracePii("NativeMessageHandler - Received response from browser extension: "+JSON.stringify(a)),a.status!=="Success")r.reject(pl.createError(a.code,a.description,a.ext));else{if(!a.result)throw xn.createUnexpectedError("Event does not contain result.");a.result.code&&a.result.description?r.reject(pl.createError(a.result.code,a.result.description,a.result.ext)):r.resolve(a.result)}this.resolvers.delete(t.responseId)}}else o===lu.HandshakeResponse&&i&&(clearTimeout(this.timeoutId),window.removeEventListener("message",this.windowListener,!1),this.extensionId=t.extensionId,this.extensionVersion=t.body.version,this.logger.verbose("NativeMessageHandler - Received HandshakeResponse from extension: "+this.extensionId),this.handshakeEvent.endMeasurement({extensionInstalled:!0,success:!0}),i.resolve(),this.handshakeResolvers.delete(t.responseId))}catch(l){this.logger.error("Error parsing response from WAM Extension"),this.logger.errorPii("Error parsing response from WAM Extension: "+l.toString()),this.logger.errorPii("Unable to parse "+e),r?r.reject(l):i&&i.reject(l)}},n.prototype.getExtensionId=function(){return this.extensionId},n.prototype.getExtensionVersion=function(){return this.extensionVersion},n.isNativeAvailable=function(e,t,r,i){if(t.trace("isNativeAvailable called"),!e.system.allowNativeBroker)return t.trace("isNativeAvailable: allowNativeBroker is not enabled, returning false"),!1;if(!r)return t.trace("isNativeAvailable: WAM extension provider is not initialized, returning false"),!1;if(i)switch(i){case Kr.BEARER:case Kr.POP:return t.trace("isNativeAvailable: authenticationScheme is supported, returning true"),!0;default:return t.trace("isNativeAvailable: authenticationScheme is not supported, returning false"),!1}return!0},n}(),MEe=function(n){function e(t,r,i,o,a,l,h,p,g,_){return t=n.call(this,t,r,i,o,a,l,h,g,_)||this,t.nativeStorage=p,t}return ia(e,n),e.prototype.acquireToken=function(t){return ft(this,void 0,void 0,function(){var r,i,o,a,l,h,p,g=this;return pt(this,function(_){switch(_.label){case 0:return this.performanceClient.setPreQueueTime(nt.StandardInteractionClientInitializeAuthorizationRequest,t.correlationId),[4,this.initializeAuthorizationRequest(t,gn.Redirect)];case 1:r=_.sent(),this.browserStorage.updateCacheEntries(r.state,r.nonce,r.authority,r.loginHint||Ne.EMPTY_STRING,r.account||null),i=this.initializeServerTelemetryManager(_i.acquireTokenRedirect),o=function(x){x.persisted&&(g.logger.verbose("Page was restored from back/forward cache. Clearing temporary cache."),g.browserStorage.cleanRequestByState(r.state),g.eventHandler.emitEvent(Bn.RESTORE_FROM_BFCACHE,gn.Redirect))},_.label=2;case 2:return _.trys.push([2,7,,8]),this.performanceClient.setPreQueueTime(nt.StandardInteractionClientInitializeAuthorizationCodeRequest,t.correlationId),[4,this.initializeAuthorizationCodeRequest(r)];case 3:return a=_.sent(),this.performanceClient.setPreQueueTime(nt.StandardInteractionClientCreateAuthCodeClient,t.correlationId),[4,this.createAuthCodeClient(i,r.authority,r.azureCloudOptions)];case 4:return h=_.sent(),this.logger.verbose("Auth code client created"),l=new t5(h,this.browserStorage,a,this.logger,this.browserCrypto,this.performanceClient),[4,h.getAuthCodeUrl(bn(bn({},r),{nativeBroker:Uf.isNativeAvailable(this.config,this.logger,this.nativeMessageHandler,t.authenticationScheme)}))];case 5:return h=_.sent(),p=this.getRedirectStartPage(t.redirectStartPage),this.logger.verbosePii("Redirect start page: "+p),window.addEventListener("pageshow",o),[4,l.initiateAuthRequest(h,{navigationClient:this.navigationClient,redirectTimeout:this.config.system.redirectNavigationTimeout,redirectStartPage:p,onRedirectNavigate:t.onRedirectNavigate})];case 6:return[2,_.sent()];case 7:throw(p=_.sent())instanceof xn&&p.setCorrelationId(this.correlationId),window.removeEventListener("pageshow",o),i.cacheFailedRequest(p),this.browserStorage.cleanRequestByState(r.state),p;case 8:return[2]}})})},e.prototype.handleRedirectPromise=function(t){return ft(this,void 0,void 0,function(){var r,i,o,a,l,h,p,g,_,x;return pt(this,function(C){switch(C.label){case 0:r=this.initializeServerTelemetryManager(_i.handleRedirectPromise),C.label=1;case 1:if(C.trys.push([1,10,,11]),!this.browserStorage.isInteractionInProgress(!0))return this.logger.info("handleRedirectPromise called but there is no interaction in progress, returning null."),[2,null];if(!(i=this.getRedirectResponseHash(t||window.location.hash)))return this.logger.info("handleRedirectPromise did not detect a response hash as a result of a redirect. Cleaning temporary cache."),this.browserStorage.cleanRequestByInteractionType(gn.Redirect),[2,null];o=void 0;try{a=xr.getDeserializedHash(i),o=this.validateAndExtractStateFromHash(a,gn.Redirect),this.logger.verbose("State extracted from hash")}catch(M){return this.logger.info("handleRedirectPromise was unable to extract state due to: "+M),this.browserStorage.cleanRequestByInteractionType(gn.Redirect),[2,null]}return l=this.browserStorage.getTemporaryCache(kr.ORIGIN_URI,!0)||Ne.EMPTY_STRING,h=xr.removeHashFromUrl(l),_=xr.removeHashFromUrl(window.location.href),h===_&&this.config.auth.navigateToLoginRequestUrl?(this.logger.verbose("Current page is loginRequestUrl, handling hash"),[4,this.handleHash(i,o,r)]):[3,3];case 2:return h=C.sent(),-1<l.indexOf("#")&&Yi.replaceHash(l),[2,h];case 3:return this.config.auth.navigateToLoginRequestUrl?[3,4]:(this.logger.verbose("NavigateToLoginRequestUrl set to false, handling hash"),[2,this.handleHash(i,o,r)]);case 4:return Yi.isInIframe()&&!this.config.system.allowRedirectInIframe?[3,9]:(this.browserStorage.setTemporaryCache(kr.URL_HASH,i,!0),p={apiId:_i.handleRedirectPromise,timeout:this.config.system.redirectNavigationTimeout,noHistory:!0},g=!0,l&&l!=="null"?[3,6]:(_=Yi.getHomepage(),this.browserStorage.setTemporaryCache(kr.ORIGIN_URI,_,!0),this.logger.warning("Unable to get valid login request url from cache, redirecting to home page"),[4,this.navigationClient.navigateInternal(_,p)]));case 5:return g=C.sent(),[3,8];case 6:return this.logger.verbose("Navigating to loginRequestUrl: "+l),[4,this.navigationClient.navigateInternal(l,p)];case 7:g=C.sent(),C.label=8;case 8:if(!g)return[2,this.handleHash(i,o,r)];C.label=9;case 9:return[2,null];case 10:throw(x=C.sent())instanceof xn&&x.setCorrelationId(this.correlationId),r.cacheFailedRequest(x),this.browserStorage.cleanRequestByInteractionType(gn.Redirect),x;case 11:return[2]}})})},e.prototype.getRedirectResponseHash=function(t){return this.logger.verbose("getRedirectResponseHash called"),xr.hashContainsKnownProperties(t)?(Yi.clearHash(window),this.logger.verbose("Hash contains known properties, returning response hash")):(t=this.browserStorage.getTemporaryCache(kr.URL_HASH,!0),this.browserStorage.removeItem(this.browserStorage.generateCacheKey(kr.URL_HASH)),this.logger.verbose("Hash does not contain known properties, returning cached hash")),t},e.prototype.handleHash=function(t,r,i){return ft(this,void 0,void 0,function(){var o,a,l,h=this;return pt(this,function(p){switch(p.label){case 0:if(o=this.browserStorage.getCachedRequest(r,this.browserCrypto),this.logger.verbose("handleHash called, retrieved cached request"),(a=xr.getDeserializedHash(t)).accountId){if(this.logger.verbose("Account id found in hash, calling WAM for token"),this.nativeMessageHandler)return a=new Bm(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,_i.acquireTokenPopup,this.performanceClient,this.nativeMessageHandler,a.accountId,this.nativeStorage,o.correlationId),l=yu.parseRequestState(this.browserCrypto,r).userRequestState,[2,a.acquireToken(bn(bn({},o),{state:l,prompt:void 0})).finally(function(){h.browserStorage.cleanRequestByState(r)})];throw Ht.createNativeConnectionNotEstablishedError()}if(a=this.browserStorage.getCachedAuthority(r))return this.performanceClient.setPreQueueTime(nt.StandardInteractionClientCreateAuthCodeClient,o.correlationId),[4,this.createAuthCodeClient(i,a)];throw Ht.createNoCachedAuthorityError();case 1:return l=p.sent(),this.logger.verbose("Auth code client created"),VE.removeThrottle(this.browserStorage,this.config.auth.clientId,o),[4,new t5(l,this.browserStorage,o,this.logger,this.browserCrypto,this.performanceClient).handleCodeResponseFromHash(t,r,l.authority,this.networkClient)];case 2:return[2,p.sent()]}})})},e.prototype.logout=function(t){return ft(this,void 0,void 0,function(){var r,i,o,a,l;return pt(this,function(h){switch(h.label){case 0:this.logger.verbose("logoutRedirect called"),r=this.initializeLogoutRequest(t),i=this.initializeServerTelemetryManager(_i.logout),h.label=1;case 1:return h.trys.push([1,10,,11]),this.eventHandler.emitEvent(Bn.LOGOUT_START,gn.Redirect,t),[4,this.clearCacheOnLogout(r.account)];case 2:return h.sent(),o={apiId:_i.logout,timeout:this.config.system.redirectNavigationTimeout,noHistory:!1},this.performanceClient.setPreQueueTime(nt.StandardInteractionClientCreateAuthCodeClient,r.correlationId),[4,this.createAuthCodeClient(i,t&&t.authority)];case 3:return a=h.sent(),this.logger.verbose("Auth code client created"),a=a.getLogoutUri(r),this.eventHandler.emitEvent(Bn.LOGOUT_SUCCESS,gn.Redirect,r),t&&typeof t.onRedirectNavigate=="function"?t.onRedirectNavigate(a)===!1?[3,5]:(this.logger.verbose("Logout onRedirectNavigate did not return false, navigating"),this.browserStorage.getInteractionInProgress()||this.browserStorage.setInteractionInProgress(!0),[4,this.navigationClient.navigateExternal(a,o)]):[3,7];case 4:return h.sent(),[2];case 5:this.browserStorage.setInteractionInProgress(!1),this.logger.verbose("Logout onRedirectNavigate returned false, stopping navigation"),h.label=6;case 6:return[3,9];case 7:return this.browserStorage.getInteractionInProgress()||this.browserStorage.setInteractionInProgress(!0),[4,this.navigationClient.navigateExternal(a,o)];case 8:return h.sent(),[2];case 9:return[3,11];case 10:throw(l=h.sent())instanceof xn&&l.setCorrelationId(this.correlationId),i.cacheFailedRequest(l),this.eventHandler.emitEvent(Bn.LOGOUT_FAILURE,gn.Redirect,null,l),this.eventHandler.emitEvent(Bn.LOGOUT_END,gn.Redirect),l;case 11:return this.eventHandler.emitEvent(Bn.LOGOUT_END,gn.Redirect),[2]}})})},e.prototype.getRedirectStartPage=function(t){return t=t||window.location.href,xr.getAbsoluteUrl(t,Yi.getCurrentUri())},e}(Sy),REe=function(n){function e(t,r,i,o,a,l,h,p,g,_){return t=n.call(this,t,r,i,o,a,l,h,g,_)||this,t.unloadWindow=t.unloadWindow.bind(t),t.nativeStorage=p,t}return ia(e,n),e.prototype.acquireToken=function(t){try{var r,i=this.generatePopupName(t.scopes||Eb,t.authority||this.config.auth.authority),o=t.popupWindowAttributes||{};return this.config.system.asyncPopups?(this.logger.verbose("asyncPopups set to true, acquiring token"),this.acquireTokenPopupAsync(t,i,o)):(this.logger.verbose("asyncPopup set to false, opening popup before acquiring token"),r=this.openSizedPopup("about:blank",i,o),this.acquireTokenPopupAsync(t,i,o,r))}catch(a){return Promise.reject(a)}},e.prototype.logout=function(t){try{this.logger.verbose("logoutPopup called");var r,i=this.initializeLogoutRequest(t),o=this.generateLogoutPopupName(i),a=t&&t.authority,l=t&&t.mainWindowRedirectUri,h=(t==null?void 0:t.popupWindowAttributes)||{};return this.config.system.asyncPopups?(this.logger.verbose("asyncPopups set to true"),this.logoutPopupAsync(i,o,h,a,void 0,l)):(this.logger.verbose("asyncPopup set to false, opening popup"),r=this.openSizedPopup("about:blank",o,h),this.logoutPopupAsync(i,o,h,a,r,l))}catch(p){return Promise.reject(p)}},e.prototype.acquireTokenPopupAsync=function(t,r,i,o){return ft(this,void 0,void 0,function(){var a,l,h,p,g,_,x,C,M,L,D,z=this;return pt(this,function(te){switch(te.label){case 0:return this.logger.verbose("acquireTokenPopupAsync called"),a=this.initializeServerTelemetryManager(_i.acquireTokenPopup),this.performanceClient.setPreQueueTime(nt.StandardInteractionClientInitializeAuthorizationRequest,t.correlationId),[4,this.initializeAuthorizationRequest(t,gn.Popup)];case 1:l=te.sent(),this.browserStorage.updateCacheEntries(l.state,l.nonce,l.authority,l.loginHint||Ne.EMPTY_STRING,l.account||null),te.label=2;case 2:return te.trys.push([2,8,,9]),this.performanceClient.setPreQueueTime(nt.StandardInteractionClientInitializeAuthorizationCodeRequest,t.correlationId),[4,this.initializeAuthorizationCodeRequest(l)];case 3:return h=te.sent(),this.performanceClient.setPreQueueTime(nt.StandardInteractionClientCreateAuthCodeClient,t.correlationId),[4,this.createAuthCodeClient(a,l.authority,l.azureCloudOptions)];case 4:return p=te.sent(),this.logger.verbose("Auth code client created"),_=Uf.isNativeAvailable(this.config,this.logger,this.nativeMessageHandler,t.authenticationScheme),g=void 0,_&&(g=this.performanceClient.startMeasurement(nt.FetchAccountIdWithNativeBroker,t.correlationId)),[4,p.getAuthCodeUrl(bn(bn({},l),{nativeBroker:_}))];case 5:return _=te.sent(),x=new uk(p,this.browserStorage,h,this.logger,this.performanceClient),C={popup:o,popupName:r,popupWindowAttributes:i},C=this.initiateAuthRequest(_,C),this.eventHandler.emitEvent(Bn.POPUP_OPENED,gn.Popup,{popupWindow:C},null),[4,this.monitorPopupForHash(C)];case 6:if(C=te.sent(),D=xr.getDeserializedHash(C),M=this.validateAndExtractStateFromHash(D,gn.Popup,l.correlationId),VE.removeThrottle(this.browserStorage,this.config.auth.clientId,h),D.accountId){if(this.logger.verbose("Account id found in hash, calling WAM for token"),g&&g.endMeasurement({success:!0,isNativeBroker:!0}),this.nativeMessageHandler)return D=new Bm(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,_i.acquireTokenPopup,this.performanceClient,this.nativeMessageHandler,D.accountId,this.nativeStorage,l.correlationId),L=yu.parseRequestState(this.browserCrypto,M).userRequestState,[2,D.acquireToken(bn(bn({},l),{state:L,prompt:void 0})).finally(function(){z.browserStorage.cleanRequestByState(M)})];throw Ht.createNativeConnectionNotEstablishedError()}return[4,x.handleCodeResponseFromHash(C,M,p.authority,this.networkClient)];case 7:return[2,te.sent()];case 8:throw D=te.sent(),o&&o.close(),D instanceof xn&&D.setCorrelationId(this.correlationId),a.cacheFailedRequest(D),this.browserStorage.cleanRequestByState(l.state),D;case 9:return[2]}})})},e.prototype.logoutPopupAsync=function(t,r,i,o,a,l){return ft(this,void 0,void 0,function(){var h,p,g;return pt(this,function(_){switch(_.label){case 0:this.logger.verbose("logoutPopupAsync called"),this.eventHandler.emitEvent(Bn.LOGOUT_START,gn.Popup,t),h=this.initializeServerTelemetryManager(_i.logoutPopup),_.label=1;case 1:return _.trys.push([1,5,,6]),[4,this.clearCacheOnLogout(t.account)];case 2:return _.sent(),this.performanceClient.setPreQueueTime(nt.StandardInteractionClientCreateAuthCodeClient,t.correlationId),[4,this.createAuthCodeClient(h,o)];case 3:return p=_.sent(),this.logger.verbose("Auth code client created"),p=p.getLogoutUri(t),this.eventHandler.emitEvent(Bn.LOGOUT_SUCCESS,gn.Popup,t),p=this.openPopup(p,{popupName:r,popupWindowAttributes:i,popup:a}),this.eventHandler.emitEvent(Bn.POPUP_OPENED,gn.Popup,{popupWindow:p},null),[4,this.waitForLogoutPopup(p)];case 4:return _.sent(),l?(p={apiId:_i.logoutPopup,timeout:this.config.system.redirectNavigationTimeout,noHistory:!1},g=xr.getAbsoluteUrl(l,Yi.getCurrentUri()),this.logger.verbose("Redirecting main window to url specified in the request"),this.logger.verbosePii("Redirecting main window to: "+g),this.navigationClient.navigateInternal(g,p)):this.logger.verbose("No main window navigation requested"),[3,6];case 5:throw g=_.sent(),a&&a.close(),g instanceof xn&&g.setCorrelationId(this.correlationId),this.browserStorage.setInteractionInProgress(!1),this.eventHandler.emitEvent(Bn.LOGOUT_FAILURE,gn.Popup,null,g),this.eventHandler.emitEvent(Bn.LOGOUT_END,gn.Popup),h.cacheFailedRequest(g),g;case 6:return this.eventHandler.emitEvent(Bn.LOGOUT_END,gn.Popup),[2]}})})},e.prototype.initiateAuthRequest=function(t,r){if(Zt.isEmpty(t))throw this.logger.error("Navigate url is empty"),Ht.createEmptyNavigationUriError();return this.logger.infoPii("Navigate to: "+t),this.openPopup(t,r)},e.prototype.monitorPopupForHash=function(t){var r=this;return new Promise(function(i,o){var a=r.config.system.windowHashTimeout/r.config.system.pollIntervalMilliseconds,l=0,h=(r.logger.verbose("PopupHandler.monitorPopupForHash - polling started"),setInterval(function(){if(t.closed)r.logger.error("PopupHandler.monitorPopupForHash - window closed"),r.cleanPopup(),clearInterval(h),o(Ht.createUserCancelledError());else{var p=Ne.EMPTY_STRING,g=Ne.EMPTY_STRING;try{p=t.location.href,g=t.location.hash}catch{}Zt.isEmpty(p)||p==="about:blank"||(r.logger.verbose("PopupHandler.monitorPopupForHash - popup window is on same origin as caller"),l++,g?(r.logger.verbose("PopupHandler.monitorPopupForHash - found hash in url"),clearInterval(h),r.cleanPopup(t),xr.hashContainsKnownProperties(g)?(r.logger.verbose("PopupHandler.monitorPopupForHash - hash contains known properties, returning."),i(g)):(r.logger.error("PopupHandler.monitorPopupForHash - found hash in url but it does not contain known properties. Check that your router is not changing the hash prematurely."),r.logger.errorPii("PopupHandler.monitorPopupForHash - hash found: "+g),o(Ht.createHashDoesNotContainKnownPropertiesError()))):a<l&&(r.logger.error("PopupHandler.monitorPopupForHash - unable to find hash in url, timing out"),clearInterval(h),o(Ht.createMonitorPopupTimeoutError())))}},r.config.system.pollIntervalMilliseconds))})},e.prototype.waitForLogoutPopup=function(t){var r=this;return new Promise(function(i){r.logger.verbose("PopupHandler.waitForLogoutPopup - polling started");var o=setInterval(function(){t.closed&&(r.logger.error("PopupHandler.waitForLogoutPopup - window closed"),r.cleanPopup(),clearInterval(o),i());var a=Ne.EMPTY_STRING;try{a=t.location.href}catch{}Zt.isEmpty(a)||a==="about:blank"||(r.logger.verbose("PopupHandler.waitForLogoutPopup - popup window is on same origin as caller, closing."),clearInterval(o),r.cleanPopup(t),i())},r.config.system.pollIntervalMilliseconds)})},e.prototype.openPopup=function(t,r){try{var i=void 0;if(r.popup?(i=r.popup,this.logger.verbosePii("Navigating popup window to: "+t),i.location.assign(t)):r.popup===void 0&&(this.logger.verbosePii("Opening popup window to: "+t),i=this.openSizedPopup(t,r.popupName,r.popupWindowAttributes)),i)return i.focus&&i.focus(),this.currentWindow=i,window.addEventListener("beforeunload",this.unloadWindow),i;throw Ht.createEmptyWindowCreatedError()}catch(o){throw this.logger.error("error opening popup "+o.message),this.browserStorage.setInteractionInProgress(!1),Ht.createPopupWindowError(o.toString())}},e.prototype.openSizedPopup=function(t,r,x){var o=window.screenLeft||window.screenX,a=window.screenTop||window.screenY,l=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,h=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight,p=(p=x.popupSize)==null?void 0:p.width,g=(g=x.popupSize)==null?void 0:g.height,_=(_=x.popupPosition)==null?void 0:_.top,x=(x=x.popupPosition)==null?void 0:x.left;return(!p||p<0||l<p)&&(this.logger.verbose("Default popup window width used. Window width not configured or invalid."),p=Ec.POPUP_WIDTH),(!g||g<0||h<g)&&(this.logger.verbose("Default popup window height used. Window height not configured or invalid."),g=Ec.POPUP_HEIGHT),(!_||_<0||h<_)&&(this.logger.verbose("Default popup window top position used. Window top not configured or invalid."),_=Math.max(0,h/2-Ec.POPUP_HEIGHT/2+a)),(!x||x<0||l<x)&&(this.logger.verbose("Default popup window left position used. Window left not configured or invalid."),x=Math.max(0,l/2-Ec.POPUP_WIDTH/2+o)),window.open(t,r,"width="+p+", height="+g+", top="+_+", left="+x+", scrollbars=yes")},e.prototype.unloadWindow=function(t){this.browserStorage.cleanRequestByInteractionType(gn.Popup),this.currentWindow&&this.currentWindow.close(),t.preventDefault()},e.prototype.cleanPopup=function(t){t&&t.close(),window.removeEventListener("beforeunload",this.unloadWindow),this.browserStorage.setInteractionInProgress(!1)},e.prototype.generatePopupName=function(t,r){return Ec.POPUP_NAME_PREFIX+"."+this.config.auth.clientId+"."+t.join("-")+"."+r+"."+this.correlationId},e.prototype.generateLogoutPopupName=function(t){return t=t.account&&t.account.homeAccountId,Ec.POPUP_NAME_PREFIX+"."+this.config.auth.clientId+"."+t+"."+this.correlationId},e}(Sy),kEe=function(){function n(){}return n.prototype.navigateInternal=function(e,t){return n.defaultNavigateWindow(e,t)},n.prototype.navigateExternal=function(e,t){return n.defaultNavigateWindow(e,t)},n.defaultNavigateWindow=function(e,t){return t.noHistory?window.location.replace(e):window.location.assign(e),new Promise(function(r){setTimeout(function(){r(!0)},t.timeout)})},n}(),OEe=6e4,jP=6e3,LEe=3e4,NEe=2e3;function DEe(i,l){var t=i.auth,r=i.cache,h=i.system,i=i.telemetry,o={clientId:Ne.EMPTY_STRING,authority:""+Ne.DEFAULT_AUTHORITY,knownAuthorities:[],cloudDiscoveryMetadata:Ne.EMPTY_STRING,authorityMetadata:Ne.EMPTY_STRING,redirectUri:Ne.EMPTY_STRING,postLogoutRedirectUri:Ne.EMPTY_STRING,navigateToLoginRequestUrl:!0,clientCapabilities:[],protocolMode:Y0.AAD,azureCloudOptions:{azureCloudInstance:W0.None,tenant:Ne.EMPTY_STRING},skipAuthorityMetadataCache:!1},a={cacheLocation:po.SessionStorage,temporaryCacheLocation:po.SessionStorage,storeAuthStateInCookie:!1,secureCookies:!1,cacheMigrationEnabled:!(!r||r.cacheLocation!==po.LocalStorage),claimsBasedCachingEnabled:!0},p={loggerCallback:function(){},logLevel:Oo.Info,piiLoggingEnabled:!1},l=bn(bn({},RV),{loggerOptions:p,networkClient:l?Yi.getBrowserNetworkClient():wEe,navigationClient:new kEe,loadFrameTimeout:0,windowHashTimeout:(h==null?void 0:h.loadFrameTimeout)||OEe,iframeHashTimeout:(h==null?void 0:h.loadFrameTimeout)||jP,navigateFrameWait:l&&Yi.detectIEOrEdge()?500:0,redirectNavigationTimeout:LEe,asyncPopups:!1,allowRedirectInIframe:!1,allowNativeBroker:!1,nativeBrokerHandshakeTimeout:(h==null?void 0:h.nativeBrokerHandshakeTimeout)||NEe,pollIntervalMilliseconds:Ec.DEFAULT_POLL_INTERVAL_MS,cryptoOptions:{useMsrCrypto:!1,entropy:void 0}}),h=bn(bn({},h),{loggerOptions:(h==null?void 0:h.loggerOptions)||p}),p={application:{appName:Ne.EMPTY_STRING,appVersion:Ne.EMPTY_STRING}};return{auth:bn(bn({},o),t),cache:bn(bn({},a),r),system:bn(bn({},l),h),telemetry:bn(bn({},p),i)}}var Tw,UV=function(n){function e(t,r,i,o,a,l){return t=n.call(this,t,r,i,o,l)||this,t.navigateFrameWait=a.navigateFrameWait,t.pollIntervalMilliseconds=a.pollIntervalMilliseconds,t}return ia(e,n),e.prototype.initiateAuthRequest=function(t){return ft(this,void 0,void 0,function(){return pt(this,function(r){switch(r.label){case 0:if(this.performanceClient.addQueueMeasurement(nt.SilentHandlerInitiateAuthRequest,this.authCodeRequest.correlationId),Zt.isEmpty(t))throw this.logger.info("Navigate url is empty"),Ht.createEmptyNavigationUriError();return this.navigateFrameWait?(this.performanceClient.setPreQueueTime(nt.SilentHandlerLoadFrame,this.authCodeRequest.correlationId),[4,this.loadFrame(t)]):[3,2];case 1:return[2,r.sent()];case 2:return[2,this.loadFrameSync(t)]}})})},e.prototype.monitorIframeForHash=function(t,r){var i=this;return this.performanceClient.addQueueMeasurement(nt.SilentHandlerMonitorIframeForHash,this.authCodeRequest.correlationId),new Promise(function(o,a){r<jP&&i.logger.warning("system.loadFrameTimeout or system.iframeHashTimeout set to lower ("+r+"ms) than the default ("+jP+"ms). This may result in timeouts.");var l=window.performance.now()+r,h=setInterval(function(){if(window.performance.now()>l)i.removeHiddenIframe(t),clearInterval(h),a(Ht.createMonitorIframeTimeoutError());else{var p=Ne.EMPTY_STRING,g=t.contentWindow;try{p=g?g.location.href:Ne.EMPTY_STRING}catch{}Zt.isEmpty(p)||(p=g?g.location.hash:Ne.EMPTY_STRING,xr.hashContainsKnownProperties(p)&&(i.removeHiddenIframe(t),clearInterval(h),o(p)))}},i.pollIntervalMilliseconds)})},e.prototype.loadFrame=function(t){var r=this;return this.performanceClient.addQueueMeasurement(nt.SilentHandlerLoadFrame,this.authCodeRequest.correlationId),new Promise(function(i,o){var a=r.createHiddenIframe();setTimeout(function(){a?(a.src=t,i(a)):o("Unable to load iframe")},r.navigateFrameWait)})},e.prototype.loadFrameSync=function(t){var r=this.createHiddenIframe();return r.src=t,r},e.prototype.createHiddenIframe=function(){var t=document.createElement("iframe");return t.style.visibility="hidden",t.style.position="absolute",t.style.width=t.style.height="0",t.style.border="0",t.setAttribute("sandbox","allow-scripts allow-same-origin allow-forms"),document.getElementsByTagName("body")[0].appendChild(t),t},e.prototype.removeHiddenIframe=function(t){document.body===t.parentNode&&document.body.removeChild(t)},e}(uk),FEe=function(n){function e(t,r,i,o,a,l,h,p,g,_,x){return t=n.call(this,t,r,i,o,a,l,p,_,x)||this,t.apiId=h,t.nativeStorage=g,t}return ia(e,n),e.prototype.acquireToken=function(t){return ft(this,void 0,void 0,function(){var r,i,o,a;return pt(this,function(l){switch(l.label){case 0:if(this.performanceClient.addQueueMeasurement(nt.SilentIframeClientAcquireToken,t.correlationId),this.logger.verbose("acquireTokenByIframe called"),r=this.performanceClient.startMeasurement(nt.SilentIframeClientAcquireToken,t.correlationId),Zt.isEmpty(t.loginHint)&&Zt.isEmpty(t.sid)&&(!t.account||Zt.isEmpty(t.account.username))&&this.logger.warning("No user hint provided. The authorization server may need more information to complete this request."),t.prompt&&t.prompt!==ya.NONE&&t.prompt!==ya.NO_SESSION)throw r.endMeasurement({success:!1}),Ht.createSilentPromptValueError(t.prompt);return this.performanceClient.setPreQueueTime(nt.StandardInteractionClientInitializeAuthorizationRequest,t.correlationId),[4,this.initializeAuthorizationRequest(bn(bn({},t),{prompt:t.prompt||ya.NONE}),gn.Silent)];case 1:i=l.sent(),this.browserStorage.updateCacheEntries(i.state,i.nonce,i.authority,i.loginHint||Ne.EMPTY_STRING,i.account||null),o=this.initializeServerTelemetryManager(this.apiId),l.label=2;case 2:return l.trys.push([2,5,,6]),this.performanceClient.setPreQueueTime(nt.StandardInteractionClientCreateAuthCodeClient,t.correlationId),[4,this.createAuthCodeClient(o,i.authority,i.azureCloudOptions)];case 3:return a=l.sent(),this.logger.verbose("Auth code client created"),this.performanceClient.setPreQueueTime(nt.SilentIframeClientTokenHelper,t.correlationId),[4,this.silentTokenHelper(a,i).then(function(h){return r.endMeasurement({success:!0,fromCache:!1,requestId:h.requestId}),h})];case 4:return[2,l.sent()];case 5:throw(a=l.sent())instanceof xn&&a.setCorrelationId(this.correlationId),o.cacheFailedRequest(a),this.browserStorage.cleanRequestByState(i.state),r.endMeasurement({errorCode:a instanceof xn&&a.errorCode||void 0,subErrorCode:a instanceof xn&&a.subError||void 0,success:!1}),a;case 6:return[2]}})})},e.prototype.logout=function(){return Promise.reject(Ht.createSilentLogoutUnsupportedError())},e.prototype.silentTokenHelper=function(t,r){return ft(this,void 0,void 0,function(){var i,o,a,l,h,p,g,_=this;return pt(this,function(x){switch(x.label){case 0:return this.performanceClient.addQueueMeasurement(nt.SilentIframeClientTokenHelper,r.correlationId),this.performanceClient.setPreQueueTime(nt.StandardInteractionClientInitializeAuthorizationCodeRequest,r.correlationId),[4,this.initializeAuthorizationCodeRequest(r)];case 1:return i=x.sent(),this.performanceClient.setPreQueueTime(nt.GetAuthCodeUrl,r.correlationId),[4,t.getAuthCodeUrl(bn(bn({},r),{nativeBroker:Uf.isNativeAvailable(this.config,this.logger,this.nativeMessageHandler,r.authenticationScheme)}))];case 2:return a=x.sent(),o=new UV(t,this.browserStorage,i,this.logger,this.config.system,this.performanceClient),this.performanceClient.setPreQueueTime(nt.SilentHandlerInitiateAuthRequest,r.correlationId),[4,o.initiateAuthRequest(a)];case 3:return a=x.sent(),this.performanceClient.setPreQueueTime(nt.SilentHandlerMonitorIframeForHash,r.correlationId),[4,o.monitorIframeForHash(a,this.config.system.iframeHashTimeout)];case 4:if(l=x.sent(),p=xr.getDeserializedHash(l),h=this.validateAndExtractStateFromHash(p,gn.Silent,i.correlationId),p.accountId){if(this.logger.verbose("Account id found in hash, calling WAM for token"),this.nativeMessageHandler)return p=new Bm(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,this.apiId,this.performanceClient,this.nativeMessageHandler,p.accountId,this.browserStorage,this.correlationId),g=yu.parseRequestState(this.browserCrypto,h).userRequestState,[2,p.acquireToken(bn(bn({},r),{state:g,prompt:r.prompt||ya.NONE})).finally(function(){_.browserStorage.cleanRequestByState(h)})];throw Ht.createNativeConnectionNotEstablishedError()}return this.performanceClient.setPreQueueTime(nt.HandleCodeResponseFromHash,r.correlationId),[2,o.handleCodeResponseFromHash(l,h,t.authority,this.networkClient)]}})})},e}(Sy),BEe=function(n){function e(){return n!==null&&n.apply(this,arguments)||this}return ia(e,n),e.prototype.acquireToken=function(t){return ft(this,void 0,void 0,function(){var r,i,o,a,l,h=this;return pt(this,function(p){switch(p.label){case 0:return this.performanceClient.addQueueMeasurement(nt.SilentRefreshClientAcquireToken,t.correlationId),this.performanceClient.setPreQueueTime(nt.InitializeBaseRequest,t.correlationId),i=[bn({},t)],[4,this.initializeBaseRequest(t,t.account)];case 1:return r=bn.apply(void 0,i.concat([p.sent()])),o=this.performanceClient.startMeasurement(nt.SilentRefreshClientAcquireToken,r.correlationId),a=this.initializeServerTelemetryManager(_i.acquireTokenSilent_silentFlow),[4,this.createRefreshTokenClient(a,r.authority,r.azureCloudOptions)];case 2:return l=p.sent(),this.logger.verbose("Refresh token client created"),this.performanceClient.setPreQueueTime(nt.RefreshTokenClientAcquireTokenByRefreshToken,t.correlationId),[2,l.acquireTokenByRefreshToken(r).then(function(g){return o.endMeasurement({success:!0,fromCache:g.fromCache,requestId:g.requestId}),g}).catch(function(g){throw g instanceof xn&&g.setCorrelationId(h.correlationId),a.cacheFailedRequest(g),o.endMeasurement({errorCode:g.errorCode,subErrorCode:g.subError,success:!1}),g})]}})})},e.prototype.logout=function(){return Promise.reject(Ht.createSilentLogoutUnsupportedError())},e.prototype.createRefreshTokenClient=function(t,r,i){return ft(this,void 0,void 0,function(){var o;return pt(this,function(a){switch(a.label){case 0:return this.performanceClient.setPreQueueTime(nt.StandardInteractionClientGetClientConfiguration,this.correlationId),[4,this.getClientConfiguration(t,r,i)];case 1:return o=a.sent(),[2,new OV(o,this.performanceClient)]}})})},e}(Sy),UEe=function(){function n(e,t){this.eventCallbacks=new Map,this.logger=e,this.browserCrypto=t,this.listeningToStorageEvents=!1,this.handleAccountCacheChange=this.handleAccountCacheChange.bind(this)}return n.prototype.addEventCallback=function(e){var t;return typeof window<"u"?(t=this.browserCrypto.createNewGuid(),this.eventCallbacks.set(t,e),this.logger.verbose("Event callback registered with id: "+t),t):null},n.prototype.removeEventCallback=function(e){this.eventCallbacks.delete(e),this.logger.verbose("Event callback "+e+" removed.")},n.prototype.enableAccountStorageEvents=function(){typeof window<"u"&&(this.listeningToStorageEvents?this.logger.verbose("Account storage listener already registered."):(this.logger.verbose("Adding account storage listener."),this.listeningToStorageEvents=!0,window.addEventListener("storage",this.handleAccountCacheChange)))},n.prototype.disableAccountStorageEvents=function(){typeof window<"u"&&(this.listeningToStorageEvents?(this.logger.verbose("Removing account storage listener."),window.removeEventListener("storage",this.handleAccountCacheChange),this.listeningToStorageEvents=!1):this.logger.verbose("No account storage listener registered."))},n.prototype.emitEvent=function(e,t,r,i){var o,a=this;typeof window<"u"&&(o={eventType:e,interactionType:t||null,payload:r||null,error:i||null,timestamp:Date.now()},this.logger.info("Emitting event: "+e),this.eventCallbacks.forEach(function(l,h){a.logger.verbose("Emitting event to callback "+h+": "+e),l.apply(null,[o])}))},n.prototype.handleAccountCacheChange=function(e){try{var t,r,i=e.newValue||e.oldValue;i&&typeof(t=JSON.parse(i))=="object"&&Qo.isAccountEntity(t)&&(r=Ka.toObject(new Qo,t).getAccountInfo(),!e.oldValue&&e.newValue?(this.logger.info("Account was added to cache in a different window"),this.emitEvent(Bn.ACCOUNT_ADDED,void 0,r)):!e.newValue&&e.oldValue&&(this.logger.info("Account was removed from cache in a different window"),this.emitEvent(Bn.ACCOUNT_REMOVED,void 0,r)))}catch{}},n}(),ha=function(){function n(){}return n.decimalToHex=function(e){for(var t=e.toString(16);t.length<2;)t="0"+t;return t},n}(),zV=function(){function n(e){this.cryptoObj=e}return n.prototype.generateGuid=function(){try{var e=new Uint8Array(16);return this.cryptoObj.getRandomValues(e),e[6]|=64,e[6]&=79,e[8]|=128,e[8]&=191,ha.decimalToHex(e[0])+ha.decimalToHex(e[1])+ha.decimalToHex(e[2])+ha.decimalToHex(e[3])+"-"+ha.decimalToHex(e[4])+ha.decimalToHex(e[5])+"-"+ha.decimalToHex(e[6])+ha.decimalToHex(e[7])+"-"+ha.decimalToHex(e[8])+ha.decimalToHex(e[9])+"-"+ha.decimalToHex(e[10])+ha.decimalToHex(e[11])+ha.decimalToHex(e[12])+ha.decimalToHex(e[13])+ha.decimalToHex(e[14])+ha.decimalToHex(e[15])}catch{for(var t="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx",r="0123456789abcdef",i=0,o=Ne.EMPTY_STRING,a=0;a<36;a++)t[a]!=="-"&&t[a]!=="4"&&(i=16*Math.random()|0),o+=t[a]==="x"?r[i]:t[a]==="y"?r[i=i&3|8]:t[a];return o}},n.prototype.isGuid=function(e){return/^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(e)},n}(),_u=function(){function n(){}return n.stringToUtf8Arr=function(e){for(var t,r=0,i=e.length,o=0;o<i;o++)r+=(t=e.charCodeAt(o))<128?1:t<2048?2:t<65536?3:t<2097152?4:t<67108864?5:6;for(var a=new Uint8Array(r),l=0,h=0;l<r;h++)(t=e.charCodeAt(h))<128?a[l++]=t:(t<2048?a[l++]=192+(t>>>6):(t<65536?a[l++]=224+(t>>>12):(t<2097152?a[l++]=240+(t>>>18):(t<67108864?a[l++]=248+(t>>>24):(a[l++]=252+(t>>>30),a[l++]=128+(t>>>24&63)),a[l++]=128+(t>>>18&63)),a[l++]=128+(t>>>12&63)),a[l++]=128+(t>>>6&63)),a[l++]=128+(63&t));return a},n.stringToArrayBuffer=function(e){for(var t=new ArrayBuffer(e.length),r=new Uint8Array(t),i=0;i<e.length;i++)r[i]=e.charCodeAt(i);return t},n.utf8ArrToString=function(e){for(var t,r=Ne.EMPTY_STRING,i=e.length,o=0;o<i;o++)t=e[o],r+=String.fromCharCode(251<t&&t<254&&o+5<i?1073741824*(t-252)+(e[++o]-128<<24)+(e[++o]-128<<18)+(e[++o]-128<<12)+(e[++o]-128<<6)+e[++o]-128:247<t&&t<252&&o+4<i?(t-248<<24)+(e[++o]-128<<18)+(e[++o]-128<<12)+(e[++o]-128<<6)+e[++o]-128:239<t&&t<248&&o+3<i?(t-240<<18)+(e[++o]-128<<12)+(e[++o]-128<<6)+e[++o]-128:223<t&&t<240&&o+2<i?(t-224<<12)+(e[++o]-128<<6)+e[++o]-128:191<t&&t<224&&o+1<i?(t-192<<6)+e[++o]-128:t);return r},n.getSortedObjectString=function(e){return JSON.stringify(e,Object.keys(e).sort())},n}(),jV=function(){function n(){}return n.prototype.urlEncode=function(e){return encodeURIComponent(this.encode(e).replace(/=/g,Ne.EMPTY_STRING).replace(/\+/g,"-").replace(/\//g,"_"))},n.prototype.urlEncodeArr=function(e){return this.base64EncArr(e).replace(/=/g,Ne.EMPTY_STRING).replace(/\+/g,"-").replace(/\//g,"_")},n.prototype.encode=function(e){return e=_u.stringToUtf8Arr(e),this.base64EncArr(e)},n.prototype.base64EncArr=function(e){for(var t,r=(3-e.length%3)%3,i=Ne.EMPTY_STRING,o=e.length,a=0,l=0;l<o;l++)a|=e[l]<<(16>>>(t=l%3)&24),t!=2&&e.length-l!=1||(i+=String.fromCharCode(this.uint6ToB64(a>>>18&63),this.uint6ToB64(a>>>12&63),this.uint6ToB64(a>>>6&63),this.uint6ToB64(63&a)),a=0);return r==0?i:i.substring(0,i.length-r)+(r==1?"=":"==")},n.prototype.uint6ToB64=function(e){return e<26?e+65:e<52?e+71:e<62?e-4:e===62?43:e===63?47:65},n}(),zEe=function(){function n(){}return n.prototype.decode=function(e){var t=e.replace(/-/g,"+").replace(/_/g,"/");switch(t.length%4){case 0:break;case 2:t+="==";break;case 3:t+="=";break;default:throw new Error("Invalid base64 string")}return e=this.base64DecToArr(t),_u.utf8ArrToString(e)},n.prototype.base64DecToArr=function(e,t){for(var r,i=e.replace(/[^A-Za-z0-9\+\/]/g,Ne.EMPTY_STRING),o=i.length,a=t?Math.ceil((3*o+1>>>2)/t)*t:3*o+1>>>2,l=new Uint8Array(a),h=void 0,p=0,g=0,_=0;_<o;_++)if(r=3&_,p|=this.b64ToUint6(i.charCodeAt(_))<<18-6*r,r==3||o-_==1){for(h=0;h<3&&g<a;h++,g++)l[g]=p>>>(16>>>h&24)&255;p=0}return l},n.prototype.b64ToUint6=function(e){return 64<e&&e<91?e-65:96<e&&e<123?e-71:47<e&&e<58?e+4:e===43?62:e===47?63:0},n}(),jEe=32,VEe=function(){function n(e){this.base64Encode=new jV,this.cryptoObj=e}return n.prototype.generateCodes=function(){return ft(this,void 0,void 0,function(){var e,t;return pt(this,function(r){switch(r.label){case 0:return e=this.generateCodeVerifier(),[4,this.generateCodeChallengeFromVerifier(e)];case 1:return t=r.sent(),[2,{verifier:e,challenge:t}]}})})},n.prototype.generateCodeVerifier=function(){try{var e=new Uint8Array(jEe);return this.cryptoObj.getRandomValues(e),this.base64Encode.urlEncodeArr(e)}catch(t){throw Ht.createPkceNotGeneratedError(t)}},n.prototype.generateCodeChallengeFromVerifier=function(e){return ft(this,void 0,void 0,function(){var t;return pt(this,function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,this.cryptoObj.sha256Digest(e)];case 1:return t=r.sent(),[2,this.base64Encode.urlEncodeArr(new Uint8Array(t))];case 2:throw t=r.sent(),Ht.createPkceNotGeneratedError(t);case 3:return[2]}})})},n}(),HEe=function(){function n(){}return n.prototype.getRandomValues=function(e){return window.crypto.getRandomValues(e)},n.prototype.generateKey=function(e,t,r){return ft(this,void 0,void 0,function(){return pt(this,function(i){return[2,window.crypto.subtle.generateKey(e,t,r)]})})},n.prototype.exportKey=function(e){return ft(this,void 0,void 0,function(){return pt(this,function(t){return[2,window.crypto.subtle.exportKey(uy,e)]})})},n.prototype.importKey=function(e,t,r,i){return ft(this,void 0,void 0,function(){return pt(this,function(o){return[2,window.crypto.subtle.importKey(uy,e,t,r,i)]})})},n.prototype.sign=function(e,t,r){return ft(this,void 0,void 0,function(){return pt(this,function(i){return[2,window.crypto.subtle.sign(e,t,r)]})})},n.prototype.digest=function(e,t){return ft(this,void 0,void 0,function(){return pt(this,function(r){return[2,window.crypto.subtle.digest(e,t)]})})},n}(),GEe=function(){function n(){}return n.prototype.initPrng=function(e){return window.msrCrypto.initPrng(ok(e))},n.prototype.getRandomValues=function(e){return window.msrCrypto.getRandomValues(e)},n.prototype.generateKey=function(e,t,r){return ft(this,void 0,void 0,function(){return pt(this,function(i){return[2,window.msrCrypto.subtle.generateKey(e,t,r)]})})},n.prototype.exportKey=function(e){return ft(this,void 0,void 0,function(){return pt(this,function(t){return[2,window.msrCrypto.subtle.exportKey(uy,e)]})})},n.prototype.importKey=function(e,t,r,i){return ft(this,void 0,void 0,function(){return pt(this,function(o){return[2,window.msrCrypto.subtle.importKey(uy,e,t,r,i)]})})},n.prototype.sign=function(e,t,r){return ft(this,void 0,void 0,function(){return pt(this,function(i){return[2,window.msrCrypto.subtle.sign(e,t,r)]})})},n.prototype.digest=function(e,t){return ft(this,void 0,void 0,function(){return pt(this,function(r){return[2,window.msrCrypto.subtle.digest(e,t)]})})},n}(),qEe=function(){function n(){}return n.prototype.getRandomValues=function(e){return window.msCrypto.getRandomValues(e)},n.prototype.generateKey=function(e,t,r){return ft(this,void 0,void 0,function(){return pt(this,function(i){return[2,new Promise(function(o,a){var l=window.msCrypto.subtle.generateKey(e,t,r);l.addEventListener("complete",function(h){o(h.target.result)}),l.addEventListener("error",function(h){a(h)})})]})})},n.prototype.exportKey=function(e){return ft(this,void 0,void 0,function(){return pt(this,function(t){return[2,new Promise(function(r,i){var o=window.msCrypto.subtle.exportKey(uy,e);o.addEventListener("complete",function(a){var l=a.target.result,l=_u.utf8ArrToString(new Uint8Array(l)).replace(/\r/g,Ne.EMPTY_STRING).replace(/\n/g,Ne.EMPTY_STRING).replace(/\t/g,Ne.EMPTY_STRING).split(" ").join(Ne.EMPTY_STRING).replace("\0",Ne.EMPTY_STRING);try{r(JSON.parse(l))}catch(h){i(h)}}),o.addEventListener("error",function(a){i(a)})})]})})},n.prototype.importKey=function(e,t,r,i){return ft(this,void 0,void 0,function(){var o,a;return pt(this,function(l){return o=_u.getSortedObjectString(e),a=_u.stringToArrayBuffer(o),[2,new Promise(function(h,p){var g=window.msCrypto.subtle.importKey(uy,a,t,r,i);g.addEventListener("complete",function(_){h(_.target.result)}),g.addEventListener("error",function(_){p(_)})})]})})},n.prototype.sign=function(e,t,r){return ft(this,void 0,void 0,function(){return pt(this,function(i){return[2,new Promise(function(o,a){var l=window.msCrypto.subtle.sign(e,t,r);l.addEventListener("complete",function(h){o(h.target.result)}),l.addEventListener("error",function(h){a(h)})})]})})},n.prototype.digest=function(e,t){return ft(this,void 0,void 0,function(){return pt(this,function(r){return[2,new Promise(function(i,o){var a=window.msCrypto.subtle.digest(e,t.buffer);a.addEventListener("complete",function(l){i(l.target.result)}),a.addEventListener("error",function(l){o(l)})})]})})},n}(),$Ee="RSASSA-PKCS1-v1_5",n5="SHA-256",WEe=2048,YEe=new Uint8Array([1,0,1]),VV=function(){function n(e,t){if(this.logger=e,this.cryptoOptions=t,this.hasBrowserCrypto())this.logger.verbose("BrowserCrypto: modern crypto interface available"),this.subtleCrypto=new HEe;else if(this.hasIECrypto())this.logger.verbose("BrowserCrypto: MS crypto interface available"),this.subtleCrypto=new qEe;else{if(!this.hasMsrCrypto()||(e=this.cryptoOptions)==null||!e.useMsrCrypto)throw this.hasMsrCrypto()&&this.logger.info("BrowserCrypto: MSR Crypto interface available but system.cryptoOptions.useMsrCrypto not enabled"),this.logger.error("BrowserCrypto: No crypto interfaces available."),Ht.createCryptoNotAvailableError("Browser crypto, msCrypto, or msrCrypto interfaces not available.");this.logger.verbose("BrowserCrypto: MSR crypto interface available"),this.subtleCrypto=new GEe}if(this.subtleCrypto.initPrng){if(this.logger.verbose("BrowserCrypto: Interface requires entropy"),(t=this.cryptoOptions)==null||!t.entropy)throw this.logger.error("BrowserCrypto: Interface requires entropy but none provided."),WE.createEntropyNotProvided();this.logger.verbose("BrowserCrypto: Entropy provided"),this.subtleCrypto.initPrng(this.cryptoOptions.entropy)}this.keygenAlgorithmOptions={name:$Ee,hash:n5,modulusLength:WEe,publicExponent:YEe}}return n.prototype.hasIECrypto=function(){return"msCrypto"in window},n.prototype.hasBrowserCrypto=function(){return"crypto"in window},n.prototype.hasMsrCrypto=function(){return"msrCrypto"in window},n.prototype.sha256Digest=function(e){return ft(this,void 0,void 0,function(){var t;return pt(this,function(r){return t=_u.stringToUtf8Arr(e),[2,this.subtleCrypto.digest({name:n5},t)]})})},n.prototype.getRandomValues=function(e){return this.subtleCrypto.getRandomValues(e)},n.prototype.generateKeyPair=function(e,t){return ft(this,void 0,void 0,function(){return pt(this,function(r){return[2,this.subtleCrypto.generateKey(this.keygenAlgorithmOptions,e,t)]})})},n.prototype.exportJwk=function(e){return ft(this,void 0,void 0,function(){return pt(this,function(t){return[2,this.subtleCrypto.exportKey(e)]})})},n.prototype.importJwk=function(e,t,r){return ft(this,void 0,void 0,function(){return pt(this,function(i){return[2,this.subtleCrypto.importKey(e,this.keygenAlgorithmOptions,t,r)]})})},n.prototype.sign=function(e,t){return ft(this,void 0,void 0,function(){return pt(this,function(r){return[2,this.subtleCrypto.sign(this.keygenAlgorithmOptions,e,t)]})})},n}(),KEe=function(){function n(){this.dbName=BP,this.version=SEe,this.tableName=CEe,this.dbOpen=!1}return n.prototype.open=function(){return ft(this,void 0,void 0,function(){var e=this;return pt(this,function(t){return[2,new Promise(function(r,i){var o=window.indexedDB.open(e.dbName,e.version);o.addEventListener("upgradeneeded",function(a){a.target.result.createObjectStore(e.tableName)}),o.addEventListener("success",function(a){e.db=a.target.result,e.dbOpen=!0,r()}),o.addEventListener("error",function(){return i(Ht.createDatabaseUnavailableError())})})]})})},n.prototype.closeConnection=function(){var e=this.db;e&&this.dbOpen&&(e.close(),this.dbOpen=!1)},n.prototype.validateDbIsOpen=function(){return ft(this,void 0,void 0,function(){return pt(this,function(e){switch(e.label){case 0:return this.dbOpen?[3,2]:[4,this.open()];case 1:return[2,e.sent()];case 2:return[2]}})})},n.prototype.getItem=function(e){return ft(this,void 0,void 0,function(){var t=this;return pt(this,function(r){switch(r.label){case 0:return[4,this.validateDbIsOpen()];case 1:return r.sent(),[2,new Promise(function(i,o){if(!t.db)return o(Ht.createDatabaseNotOpenError());var a=t.db.transaction([t.tableName],"readonly").objectStore(t.tableName).get(e);a.addEventListener("success",function(l){t.closeConnection(),i(l.target.result)}),a.addEventListener("error",function(l){t.closeConnection(),o(l)})})]}})})},n.prototype.setItem=function(e,t){return ft(this,void 0,void 0,function(){var r=this;return pt(this,function(i){switch(i.label){case 0:return[4,this.validateDbIsOpen()];case 1:return i.sent(),[2,new Promise(function(o,a){if(!r.db)return a(Ht.createDatabaseNotOpenError());var l=r.db.transaction([r.tableName],"readwrite").objectStore(r.tableName).put(t,e);l.addEventListener("success",function(){r.closeConnection(),o()}),l.addEventListener("error",function(h){r.closeConnection(),a(h)})})]}})})},n.prototype.removeItem=function(e){return ft(this,void 0,void 0,function(){var t=this;return pt(this,function(r){switch(r.label){case 0:return[4,this.validateDbIsOpen()];case 1:return r.sent(),[2,new Promise(function(i,o){if(!t.db)return o(Ht.createDatabaseNotOpenError());var a=t.db.transaction([t.tableName],"readwrite").objectStore(t.tableName).delete(e);a.addEventListener("success",function(){t.closeConnection(),i()}),a.addEventListener("error",function(l){t.closeConnection(),o(l)})})]}})})},n.prototype.getKeys=function(){return ft(this,void 0,void 0,function(){var e=this;return pt(this,function(t){switch(t.label){case 0:return[4,this.validateDbIsOpen()];case 1:return t.sent(),[2,new Promise(function(r,i){if(!e.db)return i(Ht.createDatabaseNotOpenError());var o=e.db.transaction([e.tableName],"readonly").objectStore(e.tableName).getAllKeys();o.addEventListener("success",function(a){e.closeConnection(),r(a.target.result)}),o.addEventListener("error",function(a){e.closeConnection(),i(a)})})]}})})},n.prototype.containsKey=function(e){return ft(this,void 0,void 0,function(){var t=this;return pt(this,function(r){switch(r.label){case 0:return[4,this.validateDbIsOpen()];case 1:return r.sent(),[2,new Promise(function(i,o){if(!t.db)return o(Ht.createDatabaseNotOpenError());var a=t.db.transaction([t.tableName],"readonly").objectStore(t.tableName).count(e);a.addEventListener("success",function(l){t.closeConnection(),i(l.target.result===1)}),a.addEventListener("error",function(l){t.closeConnection(),o(l)})})]}})})},n.prototype.deleteDatabase=function(){return ft(this,void 0,void 0,function(){return pt(this,function(e){return this.db&&this.dbOpen&&this.closeConnection(),[2,new Promise(function(t,r){var i=window.indexedDB.deleteDatabase(BP);i.addEventListener("success",function(){return t(!0)}),i.addEventListener("blocked",function(){return t(!0)}),i.addEventListener("error",function(){return r(!1)})})]})})},n}(),r5=function(){function n(e,t){this.inMemoryCache=new UP,this.indexedDBCache=new KEe,this.logger=e,this.storeName=t}return n.prototype.handleDatabaseAccessError=function(e){if(!(e instanceof Ht&&e.errorCode===Pt.databaseUnavailable.code))throw e;this.logger.error("Could not access persistent storage. This may be caused by browser privacy features which block persistent storage in third-party contexts.")},n.prototype.getItem=function(e){return ft(this,void 0,void 0,function(){var t,r;return pt(this,function(i){switch(i.label){case 0:if(t=this.inMemoryCache.getItem(e))return[3,4];i.label=1;case 1:return i.trys.push([1,3,,4]),this.logger.verbose("Queried item not found in in-memory cache, now querying persistent storage."),[4,this.indexedDBCache.getItem(e)];case 2:return[2,i.sent()];case 3:return r=i.sent(),this.handleDatabaseAccessError(r),[3,4];case 4:return[2,t]}})})},n.prototype.setItem=function(e,t){return ft(this,void 0,void 0,function(){var r;return pt(this,function(i){switch(i.label){case 0:this.inMemoryCache.setItem(e,t),i.label=1;case 1:return i.trys.push([1,3,,4]),[4,this.indexedDBCache.setItem(e,t)];case 2:return i.sent(),[3,4];case 3:return r=i.sent(),this.handleDatabaseAccessError(r),[3,4];case 4:return[2]}})})},n.prototype.removeItem=function(e){return ft(this,void 0,void 0,function(){var t;return pt(this,function(r){switch(r.label){case 0:this.inMemoryCache.removeItem(e),r.label=1;case 1:return r.trys.push([1,3,,4]),[4,this.indexedDBCache.removeItem(e)];case 2:return r.sent(),[3,4];case 3:return t=r.sent(),this.handleDatabaseAccessError(t),[3,4];case 4:return[2]}})})},n.prototype.getKeys=function(){return ft(this,void 0,void 0,function(){var e,t;return pt(this,function(r){switch(r.label){case 0:if((e=this.inMemoryCache.getKeys()).length!==0)return[3,4];r.label=1;case 1:return r.trys.push([1,3,,4]),this.logger.verbose("In-memory cache is empty, now querying persistent storage."),[4,this.indexedDBCache.getKeys()];case 2:return[2,r.sent()];case 3:return t=r.sent(),this.handleDatabaseAccessError(t),[3,4];case 4:return[2,e]}})})},n.prototype.containsKey=function(e){return ft(this,void 0,void 0,function(){var t,r;return pt(this,function(i){switch(i.label){case 0:if(t=this.inMemoryCache.containsKey(e))return[3,4];i.label=1;case 1:return i.trys.push([1,3,,4]),this.logger.verbose("Key not found in in-memory cache, now querying persistent storage."),[4,this.indexedDBCache.containsKey(e)];case 2:return[2,i.sent()];case 3:return r=i.sent(),this.handleDatabaseAccessError(r),[3,4];case 4:return[2,t]}})})},n.prototype.clearInMemory=function(){this.logger.verbose("Deleting in-memory keystore "+this.storeName),this.inMemoryCache.clear(),this.logger.verbose("In-memory keystore "+this.storeName+" deleted")},n.prototype.clearPersistent=function(){return ft(this,void 0,void 0,function(){var e;return pt(this,function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),this.logger.verbose("Deleting persistent keystore"),[4,this.indexedDBCache.deleteDatabase()];case 1:return(e=t.sent())&&this.logger.verbose("Persistent keystore deleted"),[2,e];case 2:return e=t.sent(),this.handleDatabaseAccessError(e),[2,!1];case 3:return[2]}})})},n}(),ZEe=(function(n){n.asymmetricKeys="asymmetricKeys",n.symmetricKeys="symmetricKeys"}(Tw=Tw||{}),function(){function n(e){this.logger=e,this.asymmetricKeys=new r5(this.logger,Tw.asymmetricKeys),this.symmetricKeys=new r5(this.logger,Tw.symmetricKeys)}return n.prototype.clear=function(){return ft(this,void 0,void 0,function(){var e;return pt(this,function(t){switch(t.label){case 0:this.asymmetricKeys.clearInMemory(),this.symmetricKeys.clearInMemory(),t.label=1;case 1:return t.trys.push([1,3,,4]),[4,this.asymmetricKeys.clearPersistent()];case 2:return t.sent(),[2,!0];case 3:return(e=t.sent())instanceof Error?this.logger.error("Clearing keystore failed with error: "+e.message):this.logger.error("Clearing keystore failed with unknown error"),[2,!1];case 4:return[2]}})})},n}()),XEe=function(){function n(e,t,r){this.logger=e,this.browserCrypto=new VV(this.logger,r),this.b64Encode=new jV,this.b64Decode=new zEe,this.guidGenerator=new zV(this.browserCrypto),this.pkceGenerator=new VEe(this.browserCrypto),this.cache=new ZEe(this.logger),this.performanceClient=t}return n.prototype.createNewGuid=function(){return this.guidGenerator.generateGuid()},n.prototype.base64Encode=function(e){return this.b64Encode.encode(e)},n.prototype.base64Decode=function(e){return this.b64Decode.decode(e)},n.prototype.generatePkceCodes=function(){return ft(this,void 0,void 0,function(){return pt(this,function(e){return[2,this.pkceGenerator.generateCodes()]})})},n.prototype.getPublicKeyThumbprint=function(e){var t;return ft(this,void 0,void 0,function(){var r,i,o,a,l;return pt(this,function(h){switch(h.label){case 0:return r=(t=this.performanceClient)==null?void 0:t.startMeasurement(nt.CryptoOptsGetPublicKeyThumbprint,e.correlationId),[4,this.browserCrypto.generateKeyPair(n.EXTRACTABLE,n.POP_KEY_USAGES)];case 1:return i=h.sent(),[4,this.browserCrypto.exportJwk(i.publicKey)];case 2:return a=h.sent(),a={e:a.e,kty:a.kty,n:a.n},a=_u.getSortedObjectString(a),[4,this.hashString(a)];case 3:return o=h.sent(),[4,this.browserCrypto.exportJwk(i.privateKey)];case 4:return a=h.sent(),[4,this.browserCrypto.importJwk(a,!1,["sign"])];case 5:return l=h.sent(),[4,this.cache.asymmetricKeys.setItem(o,{privateKey:l,publicKey:i.publicKey,requestMethod:e.resourceRequestMethod,requestUri:e.resourceRequestUri})];case 6:return h.sent(),r&&r.endMeasurement({success:!0}),[2,o]}})})},n.prototype.removeTokenBindingKey=function(e){return ft(this,void 0,void 0,function(){return pt(this,function(t){switch(t.label){case 0:return[4,this.cache.asymmetricKeys.removeItem(e)];case 1:return t.sent(),[4,this.cache.asymmetricKeys.containsKey(e)];case 2:return[2,!t.sent()]}})})},n.prototype.clearKeystore=function(){return ft(this,void 0,void 0,function(){return pt(this,function(e){switch(e.label){case 0:return[4,this.cache.clear()];case 1:return[2,e.sent()]}})})},n.prototype.signJwt=function(e,t,r){var i;return ft(this,void 0,void 0,function(){var o,a,l,h,p,g;return pt(this,function(_){switch(_.label){case 0:return o=(i=this.performanceClient)==null?void 0:i.startMeasurement(nt.CryptoOptsSignJwt,r),[4,this.cache.asymmetricKeys.getItem(t)];case 1:if(a=_.sent())return[4,this.browserCrypto.exportJwk(a.publicKey)];throw Ht.createSigningKeyNotFoundInStorageError(t);case 2:return p=_.sent(),l=_u.getSortedObjectString(p),h=this.b64Encode.urlEncode(JSON.stringify({kid:t})),h=xEe.getShrHeaderString({kid:h,alg:p.alg}),p=this.b64Encode.urlEncode(h),e.cnf={jwk:JSON.parse(l)},h=this.b64Encode.urlEncode(JSON.stringify(e)),l=p+"."+h,p=_u.stringToArrayBuffer(l),[4,this.browserCrypto.sign(a.privateKey,p)];case 3:return h=_.sent(),p=this.b64Encode.urlEncodeArr(new Uint8Array(h)),g=l+"."+p,o&&o.endMeasurement({success:!0}),[2,g]}})})},n.prototype.hashString=function(e){return ft(this,void 0,void 0,function(){var t;return pt(this,function(r){switch(r.label){case 0:return[4,this.browserCrypto.sha256Digest(e)];case 1:return t=r.sent(),t=new Uint8Array(t),[2,this.b64Encode.urlEncodeArr(t)]}})})},n.POP_KEY_USAGES=["sign","verify"],n.EXTRACTABLE=!0,n}(),i5=function(){function n(e,t){this.correlationId=t,this.measureName=n.makeMeasureName(e,t),this.startMark=n.makeStartMark(e,t),this.endMark=n.makeEndMark(e,t)}return n.makeMeasureName=function(e,t){return"msal.measure."+e+"."+t},n.makeStartMark=function(e,t){return"msal.start."+e+"."+t},n.makeEndMark=function(e,t){return"msal.end."+e+"."+t},n.supportsBrowserPerformance=function(){return typeof window<"u"&&window.performance!==void 0&&typeof window.performance.mark=="function"&&typeof window.performance.measure=="function"&&typeof window.performance.clearMarks=="function"&&typeof window.performance.clearMeasures=="function"&&typeof window.performance.getEntriesByName=="function"},n.flushMeasurements=function(e,t){if(n.supportsBrowserPerformance())try{t.forEach(function(r){r=n.makeMeasureName(r.name,e),0<window.performance.getEntriesByName(r,"measure").length&&(window.performance.clearMeasures(r),window.performance.clearMarks(n.makeStartMark(r,e)),window.performance.clearMarks(n.makeEndMark(r,e)))})}catch{}},n.prototype.startMeasurement=function(){if(n.supportsBrowserPerformance())try{window.performance.mark(this.startMark)}catch{}},n.prototype.endMeasurement=function(){if(n.supportsBrowserPerformance())try{window.performance.mark(this.endMark),window.performance.measure(this.measureName,this.startMark,this.endMark)}catch{}},n.prototype.flushMeasurement=function(){if(n.supportsBrowserPerformance())try{var e,t=window.performance.getEntriesByName(this.measureName,"measure");if(0<t.length)return e=t[0].duration,window.performance.clearMeasures(this.measureName),window.performance.clearMarks(this.startMark),window.performance.clearMarks(this.endMark),e}catch{}return null},n}(),QEe=function(n){function e(t,r,i,o,a,l,h){return t=n.call(this,t,r,i,o,a,l)||this,t.browserCrypto=new VV(t.logger,h),t.guidGenerator=new zV(t.browserCrypto),t}return ia(e,n),e.prototype.startPerformanceMeasuremeant=function(t,r){return new i5(t,r)},e.prototype.generateId=function(){return this.guidGenerator.generateGuid()},e.prototype.getPageVisibility=function(){var t;return((t=document.visibilityState)==null?void 0:t.toString())||null},e.prototype.deleteIncompleteSubMeasurements=function(t){var r=this.eventsByCorrelationId.get(t.event.correlationId),i=r&&r.eventId===t.event.eventId,o=[];i&&r!=null&&r.incompleteSubMeasurements&&r.incompleteSubMeasurements.forEach(function(a){o.push(bn({},a))}),0<o.length&&i5.flushMeasurements(t.event.correlationId,o)},e.prototype.supportsBrowserPerformanceNow=function(){return typeof window<"u"&&window.performance!==void 0&&typeof window.performance.now=="function"},e.prototype.startMeasurement=function(t,r){var i=this,o=this.getPageVisibility(),a=n.prototype.startMeasurement.call(this,t,r);return bn(bn({},a),{endMeasurement:function(l){return l=a.endMeasurement(bn({startPageVisibility:o,endPageVisibility:i.getPageVisibility()},l)),i.deleteIncompleteSubMeasurements(a),l},discardMeasurement:function(){a.discardMeasurement(),i.deleteIncompleteSubMeasurements(a),a.measurement.flushMeasurement()}})},e.prototype.setPreQueueTime=function(t,r){var i;this.supportsBrowserPerformanceNow()?r?((i=this.preQueueTimeByCorrelationId.get(r))&&(this.logger.trace("BrowserPerformanceClient: Incomplete pre-queue "+i.name+" found",r),this.addQueueMeasurement(i.name,r,void 0,!0)),this.preQueueTimeByCorrelationId.set(r,{name:t,time:window.performance.now()})):this.logger.trace("BrowserPerformanceClient: correlationId for "+t+" not provided, unable to set telemetry queue time"):this.logger.trace("BrowserPerformanceClient: window performance API not available, unable to set telemetry queue time for "+t)},e.prototype.addQueueMeasurement=function(t,r,i,o){if(this.supportsBrowserPerformanceNow())if(r){var a,l=n.prototype.getPreQueueTime.call(this,t,r);if(l)return a=window.performance.now(),i=i||n.prototype.calculateQueuedTime.call(this,l,a),n.prototype.addQueueMeasurement.call(this,t,r,i,o)}else this.logger.trace("BrowserPerformanceClient: correlationId for "+t+" not provided, unable to add queue measurement");else this.logger.trace("BrowserPerformanceClient: window performance API not available, unable to add queue measurement for "+t)},e}(NV),JEe=function(){function n(e,t,r,i){this.isBrowserEnvironment=typeof window<"u",this.config=e,this.storage=t,this.logger=r,this.cryptoObj=i}return n.prototype.loadExternalTokens=function(e,t,r){if(this.logger.info("TokenCache - loadExternalTokens called"),!t.id_token)throw Ht.createUnableToLoadTokenError("Please ensure server response includes id token.");var i=new Pl(t.id_token,this.cryptoObj);if(e.account)var o=this.loadAccount(i,e.account.environment,void 0,void 0,e.account.homeAccountId),a=new HE(o,this.loadIdToken(i,o.homeAccountId,e.account.environment,e.account.tenantId),this.loadAccessToken(e,t,o.homeAccountId,e.account.environment,e.account.tenantId,r),this.loadRefreshToken(e,t,o.homeAccountId,e.account.environment));else{if(!e.authority)throw Ht.createUnableToLoadTokenError("Please provide a request with an account or a request with authority.");var h=K0.generateAuthority(e.authority,e.azureCloudOptions),l={protocolMode:this.config.auth.protocolMode,knownAuthorities:this.config.auth.knownAuthorities,cloudDiscoveryMetadata:this.config.auth.cloudDiscoveryMetadata,authorityMetadata:this.config.auth.authorityMetadata,skipAuthorityMetadataCache:this.config.auth.skipAuthorityMetadataCache},h=new K0(h,this.config.system.networkClient,this.storage,l,this.logger);if(r.clientInfo)this.logger.trace("TokenCache - homeAccountId from options"),o=this.loadAccount(i,h.hostnameAndPort,r.clientInfo,h.authorityType);else{if(!t.client_info)throw Ht.createUnableToLoadTokenError("Please provide clientInfo in the response or options.");this.logger.trace("TokenCache - homeAccountId from response"),o=this.loadAccount(i,h.hostnameAndPort,t.client_info,h.authorityType)}a=new HE(o,this.loadIdToken(i,o.homeAccountId,h.hostnameAndPort,h.tenant),this.loadAccessToken(e,t,o.homeAccountId,h.hostnameAndPort,h.tenant,r),this.loadRefreshToken(e,t,o.homeAccountId,h.hostnameAndPort))}return this.generateAuthenticationResult(e,i,a,h)},n.prototype.loadAccount=function(e,t,r,i,o){var a;if(o?a=o:i!==void 0&&r&&(a=Qo.generateHomeAccountId(r,i,this.logger,this.cryptoObj,e)),!a)throw Ht.createUnableToLoadTokenError("Unexpected missing homeAccountId");if(o=r?Qo.createAccount(r,a,e,void 0,void 0,void 0,t):Qo.createGenericAccount(a,e,void 0,void 0,void 0,t),this.isBrowserEnvironment)return this.logger.verbose("TokenCache - loading account"),this.storage.setAccount(o),o;throw Ht.createUnableToLoadTokenError("loadExternalTokens is designed to work in browser environments only.")},n.prototype.loadIdToken=function(e,t,r,i){if(t=Ef.createIdTokenEntity(t,r,e.rawToken,this.config.auth.clientId,i),this.isBrowserEnvironment)return this.logger.verbose("TokenCache - loading id token"),this.storage.setIdTokenCredential(t),t;throw Ht.createUnableToLoadTokenError("loadExternalTokens is designed to work in browser environments only.")},n.prototype.loadAccessToken=function(l,t,g,i,o,p){if(!t.access_token)return this.logger.verbose("TokenCache - No access token provided for caching"),null;if(!t.expires_in)throw Ht.createUnableToLoadTokenError("Please ensure server response includes expires_in value.");if(!p.extendedExpiresOn)throw Ht.createUnableToLoadTokenError("Please provide an extendedExpiresOn value in the options.");var l=new pa(l.scopes).printScopes(),h=p.expiresOn||t.expires_in+new Date().getTime()/1e3,p=p.extendedExpiresOn,g=Tf.createAccessTokenEntity(g,i,t.access_token,this.config.auth.clientId,o,l,h,p,this.cryptoObj);if(this.isBrowserEnvironment)return this.logger.verbose("TokenCache - loading access token"),this.storage.setAccessTokenCredential(g),g;throw Ht.createUnableToLoadTokenError("loadExternalTokens is designed to work in browser environments only.")},n.prototype.loadRefreshToken=function(e,t,r,i){if(!t.refresh_token)return this.logger.verbose("TokenCache - No refresh token provided for caching"),null;if(r=dm.createRefreshTokenEntity(r,i,t.refresh_token,this.config.auth.clientId),this.isBrowserEnvironment)return this.logger.verbose("TokenCache - loading refresh token"),this.storage.setRefreshTokenCredential(r),r;throw Ht.createUnableToLoadTokenError("loadExternalTokens is designed to work in browser environments only.")},n.prototype.generateAuthenticationResult=function(e,t,r,i){var o,a=Ne.EMPTY_STRING,l=[],h=null,p=(r!=null&&r.accessToken&&(a=r.accessToken.secret,l=pa.fromString(r.accessToken.target).asArray(),h=new Date(1e3*Number(r.accessToken.expiresOn)),o=new Date(1e3*Number(r.accessToken.extendedExpiresOn))),(t==null?void 0:t.claims.oid)||(t==null?void 0:t.claims.sub)||Ne.EMPTY_STRING),g=(t==null?void 0:t.claims.tid)||Ne.EMPTY_STRING;return{authority:i?i.canonicalAuthority:Ne.EMPTY_STRING,uniqueId:p,tenantId:g,scopes:l,account:r!=null&&r.account?r.account.getAccountInfo():null,idToken:t?t.rawToken:Ne.EMPTY_STRING,idTokenClaims:t?t.claims:{},accessToken:a,fromCache:!0,expiresOn:h,correlationId:e.correlationId||Ne.EMPTY_STRING,requestId:Ne.EMPTY_STRING,extExpiresOn:o,familyId:Ne.EMPTY_STRING,tokenType:((i=r==null?void 0:r.accessToken)==null?void 0:i.tokenType)||Ne.EMPTY_STRING,state:Ne.EMPTY_STRING,cloudGraphHostName:((p=r==null?void 0:r.account)==null?void 0:p.cloudGraphHostName)||Ne.EMPTY_STRING,msGraphHost:((g=r==null?void 0:r.account)==null?void 0:g.msGraphHost)||Ne.EMPTY_STRING,code:void 0,fromNativeBroker:!1}},n}(),eTe=function(n){function e(t){return t=n.call(this,t)||this,t.includeRedirectUri=!1,t}return ia(e,n),e}(kV),tTe=function(n){function e(t,r,i,o,a,l,h,p,g,_){return t=n.call(this,t,r,i,o,a,l,p,g,_)||this,t.apiId=h,t}return ia(e,n),e.prototype.acquireToken=function(t){return ft(this,void 0,void 0,function(){var r,i,o,a;return pt(this,function(l){switch(l.label){case 0:if(this.logger.trace("SilentAuthCodeClient.acquireToken called"),t.code)return this.performanceClient.setPreQueueTime(nt.StandardInteractionClientInitializeAuthorizationRequest,t.correlationId),[4,this.initializeAuthorizationRequest(t,gn.Silent)];throw Ht.createAuthCodeRequiredError();case 1:r=l.sent(),this.browserStorage.updateCacheEntries(r.state,r.nonce,r.authority,r.loginHint||Ne.EMPTY_STRING,r.account||null),i=this.initializeServerTelemetryManager(this.apiId),l.label=2;case 2:return l.trys.push([2,4,,5]),o=bn(bn({},r),{code:t.code}),this.performanceClient.setPreQueueTime(nt.StandardInteractionClientGetClientConfiguration,t.correlationId),[4,this.getClientConfiguration(i,r.authority)];case 3:return a=l.sent(),a=new eTe(a),this.logger.verbose("Auth code client created"),[2,new UV(a,this.browserStorage,o,this.logger,this.config.system,this.performanceClient).handleCodeResponseFromServer({code:t.code,msgraph_host:t.msGraphHost,cloud_graph_host_name:t.cloudGraphHostName,cloud_instance_host_name:t.cloudInstanceHostName},r.state,a.authority,this.networkClient,!1)];case 4:throw(a=l.sent())instanceof xn&&a.setCorrelationId(this.correlationId),i.cacheFailedRequest(a),this.browserStorage.cleanRequestByState(r.state),a;case 5:return[2]}})})},e.prototype.logout=function(){return Promise.reject(Ht.createSilentLogoutUnsupportedError())},e}(Sy),nTe=function(){function n(e){this.isBrowserEnvironment=typeof window<"u",this.config=DEe(e,this.isBrowserEnvironment),this.initialized=!1,this.logger=new ak(this.config.system.loggerOptions,u2,h0),this.networkClient=this.config.system.networkClient,this.navigationClient=this.config.system.navigationClient,this.redirectResponse=new Map,this.hybridAuthCodeResponses=new Map,this.performanceClient=this.isBrowserEnvironment?new QEe(this.config.auth.clientId,this.config.auth.authority,this.logger,u2,h0,this.config.telemetry.application,this.config.system.cryptoOptions):new TEe(this.config.auth.clientId,this.config.auth.authority,this.logger,u2,h0,this.config.telemetry.application),this.browserCrypto=this.isBrowserEnvironment?new XEe(this.logger,this.performanceClient,this.config.system.cryptoOptions):UE,this.eventHandler=new UEe(this.logger,this.browserCrypto),this.browserStorage=this.isBrowserEnvironment?new zP(this.config.auth.clientId,this.config.cache,this.browserCrypto,this.logger):AEe(this.config.auth.clientId,this.logger),e={cacheLocation:po.MemoryStorage,temporaryCacheLocation:po.MemoryStorage,storeAuthStateInCookie:!1,secureCookies:!1,cacheMigrationEnabled:!1,claimsBasedCachingEnabled:!0},this.nativeInternalStorage=new zP(this.config.auth.clientId,e,this.browserCrypto,this.logger),this.tokenCache=new JEe(this.config,this.browserStorage,this.logger,this.browserCrypto),this.trackPageVisibilityWithMeasurement=this.trackPageVisibilityWithMeasurement.bind(this)}return n.prototype.initialize=function(){return ft(this,void 0,void 0,function(){var e,t,r,i,o;return pt(this,function(a){switch(a.label){case 0:if(this.logger.trace("initialize called"),this.initialized)return this.logger.info("initialize has already been called, exiting early."),[2];if(e=this.config.system.allowNativeBroker,t=this.performanceClient.startMeasurement(nt.InitializeClientApplication),this.eventHandler.emitEvent(Bn.INITIALIZE_START),!e)return[3,4];a.label=1;case 1:return a.trys.push([1,3,,4]),r=this,[4,Uf.createProvider(this.logger,this.config.system.nativeBrokerHandshakeTimeout,this.performanceClient)];case 2:return r.nativeExtensionProvider=a.sent(),[3,4];case 3:return i=a.sent(),this.logger.verbose(i),[3,4];case 4:return this.config.cache.claimsBasedCachingEnabled?[3,6]:(this.logger.verbose("Claims-based caching is disabled. Clearing the previous cache with claims"),o=this.performanceClient.startMeasurement(nt.ClearTokensAndKeysWithClaims),[4,this.browserStorage.clearTokensAndKeysWithClaims()]);case 5:a.sent(),o.endMeasurement({success:!0}),a.label=6;case 6:return this.initialized=!0,this.eventHandler.emitEvent(Bn.INITIALIZE_END),t.endMeasurement({allowNativeBroker:e,success:!0}),[2]}})})},n.prototype.handleRedirectPromise=function(e){return ft(this,void 0,void 0,function(){var t,r,i,o,a,l=this;return pt(this,function(h){return this.logger.verbose("handleRedirectPromise called"),Yi.blockNativeBrokerCalledBeforeInitialized(this.config.system.allowNativeBroker,this.initialized),t=this.getAllAccounts(),this.isBrowserEnvironment?(r=e||Ne.EMPTY_STRING,(i=this.redirectResponse.get(r))===void 0?(this.eventHandler.emitEvent(Bn.HANDLE_REDIRECT_START,gn.Redirect),this.logger.verbose("handleRedirectPromise has been called for the first time, storing the promise"),a=this.browserStorage.getCachedNativeRequest(),o=void 0,o=a&&Uf.isNativeAvailable(this.config,this.logger,this.nativeExtensionProvider)&&this.nativeExtensionProvider&&!e?(this.logger.trace("handleRedirectPromise - acquiring token from native platform"),new Bm(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,_i.handleRedirectPromise,this.performanceClient,this.nativeExtensionProvider,a.accountId,this.nativeInternalStorage,a.correlationId).handleRedirectPromise()):(this.logger.trace("handleRedirectPromise - acquiring token from web flow"),a=this.browserStorage.getTemporaryCache(kr.CORRELATION_ID,!0)||Ne.EMPTY_STRING,this.createRedirectClient(a).handleRedirectPromise(e)),i=o.then(function(p){return p&&(t.length<l.getAllAccounts().length?(l.eventHandler.emitEvent(Bn.LOGIN_SUCCESS,gn.Redirect,p),l.logger.verbose("handleRedirectResponse returned result, login success")):(l.eventHandler.emitEvent(Bn.ACQUIRE_TOKEN_SUCCESS,gn.Redirect,p),l.logger.verbose("handleRedirectResponse returned result, acquire token success"))),l.eventHandler.emitEvent(Bn.HANDLE_REDIRECT_END,gn.Redirect),p}).catch(function(p){throw 0<t.length?l.eventHandler.emitEvent(Bn.ACQUIRE_TOKEN_FAILURE,gn.Redirect,null,p):l.eventHandler.emitEvent(Bn.LOGIN_FAILURE,gn.Redirect,null,p),l.eventHandler.emitEvent(Bn.HANDLE_REDIRECT_END,gn.Redirect),p}),this.redirectResponse.set(r,i)):this.logger.verbose("handleRedirectPromise has been called previously, returning the result from the first call"),[2,i]):(this.logger.verbose("handleRedirectPromise returns null, not browser environment"),[2,null])})})},n.prototype.acquireTokenRedirect=function(e){return ft(this,void 0,void 0,function(){var t,r,i=this;return pt(this,function(o){return t=this.getRequestCorrelationId(e),this.logger.verbose("acquireTokenRedirect called",t),this.preflightBrowserEnvironmentCheck(gn.Redirect),(r=0<this.getAllAccounts().length)?this.eventHandler.emitEvent(Bn.ACQUIRE_TOKEN_START,gn.Redirect,e):this.eventHandler.emitEvent(Bn.LOGIN_START,gn.Redirect,e),[2,(this.nativeExtensionProvider&&this.canUseNative(e)?new Bm(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,_i.acquireTokenRedirect,this.performanceClient,this.nativeExtensionProvider,this.getNativeAccountId(e),this.nativeInternalStorage,e.correlationId).acquireTokenRedirect(e).catch(function(a){if(a instanceof pl&&a.isFatal())return i.nativeExtensionProvider=void 0,i.createRedirectClient(e.correlationId).acquireToken(e);if(a instanceof rc)return i.logger.verbose("acquireTokenRedirect - Resolving interaction required error thrown by native broker by falling back to web flow"),i.createRedirectClient(e.correlationId).acquireToken(e);throw i.browserStorage.setInteractionInProgress(!1),a}):this.createRedirectClient(e.correlationId).acquireToken(e)).catch(function(a){throw r?i.eventHandler.emitEvent(Bn.ACQUIRE_TOKEN_FAILURE,gn.Redirect,null,a):i.eventHandler.emitEvent(Bn.LOGIN_FAILURE,gn.Redirect,null,a),a})]})})},n.prototype.acquireTokenPopup=function(e){var t=this,r=this.getRequestCorrelationId(e),i=this.performanceClient.startMeasurement(nt.AcquireTokenPopup,r);try{this.logger.verbose("acquireTokenPopup called",r),this.preflightBrowserEnvironmentCheck(gn.Popup)}catch(a){return Promise.reject(a)}var o=this.getAllAccounts();return 0<o.length?this.eventHandler.emitEvent(Bn.ACQUIRE_TOKEN_START,gn.Popup,e):this.eventHandler.emitEvent(Bn.LOGIN_START,gn.Popup,e),(this.canUseNative(e)?this.acquireTokenNative(e,_i.acquireTokenPopup).then(function(a){return t.browserStorage.setInteractionInProgress(!1),i.endMeasurement({success:!0,isNativeBroker:!0,requestId:a.requestId}),a}).catch(function(a){if(a instanceof pl&&a.isFatal())return t.nativeExtensionProvider=void 0,t.createPopupClient(e.correlationId).acquireToken(e);if(a instanceof rc)return t.logger.verbose("acquireTokenPopup - Resolving interaction required error thrown by native broker by falling back to web flow"),t.createPopupClient(e.correlationId).acquireToken(e);throw t.browserStorage.setInteractionInProgress(!1),a}):this.createPopupClient(e.correlationId).acquireToken(e)).then(function(a){return o.length<t.getAllAccounts().length?t.eventHandler.emitEvent(Bn.LOGIN_SUCCESS,gn.Popup,a):t.eventHandler.emitEvent(Bn.ACQUIRE_TOKEN_SUCCESS,gn.Popup,a),i.addStaticFields({accessTokenSize:a.accessToken.length,idTokenSize:a.idToken.length}),i.endMeasurement({success:!0,requestId:a.requestId}),a}).catch(function(a){return 0<o.length?t.eventHandler.emitEvent(Bn.ACQUIRE_TOKEN_FAILURE,gn.Popup,null,a):t.eventHandler.emitEvent(Bn.LOGIN_FAILURE,gn.Popup,null,a),i.endMeasurement({errorCode:a.errorCode,subErrorCode:a.subError,success:!1}),Promise.reject(a)})},n.prototype.trackPageVisibilityWithMeasurement=function(){var e=this.ssoSilentMeasurement||this.acquireTokenByCodeAsyncMeasurement;e&&(this.logger.info("Perf: Visibility change detected in ",e.event.name),e.increment({visibilityChangeCount:1}))},n.prototype.ssoSilent=function(e){var t;return ft(this,void 0,void 0,function(){var r,i,o=this;return pt(this,function(a){return r=this.getRequestCorrelationId(e),i=bn(bn({},e),{prompt:e.prompt,correlationId:r}),this.preflightBrowserEnvironmentCheck(gn.Silent),this.ssoSilentMeasurement=this.performanceClient.startMeasurement(nt.SsoSilent,r),(t=this.ssoSilentMeasurement)!=null&&t.increment({visibilityChangeCount:0}),document.addEventListener("visibilitychange",this.trackPageVisibilityWithMeasurement),this.logger.verbose("ssoSilent called",r),this.eventHandler.emitEvent(Bn.SSO_SILENT_START,gn.Silent,i),[2,(this.canUseNative(i)?this.acquireTokenNative(i,_i.ssoSilent).catch(function(l){if(l instanceof pl&&l.isFatal())return o.nativeExtensionProvider=void 0,o.createSilentIframeClient(i.correlationId).acquireToken(i);throw l}):this.createSilentIframeClient(i.correlationId).acquireToken(i)).then(function(l){var h;return o.eventHandler.emitEvent(Bn.SSO_SILENT_SUCCESS,gn.Silent,l),(h=o.ssoSilentMeasurement)!=null&&h.addStaticFields({accessTokenSize:l.accessToken.length,idTokenSize:l.idToken.length}),(h=o.ssoSilentMeasurement)!=null&&h.endMeasurement({success:!0,isNativeBroker:l.fromNativeBroker,requestId:l.requestId}),l}).catch(function(l){var h;throw o.eventHandler.emitEvent(Bn.SSO_SILENT_FAILURE,gn.Silent,null,l),(h=o.ssoSilentMeasurement)!=null&&h.endMeasurement({errorCode:l.errorCode,subErrorCode:l.subError,success:!1}),l}).finally(function(){document.removeEventListener("visibilitychange",o.trackPageVisibilityWithMeasurement)})]})})},n.prototype.acquireTokenByCode=function(e){return ft(this,void 0,void 0,function(){var t,r,i,o,a=this;return pt(this,function(l){t=this.getRequestCorrelationId(e),this.preflightBrowserEnvironmentCheck(gn.Silent),this.logger.trace("acquireTokenByCode called",t),this.eventHandler.emitEvent(Bn.ACQUIRE_TOKEN_BY_CODE_START,gn.Silent,e),r=this.performanceClient.startMeasurement(nt.AcquireTokenByCode,e.correlationId);try{if(e.code&&e.nativeAccountId)throw Ht.createSpaCodeAndNativeAccountIdPresentError();if(e.code)return i=e.code,(o=this.hybridAuthCodeResponses.get(i))?(this.logger.verbose("Existing acquireTokenByCode request found",e.correlationId),r.discardMeasurement()):(this.logger.verbose("Initiating new acquireTokenByCode request",t),o=this.acquireTokenByCodeAsync(bn(bn({},e),{correlationId:t})).then(function(h){return a.eventHandler.emitEvent(Bn.ACQUIRE_TOKEN_BY_CODE_SUCCESS,gn.Silent,h),a.hybridAuthCodeResponses.delete(i),r.addStaticFields({accessTokenSize:h.accessToken.length,idTokenSize:h.idToken.length}),r.endMeasurement({success:!0,isNativeBroker:h.fromNativeBroker,requestId:h.requestId}),h}).catch(function(h){throw a.hybridAuthCodeResponses.delete(i),a.eventHandler.emitEvent(Bn.ACQUIRE_TOKEN_BY_CODE_FAILURE,gn.Silent,null,h),r.endMeasurement({errorCode:h.errorCode,subErrorCode:h.subError,success:!1}),h}),this.hybridAuthCodeResponses.set(i,o)),[2,o];if(e.nativeAccountId){if(this.canUseNative(e,e.nativeAccountId))return[2,this.acquireTokenNative(e,_i.acquireTokenByCode,e.nativeAccountId).catch(function(h){throw h instanceof pl&&h.isFatal()&&(a.nativeExtensionProvider=void 0),h})];throw Ht.createUnableToAcquireTokenFromNativePlatformError()}throw Ht.createAuthCodeOrNativeAccountIdRequiredError()}catch(h){throw this.eventHandler.emitEvent(Bn.ACQUIRE_TOKEN_BY_CODE_FAILURE,gn.Silent,null,h),r.endMeasurement({errorCode:h instanceof xn&&h.errorCode||void 0,subErrorCode:h instanceof xn&&h.subError||void 0,success:!1}),h}return[2]})})},n.prototype.acquireTokenByCodeAsync=function(e){var t;return ft(this,void 0,void 0,function(){var r=this;return pt(this,function(i){switch(i.label){case 0:return this.logger.trace("acquireTokenByCodeAsync called",e.correlationId),this.acquireTokenByCodeAsyncMeasurement=this.performanceClient.startMeasurement(nt.AcquireTokenByCodeAsync,e.correlationId),(t=this.acquireTokenByCodeAsyncMeasurement)!=null&&t.increment({visibilityChangeCount:0}),document.addEventListener("visibilitychange",this.trackPageVisibilityWithMeasurement),[4,this.createSilentAuthCodeClient(e.correlationId).acquireToken(e).then(function(o){var a;return(a=r.acquireTokenByCodeAsyncMeasurement)!=null&&a.endMeasurement({success:!0,fromCache:o.fromCache,isNativeBroker:o.fromNativeBroker,requestId:o.requestId}),o}).catch(function(o){var a;throw(a=r.acquireTokenByCodeAsyncMeasurement)!=null&&a.endMeasurement({errorCode:o.errorCode,subErrorCode:o.subError,success:!1}),o}).finally(function(){document.removeEventListener("visibilitychange",r.trackPageVisibilityWithMeasurement)})];case 1:return[2,i.sent()]}})})},n.prototype.acquireTokenFromCache=function(e,t,r){return ft(this,void 0,void 0,function(){return pt(this,function(i){switch(this.performanceClient.addQueueMeasurement(nt.AcquireTokenFromCache,t.correlationId),r.cacheLookupPolicy){case Ja.Default:case Ja.AccessToken:case Ja.AccessTokenAndRefreshToken:return[2,e.acquireToken(t)];default:throw tn.createRefreshRequiredError()}return[2]})})},n.prototype.acquireTokenByRefreshToken=function(e,t){return ft(this,void 0,void 0,function(){var r;return pt(this,function(i){switch(this.performanceClient.addQueueMeasurement(nt.AcquireTokenByRefreshToken,e.correlationId),t.cacheLookupPolicy){case Ja.Default:case Ja.AccessTokenAndRefreshToken:case Ja.RefreshToken:case Ja.RefreshTokenAndNetwork:return r=this.createSilentRefreshClient(e.correlationId),this.performanceClient.setPreQueueTime(nt.SilentRefreshClientAcquireToken,e.correlationId),[2,r.acquireToken(e)];default:throw tn.createRefreshRequiredError()}return[2]})})},n.prototype.acquireTokenBySilentIframe=function(e){return ft(this,void 0,void 0,function(){var t;return pt(this,function(r){return this.performanceClient.addQueueMeasurement(nt.AcquireTokenBySilentIframe,e.correlationId),t=this.createSilentIframeClient(e.correlationId),this.performanceClient.setPreQueueTime(nt.SilentIframeClientAcquireToken,e.correlationId),[2,t.acquireToken(e)]})})},n.prototype.logout=function(e){return ft(this,void 0,void 0,function(){var t;return pt(this,function(r){return t=this.getRequestCorrelationId(e),this.logger.warning("logout API is deprecated and will be removed in msal-browser v3.0.0. Use logoutRedirect instead.",t),[2,this.logoutRedirect(bn({correlationId:t},e))]})})},n.prototype.logoutRedirect=function(e){return ft(this,void 0,void 0,function(){var t;return pt(this,function(r){return t=this.getRequestCorrelationId(e),this.preflightBrowserEnvironmentCheck(gn.Redirect),[2,this.createRedirectClient(t).logout(e)]})})},n.prototype.logoutPopup=function(e){try{var t=this.getRequestCorrelationId(e);return this.preflightBrowserEnvironmentCheck(gn.Popup),this.createPopupClient(t).logout(e)}catch(r){return Promise.reject(r)}},n.prototype.getAllAccounts=function(){return this.logger.verbose("getAllAccounts called"),this.isBrowserEnvironment?this.browserStorage.getAllAccounts():[]},n.prototype.getAccountByUsername=function(e){var t;return this.logger.trace("getAccountByUsername called"),e?(t=this.browserStorage.getAccountInfoFilteredBy({username:e}))?(this.logger.verbose("getAccountByUsername: Account matching username found, returning"),this.logger.verbosePii("getAccountByUsername: Returning signed-in accounts matching username: "+e),t):(this.logger.verbose("getAccountByUsername: No matching account found, returning null"),null):(this.logger.warning("getAccountByUsername: No username provided"),null)},n.prototype.getAccountByHomeId=function(e){var t;return this.logger.trace("getAccountByHomeId called"),e?(t=this.browserStorage.getAccountInfoFilteredBy({homeAccountId:e}))?(this.logger.verbose("getAccountByHomeId: Account matching homeAccountId found, returning"),this.logger.verbosePii("getAccountByHomeId: Returning signed-in accounts matching homeAccountId: "+e),t):(this.logger.verbose("getAccountByHomeId: No matching account found, returning null"),null):(this.logger.warning("getAccountByHomeId: No homeAccountId provided"),null)},n.prototype.getAccountByLocalId=function(e){var t;return this.logger.trace("getAccountByLocalId called"),e?(t=this.browserStorage.getAccountInfoFilteredBy({localAccountId:e}))?(this.logger.verbose("getAccountByLocalId: Account matching localAccountId found, returning"),this.logger.verbosePii("getAccountByLocalId: Returning signed-in accounts matching localAccountId: "+e),t):(this.logger.verbose("getAccountByLocalId: No matching account found, returning null"),null):(this.logger.warning("getAccountByLocalId: No localAccountId provided"),null)},n.prototype.setActiveAccount=function(e){this.browserStorage.setActiveAccount(e)},n.prototype.getActiveAccount=function(){return this.browserStorage.getActiveAccount()},n.prototype.preflightBrowserEnvironmentCheck=function(e,t){if(t===void 0&&(t=!0),this.logger.verbose("preflightBrowserEnvironmentCheck started"),Yi.blockNonBrowserEnvironment(this.isBrowserEnvironment),Yi.blockRedirectInIframe(e,this.config.system.allowRedirectInIframe),Yi.blockReloadInHiddenIframes(),Yi.blockAcquireTokenInPopups(),Yi.blockNativeBrokerCalledBeforeInitialized(this.config.system.allowNativeBroker,this.initialized),e===gn.Redirect&&this.config.cache.cacheLocation===po.MemoryStorage&&!this.config.cache.storeAuthStateInCookie)throw WE.createInMemoryRedirectUnavailableError();e!==gn.Redirect&&e!==gn.Popup||this.preflightInteractiveRequest(t)},n.prototype.preflightInteractiveRequest=function(e){this.logger.verbose("preflightInteractiveRequest called, validating app environment"),Yi.blockReloadInHiddenIframes(),e&&this.browserStorage.setInteractionInProgress(!0)},n.prototype.acquireTokenNative=function(e,t,r){return ft(this,void 0,void 0,function(){return pt(this,function(i){if(this.logger.trace("acquireTokenNative called"),this.nativeExtensionProvider)return[2,new Bm(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,t,this.performanceClient,this.nativeExtensionProvider,r||this.getNativeAccountId(e),this.nativeInternalStorage,e.correlationId).acquireToken(e)];throw Ht.createNativeConnectionNotEstablishedError()})})},n.prototype.canUseNative=function(e,t){if(this.logger.trace("canUseNative called"),!Uf.isNativeAvailable(this.config,this.logger,this.nativeExtensionProvider,e.authenticationScheme))return this.logger.trace("canUseNative: isNativeAvailable returned false, returning false"),!1;if(e.prompt)switch(e.prompt){case ya.NONE:case ya.CONSENT:case ya.LOGIN:this.logger.trace("canUseNative: prompt is compatible with native flow");break;default:return this.logger.trace("canUseNative: prompt = "+e.prompt+" is not compatible with native flow, returning false"),!1}return!(!t&&!this.getNativeAccountId(e)&&(this.logger.trace("canUseNative: nativeAccountId is not available, returning false"),1))},n.prototype.getNativeAccountId=function(e){return e=e.account||this.browserStorage.getAccountInfoByHints(e.loginHint,e.sid)||this.getActiveAccount(),e&&e.nativeAccountId||""},n.prototype.createPopupClient=function(e){return new REe(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,this.performanceClient,this.nativeInternalStorage,this.nativeExtensionProvider,e)},n.prototype.createRedirectClient=function(e){return new MEe(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,this.performanceClient,this.nativeInternalStorage,this.nativeExtensionProvider,e)},n.prototype.createSilentIframeClient=function(e){return new FEe(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,_i.ssoSilent,this.performanceClient,this.nativeInternalStorage,this.nativeExtensionProvider,e)},n.prototype.createSilentCacheClient=function(e){return new BV(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,this.performanceClient,this.nativeExtensionProvider,e)},n.prototype.createSilentRefreshClient=function(e){return new BEe(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,this.performanceClient,this.nativeExtensionProvider,e)},n.prototype.createSilentAuthCodeClient=function(e){return new tTe(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,_i.acquireTokenByCode,this.performanceClient,this.nativeExtensionProvider,e)},n.prototype.addEventCallback=function(e){return this.eventHandler.addEventCallback(e)},n.prototype.removeEventCallback=function(e){this.eventHandler.removeEventCallback(e)},n.prototype.addPerformanceCallback=function(e){return this.performanceClient.addPerformanceCallback(e)},n.prototype.removePerformanceCallback=function(e){return this.performanceClient.removePerformanceCallback(e)},n.prototype.enableAccountStorageEvents=function(){this.eventHandler.enableAccountStorageEvents()},n.prototype.disableAccountStorageEvents=function(){this.eventHandler.disableAccountStorageEvents()},n.prototype.getTokenCache=function(){return this.tokenCache},n.prototype.getLogger=function(){return this.logger},n.prototype.setLogger=function(e){this.logger=e},n.prototype.initializeWrapperLibrary=function(e,t){this.browserStorage.setWrapperMetadata(e,t)},n.prototype.setNavigationClient=function(e){this.navigationClient=e},n.prototype.getConfiguration=function(){return this.config},n.prototype.getRequestCorrelationId=function(e){return e!=null&&e.correlationId?e.correlationId:this.isBrowserEnvironment?this.browserCrypto.createNewGuid():Ne.EMPTY_STRING},n}(),rTe=function(n){function e(t){return t=n.call(this,t)||this,t.astsAsyncMeasurement=void 0,t.activeSilentTokenRequests=new Map,t.trackPageVisibility=t.trackPageVisibility.bind(t),t}return ia(e,n),e.prototype.loginRedirect=function(t){return ft(this,void 0,void 0,function(){var r;return pt(this,function(i){return r=this.getRequestCorrelationId(t),this.logger.verbose("loginRedirect called",r),[2,this.acquireTokenRedirect(bn({correlationId:r},t||JF))]})})},e.prototype.loginPopup=function(t){var r=this.getRequestCorrelationId(t);return this.logger.verbose("loginPopup called",r),this.acquireTokenPopup(bn({correlationId:r},t||JF))},e.prototype.acquireTokenSilent=function(t){return ft(this,void 0,void 0,function(){var r,i,o,a,l,h=this;return pt(this,function(p){if(r=this.getRequestCorrelationId(t),(i=this.performanceClient.startMeasurement(nt.AcquireTokenSilent,r)).addStaticFields({cacheLookupPolicy:t.cacheLookupPolicy}),this.preflightBrowserEnvironmentCheck(gn.Silent),this.logger.verbose("acquireTokenSilent called",r),l=t.account||this.getActiveAccount())return a={clientId:this.config.auth.clientId,authority:t.authority||Ne.EMPTY_STRING,scopes:t.scopes,homeAccountIdentifier:l.homeAccountId,claims:t.claims,authenticationScheme:t.authenticationScheme,resourceRequestMethod:t.resourceRequestMethod,resourceRequestUri:t.resourceRequestUri,shrClaims:t.shrClaims,sshKid:t.sshKid},o=JSON.stringify(a),(a=this.activeSilentTokenRequests.get(o))===void 0?(this.logger.verbose("acquireTokenSilent called for the first time, storing active request",r),this.performanceClient.setPreQueueTime(nt.AcquireTokenSilentAsync,r),l=this.acquireTokenSilentAsync(bn(bn({},t),{correlationId:r}),l).then(function(g){return h.activeSilentTokenRequests.delete(o),i.addStaticFields({accessTokenSize:g.accessToken.length,idTokenSize:g.idToken.length}),i.endMeasurement({success:!0,fromCache:g.fromCache,isNativeBroker:g.fromNativeBroker,cacheLookupPolicy:t.cacheLookupPolicy,requestId:g.requestId}),g}).catch(function(g){throw h.activeSilentTokenRequests.delete(o),i.endMeasurement({errorCode:g.errorCode,subErrorCode:g.subError,success:!1}),g}),this.activeSilentTokenRequests.set(o,l),[2,l]):(this.logger.verbose("acquireTokenSilent has been called previously, returning the result from the first call",r),i.discardMeasurement(),[2,a]);throw Ht.createNoAccountError()})})},e.prototype.trackPageVisibility=function(){this.astsAsyncMeasurement&&(this.logger.info("Perf: Visibility change detected"),this.astsAsyncMeasurement.increment({visibilityChangeCount:1}))},e.prototype.acquireTokenSilentAsync=function(t,r){var i;return ft(this,void 0,void 0,function(){var o,a,l,h,p=this;return pt(this,function(g){switch(g.label){case 0:return this.performanceClient.addQueueMeasurement(nt.AcquireTokenSilentAsync,t.correlationId),this.eventHandler.emitEvent(Bn.ACQUIRE_TOKEN_START,gn.Silent,t),this.astsAsyncMeasurement=this.performanceClient.startMeasurement(nt.AcquireTokenSilentAsync,t.correlationId),(i=this.astsAsyncMeasurement)!=null&&i.increment({visibilityChangeCount:0}),document.addEventListener("visibilitychange",this.trackPageVisibility),Uf.isNativeAvailable(this.config,this.logger,this.nativeExtensionProvider,t.authenticationScheme)&&r.nativeAccountId?(this.logger.verbose("acquireTokenSilent - attempting to acquire token from native platform"),o=bn(bn({},t),{account:r}),o=this.acquireTokenNative(o,_i.acquireTokenSilent_silentFlow).catch(function(_){return ft(p,void 0,void 0,function(){return pt(this,function(x){if(_ instanceof pl&&_.isFatal())return this.logger.verbose("acquireTokenSilent - native platform unavailable, falling back to web flow"),this.nativeExtensionProvider=void 0,[2,this.createSilentIframeClient(t.correlationId).acquireToken(t)];throw _})})}),[3,3]):[3,1];case 1:return this.logger.verbose("acquireTokenSilent - attempting to acquire token from web flow"),a=this.createSilentCacheClient(t.correlationId),this.performanceClient.setPreQueueTime(nt.InitializeSilentRequest,t.correlationId),[4,a.initializeSilentRequest(t,r)];case 2:l=g.sent(),h=bn(bn({},t),{cacheLookupPolicy:t.cacheLookupPolicy||Ja.Default}),this.performanceClient.setPreQueueTime(nt.AcquireTokenFromCache,l.correlationId),o=this.acquireTokenFromCache(a,l,h).catch(function(_){if(h.cacheLookupPolicy===Ja.AccessToken)throw _;return Yi.blockReloadInHiddenIframes(),p.eventHandler.emitEvent(Bn.ACQUIRE_TOKEN_NETWORK_START,gn.Silent,l),p.performanceClient.setPreQueueTime(nt.AcquireTokenByRefreshToken,l.correlationId),p.acquireTokenByRefreshToken(l,h).catch(function(x){var C=x instanceof Jf,M=x instanceof rc,L=x.errorCode===fm.noTokensFoundError.code,D=x.errorCode===Ec.INVALID_GRANT_ERROR;if(C&&D&&!M&&h.cacheLookupPolicy!==Ja.AccessTokenAndRefreshToken&&h.cacheLookupPolicy!==Ja.RefreshToken||h.cacheLookupPolicy===Ja.Skip||L)return p.logger.verbose("Refresh token expired/invalid or CacheLookupPolicy is set to Skip, attempting acquire token by iframe.",t.correlationId),p.performanceClient.setPreQueueTime(nt.AcquireTokenBySilentIframe,l.correlationId),p.acquireTokenBySilentIframe(l);throw x})}),g.label=3;case 3:return[2,o.then(function(_){var x;return p.eventHandler.emitEvent(Bn.ACQUIRE_TOKEN_SUCCESS,gn.Silent,_),(x=p.astsAsyncMeasurement)!=null&&x.endMeasurement({success:!0,fromCache:_.fromCache,isNativeBroker:_.fromNativeBroker,requestId:_.requestId}),_}).catch(function(_){var x;throw p.eventHandler.emitEvent(Bn.ACQUIRE_TOKEN_FAILURE,gn.Silent,null,_),(x=p.astsAsyncMeasurement)!=null&&x.endMeasurement({errorCode:_.errorCode,subErrorCode:_.subError,success:!1}),_}).finally(function(){document.removeEventListener("visibilitychange",p.trackPageVisibility)})]}})})},e}(nTe);function VP(n){this.message=n}VP.prototype=new Error,VP.prototype.name="InvalidCharacterError";var o5=typeof window<"u"&&window.atob&&window.atob.bind(window)||function(n){var e=String(n).replace(/=+$/,"");if(e.length%4==1)throw new VP("'atob' failed: The string to be decoded is not correctly encoded.");for(var t,r,i=0,o=0,a="";r=e.charAt(o++);~r&&(t=i%4?64*t+r:r,i++%4)&&(a+=String.fromCharCode(255&t>>(-2*i&6))))r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(r);return a};function iTe(n){var e=n.replace(/-/g,"+").replace(/_/g,"/");switch(e.length%4){case 0:break;case 2:e+="==";break;case 3:e+="=";break;default:throw"Illegal base64url string!"}try{return decodeURIComponent(o5(e).replace(/(.)/g,function(t,r){return r=r.charCodeAt(0).toString(16).toUpperCase(),"%"+(r=r.length<2?"0"+r:r)}))}catch{return o5(e)}}function YE(n){this.message=n}function oTe(n,e){if(typeof n!="string")throw new YE("Invalid token specified");e=(e=e||{}).header===!0?0:1;try{return JSON.parse(iTe(n.split(".")[e]))}catch(t){throw new YE("Invalid token specified: "+t.message)}}YE.prototype=new Error,YE.prototype.name="InvalidTokenError";var aTe=function(){function n(e){var t=this,r=(this.fallbackStorage={},this._triggerTokenFetch=function(i){return i===void 0&&(i=!1),new Promise(function(o,a){typeof t.options.getToken!="function"?a(new Error("Token cannot be ".concat(i?"fetched":"renewed"," because getToken was not set or is not a function."))):t.options.getToken(function(l){try{var h=t._getTokenExpiry(l)-n.constants.tokenRefreshClockSkew;t._storeToken(l),t._setTimeoutTokenFetch(h),o()}catch{a(new Error("Invalid token returned by getToken function"))}},function(l){a(l)},t.map)})},this._setTimeoutTokenFetch=function(i){clearTimeout(t.tokenTimeOutHandle),t.tokenTimeOutHandle=setTimeout(t._triggerTokenFetch,Math.min(1e3*i,2147483647))},e.getServiceOptions());this.options=r.authOptions,this.sessionId=r.sessionId,this.map=e}return n.prototype.initialize=function(){var e=this;return this.initPromise||(this.initPromise=new Promise(function(t,r){if(e.options.authType===li.subscriptionKey)t();else if(e.options.authType===li.aad)e.options.authContext=e.options.authContext||n.getDefaultAuthContext(e.options),e.options.authContext.handleRedirectPromise().then(function(){setTimeout(function(){return e._loginAndAcquireTokenForAAD(t,r)})}).catch(function(o){r(new Error("Error logging in the AAD users: "+o))});else if(e.options.authType===li.anonymous)t(e._triggerTokenFetch(!0));else if(e.options.authType===li.sas){if(e.options.sasToken){var i=-1;try{i=e._getTokenExpiry(e.options.sasToken)}catch{return void r(new Error("An invalid sasToken was provided."))}if(i>n.constants.tokenRefreshClockSkew)return e._storeToken(e.options.sasToken),e._setTimeoutTokenFetch(i-n.constants.tokenRefreshClockSkew),void t()}t(e._triggerTokenFetch())}else r(new Error("An invalid authentication type was specified."))})),this.initPromise},n.prototype.dispose=function(){this.tokenTimeOutHandle&&(clearTimeout(this.tokenTimeOutHandle),this.tokenTimeOutHandle=null)},n.getDefaultAuthContext=function(e){if(!e.aadAppId)throw new Error("No AAD app ID was specified.");if(e.aadTenant)return this.defaultAuthContext||(this.defaultAuthContext=new rTe({auth:{authority:"".concat(e.aadInstance||Rc.aadInstance).concat(e.aadTenant),clientId:e.aadAppId},cache:{cacheLocation:this.constants.preferredCacheLocation}})),this.defaultAuthContext;throw new Error("No AAD tenant was specified.")},n.prototype._loginAndAcquireTokenForAAD=function(e,t){var r=((r=this.options.authContext)==null?void 0:r.getAllAccounts())||[];r.length===0?(this.options.authContext.loginRedirect(),e()):(this.options.authContext.setActiveAccount(r[0]),this._acquireTokenForAAD(e,t))},n.prototype._acquireTokenForAAD=function(e,t){var r=this,i={scopes:[Nn.aadResourceId]};this.options.authContext.acquireTokenSilent(i).then(function(o){r._saveItem(n.constants.storage.tokenKey,o.accessToken);var a={map:r.map,type:n.constants.events.tokenAcquired},a=(r.map.events.invoke(n.constants.events.tokenAcquired,a),clearTimeout(r.tokenTimeOutHandle),new Date(o.expiresOn).getTime()-Date.now());r.tokenTimeOutHandle=setTimeout(function(){return r._acquireTokenForAAD()},a),e!=null&&e()}).catch(function(o){if(o instanceof rc)return r.options.authContext.acquireTokenRedirect(i),e==null?void 0:e();t!=null&&t(o)})},n.prototype.getAuthType=function(){return this.options.authType},n.prototype.getClientId=function(){return this.options.clientId},n.prototype.getToken=function(){if(this.options.authType===li.aad)return this._getItem(n.constants.storage.tokenKey);if(this.options.authType!==li.anonymous&&this.options.authType!==li.sas)return this.options.authType===li.subscriptionKey?this.options.subscriptionKey:void 0;var e=this._getItem(n.constants.storage.tokenKey);if(e){var t=this._getTokenExpiry(e);if(t<300&&0<t)this._triggerTokenFetch();else if(t<=0)throw this._saveItem(n.constants.storage.tokenKey,""),new Error(n.constants.errors.tokenExpired)}else this._triggerTokenFetch();return e},n.prototype._getTokenExpiry=function(t){var t=oTe(t).exp,r=this._getCurrentTime();return 0<t-r?t-r:-1},n.prototype._storeToken=function(e){this._saveItem(n.constants.storage.tokenKey,e),e={map:this.map,type:n.constants.events.tokenAcquired},this.map.events.invoke(n.constants.events.tokenAcquired,e)},n.prototype._saveItem=function(e,t){return this._supportsLocalStorage()?localStorage.setItem(e,t):this._supportsSessionStorage()?sessionStorage.setItem(e,t):this.fallbackStorage[e]=t,!0},n.prototype._getItem=function(e){return this._supportsLocalStorage()?localStorage.getItem(e):this._supportsSessionStorage()?sessionStorage.getItem(e):e in this.fallbackStorage?this.fallbackStorage[e]:null},n.prototype._supportsLocalStorage=function(){try{return window.localStorage?(window.localStorage.setItem(n.constants.storage.testStorageKey,"A"),window.localStorage.getItem(n.constants.storage.testStorageKey)==="A"&&(window.localStorage.removeItem(n.constants.storage.testStorageKey),!window.localStorage.getItem(n.constants.storage.testStorageKey))):!1}catch{return!1}},n.prototype._supportsSessionStorage=function(){try{return window.sessionStorage?(window.sessionStorage.setItem(n.constants.storage.testStorageKey,"A"),window.sessionStorage.getItem(n.constants.storage.testStorageKey)==="A"&&(window.sessionStorage.removeItem(n.constants.storage.testStorageKey),!window.sessionStorage.getItem(n.constants.storage.testStorageKey))):!1}catch{return!1}},n.prototype._getCurrentTime=function(){return Math.round(new Date().getTime()/1e3)},n.prototype.signRequest=function(e){e.headers=e.headers||{},e.headers[Nn.sessionIdHeaderName]=this.sessionId,e.headers[Nn.msOriginHeaderName]=Nn.msOriginHeaderValue,e.headers[Nn.mapAgentHeaderName]="MapControl/".concat(kh," (Web)");var t=this.getToken();switch(this.options.authType){case li.aad:case li.anonymous:e.headers[Nn.msClientIdHeaderName]=this.options.clientId,e.headers[Nn.authorizationHeaderName]=Nn.authorizationTokenPrefix+t;break;case li.sas:e.headers[Nn.authorizationHeaderName]=Nn.jwtSasPrefix+t;break;case li.subscriptionKey:e.headers["subscription-key"]=t;break;default:throw new Error("An invalid authentication type was specified")}return e},n.constants={preferredCacheLocation:"localStorage",storage:{tokenKey:"access.token.key",testStorageKey:"testStorage"},events:{tokenAcquired:"tokenacquired"},tokenExpiresIn:3599,tokenRefreshClockSkew:300,errors:{tokenExpired:"Token Expired, Try again"}},n}(),a5=window&&window.__values||function(n){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&n[e],r=0;if(t)return t.call(n);if(n&&typeof n.length=="number")return{next:function(){return{value:(n=n&&r>=n.length?void 0:n)&&n[r++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},sTe=function(){function n(e){for(var t in this.map=e,this.controlContainer=document.createElement("div"),this.controlContainer.classList.add("atlas-control-container"),Fa){var r;Fa.hasOwnProperty(t)&&((r=document.createElement("div")).classList.add(Fa[t]),r.classList.add("subcontrol-container"),this.controlContainer.appendChild(r))}this.map.getMapContainer().appendChild(this.controlContainer),this.controls=new Set}return n.prototype.add=function(e,t){var r,i;if(Array.isArray(e))try{for(var o=a5(e),a=o.next();!a.done;a=o.next()){var l=a.value;this._add(l,t)}}catch(h){r={error:h}}finally{try{a&&!a.done&&(i=o.return)&&i.call(o)}finally{if(r)throw r.error}}else this._add(e,t)},n.prototype.getControls=function(){return Array.from(this.controls)},n.prototype.remove=function(e){var t,r;if(Array.isArray(e))try{for(var i=a5(e),o=i.next();!o.done;o=i.next()){var a=o.value;this._remove(a)}}catch(l){t={error:l}}finally{try{o&&!o.done&&(r=i.return)&&r.call(i)}finally{if(t)throw t.error}}else this._remove(e)},n.prototype._add=function(i,o){this.controls.add(i);var r=new Dae().merge(o),i=i.onAdd(this.map,o),o=this.controlContainer.getElementsByClassName(r.position);if(!(0<o.length))throw new Error("Control position ".concat(r.position," does not exist."));o.item(0).appendChild(i)},n.prototype._remove=function(e){e.onRemove(),this.controls.delete(e)},n}(),Zg=window&&window.__assign||function(){return(Zg=Object.assign||function(n){for(var e,t=1,r=arguments.length;t<r;t++)for(var i in e=arguments[t])Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i]);return n}).apply(this,arguments)},cTe=function(){function n(e){this.callbacks=new Ls,this.map=e}return n.prototype.addCallback=function(e,t,r,i,o){var a,l,h=this;if(i)a=function(C){var g=C.lngLat?new Xo(C.lngLat.lng,C.lngLat.lat):void 0,_=C.point?[C.point.x,C.point.y]:void 0,x=C.features?C.features.map(function(M){return new Pc(M.geometry,M.properties,M.id)}):[],C={type:C.type,originalEvent:C.originalEvent,position:g,coordinate:_,features:x};r(C)};else switch(e){case"data":case"sourcedata":case"styledata":a=function(p){p=Zg(Zg({dataType:p.dataType},p.dataType==="source"&&Zg(Zg(Zg({isSourceLoaded:p.isSourceLoaded},p.sourceDataType&&{sourceDataType:p.sourceDataType}),{source:h.map.sources.getById(p.sourceId)}),p.tile&&{tile:{id:{x:p.tile.tileID.canonical.x,y:p.tile.tileID.canonical.y,z:p.tile.tileID.canonical.z},size:p.tile.tileSize,state:p.tile.state}})),{map:h.map,type:p.type}),o&&h.map.events._removeListener(e,t,r),r(p)};break;case"error":a=function(p){p={error:p.error,map:h.map,type:p.type},o&&h.map.events._removeListener(e,t,r),r(p)};break;case"touchstart":case"touchend":case"touchmove":case"touchcancel":a=function(p){if(p.originalEvent){if(p.originalEvent===l)return;l=p.originalEvent}var M=p.point?new ta(p.point.x,p.point.y):void 0,g=p.points?p.points.map(function(L){return new ta(L.x,L.y)}):[],_=p.lngLat?new Xo(p.lngLat.lng,p.lngLat.lat):void 0,x=p.lngLats?p.lngLats.map(function(L){return new Xo(L.lng,L.lat)}):[],C=_?h.map.layers.getRenderedShapes(new Mc(_),t?[t]:void 0):[],M={map:h.map,originalEvent:p.originalEvent,pixel:M,pixels:g,position:_,positions:x,shapes:C,layerId:t||void 0,preventDefault:function(){return p.preventDefault()},type:p.type};o&&h.map.events._removeListener(e,t,r),r(M)};break;case"mousedown":case"mouseup":case"mouseover":case"mousemove":case"click":case"dblclick":case"mouseout":case"mouseenter":case"mouseleave":case"contextmenu":a=function(p){if(p.originalEvent){if(p.originalEvent===l)return;l=p.originalEvent}var x=p.lngLat?new Xo(p.lngLat.lng,p.lngLat.lat):void 0,g=p.point?new ta(p.point.x,p.point.y):void 0,_=x?h.map.layers.getRenderedShapes(new Mc(x),t?[t]:void 0):[],x={map:h.map,originalEvent:p.originalEvent,position:x,pixel:g,preventDefault:function(){return p.preventDefault()},shapes:_,layerId:t||void 0,type:p.type};o&&h.map.events._removeListener(e,t,r),r(x)};break;case"styleimagemissing":a=function(p){o&&h.map.events._removeListener(e,t,r),r(p.id)};break;case"wheel":a=function(p){if(p.originalEvent){if(p.originalEvent===l)return;l=p.originalEvent}var g={map:h.map,originalEvent:p.originalEvent,preventDefault:function(){return p.preventDefault()},type:p.type};o&&h.map.events._removeListener(e,t,r),r(g)};break;case"resize":a=function(p){var g,_={map:h.map,type:p.type};for(g in p)g!=="type"&&g!=="target"&&(_[g]=p[g]);o&&h.map.events._removeListener(e,t,r),r(_)};break;default:a=function(p){var g={map:h.map,type:p.type};p.originalEvent&&(g.originalEvent=p.originalEvent),o&&h.map.events._removeListener(e,t,r),r(g)}}this.callbacks.has(t)||this.callbacks.set(t,new Ls),this.callbacks.get(t).has(e)||this.callbacks.get(t).set(e,new Map),this.callbacks.get(t).get(e).set(r,[a,o])},n.prototype.removeCallback=function(e,t,r){this.callbacks.has(t)&&this.callbacks.get(t).has(e)&&this.callbacks.get(t).get(e).has(r)&&this.callbacks.get(t).get(e).delete(r)},n.prototype.getModifiedCallback=function(e,t,r){if(this.callbacks.has(t)&&this.callbacks.get(t).has(e)&&this.callbacks.get(t).get(e).has(r))return this.callbacks.get(t).get(e).get(r)[0]},n.prototype.getLayerCallbacks=function(e){if(this.callbacks.has(e))return this.callbacks.get(e)},n.prototype.getEventCallbacks=function(e,t){if(this.callbacks.has(t)&&(t=this.callbacks.get(t),t.has(e)))return t.get(e)},n}(),Jd=window&&window.__values||function(n){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&n[e],r=0;if(t)return t.call(n);if(n&&typeof n.length=="number")return{next:function(){return{value:(n=n&&r>=n.length?void 0:n)&&n[r++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},h2=window&&window.__read||function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var r,i,o=t.call(n),a=[];try{for(;(e===void 0||0<e--)&&!(r=o.next()).done;)a.push(r.value)}catch(l){i={error:l}}finally{try{r&&!r.done&&(t=o.return)&&t.call(o)}finally{if(i)throw i.error}}return a},s5=["maxzoomchanged","minzoomchanged","mapconfigurationchanged"],lTe=function(){function n(e){this.map=e,this.mapCallbackHandler=new cTe(this.map)}return n.prototype.add=function(e,t,r){var i,o;if(typeof t=="function")this._addGlobalListener(e,t,!1,!1);else{t=Array.isArray(t)?t:[t];try{for(var a=Jd(t),l=a.next();!l.done;l=a.next()){var h=l.value;h instanceof Ai&&Ai._isMBoxEvent(e)?this._addLayerListener(e,h,r,!1,!1):h._addEventListener(e,r,!1)}}catch(p){i={error:p}}finally{try{l&&!l.done&&(o=a.return)&&o.call(a)}finally{if(i)throw i.error}}}},n.prototype.addOnce=function(e,t,r){typeof t=="function"?this._addGlobalListener(e,t,!1,!0):t instanceof Ai&&Ai._isMBoxEvent(e)?this._addLayerListener(e,t,r,!1,!0):t._addEventListener(e,r,!0)},n.prototype._addLegacy=function(e,t,r){typeof t=="function"?this._addGlobalListener(e,t,!0,!1):this._addLayerListener(e,t,r,!0,!1)},n.prototype._addLayerListener=function(e,g,r,i,o){var a,l,h,p,g=g instanceof Ai?g.getId():g,_=this.map.layers.getLayerById(g),x=this.mapCallbackHandler.getModifiedCallback(e,g,r);if(x&&_)try{for(var C=Jd(_._getLayerIds()),M=C.next();!M.done;M=C.next()){var L=M.value;this.map._getMap().off(e,L,x)}}catch(te){a={error:te}}finally{try{M&&!M.done&&(l=C.return)&&l.call(C)}finally{if(a)throw a.error}}if(this.mapCallbackHandler.addCallback(e,g,r,i,o),_){x=this.mapCallbackHandler.getModifiedCallback(e,g,r);try{for(var D=Jd(_._getLayerIds()),z=D.next();!z.done;z=D.next())L=z.value,this.map._getMap().on(e,L,x)}catch(te){h={error:te}}finally{try{z&&!z.done&&(p=D.return)&&p.call(D)}finally{if(h)throw h.error}}}},n.prototype._addGlobalListener=function(e,t,r,i){var o,a,l,h;s5.includes(e)?this.map._addEventListener(e,t,i):(o=this.mapCallbackHandler.getModifiedCallback(e,"",t),this.mapCallbackHandler.addCallback(e,"",t,r,i),a=this.mapCallbackHandler.getModifiedCallback(e,"",t),e==="load"&&this.map._isLoaded()?(l={type:"load",map:this.map},setTimeout(function(){return a(l)})):e==="ready"?this.map._isReady()&&(h={type:"ready",map:this.map},setTimeout(function(){return a(h)})):(o&&this.map._getMap().off(e,o),this.map._getMap().on(e,a)))},n.prototype.invoke=function(e,t,r){if(r===void 0)this._invokeListeners(e,"",t);else if(t instanceof Ai&&Ai._isMBoxEvent(e))this._invokeListeners(e,t.getId(),r);else{if(!(t instanceof Du))throw new Error("The invoke target is invalid.");t._invokeEvent(e,r)}},n.prototype._invokeListeners=function(e,t,r){var i=this,o=new Ls(this.mapCallbackHandler.getEventCallbacks(e,t));o?o.forEach(function(a,l){a=h2(a,2),a[0],a[1]&&i._removeListener(e,t,l),l(r)}):e==="error"&&console.error("error"in r?r.error:r)},n.prototype.remove=function(e,t,r){var i,o;if(typeof t=="function")this._removeListener(e,"",t);else{t=Array.isArray(t)?t:[t];try{for(var a=Jd(t),l=a.next();!l.done;l=a.next()){var h=l.value;h instanceof Ai&&Ai._isMBoxEvent(e)?this._removeListener(e,h,r):h!=null&&h._removeEventListener(e,r)}}catch(p){i={error:p}}finally{try{l&&!l.done&&(o=a.return)&&o.call(a)}finally{if(i)throw i.error}}}},n.prototype._removeLegacy=function(e,t,r){typeof t=="function"?this._removeListener(e,"",t):this._removeListener(e,t,r)},n.prototype._removeListener=function(e,t,r){var i,o;if(s5.includes(e))this.map._removeEventListener(e,r);else{var t=t instanceof Ai?t.getId():t,a=this.mapCallbackHandler.getModifiedCallback(e,t,r);if(a)if(t){var l=this.map.layers.getLayerById(t);if(l)try{for(var h=Jd(l._getLayerIds()),p=h.next();!p.done;p=h.next()){var g=p.value;this.map._getMap().off(e,g,a)}}catch(x){i={error:x}}finally{try{p&&!p.done&&(o=h.return)&&o.call(h)}finally{if(i)throw i.error}}}else this.map._getMap().off(e,a);this.mapCallbackHandler.removeCallback(e,t,r)}},n.prototype._enableLayerEvents=function(e){var t=this,r=this.mapCallbackHandler.getLayerCallbacks(e.getId());r&&r.forEach(function(i,o){i.forEach(function(a){var l,h,p=h2(a,1)[0];try{for(var g=Jd(e._getLayerIds()),_=g.next();!_.done;_=g.next()){var x=_.value;t.map._getMap().on(o,x,p)}}catch(C){l={error:C}}finally{try{_&&!_.done&&(h=g.return)&&h.call(g)}finally{if(l)throw l.error}}})})},n.prototype._disableLayerEvents=function(e){var t=this,r=this.mapCallbackHandler.getLayerCallbacks(e.getId());r&&r.forEach(function(i,o){i.forEach(function(a){var l,h,p=h2(a,1)[0];try{for(var g=Jd(e._getLayerIds()),_=g.next();!_.done;_=g.next()){var x=_.value;t.map._getMap().off(o,x,p)}}catch(C){l={error:C}}finally{try{_&&!_.done&&(h=g.return)&&h.call(g)}finally{if(l)throw l.error}}})})},n}(),c5=window&&window.__values||function(n){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&n[e],r=0;if(t)return t.call(n);if(n&&typeof n.length=="number")return{next:function(){return{value:(n=n&&r>=n.length?void 0:n)&&n[r++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},uTe=function(){function n(e){this.markers=new Set,this.map=e}return n.prototype.add=function(e,t){var r,i;if(Array.isArray(e))try{for(var o=c5(e),a=o.next();!a.done;a=o.next()){var l=a.value;this._addMarker(l,t)}}catch(h){r={error:h}}finally{try{a&&!a.done&&(i=o.return)&&i.call(o)}finally{if(r)throw r.error}}else this._addMarker(e,t)},n.prototype._addMarker=function(e,t){e._addToMap(this.map,t),this.markers.add(e)},n.prototype.getMarkers=function(){return Array.from(this.markers)},n.prototype.remove=function(e){var t,r;if(Array.isArray(e))try{for(var i=c5(e),o=i.next();!o.done;o=i.next()){var a=o.value;this._removeMarker(a)}}catch(l){t={error:l}}finally{try{o&&!o.done&&(r=i.return)&&r.call(i)}finally{if(t)throw t.error}}else this._removeMarker(e)},n.prototype._removeMarker=function(e){var t=this;e instanceof hR?(e._removeFromMap(),this.markers.delete(e)):this.markers.forEach(function(r){r._getId()===e&&(r._removeFromMap(),t.markers.delete(r))})},n.prototype.clear=function(){var e=this;this.markers.forEach(function(t){t._removeFromMap(),e.markers.delete(t)})},n}(),hTe=function(){function n(e){this.userImages=new Ls,this.imageLoadTimeout=5e3,this.map=e}return n.prototype.add=function(e,t,r){var i=this;return new Promise(function(o,a){var l,h,p;i.userImages.has(e)?o():t instanceof HTMLImageElement||t instanceof ImageData?(i.map._getMap().addImage(e,t,r),i.userImages.set(e,{image:t,meta:r}),o()):typeof t=="string"&&(h=void 0,h=/<svg/i.test(t)&&!/^data:/i.test(t)?"data:image/svg+xml;base64,"+window.btoa(t):t,p=!1,i.map._sendRequest(h,"Image").then(function(g){return p?void 0:g.blob()}).then(function(g){var _;!p&&g&&(clearTimeout(l),(_=new Image).onload=function(){i.map._getMap().addImage(e,_,r),i.userImages.set(e,{image:_,meta:r}),o()},_.onerror=_.onabort=function(){a("Failed to load image into HTML element.")},_.src=URL.createObjectURL(g))}).catch(function(){p||(clearTimeout(l),a("Failed to load image into HTML element."))}),l=setTimeout(function(){p=!0,a("Failed to load image within specified timeout: ".concat(i.imageLoadTimeout," ms."))},i.imageLoadTimeout))})},n.prototype.clear=function(){var e=this;this.userImages.forEach(function(t,r){e.map._getMap().removeImage(r)}),this.userImages.clear()},n.prototype.getImageIds=function(){var e=[];return this.userImages.forEach(function(t,r){e.push(r)}),e},n.prototype.createFromTemplate=function(e,t,r,i,o){return r=r||"#1A73AA",i=i||"#fff",t=(t=C8(t,o)).replace(/{color}/g,r).replace(/{secondaryColor}/g,i).replace(/{text}/g,""),this.add(e,t)},n.prototype.hasImage=function(e){return this.userImages.has(e)},n.prototype.remove=function(e){this.map._getMap().removeImage(e),this.userImages.delete(e)},n.prototype._restoreImages=function(){var e=this;this.userImages.forEach(function(t,r){e.map._getMap().hasImage(r)||e.map._getMap().addImage(r,t.image,t.meta)})},n}(),dTe=window&&window.__extends||function(){var n=function(e,t){return(n=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(r,i){r.__proto__=i}:function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])}))(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),fTe=window&&window.__values||function(n){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&n[e],r=0;if(t)return t.call(n);if(n&&typeof n.length=="number")return{next:function(){return{value:(n=n&&r>=n.length?void 0:n)&&n[r++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},Ch=function(n){function e(t,r){return r=n.call(this,r)||this,r.layers=t,r}return dTe(e,n),e.prototype.getOptions=function(){return{}},e.prototype.setOptions=function(t){},e.prototype._buildLayers=function(){return this.layers},e.prototype._getLayerIds=function(){return this.layers.map(function(t){return t.id})},e.prototype._getSourceIds=function(){var t,r,i=new Set;try{for(var o=fTe(this.layers),a=o.next();!a.done;a=o.next()){var l=a.value;"source"in l&&typeof l.source=="string"?i.add(l.source):"source"in l&&l.source&&i.add(l.id)}}catch(h){t={error:h}}finally{try{a&&!a.done&&(r=o.return)&&r.call(o)}finally{if(t)throw t.error}}return i},e.prototype._updateLayoutProperty=function(t,r,i,o){var a;Ba(r,i)||(a=this.map._getMap(),this.layers.forEach(function(l){a.getLayer(l.id)?a.setLayoutProperty(l.id,t,o||r):console.warn("Could not update layout property ".concat(t," for layer ").concat(l.id," to ").concat(o||r))}))},e}(Ai),Ql=window&&window.__values||function(n){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&n[e],r=0;if(t)return t.call(n);if(n&&typeof n.length=="number")return{next:function(){return{value:(n=n&&r>=n.length?void 0:n)&&n[r++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},pTe=window&&window.__read||function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var r,i,o=t.call(n),a=[];try{for(;(e===void 0||0<e--)&&!(r=o.next()).done;)a.push(r.value)}catch(l){i={error:l}}finally{try{r&&!r.done&&(t=o.return)&&t.call(o)}finally{if(i)throw i.error}}return a},gTe=window&&window.__spreadArray||function(n,e,t){if(t||arguments.length===2)for(var r,i=0,o=e.length;i<o;i++)!r&&i in e||((r=r||Array.prototype.slice.call(e,0,i))[i]=e[i]);return n.concat(r||Array.prototype.slice.call(e))},mTe=function(){function n(e){this.layerIndex=[],this.userLayers=[],this.map=e}return n.prototype.add=function(e,t){var r,i,o=t instanceof Ai?t.getId():t;if(Array.isArray(e))try{for(var a=Ql(e),l=a.next();!l.done;l=a.next()){var h=l.value;this._addLayer(h,o)}}catch(p){r={error:p}}finally{try{l&&!l.done&&(i=a.return)&&i.call(a)}finally{if(r)throw r.error}}else this._addLayer(e,o)},n.prototype._addLayer=function(e,t){if(!(this.map._isReady()||e instanceof Ch))throw new Error("The layer '".concat(e.getId(),"' could not be added to the map because ")+"the map is not ready. Please use a ready event listener to guarantee the map is ready before adding a layer to it.");var r,i,o,a;t!==e.getId()&&this.layerIndex.find(function(l){return t===l.getId()})?this._getMapboxLayerExists(e)?(i=this.layerIndex.findIndex(function(l){return l.getId()===e.getId()}),o=this.userLayers.findIndex(function(l){return l.layer.getId()===e.getId()}),this._removeMapboxLayers(e),this._addMapboxLayers(e,t),(a=this.layerIndex[i])&&this.map.events._disableLayerEvents(a),this.map.events._enableLayerEvents(e),this.layerIndex.splice(i,1),r=this.layerIndex.findIndex(function(l){return l.getId()===t}),this.layerIndex.splice(r,0,e),e instanceof Ch||(this.userLayers[o]={layer:e,before:t}),a&&a.onRemove()):(this._addMapboxLayers(e,t),this.map.events._enableLayerEvents(e),r=this.layerIndex.findIndex(function(l){return l.getId()===t}),this.layerIndex.splice(r,0,e),e instanceof Ch||this.userLayers.push({layer:e,before:t})):(i=this.layerIndex.findIndex(function(l){return l.getId()===e.getId()}),o=this.userLayers.findIndex(function(l){return l.layer.getId()===e.getId()}),0<=i&&0<=o?(a=this.layerIndex[i],this._removeMapboxLayers(a),this._addMapboxLayers(e,i+1),this.map.events._disableLayerEvents(a),this.map.events._enableLayerEvents(e),(this.layerIndex[i]=e)instanceof Ch||(this.userLayers[o]={layer:e,before:void 0}),a.onRemove()):(this._addMapboxLayers(e),this.map.events._enableLayerEvents(e),this.layerIndex.push(e),e instanceof Ch||this.userLayers.push({layer:e,before:t}))),e.onAdd(this.map)},n.prototype._addMapboxLayers=function(e,t){var r,i;if(!(e instanceof zx)||e.getOptions().tileUrl){if(!(e instanceof Ch)){e instanceof qv&&(this.map._getMap().addSource(e._getSourceId(),e._buildSource()),this.map.sources.setSourceState(e._getSourceWrapper()));var o=this._getMapboxBefore(t);try{for(var a=Ql(e._buildLayers()),l=a.next();!l.done;l=a.next()){var h=l.value;this.map._getMap().addLayer(h,o)}}catch(p){r={error:p}}finally{try{l&&!l.done&&(i=a.return)&&i.call(a)}finally{if(r)throw r.error}}}this.map.events._enableLayerEvents(e)}},n.prototype._removeMapboxLayers=function(e,t){var r,i;if(e instanceof Ch&&!t)this.map.events._disableLayerEvents(e);else{try{for(var o=Ql(e._getLayerIds()),a=o.next();!a.done;a=o.next()){var l=a.value;this.map._getMap().getLayer(l)&&this.map._getMap().removeLayer(l)}}catch(h){r={error:h}}finally{try{a&&!a.done&&(i=o.return)&&i.call(o)}finally{if(r)throw r.error}}this.map.events._disableLayerEvents(e),e instanceof qv&&this.map._getMap().getSource(e._getSourceId())&&this.map._getMap().removeSource(e._getSourceId())}},n.prototype._getMapboxLayerExists=function(e){var t=this,r=!1;return typeof e=="string"?!!(e=this.layerIndex.find(function(i){return i.getId()===e})):(e._getLayerIds().forEach(function(i){t.map._getMap().getLayer(i)&&(r=!0)}),r)},n.prototype._getMapboxBefore=function(e){var t,r,i,o;if(typeof e=="string"){var a=this.layerIndex.find(function(C){return C.getId()===e});if(!a)return;try{for(var l=Ql(a._getLayerIds()),h=l.next();!h.done;h=l.next()){var p=h.value;if(this.map._getMap().getLayer(p))return p}}catch(C){t={error:C}}finally{try{h&&!h.done&&(r=l.return)&&r.call(l)}finally{if(t)throw t.error}}e=this.layerIndex.findIndex(function(C){return C.getId()===e})+1}for(var g=e;g<this.layerIndex.length;g++)try{i=void 0;for(var _=Ql(this.layerIndex[g]._getLayerIds()),x=_.next();!x.done;x=_.next())if(p=x.value,this.map._getMap().getLayer(p))return p}catch(C){i={error:C}}finally{try{x&&!x.done&&(o=_.return)&&o.call(_)}finally{if(i)throw i.error}}},n.prototype.clear=function(){for(var e=this.layerIndex.length-1;0<=e;e--){var t=this.layerIndex[e];t&&(this._removeMapboxLayers(t,!0),this.layerIndex.splice(e,1),t.onRemove())}this.userLayers=[]},n.prototype.getLayerById=function(e){var t=this.layerIndex.find(function(r){return r.getId()===e});if(t)return t},n.prototype.getLayers=function(){return this.layerIndex.slice(0)},n.prototype._getSourceIds=function(){var e,t,r=new Set;try{for(var i=Ql(this.layerIndex),o=i.next();!o.done;o=i.next())o.value._getSourceIds().forEach(function(a){return r.add(a)})}catch(a){e={error:a}}finally{try{o&&!o.done&&(t=i.return)&&t.call(i)}finally{if(e)throw e.error}}return r},n.prototype._getUserLayers=function(){return Array.from(this.userLayers)},n.prototype.move=function(e,t){var r=e instanceof Ai?e.getId():e,i=t instanceof Ai?t.getId():t;if(!this.layerIndex.find(function(o){return o.getId()===r}))throw new Error("The layer '".concat(r,"' has not been added to the map and cannot be moved."));t=this.layerIndex.findIndex(function(o){return o.getId()===r}),this._moveMapboxLayers(this.layerIndex[t],i),e=this.layerIndex[t],this.layerIndex.splice(t,1),t=this.layerIndex.findIndex(function(o){return o.getId()===i}),-1<t?this.layerIndex.splice(t,0,e):this.layerIndex.push(e),t=this.userLayers.find(function(o){return o.layer.getId()===r}),t&&(t.before=i)},n.prototype._moveMapboxLayers=function(e,t){var r,i,o=this._getMapboxBefore(t);try{for(var a=Ql(e._getLayerIds()),l=a.next();!l.done;l=a.next()){var h=l.value;this.map._getMap().moveLayer(h,o)}}catch(p){r={error:p}}finally{try{l&&!l.done&&(i=a.return)&&i.call(a)}finally{if(r)throw r.error}}},n.prototype.getRenderedShapes=function(e,t,r){var i,o,a,l=this;if(e=e||[-180,-85.0511,180,85.0511],Array.isArray(e)?e.length===4||e.length===6?a=this.map.positionsToPixels([lr.getSouthWest(e),lr.getNorthEast(e)]):e.length!==2&&e.length!==3||(a=this.map.positionsToPixels([e])[0]):a=this.map.positionsToPixels([e.coordinates])[0],t){t=Array.isArray(t)?t:[t];var h=[],p=this;try{for(var g=Ql(t),_=g.next();!_.done;_=g.next())(function(M){var C=M instanceof Ai?M.getId():M,M=p.layerIndex.findIndex(function(L){return L.getId()===C});if(!(-1<M))throw new Error("The layer '".concat(C,"' has not been added to the map ")+"and its rendered features cannot be retrieved.");h.push.apply(h,gTe([],pTe(p.layerIndex[M]._getLayerIds().filter(function(L){return!!l.map._getMap().getLayer(L)})),!1))})(_.value)}catch(x){i={error:x}}finally{try{_&&!_.done&&(o=g.return)&&o.call(g)}finally{if(i)throw i.error}}}return e=this.map._getMap().queryRenderedFeatures(a,{layers:h,filter:r}),this.map.sources._mapFeaturesToShapes(e)},n.prototype.remove=function(e){var t,r;if(Array.isArray(e))try{for(var i=Ql(e),o=i.next();!o.done;o=i.next()){var a=o.value;this._removeLayer(a)}}catch(l){t={error:l}}finally{try{o&&!o.done&&(r=i.return)&&r.call(i)}finally{if(t)throw t.error}}else this._removeLayer(e)},n.prototype._removeLayer=function(e){var t=e instanceof Ai?e.getId():e,i=this.layerIndex.findIndex(function(o){return o.getId()===t});if(i==-1)throw new Error("The layer '".concat(t,"' has not been added to the map and cannot be removed."));var r=this.layerIndex[i],i=(this._removeMapboxLayers(r),this.layerIndex.splice(i,1),this.userLayers.findIndex(function(o){return o.layer.getId()===t}));i!=-1&&this.userLayers.splice(i,1),e instanceof qv&&this.map.sources.unsetSourceState(e._getSourceId()),r.onRemove()},n}(),l5=window&&window.__values||function(n){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&n[e],r=0;if(t)return t.call(n);if(n&&typeof n.length=="number")return{next:function(){return{value:(n=n&&r>=n.length?void 0:n)&&n[r++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},yTe=function(){function n(e){var t=this;this._onDrag=function(r){var i,o;r.type==="mousemove"?(i=r.clientX,o=r.clientY):r.type==="touchmove"&&(i=r.touches[0].clientX,o=r.touches[0].clientY),t.draggedPopups.forEach(function(a){a._dragToPixel([i,o])})},this._onUp=function(){t.map.getMapContainer().removeEventListener("mousemove",t._onDrag),t.map.getMapContainer().removeEventListener("touchmove",t._onDrag),t.map.getMapContainer().removeEventListener("mouseup",t._onUp),t.map.getMapContainer().removeEventListener("touchend",t._onUp),t.draggedPopups.forEach(function(r){t.draggedPopups.delete(r),r._onUp()})},this.map=e,this.popups=new Set,this.draggedPopups=new Set}return n.prototype.add=function(e){var t,r;e=Array.isArray(e)?e:[e];try{for(var i=l5(e),o=i.next();!o.done;o=i.next()){var a=o.value;this.popups.has(a)||(this.popups.add(a),a.attach(this.map))}}catch(l){t={error:l}}finally{try{o&&!o.done&&(r=i.return)&&r.call(i)}finally{if(t)throw t.error}}},n.prototype.clear=function(){var e=this;this.popups.forEach(function(t){e.popups.delete(t),t.remove()})},n.prototype.remove=function(e){var t,r;e=Array.isArray(e)?e:[e];try{for(var i=l5(e),o=i.next();!o.done;o=i.next()){var a=o.value;this.popups.has(a)&&(this.popups.delete(a),a.remove())}}catch(l){t={error:l}}finally{try{o&&!o.done&&(r=i.return)&&r.call(i)}finally{if(t)throw t.error}}},n.prototype.getPopups=function(){return Array.from(this.popups)},n.prototype._getCollectionDiv=function(){var e=this.map.getMapContainer().querySelector(".".concat(n.Css.collection));return e||((e=document.createElement("div")).classList.add(n.Css.collection),e.setAttribute("aria-label","Map Information"),this.map.getMapContainer().appendChild(e)),e},n.prototype._addDraggedPopup=function(e){this.draggedPopups.size===0&&(this.map.getMapContainer().addEventListener("mousemove",this._onDrag),this.map.getMapContainer().addEventListener("touchmove",this._onDrag),this.map.getMapContainer().addEventListener("mouseup",this._onUp),this.map.getMapContainer().addEventListener("touchend",this._onUp)),this.draggedPopups.add(e)},n.Css={collection:"popup-collection-container"},n}(),d2=window&&window.__values||function(n){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&n[e],r=0;if(t)return t.call(n);if(n&&typeof n.length=="number")return{next:function(){return{value:(n=n&&r>=n.length?void 0:n)&&n[r++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},_Te=function(){function n(e){this.map=e,this.sources=new Ls}return n.prototype.add=function(e,t){var r,i;if(t===void 0&&(t=!0),Array.isArray(e))try{for(var o=d2(e),a=o.next();!a.done;a=o.next()){var l=a.value;this._addSource(l,t)}}catch(h){r={error:h}}finally{try{a&&!a.done&&(i=o.return)&&i.call(o)}finally{if(r)throw r.error}}else this._addSource(e,t)},n.prototype.getRenderedShapes=function(e,t,r){return e=typeof e=="string"?e:e.getId(),r=this.map._getMap().querySourceFeatures(e,{sourceLayer:r,filter:t}),this.map.sources._mapFeaturesToShapes(r,!0,this.sources.get(e))},n.prototype.getFeatureState=function(e,t,r){return e=typeof e=="string"?e:e instanceof Ii?e.getId():e.id,t=typeof t=="string"?t:t.getId(),this.map._getMap().getFeatureState({id:e,source:t,sourceLayer:r})},n.prototype.removeFeatureState=function(e,t,r,i){e=typeof e=="string"?e:e instanceof Ii?e.getId():e.id,t=typeof t=="string"?t:t.getId(),this.map._getMap().removeFeatureState({id:e,source:t,sourceLayer:r},i)},n.prototype.setFeatureState=function(e,t,r,i){e=typeof e=="string"?e:e instanceof Ii?e.getId():e.id,t=typeof t=="string"?t:t.getId(),this.map._getMap().setFeatureState({id:e,source:t,sourceLayer:i},r)},n.prototype._buildSources=function(){var e={};return this.sources.forEach(function(t){e[t.getId()]=t._buildSource()}),e},n.prototype.clear=function(){var e=this;this.sources.forEach(function(t){e.remove(t)})},n.prototype.getById=function(e){return this.sources.get(e)},n.prototype.getSources=function(){return Array.from(this.sources.values())},n.prototype.isSourceLoaded=function(e){return e=e instanceof bi?e.getId():e,this.map._getMap().isSourceLoaded(e)},n.prototype.remove=function(e,t){var r,i;if(t===void 0&&(t=!0),Array.isArray(e))try{for(var o=d2(e),a=o.next();!a.done;a=o.next()){var l=a.value;this._removeSource(l,t)}}catch(h){r={error:h}}finally{try{a&&!a.done&&(i=o.return)&&i.call(o)}finally{if(r)throw r.error}}else this._removeSource(e,t)},n.prototype.setSourceState=function(e,t){t===void 0&&(t=!0),this.sources.set(e.getId(),e),e._setMap(this.map,t)},n.prototype.unsetSourceState=function(e){this.sources.has(e)&&(this.sources.get(e)._setMap(null),this.sources.delete(e))},n.prototype._removeSource=function(e,t){if(e=e instanceof bi?e.getId():e,!this.sources.has(e))throw new Error("'".concat(e,"' is not added to the map"));if(this.map._getMap().getSource(e)&&t&&this.map._getMap().removeSource(e),this.map._getMap().getSource(e)&&t)throw new Error("One or more layers have a dependency on the source '".concat(e,"'"));this.unsetSourceState(e)},n.prototype._addSource=function(e,t){if(this.sources.has(e.getId())){if(t)throw new Error("'".concat(e.getId(),"' is already added to the map"));this.unsetSourceState(e.getId())}if(t){if(!this.map._isReady())throw new Error("The source '".concat(e.getId(),"' could not be added to the map because ")+"the map is not ready. Please use a ready event listener to guarantee the map is ready before adding a source to it.");this.map._getMap().addSource(e.getId(),e._buildSource())}this.setSourceState(e)},n.prototype._mapFeaturesToShapes=function(e,t,r){var i,o,a=[];try{for(var l=d2(e),h=l.next();!h.done;h=l.next()){var p=h.value;if((r||typeof p.source=="string")&&typeof p.properties[Ii._shapeIdPropName]=="string"){var g=r||this.sources.get(p.source);if(g instanceof Ps){var _=g.getShapeById(p.properties[Ii._shapeIdPropName]);if(_ instanceof Ii){a.push(_);continue}}}t||a.push(p)}}catch(x){i={error:x}}finally{try{h&&!h.done&&(o=l.return)&&o.call(l)}finally{if(i)throw i.error}}return a},n.prototype._syncSources=function(e){var t=this;e?(Object.keys(e).map(function(r){var i,o=e[r];switch(o.type){case"vector":case"raster":case"raster-dem":i=new Bz(r,{name:r,tiles:o.tiles,type:o.type,url:o.url,tileSize:"tileSize"in o?o.tileSize:void 0});break;case"canvas":i=new Oz(r,o);break;case"geojson":var a=new Ps(r,{maxZoom:o.maxzoom,cluster:o.cluster,clusterRadius:o.clusterRadius,tolerance:o.tolerance,lineMetrics:o.lineMetrics,clusterProperties:o.clusterProperties,buffer:o.buffer,clusterMinPoints:o.clusterMinPoints,generateId:o.generateId,promoteId:o.promoteId,filter:o.filter});typeof o.data!="string"&&o.data!==void 0&&a._addNoUpdate(o.data),i=a;break;case"image":i=new uR(r,o);break;case"video":i=new Nz(r,o);break;default:i=new Lz(r,o)}return i}).forEach(function(r){var i=t.sources.get(r.getId()),o=i&&r._isDeepEqual(i);!o&&i&&t.unsetSourceState(i.getId()),t.setSourceState(r,!o)}),Array.from(this.sources.keys()).filter(function(r){return!(r in e)}).forEach(function(r){return t.unsetSourceState(r)})):console.warn("syncSources called with no style sources which is unexpected.")},n}(),vTe=window&&window.__extends||function(){var n=function(e,t){return(n=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(r,i){r.__proto__=i}:function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])}))(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),bTe=function(n){function e(){var t=n!==null&&n.apply(this,arguments)||this;return t.duration=1e3,t.type="jump",t}return vTe(e,n),e}(wi),wTe=window&&window.__extends||function(){var n=function(e,t){return(n=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(r,i){r.__proto__=i}:function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])}))(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),xTe=function(n){function e(){var t=n!==null&&n.apply(this,arguments)||this;return t.bottom=0,t.left=0,t.right=0,t.top=0,t}return wTe(e,n),e}(wi),ETe=window&&window.__extends||function(){var n=function(e,t){return(n=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(r,i){r.__proto__=i}:function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])}))(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),TTe=window&&window.__values||function(n){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&n[e],r=0;if(t)return t.call(n);if(n&&typeof n.length=="number")return{next:function(){return{value:(n=n&&r>=n.length?void 0:n)&&n[r++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},STe=window&&window.__read||function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var r,i,o=t.call(n),a=[];try{for(;(e===void 0||0<e--)&&!(r=o.next()).done;)a.push(r.value)}catch(l){i={error:l}}finally{try{r&&!r.done&&(t=o.return)&&t.call(o)}finally{if(i)throw i.error}}return a},CTe=window&&window.__spreadArray||function(n,e,t){if(t||arguments.length===2)for(var r,i=0,o=e.length;i<o;i++)!r&&i in e||((r=r||Array.prototype.slice.call(e,0,i))[i]=e[i]);return n.concat(r||Array.prototype.slice.call(e))},ATe=function(n){function e(){var t=n!==null&&n.apply(this,arguments)||this;return t.bounds=[-180,-89,180,90],t.maxBounds=void 0,t.maxZoom=20,t.offset=new ta(0,0),t.padding=new xTe,t}return ETe(e,n),e.prototype.merge=function(){for(var t,r,i=[],o=0;o<arguments.length;o++)i[o]=arguments[o];try{for(var a=TTe(i),l=a.next();!l.done;l=a.next()){var h=l.value;h&&typeof h.padding=="number"&&(h.padding={top:h.padding,bottom:h.padding,left:h.padding,right:h.padding})}}catch(p){t={error:p}}finally{try{l&&!l.done&&(r=a.return)&&r.call(a)}finally{if(t)throw t.error}}return n.prototype.merge.apply(this,CTe([],STe(i),!1))},e}(wi),ITe=window&&window.__extends||function(){var n=function(e,t){return(n=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(r,i){r.__proto__=i}:function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])}))(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),PTe=function(n){function e(){var t=n!==null&&n.apply(this,arguments)||this;return t.zoom=1,t.center=new Xo(0,0),t.centerOffset=new ta(0,0),t.bearing=0,t.pitch=0,t.minZoom=1,t.maxZoom=20,t.minPitch=0,t.maxPitch=60,t.maxBounds=void 0,t}return ITe(e,n),e}(wi),MTe=window&&window.__extends||function(){var n=function(e,t){return(n=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(r,i){r.__proto__=i}:function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])}))(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),Tb=function(n){function e(){var t=n!==null&&n.apply(this,arguments)||this;return t.name=void 0,t.before=void 0,t.minZoom=1,t.maxZoom=20,t.overwrite=!1,t.opacity=1,t}return MTe(e,n),e}(wi),RTe=window&&window.__extends||function(){var n=function(e,t){return(n=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(r,i){r.__proto__=i}:function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])}))(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),kTe=function(n){function e(){var t=n!==null&&n.apply(this,arguments)||this;return t.color="rgba(0,0,0,.5)",t.outlineColor="#000",t.radius=1,t.outlineWidth=5,t.name="default-circles",t}return RTe(e,n),e}(Tb),OTe=window&&window.__extends||function(){var n=function(e,t){return(n=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(r,i){r.__proto__=i}:function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])}))(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),LTe=function(n){function e(){var t=n!==null&&n.apply(this,arguments)||this;return t.cap="butt",t.join="miter",t.name="default-linestrings",t.color="#000",t.width=1,t}return OTe(e,n),e}(Tb),NTe=window&&window.__extends||function(){var n=function(e,t){return(n=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(r,i){r.__proto__=i}:function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])}))(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),DTe=function(n){function e(){var t=n!==null&&n.apply(this,arguments)||this;return t.iconSize=1,t.fontSize=14,t.fontColor="#000",t.textFont="SegoeUi-Regular",t.cluster=!0,t.clusterIcon=void 0,t.textOffset=[0,0],t.name="default-pins",t.icon="pin-darkblue",t.title="",t}return NTe(e,n),e}(Tb),FTe=window&&window.__extends||function(){var n=function(e,t){return(n=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(r,i){r.__proto__=i}:function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])}))(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),BTe=function(n){function e(){var t=n!==null&&n.apply(this,arguments)||this;return t.color="rgba(0,0,0,.5)",t.outlineColor="#000",t.name="default-polygons",t}return FTe(e,n),e}(Tb),UTe=window&&window.__extends||function(){var n=function(e,t){return(n=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(r,i){r.__proto__=i}:function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])}))(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),zTe=function(n){function e(){var t=n!==null&&n.apply(this,arguments)||this;return t.name="default-raster",t}return UTe(e,n),e}(Tb),jTe=window&&window.__extends||function(){var n=function(e,t){return(n=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(r,i){r.__proto__=i}:function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])}))(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),VTe=function(n){function e(){var t=n!==null&&n.apply(this,arguments)||this;return t.anchor="map",t.color="#FFFFFF",t.intensity=.5,t.position=[1.15,210,30],t}return jTe(e,n),e}(wi),HTe=window&&window.__extends||function(){var n=function(e,t){return(n=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(r,i){r.__proto__=i}:function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])}))(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),GTe=window&&window.__values||function(n){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&n[e],r=0;if(t)return t.call(n);if(n&&typeof n.length=="number")return{next:function(){return{value:(n=n&&r>=n.length?void 0:n)&&n[r++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},qTe=window&&window.__read||function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var r,i,o=t.call(n),a=[];try{for(;(e===void 0||0<e--)&&!(r=o.next()).done;)a.push(r.value)}catch(l){i={error:l}}finally{try{r&&!r.done&&(t=o.return)&&t.call(o)}finally{if(i)throw i.error}}return a},$Te=window&&window.__spreadArray||function(n,e,t){if(t||arguments.length===2)for(var r,i=0,o=e.length;i<o;i++)!r&&i in e||((r=r||Array.prototype.slice.call(e,0,i))[i]=e[i]);return n.concat(r||Array.prototype.slice.call(e))},u5=function(n){function e(){var t=n!==null&&n.apply(this,arguments)||this;return t.antialias=void 0,t.autoResize=!0,t.language=f8(),t.light=new VTe,t.preserveDrawingBuffer=!1,t.progressiveLoading=!1,t.progressiveLoadingInitialLayerGroups=["base"],t.renderWorldCopies=!0,t.showBuildingModels=!1,t.showFeedbackLink=!0,t.showLogo=!0,t.showLabels=!0,t.customAttribution=void 0,t.showTileBoundaries=!1,t.style=void 0,t.view=m8(),t.userRegion=t.view,t.customStyleTransform=void 0,t}return HTe(e,n),e.prototype.merge=function(){for(var t,r,i=[],o=0;o<arguments.length;o++)i[o]=arguments[o];try{for(var a=GTe(i),l=a.next();!l.done;l=a.next()){var h=l.value;h&&(h.hasOwnProperty("view")?h.userRegion=h.view:h.hasOwnProperty("userRegion")&&(h.view=h.userRegion),typeof h.language=="string")&&(h.language=Lx.getCode(h.language))}}catch(p){t={error:p}}finally{try{l&&!l.done&&(r=a.return)&&r.call(a)}finally{if(t)throw t.error}}return n.prototype.merge.apply(this,$Te([],qTe(i),!1))},e}(wi),WTe=window&&window.__extends||function(){var n=function(e,t){return(n=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(r,i){r.__proto__=i}:function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])}))(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),Z0=window&&window.__assign||function(){return(Z0=Object.assign||function(n){for(var e,t=1,r=arguments.length;t<r;t++)for(var i in e=arguments[t])Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i]);return n}).apply(this,arguments)},YTe=window&&window.__values||function(n){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&n[e],r=0;if(t)return t.call(n);if(n&&typeof n.length=="number")return{next:function(){return{value:(n=n&&r>=n.length?void 0:n)&&n[r++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},bv=window&&window.__read||function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var r,i,o=t.call(n),a=[];try{for(;(e===void 0||0<e--)&&!(r=o.next()).done;)a.push(r.value)}catch(l){i={error:l}}finally{try{r&&!r.done&&(t=o.return)&&t.call(o)}finally{if(i)throw i.error}}return a},wv=window&&window.__spreadArray||function(n,e,t){if(t||arguments.length===2)for(var r,i=0,o=e.length;i<o;i++)!r&&i in e||((r=r||Array.prototype.slice.call(e,0,i))[i]=e[i]);return n.concat(r||Array.prototype.slice.call(e))},f2=function(n){return n.length==0?void 0:n.slice(1).reduce(function(e,t){return function(r,i){return r=e(r,i),Z0(Z0({},r),t(r.url,i))}},n[0])},p2=function(n){function e(){var t=n!==null&&n.apply(this,arguments)||this;return t.authOptions=a8(),t.disableTelemetry=Nx()==="atlas.azure.us",t["disable-telemetry"]=t.disableTelemetry,t.domain=Nx(),t.staticAssetsDomain=s8(),t.styleDefinitionsPath=c8(),t.styleDefinitionsVersion=l8(),t.styleAPIVersion=u8(),t.mapConfiguration=void 0,t.styleSet=void 0,t.enableAccessibility=!0,t["enable-accessibility"]=t.enableAccessibility,t.enableAccessibilityLocationFallback=!0,t.maxParallelImageRequests=d8(),t.refreshExpiredTiles=!0,t.subscriptionKey=g8(),t["subscription-key"]=t.subscriptionKey,t.sessionId=p8(),t["session-id"]=t.sessionId,t._transformers=[],t.transformRequest=void 0,t.workerCount=h8(),t.fadeDuration=300,t.localIdeographFontFamily="sans-serif",t.validateStyle=!1,t}return WTe(e,n),e.prototype.merge=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var i=this.styleDefinitionsVersion;try{for(var o=YTe(t),a=o.next();!a.done;a=o.next()){var l=a.value;l&&(l.authOptions?typeof l.authOptions.subscriptionKey=="string"&&(l.subscriptionKey=l["subscription-key"]=l.authOptions.subscriptionKey):typeof l.subscriptionKey=="string"?(l["subscription-key"]=l.subscriptionKey,l.authOptions={authType:li.subscriptionKey,subscriptionKey:l.subscriptionKey}):typeof l["subscription-key"]=="string"&&(l.subscriptionKey=l["subscription-key"],l.authOptions={authType:li.subscriptionKey,subscriptionKey:l["subscription-key"]}),typeof l.sessionId=="string"?l["session-id"]=l.sessionId:typeof l["session-id"]=="string"&&(l.sessionId=l["session-id"]),typeof l.disableTelemetry=="boolean"?l["disable-telemetry"]=l.disableTelemetry:typeof l["disable-telemetry"]=="boolean"&&(l.disableTelemetry=l["disable-telemetry"]),typeof l.enableAccessibility=="boolean"?l["enable-accessibility"]=l.enableAccessibility:typeof l["enable-accessibility"]=="boolean"&&(l.enableAccessibility=l["enable-accessibility"]))}}catch(x){p={error:x}}finally{try{a&&!a.done&&(g=o.return)&&g.call(o)}finally{if(p)throw p.error}}var h=this._transformers,g=t?t.filter(function(x){return x!==void 0}).reduce(function(x,C){return wv(wv([],bv(x),!1),bv(C._transformers||[]),!1)},[]):[],p=n.prototype.merge.apply(this,wv([],bv(t),!1)),g=(p.authOptions.authType!==li.subscriptionKey&&(p["subscription-key"]=p.subscriptionKey=void 0),p.styleSet!==void 0&&p.mapConfiguration===void 0&&(p.mapConfiguration=p.styleSet),p.mapConfiguration&&typeof p.mapConfiguration!="string"&&(p.mapConfiguration=Z0(Z0({},p.mapConfiguration),{defaultConfiguration:p.mapConfiguration.defaultConfiguration||p.mapConfiguration.defaultStyle,configurations:p.mapConfiguration.configurations||p.mapConfiguration.styles})),this._transformers=wv(wv([],bv(h||[]),!1),bv(g.filter(function(x){return!h.includes(x)})),!1),this.transformRequest&&!this._transformers.includes(this.transformRequest)&&this._transformers.push(this.transformRequest),new Date(Date.UTC(2023,0))),_=new Date(this.styleDefinitionsVersion);return(isNaN(_.getTime())||_.getTime()<g.getTime())&&(console.warn("Style definition version ".concat(this.styleDefinitionsVersion," is invalid or deprecated, style definition version is unchanged (").concat(i,")")),this.styleDefinitionsVersion=i),this.transformRequest=f2(this._transformers),p},e.prototype.addTransformer=function(t){this._transformers||(this._transformers=[]),this._transformers.push(t),this.transformRequest=f2(this._transformers)},e.prototype.removeTransformer=function(t){this._transformers&&(this._transformers=this._transformers.filter(function(r){return t!==r}),this.transformRequest=f2(this._transformers))},e._cloneCustomizer=function(t){if(typeof t=="object")return Object.assign({},t)},e}(wi),KTe=function(){function n(){}return n.getLayerGroup=function(e){return typeof e!="string"&&e.metadata&&e.metadata["microsoft.maps:layerGroup"]?e.metadata["microsoft.maps:layerGroup"]:(e=typeof e!="string"?e.id:e).startsWith("microsoft.")&&4<=(e=e.split(".")).length?e[3]:void 0},n}(),Sw=function(){function n(e){var t=this;this.isHijacked=function(){return t._hijackedToResolve!==void 0||t._hijackedToReject!==void 0},this.isResolved=function(){return t._hijackedToResolve!==void 0||t._toResolve!==void 0},this.isRejected=function(){return t._hijackedToReject!==void 0||t._toReject!==void 0},this.resultIfResolved=function(){return t._hijackedToResolve||t._toResolve},this.errorIfRejected=function(){return t._hijackedToReject||t._toReject},this._thenResolver=function(r,i){var o;t._hijackedToResolve?r(t._hijackedToResolve):t._hijackedToReject?i(t._hijackedToReject):(o=t.origin,t.origin.then(function(a){t.isHijacked()||(o!==t.origin?t._thenResolver(r,i):(t._toResolve=a,r(a)))}).catch(function(a){t.isHijacked()||(o!==t.origin?t._thenResolver(r,i):(t._toReject=a,i(a)))}))},this.origin=e,this[Symbol.toStringTag]=this.origin[Symbol.toStringTag]}return n.resolve=function(e){return new n(Promise.resolve(e))},n.reject=function(e){return new n(Promise.reject(e))},n.prototype.then=function(e,t){var r=this;return new Promise(function(i,o){r._resolve=i,r._reject=o,r._thenResolver(i,o)}).then(e,t)},n.prototype.catch=function(e){var t=this;return new Promise(function(r,i){t._resolve=r,t._reject=i,t._thenResolver(r,i)}).catch(e)},n.prototype.finally=function(e){var t=this;return new Promise(function(r,i){t._resolve=r,t._reject=i,t._thenResolver(r,i)}).finally(e)},n.prototype.hijackAndResolve=function(e){this._hijackedToResolve=e,this._resolve&&this._resolve(e)},n.prototype.hijackAndReject=function(e){this._hijackedToReject=e,this._reject&&this._reject(e)},n.prototype.switchWith=function(e){this.origin=e,this._toResolve=void 0,this._toReject=void 0},n}(),h5={road:"Road",satellite:"Satellite",satellite_road_labels:"Hybrid",grayscale_dark:"Grayscale (Dark)",grayscale_light:"Grayscale (Light)",night:"Night",road_shaded_relief:"Terra",blank:"Blank",blank_accessible:"Blank (Accessible)",high_contrast_dark:"High contrast (Dark)",high_contrast_light:"High contrast (Light)"},wc=window&&window.__assign||function(){return(wc=Object.assign||function(n){for(var e,t=1,r=arguments.length;t<r;t++)for(var i in e=arguments[t])Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i]);return n}).apply(this,arguments)},g2=window&&window.__awaiter||function(n,e,t,r){return new(t=t||Promise)(function(i,o){function a(p){try{h(r.next(p))}catch(g){o(g)}}function l(p){try{h(r.throw(p))}catch(g){o(g)}}function h(p){var g;p.done?i(p.value):((g=p.value)instanceof t?g:new t(function(_){_(g)})).then(a,l)}h((r=r.apply(n,e||[])).next())})},m2=window&&window.__generator||function(n,e){var t,r,i,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]},a={next:l(0),throw:l(1),return:l(2)};return typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function l(h){return function(p){var g=[h,p];if(t)throw new TypeError("Generator is already executing.");for(;o=a&&g[a=0]?0:o;)try{if(t=1,r&&(i=2&g[0]?r.return:g[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,g[1])).done)return i;switch(r=0,(g=i?[2&g[0],i.value]:g)[0]){case 0:case 1:i=g;break;case 4:return o.label++,{value:g[1],done:!1};case 5:o.label++,r=g[1],g=[0];continue;case 7:g=o.ops.pop(),o.trys.pop();continue;default:if(!(i=0<(i=o.trys).length&&i[i.length-1])&&(g[0]===6||g[0]===2)){o=0;continue}if(g[0]===3&&(!i||g[1]>i[0]&&g[1]<i[3]))o.label=g[1];else if(g[0]===6&&o.label<i[1])o.label=i[1],i=g;else{if(!(i&&o.label<i[2])){i[2]&&o.ops.pop(),o.trys.pop();continue}o.label=i[2],o.ops.push(g)}}g=e.call(n,o)}catch(_){g=[6,_],r=0}finally{t=i=0}if(5&g[0])throw g[1];return{value:g[0]?g[1]:void 0,done:!0}}}},Ng=window&&window.__read||function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var r,i,o=t.call(n),a=[];try{for(;(e===void 0||0<e--)&&!(r=o.next()).done;)a.push(r.value)}catch(l){i={error:l}}finally{try{r&&!r.done&&(t=o.return)&&t.call(o)}finally{if(i)throw i.error}}return a},y2=window&&window.__spreadArray||function(n,e,t){if(t||arguments.length===2)for(var r,i=0,o=e.length;i<o;i++)!r&&i in e||((r=r||Array.prototype.slice.call(e,0,i))[i]=e[i]);return n.concat(r||Array.prototype.slice.call(e))},ZTe=window&&window.__values||function(n){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&n[e],r=0;if(t)return t.call(n);if(n&&typeof n.length=="number")return{next:function(){return{value:(n=n&&r>=n.length?void 0:n)&&n[r++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},XTe=function(){function n(e,t){var r=this;this.definitions=function(){var i=r.initPromise||r.initStyleset();return i},this.indoorState=void 0,this.preservedPreindoorMapConfiguration=void 0,this._progressiveLoadingState={mapStyle:void 0,pendingVisibilityChange:void 0},this._deferLayerGroupVisibilities=function(i,o){var a,l,h,p,g=o.filter(function(_){return _ in i});g.length!==0&&(a=r.map._getMap(),l=a.getZoom(),h=r.map.getStyle().style,r._progressiveLoadingState.pendingVisibilityChange&&(r.map.events.remove("load",r._progressiveLoadingState.pendingVisibilityChange),r._progressiveLoadingState.pendingVisibilityChange=null),r._progressiveLoadingState.mapStyle=h,(p=Object.entries(i).reduce(function(_,M){var M=Ng(M,2),C=M[0],M=M[1],L=g.includes(C);return y2(y2([],Ng(_),!1),Ng(M.filter(function(D){if(D.type==="custom")return!1;if(L){if(typeof D.maxzoom=="number"&&typeof D.minzoom=="number"){if(l<=D.maxzoom&&l>=D.minzoom)return!1}else if(typeof D.minzoom=="number"){if(l>=D.minzoom)return!1}else if(typeof D.maxzoom!="number"||l<=D.maxzoom)return!1}return((D=D.layout)==null?void 0:D.visibility)!=="none"})),!1)},[])).forEach(function(_){_.layout=_.layout||{},_.layout.visibility="none"}),r._progressiveLoadingState.pendingVisibilityChange=function(){r._progressiveLoadingState.pendingVisibilityChange=null;var _=r.map.getStyle().style;h===_&&(p.forEach(function(x){x.layout.visibility="visible",a.setLayoutProperty(x.id,"visibility","visible")}),(_=r.map.copyrightDelegate)!=null)&&_.reloadAttribution()},r.map.events.addOnce("load",r._progressiveLoadingState.pendingVisibilityChange))},this._onStyleData=function(i){r.map.events.invoke("stylechanged",{style:i.name,map:r.map,type:"stylechanged"})},this._lookUp=function(i){var o,a,p=r.definitions(),l=p.errorIfRejected(),h=p.resultIfResolved();if(l||!h)return null;var p=h.configurations,g=void 0;try{for(var _=ZTe(p),x=_.next();!x.done;x=_.next()){var C=x.value;if(C.name===i.style)return C;C.name===h.defaultConfiguration&&(g=g||C)}}catch(M){o={error:M}}finally{try{x&&!x.done&&(a=_.return)&&a.call(_)}finally{if(o)throw o.error}}return g=g||p[0]},this._lookUpAsync=function(i){return g2(r,void 0,void 0,function(){var o;return m2(this,function(a){switch(a.label){case 0:return[4,this.definitions()];case 1:return o=a.sent(),[2,o.configurations.find(function(l){return l.name===(i.style||o.defaultConfiguration)})||o.configurations.find(function(l){return l.name===o.defaultConfiguration})||o.configurations[0]]}})})},this.map=e,this.serviceOptions=t}return n.prototype.updateIndoorState=function(e,t){var r,i,o=this,a=this.map.styles.getMapConfiguration();a?(this.preservedPreindoorMapConfiguration=a,r=this.map.getStyle().style?"".concat(this.map.getStyle().style,"_indoor").concat(e==="dark"?"_dark":"","_tileset_").concat(t):void 0,this.map.styles.setMapConfiguration("defaultIndoor_".concat(t),a==="microsoft-maps:default"?r:void 0)):(i=((a=this.indoorState)==null?void 0:a.tilesetId)!==t,this.indoorState={tilesetId:t,theme:e},this.initStyleset(),this.definitions().then(function(l){var p=(o.map.getStyle().style||l.defaultConfiguration).replace("_indoor_dark","").replace("_indoor",""),h="".concat(p,"_indoor"),p=l.configurations.find(function(g){return g.name.startsWith(h)});p&&o.map.setStyle({style:p.name},!i)}))},n.prototype.unsetIndoorState=function(){var e=this,t=this.preservedPreindoorMapConfiguration;t?this.map.styles.setMapConfiguration(t):(this.indoorState=void 0,this.initStyleset(),this.definitions().then(function(r){var i=e.map.getStyle().style;i.includes("_indoor")&&i.split("_indoor")[0]?e.map.setStyle({style:i.split("_indoor")[0]}):e.map.setStyle({style:void 0})}))},n.prototype.initStyleset=function(){var e,t=this;return e=this.serviceOptions.mapConfiguration?typeof this.serviceOptions.mapConfiguration=="string"?(e=this.map.authentication?this.map.authentication.initialize():Promise.resolve(),new Sw(e.then(function(){return t._request(t.serviceOptions.domain,"".concat(Nn.styleResourcePath,"/mapconfigurations/metadata/").concat(t.serviceOptions.mapConfiguration),"StyleDefinitions").then(function(r){return wc(wc({},r),{defaultConfiguration:r.defaultConfiguration||r.defaultStyle,configurations:r.configurations||r.styles})})}))):Sw.resolve(this.serviceOptions.mapConfiguration):(e=this.map.authentication?this.map.authentication.initialize():Promise.resolve(),new Sw(e.then(function(){return t._request(t.serviceOptions.staticAssetsDomain,"".concat(Nn.stylePath,"/").concat(Nn.styleResourcePath),"StyleDefinitions",{version:t.serviceOptions.styleDefinitionsVersion,mcv:kh.replace(/\./g,"")}).then(function(r){return{version:isNaN(r.version)?0:parseFloat(r.version),defaultConfiguration:r.defaultStyle,configurations:r.styles.filter(function(i){return t.indoorState?t.indoorState.theme==="auto"?i.name.endsWith(i.theme==="dark"?"_indoor_dark":"_indoor"):i.name.endsWith(t.indoorState.theme==="dark"?"_indoor_dark":"_indoor"):!i.name.includes("indoor")}).map(function(i){return{copyright:i.copyright.join(" "),name:i.name,displayName:function(o){return o=t.indoorState&&o.includes("_indoor")?o.split("_indoor")[0]:o,o in h5?h5[o]:o}(i.name),theme:i.theme,thumbnail:new vl({domain:t.serviceOptions.staticAssetsDomain,path:i.thumbnail,protocol:"https"}).toString(),url:new vl({domain:t.serviceOptions.staticAssetsDomain,path:"".concat(Nn.stylePath,"/").concat(Nn.styleResourcePath,"/").concat(i.name),queryParams:{styleVersion:r.version!==void 0&&r.version!==null?r.version:t.serviceOptions.styleDefinitionsVersion,mcv:kh.replace(/\./g,"")},protocol:"https"}).toString()}})}})}))),this.initPromise&&this.initPromise.switchWith(e),this.initPromise=e,this.initPromise.then(function(r){return t.map._invokeEvent("mapconfigurationchanged",r)}),this.initPromise},n.prototype.getStyle=function(e){if(e=this._lookUp(e),!e)throw Error("Style definition is not available.");if(e.url)return e.url;if(e.style)return e.style;throw Error("Style definition neither contains URL nor style object.")},n.prototype.deriveNewStyleAndLayerGroups=function(e,t){for(var r,i,o=this.map.getStyle(),a=this.map.getTraffic(),l={},h=0;h<t.layers.length;h++){var p=t.layers[h],g=KTe.getLayerGroup(p);g?(l[g]||(l[g]=[]),l[g].push(p),o.showBuildingModels||p.type!=="fill-extrusion"?p.type==="fill-extrusion"&&(p.layout=(r=p.layout)!=null?r:{},p.layout.visibility="visible"):(p.layout=(r=p.layout)!=null?r:{},p.layout.visibility="none"),a.flow!=="none"&&g&&g==="traffic_".concat(a.flow)&&p.type=="line"&&(p.layout=(i=p.layout)!=null?i:{},p.layout.visibility="visible"),g!=="labels"&&g!=="labels_places"&&g!=="labels_indoor"||p.type!=="symbol"||(o.showLabels&&((i=p.layout)==null?void 0:i.visibility)!=="none"?(p.layout=(g=p.layout)!=null?g:{},p.layout.visibility="visible"):(p.layout=(g=p.layout)!=null?g:{},p.layout.visibility="none"))):l[p.id]=[p]}return[t,l]},n.prototype.injectUserLayersIntoStyle=function(e,t,r){return e?this.map.layers._getUserLayers().reduce(function(i,o){var a,l,h,p;return o.layer instanceof Uz||(a=((l=(l=r==null?void 0:r[o.before])==null?void 0:l[0])==null?void 0:l.id)||o.before,l=e.layers.find(function(g){return g.id===o.layer.getId()}),-1<(h=t.layers.findIndex(function(g){return g.id===o.layer.getId()}))&&t.layers.splice(h,1),l&&(h=new Set(Array.from(o.layer._getSourceIds()).map(function(g){var _;return!i.sources[g]&&(_=e.sources[g])?{source:_,id:g}:void 0}).filter(function(g){return g!==void 0})),-1<(p=a?i.layers.findIndex(function(g){return g.id===a}):-1)?i.layers.splice(p,0,l):i.layers.push(l),h.forEach(function(x){var _=x.source,x=x.id;i.sources[x]=_}))),i},wc({},t)):t},n.prototype.setStyle=function(e,t){var r=this,i=(t===void 0&&(t=!0),this._lookUp(e));if(!i)throw Error("Style definition ".concat(e.style," is not available."));if(!i.url&&!i.style)throw Error("Style definition neither contains URL nor style object.");var o=function(){return r._onStyleData(i)},a=function(){r.map.events.remove("styledata",o),r.map.events.addOnce("styledata",o)},l=e&&e.customStyleTransform?function(h,p){return h=e.customStyleTransform(h,p),a(),h}:function(x,g){var C=wc(wc({},g),{layers:y2([],Ng(g.layers),!1),sources:wc({},g.sources)}),_=e.progressiveLoading&&!r.map._isLoaded(),g=(_&&Array.isArray(g==null?void 0:g.layers)&&((C=wc({},g)).layers=C.layers.map(function(M){var L=wc({},M);return M.layout&&(L.layout=wc({},M.layout)),L})),Ng(r.deriveNewStyleAndLayerGroups(x,C),2)),C=g[0],g=g[1],_=(_&&(_=e.progressiveLoadingInitialLayerGroups,Array.isArray(_))&&0<_.length&&r._deferLayerGroupVisibilities(g,_),r.injectUserLayersIntoStyle(x,C,g)),x=Object.entries(g).map(function(D){var D=Ng(D,2),L=D[0],D=D[1];return r._buildFundamentalLayerFrom(D,L)}),C=r.map.layers._getUserLayers().reduce(function(M,L){var D=L.before?M.findIndex(function(z){return z.getId()===L.before}):-1;return-1<D?M.splice(D,0,L.layer):M.push(L.layer),M},x);return r.map.layers.layerIndex=C,r.map.sources._syncSources(_.sources),a(),_};this.map._getMap().setStyle(i.url||i.style,{diff:t,validate:this.serviceOptions.validateStyle,transformStyle:l})},n.prototype.getTheme=function(e){if(e=this._lookUp(e),e)return e.theme.toLowerCase()},n.prototype.getThemeAsync=function(e){return g2(this,void 0,void 0,function(){return m2(this,function(t){switch(t.label){case 0:return[4,this._lookUpAsync(e)];case 1:return[2,t.sent().theme]}})})},n.prototype.setMapConfiguration=function(e,t){var r=this;typeof(this.serviceOptions.mapConfiguration=e)=="string"?this.initStyleset():this.initPromise?this.initPromise.hijackAndResolve(e):this.initPromise=Sw.resolve(e),this.definitions().then(function(i){var o=i.defaultConfiguration;i.configurations.find(function(a){return a.name===t})&&(o=t),r.map.setStyle({style:o})})},n.prototype.getMapConfiguration=function(){return this.serviceOptions.mapConfiguration},n.prototype.setStyleSet=function(e){this.updateIndoorState(e==="indoor_dark"?"dark":"light",null)},n.prototype.getStyleSet=function(){return this.indoorState!==void 0?this.indoorState.theme==="dark"?"indoor_dark":"indoor":"base"},n.prototype.clearStyleSet=function(){this.unsetIndoorState()},n.prototype._buildFundamentalLayerFrom=function(e,t){if(e&&0<e.length)return(e=new Ch(e,t)).onAdd(this.map),e;throw new Error("Unable to construct fundamental map layer for ID: ".concat(t,"."))},n.prototype._transformStyleRequest=function(e,t){e.includes(Nn.domainPlaceHolder)&&(t.url=t.url.replace(Nn.domainPlaceHolder,this.serviceOptions.domain)),e.includes(Nn.stylePathHolder)&&(t.url=t.url.replace(Nn.stylePathHolder,Nn.stylePath)),e.includes(Nn.styleResourcePlaceholder)&&(t.url=t.url.replace(Nn.styleResourcePlaceholder,Nn.styleResourcePath)),(t.url.toLocaleLowerCase().includes(this.serviceOptions.domain.toLocaleLowerCase())||t.url.toLocaleLowerCase().includes(this.serviceOptions.staticAssetsDomain.toLocaleLowerCase()))&&((e=new URL(t.url)).searchParams.get(Nn.apiVersionQueryParameter)||(e.searchParams.set(Nn.apiVersionQueryParameter,this.serviceOptions.styleAPIVersion),t.url=e.href),(e=this.map.authentication)!=null&&e.signRequest(t),this._deleteAuthTokenForStaticAssets(t))},n.prototype._request=function(e,t,r,i){var o;return i===void 0&&(i={}),g2(this,void 0,void 0,function(){var a,l;return m2(this,function(h){switch(h.label){case 0:return l={url:new vl({protocol:"https",domain:e,path:t,queryParams:wc(((l={})[Nn.apiVersionQueryParameter]=this.serviceOptions.styleAPIVersion,l),i)}).toString()},typeof this.serviceOptions.transformRequest=="function"&&r&&(l=this.serviceOptions.transformRequest(l.url,r)),(o=this.map.authentication)!=null&&o.signRequest(l),this._deleteAuthTokenForStaticAssets(l),a={method:"GET",mode:"cors"},l.credentials&&(a.credentials=l.credentials),l.headers&&(a.headers=l.headers),[4,fetch(l.url,a).then(function(p){if(p.ok)return p.json();throw new Error("HTTP ".concat(p.status,": ").concat(p.statusText," "))})];case 1:return[2,h.sent()]}})})},n.prototype._deleteAuthTokenForStaticAssets=function(e){e.url.startsWith("https://".concat(this.serviceOptions.staticAssetsDomain,"/").concat(Nn.stylePath))&&(delete e.headers[Nn.msClientIdHeaderName],delete e.headers[Nn.authorizationHeaderName])},n}(),QTe=function(){return"ENVIRONMENT"in window&&!!window.ENVIRONMENT.hmr},d5=window&&window.__values||function(n){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&n[e],r=0;if(t)return t.call(n);if(n&&typeof n.length=="number")return{next:function(){return{value:(n=n&&r>=n.length?void 0:n)&&n[r++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},JTe=function(){function n(e){this.map=e,this.indicators=new Set}return n.prototype.add=function(e){var t,r;e=Array.isArray(e)?e:[e];try{for(var i=d5(e),o=i.next();!o.done;o=i.next()){var a=o.value;this.indicators.has(a)||(this.indicators.add(a),a.attach(this.map))}}catch(l){t={error:l}}finally{try{o&&!o.done&&(r=i.return)&&r.call(i)}finally{if(t)throw t.error}}},n.prototype.clear=function(){var e=this;this.indicators.forEach(function(t){e.indicators.delete(t),t.remove()})},n.prototype.remove=function(e){var t,r;e=Array.isArray(e)?e:[e];try{for(var i=d5(e),o=i.next();!o.done;o=i.next()){var a=o.value;this.indicators.has(a)&&(this.indicators.delete(a),a.remove())}}catch(l){t={error:l}}finally{try{o&&!o.done&&(r=i.return)&&r.call(i)}finally{if(t)throw t.error}}},n.prototype.getIndicators=function(){return Array.from(this.indicators)},n.prototype._getCollectionDiv=function(){var e=this.map.getMapContainer().querySelector(".".concat(n.Css.collection));return e||((e=document.createElement("div")).setAttribute("aria-label","map data"),e.setAttribute("role","listbox"),e.classList.add(n.Css.collection),this.map.getMapContainer().appendChild(e)),e},n.Css={collection:"accessible-indicator-collection-container"},n}(),eSe=window&&window.__extends||function(){var n=function(e,t){return(n=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(r,i){r.__proto__=i}:function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])}))(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),eu=window&&window.__assign||function(){return(eu=Object.assign||function(n){for(var e,t=1,r=arguments.length;t<r;t++)for(var i in e=arguments[t])Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i]);return n}).apply(this,arguments)},tSe=window&&window.__awaiter||function(n,e,t,r){return new(t=t||Promise)(function(i,o){function a(p){try{h(r.next(p))}catch(g){o(g)}}function l(p){try{h(r.throw(p))}catch(g){o(g)}}function h(p){var g;p.done?i(p.value):((g=p.value)instanceof t?g:new t(function(_){_(g)})).then(a,l)}h((r=r.apply(n,e||[])).next())})},nSe=window&&window.__generator||function(n,e){var t,r,i,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]},a={next:l(0),throw:l(1),return:l(2)};return typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function l(h){return function(p){var g=[h,p];if(t)throw new TypeError("Generator is already executing.");for(;o=a&&g[a=0]?0:o;)try{if(t=1,r&&(i=2&g[0]?r.return:g[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,g[1])).done)return i;switch(r=0,(g=i?[2&g[0],i.value]:g)[0]){case 0:case 1:i=g;break;case 4:return o.label++,{value:g[1],done:!1};case 5:o.label++,r=g[1],g=[0];continue;case 7:g=o.ops.pop(),o.trys.pop();continue;default:if(!(i=0<(i=o.trys).length&&i[i.length-1])&&(g[0]===6||g[0]===2)){o=0;continue}if(g[0]===3&&(!i||g[1]>i[0]&&g[1]<i[3]))o.label=g[1];else if(g[0]===6&&o.label<i[1])o.label=i[1],i=g;else{if(!(i&&o.label<i[2])){i[2]&&o.ops.pop(),o.trys.pop();continue}o.label=i[2],o.ops.push(g)}}g=e.call(n,o)}catch(_){g=[6,_],r=0}finally{t=i=0}if(5&g[0])throw g[1];return{value:g[0]?g[1]:void 0,done:!0}}}},rSe=window&&window.__read||function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var r,i,o=t.call(n),a=[];try{for(;(e===void 0||0<e--)&&!(r=o.next()).done;)a.push(r.value)}catch(l){i={error:l}}finally{try{r&&!r.done&&(t=o.return)&&t.call(o)}finally{if(i)throw i.error}}return a},iSe=window&&window.__spreadArray||function(n,e,t){if(t||arguments.length===2)for(var r,i=0,o=e.length;i<o;i++)!r&&i in e||((r=r||Array.prototype.slice.call(e,0,i))[i]=e[i]);return n.concat(r||Array.prototype.slice.call(e))},Cw=window&&window.__values||function(n){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&n[e],r=0;if(t)return t.call(n);if(n&&typeof n.length=="number")return{next:function(){return{value:(n=n&&r>=n.length?void 0:n)&&n[r++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},HV=function(n){function e(t,r){var i,o,a=n.call(this)||this,l=(a.removed=!1,a.loaded=!1,a.ready=!1,a._resizeCallback=function(){return a.resize()},!0);a._updateGlobalDefaults(r),a.serviceOptions=new p2().merge(r),a.styleOptions=new u5().merge(r),a.trafficOptions=new Dx,a.styles=new XTe(a,a.serviceOptions),a.insights=new bxe(a.serviceOptions),a.serviceOptions.authOptions.subscriptionKey&&(a.serviceOptions.authOptions.subscriptionKey=encodeURIComponent(a.serviceOptions.authOptions.subscriptionKey)),i=a.serviceOptions.authOptions.clientId||(a.serviceOptions.authOptions.subscriptionKey?a.serviceOptions.authOptions.subscriptionKey.replace(/.(?=.{3,}$)/g,"*"):"invalid-setting"),a.insights&&a.insights.setAuthenticatedUserContext(a.serviceOptions.sessionId,i),arguments[2]&&QTe()?(o=arguments[2],a.ready=!0,a.loaded=!0):(i={antialias:a.styleOptions.antialias,attributionControl:!1,container:t,fadeDuration:a.serviceOptions.fadeDuration,localIdeographFontFamily:a.serviceOptions.localIdeographFontFamily,preserveDrawingBuffer:a.styleOptions.preserveDrawingBuffer,refreshExpiredTiles:a.serviceOptions.refreshExpiredTiles,renderWorldCopies:a.styleOptions.renderWorldCopies,trackResize:!1,transformRequest:function(_,x){var C={url:_};return x==="Tile"||x==="Source"?(_.includes(Nn.legacyDomainPlaceHolder)&&a.insights&&a.insights.trackEvent({name:"TileLoad"}),a._substituteDomainLanguageViewAndSignInRequest(_,C)):x!=="Style"&&x!=="SpriteJSON"&&x!=="SpriteImage"&&x!=="Glyphs"||a.styles._transformStyleRequest(_,C),a.serviceOptions.transformRequest&&pz(C,a.serviceOptions.transformRequest(C.url,x)),C}},o=new as.Map(i));try{a.map=o,a.authentication=new aTe(a),a.controls=new sTe(a),a.events=new lTe(a),a.imageSprite=new hTe(a),a.layers=new mTe(a),a.markers=new uTe(a),a.sources=new _Te(a),a.popups=new yTe(a),a.indicators=new JTe(a),a.map.getContainer().classList.add(e.Css.container),a.map.getCanvasContainer().classList.add(e.Css.canvasContainer),a.map.getCanvas().classList.add(e.Css.canvas),a._detectHighContrast(),a.copyrightControl=new Exe({showFeedbackLink:a.styleOptions.showFeedbackLink,showLogo:a.styleOptions.showLogo,customAttribution:a.styleOptions.customAttribution}),a.controls.add(a.copyrightControl,{position:Fa.NonFixed}),a.logoControl=new Cxe({showLogo:a.styleOptions.showLogo}),a.controls.add(a.logoControl,{position:Fa.BottomLeft});var h=a.authentication?a.authentication.initialize():Promise.resolve();if(a.removed)return a;var p=function(){a.loaded=!0,a.map.off("load",p)},g=(a.map.on("load",p),function(){a.ready=!0,a.map.off("styledata",g),a.events.invoke("ready",{map:a,type:"ready"})});a.map.on("styledata",g),a._setAutoResize(a.styleOptions.autoResize),a.map.showTileBoundaries=a.styleOptions.showTileBoundaries,a.localizedStringsPromise=Lx.getStrings(a.styleOptions.language),h.then(function(){return a.styles.definitions()}).then(function(_){if(!a.removed){if(a.authentication&&!a.authentication.getToken())throw new Error("AuthenticationManager finished initializing, but no token is available");a.serviceOptions["enable-accessibility"]&&a.accessibleMapDelegate.addToMap(),a._setStyleComponents(a.styleOptions),a.copyrightDelegate&&a.copyrightDelegate.addToMap()}}).catch(function(_){_=_ instanceof Error?_:new Error(_),a.insights.trackException({error:_}),_={map:a,type:"error",error:_},a.events.invoke("error",_)}),a.setCamera(eu(eu({minZoom:1},r),{type:"jump",duration:0})),a.incidentDelegate=new Fxe(a),a.flowDelegate=new Oxe(a),a.accessibleMapDelegate=new kxe(a),a.userInteractionDelegate=new jxe(a,r),a.userInteractionDelegate.addToMap(),a.copyrightDelegate=new Qxe(a,a.copyrightControl,a.styleOptions)}catch(_){throw l=!1,a.insights.trackException({error:_ instanceof Error?_:new Error(_)}),_}finally{a.insights.trackEvent({name:"MapLoad"},{success:l,supported:aI(),supportedWithPerformance:aI({failIfMajorPerformanceCaveat:!0})}),a.insights.flush()}return a}return eSe(e,n),Object.defineProperty(e.prototype,"isDisposed",{get:function(){return this.removed},enumerable:!1,configurable:!0}),e.prototype.getCanvas=function(){return this.map.getCanvas()},e.prototype.getCanvasContainer=function(){return this.map.getCanvasContainer()},e.prototype.getMapContainer=function(){return this.map.getContainer()},e.prototype.getServiceOptions=function(){return Ar(this.serviceOptions,p2._cloneCustomizer)},e.prototype.setServiceOptions=function(t){this.serviceOptions=new p2().merge(this.serviceOptions,t),this.serviceOptions["enable-accessibility"]?this.accessibleMapDelegate.addToMap():this.accessibleMapDelegate.removeFromMap(),t=this.styles.serviceOptions.mapConfiguration!==this.serviceOptions.mapConfiguration||this.styles.serviceOptions.staticAssetsDomain!==this.serviceOptions.staticAssetsDomain||this.styles.serviceOptions.styleDefinitionsVersion!==this.serviceOptions.styleDefinitionsVersion||this.styles.serviceOptions.domain!==this.serviceOptions.domain||this.styles.serviceOptions.styleAPIVersion!==this.serviceOptions.styleAPIVersion,this.styles.serviceOptions=this.serviceOptions,t&&(this.styles.initPromise=null,this.setStyle({}))},e.prototype.addRequestTransformer=function(t){this.serviceOptions.addTransformer(t)},e.prototype.removeRequestTransformer=function(t){this.serviceOptions.removeTransformer(t)},e.prototype.setCamera=function(t,r){if(r===void 0&&(r=!1),"padding"in t||"offset"in t||"bounds"in t){var i,l=new ATe().merge({maxZoom:this.getCamera().maxZoom},t),o=this._generateSafeBounds(l.bounds),h={padding:l.padding,offset:l.offset,maxZoom:l.maxZoom};if(!(i=this.map.cameraForBounds(o,h)))throw a={message:"The map cannot be fit to the current canvas with the given CameraBoundsOptions.",containerWidth:(a=(a=this.map)==null?void 0:a.getContainer())==null?void 0:a.clientWidth,containerHeight:a==null?void 0:a.clientHeight,safeBounds:o,cameraForBoundsOptions:h},new Error(JSON.stringify(a));"pitch"in t&&(i.pitch=t.pitch),"bearing"in t&&(i.bearing=t.bearing),"minPitch"in t&&this.map.setMinPitch(t.minPitch),"maxPitch"in t&&this.map.setMaxPitch(t.maxPitch),"minZoom"in t&&this.map.setMinZoom(t.minZoom),o=this._generateSafeBounds(l.maxBounds)}else h=new PTe().merge(this.getCamera(),t),h.centerOffset&&2<=h.centerOffset.length&&(a=h.centerOffset,(l=pb([h.center],h.zoom))[0][0]+=a[0],l[0][1]+=a[1],h.center=cR(l,h.zoom)[0]),i={center:h.center,zoom:h.zoom,bearing:h.bearing,pitch:h.pitch,around:void 0},h.minZoom<1&&console.warn("Setting minZoom below 1 may result in an empty map when the zoom level is less than 1."),this.map.setMinZoom(h.minZoom),this.map.setMaxZoom(h.maxZoom),h.minPitch&&this.map.setMinPitch(h.minPitch),h.maxPitch&&this.map.setMaxPitch(h.maxPitch),this._invokeEvent("minzoomchanged",this.map.getMinZoom()),this._invokeEvent("maxzoomchanged",this.map.getMaxZoom()),o=this._generateSafeBounds(h.maxBounds);o?this.map.setMaxBounds(o):this.map.setMaxBounds(null);var a=new bTe().merge(t),l={duration:a.duration,easing:function(p){return p},offset:[0,0],animate:!0},h={fromControl:r};a.type==="jump"?this.map.jumpTo(i,h):a.type==="ease"?this.map.easeTo(eu(eu({},i),l),h):a.type==="fly"&&this.map.flyTo(eu(eu({},i),l),h)},e.prototype.setCameraBounds=function(t){this.setCamera(t)},e.prototype.getCamera=function(){var t=this.map.getBounds().getSouthWest().toArray(),r=this.map.getBounds().getNorthEast().toArray();return{zoom:this.map.getZoom(),center:this.map.getCenter().toArray(),bearing:this.map.getBearing(),pitch:this.map.getPitch(),bounds:new lr(t,r),minZoom:this.map.getMinZoom(),maxZoom:this.map.getMaxZoom()}},e.prototype.setStyle=function(t,r){r===void 0&&(r=!0),delete t.preserveDrawingBuffer,t=new u5().merge(this.styleOptions,t),t.autoResize!==this.styleOptions.autoResize&&this._setAutoResize(t.autoResize),t.language!==this.styleOptions.language&&(this.localizedStringsPromise=Lx.getStrings(t.language)),t.renderWorldCopies!==this.styleOptions.renderWorldCopies&&this.map.setRenderWorldCopies(t.renderWorldCopies),t.showFeedbackLink!==this.styleOptions.showFeedbackLink&&this.copyrightControl.setOptions({showFeedbackLink:t.showFeedbackLink}),t.customAttribution!==this.styleOptions.customAttribution&&this.copyrightControl.setOptions({customAttribution:t.customAttribution}),t.showLogo!==this.styleOptions.showLogo&&(this.copyrightControl.setOptions({showLogo:t.showLogo}),this.logoControl.setOptions({showLogo:t.showLogo})),t.showTileBoundaries!==this.styleOptions.showTileBoundaries&&(this.map.showTileBoundaries=t.showTileBoundaries),t.showBuildingModels&&console.warn("showBuildingModels is deprecated."),r=r&&this.styleOptions.language===t.language&&this.styleOptions.view===t.view,this.styleOptions=t,this._setStyleComponents(t,r)},e.prototype.getStyle=function(){return ao(this.styleOptions)},e.prototype.addIcon=function(t,r){this.imageSprite.add(t,r)},e.prototype.addPins=function(t,i){var i=new DTe().merge(i),o=this.layers.getLayerById(i.name),a=!1;if(o||(a=!0,o=new Ux("".concat(i.name,"-source"),i.name,{source:"".concat(i.name,"-source"),minZoom:i.minZoom,maxZoom:i.maxZoom,iconOptions:{anchor:"center",size:i.iconSize,image:["case",["has","icon"],["get","icon"],i.icon],ignorePlacement:!i.cluster,opacity:i.opacity},textOptions:{anchor:"center",textField:["case",["has","point_count"],["to-string",["get","point_count"]],["has","title"],["to-string",["get","title"]],i.title],font:["case",["has","point_count"],["literal",["StandardFontCondensed-Bold"]],["literal",[i.textFont]]],size:["case",["has","point_count"],20,i.fontSize],ignorePlacement:!i.cluster,opacity:i.opacity,offset:["case",["has","point_count"],["literal",[.5,-.45]],["literal",[i.textOffset[0]/16,i.textOffset[1]/16]]],color:i.fontColor}})),!(o instanceof Ux))throw new Error("A layer with name '".concat(i.name,"' already exists but it is not a SymbolLayer.")+"A SymbolLayer should be used for rendering pins.");var l=o.getSource(),h=(typeof l=="string"?(p=l,l=this.sources.getById(p)):p=l.getId(),!1);if(l||(h=!0,l=new Ps(p,{cluster:i.cluster})),!(l instanceof Ps))throw new Error("The source with name '".concat(p,"' already exists but it is not a DataSource.")+"New data can only be added to a DataSource.");h&&this.sources.add(l),a&&this.layers.add(o,i.before);var p=new yf(t);i.overwrite?l.setShapes(p):l.add(p)},e.prototype.addCircles=function(t,i){var i=new kTe().merge(i),o=this.layers.getLayerById(i.name),a=!1;if(o||(a=!0,o=new _I("".concat(i.name,"-source"),i.name,{source:"".concat(i.name,"-source"),minZoom:i.minZoom,maxZoom:i.maxZoom,opacity:i.opacity,radius:["case",["has","radius"],["get","radius"],i.radius],color:["case",["has","color"],["get","color"],i.color],strokeColor:["case",["has","outlineColor"],["get","outlineColor"],i.outlineColor],strokeWidth:["case",["has","outlineWidth"],["get","outlineWidth"],i.outlineWidth]})),!(o instanceof _I))throw new Error("A layer with name '".concat(i.name,"' already exists but it is not a BubbleLayer.")+"A BubbleLayer should be used for rendering circles.");var l=o.getSource(),h=(typeof l=="string"?(p=l,l=this.sources.getById(p)):p=l.getId(),!1);if(l||(h=!0,l=new Ps(p)),!(l instanceof Ps))throw new Error("The source with name '".concat(p,"' already exists but it is not a DataSource.")+"New data can only be added to a DataSource.");h&&this.sources.add(l),a&&this.layers.add(o,i.before);var p=new yf(t);i.overwrite?l.setShapes(p):l.add(p)},e.prototype.addLinestrings=function(t,i){var i=new LTe().merge(i),o=this.layers.getLayerById(i.name),a=!1;if(o||(a=!0,o=new vI("".concat(i.name,"-source"),i.name,{source:"".concat(i.name,"-source"),minZoom:i.minZoom,maxZoom:i.maxZoom,lineCap:i.cap,lineJoin:i.join,strokeOpacity:i.opacity,strokeColor:["case",["has","color"],["get","color"],i.color],strokeWidth:["case",["has","width"],["get","width"],i.width]})),!(o instanceof vI))throw new Error("A layer with name '".concat(i.name,"' already exists but it is not a LineLayer.")+"A LineLayer should be used for rendering linestrings.");var l=o.getSource(),h=(typeof l=="string"?(p=l,l=this.sources.getById(p)):p=l.getId(),!1);if(l||(h=!0,l=new Ps(p)),!(l instanceof Ps))throw new Error("The source with name '".concat(p,"' already exists but it is not a DataSource.")+"New data can only be added to a DataSource.");h&&this.sources.add(l),a&&this.layers.add(o,i.before);var p=new yf(t);i.overwrite?l.setShapes(p):l.add(p)},e.prototype.addPolygons=function(t,i){var i=new BTe().merge(i),o=this.layers.getLayerById(i.name),a=!1;if(o||(a=!0,o=new bI("".concat(i.name,"-source"),i.name,{source:"".concat(i.name,"-source"),minZoom:i.minZoom,maxZoom:i.maxZoom,fillOpacity:i.opacity,fillColor:["case",["has","color"],["get","color"],i.color]})),!(o instanceof bI))throw new Error("A layer with name '".concat(i.name,"' already exists but it is not a PolygonLayer.")+"A PolygonLayer should be used for rendering linestrings.");var l=o.getSource(),h=(typeof l=="string"?(p=l,l=this.sources.getById(p)):p=l.getId(),!1);if(l||(h=!0,l=new Ps(p)),!(l instanceof Ps))throw new Error("The source with name '".concat(p,"' already exists but it is not a DataSource.")+"New data can only be added to a DataSource.");h&&this.sources.add(l),a&&this.layers.add(o,i.before);var p=new yf(t);i.overwrite?l.setShapes(p):l.add(p)},e.prototype.addRaster=function(t,o){var i,o=new zTe().merge(o),a=this.layers.getLayerById(o.name);if(!((a=a||new zx({maxZoom:o.maxZoom,minZoom:o.minZoom,opacity:o.opacity,tileSize:256,tileUrl:"{subdomain}"},o.name))instanceof zx))throw new Error("A layer with name '".concat(o.name,"' already exists but it is not a TileLayer.")+"A TileLayer should be used for rendering raster images.");if(a.getOptions().tileUrl!=="{subdomain}")throw new Error("A TileLayer with name '".concat(o.name,"' already exists but was configured ")+"for a single tile url [default for new TileLayer(...)].");(i=!o.overwrite&&a.getOptions().subdomains||[]).push.apply(i,iSe([],rSe(t),!1)),a._setOptionsNoUpdate({subdomains:i}),this.layers.add(a,o.before)},e.prototype.getLayers=function(){return this.layers.getLayers().map(function(t){return t.getId()})},e.prototype.removeLayers=function(t){var r,i;try{for(var o=Cw(t),a=o.next();!a.done;a=o.next()){var l,h=a.value;this.layers.getLayerById(h)&&(this.layers.remove(h),l="".concat(h,"-source"),this.sources.getById(l))&&this.sources.remove(l)}}catch(p){r={error:p}}finally{try{a&&!a.done&&(i=o.return)&&i.call(o)}finally{if(r)throw r.error}}},e.prototype.addHtml=function(t,r){t.id||(t.id="marker_".concat(qf()));var i=new hR({htmlContent:t});return this.markers.add(i,r),t.id},e.prototype.removeHtml=function(t){this.markers.remove(t)},e.prototype.addEventListener=function(t,r,i){this.events._addLegacy(t,r,i)},e.prototype.removeEventListener=function(t,r,i){this.events._removeLegacy(t,r,i)},e.prototype.setUserInteraction=function(t){this.userInteractionDelegate.setOptions(t)},e.prototype.getUserInteraction=function(){return this.userInteractionDelegate.getOptions()},e.prototype.addControl=function(t,r){this.controls.add(t,r)},e.prototype.removeControl=function(t){this.controls.remove(t)},e.prototype.setTraffic=function(t){var r=this.trafficOptions.incidents,i=this.trafficOptions.flow;if(this.trafficOptions=new Dx().merge(this.trafficOptions,t),this.controls.getControls().filter(function(o){return o instanceof gz}).forEach(function(o){return o.updateButtonState()}),this.incidentDelegate&&(this.trafficOptions.incidents?r||this.incidentDelegate.addToMap():this.incidentDelegate.removeFromMap()),this.trafficOptions.flow&&this.trafficOptions.flow!=="none"){["absolute","relative-delay"].includes(this.trafficOptions.flow)&&console.warn("The 'absolute' and 'relative-delay' flow options are deprecated. Please use 'relative' instead.");try{this.trafficOptions.flow!==i&&this.flowDelegate.addToMap()}catch(o){throw this.trafficOptions.flow=i,o}}else this.flowDelegate.removeFromMap()},e.prototype.getTraffic=function(){return ao(this.trafficOptions)},e.prototype.remove=function(){this.dispose()},e.prototype.clear=function(){this.popups.clear(),this.layers.clear(),this.sources.clear(),this.markers.clear(),this.indicators.clear()},e.prototype.dispose=function(){var t;for(this.clear(),this.map.remove(),(t=this.authentication)!=null&&t.dispose(),this.removed=!0,(t=this.resizeObserver)!=null&&t.disconnect(),this.resizeObserver=null;this.getMapContainer().firstChild;){var r=this.getMapContainer().firstChild;this.getMapContainer().removeChild(r)}},e.prototype.resize=function(t,r,i){typeof t!="number"&&typeof t!="string"||typeof r!="number"&&typeof r!="string"?i=t:(t=t,this.getMapContainer().style.height=typeof t=="number"?"".concat(t,"px"):t,this.getMapContainer().style.width=typeof r=="number"?"".concat(r,"px"):r),t=this.getMapContainer().style.overflow,this.getMapContainer().style.overflow="hidden",this.map.resize(i),this.getMapContainer().style.overflow=t},e.prototype.pixelsToPositions=function(t){var r,i,o=[];try{for(var a=Cw(t),l=a.next();!l.done;l=a.next()){var h=l.value,p=this.map.unproject(h);o.push(new Xo(p.lng,p.lat))}}catch(g){r={error:g}}finally{try{l&&!l.done&&(i=a.return)&&i.call(a)}finally{if(r)throw r.error}}return o},e.prototype.positionsToPixels=function(t){var r,i,o=[];try{for(var a=Cw(t),l=a.next();!l.done;l=a.next()){var h=l.value,p=this.map.project(h);o.push(new ta(p.x,p.y))}}catch(g){r={error:g}}finally{try{l&&!l.done&&(i=a.return)&&i.call(a)}finally{if(r)throw r.error}}return o},e.prototype.areTilesLoaded=function(){return this.map.areTilesLoaded()},e.prototype.stop=function(){this.map.stop()},e.prototype.triggerRepaint=function(){this.map.triggerRepaint()},e.prototype.enableElevation=function(t,r){this.map.setTerrain(typeof t=="string"?{source:t,exaggeration:r}:{source:t.getId(),exaggeration:r})},e.prototype.disableElevation=function(){this.map.setTerrain(null)},e.prototype._getMap=function(){return this.map},e.prototype._rebuildStyle=function(t){return t===void 0&&(t=!0),tSe(this,void 0,void 0,function(){return nSe(this,function(r){return this.styles.setStyle(this.styleOptions,t),this.imageSprite._restoreImages(),[2]})})},e.prototype._isLoaded=function(){return this.loaded},e.prototype._isReady=function(){return this.ready},e.prototype._getLocalizedStrings=function(){return this.localizedStringsPromise},e.prototype._sendRequest=function(t,r,i){var o;return(o=typeof this.serviceOptions.transformRequest=="function"?this.serviceOptions.transformRequest(t,r):o)?fetch(o.url||t,{credentials:o.credentials,headers:eu(eu({},i),o.headers),method:"GET",mode:"cors"}):fetch(t,{headers:i,method:"GET",mode:"cors"})},e.prototype._substituteDomainLanguageViewAndSignInRequest=function(t,r){var i;(t.includes(Nn.legacyDomainPlaceHolder)||t.includes(Nn.domainPlaceHolder))&&(i=new RegExp("[^{]".concat(Nn.legacyDomainPlaceHolder,"[^}]")),t.match(i)&&(r.url=r.url.replace(Nn.legacyDomainPlaceHolder,Nn.domainPlaceHolder)),vl.protoRegEx.test(this.serviceOptions.domain)?(i=r.url.indexOf(Nn.domainPlaceHolder),r.url=this.serviceOptions.domain+r.url.substring(i+Nn.domainPlaceHolder.length)):r.url=r.url.replace(Nn.domainPlaceHolder,this.serviceOptions.domain)),(r.url.toLocaleLowerCase().includes(this.serviceOptions.domain.toLocaleLowerCase())||r.url.toLocaleLowerCase().includes(this.serviceOptions.staticAssetsDomain.toLocaleLowerCase()))&&(i=this.authentication)!=null&&i.signRequest(r),t.includes(Nn.languagePlaceHolder)&&(r.url=r.url.replace(Nn.languagePlaceHolder,this.styleOptions.language)),t.includes(Nn.viewPlaceHolder)&&(r.url=this.styleOptions.view?r.url.replace(Nn.viewPlaceHolder,this.styleOptions.view):r.url.replace(Nn.viewPlaceHolder,"").replace("&".concat(Nn.viewParameter,"="),""))},e.prototype._setAutoResize=function(t){t?(this.resizeObserver||(this.resizeObserver=new ResizeObserver(this._resizeCallback)),this.resizeObserver.observe(this.map.getContainer())):this.resizeObserver&&this.resizeObserver.unobserve(this.map.getContainer())},e.prototype._setStyleComponents=function(t,r){var i=this;r===void 0&&(r=!0),this.removed||this.styles.definitions().then(function(o){var a,l,h=!0;if(i.styleOptions.style)try{for(var p=Cw(o.configurations),g=p.next();!g.done;g=p.next()){var _=g.value;if(i.styleOptions.style===_.name){h=!1;break}}}catch(x){a={error:x}}finally{try{g&&!g.done&&(l=p.return)&&l.call(p)}finally{if(a)throw a.error}}h&&(i.styleOptions.style=o.defaultConfiguration),i.styleOptions=t,i._rebuildStyle(r)})},e.prototype._updateGlobalDefaults=function(t){t&&(t.authOptions&&!sI()&&y8(t.authOptions),t.domain&&!A8()&&_8(t.domain),t.styleDefinitionsPath&&!I8()&&v8(t.styleDefinitionsPath),t.workerCount&&!P8()&&b8(t.workerCount),t.maxParallelImageRequests&&!M8()&&w8(t.maxParallelImageRequests),!t.subscriptionKey&&!t["subscription-key"]||sI()||T8(t.subscriptionKey||t["subscription-key"]),!t.sessionId&&!t["session-id"]||k8()||E8(t.sessionId||t["session-id"]),t.language&&!R8()&&x8(t.language),!t.userRegion&&!t.view||O8()||S8(t.userRegion||t.view))},e.prototype._generateSafeBounds=function(t){if(t){var r=lr.getSouth(t),i=lr.getWest(t),o=lr.getNorth(t),a=lr.getEast(t);if(!(isFinite(r)&&isFinite(i)&&isFinite(o)&&isFinite(a)))throw new Error("The bounds specified are invalid: [".concat(t,"]"));for(;a<i;)a+=360;return new lr([i,r,a,o])}return t},e.prototype._detectHighContrast=function(){var t,r;switch(B_e.getHighContrastMode()){case"invert":case"light":t=e.Css.hcLight,r="high_contrast_light";break;case"dark":t=e.Css.hcDark,r="high_contrast_dark"}t&&this.map.getContainer().classList.add(t),r&&this.styleOptions.style==="road"&&(this.styleOptions.style=r)},e.Css={canvasContainer:"atlas-map-canvas-container",canvas:"atlas-map-canvas",container:"atlas-map",hcDark:"high-contrast-dark",hcLight:"high-contrast-light"},e}(Du),oSe=window&&window.__read||function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var r,i,o=t.call(n),a=[];try{for(;(e===void 0||0<e--)&&!(r=o.next()).done;)a.push(r.value)}catch(l){i={error:l}}finally{try{r&&!r.done&&(t=o.return)&&t.call(o)}finally{if(i)throw i.error}}return a},aSe=window&&window.__spreadArray||function(n,e,t){if(t||arguments.length===2)for(var r,i=0,o=e.length;i<o;i++)!r&&i in e||((r=r||Array.prototype.slice.call(e,0,i))[i]=e[i]);return n.concat(r||Array.prototype.slice.call(e))},sSe=function(){function n(){this.detectHyperlinks=!0,this.parsePropertyPaths=!0}return n.applyTemplate=function(e,t){var r,i,o,a=this,l=document.createElement("div");return l.classList.add(n.Css.template),e&&(typeof(t=t||{}).singleDescription!="boolean"&&(t.singleDescription=!0),t.sandboxContent=typeof t.sandboxContent!="boolean"||t.sandboxContent,t.title&&typeof t.content=="string"&&(t.content.includes("{title}")||t.content.includes("{name}"))||(e.title?t.title="{title}":e.name&&(t.title="{name}")),typeof t.detectHyperlinks!="boolean"&&(t.detectHyperlinks=!0),typeof t.parsePropertyPaths!="boolean"&&(t.parsePropertyPaths=!0),t.textColor&&(l.style.color=t.textColor),t.fillColor&&(l.style.backgroundColor=t.fillColor),t.title&&((o=this._applyStringTemplate(e,t.title,t)).innerText=o.textContent||o.innerText||"",this._appendChild(l,o,n.Css.title)),(r=document.createElement("div")).classList.add(n.Css.content),Array.isArray(t.content)?0<t.content.length&&t.content[0].propertyPath?this._appendChild(r,this._generateContent(e,t.content,t),n.Css.item):t.content.forEach(function(h){a._appendChild(r,a._generateContent(e,h,t),n.Css.item)}):(i=0,o=void(e.description&&Object.keys(e).forEach(function(h){a._ignoreProperty(h,e[h])||i++})),i===1||t.singleDescription&&e.description||i===2&&e.Snippet?(o=document.createElement("div")).innerHTML=e.description:o=this._generateContent(e,t.content,t),this._appendChild(r,o,n.Css.item)),r.innerHTML!=="")&&(t.sandboxContent?l.appendChild(n._createSandboxedIframe(r,t)):l.appendChild(r)),l},n._createSandboxedIframe=function(i,t){var r=document.createElement("iframe"),i=(r.sandbox.add("allow-popups"),i.innerHTML),o=!1,_=100,a=550,l=10,g=(document.body.scrollWidth<=340&&(a=300,_=50),i.split(/<(tr|div|br|li|h[0-9]|p>)/)),p=Math.max.apply(Math,aSe([],oSe(g.map(function(x){return x.replace(/<[a-zA-Z0-9\s=\/]+>/g,"").length})),!1))-1,h=Math.ceil(3.5*p),p=(h<a&&(a=h,_=p),i.includes("<img")||i.includes("<video")?(o=!0,r.width="550px"):(h=-1<i.indexOf(n.Css.table)?25:20,l+=Math.max(.5*g.length*h,Math.ceil(i.replace(/<[a-zA-Z0-9\s=\/]+>/g,"").length/_)*h)),r.width=a+"px",r.height=o||280<l?"280px":l+"px",t.textColor?"color:".concat(t.textColor,";"):""),g=t.fillColor?"background-color:".concat(t.fillColor,";"):"",_='<html><head><title></title><meta charset="utf-8" /><meta http-equiv="x-ua-compatible" content="IE=Edge" />'+'<link rel="stylesheet" href="'.concat(n._cssUrl,'" type="text/css"/>')+"<style>html, body{margin:0;padding:0;".concat(p).concat(g,"}</style></head>")+'<body><div class="'.concat(n.Css.template,'" style="padding:0;width:').concat(a-20,'px">').concat(i,"</div></body></html>");return r.srcdoc===void 0?r.src="data:text/html;charset=utf-8,"+encodeURI(_):r.srcdoc=_,r},n._appendChild=function(e,t,r){t&&(r&&(t.className=(t.className?t.className+" ":"")+r),e.appendChild(t))},n._generateContent=function(e,t,r){return t?Array.isArray(t)?this._generatePropertyInfoTable(e,t,r):this._applyStringTemplate(e,t,r):(t=this._generateDynamicTableHtml(e,null,r))?((e=document.createElement("div")).innerHTML=t,e):null},n._applyStringTemplate=function(e,t,r){if(t){for(var i,o,a=t,l=this._placeholderRx.exec(t);l;)2<=l.length&&(i=this._getPropertyValue(e,l[1],r),a=a.replace(l[0],i)),l=this._placeholderRx.exec(t);if(a)return(a=a.trim()).includes("<")&&(a=a.replace(/[\r\n]+/g,"<br/>")),(o=document.createElement("div")).innerHTML=a,o}return null},n._getPropertyValue=function(e,t,r,i){var o=r.parsePropertyPaths?t.split("/"):[t],a=o.length;if(0<a&&e){var l=o[0],h=e[l];if(r.detectHyperlinks&&t==="link"&&(!i||i.hyperlinkFormat)){var p,g,_,x=[];if(Array.isArray(h)?h.forEach(function(z){z.href?x.push(z):typeof z=="string"&&x.push({href:z})}):h.href&&x.push(h),0<x.length)return i&&i.hyperlinkFormat?p=i.hyperlinkFormat:r&&r.hyperlinkFormat&&(p=r.hyperlinkFormat),g=p&&p.target?p.target:"_blank",_=[],x.forEach(function(z){z.title||p&&p.label||!z.rel||_.push(z.rel," - "),_.push('<a href="',z.href,'" target="',g,'">'),z.title?_.push(z.title):p&&p.label?_.push(p.label):_.push(z.href),_.push("</a>","<br/>")}),_.pop(),_.join("")}if(h!=null){for(var C=void 0,C=1;C<a&&(h=h[o[C]],l=o[C],h!=null);C++);if(C===a&&h!=null){if(e=void 0,(e=h.value!==void 0?h.value:h)instanceof Date)return i&&i.dateFormat?e.toLocaleString(void 0,i.dateFormat):r.dateFormat?e.toLocaleString(void 0,r.dateFormat):e.toISOString();if(typeof e=="object")return(M=this._generateDynamicTableHtml(e,o.slice(1),r))||"";if(typeof e=="number"){if(i){if(i.dateFormat)return new Date(e).toLocaleString(void 0,i.dateFormat);if(i.numberFormat)return e.toLocaleString(void 0,i.numberFormat)}else if(/(timestamp|date)/gi.test(l))return new Date(e).toISOString();return e.toLocaleString(void 0,r.numberFormat)}if(typeof e=="string"&&e!==""&&!/[\n\r<>\s]/g.test(e)&&(r.detectHyperlinks||i&&i.hyperlinkFormat)){var M,e=e.trim(),t=this._isUrlRx.test(e)||i&&i.hyperlinkFormat,L=this._isImageUrlRx.test(e)&&(t||e.startsWith("data:image")),D=this._emailRx.test(e);if(t||L||D)return t=void 0,M=void(i&&i.hyperlinkFormat?t=i.hyperlinkFormat:r&&r.hyperlinkFormat&&(t=r.hyperlinkFormat)),M=t&&t.target?' target="'.concat(t.target,'"'):' target="_blank"',i="".concat(t&&t.label?t.label:e),t&&t.scheme?e=t.scheme+e:D&&(e="mailto:"+e),r=t&&t.label?' alt="'.concat(t.label,'"'):"",(t&&t.isImage||L)&&(i='<img src="'.concat(e,'" style="max-width:100%"').concat(r,'"/>')),'<a href="'.concat(e,'"').concat(M,">").concat(i,"</a>")}return e.toString()}}}return""},n._generatePropertyInfoTable=function(e,t,r){var i,o;return e&&t&&0<t.length?((i=[]).push('<table class="'.concat((o=this).Css.table,'">')),t.forEach(function(a){var l=o._getPropertyValue(e,a.propertyPath,r,a);a.hideLabel?i.push('<tr><td colspan="2">',l,"</td></tr>"):(a=a.label||a.propertyPath.split("/")[0],i.push("<tr><th>",a,"</th><td>",l,"</td></tr>"))}),i.push("</table>"),(t=document.createElement("div")).innerHTML=i.join(""),t):null},n._generateDynamicTableHtml=function(e,t,r){var i,o,a,l,h=this;return!e||((i=[]).push('<table class="'.concat((o=this).Css.table,'">')),a=t&&0<t.length?t.join("/")+"/":"",l=0,Object.keys(e).forEach(function(p){h._ignoreProperty(p,e[p])||(i.push("<tr><th>",p,"</th><td>",o._getPropertyValue(e,a+p,r),"</td></tr>"),l++)}),l===0)?null:(i.push("</table>"),i.join(""))},n._ignoreProperty=function(e,t){switch(e){case"title":case"name":case"base":case"popupTemplate":case"anchor":case"icon":case"image":case"imageUrl":case"rotation":case"color":case"size":case"offset":case"strokeColor":case"strokeWidth":case"strokeOpacity":case"subType":case"fillColor":case"fillOpacity":case"visibility":case"visible":return!0;default:if(e.indexOf("_")===0||t==null||t==="")return!0}return!1},n._placeholderRx=/\{([a-zA-Z0-9_\/\s]+)\}/gi,n._isUrlRx=/^(http|https|ftp|tel|mailto):\/\//i,n._isImageUrlRx=/(^data:image|.png$|.jpg$|.jpeg$|.gif$|.bmp$|.svg|.tif|.tiff$)/i,n._emailRx=/^[^\.\s@:](?:[^\s@:]*[^\s@:\.])?@[^\.\s@]+(?:\.[^\.\s@]+)*$/,n._cssUrl=new vl({domain:Rc.staticAssetsDomain,path:"sdk/javascript/mapcontrol/".concat(lT.getEndpointVersion(),"/atlas.min.css")}).toString(),n.Css={template:"azure-maps-control-popup-template",title:"azure-maps-control-popup-template-title",content:"azure-maps-control-popup-template-content",item:"azure-maps-control-popup-template-content-item",table:"azure-maps-control-popup-template-table"},n}(),f5=(kD(),Object.freeze({__proto__:null,get AuthenticationType(){return li},get ControlPosition(){return Fa},get ControlStyle(){return Jo},HtmlMarker:hR,Map:HV,Pixel:ta,Popup:wT,PopupTemplate:sSe,Shape:Ii,_enableRTLTextPlugin:kD,_getAssetDomain:Oae,_getDomain:Lae,_hasMaxParallelImageRequests:M8,_hasSetAuthenticationOptions:sI,_hasSetDomain:A8,_hasSetLanguage:R8,_hasSetSessionId:k8,_hasSetStyleDefinitionsPath:I8,_hasSetStyleDefinitionsVersion:kae,_hasSetView:O8,_hasWorkerCount:P8,addImageTemplate:Cae,addProtocol:Mae,clearPrewarmedResources:Pae,control:Pye,data:gye,getAllImageTemplateNames:Aae,getAuthenticationOptions:a8,getDomain:Nx,getImageTemplate:C8,getLanguage:f8,getMaxParallelImageRequests:d8,getSessionId:p8,getStaticAssetsDomain:s8,getStyleAPIVersion:u8,getStyleDefinitionsPath:c8,getStyleDefinitionsVersion:l8,getSubscriptionKey:g8,getUserRegion:bae,getVersion:wae,getView:m8,getWorkerCount:h8,internal:Bae,isSupported:xae,layer:M_e,math:Tye,prewarm:Iae,removeProtocol:Rae,setAuthenticationOptions:y8,setDomain:_8,setLanguage:x8,setMaxParallelImageRequests:w8,setSessionId:E8,setStyleAPIVersion:Tae,setStyleDefinitionsPath:v8,setStyleDefinitionsVersion:Eae,setSubscriptionKey:T8,setUserRegion:S8,setView:Sae,setWorkerCount:b8,source:Zye}));let GV,HP,qV,Fv;function cSe(){lSe().then(n=>{({locations:HP,flows:qV}=n);const[e,t]=[globalThis.innerWidth,globalThis.innerHeight],r=LU(HP,a=>[a.lon,a.lat],[e,t],{pad:.3});Fv=new f5.Map("myMap",{style:"grayscale_dark",interactive:!1,center:[r.longitude,r.latitude],zoom:r.zoom,bearing:r.bearing,pitch:r.pitch,authOptions:{authType:"anonymous",clientId:"e6b6ab59-eb5d-4d25-aa57-581135b927f0",getToken:function(a,l,h){var p="https://samples.azuremaps.com/api/GetAzureMapsToken";fetch(p).then(g=>g.text()).then(g=>a(g))}}}),Fv.events.add("ready",()=>{Fv.controls.add(new f5.control.StyleControl({mapStyles:["road","grayscale_light","grayscale_dark","night","satellite"]}),{position:"top-right"})}),GV=new mM({canvas:"deck-canvas",width:"100%",height:"100%",initialViewState:r,controller:!0,map:!0,onViewStateChange:({viewState:a})=>{Fv.setCamera({center:[a.longitude,a.latitude],zoom:a.zoom,bearing:a.bearing,pitch:a.pitch})},layers:[]}),GP(),document.querySelectorAll(".control").forEach(a=>{a.onchange=GP}),document.getElementById("darkMode").onchange=uSe;const i=document.getElementById("deck-canvas"),o=document.getElementById("myMap");o.insertBefore(i,o.querySelector(".atlas-control-container"))})}async function lSe(){const[n,e]=await Promise.all([AD("/data/flowmap/locations.csv",t=>({id:t.id,name:t.name,lat:+t.lat,lon:+t.lon})),AD("/data/flowmap/flows.csv",t=>({origin:t.origin,dest:t.dest,count:+t.count}))]);return{locations:n,flows:e}}function GP(){GV.setProps({layers:[new NU({id:"my-flowmap-layer",data:{locations:HP,flows:qV},pickable:!0,darkMode:d0("darkMode"),colorScheme:fSe("colorScheme"),clusteringEnabled:d0("clusteringEnabled"),getLocationId:n=>n.id,getLocationLat:n=>n.lat,getLocationLon:n=>n.lon,getFlowOriginId:n=>n.origin,getFlowDestId:n=>n.dest,getFlowMagnitude:n=>n.count,getLocationName:n=>n.name,onHover:n=>hSe(dSe(n))})]})}function uSe(){Fv.setStyle({style:d0("darkMode")?"grayscale_dark":"grayscale_light"}),document.getElementById("deck-canvas").style.mixBlendMode=d0("darkMode")?"screen":"darken",document.getElementById("container").style.backgroundColor=d0("darkMode")?"#000":"#fff",GP()}function hSe(n){const e=document.getElementById("tooltip");if(!n){e.style.display="none";return}e.style.left=`${n.position.left}px`,e.style.top=`${n.position.top}px`,e.innerHTML=n.content,e.style.display="block"}function dSe(n){if(!n)return;const{x:e,y:t,object:r}=n,i={left:e,top:t};switch(r==null?void 0:r.type){case Jm.LOCATION:const o=document.createElement("b");o.innerText=r.name.replaceAll('"',"");const a=document.createElement("li");a.innerText=`Incoming trips: ${r.totals.incomingCount}`;const l=document.createElement("li");l.innerText=`Outgoing trips: ${r.totals.outgoingCount}`;const h=document.createElement("li");return h.innerText=`Internal or round trips: ${r.totals.internalCount}`,{position:i,content:[o,a,l,h].map(x=>x.outerHTML).join("")};case Jm.FLOW:const p=document.createElement("b");p.innerText="Route Info";const g=document.createElement("li");g.innerText=`Bike Station: ${r.origin.id.slice(2,-2)}  ${r.dest.id.slice(2,-2)}`;const _=document.createElement("li");return _.innerText=`Trips Count: ${r.count}`,{position:i,content:[p,g,_].map(x=>x.outerHTML).join("")}}}function fSe(n){var e=document.getElementById(n);return e.options[e.selectedIndex].value}function d0(n){return document.getElementById(n).checked}document.body.onload=cSe;
