/* MIT License - Copyright (c) Microsoft Corporation. */


!function(t,P){"use strict";var r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)};function e(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}var o=function(){return(o=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)},n=(i.merge=function(t,e){for(var n=window||global,r=0,i=t.split(".");r<i.length;r++){var a=i[r];if(!n[a])return e;n=n[a]}return o(o({},n),e)},i);function i(){}var s=(a.linear=function(t){return t},a.easeInSine=function(t){return 1-Math.cos(t*Math.PI*.5)},a.easeOutSine=function(t){return Math.sin(t*Math.PI*.5)},a.easeInOutSine=function(t){return-.5*(Math.cos(Math.PI*t)-1)},a.easeInQuad=function(t){return t*t},a.easeOutQuad=function(t){return t*(2-t)},a.easeInOutQuad=function(t){return t<.5?2*t*t:(4-2*t)*t-1},a.easeInCubic=function(t){return t*t*t},a.easeOutCubic=function(t){var e=t-1;return e*e*e+1},a.easeInOutCubic=function(t){return t<.5?4*t*t*t:(t-1)*(2*t-2)*(2*t-2)+1},a.easeInQuart=function(t){return t*t*t*t},a.easeOutQuart=function(t){var e=t-1;return 1-e*e*e*e},a.easeInOutQuart=function(t){if(t<.5)return 8*t*t*t*t;var e=t-1;return 1-8*e*e*e*e},a.easeInQuint=function(t){return t*t*t*t*t},a.easeOutQuint=function(t){var e=t-1;return 1+e*e*e*e*e},a.easeInOutQuint=function(t){if(t<.5)return 16*t*t*t*t*t;var e=t-1;return 1+16*e*e*e*e*e},a.easeInExpo=function(t){return 0===t?0:Math.pow(2,10*(t-1))},a.easeOutExpo=function(t){return 1===t?1:1-Math.pow(2,-10*t)},a.easeInOutExpo=function(t){if(0===t||1===t)return t;var e=2*t-1;return e<0?.5*Math.pow(2,10*e):.5*(2-Math.pow(2,-10*e))},a.easeInCirc=function(t){return-1*(Math.sqrt(1-t*t)-1)},a.easeOutCirc=function(t){var e=t-1;return Math.sqrt(1-e*e)},a.easeInOutCirc=function(t){var e=2*t;if(e<1)return-.5*(Math.sqrt(1-e*e)-1);var n=e-2;return.5*(Math.sqrt(1-n*n)+1)},a.easeInBack=function(t,e){return t*t*(((e=e||1.70158)+1)*t-e)},a.easeOutBack=function(t,e){var n=t-1;return n*n*(((e=e||1.70158)+1)*n+e)+1},a.easeInOutBack=function(t,e){var n=2*t,r=1.525*(e=e||1.70158);if(n<1)return.5*n*n*((1+r)*n-r);var i=n-2;return.5*(i*i*((1+r)*i+r)+2)},a.easeInElastic=function(t,e){if(0===t||1===t)return t;var n=t-1,r=1-(e=e||.7),i=r/(2*Math.PI)*Math.asin(1);return-(Math.pow(2,10*n)*Math.sin((n-i)*(2*Math.PI)/r))},a.easeOutElastic=function(t,e){if(0===t||1===t)return t;var n=1-(e=e||.7),r=2*t,i=n/(2*Math.PI)*Math.asin(1);return Math.pow(2,-10*r)*Math.sin((r-i)*(2*Math.PI)/n)+1},a.easeInOutElastic=function(t,e){if(0===t||1===t)return t;var n=1-(e=e||.65),r=2*t-1,i=n/(2*Math.PI)*Math.asin(1);return r<0?Math.pow(2,10*r)*Math.sin((r-i)*(2*Math.PI)/n)*-.5:Math.pow(2,-10*r)*Math.sin((r-i)*(2*Math.PI)/n)*.5+1},a.easeOutBounce=function(t){return t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(e=t-1.5/2.75)*e+.75:t<2.5/2.75?7.5625*(e=t-2.25/2.75)*e+.9375:7.5625*(e=t-2.625/2.75)*e+.984375;var e},a.easeInBounce=function(t){return 1-a.easeOutBounce(1-t)},a.easeInOutBounce=function(t){return t<.5?.5*a.easeInBounce(2*t):.5*a.easeOutBounce(2*t-1)+.5},a);function a(){}var M=(l.getProgress=function(t,e,n,r){return Math.max(Math.min((t-e)*r/n,1),0)},l.getStartTime=function(t,e,n){return performance.now()-Math.round(e*t/n)},l.getDimensions=function(t){if(t&&Array.isArray(t)&&0<t.length){if("number"==typeof t[0])return 0;if(Array.isArray(t[0])&&0<t[0].length){if("number"==typeof t[0][0])return 1;if(Array.isArray(t[0][0])&&0<t[0][0].length){if("number"==typeof t[0][0][0])return 2;if(Array.isArray(t[0][0][0])&&0<t[0][0][0].length&&"number"==typeof t[0][0][0][0])return 3}}}return-1},l.getSuitableCoordinates=function(t,e){var n="Point";if(t instanceof P.Shape&&(n=t.getType()),e){var r=l.getDimensions(e);switch(n){case"Point":switch(r){case 0:return e;case 1:return e[0];case 2:return e[0][0];case 3:return e[0][0][0]}break;case"MultiPoint":case"LineString":switch(r){case 0:return"MultiPoint"===n?[e]:[e,e];case 1:return e;case 2:return e[0];case 3:return e[0][0]}break;case"MultiLineString":case"Polygon":switch(r){case 0:return[[e,e,e]];case 1:return[e];case 2:return e;case 3:return e[0]}break;case"MultiPolygon":switch(r){case 0:return[[[e,e,e]]];case 1:return[[e]];case 2:return[e];case 3:return e}}}return null},l.getPixelHeading=function(t,e){var n=(e[0]-t[0])*Math.PI/180,r=(t[1]-e[1])*Math.PI/180;return 180*(2.5*Math.PI-Math.atan2(r,n))/Math.PI%360},l.getPixelDestination=function(t,e,n){return[t[0]+n*Math.cos((e+270)*Math.PI/180),t[1]+n*Math.sin((e+270)*Math.PI/180)]},l.setMetadata=function(t,e){t&&e&&(t instanceof P.Shape?t.setProperties(Object.assign(t.getProperties(),e)):t instanceof P.HtmlMarker&&(t.metadata=Object.assign(t.metadata||{},e)))},l.setCoordinates=function(t,e,n){if(t)if(t instanceof P.Shape)switch(t.getType()){case"Point":t.setCoordinates(e);break;case"LineString":n&&t.setCoordinates(n)}else t instanceof P.HtmlMarker&&t.setOptions({position:e})},l.getPropertyPath=function(t){return t.split("/")},l.setValue=function(t,e,n){if(1<e.length){var r=e.shift();l.setValue(t[r]="[object Object]"===Object.prototype.toString.call(t[r])?t[r]:{},e,n)}else t[e[0]]=n},l.getValue=function(t,e){var n=e.length;if(0<n&&t){var r=t[e[0]];if(null!=r){var i=void 0;for(i=1;i<n&&null!=(r=r[e[i]]);i++);if(i===n&&null!=r)return r}}return null},l.interpolateValue=function(t,e,n,r,i){if(t&&e&&r){r.interpolation=r.interpolation||"linear";var a=l.getPropertyPath(r.propertyPath),o=l.getValue(t.properties,a),s=l.getValue(e.properties,a),u=typeof o,h=typeof s;if("undefined"!=u&&"undefined"!=h&&u==h){var p=void 0;if(o instanceof Date&&(o=o.getTime(),p="Date"),s instanceof Date&&(s=s.getTime(),"Date"!==p))return null;var c=void 0;if("number"==u&&"number"==h)switch(r.interpolation){case"linear":c=o+(s-o)*n;break;case"min":c=Math.min(o,s);break;case"max":c=Math.max(o,s);break;case"avg":c=.5*(o+s)}else"nearest"===r.interpolation&&(c=n<.5?o:s);void 0!==c&&("Date"===p&&(c=new Date(c)),l.setValue(i,a,c))}}return null},l.extractRoutePointsFromFeature=function(t,e){var n,r,i=[];switch(t.geometry.type){case"Point":(n=l.extractRoutePointFromPoint(t,e))&&(i=[n]);break;case"LineString":case"MultiPoint":if(t.properties[e]&&Array.isArray(t.properties[e])&&t.geometry.coordinates.length===t.properties[e])for(var a=0,o=t.geometry.coordinates.length;a<o;a++)(r=P.math.parseTimestamp(t.properties[e]))&&i.push(new P.data.Feature(new P.data.Point(t.geometry.coordinates[a]),{_timestamp:r.getTime()}));else if(t.properties.waypoints&&Array.isArray(t.properties.waypoints)&&t.geometry.coordinates.length===t.properties.waypoints.length&&0<t.properties.waypoints.length&&t.properties.waypoints[0].geometry)for(a=0,o=t.geometry.coordinates.length;a<o;a++)"Point"===t.properties.waypoints[a].geometry.type&&(n=l.extractRoutePointFromPoint(t.properties.waypoints[a],e))&&i.push(n)}return 0<i.length?i:null},l.extractRoutePointFromPoint=function(t,e){if(t.properties[e]){var n=P.math.parseTimestamp(t.properties[e]);if(void 0!==n)return t.properties._timestamp=n.getTime(),t}return null},l);function l(){}var h=(u.prototype.disable=function(){this._stopped||(this._stopped=!0,cancelAnimationFrame(this._animation))},u.prototype.enable=function(){var t=this;t._stopped&&(t._stopped=!1,t._animation=requestAnimationFrame(t._animate.bind(t)))},u.prototype.add=function(t){return t._id||(t._id=this._getUuid()),this._idTable[t._id]||(this._queue.push(t),this._idTable[t._id]=t),t._id},u.prototype.getById=function(t){return this._idTable[t]},u.prototype.remove=function(t){if(t){var e=t._id;if(this._idTable[e])for(var n=this._queue,r=n.length-1;0<=r;r--)if(e===n[r]._id){this._queue=n.splice(r,1),this._idTable[e]=void 0;break}}},u.prototype.removeById=function(t){this.remove(this._idTable[t])},u.prototype._animate=function(){var t=this;if(!t._stopped){var e=performance.now();if(e-t._lastTime>=t._minFR){for(var n=t._queue,r=n.length-1;0<=r;r--)try{n[r]._onAnimationProgress(e)}catch(t){}t._lastTime=e}t._animation=requestAnimationFrame(t._animate.bind(t))}},u.prototype._getUuid=function(){return this._idCounter++},u.instance=new u,u);function u(){this._animation=null,this._queue=[],this._minFR=33,this._stopped=!0,this._idCounter=1234567890,this._idTable={},this._lastTime=performance.now(),this.enable()}var p,c=(e(f,p=P.internal.EventEmitter),f.prototype.dispose=function(){var t=this;t.stop(),h.instance.remove(t),t._options=null,t._easing=null,t._start=null,t._onComplete=null,t._id=void 0,t._rawProgress=null},f.prototype.getDuration=function(){var t=this._options;return t.loop?1/0:t.duration/t.speedMultiplier},f.prototype.getOptions=function(){return Object.assign({},this._options)},f.prototype.isPlaying=function(){return null!==this._start},f.prototype.play=function(t){var e=this;t&&e.reset(),1<=e._rawProgress&&(e._rawProgress=0),0<e._rawProgress?e._start=M.getStartTime(e._rawProgress,e._options.duration,e._options.speedMultiplier):e._start=performance.now()},f.prototype.pause=function(){this._start=null},f.prototype.seek=function(t){var e=this;if("number"==typeof t){var n=e.isPlaying();n&&e.pause(),e._rawProgress=Math.min(Math.max(t,0),1)/e._options.speedMultiplier,e._processFrame(),n&&e.play()}},f.prototype.setOptions=function(t){if(t){var e=this,n=e._options;t.easing&&("string"==typeof t.easing&&s[t.easing]?(e._easing=s[t.easing],n.easing=t.easing):t.easing instanceof Function&&(e._easing=t.easing,n.easing=t.easing)),"boolean"==typeof t.loop&&(n.loop=t.loop),"boolean"==typeof t.disposeOnComplete&&(n.disposeOnComplete=t.disposeOnComplete),"boolean"==typeof t.reverse&&(n.reverse=t.reverse),"number"==typeof t.speedMultiplier&&0<t.speedMultiplier&&(n.speedMultiplier=t.speedMultiplier);var r="number"==typeof t.duration&&0<t.duration&&n.duration!==t.duration,i="boolean"==typeof t.autoPlay;if(r||i){var a=e.isPlaying();a&&e.pause(),i&&(n.autoPlay=t.autoPlay||n.autoPlay,!a&&t.autoPlay&&(a=!0)),r&&(n.duration=t.duration||n.duration),a&&e.play()}}},f.prototype.stop=function(){this._rawProgress=1,this._processFrame(),this._start=null},f.prototype.reset=function(){this._start=null,this._rawProgress=0,this._processFrame()},f.prototype._onAnimationProgress=function(t){var e=this;e._start&&(e._rawProgress=M.getProgress(t,e._start,e._options.duration,e._options.speedMultiplier),e._processFrame())},f.prototype._processFrame=function(){var t=this,e=t._options;if(void 0!==t._id){var n=t._rawProgress||0;1<=n&&(e.loop?(t._rawProgress=0,t._start=performance.now()):(t._rawProgress=1,t._start=null,t._onComplete&&t._onComplete()));var r=e.reverse?1-t._rawProgress:t._rawProgress;t._easing&&(n=t._easing(r));var i=t.onAnimationProgress(n),a=Object.assign({progress:r,easingProgress:n,animation:t},i||{});t._invokeEvent("onprogress",Object.assign({type:"onprogress"},a)),null===t._start&&t._invokeEvent("oncomplete",Object.assign({type:"oncomplete"},a)),e.disposeOnComplete&&t.dispose()}},f);function f(t){var e=p.call(this)||this;e._start=null,e._rawProgress=0,e._options={duration:1e3,autoPlay:!1,easing:"linear",loop:!1,reverse:!1,speedMultiplier:1,disposeOnComplete:!1},e._easing=s.linear;var n=e;return n._id=h.instance.add(n),n.setOptions(t),e}var g,y=(e(v,g=c),v.prototype.getCurrentFrameIdx=function(){return this._numFrames<=0?-1:this._curFrameIdx},v.prototype.getNumberOfFrames=function(){return this._numFrames},v.prototype.setFrameIdx=function(t){(0<=t||t<this._numFrames)&&this.seek(this._numFrames/t)},v.prototype.setNumberOfFrames=function(t){var e=this;"number"==typeof t&&e._numFrames!==t&&(e._numFrames=Math.max(t,0),e._curFrameIdx=t<e._curFrameIdx?e._curFrameIdx:0,t<=0&&(e._curFrameIdx=-1),e._triggerFrame(e._curFrameIdx))},v.prototype.onAnimationProgress=function(t){var e=this._numFrames;if(0<e){var n=Math.round(t*e-.5);if(n!==this._curFrameIdx)return n===e?n--:n<0&&(n=-1),this._triggerFrame(n),{frameIdx:n}}return null},v.prototype._triggerFrame=function(t){var e=this;e._onFrame&&-1!==t&&e._onFrame(t),-1!==(e._curFrameIdx=t)&&e._invokeEvent("onframe",{type:"onFrame",frameIdx:t,animation:e,numFrames:e._numFrames})},v);function v(t,e,n){var r=g.call(this,n)||this;r._numFrames=0,r._curFrameIdx=-1;var i=r;return i._numFrames=t,i._onFrame=e,n&&n.autoPlay&&i.play(),r}var m,d=(e(_,m=P.layer.Layer),_.prototype.dispose=function(){var t=this;t._animation.stop(),h.instance.remove(t),h.instance.remove(t._animation),t._animation=void 0,t._onComplete=void 0,t._id=void 0,t._options=void 0},_.prototype.getDuration=function(){return this._options.loop?1/0:this._options.duration},_.prototype.getOptions=function(){return Object.assign({},this._options,this._animation.getOptions())},_.prototype.getPlayableAnimation=function(){return this._animation},_.prototype.isPlaying=function(){return this._animation.isPlaying()},_.prototype.pause=function(){this._animation.pause()},_.prototype.play=function(){this._animation.play()},_.prototype.reset=function(){this._animation.reset()},_.prototype.stop=function(){this._animation.stop()},_.prototype.setFrameIdx=function(t){this._animation.setFrameIdx(t)},_.prototype.setOptions=function(t){var e=this,n=e._animation,r=e._map,i=e._options,a=e._tileLayers;if(t&&(t.tileLayerOptions&&(0<a.length&&(r&&r.layers.remove(a),a=[],e._tileLayers=a,e._currentTileLayer=null),t.tileLayerOptions.forEach(function(t){t.fadeDuration=0,t.visible=!0,a.push(new P.layer.TileLayer(Object.assign({},t,{opacity:0})))}),r&&r.layers.add(a,e),i.tileLayerOptions=t.tileLayerOptions,n&&n.setNumberOfFrames(i.tileLayerOptions.length),0<=(o=n?e._animation.getCurrentFrameIdx():0)&&(e._currentTileLayer=a[o],e._currentTileLayer.setOptions({fadeDuration:0,visible:!0}))),"boolean"==typeof t.visible))if(i.visible=t.visible,t.visible){var o=n.getCurrentFrameIdx();0<t.tileLayerOptions.length&&e._currentTileLayer.setOptions({fadeDuration:0,opacity:t.tileLayerOptions[o].opacity})}else a.forEach(function(t){return t.setOptions({opacity:0})});if(n){var s=!1;Object.keys(t).forEach(function(t){switch(t){case"tileLayerOptions":case"visible":break;default:s=!0}}),s&&n.setOptions(t)}},_.prototype.onAdd=function(t){(this._map=t).layers.add(this._tileLayers,this)},_.prototype.onRemove=function(){var t=this;t.pause();var n=t._map;t._map=null,setTimeout(function(){var e=n.layers.getLayers();t._tileLayers.forEach(function(t){-1<e.indexOf(t)&&n.layers.remove(t)})},0)},_.prototype._buildLayers=function(){return[]},_.prototype._getLayerIds=function(){var e=[];return this._tileLayers.forEach(function(t){e.push(t.getId())}),e},_.prototype._buildSource=function(){return null},_.prototype._getSourceId=function(){return null},_.prototype._onAnimationProgress=function(t){return null},_);function _(t){var o=m.call(this)||this;o._tileLayers=[],o._options={tileLayerOptions:[],visible:!0},o._onFrame=function(t){var e=o,n=e._options;if(e._map&&n.visible&&n.tileLayerOptions&&0<n.tileLayerOptions.length&&t<n.tileLayerOptions.length){var r=e._map.map,i=e._currentTileLayer,a=void 0;i&&(a=i.getId(),r.setPaintProperty(a,"raster-opacity-transition",{duration:0,delay:0}),r.setPaintProperty(a,"raster-opacity",0)),i=e._tileLayers[t],a=(e._currentTileLayer=i).getId(),r.setPaintProperty(a,"raster-opacity-transition",{duration:0,delay:0}),r.setPaintProperty(a,"raster-opacity",n.tileLayerOptions[t].opacity)}};var e=o;e._id=h.instance.add(e);var n=0;return t&&(e.setOptions(t),t.tileLayerOptions&&(n=t.tileLayerOptions.length)),e._animation=new y(n,e._onFrame,t),e._onComplete=e._animation._onComplete,o}var x,b=Object.freeze({__proto__:null,AnimatedTileLayer:d}),w=(e(O,x=c),O.prototype.onAnimationProgress=function(t){for(var e,n,r=this._shapes,i=0,a=r.length;i<a;i++)if(n=this._y0[i]-this._height*(1-t),e=[this._x0[i],n],r[i]instanceof P.Shape){var o=r[i];o.setProperties(Object.assign(o.getProperties(),{offset:e,opacity:0!==t?1:0}))}else r[i].setOptions({pixelOffset:e,visible:0!==t});return null},O);function O(t,e,n,r){var i=x.call(this,r)||this;if(i._height=200,!(t&&0<t.length))throw"No shape specified for animation.";var a=i;a._shapes=t;var o=[];a._x0=o;var s=[];a._y0=s,a._height="number"==typeof n&&0<n?n:a._height;var u=[],h=void 0,p=void 0,c=void 0,l=[];e instanceof P.source.DataSource&&(p=e),e instanceof P.Map&&(l=(c=e).markers.getMarkers());for(var f=0,g=t.length;f<g;f++){if(h=null,t[f]instanceof P.Shape)h=t[f].getProperties().offset;else h=t[f].getOptions().pixelOffset;if(h&&Array.isArray(h)&&2<=h.length?(o.push(h[0]),s.push(h[1])):(o.push(0),s.push(0),h=[0,0]),h[1]-=a._height,t[f]instanceof P.Shape){var y=t[f];y.setProperties(Object.assign(y.getProperties(),{offset:h,opacity:0})),p&&null===p.getShapeById(t[f].getId())&&u.push(t[f])}else{var v=t[f];v.setOptions({pixelOffset:h,visible:!1}),c&&l&&-1===l.indexOf(v)&&c.markers.add(v)}}return p&&0<u.length&&p.add(u),r&&r.autoPlay&&a.play(),i}var L,A=(e(C,L=c),C.prototype.dispose=function(){this._pathOptions=null,L.prototype.dispose.call(this)},C.prototype.getOptions=function(){return Object.assign({},L.prototype.getOptions.call(this),this._pathOptions)},C.prototype.setOptions=function(t){if(t){var e=this._pathOptions;"number"==typeof t.duration&&0<t.duration&&(e.duration=t.duration||e.duration),"boolean"==typeof t.captureMetadata&&(e.captureMetadata=t.captureMetadata),"boolean"==typeof t.geodesic&&(e.geodesic=t.geodesic),"boolean"==typeof t.reverse&&(e.reverse=t.reverse),"number"==typeof t.pitch&&(e.pitch=t.pitch),"number"==typeof t.zoom&&(e.zoom=t.zoom),"boolean"==typeof t.rotate&&(e.rotate=t.rotate),"number"==typeof t.rotationOffset&&(e.rotationOffset=t.rotationOffset),!t.map&&null!==t.map||(e.map=t.map),L.prototype.setOptions.call(this,t)}},C.prototype._setMapCamera=function(t,e,n){var r=this._pathOptions;if(r.map&&t){var i={center:t};"number"==typeof r.pitch&&(i.pitch=r.pitch),"number"==typeof r.zoom&&(i.zoom=r.zoom),r.rotate&&"number"==typeof e&&(i.bearing=r.reverse?e+180:e,"number"==typeof r.rotationOffset&&(i.bearing+=r.rotationOffset)),n?(i.type="fly",i.duration=Math.min(60,r.duration)):i.type="jump",r.map.setCamera(i)}},C.prototype.onAnimationProgress=function(t){return null},C);function C(t){var e=L.call(this,t)||this;return e._pathOptions={duration:1e3},e.setOptions(t),e}var I,k=(e(S,I=A),S.prototype.setOptions=function(t){t&&I.prototype.setOptions.call(this,t);var e=this,n=e._originPosition,r=e._destinationPosition,i=P.math,a=P.Pixel;if(n&&r){if(e._pathOptions.geodesic)e._dx=i.getDistanceTo(n,r),e._heading=i.getHeading(n,r);else{var o=i.mercatorPositionsToPixels([n,r],21);if(e._originPixel=o[0],180<Math.abs(n[0]-r[0])){var s=512*Math.pow(2,21);o[0][0]>o[1][0]?o[1][0]+=s:o[0][0]+=s}e._dx=a.getDistance(o[0],o[1]),e._heading=a.getHeading(o[0],o[1])}e._pathOptions.captureMetadata&&M.setMetadata(e._shape,{heading:e._heading})}},S.prototype.onAnimationProgress=function(t){var e=this,n=e._originPosition,r=e._heading,i=e._destinationPosition,a=P.math,o=e._pathOptions;if(n&&i&&o){var s=void 0,u=!1;if(1===t)s=i;else if(0===t)s=n;else{var h=e._dx*t;s=o.geodesic?a.getDestination(n,r,h):a.mercatorPixelsToPositions([P.Pixel.getDestination(e._originPixel,r,h)],21)[0],u=!0}return M.setCoordinates(e._shape,s),o.map&&e._setMapCamera(s,r,u),{position:s,heading:r}}return null},S);function S(t,e,n){var r,i=I.call(this)||this,a=i;return r=t instanceof P.Shape?t.getCoordinates():t.getOptions().position,a._originPosition=r,a._shape=t,a._destinationPosition=e,a.setOptions(n),n&&n.autoPlay&&a.play(),i}var T,F=(e(E,T=A),E.prototype.dispose=function(){var e=this;Object.keys(this).forEach(function(t){e[t]=void 0}),T.prototype.dispose.call(this)},E.prototype.setOptions=function(t){var e=this;t&&T.prototype.setOptions.call(this,t);var n=e.isPlaying();if(n&&e.pause(),e._positions){var r=0,i=[],a=[],o=e._positions,s=P.math;if(e._pathOptions.geodesic)for(var u=1,h=o.length;u<h;u++){r+=l=s.getDistanceTo(o[u-1],o[u]),i.push(l);var p=s.getHeading(o[u-1],o[u]);a.push(p)}else{var c=s.mercatorPositionsToPixels(o,21);for(u=1,h=(e._pixels=c).length;u<h;u++){var l;r+=l=P.Pixel.getDistance(c[u-1],c[u]),i.push(l),p=M.getPixelHeading(c[u-1],c[u]),a.push(p)}}e._totalLength=r,e._distances=i,e._headings=a,e._pathOptions.captureMetadata&&M.setMetadata(e._shape,{heading:e._headings[0]})}n&&e.play()},E.prototype.onAnimationProgress=function(t){var e,n,r=this,i=r._shape,a=r._positions,o=r._headings,s=r._distances,u=r._pathOptions,h=r._totalLength,p=P.math;if(1===t)e=a[a.length-1],n=0<o.length?o[o.length-1]:void 0,u.map&&r._setMapCamera(e,n,!1),M.setCoordinates(i,e,a);else if(0===t)e=a[0],n=0<o.length?o[0]:void 0,u.map&&r._setMapCamera(e,n,!1),M.setCoordinates(i,e,[e,e]);else{var c=h*t,l=null;if(u.geodesic)if(h<c)n=o[o.length-1],l=a.slice(0);else if(c<0)n=o[0],l=a.slice(0,1);else for(var f=0,g=0;g<s.length;g++){if(f+s[g]>=c){n=o[g],(l=a.slice(0,g+1)).push(p.getDestination(a[g],n,c-f));break}f+=s[g]}else{var y=null,v=r._pixels;if(h<c)n=o[o.length-1],y=M.getPixelDestination(v[v.length-1],n,c-h),(l=a.slice(0)).push(p.mercatorPixelsToPositions([y],21)[0]);else if(c<0)n=o[0],y=M.getPixelDestination(v[0],n,c),(l=a.slice(0,1)).push(p.mercatorPixelsToPositions([y],21)[0]);else for(g=f=0;g<s.length;g++){if(f+s[g]>=c){n=o[g],y=M.getPixelDestination(v[g],n,c-f),(l=a.slice(0,g+1)).push(p.mercatorPixelsToPositions([y],21)[0]);break}f+=s[g]}}l&&0<l.length&&(e=l[l.length-1],u.map&&r._setMapCamera(e,n,2<l.length),M.setCoordinates(i,e,l))}return u.captureMetadata&&M.setMetadata(i,{heading:n}),{position:e,heading:n}},E);function E(t,e,n){var r=T.call(this)||this,i=r;return i._shape=e,i._positions=t,i.setOptions(Object.assign({rotate:!0,rotationOffset:0},n||{})),n&&n.autoPlay&&i.play(),r}var q,D,j=(function(t){!function(t){function e(t){return 10===t||13===t||8232===t||8233===t||32===t||9===t||11===t||12===t||160===t||t>=5760&&ie.indexOf(t)>=0}function o(t){switch(32|t){case 109:case 122:case 108:case 104:case 118:case 99:case 115:case 113:case 116:case 97:case 114:return!0}return!1}function h(t){return t>=48&&t<=57}function s(t){return t>=48&&t<=57||43===t||45===t||46===t}function r(t){this.index=0,this.path=t,this.max=t.length,this.result=[],this.param=0,this.err="",this.segmentStart=0,this.data=[]}function u(t){for(;t.index<t.max&&e(t.path.charCodeAt(t.index));)t.index++}function p(t){var e,n=t.index,r=n,i=t.max,a=!1,o=!1,s=!1,u=!1;if(r>=i)return void(t.err="SvgPath: missed param (at pos "+r+")");if(e=t.path.charCodeAt(r),43!==e&&45!==e||(r++,e=r<i?t.path.charCodeAt(r):0),!h(e)&&46!==e)return void(t.err="SvgPath: param should start with 0..9 or `.` (at pos "+r+")");if(46!==e){if(a=48===e,r++,e=r<i?t.path.charCodeAt(r):0,a&&r<i&&e&&h(e))return void(t.err="SvgPath: numbers started with `0` such as `09` are ilegal (at pos "+n+")");for(;r<i&&h(t.path.charCodeAt(r));)r++,o=!0;e=r<i?t.path.charCodeAt(r):0}if(46===e){for(u=!0,r++;h(t.path.charCodeAt(r));)r++,s=!0;e=r<i?t.path.charCodeAt(r):0}if(101===e||69===e){if(u&&!o&&!s)return void(t.err="SvgPath: invalid float exponent (at pos "+r+")");if(r++,e=r<i?t.path.charCodeAt(r):0,43!==e&&45!==e||r++,!(r<i&&h(t.path.charCodeAt(r))))return void(t.err="SvgPath: invalid float exponent (at pos "+r+")");for(;r<i&&h(t.path.charCodeAt(r));)r++}t.index=r,t.param=parseFloat(t.path.slice(n,r))+0}function c(t){var e,n;e=t.path[t.segmentStart],n=e.toLowerCase();var r=t.data;if("m"===n&&r.length>2&&(t.result.push([e,r[0],r[1]]),r=r.slice(2),n="l",e="m"===e?"l":"L"),"r"===n)t.result.push([e].concat(r));else for(;r.length>=re[n]&&(t.result.push([e].concat(r.splice(0,re[n]))),re[n]););}function i(t){var e,n,r,i,a=t.max;if(t.segmentStart=t.index,e=t.path.charCodeAt(t.index),!o(e))return void(t.err="SvgPath: bad command "+t.path[t.index]+" (at pos "+t.index+")");if(r=re[t.path[t.index].toLowerCase()],t.index++,u(t),t.data=[],!r)return void c(t);for(n=!1;;){for(i=r;i>0;i--){if(p(t),t.err.length)return;t.data.push(t.param),u(t),n=!1,t.index<a&&44===t.path.charCodeAt(t.index)&&(t.index++,u(t),n=!0)}if(!n){if(t.index>=t.max)break;if(!s(t.path.charCodeAt(t.index)))break}}c(t)}function n(t,e){return[t[0]*e[0]+t[2]*e[1],t[1]*e[0]+t[3]*e[1],t[0]*e[2]+t[2]*e[3],t[1]*e[2]+t[3]*e[3],t[0]*e[4]+t[2]*e[5]+t[4],t[1]*e[4]+t[3]*e[5]+t[5]]}function a(){if(!(this instanceof a))return new a;this.queue=[],this.cache=null}function A(t,e,n,r){var i=t*r-e*n<0?-1:1,a=Math.sqrt(t*t+e*e),o=Math.sqrt(t*t+e*e),s=t*n+e*r,u=s/(a*o);return u>1&&(u=1),u<-1&&(u=-1),i*Math.acos(u)}function x(t,e,n,r,i,a,o,s,u,h){var p=h*(t-n)/2+u*(e-r)/2,c=-u*(t-n)/2+h*(e-r)/2,l=o*o,f=s*s,g=p*p,y=c*c,v=l*f-l*y-f*g;v<0&&(v=0),v/=l*y+f*g,v=Math.sqrt(v)*(i===a?-1:1);var m=v*o/s*c,d=v*-s/o*p,_=h*m-u*d+(t+n)/2,x=u*m+h*d+(e+r)/2,P=(p-m)/o,M=(c-d)/s,b=(-p-m)/o,w=(-c-d)/s,O=A(1,0,P,M),L=A(P,M,b,w);return 0===a&&L>0&&(L-=ce),1===a&&L<0&&(L+=ce),[_,x,O,L]}function P(t,e){var n=4/3*Math.tan(e/4),r=Math.cos(t),i=Math.sin(t),a=Math.cos(t+e),o=Math.sin(t+e);return[r,i,r-i*n,i+r*n,a+o*n,o-a*n,a,o]}function l(t,e,n){if(!(this instanceof l))return new l(t,e,n);this.rx=t,this.ry=e,this.ax=n}function f(t){if(!(this instanceof f))return new f(t);var e=ae(t);this.segments=e.segments,this.err=e.err,this.__stack=[]}function g(t){var e=t.match(xe);return e?e.map(Number):[]}function y(t,e,n,r,i,a,o,s){this.a={x:t,y:e},this.b={x:n,y:r},this.c={x:i,y:a},this.d={x:o,y:s},null!==o&&void 0!==o&&null!==s&&void 0!==s?(this.getArcLength=C,this.getPoint=M,this.getDerivative=m):(this.getArcLength=b,this.getPoint=_,this.getDerivative=v),this.init()}function v(t,e,n){return{x:2*(1-n)*(t[1]-t[0])+2*n*(t[2]-t[1]),y:2*(1-n)*(e[1]-e[0])+2*n*(e[2]-e[1])}}function m(t,e,n){return _([3*(t[1]-t[0]),3*(t[2]-t[1]),3*(t[3]-t[2])],[3*(e[1]-e[0]),3*(e[2]-e[1]),3*(e[3]-e[2])],n)}function d(t,e,n,r,i){for(var a=1,o=t/e,s=(t-n(r,i,o))/e;a>.001;){var u=n(r,i,o+s),h=n(r,i,o-s),p=Math.abs(t-u)/e,c=Math.abs(t-h)/e;p<a?(a=p,o+=s):c<a?(a=c,o-=s):s/=2}return o}function _(t,e,n){return{x:(1-n)*(1-n)*t[0]+2*(1-n)*n*t[1]+n*n*t[2],y:(1-n)*(1-n)*e[0]+2*(1-n)*n*e[1]+n*n*e[2]}}function M(t,e,n){return{x:(1-n)*(1-n)*(1-n)*t[0]+3*(1-n)*(1-n)*n*t[1]+3*(1-n)*n*n*t[2]+n*n*n*t[3],y:(1-n)*(1-n)*(1-n)*e[0]+3*(1-n)*(1-n)*n*e[1]+3*(1-n)*n*n*e[2]+n*n*n*e[3]}}function b(t,e,n){void 0===n&&(n=1);var r=t[0]-2*t[1]+t[2],i=e[0]-2*e[1]+e[2],a=2*t[1]-2*t[0],o=2*e[1]-2*e[0],s=4*(r*r+i*i),u=4*(r*a+i*o),h=a*a+o*o;if(0===s)return n*Math.sqrt(Math.pow(t[2]-t[0],2)+Math.pow(e[2]-e[0],2));var p=u/(2*s),c=h/s,l=n+p,f=c-p*p;return Math.sqrt(s)/2*(l*Math.sqrt(l*l+f)-p*Math.sqrt(p*p+f)+f*Math.log(Math.abs((l+Math.sqrt(l*l+f))/(p+Math.sqrt(p*p+f)))))}function w(t,e){return we[t][e]}function O(t,e,n){var r,i,a,o=n.length-1;if(0===o)return 0;if(0===t){for(i=0,a=0;a<=o;a++)i+=w(o,a)*Math.pow(1-e,o-a)*Math.pow(e,a)*n[a];return i}for(r=new Array(o),a=0;a<o;a++)r[a]=o*(n[a+1]-n[a]);return O(t-1,e,r)}function L(t,e,n){var r=O(1,n,t),i=O(1,n,e),a=r*r+i*i;return Math.sqrt(a)}function C(t,e,n){var r,i,a,o;void 0===n&&(n=1);for(r=n/2,i=0,a=0;a<20;a++)o=r*Me[20][a]+r,i+=be[20][a]*L(t,e,o);return r*i}function I(t,e,n,r){var i=t*r-e*n<0?-1:1,a=t*n+e*r;return a>1&&(a=1),a<-1&&(a=-1),i*Math.acos(a)}function k(t,e,n,r,i,a,o,s,u,h){var p=h*(t-n)/2+u*(e-r)/2,c=-u*(t-n)/2+h*(e-r)/2,l=o*o,f=s*s,g=p*p,y=c*c,v=l*f-l*y-f*g;v<0&&(v=0),v/=l*y+f*g,v=Math.sqrt(v)*(i===a?-1:1);var m=v*o/s*c,d=v*-s/o*p,_=h*m-u*d+(t+n)/2,x=u*m+h*d+(e+r)/2,P=(p-m)/o,M=(c-d)/s,b=(-p-m)/o,w=(-c-d)/s,O=I(1,0,P,M),L=I(P,M,b,w);return 0===a&&L>0&&(L-=Oe),1===a&&L<0&&(L+=Oe),[_,x,O,L]}function S(t,e){var n=4/3*Math.tan(e/4),r=Math.cos(t),i=Math.sin(t),a=Math.cos(t+e),o=Math.sin(t+e);return[r,i,r-i*n,i+r*n,a+o*n,o-a*n,a,o]}function T(t,e,n,r,i,a,o,s,u){var h=0,p=[],c=[];Le(t,e,n,r,i,a,o,s,u).forEach(function(t){var e=new Pe(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7]),n=e.getTotalLength();h+=n,p.push(n),c.push(e)}),this.length=h,this.partialLengths=p,this.curves=c}function F(t,e,n,r){this.x0=t,this.x1=e,this.y0=n,this.y1=r}function E(t,e){return Math.sqrt((t[0]-e[0])*(t[0]-e[0])+(t[1]-e[1])*(t[1]-e[1]))}function q(t,e,n){return[t[0]+(e[0]-t[0])*n,t[1]+(e[1]-t[1])*n]}function D(t,e){return E(t,e)<1e-9}function j(t,n,r){var i=t.map(function(t,e){return Z(t,n[e])});return function(e){var t=i.map(function(t){return t(e)});return r?V(t):t}}function Z(t,r){return function(n){return t.map(function(t,e){return t+n*(r[e]-t)})}}function G(t){return"number"==typeof t&&isFinite(t)}function z(t){return B(t)?ee(t):[(t[0][0]+t[t.length-1][0])/2,(t[0][1]+t[t.length-1][1])/2]}function B(t){for(var e=0;e<t.length-2;e++){var n=t[e],r=t[e+1],i=t[e+2];if(n[0]*(r[1]-i[1])+r[0]*(i[1]-n[1])+i[0]*(n[1]-r[1]))return!0}return!1}function H(t){return new ve(t).abs()}function N(t){return t.toString().split("M").map(function(t,e){return t=t.trim(),e&&t?"M"+t:t}).filter(function(t){return t})}function V(t){return"M"+t.join("L")+"Z"}function R(t){return N(H(t))}function Q(t,e){var n=H(t);return J(n)||X(n,e)}function J(t){var e=t.segments||[],n=[];if(!e.length||"M"!==e[0][0])return!1;for(var r=0;r<e.length;r++){var i=e[r],a=i[0],o=i[1],s=i[2];if("M"===a&&r||"Z"===a)break;if("M"===a||"L"===a)n.push([o,s]);else if("H"===a)n.push([o,n[n.length-1][1]]);else{if("V"!==a)return!1;n.push([n[n.length-1][0],o])}}return!!n.length&&{ring:n}}function X(t,e){var n,r,i=N(t)[0],a=[],o=3;if(!i)throw new TypeError(ke);r=Y(i),n=r.getTotalLength(),e&&G(e)&&e>0&&(o=Math.max(o,Math.ceil(n/e)));for(var s=0;s<o;s++){var u=r.getPointAtLength(n*s/o);a.push([u.x,u.y])}return{ring:a,skipBisect:!0}}function Y(t){if("undefined"!=typeof window&&window&&window.document)try{var e=window.document.createElementNS("http://www.w3.org/2000/svg","path");return e.setAttributeNS(null,"d",t),e}catch(t){}return Ie(t)}function U(t,e){for(var n=t.length+e,r=ne(t)/e,i=0,a=0,o=r/2;t.length<n;){var s=t[i],u=t[(i+1)%t.length],h=E(s,u);o<=a+h?(t.splice(i+1,0,h?q(s,u,(o-a)/h):s.slice(0)),o+=r):(a+=h,i++)}}function W(t,e){void 0===e&&(e=1/0);for(var n=0;n<t.length;n++)for(var r=t[n],i=n===t.length-1?t[0]:t[n+1];E(r,i)>e;)i=q(r,i,.5),t.splice(n+1,0,i)}function $(t,e){var n,r,i;if("string"==typeof t){var a=Q(t,e);t=a.ring,i=a.skipBisect}else if(!Array.isArray(t))throw new TypeError(ke);if(n=t.slice(0),!K(n))throw new TypeError(ke);return n.length>1&&D(n[0],n[n.length-1])&&n.pop(),r=te(n),r>0&&n.reverse(),!i&&e&&G(e)&&e>0&&W(n,e),n}function K(t){return t.every(function(t){return Array.isArray(t)&&t.length>=2&&G(t[0])&&G(t[1])})}function tt(t,e,n){var r;return r=t.length-e.length,U(t,r<0?-1*r:0),U(e,r>0?r:0),Te(t,e),j(t,e,n)}function et(t,e,n){n=n||2;var r=e&&e.length,i=r?e[0]*n:t.length,a=nt(t,0,i,n,!0),o=[];if(!a)return o;var s,u,h,p,c,l,f;if(r&&(a=ht(t,e,a,n)),t.length>80*n){s=h=t[0],u=p=t[1];for(var g=n;g<i;g+=n)c=t[g],l=t[g+1],c<s&&(s=c),l<u&&(u=l),c>h&&(h=c),l>p&&(p=l);f=Math.max(h-s,p-u)}return it(a,o,n,s,u,f),o}function nt(t,e,n,r,i){var a,o;if(i===It(t,e,n,r)>0)for(a=e;a<n;a+=r)o=Lt(a,t[a],t[a+1],o);else for(a=n-r;a>=e;a-=r)o=Lt(a,t[a],t[a+1],o);return o&&xt(o,o.next)&&(At(o),o=o.next),o}function rt(t,e){if(!t)return t;e||(e=t);var n,r=t;do{if(n=!1,r.steiner||!xt(r,r.next)&&0!==_t(r.prev,r,r.next))r=r.next;else{if(At(r),(r=e=r.prev)===r.next)return null;n=!0}}while(n||r!==e);return e}function it(t,e,n,r,i,a,o){if(t){!o&&a&&ft(t,r,i,a);for(var s,u,h=t;t.prev!==t.next;)if(s=t.prev,u=t.next,a?ot(t,r,i,a):at(t))e.push(s.i/n),e.push(t.i/n),e.push(u.i/n),At(t),t=u.next,h=u.next;else if((t=u)===h){o?1===o?(t=st(t,e,n),it(t,e,n,r,i,a,2)):2===o&&ut(t,e,n,r,i,a):it(rt(t),e,n,r,i,a,1);break}}}function at(t){var e=t.prev,n=t,r=t.next;if(_t(e,n,r)>=0)return!1;for(var i=t.next.next;i!==t.prev;){if(mt(e.x,e.y,n.x,n.y,r.x,r.y,i.x,i.y)&&_t(i.prev,i,i.next)>=0)return!1;i=i.next}return!0}function ot(t,e,n,r){var i=t.prev,a=t,o=t.next;if(_t(i,a,o)>=0)return!1;for(var s=i.x<a.x?i.x<o.x?i.x:o.x:a.x<o.x?a.x:o.x,u=i.y<a.y?i.y<o.y?i.y:o.y:a.y<o.y?a.y:o.y,h=i.x>a.x?i.x>o.x?i.x:o.x:a.x>o.x?a.x:o.x,p=i.y>a.y?i.y>o.y?i.y:o.y:a.y>o.y?a.y:o.y,c=yt(s,u,e,n,r),l=yt(h,p,e,n,r),f=t.nextZ;f&&f.z<=l;){if(f!==t.prev&&f!==t.next&&mt(i.x,i.y,a.x,a.y,o.x,o.y,f.x,f.y)&&_t(f.prev,f,f.next)>=0)return!1;f=f.nextZ}for(f=t.prevZ;f&&f.z>=c;){if(f!==t.prev&&f!==t.next&&mt(i.x,i.y,a.x,a.y,o.x,o.y,f.x,f.y)&&_t(f.prev,f,f.next)>=0)return!1;f=f.prevZ}return!0}function st(t,e,n){var r=t;do{var i=r.prev,a=r.next.next;!xt(i,a)&&Pt(i,r,r.next,a)&&bt(i,a)&&bt(a,i)&&(e.push(i.i/n),e.push(r.i/n),e.push(a.i/n),At(r),At(r.next),r=t=a),r=r.next}while(r!==t);return r}function ut(t,e,n,r,i,a){var o=t;do{for(var s=o.next.next;s!==o.prev;){if(o.i!==s.i&&dt(o,s)){var u=Ot(o,s);return o=rt(o,o.next),u=rt(u,u.next),it(o,e,n,r,i,a),void it(u,e,n,r,i,a)}s=s.next}o=o.next}while(o!==t)}function ht(t,e,n,r){var i,a,o,s,u,h=[];for(i=0,a=e.length;i<a;i++)o=e[i]*r,s=i<a-1?e[i+1]*r:t.length,u=nt(t,o,s,r,!1),u===u.next&&(u.steiner=!0),h.push(vt(u));for(h.sort(pt),i=0;i<h.length;i++)ct(h[i],n),n=rt(n,n.next);return n}function pt(t,e){return t.x-e.x}function ct(t,e){if(e=lt(t,e)){var n=Ot(e,t);rt(n,n.next)}}function lt(t,e){var n,r=e,i=t.x,a=t.y,o=-1/0;do{if(a<=r.y&&a>=r.next.y){var s=r.x+(a-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(s<=i&&s>o){if(o=s,s===i){if(a===r.y)return r;if(a===r.next.y)return r.next}n=r.x<r.next.x?r:r.next}}r=r.next}while(r!==e);if(!n)return null;if(i===o)return n.prev;var u,h=n,p=n.x,c=n.y,l=1/0;for(r=n.next;r!==h;)i>=r.x&&r.x>=p&&mt(a<c?i:o,a,p,c,a<c?o:i,a,r.x,r.y)&&((u=Math.abs(a-r.y)/(i-r.x))<l||u===l&&r.x>n.x)&&bt(r,t)&&(n=r,l=u),r=r.next;return n}function ft(t,e,n,r){var i=t;do{null===i.z&&(i.z=yt(i.x,i.y,e,n,r)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next}while(i!==t);i.prevZ.nextZ=null,i.prevZ=null,gt(i)}function gt(t){var e,n,r,i,a,o,s,u,h=1;do{for(n=t,t=null,a=null,o=0;n;){for(o++,r=n,s=0,e=0;e<h&&(s++,r=r.nextZ);e++);for(u=h;s>0||u>0&&r;)0===s?(i=r,r=r.nextZ,u--):0!==u&&r?n.z<=r.z?(i=n,n=n.nextZ,s--):(i=r,r=r.nextZ,u--):(i=n,n=n.nextZ,s--),a?a.nextZ=i:t=i,i.prevZ=a,a=i;n=r}a.nextZ=null,h*=2}while(o>1);return t}function yt(t,e,n,r,i){return t=32767*(t-n)/i,e=32767*(e-r)/i,t=16711935&(t|t<<8),t=252645135&(t|t<<4),t=858993459&(t|t<<2),t=1431655765&(t|t<<1),e=16711935&(e|e<<8),e=252645135&(e|e<<4),e=858993459&(e|e<<2),e=1431655765&(e|e<<1),t|e<<1}function vt(t){var e=t,n=t;do{e.x<n.x&&(n=e),e=e.next}while(e!==t);return n}function mt(t,e,n,r,i,a,o,s){return(i-o)*(e-s)-(t-o)*(a-s)>=0&&(t-o)*(r-s)-(n-o)*(e-s)>=0&&(n-o)*(a-s)-(i-o)*(r-s)>=0}function dt(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!Mt(t,e)&&bt(t,e)&&bt(e,t)&&wt(t,e)}function _t(t,e,n){return(e.y-t.y)*(n.x-e.x)-(e.x-t.x)*(n.y-e.y)}function xt(t,e){return t.x===e.x&&t.y===e.y}function Pt(t,e,n,r){return!!(xt(t,e)&&xt(n,r)||xt(t,r)&&xt(n,e))||_t(t,e,n)>0!=_t(t,e,r)>0&&_t(n,r,t)>0!=_t(n,r,e)>0}function Mt(t,e){var n=t;do{if(n.i!==t.i&&n.next.i!==t.i&&n.i!==e.i&&n.next.i!==e.i&&Pt(n,n.next,t,e))return!0;n=n.next}while(n!==t);return!1}function bt(t,e){return _t(t.prev,t,t.next)<0?_t(t,e,t.next)>=0&&_t(t,t.prev,e)>=0:_t(t,e,t.prev)<0||_t(t,t.next,e)<0}function wt(t,e){var n=t,r=!1,i=(t.x+e.x)/2,a=(t.y+e.y)/2;do{n.y>a!=n.next.y>a&&i<(n.next.x-n.x)*(a-n.y)/(n.next.y-n.y)+n.x&&(r=!r),n=n.next}while(n!==t);return r}function Ot(t,e){var n=new Ct(t.i,t.x,t.y),r=new Ct(e.i,e.x,e.y),i=t.next,a=e.prev;return t.next=e,e.prev=t,n.next=i,i.prev=n,r.next=n,n.prev=r,a.next=r,r.prev=a,r}function Lt(t,e,n,r){var i=new Ct(t,e,n);return r?(i.next=r.next,i.prev=r,r.next.prev=i,r.next=i):(i.prev=i,i.next=i),i}function At(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function Ct(t,e,n){this.i=t,this.x=e,this.y=n,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function It(t,e,n,r){for(var i=0,a=e,o=n-r;a<n;a+=r)i+=(t[o]-t[a])*(t[a+1]+t[o+1]),o=a;return i}function kt(t,e){var n=e.id,r=e.bbox,i=null==e.properties?{}:e.properties,a=St(t,e);return null==n&&null==r?{type:"Feature",properties:i,geometry:a}:null==r?{type:"Feature",id:n,properties:i,geometry:a}:{type:"Feature",id:n,bbox:r,properties:i,geometry:a}}function St(t,e){function i(t,e){e.length&&e.pop();for(var n=h[t<0?~t:t],r=0,i=n.length;r<i;++r)e.push(u(n[r],r));t<0&&je(e,i)}function r(t){return u(t)}function a(t){for(var e=[],n=0,r=t.length;n<r;++n)i(t[n],e);return e.length<2&&e.push(e[0]),e}function n(t){for(var e=a(t);e.length<4;)e.push(e[0]);return e}function o(t){return t.map(n)}function s(t){var e,n=t.type;switch(n){case"GeometryCollection":return{type:n,geometries:t.geometries.map(s)};case"Point":e=r(t.coordinates);break;case"MultiPoint":e=t.coordinates.map(r);break;case"LineString":e=a(t.arcs);break;case"MultiLineString":e=t.arcs.map(a);break;case"Polygon":e=o(t.arcs);break;case"MultiPolygon":e=t.arcs.map(o);break;default:return null}return{type:n,coordinates:e}}var u=De(t.transform),h=t.arcs;return s(e)}function Tt(t){for(var e,n=-1,r=t.length,i=t[r-1],a=0;++n<r;)e=i,i=t[n],a+=e[0]*i[1]-e[1]*i[0];return Math.abs(a)}function Ft(s,t){function e(t){switch(t.type){case"GeometryCollection":t.geometries.forEach(e);break;case"Polygon":n(t.arcs);break;case"MultiPolygon":t.arcs.forEach(n)}}function n(e){e.forEach(function(t){t.forEach(function(t){(h[t=t<0?~t:t]||(h[t]=[])).push(e)})}),r.push(e)}function u(t){return Tt(St(s,{type:"Polygon",arcs:[t]}).coordinates[0])}var h={},r=[],i=[];return t.forEach(e),r.forEach(function(t){if(!t._){var e=[],n=[t];for(t._=1,i.push(e);t=n.pop();)e.push(t),t.forEach(function(t){t.forEach(function(t){h[t<0?~t:t].forEach(function(t){t._||(t._=1,n.push(t))})})})}}),r.forEach(function(t){delete t._}),{type:"MultiPolygon",arcs:i.map(function(t){var e,n=[];if(t.forEach(function(t){t.forEach(function(t){t.forEach(function(t){h[t<0?~t:t].length<2&&n.push(t)})})}),n=Ge(s,n),(e=n.length)>1)for(var r,i,a=1,o=u(n[0]);a<e;++a)(r=u(n[a]))>o&&(i=n[0],n[0]=n[a],n[a]=i,o=r);return n})}}function Et(n){return function(t,e){return He(n(t),e)}}function qt(t,a){var o={},s={type:"Topology",objects:{triangles:{type:"GeometryCollection",geometries:[]}},arcs:[]};return t.forEach(function(t){var i=[];t.forEach(function(t,e){var n=t[0]<t[1]?t.join(","):t[1]+","+t[0],r=t.map(function(t){return a[t]});n in o?i.push(~o[n]):(i.push(o[n]=s.arcs.length),s.arcs.push(r))}),s.objects.triangles.geometries.push({type:"Polygon",area:Math.abs(te(t.map(function(t){return a[t[0]]}))),arcs:[i]})}),s.objects.triangles.geometries.sort(function(t,e){return t.area-e.area}),s}function Dt(i,t){for(var a=i.objects.triangles.geometries,o=Ne(function(t){return t.area}).left;a.length>t;)!function(){var t=a[0],e=Be(a)[0][0],n=a[e],r=Ft(i,[t,n]);r.area=t.area+n.area,r.type="Polygon",r.arcs=r.arcs[0],a.splice(e,1),a.shift(),a.splice(o(a,r.area),0,r)}();if(t>a.length)throw new RangeError("Can't collapse topology into "+t+" pieces.");return Ze(i,i.objects.triangles).features.map(function(t){return t.geometry.coordinates[0].pop(),t.geometry.coordinates[0]})}function jt(t){for(var e=Ee(t.reduce(function(t,e){return t.concat([e[0]],[e[1]])},[])),n=[],r=0,i=e.length;r<i;r+=3)n.push([[e[r],e[r+1]],[e[r+1],e[r+2]],[e[r+2],e[r]]]);return n}function Zt(t,e,o){function s(t,e,n){void 0===e&&(e=[]),void 0===n&&(n=0);for(var r=0;r<t.length;r++){var i=t.splice(r,1),a=o[i[0]][e.length];n+a<u&&(t.length?s(t.slice(),e.concat(i),n+a):(u=n+a,h=e.concat(i))),t.length&&t.splice(r,0,i[0])}}var u=1/0,h=t.map(function(t,e){return e});return s(h),h}function Gt(t,e){var n=E(z(t),z(e));return n*n}function zt(t,e,n){void 0===n&&(n={});var r=n.maxSegmentLength;void 0===r&&(r=10);var i=n.string;void 0===i&&(i=!0);var a=n.single;void 0===a&&(a=!1);var o=$(t,r);o.length<e.length+2&&U(o,e.length+2-o.length);var s,u=Re(o,e.length),h=e.map(function(t){return $(t,r)}),p="string"==typeof t&&t;return a&&!e.every(function(t){return"string"==typeof t})||(s=e.slice(0)),Nt(u,h,{match:!0,string:i,single:a,t0:p,t1:s})}function Bt(t,e,n){void 0===n&&(n={});var r=n.maxSegmentLength;void 0===r&&(r=10);var i=n.string;void 0===i&&(i=!0);var a=n.single;void 0===a&&(a=!1);var o=zt(e,t,{maxSegmentLength:r,string:i,single:a});return a?function(t){return o(1-t)}:o.map(function(e){return function(t){return e(1-t)}})}function Ht(t,e,n){void 0===n&&(n={});var r=n.maxSegmentLength;void 0===r&&(r=10);var i=n.string;void 0===i&&(i=!0);var a=n.single;if(void 0===a&&(a=!1),!Array.isArray(t)||!Array.isArray(e)||t.length!==e.length||!t.length)throw new TypeError(Se);var o,s,u=function(t){return $(t,r)},h=t.map(u),p=e.map(u);return a?(t.every(function(t){return"string"==typeof t})&&(o=t.slice(0)),e.every(function(t){return"string"==typeof t})&&(s=e.slice(0))):(o=t.slice(0),s=e.slice(0)),Nt(h,p,{string:i,single:a,t0:o,t1:s,match:!1})}function Nt(n,r,t){void 0===t&&(t={});var i=t.string,e=t.single,a=t.t0,o=t.t1,s=t.match,u=s?Qe(n,r):n.map(function(t,e){return e}),h=u.map(function(t,e){return tt(n[t],r[e],i)});if(s&&Array.isArray(a)&&(a=u.map(function(t){return a[t]})),e&&i&&(Array.isArray(a)&&(a=a.join(" ")),Array.isArray(o)&&(o=o.join(" "))),e){var p=i?function(e){return h.map(function(t){return t(e)}).join(" ")}:function(e){return h.map(function(t){return t(e)})};return i&&(a||o)?function(t){return t<1e-4&&a||1-t<1e-4&&o||p(t)}:p}return i?(a=Array.isArray(a)?a.map(function(t){return"string"==typeof t&&t}):[],o=Array.isArray(o)?o.map(function(t){return"string"==typeof t&&t}):[],h.map(function(e,n){return a[n]||o[n]?function(t){return t<1e-4&&a[n]||1-t<1e-4&&o[n]||e(t)}:e})):h}function Vt(t,e,n,r,i){return Xt(Yt(t,e,n),r,$t(t,e,n),2*Math.PI*n,i)}function Rt(t,e,n,r,i){var a=Vt(e,n,r,t,i);return function(t){return a(1-t)}}function Qt(t,e,n,r,i,a){return Xt(Ut(t,e,n,r),i,Kt(t,e,n,r),2*n+2*r,a)}function Jt(t,e,n,r,i,a){var o=Qt(e,n,r,i,t,a);return function(t){return o(1-t)}}function Xt(t,e,n,r,i){void 0===i&&(i={});var a=i.maxSegmentLength;void 0===a&&(a=10);var o=i.string;void 0===o&&(o=!0);var s,u,h=$(e,a);return G(r)&&h.length<r/a&&U(h,Math.ceil(r/a-h.length)),s=t(h),u=j(s,h,o),o?function(t){return t<1e-4?n:u(t)}:u}function Yt(s,u,h){return function(r){var t=z(r),i=ne(r.concat([r[0]])),a=Math.atan2(r[0][1]-t[1],r[0][0]-t[0]),o=0;return r.map(function(t,e){var n;return e&&(o+=E(t,r[e-1])),n=a+2*Math.PI*(i?o/i:e/r.length),[Math.cos(n)*h+s,Math.sin(n)*h+u]})}}function Ut(s,u,h,p){return function(r){var t=z(r),i=ne(r.concat([r[0]])),e=Math.atan2(r[0][1]-t[1],r[0][0]-t[0]),a=0;e<0&&(e=2*Math.PI+e);var o=e/(2*Math.PI);return r.map(function(t,e){e&&(a+=E(t,r[e-1]));var n=Wt((o+(i?a/i:e/r.length))%1);return[s+n[0]*h,u+n[1]*p]})}}function Wt(t){return t<=1/8?[1,.5+4*t]:t<=3/8?[1.5-4*t,1]:t<=5/8?[0,2.5-4*t]:t<=7/8?[4*t-2.5,0]:[1,4*t-3.5]}function $t(t,e,n){var r=t-n+","+e,i=t+n+","+e,a="A"+n+","+n+",0,1,1,";return"M"+r+a+i+a+r+"Z"}function Kt(t,e,n,r){var i=t+n,a=e+r;return"M"+t+","+e+"L"+i+","+e+"L"+i+","+a+"L"+t+","+a+"Z"}var te=function(t){for(var e,n=-1,r=t.length,i=t[r-1],a=0;++n<r;)e=i,i=t[n],a+=e[1]*i[0]-e[0]*i[1];return a/2},ee=function(t){for(var e,n,r=-1,i=t.length,a=0,o=0,s=t[i-1],u=0;++r<i;)e=s,s=t[r],u+=n=e[0]*s[1]-s[0]*e[1],a+=(e[0]+s[0])*n,o+=(e[1]+s[1])*n;return u*=3,[a/u,o/u]},ne=function(t){for(var e,n,r=-1,i=t.length,a=t[i-1],o=a[0],s=a[1],u=0;++r<i;)e=o,n=s,a=t[r],o=a[0],s=a[1],e-=o,n-=s,u+=Math.sqrt(e*e+n*n);return u},re={a:7,c:6,h:1,l:2,m:2,r:4,q:4,s:4,t:2,v:1,z:0},ie=[5760,6158,8192,8193,8194,8195,8196,8197,8198,8199,8200,8201,8202,8239,8287,12288,65279],ae=function(t){var e=new r(t),n=e.max;for(u(e);e.index<n&&!e.err.length;)i(e);return e.err.length?e.result=[]:e.result.length&&("mM".indexOf(e.result[0][0])<0?(e.err="SvgPath: string should start with `M` or `m`",e.result=[]):e.result[0][0]="M"),{err:e.err,segments:e.result}};a.prototype.matrix=function(t){return 1===t[0]&&0===t[1]&&0===t[2]&&1===t[3]&&0===t[4]&&0===t[5]?this:(this.cache=null,this.queue.push(t),this)},a.prototype.translate=function(t,e){return 0===t&&0===e||(this.cache=null,this.queue.push([1,0,0,1,t,e])),this},a.prototype.scale=function(t,e){return 1===t&&1===e||(this.cache=null,this.queue.push([t,0,0,e,0,0])),this},a.prototype.rotate=function(t,e,n){var r,i,a;return 0!==t&&(this.translate(e,n),r=t*Math.PI/180,i=Math.cos(r),a=Math.sin(r),this.queue.push([i,a,-a,i,0,0]),this.cache=null,this.translate(-e,-n)),this},a.prototype.skewX=function(t){return 0!==t&&(this.cache=null,this.queue.push([1,0,Math.tan(t*Math.PI/180),1,0,0])),this},a.prototype.skewY=function(t){return 0!==t&&(this.cache=null,this.queue.push([1,Math.tan(t*Math.PI/180),0,1,0,0])),this},a.prototype.toArray=function(){var t=this;if(this.cache)return this.cache;if(!this.queue.length)return this.cache=[1,0,0,1,0,0],this.cache;if(this.cache=this.queue[0],1===this.queue.length)return this.cache;for(var e=1;e<this.queue.length;e++)t.cache=n(t.cache,t.queue[e]);return this.cache},a.prototype.calc=function(t,e,n){var r;return this.queue.length?(this.cache||(this.cache=this.toArray()),r=this.cache,[t*r[0]+e*r[2]+(n?0:r[4]),t*r[1]+e*r[3]+(n?0:r[5])]):[t,e]};var oe=a,se={matrix:!0,scale:!0,rotate:!0,translate:!0,skewX:!0,skewY:!0},ue=/\s*(matrix|translate|scale|rotate|skewX|skewY)\s*\(\s*(.+?)\s*\)[\s,]*/,he=/[\s,]+/,pe=function(t){var e,n,r=new oe;return t.split(ue).forEach(function(t){if(t.length){if(void 0!==se[t])return void(e=t);switch(n=t.split(he).map(function(t){return+t||0}),e){case"matrix":return void(6===n.length&&r.matrix(n));case"scale":return void(1===n.length?r.scale(n[0],n[0]):2===n.length&&r.scale(n[0],n[1]));case"rotate":return void(1===n.length?r.rotate(n[0],0,0):3===n.length&&r.rotate(n[0],n[1],n[2]));case"translate":return void(1===n.length?r.translate(n[0],0):2===n.length&&r.translate(n[0],n[1]));case"skewX":return void(1===n.length&&r.skewX(n[0]));case"skewY":return void(1===n.length&&r.skewY(n[0]))}}}),r},ce=2*Math.PI,le=function(t,e,n,r,i,a,o,s,u){var h=Math.sin(u*ce/360),p=Math.cos(u*ce/360),c=p*(t-n)/2+h*(e-r)/2,l=-h*(t-n)/2+p*(e-r)/2;if(0===c&&0===l)return[];if(0===o||0===s)return[];o=Math.abs(o),s=Math.abs(s);var f=c*c/(o*o)+l*l/(s*s);f>1&&(o*=Math.sqrt(f),s*=Math.sqrt(f));var g=x(t,e,n,r,i,a,o,s,h,p),y=[],v=g[2],m=g[3],d=Math.max(Math.ceil(Math.abs(m)/(ce/4)),1);m/=d;for(var _=0;_<d;_++)y.push(P(v,m)),v+=m;return y.map(function(t){for(var e=0;e<t.length;e+=2){var n=t[e+0],r=t[e+1];n*=o,r*=s;var i=p*n-h*r,a=h*n+p*r;t[e+0]=i+g[0],t[e+1]=a+g[1]}return t})},fe=Math.PI/180;l.prototype.transform=function(t){var e=Math.cos(this.ax*fe),n=Math.sin(this.ax*fe),r=[this.rx*(t[0]*e+t[2]*n),this.rx*(t[1]*e+t[3]*n),this.ry*(-t[0]*n+t[2]*e),this.ry*(-t[1]*n+t[3]*e)],i=r[0]*r[0]+r[2]*r[2],a=r[1]*r[1]+r[3]*r[3],o=((r[0]-r[3])*(r[0]-r[3])+(r[2]+r[1])*(r[2]+r[1]))*((r[0]+r[3])*(r[0]+r[3])+(r[2]-r[1])*(r[2]-r[1])),s=(i+a)/2;if(o<1e-10*s)return this.rx=this.ry=Math.sqrt(s),this.ax=0,this;var u=r[0]*r[1]+r[2]*r[3];o=Math.sqrt(o);var h=s+o/2,p=s-o/2;return this.ax=Math.abs(u)<1e-10&&Math.abs(h-a)<1e-10?90:180*Math.atan(Math.abs(u)>Math.abs(h-a)?(h-i)/u:u/(h-a))/Math.PI,this.ax>=0?(this.rx=Math.sqrt(h),this.ry=Math.sqrt(p)):(this.ax+=90,this.rx=Math.sqrt(p),this.ry=Math.sqrt(h)),this},l.prototype.isDegenerate=function(){return this.rx<1e-10*this.ry||this.ry<1e-10*this.rx};var ge=l;f.prototype.__matrix=function(p){var c,l=this;p.queue.length&&this.iterate(function(t,e,n,r){var i,a,o,s;switch(t[0]){case"v":i=p.calc(0,t[1],!0),a=0===i[0]?["v",i[1]]:["l",i[0],i[1]];break;case"V":i=p.calc(n,t[1],!1),a=i[0]===p.calc(n,r,!1)[0]?["V",i[1]]:["L",i[0],i[1]];break;case"h":i=p.calc(t[1],0,!0),a=0===i[1]?["h",i[0]]:["l",i[0],i[1]];break;case"H":i=p.calc(t[1],r,!1),a=i[1]===p.calc(n,r,!1)[1]?["H",i[0]]:["L",i[0],i[1]];break;case"a":case"A":var u=p.toArray(),h=ge(t[1],t[2],t[3]).transform(u);if(u[0]*u[3]-u[1]*u[2]<0&&(t[5]=t[5]?"0":"1"),i=p.calc(t[6],t[7],"a"===t[0]),"A"===t[0]&&t[6]===n&&t[7]===r||"a"===t[0]&&0===t[6]&&0===t[7]){a=["a"===t[0]?"l":"L",i[0],i[1]];break}a=h.isDegenerate()?["a"===t[0]?"l":"L",i[0],i[1]]:[t[0],h.rx,h.ry,h.ax,t[4],t[5],i[0],i[1]];break;case"m":s=e>0,i=p.calc(t[1],t[2],s),a=["m",i[0],i[1]];break;default:for(o=t[0],a=[o],s=o.toLowerCase()===o,c=1;c<t.length;c+=2)i=p.calc(t[c],t[c+1],s),a.push(i[0],i[1])}l.segments[e]=a},!0)},f.prototype.__evaluateStack=function(){var t,e,n=this;if(this.__stack.length){if(1===this.__stack.length)return this.__matrix(this.__stack[0]),void(this.__stack=[]);for(t=oe(),e=this.__stack.length;--e>=0;)t.matrix(n.__stack[e].toArray());this.__matrix(t),this.__stack=[]}},f.prototype.toString=function(){var t,e,n=this,r=[];this.__evaluateStack();for(var i=0;i<this.segments.length;i++)e=n.segments[i][0],t=i>0&&"m"!==e&&"M"!==e&&e===n.segments[i-1][0],r=r.concat(t?n.segments[i].slice(1):n.segments[i]);return r.join(" ").replace(/ ?([achlmqrstvz]) ?/gi,"$1").replace(/ \-/g,"-").replace(/zm/g,"z m")},f.prototype.translate=function(t,e){return this.__stack.push(oe().translate(t,e||0)),this},f.prototype.scale=function(t,e){return this.__stack.push(oe().scale(t,e||0===e?e:t)),this},f.prototype.rotate=function(t,e,n){return this.__stack.push(oe().rotate(t,e||0,n||0)),this},f.prototype.skewX=function(t){return this.__stack.push(oe().skewX(t)),this},f.prototype.skewY=function(t){return this.__stack.push(oe().skewY(t)),this},f.prototype.matrix=function(t){return this.__stack.push(oe().matrix(t)),this},f.prototype.transform=function(t){return t.trim()?(this.__stack.push(pe(t)),this):this},f.prototype.round=function(r){var e,i=0,a=0,o=0,s=0;return r=r||0,this.__evaluateStack(),this.segments.forEach(function(n){var t=n[0].toLowerCase()===n[0];switch(n[0]){case"H":case"h":return t&&(n[1]+=o),o=n[1]-n[1].toFixed(r),void(n[1]=+n[1].toFixed(r));case"V":case"v":return t&&(n[1]+=s),s=n[1]-n[1].toFixed(r),void(n[1]=+n[1].toFixed(r));case"Z":case"z":return o=i,void(s=a);case"M":case"m":return t&&(n[1]+=o,n[2]+=s),o=n[1]-n[1].toFixed(r),s=n[2]-n[2].toFixed(r),i=o,a=s,n[1]=+n[1].toFixed(r),void(n[2]=+n[2].toFixed(r));case"A":case"a":return t&&(n[6]+=o,n[7]+=s),o=n[6]-n[6].toFixed(r),s=n[7]-n[7].toFixed(r),n[1]=+n[1].toFixed(r),n[2]=+n[2].toFixed(r),n[3]=+n[3].toFixed(r+2),n[6]=+n[6].toFixed(r),void(n[7]=+n[7].toFixed(r));default:return e=n.length,t&&(n[e-2]+=o,n[e-1]+=s),o=n[e-2]-n[e-2].toFixed(r),s=n[e-1]-n[e-1].toFixed(r),void n.forEach(function(t,e){e&&(n[e]=+n[e].toFixed(r))})}}),this},f.prototype.iterate=function(i,t){var e,n,r,a=this.segments,o={},s=!1,u=0,h=0,p=0,c=0;if(t||this.__evaluateStack(),a.forEach(function(t,e){var n=i(t,e,u,h);Array.isArray(n)&&(o[e]=n,s=!0);var r=t[0]===t[0].toLowerCase();switch(t[0]){case"m":case"M":return u=t[1]+(r?u:0),h=t[2]+(r?h:0),p=u,void(c=h);case"h":case"H":return void(u=t[1]+(r?u:0));case"v":case"V":return void(h=t[1]+(r?h:0));case"z":case"Z":return u=p,void(h=c);default:u=t[t.length-2]+(r?u:0),h=t[t.length-1]+(r?h:0)}}),!s)return this;for(r=[],e=0;e<a.length;e++)if(void 0!==o[e])for(n=0;n<o[e].length;n++)r.push(o[e][n]);else r.push(a[e]);return this.segments=r,this},f.prototype.abs=function(){return this.iterate(function(t,e,n,r){var i,a=t[0],o=a.toUpperCase();if(a!==o)switch(t[0]=o,a){case"v":return void(t[1]+=r);case"a":return t[6]+=n,void(t[7]+=r);default:for(i=1;i<t.length;i++)t[i]+=i%2?n:r}},!0),this},f.prototype.rel=function(){return this.iterate(function(t,e,n,r){var i,a=t[0],o=a.toLowerCase();if(a!==o&&(0!==e||"M"!==a))switch(t[0]=o,a){case"V":return void(t[1]-=r);case"A":return t[6]-=n,void(t[7]-=r);default:for(i=1;i<t.length;i++)t[i]-=i%2?n:r}},!0),this},f.prototype.unarc=function(){return this.iterate(function(t,e,n,r){var i,a,o,s=[],u=t[0];return"A"!==u&&"a"!==u?null:("a"===u?(a=n+t[6],o=r+t[7]):(a=t[6],o=t[7]),i=le(n,r,a,o,t[4],t[5],t[1],t[2],t[3]),0===i.length?[["a"===t[0]?"l":"L",t[6],t[7]]]:(i.forEach(function(t){s.push(["C",t[2],t[3],t[4],t[5],t[6],t[7]])}),s))}),this},f.prototype.unshort=function(){var s,u,h,p,c,l=this.segments;return this.iterate(function(t,e,n,r){var i,a=t[0],o=a.toUpperCase();e&&("T"===o?(i="t"===a,h=l[e-1],"Q"===h[0]?(s=h[1]-n,u=h[2]-r):"q"===h[0]?(s=h[1]-h[3],u=h[2]-h[4]):(s=0,u=0),p=-s,c=-u,i||(p+=n,c+=r),l[e]=[i?"q":"Q",p,c,t[1],t[2]]):"S"===o&&(i="s"===a,h=l[e-1],"C"===h[0]?(s=h[3]-n,u=h[4]-r):"c"===h[0]?(s=h[3]-h[5],u=h[4]-h[6]):(s=0,u=0),p=-s,c=-u,i||(p+=n,c+=r),l[e]=[i?"c":"C",p,c,t[1],t[2],t[3],t[4]]))}),this};var ye,ve=f,me={a:7,c:6,h:1,l:2,m:2,q:4,s:4,t:2,v:1,z:0},de=/([astvzqmhlc])([^astvzqmhlc]*)/gi,_e=function(t){var i=[];return t.replace(de,function(t,e,n){var r=e.toLowerCase();for(n=g(n),"m"===r&&n.length>2&&(i.push([e].concat(n.splice(0,2))),r="l",e="m"===e?"l":"L");n.length>=0;){if(n.length===me[r])return n.unshift(e),i.push(n);if(n.length<me[r])throw new Error("malformed path data");i.push([e].concat(n.splice(0,me[r])))}}),i},xe=/-?[0-9]*\.?[0-9]+(?:e[-+]?\d+)?/gi,Pe=function(t,e,n,r,i,a,o,s){return new y(t,e,n,r,i,a,o,s)};y.prototype={constructor:y,init:function(){this.length=this.getArcLength([this.a.x,this.b.x,this.c.x,this.d.x],[this.a.y,this.b.y,this.c.y,this.d.y])},getTotalLength:function(){return this.length},getPointAtLength:function(t){var e=d(t,this.length,this.getArcLength,[this.a.x,this.b.x,this.c.x,this.d.x],[this.a.y,this.b.y,this.c.y,this.d.y]);return this.getPoint([this.a.x,this.b.x,this.c.x,this.d.x],[this.a.y,this.b.y,this.c.y,this.d.y],e)},getTangentAtLength:function(t){var e=d(t,this.length,this.getArcLength,[this.a.x,this.b.x,this.c.x,this.d.x],[this.a.y,this.b.y,this.c.y,this.d.y]),n=this.getDerivative([this.a.x,this.b.x,this.c.x,this.d.x],[this.a.y,this.b.y,this.c.y,this.d.y],e),r=Math.sqrt(n.x*n.x+n.y*n.y);return r>0?{x:n.x/r,y:n.y/r}:{x:0,y:0}},getPropertiesAtLength:function(t){var e,n=d(t,this.length,this.getArcLength,[this.a.x,this.b.x,this.c.x,this.d.x],[this.a.y,this.b.y,this.c.y,this.d.y]),r=this.getDerivative([this.a.x,this.b.x,this.c.x,this.d.x],[this.a.y,this.b.y,this.c.y,this.d.y],n),i=Math.sqrt(r.x*r.x+r.y*r.y);e=i>0?{x:r.x/i,y:r.y/i}:{x:0,y:0};var a=this.getPoint([this.a.x,this.b.x,this.c.x,this.d.x],[this.a.y,this.b.y,this.c.y,this.d.y],n);return{x:a.x,y:a.y,tangentX:e.x,tangentY:e.y}}};var Me=[[],[],[-.5773502691896257,.5773502691896257],[0,-.7745966692414834,.7745966692414834],[-.33998104358485626,.33998104358485626,-.8611363115940526,.8611363115940526],[0,-.5384693101056831,.5384693101056831,-.906179845938664,.906179845938664],[.6612093864662645,-.6612093864662645,-.2386191860831969,.2386191860831969,-.932469514203152,.932469514203152],[0,.4058451513773972,-.4058451513773972,-.7415311855993945,.7415311855993945,-.9491079123427585,.9491079123427585],[-.1834346424956498,.1834346424956498,-.525532409916329,.525532409916329,-.7966664774136267,.7966664774136267,-.9602898564975363,.9602898564975363],[0,-.8360311073266358,.8360311073266358,-.9681602395076261,.9681602395076261,-.3242534234038089,.3242534234038089,-.6133714327005904,.6133714327005904],[-.14887433898163122,.14887433898163122,-.4333953941292472,.4333953941292472,-.6794095682990244,.6794095682990244,-.8650633666889845,.8650633666889845,-.9739065285171717,.9739065285171717],[0,-.26954315595234496,.26954315595234496,-.5190961292068118,.5190961292068118,-.7301520055740494,.7301520055740494,-.8870625997680953,.8870625997680953,-.978228658146057,.978228658146057],[-.1252334085114689,.1252334085114689,-.3678314989981802,.3678314989981802,-.5873179542866175,.5873179542866175,-.7699026741943047,.7699026741943047,-.9041172563704749,.9041172563704749,-.9815606342467192,.9815606342467192],[0,-.2304583159551348,.2304583159551348,-.44849275103644687,.44849275103644687,-.6423493394403402,.6423493394403402,-.8015780907333099,.8015780907333099,-.9175983992229779,.9175983992229779,-.9841830547185881,.9841830547185881],[-.10805494870734367,.10805494870734367,-.31911236892788974,.31911236892788974,-.5152486363581541,.5152486363581541,-.6872929048116855,.6872929048116855,-.827201315069765,.827201315069765,-.9284348836635735,.9284348836635735,-.9862838086968123,.9862838086968123],[0,-.20119409399743451,.20119409399743451,-.3941513470775634,.3941513470775634,-.5709721726085388,.5709721726085388,-.7244177313601701,.7244177313601701,-.8482065834104272,.8482065834104272,-.937273392400706,.937273392400706,-.9879925180204854,.9879925180204854],[-.09501250983763744,.09501250983763744,-.2816035507792589,.2816035507792589,-.45801677765722737,.45801677765722737,-.6178762444026438,.6178762444026438,-.755404408355003,.755404408355003,-.8656312023878318,.8656312023878318,-.9445750230732326,.9445750230732326,-.9894009349916499,.9894009349916499],[0,-.17848418149584785,.17848418149584785,-.3512317634538763,.3512317634538763,-.5126905370864769,.5126905370864769,-.6576711592166907,.6576711592166907,-.7815140038968014,.7815140038968014,-.8802391537269859,.8802391537269859,-.9506755217687678,.9506755217687678,-.9905754753144174,.9905754753144174],[-.0847750130417353,.0847750130417353,-.2518862256915055,.2518862256915055,-.41175116146284263,.41175116146284263,-.5597708310739475,.5597708310739475,-.6916870430603532,.6916870430603532,-.8037049589725231,.8037049589725231,-.8926024664975557,.8926024664975557,-.9558239495713977,.9558239495713977,-.9915651684209309,.9915651684209309],[0,-.16035864564022537,.16035864564022537,-.31656409996362983,.31656409996362983,-.46457074137596094,.46457074137596094,-.600545304661681,.600545304661681,-.7209661773352294,.7209661773352294,-.8227146565371428,.8227146565371428,-.9031559036148179,.9031559036148179,-.96020815213483,.96020815213483,-.9924068438435844,.9924068438435844],[-.07652652113349734,.07652652113349734,-.22778585114164507,.22778585114164507,-.37370608871541955,.37370608871541955,-.5108670019508271,.5108670019508271,-.636053680726515,.636053680726515,-.7463319064601508,.7463319064601508,-.8391169718222188,.8391169718222188,-.912234428251326,.912234428251326,-.9639719272779138,.9639719272779138,-.9931285991850949,.9931285991850949],[0,-.1455618541608951,.1455618541608951,-.2880213168024011,.2880213168024011,-.4243421202074388,.4243421202074388,-.5516188358872198,.5516188358872198,-.6671388041974123,.6671388041974123,-.7684399634756779,.7684399634756779,-.8533633645833173,.8533633645833173,-.9200993341504008,.9200993341504008,-.9672268385663063,.9672268385663063,-.9937521706203895,.9937521706203895],[-.06973927331972223,.06973927331972223,-.20786042668822127,.20786042668822127,-.34193582089208424,.34193582089208424,-.469355837986757,.469355837986757,-.5876404035069116,.5876404035069116,-.6944872631866827,.6944872631866827,-.7878168059792081,.7878168059792081,-.8658125777203002,.8658125777203002,-.926956772187174,.926956772187174,-.9700604978354287,.9700604978354287,-.9942945854823992,.9942945854823992],[0,-.1332568242984661,.1332568242984661,-.26413568097034495,.26413568097034495,-.3903010380302908,.3903010380302908,-.5095014778460075,.5095014778460075,-.6196098757636461,.6196098757636461,-.7186613631319502,.7186613631319502,-.8048884016188399,.8048884016188399,-.8767523582704416,.8767523582704416,-.9329710868260161,.9329710868260161,-.9725424712181152,.9725424712181152,-.9947693349975522,.9947693349975522],[-.06405689286260563,.06405689286260563,-.1911188674736163,.1911188674736163,-.3150426796961634,.3150426796961634,-.4337935076260451,.4337935076260451,-.5454214713888396,.5454214713888396,-.6480936519369755,.6480936519369755,-.7401241915785544,.7401241915785544,-.820001985973903,.820001985973903,-.8864155270044011,.8864155270044011,-.9382745520027328,.9382745520027328,-.9747285559713095,.9747285559713095,-.9951872199970213,.9951872199970213]],be=[[],[],[1,1],[.8888888888888888,.5555555555555556,.5555555555555556],[.6521451548625461,.6521451548625461,.34785484513745385,.34785484513745385],[.5688888888888889,.47862867049936647,.47862867049936647,.23692688505618908,.23692688505618908],[.3607615730481386,.3607615730481386,.46791393457269104,.46791393457269104,.17132449237917036,.17132449237917036],[.4179591836734694,.3818300505051189,.3818300505051189,.27970539148927664,.27970539148927664,.1294849661688697,.1294849661688697],[.362683783378362,.362683783378362,.31370664587788727,.31370664587788727,.22238103445337448,.22238103445337448,.10122853629037626,.10122853629037626],[.3302393550012598,.1806481606948574,.1806481606948574,.08127438836157441,.08127438836157441,.31234707704000286,.31234707704000286,.26061069640293544,.26061069640293544],[.29552422471475287,.29552422471475287,.26926671930999635,.26926671930999635,.21908636251598204,.21908636251598204,.1494513491505806,.1494513491505806,.06667134430868814,.06667134430868814],[.2729250867779006,.26280454451024665,.26280454451024665,.23319376459199048,.23319376459199048,.18629021092773426,.18629021092773426,.1255803694649046,.1255803694649046,.05566856711617366,.05566856711617366],[.24914704581340277,.24914704581340277,.2334925365383548,.2334925365383548,.20316742672306592,.20316742672306592,.16007832854334622,.16007832854334622,.10693932599531843,.10693932599531843,.04717533638651183,.04717533638651183],[.2325515532308739,.22628318026289723,.22628318026289723,.2078160475368885,.2078160475368885,.17814598076194574,.17814598076194574,.13887351021978725,.13887351021978725,.09212149983772845,.09212149983772845,.04048400476531588,.04048400476531588],[.2152638534631578,.2152638534631578,.2051984637212956,.2051984637212956,.18553839747793782,.18553839747793782,.15720316715819355,.15720316715819355,.12151857068790319,.12151857068790319,.08015808715976021,.08015808715976021,.03511946033175186,.03511946033175186],[.2025782419255613,.19843148532711158,.19843148532711158,.1861610000155622,.1861610000155622,.16626920581699392,.16626920581699392,.13957067792615432,.13957067792615432,.10715922046717194,.10715922046717194,.07036604748810812,.07036604748810812,.03075324199611727,.03075324199611727],[.1894506104550685,.1894506104550685,.18260341504492358,.18260341504492358,.16915651939500254,.16915651939500254,.14959598881657674,.14959598881657674,.12462897125553388,.12462897125553388,.09515851168249279,.09515851168249279,.062253523938647894,.062253523938647894,.027152459411754096,.027152459411754096],[.17944647035620653,.17656270536699264,.17656270536699264,.16800410215645004,.16800410215645004,.15404576107681028,.15404576107681028,.13513636846852548,.13513636846852548,.11188384719340397,.11188384719340397,.08503614831717918,.08503614831717918,.0554595293739872,.0554595293739872,.02414830286854793,.02414830286854793],[.1691423829631436,.1691423829631436,.16427648374583273,.16427648374583273,.15468467512626524,.15468467512626524,.14064291467065065,.14064291467065065,.12255520671147846,.12255520671147846,.10094204410628717,.10094204410628717,.07642573025488905,.07642573025488905,.0497145488949698,.0497145488949698,.02161601352648331,.02161601352648331],[.1610544498487837,.15896884339395434,.15896884339395434,.15276604206585967,.15276604206585967,.1426067021736066,.1426067021736066,.12875396253933621,.12875396253933621,.11156664554733399,.11156664554733399,.09149002162245,.09149002162245,.06904454273764123,.06904454273764123,.0448142267656996,.0448142267656996,.019461788229726478,.019461788229726478],[.15275338713072584,.15275338713072584,.14917298647260374,.14917298647260374,.14209610931838204,.14209610931838204,.13168863844917664,.13168863844917664,.11819453196151841,.11819453196151841,.10193011981724044,.10193011981724044,.08327674157670475,.08327674157670475,.06267204833410907,.06267204833410907,.04060142980038694,.04060142980038694,.017614007139152118,.017614007139152118],[.14608113364969041,.14452440398997005,.14452440398997005,.13988739479107315,.13988739479107315,.13226893863333747,.13226893863333747,.12183141605372853,.12183141605372853,.10879729916714838,.10879729916714838,.09344442345603386,.09344442345603386,.0761001136283793,.0761001136283793,.057134425426857205,.057134425426857205,.036953789770852494,.036953789770852494,.016017228257774335,.016017228257774335],[.13925187285563198,.13925187285563198,.13654149834601517,.13654149834601517,.13117350478706238,.13117350478706238,.12325237681051242,.12325237681051242,.11293229608053922,.11293229608053922,.10041414444288096,.10041414444288096,.08594160621706773,.08594160621706773,.06979646842452049,.06979646842452049,.052293335152683286,.052293335152683286,.03377490158481415,.03377490158481415,.0146279952982722,.0146279952982722],[.13365457218610619,.1324620394046966,.1324620394046966,.12890572218808216,.12890572218808216,.12304908430672953,.12304908430672953,.11499664022241136,.11499664022241136,.10489209146454141,.10489209146454141,.09291576606003515,.09291576606003515,.07928141177671895,.07928141177671895,.06423242140852585,.06423242140852585,.04803767173108467,.04803767173108467,.030988005856979445,.030988005856979445,.013411859487141771,.013411859487141771],[.12793819534675216,.12793819534675216,.1258374563468283,.1258374563468283,.12167047292780339,.12167047292780339,.1155056680537256,.1155056680537256,.10744427011596563,.10744427011596563,.09761865210411388,.09761865210411388,.08619016153195327,.08619016153195327,.0733464814110803,.0733464814110803,.05929858491543678,.05929858491543678,.04427743881741981,.04427743881741981,.028531388628933663,.028531388628933663,.0123412297999872,.0123412297999872]],we=[[1],[1,1],[1,2,1],[1,3,3,1]],Oe=2*Math.PI,Le=function(t,e,o,s,n,r,i,a,u){var h=Math.sin(n*Oe/360),p=Math.cos(n*Oe/360),c=p*(t-a)/2+h*(e-u)/2,l=-h*(t-a)/2+p*(e-u)/2;if(0===c&&0===l)return[];if(0===o||0===s)return[];o=Math.abs(o),s=Math.abs(s);var f=c*c/(o*o)+l*l/(s*s);f>1&&(o*=Math.sqrt(f),s*=Math.sqrt(f));var g=k(t,e,a,u,r,i,o,s,h,p),y=[],v=g[2],m=g[3],d=Math.max(Math.ceil(Math.abs(m)/(Oe/4)),1);m/=d;for(var _=0;_<d;_++)y.push(S(v,m)),v+=m;return y.map(function(t){for(var e=0;e<t.length;e+=2){var n=t[e+0],r=t[e+1];n*=o,r*=s;var i=p*n-h*r,a=h*n+p*r;t[e+0]=i+g[0],t[e+1]=a+g[1]}return t})},Ae=function(t,e,n,r,i,a,o,s,u){return new T(t,e,n,r,i,a,o,s,u)};T.prototype={constructor:T,init:function(){},getTotalLength:function(){return this.length},getPointAtLength:function(t){var e=this;t<0?t=0:t>this.length&&(t=this.length);for(var n=this.partialLengths.length-1;this.partialLengths[n]>=t&&this.partialLengths[n]>0;)n--;n<this.partialLengths.length-1&&n++;for(var r=0,i=0;i<n;i++)r+=e.partialLengths[i];return this.curves[n].getPointAtLength(t-r)},getTangentAtLength:function(t){var e=this;t<0?t=0:t>this.length&&(t=this.length);for(var n=this.partialLengths.length-1;this.partialLengths[n]>=t&&this.partialLengths[n]>0;)n--;n<this.partialLengths.length-1&&n++;for(var r=0,i=0;i<n;i++)r+=e.partialLengths[i];return this.curves[n].getTangentAtLength(t-r)},getPropertiesAtLength:function(t){var e=this.getTangentAtLength(t),n=this.getPointAtLength(t);return{x:n.x,y:n.y,tangentX:e.x,tangentY:e.y}}};var Ce=function(t,e,n,r){return new F(t,e,n,r)};F.prototype.getTotalLength=function(){return Math.sqrt(Math.pow(this.x0-this.x1,2)+Math.pow(this.y0-this.y1,2))},F.prototype.getPointAtLength=function(t){var e=t/Math.sqrt(Math.pow(this.x0-this.x1,2)+Math.pow(this.y0-this.y1,2)),n=(this.x1-this.x0)*e,r=(this.y1-this.y0)*e;return{x:this.x0+n,y:this.y0+r}},F.prototype.getTangentAtLength=function(){var t=Math.sqrt((this.x1-this.x0)*(this.x1-this.x0)+(this.y1-this.y0)*(this.y1-this.y0));return{x:(this.x1-this.x0)/t,y:(this.y1-this.y0)/t}},F.prototype.getPropertiesAtLength=function(t){var e=this.getPointAtLength(t),n=this.getTangentAtLength();return{x:e.x,y:e.y,tangentX:n.x,tangentY:n.y}};var Ie=function(t){function o(t){if(!t)return null;for(var e,n=_e(t),r=[0,0],i=[0,0],a=0;a<n.length;a++)"M"===n[a][0]?(r=[n[a][1],n[a][2]],h.push(null)):"m"===n[a][0]?(r=[n[a][1]+r[0],n[a][2]+r[1]],h.push(null)):"L"===n[a][0]?(s+=Math.sqrt(Math.pow(r[0]-n[a][1],2)+Math.pow(r[1]-n[a][2],2)),h.push(new Ce(r[0],n[a][1],r[1],n[a][2])),r=[n[a][1],n[a][2]]):"l"===n[a][0]?(s+=Math.sqrt(Math.pow(n[a][1],2)+Math.pow(n[a][2],2)),h.push(new Ce(r[0],n[a][1]+r[0],r[1],n[a][2]+r[1])),r=[n[a][1]+r[0],n[a][2]+r[1]]):"H"===n[a][0]?(s+=Math.abs(r[0]-n[a][1]),h.push(new Ce(r[0],n[a][1],r[1],r[1])),r[0]=n[a][1]):"h"===n[a][0]?(s+=Math.abs(n[a][1]),h.push(new Ce(r[0],r[0]+n[a][1],r[1],r[1])),r[0]=n[a][1]+r[0]):"V"===n[a][0]?(s+=Math.abs(r[1]-n[a][1]),h.push(new Ce(r[0],r[0],r[1],n[a][1])),r[1]=n[a][1]):"v"===n[a][0]?(s+=Math.abs(n[a][1]),h.push(new Ce(r[0],r[0],r[1],r[1]+n[a][1])),r[1]=n[a][1]+r[1]):"z"===n[a][0]||"Z"===n[a][0]?(s+=Math.sqrt(Math.pow(n[0][1]-r[0],2)+Math.pow(n[0][2]-r[1],2)),h.push(new Ce(r[0],n[0][1],r[1],n[0][2])),r=[n[0][1],n[0][2]]):"C"===n[a][0]?(e=new Pe(r[0],r[1],n[a][1],n[a][2],n[a][3],n[a][4],n[a][5],n[a][6]),s+=e.getTotalLength(),r=[n[a][5],n[a][6]],h.push(e)):"c"===n[a][0]?(e=new Pe(r[0],r[1],r[0]+n[a][1],r[1]+n[a][2],r[0]+n[a][3],r[1]+n[a][4],r[0]+n[a][5],r[1]+n[a][6]),s+=e.getTotalLength(),r=[n[a][5]+r[0],n[a][6]+r[1]],h.push(e)):"S"===n[a][0]?(e=a>0&&["C","c","S","s"].indexOf(n[a-1][0])>-1?new Pe(r[0],r[1],2*r[0]-n[a-1][n[a-1].length-4],2*r[1]-n[a-1][n[a-1].length-3],n[a][1],n[a][2],n[a][3],n[a][4]):new Pe(r[0],r[1],r[0],r[1],n[a][1],n[a][2],n[a][3],n[a][4]),s+=e.getTotalLength(),r=[n[a][3],n[a][4]],h.push(e)):"s"===n[a][0]?(e=a>0&&["C","c","S","s"].indexOf(n[a-1][0])>-1?new Pe(r[0],r[1],r[0]+e.d.x-e.c.x,r[1]+e.d.y-e.c.y,r[0]+n[a][1],r[1]+n[a][2],r[0]+n[a][3],r[1]+n[a][4]):new Pe(r[0],r[1],r[0],r[1],r[0]+n[a][1],r[1]+n[a][2],r[0]+n[a][3],r[1]+n[a][4]),s+=e.getTotalLength(),r=[n[a][3]+r[0],n[a][4]+r[1]],h.push(e)):"Q"===n[a][0]?(e=new Pe(r[0],r[1],n[a][1],n[a][2],n[a][3],n[a][4]),s+=e.getTotalLength(),h.push(e),r=[n[a][3],n[a][4]],i=[n[a][1],n[a][2]]):"q"===n[a][0]?(e=new Pe(r[0],r[1],r[0]+n[a][1],r[1]+n[a][2],r[0]+n[a][3],r[1]+n[a][4]),s+=e.getTotalLength(),i=[r[0]+n[a][1],r[1]+n[a][2]],r=[n[a][3]+r[0],n[a][4]+r[1]],h.push(e)):"T"===n[a][0]?(e=a>0&&["Q","q","T","t"].indexOf(n[a-1][0])>-1?new Pe(r[0],r[1],2*r[0]-i[0],2*r[1]-i[1],n[a][1],n[a][2]):new Ce(r[0],n[a][1],r[1],n[a][2]),h.push(e),s+=e.getTotalLength(),i=[2*r[0]-i[0],2*r[1]-i[1]],r=[n[a][1],n[a][2]]):"t"===n[a][0]?(e=a>0&&["Q","q","T","t"].indexOf(n[a-1][0])>-1?new Pe(r[0],r[1],2*r[0]-i[0],2*r[1]-i[1],r[0]+n[a][1],r[1]+n[a][2]):new Ce(r[0],r[0]+n[a][1],r[1],r[1]+n[a][2]),s+=e.getTotalLength(),i=[2*r[0]-i[0],2*r[1]-i[1]],r=[n[a][1]+r[0],n[a][2]+r[0]],h.push(e)):"A"===n[a][0]?(e=new Ae(r[0],r[1],n[a][1],n[a][2],n[a][3],n[a][4],n[a][5],n[a][6],n[a][7]),s+=e.getTotalLength(),r=[n[a][6],n[a][7]],h.push(e)):"a"===n[a][0]&&(e=new Ae(r[0],r[1],n[a][1],n[a][2],n[a][3],n[a][4],n[a][5],r[0]+n[a][6],r[1]+n[a][7]),s+=e.getTotalLength(),r=[r[0]+n[a][6],r[1]+n[a][7]],h.push(e)),u.push(s);return o}var s=0,u=[],h=[];o.getTotalLength=function(){return s},o.getPointAtLength=function(t){var e=n(t);return h[e.i].getPointAtLength(e.fraction)},o.getTangentAtLength=function(t){var e=n(t);return h[e.i].getTangentAtLength(e.fraction)},o.getPropertiesAtLength=function(t){var e=n(t);return h[e.i].getPropertiesAtLength(e.fraction)};var n=function(t){t<0?t=0:t>s&&(t=s);for(var e=u.length-1;u[e]>=t&&u[e]>0;)e--;return e++,{fraction:t-u[e-1],i:e}};return o(t)},ke='All shapes must be supplied as arrays of [x, y] points or an SVG path string (https://developer.mozilla.org/en-US/docs/Web/SVG/Attribute/d).\nExample valid ways of supplying a shape would be:\n[[0, 0], [10, 0], [10, 10]]\n"M0,0 L10,0 L10,10Z"\n',Se="flubber.all() expects two arrays of equal length as arguments. Each element in both arrays should be an array of [x, y] points or an SVG path string (https://developer.mozilla.org/en-US/docs/Web/SVG/Attribute/d).",Te=function(i,t){for(var e,a,n,o=i.length,s=1/0,r=0;r<o;r++)!function(r){a=0,t.forEach(function(t,e){var n=E(i[(r+e)%o],t);a+=n*n}),a<s&&(s=a,e=r)}(r);e&&(n=i.splice(0,e),i.splice.apply(i,[i.length,0].concat(n)))},Fe=function(e,n,t){void 0===t&&(t={});var r=t.maxSegmentLength;void 0===r&&(r=10);var i=t.string;void 0===i&&(i=!0);var a=$(e,r),o=$(n,r),s=tt(a,o,i);return!i||"string"!=typeof e&&"string"!=typeof n?s:function(t){return t<1e-4&&"string"==typeof e?e:1-t<1e-4&&"string"==typeof n?n:s(t)}},Ee=et;et.deviation=function(t,e,n,r){var i=e&&e.length,a=i?e[0]*n:t.length,o=Math.abs(It(t,0,a,n));if(i)for(var s=0,u=e.length;s<u;s++){var h=e[s]*n,p=s<u-1?e[s+1]*n:t.length;o-=Math.abs(It(t,h,p,n))}var c=0;for(s=0;s<r.length;s+=3){var l=r[s]*n,f=r[s+1]*n,g=r[s+2]*n;c+=Math.abs((t[l]-t[g])*(t[f+1]-t[l+1])-(t[l]-t[f])*(t[g+1]-t[l+1]))}return 0===o&&0===c?0:Math.abs((c-o)/o)},et.flatten=function(t){for(var e=t[0][0].length,n={vertices:[],holes:[],dimensions:e},r=0,i=0;i<t.length;i++){for(var a=0;a<t[i].length;a++)for(var o=0;o<e;o++)n.vertices.push(t[i][a][o]);i>0&&(r+=t[i-1].length,n.holes.push(r))}return n};var qe=function(t){return t},De=function(t){if(null==t)return qe;var a,o,s=t.scale[0],u=t.scale[1],h=t.translate[0],p=t.translate[1];return function(t,e){e||(a=o=0);var n=2,r=t.length,i=new Array(r);for(i[0]=(a+=t[0])*s+h,i[1]=(o+=t[1])*u+p;n<r;)i[n]=t[n],++n;return i}},je=function(t,e){for(var n,r=t.length,i=r-e;i<--r;)n=t[i],t[i++]=t[r],t[r]=n},Ze=function(e,t){return"GeometryCollection"===t.type?{type:"FeatureCollection",features:t.geometries.map(function(t){return kt(e,t)})}:kt(e,t)},Ge=function(i,a){function u(t){var e,n=i.arcs[t<0?~t:t],r=n[0];return i.transform?(e=[0,0],n.forEach(function(t){e[0]+=t[0],e[1]+=t[1]})):e=n[n.length-1],t<0?[e,r]:[r,e]}function t(t,e){for(var n in t){var r=t[n];delete e[r.start],delete r.start,delete r.end,r.forEach(function(t){o[t<0?~t:t]=1}),s.push(r)}}var o={},h={},p={},s=[],c=-1;return a.forEach(function(t,e){var n,r=i.arcs[t<0?~t:t];r.length<3&&!r[1][0]&&!r[1][1]&&(n=a[++c],a[c]=t,a[e]=n)}),a.forEach(function(t){var e,n,r=u(t),i=r[0],a=r[1];if(e=p[i])if(delete p[e.end],e.push(t),e.end=a,n=h[a]){delete h[n.start];var o=n===e?e:e.concat(n);h[o.start=e.start]=p[o.end=n.end]=o}else h[e.start]=p[e.end]=e;else if(e=h[a])if(delete h[e.start],e.unshift(t),e.start=i,n=p[i]){delete p[n.end];var s=n===e?e:n.concat(e);h[s.start=n.start]=p[s.end=e.end]=s}else h[e.start]=p[e.end]=e;else e=[t],h[e.start=i]=p[e.end=a]=e}),t(p,h),t(h,p),a.forEach(function(t){o[t<0?~t:t]||s.push([t])}),s},ze=function(t,e){for(var n=0,r=t.length;n<r;){var i=n+r>>>1;t[i]<e?n=i+1:r=i}return n},Be=function(t){function n(t,n){t.forEach(function(t){t<0&&(t=~t);var e=a[t];e?e.push(n):a[t]=[n]})}function r(t,e){t.forEach(function(t){n(t,e)})}function i(t,e){"GeometryCollection"===t.type?t.geometries.forEach(function(t){i(t,e)}):t.type in o&&o[t.type](t.arcs,e)}var a={},e=t.map(function(){return[]}),o={LineString:n,MultiLineString:r,Polygon:r,MultiPolygon:function(t,e){t.forEach(function(t){r(t,e)})}};t.forEach(i);for(var s in a)for(var u=a[s],h=u.length,p=0;p<h;++p)for(var c=p+1;c<h;++c){var l,f=u[p],g=u[c];(l=e[f])[s=ze(l,g)]!==g&&l.splice(s,0,g),(l=e[g])[s=ze(l,f)]!==f&&l.splice(s,0,f)}return e},He=function(t,e){return t<e?-1:t>e?1:t>=e?0:NaN},Ne=function(a){return 1===a.length&&(a=Et(a)),{left:function(t,e,n,r){for(null==n&&(n=0),null==r&&(r=t.length);n<r;){var i=n+r>>>1;a(t[i],e)<0?n=i+1:r=i}return n},right:function(t,e,n,r){for(null==n&&(n=0),null==r&&(r=t.length);n<r;){var i=n+r>>>1;a(t[i],e)>0?r=i:n=i+1}return n}}},Ve=Ne(He),Re=function(t,e){return Dt(qt(jt(t),t),e)},Qe=function(t,n){if(t.length>8)return t.map(function(t,e){return e});var e=t.map(function(e){return n.map(function(t){return Gt(e,t)})});return Zt(t,n,e)};t.interpolate=Fe,t.separate=zt,t.combine=Bt,t.interpolateAll=Ht,t.splitPathString=R,t.toPathString=V,t.fromCircle=Vt,t.toCircle=Rt,t.fromRect=Qt,t.toRect=Jt,Object.defineProperty(t,"__esModule",{value:!0})}(t)}((q={exports:{}},q.exports)),q.exports),Z=(D=j)&&D.__esModule&&Object.prototype.hasOwnProperty.call(D,"default")?D.default:D,G=(z.prototype.interpolate=function(t){return this._constPos?this._constPos:this._interp(t)},z);function z(t,n){var r=!0;t.length!==n.length&&(r=!1),r&&t.forEach(function(t,e){r=r&&P.data.Position.areEqual(t,n[e])}),r?this._constPos=n:this._interp=Z.interpolate(t,n,{string:!1})}var B=(H.prototype.interpolate=function(t){var e=this,n=e._fromGeom,r=e._toGeom;if(e._areSame)return r;if(0===t)return n;if(1===t)return r;var i=n.coordinates,a=r.coordinates,o=e._runInterps(t),s={type:r.type};switch(r.type){case"Point":"LineString"===n.type||"MultiPoint"===n.type?s={type:n.type,coordinates:e._sampleMultiPoint(o,i.length)}:"Polygon"===n.type||"MultiLineString"===n.type?s={type:n.type,coordinates:o}:s.coordinates=o[0][0];break;case"LineString":if("Polygon"===n.type&&i.length>a.length)for(var u=Math.floor(o[0].length/(a.length-1));0<=u;u--)o[0].pop();s.coordinates=o[0];break;case"MultiPoint":"Point"===n.type?s.coordinates=e._sampleMultiPoint(o,a.length):"MultiPoint"!==n.type?s={type:n.type,coordinates:"LineString"===n.type?o[0]:o}:s.coordinates=o[0];break;case"Polygon":case"MultiLineString":s.coordinates=o}return s},H.prototype._initInterps=function(){var t=this._fromGeom,e=this._toGeom;if(!this._areSame&&t&&0<t.coordinates.length&&e&&0<e.coordinates.length){var n=t.coordinates,r=e.coordinates,i=[],a=[];switch(t.type){case"Point":i=[[n,n,n]];break;case"LineString":case"MultiPoint":i=[n];break;case"Polygon":case"MultiLineString":i="number"==typeof n[0]?[n]:n}switch(e.type){case"Point":a=[[r,r,r]];break;case"LineString":case"MultiPoint":a=[r];break;case"Polygon":case"MultiLineString":a="number"==typeof r[0]?[r]:r}var o=void 0,s=a.length;if(i.length<a.length)for(o=i.length;o<s;o++)i.push([i[0][0],i[0][0],i[0][0]]);for(o=0;o<s;o++)this._interps.push(new G(i[o],a[o]))}},H.prototype._runInterps=function(t){for(var e=[],n=this._interps,r=0;r<n.length;r++)e.push(n[r].interpolate(t));return e},H.prototype._sampleMultiPoint=function(t,e){for(var n=Math.min(Math.ceil(t[0].length/e),e),r=[],i=0;i<e;i++)r.push(t[0][i*n]);return r},H);function H(t,e){this._interps=[],this._areSame=!1;if("MultiPolygon"===t.type)throw"Only simple geometries supported.";this._fromGeom=t,this._toGeom=e,this._areSame=t.type===e.type&&JSON.parse(JSON.stringify(t.coordinates))===JSON.parse(JSON.stringify(e.coordinates)),this._initInterps()}var N=(V.prototype.interpolate=function(e){var t=this._toGeom,n=this._interps;if(0===e)return this._fromGeom;if(1===e)return t;if("MultiPolygon"===t.type){var r=[];return n.forEach(function(t){r.push(t.interpolate(e).coordinates)}),{type:"MultiPolygon",coordinates:r}}if("GeometryCollection"!==t.type)return n[0].interpolate(e);var i=[];return n.forEach(function(t){i.push(t.interpolate(e))}),{type:"GeometryCollection",geometries:i}},V.prototype._initInterps=function(){var t=this,e=[],n=[];if(t._extractGeoms(t._fromGeom,e),t._extractGeoms(t._toGeom,n),e.length<n.length&&0<e.length){var r=P.data.BoundingBox.getCenter(P.data.BoundingBox.fromData(e[0])),i={type:e[0].type,coordinates:[]};switch(e[0].type){case"Point":i.coordinates=r;break;case"LineString":case"MultiPoint":i.coordinates=[r,r];break;case"MultiLineString":case"Polygon":i.coordinates=[[r,r,r]]}for(var a=e.length,o=n.length;a<o;a++)e.push(i)}for(a=0;a<n.length;a++)t._interps.push(new B(e[a],n[a]))},V.prototype._extractGeoms=function(t,e){var n=this;switch(t.type){case"MultiPolygon":t.coordinates.forEach(function(t){e.push({type:"Polygon",coordinates:t})});break;case"GeometryCollection":t.geometries.forEach(function(t){n._extractGeoms(t,e)});break;default:e.push(t)}},V);function V(t,e){this._interps=[];this._fromGeom=t,this._toGeom=e,this._initInterps()}var R,Q=(e(J,R=A),J.prototype.onAnimationProgress=function(t){var e=this,n=P.data.BoundingBox,r=e._interp.interpolate(t),i=n.getCenter(n.fromData(r)),a=0;a=e._pathOptions.geodesic?e._heading:e._pixelHeading,e._pathOptions.map&&e._setMapCamera(i,a,!0);var o=e._shape;return e._pathOptions.captureMetadata&&o.addProperty("heading",a),o.isCircle()&&"Point"===r.type||(o.data.geometry.type=r.type),o.setCoordinates(r.coordinates),{position:i,heading:a}},J);function J(t,e,n){var r=R.call(this)||this,i=r,a=P.data.BoundingBox;(i._shape=t).toJson().geometry;t.isCircle()&&"Point"!==e.type&&new P.data.Polygon(t.getCircleCoordinates()),i._interp=new N(t.toJson().geometry,e);var o=a.getCenter(i._shape.getBounds()),s=a.getCenter(a.fromData(e));i._heading=P.math.getHeading(o,s);var u=P.math.mercatorPositionsToPixels([o,s],21);return i._pixelHeading=M.getPixelHeading(u[0],u[1]),n&&(i.setOptions(n),n.autoPlay&&i.play()),h.instance.add(i),r}var X=(Y.prototype.dispose=function(){var e=this;h.instance.remove(e),Object.keys(e).forEach(function(t){e[t]=void 0})},Y.prototype.getDuration=function(){return this._numberOfInv*this._delay},Y.prototype.isPlaying=function(){return null!=this._start},Y.prototype.pause=function(){this._start=null},Y.prototype.play=function(){this._start=performance.now()},Y.prototype.reset=function(){this._start=null,this._currentInterval=0},Y.prototype.stop=function(){this._start=null,this._currentInterval=this._numberOfInv},Y.prototype._onAnimationProgress=function(t){var e=this;if(e._start){var n=Math.round((t-e._start)/e._delay);n!==e._currentInterval&&(e._currentInterval=n,e._intervalCb&&setTimeout(e._intervalCb,0,e._arguments),n>=e._numberOfInv&&(e._start=null,e._onComplete&&(e._onComplete(),e.dispose())))}},Y);function Y(t,e,n){for(var r=[],i=3;i<arguments.length;i++)r[i-3]=arguments[i];this._delay=1,this._numberOfInv=1/0,this._currentInterval=0;var a=this;a._id=h.instance.add(a),a._intervalCb=t,a._arguments=r,0<=e&&(a._delay=e),0<n&&(a._numberOfInv=n)}var U,W=(e($,U=A),$.prototype.dispose=function(){var t=this;t._route=null,t._headingInv=null,t._positions=null,t._timestamps=null,t._timeInv=null,t._totalTime=null,t._shape=null,U.prototype.dispose.call(this)},$.prototype.getDuration=function(){return void 0!==this._totalTime?this._totalTime/this._pathOptions.speedMultiplier:U.prototype.getDuration.call(this)},$.prototype.getOptions=function(){return Object.assign({},U.prototype.getOptions.call(this),{valueInterpolations:this._valueInterps})},$.prototype.setOptions=function(t){if(t){var e=this;t.valueInterpolations&&Array.isArray(t.valueInterpolations)&&(e._positions=null,e._valueInterps=t.valueInterpolations),U.prototype.setOptions.call(this,t);var n=e.isPlaying();n&&e.pause(),e._positions||(e._processPath(),e._pathOptions.captureMetadata&&0<e._headingInv.length&&M.setMetadata(e._shape,{heading:e._headingInv[0],speed:e._speedInv[0],timestamp:e._timestamps[0]})),n&&e.play()}},$.prototype.getTimeSpan=function(){var t=this._timestamps;return 0<t.length?{begin:t[0],end:t[t.length-1]}:null},$.prototype.getPath=function(){return JSON.parse(JSON.stringify(this._positions))},$.prototype.onAnimationProgress=function(t){var e=this,n=e._positions;if(n&&1<n.length){var r={},i=0,a=void 0,o=0,s=e._shape,u=e._pathOptions,h=e._headingInv,p=e._speedInv,c=e._timestamps,l=e._route;if(1===t)r={position:n[1+(i=h.length-1)],heading:h[i],speed:p[i],timestamp:c[i+1]},u.map&&e._setMapCamera(r.position,r.heading,!1),M.setCoordinates(s,r.position,n),a=l[i].properties,o=1;else if(0===t)r={position:n[i=0],heading:h[0],speed:p[0],timestamp:c[0]},u.map&&e._setMapCamera(r.position,r.heading,!1),M.setCoordinates(s,r.position,[r.position,r.position]),a=l[0].properties;else{var f=e._totalTime*t,g=null;if(f>e._totalTime)r={heading:h[i=h.length-1],speed:p[i],timestamp:c[i+1]},g=n.slice(0),a=l[i+1].properties,o=1;else if(f<0)r.heading=h[0],g=n.slice(0,1);else{var y=0,v=e._timeInv;for(i=0;i<h.length;i++){if(y+v[i]>=f){r.heading=h[i],r.speed=p[i],g=n.slice(0,i+1);var m=f-y,d=p[i]*m*.001;o=d/P.math.getDistanceTo(n[i],n[i+1]),r.timestamp=c[i]+m,g.push(P.math.getDestination(n[i],r.heading,d));break}y+=v[i]}}g&&0<g.length&&(r.position=g[g.length-1],u.map&&e._setMapCamera(r.position,r.heading,2<g.length),M.setCoordinates(s,r.position,g))}if(r=Object.assign(a||{},r),u.captureMetadata){var _={},x=e._valueInterps;x&&Array.isArray(x)&&x.forEach(function(t){M.interpolateValue(l[i],l[i+1],o,t,_)}),M.setMetadata(s,Object.assign(r,_))}return r}return null},$.prototype._processPath=function(){var t=this,e=t._route;if(e){t._totalTime=0,t._positions=null;var n=[],r=[],i=[],a=[],o=[],s=P.math,u=e[0];if("Feature"!==u.type||"Point"!==u.geometry.type||"number"!=typeof u.properties._timestamp)throw"Feature is not a point or is missing a _timestamp value.";o.push(u.properties._timestamp),n.push(u.geometry.coordinates);for(var h=1,p=e.length;h<p;h++)if("Feature"===(u=e[h]).type&&"Point"===u.geometry.type&&"number"==typeof u.properties._timestamp){n.push(u.geometry.coordinates);var c=s.getDistanceTo(n[h-1],n[h]);o.push(u.properties._timestamp);var l=o[h]-o[h-1];a.push(l),t._totalTime+=l,i.push(c/(.001*l));var f=s.getHeading(n[h-1],n[h]);r.push(f)}if(e.length!==n.length)throw t.dispose(),"Unable to process all points in route.";t._headingInv=r,t._speedInv=i,t._timeInv=a,t._timestamps=o,t._positions=n,U.prototype.setOptions.call(this,{duration:t._totalTime})}},$);function $(t,e,n){var r=U.call(this)||this,i=r;return i._shape=e,i._route=t,i.setOptions(Object.assign({rotate:!0,rotationOffset:0},n||{})),n&&n.autoPlay&&i.play(),r}var K,tt=(e(et,K=c),et.prototype.onAnimationProgress=function(e){var n=this;return n._shapes.forEach(function(t){t.setProperties(Object.assign(t.getProperties(),{opacity:n._minOpacity+n._opacityWidth*e}))}),null},et);function et(t,e,n,r){var i=K.call(this,r)||this;if((n=n||1)<(e=e||0)){var a=n;n=e,e=a}if(i._minOpacity=e,i._opacityWidth=n-e,!(t&&0<t.length))throw"No shape specified for animation.";var o=i;return(o._shapes=t).forEach(function(t){t.setProperties(Object.assign(t.getProperties(),{opacity:e}))}),r&&r.autoPlay&&o.play(),i}function nt(t){var e=h.instance.getById(t);e&&e.stop()}function rt(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];var i=new X(t,e,1,n);return i.play(),i._id}var it,at=(e(ot,it=P.internal.EventEmitter),ot.prototype.dispose=function(){var t=this;t.stop(),t._options=null,t._animations=null,t._onComplete=null,t._isPlaying=null,t._cancelAnimations=null},ot.prototype.getDuration=function(){return this._calculateDuration()},ot.prototype.getOptions=function(){return Object.assign({},this._options)},ot.prototype.isPlaying=function(){return this._isPlaying},ot.prototype.play=function(t){var e=this;switch(t&&e.reset(),e._cancelAnimations=!1,e._options.playType){case"together":e._playTogether();break;case"sequential":e._playSeq();break;case"interval":e._playInterval()}},ot.prototype.reset=function(){this._cancelAnimations=!0;var t=this._animations;if(t&&0<t.length)for(var e=0;e<t.length;e++)t[e].reset();this._isPlaying=!1},ot.prototype.stop=function(){this._cancelAnimations=!0;var t=this._animations;if(t&&0<t.length)for(var e=0;e<t.length;e++)t[e].stop();this._isPlaying=!1},ot.prototype.setOptions=function(t){if(t){var e=this,n=e._options,r=e._isPlaying;r&&e.stop(),t.playType&&-1!==["together","sequential","interval"].indexOf(t.playType)&&(n.playType=t.playType),"boolean"==typeof t.autoPlay&&(n.autoPlay=t.autoPlay,!r&&t.autoPlay&&(r=!0)),"number"==typeof t.interval&&(n.interval=0<t.interval?Math.abs(t.interval):100),e._calculateDuration(),r&&e.play()}},ot.prototype._playTogether=function(){var t=this,e=this._animations;if(e&&0<e.length){t._isPlaying=!0;for(var n=0;n<e.length;n++)n===e.length-1&&(e[n]._onComplete=function(){t._isPlaying=!1,t._invokeEvent("oncomplete",null)}),e[n].play()}},ot.prototype._playSeq=function(){var t=this,e=t._animations;if(e&&0<e.length){t._isPlaying=!0;var n=0,r=function(){t._isPlaying&&(0<n&&(e[n-1]._onComplete=null),!t._cancelAnimations&&n<e.length?(e[n]._onComplete=r,e[n].play(),n++):(t._isPlaying=!1,t._invokeEvent("oncomplete",null)))};r()}},ot.prototype._playInterval=function(){var t=this,e=t._animations;if(e&&0<e.length){t._isPlaying=!0;var n=0,r=function(){t._isPlaying&&(!t._cancelAnimations&&n<e.length?(n===e.length-1&&(e[n]._onComplete=function(){t._isPlaying&&(t._isPlaying=!1,t._invokeEvent("oncomplete",null))}),e[n].play(),n++,rt(function(){r()},t._options.interval)):t._cancelAnimations&&t._isPlaying&&(t._isPlaying=!1,t._invokeEvent("oncomplete",null)))};r()}},ot.prototype._calculateDuration=function(){var i=0,a=0,o=0,s=0,u=this._options,t=this._animations,h=u.interval*t.length;t.forEach(function(t,e,n){var r=t.getDuration();(a=h-e*u.interval)<r&&(i=Math.max(i,r-a)),o=Math.max(o,r),s+=r});var e=0;switch(u.playType){case"together":e=o;break;case"sequential":e=s;break;case"interval":e=i+h}return e},ot);function ot(t,e){var n=it.call(this)||this;n._cancelAnimations=!1,n._isPlaying=!1,n._options={playType:"together",interval:100,autoPlay:!1},n._onComplete=function(){};var r=n;return r._animations=t,e?r.setOptions(e):r._calculateDuration(),n}var st=Object.freeze({__proto__:null,FrameBasedAnimationTimer:y,GroupAnimation:at,PlayableAnimation:c,drop:function(t,e,n,r){var i=[];if(Array.isArray(t))for(var a=0,o=t.length;a<o;a++)"Feature"===t[a].type&&"Point"===t[a].geometry.type||"Point"===t[a].type?i.push(new P.Shape(t[a])):t[a]instanceof P.Shape&&"Point"===t[a].getType()&&i.push(t[a]);else"Feature"===t.type&&"Point"===t.geometry.type||"Point"===t.type?i.push(new P.Shape(t)):t instanceof P.Shape&&"Point"===t.getType()&&i.push(t);if(0<i.length)return new w(i,e,n,r);throw"No supported shapes specified."},dropMarkers:function(t,e,n,r){var i=[];if(Array.isArray(t))for(var a=0,o=t.length;a<o;a++)t[a]instanceof P.HtmlMarker&&i.push(t[a]);else t instanceof P.HtmlMarker&&i.push(t);if(0<i.length)return new w(i,e,n,r);throw"No markers specified."},setCoordinates:function(t,e,n){var r=M.getSuitableCoordinates(t,e);if(t instanceof P.Shape){var i=t.getType();if("Point"===i)return new k(t,r,n);if("GeometryCollection"!==i)return new Q(t,{type:t.getType(),coordinates:r},n)}return new k(t,r,n)},snakeline:function(t,e){if(t&&"LineString"===t.getType())return new F(t.getCoordinates().slice(0),t,e);throw"Specified shape is not a LineString type, or no map specified."},moveAlongPath:function(t,e,n){if(e&&(e instanceof P.HtmlMarker||e instanceof P.Shape&&"Point"===e.getType())||n&&n.map){var r=void 0;if(t)if(Array.isArray(t))r=t;else if(t instanceof P.Shape){if("LineString"===t.getType())r=t.getCoordinates();else if("Polygon"===t.getType()){var i=t.getCoordinates();0<i.length&&(r=i[0])}}else"LineString"===t.type&&(r=t.coordinates);if(r.length<2)throw"Invalid path option specified.";return new F(r,e,n)}throw"Specified shape is not a Point type, or not map specified."},moveAlongRoute:function(t,e,n){if(t.length<2)throw"Invalid path option specified.";return new W(t,e,n)},extractRoutePoints:function(t,e){var n;if(e=e||"_timestamp",Array.isArray(t)){n=[];for(var r=void 0,i=0,a=t.length;i<a;i++){var o=void 0;if(o=t[i]instanceof P.Shape?t[i].toJson():t[i],!r&&-1===["Polygon","MultiLineString","MultiPolygon","GeometryCollection"].indexOf(o.geometry.type)&&(o.properties[e]||"number"==typeof o.properties._timestamp||"Point"!==o.geometry.type&&o.properties.waypoints)&&(r=o.geometry.type),r&&(0===n.length||"Point"===o.geometry.type)){var s=this.extractRoutePoints(o,e);if(s&&(n=n.concat(s),"Point"!==r))break}}}else t instanceof P.Shape?n=M.extractRoutePointsFromFeature(t.toJson(),e):"FeatureCollection"===t.type?n=this.extractRoutePoints(t.features,e):t.type&&(n=M.extractRoutePointsFromFeature(t,e));return 0<(n=n&&n.sort(function(t,e){return t.properties._timestamp-e.properties._timestamp})).length?n:null},morph:function(t,e,n){return new Q(t,e,n)},delay:function(t,e){return new X(e,t,1)},interval:function(t,e,n){return new X(e,t,Math.max(n||1/0,1))},setInterval:function(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];var i=new X(t,e,1/0,n);return i.play(),i._id},clearInterval:nt,setTimeout:rt,clearTimeout:function(t){nt(t)},getEasingFn:function(t){return s[t]||null},getEasingNames:function(){return Object.keys(s)},flowingDashedLine:function(o,t){"round"===o.getOptions().lineCap&&o.setOptions({lineCap:"butt"});var s=t.dashLength||4,u=t.gapLength||4,h=40*s/(u+s),p=40-h;return new y(40,function(t){var e,n,r,i,a;a=t<h?(n=(1-(e=t/h))*s,r=u,i=e*s,0):(n=0,r=(1-(e=(t-h)/p))*u,i=s,e*u),o.setOptions({strokeDashArray:[n,r,i,a]})},t)},fadeShapes:function(t,e,n,r){if(0<t.length)return new tt(t,e,n,r);throw"No supported shapes specified."}}),ut=n.merge("atlas.layer",b),ht=n.merge("atlas.animations",st);t.animations=ht,t.layer=ut}(this.atlas=this.atlas||{},atlas);
