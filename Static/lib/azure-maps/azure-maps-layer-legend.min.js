/* MIT License - Copyright (c) Microsoft Corporation. */


!function(e,_){"use strict";var d="default"in _?_.default:_,o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)t.hasOwnProperty(a)&&(e[a]=t[a])})(e,t)};function t(e,t){function a(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(a.prototype=t.prototype,new a)}var i=function(){return(i=Object.assign||function(e){for(var t,a=1,o=arguments.length;a<o;a++)for(var n in t=arguments[a])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}).apply(this,arguments)},a=(n.merge=function(e,t){for(var a=window||global,o=0,n=e.split(".");o<n.length;o++){var r=n[o];if(!a[r])return t;a=a[r]}return i(i({},a),t)},n);function n(){}var M=(s.getString=function(e,t,a,o){if(void 0!==e){if("number"==typeof e)return e.toLocaleString(a,o);if(""!==e)return Number.toString(),t&&t[e]?t[e]:e}return""},s.uuid=function(){return([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,function(e){return(e^crypto.getRandomValues(new Uint8Array(1))[0]&15>>e/4).toString(16)})},s.getLayer=function(e,t){return"string"==typeof e?t.layers.getLayerById(e):e},s.colorToRGBA=function(e){var t=document.createElement("canvas");t.setAttribute("width","1"),t.setAttribute("height","1");var a=t.getContext("2d");a.fillStyle=e,a.fillRect(0,0,1,1);var o=a.getImageData(0,0,1,1).data;return[o[0],o[1],o[2],o[3]]},s.getColorTheme=function(e){var t=s.colorToRGBA(e);return 127<Math.sqrt(.299*t[0]*t[0]+.587*t[1]*t[1]+.114*t[2]*t[2])?"light":"dark"},s.getElement=function(e){if(e){if("string"!=typeof e)return e;var t=document.getElementById(e);return t=t||document.querySelector(e)}return null},s.replacePlaceholder=function(e,t,a,o){o&&(t="[\"']?"+t+"[\"']?");var n=RegExp(t,"gi");return JSON.parse(JSON.stringify(e).replace(n,a+""))},s.setZoomRangeAttr=function(e,t,a,o){var n="data-zoom-behavior",r=e.minZoom+"",i=e.maxZoom+"",l=e.zoomBehavior||t.zoomBehavior||"";a.setAttribute("data-min-zoom",r),a.setAttribute("data-max-zoom",i),a.setAttribute(n,l),o&&(o.setAttribute("data-min-zoom",r),o.setAttribute("data-max-zoom",i),o.setAttribute(n,l))},s.processZoomRangeAttr=function(e,t){for(var a="data-min-zoom",o="atlas-carousel-disabled-text",n=0;n<e.length;n++){var r=e[n];if(r.hasAttribute(a)){var i=parseInt(r.getAttribute(a)),l=parseInt(r.getAttribute("data-max-zoom")),s=r.getAttribute("data-zoom-behavior"),c=i<=t&&Math.ceil(t)<=l;if("hide"===s)r.style.display=c?"":"none";else{for(var d=r.querySelectorAll("input, option"),u=0;u<d.length;u++)d[u].disabled=!c;c?r.classList.remove(o):r.classList.add(o)}}}},s.getZoomRange=function(e){if(e&&0<e.length){var a={minZoom:24,maxZoom:0};if(e.forEach(function(e){if(e.getOptions){var t=e.getOptions();a.minZoom=Math.min(t.minZoom||0,a.minZoom),a.maxZoom=Math.max(t.maxZoom||24,a.maxZoom)}}),a.minZoom>a.maxZoom){var t=a.maxZoom;a.maxZoom=a.minZoom,a.minZoom=t}return a}return{minZoom:0,maxZoom:24}},s.addClearDiv=function(e){var t=document.createElement("div");t.className="atlas-control-clear",e.appendChild(t)},s.measureText=function(e,t,a){var o=document.createElement("canvas").getContext("2d");return o.font=t+"px "+(a||"Arial"),s.HexCharRx.test(e)&&(e=e.replace(s.HexCharRx,"W")),o.measureText(e)},s.addStringDiv=function(e,t,a,o,n,r){if(t&&""!==t){if(""!==(t=s.getString(t,o))){var i=document.createElement("div");if(i.className=a,i.innerHTML=t,i.setAttribute("aria-label",t),e.appendChild(i),!r){var l=s.measureText(t,14);i.style.minWidth=Math.ceil(l.width+20)+"px"}n&&s.addClearDiv(e)}return t}return""},s.getNumber=function(e,t,a,o){var n=e[t];return"number"==typeof n?Math.max(a,n):o},s.getNumber2=function(e,t,a,o,n){var r=e[a];return"number"==typeof r||"number"==typeof(r=t[a])?Math.max(o,r):n},s.getMapLayers=function(e,t){var a=[];if(e){var o=e.layers.getLayers(),n=[],r=[];t&&0<t.length&&t.forEach(function(e){r.push("string"==typeof e?e:e.getId())});var i=_.control.DrawingToolbar;i&&e.controls.getControls().forEach(function(e){if(e instanceof i){var t=i.drawMgr.getLayers();r.push(t.lineLayer.getId()),r.push(t.pointLayer.getId()),r.push(t.polygonLayer.getId()),r.push(t.polygonOutlineLayer.getId())}});var l=_.layer.SimpleDataLayer;o.forEach(function(e){var t=e.layers&&0<e.layers.length?e.layers[0].id:e.getId();if(l&&e instanceof l){n.push(e);var o=e.getLayers();Object.keys(o).forEach(function(e){var t=o[e],a=n.indexOf(t);-1<a&&n.splice(a,1),r.push(t.getId())})}else t.startsWith("microsoft.maps.")||n.push(e)}),n.forEach(function(e){var t=e.layers&&0<e.layers.length?e.layers[0].id:e.getId();-1===r.indexOf(t)&&a.push(e)})}return a},s.decimalPlaces=function(e){var t=(""+e).match(/(?:\.(\d+))?(?:[eE]([+-]?\d+))?$/);return t?Math.max(0,(t[1]?t[1].length:0)-(t[2]?+t[2]:0)):0},s.round=function(e,t){var a=Math.pow(10,t);return Math.round(e*a)/a},s.HexCharRx=/&#x[0-9a-zA-Z]+;/g,s);function s(){}var f=(C.serializeLayerOptions=function(e){if(e.getOptions){var o=e.getOptions(),t={radius:o.radius,color:o.color,fillColor:o.fillColor,fillPattern:o.fillPattern,strokeColor:o.strokeColor,strokeWidth:o.strokeWidth,strokeGradient:o.strokeGradient,image:o.iconOptions?o.iconOptions.image:0,minZoom:o.minZoom,maxZoom:o.maxZoom,visible:o.visible,activeLayers:o.activeLayers};if(_.layer.SimpleDataLayer&&e instanceof _.layer.SimpleDataLayer){var n=[t],r=e.getLayers();return["bubbleLayer","extrudedPolygonLayer","lineLayer","polygonLayer","symbolLayer"].forEach(function(e){var t=r[e],a="extrudedPolygonLayer"===e;t&&(!a||a&&o.allowExtrusions)&&n.push(C.serializeLayerOptions(t))}),JSON.stringify(n)}return JSON.stringify(t)}},C.parse=function(e,t){var a=C,o=[],n=M.getLayer(e.layer,t._map);if(n){var r=_.layer,i=a._parseStyle,l=a._overrideCategoryValue,s={};if(n.getOptions&&(s=n.getOptions()),s.visible)if(n instanceof r.BubbleLayer){i(n,"color","color",e,t,o);var c=i(n,"radius","scale",e,t,o);c&&("category"===c.type&&c.items.forEach(function(e){e.shapeSize*=2}),"string"==typeof s.color&&l(c,"color",s.color))}else if(n instanceof r.LineLayer){var d=i(n,"strokeGradient","color",e,t,o,!0);l(d||i(n,"strokeColor","color",e,t,o,!0),"shape","line");var u=i(n,"strokeWidth","scale",e,t,o);l(u,"shape","line"),u&&!d&&"string"==typeof s.strokeColor&&l(u,"color",s.strokeColor)}else if(n instanceof r.PolygonLayer||n instanceof r.PolygonExtrusionLayer){var p=i(n,"fillPattern","image",e,t,o);l(p||i(n,"fillColor","color",e,t,o),"shape","square")}else if(n instanceof r.HeatMapLayer)i(n,"color","color",e,t,o,!0);else if(n instanceof r.SymbolLayer){var m=s.iconOptions;if(m)if("string"==typeof m.image){if(m.size&&Array.isArray(m.size)){var g=a._getValue(m.image,"image",t);g&&g.shape&&l(i(n,"size","scale",e,t,o),"shape",g.shape)}}else i(n,"image","image",e,t,o)}else if(r.OgcMapLayer&&n instanceof r.OgcMapLayer){var f=n;f.onActiveLayersChanged=function(e){e._client._capabilities?t._rebuildContainer():e.getCapabilities().then(function(e){e&&t._rebuildContainer()})};var y=e.defaultImage||{},h=s.activeLayers,v=f._client;if(v&&v._capabilities&&h){var b=v._capabilities.sublayers;b&&h.forEach(function(e){for(var t=0;t<b.length;t++)if("string"==typeof e&&e===b[t].id||e.id===b[t].id){var a=e.styles;a&&0<a.length&&a[0].legendUrl&&""!==a[0].legendUrl&&o.push({type:"image",url:a[0].legendUrl.replace(/\&amp;/g,"&"),subtitle:e.title||e.subtitle||b[t].id||"",footer:e.description||e.abstract||"",minZoom:e.minZoom,maxZoom:e.maxZoom,maxHeight:y.maxHeight,maxWidth:y.maxWidth})}})}}else r.SimpleDataLayer&&r.SimpleDataLayer}return o},C._parseStyle=function(e,t,a,o,n,r,i){if(e.getOptions){var l=C,s=e.getOptions(),c=s[t];if(!c&&s.iconOptions&&"image"===t&&"image"===a&&(c=s.iconOptions[t]),l._isExp(c)){var d=void 0;switch(c[0]){case"step":d=l._parseStep(e,c,a,o,n);break;case"match":d=l._parseMatch(e,c,a,o,n);break;case"interpolate":d=l._parseInterpolation(e,c,a,o)}if(d){switch(d.type){case"category":o.defaultCategory&&Object.assign(d,o.defaultCategory);break;case"gradient":if(i){var u=d;u.stops.forEach(function(e){e.label=void 0}),u.stops[0].label="low",u.stops[u.stops.length-1].label="high"}o.defaultGradient&&Object.assign(d,o.defaultGradient);break;case"image":o.defaultImage&&Object.assign(d,o.defaultImage)}return"number"==typeof s.minZoom&&(d.minZoom=s.minZoom),"number"==typeof s.maxZoom&&(d.maxZoom=s.maxZoom),d.cssClass=o.cssClass,r.push(d),d}}}},C._parseStep=function(e,t,a,o,n){if(5<=t.length&&t.length%2==1){var r=C,i=M.getString,l=[],s=t.length,c=t[2],d=n.getOptions().resx;if(("color"===a||"image"===a)&&"string"!=typeof c||"scale"===a&&"number"!=typeof c)return;var u=r._getValue(c,a,n);if(!u)return;var p=o.defaultCategory,m=void 0,g=void 0;p&&(m=p.numberFormat,g=p.numberFormatLocales);var f=i(t[3],d,g,m);u.label="<"+f,l.push(u);for(var y=3;y<s;y+=2){var h=r._getValue(t[y+1],a,n);if(!h)return;if(h.label=i(t[y],d,g,m),y===s-2)h.label=">"+f;else{var v=i(t[y+2],d,g,m);h.label=f+" - "+v,f=v}l.push(h)}return{type:"category",items:l,subtitle:o.subtitle||r._getSubtitle(o.subtitleFallback,t[1],e),footer:o.footer||r._getFooter(o.footerFallback,e),layout:"image"!==a?"column-reverse":"column",collapse:"color"===a}}},C._parseMatch=function(e,t,a,o,n){if(5<=t.length&&t.length%2==1){for(var r=C,i=[],l=2,s=t.length-1;l<s;l+=2){var c=r._getValue(t[l+1],a,n);if(!c)return;c.label=t[l],i.push(c)}var d=r._getValue(t[t.length-1],a,n);if(!stop)return;return d.label="no data",i.push(d),{type:"category",items:i,subtitle:o.subtitle||r._getSubtitle(o.subtitleFallback,t[1],e),footer:o.footer||r._getFooter(o.footerFallback,e),collapse:"color"===a}}},C._parseInterpolation=function(e,t,a,o){if(7<=t.length&&t.length%2==1){var n=C,r=o.subtitle||n._getSubtitle(o.subtitleFallback,t[2],e),i=o.footer||n._getFooter(o.footerFallback,e),l=t[3],s=t[t.length-2];if("color"===a){if(v=n._getInterpFn(t[1],l,s)){for(var c=[],d=-1,u=3,p=t.length;u<p;u+=2){var m=t[u];if("string"!=typeof(y=t[u+1]))return;var g=v(m);g-d<.05&&(m=void 0,d=g),c.push({offset:g,label:m,color:y})}return{type:"gradient",stops:c,subtitle:r,footer:i}}}else if("scale"===a){var f=[];for(u=3,p=t.length;u<p;u+=2){var y;if(m=t[u],"number"!=typeof(y=t[u+1]))return;f.push({shapeSize:0===y?.01:y,label:m})}if(7===t.length){var h=l+(s-l)/2,v=n._getInterpFn(t[1],l,s),b=t[4],_=t[6],x=v(h)*(_-b)+b;h=M.round(h,Math.max(M.decimalPlaces(l),M.decimalPlaces(s))+1),f.splice(f.length-1,0,{shapeSize:x,label:h})}return{type:"category",items:f,layout:"column-reverse",subtitle:r,footer:i,fitItems:!0}}}},C._parseInputGetter=function(e){if(Array.isArray(e)&&"get"===e[0]&&"string"==typeof e[1])return e[1]},C._getInterpFn=function(e,a,t){var o=e[0],n=t-a;if(0==n)return function(e){return 0};if("linear"===o)return function(e){return(e-a)/n};if("exponential"===o){var r=e[1];return function(e){var t=e-a;return(Math.pow(r,t)-1)/(Math.pow(r,n)-1)}}},C._isExp=function(e){return e&&Array.isArray(e)&&0<e.length&&"string"==typeof e[0]},C._overrideCategoryValue=function(e,t,a){e&&"category"===e.type&&!e[t]&&(e[t]=a)},C._getValue=function(e,t,a){var o,n="string"==typeof e;if("color"===t&&n)o={color:e};else if("scale"===t&&"number"==typeof e)o={shapeSize:0===e?.01:e};else if("image"===t&&n&&a._map){var r=this._getImage(a._map,e);r&&(o={shape:r})}return o},C._getImage=function(e,t){if(e&&"none"!==t){if(e.imageSprite.hasImage(t))return e.imageSprite.userImages.get(t).src;var a=void 0,o=void 0;if(t.startsWith("marker")?(a="marker",o=t.replace("marker-","")):t.startsWith("pin-round")?(a="pin-round",o=t.replace("pin-round-","")):t.startsWith("pin")&&(a="pin",o=t.replace("pin-","")),a&&(o={black:"#231f20",blue:"#1a73aa",darkblue:"#003963",red:"#ef4c4c",yellow:"#f2c851"}[o]))return _.getImageTemplate(a,1).replace(/{color}/g,o).replace(/{secondaryColor}/g,"#fff").replace(/{text}/g,"")}},C._getSubtitle=function(e,t,a){if("none"!==(e=e||"auto")){var o=a.metadata||{},n=a.getId();return"auto"===e?o.title||o.subtitle||n:"expression"===e?this._parseInputGetter(t)||n:o[e]||""}},C._getFooter=function(e,t){e=e||"auto";var a=t.metadata||{};return"auto"===e?a.footer||a.description||a.abstract||"":"none"!==e?a[e]||"":void 0},C);function C(){}var r,l=(t(u,r=_.internal.EventEmitter),u.prototype.onAdd=function(e,t){var a=this,o=(a._map=e).getStyle().language||d.getLanguage();o&&0<o.indexOf("-")&&(o=o.substring(0,o.indexOf("-")));var n=u._translations,r=n[o];r=r||n.en,a._localization=r,t&&(a._controlPosition=t.position);var i=document.createElement("div");i.classList.add("azure-maps-control-container"),a._cssClass&&i.classList.add(a._cssClass);var l=r[a._nameIdx];l&&i.setAttribute("aria-label",l),a._container=i;var s=e.getMapContainer().classList;if(s.contains("high-contrast-dark")?a._hclStyle="dark":s.contains("high-contrast-light")&&(a._hclStyle="light"),a._setStyle(a._baseOptions.style),a._rebuildContainer(),void 0!==a._baseOptions.visible){var c=a._baseOptions.visible?"":"none";i&&(i.style.display=c),a._content&&(a._content.style.display=c)}return a._controlWatcher=setInterval(a._checkControlCount,1e3),e.events.add("zoomend",a._mapZoomChanged),a._mapZoomChanged(null),i},u.prototype.onRemove=function(){var e=this;e._content&&(e._content.remove(),e._content=null),e._container&&(e._container.remove(),e._container=null),e._controlWatcher&&(clearInterval(e._controlWatcher),e._controlWatcher=null);var t=e._map;t&&(e._baseOptions.style.startsWith("auto")&&t.events.remove("styledata",e._mapStyleChanged),t.events.remove("zoomend",e._mapZoomChanged)),e._map=null},u.prototype.setOptions=function(e){e=e||{};var t=this,a=t._baseOptions,o=t._container,n=t._content,r=!1;if(void 0!==e.style&&(a.style=e.style,t._setStyle(e.style)),void 0!==e.zoomBehavior&&(a.zoomBehavior=e.zoomBehavior,t._needsRebuild=!0),void 0!==e.visible){a.visible=e.visible;var i=e.visible?"":"none";o&&(o.style.display=i),n&&(n.style.display=i),r=!0}void 0!==e.minimized&&a.minimized!==e.minimized&&(a.minimized=e.minimized,t._setBtnState()),void 0!==e.container&&(a.minimized=!1,t._setBtnState(),a.container=e.container,t._needsRebuild=!0),void 0!==e.layout&&a.layout!==e.layout&&(a.layout=e.layout,t._needsRebuild=!0),void 0!==e.showToggle&&a.showToggle!==e.showToggle&&(a.showToggle=e.showToggle,e.showToggle||(e.minimized=!1),t._setBtnState()),t._needsRebuild&&t._map?t._rebuildContainer():r&&t._mapZoomChanged(null)},u.prototype._addCard=function(e,t,a,o){var n,r=this,i=r._content,l=r._baseOptions.layout;if("carousel"===l?((n=document.createElement("button")).className="atlas-carousel-dot",t.appendChild(n)):"accordion"===l?((n=document.createElement("button")).className="atlas-accordion-button",n.innerHTML=o,i.appendChild(n)):r._baseOptions.layout="list",i.appendChild(e),n){var s=e.getAttribute("rel");n.setAttribute("rel",s),n.setAttribute("aria-label",o),n.setAttribute("title",o),n.setAttribute("aria-controls",e.id),n.onclick=r._handledClicked.bind(r),r._currentIdx===parseInt(s)?(e.style.display="",n.setAttribute("aria-expanded","true"),n.classList.add("active")):(n.setAttribute("aria-expanded","false"),e.style.display="none")}M.setZoomRangeAttr(a,r._baseOptions,e,n)},u.prototype._adjustSize=function(){var e=this,t=e._baseOptions,a=e._container;if(e._map){var o="unset",n="unset";if(!t.container){var r=e._map.getCanvasContainer().getClientRects()[0];o=r.width-20+"px";var i=r.height-20,l=e._controlPosition;if(l&&""!==l&&"non-fixed"!==l){var s=-1<l.indexOf("left")?"left":"right",c=0,d=e._map.controls.controlContainer.children;Array.from(d).forEach(function(e){-1<e.className.indexOf(s)&&(c+=e.children.length)}),1<c&&(c--,-1<l.indexOf("right")&&c++,i=Math.min(i,r.height-35*c-20))}Object.assign(a.style,{maxHeight:i+"px",maxWidth:o}),"accordion"===t.layout?(i=i-30*a.querySelectorAll(".atlas-accordion-button").length-20,n=i+"px"):"carousel"===t.layout&&(i=r.height-110,n=i+"px"),i<=40&&(n="unset"),a.querySelectorAll(".atlas-layer-legend-card").forEach(function(e){Object.assign(e.style,{maxHeight:n,maxWidth:o})})}}},u.prototype._setStyle=function(e){if(e){var t=this,a=t._map;a&&(e.startsWith("auto")&&!t._hclStyle?(a.events.add("styledata",t._mapStyleChanged),t._setColorFromMapStyle()):(a.events.remove("styledata",t._mapStyleChanged),t._setControlColor(e)))}},u.prototype._setColorFromMapStyle=function(){var e=this,t="light";if(-1<["satellite","satellite_road_labels","grayscale_dark","night","high_contrast_dark"].indexOf(e._map.getStyle().style))t="dark";else if(-1===["road","grayscale_light","road_shaded_relief","blank","blank_accessible","high_contrast_light"].indexOf(e._map.getStyle().style))for(var a=e._map.map.getStyle(),o=0;o<a.length;o++){var n=a[o];if("background"===n.type){n.paint&&"string"==typeof n.paint["background-color"]&&(t=M.getColorTheme(n.paint["background-color"]));break}}"auto-reverse"===e._baseOptions.style&&(t="light"===t?"dark":"light"),e._setControlColor(t)},u.prototype._setControlColor=function(e){var t=this;if(t._container||t._content){e=t._hclStyle||e;var a=t._darkColor,o="white",n=a;"light"===e||"dark"===e||e.startsWith("auto")?"dark"===e&&(o=a,n="white"):(o=e,n="dark"===(e=M.getColorTheme(e))?"white":a);var r={backgroundColor:o,color:n};t._content&&Object.assign(t._content.style,r),t._container&&Object.assign(t._container.style,r),t._btn&&(t._btn.style.backgroundColor=o),t._fontColor=n,t._bgColor=o}},u.prototype._setCardIdx=function(e,t){var a=this;if(a._content){var o=a._content.getElementsByClassName("atlas-layer-legend-card"),n=a._content.querySelectorAll(".atlas-carousel-dot, .atlas-accordion-button"),r=a._baseOptions.layout,i=o.length;0===n.length&&(n=null),i<=e&&(e=i-1),e<0&&"accordion"!==r&&(e=0),a._currentIdx=e;for(var l=0;l<i;l++){var s=o[l],c=parseInt(s.getAttribute("rel"));if("carousel"===r)c!==e?(s.style.display="none",n&&(n[l].classList.remove("atlas-carousel-dot-active"),n[l].setAttribute("aria-expanded","false"))):(s.style.display="block",n&&(n[l].classList.add("atlas-carousel-dot-active"),n[l].setAttribute("aria-expanded","true")),t&&a._setItemFocus(s));else if("accordion"===r)c!==e?(s.style.display="none",n&&(n[l].classList.remove("active"),n[l].setAttribute("aria-expanded","false"))):(s.style.display="block",n&&(n[l].classList.add("active"),n[l].setAttribute("aria-expanded","true")),t&&a._setItemFocus(s));else if(c===e){s.scrollIntoView(),t&&a._setItemFocus(s);break}}}},u.prototype._setItemFocus=function(e){var t=e.querySelectorAll("input, button, select, a");0<t.length&&t[0].focus()},u.prototype._setBtnState=function(){var e=this,t=e._btn,a=e._baseOptions;if(t&&!a.container){var o=e._btnCSS,n="32px",r="32px",i="none",l=!1,s=e._localization[e._nameIdx],c=a.minimized&&a.showToggle;c?s+=" - "+e._localization[2]:(l=a.showToggle,i="",n=r="unset"),t.setAttribute("aria-expanded",!c+"");var d=e._container;if(d){e._content&&a.visible&&(e._content.style.display=i),d.setAttribute("aria-expanded",!c+"");var u=d.classList;l?(u.contains(o)||u.add(o),t.style.display="",d.style.cursor=""):(u.remove(o),t.style.display="none",c&&(d.style.cursor="pointer")),d.setAttribute("title",s),d.setAttribute("alt",s),Object.assign(d.style,{height:r,width:n})}a.minimized!==c&&e._invokeEvent("toggled",{minimized:c,type:"toggled"})}},u._translations={en:["Legend control","Layer control","Expand","Collapse"],af:["Legende beheer","Laagbeheer","Uitbrei","Inval"],ar:["السيطرة على الأسطورة","التحكم في الطبقة","وسعت","انهيار"],eu:["Kondaira kontrol","Geruzaren kontrola","Hedatu","Erroiztu"],bg:["Контрол на легендата","Контрол на слоя","Разширяване","С колапс"],zh:["传说控制","层控制","扩张","坍塌"],hr:["Legenda kontrola","Kontrola sloja","Proširiti","Kolaps"],cs:["Kontrola legendy","Řízení vrstvy","Rozšířit","Kolaps"],da:["Legend Control.","Lagstyring","Udvide","Falde sammen"],nl:["Legend Control","Laagregeling","Uitbreiden","Instorten"],et:["Legendikontroll","Kihi juhtimine","Laiendama","Kollaps"],fi:["Legend Control","Kerrosohjaus","Laajentaa","Romahdus"],fr:["Lutte contre la légende","Contrôle de couche","Développer","Effondrer"],gl:["Control de lendas","Control de capa","Expandir.","Colapso"],de:["Legend Control.","Schichtregelung","Expandieren","Zusammenbruch"],el:["Έλεγχος θρύλου","Έλεγχος στρώματος","Επεκτείνουν","Κατάρρευση"],hi:["पौराणिक नियंत्रण","परत नियंत्रण","विस्तार करना","ढहने"],hu:["Legenda irányítás","Rétegszabályozás","Kiterjed","Összeomlás"],id:["Kontrol legenda","Kontrol lapisan","Mengembangkan","Jatuh"],it:["Controllo della legenda","Controllo del livello","Espandere","Crollo"],ja:["伝説のコントロール","レイヤコントロール","拡大","崩壊"],kk:["Аңызды бақылау","Қабатты бақылау","Кеңейту","Күйреу"],ko:["전설 제어","레이어 제어","확장하다","무너지다"],es:["Control de leyenda","Control de la capa","Expandir","Colapso"],lv:["Leģenda kontrole","Slāņa kontrole","Paplašināt","Sabrukums"],lt:["Legend Control.","Sluoksnio kontrolė","Išplėsti","Žlugimas"],ms:["Kawalan Legend.","Kawalan lapisan","Berkembang","Runtuh"],nb:["Legenden kontrollen","Lagkontroll","Utvide","Kollapse"],pl:["Kontrola legendy","Kontrola warstwy","Zwiększać","Zawalić się"],pt:["Controle da legenda","Controle de camada","Expandir","Colapso"],ro:["Controlul legendei","Controlul stratului","Extinde","Colaps"],ru:["Легендант контроля","Управление слоем","Расширять","Крах"],sr:["Контрола легенде","Контрола слоја","Проширити","Колапс"],sk:["Legenda","Ovládanie vrstvy","Rozbaľovať","Kolaps"],sl:["Legenda Control.","Kontrola plasti","Razširi","Spanje."],sv:["Legendkontroll","Lagkontroll","Bygga ut","Kollaps"],th:["การควบคุมตำนาน","การควบคุมเลเยอร์","ขยาย","ทรุด"],tr:["Efsane kontrolü","Katman kontrolü","Genişletmek","Yıkılmak"],uk:["Легенда контроль","Керування шаром","Розширювати","Розвал"],vi:["Kiểm soát huyền thoại","Lớp kiểm soát","Mở rộng","Sự sụp đổ"]},u);function u(e,t,a){var h=r.call(this)||this;h._needsRebuild=!1,h._rebuildOnStyleChange=!1,h._darkColor="#011c2c",h._baseOptions={layout:"carousel",style:"light",visible:!0,zoomBehavior:"hide",showToggle:!0,minimized:!1},h._currentIdx=0,h._hasZoomableContent=!1,h._btnRotation=0,h._controlCount=0,h._checkControlCount=function(){var e=h,t=e._map;if(t){var a=t.controls.getControls().length;e._controlCount!==a&&(e._controlCount=a,e._adjustSize())}},h._mapZoomChanged=function(e){var t=h,a=t._content,o=t._baseOptions;if(a)if(t._hasZoomableContent){for(var n=t._map.getCamera().zoom,r=void 0,i=a.querySelectorAll(".atlas-layer-legend-card"),l=a.querySelectorAll(".atlas-carousel-dot, .atlas-accordion-button"),s=0;s<i.length;s++){var c=i[s],d=parseInt(c.getAttribute("rel")),u=parseInt(c.getAttribute("data-min-zoom")),p=parseInt(c.getAttribute("data-max-zoom")),m=c.getAttribute("data-zoom-behavior"),g=u<=n&&Math.ceil(n)<=p,f=g?"":"none";"hide"===m&&("carousel"===o.layout||"accordion"===o.layout?0<l.length&&(l[s].style.display=f):c.style.display=f),!g||void 0!==r&&d!==t._currentIdx||(r=d);var y=c.querySelectorAll("label, option");M.processZoomRangeAttr(y,n)}"hide"===o.zoomBehavior&&(o.visible&&!o.minimized&&(a.style.display=void 0===r?"none":""),t._currentIdx!==r&&t._setItemIndex(r,!0))}else o.visible&&!o.minimized&&(a.style.display="")},h._rebuildContainer=function(){var e=h,t=e._baseOptions,a=e._container;e._createContent(),e._setStyle(t.style);var o=e._content;if(t.visible||(a.style.display="none",o.style.display="none"),!t.container){e._btn&&e._btn.remove();var n={display:t.showToggle?"":"none",backgroundColor:e._bgColor},r=90,i=e._controlPosition;i&&"non-fixed"!==i||(i="top-left");var l=-1<i.indexOf("left");r=-1<i.indexOf("top")?(n.bottom="0",l?180:270):(n.top="0",l?90:0),l?n.right="0":n.left="0",n.transform="rotate("+r+"deg)",e._btnRotation=r,a.onclick=e._contentBtnClicked;var s=document.createElement("button");s.setAttribute("type","button"),s.classList.add("atlas-layer-legend-expand-btn"),Object.assign(s.style,n),s.addEventListener("click",e._toggle),a.appendChild(s);var c=e._localization[e._nameIdx]+" - "+e._localization[3];s.setAttribute("title",c),s.setAttribute("alt",c),e._btn=s,e._setBtnState()}e._mapZoomChanged(null),e._adjustSize()},h._mapStyleChanged=function(){h._setColorFromMapStyle(),h._rebuildOnStyleChange&&h._rebuildContainer()},h._handledClicked=function(e){var t=h,a=e.target,o=parseInt(a.getAttribute("rel"));"accordion"===t._baseOptions.layout&&a.classList.contains("active")&&(o=-1),t._setItemIndex(o,!0)},h._toggle=function(e){var t=h,a=t._baseOptions;return a.minimized=!a.minimized,t._setBtnState(),e.stopPropagation(),e.preventDefault(),!1},h._contentBtnClicked=function(e){h._baseOptions.minimized&&h._toggle(e)};var o=h;return o._nameIdx=e,o._cssClass=t,o._btnCSS=a,h}var c,p=(t(m,c=l),m.prototype.getOptions=function(){return Object.assign({},this._options)},m.prototype.setOptions=function(n){n=n||{};var r=this,i=r._options;Object.keys(n).forEach(function(e){var t=n[e];if(void 0!==t)switch(e){case"style":case"visible":case"container":case"layout":case"zoomBehavior":i[e]=t;break;case"legends":var a=0;null!==(i[e]=t)&&r._currentLegend&&-1!==(a=t.indexOf(r._currentLegend))||(r._currentLegend=null,a=0),r._legendIdx=a;var o=!1;t.forEach(function(e){e.minZoom=M.getNumber(e,"minZoom",0,0),e.maxZoom=M.getNumber(e,"maxZoom",0,24),0===e.minZoom&&24===e.maxZoom&&"dynamic"!==e.type||(o=!0)}),r._hasZoomableContent=o,t&&r.setLegendIdx(a),r._needsRebuild=!0;break;default:i[e]=t,r._needsRebuild=!0}}),c.prototype.setOptions.call(this,n)},m.prototype.setLegendIdx=function(e,t){this._setItemIndex(e,t)},m.prototype.add=function(e,t,a){var o=this,n=o._getLegendIdx(e);-1===n?(o._options.legends.push(e),focus&&(o._legendIdx=o._options.legends.length-1,o._currentLegend=e),e.minZoom=M.getNumber(e,"minZoom",0,0),e.maxZoom=M.getNumber(e,"maxZoom",0,24),0===e.minZoom&&24===e.maxZoom||(o._hasZoomableContent=!0),a||o._rebuildContainer()):t&&o.setLegendIdx(n)},m.prototype.focus=function(e){var t=this._getLegendIdx(e);-1!==t&&this.setLegendIdx(t)},m.prototype.remove=function(e,t){var a=this,o=a._getLegendIdx(e),n=a._options.legends;-1<o&&n.length>o&&(a._legendIdx===o&&(1<n.length?(a._legendIdx=o-1,a._currentLegend=n[o-1]):(a._legendIdx=-1,a._currentLegend=null)),n.splice(o,1),t||a._rebuildContainer())},m.prototype.onAdd=function(e,t){return e.events.add("styledata",this._styleDataChanged),c.prototype.onAdd.call(this,e,t)},m.prototype.onRemove=function(){this._map&&this._map.events.remove("styledata",this._styleDataChanged),c.prototype.onRemove.call(this)},m.prototype._replaceMany=function(e,t){var a=this;e&&e.forEach(function(e){a.remove(e,!0)});var o=a._currentLegend,n=a._legendIdx;t&&t.forEach(function(e){a.add(e,!1,!0)}),-1<n&&o&&(a._currentLegend=o,a._legendIdx=n),a._rebuildContainer()},m.prototype._setItemIndex=function(e,t){var a=this;if(a._content){a._setCardIdx(e,t),e=a._currentIdx;var o=a._options.legends,n=void 0!==e&&o.length>e?o[e]:null;a._currentLegend=n,a._invokeEvent("legendfocused",{legendIdx:e,legend:n,type:"legendfocused"})}},m.prototype._getLegendIdx=function(e){return this._options.legends.indexOf(e)},m.prototype._createContent=function(){var n=this,e=n._options,t=e.resx||{},a=e.layout,r={};n._layerOptCache=r;var i=[];e.legends.forEach(function(e){if("dynamic"===e.type){var t=e,a=f.parse(t,n);if(a&&0<a.length){i=i.concat(a),a.forEach(function(e){0===e.minZoom&&24===e.maxZoom||(n._hasZoomableContent=!0)});var o=M.getLayer(t.layer,n._map);o.getOptions&&(r[o.getId()]=f.serializeLayerOptions(o))}}else i.push(e)}),n._content&&n._content.remove();var o=document.createElement("div");if(o.className="atlas-legend-control",n._content=o,M.addStringDiv(o,e.title,"atlas-legend-title",t,!0),i&&0<i.length){for(var l=document.createElement("div"),s=!(l.className="atlas-carousel-dot-container"),c=0;c<i.length;c++){var d=i[c];if(d){var u=M.uuid(),p=document.createElement("div");p.classList.add("atlas-layer-legend-card"),p.id=u,p.setAttribute("rel",c+"");var m=void 0;switch(m="accordion"===e.layout?M.getString(d.subtitle,t):M.addStringDiv(p,d.subtitle,"atlas-legend-subtitle",t,!0),d.type){case"category":n._createCategoryLegend(p,d,t);break;case"image":n._createImageLegend(p,d,t);break;case"html":n._createHtmlLegend(p,d);break;case"gradient":s=!0,n._createGradientLegend(p,d,t)}M.addStringDiv(p,d.footer,"atlas-legend-footer",t,!1,!0),n._addCard(p,l,d,m)}}n._rebuildOnStyleChange=s,"carousel"===a&&(1<l.children.length&&(M.addClearDiv(o),o.appendChild(l)),n.setLegendIdx(n._legendIdx))}var g=M.getElement(e.container);g?g.appendChild(o):n._container&&n._container.appendChild(o)},m.prototype._createCategoryLegend=function(e,g,f){if(g.items){var y=document.createElement("div");y.classList.add("atlas-legend-category-legend"),g.cssClass&&y.classList.add(g.cssClass),g.layout&&(y.style.flexDirection=g.layout);var h=g.fitItems&&g.layout&&g.layout.startsWith("row")&&g.itemLayout&&g.itemLayout.startsWith("column"),v=0;if(g.items.forEach(function(e){var t=document.createElement("div");t.classList.add("atlas-legend-category-item"),t.style.flexDirection=g.itemLayout?g.itemLayout:"row";var a,o,n=e.color||g.color||"transparent",r=e.shape||g.shape||"circle",i=M.getNumber2(e,g,"strokeWidth",0,1),l=M.getNumber2(e,g,"shapeSize",1,20),s=l-2*i,c=.5*l;switch(r){case"line":var d=.5*l;a='<line x1="0" y1="'+d+'" x2="'+l+'" y2="'+d+'" stroke="'+n+'" stroke-width="'+i+'" />';break;case"square":a='<rect x="'+i+'" y="'+i+'" height="'+s+'" width="'+s+'" fill="'+n+'" stroke-width="'+i+'"/>';break;case"triangle":a='<polygon points="'+i+" "+s+", "+s+" "+s+", "+.5*(s+i)+" "+i+'" fill="'+n+'" stroke-width="'+i+'"/>';break;case"circle":a='<circle cx="'+c+'" cy="'+c+'" r="'+(c-i)+'" fill="'+n+'" stroke-width="'+i+'"/>';break;default:o=/<svg/i.test(r)&&!/^data:/i.test(r)?"data:image/svg+xml;base64,"+window.btoa(r):r}v=Math.max(v,l);var u=document.createElement("div");a?u.innerHTML='<svg class="atlas-legend-category-shape" style="width:'+l+'px;" viewBox="0 0 '+l+" "+l+'" xmlns="http://www.w3.org/2000/svg">'+a+"</svg>":o&&(u.innerHTML='<img class="atlas-legend-category-shape" style="width:'+l+'px;" src="'+o+'"/>'),e.cssClass&&t.classList.add(e.cssClass),g.collapse&&(t.style.padding="0px"),t.appendChild(u),h&&(Object.assign(u.style,{position:"relative"}),Object.assign(u.firstChild.style,{position:"absolute",top:0,bottom:0,left:0,right:0}));var p=M.getString(e.label,f,g.numberFormatLocales,g.numberFormat),m=document.createElement("span");m.innerHTML=p,m.setAttribute("aria-label",p),g.labelsOverlapShapes&&Object.assign(m.style,{position:"absolute",left:0,right:0,textAlign:"center",margin:"0 auto"}),t.appendChild(m),y.appendChild(t)}),g.fitItems){var t=y.getElementsByClassName("atlas-legend-category-item"),a=v+"px",o={};h?o.height=a:o.width=a;var n=h||g.layout&&g.layout.startsWith("row")&&g.itemLayout&&g.itemLayout.startsWith("row");Array.prototype.forEach.call(t,function(e){n&&(o.width=e.firstChild.firstChild.style.width),Object.assign(e.firstChild.style,o)})}e.appendChild(y)}},m.prototype._createImageLegend=function(e,t,a){if(t.url){var o=document.createElement("div");o.classList.add("atlas-legend-image-legend"),t.cssClass&&o.classList.add(t.cssClass);var n=document.createElement("img"),r=M.getString(t.altText||t.subtitle,a);""!==r&&(n.setAttribute("alt",r),n.setAttribute("title",r)),n.onerror=function(){console.log("Unable to load legend image: "+t.url),o.remove()};var i=t.maxHeight,l=t.maxWidth;i&&0<i&&(n.style.maxWidth=i+"px"),l&&0<l&&(n.style.maxWidth=l+"px");var s=t.url;/<svg/i.test(s)&&!/^data:/i.test(s)&&(s="data:image/svg+xml;base64,"+window.btoa(s)),n.src=s,o.appendChild(n),e.appendChild(o)}},m.prototype._createHtmlLegend=function(e,t){if(t.html){var a=document.createElement("div");t.cssClass&&a.classList.add(t.cssClass),"string"==typeof t.html?a.innerHTML=t.html:a.appendChild(t.html),e.appendChild(a)}},m.prototype._createGradientLegend=function(e,n,r){if(n.stops&&0<n.stops.length){var t=document.createElement("div");t.classList.add("atlas-legend-gradient-legend"),n.cssClass&&t.classList.add(n.cssClass);var a=this._fontColor,o=M.getNumber,i="vertical"===n.orientation,l=o(n,"fontSize",1,12),s=n.fontFamily||"'Segoe UI', Roboto, 'Helvetica Neue', Arial, 'Noto Sans', sans-serif";s=s.replace(/"/g,"'");var c=o(n,"barThickness",1,20),d=o(n,"barLength",1,200),u=o(n,"tickSize",0,5),p=[],m=[],g=[],f=void 0,y=void 0,h=void 0,v=void 0,b=void 0,_=void 0,x=void 0,C=void 0;if(n.stops.sort(function(e,t){return e.offset-t.offset}),i){b='x1="0%" y1="0%" x2="0%" y2="100%" gradientTransform="rotate(180,0.5,0.5)"',_="fill:"+a+";font-size:"+l+"px;font-family:"+s+';text-align:center;text-anchor:start;dominant-baseline:middle;"',C=d;var L=0,k=(x=c)+3,S=k+u,O=S+3;0<u&&m.push('<line x1="'+k+'" y1="0" x2="'+k+'" y2="'+d+'" />'),n.stops.forEach(function(e){var t=e.color||"black";p.push('<stop offset="'+100*e.offset+'%" stop-color="'+t+'" />');var a=M.getString(e.label,r,n.numberFormatLocales,n.numberFormat);if(a&&""!==a){var o=d*(1-e.offset);0===e.offset?--o:1===e.offset&&(o+=1),0<u&&m.push('<line x1="'+k+'" y1="'+o+'" x2="'+S+'" y2="'+o+'" />'),g.push('<text x="'+O+'" y="'+o+'">'+a+"</text>"),L=Math.max(M.measureText(a,l,s).width,L)}}),y=f=Math.ceil(O+L),v=(h=d)+l}else{b='x1="0%" y1="0%" x2="100%" y2="0%"',_="fill:"+a+";font-size:"+l+"px;font-family:"+s+";text-align:center;text-anchor:middle;dominant-baseline:hanging;",x=d;var E=0,w=(C=c)+3,I=w+u,Z=I+3;0<u&&m.push('<line x1="0" y1="'+w+'" x2="'+d+'" y2="'+w+'" />'),n.stops.forEach(function(e){var t=e.color||"black";p.push('<stop offset="'+100*e.offset+'%" stop-color="'+t+'" />');var a=M.getString(e.label,r,n.numberFormatLocales,n.numberFormat);if(a&&""!==a){var o=d*e.offset;1===e.offset?--o:0===e.offset&&(o+=1),0<u&&m.push('<line x1="'+o+'" y1="'+w+'" x2="'+o+'" y2="'+I+'" />'),g.push('<text x="'+o+'" y="'+Z+'">'+a+"</text>"),E=Math.max(M.measureText(a,l,s).width,E)}}),y=E+(f=d),v=h=Z+(0<g.length?1.33*l:0)}var A=M.uuid(),z='\n                <svg width="'+y+'" height="'+v+'" viewBox="0 0 '+f+" "+h+'" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">\n                    <defs>                    \n                        <pattern id="atlas-pattern-'+A+'" x="0" y="0" width="10" height="10" patternUnits="userSpaceOnUse">\n                            <rect x="0" y="0" width="10" height="10" fill="white"/>\n                            <rect x="0" y="0" width="5" height="5" fill="#ccc"/>\n                            <rect x="5" y="5" width="5" height="5" fill="#ccc"/>\n                        </pattern>\n\n                        <linearGradient id="atlas-gradient-'+A+'" '+b+">"+p.join("")+'</linearGradient>\n                    </defs>\n\n                    <rect x="0" y="0" width="'+x+'" height="'+C+'" fill="url(\'#atlas-pattern-'+A+'\')" />  \n                    <rect x="0" y="0" width="'+x+'" height="'+C+'" fill="url(\'#atlas-gradient-'+A+'\')" />\n\n                    <g style="stroke:'+a+';stroke-width:2;">'+m.join("")+'</g>\n\n                    <g style="'+_+'">'+g.join("")+"</g>\n                </svg>\n                ";t.innerHTML=z,e.appendChild(t)}},m);function m(e){var t=c.call(this,0,"atlas-legend-control-container","atlas-legend-btn")||this;return t._options={resx:{},layout:"carousel",style:"light",visible:!0,legends:[],zoomBehavior:"hide",showToggle:!0,minimized:!1},t._legendIdx=0,t._currentLegend=null,t._layerOptCache={},t._styleDataChanged=function(){var e=t,a=e._layerOptCache,o=e._map,n=!1;Object.keys(a).forEach(function(e){var t=o.layers.getLayerById(e);a[e]!==f.serializeLayerOptions(t)&&(n=!0)}),n&&e._rebuildContainer()},t.setOptions(e),t}var g,y=(t(h,g=l),h.prototype.getOptions=function(){return this._options},h.prototype.setOptions=function(a){a=a||{};var o=this,n=o._options;Object.keys(a).forEach(function(e){var t=a[e];if(void 0!==t)switch(e){case"style":case"visible":case"container":case"layout":case"zoomBehavior":n[e]=t;break;default:n[e]=t,o._needsRebuild=!0}}),g.prototype.setOptions.call(this,a)},h.prototype.onAdd=function(e,t){return e.events.add("layeradded",this._layerChanged),e.events.add("layerremoved",this._layerChanged),g.prototype.onAdd.call(this,e,t)},h.prototype.onRemove=function(){var e=this._map;return e&&(e.events.remove("layeradded",this._layerChanged),e.events.remove("layerremoved",this._layerChanged)),g.prototype.onRemove.call(this)},h.prototype.refresh=function(){this._rebuildContainer()},h.prototype._setItemIndex=function(e,t){this._setCardIdx(e,t)},h.prototype._createContent=function(){var d=this,u=d._options,p=u.resx||{},m=u.layout,g=!1,f=u.layerGroups?u.layerGroups.map(function(e){return e}):[],e=u.dynamicLayerGroup;if(e){var t=d._getLayerGroup(e);if(t){g=!0;var a=e.layerGroupIdx;if(("number"!=typeof a||a<0||a>f.length)&&(a=0),f.splice(a,0,t),u.legendControl){var o=[];t.items.forEach(function(e){e.layers&&e.layers.forEach(function(e){o.push({type:"dynamic",layer:e})})}),u.legendControl._replaceMany(d._dynamicLegends,o),d._dynamicLegends=o}}}d._content&&d._content.remove();var n=document.createElement("div");if(n.className="atlas-layer-control",d._content=n,M.addStringDiv(n,u.title,"atlas-layer-title",p,!0),f&&0<f.length){var y=document.createElement("div");y.className="atlas-carousel-dot-container";for(var r=function(e){var t=M.uuid(),o=f[e],a=M.getZoomRange(d._getAllAzLayers(null,o));o.minZoom=M.getNumber2(o,a,"minZoom",0,0),o.maxZoom=M.getNumber2(o,a,"maxZoom",0,24),0===o.minZoom&&24===o.maxZoom||(g=!0),o.items&&o.items.forEach(function(e){var t=d._getAllAzLayers(e,o);d._inflateLayerStateStyles(e,t);var a=M.getZoomRange(t);e.minZoom=Math.max(M.getNumber2(e,a,"minZoom",0,0),o.minZoom),e.maxZoom=Math.min(M.getNumber2(e,a,"maxZoom",0,24),o.maxZoom),0!==e.minZoom&&24!==e.maxZoom&&(g=!0)});var n=document.createElement("div");n.classList.add("atlas-layer-legend-card"),n.id=t,o.cssClass&&n.classList.add(o.cssClass),n.setAttribute("rel",e+"");var r=void 0;if(r="accordion"===m?M.getString(o.groupTitle,p):M.addStringDiv(n,o.groupTitle,"atlas-layer-group-title",p,!0),o.legends&&u.legendControl)for(var i=0;i<o.legends.length;i++){var l=o.legends[i];l.minZoom=M.getNumber2(l,o,"minZoom",0,0),l.maxZoom=M.getNumber2(l,o,"maxZoom",0,24),u.legendControl.add(l,0===i)}var s=o.layout||"checkbox",c=void 0;switch(s){case"dropdown":c=d._createDropdown(o,r);break;case"checkbox":case"radio":c=d._createChoiceGroup(s,o);break;case"range":c=d._createRange(o)}c&&n.appendChild(c),d._addCard(n,y,o,r)},i=0;i<f.length;i++)r(i);d._hasZoomableContent=g,"carousel"===m&&(1<y.children.length&&(M.addClearDiv(n),n.appendChild(y)),d._setCardIdx(0))}var l=M.getElement(u.container);l?l.appendChild(n):d._container&&d._container.appendChild(n)},h.prototype._bindLayerState=function(e,t,a,o){var n=this,r=n._getAllAzLayers(e,t),i=n._itemChanged.bind(n,e,r,t,a,!0);a instanceof HTMLOptionElement?a.parentElement.addEventListener("change",i):(a.onchange=i,o&&(a.oninput=i)),n._itemChanged(e,r,t,a,!1)},h.prototype._createDropdown=function(a,e){var o=this,n=document.createElement("select");return n.className="atlas-layer-dropdown",n.title=e,a.items&&(n.name=M.uuid(),a.items.forEach(function(e){var t=document.createElement("option");e.label&&(t.innerHTML=M.getString(e.label,o._options.resx)),e.enabled&&(t.selected=!0),M.setZoomRangeAttr(e,o._baseOptions,t),n.appendChild(t),o._bindLayerState(e,a,t)})),n},h.prototype._createChoiceGroup=function(n,r){var i=this,l=document.createElement("div");if(r.items){var e=r.items,s=M.uuid();e.forEach(function(e){var t=document.createElement("label");t.className="atlas-layer-"+n;var a=document.createElement("input");"radio"===(a.type=n)&&(a.name=s),a.checked=e.enabled,t.appendChild(a);var o=document.createElement("span");o.innerHTML=M.getString(e.label,i._options.resx),t.appendChild(o),i._bindLayerState(e,r,a),M.setZoomRangeAttr(e,i._baseOptions,t),l.appendChild(t)})}return l},h.prototype._createRange=function(d){var u=this,p=document.createElement("div");if(d.items){var e=d.items,m=M.getNumber,g=M.measureText,f="{rangeValue}";e.forEach(function(e){var t=document.createElement("label");t.className="atlas-layer-range";var a=document.createElement("input");a.type="range";var o=m(e,"min",0,0),n=m(e,"max",0,1),r=m(e,"step",0,.1),i=m(e,"value",0,1);a.setAttribute("min",o+""),a.setAttribute("max",n+""),a.setAttribute("step",r+""),a.value=i+"",t.appendChild(a);var l=document.createElement("span"),s=e.label?M.getString(e.label,u._options.resx):f,c=new Intl.NumberFormat(void 0,e.numberFormat||{});l.innerHTML=s.replace(f,c.format(i)),l.style.minWidth=Math.max(g(s.replace(f,c.format(i)),12,"Arial").width,g(s.replace(f,c.format(o)),12,"Arial").width,g(s.replace(f,c.format(n)),12,"Arial").width,g(s.replace(f,c.format(n-r)),12,"Arial").width)+"px",t.appendChild(l),M.setZoomRangeAttr(e,u._baseOptions,t),u._bindLayerState(e,d,a,e.updateOnInput),p.appendChild(t)})}return p},h.prototype._updateStateCache=function(e,t,a){var o=this,n=o._options.legendControl;if(a instanceof HTMLInputElement&&"radio"===a.type||a instanceof HTMLSelectElement){var r=e,i=o._stateCache[a.name];if(i&&i!==e){i.enabled=!r.enabled;var l=i.enabled?i.enabledStyle:i.disabledStyle;if(l&&i.layers&&i.layers.forEach(function(e){return o._setLayerStyle(e,l)}),n&&i.legends&&i.legends.forEach(function(e){n.remove(e)}),r.enabled)return o._stateCache[a.name]=r,i}else!i&&r.enabled&&(o._stateCache[a.name]=r)}return null},h.prototype._inflateLayerStateStyles=function(e,t){e.enabledStyle&&this._inflateStyle(e.enabledStyle,t),e.disabledStyle&&this._inflateStyle(e.disabledStyle,t),e.style&&this._inflateStyle(e.style,t)},h.prototype._inflateStyle=function(t,e){if(t){var a={},o=Object.keys(t),n=!1,r=!1;e.forEach(function(e){e instanceof _.layer.BubbleLayer?n=!0:e instanceof _.layer.LineLayer&&(r=!0)}),o.forEach(function(e){switch(e){case"color":t.fillColor||(a.fillColor=t.color);break;case"fillColor":t.color||(a.color=t.fillColor),!r||n||t.strokeColor||(a.strokeColor=t.fillColor);break;case"opacity":t.fillOpacity||(a.fillOpacity=t.opacity);break;case"fillOpacity":t.opacity||(a.opacity=t.fillOpacity),!r||n||t.strokeOpacity||(a.strokeOpacity=t.strokeOpacity)}}),Object.assign(t,a)}},h.prototype._setLayerStyle=function(e,t){if(e&&(e=M.getLayer(e,this._map)).setOptions){var a=t;e instanceof _.layer.LineLayer&&(!t.strokeColor&&t.color&&(a=Object.assign({strokeColor:t.color},a)),!t.strokeOpacity&&t.opacity&&(a=Object.assign({strokeOpacity:t.opacity},a))),e.setOptions(a)}},h.prototype._getAllAzLayers=function(e,t){var a=this._map,o=[];return a&&(t&&t.layers&&t.layers.forEach(function(e){var t=M.getLayer(e,a);t&&o.push(t)}),e?e.layers&&e.layers.forEach(function(e){var t=M.getLayer(e,a);-1===o.indexOf(t)&&o.push(t)}):t.items.forEach(function(e){e.layers&&e.layers.forEach(function(e){var t=M.getLayer(e,a);-1===o.indexOf(t)&&o.push(t)})})),o},h.prototype._getLayerGroup=function(e){if(e.layout){var g=this,f={cssClass:e.cssClass,groupTitle:e.groupTitle,legends:e.legends,items:[],layout:e.layout||"checkbox"},t=M.getMapLayers(g._map,e.layerFilter),y=e.labelProperty;if(t&&0<t.length){var h=!1;return t.forEach(function(e){var t=e.getOptions?e.getOptions():{},a=t.visible;void 0===a&&(a=!0),"dropdown"!==f.layout&&"radio"!==f.layout||(h?(a=!1,e.setOptions&&e.setOptions({visible:!1})):a&&(h=!0));var o=M.getString(y&&e.metadata&&e.metadata[y]&&""!==e.metadata[y]?e.metadata[y]:e.getId(),g._options.resx),n=_.layer.OgcMapLayer,r=_.layer.SimpleDataLayer;if(e.getId()===o&&-1<o.indexOf("-"))if(n&&e instanceof n){var i=e,l=i._client;if(l&&l._capabilities){var s=l._capabilities;if(s.title&&""!==s.title&&"wms"===s.title.toLowerCase())o=s.title;else{var c=i.getOptions().activeLayers,d=s.sublayers;if(1===c.length&&d)for(var u=c[0],p=0;p<d.length;p++)if("string"==typeof u&&u===d[p].id||u.id===d[p].id){var m=u.styles;m&&0<m.length&&m[0].legendUrl&&""!==m[0].legendUrl&&(o=u.title||u.subtitle||d[p].id||"")}}}else i.getCapabilities().then(function(e){e&&g._rebuildContainer()})}else r&&e instanceof r&&e.metadata&&(o=e.metadata.title||e.metadata.name||"");f.items.push({layers:[e],label:o,enabled:a,enabledStyle:{visible:!0},disabledStyle:{visible:!1},minZoom:M.getNumber(t,"minZoom",0,0),maxZoom:M.getNumber(t,"maxZoom",0,24)})}),h||"dropdown"!==f.layout&&"radio"!==f.layout||(f.items[0].enabled=!0,t[0].setOptions&&t[0].setOptions({visible:!0})),f}}},h);function h(e){var v=g.call(this,1,"atlas-layer-control-container","atlas-layer-btn")||this;return v._options={resx:{},layout:"list",style:"light",visible:!0,zoomBehavior:"disable",showToggle:!0,minimized:!1},v._stateCache={},v._layerChanged=function(e){v._rebuildContainer()},v._itemChanged=function(e,t,a,o,n){if(t){var r=v,i=r._options.legendControl;if(o instanceof HTMLInputElement&&"range"===o.type){var l=e,s=parseFloat(o.value),c=l.style;if(c){var d=(e.label?M.getString(e.label,r._options.resx):"{rangeValue}").replace("{rangeValue}",new Intl.NumberFormat(void 0,l.numberFormat||{}).format(s));o.parentElement.children[1].innerHTML=d;var u=M.replacePlaceholder(c,"{rangeValue}",s,!0);t.forEach(function(e){return r._setLayerStyle(e,u)})}l.value=s}else{var p=void 0!==o.checked?o.checked:o.selected;void 0===p&&(p=!1),o instanceof HTMLOptionElement&&(p=o.parentElement.selectedOptions[0]===o);l=e;var m=p?l.enabledStyle:l.disabledStyle||{};if(m&&t.forEach(function(e){return r._setLayerStyle(e,m)}),l.legends&&i)for(var g=0;g<l.legends.length;g++){var f=l.legends[g];p?(f.minZoom=M.getNumber2(f,l,"minZoom",0,0),f.maxZoom=M.getNumber2(f,l,"maxZoom",0,24),i.add(f,0===g&&n)):i.remove(f)}l.enabled=p;var y=r._options.legendControl;"boolean"==typeof m.visible&&y&&y._rebuildContainer()}var h=r._updateStateCache(e,t,o instanceof HTMLOptionElement?o.parentElement:o);r._invokeEvent("statechanged",{type:"statechanged",layerGroup:a,oldState:h,newState:e})}},v.setOptions(Object.assign({},v._options,e)),v}var v=Object.freeze({__proto__:null,LegendControl:p,LayerControl:y}),b=a.merge("atlas.control",v);e.control=b}(this.atlas=this.atlas||{},atlas);
