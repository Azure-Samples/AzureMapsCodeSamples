/* MIT License - Copyright (c) Microsoft Corporation. */


!function(e,x){"use strict";var r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)};var a=function(){return(a=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},t=(n.merge=function(e,t){for(var r=window||global,n=0,o=e.split(".");n<o.length;n++){var i=o[n];if(!r[i])return t;r=r[i]}return a(a({},r),t)},n);function n(){}var b=(o.parse=function(e){if(!Array.isArray(e))return new h.literal(e);if(0<e.length){var t=h[e[0]];if(t)return t.parse(e)}throw"Invalid expression"},o);function o(){}var i=(s.parse=function(e){if(3<=e.length)return new s(e[0],b.parse(e[1]),b.parse(e[2]));throw"Invalid '"+e[1]+"' expression."},s.prototype.eval=function(e){var t=this,r=t._e1.eval(e),n=t._e2.eval(e);switch(t._c){case"<":return r<n;case"<=":return r<=n;case"==":return r==n;case"!=":return r!=n;case">":return n<r;case">=":return n<=r;case">":return n<r}throw"Invalid comparison"},s);function s(e,t,r){var n=this;n._c=e,n._e1=t,n._e2=r}var l=(c.parse=function(e){if(3<=e.length){for(var t=[],r=1,n=e.length;r<n;r++)Array.isArray(e[1])?t.push(b.parse(e[r])):t.push(e[r]);return new c(e[0],t)}throw"Invalid '"+e[0]+"' expression."},c.prototype.eval=function(e){var t=this,r=Math,n=1<=t._e.length?t._getValue(e,t._e[0]):0,o=2<=t._e.length?t._getValue(e,t._e[1]):0;switch(t._o){case"+":case"*":case"min":case"max":t._evalArray(e);break;case"-":return o-n;case"/":return n/o;case"%":return n%o;case"^":return r.pow(n,o);case"abs":return r.abs(n);case"acos":return r.acos(n);case"asin":return r.asin(n);case"atan":return r.atan(n);case"ceil":return r.ceil(n);case"cos":return r.cos(n);case"e":return r.exp(n);case"floor":return r.floor(n);case"ln":return r.log(n);case"ln2":return r.LN2;case"log10":return r.log(n)/r.LN10;case"log2":return r.log(n)/r.LN2;case"pi":return r.PI;case"round":return r.round(n);case"sin":return r.sin(n);case"sqrt":return r.sqrt(n);case"tan":return r.tan(n)}throw"Invalid '"+t._o+"' expression."},c.prototype._evalArray=function(r){var e,n=this,t=0;switch(n._o){case"+":e=function(e,t){return e+n._getValue(r,t)};break;case"*":t=1,e=function(e,t){return e*n._getValue(r,t)};break;case"max":t=n._getValue(r,n._e[0]),e=function(e,t){return Math.max(e,n._getValue(r,t))};break;case"min":t=n._getValue(r,n._e[0]),e=function(e,t){return Math.min(e,n._getValue(r,t))}}return n._e.reduce(e,t)},c.prototype._getValue=function(e,t){return"number"==typeof t?t:t.eval(e)},c);function c(e,t){this._o=e,this._e=t}var u=(p.parse=function(e){if(3<=e.length)return new p(e[0],b.parse(e[2]),e[1]);if(2===e.length)return new p(e[0],b.parse(e[1]));throw"Invalid 'CellAggregateExpression'."},p.prototype.eval=function(e){return this._e.eval(e)},p.prototype.finalize=function(e,t){if(e.aggregateProperties){var r=e.aggregateProperties[t],n=this._i;if(void 0!==n)switch(this._o){case"max":r=Math.max(n,r);break;case"min":r=Math.min(n,r);break;case"+":r=n+r;break;case"*":r*=n;break;case"all":r=n&&r;break;case"any":r=n||r}e.aggregateProperties[t]=r}},p);function p(e,t,r){this._o=e,this._e=t,this._i=r}var h={get:(S.parse=function(e){var t=3<=e.length?b.parse(e[2]):void 0;if(2<=e.length)return new S(e[1],t);throw"Invalid 'get' expression."},S.prototype.eval=function(e){var t=e;return this._e&&(t=this._e.eval(e)),t[this._n]},S),has:(A.parse=function(e){var t=3<=e.length?b.parse(e[2]):void 0;if(2<=e.length)return new A(e[1],t);throw"Invalid 'has' expression."},A.prototype.eval=function(e){var t=e;return this._e&&(t=this._e.eval(e)[this._n]),-1<Object.keys(t).indexOf(this._n)},A),literal:(T.parse=function(e){if(2<=e.length)return new T(e[1]);throw"Invalid 'literal' expression."},T.prototype.eval=function(e){return this._v},T),at:(z.parse=function(e){if(3<=e.length)return new z(e[1],b.parse(e[2]));throw"Invalid 'at' expression."},z.prototype.eval=function(e){return this._e.eval(e)[this._i]},z),"index-of":(O.parse=function(e){var t=0;if(4<=e.length&&(t=e[3]),3<=e.length)return new O(e[1],b.parse(e[2]),t);throw"Invalid 'index-of' expression."},O.prototype.eval=function(e){return this._e.eval(e).indexOf(this._v,this._i)},O),length:(k.parse=function(e){if(3<=e.length)return new k(b.parse(e[1]));throw"Invalid 'length' expression."},k.prototype.eval=function(e){return this._e.eval(e).length},k),slice:(I.parse=function(e){var t;if(4<=e.length&&(t=e[3]),3<=e.length)return new I(b.parse(e[1]),e[2],t);throw"Invalid 'index-of' expression."},I.prototype.eval=function(e){return this._v.eval(e).slice(this._s,this._e)},I),"!":(M.parse=function(e){if(2<=e.length)return new M(b.parse(e[1]));throw"Invalid '!' expression."},M.prototype.eval=function(e){return!this._e.eval(e)},M),"!=":i,"<":i,"<=":i,"==":i,">":i,">=":i,"to-boolean":(P.parse=function(e){if(2<=e.length)return new P(b.parse(e[1]));throw"Invalid 'to-boolean' expression."},P.prototype.eval=function(e){var t=this._e.eval(e);return"boolean"==typeof t?t:"string"==typeof t?-1<["true","yes","on","1"].indexOf(t.toLowerCase()):"number"==typeof t&&1===t},P),"to-number":(C.parse=function(e){if(2<=e.length)return new C(b.parse(e[1]));throw"Invalid 'to-number' expression."},C.prototype.eval=function(e){var t=this._e.eval(e);return"boolean"==typeof t?t?1:0:"string"==typeof t?Number.parseFloat(t):"number"==typeof t?t:Number.NaN},C),"to-string":(w.parse=function(e){if(2<=e.length)return new w(b.parse(e[1]));throw"Invalid 'to-number' expression."},w.prototype.eval=function(e){var t=this._e.eval(e);return t.toString?t.toString():Number.NaN},w),typeof:(m.parse=function(e){if(2<=e.length)return new m(b.parse(e[1]));throw"Invalid 'typeOf' expression."},m.prototype.eval=function(e){return typeof this._e.eval(e)},m),case:(y.parse=function(e){if(3<=e.length&&e.length%2==0){for(var t=[],r=[],n=1,o=e.length;n<o;n+=2)t.push(b.parse(e[n])),r.push(e[n+1]);return new y(t,r,e[e.length-1])}throw"Invalid 'case' expression."},y.prototype.eval=function(e){for(var t=0,r=this._e.length;t<r;t++)if(this._e[t].eval(e))return this._o[t];return this._f},y),match:(v.parse=function(e){if(5<=e.length&&e.length%2==1){for(var t=b.parse(e[1]),r=[],n=[],o=2,i=e.length;o<i;o+=2)r.push(e[o]),n.push(e[o+1]);return new v(t,r,n,e[e.length-1])}throw"Invalid 'match' expression."},v.prototype.eval=function(e){for(var t=this,r=t._i.eval(e),n=0,o=t._l.length;n<o;n++)if(t._l[n]===r)return t._o[n];return t._f},v),step:(d.parse=function(e){if(5<=e.length&&e.length%2==1){var t=b.parse(e[1]),r=[],n=[];n.push(e[2]);for(var o=3,i=e.length;o<i;o+=2)r.push(e[o]),n.push(e[o+1]);return new d(t,r,n)}throw"Invalid 'step' expression."},d.prototype.eval=function(e){for(var t=this,r=t._i.eval(e),n=0,o=t._l.length;n<o;n++)if(r<=t._l[n])return t._o[n];return t._o[t._o.length-1]},d),in:(_.parse=function(e){if(3<=e.length)return new _(e[1],b.parse(e[2]));throw"Invalid 'at' expression."},_.prototype.eval=function(e){return-1<this._e.eval(e).indexOf(this._i)},_),all:(g.parse=function(e){if(3<=e.length&&e.length%2==0){for(var t=[],r=1,n=e.length;r<n;r++)t.push(b.parse(e[r]));return new g(t)}throw"Invalid 'all' expression."},g.prototype.eval=function(t){var r=!0;return this._e.forEach(function(e){r=r&&e.eval(t)}),r},g),any:(f.parse=function(e){if(3<=e.length&&e.length%2==0){for(var t=[],r=1,n=e.length;r<n;r++)t.push(b.parse(e[r]));return new f(t)}throw"Invalid 'any' expression."},f.prototype.eval=function(t){var r=!1;return this._e.forEach(function(e){r=r||e.eval(t)}),r},f),"+":l,"*":l,min:l,max:l,"-":l,"/":l,"%":l,"^":l,abs:l,acos:l,asin:l,atan:l,ceil:l,cos:l,e:l,floor:l,ln:l,ln2:l,log10:l,log2:l,pi:l,round:l,sin:l,sqrt:l,tan:l};function f(e){this._e=e}function g(e){this._e=e}function _(e,t){this._i=e,this._e=t}function d(e,t,r){this._i=e,this._l=t,this._o=r}function v(e,t,r,n){this._i=e,this._l=t,this._o=r,this._f=n}function y(e,t,r){this._e=e,this._o=t,this._f=r}function m(e){this._e=e}function w(e){this._e=e}function C(e){this._e=e}function P(e){this._e=e}function M(e){this._e=e}function I(e,t,r){this._v=e,this._s=t,this._e=r}function k(e){this._e=e}function O(e,t,r){this._v=e,this._e=t,this._i=r}function z(e,t){this._i=e,this._e=t}function T(e){this._v=e}function A(e,t){this._n=e,this._e=t}function S(e,t){this._n=e,this._e=t}var L=(E.calculateGrid=function(e,t,r){var n=this;r=Object.assign({gridType:"hexagon",cellWidth:25e3,distanceUnits:"meters",coverage:1,minCellWidth:0,scaleExpression:n.LinearPointCountScaleExpression},r||{}),e=e||[];var o,i=n._getGroundResolutionZ22(r.centerLatitude),a=x.math.convertDistance(r.cellWidth,r.distanceUnits,"meters")/i,s=x.math.convertDistance(Math.min(r.minCellWidth,r.cellWidth),r.distanceUnits,"meters")/i,l=r.aggregateProperties&&0<Object.keys(r.aggregateProperties).length,c=l?n._parseMapExpressions(r.aggregateProperties):{},u=b.parse(r.scaleExpression||n.LinearPointCountScaleExpression),p=n._getArcAngles(r.gridType),h=Math.sqrt(3);switch(r.gridType){case"pointyHexagon":o=2*a/h;break;case"hexagon":case"hexCircle":o=h*a*.5;break;case"triangle":o=.5*h*a;break;default:o=a}for(var f={cells:[],cellLookupTable:{},pointLookupTable:{},width:a,height:o},g={col:0,row:0,z:0},_=0,d=e.length;_<d;_++){var v=t[_];n._getCellCoord(v,a,o,r.gridType,g,h);var y="x"+g.col+"y"+g.row+"z"+g.z,m=n._getGridCell(y,g,_,f,a,o,r.gridType,l);n._incrementCellInfo(m.properties,e[_],r.aggregateProperties,c)}return n._finalizeGrid(f,a,o,r,c,u,s,p),f},E.recalculateCoords=function(e,t){for(var r=b.parse(t.scaleExpression||this.LinearPointCountScaleExpression),n=x.math.convertDistance(Math.min(t.minCellWidth,t.cellWidth),t.distanceUnits,"meters")/this._getGroundResolutionZ22(t.centerLatitude),o=0,i=e.cells.length;o<i;o++)e.cells[o].geometry.coordinates=this.createGridPolygon(e.cells[o].properties,t,e.width,e.height,this._getArcAngles(t.gridType),n,r,e.scaleMetrics)},E.toPixel22=function(e){var t=Math.sin(e[1]*this.PI_By_180),r=this.MapSize22;return[(e[0]+180)/360*r,(.5-Math.log((1+t)/(1-t))/(4*Math.PI))*r]},E._getCellCoord=function(e,t,r,n,o,i){switch(n){case"pointyHexagon":this._rotatedHexCellCoord(e,t,r,o,i);break;case"hexagon":case"hexCircle":this._hexCellCoord(e,t,r,o,i);break;case"triangle":this._triangleCellCoord(e,t,r,o,i);break;default:o.col=Math.floor(e[0]/t),o.row=Math.floor(e[1]/r)}},E._getGroundResolutionZ22=function(e){return 2*Math.cos(e*this.PI_By_180)*Math.PI*6378137/this.MapSize22},E._getGridCell=function(e,t,r,n,o,i,a,s){var l=n.cellLookupTable[e];if(void 0!==l)return n.pointLookupTable[e].push(r),n.cells[l];var c=this._createCellFromCubeCoord(e,t,a,o,i,s);return n.pointLookupTable[e]=[r],n.cells.push(c),n.cellLookupTable[e]=n.cells.length-1,c},E._hexCellCoord=function(e,t,r,n,o){n.col=4*e[0]/(3*t),n.z=(e[1]-e[0]/o)/r,n.row=-n.col-n.z,E._roundCubeCoord(n)},E._rotatedHexCellCoord=function(e,t,r,n,o){return n.col=(e[0]-e[1]/o)/t,n.z=4*e[1]/(3*r),n.row=-n.col-n.z,E._roundCubeCoord(n)},E._roundCubeCoord=function(e){var t=Math.round,r=Math.abs,n=t(e.col),o=t(e.row),i=t(e.z),a=r(n-e.col),s=r(o-e.row),l=r(i-e.z);s<a&&l<a?n=-o-i:l<s?o=-n-i:i=-n-o,e.col=n,e.row=o,e.z=i},E._triangleCellCoord=function(e,t,r,n,o){n.row=Math.floor(e[1]/r),n.col=Math.floor(e[0]/t);var i=(n.row+1)*r-e[1],a=e[0]-n.col*t;n.row%2==1&&(i=r-i),1<i&&(a<.5*t?a/i<1/o&&(n.col-=.5):(t-a)/i<1/o&&(n.col+=.5))},E._createCellFromCubeCoord=function(e,t,r,n,o,i){var a,s,l;switch(r){case"pointyHexagon":a=n*(t.col+.5*t.z),s=.75*o*t.z;break;case"hexagon":case"hexCircle":a=.75*n*t.col,s=o*(t.z+.5*t.col);break;case"triangle":s=Math.floor(t.row*o),a=Math.floor((t.col+.5)*n);var c=Math.abs(t.col-Math.round(t.col))<.1;l=Math.round(t.row)%2==0?c:!c;break;default:a=(t.col+.5)*n,s=(t.row+.5)*o}return this._createCell(e,a,s,l,i)},E._getArcAngles=function(e){var t=E,r=t._calculateArcAngles,n=t._arcAngles[e];if(!n){switch(e){case"circle":case"hexCircle":n=r(36);break;case"pointyHexagon":n=r(6);break;case"hexagon":n=r(6,30)}t._arcAngles[e]=n}return n},E._calculateArcAngles=function(e,t){t=t||0;for(var r,n=360/e,o=[],i=[],a=0;a<e;a++)r=(a*n+t)*E.PI_By_180,o.push(Math.sin(r)),i.push(Math.cos(r));return{sin:o,cos:i}},E._toPosition22=function(e){var t=E.MapSize22,r=Math;return[360*(e[0]/t-.5),90-360*r.atan(r.exp((e[1]/t-.5)*r.PI*2))/r.PI]},E._parseMapExpressions=function(r){var e,n={};return r&&Object.keys(r).forEach(function(t){if((e=r[t])&&2<=e.length)try{n[t]=u.parse(e)}catch(e){r[t]=void 0}else r[t]=void 0}),n},E._incrementCellInfo=function(n,o,i,a){if(n.point_count++,i){var s,l,c=n.point_count,u=n.aggregateProperties||{};Object.keys(i).forEach(function(e){var t=i[e],r=a[e];if(r){if(l=r.eval(o.properties),null!==(s=1===c?Array.isArray(t[1])?null:t[1]:u[e]))switch(t[0]){case"max":l=l<s?s:l;break;case"min":l=s<l?s:l;break;case"+":l=s+l;break;case"*":l*=s;break;case"all":l=s&&l;break;case"any":l=s||l}null!==l&&(u[e]=l)}n.aggregateProperties=u})}},E._finalizeCellInfo=function(t,r,e,n){var o=t.point_count,i=o.toString();1e6<=o?i=Math.round(o/1e6)+"M":1e3<=o&&(i=Math.round(o/1e3)+"k"),t.point_count_abbreviated=i;var a=o;r&&(Object.keys(r).forEach(function(e){r[e].finalize(t,e)}),n&&void 0!==t.aggregateProperties[n]&&(a=t.aggregateProperties[n])),e&&(void 0===e.min?(e.min=a,e.max=a):(e.min=Math.min(e.min,a),e.max=Math.max(e.max,a)))},E._createCell=function(e,t,r,n,o){return{type:"Feature",properties:{cell_id:e,aggregateProperties:o?{}:void 0,_x:t,_y:r,_rightSideUp:n,point_count:0,point_count_abbreviated:"0"},geometry:{type:"Polygon",coordinates:[]}}},E.createGridPolygon=function(e,t,r,n,o,i,a,s){var l=E,c=t.coverage||1;if(t.scaleProperty&&s){var u=a.eval(Object.assign({min:s.min,max:s.max},e));isNaN(u)||"number"!=typeof u||(c*=u)}var p=l._getRegularPolygon;switch(t.gridType){case"square":return l._getSquare(e,r,c,i);case"hexCircle":return p(e,l.InnerRadiusScale*r*.5*c,o,i);case"triangle":return l._getTriangle(e,r,n,c,i);case"pointyHexagon":return p(e,.5*n*c,o,i);default:return p(e,.5*r*c,o,i)}},E._getRegularPolygon=function(r,n,o,e){var i,a,s=E,l=[],c=s.MapSize22;return 2*n<e&&(n=.5*e),o.sin.forEach(function(e,t){i=Math.min(Math.max(r._x+n*e,0),c),a=r._y+n*o.cos[t],l.push(s._toPosition22([i,a]))}),l.push(l[0]),[l]},E._getSquare=function(e,t,r,n){var o=.5*Math.max(t*r,n),i=e._y-o,a=e._y+o,s=Math.max(e._x-o,0),l=Math.min(e._x+o,this.MapSize22),c=this._toPosition22,u=[c([s,i]),c([s,a]),c([l,a]),c([l,i])];return u.push(u[0]),[u]},E._getTriangle=function(e,t,r,n,o){var i,a=e._x,s=e._y+.5*(r-r*n);r*=n,(t*=n)<o&&(r*=o/t);var l=.5*t,c=this.MapSize22,u=a,p=a+l,h=a-l,f=Math.max,g=Math.min;h<0?(u=f(u,0),p=f(p,0),h=f(h,0)):c<p&&(u=g(u,c),p=g(p,c),h=g(h,c));var _=this._toPosition22;return(i=e._rightSideUp?[_([u,s]),_([p,r+s]),_([h,r+s])]:[_([u,r+s]),_([p,s]),_([h,s])]).push(i[0]),[i]},E._finalizeGrid=function(e,t,r,n,o,i,a,s){var l={},c=e.cells.length;if(n.scaleProperty){for(var u=0;u<c;u++)this._finalizeCellInfo(e.cells[u].properties,o,l,n.scaleProperty);for(u=0;u<c;u++)e.cells[u].geometry.coordinates=this.createGridPolygon(e.cells[u].properties,n,t,r,s,a,i,l)}else for(u=0;u<c;u++)this._finalizeCellInfo(e.cells[u].properties,o,l,n.scaleProperty),e.cells[u].geometry.coordinates=this.createGridPolygon(e.cells[u].properties,n,t,r,s,a,i,l);e.scaleMetrics=l},E.PI_By_180=Math.PI/180,E.MapSize22=512*Math.pow(2,22),E.InnerRadiusScale=Math.cos(30*Math.PI/180),E.LinearPointCountScaleExpression=["/",["-",["get","point_count"],["get","min"]],["-",["get","max"],["get","min"]]],E._arcAngles={},E);function E(){}var W,G,j,N=(W=x.source.DataSource,r(G=q,j=W),G.prototype=null===j?Object.create(j):(U.prototype=j.prototype,new U),q.prototype.add=function(e){this._addPoints(e),this._recalculate()},q.prototype.clear=function(){this._points=[],this._pixels=[],W.prototype.clear.call(this)},q.prototype.dispose=function(){var t=this;this.clear(),W.prototype.dispose.call(this),Object.keys(this).forEach(function(e){return t[e]=null})},q.prototype.getCellChildren=function(e){var t=this._gridInfo.pointLookupTable[e],r=[];if(t)for(var n=0,o=t.length;n<o;n++)r.push(this._points[t[n]]);return JSON.parse(JSON.stringify(r))},q.prototype.getGridCells=function(){return W.prototype.toJson.call(this)},q.prototype.getOptions=function(){return Object.assign({},this._options)},q.prototype.getPoints=function(){return new x.data.FeatureCollection(JSON.parse(JSON.stringify(this._points)))},q.prototype.importDataFromUrl=function(r){var n=this,o=this;return new Promise(function(e,t){W.prototype.clear.call(n),W.prototype.importDataFromUrl.call(n,r).then(function(){o._addPoints(W.prototype.toJson.call(n)),o._recalculate(),e()},function(){t()})})},q.prototype.remove=function(e){this._remove(e),this._recalculate()},q.prototype.removeById=function(e){this._remove(e),this._recalculate()},q.prototype.setOptions=function(e){if(e){var t=this._options,r={},n=!1,o=!1;if("number"==typeof e.maxZoom&&0<=e.maxZoom&&e.maxZoom<25&&e.maxZoom!==t.maxZoom&&(t.maxZoom=e.maxZoom,r.maxZoom=e.maxZoom),"number"==typeof e.cellWidth&&0<e.cellWidth&&e.cellWidth!==t.cellWidth&&(t.cellWidth=e.cellWidth,o=!0),"number"==typeof e.minCellWidth&&0<=e.minCellWidth&&e.minCellWidth!==t.minCellWidth&&(t.minCellWidth=e.minCellWidth,n=!0),void 0!==e.centerLatitude&&e.centerLatitude!==t.centerLatitude&&(t.centerLatitude=e.centerLatitude,o=!0),e.distanceUnits&&e.distanceUnits!==t.distanceUnits&&(t.distanceUnits=e.distanceUnits,o=!0),e.gridType&&e.gridType!==t.gridType){var i=["square","circle"],a=["hexagon","hexCircle"];-1<a.indexOf(t.gridType)&&-1<a.indexOf(e.gridType)||-1<i.indexOf(t.gridType)&&-1<i.indexOf(e.gridType)?n=!0:o=!0,t.gridType=e.gridType}void 0!==e.aggregateProperties&&(t.aggregateProperties=e.aggregateProperties,o=!0),void 0!==e.scaleExpression&&e.scaleExpression!==t.scaleExpression&&(t.scaleExpression=e.scaleExpression,(e.scaleProperty||t.scaleProperty)&&(n=!0)),void 0!==e.scaleProperty&&e.scaleProperty!==t.scaleProperty&&(t.scaleProperty=e.scaleProperty,null===e.scaleProperty||"point_count"===e.scaleProperty?n=!0:o=!0),void 0!==e.coverage&&e.coverage!==t.coverage&&(t.coverage=e.coverage,n=!0),0<Object.keys(r).length&&W.prototype.setOptions.call(this,r),o||!this._gridInfo?this._recalculate():n&&this._recalculateCoords()}},q.prototype.setPoints=function(e){this._points=[],this._pixels=[],this._addPoints(e),this._recalculate()},q.prototype._addPoints=function(e){var t=this._points,r=this._pixels,n=this._normalizeGetPixel22;if("FeatureCollection"===e.type&&(e=e.features),Array.isArray(e))for(var o=0,i=e.length;o<i;o++)this._addPoints(e[o]);else if(e instanceof x.Shape)"Point"===e.getType()&&(r.push(n(e.getCoordinates())),t.push(e.toJson()));else if("Feature"===e.type&&"Point"===e.geometry.type){var a=e;r.push(n(a.geometry.coordinates)),t.push(a)}else if("Point"===e.type){var s=e;r.push(n(s.coordinates)),t.push(new x.data.Feature(s))}},q.prototype._normalizeGetPixel22=function(e){return e[0]=x.math.normalizeLongitude(e[0]),e[1]=x.math.normalizeLatitude(e[1]),L.toPixel22(e)},q.prototype._remove=function(e){var t=this,r=t._points;if(Array.isArray(e))for(var n=0,o=e.length;n<o;n++)t._remove(e[n]);else if(e instanceof x.Shape){var i=e.getId();for(n=0,o=r.length;n<o;n++)if(r[n].id===i){t._remove(n);break}}else if("number"==typeof e)e<r.length&&r.splice(e,1);else if("string"==typeof e){for(n=0,o=r.length;n<o;n++)if(r[n].id===e){t._remove(n);break}}else if("Feature"===e.type){var a=r.indexOf(e);t._remove(a)}},q.prototype._recalculate=function(){var e=this;void 0===this._requestId&&(e._requestId=requestAnimationFrame(function(){e._gridInfo=L.calculateGrid(e._points,e._pixels,e._options),e._updateCells(),e._requestId=void 0}))},q.prototype._recalculateCoords=function(){L.recalculateCoords(this._gridInfo,this._options),this._updateCells()},q.prototype._updateCells=function(){W.prototype._clearNoUpdate.call(this),W.prototype.add.call(this,this._gridInfo.cells)},q);function U(){this.constructor=G}function q(e,t){var r=W.call(this,e)||this;return r._options={maxZoom:18,cellWidth:25e3,minCellWidth:0,distanceUnits:"meters",gridType:"hexagon",coverage:1,centerLatitude:0},r._points=[],r._pixels=[],t&&(Object.assign(r._options,t),W.prototype.setOptions.call(r,Object.assign({buffer:8,tolerance:0},t))),r}var Z,F=Object.freeze({__proto__:null,GriddedDataSource:N});(Z=e.GridType||(e.GridType={})).circle="circle",Z.hexagon="hexagon",Z.hexCircle="hexCircle",Z.pointyHexagon="pointyHexagon",Z.square="square",Z.triangle="triangle";var H=t.merge("atlas.source",F);e.source=H}(this.atlas=this.atlas||{},atlas);
