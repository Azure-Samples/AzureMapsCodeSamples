/* MIT License - Copyright (c) Microsoft Corporation. */


!function(e,a){"use strict";var i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)};var t,s,o,r=(function(e){var t=(t=function(e){if(this.REQUEST_TYPE={LOGIN:"LOGIN",RENEW_TOKEN:"RENEW_TOKEN",UNKNOWN:"UNKNOWN"},this.RESPONSE_TYPE={ID_TOKEN_TOKEN:"id_token token",TOKEN:"token"},this.CONSTANTS={ACCESS_TOKEN:"access_token",EXPIRES_IN:"expires_in",ID_TOKEN:"id_token",ERROR_DESCRIPTION:"error_description",SESSION_STATE:"session_state",ERROR:"error",STORAGE:{TOKEN_KEYS:"adal.token.keys",ACCESS_TOKEN_KEY:"adal.access.token.key",EXPIRATION_KEY:"adal.expiration.key",STATE_LOGIN:"adal.state.login",STATE_RENEW:"adal.state.renew",NONCE_IDTOKEN:"adal.nonce.idtoken",SESSION_STATE:"adal.session.state",USERNAME:"adal.username",IDTOKEN:"adal.idtoken",ERROR:"adal.error",ERROR_DESCRIPTION:"adal.error.description",LOGIN_REQUEST:"adal.login.request",LOGIN_ERROR:"adal.login.error",RENEW_STATUS:"adal.token.renew.status",ANGULAR_LOGIN_REQUEST:"adal.angular.login.request"},RESOURCE_DELIMETER:"|",CACHE_DELIMETER:"||",LOADFRAME_TIMEOUT:6e3,TOKEN_RENEW_STATUS_CANCELED:"Canceled",TOKEN_RENEW_STATUS_COMPLETED:"Completed",TOKEN_RENEW_STATUS_IN_PROGRESS:"In Progress",LOGGING_LEVEL:{ERROR:0,WARN:1,INFO:2,VERBOSE:3},LEVEL_STRING_MAP:{0:"ERROR:",1:"WARNING:",2:"INFO:",3:"VERBOSE:"},POPUP_WIDTH:483,POPUP_HEIGHT:600},t.prototype._singletonInstance)return t.prototype._singletonInstance;if((t.prototype._singletonInstance=this).instance="https://login.microsoftonline.com/",this.config={},this.callback=null,this.popUp=!1,this.isAngular=!1,this._user=null,this._activeRenewals={},this._loginInProgress=!1,this._acquireTokenInProgress=!1,this._renewStates=[],this._callBackMappedToRenewStates={},this._callBacksMappedToRenewStates={},this._openedWindows=[],this._requestType=this.REQUEST_TYPE.LOGIN,window._adalInstance=this,e.displayCall&&"function"!=typeof e.displayCall)throw new Error("displayCall is not a function");if(!e.clientId)throw new Error("clientId is required");this.config=this._cloneConfig(e),void 0===this.config.navigateToLoginRequestUrl&&(this.config.navigateToLoginRequestUrl=!0),this.config.popUp&&(this.popUp=!0),this.config.callback&&"function"==typeof this.config.callback&&(this.callback=this.config.callback),this.config.instance&&(this.instance=this.config.instance),this.config.loginResource||(this.config.loginResource=this.config.clientId),this.config.redirectUri||(this.config.redirectUri=window.location.href.split("?")[0].split("#")[0]),this.config.postLogoutRedirectUri||(this.config.postLogoutRedirectUri=window.location.href.split("?")[0].split("#")[0]),this.config.anonymousEndpoints||(this.config.anonymousEndpoints=[]),this.config.isAngular&&(this.isAngular=this.config.isAngular),this.config.loadFrameTimeout&&(this.CONSTANTS.LOADFRAME_TIMEOUT=this.config.loadFrameTimeout)},"undefined"!=typeof window&&(window.Logging={piiLoggingEnabled:!1,level:0,log:function(e){}}),t.prototype.login=function(){if(this._loginInProgress)this.info("Login in progress");else{this._loginInProgress=!0;var e=this._guid();this.config.state=e,this._idTokenNonce=this._guid();var t=this._getItem(this.CONSTANTS.STORAGE.ANGULAR_LOGIN_REQUEST);t&&""!==t?this._saveItem(this.CONSTANTS.STORAGE.ANGULAR_LOGIN_REQUEST,""):t=window.location.href,this.verbose("Expected state: "+e+" startPage:"+t),this._saveItem(this.CONSTANTS.STORAGE.LOGIN_REQUEST,t),this._saveItem(this.CONSTANTS.STORAGE.LOGIN_ERROR,""),this._saveItem(this.CONSTANTS.STORAGE.STATE_LOGIN,e,!0),this._saveItem(this.CONSTANTS.STORAGE.NONCE_IDTOKEN,this._idTokenNonce,!0),this._saveItem(this.CONSTANTS.STORAGE.ERROR,""),this._saveItem(this.CONSTANTS.STORAGE.ERROR_DESCRIPTION,"");var i=this._getNavigateUrl("id_token",null)+"&nonce="+encodeURIComponent(this._idTokenNonce);this.config.displayCall?this.config.displayCall(i):this.popUp?(this._saveItem(this.CONSTANTS.STORAGE.STATE_LOGIN,""),this._renewStates.push(e),this.registerCallback(e,this.config.clientId,this.callback),this._loginPopup(i)):this.promptUser(i)}},t.prototype._openPopup=function(e,t,i,o){try{var r=window.screenLeft?window.screenLeft:window.screenX,n=window.screenTop?window.screenTop:window.screenY,s=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,a=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight,A=s/2-i/2+r,c=a/2-o/2+n,h=window.open(e,t,"width="+i+", height="+o+", top="+c+", left="+A);return h.focus&&h.focus(),h}catch(e){return this.warn("Error opening popup, "+e.message),this._loginInProgress=!1,this._acquireTokenInProgress=!1,null}},t.prototype._handlePopupError=function(e,t,i,o,r){this.warn(o),this._saveItem(this.CONSTANTS.STORAGE.ERROR,i),this._saveItem(this.CONSTANTS.STORAGE.ERROR_DESCRIPTION,o),this._saveItem(this.CONSTANTS.STORAGE.LOGIN_ERROR,r),t&&this._activeRenewals[t]&&(this._activeRenewals[t]=null),this._loginInProgress=!1,this._acquireTokenInProgress=!1,e&&e(o,null,i)},t.prototype._loginPopup=function(e,o,t){var r=this._openPopup(e,"login",this.CONSTANTS.POPUP_WIDTH,this.CONSTANTS.POPUP_HEIGHT),n=t||this.callback;if(null!=r){if(this._openedWindows.push(r),-1!=this.config.redirectUri.indexOf("#"))var s=this.config.redirectUri.split("#")[0];else s=this.config.redirectUri;var a=this,A=window.setInterval(function(){if(!r||r.closed||void 0===r.closed){var e="Popup Window closed",t="Popup Window closed by UI action/ Popup Window handle destroyed due to cross zone navigation in IE/Edge";return a.isAngular&&a._broadcast("adal:popUpClosed",t+a.CONSTANTS.RESOURCE_DELIMETER+e),a._handlePopupError(n,o,e,t,t),void window.clearInterval(A)}try{var i=r.location;if(-1!=encodeURI(i.href).indexOf(encodeURI(s)))return a.isAngular?a._broadcast("adal:popUpHashChanged",i.hash):a.handleWindowCallback(i.hash),window.clearInterval(A),a._loginInProgress=!1,a._acquireTokenInProgress=!1,a.info("Closing popup window"),a._openedWindows=[],void r.close()}catch(e){}},1)}else{var i="Popup Window is null. This can happen if you are using IE";this._handlePopupError(n,o,"Error opening popup",i,i)}},t.prototype._broadcast=function(e,t){function i(e,t){t=t||{bubbles:!1,cancelable:!1,detail:void 0};var i=document.createEvent("CustomEvent");return i.initCustomEvent(e,t.bubbles,t.cancelable,t.detail),i}"function"!=typeof window.CustomEvent&&(i.prototype=window.Event.prototype,window.CustomEvent=i);var o=new CustomEvent(e,{detail:t});window.dispatchEvent(o)},t.prototype.loginInProgress=function(){return this._loginInProgress},t.prototype._hasResource=function(e){var t=this._getItem(this.CONSTANTS.STORAGE.TOKEN_KEYS);return t&&!this._isEmpty(t)&&-1<t.indexOf(e+this.CONSTANTS.RESOURCE_DELIMETER)},t.prototype.getCachedToken=function(e){if(!this._hasResource(e))return null;var t=this._getItem(this.CONSTANTS.STORAGE.ACCESS_TOKEN_KEY+e),i=this._getItem(this.CONSTANTS.STORAGE.EXPIRATION_KEY+e),o=this.config.expireOffsetSeconds||300;return i&&i>this._now()+o?t:(this._saveItem(this.CONSTANTS.STORAGE.ACCESS_TOKEN_KEY+e,""),this._saveItem(this.CONSTANTS.STORAGE.EXPIRATION_KEY+e,0),null)},t.prototype.getCachedUser=function(){if(this._user)return this._user;var e=this._getItem(this.CONSTANTS.STORAGE.IDTOKEN);return this._user=this._createUser(e),this._user},t.prototype.registerCallback=function(n,s,e){this._activeRenewals[s]=n,this._callBacksMappedToRenewStates[n]||(this._callBacksMappedToRenewStates[n]=[]);var a=this;this._callBacksMappedToRenewStates[n].push(e),this._callBackMappedToRenewStates[n]||(this._callBackMappedToRenewStates[n]=function(e,t,i,o){a._activeRenewals[s]=null;for(var r=0;r<a._callBacksMappedToRenewStates[n].length;++r)try{a._callBacksMappedToRenewStates[n][r](e,t,i,o)}catch(i){a.warn(i)}a._callBacksMappedToRenewStates[n]=null,a._callBackMappedToRenewStates[n]=null})},t.prototype._renewToken=function(e,t,i){this.info("renewToken is called for resource:"+e);var o=this._addAdalFrame("adalRenewFrame"+e),r=this._guid()+"|"+e;this.config.state=r,this._renewStates.push(r),this.verbose("Renew token Expected state: "+r),i=i||"token";var n=this._urlRemoveQueryStringParameter(this._getNavigateUrl(i,e),"prompt");i===this.RESPONSE_TYPE.ID_TOKEN_TOKEN&&(this._idTokenNonce=this._guid(),this._saveItem(this.CONSTANTS.STORAGE.NONCE_IDTOKEN,this._idTokenNonce,!0),n+="&nonce="+encodeURIComponent(this._idTokenNonce)),n+="&prompt=none",n=this._addHintParameters(n),this.registerCallback(r,e,t),this.verbosePii("Navigate to:"+n),o.src="about:blank",this._loadFrameTimeout(n,"adalRenewFrame"+e,e)},t.prototype._renewIdToken=function(e,t){this.info("renewIdToken is called");var i=this._addAdalFrame("adalIdTokenFrame"),o=this._guid()+"|"+this.config.clientId;this._idTokenNonce=this._guid(),this._saveItem(this.CONSTANTS.STORAGE.NONCE_IDTOKEN,this._idTokenNonce,!0),this.config.state=o,this._renewStates.push(o),this.verbose("Renew Idtoken Expected state: "+o);var r=null==t?null:this.config.clientId,n=(t=t||"id_token",this._urlRemoveQueryStringParameter(this._getNavigateUrl(t,r),"prompt"));n+="&prompt=none",n=this._addHintParameters(n),n+="&nonce="+encodeURIComponent(this._idTokenNonce),this.registerCallback(o,this.config.clientId,e),this.verbosePii("Navigate to:"+n),i.src="about:blank",this._loadFrameTimeout(n,"adalIdTokenFrame",this.config.clientId)},t.prototype._urlContainsQueryStringParameter=function(e,t){return new RegExp("[\\?&]"+e+"=").test(t)},t.prototype._urlRemoveQueryStringParameter=function(e,t){var i=new RegExp("(\\&"+t+"=)[^&]+");return e=e.replace(i,""),i=new RegExp("("+t+"=)[^&]+&"),e=e.replace(i,""),i=new RegExp("("+t+"=)[^&]+"),e=e.replace(i,"")},t.prototype._loadFrameTimeout=function(e,t,i){this.verbose("Set loading state to pending for: "+i),this._saveItem(this.CONSTANTS.STORAGE.RENEW_STATUS+i,this.CONSTANTS.TOKEN_RENEW_STATUS_IN_PROGRESS),this._loadFrame(e,t);var o=this;setTimeout(function(){if(o._getItem(o.CONSTANTS.STORAGE.RENEW_STATUS+i)===o.CONSTANTS.TOKEN_RENEW_STATUS_IN_PROGRESS){o.verbose("Loading frame has timed out after: "+o.CONSTANTS.LOADFRAME_TIMEOUT/1e3+" seconds for resource "+i);var e=o._activeRenewals[i];e&&o._callBackMappedToRenewStates[e]&&o._callBackMappedToRenewStates[e]("Token renewal operation failed due to timeout",null,"Token Renewal Failed"),o._saveItem(o.CONSTANTS.STORAGE.RENEW_STATUS+i,o.CONSTANTS.TOKEN_RENEW_STATUS_CANCELED)}},o.CONSTANTS.LOADFRAME_TIMEOUT)},t.prototype._loadFrame=function(t,e){var i=this;i.info("LoadFrame: "+e);var o=e;setTimeout(function(){var e=i._addAdalFrame(o);""!==e.src&&"about:blank"!==e.src||(e.src=t,i._loadFrame(t,o))},500)},t.prototype.acquireToken=function(e,t){if(this._isEmpty(e))return this.warn("resource is required"),void t("resource is required",null,"resource is required");var i=this.getCachedToken(e);return i?(this.info("Token is already in cache for resource:"+e),void t(null,i,null)):this._user||this.config.extraQueryParameter&&-1!==this.config.extraQueryParameter.indexOf("login_hint")?void(this._activeRenewals[e]?this.registerCallback(this._activeRenewals[e],e,t):(this._requestType=this.REQUEST_TYPE.RENEW_TOKEN,e===this.config.clientId?this._user?(this.verbose("renewing idtoken"),this._renewIdToken(t)):(this.verbose("renewing idtoken and access_token"),this._renewIdToken(t,this.RESPONSE_TYPE.ID_TOKEN_TOKEN)):this._user?(this.verbose("renewing access_token"),this._renewToken(e,t)):(this.verbose("renewing idtoken and access_token"),this._renewToken(e,t,this.RESPONSE_TYPE.ID_TOKEN_TOKEN)))):(this.warn("User login is required"),void t("User login is required",null,"login required"))},t.prototype.acquireTokenPopup=function(e,t,i,o){if(this._isEmpty(e))return this.warn("resource is required"),void o("resource is required",null,"resource is required");if(!this._user)return this.warn("User login is required"),void o("User login is required",null,"login required");if(this._acquireTokenInProgress)return this.warn("Acquire token interactive is already in progress"),void o("Acquire token interactive is already in progress",null,"Acquire token interactive is already in progress");var r=this._guid()+"|"+e;this.config.state=r,this._renewStates.push(r),this._requestType=this.REQUEST_TYPE.RENEW_TOKEN,this.verbose("Renew token Expected state: "+r);var n=this._urlRemoveQueryStringParameter(this._getNavigateUrl("token",e),"prompt");if(n+="&prompt=select_account",t&&(n+=t),i&&-1===n.indexOf("&claims"))n+="&claims="+encodeURIComponent(i);else if(i&&-1!==n.indexOf("&claims"))throw new Error("Claims cannot be passed as an extraQueryParameter");n=this._addHintParameters(n),this._acquireTokenInProgress=!0,this.info("acquireToken interactive is called for the resource "+e),this.registerCallback(r,e,o),this._loginPopup(n,e,o)},t.prototype.acquireTokenRedirect=function(e,t,i){if(this._isEmpty(e))return this.warn("resource is required"),void o("resource is required",null,"resource is required");var o=this.callback;if(!this._user)return this.warn("User login is required"),void o("User login is required",null,"login required");if(this._acquireTokenInProgress)return this.warn("Acquire token interactive is already in progress"),void o("Acquire token interactive is already in progress",null,"Acquire token interactive is already in progress");var r=this._guid()+"|"+e;this.config.state=r,this.verbose("Renew token Expected state: "+r);var n=this._urlRemoveQueryStringParameter(this._getNavigateUrl("token",e),"prompt");if(n+="&prompt=select_account",t&&(n+=t),i&&-1===n.indexOf("&claims"))n+="&claims="+encodeURIComponent(i);else if(i&&-1!==n.indexOf("&claims"))throw new Error("Claims cannot be passed as an extraQueryParameter");n=this._addHintParameters(n),this._acquireTokenInProgress=!0,this.info("acquireToken interactive is called for the resource "+e),this._saveItem(this.CONSTANTS.STORAGE.LOGIN_REQUEST,window.location.href),this._saveItem(this.CONSTANTS.STORAGE.STATE_RENEW,r,!0),this.promptUser(n)},t.prototype.promptUser=function(e){e?(this.infoPii("Navigate to:"+e),window.location.replace(e)):this.info("Navigate url is empty")},t.prototype.clearCache=function(){this._saveItem(this.CONSTANTS.STORAGE.LOGIN_REQUEST,""),this._saveItem(this.CONSTANTS.STORAGE.ANGULAR_LOGIN_REQUEST,""),this._saveItem(this.CONSTANTS.STORAGE.SESSION_STATE,""),this._saveItem(this.CONSTANTS.STORAGE.STATE_LOGIN,""),this._saveItem(this.CONSTANTS.STORAGE.STATE_RENEW,""),this._renewStates=[],this._saveItem(this.CONSTANTS.STORAGE.NONCE_IDTOKEN,""),this._saveItem(this.CONSTANTS.STORAGE.IDTOKEN,""),this._saveItem(this.CONSTANTS.STORAGE.ERROR,""),this._saveItem(this.CONSTANTS.STORAGE.ERROR_DESCRIPTION,""),this._saveItem(this.CONSTANTS.STORAGE.LOGIN_ERROR,""),this._saveItem(this.CONSTANTS.STORAGE.LOGIN_ERROR,"");var e=this._getItem(this.CONSTANTS.STORAGE.TOKEN_KEYS);if(!this._isEmpty(e)){e=e.split(this.CONSTANTS.RESOURCE_DELIMETER);for(var t=0;t<e.length&&""!==e[t];t++)this._saveItem(this.CONSTANTS.STORAGE.ACCESS_TOKEN_KEY+e[t],""),this._saveItem(this.CONSTANTS.STORAGE.EXPIRATION_KEY+e[t],0)}this._saveItem(this.CONSTANTS.STORAGE.TOKEN_KEYS,"")},t.prototype.clearCacheForResource=function(e){this._saveItem(this.CONSTANTS.STORAGE.STATE_RENEW,""),this._saveItem(this.CONSTANTS.STORAGE.ERROR,""),this._saveItem(this.CONSTANTS.STORAGE.ERROR_DESCRIPTION,""),this._hasResource(e)&&(this._saveItem(this.CONSTANTS.STORAGE.ACCESS_TOKEN_KEY+e,""),this._saveItem(this.CONSTANTS.STORAGE.EXPIRATION_KEY+e,0))},t.prototype.logOut=function(){var e;if(this.clearCache(),this._user=null,this.config.logOutUri)e=this.config.logOutUri;else{var t="common",i="";this.config.tenant&&(t=this.config.tenant),this.config.postLogoutRedirectUri&&(i="post_logout_redirect_uri="+encodeURIComponent(this.config.postLogoutRedirectUri)),e=this.instance+t+"/oauth2/logout?"+i}this.infoPii("Logout navigate to: "+e),this.promptUser(e)},t.prototype._isEmpty=function(e){return void 0===e||!e||0===e.length},t.prototype.getUser=function(e){if("function"!=typeof e)throw new Error("callback is not a function");if(this._user)e(null,this._user);else{var t=this._getItem(this.CONSTANTS.STORAGE.IDTOKEN);this._isEmpty(t)?(this.warn("User information is not available"),e("User information is not available",null)):(this.info("User exists in cache: "),this._user=this._createUser(t),e(null,this._user))}},t.prototype._addHintParameters=function(e){if(this._user&&this._user.profile)if(this._user.profile.sid&&-1!==e.indexOf("&prompt=none"))this._urlContainsQueryStringParameter("sid",e)||(e+="&sid="+encodeURIComponent(this._user.profile.sid));else if(this._user.profile.upn&&(this._urlContainsQueryStringParameter("login_hint",e)||(e+="&login_hint="+encodeURIComponent(this._user.profile.upn)),!this._urlContainsQueryStringParameter("domain_hint",e)&&-1<this._user.profile.upn.indexOf("@"))){var t=this._user.profile.upn.split("@");e+="&domain_hint="+encodeURIComponent(t[t.length-1])}return e},t.prototype._createUser=function(e){var t=null,i=this._extractIdToken(e);return i&&i.hasOwnProperty("aud")&&(i.aud.toLowerCase()===this.config.clientId.toLowerCase()?(t={userName:"",profile:i},i.hasOwnProperty("upn")?t.userName=i.upn:i.hasOwnProperty("email")&&(t.userName=i.email)):this.warn("IdToken has invalid aud field")),t},t.prototype._getHash=function(e){return-1<e.indexOf("#/")?e=e.substring(e.indexOf("#/")+2):-1<e.indexOf("#")&&(e=e.substring(1)),e},t.prototype.isCallback=function(e){e=this._getHash(e);var t=this._deserialize(e);return t.hasOwnProperty(this.CONSTANTS.ERROR_DESCRIPTION)||t.hasOwnProperty(this.CONSTANTS.ACCESS_TOKEN)||t.hasOwnProperty(this.CONSTANTS.ID_TOKEN)},t.prototype.getLoginError=function(){return this._getItem(this.CONSTANTS.STORAGE.LOGIN_ERROR)},t.prototype.getRequestInfo=function(e){e=this._getHash(e);var t=this._deserialize(e),i={valid:!1,parameters:{},stateMatch:!1,stateResponse:"",requestType:this.REQUEST_TYPE.UNKNOWN};if(t&&((i.parameters=t).hasOwnProperty(this.CONSTANTS.ERROR_DESCRIPTION)||t.hasOwnProperty(this.CONSTANTS.ACCESS_TOKEN)||t.hasOwnProperty(this.CONSTANTS.ID_TOKEN))){i.valid=!0;var o="";if(!t.hasOwnProperty("state"))return this.warn("No state returned"),i;if(this.verbose("State: "+t.state),o=t.state,i.stateResponse=o,this._matchState(i))return i;if(!i.stateMatch&&window.parent){i.requestType=this._requestType;for(var r=this._renewStates,n=0;n<r.length;n++)if(r[n]===i.stateResponse){i.stateMatch=!0;break}}}return i},t.prototype._matchNonce=function(e){var t=this._getItem(this.CONSTANTS.STORAGE.NONCE_IDTOKEN);if(t){t=t.split(this.CONSTANTS.CACHE_DELIMETER);for(var i=0;i<t.length;i++)if(t[i]&&t[i]===e.profile.nonce)return!0}return!1},t.prototype._matchState=function(e){var t=this._getItem(this.CONSTANTS.STORAGE.STATE_LOGIN);if(t){t=t.split(this.CONSTANTS.CACHE_DELIMETER);for(var i=0;i<t.length;i++)if(t[i]&&t[i]===e.stateResponse)return e.requestType=this.REQUEST_TYPE.LOGIN,e.stateMatch=!0}var o=this._getItem(this.CONSTANTS.STORAGE.STATE_RENEW);if(o)for(o=o.split(this.CONSTANTS.CACHE_DELIMETER),i=0;i<o.length;i++)if(o[i]&&o[i]===e.stateResponse)return e.requestType=this.REQUEST_TYPE.RENEW_TOKEN,e.stateMatch=!0;return!1},t.prototype._getResourceFromState=function(e){if(e){var t=e.indexOf("|");if(-1<t&&t+1<e.length)return e.substring(t+1)}return""},t.prototype.saveTokenFromHash=function(e){this.info("State status:"+e.stateMatch+"; Request type:"+e.requestType),this._saveItem(this.CONSTANTS.STORAGE.ERROR,""),this._saveItem(this.CONSTANTS.STORAGE.ERROR_DESCRIPTION,"");var t,i=this._getResourceFromState(e.stateResponse);e.parameters.hasOwnProperty(this.CONSTANTS.ERROR_DESCRIPTION)?(this.infoPii("Error :"+e.parameters.error+"; Error description:"+e.parameters[this.CONSTANTS.ERROR_DESCRIPTION]),this._saveItem(this.CONSTANTS.STORAGE.ERROR,e.parameters.error),this._saveItem(this.CONSTANTS.STORAGE.ERROR_DESCRIPTION,e.parameters[this.CONSTANTS.ERROR_DESCRIPTION]),e.requestType===this.REQUEST_TYPE.LOGIN&&(this._loginInProgress=!1,this._saveItem(this.CONSTANTS.STORAGE.LOGIN_ERROR,e.parameters.error_description))):e.stateMatch?(this.info("State is right"),e.parameters.hasOwnProperty(this.CONSTANTS.SESSION_STATE)&&this._saveItem(this.CONSTANTS.STORAGE.SESSION_STATE,e.parameters[this.CONSTANTS.SESSION_STATE]),e.parameters.hasOwnProperty(this.CONSTANTS.ACCESS_TOKEN)&&(this.info("Fragment has access token"),this._hasResource(i)||(t=this._getItem(this.CONSTANTS.STORAGE.TOKEN_KEYS)||"",this._saveItem(this.CONSTANTS.STORAGE.TOKEN_KEYS,t+i+this.CONSTANTS.RESOURCE_DELIMETER)),this._saveItem(this.CONSTANTS.STORAGE.ACCESS_TOKEN_KEY+i,e.parameters[this.CONSTANTS.ACCESS_TOKEN]),this._saveItem(this.CONSTANTS.STORAGE.EXPIRATION_KEY+i,this._expiresIn(e.parameters[this.CONSTANTS.EXPIRES_IN]))),e.parameters.hasOwnProperty(this.CONSTANTS.ID_TOKEN)&&(this.info("Fragment has id token"),this._loginInProgress=!1,this._user=this._createUser(e.parameters[this.CONSTANTS.ID_TOKEN]),this._user&&this._user.profile?this._matchNonce(this._user)?(this._saveItem(this.CONSTANTS.STORAGE.IDTOKEN,e.parameters[this.CONSTANTS.ID_TOKEN]),i=this.config.loginResource?this.config.loginResource:this.config.clientId,this._hasResource(i)||(t=this._getItem(this.CONSTANTS.STORAGE.TOKEN_KEYS)||"",this._saveItem(this.CONSTANTS.STORAGE.TOKEN_KEYS,t+i+this.CONSTANTS.RESOURCE_DELIMETER)),this._saveItem(this.CONSTANTS.STORAGE.ACCESS_TOKEN_KEY+i,e.parameters[this.CONSTANTS.ID_TOKEN]),this._saveItem(this.CONSTANTS.STORAGE.EXPIRATION_KEY+i,this._user.profile.exp)):(this._saveItem(this.CONSTANTS.STORAGE.LOGIN_ERROR,"Nonce received: "+this._user.profile.nonce+" is not same as requested: "+this._getItem(this.CONSTANTS.STORAGE.NONCE_IDTOKEN)),this._user=null):(e.parameters.error="invalid id_token",e.parameters.error_description="Invalid id_token. id_token: "+e.parameters[this.CONSTANTS.ID_TOKEN],this._saveItem(this.CONSTANTS.STORAGE.ERROR,"invalid id_token"),this._saveItem(this.CONSTANTS.STORAGE.ERROR_DESCRIPTION,"Invalid id_token. id_token: "+e.parameters[this.CONSTANTS.ID_TOKEN])))):(e.parameters.error="Invalid_state",e.parameters.error_description="Invalid_state. state: "+e.stateResponse,this._saveItem(this.CONSTANTS.STORAGE.ERROR,"Invalid_state"),this._saveItem(this.CONSTANTS.STORAGE.ERROR_DESCRIPTION,"Invalid_state. state: "+e.stateResponse)),this._saveItem(this.CONSTANTS.STORAGE.RENEW_STATUS+i,this.CONSTANTS.TOKEN_RENEW_STATUS_COMPLETED)},t.prototype.getResourceForEndpoint=function(e){if(this.config&&this.config.anonymousEndpoints)for(var t=0;t<this.config.anonymousEndpoints.length;t++)if(-1<e.indexOf(this.config.anonymousEndpoints[t]))return null;if(this.config&&this.config.endpoints)for(var i in this.config.endpoints)if(-1<e.indexOf(i))return this.config.endpoints[i];return(-1<e.indexOf("http://")||-1<e.indexOf("https://"))&&this._getHostFromUri(e)!==this._getHostFromUri(this.config.redirectUri)?null:this.config.loginResource},t.prototype._getHostFromUri=function(e){var t=String(e).replace(/^(https?:)\/\//,"");return t=t.split("/")[0]},t.prototype.handleWindowCallback=function(e){if(null==e&&(e=window.location.hash),this.isCallback(e)){var t=null,i=!1;0<this._openedWindows.length&&this._openedWindows[this._openedWindows.length-1].opener&&this._openedWindows[this._openedWindows.length-1].opener._adalInstance?(t=this._openedWindows[this._openedWindows.length-1].opener._adalInstance,i=!0):window.parent&&window.parent._adalInstance&&(t=window.parent._adalInstance);var o,r,n=t.getRequestInfo(e),s=null;r=i||window.parent!==window?t._callBackMappedToRenewStates[n.stateResponse]:t.callback,t.info("Returned from redirect url"),t.saveTokenFromHash(n),n.requestType===this.REQUEST_TYPE.RENEW_TOKEN&&window.parent?(window.parent!==window?t.verbose("Window is in iframe, acquiring token silently"):t.verbose("acquiring token interactive in progress"),o=n.parameters[t.CONSTANTS.ACCESS_TOKEN]||n.parameters[t.CONSTANTS.ID_TOKEN],s=t.CONSTANTS.ACCESS_TOKEN):n.requestType===this.REQUEST_TYPE.LOGIN&&(o=n.parameters[t.CONSTANTS.ID_TOKEN],s=t.CONSTANTS.ID_TOKEN);var a=n.parameters[t.CONSTANTS.ERROR_DESCRIPTION],A=n.parameters[t.CONSTANTS.ERROR];try{r&&r(a,o,A,s)}catch(e){t.error("Error occurred in user defined callback function: "+e)}window.parent!==window||i||(t.config.navigateToLoginRequestUrl?window.location.href=t._getItem(t.CONSTANTS.STORAGE.LOGIN_REQUEST):window.location.hash="")}},t.prototype._getNavigateUrl=function(e,t){var i="common";this.config.tenant&&(i=this.config.tenant);var o=this.instance+i+"/oauth2/authorize"+this._serialize(e,this.config,t)+this._addLibMetadata();return this.info("Navigate url:"+o),o},t.prototype._extractIdToken=function(e){var t=this._decodeJwt(e);if(!t)return null;try{var i=t.JWSPayload,o=this._base64DecodeStringUrlSafe(i);return o?JSON.parse(o):(this.info("The returned id_token could not be base64 url safe decoded."),null)}catch(e){this.error("The returned id_token could not be decoded",e)}return null},t.prototype._base64DecodeStringUrlSafe=function(e){return e=e.replace(/-/g,"+").replace(/_/g,"/"),window.atob?decodeURIComponent(escape(window.atob(e))):decodeURIComponent(escape(this._decode(e)))},t.prototype._decode=function(e){var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",i=(e=String(e).replace(/=+$/,"")).length;if(i%4==1)throw new Error("The token to be decoded is not correctly encoded.");for(var o,r,n,s,a,A,c,h,l="",E=0;E<i;E+=4){if(o=t.indexOf(e.charAt(E)),r=t.indexOf(e.charAt(E+1)),n=t.indexOf(e.charAt(E+2)),s=t.indexOf(e.charAt(E+3)),E+2===i-1){A=(a=o<<18|r<<12|n<<6)>>16&255,c=a>>8&255,l+=String.fromCharCode(A,c);break}if(E+1===i-1){A=(a=o<<18|r<<12)>>16&255,l+=String.fromCharCode(A);break}A=(a=o<<18|r<<12|n<<6|s)>>16&255,c=a>>8&255,h=255&a,l+=String.fromCharCode(A,c,h)}return l},t.prototype._decodeJwt=function(e){if(this._isEmpty(e))return null;var t=/^([^\.\s]*)\.([^\.\s]+)\.([^\.\s]*)$/.exec(e);return!t||t.length<4?(this.warn("The returned id_token is not parseable."),null):{header:t[1],JWSPayload:t[2],JWSSig:t[3]}},t.prototype._convertUrlSafeToRegularBase64EncodedString=function(e){return e.replace("-","+").replace("_","/")},t.prototype._serialize=function(e,t,i){var o=[];if(null!==t){o.push("?response_type="+e),o.push("client_id="+encodeURIComponent(t.clientId)),i&&o.push("resource="+encodeURIComponent(i)),o.push("redirect_uri="+encodeURIComponent(t.redirectUri)),o.push("state="+encodeURIComponent(t.state)),t.hasOwnProperty("slice")&&o.push("slice="+encodeURIComponent(t.slice)),t.hasOwnProperty("extraQueryParameter")&&o.push(t.extraQueryParameter);var r=t.correlationId?t.correlationId:this._guid();o.push("client-request-id="+encodeURIComponent(r))}return o.join("&")},t.prototype._deserialize=function(e){function t(e){return decodeURIComponent(e.replace(o," "))}var i,o=/\+/g,r=/([^&=]+)=([^&]*)/g,n={};for(i=r.exec(e);i;)n[t(i[1])]=t(i[2]),i=r.exec(e);return n},t.prototype._decimalToHex=function(e){for(var t=e.toString(16);t.length<2;)t="0"+t;return t},t.prototype._guid=function(){var e=window.crypto||window.msCrypto;if(e&&e.getRandomValues){var t=new Uint8Array(16);return e.getRandomValues(t),t[6]|=64,t[6]&=79,t[8]|=128,t[8]&=191,this._decimalToHex(t[0])+this._decimalToHex(t[1])+this._decimalToHex(t[2])+this._decimalToHex(t[3])+"-"+this._decimalToHex(t[4])+this._decimalToHex(t[5])+"-"+this._decimalToHex(t[6])+this._decimalToHex(t[7])+"-"+this._decimalToHex(t[8])+this._decimalToHex(t[9])+"-"+this._decimalToHex(t[10])+this._decimalToHex(t[11])+this._decimalToHex(t[12])+this._decimalToHex(t[13])+this._decimalToHex(t[14])+this._decimalToHex(t[15])}for(var i="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx",o="0123456789abcdef",r=0,n="",s=0;s<36;s++)"-"!==i[s]&&"4"!==i[s]&&(r=16*Math.random()|0),"x"===i[s]?n+=o[r]:"y"===i[s]?(r&=3,n+=o[r|=8]):n+=i[s];return n},t.prototype._expiresIn=function(e){return e=e||3599,this._now()+parseInt(e,10)},t.prototype._now=function(){return Math.round((new Date).getTime()/1e3)},t.prototype._addAdalFrame=function(e){if(void 0!==e){this.info("Add adal frame to document:"+e);var t=document.getElementById(e);if(!t){if(document.createElement&&document.documentElement&&(window.opera||-1===window.navigator.userAgent.indexOf("MSIE 5.0"))){var i=document.createElement("iframe");i.setAttribute("id",e),i.setAttribute("aria-hidden","true"),i.style.visibility="hidden",i.style.position="absolute",i.style.width=i.style.height=i.borderWidth="0px",t=document.getElementsByTagName("body")[0].appendChild(i)}else document.body&&document.body.insertAdjacentHTML&&document.body.insertAdjacentHTML("beforeEnd",'<iframe name="'+e+'" id="'+e+'" style="display:none"></iframe>');window.frames&&window.frames[e]&&(t=window.frames[e])}return t}},t.prototype._saveItem=function(e,t,i){if(this.config&&this.config.cacheLocation&&"localStorage"===this.config.cacheLocation){if(!this._supportsLocalStorage())return this.info("Local storage is not supported"),!1;if(i){var o=this._getItem(e)||"";localStorage.setItem(e,o+t+this.CONSTANTS.CACHE_DELIMETER)}else localStorage.setItem(e,t);return!0}return this._supportsSessionStorage()?(sessionStorage.setItem(e,t),!0):(this.info("Session storage is not supported"),!1)},t.prototype._getItem=function(e){return this.config&&this.config.cacheLocation&&"localStorage"===this.config.cacheLocation?this._supportsLocalStorage()?localStorage.getItem(e):(this.info("Local storage is not supported"),null):this._supportsSessionStorage()?sessionStorage.getItem(e):(this.info("Session storage is not supported"),null)},t.prototype._supportsLocalStorage=function(){try{return!!window.localStorage&&(window.localStorage.setItem("storageTest","A"),"A"==window.localStorage.getItem("storageTest")&&(window.localStorage.removeItem("storageTest"),!window.localStorage.getItem("storageTest")))}catch(e){return!1}},t.prototype._supportsSessionStorage=function(){try{return!!window.sessionStorage&&(window.sessionStorage.setItem("storageTest","A"),"A"==window.sessionStorage.getItem("storageTest")&&(window.sessionStorage.removeItem("storageTest"),!window.sessionStorage.getItem("storageTest")))}catch(e){return!1}},t.prototype._cloneConfig=function(e){if(null===e||"object"!=typeof e)return e;var t={};for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);return t},t.prototype._addLibMetadata=function(){return"&x-client-SKU=Js&x-client-Ver="+this._libVersion()},t.prototype.log=function(e,t,i,o){if(e<=Logging.level){if(!Logging.piiLoggingEnabled&&o)return;var r=(new Date).toUTCString(),n="";n=this.config.correlationId?r+":"+this.config.correlationId+"-"+this._libVersion()+"-"+this.CONSTANTS.LEVEL_STRING_MAP[e]+" "+t:r+":"+this._libVersion()+"-"+this.CONSTANTS.LEVEL_STRING_MAP[e]+" "+t,i&&(n+="\nstack:\n"+i.stack),Logging.log(n)}},t.prototype.error=function(e,t){this.log(this.CONSTANTS.LOGGING_LEVEL.ERROR,e,t)},t.prototype.warn=function(e){this.log(this.CONSTANTS.LOGGING_LEVEL.WARN,e,null)},t.prototype.info=function(e){this.log(this.CONSTANTS.LOGGING_LEVEL.INFO,e,null)},t.prototype.verbose=function(e){this.log(this.CONSTANTS.LOGGING_LEVEL.VERBOSE,e,null)},t.prototype.errorPii=function(e,t){this.log(this.CONSTANTS.LOGGING_LEVEL.ERROR,e,t,!0)},t.prototype.warnPii=function(e){this.log(this.CONSTANTS.LOGGING_LEVEL.WARN,e,null,!0)},t.prototype.infoPii=function(e){this.log(this.CONSTANTS.LOGGING_LEVEL.INFO,e,null,!0)},t.prototype.verbosePii=function(e){this.log(this.CONSTANTS.LOGGING_LEVEL.VERBOSE,e,null,!0)},t.prototype._libVersion=function(){return"1.0.18"},e.exports&&(e.exports=t,e.exports.inject=function(e){return new t(e)}),t)}(t={exports:{}}),t.exports);r.inject;(o=s=s||{}).subscriptionKey="subscriptionKey",o.aad="aad",o.anonymous="anonymous";var A={preferredCacheLocation:"localStorage",storage:{accessTokenKey:"access.token.key",testStorageKey:"testStorage"},events:{tokenAcquired:"tokenacquired"},tokenExpiresIn:3599,tokenRefreshClockSkew:300,errors:{tokenExpired:"Token Expired, Try again"},AUTHORIZATION:"authorization",AUTHORIZATION_SCHEME:"Bearer",MAP_AGENT:"Map-Agent",MS_AM_REQUEST_ORIGIN:"Ms-Am-Request-Origin",MS_AM_REQUEST_ORIGIN_VALUE:"MapControl",X_MS_CLIENT_ID:"x-ms-client-id",SESSION_ID:"Session-Id",SHORT_DOMAIN:"atlas.microsoft.com",DEFAULT_DOMAIN:"https://atlas.microsoft.com/",SDK_VERSION:"0.0.1",TARGET_SDK:"Cesium",RENDERV2_VERSION:"2.1",TILESETS:{"microsoft.base.road":{name:"Road",icon:"data:image/jpeg;base64,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",isBasemap:!0},"microsoft.base.labels.road":{name:"Road Labels",hasAlpha:!0},"microsoft.base.hybrid.road":{name:"Road Hybrid",hasAlpha:!0},"microsoft.base.darkgrey":{name:"Dark Grayscale Road",icon:"data:image/jpeg;base64,/9j/4AAQSkZJRgABAQEASABIAAD/2wBDAAMCAgMCAgMDAwMEAwMEBQgFBQQEBQoHBwYIDAoMDAsKCwsNDhIQDQ4RDgsLEBYQERMUFRUVDA8XGBYUGBIUFRT/2wBDAQMEBAUEBQkFBQkUDQsNFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBT/wgARCAA8ADwDAREAAhEBAxEB/8QAGwAAAgIDAQAAAAAAAAAAAAAAAAECBgMEBQj/xAAZAQEAAwEBAAAAAAAAAAAAAAAAAQIEAwX/2gAMAwEAAhADEAAAAfOXo+UJDbrew8Nc4lIaahqwIDdp07/HVOJQpip6cKA6XPt3OOkRJOaFZ0ZJGaturz77FbAxFa0ZADvcdWWszMUgp+rAgLRn25q2CRBFT1YUBZs+zZreMxKJSKlqwgFj4a9unRTEokR//8QAJBAAAgEDAgYDAAAAAAAAAAAAAAECAwQSESAUISIxMjMQE0H/2gAIAQEAAQUC+bX3C7Ysxey094+Q9tlHrXf9xFFmVsJ2p9lmUVRUNYGR1GkTjGcUcTEpzWCnzc5HUaPZT9a7sltoLSjHyJC2W3OhHyJCP//EACIRAAADCAMBAAAAAAAAAAAAAAACMAEDERIgIjEyEFFhIf/aAAgBAwEBPwHkmyDvZB3mmwWCLvoFhD5TP4JvBMzoMwgzCBcIE1p//8QAIBEAAAUEAwEAAAAAAAAAAAAAAAECMDEREiAiECFhQf/aAAgBAgEBPwHlUMKhheOw2FFg6/R3haLfRb6DYOWDlhU4/wD/xAAlEAABAwEIAgMAAAAAAAAAAAABAAIQIAMRITEzQXGRIjJRksH/2gAIAQEABj8CluMGMqBFyFJPwhH4tgvW07Xranpab14NuBjALZgW5WnZ/VaLOloMTfADBZBZRnQ3hCBxSzhCBxS1CBH/xAAkEAACAQMDBAMBAAAAAAAAAAAAAREhMaEgUWEQQXGRgbHhwf/aAAgBAQABPyHqzVp0VuKpxsW60LPAn0oZFngLQ59ukGcOW3diqrfZcRWNkt1+FF3XyGF+t+iI2VlZEhqFgaS014+iwC2uckuwRd2ie7/YzEtCmxTFYrAl+z9G5Vy9Dy9bDOGqxnFel8AGQO7LCsIIILjt/RPYNVYlPEWh/9oADAMBAAIAAwAAABBpEr5barVbZOEHF29JBmRbDIdbNHfbHFX/xAAfEQACAgEFAQEAAAAAAAAAAAAAAREhECAwMVFhQZH/2gAIAQMBAT8QzxZjSlNhbPMYnoxNfjPQIsk5KJLIJdPwj0PIOoUSSyyNF12FhdhpQWHj/8QAHREAAgEFAQEAAAAAAAAAAAAAAAERECAhMVFhcf/aAAgBAgEBPxCuyjJRKuvRWtiB0klEdojtHoPPIgQYJZHrPoS6EcvI16JIwSrNg9CEOzcPVEN2bB6ohn//xAAmEAEAAgEBCAIDAQAAAAAAAAABABExIRBBUWFxkbHBofCB0eHx/9oACAEBAAE/EF1ly2VkrqO+ysS3iyjStDTh9CKmnblP0xztvu5Hw7NIcmvVKpnV1tg0jnbx211f8YLDk8wDAo4Myml3rf4mhAdzFxZ3W+SW4LhS+Km+fkfqMJz9i9dZdStlavbF8i90fxlHAvAGj+5VbdvJV94q+GE9ohPaAe4psmCtaDSAAHaGLl9ol7lFmN4/vL9SODVjnaTBRzZwQ2fL5ius5d8ylXNzYFxztABi7uX7nx3mfIZ9DmwHdHVtGrVtjsg8TtfzCOsz6HiwVdZ//9k=",isBasemap:!0},"microsoft.imagery":{name:"Imagery",maxZoom:19,icon:"data:image/jpeg;base64,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",isBasemap:!0},"microsoft.traffic.flow.absolute":{name:"Traffic flow (absolute)",hasAlpha:!0},"microsoft.traffic.flow.reduced-sensitivity":{name:"Traffic flow (reduced-sensitivity)",hasAlpha:!0},"microsoft.traffic.flow.relative":{name:"Traffic flow (relative)",hasAlpha:!0},"microsoft.traffic.flow.relative-delay":{name:"Traffic flow (relative-delay)",hasAlpha:!0},"microsoft.traffic.incident.night":{name:"Traffic incident (night)",hasAlpha:!0},"microsoft.traffic.incident.s1":{name:"Traffic incident (s1)",hasAlpha:!0},"microsoft.traffic.incident.s2":{name:"Traffic incident (s2)",hasAlpha:!0},"microsoft.traffic.incident.s3":{name:"Traffic incident (s3)",hasAlpha:!0},"microsoft.weather.infrared.main":{name:"Weather (infrared)",maxZoom:15,hasAlpha:!0},"microsoft.weather.radar.main":{name:"Weather (radar)",maxZoom:15,hasAlpha:!0}},AIRBUS_CREDIT:"© DLR 2011-2014 / © Airbus 2021"},n=(c.uuid=function(){return([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,function(e){return(e^crypto.getRandomValues(new Uint8Array(1))[0]&15>>e/4).toString(16)})},c);function c(){}var h=(l.getInstance=function(e){if(e&&e.authType){var t=e.azMapsDomain;if(t&&/^\w+:\/\//.test(t)&&(e.azMapsDomain=t.replace(/^\w+:\/\//,"")),l.instance&&l.instance.compareOptions(e))return l.instance;var i=new l(e);return l.instance||(l.instance=i),i}if(l.instance)return l.instance;throw"Azure Maps credentials not specified."},l.prototype.compareOptions=function(e){var t=this.options;return e.azMapsDomain===t.azMapsDomain&&e.aadAppId===t.aadAppId&&e.aadInstance===t.aadInstance&&e.aadTenant===t.aadTenant&&e.authType===t.authType&&e.clientId===t.clientId&&e.getToken===t.getToken&&e.subscriptionKey===t.subscriptionKey},l.prototype.isInitialized=function(){return this._initialized},l.prototype.initialize=function(){var i=this,o=i.options;return i.initPromise||(i.initPromise=new Promise(function(e,t){if(o.authType===s.subscriptionKey)i._initialized=!0,e();else if(o.authType===s.aad){if(o.authContext=o.authContext||l.getDefaultAuthContext(o),o.authContext.handleWindowCallback(),o.authContext.getLoginError())return void t(new Error("Error logging in the AAD users: "+o.authContext.getLoginError()));if(o.authContext.isCallback(window.location.hash))return;setTimeout(function(){return i._loginAndAcquire(e,t)})}else o.authType===s.anonymous?(i._initialized=!0,e(i._triggerTokenFetch())):t(new Error("An invalid authentication type was specified."))})),this.initPromise},l.getDefaultAuthContext=function(e){if(!e.aadAppId)throw new Error("No AAD app ID was specified.");if(!e.aadTenant)throw new Error("No AAD tenant was specified.");return this.defaultAuthContext||(this.defaultAuthContext=new r({instance:e.aadInstance||"https://login.windows-ppe.net/",tenant:e.aadTenant,clientId:e.aadAppId,cacheLocation:A.preferredCacheLocation})),this.defaultAuthContext},l.prototype._loginAndAcquire=function(t,i){function e(){r.authContext.acquireToken(A.DEFAULT_DOMAIN,function(e){e?i(new Error(e)):(o._initialized=!0,t())})}var o=this,r=o.options,n=r.authContext.getCachedToken(r.aadAppId),s=r.authContext.getCachedUser();if(n&&s)e();else{r.authContext.loginInProgress()||r.authContext.login();var a=setInterval(function(){r.authContext.loginInProgress()||(clearInterval(a),r.authContext.getCachedToken(r.aadAppId)?e():i(new Error(r.authContext.getLoginError()||"The AAD authentication context is not logged-in for the specified app ID: "+r.aadAppId)))},25)}},l.prototype.getAuthType=function(){return this.options.authType},l.prototype.getClientId=function(){return this.options.clientId},l.prototype.getToken=function(){var e=this,t=e.options;if(t.authType===s.aad){var i=t.authContext.getCachedToken(A.DEFAULT_DOMAIN);return i||(t.authContext.getCachedUser()||t.authContext.login(),t.authContext.acquireToken(A.DEFAULT_DOMAIN,function(e,t){e||(i=t)})),i}if(t.authType===s.anonymous){var o=e._getItem(A.storage.accessTokenKey);if(o){var r=e._getTokenExpiry(o);if(r<300&&0<r)e._triggerTokenFetch();else if(r<=0)throw e._saveItem(A.storage.accessTokenKey,""),new Error(A.errors.tokenExpired)}else e._triggerTokenFetch();return o}if(t.authType===s.subscriptionKey)return t.subscriptionKey},l.prototype._getTokenExpiry=function(e){var t=atob(e.split(".")[1]);return 1e3*JSON.parse(t).exp-Date.now()-3e5},l.prototype._storeAccessToken=function(e){this._saveItem(A.storage.accessTokenKey,e)},l.prototype._saveItem=function(e,t){return this._supportsLocalStorage()?localStorage.setItem(e,t):this._supportsSessionStorage()?sessionStorage.setItem(e,t):l.fallbackStorage[e]=t,!0},l.prototype._getItem=function(e){return this._supportsLocalStorage()?localStorage.getItem(e):this._supportsSessionStorage()?sessionStorage.getItem(e):l.fallbackStorage[e]},l.prototype._supportsLocalStorage=function(){try{var e=window.localStorage,t=A.storage.testStorageKey;return!!e&&(e.setItem(t,"A"),"A"===e.getItem(t)&&(e.removeItem(t),!e.getItem(t)))}catch(e){return!1}},l.prototype._supportsSessionStorage=function(){try{var e=window.sessionStorage,t=A.storage.testStorageKey;return!!e&&(e.setItem(t,"A"),"A"===e.getItem(t)&&(e.removeItem(t),!e.getItem(t)))}catch(e){return!1}},l.prototype.signRequest=function(e){var t=this.options,i=A;e.url=e.url.replace("{azMapsDomain}",t.azMapsDomain);var o=e.headers||{};o[i.SESSION_ID]=l.sessionId,o[i.MS_AM_REQUEST_ORIGIN]=i.MS_AM_REQUEST_ORIGIN_VALUE,o[i.MAP_AGENT]="MapControl/"+i.SDK_VERSION+" ("+i.TARGET_SDK+")";var r=this.getToken();switch(t.authType){case s.aad:case s.anonymous:o[i.X_MS_CLIENT_ID]=t.clientId,o[i.AUTHORIZATION]=i.AUTHORIZATION_SCHEME+" "+r;break;case s.subscriptionKey:if(!("url"in e))throw new Error("No URL specified in request.");var n="?";-1!==e.url.indexOf("?")&&(n="&"),e.url+=n+"subscription-key="+r;break;default:throw new Error("An invalid authentication type was specified")}return e.headers=o,e},l.prototype.getRequest=function(e){var t=this.signRequest({url:e});return fetch(t.url,{method:"GET",mode:"cors",headers:new Headers(t.headers)})},l.fallbackStorage={},l.sessionId=n.uuid(),l);function l(e){var t=this;this._initialized=!1,this._triggerTokenFetch=function(){var r=t;return new Promise(function(i,o){r.options.getToken(function(e){try{var t=r._getTokenExpiry(e)-A.tokenRefreshClockSkew;r._storeAccessToken(e),clearTimeout(r.tokenTimeOutHandle),r.tokenTimeOutHandle=setTimeout(r._triggerTokenFetch,t),i()}catch(e){o(new Error("Invalid token returned by getToken function"))}},function(e){o(e)})})},this.options=e}var E,p,T,u,d="https://{azMapsDomain}/map/tile?api-version="+A.RENDERV2_VERSION+"&tilesetId={tilesetId}&zoom={z}&x={x}&y={y}&tileSize={tileSize}&language={language}&view={view}",S=(E=a.UrlTemplateImageryProvider,i(p=g,T=E),p.prototype=null===T?Object.create(T):(f.prototype=T.prototype,new f),g.getImageryLayer=function(e,t){return new a.ImageryLayer(new g(e),t)},g.getAllOverlayImageryLayer=function(i,o){var r=[],n=A.TILESETS;return Object.keys(n).forEach(function(e){var t=n[e];t&&!t.isBasemap&&r.push(g.getImageryLayer(Object.assign({},i,{tilesetId:e}),o))}),r},g.getProviderViewModel=function(e,t){if(e){e.tilesetId=e.tilesetId||"microsoft.base.road";var i=A.TILESETS[e.tilesetId];if(i){var o=("boolean"==typeof t&&t?"Azure Maps ":"")+i.name;return new a.ProviderViewModel({name:o,iconUrl:i.icon,tooltip:o,creationFunction:function(){return new g(e)}})}}return null},g.getBaseMapProviderViewModels=function(i,o){var r=[],n=A.TILESETS;return Object.keys(n).forEach(function(e){var t=n[e];t&&t.isBasemap&&r.push(g.getProviderViewModel(Object.assign({},i,{tilesetId:e}),o))}),r},g.prototype.getTileCredits=function(e,t,i){var o,r=this._options.tilesetId;return r&&(r.startsWith("microsoft.base.")||r.startsWith("microsoft.traffic.")?o="TomTom":r.startsWith("microsoft.weather.")?o="AccuWeather":"microsoft.imagery"===r&&(o="Airbus"),o)?[new a.Credit("© "+(new Date).getFullYear()+" "+o,!0),new a.Credit("Microsoft",!0)]:[new a.Credit("Microsoft",!0)]},g.prototype.requestImage=function(e,t,r,i){var n=this;return new Promise(function(i,o){n._options.tilesetId?n._authManager.getRequest(n._getTileUrl(e,t,r)).then(function(e){e.blob().then(function(e){var t=new FileReader;t.onload=function(){var e=document.createElement("img");e.setAttribute("role","presentation"),e.src=t.result,e.style.visibility="visible",i(e)},t.onerror=function(){o("Unable to load tile.")},t.readAsDataURL(e)})},function(e){o(e)}):o("Azure Maps TilesetId not specified.")})},g.prototype.getDisplayName=function(){var e=this._options.tilesetId?A.TILESETS[this._options.tilesetId]:null;return e?e.name:null},g.prototype.getView=function(){return this._options.view},g.prototype.getLanguage=function(){return this._options.language},g.prototype.getTilesetId=function(){return this._options.tilesetId},g.prototype.getTimeStamp=function(){return this._options.timeStamp},g.prototype.getTrafficFlowThickness=function(){return this._options.trafficFlowThickness},g.prototype._setTilesetId=function(e){var t=this;t._options.tilesetId=e,t._baseUrl=d,e&&(e.startsWith("microsoft.traffic.flow")?t._baseUrl="https://{azMapsDomain}/traffic/flow/tile/png?api-version=1.0&style={style}&zoom={z}&x={x}&y={y}":e.startsWith("microsoft.traffic.incident")&&(t._baseUrl="https://{azMapsDomain}/traffic/incident/tile/png?api-version=1.0&style={style}&zoom={z}&x={x}&y={y}")),t._refresh()},g.prototype._getTileUrl=function(e,t,i){return this._getFormattedUrl().replace("{x}",e.toString()).replace("{y}",t.toString()).replace("{z}",i.toString())},g.prototype._refresh=function(){var e=this._options.tilesetId?A.TILESETS[this._options.tilesetId]:null;e=e||{name:"",maxZoom:22,hasAlpha:!0},E.prototype.reinitialize.call(this,{url:this._getFormattedUrl(),enablePickFeatures:!1,tileWidth:256,tileHeight:256,maximumLevel:e.maxZoom||22,hasAlphaChannel:e.hasAlpha})},g.prototype._getFormattedUrl=function(){var e=this._options,t=this._baseUrl.replace("{tileSize}","256").replace("{language}",e.language).replace("{view}",e.view).replace("{tilesetId}",e.tilesetId);if(e.tilesetId&&e.tilesetId.startsWith("microsoft.traffic")&&(t=t.replace("{style}",this._getTrafficStyle()),0<e.tilesetId.indexOf("flow")&&(t+="&thickness="+this._options.trafficFlowThickness)),e.timeStamp){var i=e.timeStamp;e.timeStamp instanceof Date&&(i=e.timeStamp.toISOString().slice(0,19)),t=t.replace("{timeStamp}",i)}return t},g.prototype._getTrafficStyle=function(){var e=this._options.tilesetId;return e&&-1<e.indexOf("microsoft.traffic.")?e.replace("microsoft.traffic.incident.","").replace("microsoft.traffic.flow.",""):null},g);function f(){this.constructor=p}function g(e){var t=E.call(this,{url:d,enablePickFeatures:!1,tileWidth:256,tileHeight:256,maximumLevel:22,hasAlphaChannel:!1})||this;t._baseUrl=d,t._options={};var i=t,o=Object.assign({language:"en-US",view:"Auto",tilesetId:"microsoft.base.road",trafficFlowThickness:5},e),r=(i._options=o).authOptions||{};r.azMapsDomain||(r.azMapsDomain=A.SHORT_DOMAIN);var n=h.getInstance(r);return(i._authManager=n).isInitialized()?i._setTilesetId(o.tilesetId):n.initialize().then(function(){i._setTilesetId(o.tilesetId)}),t}(u=e.AzureMapsTilesets||(e.AzureMapsTilesets={})).ROAD="microsoft.base.road",u.DARK_GRAYSCALE_ROAD="microsoft.base.darkgrey",u.ROAD_LABELS="microsoft.base.labels.road",u.ROAD_HYBRID="microsoft.base.hybrid.road",u.IMAGERY="microsoft.imagery",u.TRAFFIC_FLOW_ABSOLUTE="microsoft.traffic.flow.absolute",u.TRAFFIC_FLOW_REDUCED_SENSITIVITY="microsoft.traffic.flow.reduced-sensitivity",u.TRAFFIC_FLOW_RELATIVE="microsoft.traffic.flow.relative",u.TRAFFIC_FLOW_RELATIVE_DELAY="microsoft.traffic.flow.relative-delay",u.TRAFFIC_INCIDENT_NIGHT="microsoft.traffic.incident.night",u.TRAFFIC_INCIDENT_S1="microsoft.traffic.incident.s1",u.TRAFFIC_INCIDENT_S2="microsoft.traffic.incident.s2",u.TRAFFIC_INCIDENT_S3="microsoft.traffic.incident.s3",u.WEATHER_INFRARED="microsoft.weather.infrared.main",u.WEATHER_RADAR="microsoft.weather.radar.main";var _,R=(I.prototype.geocode=function(o,r){var s=this;return new Promise(function(t,i){var n=s._options,e="https://{azMapsDomain}/search/{searchService}/json?api-version=1.0&query={query}&language={language}&view={view}&typeahead={typeahead}".replace("{searchService}",n.searchService.replace(/_/gi,"/")).replace("{query}",o).replace("{language}",n.language).replace("{view}",n.view).replace("{typeahead}",("AUTOCOMPLETE"===r).toString());"ADDRESS_REVERSE"!==n.searchService&&(e+="&limit="+n.limit),s._authManager.getRequest(e).then(function(e){e.json().then(function(e){var r=[];e&&(e.results||e.addresses).forEach(function(e){var t;if(n.preferRectangle&&e.viewport){var i=e.viewport;t=a.Rectangle.fromDegrees(i.topLeftPoint.lon,i.btmRightPoint.lat,i.btmRightPoint.lon,i.topLeftPoint.lat)}if(!t)if("string"==typeof e.position){var o=e.position.split(",");t=a.Cartesian3.fromDegrees(parseFloat(o[1]),parseFloat(o[0]))}else t=a.Cartesian3.fromDegrees(e.position.lon,e.position.lat);r.push({displayName:e.poi&&e.poi.name?e.poi.name:e.address.freeformAddress,destination:t})}),t(r)})},function(e){i(e)})})},I);function I(e){this._options={};var t=Object.assign({language:"en-US",view:"Auto",searchService:"FUZZY",preferRectangle:!0,limit:10},e),i=(this._options=t).authOptions||{};i.azMapsDomain||(i.azMapsDomain=A.SHORT_DOMAIN);var o=h.getInstance(i);(this._authManager=o).isInitialized()||o.initialize()}(_=e.AzureMapsSearchServices||(e.AzureMapsSearchServices={})).ADDRESS="ADDRESS",_.ADDRESS_REVERSE="ADDRESS_REVERSE",_.ADDRESS_REVERSE_CROSSSTREET="ADDRESS_REVERSE_CROSSSTREET",_.FUZZY="FUZZY",_.POI="POI",_.POI_CATEGORY="POI_CATEGORY",e.AzureMapsGeocoderService=R,e.AzureMapsImageryProvider=S}(this.Cesium=this.Cesium||{},Cesium);
