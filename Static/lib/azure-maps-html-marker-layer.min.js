/* MIT License - Copyright (c) Microsoft Corporation. */


!function(e,y){"use strict";var r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(e,t)};function t(e,t){function o(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}var s=function(){return(s=Object.assign||function(e){for(var t,o=1,r=arguments.length;o<r;o++)for(var i in t=arguments[o])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},o=(i.merge=function(e,t){for(var o=window||global,r=0,i=e.split(".");r<i.length;r++){var a=i[r];if(!o[a])return t;o=o[a]}return s(s({},o),t)},i);function i(){}var a,n=(t(l,a=y.layer.BubbleLayer),l.prototype.getOptions=function(){return Object.assign({},this._options)},l.prototype.setOptions=function(e){var t=this._options,o={},r=!1;e.source&&t.source!==e.source&&(t.source=e.source,o.source=e.source,r=!0),e.sourceLayer&&t.sourceLayer!==e.sourceLayer&&(t.sourceLayer=e.sourceLayer,o.sourceLayer=e.sourceLayer,r=!0),e.filter&&t.filter!==e.filter&&(t.filter=e.filter,o.filter=e.filter,r=!0),"number"==typeof e.minZoom&&t.minZoom!==e.minZoom&&(t.minZoom=e.minZoom,o.minZoom=e.minZoom),"number"==typeof e.maxZoom&&t.maxZoom!==e.maxZoom&&(t.maxZoom=e.maxZoom,o.maxZoom=e.maxZoom),void 0!==e.visible&&t.visible!==e.visible&&(t.visible=e.visible,o.visible=e.visible),e.markerCallback&&t.markerCallback!=e.markerCallback&&(t.markerCallback=e.markerCallback,r=!0),"boolean"==typeof e.updateWhileMoving&&t.updateWhileMoving!==e.updateWhileMoving&&(t.updateWhileMoving=e.updateWhileMoving),r?this._clearCache(!0):this._updateMarkers(),a.prototype.setOptions.call(this,o)},l.prototype.update=function(){this._clearCache(!0),this._updateMarkers()},l.prototype.onAdd=function(e){var t=this,o=e.events;e&&(o.remove("moveend",t._updateMarkers),o.remove("move",t._mapMoved),o.remove("sourcedata",t._sourceUpdated)),(o=(t._map=e).events).add("moveend",t._updateMarkers),o.add("move",t._mapMoved),o.add("sourcedata",t._sourceUpdated),a.prototype.onAdd.call(this,e)},l.prototype.onRemove=function(){var e=this,t=e._map;if(t){var o=t.events;o.remove("moveend",e._updateMarkers),o.remove("move",e._mapMoved),o.remove("sourcedata",e._sourceUpdated)}e._clearCache(!1),e._map=null,a.prototype.onRemove.call(this)},l.prototype._getSourceClass=function(){var e=this.getSource();return"string"==typeof e&&null!==this._map?this._map.sources.getById(e):e instanceof y.source.Source?e:null},l.prototype._clearCache=function(e){var t=this;if(t._markerCache={},t._map)for(var o=0,r=t._markers.length;o<r;o++){var i=t._markers[o];t._removeEvents(i),i._eventsAttached=!1,t._map.markers.remove(i)}t._markers=[],t._markerIds=[],e&&t._updateMarkers()},l.prototype._getMarker=function(e,t,o){var r=this._markerCache,i=this._options;if(r[e=e||t.join(",")+JSON.stringify(o||{})])return r[e];var a=i.markerCallback(e,t,o);return a?(a.properties=o,a.id=e,a.setOptions({position:t}),r[e]=a):null},l.prototype._addEvents=function(t){var o=this;o._supportedEvents.forEach(function(e){o.map.events.add(e,t,o._wrappedEvent)})},l.prototype._removeEvents=function(t){var o=this;o._supportedEvents.forEach(function(e){o.map.events.remove(e,t,o._wrappedEvent)})},l);function l(e,t,o){var k=a.call(this,e,t)||this;return k._options={minZoom:0,maxZoom:24,visible:!0,updateWhileMoving:!1,filter:["==",["geometry-type"],"Point"],markerCallback:function(e,t,o){return o.cluster?new y.HtmlMarker({position:t,text:o.point_count_abbreviated}):new y.HtmlMarker({position:t})}},k._markers=[],k._markerIds=[],k._markerCache={},k._supportedEvents=["click","contextmenu","dblclick","drag","dragstart","dragend","keydown","keypress","keyup","mousedown","mouseenter","mouseleave","mousemove","mouseout","mouseover","mouseup"],k._mapMoved=function(){k._options.updateWhileMoving&&k._updateMarkers()},k._sourceUpdated=function(e){var t=k._getSourceClass();t&&t.getId()===e.source.id&&(k._timer&&clearTimeout(k._timer),k._timer=setTimeout(k._sourceUpdater,33))},k._sourceUpdater=function(){k._timer=null,k._clearCache(!0)},k._updateMarkers=function(){var e=k,t=e._map,o=e._markers,r=e._options,i=t?t.getCamera().zoom:void 0;if(r.visible&&void 0!==i&&i>=r.minZoom&&i<=r.maxZoom){for(var a=e.getSource(),s="string"==typeof a?a:a.getId(),n=t.map.querySourceFeatures(s,{sourceLayer:e.getOptions().sourceLayer,filter:r.filter}),l=[],p=[],c=void 0,u=void 0,d=void 0,m=void 0,h=void 0,v=void 0,_=0,f=n.length;_<f;_++)v=null,n[_]instanceof y.Shape?"Point"===(m=n[_]).getType()&&(d=m.getCoordinates(),u=m.getProperties(),c=m.getId()):"Point"===(h=n[_]).geometry.type&&(d=h.geometry.coordinates,(u=h.properties)&&u.cluster?c="cluster_"+h.properties.cluster_id:h.id&&(c=h.id)),d&&((v=e._getMarker(c,d,u))._eventsAttached||(e._addEvents(v),v._eventsAttached=!0),v&&(v.id&&p.push(v.id),v.id&&-1!==e._markerIds.indexOf(v.id)||(l.push(v),t.markers.add(v))));for(_=o.length-1;0<=_;_--)o[_].id&&-1!==p.indexOf(o[_].id)||(t.markers.remove(o[_]),o.splice(_,1));e._markers=o.concat(l),e._markerIds=p}else 0<e._markers.length&&(t.markers.remove(e._markers),e._markers=[])},k._wrappedEvent=function(e){k.map.events.invoke(e.type,k,e)},a.prototype.setOptions.call(k,{color:"transparent",radius:0,strokeWidth:0}),k.setOptions(o||{}),k}var g,p=Object.freeze({__proto__:null,HtmlMarkerLayer:n}),c=(t(C,g=y.HtmlMarker),C.prototype.getTotalValue=function(){return this._total},C.prototype.getSliceValue=function(e){var t=this._options.values;return 0<=e&&e<t.length?t[e]:0},C.prototype.getSlicePercentage=function(e){return 0<this._total?Math.round(this.getSliceValue(e)/this._total*1e4)/100:0},C.prototype.getOptions=function(){return Object.assign({},g.prototype.getOptions.call(this),this._options)},C.prototype.setOptions=function(e){var t=this._options,o=JSON.stringify,r=!1;e.radius&&0<e.radius&&e.radius!=t.radius&&(t.radius=e.radius,r=!0),0<=e.innerRadius&&e.innerRadius!=t.innerRadius&&(t.innerRadius=e.innerRadius,r=!0),e.colors&&o(e.colors)!==o(t.colors)&&(t.colors=e.colors,r=!0),e.fillColor&&o(e.fillColor)!==o(t.fillColor)&&(t.fillColor=e.fillColor,r=!0),e.strokeColor&&e.strokeColor!==t.strokeColor&&(t.strokeColor=e.strokeColor,r=!0),0<=e.strokeWidth&&e.strokeWidth!=t.strokeWidth&&(t.strokeWidth=e.strokeWidth,r=!0),void 0!==e.tooltipCallback&&t.tooltipCallback!=e.tooltipCallback&&(t.tooltipCallback=e.tooltipCallback,r=!0),e.values&&o(e.values)!==o(t.values)&&(t.values=e.values,r=!0),e.text!==t.text&&(g.prototype.setOptions.call(this,{text:e.text}),r=!0),e.textClassName!==t.textClassName&&(t.textClassName=e.textClassName,r=!0),r&&this._render(),g.prototype.setOptions.call(this,e)},C.prototype._render=function(){var e=this,t=e._options,o=t.values,r=t.radius,i=0,a=0;if(o){e._total=o.reduce(function(e,t){return e+t},0);for(var s=C._moreColors,n=Math.random,l=Math.round,p=0;o.length>t.colors.length;)s.length<o.length&&s.push("hsl("+l(360*n())+","+(l(20*n())+70)+"%,"+(l(40*n())+30)+"%)"),t.colors.push(s[p]),p++;var c=r+t.strokeWidth,u=['<svg xmlns="http://www.w3.org/2000/svg" width="'+2*c+'px" height="'+2*c+'px">'],d="",m=void 0;if(0<t.innerRadius&&t.innerRadius<=t.radius&&(m="piechart-innercircle-"+l(1e7*n()),u.push('<defs><mask id="'+m+'"><rect width="100%" height="100%" fill="white"/><circle r="'+t.innerRadius+'" cx="'+c+'" cy="'+c+'" fill="black"/></mask></defs>\n                    <circle r="'+t.innerRadius+'" cx="'+c+'" cy="'+c+'" style="fill:'+t.fillColor+";stroke:"+t.strokeColor+";stroke-width:"+2*t.strokeWidth+'px;"/>')),0<e._total)for(var h=t.tooltipCallback,v=2*Math.PI/e._total,_=0;_<o.length;_++){a=v*o[_],h&&(d=h(e,_));var f=_<t.colors.length?t.colors[_]:s[_];u.push(e._createSlice(c,c,r,i,a,f,d,m)),i+=a}var k=g.prototype.getOptions.call(this).text;k&&u.push('<text x="'+c+'" y="'+(c+7)+'" style="font-size:16px;font-family:arial;fill:#000;font-weight:bold;" class="'+(t.textClassName||"")+'" text-anchor="middle">'+k+"</text>"),u.push("</svg>"),g.prototype.getOptions.call(this).htmlContent.innerHTML=u.join("")}},C.prototype._createSlice=function(e,t,o,r,i,a,s,n){var l=this._options,p=Math.PI,c="";if(n&&(c=' mask="url(#'+n+'"'),2*p*.99<i)return'<circle r="'+o+'" cx="'+e+'" cy="'+t+'" style="fill:'+a+";stroke:"+l.strokeColor+";stroke-width:"+l.strokeWidth+'px;"'+c+"><title>"+s+"</title></circle>";var u=Math.sin,d=Math.cos,m=e+o*u(r),h=t-o*d(r),v=e+o*u(r+i),_=t-o*d(r+i),f=(l.innerRadius,u(r),l.innerRadius,d(r),l.innerRadius,u(r+i),l.innerRadius,d(r+i),0);return p<i&&(f=1),'<path d="M'+e+" "+t+" L "+m+" "+h+" A "+o+","+o+" 0 "+f+" 1 "+v+" "+_+'z" style="fill:'+a+";stroke:"+l.strokeColor+";stroke-width:"+l.strokeWidth+'px;"'+c+"><title>"+s+"</title></path>"},C._moreColors=[],C);function C(e){var t=g.call(this,e)||this;return t._options={values:[],radius:40,colors:["#d7191c","#fdae61","#ffffbf","#abdda4","#2b83ba"],fillColor:"transparent",strokeWidth:0,strokeColor:"#666666",innerRadius:0},t._total=0,t.properties={},g.prototype.setOptions.call(t,{htmlContent:document.createElement("div"),pixelOffset:[0,0],anchor:"center"}),t.setOptions(e),t}var u=o.merge("atlas.layer",p);e.PieChartMarker=c,e.layer=u}(this.atlas=this.atlas||{},atlas);
